<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/hotspot/jtreg/runtime/sealedClasses/GetPermittedSubclasses.jcod</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 // This class has entries in its PermittedSubclasses attribute that do not exist.
 25 // Test that this does not prevent JVM_GetPermittedSubclasses() from returning
 26 // their names.
 27 //
 28 // sealed class NoLoadSubclasses permits iDontExist, I/Dont/Exist/Either { }
 29 //
 30 class NoLoadSubclasses {
 31   0xCAFEBABE;
 32   65535; // minor version
 33   60; // version
 34   [18] { // Constant Pool
 35     ; // first element is empty
 36     Method #2 #3; // #1     at 0x0A
 37     class #4; // #2     at 0x0F
 38     NameAndType #5 #6; // #3     at 0x12
 39     Utf8 &quot;java/lang/Object&quot;; // #4     at 0x17
 40     Utf8 &quot;&lt;init&gt;&quot;; // #5     at 0x2A
 41     Utf8 &quot;()V&quot;; // #6     at 0x33
 42     class #8; // #7     at 0x39
 43     Utf8 &quot;NoLoadSubclasses&quot;; // #8     at 0x3C
 44     Utf8 &quot;Code&quot;; // #9     at 0x4D
 45     Utf8 &quot;LineNumberTable&quot;; // #10     at 0x54
 46     Utf8 &quot;SourceFile&quot;; // #11     at 0x66
 47     Utf8 &quot;NoLoadSubclasses.java&quot;; // #12     at 0x73
 48     Utf8 &quot;PermittedSubclasses&quot;; // #13     at 0x89
 49     class #15; // #14     at 0x9D
 50     Utf8 &quot;iDontExist&quot;; // #15     at 0xA0
 51     class #17; // #16     at 0xAA
 52     Utf8 &quot;I/Dont/Exist/Either&quot;; // #17     at 0xAD
 53   } // Constant Pool
 54 
 55   0x0020; // access [ ACC_SUPER ]
 56   #7;// this_cpx
 57   #2;// super_cpx
 58 
 59   [0] { // Interfaces
 60   } // Interfaces
 61 
 62   [0] { // fields
 63   } // fields
 64 
 65   [1] { // methods
 66     { // Member at 0xC1
 67       0x0000; // access
 68       #5; // name_cpx
 69       #6; // sig_cpx
 70       [1] { // Attributes
 71         Attr(#9, 29) { // Code at 0xC9
 72           1; // max_stack
 73           1; // max_locals
 74           Bytes[5]{
 75             0x2AB70001B1;
 76           }
 77           [0] { // Traps
 78           } // end Traps
 79           [1] { // Attributes
 80             Attr(#10, 6) { // LineNumberTable at 0xE0
 81               [1] { // LineNumberTable
 82                 0  1; //  at 0xEC
 83               }
 84             } // end LineNumberTable
 85           } // Attributes
 86         } // end Code
 87       } // Attributes
 88     } // Member
 89   } // methods
 90 
 91   [2] { // Attributes
 92     Attr(#13, 6) { // PermittedSubclasses at 0xF6
 93       0x0002000E0010;
 94     } // end PermittedSubclasses
 95     ;
 96     Attr(#11, 2) { // SourceFile at 0xEE
 97       #12;
 98     } // end SourceFile
 99   } // Attributes
100 } // end class NoLoadSubclasses
101 
102 
103 
104 // This class contains an empty PermittedSubclasses attribute.  Test that
105 // this causes an exception to get thrown.
106 class NoSubclasses {
107   0xCAFEBABE;
108   65535; // minor version
109   60; // version
110   [14] { // Constant Pool
111     ; // first element is empty
112     Method #2 #3; // #1     at 0x0A
113     class #4; // #2     at 0x0F
114     NameAndType #5 #6; // #3     at 0x12
115     Utf8 &quot;java/lang/Object&quot;; // #4     at 0x17
116     Utf8 &quot;&lt;init&gt;&quot;; // #5     at 0x2A
117     Utf8 &quot;()V&quot;; // #6     at 0x33
118     class #8; // #7     at 0x39
119     Utf8 &quot;NoSubclasses&quot;; // #8     at 0x3C
120     Utf8 &quot;Code&quot;; // #9     at 0x49
121     Utf8 &quot;LineNumberTable&quot;; // #10     at 0x50
122     Utf8 &quot;SourceFile&quot;; // #11     at 0x62
123     Utf8 &quot;NoSubclasses.java&quot;; // #12     at 0x6F
124     Utf8 &quot;PermittedSubclasses&quot;; // #13     at 0x81
125   } // Constant Pool
126 
127   0x0020; // access [ ACC_SUPER ]
128   #7;// this_cpx
129   #2;// super_cpx
130 
131   [0] { // Interfaces
132   } // Interfaces
133 
134   [0] { // fields
135   } // fields
136 
137   [1] { // methods
138     { // Member at 0xAB
139       0x0000; // access
140       #5; // name_cpx
141       #6; // sig_cpx
142       [1] { // Attributes
143         Attr(#9, 29) { // Code at 0xB3
144           1; // max_stack
145           1; // max_locals
146           Bytes[5]{
147             0x2AB70001B1;
148           }
149           [0] { // Traps
150           } // end Traps
151           [1] { // Attributes
152             Attr(#10, 6) { // LineNumberTable at 0xCA
153               [1] { // LineNumberTable
154                 0  1; //  at 0xD6
155               }
156             } // end LineNumberTable
157           } // Attributes
158         } // end Code
159       } // Attributes
160     } // Member
161   } // methods
162 
163   [2] { // Attributes
164     Attr(#11, 2) { // SourceFile at 0xD8
165       #12;
166     } // end SourceFile
167     ;
168     Attr(#13, 2) { // PermittedSubclasses at 0xE0
169       0x0000;
170     } // end PermittedSubclasses
171   } // Attributes
172 } // end class NoSubclasses
173 
174 
175 
176 // This class has a PermittedSubclasses attribute but an old class file version.
177 // The PermittedSubclasses attribute should be ignored.
178 //
179 // sealed class OldClassFile permits iDontExist, I/Dont/Exist/Either { }
180 //
181 class OldClassFile {
182   0xCAFEBABE;
183   0; // minor version
184   57; // version
185   [18] { // Constant Pool
186     ; // first element is empty
187     Method #2 #3; // #1     at 0x0A
188     class #4; // #2     at 0x0F
189     NameAndType #5 #6; // #3     at 0x12
190     Utf8 &quot;java/lang/Object&quot;; // #4     at 0x17
191     Utf8 &quot;&lt;init&gt;&quot;; // #5     at 0x2A
192     Utf8 &quot;()V&quot;; // #6     at 0x33
193     class #8; // #7     at 0x39
194     Utf8 &quot;OldClassFile&quot;; // #8     at 0x3C
195     Utf8 &quot;Code&quot;; // #9     at 0x4D
196     Utf8 &quot;LineNumberTable&quot;; // #10     at 0x54
197     Utf8 &quot;SourceFile&quot;; // #11     at 0x66
198     Utf8 &quot;OldClassFile.java&quot;; // #12     at 0x73
199     Utf8 &quot;PermittedSubclasses&quot;; // #13     at 0x89
200     class #15; // #14     at 0x9D
201     Utf8 &quot;iDontExist&quot;; // #15     at 0xA0
202     class #17; // #16     at 0xAA
203     Utf8 &quot;I/Dont/Exist/Either&quot;; // #17     at 0xAD
204   } // Constant Pool
205 
206   0x0030; // access [ ACC_SUPER ACC_FINAL ]
207   #7;// this_cpx
208   #2;// super_cpx
209 
210   [0] { // Interfaces
211   } // Interfaces
212 
213   [0] { // fields
214   } // fields
215 
216   [1] { // methods
217     { // Member at 0xC1
218       0x0000; // access
219       #5; // name_cpx
220       #6; // sig_cpx
221       [1] { // Attributes
222         Attr(#9, 29) { // Code at 0xC9
223           1; // max_stack
224           1; // max_locals
225           Bytes[5]{
226             0x2AB70001B1;
227           }
228           [0] { // Traps
229           } // end Traps
230           [1] { // Attributes
231             Attr(#10, 6) { // LineNumberTable at 0xE0
232               [1] { // LineNumberTable
233                 0  1; //  at 0xEC
234               }
235             } // end LineNumberTable
236           } // Attributes
237         } // end Code
238       } // Attributes
239     } // Member
240   } // methods
241 
242   [2] { // Attributes
243     Attr(#11, 2) { // SourceFile at 0xEE
244       #12;
245     } // end SourceFile
246     ;
247     Attr(#13, 6) { // PermittedSubclasses at 0xF6
248       0x0002000E0010;
249     } // end PermittedSubclasses
250   } // Attributes
251 } // end class OldClassFile
252 
253 
254 
255 // This class has a corrupted PermittedSubclasses attribute.  Attempts to load it
256 // should throw ClassFormatError.
257 class BadPermittedAttr {
258   0xCAFEBABE;
259   65535; // minor version
260   60; // version
261   [18] { // Constant Pool
262     ; // first element is empty
263     Method #2 #3; // #1     at 0x0A
264     class #4; // #2     at 0x0F
265     NameAndType #5 #6; // #3     at 0x12
266     Utf8 &quot;java/lang/Object&quot;; // #4     at 0x17
267     Utf8 &quot;&lt;init&gt;&quot;; // #5     at 0x2A
268     Utf8 &quot;()V&quot;; // #6     at 0x33
269     class #8; // #7     at 0x39
270     Utf8 &quot;BadPermittedAttr&quot;; // #8     at 0x3C
271     Utf8 &quot;Code&quot;; // #9     at 0x4D
272     Utf8 &quot;LineNumberTable&quot;; // #10     at 0x54
273     Utf8 &quot;SourceFile&quot;; // #11     at 0x66
274     Utf8 &quot;BadPermittedAttr.java&quot;; // #12     at 0x73
275     Utf8 &quot;PermittedSubclasses&quot;; // #13     at 0x89
276     class #15; // #14     at 0x9D
277     Utf8 &quot;iDontExist&quot;; // #15     at 0xA0
278     class #17; // #16     at 0xAA
279     Utf8 &quot;I/Dont/Exist/Either&quot;; // #17     at 0xAD
280   } // Constant Pool
281 
282   0x0020; // access [ ACC_SUPER ]
283   #7;// this_cpx
284   #2;// super_cpx
285 
286   [0] { // Interfaces
287   } // Interfaces
288 
289   [0] { // fields
290   } // fields
291 
292   [1] { // methods
293     { // Member at 0xC1
294       0x0000; // access
295       #5; // name_cpx
296       #6; // sig_cpx
297       [1] { // Attributes
298         Attr(#9, 29) { // Code at 0xC9
299           1; // max_stack
300           1; // max_locals
301           Bytes[5]{
302             0x2AB70001B1;
303           }
304           [0] { // Traps
305           } // end Traps
306           [1] { // Attributes
307             Attr(#10, 6) { // LineNumberTable at 0xE0
308               [1] { // LineNumberTable
309                 0  1; //  at 0xEC
310               }
311             } // end LineNumberTable
312           } // Attributes
313         } // end Code
314       } // Attributes
315     } // Member
316   } // methods
317 
318   [2] { // Attributes
319     Attr(#11, 2) { // SourceFile at 0xEE
320       #12;
321     } // end SourceFile
322     ;
323     Attr(#13, 6) { // PermittedSubclasses at 0xF6
324       0x0002000F0010;
325     } // end PermittedSubclasses
326   } // Attributes
327 } // end class BadPermittedAttr
328 
329 
330 // This class has a PermittedSubclasses attribute and is marked Final.
331 // Loading this class should throw a ClassFormatError exception.
332 //
333 // sealed class SealedButFinal permits iDontExist, I/Dont/Exist/Either { }
334 //
335 class SealedButFinal {
336   0xCAFEBABE;
337   65535; // minor version
338   60; // version
339   [18] { // Constant Pool
340     ; // first element is empty
341     Method #2 #3; // #1     at 0x0A
342     class #4; // #2     at 0x0F
343     NameAndType #5 #6; // #3     at 0x12
344     Utf8 &quot;java/lang/Object&quot;; // #4     at 0x17
345     Utf8 &quot;&lt;init&gt;&quot;; // #5     at 0x2A
346     Utf8 &quot;()V&quot;; // #6     at 0x33
347     class #8; // #7     at 0x39
348     Utf8 &quot;SealedButFinal&quot;; // #8     at 0x3C
349     Utf8 &quot;Code&quot;; // #9     at 0x4D
350     Utf8 &quot;LineNumberTable&quot;; // #10     at 0x54
351     Utf8 &quot;SourceFile&quot;; // #11     at 0x66
352     Utf8 &quot;SealedButFinal.java&quot;; // #12     at 0x73
353     Utf8 &quot;PermittedSubclasses&quot;; // #13     at 0x89
354     class #15; // #14     at 0x9D
355     Utf8 &quot;iDontExist&quot;; // #15     at 0xA0
356     class #17; // #16     at 0xAA
357     Utf8 &quot;I/Dont/Exist/Either&quot;; // #17     at 0xAD
358   } // Constant Pool
359 
360   0x0030; // access [ ACC_SUPER ACC_FINAL ]
361   #7;// this_cpx
362   #2;// super_cpx
363 
364   [0] { // Interfaces
365   } // Interfaces
366 
367   [0] { // fields
368   } // fields
369 
370   [1] { // methods
371     { // Member at 0xC1
372       0x0000; // access
373       #5; // name_cpx
374       #6; // sig_cpx
375       [1] { // Attributes
376         Attr(#9, 29) { // Code at 0xC9
377           1; // max_stack
378           1; // max_locals
379           Bytes[5]{
380             0x2AB70001B1;
381           }
382           [0] { // Traps
383           } // end Traps
384           [1] { // Attributes
385             Attr(#10, 6) { // LineNumberTable at 0xE0
386               [1] { // LineNumberTable
387                 0  1; //  at 0xEC
388               }
389             } // end LineNumberTable
390           } // Attributes
391         } // end Code
392       } // Attributes
393     } // Member
394   } // methods
395 
396   [2] { // Attributes
397     Attr(#11, 2) { // SourceFile at 0xEE
398       #12;
399     } // end SourceFile
400     ;
401     Attr(#13, 6) { // PermittedSubclasses at 0xF6
402       0x0002000E0010;
403     } // end PermittedSubclasses
404   } // Attributes
405 } // end class SealedButFinal
406 
407 
408 // This class contains a PermittedSubclasses attribute with an invalid class
409 // name.  Test that this causes a ClassFormatError exception to get thrown.
410 //
411 // sealed class BadPermittedSubclassEntry permits iDont;;Exist, I/Dont/Exist/Either { }
412 //
413 class BadPermittedSubclassEntry {
414   0xCAFEBABE;
415   65535; // minor version
416   60; // version
417   [18] { // Constant Pool
418     ; // first element is empty
419     Method #2 #3; // #1     at 0x0A
420     class #4; // #2     at 0x0F
421     NameAndType #5 #6; // #3     at 0x12
422     Utf8 &quot;java/lang/Object&quot;; // #4     at 0x17
423     Utf8 &quot;&lt;init&gt;&quot;; // #5     at 0x2A
424     Utf8 &quot;()V&quot;; // #6     at 0x33
425     class #8; // #7     at 0x39
426     Utf8 &quot;BadPermittedSubclassEntry&quot;; // #8     at 0x3C
427     Utf8 &quot;Code&quot;; // #9     at 0x4D
428     Utf8 &quot;LineNumberTable&quot;; // #10     at 0x54
429     Utf8 &quot;SourceFile&quot;; // #11     at 0x66
430     Utf8 &quot;BadPermittedSubclassEntry.java&quot;; // #12     at 0x73
431     Utf8 &quot;PermittedSubclasses&quot;; // #13     at 0x89
432     class #15; // #14     at 0x9D
433     Utf8 &quot;iDont;;Exist&quot;; // #15     at 0xA0
434     class #17; // #16     at 0xAA
435     Utf8 &quot;I/Dont/Exist/Either&quot;; // #17     at 0xAD
436   } // Constant Pool
437 
438   0x0020; // access [ ACC_SUPER ]
439   #7;// this_cpx
440   #2;// super_cpx
441 
442   [0] { // Interfaces
443   } // Interfaces
444 
445   [0] { // fields
446   } // fields
447 
448   [1] { // methods
449     { // Member at 0xC1
450       0x0000; // access
451       #5; // name_cpx
452       #6; // sig_cpx
453       [1] { // Attributes
454         Attr(#9, 29) { // Code at 0xC9
455           1; // max_stack
456           1; // max_locals
457           Bytes[5]{
458             0x2AB70001B1;
459           }
460           [0] { // Traps
461           } // end Traps
462           [1] { // Attributes
463             Attr(#10, 6) { // LineNumberTable at 0xE0
464               [1] { // LineNumberTable
465                 0  1; //  at 0xEC
466               }
467             } // end LineNumberTable
468           } // Attributes
469         } // end Code
470       } // Attributes
471     } // Member
472   } // methods
473 
474   [2] { // Attributes
475     Attr(#13, 6) { // PermittedSubclasses at 0xF6
476       0x0002000E0010;
477     } // end PermittedSubclasses
478     ;
479     Attr(#11, 2) { // SourceFile at 0xEE
480       #12;
481     } // end SourceFile
482   } // Attributes
483 }
484 
485 // This class contains a PermittedSubclasses attribute with an empty class
486 // name.  Test that this causes a ClassFormatError exception to get thrown.
487 //
488 // sealed class EmptyPermittedSubclassEntry permits &quot;&quot;, I/Dont/Exist/Either { }
489 //
490 class EmptyPermittedSubclassEntry {
491   0xCAFEBABE;
492   65535; // minor version
493   60; // version
494   [18] { // Constant Pool
495     ; // first element is empty
496     Method #2 #3; // #1     at 0x0A
497     class #4; // #2     at 0x0F
498     NameAndType #5 #6; // #3     at 0x12
499     Utf8 &quot;java/lang/Object&quot;; // #4     at 0x17
500     Utf8 &quot;&lt;init&gt;&quot;; // #5     at 0x2A
501     Utf8 &quot;()V&quot;; // #6     at 0x33
502     class #8; // #7     at 0x39
503     Utf8 &quot;EmptyPermittedSubclassEntry&quot;; // #8     at 0x3C
504     Utf8 &quot;Code&quot;; // #9     at 0x4D
505     Utf8 &quot;LineNumberTable&quot;; // #10     at 0x54
506     Utf8 &quot;SourceFile&quot;; // #11     at 0x66
507     Utf8 &quot;EmptyPermittedSubclassEntry.java&quot;; // #12     at 0x73
508     Utf8 &quot;PermittedSubclasses&quot;; // #13     at 0x89
509     class #15; // #14     at 0x9D
510     Utf8 &quot;&quot;; // #15     at 0xA0
511     class #17; // #16     at 0xAA
512     Utf8 &quot;I/Dont/Exist/Either&quot;; // #17     at 0xAD
513   } // Constant Pool
514 
515   0x0020; // access [ ACC_SUPER ]
516   #7;// this_cpx
517   #2;// super_cpx
518 
519   [0] { // Interfaces
520   } // Interfaces
521 
522   [0] { // fields
523   } // fields
524 
525   [1] { // methods
526     { // Member at 0xC1
527       0x0000; // access
528       #5; // name_cpx
529       #6; // sig_cpx
530       [1] { // Attributes
531         Attr(#9, 29) { // Code at 0xC9
532           1; // max_stack
533           1; // max_locals
534           Bytes[5]{
535             0x2AB70001B1;
536           }
537           [0] { // Traps
538           } // end Traps
539           [1] { // Attributes
540             Attr(#10, 6) { // LineNumberTable at 0xE0
541               [1] { // LineNumberTable
542                 0  1; //  at 0xEC
543               }
544             } // end LineNumberTable
545           } // Attributes
546         } // end Code
547       } // Attributes
548     } // Member
549   } // methods
550 
551   [2] { // Attributes
552     Attr(#13, 6) { // PermittedSubclasses at 0xF6
553       0x0002000E0010;
554     } // end PermittedSubclasses
555     ;
556     Attr(#11, 2) { // SourceFile at 0xEE
557       #12;
558     } // end SourceFile
559   } // Attributes
560 }
    </pre>
  </body>
</html>