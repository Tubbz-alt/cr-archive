<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/utils/UnsyncByteArrayOutputStream.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../../../../java.compiler/share/classes/javax/lang/model/util/TypeKindVisitor14.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../../jdk.compiler/share/classes/com/sun/tools/doclint/Checker.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/utils/UnsyncByteArrayOutputStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 29  * A simple Unsynced ByteArrayOutputStream
 30  *
 31  */
 32 public class UnsyncByteArrayOutputStream extends OutputStream  {
 33 
 34     // Maximum array size. Using same value as ArrayList in OpenJDK.
 35     // Integer.MAX_VALUE doesn&#39;t work on some VMs, as some header values are reserved
 36     private static final int VM_ARRAY_INDEX_MAX_VALUE = Integer.MAX_VALUE - 8;
 37     private static final int INITIAL_SIZE = 8192;
 38 
 39     private byte[] buf;
 40     private int size = INITIAL_SIZE;
 41     private int pos;
 42 
 43     public UnsyncByteArrayOutputStream() {
 44         buf = new byte[INITIAL_SIZE];
 45     }
 46 
 47     public void write(byte[] arg0) {
 48         if ((VM_ARRAY_INDEX_MAX_VALUE - pos) &lt; arg0.length) {
<span class="line-modified"> 49             throw new OutOfMemoryError();</span>
 50         }
 51         int newPos = pos + arg0.length;
 52         if (newPos &gt; size) {
 53             expandSize(newPos);
 54         }
 55         System.arraycopy(arg0, 0, buf, pos, arg0.length);
 56         pos = newPos;
 57     }
 58 
 59     public void write(byte[] arg0, int arg1, int arg2) {
 60         if ((VM_ARRAY_INDEX_MAX_VALUE - pos) &lt; arg2) {
<span class="line-modified"> 61             throw new OutOfMemoryError();</span>
 62         }
 63         int newPos = pos + arg2;
 64         if (newPos &gt; size) {
 65             expandSize(newPos);
 66         }
 67         System.arraycopy(arg0, arg1, buf, pos, arg2);
 68         pos = newPos;
 69     }
 70 
 71     public void write(int arg0) {
 72         if (VM_ARRAY_INDEX_MAX_VALUE - pos == 0) {
<span class="line-modified"> 73             throw new OutOfMemoryError();</span>
 74         }
 75         int newPos = pos + 1;
 76         if (newPos &gt; size) {
 77             expandSize(newPos);
 78         }
 79         buf[pos++] = (byte)arg0;
 80     }
 81 
 82     public byte[] toByteArray() {
 83         byte result[] = new byte[pos];
 84         System.arraycopy(buf, 0, result, 0, pos);
 85         return result;
 86     }
 87 
 88     public void reset() {
 89         pos = 0;
 90     }
 91 
 92     /**
 93      * Takes the contents of this stream and writes it to the output stream
</pre>
<hr />
<pre>
 99      *             if an error occurs while writing to {@code out}.
100      */
101     public void writeTo(OutputStream out) throws IOException {
102         out.write(buf, 0, pos);
103     }
104 
105     private void expandSize(int newPos) {
106         int newSize = size;
107         while (newPos &gt; newSize) {
108             newSize = newSize &lt;&lt; 1;
109             // Deal with overflow
110             if (newSize &lt; 0) {
111                 newSize = VM_ARRAY_INDEX_MAX_VALUE;
112             }
113         }
114         byte newBuf[] = new byte[newSize];
115         System.arraycopy(buf, 0, newBuf, 0, pos);
116         buf = newBuf;
117         size = newSize;
118     }
<span class="line-modified">119 }</span>
</pre>
</td>
<td>
<hr />
<pre>
 29  * A simple Unsynced ByteArrayOutputStream
 30  *
 31  */
 32 public class UnsyncByteArrayOutputStream extends OutputStream  {
 33 
 34     // Maximum array size. Using same value as ArrayList in OpenJDK.
 35     // Integer.MAX_VALUE doesn&#39;t work on some VMs, as some header values are reserved
 36     private static final int VM_ARRAY_INDEX_MAX_VALUE = Integer.MAX_VALUE - 8;
 37     private static final int INITIAL_SIZE = 8192;
 38 
 39     private byte[] buf;
 40     private int size = INITIAL_SIZE;
 41     private int pos;
 42 
 43     public UnsyncByteArrayOutputStream() {
 44         buf = new byte[INITIAL_SIZE];
 45     }
 46 
 47     public void write(byte[] arg0) {
 48         if ((VM_ARRAY_INDEX_MAX_VALUE - pos) &lt; arg0.length) {
<span class="line-modified"> 49             throw new OutOfMemoryError(&quot;Required length exceeds implementation limit&quot;);</span>
 50         }
 51         int newPos = pos + arg0.length;
 52         if (newPos &gt; size) {
 53             expandSize(newPos);
 54         }
 55         System.arraycopy(arg0, 0, buf, pos, arg0.length);
 56         pos = newPos;
 57     }
 58 
 59     public void write(byte[] arg0, int arg1, int arg2) {
 60         if ((VM_ARRAY_INDEX_MAX_VALUE - pos) &lt; arg2) {
<span class="line-modified"> 61             throw new OutOfMemoryError(&quot;Required length exceeds implementation limit&quot;);</span>
 62         }
 63         int newPos = pos + arg2;
 64         if (newPos &gt; size) {
 65             expandSize(newPos);
 66         }
 67         System.arraycopy(arg0, arg1, buf, pos, arg2);
 68         pos = newPos;
 69     }
 70 
 71     public void write(int arg0) {
 72         if (VM_ARRAY_INDEX_MAX_VALUE - pos == 0) {
<span class="line-modified"> 73             throw new OutOfMemoryError(&quot;Required length exceeds implementation limit&quot;);</span>
 74         }
 75         int newPos = pos + 1;
 76         if (newPos &gt; size) {
 77             expandSize(newPos);
 78         }
 79         buf[pos++] = (byte)arg0;
 80     }
 81 
 82     public byte[] toByteArray() {
 83         byte result[] = new byte[pos];
 84         System.arraycopy(buf, 0, result, 0, pos);
 85         return result;
 86     }
 87 
 88     public void reset() {
 89         pos = 0;
 90     }
 91 
 92     /**
 93      * Takes the contents of this stream and writes it to the output stream
</pre>
<hr />
<pre>
 99      *             if an error occurs while writing to {@code out}.
100      */
101     public void writeTo(OutputStream out) throws IOException {
102         out.write(buf, 0, pos);
103     }
104 
105     private void expandSize(int newPos) {
106         int newSize = size;
107         while (newPos &gt; newSize) {
108             newSize = newSize &lt;&lt; 1;
109             // Deal with overflow
110             if (newSize &lt; 0) {
111                 newSize = VM_ARRAY_INDEX_MAX_VALUE;
112             }
113         }
114         byte newBuf[] = new byte[newSize];
115         System.arraycopy(buf, 0, newBuf, 0, pos);
116         buf = newBuf;
117         size = newSize;
118     }
<span class="line-modified">119 }</span>
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../../../../../java.compiler/share/classes/javax/lang/model/util/TypeKindVisitor14.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../../jdk.compiler/share/classes/com/sun/tools/doclint/Checker.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>