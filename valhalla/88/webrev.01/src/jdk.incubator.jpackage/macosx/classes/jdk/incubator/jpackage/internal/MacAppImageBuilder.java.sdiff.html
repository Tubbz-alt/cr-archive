<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jpackage/macosx/classes/jdk/incubator/jpackage/internal/MacAppImageBuilder.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../jdk.compiler/share/classes/com/sun/tools/javac/processing/PrintingProcessor.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacDmgBundler.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/macosx/classes/jdk/incubator/jpackage/internal/MacAppImageBuilder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
293             if (f != null &amp;&amp; f.exists()) {
294                 try (InputStream in2 = new FileInputStream(f)) {
295                     Files.copy(in2, resourcesDir.resolve(f.getName()));
296                 }
297 
298             }
299         }
300 
301         copyRuntimeFiles(params);
302         sign(params);
303     }
304 
305     private void copyRuntimeFiles(Map&lt;String, ? super Object&gt; params)
306             throws IOException {
307         // Generate Info.plist
308         writeInfoPlist(contentsDir.resolve(&quot;Info.plist&quot;).toFile(), params);
309 
310         // generate java runtime info.plist
311         writeRuntimeInfoPlist(
312                 runtimeDir.resolve(&quot;Contents/Info.plist&quot;).toFile(), params);













313     }
314 
315     private void sign(Map&lt;String, ? super Object&gt; params) throws IOException {
316         if (Optional.ofNullable(
317                 SIGN_BUNDLE.fetchFrom(params)).orElse(Boolean.TRUE)) {
318             try {
319                 addNewKeychain(params);
320             } catch (InterruptedException e) {
321                 Log.error(e.getMessage());
322             }
323             String signingIdentity =
324                     DEVELOPER_ID_APP_SIGNING_KEY.fetchFrom(params);
325             if (signingIdentity != null) {
326                 prepareEntitlements(params);
327                 signAppBundle(params, root, signingIdentity,
328                         BUNDLE_ID_SIGNING_PREFIX.fetchFrom(params),
329                         getConfig_Entitlements(params));
330             }
331             restoreKeychainList(params);
332         }
</pre>
</td>
<td>
<hr />
<pre>
293             if (f != null &amp;&amp; f.exists()) {
294                 try (InputStream in2 = new FileInputStream(f)) {
295                     Files.copy(in2, resourcesDir.resolve(f.getName()));
296                 }
297 
298             }
299         }
300 
301         copyRuntimeFiles(params);
302         sign(params);
303     }
304 
305     private void copyRuntimeFiles(Map&lt;String, ? super Object&gt; params)
306             throws IOException {
307         // Generate Info.plist
308         writeInfoPlist(contentsDir.resolve(&quot;Info.plist&quot;).toFile(), params);
309 
310         // generate java runtime info.plist
311         writeRuntimeInfoPlist(
312                 runtimeDir.resolve(&quot;Contents/Info.plist&quot;).toFile(), params);
<span class="line-added">313 </span>
<span class="line-added">314         // copy library</span>
<span class="line-added">315         Path runtimeMacOSDir = Files.createDirectories(</span>
<span class="line-added">316                 runtimeDir.resolve(&quot;Contents/MacOS&quot;));</span>
<span class="line-added">317 </span>
<span class="line-added">318         final Path jliName = Path.of(&quot;libjli.dylib&quot;);</span>
<span class="line-added">319         try (Stream&lt;Path&gt; walk = Files.walk(runtimeRoot.resolve(&quot;lib&quot;))) {</span>
<span class="line-added">320             final Path jli = walk</span>
<span class="line-added">321                     .filter(file -&gt; file.getFileName().equals(jliName))</span>
<span class="line-added">322                     .findFirst()</span>
<span class="line-added">323                     .get();</span>
<span class="line-added">324             Files.copy(jli, runtimeMacOSDir.resolve(jliName));</span>
<span class="line-added">325         }</span>
326     }
327 
328     private void sign(Map&lt;String, ? super Object&gt; params) throws IOException {
329         if (Optional.ofNullable(
330                 SIGN_BUNDLE.fetchFrom(params)).orElse(Boolean.TRUE)) {
331             try {
332                 addNewKeychain(params);
333             } catch (InterruptedException e) {
334                 Log.error(e.getMessage());
335             }
336             String signingIdentity =
337                     DEVELOPER_ID_APP_SIGNING_KEY.fetchFrom(params);
338             if (signingIdentity != null) {
339                 prepareEntitlements(params);
340                 signAppBundle(params, root, signingIdentity,
341                         BUNDLE_ID_SIGNING_PREFIX.fetchFrom(params),
342                         getConfig_Entitlements(params));
343             }
344             restoreKeychainList(params);
345         }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../jdk.compiler/share/classes/com/sun/tools/javac/processing/PrintingProcessor.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="MacDmgBundler.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>