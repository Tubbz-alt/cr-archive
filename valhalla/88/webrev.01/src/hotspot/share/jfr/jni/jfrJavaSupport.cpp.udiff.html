<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/jfr/jni/jfrJavaSupport.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../gc/shenandoah/shenandoahPacer.inline.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrJniMethod.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/jni/jfrJavaSupport.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -721,48 +721,44 @@</span>
    }
    remove_thread_from_exclusion_list(h_obj);
    return true;
  }
  
<span class="udiff-line-modified-removed">- jlong JfrJavaSupport::jfr_thread_id(jobject thread) {</span>
<span class="udiff-line-modified-added">+ static JavaThread* get_native(jobject thread) {</span>
    ThreadsListHandle tlh;
    JavaThread* native_thread = NULL;
    (void)tlh.cv_internal_thread_to_JavaThread(thread, &amp;native_thread, NULL);
<span class="udiff-line-added">+   return native_thread;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ jlong JfrJavaSupport::jfr_thread_id(jobject thread) {</span>
<span class="udiff-line-added">+   JavaThread* native_thread = get_native(thread);</span>
    return native_thread != NULL ? JFR_THREAD_ID(native_thread) : 0;
  }
  
  void JfrJavaSupport::exclude(jobject thread) {
<span class="udiff-line-modified-removed">-   HandleMark hm;</span>
<span class="udiff-line-removed">-   ThreadsListHandle tlh;</span>
<span class="udiff-line-removed">-   JavaThread* native_thread = NULL;</span>
<span class="udiff-line-removed">-   (void)tlh.cv_internal_thread_to_JavaThread(thread, &amp;native_thread, NULL);</span>
<span class="udiff-line-modified-added">+   JavaThread* native_thread = get_native(thread);</span>
    if (native_thread != NULL) {
      JfrThreadLocal::exclude(native_thread);
    } else {
      // not started yet, track the thread oop
      add_thread_to_exclusion_list(thread);
    }
  }
  
  void JfrJavaSupport::include(jobject thread) {
<span class="udiff-line-modified-removed">-   HandleMark hm;</span>
<span class="udiff-line-removed">-   ThreadsListHandle tlh;</span>
<span class="udiff-line-removed">-   JavaThread* native_thread = NULL;</span>
<span class="udiff-line-removed">-   (void)tlh.cv_internal_thread_to_JavaThread(thread, &amp;native_thread, NULL);</span>
<span class="udiff-line-modified-added">+   JavaThread* native_thread = get_native(thread);</span>
    if (native_thread != NULL) {
      JfrThreadLocal::include(native_thread);
    } else {
      // not started yet, untrack the thread oop
      remove_thread_from_exclusion_list(thread);
    }
  }
  
  bool JfrJavaSupport::is_excluded(jobject thread) {
<span class="udiff-line-modified-removed">-   HandleMark hm;</span>
<span class="udiff-line-removed">-   ThreadsListHandle tlh;</span>
<span class="udiff-line-removed">-   JavaThread* native_thread = NULL;</span>
<span class="udiff-line-removed">-   (void)tlh.cv_internal_thread_to_JavaThread(thread, &amp;native_thread, NULL);</span>
<span class="udiff-line-modified-added">+   JavaThread* native_thread = get_native(thread);</span>
    return native_thread != NULL ? native_thread-&gt;jfr_thread_local()-&gt;is_excluded() : is_thread_excluded(thread);
  }
  
  jobject JfrJavaSupport::get_handler(jobject clazz, TRAPS) {
    DEBUG_ONLY(JfrJavaSupport::check_java_thread_in_vm(THREAD));
</pre>
<center><a href="../../gc/shenandoah/shenandoahPacer.inline.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jfrJniMethod.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>