<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/lang/Module.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractStringBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="String.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/lang/Module.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  25 
  26 package java.lang;
  27 
  28 import java.io.IOException;
  29 import java.io.InputStream;
  30 import java.lang.annotation.Annotation;
  31 import java.lang.module.Configuration;
  32 import java.lang.module.ModuleReference;
  33 import java.lang.module.ModuleDescriptor;
  34 import java.lang.module.ModuleDescriptor.Exports;
  35 import java.lang.module.ModuleDescriptor.Opens;
  36 import java.lang.module.ModuleDescriptor.Version;
  37 import java.lang.module.ResolvedModule;
  38 import java.lang.reflect.AnnotatedElement;
  39 import java.net.URI;
  40 import java.net.URL;
  41 import java.security.AccessController;
  42 import java.security.PrivilegedAction;
  43 import java.util.HashMap;
  44 import java.util.HashSet;
<span class="line-removed">  45 import java.util.Iterator;</span>
  46 import java.util.List;
  47 import java.util.Map;
  48 import java.util.Objects;
  49 import java.util.Optional;
  50 import java.util.Set;
  51 import java.util.concurrent.ConcurrentHashMap;
  52 import java.util.function.Function;
  53 import java.util.stream.Collectors;
  54 import java.util.stream.Stream;
  55 
  56 import jdk.internal.loader.BuiltinClassLoader;
  57 import jdk.internal.loader.BootLoader;
  58 import jdk.internal.loader.ClassLoaders;
  59 import jdk.internal.module.IllegalAccessLogger;
  60 import jdk.internal.module.ModuleLoaderMap;
  61 import jdk.internal.module.ServicesCatalog;
  62 import jdk.internal.module.Resources;
  63 import jdk.internal.org.objectweb.asm.AnnotationVisitor;
  64 import jdk.internal.org.objectweb.asm.Attribute;
  65 import jdk.internal.org.objectweb.asm.ClassReader;
</pre>
<hr />
<pre>
1487             @Override
1488             public ModuleVisitor visitModule(String name, int flags, String version) {
1489                 // drop Module attribute
1490                 return null;
1491             }
1492         };
1493 
1494         ClassReader cr = new ClassReader(in);
1495         cr.accept(cv, 0);
1496         byte[] bytes = cw.toByteArray();
1497 
1498         ClassLoader cl = new ClassLoader(loader) {
1499             @Override
1500             protected Class&lt;?&gt; findClass(String cn)throws ClassNotFoundException {
1501                 if (cn.equals(MODULE_INFO)) {
1502                     return super.defineClass(cn, bytes, 0, bytes.length);
1503                 } else {
1504                     throw new ClassNotFoundException(cn);
1505                 }
1506             }


















1507         };
1508 
1509         try {
1510             return cl.loadClass(MODULE_INFO);
1511         } catch (ClassNotFoundException e) {
1512             throw new InternalError(e);
1513         }
1514     }
1515 
1516 
1517     // -- misc --
1518 
1519 
1520     /**
1521      * Returns an input stream for reading a resource in this module.
1522      * The {@code name} parameter is a {@code &#39;/&#39;}-separated path name that
1523      * identifies the resource. As with {@link Class#getResourceAsStream
1524      * Class.getResourceAsStream}, this method delegates to the module&#39;s class
1525      * loader {@link ClassLoader#findResource(String,String)
1526      * findResource(String,String)} method, invoking it with the module name
</pre>
</td>
<td>
<hr />
<pre>
  25 
  26 package java.lang;
  27 
  28 import java.io.IOException;
  29 import java.io.InputStream;
  30 import java.lang.annotation.Annotation;
  31 import java.lang.module.Configuration;
  32 import java.lang.module.ModuleReference;
  33 import java.lang.module.ModuleDescriptor;
  34 import java.lang.module.ModuleDescriptor.Exports;
  35 import java.lang.module.ModuleDescriptor.Opens;
  36 import java.lang.module.ModuleDescriptor.Version;
  37 import java.lang.module.ResolvedModule;
  38 import java.lang.reflect.AnnotatedElement;
  39 import java.net.URI;
  40 import java.net.URL;
  41 import java.security.AccessController;
  42 import java.security.PrivilegedAction;
  43 import java.util.HashMap;
  44 import java.util.HashSet;

  45 import java.util.List;
  46 import java.util.Map;
  47 import java.util.Objects;
  48 import java.util.Optional;
  49 import java.util.Set;
  50 import java.util.concurrent.ConcurrentHashMap;
  51 import java.util.function.Function;
  52 import java.util.stream.Collectors;
  53 import java.util.stream.Stream;
  54 
  55 import jdk.internal.loader.BuiltinClassLoader;
  56 import jdk.internal.loader.BootLoader;
  57 import jdk.internal.loader.ClassLoaders;
  58 import jdk.internal.module.IllegalAccessLogger;
  59 import jdk.internal.module.ModuleLoaderMap;
  60 import jdk.internal.module.ServicesCatalog;
  61 import jdk.internal.module.Resources;
  62 import jdk.internal.org.objectweb.asm.AnnotationVisitor;
  63 import jdk.internal.org.objectweb.asm.Attribute;
  64 import jdk.internal.org.objectweb.asm.ClassReader;
</pre>
<hr />
<pre>
1486             @Override
1487             public ModuleVisitor visitModule(String name, int flags, String version) {
1488                 // drop Module attribute
1489                 return null;
1490             }
1491         };
1492 
1493         ClassReader cr = new ClassReader(in);
1494         cr.accept(cv, 0);
1495         byte[] bytes = cw.toByteArray();
1496 
1497         ClassLoader cl = new ClassLoader(loader) {
1498             @Override
1499             protected Class&lt;?&gt; findClass(String cn)throws ClassNotFoundException {
1500                 if (cn.equals(MODULE_INFO)) {
1501                     return super.defineClass(cn, bytes, 0, bytes.length);
1502                 } else {
1503                     throw new ClassNotFoundException(cn);
1504                 }
1505             }
<span class="line-added">1506             @Override</span>
<span class="line-added">1507             protected Class&lt;?&gt; loadClass(String cn, boolean resolve)</span>
<span class="line-added">1508                 throws ClassNotFoundException</span>
<span class="line-added">1509             {</span>
<span class="line-added">1510                 synchronized (getClassLoadingLock(cn)) {</span>
<span class="line-added">1511                     Class&lt;?&gt; c = findLoadedClass(cn);</span>
<span class="line-added">1512                     if (c == null) {</span>
<span class="line-added">1513                         if (cn.equals(MODULE_INFO)) {</span>
<span class="line-added">1514                             c = findClass(cn);</span>
<span class="line-added">1515                         } else {</span>
<span class="line-added">1516                             c = super.loadClass(cn, resolve);</span>
<span class="line-added">1517                         }</span>
<span class="line-added">1518                     }</span>
<span class="line-added">1519                     if (resolve)</span>
<span class="line-added">1520                         resolveClass(c);</span>
<span class="line-added">1521                     return c;</span>
<span class="line-added">1522                 }</span>
<span class="line-added">1523             }</span>
1524         };
1525 
1526         try {
1527             return cl.loadClass(MODULE_INFO);
1528         } catch (ClassNotFoundException e) {
1529             throw new InternalError(e);
1530         }
1531     }
1532 
1533 
1534     // -- misc --
1535 
1536 
1537     /**
1538      * Returns an input stream for reading a resource in this module.
1539      * The {@code name} parameter is a {@code &#39;/&#39;}-separated path name that
1540      * identifies the resource. As with {@link Class#getResourceAsStream
1541      * Class.getResourceAsStream}, this method delegates to the module&#39;s class
1542      * loader {@link ClassLoader#findResource(String,String)
1543      * findResource(String,String)} method, invoking it with the module name
</pre>
</td>
</tr>
</table>
<center><a href="AbstractStringBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="String.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>