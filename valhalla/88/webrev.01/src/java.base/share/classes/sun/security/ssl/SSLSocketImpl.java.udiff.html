<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/sun/security/ssl/SSLSocketImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../jdk/internal/org/objectweb/asm/Opcodes.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../java.compiler/share/classes/javax/lang/model/SourceVersion.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/SSLSocketImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -352,11 +352,11 @@</span>
  
      @Override
      public SSLSession getSession() {
          try {
              // start handshaking, if failed, the connection will be closed.
<span class="udiff-line-modified-removed">-             ensureNegotiated();</span>
<span class="udiff-line-modified-added">+             ensureNegotiated(false);</span>
          } catch (IOException ioe) {
              if (SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;handshake&quot;)) {
                  SSLLogger.severe(&quot;handshake failed&quot;, ioe);
              }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -407,10 +407,14 @@</span>
          }
      }
  
      @Override
      public void startHandshake() throws IOException {
<span class="udiff-line-added">+         startHandshake(true);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private void startHandshake(boolean resumable) throws IOException {</span>
          if (!isConnected) {
              throw new SocketException(&quot;Socket is not connected&quot;);
          }
  
          if (conContext.isBroken || conContext.isInboundClosed() ||
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -435,11 +439,16 @@</span>
                  // Handle handshake messages only, need no application data.
                  if (!conContext.isNegotiated) {
                      readHandshakeRecord();
                  }
              } catch (InterruptedIOException iioe) {
<span class="udiff-line-modified-removed">-                 handleException(iioe);</span>
<span class="udiff-line-modified-added">+                 if(resumable){</span>
<span class="udiff-line-added">+                     handleException(iioe);</span>
<span class="udiff-line-added">+                 } else{</span>
<span class="udiff-line-added">+                     throw conContext.fatal(Alert.HANDSHAKE_FAILURE,</span>
<span class="udiff-line-added">+                             &quot;Couldn&#39;t kickstart handshaking&quot;, iioe);</span>
<span class="udiff-line-added">+                 }</span>
              } catch (IOException ioe) {
                  throw conContext.fatal(Alert.HANDSHAKE_FAILURE,
                      &quot;Couldn&#39;t kickstart handshaking&quot;, ioe);
              } catch (Exception oe) {    // including RuntimeException
                  handleException(oe);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -865,11 +874,11 @@</span>
          } finally {
              socketLock.unlock();
          }
      }
  
<span class="udiff-line-modified-removed">-     private void ensureNegotiated() throws IOException {</span>
<span class="udiff-line-modified-added">+     private void ensureNegotiated(boolean resumable) throws IOException {</span>
          if (conContext.isNegotiated || conContext.isBroken ||
                  conContext.isInboundClosed() || conContext.isOutboundClosed()) {
              return;
          }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -880,11 +889,11 @@</span>
                      conContext.isInboundClosed() ||
                      conContext.isOutboundClosed()) {
                  return;
              }
  
<span class="udiff-line-modified-removed">-             startHandshake();</span>
<span class="udiff-line-modified-added">+             startHandshake(resumable);</span>
          } finally {
              handshakeLock.unlock();
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -971,11 +980,11 @@</span>
  
              // start handshaking if the connection has not been negotiated.
              if (!conContext.isNegotiated &amp;&amp; !conContext.isBroken &amp;&amp;
                      !conContext.isInboundClosed() &amp;&amp;
                      !conContext.isOutboundClosed()) {
<span class="udiff-line-modified-removed">-                 ensureNegotiated();</span>
<span class="udiff-line-modified-added">+                 ensureNegotiated(true);</span>
              }
  
              // Check if the Socket is invalid (error or closed).
              if (!conContext.isNegotiated ||
                      conContext.isBroken || conContext.isInboundClosed()) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1250,11 +1259,11 @@</span>
  
              // Start handshaking if the connection has not been negotiated.
              if (!conContext.isNegotiated &amp;&amp; !conContext.isBroken &amp;&amp;
                      !conContext.isInboundClosed() &amp;&amp;
                      !conContext.isOutboundClosed()) {
<span class="udiff-line-modified-removed">-                 ensureNegotiated();</span>
<span class="udiff-line-modified-added">+                 ensureNegotiated(true);</span>
              }
  
              // Check if the Socket is invalid (error or closed).
              if (!conContext.isNegotiated ||
                      conContext.isBroken || conContext.isOutboundClosed()) {
</pre>
<center><a href="../../../jdk/internal/org/objectweb/asm/Opcodes.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../java.compiler/share/classes/javax/lang/model/SourceVersion.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>