<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/memory/dynamicArchive.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../compiler/compileBroker.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="metaspaceShared.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/memory/dynamicArchive.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1128   }
1129 }
1130 
1131 uintx DynamicArchive::object_delta_uintx(void* buff_obj) {
1132   assert(DynamicDumpSharedSpaces, &quot;must be&quot;);
1133   address target_obj = _builder-&gt;to_target_no_check(address(buff_obj));
1134   assert(uintx(target_obj) &gt;= SharedBaseAddress, &quot;must be&quot;);
1135   return uintx(target_obj) - SharedBaseAddress;
1136 }
1137 
1138 bool DynamicArchive::is_in_target_space(void *obj) {
1139   assert(DynamicDumpSharedSpaces, &quot;must be&quot;);
1140   return _builder-&gt;is_in_target_space(obj);
1141 }
1142 
1143 
1144 DynamicArchiveBuilder* DynamicArchive::_builder = NULL;
1145 
1146 
1147 bool DynamicArchive::validate(FileMapInfo* dynamic_info) {

1148   // Check if the recorded base archive matches with the current one
1149   FileMapInfo* base_info = FileMapInfo::current_info();
1150   DynamicArchiveHeader* dynamic_header = dynamic_info-&gt;dynamic_header();
1151 
1152   // Check the header crc
1153   if (dynamic_header-&gt;base_header_crc() != base_info-&gt;crc()) {
<span class="line-modified">1154     FileMapInfo::fail_continue(&quot;Archive header checksum verification failed.&quot;);</span>
1155     return false;
1156   }
1157 
1158   // Check each space&#39;s crc
1159   for (int i = 0; i &lt; MetaspaceShared::n_regions; i++) {
1160     if (dynamic_header-&gt;base_region_crc(i) != base_info-&gt;space_crc(i)) {
<span class="line-modified">1161       FileMapInfo::fail_continue(&quot;Archive region #%d checksum verification failed.&quot;, i);</span>
1162       return false;
1163     }
1164   }
1165 
<span class="line-removed">1166   // Validate the dynamic archived shared path table, and set the global</span>
<span class="line-removed">1167   // _shared_path_table to that.</span>
<span class="line-removed">1168   if (!dynamic_info-&gt;validate_shared_path_table()) {</span>
<span class="line-removed">1169     return false;</span>
<span class="line-removed">1170   }</span>
1171   return true;
1172 }
</pre>
</td>
<td>
<hr />
<pre>
1128   }
1129 }
1130 
1131 uintx DynamicArchive::object_delta_uintx(void* buff_obj) {
1132   assert(DynamicDumpSharedSpaces, &quot;must be&quot;);
1133   address target_obj = _builder-&gt;to_target_no_check(address(buff_obj));
1134   assert(uintx(target_obj) &gt;= SharedBaseAddress, &quot;must be&quot;);
1135   return uintx(target_obj) - SharedBaseAddress;
1136 }
1137 
1138 bool DynamicArchive::is_in_target_space(void *obj) {
1139   assert(DynamicDumpSharedSpaces, &quot;must be&quot;);
1140   return _builder-&gt;is_in_target_space(obj);
1141 }
1142 
1143 
1144 DynamicArchiveBuilder* DynamicArchive::_builder = NULL;
1145 
1146 
1147 bool DynamicArchive::validate(FileMapInfo* dynamic_info) {
<span class="line-added">1148   assert(!dynamic_info-&gt;is_static(), &quot;must be&quot;);</span>
1149   // Check if the recorded base archive matches with the current one
1150   FileMapInfo* base_info = FileMapInfo::current_info();
1151   DynamicArchiveHeader* dynamic_header = dynamic_info-&gt;dynamic_header();
1152 
1153   // Check the header crc
1154   if (dynamic_header-&gt;base_header_crc() != base_info-&gt;crc()) {
<span class="line-modified">1155     FileMapInfo::fail_continue(&quot;Dynamic archive cannot be used: static archive header checksum verification failed.&quot;);</span>
1156     return false;
1157   }
1158 
1159   // Check each space&#39;s crc
1160   for (int i = 0; i &lt; MetaspaceShared::n_regions; i++) {
1161     if (dynamic_header-&gt;base_region_crc(i) != base_info-&gt;space_crc(i)) {
<span class="line-modified">1162       FileMapInfo::fail_continue(&quot;Dynamic archive cannot be used: static archive region #%d checksum verification failed.&quot;, i);</span>
1163       return false;
1164     }
1165   }
1166 





1167   return true;
1168 }
</pre>
</td>
</tr>
</table>
<center><a href="../compiler/compileBroker.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="metaspaceShared.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>