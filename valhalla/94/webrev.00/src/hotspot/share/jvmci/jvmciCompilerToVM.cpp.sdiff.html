<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jvmci/jvmciCompilerToVM.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../classfile/classFileParser.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../prims/jni.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jvmci/jvmciCompilerToVM.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
2520   JVMCIObject code = JVMCIENV-&gt;wrap(code_handle);
2521   nmethodLocker locker;
2522   CodeBlob* cb = JVMCIENV-&gt;get_code_blob(code, locker);
2523   if (cb == NULL) {
2524     return NULL;
2525   }
2526   int code_size = cb-&gt;code_size();
2527   JVMCIPrimitiveArray result = JVMCIENV-&gt;new_byteArray(code_size, JVMCI_CHECK_NULL);
2528   JVMCIENV-&gt;copy_bytes_from((jbyte*) cb-&gt;code_begin(), result, 0, code_size);
2529   return JVMCIENV-&gt;get_jbyteArray(result);
2530 }
2531 
2532 C2V_VMENTRY_NULL(jobject, asReflectionExecutable, (JNIEnv* env, jobject, jobject jvmci_method))
2533   requireInHotSpot(&quot;asReflectionExecutable&quot;, JVMCI_CHECK_NULL);
2534   methodHandle m(THREAD, JVMCIENV-&gt;asMethod(jvmci_method));
2535   oop executable;
2536   if (m-&gt;is_class_initializer()) {
2537       JVMCI_THROW_MSG_NULL(IllegalArgumentException,
2538           &quot;Cannot create java.lang.reflect.Method for class initializer&quot;);
2539   }
<span class="line-modified">2540   else if (m-&gt;is_object_constructor()) {</span>
2541     executable = Reflection::new_constructor(m, CHECK_NULL);
2542   } else {
2543     executable = Reflection::new_method(m, false, CHECK_NULL);
2544   }
2545   return JNIHandles::make_local(THREAD, executable);
2546 }
2547 
2548 C2V_VMENTRY_NULL(jobject, asReflectionField, (JNIEnv* env, jobject, jobject jvmci_type, jint index))
2549   requireInHotSpot(&quot;asReflectionField&quot;, JVMCI_CHECK_NULL);
2550   Klass* klass = JVMCIENV-&gt;asKlass(jvmci_type);
2551   if (!klass-&gt;is_instance_klass()) {
2552     JVMCI_THROW_MSG_NULL(IllegalArgumentException,
2553         err_msg(&quot;Expected non-primitive type, got %s&quot;, klass-&gt;external_name()));
2554   }
2555   InstanceKlass* iklass = InstanceKlass::cast(klass);
2556   Array&lt;u2&gt;* fields = iklass-&gt;fields();
2557   if (index &lt; 0 ||index &gt; fields-&gt;length()) {
2558     JVMCI_THROW_MSG_NULL(IllegalArgumentException,
2559         err_msg(&quot;Field index %d out of bounds for %s&quot;, index, klass-&gt;external_name()));
2560   }
</pre>
</td>
<td>
<hr />
<pre>
2520   JVMCIObject code = JVMCIENV-&gt;wrap(code_handle);
2521   nmethodLocker locker;
2522   CodeBlob* cb = JVMCIENV-&gt;get_code_blob(code, locker);
2523   if (cb == NULL) {
2524     return NULL;
2525   }
2526   int code_size = cb-&gt;code_size();
2527   JVMCIPrimitiveArray result = JVMCIENV-&gt;new_byteArray(code_size, JVMCI_CHECK_NULL);
2528   JVMCIENV-&gt;copy_bytes_from((jbyte*) cb-&gt;code_begin(), result, 0, code_size);
2529   return JVMCIENV-&gt;get_jbyteArray(result);
2530 }
2531 
2532 C2V_VMENTRY_NULL(jobject, asReflectionExecutable, (JNIEnv* env, jobject, jobject jvmci_method))
2533   requireInHotSpot(&quot;asReflectionExecutable&quot;, JVMCI_CHECK_NULL);
2534   methodHandle m(THREAD, JVMCIENV-&gt;asMethod(jvmci_method));
2535   oop executable;
2536   if (m-&gt;is_class_initializer()) {
2537       JVMCI_THROW_MSG_NULL(IllegalArgumentException,
2538           &quot;Cannot create java.lang.reflect.Method for class initializer&quot;);
2539   }
<span class="line-modified">2540   else if (m-&gt;is_object_constructor() || m-&gt;is_static_init_factory()) {</span>
2541     executable = Reflection::new_constructor(m, CHECK_NULL);
2542   } else {
2543     executable = Reflection::new_method(m, false, CHECK_NULL);
2544   }
2545   return JNIHandles::make_local(THREAD, executable);
2546 }
2547 
2548 C2V_VMENTRY_NULL(jobject, asReflectionField, (JNIEnv* env, jobject, jobject jvmci_type, jint index))
2549   requireInHotSpot(&quot;asReflectionField&quot;, JVMCI_CHECK_NULL);
2550   Klass* klass = JVMCIENV-&gt;asKlass(jvmci_type);
2551   if (!klass-&gt;is_instance_klass()) {
2552     JVMCI_THROW_MSG_NULL(IllegalArgumentException,
2553         err_msg(&quot;Expected non-primitive type, got %s&quot;, klass-&gt;external_name()));
2554   }
2555   InstanceKlass* iklass = InstanceKlass::cast(klass);
2556   Array&lt;u2&gt;* fields = iklass-&gt;fields();
2557   if (index &lt; 0 ||index &gt; fields-&gt;length()) {
2558     JVMCI_THROW_MSG_NULL(IllegalArgumentException,
2559         err_msg(&quot;Field index %d out of bounds for %s&quot;, index, klass-&gt;external_name()));
2560   }
</pre>
</td>
</tr>
</table>
<center><a href="../classfile/classFileParser.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../prims/jni.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>