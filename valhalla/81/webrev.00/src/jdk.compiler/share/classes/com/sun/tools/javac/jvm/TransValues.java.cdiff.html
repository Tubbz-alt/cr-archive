<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.compiler/share/classes/com/sun/tools/javac/jvm/TransValues.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/jvm/TransValues.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 61,10 ***</span>
<span class="line-new-header">--- 61,11 ---</span>
  import java.util.HashMap;
  import java.util.Map;
  
  import static com.sun.tools.javac.code.Flags.STATIC;
  import static com.sun.tools.javac.code.Kinds.Kind.MTH;
<span class="line-added">+ import static com.sun.tools.javac.code.Kinds.Kind.TYP;</span>
  import static com.sun.tools.javac.code.Kinds.Kind.VAR;
  import static com.sun.tools.javac.tree.JCTree.Tag.APPLY;
  import static com.sun.tools.javac.tree.JCTree.Tag.EXEC;
  import static com.sun.tools.javac.tree.JCTree.Tag.IDENT;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 327,23 ***</span>
                      result = make.Select(facHandle, symbol);
                      return;
                  }
              }
          }
<span class="line-modified">!         // Rewrite any accesses of the form V.ref.member to ((V) V.ref).member</span>
          fieldAccess.selected = translate(fieldAccess.selected);
          if (fieldAccess.name != names._class &amp;&amp; fieldAccess.name != names._default) {  // TODO: this and super ??
              Symbol sym = TreeInfo.symbol(fieldAccess);
              TypeSymbol selectedType = fieldAccess.selected.type.tsym;
              if (selectedType.isReferenceProjection()) {
                  switch (sym.kind) {
                      case MTH:
                      case VAR:
<span class="line-modified">!                         fieldAccess.selected =</span>
<span class="line-modified">!                                 make.TypeCast(types.erasure(selectedType.valueProjection().type), fieldAccess.selected);</span>
<span class="line-modified">!                         if (sym.owner.isReferenceProjection()) // is an empty class file.</span>
<span class="line-modified">!                             TreeInfo.setSymbol(fieldAccess, sym.valueProjection());</span>
                          break;
                      case TYP:
                          fieldAccess.selected = make.Type(types.erasure(selectedType.valueProjection().type));
                          break;
                  }
<span class="line-new-header">--- 328,31 ---</span>
                      result = make.Select(facHandle, symbol);
                      return;
                  }
              }
          }
<span class="line-modified">!         /* Rewrite any accesses of the form V.ref.member to ((V) V.ref).member OR</span>
<span class="line-added">+            if a static member is being selected via a V.ref as a TYP, rewrite</span>
<span class="line-added">+            V.ref.member to V.member</span>
<span class="line-added">+         */</span>
          fieldAccess.selected = translate(fieldAccess.selected);
          if (fieldAccess.name != names._class &amp;&amp; fieldAccess.name != names._default) {  // TODO: this and super ??
              Symbol sym = TreeInfo.symbol(fieldAccess);
<span class="line-added">+             Symbol sitesym = TreeInfo.symbol(fieldAccess.selected);</span>
              TypeSymbol selectedType = fieldAccess.selected.type.tsym;
              if (selectedType.isReferenceProjection()) {
                  switch (sym.kind) {
                      case MTH:
                      case VAR:
<span class="line-modified">!                         if (sym.isStatic() &amp;&amp; sitesym != null &amp;&amp; sitesym.kind == TYP) {</span>
<span class="line-modified">!                             fieldAccess.selected = make.Type(types.erasure(selectedType.valueProjection().type));</span>
<span class="line-modified">!                         } else {</span>
<span class="line-modified">!                             fieldAccess.selected =</span>
<span class="line-added">+                                     make.TypeCast(types.erasure(selectedType.valueProjection().type), fieldAccess.selected);</span>
<span class="line-added">+                             if (sym.owner.isReferenceProjection()) // is an empty class file.</span>
<span class="line-added">+                                 TreeInfo.setSymbol(fieldAccess, sym.valueProjection());</span>
<span class="line-added">+                         }</span>
                          break;
                      case TYP:
                          fieldAccess.selected = make.Type(types.erasure(selectedType.valueProjection().type));
                          break;
                  }
</pre>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>