<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/memory/metaspaceShared.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="dynamicArchive.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="universe.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/memory/metaspaceShared.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
2541 
2542   // Paranoid checks:
2543   assert(base_address == NULL || (address)total_rs.base() == base_address,
2544          &quot;Sanity (&quot; PTR_FORMAT &quot; vs &quot; PTR_FORMAT &quot;)&quot;, p2i(base_address), p2i(total_rs.base()));
2545   assert(is_aligned(total_rs.base(), archive_space_alignment), &quot;Sanity&quot;);
2546   assert(total_rs.size() == total_range_size, &quot;Sanity&quot;);
2547   assert(CompressedKlassPointers::is_valid_base((address)total_rs.base()), &quot;Sanity&quot;);
2548 
2549   // Now split up the space into ccs and cds archive. For simplicity, just leave
2550   //  the gap reserved at the end of the archive space.
2551   archive_space_rs = total_rs.first_part(ccs_begin_offset,
2552                                          (size_t)os::vm_allocation_granularity(),
2553                                          /*split=*/true);
2554   class_space_rs = total_rs.last_part(ccs_begin_offset);
2555 
2556   assert(is_aligned(archive_space_rs.base(), archive_space_alignment), &quot;Sanity&quot;);
2557   assert(is_aligned(archive_space_rs.size(), archive_space_alignment), &quot;Sanity&quot;);
2558   assert(is_aligned(class_space_rs.base(), class_space_alignment), &quot;Sanity&quot;);
2559   assert(is_aligned(class_space_rs.size(), class_space_alignment), &quot;Sanity&quot;);
2560 




2561   return archive_space_rs.base();
2562 
2563 #else
2564   ShouldNotReachHere();
2565   return NULL;
2566 #endif
2567 
2568 }
2569 
2570 void MetaspaceShared::release_reserved_spaces(ReservedSpace&amp; archive_space_rs,
2571                                               ReservedSpace&amp; class_space_rs) {
2572   if (archive_space_rs.is_reserved()) {
2573     log_debug(cds)(&quot;Released shared space (archive) &quot; INTPTR_FORMAT, p2i(archive_space_rs.base()));
2574     archive_space_rs.release();
2575   }
2576   if (class_space_rs.is_reserved()) {
2577     log_debug(cds)(&quot;Released shared space (classes) &quot; INTPTR_FORMAT, p2i(class_space_rs.base()));
2578     class_space_rs.release();
2579   }
2580 }
</pre>
</td>
<td>
<hr />
<pre>
2541 
2542   // Paranoid checks:
2543   assert(base_address == NULL || (address)total_rs.base() == base_address,
2544          &quot;Sanity (&quot; PTR_FORMAT &quot; vs &quot; PTR_FORMAT &quot;)&quot;, p2i(base_address), p2i(total_rs.base()));
2545   assert(is_aligned(total_rs.base(), archive_space_alignment), &quot;Sanity&quot;);
2546   assert(total_rs.size() == total_range_size, &quot;Sanity&quot;);
2547   assert(CompressedKlassPointers::is_valid_base((address)total_rs.base()), &quot;Sanity&quot;);
2548 
2549   // Now split up the space into ccs and cds archive. For simplicity, just leave
2550   //  the gap reserved at the end of the archive space.
2551   archive_space_rs = total_rs.first_part(ccs_begin_offset,
2552                                          (size_t)os::vm_allocation_granularity(),
2553                                          /*split=*/true);
2554   class_space_rs = total_rs.last_part(ccs_begin_offset);
2555 
2556   assert(is_aligned(archive_space_rs.base(), archive_space_alignment), &quot;Sanity&quot;);
2557   assert(is_aligned(archive_space_rs.size(), archive_space_alignment), &quot;Sanity&quot;);
2558   assert(is_aligned(class_space_rs.base(), class_space_alignment), &quot;Sanity&quot;);
2559   assert(is_aligned(class_space_rs.size(), class_space_alignment), &quot;Sanity&quot;);
2560 
<span class="line-added">2561   // NMT: fix up the space tags</span>
<span class="line-added">2562   MemTracker::record_virtual_memory_type(archive_space_rs.base(), mtClassShared);</span>
<span class="line-added">2563   MemTracker::record_virtual_memory_type(class_space_rs.base(), mtClass);</span>
<span class="line-added">2564 </span>
2565   return archive_space_rs.base();
2566 
2567 #else
2568   ShouldNotReachHere();
2569   return NULL;
2570 #endif
2571 
2572 }
2573 
2574 void MetaspaceShared::release_reserved_spaces(ReservedSpace&amp; archive_space_rs,
2575                                               ReservedSpace&amp; class_space_rs) {
2576   if (archive_space_rs.is_reserved()) {
2577     log_debug(cds)(&quot;Released shared space (archive) &quot; INTPTR_FORMAT, p2i(archive_space_rs.base()));
2578     archive_space_rs.release();
2579   }
2580   if (class_space_rs.is_reserved()) {
2581     log_debug(cds)(&quot;Released shared space (classes) &quot; INTPTR_FORMAT, p2i(class_space_rs.base()));
2582     class_space_rs.release();
2583   }
2584 }
</pre>
</td>
</tr>
</table>
<center><a href="dynamicArchive.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="universe.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>