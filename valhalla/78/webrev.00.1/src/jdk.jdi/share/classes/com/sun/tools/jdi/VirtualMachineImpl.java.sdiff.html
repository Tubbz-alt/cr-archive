<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jdi/share/classes/com/sun/tools/jdi/VirtualMachineImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/Utils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../jdk.unsupported/share/classes/sun/misc/Unsafe.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdi/share/classes/com/sun/tools/jdi/VirtualMachineImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 298          * if (shutdown) {
 299          *    throw new VMDisconnectedException();
 300          * }
 301          */
 302     }
 303 
 304     public boolean equals(Object obj) {
 305         return this == obj;
 306     }
 307 
 308     public int hashCode() {
 309         return System.identityHashCode(this);
 310     }
 311 
 312     public List&lt;ModuleReference&gt; allModules() {
 313         validateVM();
 314         List&lt;ModuleReference&gt; modules = retrieveAllModules();
 315         return Collections.unmodifiableList(modules);
 316     }
 317 








 318     public List&lt;ReferenceType&gt; classesByName(String className) {
 319         validateVM();
 320         return classesBySignature(JNITypeParser.typeNameToSignature(className));
 321     }
 322 
 323     List&lt;ReferenceType&gt; classesBySignature(String signature) {
 324         validateVM();
 325         List&lt;ReferenceType&gt; list;
 326         if (retrievedAllTypes) {
 327             list = findReferenceTypes(signature);
 328         } else {
 329             list = retrieveClassesBySignature(signature);
 330         }


















 331         return Collections.unmodifiableList(list);
 332     }
 333 
 334     public List&lt;ReferenceType&gt; allClasses() {
 335         validateVM();
 336 
 337         if (!retrievedAllTypes) {
 338             retrieveAllClasses();
 339         }
 340         ArrayList&lt;ReferenceType&gt; a;
 341         synchronized (this) {
 342             a = new ArrayList&lt;&gt;(typesBySignature);
 343         }
 344         return Collections.unmodifiableList(a);
 345     }
 346 
 347     /**
 348      * Performs an action for each loaded type.
 349      */
 350     public void forEachClass(Consumer&lt;ReferenceType&gt; action) {
</pre>
<hr />
<pre>
1383             return null;
1384         }
1385         ObjectReferenceImpl object = null;
1386         Long key = id;
1387 
1388         /*
1389          * Attempt to retrieve an existing object reference
1390          */
1391         SoftObjectReference ref = objectsByID.get(key);
1392         if (ref != null) {
1393             object = ref.object();
1394         }
1395 
1396         /*
1397          * If the object wasn&#39;t in the table, or it&#39;s soft reference was
1398          * cleared, create a new instance.
1399          */
1400         if (object == null) {
1401             switch (tag) {
1402                 case JDWP.Tag.OBJECT:

1403                     object = new ObjectReferenceImpl(vm, id);
1404                     break;
1405                 case JDWP.Tag.STRING:
1406                     object = new StringReferenceImpl(vm, id);
1407                     break;
1408                 case JDWP.Tag.ARRAY:
1409                     object = new ArrayReferenceImpl(vm, id);
1410                     break;
1411                 case JDWP.Tag.THREAD:
1412                     ThreadReferenceImpl thread =
1413                         new ThreadReferenceImpl(vm, id);
1414                     thread.addListener(this);
1415                     object = thread;
1416                     break;
1417                 case JDWP.Tag.THREAD_GROUP:
1418                     object = new ThreadGroupReferenceImpl(vm, id);
1419                     break;
1420                 case JDWP.Tag.CLASS_LOADER:
1421                     object = new ClassLoaderReferenceImpl(vm, id);
1422                     break;
</pre>
</td>
<td>
<hr />
<pre>
 298          * if (shutdown) {
 299          *    throw new VMDisconnectedException();
 300          * }
 301          */
 302     }
 303 
 304     public boolean equals(Object obj) {
 305         return this == obj;
 306     }
 307 
 308     public int hashCode() {
 309         return System.identityHashCode(this);
 310     }
 311 
 312     public List&lt;ModuleReference&gt; allModules() {
 313         validateVM();
 314         List&lt;ModuleReference&gt; modules = retrieveAllModules();
 315         return Collections.unmodifiableList(modules);
 316     }
 317 
<span class="line-added"> 318     private static boolean isReferenceArray(String signature) {</span>
<span class="line-added"> 319         int i = signature.lastIndexOf(&#39;[&#39;);</span>
<span class="line-added"> 320         if (i &gt; -1 &amp;&amp; signature.charAt(i+1) == &#39;L&#39;) {</span>
<span class="line-added"> 321             return true;</span>
<span class="line-added"> 322         }</span>
<span class="line-added"> 323         return false;</span>
<span class="line-added"> 324     }</span>
<span class="line-added"> 325 </span>
 326     public List&lt;ReferenceType&gt; classesByName(String className) {
 327         validateVM();
 328         return classesBySignature(JNITypeParser.typeNameToSignature(className));
 329     }
 330 
 331     List&lt;ReferenceType&gt; classesBySignature(String signature) {
 332         validateVM();
 333         List&lt;ReferenceType&gt; list;
 334         if (retrievedAllTypes) {
 335             list = findReferenceTypes(signature);
 336         } else {
 337             list = retrieveClassesBySignature(signature);
 338         }
<span class="line-added"> 339         // HACK: add second request to cover the case where className</span>
<span class="line-added"> 340         // is the name of an inline type. This is done only if the</span>
<span class="line-added"> 341         // first signature is either a reference type or an array</span>
<span class="line-added"> 342         // of a reference type.</span>
<span class="line-added"> 343         if (signature.length() &gt; 1 &amp;&amp;</span>
<span class="line-added"> 344                 (signature.charAt(0) == &#39;L&#39; || isReferenceArray((signature)))) {</span>
<span class="line-added"> 345             List&lt;ReferenceType&gt; listInlineTypes;</span>
<span class="line-added"> 346             signature = signature.replaceFirst(&quot;L&quot;, &quot;Q&quot;);</span>
<span class="line-added"> 347             if (retrievedAllTypes) {</span>
<span class="line-added"> 348                 listInlineTypes = findReferenceTypes(signature);</span>
<span class="line-added"> 349             } else {</span>
<span class="line-added"> 350                 listInlineTypes = retrieveClassesBySignature(signature);</span>
<span class="line-added"> 351             }</span>
<span class="line-added"> 352             if (!listInlineTypes.isEmpty()) {</span>
<span class="line-added"> 353                 list.addAll(listInlineTypes);</span>
<span class="line-added"> 354             }</span>
<span class="line-added"> 355         }</span>
<span class="line-added"> 356 </span>
 357         return Collections.unmodifiableList(list);
 358     }
 359 
 360     public List&lt;ReferenceType&gt; allClasses() {
 361         validateVM();
 362 
 363         if (!retrievedAllTypes) {
 364             retrieveAllClasses();
 365         }
 366         ArrayList&lt;ReferenceType&gt; a;
 367         synchronized (this) {
 368             a = new ArrayList&lt;&gt;(typesBySignature);
 369         }
 370         return Collections.unmodifiableList(a);
 371     }
 372 
 373     /**
 374      * Performs an action for each loaded type.
 375      */
 376     public void forEachClass(Consumer&lt;ReferenceType&gt; action) {
</pre>
<hr />
<pre>
1409             return null;
1410         }
1411         ObjectReferenceImpl object = null;
1412         Long key = id;
1413 
1414         /*
1415          * Attempt to retrieve an existing object reference
1416          */
1417         SoftObjectReference ref = objectsByID.get(key);
1418         if (ref != null) {
1419             object = ref.object();
1420         }
1421 
1422         /*
1423          * If the object wasn&#39;t in the table, or it&#39;s soft reference was
1424          * cleared, create a new instance.
1425          */
1426         if (object == null) {
1427             switch (tag) {
1428                 case JDWP.Tag.OBJECT:
<span class="line-added">1429                 case JDWP.Tag.INLINE_OBJECT:</span>
1430                     object = new ObjectReferenceImpl(vm, id);
1431                     break;
1432                 case JDWP.Tag.STRING:
1433                     object = new StringReferenceImpl(vm, id);
1434                     break;
1435                 case JDWP.Tag.ARRAY:
1436                     object = new ArrayReferenceImpl(vm, id);
1437                     break;
1438                 case JDWP.Tag.THREAD:
1439                     ThreadReferenceImpl thread =
1440                         new ThreadReferenceImpl(vm, id);
1441                     thread.addListener(this);
1442                     object = thread;
1443                     break;
1444                 case JDWP.Tag.THREAD_GROUP:
1445                     object = new ThreadGroupReferenceImpl(vm, id);
1446                     break;
1447                 case JDWP.Tag.CLASS_LOADER:
1448                     object = new ClassLoaderReferenceImpl(vm, id);
1449                     break;
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/Utils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../jdk.unsupported/share/classes/sun/misc/Unsafe.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>