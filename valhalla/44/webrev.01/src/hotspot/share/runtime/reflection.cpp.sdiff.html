<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/runtime/reflection.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../prims/jvmtiGetLoadedClasses.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../services/heapDumper.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/reflection.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 376     if (d &lt; 0) {
 377       THROW_MSG_0(vmSymbols::java_lang_NegativeArraySizeException(), err_msg(&quot;%d&quot;, d));
 378     }
 379     dimensions[i] = d;
 380   }
 381 
 382   Klass* klass;
 383   int dim = len;
 384   if (java_lang_Class::is_primitive(element_mirror)) {
 385     klass = basic_type_mirror_to_arrayklass(element_mirror, CHECK_NULL);
 386   } else {
 387     klass = java_lang_Class::as_Klass(element_mirror);
 388     if (klass-&gt;is_array_klass()) {
 389       int k_dim = ArrayKlass::cast(klass)-&gt;dimension();
 390       if (k_dim + len &gt; MAX_DIM) {
 391         THROW_0(vmSymbols::java_lang_IllegalArgumentException());
 392       }
 393       dim += k_dim;
 394     }
 395   }
<span class="line-modified"> 396   ArrayStorageProperties storage_props = ArrayStorageProperties::for_signature(klass-&gt;name());</span>
<span class="line-removed"> 397   klass = klass-&gt;array_klass(storage_props, dim, CHECK_NULL);</span>
 398   oop obj = ArrayKlass::cast(klass)-&gt;multi_allocate(len, dimensions, CHECK_NULL);
 399   assert(obj-&gt;is_array(), &quot;just checking&quot;);
 400   return arrayOop(obj);
 401 }
 402 
 403 
 404 static bool under_unsafe_anonymous_host(const InstanceKlass* ik, const InstanceKlass* unsafe_anonymous_host) {
 405   DEBUG_ONLY(int inf_loop_check = 1000 * 1000 * 1000);
 406   for (;;) {
 407     const InstanceKlass* hc = ik-&gt;unsafe_anonymous_host();
 408     if (hc == NULL)        return false;
 409     if (hc == unsafe_anonymous_host)  return true;
 410     ik = hc;
 411 
 412     // There&#39;s no way to make a host class loop short of patching memory.
 413     // Therefore there cannot be a loop here unless there&#39;s another bug.
 414     // Still, let&#39;s check for it.
 415     assert(--inf_loop_check &gt; 0, &quot;no unsafe_anonymous_host loop&quot;);
 416   }
 417 }
</pre>
</td>
<td>
<hr />
<pre>
 376     if (d &lt; 0) {
 377       THROW_MSG_0(vmSymbols::java_lang_NegativeArraySizeException(), err_msg(&quot;%d&quot;, d));
 378     }
 379     dimensions[i] = d;
 380   }
 381 
 382   Klass* klass;
 383   int dim = len;
 384   if (java_lang_Class::is_primitive(element_mirror)) {
 385     klass = basic_type_mirror_to_arrayklass(element_mirror, CHECK_NULL);
 386   } else {
 387     klass = java_lang_Class::as_Klass(element_mirror);
 388     if (klass-&gt;is_array_klass()) {
 389       int k_dim = ArrayKlass::cast(klass)-&gt;dimension();
 390       if (k_dim + len &gt; MAX_DIM) {
 391         THROW_0(vmSymbols::java_lang_IllegalArgumentException());
 392       }
 393       dim += k_dim;
 394     }
 395   }
<span class="line-modified"> 396   klass = klass-&gt;array_klass(dim, CHECK_NULL);</span>

 397   oop obj = ArrayKlass::cast(klass)-&gt;multi_allocate(len, dimensions, CHECK_NULL);
 398   assert(obj-&gt;is_array(), &quot;just checking&quot;);
 399   return arrayOop(obj);
 400 }
 401 
 402 
 403 static bool under_unsafe_anonymous_host(const InstanceKlass* ik, const InstanceKlass* unsafe_anonymous_host) {
 404   DEBUG_ONLY(int inf_loop_check = 1000 * 1000 * 1000);
 405   for (;;) {
 406     const InstanceKlass* hc = ik-&gt;unsafe_anonymous_host();
 407     if (hc == NULL)        return false;
 408     if (hc == unsafe_anonymous_host)  return true;
 409     ik = hc;
 410 
 411     // There&#39;s no way to make a host class loop short of patching memory.
 412     // Therefore there cannot be a loop here unless there&#39;s another bug.
 413     // Still, let&#39;s check for it.
 414     assert(--inf_loop_check &gt; 0, &quot;no unsafe_anonymous_host loop&quot;);
 415   }
 416 }
</pre>
</td>
</tr>
</table>
<center><a href="../prims/jvmtiGetLoadedClasses.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../services/heapDumper.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>