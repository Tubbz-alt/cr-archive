<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jdwp.agent/share/native/libjdwp/util.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/Utils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/jdk.jdwp.agent/share/native/libjdwp/util.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 280             saveGlobalRef(env, localAgentProperties, &amp;(gdata-&gt;agent_properties));
 281             if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {
 282                 JNI_FUNC_PTR(env,ExceptionClear)(env);
 283                 EXIT_ERROR(AGENT_ERROR_INTERNAL,
 284                     &quot;Exception occurred calling VMSupport.getAgentProperties&quot;);
 285             }
 286         }
 287 
 288     } END_WITH_LOCAL_REFS(env);
 289 
 290 }
 291 
 292 void
 293 util_reset(void)
 294 {
 295 }
 296 
 297 jboolean
 298 isObjectTag(jbyte tag) {
 299     return (tag == JDWP_TAG(OBJECT)) ||

 300            (tag == JDWP_TAG(STRING)) ||
 301            (tag == JDWP_TAG(THREAD)) ||
 302            (tag == JDWP_TAG(THREAD_GROUP)) ||
 303            (tag == JDWP_TAG(CLASS_LOADER)) ||
 304            (tag == JDWP_TAG(CLASS_OBJECT)) ||
 305            (tag == JDWP_TAG(ARRAY));
 306 }
 307 
 308 jbyte
 309 specificTypeKey(JNIEnv *env, jobject object)
 310 {
 311     if (object == NULL) {
 312         return JDWP_TAG(OBJECT);
 313     } else if (JNI_FUNC_PTR(env,IsInstanceOf)(env, object, gdata-&gt;stringClass)) {
 314         return JDWP_TAG(STRING);
 315     } else if (JNI_FUNC_PTR(env,IsInstanceOf)(env, object, gdata-&gt;threadClass)) {
 316         return JDWP_TAG(THREAD);
 317     } else if (JNI_FUNC_PTR(env,IsInstanceOf)(env, object, gdata-&gt;threadGroupClass)) {
 318         return JDWP_TAG(THREAD_GROUP);
 319     } else if (JNI_FUNC_PTR(env,IsInstanceOf)(env, object, gdata-&gt;classLoaderClass)) {
</pre>
<hr />
<pre>
 346     error = fieldSignature(clazz, field, NULL, &amp;signature, NULL);
 347     if (error != JVMTI_ERROR_NONE) {
 348         outStream_setError(out, map2jdwpError(error));
 349         return;
 350     }
 351     typeKey = jdwpTag(signature);
 352     jvmtiDeallocate(signature);
 353 
 354     if (isReferenceTag(typeKey)) {
 355 
 356         jobject value = JNI_FUNC_PTR(env,GetObjectField)(env, object, field);
 357         (void)outStream_writeByte(out, specificTypeKey(env, value));
 358         (void)outStream_writeObjectRef(env, out, value);
 359         return;
 360 
 361     }
 362 
 363     /*
 364      * For primitive types, the type key is bounced back as is.
 365      */
<span class="line-removed"> 366 </span>
 367     (void)outStream_writeByte(out, typeKey);
 368 
 369     switch (typeKey) {
 370         case JDWP_TAG(BYTE):
 371             (void)outStream_writeByte(out,
 372                       JNI_FUNC_PTR(env,GetByteField)(env, object, field));
 373             break;
 374 
 375         case JDWP_TAG(CHAR):
 376             (void)outStream_writeChar(out,
 377                       JNI_FUNC_PTR(env,GetCharField)(env, object, field));
 378             break;
 379 
 380         case JDWP_TAG(FLOAT):
 381             (void)outStream_writeFloat(out,
 382                       JNI_FUNC_PTR(env,GetFloatField)(env, object, field));
 383             break;
 384 
 385         case JDWP_TAG(DOUBLE):
 386             (void)outStream_writeDouble(out,
</pre>
</td>
<td>
<hr />
<pre>
 280             saveGlobalRef(env, localAgentProperties, &amp;(gdata-&gt;agent_properties));
 281             if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {
 282                 JNI_FUNC_PTR(env,ExceptionClear)(env);
 283                 EXIT_ERROR(AGENT_ERROR_INTERNAL,
 284                     &quot;Exception occurred calling VMSupport.getAgentProperties&quot;);
 285             }
 286         }
 287 
 288     } END_WITH_LOCAL_REFS(env);
 289 
 290 }
 291 
 292 void
 293 util_reset(void)
 294 {
 295 }
 296 
 297 jboolean
 298 isObjectTag(jbyte tag) {
 299     return (tag == JDWP_TAG(OBJECT)) ||
<span class="line-added"> 300            (tag == JDWP_TAG(INLINE_OBJECT)) ||</span>
 301            (tag == JDWP_TAG(STRING)) ||
 302            (tag == JDWP_TAG(THREAD)) ||
 303            (tag == JDWP_TAG(THREAD_GROUP)) ||
 304            (tag == JDWP_TAG(CLASS_LOADER)) ||
 305            (tag == JDWP_TAG(CLASS_OBJECT)) ||
 306            (tag == JDWP_TAG(ARRAY));
 307 }
 308 
 309 jbyte
 310 specificTypeKey(JNIEnv *env, jobject object)
 311 {
 312     if (object == NULL) {
 313         return JDWP_TAG(OBJECT);
 314     } else if (JNI_FUNC_PTR(env,IsInstanceOf)(env, object, gdata-&gt;stringClass)) {
 315         return JDWP_TAG(STRING);
 316     } else if (JNI_FUNC_PTR(env,IsInstanceOf)(env, object, gdata-&gt;threadClass)) {
 317         return JDWP_TAG(THREAD);
 318     } else if (JNI_FUNC_PTR(env,IsInstanceOf)(env, object, gdata-&gt;threadGroupClass)) {
 319         return JDWP_TAG(THREAD_GROUP);
 320     } else if (JNI_FUNC_PTR(env,IsInstanceOf)(env, object, gdata-&gt;classLoaderClass)) {
</pre>
<hr />
<pre>
 347     error = fieldSignature(clazz, field, NULL, &amp;signature, NULL);
 348     if (error != JVMTI_ERROR_NONE) {
 349         outStream_setError(out, map2jdwpError(error));
 350         return;
 351     }
 352     typeKey = jdwpTag(signature);
 353     jvmtiDeallocate(signature);
 354 
 355     if (isReferenceTag(typeKey)) {
 356 
 357         jobject value = JNI_FUNC_PTR(env,GetObjectField)(env, object, field);
 358         (void)outStream_writeByte(out, specificTypeKey(env, value));
 359         (void)outStream_writeObjectRef(env, out, value);
 360         return;
 361 
 362     }
 363 
 364     /*
 365      * For primitive types, the type key is bounced back as is.
 366      */

 367     (void)outStream_writeByte(out, typeKey);
 368 
 369     switch (typeKey) {
 370         case JDWP_TAG(BYTE):
 371             (void)outStream_writeByte(out,
 372                       JNI_FUNC_PTR(env,GetByteField)(env, object, field));
 373             break;
 374 
 375         case JDWP_TAG(CHAR):
 376             (void)outStream_writeChar(out,
 377                       JNI_FUNC_PTR(env,GetCharField)(env, object, field));
 378             break;
 379 
 380         case JDWP_TAG(FLOAT):
 381             (void)outStream_writeFloat(out,
 382                       JNI_FUNC_PTR(env,GetFloatField)(env, object, field));
 383             break;
 384 
 385         case JDWP_TAG(DOUBLE):
 386             (void)outStream_writeDouble(out,
</pre>
</td>
</tr>
</table>
<center><a href="../../../../jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/Utils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>