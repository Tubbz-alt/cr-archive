<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.compiler/share/classes/com/sun/tools/javac/tree/TreeInfo.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Pretty.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TreeMaker.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/tree/TreeInfo.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1999, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 680             JCTry t = (JCTry) tree;
 681             Assert.checkNonNull(t.finalizer);
 682             return posKind.toPos(t.finalizer);
 683         } else if (tree.hasTag(SYNCHRONIZED)) {
 684             return endPos(((JCSynchronized) tree).body);
 685         } else {
 686             throw new AssertionError();
 687         }
 688     }
 689 
 690     /** Find the position for reporting an error about a symbol, where
 691      *  that symbol is defined somewhere in the given tree. */
 692     public static int positionFor(final Symbol sym, final JCTree tree) {
 693         JCTree decl = declarationFor(sym, tree);
 694         return ((decl != null) ? decl : tree).pos;
 695     }
 696 
 697     /** Find the position for reporting an error about a symbol, where
 698      *  that symbol is defined somewhere in the given tree. */
 699     public static DiagnosticPosition diagnosticPositionFor(final Symbol sym, final JCTree tree) {
<span class="line-modified"> 700         JCTree decl = declarationFor(sym, tree);</span>
<span class="line-removed"> 701         return ((decl != null) ? decl : tree).pos();</span>
 702     }
 703 
<span class="line-modified"> 704     /** Find the declaration for a symbol, where</span>
<span class="line-modified"> 705      *  that symbol is defined somewhere in the given tree. */</span>
<span class="line-modified"> 706     public static JCTree declarationFor(final Symbol sym, final JCTree tree) {</span>
<span class="line-modified"> 707         class DeclScanner extends TreeScanner {</span>
<span class="line-removed"> 708             JCTree result = null;</span>
<span class="line-removed"> 709             public void scan(JCTree tree) {</span>
<span class="line-removed"> 710                 if (tree!=null &amp;&amp; result==null)</span>
<span class="line-removed"> 711                     tree.accept(this);</span>
<span class="line-removed"> 712             }</span>
<span class="line-removed"> 713             public void visitTopLevel(JCCompilationUnit that) {</span>
<span class="line-removed"> 714                 if (that.packge == sym) result = that;</span>
<span class="line-removed"> 715                 else super.visitTopLevel(that);</span>
<span class="line-removed"> 716             }</span>
<span class="line-removed"> 717             public void visitModuleDef(JCModuleDecl that) {</span>
<span class="line-removed"> 718                 if (that.sym == sym) result = that;</span>
<span class="line-removed"> 719                 // no need to scan within module declaration</span>
<span class="line-removed"> 720             }</span>
<span class="line-removed"> 721             public void visitPackageDef(JCPackageDecl that) {</span>
<span class="line-removed"> 722                 if (that.packge == sym) result = that;</span>
<span class="line-removed"> 723                 else super.visitPackageDef(that);</span>
 724             }
<span class="line-modified"> 725             public void visitClassDef(JCClassDecl that) {</span>
<span class="line-modified"> 726                 if (that.sym == sym) result = that;</span>
<span class="line-removed"> 727                 else super.visitClassDef(that);</span>
<span class="line-removed"> 728             }</span>
<span class="line-removed"> 729             public void visitMethodDef(JCMethodDecl that) {</span>
 730                 if (that.sym == sym) result = that;
<span class="line-modified"> 731                 else super.visitMethodDef(that);</span>
 732             }
<span class="line-modified"> 733             public void visitVarDef(JCVariableDecl that) {</span>
 734                 if (that.sym == sym) result = that;
<span class="line-modified"> 735                 else super.visitVarDef(that);</span>
<span class="line-removed"> 736             }</span>
<span class="line-removed"> 737             public void visitTypeParameter(JCTypeParameter that) {</span>
<span class="line-removed"> 738                 if (that.type != null &amp;&amp; that.type.tsym == sym) result = that;</span>
<span class="line-removed"> 739                 else super.visitTypeParameter(that);</span>
 740             }
 741         }
<span class="line-modified"> 742         DeclScanner s = new DeclScanner();</span>
























































 743         tree.accept(s);
 744         return s.result;
 745     }
 746 
 747     public static Env&lt;AttrContext&gt; scopeFor(JCTree node, JCCompilationUnit unit) {
 748         return scopeFor(pathFor(node, unit));
 749     }
 750 
 751     public static Env&lt;AttrContext&gt; scopeFor(List&lt;JCTree&gt; path) {
 752         // TODO: not implemented yet
 753         throw new UnsupportedOperationException(&quot;not implemented yet&quot;);
 754     }
 755 
 756     public static List&lt;JCTree&gt; pathFor(final JCTree node, final JCCompilationUnit unit) {
 757         class Result extends Error {
 758             static final long serialVersionUID = -5942088234594905625L;
 759             List&lt;JCTree&gt; path;
 760             Result(List&lt;JCTree&gt; path) {
 761                 this.path = path;
 762             }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1999, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 680             JCTry t = (JCTry) tree;
 681             Assert.checkNonNull(t.finalizer);
 682             return posKind.toPos(t.finalizer);
 683         } else if (tree.hasTag(SYNCHRONIZED)) {
 684             return endPos(((JCSynchronized) tree).body);
 685         } else {
 686             throw new AssertionError();
 687         }
 688     }
 689 
 690     /** Find the position for reporting an error about a symbol, where
 691      *  that symbol is defined somewhere in the given tree. */
 692     public static int positionFor(final Symbol sym, final JCTree tree) {
 693         JCTree decl = declarationFor(sym, tree);
 694         return ((decl != null) ? decl : tree).pos;
 695     }
 696 
 697     /** Find the position for reporting an error about a symbol, where
 698      *  that symbol is defined somewhere in the given tree. */
 699     public static DiagnosticPosition diagnosticPositionFor(final Symbol sym, final JCTree tree) {
<span class="line-modified"> 700         return diagnosticPositionFor(sym, tree, false);</span>

 701     }
 702 
<span class="line-modified"> 703     public static DiagnosticPosition diagnosticPositionFor(final Symbol sym, final JCTree tree, boolean returnNullIfNotFound) {</span>
<span class="line-modified"> 704         class DiagScanner extends DeclScanner {</span>
<span class="line-modified"> 705             DiagScanner(Symbol sym) {</span>
<span class="line-modified"> 706                 super(sym);</span>
















 707             }
<span class="line-modified"> 708 </span>
<span class="line-modified"> 709             public void visitIdent(JCIdent that) {</span>



 710                 if (that.sym == sym) result = that;
<span class="line-modified"> 711                 else super.visitIdent(that);</span>
 712             }
<span class="line-modified"> 713             public void visitSelect(JCFieldAccess that) {</span>
 714                 if (that.sym == sym) result = that;
<span class="line-modified"> 715                 else super.visitSelect(that);</span>




 716             }
 717         }
<span class="line-modified"> 718         DiagScanner s = new DiagScanner(sym);</span>
<span class="line-added"> 719         tree.accept(s);</span>
<span class="line-added"> 720         JCTree decl = s.result;</span>
<span class="line-added"> 721         if (decl == null &amp;&amp; returnNullIfNotFound) { return null; }</span>
<span class="line-added"> 722         return ((decl != null) ? decl : tree).pos();</span>
<span class="line-added"> 723     }</span>
<span class="line-added"> 724 </span>
<span class="line-added"> 725     public static DiagnosticPosition diagnosticPositionFor(final Symbol sym, final List&lt;? extends JCTree&gt; trees) {</span>
<span class="line-added"> 726         return trees.stream().map(t -&gt; TreeInfo.diagnosticPositionFor(sym, t)).filter(t -&gt; t != null).findFirst().get();</span>
<span class="line-added"> 727     }</span>
<span class="line-added"> 728 </span>
<span class="line-added"> 729     private static class DeclScanner extends TreeScanner {</span>
<span class="line-added"> 730         final Symbol sym;</span>
<span class="line-added"> 731 </span>
<span class="line-added"> 732         DeclScanner(final Symbol sym) {</span>
<span class="line-added"> 733             this.sym = sym;</span>
<span class="line-added"> 734         }</span>
<span class="line-added"> 735 </span>
<span class="line-added"> 736         JCTree result = null;</span>
<span class="line-added"> 737         public void scan(JCTree tree) {</span>
<span class="line-added"> 738             if (tree!=null &amp;&amp; result==null)</span>
<span class="line-added"> 739                 tree.accept(this);</span>
<span class="line-added"> 740         }</span>
<span class="line-added"> 741         public void visitTopLevel(JCCompilationUnit that) {</span>
<span class="line-added"> 742             if (that.packge == sym) result = that;</span>
<span class="line-added"> 743             else super.visitTopLevel(that);</span>
<span class="line-added"> 744         }</span>
<span class="line-added"> 745         public void visitModuleDef(JCModuleDecl that) {</span>
<span class="line-added"> 746             if (that.sym == sym) result = that;</span>
<span class="line-added"> 747             // no need to scan within module declaration</span>
<span class="line-added"> 748         }</span>
<span class="line-added"> 749         public void visitPackageDef(JCPackageDecl that) {</span>
<span class="line-added"> 750             if (that.packge == sym) result = that;</span>
<span class="line-added"> 751             else super.visitPackageDef(that);</span>
<span class="line-added"> 752         }</span>
<span class="line-added"> 753         public void visitClassDef(JCClassDecl that) {</span>
<span class="line-added"> 754             if (that.sym == sym) result = that;</span>
<span class="line-added"> 755             else super.visitClassDef(that);</span>
<span class="line-added"> 756         }</span>
<span class="line-added"> 757         public void visitMethodDef(JCMethodDecl that) {</span>
<span class="line-added"> 758             if (that.sym == sym) result = that;</span>
<span class="line-added"> 759             else super.visitMethodDef(that);</span>
<span class="line-added"> 760         }</span>
<span class="line-added"> 761         public void visitVarDef(JCVariableDecl that) {</span>
<span class="line-added"> 762             if (that.sym == sym) result = that;</span>
<span class="line-added"> 763             else super.visitVarDef(that);</span>
<span class="line-added"> 764         }</span>
<span class="line-added"> 765         public void visitTypeParameter(JCTypeParameter that) {</span>
<span class="line-added"> 766             if (that.type != null &amp;&amp; that.type.tsym == sym) result = that;</span>
<span class="line-added"> 767             else super.visitTypeParameter(that);</span>
<span class="line-added"> 768         }</span>
<span class="line-added"> 769     }</span>
<span class="line-added"> 770 </span>
<span class="line-added"> 771     /** Find the declaration for a symbol, where</span>
<span class="line-added"> 772      *  that symbol is defined somewhere in the given tree. */</span>
<span class="line-added"> 773     public static JCTree declarationFor(final Symbol sym, final JCTree tree) {</span>
<span class="line-added"> 774         DeclScanner s = new DeclScanner(sym);</span>
 775         tree.accept(s);
 776         return s.result;
 777     }
 778 
 779     public static Env&lt;AttrContext&gt; scopeFor(JCTree node, JCCompilationUnit unit) {
 780         return scopeFor(pathFor(node, unit));
 781     }
 782 
 783     public static Env&lt;AttrContext&gt; scopeFor(List&lt;JCTree&gt; path) {
 784         // TODO: not implemented yet
 785         throw new UnsupportedOperationException(&quot;not implemented yet&quot;);
 786     }
 787 
 788     public static List&lt;JCTree&gt; pathFor(final JCTree node, final JCCompilationUnit unit) {
 789         class Result extends Error {
 790             static final long serialVersionUID = -5942088234594905625L;
 791             List&lt;JCTree&gt; path;
 792             Result(List&lt;JCTree&gt; path) {
 793                 this.path = path;
 794             }
</pre>
</td>
</tr>
</table>
<center><a href="Pretty.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="TreeMaker.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>