<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/opto/type.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="stringopts.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../prims/jvm.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/opto/type.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
3249     } else if (UseCompressedOops &amp;&amp; this-&gt;isa_aryptr() &amp;&amp; this-&gt;offset() != arrayOopDesc::length_offset_in_bytes()) {
3250       if (klass()-&gt;is_obj_array_klass()) {
3251         _is_ptr_to_narrowoop = true;
3252       } else if (klass()-&gt;is_value_array_klass() &amp;&amp; field_offset != Offset::top &amp;&amp; field_offset != Offset::bottom) {
3253         // Check if the field of the value type array element contains oops
3254         ciValueKlass* vk = klass()-&gt;as_value_array_klass()-&gt;element_klass()-&gt;as_value_klass();
3255         int foffset = field_offset.get() + vk-&gt;first_field_offset();
3256         ciField* field = vk-&gt;get_field_by_offset(foffset, false);
3257         assert(field != NULL, &quot;missing field&quot;);
3258         BasicType bt = field-&gt;layout_type();
3259         _is_ptr_to_narrowoop = (bt == T_OBJECT || bt == T_ARRAY || T_VALUETYPE);
3260       }
3261     } else if (klass()-&gt;is_instance_klass()) {
3262       if (this-&gt;isa_klassptr()) {
3263         // Perm objects don&#39;t use compressed references
3264       } else if (_offset == Offset::bottom || _offset == Offset::top) {
3265         // unsafe access
3266         _is_ptr_to_narrowoop = UseCompressedOops;
3267       } else { // exclude unsafe ops
3268         assert(this-&gt;isa_instptr(), &quot;must be an instance ptr.&quot;);
<span class="line-modified">3269         if (klass() == ciEnv::current()-&gt;Class_klass() &amp;&amp;</span>
<span class="line-modified">3270             (this-&gt;offset() == java_lang_Class::klass_offset_in_bytes() ||</span>
3271              this-&gt;offset() == java_lang_Class::array_klass_offset_in_bytes())) {
3272           // Special hidden fields from the Class.
3273           assert(this-&gt;isa_instptr(), &quot;must be an instance ptr.&quot;);
3274           _is_ptr_to_narrowoop = false;
3275         } else if (klass() == ciEnv::current()-&gt;Class_klass() &amp;&amp;
3276                    this-&gt;offset() &gt;= InstanceMirrorKlass::offset_of_static_fields()) {
3277           // Static fields
3278           assert(o != NULL, &quot;must be constant&quot;);
3279           ciInstanceKlass* ik = o-&gt;as_instance()-&gt;java_lang_Class_klass()-&gt;as_instance_klass();
3280           BasicType basic_elem_type;
3281           if (ik-&gt;is_valuetype() &amp;&amp; this-&gt;offset() == ik-&gt;as_value_klass()-&gt;default_value_offset()) {
3282             // Special hidden field that contains the oop of the default value type
3283             basic_elem_type = T_VALUETYPE;
3284           } else {
3285             ciField* field = ik-&gt;get_field_by_offset(this-&gt;offset(), true);
3286             assert(field != NULL, &quot;missing field&quot;);
3287             basic_elem_type = field-&gt;layout_type();
3288           }
3289           _is_ptr_to_narrowoop = UseCompressedOops &amp;&amp; is_reference_type(basic_elem_type);
3290         } else {
</pre>
</td>
<td>
<hr />
<pre>
3249     } else if (UseCompressedOops &amp;&amp; this-&gt;isa_aryptr() &amp;&amp; this-&gt;offset() != arrayOopDesc::length_offset_in_bytes()) {
3250       if (klass()-&gt;is_obj_array_klass()) {
3251         _is_ptr_to_narrowoop = true;
3252       } else if (klass()-&gt;is_value_array_klass() &amp;&amp; field_offset != Offset::top &amp;&amp; field_offset != Offset::bottom) {
3253         // Check if the field of the value type array element contains oops
3254         ciValueKlass* vk = klass()-&gt;as_value_array_klass()-&gt;element_klass()-&gt;as_value_klass();
3255         int foffset = field_offset.get() + vk-&gt;first_field_offset();
3256         ciField* field = vk-&gt;get_field_by_offset(foffset, false);
3257         assert(field != NULL, &quot;missing field&quot;);
3258         BasicType bt = field-&gt;layout_type();
3259         _is_ptr_to_narrowoop = (bt == T_OBJECT || bt == T_ARRAY || T_VALUETYPE);
3260       }
3261     } else if (klass()-&gt;is_instance_klass()) {
3262       if (this-&gt;isa_klassptr()) {
3263         // Perm objects don&#39;t use compressed references
3264       } else if (_offset == Offset::bottom || _offset == Offset::top) {
3265         // unsafe access
3266         _is_ptr_to_narrowoop = UseCompressedOops;
3267       } else { // exclude unsafe ops
3268         assert(this-&gt;isa_instptr(), &quot;must be an instance ptr.&quot;);
<span class="line-modified">3269         if (klass() == ciEnv::current()-&gt;Class_klass() &amp;&amp;</span>
<span class="line-modified">3270             (this-&gt;offset() == java_lang_Class::klass_offset() ||</span>
3271              this-&gt;offset() == java_lang_Class::array_klass_offset())) {
3272           // Special hidden fields from the Class.
3273           assert(this-&gt;isa_instptr(), &quot;must be an instance ptr.&quot;);
3274           _is_ptr_to_narrowoop = false;
3275         } else if (klass() == ciEnv::current()-&gt;Class_klass() &amp;&amp;
3276                    this-&gt;offset() &gt;= InstanceMirrorKlass::offset_of_static_fields()) {
3277           // Static fields
3278           assert(o != NULL, &quot;must be constant&quot;);
3279           ciInstanceKlass* ik = o-&gt;as_instance()-&gt;java_lang_Class_klass()-&gt;as_instance_klass();
3280           BasicType basic_elem_type;
3281           if (ik-&gt;is_valuetype() &amp;&amp; this-&gt;offset() == ik-&gt;as_value_klass()-&gt;default_value_offset()) {
3282             // Special hidden field that contains the oop of the default value type
3283             basic_elem_type = T_VALUETYPE;
3284           } else {
3285             ciField* field = ik-&gt;get_field_by_offset(this-&gt;offset(), true);
3286             assert(field != NULL, &quot;missing field&quot;);
3287             basic_elem_type = field-&gt;layout_type();
3288           }
3289           _is_ptr_to_narrowoop = UseCompressedOops &amp;&amp; is_reference_type(basic_elem_type);
3290         } else {
</pre>
</td>
</tr>
</table>
<center><a href="stringopts.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../prims/jvm.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>