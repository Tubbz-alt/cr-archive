<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/interpreter/interpreterRuntime.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../gc/z/zBarrierSet.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../jvmci/jvmciCompilerToVM.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/interpreter/interpreterRuntime.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 201   assert(result != NULL || is_fast_aldc, &quot;null result only valid for fast_aldc&quot;);
 202 
 203 #ifdef ASSERT
 204   {
 205     // The bytecode wrappers aren&#39;t GC-safe so construct a new one
 206     Bytecode_loadconstant ldc2(m, last_frame.bci());
 207     int rindex = ldc2.cache_index();
 208     if (rindex &lt; 0)
 209       rindex = m-&gt;constants()-&gt;cp_to_object_index(ldc2.pool_index());
 210     if (rindex &gt;= 0) {
 211       oop coop = m-&gt;constants()-&gt;resolved_references()-&gt;obj_at(rindex);
 212       oop roop = (result == NULL ? Universe::the_null_sentinel() : result);
 213       assert(roop == coop, &quot;expected result for assembly code&quot;);
 214     }
 215   }
 216 #endif
 217   thread-&gt;set_vm_result(result);
 218   if (!is_fast_aldc) {
 219     // Tell the interpreter how to unbox the primitive.
 220     guarantee(java_lang_boxing_object::is_instance(result, type), &quot;&quot;);
<span class="line-modified"> 221     int offset = java_lang_boxing_object::value_offset_in_bytes(type);</span>
 222     intptr_t flags = ((as_TosState(type) &lt;&lt; ConstantPoolCacheEntry::tos_state_shift)
 223                       | (offset &amp; ConstantPoolCacheEntry::field_index_mask));
 224     thread-&gt;set_vm_result_2((Metadata*)flags);
 225   }
 226 }
 227 JRT_END
 228 
 229 
 230 //------------------------------------------------------------------------------------------------------------------------
 231 // Allocation
 232 
 233 JRT_ENTRY(void, InterpreterRuntime::_new(JavaThread* thread, ConstantPool* pool, int index))
 234   Klass* k = pool-&gt;klass_at(index, CHECK);
 235   InstanceKlass* klass = InstanceKlass::cast(k);
 236 
 237   if (klass-&gt;is_value()) {
 238     THROW(vmSymbols::java_lang_InstantiationError());
 239   }
 240 
 241   // Make sure we are not instantiating an abstract klass
</pre>
</td>
<td>
<hr />
<pre>
 201   assert(result != NULL || is_fast_aldc, &quot;null result only valid for fast_aldc&quot;);
 202 
 203 #ifdef ASSERT
 204   {
 205     // The bytecode wrappers aren&#39;t GC-safe so construct a new one
 206     Bytecode_loadconstant ldc2(m, last_frame.bci());
 207     int rindex = ldc2.cache_index();
 208     if (rindex &lt; 0)
 209       rindex = m-&gt;constants()-&gt;cp_to_object_index(ldc2.pool_index());
 210     if (rindex &gt;= 0) {
 211       oop coop = m-&gt;constants()-&gt;resolved_references()-&gt;obj_at(rindex);
 212       oop roop = (result == NULL ? Universe::the_null_sentinel() : result);
 213       assert(roop == coop, &quot;expected result for assembly code&quot;);
 214     }
 215   }
 216 #endif
 217   thread-&gt;set_vm_result(result);
 218   if (!is_fast_aldc) {
 219     // Tell the interpreter how to unbox the primitive.
 220     guarantee(java_lang_boxing_object::is_instance(result, type), &quot;&quot;);
<span class="line-modified"> 221     int offset = java_lang_boxing_object::value_offset(type);</span>
 222     intptr_t flags = ((as_TosState(type) &lt;&lt; ConstantPoolCacheEntry::tos_state_shift)
 223                       | (offset &amp; ConstantPoolCacheEntry::field_index_mask));
 224     thread-&gt;set_vm_result_2((Metadata*)flags);
 225   }
 226 }
 227 JRT_END
 228 
 229 
 230 //------------------------------------------------------------------------------------------------------------------------
 231 // Allocation
 232 
 233 JRT_ENTRY(void, InterpreterRuntime::_new(JavaThread* thread, ConstantPool* pool, int index))
 234   Klass* k = pool-&gt;klass_at(index, CHECK);
 235   InstanceKlass* klass = InstanceKlass::cast(k);
 236 
 237   if (klass-&gt;is_value()) {
 238     THROW(vmSymbols::java_lang_InstantiationError());
 239   }
 240 
 241   // Make sure we are not instantiating an abstract klass
</pre>
</td>
</tr>
</table>
<center><a href="../gc/z/zBarrierSet.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../jvmci/jvmciCompilerToVM.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>