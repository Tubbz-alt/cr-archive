<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/lib/jdk/test/lib/Utils.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="SA/SATestUtils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="containers/cgroup/CgroupMetricsTester.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/lib/jdk/test/lib/Utils.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
103      * Returns the value of &#39;compile.jdk&#39; system property
104      */
105     public static final String COMPILE_JDK = System.getProperty(&quot;compile.jdk&quot;, TEST_JDK);
106 
107     /**
108      * Returns the value of &#39;test.classes&#39; system property
109      */
110     public static final String TEST_CLASSES = System.getProperty(&quot;test.classes&quot;, &quot;.&quot;);
111 
112     /**
113      * Defines property name for seed value.
114      */
115     public static final String SEED_PROPERTY_NAME = &quot;jdk.test.lib.random.seed&quot;;
116 
117     /* (non-javadoc)
118      * Random generator with (or without) predefined seed. Depends on
119      * &quot;jdk.test.lib.random.seed&quot; property value.
120      */
121     private static volatile Random RANDOM_GENERATOR;
122 





123     /**
124      * Contains the seed value used for {@link java.util.Random} creation.
125      */
126     public static final long SEED = Long.getLong(SEED_PROPERTY_NAME, new Random().nextLong());
127     /**
128      * Returns the value of &#39;test.timeout.factor&#39; system property
129      * converted to {@code double}.
130      */
131     public static final double TIMEOUT_FACTOR;
132     static {
133         String toFactor = System.getProperty(&quot;test.timeout.factor&quot;, &quot;1.0&quot;);
134         TIMEOUT_FACTOR = Double.parseDouble(toFactor);
135     }
136 
137     /**
138      * Returns the value of JTREG default test timeout in milliseconds
139      * converted to {@code long}.
140      */
141     public static final long DEFAULT_TEST_TIMEOUT = TimeUnit.SECONDS.toMillis(120);
142 
</pre>
<hr />
<pre>
298                 return sa;
299             }
300             port++;
301         }
302         throw new RuntimeException(&quot;Unable to find system port that is refusing connections&quot;);
303     }
304 
305     /**
306      * Returns the free port on the local host.
307      *
308      * @return The port number
309      * @throws IOException if an I/O error occurs when opening the socket
310      */
311     public static int getFreePort() throws IOException {
312         try (ServerSocket serverSocket =
313                 new ServerSocket(0, 5, InetAddress.getLoopbackAddress());) {
314             return serverSocket.getLocalPort();
315         }
316     }
317 































318     /**
319      * Returns the name of the local host.
320      *
321      * @return The host name
322      * @throws UnknownHostException if IP address of a host could not be determined
323      */
324     public static String getHostname() throws UnknownHostException {
325         InetAddress inetAddress = InetAddress.getLocalHost();
326         String hostName = inetAddress.getHostName();
327 
328         assertTrue((hostName != null &amp;&amp; !hostName.isEmpty()),
329                 &quot;Cannot get hostname&quot;);
330 
331         return hostName;
332     }
333 
334     /**
335      * Uses &quot;jcmd -l&quot; to search for a jvm pid. This function will wait
336      * forever (until jtreg timeout) for the pid to be found.
337      * @param key Regular expression to search for
</pre>
</td>
<td>
<hr />
<pre>
103      * Returns the value of &#39;compile.jdk&#39; system property
104      */
105     public static final String COMPILE_JDK = System.getProperty(&quot;compile.jdk&quot;, TEST_JDK);
106 
107     /**
108      * Returns the value of &#39;test.classes&#39; system property
109      */
110     public static final String TEST_CLASSES = System.getProperty(&quot;test.classes&quot;, &quot;.&quot;);
111 
112     /**
113      * Defines property name for seed value.
114      */
115     public static final String SEED_PROPERTY_NAME = &quot;jdk.test.lib.random.seed&quot;;
116 
117     /* (non-javadoc)
118      * Random generator with (or without) predefined seed. Depends on
119      * &quot;jdk.test.lib.random.seed&quot; property value.
120      */
121     private static volatile Random RANDOM_GENERATOR;
122 
<span class="line-added">123     /**</span>
<span class="line-added">124      * Maximum number of attempts to get free socket</span>
<span class="line-added">125      */</span>
<span class="line-added">126     private static final int MAX_SOCKET_TRIES = 10;</span>
<span class="line-added">127 </span>
128     /**
129      * Contains the seed value used for {@link java.util.Random} creation.
130      */
131     public static final long SEED = Long.getLong(SEED_PROPERTY_NAME, new Random().nextLong());
132     /**
133      * Returns the value of &#39;test.timeout.factor&#39; system property
134      * converted to {@code double}.
135      */
136     public static final double TIMEOUT_FACTOR;
137     static {
138         String toFactor = System.getProperty(&quot;test.timeout.factor&quot;, &quot;1.0&quot;);
139         TIMEOUT_FACTOR = Double.parseDouble(toFactor);
140     }
141 
142     /**
143      * Returns the value of JTREG default test timeout in milliseconds
144      * converted to {@code long}.
145      */
146     public static final long DEFAULT_TEST_TIMEOUT = TimeUnit.SECONDS.toMillis(120);
147 
</pre>
<hr />
<pre>
303                 return sa;
304             }
305             port++;
306         }
307         throw new RuntimeException(&quot;Unable to find system port that is refusing connections&quot;);
308     }
309 
310     /**
311      * Returns the free port on the local host.
312      *
313      * @return The port number
314      * @throws IOException if an I/O error occurs when opening the socket
315      */
316     public static int getFreePort() throws IOException {
317         try (ServerSocket serverSocket =
318                 new ServerSocket(0, 5, InetAddress.getLoopbackAddress());) {
319             return serverSocket.getLocalPort();
320         }
321     }
322 
<span class="line-added">323     /**</span>
<span class="line-added">324      * Returns the free unreserved port on the local host.</span>
<span class="line-added">325      *</span>
<span class="line-added">326      * @param reservedPorts reserved ports</span>
<span class="line-added">327      * @return The port number or -1 if failed to find a free port</span>
<span class="line-added">328      */</span>
<span class="line-added">329     public static int findUnreservedFreePort(int... reservedPorts) {</span>
<span class="line-added">330         int numTries = 0;</span>
<span class="line-added">331         while (numTries++ &lt; MAX_SOCKET_TRIES) {</span>
<span class="line-added">332             int port = -1;</span>
<span class="line-added">333             try {</span>
<span class="line-added">334                 port = getFreePort();</span>
<span class="line-added">335             } catch (IOException e) {</span>
<span class="line-added">336                 e.printStackTrace();</span>
<span class="line-added">337             }</span>
<span class="line-added">338             if (port &gt; 0 &amp;&amp; !isReserved(port, reservedPorts)) {</span>
<span class="line-added">339                 return port;</span>
<span class="line-added">340             }</span>
<span class="line-added">341         }</span>
<span class="line-added">342         return -1;</span>
<span class="line-added">343     }</span>
<span class="line-added">344 </span>
<span class="line-added">345     private static boolean isReserved(int port, int[] reservedPorts) {</span>
<span class="line-added">346         for (int p : reservedPorts) {</span>
<span class="line-added">347             if (p == port) {</span>
<span class="line-added">348                 return true;</span>
<span class="line-added">349             }</span>
<span class="line-added">350         }</span>
<span class="line-added">351         return false;</span>
<span class="line-added">352     }</span>
<span class="line-added">353 </span>
354     /**
355      * Returns the name of the local host.
356      *
357      * @return The host name
358      * @throws UnknownHostException if IP address of a host could not be determined
359      */
360     public static String getHostname() throws UnknownHostException {
361         InetAddress inetAddress = InetAddress.getLocalHost();
362         String hostName = inetAddress.getHostName();
363 
364         assertTrue((hostName != null &amp;&amp; !hostName.isEmpty()),
365                 &quot;Cannot get hostname&quot;);
366 
367         return hostName;
368     }
369 
370     /**
371      * Uses &quot;jcmd -l&quot; to search for a jvm pid. This function will wait
372      * forever (until jtreg timeout) for the pid to be found.
373      * @param key Regular expression to search for
</pre>
</td>
</tr>
</table>
<center><a href="SA/SATestUtils.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="containers/cgroup/CgroupMetricsTester.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>