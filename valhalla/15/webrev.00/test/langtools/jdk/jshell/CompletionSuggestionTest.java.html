<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/langtools/jdk/jshell/CompletionSuggestionTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8131025 8141092 8153761 8145263 8131019 8175886 8176184 8176241 8176110 8177466 8197439 8221759 8234896
 27  * @summary Test Completion and Documentation
 28  * @library /tools/lib
 29  * @modules jdk.compiler/com.sun.tools.javac.api
 30  *          jdk.compiler/com.sun.tools.javac.main
 31  *          jdk.jdeps/com.sun.tools.javap
 32  *          jdk.jshell/jdk.jshell:open
 33  * @build toolbox.ToolBox toolbox.JarTask toolbox.JavacTask
 34  * @build KullaTesting TestingInputStream Compiler
 35  * @run testng CompletionSuggestionTest
 36  */
 37 
 38 import java.io.IOException;
 39 import java.lang.reflect.Field;
 40 import java.nio.file.Files;
 41 import java.nio.file.Path;
 42 import java.nio.file.Paths;
 43 import java.util.Arrays;
 44 import java.util.Collections;
 45 import java.util.Set;
 46 import java.util.HashSet;
 47 import java.util.function.BiFunction;
 48 import java.util.function.Function;
 49 import java.util.jar.JarEntry;
 50 import java.util.jar.JarOutputStream;
 51 
 52 import jdk.jshell.Snippet;
 53 import org.testng.annotations.BeforeMethod;
 54 import org.testng.annotations.Test;
 55 
 56 import static jdk.jshell.Snippet.Status.VALID;
 57 import static jdk.jshell.Snippet.Status.OVERWRITTEN;
 58 
 59 @Test
 60 public class CompletionSuggestionTest extends KullaTesting {
 61 
 62     private final Compiler compiler = new Compiler();
 63     private final Path outDir = Paths.get(&quot;completion_suggestion_test&quot;);
 64 
 65     public void testMemberExpr() {
 66         assertEval(&quot;class Test { static void test() { } }&quot;);
 67         assertCompletion(&quot;Test.t|&quot;, &quot;test()&quot;);
 68         assertEval(&quot;Test ccTestInstance = new Test();&quot;);
 69         assertCompletion(&quot;ccTestInstance.t|&quot;, &quot;toString()&quot;);
 70         assertCompletion(&quot; ccTe|&quot;, &quot;ccTestInstance&quot;);
 71         assertCompletion(&quot;String value = ccTestInstance.to|&quot;, &quot;toString()&quot;);
 72         assertCompletion(&quot;java.util.Coll|&quot;, &quot;Collection&quot;, &quot;Collections&quot;);
 73         assertCompletion(&quot;String.cla|&quot;, &quot;class&quot;);
 74         assertCompletion(&quot;boolean.cla|&quot;, &quot;class&quot;);
 75         assertCompletion(&quot;byte.cla|&quot;, &quot;class&quot;);
 76         assertCompletion(&quot;short.cla|&quot;, &quot;class&quot;);
 77         assertCompletion(&quot;char.cla|&quot;, &quot;class&quot;);
 78         assertCompletion(&quot;int.cla|&quot;, &quot;class&quot;);
 79         assertCompletion(&quot;float.cla|&quot;, &quot;class&quot;);
 80         assertCompletion(&quot;long.cla|&quot;, &quot;class&quot;);
 81         assertCompletion(&quot;double.cla|&quot;, &quot;class&quot;);
 82         assertCompletion(&quot;void.cla|&quot;, &quot;class&quot;);
 83         assertCompletion(&quot;Object[].|&quot;, &quot;class&quot;);
 84         assertCompletion(&quot;int[].|&quot;, &quot;class&quot;);
 85         assertEval(&quot;Object[] ao = null;&quot;);
 86         assertCompletion(&quot;int i = ao.|&quot;, &quot;length&quot;);
 87         assertEval(&quot;int[] ai = null;&quot;);
 88         assertCompletion(&quot;int i = ai.|&quot;, &quot;length&quot;);
 89         assertCompletionIncludesExcludes(&quot;\&quot;\&quot;.|&quot;,
 90                 new HashSet&lt;&gt;(Collections.emptyList()),
 91                 new HashSet&lt;&gt;(Arrays.asList(&quot;String(&quot;)));
 92         assertEval(&quot;double d = 0;&quot;);
 93         assertEval(&quot;void m() {}&quot;);
 94         assertCompletionIncludesExcludes(&quot;d.|&quot;,
 95                 new HashSet&lt;&gt;(Collections.emptyList()),
 96                 new HashSet&lt;&gt;(Arrays.asList(&quot;class&quot;)));
 97         assertCompletionIncludesExcludes(&quot;m().|&quot;,
 98                 new HashSet&lt;&gt;(Collections.emptyList()),
 99                 new HashSet&lt;&gt;(Arrays.asList(&quot;class&quot;)));
100         assertEval(&quot;class C {class D {} static class E {} enum F {} interface H {} void method() {} int number;}&quot;);
101         assertCompletionIncludesExcludes(&quot;C.|&quot;,
102                 new HashSet&lt;&gt;(Arrays.asList(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;H&quot;, &quot;class&quot;)),
103                 new HashSet&lt;&gt;(Arrays.asList(&quot;method()&quot;, &quot;number&quot;)));
104         assertCompletionIncludesExcludes(&quot;new C().|&quot;,
105                 new HashSet&lt;&gt;(Arrays.asList(&quot;method()&quot;, &quot;number&quot;)),
106                 new HashSet&lt;&gt;(Arrays.asList(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;H&quot;, &quot;class&quot;)));
107         assertCompletionIncludesExcludes(&quot;new C() {}.|&quot;,
108                 new HashSet&lt;&gt;(Arrays.asList(&quot;method()&quot;, &quot;number&quot;)),
109                 new HashSet&lt;&gt;(Arrays.asList(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;H&quot;, &quot;class&quot;)));
110         assertCompletion(&quot;\&quot;\&quot;.leng|&quot;, &quot;length()&quot;);
111         assertCompletion(&quot;\&quot;\&quot;\&quot;\n\&quot;\&quot;\&quot;.leng|&quot;, &quot;length()&quot;);
112     }
113 
114     public void testStartOfExpression() {
115         assertEval(&quot;int ccTest = 0;&quot;);
116         assertCompletion(&quot;System.err.println(cc|&quot;, &quot;ccTest&quot;);
117         assertCompletion(&quot;for (int i = cc|&quot;, &quot;ccTest&quot;);
118     }
119 
120     public void testParameter() {
121         assertCompletion(&quot;class C{void method(int num){num|&quot;, &quot;num&quot;);
122     }
123 
124     public void testPrimitive() {
125         Set&lt;String&gt; primitives = new HashSet&lt;&gt;(Arrays.asList(&quot;boolean&quot;, &quot;char&quot;, &quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;));
126         Set&lt;String&gt; onlyVoid = new HashSet&lt;&gt;(Collections.singletonList(&quot;void&quot;));
127         Set&lt;String&gt; primitivesOrVoid = new HashSet&lt;&gt;(primitives);
128         primitivesOrVoid.addAll(onlyVoid);
129 
130         assertCompletionIncludesExcludes(&quot;|&quot;,
131                 primitivesOrVoid,
132                 new HashSet&lt;&gt;(Collections.emptyList()));
133         assertCompletionIncludesExcludes(&quot;int num = |&quot;,
134                 primitivesOrVoid,
135                 new HashSet&lt;&gt;(Collections.emptyList()));
136         assertCompletionIncludesExcludes(&quot;num = |&quot;,
137                 primitivesOrVoid,
138                 new HashSet&lt;&gt;(Collections.emptyList()));
139         assertCompletionIncludesExcludes(&quot;class C{void m() {|&quot;,
140                 primitivesOrVoid,
141                 new HashSet&lt;&gt;(Collections.emptyList()));
142         assertCompletionIncludesExcludes(&quot;void method(|&quot;,
143                 primitives,
144                 onlyVoid);
145         assertCompletionIncludesExcludes(&quot;void method(int num, |&quot;,
146                 primitives,
147                 onlyVoid);
148         assertCompletion(&quot;new java.util.ArrayList&lt;doub|&quot;);
149         assertCompletion(&quot;class A extends doubl|&quot;);
150         assertCompletion(&quot;class A implements doubl|&quot;);
151         assertCompletion(&quot;interface A extends doubl|&quot;);
152         assertCompletion(&quot;enum A implements doubl|&quot;);
153         assertCompletion(&quot;class A&lt;T extends doubl|&quot;);
154     }
155 
156     public void testEmpty() {
157         assertCompletionIncludesExcludes(&quot;|&quot;,
158                 new HashSet&lt;&gt;(Arrays.asList(&quot;Object&quot;, &quot;Void&quot;)),
159                 new HashSet&lt;&gt;(Arrays.asList(&quot;$REPL00DOESNOTMATTER&quot;)));
160         assertCompletionIncludesExcludes(&quot;V|&quot;,
161                 new HashSet&lt;&gt;(Collections.singletonList(&quot;Void&quot;)),
162                 new HashSet&lt;&gt;(Collections.singletonList(&quot;Object&quot;)));
163         assertCompletionIncludesExcludes(&quot;{ |&quot;,
164                 new HashSet&lt;&gt;(Arrays.asList(&quot;Object&quot;, &quot;Void&quot;)),
165                 new HashSet&lt;&gt;(Arrays.asList(&quot;$REPL00DOESNOTMATTER&quot;)));
166     }
167 
168     public void testSmartCompletion() {
169         assertEval(&quot;int ccTest1 = 0;&quot;);
170         assertEval(&quot;int ccTest2 = 0;&quot;);
171         assertEval(&quot;String ccTest3 = null;&quot;);
172         assertEval(&quot;void method(int i, String str) { }&quot;);
173         assertEval(&quot;void method(String str, int i) { }&quot;);
174         assertEval(&quot;java.util.List&lt;String&gt; list = null;&quot;);
175         assertCompletion(&quot;int ccTest4 = |&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;);
176         assertCompletion(&quot;ccTest2 = |&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;);
177         assertCompletion(&quot;int ccTest4 = ccTe|&quot;, &quot;ccTest1&quot;, &quot;ccTest2&quot;, &quot;ccTest3&quot;);
178         assertCompletion(&quot;int ccTest4 = ccTest3.len|&quot;, true, &quot;length()&quot;);
179         assertCompletion(&quot;method(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;, &quot;ccTest3&quot;);
180         assertCompletion(&quot;method(0, |&quot;, true, &quot;ccTest3&quot;);
181         assertCompletion(&quot;list.add(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;, &quot;ccTest3&quot;);
182         assertCompletion(&quot;list.add(0, |&quot;, true, &quot;ccTest3&quot;);
183         assertCompletion(&quot;new String(|&quot;, true, &quot;ccTest3&quot;);
184         assertCompletion(&quot;new String(new char[0], |&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;);
185         assertCompletionIncludesExcludes(&quot;new jav|&quot;, new HashSet&lt;&gt;(Arrays.asList(&quot;java.&quot;, &quot;javax.&quot;)), Collections.emptySet());
186         assertCompletion(&quot;Class&lt;String&gt; clazz = String.c|&quot;, true, &quot;class&quot;);
187 
188         Snippet klass = classKey(assertEval(&quot;class Klass {void method(int n) {} private void method(String str) {}}&quot;));
189         assertCompletion(&quot;new Klass().method(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;);
190         Snippet klass2 = classKey(assertEval(&quot;class Klass {static void method(int n) {} void method(String str) {}}&quot;,
191                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
192                 ste(klass, VALID, OVERWRITTEN, false, MAIN_SNIPPET)));
193         assertCompletion(&quot;Klass.method(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;);
194         assertEval(&quot;class Klass {Klass(int n) {} private Klass(String str) {}}&quot;,
195                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
196                 ste(klass2, VALID, OVERWRITTEN, false, MAIN_SNIPPET));
197         assertCompletion(&quot;new Klass(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;);
198     }
199 
200     public void testSmartCompletionInOverriddenMethodInvocation() {
201         assertEval(&quot;int ccTest1 = 0;&quot;);
202         assertEval(&quot;int ccTest2 = 0;&quot;);
203         assertEval(&quot;String ccTest3 = null;&quot;);
204         assertCompletion(&quot;\&quot;\&quot;.wait(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;);
205         assertEval(&quot;class Base {void method(int n) {}}&quot;);
206         assertEval(&quot;class Extend extends Base {}&quot;);
207         assertCompletion(&quot;new Extend().method(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;);
208     }
209 
210     public void testSmartCompletionForBoxedType() {
211         assertEval(&quot;int ccTest1 = 0;&quot;);
212         assertEval(&quot;Integer ccTest2 = 0;&quot;);
213         assertEval(&quot;Object ccTest3 = null;&quot;);
214         assertEval(&quot;int method1(int n) {return n;}&quot;);
215         assertEval(&quot;Integer method2(Integer n) {return n;}&quot;);
216         assertEval(&quot;Object method3(Object o) {return o;}&quot;);
217         assertCompletion(&quot;int ccTest4 = |&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;, &quot;method1(&quot;, &quot;method2(&quot;);
218         assertCompletion(&quot;Integer ccTest4 = |&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;, &quot;method1(&quot;, &quot;method2(&quot;);
219         assertCompletion(&quot;Object ccTest4 = |&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;, &quot;ccTest3&quot;, &quot;method1(&quot;, &quot;method2(&quot;, &quot;method3(&quot;);
220         assertCompletion(&quot;method1(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;, &quot;method1(&quot;, &quot;method2(&quot;);
221         assertCompletion(&quot;method2(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;, &quot;method1(&quot;, &quot;method2(&quot;);
222         assertCompletion(&quot;method3(|&quot;, true, &quot;ccTest1&quot;, &quot;ccTest2&quot;, &quot;ccTest3&quot;, &quot;method1(&quot;, &quot;method2(&quot;, &quot;method3(&quot;);
223     }
224 
225     public void testNewClass() {
226         assertCompletion(&quot;String str = new Strin|&quot;, &quot;String(&quot;, &quot;StringBuffer(&quot;, &quot;StringBuilder(&quot;, &quot;StringIndexOutOfBoundsException(&quot;);
227         assertCompletion(&quot;String str = new java.lang.Strin|&quot;, &quot;String(&quot;, &quot;StringBuffer(&quot;, &quot;StringBuilder(&quot;, &quot;StringIndexOutOfBoundsException(&quot;);
228         assertCompletion(&quot;String str = new |&quot;, true, &quot;String(&quot;);
229         assertCompletion(&quot;String str = new java.lang.|&quot;, true, &quot;String(&quot;);
230         assertCompletion(&quot;throw new Strin|&quot;, true, &quot;StringIndexOutOfBoundsException(&quot;);
231 
232         assertEval(&quot;class A{class B{} class C {C(int n) {}} static class D {} interface I {}}&quot;);
233         assertEval(&quot;A a;&quot;);
234         assertCompletion(&quot;new A().new |&quot;, &quot;B()&quot;, &quot;C(&quot;);
235         assertCompletion(&quot;a.new |&quot;, &quot;B()&quot;, &quot;C(&quot;);
236         assertCompletion(&quot;new A.|&quot;, &quot;D()&quot;);
237 
238         assertEval(&quot;enum E{; class A {}}&quot;);
239         assertEval(&quot;interface I{; class A {}}&quot;);
240         assertCompletion(&quot;new E.|&quot;, &quot;A()&quot;);
241         assertCompletion(&quot;new I.|&quot;, &quot;A()&quot;);
242         assertCompletion(&quot;new String(I.A|&quot;, &quot;A&quot;);
243     }
244 
245     public void testFullyQualified() {
246         assertCompletion(&quot;Optional&lt;String&gt; opt = java.u|&quot;, &quot;util.&quot;);
247         assertCompletionIncludesExcludes(&quot;Optional&lt;Strings&gt; opt = java.util.O|&quot;, new HashSet&lt;&gt;(Collections.singletonList(&quot;Optional&quot;)), Collections.emptySet());
248 
249         assertEval(&quot;void method(java.util.Optional&lt;String&gt; opt) {}&quot;);
250         assertCompletion(&quot;method(java.u|&quot;, &quot;util.&quot;);
251 
252         assertCompletion(&quot;Object.notElement.|&quot;);
253         assertCompletion(&quot;Object o = com.su|&quot;, &quot;sun.&quot;);
254 
255         Path p1 = outDir.resolve(&quot;dir1&quot;);
256         compiler.compile(p1,
257                 &quot;package p1.p2;\n&quot; +
258                 &quot;public class Test {\n&quot; +
259                 &quot;}&quot;,
260                 &quot;package p1.p3;\n&quot; +
261                 &quot;public class Test {\n&quot; +
262                 &quot;}&quot;);
263         String jarName = &quot;test.jar&quot;;
264         compiler.jar(p1, jarName, &quot;p1/p2/Test.class&quot;, &quot;p1/p3/Test.class&quot;);
265         addToClasspath(compiler.getPath(p1.resolve(jarName)));
266 
267         assertCompletionIncludesExcludes(&quot;|&quot;, new HashSet&lt;&gt;(Collections.singletonList(&quot;p1.&quot;)), Collections.emptySet());
268         assertCompletion(&quot;p1.|&quot;, &quot;p2.&quot;, &quot;p3.&quot;);
269         assertCompletion(&quot;p1.p2.|&quot;, &quot;Test&quot;);
270         assertCompletion(&quot;p1.p3.|&quot;, &quot;Test&quot;);
271     }
272 
273     public void testCheckAccessibility() {
274         assertCompletion(&quot;java.util.regex.Pattern.co|&quot;, &quot;compile(&quot;);
275     }
276 
277     public void testCompletePackages() {
278         assertCompletion(&quot;java.u|&quot;, &quot;util.&quot;);
279         assertCompletionIncludesExcludes(&quot;jav|&quot;, new HashSet&lt;&gt;(Arrays.asList(&quot;java.&quot;, &quot;javax.&quot;)), Collections.emptySet());
280     }
281 
282     public void testImports() {
283         assertCompletion(&quot;import java.u|&quot;, &quot;util.&quot;);
284         assertCompletionIncludesExcludes(&quot;import jav|&quot;, new HashSet&lt;&gt;(Arrays.asList(&quot;java.&quot;, &quot;javax.&quot;)), Collections.emptySet());
285         assertCompletion(&quot;import static java.u|&quot;, &quot;util.&quot;);
286         assertCompletionIncludesExcludes(&quot;import static jav|&quot;, new HashSet&lt;&gt;(Arrays.asList(&quot;java.&quot;, &quot;javax.&quot;)), Collections.emptySet());
287         assertCompletion(&quot;import static java.lang.Boolean.g|&quot;, &quot;getBoolean&quot;);
288         assertCompletion(&quot;import java.util.*|&quot;);
289         assertCompletionIncludesExcludes(&quot;import java.lang.String.|&quot;,
290                 Collections.emptySet(),
291                 new HashSet&lt;&gt;(Arrays.asList(&quot;CASE_INSENSITIVE_ORDER&quot;, &quot;copyValueOf&quot;, &quot;format&quot;, &quot;join&quot;, &quot;valueOf&quot;, &quot;class&quot;, &quot;length&quot;)));
292         assertCompletionIncludesExcludes(&quot;import static java.lang.String.|&quot;,
293                 new HashSet&lt;&gt;(Arrays.asList(&quot;CASE_INSENSITIVE_ORDER&quot;, &quot;copyValueOf&quot;, &quot;format&quot;, &quot;join&quot;, &quot;valueOf&quot;)),
294                 new HashSet&lt;&gt;(Arrays.asList(&quot;class&quot;, &quot;length&quot;)));
295         assertCompletionIncludesExcludes(&quot;import java.util.Map.|&quot;,
296                 new HashSet&lt;&gt;(Arrays.asList(&quot;Entry&quot;)),
297                 new HashSet&lt;&gt;(Arrays.asList(&quot;class&quot;)));
298     }
299 
300     public void testImportStart() {
301         assertCompletionIncludesExcludes(&quot;import c|&quot;, Set.of(&quot;com.&quot;), Set.of());
302     }
303 
304     public void testBrokenClassFile() throws Exception {
305         Compiler compiler = new Compiler();
306         Path testOutDir = Paths.get(&quot;CompletionTestBrokenClassFile&quot;);
307         String input = &quot;package test.inner; public class Test {}&quot;;
308         compiler.compile(testOutDir, input);
309         addToClasspath(compiler.getPath(testOutDir).resolve(&quot;test&quot;));
310         assertCompletion(&quot;import inner.|&quot;);
311     }
312 
313     public void testDocumentation() throws Exception {
314         dontReadParameterNamesFromClassFile();
315         assertSignature(&quot;System.getProperty(|&quot;,
316                 &quot;String System.getProperty(String key)&quot;,
317                 &quot;String System.getProperty(String key, String def)&quot;);
318         assertEval(&quot;char[] chars = null;&quot;);
319         assertSignature(&quot;new String(chars, |&quot;,
320                 &quot;String(char[], int, int)&quot;);
321         assertSignature(&quot;String.format(|&quot;,
322                 &quot;String String.format(String, Object...)&quot;,
323                 &quot;String String.format(java.util.Locale, String, Object...)&quot;);
324         assertSignature(&quot;\&quot;\&quot;.getBytes(\&quot;\&quot;|&quot;, &quot;void String.getBytes(int, int, byte[], int)&quot;,
325                                                     &quot;byte[] String.getBytes(String) throws java.io.UnsupportedEncodingException&quot;,
326                                                     &quot;byte[] String.getBytes(java.nio.charset.Charset)&quot;);
327         assertSignature(&quot;\&quot;\&quot;.getBytes(\&quot;\&quot; |&quot;, &quot;void String.getBytes(int, int, byte[], int)&quot;,
328                                                      &quot;byte[] String.getBytes(String) throws java.io.UnsupportedEncodingException&quot;,
329                                                      &quot;byte[] String.getBytes(java.nio.charset.Charset)&quot;);
330         //JDK-8221759:
331         Compiler compiler = new Compiler();
332         Path testOutDir = Paths.get(&quot;WithPrivateField&quot;);
333         String input = &quot;package field; public class FieldTest { private static String field; private static String field2; }&quot;;
334         compiler.compile(testOutDir, input);
335         addToClasspath(compiler.getPath(testOutDir));
336         assertSignature(&quot;field.FieldTest.field|&quot;);
337         assertSignature(&quot;field.FieldTest.field2|&quot;);
338     }
339 
340     public void testMethodsWithNoArguments() throws Exception {
341         dontReadParameterNamesFromClassFile();
342         assertSignature(&quot;System.out.println(|&quot;,
343                 &quot;void java.io.PrintStream.println()&quot;,
344                 &quot;void java.io.PrintStream.println(boolean)&quot;,
345                 &quot;void java.io.PrintStream.println(char)&quot;,
346                 &quot;void java.io.PrintStream.println(int)&quot;,
347                 &quot;void java.io.PrintStream.println(long)&quot;,
348                 &quot;void java.io.PrintStream.println(float)&quot;,
349                 &quot;void java.io.PrintStream.println(double)&quot;,
350                 &quot;void java.io.PrintStream.println(char[])&quot;,
351                 &quot;void java.io.PrintStream.println(String)&quot;,
352                 &quot;void java.io.PrintStream.println(Object)&quot;);
353     }
354 
355     public void testErroneous() {
356         assertCompletion(&quot;Undefined.|&quot;);
357         assertSignature(&quot;does.not.exist|&quot;);
358     }
359 
360     public void testClinit() {
361         assertEval(&quot;enum E{;}&quot;);
362         assertEval(&quot;class C{static{}}&quot;);
363         assertCompletionIncludesExcludes(&quot;E.|&quot;, Collections.emptySet(), new HashSet&lt;&gt;(Collections.singletonList(&quot;&lt;clinit&gt;&quot;)));
364         assertCompletionIncludesExcludes(&quot;C.|&quot;, Collections.emptySet(), new HashSet&lt;&gt;(Collections.singletonList(&quot;&lt;clinit&gt;&quot;)));
365     }
366 
367     public void testMethodHeaderContext() {
368         assertCompletion(&quot;private void f(Runn|&quot;, &quot;Runnable&quot;);
369         assertCompletion(&quot;void f(Runn|&quot;, &quot;Runnable&quot;);
370         assertCompletion(&quot;void f(Object o1, Runn|&quot;, &quot;Runnable&quot;);
371         assertCompletion(&quot;void f(Object o1) throws Num|&quot;, true, &quot;NumberFormatException&quot;);
372         assertCompletion(&quot;void f(Object o1) throws java.lang.Num|&quot;, true, &quot;NumberFormatException&quot;);
373         assertEval(&quot;class HogeHoge {static class HogeHogeException extends Exception {}}&quot;);
374         assertCompletion(&quot;void f(Object o1) throws Hoge|&quot;, &quot;HogeHoge&quot;);
375         assertCompletion(&quot;void f(Object o1) throws HogeHoge.|&quot;, true, &quot;HogeHogeException&quot;);
376     }
377 
378     public void testTypeVariables() {
379         assertCompletion(&quot;class A&lt;TYPE&gt; { public void test() { TY|&quot;, &quot;TYPE&quot;);
380         assertCompletion(&quot;class A&lt;TYPE&gt; { public static void test() { TY|&quot;);
381         assertCompletion(&quot;class A&lt;TYPE&gt; { public &lt;TYPE&gt; void test() { TY|&quot;, &quot;TYPE&quot;);
382         assertCompletion(&quot;class A&lt;TYPE&gt; { public static &lt;TYPE&gt; void test() { TY|&quot;, &quot;TYPE&quot;);
383     }
384 
385     public void testGeneric() {
386         assertEval(&quot;import java.util.concurrent.*;&quot;);
387         assertCompletion(&quot;java.util.List&lt;Integ|&quot;, &quot;Integer&quot;);
388         assertCompletion(&quot;class A&lt;TYPE extends Call|&quot;, &quot;Callable&quot;);
389         assertCompletion(&quot;class A&lt;TYPE extends Callable&lt;TY|&quot;, &quot;TYPE&quot;);
390         assertCompletion(&quot;&lt;TYPE&gt; void f(TY|&quot;, &quot;TYPE&quot;);
391         assertCompletion(&quot;class A&lt;TYPE extends Callable&lt;? sup|&quot;, &quot;super&quot;);
392         assertCompletion(&quot;class A&lt;TYPE extends Callable&lt;? super TY|&quot;, &quot;TYPE&quot;);
393     }
394 
395     public void testFields() {
396         assertEval(&quot;interface Interface { int field = 0; }&quot;);
397         Snippet clazz = classKey(assertEval(&quot;class Clazz {&quot; +
398                 &quot;static int staticField = 0;&quot; +
399                 &quot;int field = 0;&quot; +
400                 &quot; }&quot;));
401         assertCompletion(&quot;Interface.fiel|&quot;, &quot;field&quot;);
402         assertCompletion(&quot;Clazz.staticFiel|&quot;, &quot;staticField&quot;);
403         assertCompletion(&quot;new Interface() {}.fiel|&quot;);
404         assertCompletion(&quot;new Clazz().staticFiel|&quot;);
405         assertCompletion(&quot;new Clazz().fiel|&quot;, &quot;field&quot;);
406         assertCompletion(&quot;new Clazz() {}.fiel|&quot;, &quot;field&quot;);
407         assertEval(&quot;class Clazz implements Interface {}&quot;,
408                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
409                 ste(clazz, VALID, OVERWRITTEN, false, MAIN_SNIPPET));
410         assertCompletion(&quot;Clazz.fiel|&quot;, &quot;field&quot;);
411         assertCompletion(&quot;new Clazz().fiel|&quot;);
412         assertCompletion(&quot;new Clazz() {}.fiel|&quot;);
413     }
414 
415     public void testMethods() {
416         assertEval(&quot;interface Interface {&quot; +
417                 &quot;default int defaultMethod() { return 0; }&quot; +
418                 &quot;static int staticMethod() { return 0; }&quot; +
419                 &quot;}&quot;);
420         Snippet clazz = classKey(assertEval(&quot;class Clazz {&quot; +
421                 &quot;static int staticMethod() { return 0; }&quot; +
422                 &quot;int method() { return 0; }&quot; +
423                 &quot;}&quot;));
424         assertCompletion(&quot;Interface.staticMeth|&quot;, &quot;staticMethod()&quot;);
425         assertCompletion(&quot;Clazz.staticMeth|&quot;, &quot;staticMethod()&quot;);
426         assertCompletion(&quot;new Interface() {}.defaultMe||&quot;, &quot;defaultMethod()&quot;);
427         assertCompletion(&quot;new Clazz().staticMeth|&quot;);
428         assertCompletion(&quot;new Clazz().meth|&quot;, &quot;method()&quot;);
429         assertEval(&quot;class Clazz implements Interface {}&quot;,
430                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
431                 ste(clazz, VALID, OVERWRITTEN, false, MAIN_SNIPPET));
432         assertCompletion(&quot;Clazz.staticMeth|&quot;);
433         assertCompletion(&quot;new Clazz() {}.defaultM|&quot;, &quot;defaultMethod()&quot;);
434     }
435 
436     @Test
437     public void testUncompletedDeclaration() {
438         assertCompletion(&quot;class Clazz { Claz|&quot;, &quot;Clazz&quot;);
439         assertCompletion(&quot;class Clazz { class A extends Claz|&quot;, &quot;Clazz&quot;);
440         assertCompletion(&quot;class Clazz { Clazz clazz; Object o = claz|&quot;, &quot;clazz&quot;);
441         assertCompletion(&quot;class Clazz { static Clazz clazz; Object o = claz|&quot;, &quot;clazz&quot;);
442         assertCompletion(&quot;class Clazz { Clazz clazz; static Object o = claz|&quot;, true);
443         assertCompletion(&quot;class Clazz { void method(Claz|&quot;, &quot;Clazz&quot;);
444         assertCompletion(&quot;class A { int method() { return 0; } int a = meth|&quot;, &quot;method()&quot;);
445         assertCompletion(&quot;class A { int field = 0; int method() { return fiel|&quot;, &quot;field&quot;);
446         assertCompletion(&quot;class A { static int method() { return 0; } int a = meth|&quot;, &quot;method()&quot;);
447         assertCompletion(&quot;class A { static int field = 0; int method() { return fiel|&quot;, &quot;field&quot;);
448         assertCompletion(&quot;class A { int method() { return 0; } static int a = meth|&quot;, true);
449         assertCompletion(&quot;class A { int field = 0; static int method() { return fiel|&quot;, true);
450     }
451 
452     @Test
453     public void testClassDeclaration() {
454         assertEval(&quot;void ClazzM() {}&quot;);
455         assertEval(&quot;void InterfaceM() {}&quot;);
456         assertEval(&quot;interface Interface {}&quot;);
457         assertCompletion(&quot;interface A extends Interf|&quot;, &quot;Interface&quot;);
458         assertCompletion(&quot;class A implements Interf|&quot;, &quot;Interface&quot;);
459         assertEval(&quot;class Clazz {}&quot;);
460         assertCompletion(&quot;class A extends Claz|&quot;, &quot;Clazz&quot;);
461         assertCompletion(&quot;class A extends Clazz implements Interf|&quot;, &quot;Interface&quot;);
462         assertEval(&quot;interface Interface1 {}&quot;);
463         assertCompletion(&quot;class A extends Clazz implements Interface, Interf|&quot;, &quot;Interface&quot;, &quot;Interface1&quot;);
464         assertCompletion(&quot;interface A implements Claz|&quot;);
465         assertCompletion(&quot;interface A implements Inter|&quot;);
466         assertCompletion(&quot;class A implements Claz|&quot;, true);
467         assertCompletion(&quot;class A extends Clazz implements Interface, Interf|&quot;, true, &quot;Interface1&quot;);
468         assertCompletion(&quot;class A extends Clazz implements Interface, Interf|&quot;, true, &quot;Interface1&quot;);
469         assertEval(&quot;class InterfaceClazz {}&quot;);
470         assertCompletion(&quot;class A &lt;T extends Claz|&quot;, &quot;Clazz&quot;);
471         assertCompletion(&quot;class A &lt;T extends Interf|&quot;, &quot;Interface&quot;, &quot;Interface1&quot;, &quot;InterfaceClazz&quot;);
472         assertCompletion(&quot;class A &lt;T extends Interface &amp; Interf|&quot;, &quot;Interface&quot;, &quot;Interface1&quot;, &quot;InterfaceClazz&quot;);
473         assertCompletion(&quot;class A &lt;T extends Clazz &amp; Interf|&quot;, &quot;Interface&quot;, &quot;Interface1&quot;, &quot;InterfaceClazz&quot;);
474         assertCompletion(&quot;class A &lt;T extends Claz|&quot;, true, &quot;Clazz&quot;);
475         assertCompletion(&quot;class A &lt;T extends Interf|&quot;, true, &quot;Interface&quot;, &quot;Interface1&quot;, &quot;InterfaceClazz&quot;);
476         assertCompletion(&quot;class A &lt;T extends Interface &amp; Interf|&quot;, true, &quot;Interface1&quot;);
477         assertCompletion(&quot;class A &lt;T extends Clazz &amp; Interf|&quot;, true, &quot;Interface&quot;, &quot;Interface1&quot;);
478     }
479 
480     public void testMethodDeclaration() {
481         assertEval(&quot;void ClazzM() {}&quot;);
482         assertEval(&quot;void InterfaceM() {}&quot;);
483         assertEval(&quot;interface Interface {}&quot;);
484         assertCompletion(&quot;void m(Interf|&quot;, &quot;Interface&quot;);
485         assertCompletion(&quot;void m(Interface i1, Interf|&quot;, &quot;Interface&quot;);
486         assertEval(&quot;class InterfaceException extends Exception {}&quot;);
487         assertCompletion(&quot;void m(Interface i1) throws Interf|&quot;, &quot;Interface&quot;, &quot;InterfaceException&quot;);
488         assertCompletion(&quot;void m(Interface i1) throws Interf|&quot;, true, &quot;InterfaceException&quot;);
489     }
490 
491     public void testDocumentationOfUserDefinedMethods() {
492         assertEval(&quot;void f() {}&quot;);
493         assertSignature(&quot;f(|&quot;, &quot;void f()&quot;);
494         assertEval(&quot;void f(int i) {}&quot;);
495         assertSignature(&quot;f(|&quot;, &quot;void f()&quot;, &quot;void f(int i)&quot;);
496         assertEval(&quot;&lt;T&gt; void f(T... ts) {}&quot;, DiagCheck.DIAG_WARNING, DiagCheck.DIAG_OK);
497         assertSignature(&quot;f(|&quot;, &quot;void f()&quot;, &quot;void f(int i)&quot;, &quot;void &lt;T&gt;f(T... ts)&quot;);
498         assertEval(&quot;class A {}&quot;);
499         assertEval(&quot;void f(A a) {}&quot;);
500         assertSignature(&quot;f(|&quot;, &quot;void f()&quot;, &quot;void f(int i)&quot;, &quot;void &lt;T&gt;f(T... ts)&quot;, &quot;void f(A a)&quot;);
501     }
502 
503     public void testClass() {
504         assertSignature(&quot;String|&quot;, &quot;java.lang.String&quot;);
505     }
506 
507     public void testDocumentationOfUserDefinedConstructors() {
508         Snippet a = classKey(assertEval(&quot;class A {}&quot;));
509         assertSignature(&quot;new A(|&quot;, &quot;A()&quot;);
510         Snippet a2 = classKey(assertEval(&quot;class A { A() {} A(int i) {}}&quot;,
511                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
512                 ste(a, VALID, OVERWRITTEN, false, MAIN_SNIPPET)));
513         assertSignature(&quot;new A(|&quot;, &quot;A()&quot;, &quot;A(int i)&quot;);
514         assertEval(&quot;class A&lt;T&gt; { A(T a) {} A(int i) {} &lt;U&gt; A(T t, U u) {}}&quot;,
515                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
516                 ste(a2, VALID, OVERWRITTEN, false, MAIN_SNIPPET));
517         assertSignature(&quot;new A(|&quot;, &quot;A&lt;T&gt;(T a)&quot;, &quot;A&lt;T&gt;(int i)&quot;, &quot;&lt;U&gt; A&lt;T&gt;(T t, U u)&quot;);
518     }
519 
520     public void testDocumentationOfOverriddenMethods() throws Exception {
521         dontReadParameterNamesFromClassFile();
522         assertSignature(&quot;\&quot;\&quot;.wait(|&quot;,
523             &quot;void Object.wait(long) throws InterruptedException&quot;,
524             &quot;void Object.wait(long, int) throws InterruptedException&quot;,
525             &quot;void Object.wait() throws InterruptedException&quot;);
526         assertEval(&quot;class Base {void method() {}}&quot;);
527         Snippet e = classKey(assertEval(&quot;class Extend extends Base {}&quot;));
528         assertSignature(&quot;new Extend().method(|&quot;, &quot;void Base.method()&quot;);
529         assertEval(&quot;class Extend extends Base {void method() {}}&quot;,
530                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
531                 ste(e, VALID, OVERWRITTEN, false, MAIN_SNIPPET));
532         assertSignature(&quot;new Extend().method(|&quot;, &quot;void Extend.method()&quot;);
533     }
534 
535     public void testDocumentationOfInvisibleMethods() {
536         assertSignature(&quot;Object.wait(|&quot;);
537         assertSignature(&quot;\&quot;\&quot;.indexOfSupplementary(|&quot;);
538         Snippet a = classKey(assertEval(&quot;class A {void method() {}}&quot;));
539         assertSignature(&quot;A.method(|&quot;);
540         assertEval(&quot;class A {private void method() {}}&quot;,
541                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
542                 ste(a, VALID, OVERWRITTEN, false, MAIN_SNIPPET));
543         assertSignature(&quot;new A().method(|&quot;);
544     }
545 
546     public void testDocumentationOfInvisibleConstructors() {
547         assertSignature(&quot;new Compiler(|&quot;);
548         assertEval(&quot;class A { private A() {} }&quot;);
549         assertSignature(&quot;new A(|&quot;);
550     }
551 
552     public void testDocumentationWithBoxing() {
553         assertEval(&quot;int primitive = 0;&quot;);
554         assertEval(&quot;Integer boxed = 0;&quot;);
555         assertEval(&quot;Object object = null;&quot;);
556         assertEval(&quot;void method(int n, Object o) { }&quot;);
557         assertEval(&quot;void method(Object n, int o) { }&quot;);
558         assertSignature(&quot;method(primitive,|&quot;,
559                 &quot;void method(int n, Object o)&quot;,
560                 &quot;void method(Object n, int o)&quot;);
561         assertSignature(&quot;method(boxed,|&quot;,
562                 &quot;void method(int n, Object o)&quot;,
563                 &quot;void method(Object n, int o)&quot;);
564         assertSignature(&quot;method(object,|&quot;,
565                 &quot;void method(Object n, int o)&quot;);
566     }
567 
568     public void testDocumentationWithGenerics() {
569         class TestDocumentationWithGenerics {
570             private final Function&lt;Integer, String&gt; codeFacotry;
571             private final BiFunction&lt;String, Integer, String&gt; evalFormatter;
572             private final BiFunction&lt;String, Integer, String&gt; docFormatter;
573             int count;
574 
575             TestDocumentationWithGenerics(
576                     Function&lt;Integer, String&gt; codeFactory,
577                     BiFunction&lt;String, Integer, String&gt; evalFormatter,
578                     BiFunction&lt;String, Integer, String&gt; documentationFormatter) {
579                 this.codeFacotry = codeFactory;
580                 this.evalFormatter = evalFormatter;
581                 this.docFormatter = documentationFormatter;
582             }
583 
584             void assertDoc(String generics) {
585                 assertDoc(generics, generics);
586             }
587 
588             void assertDoc(String generics, String expectedGenerics) {
589                 assertEval(evalFormatter.apply(generics, count));
590                 assertSignature(codeFacotry.apply(count), docFormatter.apply(expectedGenerics, count));
591                 count++;
592             }
593         }
594 
595         TestDocumentationWithGenerics[] tests = {
596             new TestDocumentationWithGenerics(
597                     i -&gt; &quot;f&quot; + i + &quot;(|&quot;,
598                     (g, i) -&gt; &quot;&lt;&quot; + g + &quot;&gt; void f&quot; + i + &quot;() {}&quot;,
599                     (g, i) -&gt; &quot;void &lt;&quot; + g + &quot;&gt;f&quot; + i + &quot;()&quot;
600             ),
601             new TestDocumentationWithGenerics(
602                     i -&gt; &quot;new C&quot; + i + &quot;().f(|&quot;,
603                     (g, i) -&gt; &quot;class C&quot; + i + &quot;&lt;&quot; + g + &quot;&gt; { void f() {} }&quot;,
604                     (g, i) -&gt; &quot;void C&quot; + i + &quot;&lt;&quot; + g + &quot;&gt;.f()&quot;
605             )
606         };
607 
608         Arrays.stream(tests).forEach(t -&gt; {
609                 t.assertDoc(&quot;T&quot;);
610                 t.assertDoc(&quot;T extends Object&quot;,
611                         &quot;T&quot;);
612                 t.assertDoc(&quot;T extends String&quot;);
613                 t.assertDoc(&quot;T extends java.lang.String&quot;,
614                         &quot;T extends String&quot;);
615                 t.assertDoc(&quot;T extends Number &amp; Comparable&lt;T&gt;&quot;);
616                 t.assertDoc(&quot;T extends java.io.Serializable &amp; CharSequence&quot;);
617                 t.assertDoc(&quot;K, D, M extends java.util.Map&lt;K, D&gt;&quot;,
618                         &quot;K, D, M extends java.util.Map&lt;K,D&gt;&quot;);
619         });
620     }
621 
622     public void testVarArgs() {
623         assertEval(&quot;int i = 0;&quot;);
624         assertEval(&quot;class Foo1 { static void m(int... i) { } } &quot;);
625         assertCompletion(&quot;Foo1.m(|&quot;, true, &quot;i&quot;);
626         assertCompletion(&quot;Foo1.m(i, |&quot;, true, &quot;i&quot;);
627         assertCompletion(&quot;Foo1.m(i, i, |&quot;, true, &quot;i&quot;);
628         assertEval(&quot;class Foo2 { static void m(String s, int... i) { } } &quot;);
629         assertCompletion(&quot;Foo2.m(|&quot;, true);
630         assertCompletion(&quot;Foo2.m(i, |&quot;, true);
631         assertCompletion(&quot;Foo2.m(\&quot;\&quot;, |&quot;, true, &quot;i&quot;);
632         assertCompletion(&quot;Foo2.m(\&quot;\&quot;, i, |&quot;, true, &quot;i&quot;);
633         assertCompletion(&quot;Foo2.m(\&quot;\&quot;, i, i, |&quot;, true, &quot;i&quot;);
634         assertEval(&quot;class Foo3 { Foo3(String s, int... i) { } } &quot;);
635         assertCompletion(&quot;new Foo3(|&quot;, true);
636         assertCompletion(&quot;new Foo3(i, |&quot;, true);
637         assertCompletion(&quot;new Foo3(\&quot;\&quot;, |&quot;, true, &quot;i&quot;);
638         assertCompletion(&quot;new Foo3(\&quot;\&quot;, i, |&quot;, true, &quot;i&quot;);
639         assertCompletion(&quot;new Foo3(\&quot;\&quot;, i, i, |&quot;, true, &quot;i&quot;);
640         assertEval(&quot;int[] ia = null;&quot;);
641         assertCompletion(&quot;Foo1.m(ia, |&quot;, true);
642         assertEval(&quot;class Foo4 { static void m(int... i) { } static void m(int[] ia, String str) { } } &quot;);
643         assertEval(&quot;String str = null;&quot;);
644         assertCompletion(&quot;Foo4.m(ia, |&quot;, true, &quot;str&quot;);
645     }
646 
647     public void testConstructorAsMemberOf() {
648         assertEval(&quot;class Baz&lt;X&gt; { Baz(X x) { } } &quot;);
649         assertEval(&quot;String str = null;&quot;);
650         assertEval(&quot;Integer i = null;&quot;);
651         assertCompletion(&quot;new Baz(|&quot;, true, &quot;i&quot;, &quot;str&quot;);
652         assertCompletion(&quot;new Baz&lt;String&gt;(|&quot;, true, &quot;str&quot;);
653         assertCompletion(&quot;Baz&lt;String&gt; bz = new Baz&lt;&gt;(|&quot;, true, &quot;str&quot;);
654         assertEval(&quot;class Foo { static void m(String str) {} static void m(Baz&lt;String&gt; baz) {} }&quot;);
655         assertCompletion(&quot;Foo.m(new Baz&lt;&gt;(|&quot;, true, &quot;str&quot;);
656     }
657 
658     public void testIntersection() {
659         assertEval(&quot;&lt;Z extends Runnable &amp; CharSequence&gt; Z get() { return null; }&quot;);
660         assertEval(&quot;var v = get();&quot;);
661         assertCompletionIncludesExcludes(&quot;v.|&quot;, true, Set.of(&quot;run()&quot;, &quot;length()&quot;), Set.of());
662         assertCompletion(&quot;Runnable r = |&quot;, true, &quot;get()&quot;, &quot;v&quot;);
663         assertCompletion(&quot;CharSequence r = |&quot;, true, &quot;get()&quot;, &quot;v&quot;);
664         assertCompletion(&quot;Number r = |&quot;, true);
665     }
666 
667     public void testAnonymous() {
668         assertEval(&quot;var v = new Runnable() { public void run() { } public int length() { return 0; } };&quot;);
669         assertCompletionIncludesExcludes(&quot;v.|&quot;, true, Set.of(&quot;run()&quot;, &quot;length()&quot;), Set.of());
670         assertCompletion(&quot;Runnable r = |&quot;, true, &quot;v&quot;);
671         assertCompletion(&quot;CharSequence r = |&quot;, true);
672     }
673 
674     public void testCompletionInAnonymous() {
675         assertCompletionIncludesExcludes(&quot;new Undefined() { int i = \&quot;\&quot;.l|&quot;, Set.of(&quot;length()&quot;), Set.of());
676     }
677 
678     public void testMemberReferences() {
679         assertEval(&quot;class C {&quot; +
680                    &quot;    public static String stat() { return null; }&quot; +
681                    &quot;    public static void statVoid(String s) {}&quot; +
682                    &quot;    public static Integer statConvert1(String s) { return null; }&quot; +
683                    &quot;    public static String statConvert2(Integer s) { return null; }&quot; +
684                    &quot;    public static String statConvert3(CharSequence s) { return null; }&quot; +
685                    &quot;    public String inst() { return null; }&quot; +
686                    &quot;    public void instVoid(String s) { }&quot; +
687                    &quot;}&quot;);
688         assertEval(&quot;interface FI { public void t(String s); }&quot;);
689         assertCompletion(&quot;FI fi = C::|&quot;, (Boolean) null, &quot;stat&quot;, &quot;statConvert1&quot;, &quot;statConvert2&quot;, &quot;statConvert3&quot;, &quot;statVoid&quot;);
690         assertCompletion(&quot;FI fi = C::|&quot;, true, &quot;statConvert1&quot;, &quot;statConvert3&quot;,&quot;statVoid&quot;);
691         assertCompletion(&quot;FI fi = new C()::i|&quot;, (Boolean) null, &quot;inst&quot;, &quot;instVoid&quot;);
692         assertCompletion(&quot;FI fi = new C()::i|&quot;, true, &quot;instVoid&quot;);
693         assertEval(&quot;interface FI2&lt;R, P&gt; { public R t(P p); }&quot;);
694         assertCompletion(&quot;FI2&lt;String, Integer&gt; fi = C::|&quot;, (Boolean) null, &quot;stat&quot;, &quot;statConvert1&quot;, &quot;statConvert2&quot;, &quot;statConvert3&quot;, &quot;statVoid&quot;);
695         assertCompletion(&quot;FI2&lt;String, Integer&gt; fi = C::|&quot;, true, &quot;statConvert2&quot;);
696         assertCompletion(&quot;FI2&lt;String, CharSequence&gt; fi = C::|&quot;, true, &quot;statConvert3&quot;);
697         assertCompletion(&quot;FI2&lt;String, String&gt; fi = C::|&quot;, true, &quot;statConvert3&quot;);
698         assertCompletion(&quot;FI2&lt;Object, String&gt; fi = C::|&quot;, true, &quot;statConvert1&quot;, &quot;statConvert3&quot;);
699     }
700 
701     @BeforeMethod
702     public void setUp() {
703         super.setUp();
704 
705         Path srcZip = Paths.get(&quot;src.zip&quot;);
706 
707         try (JarOutputStream out = new JarOutputStream(Files.newOutputStream(srcZip))) {
708             out.putNextEntry(new JarEntry(&quot;java/lang/System.java&quot;));
709             out.write((&quot;package java.lang;\n&quot; +
710                        &quot;public class System {\n&quot; +
711                        &quot;    public String getProperty(String key) { return null; }\n&quot; +
712                        &quot;    public String getProperty(String key, String def) { return def; }\n&quot; +
713                        &quot;}\n&quot;).getBytes());
714         } catch (IOException ex) {
715             throw new IllegalStateException(ex);
716         }
717 
718         try {
719             Field availableSources = getAnalysis().getClass().getDeclaredField(&quot;availableSources&quot;);
720             availableSources.setAccessible(true);
721             availableSources.set(getAnalysis(), Arrays.asList(srcZip));
722         } catch (NoSuchFieldException | IllegalArgumentException | IllegalAccessException ex) {
723             throw new IllegalStateException(ex);
724         }
725     }
726 
727     private void dontReadParameterNamesFromClassFile() throws Exception {
728         Field keepParameterNames = getAnalysis().getClass().getDeclaredField(&quot;keepParameterNames&quot;);
729         keepParameterNames.setAccessible(true);
730         keepParameterNames.set(getAnalysis(), new String[0]);
731     }
732 
733     @Test(enabled = false) //TODO 8171829
734     public void testBrokenClassFile2() throws IOException {
735         Path broken = outDir.resolve(&quot;broken&quot;);
736         compiler.compile(broken,
737                 &quot;package p;\n&quot; +
738                 &quot;public class BrokenA {\n&quot; +
739                 &quot;}&quot;,
740                 &quot;package p.q;\n&quot; +
741                 &quot;public class BrokenB {\n&quot; +
742                 &quot;}&quot;,
743                 &quot;package p;\n&quot; +
744                 &quot;public class BrokenC {\n&quot; +
745                 &quot;}&quot;);
746         Path cp = compiler.getPath(broken);
747         Path target = cp.resolve(&quot;p&quot;).resolve(&quot;BrokenB.class&quot;);
748         Files.deleteIfExists(target);
749         Files.move(cp.resolve(&quot;p&quot;).resolve(&quot;q&quot;).resolve(&quot;BrokenB.class&quot;), target);
750         addToClasspath(cp);
751 
752         assertEval(&quot;import p.*;&quot;);
753         assertCompletion(&quot;Broke|&quot;, &quot;BrokenA&quot;, &quot;BrokenC&quot;);
754     }
755 }
    </pre>
  </body>
</html>