<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/gtest/runtime/test_classLoader.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../oops/test_oop.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../utilities/test_globalDefinitions.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/gtest/runtime/test_classLoader.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 21,72 ***</span>
   * questions.
   */
  
  #include &quot;precompiled.hpp&quot;
  #include &quot;classfile/classLoader.hpp&quot;
  #include &quot;memory/resourceArea.hpp&quot;
  #include &quot;unittest.hpp&quot;
  
<span class="line-modified">! // Tests ClassLoader::package_from_name()</span>
<span class="line-modified">! TEST_VM(classLoader, null_class_name) {</span>
<span class="line-removed">-   ResourceMark rm;</span>
    bool bad_class_name = false;
<span class="line-modified">!   const char* retval= ClassLoader::package_from_name(NULL, &amp;bad_class_name);</span>
    ASSERT_TRUE(bad_class_name) &lt;&lt; &quot;Function did not set bad_class_name with NULL class name&quot;;
<span class="line-modified">!   ASSERT_STREQ(retval, NULL) &lt;&lt; &quot;Wrong package for NULL class name pointer&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(classLoader, empty_class_name) {</span>
<span class="line-modified">!   ResourceMark rm;</span>
<span class="line-modified">!   const char* retval = ClassLoader::package_from_name(&quot;&quot;);</span>
<span class="line-modified">!   ASSERT_STREQ(retval, NULL) &lt;&lt; &quot;Wrong package for empty string&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(classLoader, no_slash) {</span>
<span class="line-modified">!   ResourceMark rm;</span>
<span class="line-modified">!   const char* retval = ClassLoader::package_from_name(&quot;L&quot;);</span>
<span class="line-modified">!   ASSERT_STREQ(retval, NULL) &lt;&lt; &quot;Wrong package for class with no slashes&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(classLoader, just_slash) {</span>
<span class="line-removed">-   ResourceMark rm;</span>
    bool bad_class_name = false;
<span class="line-modified">!   const char* retval = ClassLoader::package_from_name(&quot;/&quot;, &amp;bad_class_name);</span>
    ASSERT_TRUE(bad_class_name) &lt;&lt; &quot;Function did not set bad_class_name with package of length 0&quot;;
<span class="line-modified">!   ASSERT_STREQ(retval, NULL) &lt;&lt; &quot;Wrong package for class with just slash&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(classLoader, multiple_slashes) {</span>
<span class="line-modified">!   ResourceMark rm;</span>
<span class="line-modified">!   const char* retval = ClassLoader::package_from_name(&quot;///&quot;);</span>
<span class="line-modified">!   ASSERT_STREQ(retval, &quot;//&quot;) &lt;&lt; &quot;Wrong package for class with just slashes&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(classLoader, standard_case_1) {</span>
<span class="line-modified">!   ResourceMark rm;</span>
<span class="line-modified">!   bool bad_class_name = true;</span>
<span class="line-modified">!   const char* retval = ClassLoader::package_from_name(&quot;package/class&quot;, &amp;bad_class_name);</span>
<span class="line-modified">!   ASSERT_FALSE(bad_class_name) &lt;&lt; &quot;Function did not reset bad_class_name&quot;;</span>
<span class="line-modified">!   ASSERT_STREQ(retval, &quot;package&quot;) &lt;&lt; &quot;Wrong package for class with one slash&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(classLoader, standard_case_2) {</span>
<span class="line-modified">!   ResourceMark rm;</span>
<span class="line-modified">!   const char* retval = ClassLoader::package_from_name(&quot;package/folder/class&quot;);</span>
<span class="line-modified">!   ASSERT_STREQ(retval, &quot;package/folder&quot;) &lt;&lt; &quot;Wrong package for class with multiple slashes&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(classLoader, class_array) {</span>
<span class="line-removed">-   ResourceMark rm;</span>
    bool bad_class_name = false;
<span class="line-modified">!   const char* retval = ClassLoader::package_from_name(&quot;[package/class&quot;, &amp;bad_class_name);</span>
    ASSERT_FALSE(bad_class_name) &lt;&lt; &quot;Function set bad_class_name with class array&quot;;
<span class="line-modified">!   ASSERT_STREQ(retval, &quot;package&quot;) &lt;&lt; &quot;Wrong package for class with leading bracket&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(classLoader, class_object_array) {</span>
<span class="line-removed">-   ResourceMark rm;</span>
    bool bad_class_name = false;
<span class="line-modified">!   const char* retval = ClassLoader::package_from_name(&quot;[Lpackage/class&quot;, &amp;bad_class_name);</span>
    ASSERT_TRUE(bad_class_name) &lt;&lt; &quot;Function did not set bad_class_name with array of class objects&quot;;
<span class="line-modified">!   ASSERT_STREQ(retval, NULL) &lt;&lt; &quot;Wrong package for class with leading &#39;[L&#39;&quot;;</span>
  }
<span class="line-new-header">--- 21,87 ---</span>
   * questions.
   */
  
  #include &quot;precompiled.hpp&quot;
  #include &quot;classfile/classLoader.hpp&quot;
<span class="line-added">+ #include &quot;classfile/symbolTable.hpp&quot;</span>
  #include &quot;memory/resourceArea.hpp&quot;
  #include &quot;unittest.hpp&quot;
  
<span class="line-modified">! // Tests ClassLoader::package_from_class_name()</span>
<span class="line-modified">! TEST_VM(ClassLoader, null_class_name) {</span>
    bool bad_class_name = false;
<span class="line-modified">!   TempNewSymbol retval = ClassLoader::package_from_class_name(NULL, &amp;bad_class_name);</span>
    ASSERT_TRUE(bad_class_name) &lt;&lt; &quot;Function did not set bad_class_name with NULL class name&quot;;
<span class="line-modified">!   ASSERT_TRUE(retval == NULL) &lt;&lt; &quot;Wrong package for NULL class name pointer&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(ClassLoader, empty_class_name) {</span>
<span class="line-modified">!   bool bad_class_name = false;</span>
<span class="line-modified">!   TempNewSymbol name = SymbolTable::new_symbol(&quot;&quot;);</span>
<span class="line-modified">!   TempNewSymbol retval = ClassLoader::package_from_class_name(name, &amp;bad_class_name);</span>
<span class="line-added">+   ASSERT_TRUE(retval == NULL) &lt;&lt; &quot;Wrong package for empty string&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(ClassLoader, no_slash) {</span>
<span class="line-modified">!   bool bad_class_name = false;</span>
<span class="line-modified">!   TempNewSymbol name = SymbolTable::new_symbol(&quot;L&quot;);</span>
<span class="line-modified">!   TempNewSymbol retval = ClassLoader::package_from_class_name(name, &amp;bad_class_name);</span>
<span class="line-added">+   ASSERT_FALSE(bad_class_name) &lt;&lt; &quot;Function set bad_class_name with empty package&quot;;</span>
<span class="line-added">+   ASSERT_TRUE(retval == NULL) &lt;&lt; &quot;Wrong package for class with no slashes&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(ClassLoader, just_slash) {</span>
    bool bad_class_name = false;
<span class="line-modified">!   TempNewSymbol name = SymbolTable::new_symbol(&quot;/&quot;);</span>
<span class="line-added">+   TempNewSymbol retval = ClassLoader::package_from_class_name(name, &amp;bad_class_name);</span>
    ASSERT_TRUE(bad_class_name) &lt;&lt; &quot;Function did not set bad_class_name with package of length 0&quot;;
<span class="line-modified">!   ASSERT_TRUE(retval == NULL) &lt;&lt; &quot;Wrong package for class with just slash&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(ClassLoader, multiple_slashes) {</span>
<span class="line-modified">!   bool bad_class_name = false;</span>
<span class="line-modified">!   TempNewSymbol name = SymbolTable::new_symbol(&quot;///&quot;);</span>
<span class="line-modified">!   TempNewSymbol retval = ClassLoader::package_from_class_name(name, &amp;bad_class_name);</span>
<span class="line-added">+   ASSERT_FALSE(bad_class_name) &lt;&lt; &quot;Function set bad_class_name with slashes package&quot;;</span>
<span class="line-added">+   ASSERT_TRUE(retval-&gt;equals(&quot;//&quot;)) &lt;&lt; &quot;Wrong package for class with just slashes&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(ClassLoader, standard_case_1) {</span>
<span class="line-modified">!   bool bad_class_name = false;</span>
<span class="line-modified">!   TempNewSymbol name = SymbolTable::new_symbol(&quot;package/class&quot;);</span>
<span class="line-modified">!   TempNewSymbol retval = ClassLoader::package_from_class_name(name, &amp;bad_class_name);</span>
<span class="line-modified">!   ASSERT_FALSE(bad_class_name) &lt;&lt; &quot;Function set bad_class_name for valid package&quot;;</span>
<span class="line-modified">!   ASSERT_TRUE(retval-&gt;equals(&quot;package&quot;)) &lt;&lt; &quot;Wrong package for class with one slash&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(ClassLoader, standard_case_2) {</span>
<span class="line-modified">!   bool bad_class_name = false;</span>
<span class="line-modified">!   TempNewSymbol name = SymbolTable::new_symbol(&quot;package/folder/class&quot;);</span>
<span class="line-modified">!   TempNewSymbol retval = ClassLoader::package_from_class_name(name, &amp;bad_class_name);</span>
<span class="line-added">+   ASSERT_FALSE(bad_class_name) &lt;&lt; &quot;Function set bad_class_name for valid package&quot;;</span>
<span class="line-added">+   ASSERT_TRUE(retval-&gt;equals(&quot;package/folder&quot;)) &lt;&lt; &quot;Wrong package for class with multiple slashes&quot;;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ TEST_VM(ClassLoader, class_array) {</span>
<span class="line-added">+   bool bad_class_name = false;</span>
<span class="line-added">+   TempNewSymbol name = SymbolTable::new_symbol(&quot;[package/class&quot;);</span>
<span class="line-added">+   TempNewSymbol retval = ClassLoader::package_from_class_name(name, &amp;bad_class_name);</span>
<span class="line-added">+   ASSERT_FALSE(bad_class_name) &lt;&lt; &quot;Function set bad_class_name with class array&quot;;</span>
<span class="line-added">+   ASSERT_TRUE(retval-&gt;equals(&quot;package&quot;)) &lt;&lt; &quot;Wrong package for class with leading bracket&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(ClassLoader, class_multiarray) {</span>
    bool bad_class_name = false;
<span class="line-modified">!   TempNewSymbol name = SymbolTable::new_symbol(&quot;[[package/class&quot;);</span>
<span class="line-added">+   TempNewSymbol retval = ClassLoader::package_from_class_name(name, &amp;bad_class_name);</span>
    ASSERT_FALSE(bad_class_name) &lt;&lt; &quot;Function set bad_class_name with class array&quot;;
<span class="line-modified">!   ASSERT_TRUE(retval-&gt;equals(&quot;package&quot;)) &lt;&lt; &quot;Wrong package for class with leading bracket&quot;;</span>
  }
  
<span class="line-modified">! TEST_VM(ClassLoader, class_object_array) {</span>
    bool bad_class_name = false;
<span class="line-modified">!   TempNewSymbol name = SymbolTable::new_symbol(&quot;[Lpackage/class&quot;);</span>
<span class="line-added">+   TempNewSymbol retval = ClassLoader::package_from_class_name(name, &amp;bad_class_name);</span>
    ASSERT_TRUE(bad_class_name) &lt;&lt; &quot;Function did not set bad_class_name with array of class objects&quot;;
<span class="line-modified">!   ASSERT_TRUE(retval == NULL) &lt;&lt; &quot;Wrong package for class with leading &#39;[L&#39;&quot;;</span>
  }
</pre>
<center><a href="../oops/test_oop.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../utilities/test_globalDefinitions.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>