<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/cpu/x86/x86_64.ad</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="x86_32.ad.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../../os/aix/os_aix.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/x86/x86_64.ad</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 783,11 ***</span>
  }
  
  //=============================================================================
  const RegMask&amp; MachConstantBaseNode::_out_RegMask = RegMask::Empty;
  
<span class="line-modified">! int Compile::ConstantTable::calculate_table_base_offset() const {</span>
    return 0;  // absolute addressing, no offset
  }
  
  bool MachConstantBaseNode::requires_postalloc_expand() const { return false; }
  void MachConstantBaseNode::postalloc_expand(GrowableArray &lt;Node *&gt; *nodes, PhaseRegAlloc *ra_) {
<span class="line-new-header">--- 783,11 ---</span>
  }
  
  //=============================================================================
  const RegMask&amp; MachConstantBaseNode::_out_RegMask = RegMask::Empty;
  
<span class="line-modified">! int ConstantTable::calculate_table_base_offset() const {</span>
    return 0;  // absolute addressing, no offset
  }
  
  bool MachConstantBaseNode::requires_postalloc_expand() const { return false; }
  void MachConstantBaseNode::postalloc_expand(GrowableArray &lt;Node *&gt; *nodes, PhaseRegAlloc *ra_) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 812,17 ***</span>
  //=============================================================================
  #ifndef PRODUCT
  void MachPrologNode::format(PhaseRegAlloc* ra_, outputStream* st) const {
    Compile* C = ra_-&gt;C;
  
<span class="line-modified">!   int framesize = C-&gt;frame_size_in_bytes();</span>
<span class="line-modified">!   int bangsize = C-&gt;bang_size_in_bytes();</span>
    assert((framesize &amp; (StackAlignmentInBytes-1)) == 0, &quot;frame size not aligned&quot;);
    // Remove wordSize for return addr which is already pushed.
    framesize -= wordSize;
  
<span class="line-modified">!   if (C-&gt;need_stack_bang(bangsize)) {</span>
      framesize -= wordSize;
      st-&gt;print(&quot;# stack bang (%d bytes)&quot;, bangsize);
      st-&gt;print(&quot;\n\t&quot;);
      st-&gt;print(&quot;pushq   rbp\t# Save rbp&quot;);
      if (PreserveFramePointer) {
<span class="line-new-header">--- 812,17 ---</span>
  //=============================================================================
  #ifndef PRODUCT
  void MachPrologNode::format(PhaseRegAlloc* ra_, outputStream* st) const {
    Compile* C = ra_-&gt;C;
  
<span class="line-modified">!   int framesize = C-&gt;output()-&gt;frame_size_in_bytes();</span>
<span class="line-modified">!   int bangsize = C-&gt;output()-&gt;bang_size_in_bytes();</span>
    assert((framesize &amp; (StackAlignmentInBytes-1)) == 0, &quot;frame size not aligned&quot;);
    // Remove wordSize for return addr which is already pushed.
    framesize -= wordSize;
  
<span class="line-modified">!   if (C-&gt;output()-&gt;need_stack_bang(bangsize)) {</span>
      framesize -= wordSize;
      st-&gt;print(&quot;# stack bang (%d bytes)&quot;, bangsize);
      st-&gt;print(&quot;\n\t&quot;);
      st-&gt;print(&quot;pushq   rbp\t# Save rbp&quot;);
      if (PreserveFramePointer) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 895,16 ***</span>
    if (C-&gt;stub_function() == NULL) {
      BarrierSetAssembler* bs = BarrierSet::barrier_set()-&gt;barrier_set_assembler();
      bs-&gt;nmethod_entry_barrier(&amp;_masm);
    }
  
<span class="line-modified">!   C-&gt;set_frame_complete(cbuf.insts_size());</span>
  
    if (C-&gt;has_mach_constant_base_node()) {
      // NOTE: We set the table base offset here because users might be
      // emitted before MachConstantBaseNode.
<span class="line-modified">!     Compile::ConstantTable&amp; constant_table = C-&gt;constant_table();</span>
      constant_table.set_table_base_offset(constant_table.calculate_table_base_offset());
    }
  }
  
  int MachPrologNode::reloc() const
<span class="line-new-header">--- 895,16 ---</span>
    if (C-&gt;stub_function() == NULL) {
      BarrierSetAssembler* bs = BarrierSet::barrier_set()-&gt;barrier_set_assembler();
      bs-&gt;nmethod_entry_barrier(&amp;_masm);
    }
  
<span class="line-modified">!   C-&gt;output()-&gt;set_frame_complete(cbuf.insts_size());</span>
  
    if (C-&gt;has_mach_constant_base_node()) {
      // NOTE: We set the table base offset here because users might be
      // emitted before MachConstantBaseNode.
<span class="line-modified">!     ConstantTable&amp; constant_table = C-&gt;output()-&gt;constant_table();</span>
      constant_table.set_table_base_offset(constant_table.calculate_table_base_offset());
    }
  }
  
  int MachPrologNode::reloc() const
</pre>
<hr />
<pre>
<span class="line-old-header">*** 920,11 ***</span>
    if (generate_vzeroupper(C)) {
      st-&gt;print(&quot;vzeroupper&quot;);
      st-&gt;cr(); st-&gt;print(&quot;\t&quot;);
    }
  
<span class="line-modified">!   int framesize = C-&gt;frame_size_in_bytes();</span>
    assert((framesize &amp; (StackAlignmentInBytes-1)) == 0, &quot;frame size not aligned&quot;);
    // Remove word for return adr already pushed
    // and RBP
    framesize -= 2*wordSize;
  
<span class="line-new-header">--- 920,11 ---</span>
    if (generate_vzeroupper(C)) {
      st-&gt;print(&quot;vzeroupper&quot;);
      st-&gt;cr(); st-&gt;print(&quot;\t&quot;);
    }
  
<span class="line-modified">!   int framesize = C-&gt;output()-&gt;frame_size_in_bytes();</span>
    assert((framesize &amp; (StackAlignmentInBytes-1)) == 0, &quot;frame size not aligned&quot;);
    // Remove word for return adr already pushed
    // and RBP
    framesize -= 2*wordSize;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 962,12 ***</span>
      // wide vectors to avoid AVX &lt;-&gt; SSE transition penalty during call.
      __ vzeroupper();
    }
  
    // Subtract two words to account for return address and rbp
<span class="line-modified">!   int initial_framesize = C-&gt;frame_size_in_bytes() - 2*wordSize;</span>
<span class="line-modified">!   __ remove_frame(initial_framesize, C-&gt;needs_stack_repair(), C-&gt;sp_inc_offset());</span>
  
    if (StackReservedPages &gt; 0 &amp;&amp; C-&gt;has_reserved_stack_access()) {
      __ reserved_stack_check();
    }
  
<span class="line-new-header">--- 962,12 ---</span>
      // wide vectors to avoid AVX &lt;-&gt; SSE transition penalty during call.
      __ vzeroupper();
    }
  
    // Subtract two words to account for return address and rbp
<span class="line-modified">!   int initial_framesize = C-&gt;output()-&gt;frame_size_in_bytes() - 2*wordSize;</span>
<span class="line-modified">!   __ remove_frame(initial_framesize, C-&gt;needs_stack_repair(), C-&gt;output()-&gt;sp_inc_offset());</span>
  
    if (StackReservedPages &gt; 0 &amp;&amp; C-&gt;has_reserved_stack_access()) {
      __ reserved_stack_check();
    }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3110,21 ***</span>
    interface(CONST_INTER);
  %}
  
  operand immL_Pow2()
  %{
<span class="line-modified">!   predicate(is_power_of_2(n-&gt;get_long()));</span>
    match(ConL);
  
    op_cost(15);
    format %{ %}
    interface(CONST_INTER);
  %}
  
  operand immL_NotPow2()
  %{
<span class="line-modified">!   predicate(is_power_of_2(~n-&gt;get_long()));</span>
    match(ConL);
  
    op_cost(15);
    format %{ %}
    interface(CONST_INTER);
<span class="line-new-header">--- 3110,21 ---</span>
    interface(CONST_INTER);
  %}
  
  operand immL_Pow2()
  %{
<span class="line-modified">!   predicate(is_power_of_2((julong)n-&gt;get_long()));</span>
    match(ConL);
  
    op_cost(15);
    format %{ %}
    interface(CONST_INTER);
  %}
  
  operand immL_NotPow2()
  %{
<span class="line-modified">!   predicate(is_power_of_2((julong)~n-&gt;get_long()));</span>
    match(ConL);
  
    op_cost(15);
    format %{ %}
    interface(CONST_INTER);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 10075,11 ***</span>
    effect(KILL cr);
  
    ins_cost(125);
    format %{ &quot;btsq    $dst, log2($con)\t# long&quot; %}
    ins_encode %{
<span class="line-modified">!     __ btsq($dst$$Address, log2_long($con$$constant));</span>
    %}
    ins_pipe(ialu_mem_imm);
  %}
  
  // Xor Instructions
<span class="line-new-header">--- 10075,11 ---</span>
    effect(KILL cr);
  
    ins_cost(125);
    format %{ &quot;btsq    $dst, log2($con)\t# long&quot; %}
    ins_encode %{
<span class="line-modified">!     __ btsq($dst$$Address, log2_long((julong)$con$$constant));</span>
    %}
    ins_pipe(ialu_mem_imm);
  %}
  
  // Xor Instructions
</pre>
<center><a href="x86_32.ad.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../../os/aix/os_aix.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>