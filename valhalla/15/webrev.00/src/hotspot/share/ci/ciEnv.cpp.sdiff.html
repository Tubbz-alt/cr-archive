<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/ci/ciEnv.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../c1/c1_LinearScan.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../classfile/classFileParser.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/ci/ciEnv.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  23  */
  24 
  25 #include &quot;precompiled.hpp&quot;
  26 #include &quot;jvm.h&quot;
  27 #include &quot;ci/ciConstant.hpp&quot;
  28 #include &quot;ci/ciEnv.hpp&quot;
  29 #include &quot;ci/ciField.hpp&quot;
  30 #include &quot;ci/ciInstance.hpp&quot;
  31 #include &quot;ci/ciInstanceKlass.hpp&quot;
  32 #include &quot;ci/ciMethod.hpp&quot;
  33 #include &quot;ci/ciNullObject.hpp&quot;
  34 #include &quot;ci/ciReplay.hpp&quot;
  35 #include &quot;ci/ciUtilities.inline.hpp&quot;
  36 #include &quot;ci/ciValueKlass.hpp&quot;
  37 #include &quot;classfile/symbolTable.hpp&quot;
  38 #include &quot;classfile/systemDictionary.hpp&quot;
  39 #include &quot;classfile/vmSymbols.hpp&quot;
  40 #include &quot;code/codeCache.hpp&quot;
  41 #include &quot;code/scopeDesc.hpp&quot;
  42 #include &quot;compiler/compileBroker.hpp&quot;

  43 #include &quot;compiler/compileLog.hpp&quot;
  44 #include &quot;compiler/disassembler.hpp&quot;
  45 #include &quot;gc/shared/collectedHeap.inline.hpp&quot;
  46 #include &quot;interpreter/linkResolver.hpp&quot;
<span class="line-removed">  47 #include &quot;jfr/jfrEvents.hpp&quot;</span>
  48 #include &quot;logging/log.hpp&quot;
  49 #include &quot;memory/allocation.inline.hpp&quot;
  50 #include &quot;memory/oopFactory.hpp&quot;
  51 #include &quot;memory/resourceArea.hpp&quot;
  52 #include &quot;memory/universe.hpp&quot;
  53 #include &quot;oops/constantPool.inline.hpp&quot;
  54 #include &quot;oops/cpCache.inline.hpp&quot;
  55 #include &quot;oops/method.inline.hpp&quot;
  56 #include &quot;oops/methodData.hpp&quot;
  57 #include &quot;oops/objArrayKlass.hpp&quot;
  58 #include &quot;oops/objArrayOop.inline.hpp&quot;
  59 #include &quot;oops/oop.inline.hpp&quot;
  60 #include &quot;prims/jvmtiExport.hpp&quot;
  61 #include &quot;runtime/handles.inline.hpp&quot;
  62 #include &quot;runtime/init.hpp&quot;
  63 #include &quot;runtime/reflection.hpp&quot;
  64 #include &quot;runtime/jniHandles.inline.hpp&quot;
  65 #include &quot;runtime/safepointVerifiers.hpp&quot;
  66 #include &quot;runtime/sharedRuntime.hpp&quot;
  67 #include &quot;runtime/thread.inline.hpp&quot;
</pre>
<hr />
<pre>
1169 }
1170 
1171 // ------------------------------------------------------------------
1172 // ciEnv::num_inlined_bytecodes()
1173 int ciEnv::num_inlined_bytecodes() const {
1174   return _num_inlined_bytecodes;
1175 }
1176 
1177 // ------------------------------------------------------------------
1178 // ciEnv::record_failure()
1179 void ciEnv::record_failure(const char* reason) {
1180   if (_failure_reason == NULL) {
1181     // Record the first failure reason.
1182     _failure_reason = reason;
1183   }
1184 }
1185 
1186 void ciEnv::report_failure(const char* reason) {
1187   EventCompilationFailure event;
1188   if (event.should_commit()) {
<span class="line-modified">1189     event.set_compileId(compile_id());</span>
<span class="line-removed">1190     event.set_failureMessage(reason);</span>
<span class="line-removed">1191     event.commit();</span>
1192   }
1193 }
1194 
1195 // ------------------------------------------------------------------
1196 // ciEnv::record_method_not_compilable()
1197 void ciEnv::record_method_not_compilable(const char* reason, bool all_tiers) {
1198   int new_compilable =
1199     all_tiers ? MethodCompilable_never : MethodCompilable_not_at_tier ;
1200 
1201   // Only note transitions to a worse state
1202   if (new_compilable &gt; _compilable) {
1203     if (log() != NULL) {
1204       if (all_tiers) {
1205         log()-&gt;elem(&quot;method_not_compilable&quot;);
1206       } else {
1207         log()-&gt;elem(&quot;method_not_compilable_at_tier level=&#39;%d&#39;&quot;,
1208                     current()-&gt;task()-&gt;comp_level());
1209       }
1210     }
1211     _compilable = new_compilable;
</pre>
</td>
<td>
<hr />
<pre>
  23  */
  24 
  25 #include &quot;precompiled.hpp&quot;
  26 #include &quot;jvm.h&quot;
  27 #include &quot;ci/ciConstant.hpp&quot;
  28 #include &quot;ci/ciEnv.hpp&quot;
  29 #include &quot;ci/ciField.hpp&quot;
  30 #include &quot;ci/ciInstance.hpp&quot;
  31 #include &quot;ci/ciInstanceKlass.hpp&quot;
  32 #include &quot;ci/ciMethod.hpp&quot;
  33 #include &quot;ci/ciNullObject.hpp&quot;
  34 #include &quot;ci/ciReplay.hpp&quot;
  35 #include &quot;ci/ciUtilities.inline.hpp&quot;
  36 #include &quot;ci/ciValueKlass.hpp&quot;
  37 #include &quot;classfile/symbolTable.hpp&quot;
  38 #include &quot;classfile/systemDictionary.hpp&quot;
  39 #include &quot;classfile/vmSymbols.hpp&quot;
  40 #include &quot;code/codeCache.hpp&quot;
  41 #include &quot;code/scopeDesc.hpp&quot;
  42 #include &quot;compiler/compileBroker.hpp&quot;
<span class="line-added">  43 #include &quot;compiler/compilerEvent.hpp&quot;</span>
  44 #include &quot;compiler/compileLog.hpp&quot;
  45 #include &quot;compiler/disassembler.hpp&quot;
  46 #include &quot;gc/shared/collectedHeap.inline.hpp&quot;
  47 #include &quot;interpreter/linkResolver.hpp&quot;

  48 #include &quot;logging/log.hpp&quot;
  49 #include &quot;memory/allocation.inline.hpp&quot;
  50 #include &quot;memory/oopFactory.hpp&quot;
  51 #include &quot;memory/resourceArea.hpp&quot;
  52 #include &quot;memory/universe.hpp&quot;
  53 #include &quot;oops/constantPool.inline.hpp&quot;
  54 #include &quot;oops/cpCache.inline.hpp&quot;
  55 #include &quot;oops/method.inline.hpp&quot;
  56 #include &quot;oops/methodData.hpp&quot;
  57 #include &quot;oops/objArrayKlass.hpp&quot;
  58 #include &quot;oops/objArrayOop.inline.hpp&quot;
  59 #include &quot;oops/oop.inline.hpp&quot;
  60 #include &quot;prims/jvmtiExport.hpp&quot;
  61 #include &quot;runtime/handles.inline.hpp&quot;
  62 #include &quot;runtime/init.hpp&quot;
  63 #include &quot;runtime/reflection.hpp&quot;
  64 #include &quot;runtime/jniHandles.inline.hpp&quot;
  65 #include &quot;runtime/safepointVerifiers.hpp&quot;
  66 #include &quot;runtime/sharedRuntime.hpp&quot;
  67 #include &quot;runtime/thread.inline.hpp&quot;
</pre>
<hr />
<pre>
1169 }
1170 
1171 // ------------------------------------------------------------------
1172 // ciEnv::num_inlined_bytecodes()
1173 int ciEnv::num_inlined_bytecodes() const {
1174   return _num_inlined_bytecodes;
1175 }
1176 
1177 // ------------------------------------------------------------------
1178 // ciEnv::record_failure()
1179 void ciEnv::record_failure(const char* reason) {
1180   if (_failure_reason == NULL) {
1181     // Record the first failure reason.
1182     _failure_reason = reason;
1183   }
1184 }
1185 
1186 void ciEnv::report_failure(const char* reason) {
1187   EventCompilationFailure event;
1188   if (event.should_commit()) {
<span class="line-modified">1189     CompilerEvent::CompilationFailureEvent::post(event, compile_id(), reason);</span>


1190   }
1191 }
1192 
1193 // ------------------------------------------------------------------
1194 // ciEnv::record_method_not_compilable()
1195 void ciEnv::record_method_not_compilable(const char* reason, bool all_tiers) {
1196   int new_compilable =
1197     all_tiers ? MethodCompilable_never : MethodCompilable_not_at_tier ;
1198 
1199   // Only note transitions to a worse state
1200   if (new_compilable &gt; _compilable) {
1201     if (log() != NULL) {
1202       if (all_tiers) {
1203         log()-&gt;elem(&quot;method_not_compilable&quot;);
1204       } else {
1205         log()-&gt;elem(&quot;method_not_compilable_at_tier level=&#39;%d&#39;&quot;,
1206                     current()-&gt;task()-&gt;comp_level());
1207       }
1208     }
1209     _compilable = new_compilable;
</pre>
</td>
</tr>
</table>
<center><a href="../c1/c1_LinearScan.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../classfile/classFileParser.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>