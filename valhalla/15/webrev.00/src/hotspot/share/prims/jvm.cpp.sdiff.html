<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/prims/jvm.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="jni.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="jvmtiRedefineClasses.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/prims/jvm.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 453  *
 454  * It is important that this directory is well-known and the
 455  * same for all VM instances. It cannot be affected by configuration
 456  * variables such as java.io.tmpdir.
 457  */
 458 JVM_ENTRY(jstring, JVM_GetTemporaryDirectory(JNIEnv *env))
 459   JVMWrapper(&quot;JVM_GetTemporaryDirectory&quot;);
 460   HandleMark hm(THREAD);
 461   const char* temp_dir = os::get_temp_directory();
 462   Handle h = java_lang_String::create_from_platform_dependent_str(temp_dir, CHECK_NULL);
 463   return (jstring) JNIHandles::make_local(env, h());
 464 JVM_END
 465 
 466 
 467 // java.lang.Runtime /////////////////////////////////////////////////////////////////////////
 468 
 469 extern volatile jint vm_created;
 470 
 471 JVM_ENTRY_NO_ENV(void, JVM_BeforeHalt())
 472   JVMWrapper(&quot;JVM_BeforeHalt&quot;);




 473   EventShutdown event;
 474   if (event.should_commit()) {
 475     event.set_reason(&quot;Shutdown requested from Java&quot;);
 476     event.commit();
 477   }
 478 JVM_END
 479 
 480 
 481 JVM_ENTRY_NO_ENV(void, JVM_Halt(jint code))
 482   before_exit(thread);
 483   vm_exit(code);
 484 JVM_END
 485 
 486 
 487 JVM_ENTRY_NO_ENV(void, JVM_GC(void))
 488   JVMWrapper(&quot;JVM_GC&quot;);
 489   if (!DisableExplicitGC) {
 490     Universe::heap()-&gt;collect(GCCause::_java_lang_system_gc);
 491   }
 492 JVM_END
</pre>
<hr />
<pre>
 542 
 543 // java.lang.NullPointerException ///////////////////////////////////////////
 544 
 545 JVM_ENTRY(jstring, JVM_GetExtendedNPEMessage(JNIEnv *env, jthrowable throwable))
 546   if (!ShowCodeDetailsInExceptionMessages) return NULL;
 547 
 548   oop exc = JNIHandles::resolve_non_null(throwable);
 549 
 550   Method* method;
 551   int bci;
 552   if (!java_lang_Throwable::get_top_method_and_bci(exc, &amp;method, &amp;bci)) {
 553     return NULL;
 554   }
 555   if (method-&gt;is_native()) {
 556     return NULL;
 557   }
 558 
 559   stringStream ss;
 560   bool ok = BytecodeUtils::get_NPE_message_at(&amp;ss, method, bci);
 561   if (ok) {
<span class="line-modified"> 562     oop result = java_lang_String::create_oop_from_str(ss.base(), CHECK_0);</span>
 563     return (jstring) JNIHandles::make_local(env, result);
 564   } else {
 565     return NULL;
 566   }
 567 JVM_END
 568 
 569 // java.lang.StackTraceElement //////////////////////////////////////////////
 570 
 571 
 572 JVM_ENTRY(void, JVM_InitStackTraceElementArray(JNIEnv *env, jobjectArray elements, jobject throwable))
 573   JVMWrapper(&quot;JVM_InitStackTraceElementArray&quot;);
 574   Handle exception(THREAD, JNIHandles::resolve(throwable));
 575   objArrayOop st = objArrayOop(JNIHandles::resolve(elements));
 576   objArrayHandle stack_trace(THREAD, st);
 577   // Fill in the allocated stack trace
 578   java_lang_Throwable::get_stack_trace_elements(exception, stack_trace, CHECK);
 579 JVM_END
 580 
 581 
 582 JVM_ENTRY(void, JVM_InitStackTraceElement(JNIEnv* env, jobject element, jobject stackFrameInfo))
</pre>
</td>
<td>
<hr />
<pre>
 453  *
 454  * It is important that this directory is well-known and the
 455  * same for all VM instances. It cannot be affected by configuration
 456  * variables such as java.io.tmpdir.
 457  */
 458 JVM_ENTRY(jstring, JVM_GetTemporaryDirectory(JNIEnv *env))
 459   JVMWrapper(&quot;JVM_GetTemporaryDirectory&quot;);
 460   HandleMark hm(THREAD);
 461   const char* temp_dir = os::get_temp_directory();
 462   Handle h = java_lang_String::create_from_platform_dependent_str(temp_dir, CHECK_NULL);
 463   return (jstring) JNIHandles::make_local(env, h());
 464 JVM_END
 465 
 466 
 467 // java.lang.Runtime /////////////////////////////////////////////////////////////////////////
 468 
 469 extern volatile jint vm_created;
 470 
 471 JVM_ENTRY_NO_ENV(void, JVM_BeforeHalt())
 472   JVMWrapper(&quot;JVM_BeforeHalt&quot;);
<span class="line-added"> 473   // Link all classes for dynamic CDS dumping before vm exit.</span>
<span class="line-added"> 474   if (DynamicDumpSharedSpaces) {</span>
<span class="line-added"> 475     MetaspaceShared::link_and_cleanup_shared_classes(THREAD);</span>
<span class="line-added"> 476   }</span>
 477   EventShutdown event;
 478   if (event.should_commit()) {
 479     event.set_reason(&quot;Shutdown requested from Java&quot;);
 480     event.commit();
 481   }
 482 JVM_END
 483 
 484 
 485 JVM_ENTRY_NO_ENV(void, JVM_Halt(jint code))
 486   before_exit(thread);
 487   vm_exit(code);
 488 JVM_END
 489 
 490 
 491 JVM_ENTRY_NO_ENV(void, JVM_GC(void))
 492   JVMWrapper(&quot;JVM_GC&quot;);
 493   if (!DisableExplicitGC) {
 494     Universe::heap()-&gt;collect(GCCause::_java_lang_system_gc);
 495   }
 496 JVM_END
</pre>
<hr />
<pre>
 546 
 547 // java.lang.NullPointerException ///////////////////////////////////////////
 548 
 549 JVM_ENTRY(jstring, JVM_GetExtendedNPEMessage(JNIEnv *env, jthrowable throwable))
 550   if (!ShowCodeDetailsInExceptionMessages) return NULL;
 551 
 552   oop exc = JNIHandles::resolve_non_null(throwable);
 553 
 554   Method* method;
 555   int bci;
 556   if (!java_lang_Throwable::get_top_method_and_bci(exc, &amp;method, &amp;bci)) {
 557     return NULL;
 558   }
 559   if (method-&gt;is_native()) {
 560     return NULL;
 561   }
 562 
 563   stringStream ss;
 564   bool ok = BytecodeUtils::get_NPE_message_at(&amp;ss, method, bci);
 565   if (ok) {
<span class="line-modified"> 566     oop result = java_lang_String::create_oop_from_str(ss.base(), CHECK_NULL);</span>
 567     return (jstring) JNIHandles::make_local(env, result);
 568   } else {
 569     return NULL;
 570   }
 571 JVM_END
 572 
 573 // java.lang.StackTraceElement //////////////////////////////////////////////
 574 
 575 
 576 JVM_ENTRY(void, JVM_InitStackTraceElementArray(JNIEnv *env, jobjectArray elements, jobject throwable))
 577   JVMWrapper(&quot;JVM_InitStackTraceElementArray&quot;);
 578   Handle exception(THREAD, JNIHandles::resolve(throwable));
 579   objArrayOop st = objArrayOop(JNIHandles::resolve(elements));
 580   objArrayHandle stack_trace(THREAD, st);
 581   // Fill in the allocated stack trace
 582   java_lang_Throwable::get_stack_trace_elements(exception, stack_trace, CHECK);
 583 JVM_END
 584 
 585 
 586 JVM_ENTRY(void, JVM_InitStackTraceElement(JNIEnv* env, jobject element, jobject stackFrameInfo))
</pre>
</td>
</tr>
</table>
<center><a href="jni.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="jvmtiRedefineClasses.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>