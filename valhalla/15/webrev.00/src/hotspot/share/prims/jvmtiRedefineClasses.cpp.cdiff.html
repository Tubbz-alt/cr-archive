<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/prims/jvmtiRedefineClasses.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="jvm.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="nativeLookup.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/prims/jvmtiRedefineClasses.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1479,23 ***</span>
  
        case JVM_CONSTANT_Double:
        case JVM_CONSTANT_Long:
          // just copy the entry to *merge_cp_p, but double and long take
          // two constant pool entries
<span class="line-modified">!         ConstantPool::copy_entry_to(old_cp, old_i, *merge_cp_p, old_i, CHECK_0);</span>
          old_i++;
          break;
  
        default:
          // just copy the entry to *merge_cp_p
<span class="line-modified">!         ConstantPool::copy_entry_to(old_cp, old_i, *merge_cp_p, old_i, CHECK_0);</span>
          break;
        }
      } // end for each old_cp entry
  
<span class="line-modified">!     ConstantPool::copy_operands(old_cp, *merge_cp_p, CHECK_0);</span>
<span class="line-modified">!     (*merge_cp_p)-&gt;extend_operands(scratch_cp, CHECK_0);</span>
  
      // We don&#39;t need to sanity check that *merge_cp_length_p is within
      // *merge_cp_p bounds since we have the minimum on-entry check above.
      (*merge_cp_length_p) = old_i;
    }
<span class="line-new-header">--- 1479,23 ---</span>
  
        case JVM_CONSTANT_Double:
        case JVM_CONSTANT_Long:
          // just copy the entry to *merge_cp_p, but double and long take
          // two constant pool entries
<span class="line-modified">!         ConstantPool::copy_entry_to(old_cp, old_i, *merge_cp_p, old_i, CHECK_false);</span>
          old_i++;
          break;
  
        default:
          // just copy the entry to *merge_cp_p
<span class="line-modified">!         ConstantPool::copy_entry_to(old_cp, old_i, *merge_cp_p, old_i, CHECK_false);</span>
          break;
        }
      } // end for each old_cp entry
  
<span class="line-modified">!     ConstantPool::copy_operands(old_cp, *merge_cp_p, CHECK_false);</span>
<span class="line-modified">!     (*merge_cp_p)-&gt;extend_operands(scratch_cp, CHECK_false);</span>
  
      // We don&#39;t need to sanity check that *merge_cp_length_p is within
      // *merge_cp_p bounds since we have the minimum on-entry check above.
      (*merge_cp_length_p) = old_i;
    }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1525,11 ***</span>
          increment = 1;
          break;
        }
  
        bool match = scratch_cp-&gt;compare_entry_to(scratch_i, *merge_cp_p,
<span class="line-modified">!         scratch_i, CHECK_0);</span>
        if (match) {
          // found a match at the same index so nothing more to do
          continue;
        } else if (is_unresolved_class_mismatch(scratch_cp, scratch_i,
                                                *merge_cp_p, scratch_i)) {
<span class="line-new-header">--- 1525,11 ---</span>
          increment = 1;
          break;
        }
  
        bool match = scratch_cp-&gt;compare_entry_to(scratch_i, *merge_cp_p,
<span class="line-modified">!         scratch_i, CHECK_false);</span>
        if (match) {
          // found a match at the same index so nothing more to do
          continue;
        } else if (is_unresolved_class_mismatch(scratch_cp, scratch_i,
                                                *merge_cp_p, scratch_i)) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1540,11 ***</span>
          // we go with the unresolved class entry.
          continue;
        }
  
        int found_i = scratch_cp-&gt;find_matching_entry(scratch_i, *merge_cp_p,
<span class="line-modified">!         CHECK_0);</span>
        if (found_i != 0) {
          guarantee(found_i != scratch_i,
            &quot;compare_entry_to() and find_matching_entry() do not agree&quot;);
  
          // Found a matching entry somewhere else in *merge_cp_p so
<span class="line-new-header">--- 1540,11 ---</span>
          // we go with the unresolved class entry.
          continue;
        }
  
        int found_i = scratch_cp-&gt;find_matching_entry(scratch_i, *merge_cp_p,
<span class="line-modified">!         CHECK_false);</span>
        if (found_i != 0) {
          guarantee(found_i != scratch_i,
            &quot;compare_entry_to() and find_matching_entry() do not agree&quot;);
  
          // Found a matching entry somewhere else in *merge_cp_p so
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1561,11 ***</span>
        // worth the time.
  
        // No match found so we have to append this entry and any unique
        // referenced entries to *merge_cp_p.
        append_entry(scratch_cp, scratch_i, merge_cp_p, merge_cp_length_p,
<span class="line-modified">!         CHECK_0);</span>
      }
    }
  
    log_debug(redefine, class, constantpool)
      (&quot;after pass 1a: merge_cp_len=%d, scratch_i=%d, index_map_len=%d&quot;,
<span class="line-new-header">--- 1561,11 ---</span>
        // worth the time.
  
        // No match found so we have to append this entry and any unique
        // referenced entries to *merge_cp_p.
        append_entry(scratch_cp, scratch_i, merge_cp_p, merge_cp_length_p,
<span class="line-modified">!         CHECK_false);</span>
      }
    }
  
    log_debug(redefine, class, constantpool)
      (&quot;after pass 1a: merge_cp_len=%d, scratch_i=%d, index_map_len=%d&quot;,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1589,22 ***</span>
          increment = 1;
          break;
        }
  
        int found_i =
<span class="line-modified">!         scratch_cp-&gt;find_matching_entry(scratch_i, *merge_cp_p, CHECK_0);</span>
        if (found_i != 0) {
          // Found a matching entry somewhere else in *merge_cp_p so
          // just need a mapping entry.
          map_index(scratch_cp, scratch_i, found_i);
          continue;
        }
  
        // No match found so we have to append this entry and any unique
        // referenced entries to *merge_cp_p.
        append_entry(scratch_cp, scratch_i, merge_cp_p, merge_cp_length_p,
<span class="line-modified">!         CHECK_0);</span>
      }
  
      log_debug(redefine, class, constantpool)
        (&quot;after pass 1b: merge_cp_len=%d, scratch_i=%d, index_map_len=%d&quot;,
         *merge_cp_length_p, scratch_i, _index_map_count);
<span class="line-new-header">--- 1589,22 ---</span>
          increment = 1;
          break;
        }
  
        int found_i =
<span class="line-modified">!         scratch_cp-&gt;find_matching_entry(scratch_i, *merge_cp_p, CHECK_false);</span>
        if (found_i != 0) {
          // Found a matching entry somewhere else in *merge_cp_p so
          // just need a mapping entry.
          map_index(scratch_cp, scratch_i, found_i);
          continue;
        }
  
        // No match found so we have to append this entry and any unique
        // referenced entries to *merge_cp_p.
        append_entry(scratch_cp, scratch_i, merge_cp_p, merge_cp_length_p,
<span class="line-modified">!         CHECK_false);</span>
      }
  
      log_debug(redefine, class, constantpool)
        (&quot;after pass 1b: merge_cp_len=%d, scratch_i=%d, index_map_len=%d&quot;,
         *merge_cp_length_p, scratch_i, _index_map_count);
</pre>
<center><a href="jvm.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="nativeLookup.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>