<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jfr/recorder/service/jfrRecorderService.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../checkpoint/types/jfrTypeSet.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../storage/jfrStorage.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/recorder/service/jfrRecorderService.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
606   if (!buffer-&gt;empty()) {
607     chunkwriter.write_unbuffered(buffer-&gt;top(), buffer-&gt;pos() - buffer-&gt;top());
608     reset_buffer(buffer, t);
609   }
610 }
611 
612 size_t JfrRecorderService::flush() {
613   assert(JfrStream_lock-&gt;owned_by_self(), &quot;invariant&quot;);
614   size_t total_elements = flush_metadata(_chunkwriter);
615   const size_t storage_elements = flush_storage(_storage, _chunkwriter);
616   if (0 == storage_elements) {
617     return total_elements;
618   }
619   total_elements += storage_elements;
620   if (_string_pool.is_modified()) {
621     total_elements += flush_stringpool(_string_pool, _chunkwriter);
622   }
623   if (_stack_trace_repository.is_modified()) {
624     total_elements += flush_stacktrace(_stack_trace_repository, _chunkwriter);
625   }
<span class="line-modified">626   if (_checkpoint_manager.is_type_set_required()) {</span>
<span class="line-removed">627     total_elements += flush_typeset(_checkpoint_manager, _chunkwriter);</span>
<span class="line-removed">628   } else if (_checkpoint_manager.is_static_type_set_required()) {</span>
<span class="line-removed">629     // don&#39;t tally this, it is only in order to flush the waiting constants</span>
<span class="line-removed">630     _checkpoint_manager.flush_static_type_set();</span>
<span class="line-removed">631   }</span>
<span class="line-removed">632   return total_elements;</span>
633 }
634 
635 typedef Content&lt;JfrRecorderService, &amp;JfrRecorderService::flush&gt; FlushFunctor;
636 typedef WriteContent&lt;FlushFunctor&gt; Flush;
637 
638 void JfrRecorderService::invoke_flush() {
639   assert(JfrStream_lock-&gt;owned_by_self(), &quot;invariant&quot;);
640   assert(_chunkwriter.is_valid(), &quot;invariant&quot;);
641   Thread* const t = Thread::current();
642   ResourceMark rm(t);
643   HandleMark hm(t);
644   ++flushpoint_id;
645   reset_thread_local_buffer(t);
646   FlushFunctor flushpoint(*this);
647   Flush fl(_chunkwriter, flushpoint);
648   invoke_with_flush_event(fl);
649   write_thread_local_buffer(_chunkwriter, t);
650   _repository.flush_chunk();
651 }
652 
</pre>
</td>
<td>
<hr />
<pre>
606   if (!buffer-&gt;empty()) {
607     chunkwriter.write_unbuffered(buffer-&gt;top(), buffer-&gt;pos() - buffer-&gt;top());
608     reset_buffer(buffer, t);
609   }
610 }
611 
612 size_t JfrRecorderService::flush() {
613   assert(JfrStream_lock-&gt;owned_by_self(), &quot;invariant&quot;);
614   size_t total_elements = flush_metadata(_chunkwriter);
615   const size_t storage_elements = flush_storage(_storage, _chunkwriter);
616   if (0 == storage_elements) {
617     return total_elements;
618   }
619   total_elements += storage_elements;
620   if (_string_pool.is_modified()) {
621     total_elements += flush_stringpool(_string_pool, _chunkwriter);
622   }
623   if (_stack_trace_repository.is_modified()) {
624     total_elements += flush_stacktrace(_stack_trace_repository, _chunkwriter);
625   }
<span class="line-modified">626   return flush_typeset(_checkpoint_manager, _chunkwriter) + total_elements;</span>






627 }
628 
629 typedef Content&lt;JfrRecorderService, &amp;JfrRecorderService::flush&gt; FlushFunctor;
630 typedef WriteContent&lt;FlushFunctor&gt; Flush;
631 
632 void JfrRecorderService::invoke_flush() {
633   assert(JfrStream_lock-&gt;owned_by_self(), &quot;invariant&quot;);
634   assert(_chunkwriter.is_valid(), &quot;invariant&quot;);
635   Thread* const t = Thread::current();
636   ResourceMark rm(t);
637   HandleMark hm(t);
638   ++flushpoint_id;
639   reset_thread_local_buffer(t);
640   FlushFunctor flushpoint(*this);
641   Flush fl(_chunkwriter, flushpoint);
642   invoke_with_flush_event(fl);
643   write_thread_local_buffer(_chunkwriter, t);
644   _repository.flush_chunk();
645 }
646 
</pre>
</td>
</tr>
</table>
<center><a href="../checkpoint/types/jfrTypeSet.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../storage/jfrStorage.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>