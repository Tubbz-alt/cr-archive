<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/runtime/vmStructs.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="vmOperations.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vmStructs.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/vmStructs.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  89 #include &quot;runtime/java.hpp&quot;
  90 #include &quot;runtime/javaCalls.hpp&quot;
  91 #include &quot;runtime/notificationThread.hpp&quot;
  92 #include &quot;runtime/os.hpp&quot;
  93 #include &quot;runtime/perfMemory.hpp&quot;
  94 #include &quot;runtime/serviceThread.hpp&quot;
  95 #include &quot;runtime/sharedRuntime.hpp&quot;
  96 #include &quot;runtime/stubRoutines.hpp&quot;
  97 #include &quot;runtime/thread.inline.hpp&quot;
  98 #include &quot;runtime/threadSMR.hpp&quot;
  99 #include &quot;runtime/vframeArray.hpp&quot;
 100 #include &quot;runtime/vmStructs.hpp&quot;
 101 #include &quot;utilities/globalDefinitions.hpp&quot;
 102 #include &quot;utilities/hashtable.hpp&quot;
 103 #include &quot;utilities/macros.hpp&quot;
 104 
 105 #include CPU_HEADER(vmStructs)
 106 #include OS_HEADER(vmStructs)
 107 #include OS_CPU_HEADER(vmStructs)
 108 
<span class="line-removed"> 109 #if INCLUDE_JVMCI</span>
<span class="line-removed"> 110 # include &quot;jvmci/vmStructs_jvmci.hpp&quot;</span>
<span class="line-removed"> 111 #endif</span>
<span class="line-removed"> 112 </span>
<span class="line-removed"> 113 </span>
 114 #ifdef COMPILER2
 115 #include &quot;opto/addnode.hpp&quot;
 116 #include &quot;opto/block.hpp&quot;
 117 #include &quot;opto/callnode.hpp&quot;
 118 #include &quot;opto/castnode.hpp&quot;
 119 #include &quot;opto/cfgnode.hpp&quot;
 120 #include &quot;opto/chaitin.hpp&quot;
 121 #include &quot;opto/convertnode.hpp&quot;
 122 #include &quot;opto/divnode.hpp&quot;
 123 #include &quot;opto/intrinsicnode.hpp&quot;
 124 #include &quot;opto/locknode.hpp&quot;
 125 #include &quot;opto/loopnode.hpp&quot;
 126 #include &quot;opto/machnode.hpp&quot;
 127 #include &quot;opto/matcher.hpp&quot;
 128 #include &quot;opto/mathexactnode.hpp&quot;
 129 #include &quot;opto/movenode.hpp&quot;
 130 #include &quot;opto/mulnode.hpp&quot;
 131 #include &quot;opto/narrowptrnode.hpp&quot;
 132 #include &quot;opto/opaquenode.hpp&quot;
 133 #include &quot;opto/optoreg.hpp&quot;
</pre>
<hr />
<pre>
 505   nonstatic_field(BasicHashtableEntry&lt;mtInternal&gt;, _hash,                                     unsigned int)                          \
 506   nonstatic_field(IntptrHashtableEntry,            _literal,                                  intptr_t)                              \
 507                                                                                                                                      \
 508   /*************/                                                                                                                    \
 509   /* Hashtable */                                                                                                                    \
 510   /*************/                                                                                                                    \
 511                                                                                                                                      \
 512   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _table_size,                                   int)                                   \
 513   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _buckets,                                      HashtableBucket&lt;mtInternal&gt;*)          \
 514   volatile_nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _free_list,                           BasicHashtableEntry&lt;mtInternal&gt;*)      \
 515   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _first_free_entry,                             char*)                                 \
 516   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _end_block,                                    char*)                                 \
 517   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _entry_size,                                   int)                                   \
 518                                                                                                                                      \
 519   /*******************/                                                                                                              \
 520   /* ClassLoaderData */                                                                                                              \
 521   /*******************/                                                                                                              \
 522   nonstatic_field(ClassLoaderData,             _class_loader,                                 OopHandle)                             \
 523   nonstatic_field(ClassLoaderData,             _next,                                         ClassLoaderData*)                      \
 524   volatile_nonstatic_field(ClassLoaderData,    _klasses,                                      Klass*)                                \
<span class="line-removed"> 525   nonstatic_field(ClassLoaderData,             _is_unsafe_anonymous,                          bool)                                  \</span>
 526   volatile_nonstatic_field(ClassLoaderData,    _dictionary,                                   Dictionary*)                           \
 527                                                                                                                                      \
 528   static_ptr_volatile_field(ClassLoaderDataGraph, _head,                                      ClassLoaderData*)                      \
 529                                                                                                                                      \
 530   /**********/                                                                                                                       \
 531   /* Arrays */                                                                                                                       \
 532   /**********/                                                                                                                       \
 533                                                                                                                                      \
 534   nonstatic_field(Array&lt;Klass*&gt;,               _length,                                       int)                                   \
 535   nonstatic_field(Array&lt;Klass*&gt;,               _data[0],                                      Klass*)                                \
 536                                                                                                                                      \
 537   /*******************/                                                                                                              \
 538   /* GrowableArrays  */                                                                                                              \
 539   /*******************/                                                                                                              \
 540                                                                                                                                      \
 541   nonstatic_field(GenericGrowableArray,        _len,                                          int)                                   \
 542   nonstatic_field(GenericGrowableArray,        _max,                                          int)                                   \
 543   nonstatic_field(GenericGrowableArray,        _arena,                                        Arena*)                                \
 544   nonstatic_field(GrowableArray&lt;int&gt;,          _data,                                         int*)                                  \
 545                                                                                                                                      \
</pre>
<hr />
<pre>
 774   volatile_nonstatic_field(JavaThread,         _is_method_handle_return,                      int)                                   \
 775   nonstatic_field(JavaThread,                  _special_runtime_exit_condition,               JavaThread::AsyncRequests)             \
 776   nonstatic_field(JavaThread,                  _saved_exception_pc,                           address)                               \
 777   volatile_nonstatic_field(JavaThread,         _thread_state,                                 JavaThreadState)                       \
 778   nonstatic_field(JavaThread,                  _osthread,                                     OSThread*)                             \
 779   nonstatic_field(JavaThread,                  _stack_base,                                   address)                               \
 780   nonstatic_field(JavaThread,                  _stack_size,                                   size_t)                                \
 781   nonstatic_field(JavaThread,                  _vframe_array_head,                            vframeArray*)                          \
 782   nonstatic_field(JavaThread,                  _vframe_array_last,                            vframeArray*)                          \
 783   volatile_nonstatic_field(JavaThread,         _terminated,                                   JavaThread::TerminatedTypes)           \
 784   nonstatic_field(Thread,                      _resource_area,                                ResourceArea*)                         \
 785   nonstatic_field(CompilerThread,              _env,                                          ciEnv*)                                \
 786                                                                                                                                      \
 787   /************/                                                                                                                     \
 788   /* OSThread */                                                                                                                     \
 789   /************/                                                                                                                     \
 790                                                                                                                                      \
 791   volatile_nonstatic_field(OSThread,           _state,                                        ThreadState)                           \
 792                                                                                                                                      \
 793   /************************/                                                                                                         \
<span class="line-modified"> 794   /* OopMap and OopMapSet */                                                                                                         \</span>
 795   /************************/                                                                                                         \
 796                                                                                                                                      \
<span class="line-removed"> 797   nonstatic_field(OopMap,                      _pc_offset,                                    int)                                   \</span>
<span class="line-removed"> 798   nonstatic_field(OopMap,                      _omv_count,                                    int)                                   \</span>
<span class="line-removed"> 799   nonstatic_field(OopMap,                      _write_stream,                                 CompressedWriteStream*)                \</span>
<span class="line-removed"> 800   nonstatic_field(OopMapSet,                   _om_count,                                     int)                                   \</span>
<span class="line-removed"> 801   nonstatic_field(OopMapSet,                   _om_size,                                      int)                                   \</span>
<span class="line-removed"> 802   nonstatic_field(OopMapSet,                   _om_data,                                      OopMap**)                              \</span>
<span class="line-removed"> 803                                                                                                                                      \</span>
 804   nonstatic_field(ImmutableOopMapSet,          _count,                                        int)                                   \
 805   nonstatic_field(ImmutableOopMapSet,          _size,                                         int)                                   \
 806                                                                                                                                      \
 807   nonstatic_field(ImmutableOopMapPair,         _pc_offset,                                    int)                                   \
 808   nonstatic_field(ImmutableOopMapPair,         _oopmap_offset,                                int)                                   \
 809                                                                                                                                      \
 810   nonstatic_field(ImmutableOopMap,             _count,                                        int)                                   \
 811                                                                                                                                      \
 812   /*********************************/                                                                                                \
 813   /* JNIHandles and JNIHandleBlock */                                                                                                \
 814   /*********************************/                                                                                                \
 815   static_field(JNIHandles,                     _global_handles,                               OopStorage*)                           \
 816   static_field(JNIHandles,                     _weak_global_handles,                          OopStorage*)                           \
 817   unchecked_nonstatic_field(JNIHandleBlock,    _handles,       JNIHandleBlock::block_size_in_oops * sizeof(Oop)) /* Note: no type */ \
 818   nonstatic_field(JNIHandleBlock,              _top,                                          int)                                   \
 819   nonstatic_field(JNIHandleBlock,              _next,                                         JNIHandleBlock*)                       \
 820                                                                                                                                      \
 821   /********************/                                                                                                             \
 822   /* CompressedStream */                                                                                                             \
 823   /********************/                                                                                                             \
</pre>
<hr />
<pre>
1432   declare_type(RuntimeStub,              RuntimeBlob)                     \
1433   declare_type(SingletonBlob,            RuntimeBlob)                     \
1434   declare_type(SafepointBlob,            SingletonBlob)                   \
1435   declare_type(DeoptimizationBlob,       SingletonBlob)                   \
1436   declare_c2_type(ExceptionBlob,         SingletonBlob)                   \
1437   declare_c2_type(UncommonTrapBlob,      RuntimeBlob)                     \
1438                                                                           \
1439   /***************************************/                               \
1440   /* PcDesc and other compiled code info */                               \
1441   /***************************************/                               \
1442                                                                           \
1443   declare_toplevel_type(PcDesc)                                           \
1444   declare_toplevel_type(ExceptionCache)                                   \
1445   declare_toplevel_type(PcDescCache)                                      \
1446   declare_toplevel_type(Dependencies)                                     \
1447   declare_toplevel_type(CompileTask)                                      \
1448   declare_toplevel_type(Deoptimization)                                   \
1449   declare_toplevel_type(Deoptimization::UnrollBlock)                      \
1450                                                                           \
1451   /************************/                                              \
<span class="line-modified">1452   /* OopMap and OopMapSet */                                              \</span>
1453   /************************/                                              \
1454                                                                           \
<span class="line-removed">1455   declare_toplevel_type(OopMap)                                           \</span>
<span class="line-removed">1456   declare_toplevel_type(OopMapSet)                                        \</span>
1457   declare_toplevel_type(ImmutableOopMapSet)                               \
1458   declare_toplevel_type(ImmutableOopMapPair)                              \
1459   declare_toplevel_type(ImmutableOopMap)                                  \
1460                                                                           \
1461   /********************/                                                  \
1462   /* CompressedStream */                                                  \
1463   /********************/                                                  \
1464                                                                           \
1465   declare_toplevel_type(CompressedStream)                                 \
1466                                                                           \
1467   /**************/                                                        \
1468   /* VMRegImpl  */                                                        \
1469   /**************/                                                        \
1470                                                                           \
1471   declare_toplevel_type(VMRegImpl)                                        \
1472                                                                           \
1473   /*********************************/                                     \
1474   /* JNIHandles and JNIHandleBlock */                                     \
1475   /*********************************/                                     \
1476                                                                           \
</pre>
<hr />
<pre>
1816   declare_c2_type(FmaVFNode, VectorNode)                                  \
1817   declare_c2_type(CMoveVFNode, VectorNode)                                \
1818   declare_c2_type(CMoveVDNode, VectorNode)                                \
1819   declare_c2_type(MulReductionVDNode, ReductionNode)                      \
1820   declare_c2_type(DivVFNode, VectorNode)                                  \
1821   declare_c2_type(DivVDNode, VectorNode)                                  \
1822   declare_c2_type(PopCountVINode, VectorNode)                             \
1823   declare_c2_type(LShiftVBNode, VectorNode)                               \
1824   declare_c2_type(LShiftVSNode, VectorNode)                               \
1825   declare_c2_type(LShiftVINode, VectorNode)                               \
1826   declare_c2_type(LShiftVLNode, VectorNode)                               \
1827   declare_c2_type(RShiftVBNode, VectorNode)                               \
1828   declare_c2_type(RShiftVSNode, VectorNode)                               \
1829   declare_c2_type(RShiftVINode, VectorNode)                               \
1830   declare_c2_type(RShiftVLNode, VectorNode)                               \
1831   declare_c2_type(URShiftVBNode, VectorNode)                              \
1832   declare_c2_type(URShiftVSNode, VectorNode)                              \
1833   declare_c2_type(URShiftVINode, VectorNode)                              \
1834   declare_c2_type(URShiftVLNode, VectorNode)                              \
1835   declare_c2_type(AndVNode, VectorNode)                                   \

1836   declare_c2_type(OrVNode, VectorNode)                                    \

1837   declare_c2_type(XorVNode, VectorNode)                                   \

1838   declare_c2_type(MaxVNode, VectorNode)                                   \
1839   declare_c2_type(MinVNode, VectorNode)                                   \
1840   declare_c2_type(MaxReductionVNode, ReductionNode)                       \
1841   declare_c2_type(MinReductionVNode, ReductionNode)                       \
1842   declare_c2_type(LoadVectorNode, LoadNode)                               \
1843   declare_c2_type(StoreVectorNode, StoreNode)                             \
1844   declare_c2_type(ReplicateBNode, VectorNode)                             \
1845   declare_c2_type(ReplicateSNode, VectorNode)                             \
1846   declare_c2_type(ReplicateINode, VectorNode)                             \
1847   declare_c2_type(ReplicateLNode, VectorNode)                             \
1848   declare_c2_type(ReplicateFNode, VectorNode)                             \
1849   declare_c2_type(ReplicateDNode, VectorNode)                             \
1850   declare_c2_type(PackNode, VectorNode)                                   \
1851   declare_c2_type(PackBNode, PackNode)                                    \
1852   declare_c2_type(PackSNode, PackNode)                                    \
1853   declare_c2_type(PackINode, PackNode)                                    \
1854   declare_c2_type(PackLNode, PackNode)                                    \
1855   declare_c2_type(PackFNode, PackNode)                                    \
1856   declare_c2_type(PackDNode, PackNode)                                    \
1857   declare_c2_type(Pack2LNode, PackNode)                                   \
</pre>
<hr />
<pre>
1980   declare_toplevel_type(JavaThread *const *const)                         \
1981   declare_toplevel_type(java_lang_Class)                                  \
1982   declare_integer_type(JavaThread::AsyncRequests)                         \
1983   declare_integer_type(JavaThread::TerminatedTypes)                       \
1984   declare_toplevel_type(jbyte*)                                           \
1985   declare_toplevel_type(jbyte**)                                          \
1986   declare_toplevel_type(jint*)                                            \
1987   declare_toplevel_type(jniIdMapBase*)                                    \
1988   declare_unsigned_integer_type(juint)                                    \
1989   declare_unsigned_integer_type(julong)                                   \
1990   declare_toplevel_type(JNIHandleBlock*)                                  \
1991   declare_toplevel_type(JNIid)                                            \
1992   declare_toplevel_type(JNIid*)                                           \
1993   declare_toplevel_type(jmethodID*)                                       \
1994   declare_toplevel_type(Mutex*)                                           \
1995   declare_toplevel_type(nmethod*)                                         \
1996   COMPILER2_PRESENT(declare_unsigned_integer_type(node_idx_t))            \
1997   declare_toplevel_type(ObjectMonitor*)                                   \
1998   declare_toplevel_type(PaddedObjectMonitor*)                             \
1999   declare_toplevel_type(oop*)                                             \
<span class="line-removed">2000   declare_toplevel_type(OopMap**)                                         \</span>
2001   declare_toplevel_type(OopMapCache*)                                     \
<span class="line-removed">2002   declare_toplevel_type(OopMapSet*)                                       \</span>
2003   declare_toplevel_type(VMReg)                                            \
2004   declare_toplevel_type(OSThread*)                                        \
2005    declare_integer_type(ReferenceType)                                    \
2006   declare_toplevel_type(StubQueue*)                                       \
2007   declare_toplevel_type(Thread*)                                          \
2008   declare_toplevel_type(Universe)                                         \
2009   declare_toplevel_type(CompressedOops)                                   \
2010   declare_toplevel_type(CompressedKlassPointers)                          \
2011   declare_toplevel_type(os)                                               \
2012   declare_toplevel_type(vframeArray)                                      \
2013   declare_toplevel_type(vframeArrayElement)                               \
2014   declare_toplevel_type(Annotations*)                                     \
2015   declare_type(OopMapValue, StackObj)                                     \
2016   declare_type(FileMapInfo, CHeapObj&lt;mtInternal&gt;)                         \
2017   declare_toplevel_type(FileMapHeader)                                    \
2018   declare_toplevel_type(CDSFileMapRegion)                                 \
2019                                                                           \
2020   /************/                                                          \
2021   /* GC types */                                                          \
2022   /************/                                                          \
</pre>
<hr />
<pre>
2677   declare_constant(markWord::biased_lock_pattern)                         \
2678                                                                           \
2679   declare_constant(markWord::no_hash)                                     \
2680   declare_constant(markWord::no_hash_in_place)                            \
2681   declare_constant(markWord::no_lock_in_place)                            \
2682   declare_constant(markWord::max_age)                                     \
2683                                                                           \
2684   /* InvocationCounter constants */                                       \
2685   declare_constant(InvocationCounter::count_increment)                    \
2686   declare_constant(InvocationCounter::count_shift)
2687 
2688 
2689 //--------------------------------------------------------------------------------
2690 //
2691 
2692 // Generate and check a nonstatic field in non-product builds
2693 #ifndef PRODUCT
2694 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2695 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2696 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
<span class="line-removed">2697 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)</span>
<span class="line-removed">2698 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)</span>
<span class="line-removed">2699 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)</span>
2700 #else
2701 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2702 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2703 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)
<span class="line-removed">2704 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)</span>
<span class="line-removed">2705 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)</span>
<span class="line-removed">2706 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)</span>
2707 #endif /* PRODUCT */
2708 
2709 // Generate and check a nonstatic field in C1 builds
2710 #ifdef COMPILER1
2711 # define GENERATE_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2712 # define CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2713 # define ENSURE_C1_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
2714 #else
2715 # define GENERATE_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2716 # define CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2717 # define ENSURE_C1_FIELD_TYPE_PRESENT(a, b, c)
2718 #endif /* COMPILER1 */
2719 // Generate and check a nonstatic field in C2 builds
2720 #ifdef COMPILER2
2721 # define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2722 # define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2723 # define ENSURE_C2_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
2724 #else
2725 # define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2726 # define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
</pre>
<hr />
<pre>
2958 
2959   VM_LONG_CONSTANTS_CPU(GENERATE_VM_LONG_CONSTANT_ENTRY,
2960                         GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
2961                         GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
2962                         GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
2963                         GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
2964 
2965   VM_LONG_CONSTANTS_OS_CPU(GENERATE_VM_LONG_CONSTANT_ENTRY,
2966                            GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
2967                            GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
2968                            GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
2969                            GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
2970 
2971   GENERATE_VM_LONG_CONSTANT_LAST_ENTRY()
2972 };
2973 
2974 size_t VMStructs::localHotSpotVMLongConstantsLength() {
2975   return sizeof(localHotSpotVMLongConstants) / sizeof(VMLongConstantEntry);
2976 }
2977 
<span class="line-modified">2978 // This is used both to check the types of referenced fields and, in</span>
<span class="line-modified">2979 // debug builds, to ensure that all of the field types are present.</span>
<span class="line-modified">2980 void</span>
<span class="line-modified">2981 VMStructs::init() {</span>

































2982   VM_STRUCTS(CHECK_NONSTATIC_VM_STRUCT_ENTRY,
2983              CHECK_STATIC_VM_STRUCT_ENTRY,
2984              CHECK_STATIC_PTR_VOLATILE_VM_STRUCT_ENTRY,
2985              CHECK_NO_OP,
2986              CHECK_VOLATILE_NONSTATIC_VM_STRUCT_ENTRY,
2987              CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
2988              CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY,
2989              CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY,
2990              CHECK_NO_OP,
2991              CHECK_NO_OP);
2992 
2993 
2994   VM_STRUCTS_CPU(CHECK_NONSTATIC_VM_STRUCT_ENTRY,
2995                  CHECK_STATIC_VM_STRUCT_ENTRY,
2996                  CHECK_NO_OP,
2997                  CHECK_VOLATILE_NONSTATIC_VM_STRUCT_ENTRY,
2998                  CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
2999                  CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY,
3000                  CHECK_NO_OP,
3001                  CHECK_NO_OP);
</pre>
<hr />
<pre>
3037                   CHECK_C2_VM_TYPE_ENTRY,
3038                   CHECK_C2_TOPLEVEL_VM_TYPE_ENTRY);
3039 
3040   //
3041   // Split VM_STRUCTS() invocation into two parts to allow MS VC++ 6.0
3042   // to build with the source mounted over SNC3.2. Symptom was that
3043   // debug build failed with an internal compiler error. Has been seen
3044   // mounting sources from Solaris 2.6 and 2.7 hosts, but so far not
3045   // 2.8 hosts. Appears to occur because line is too long.
3046   //
3047   // If an assertion failure is triggered here it means that an entry
3048   // in VMStructs::localHotSpotVMStructs[] was not found in
3049   // VMStructs::localHotSpotVMTypes[]. (The assertion itself had to be
3050   // made less descriptive because of this above bug -- see the
3051   // definition of ENSURE_FIELD_TYPE_PRESENT.)
3052   //
3053   // NOTE: taken out because this was just not working on everyone&#39;s
3054   // Solstice NFS setup. If everyone switches to local workspaces on
3055   // Win32, we can put this back in.
3056 #ifndef _WINDOWS
<span class="line-modified">3057   debug_only(VM_STRUCTS(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3058                         CHECK_NO_OP,</span>
<span class="line-modified">3059                         CHECK_NO_OP,</span>
<span class="line-modified">3060                         CHECK_NO_OP,</span>
<span class="line-modified">3061                         CHECK_NO_OP,</span>
<span class="line-modified">3062                         CHECK_NO_OP,</span>
<span class="line-modified">3063                         CHECK_NO_OP,</span>
<span class="line-modified">3064                         CHECK_NO_OP,</span>
<span class="line-modified">3065                         CHECK_NO_OP,</span>
<span class="line-modified">3066                         CHECK_NO_OP));</span>
<span class="line-removed">3067   debug_only(VM_STRUCTS(CHECK_NO_OP,</span>
<span class="line-removed">3068                         ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3069                         ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3070                         CHECK_NO_OP,</span>
<span class="line-removed">3071                         ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3072                         ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3073                         ENSURE_C1_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3074                         ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3075                         CHECK_NO_OP,</span>
<span class="line-removed">3076                         CHECK_NO_OP));</span>
<span class="line-removed">3077 </span>
<span class="line-removed">3078   debug_only(VM_STRUCTS_CPU(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3079                             ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3080                             CHECK_NO_OP,</span>
<span class="line-removed">3081                             ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3082                             ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3083                             ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3084                             CHECK_NO_OP,</span>
<span class="line-removed">3085                             CHECK_NO_OP));</span>
<span class="line-removed">3086   debug_only(VM_STRUCTS_OS_CPU(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3087                                ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3088                                CHECK_NO_OP,</span>
<span class="line-removed">3089                                ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3090                                ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3091                                ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-removed">3092                                CHECK_NO_OP,</span>
<span class="line-removed">3093                                CHECK_NO_OP));</span>
<span class="line-removed">3094 #endif</span>
<span class="line-removed">3095 }</span>
<span class="line-removed">3096 </span>
<span class="line-removed">3097 extern &quot;C&quot; {</span>
<span class="line-removed">3098 </span>
<span class="line-removed">3099 #define STRIDE(array) ((char*)&amp;array[1] - (char*)&amp;array[0])</span>
<span class="line-removed">3100 </span>
<span class="line-removed">3101 JNIEXPORT VMStructEntry* gHotSpotVMStructs = VMStructs::localHotSpotVMStructs;</span>
<span class="line-removed">3102 JNIEXPORT uint64_t gHotSpotVMStructEntryTypeNameOffset = offset_of(VMStructEntry, typeName);</span>
<span class="line-removed">3103 JNIEXPORT uint64_t gHotSpotVMStructEntryFieldNameOffset = offset_of(VMStructEntry, fieldName);</span>
<span class="line-removed">3104 JNIEXPORT uint64_t gHotSpotVMStructEntryTypeStringOffset = offset_of(VMStructEntry, typeString);</span>
<span class="line-removed">3105 JNIEXPORT uint64_t gHotSpotVMStructEntryIsStaticOffset = offset_of(VMStructEntry, isStatic);</span>
<span class="line-removed">3106 JNIEXPORT uint64_t gHotSpotVMStructEntryOffsetOffset = offset_of(VMStructEntry, offset);</span>
<span class="line-removed">3107 JNIEXPORT uint64_t gHotSpotVMStructEntryAddressOffset = offset_of(VMStructEntry, address);</span>
<span class="line-removed">3108 JNIEXPORT uint64_t gHotSpotVMStructEntryArrayStride = STRIDE(gHotSpotVMStructs);</span>
<span class="line-removed">3109 </span>
<span class="line-removed">3110 JNIEXPORT VMTypeEntry* gHotSpotVMTypes = VMStructs::localHotSpotVMTypes;</span>
<span class="line-removed">3111 JNIEXPORT uint64_t gHotSpotVMTypeEntryTypeNameOffset = offset_of(VMTypeEntry, typeName);</span>
<span class="line-removed">3112 JNIEXPORT uint64_t gHotSpotVMTypeEntrySuperclassNameOffset = offset_of(VMTypeEntry, superclassName);</span>
<span class="line-removed">3113 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsOopTypeOffset = offset_of(VMTypeEntry, isOopType);</span>
<span class="line-removed">3114 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsIntegerTypeOffset = offset_of(VMTypeEntry, isIntegerType);</span>
<span class="line-removed">3115 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsUnsignedOffset = offset_of(VMTypeEntry, isUnsigned);</span>
<span class="line-removed">3116 JNIEXPORT uint64_t gHotSpotVMTypeEntrySizeOffset = offset_of(VMTypeEntry, size);</span>
<span class="line-removed">3117 JNIEXPORT uint64_t gHotSpotVMTypeEntryArrayStride = STRIDE(gHotSpotVMTypes);</span>
3118 
<span class="line-modified">3119 JNIEXPORT VMIntConstantEntry* gHotSpotVMIntConstants = VMStructs::localHotSpotVMIntConstants;</span>
<span class="line-modified">3120 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryNameOffset = offset_of(VMIntConstantEntry, name);</span>
<span class="line-modified">3121 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryValueOffset = offset_of(VMIntConstantEntry, value);</span>
<span class="line-modified">3122 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryArrayStride = STRIDE(gHotSpotVMIntConstants);</span>






3123 
<span class="line-modified">3124 JNIEXPORT VMLongConstantEntry* gHotSpotVMLongConstants = VMStructs::localHotSpotVMLongConstants;</span>
<span class="line-modified">3125 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryNameOffset = offset_of(VMLongConstantEntry, name);</span>
<span class="line-modified">3126 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryValueOffset = offset_of(VMLongConstantEntry, value);</span>
<span class="line-modified">3127 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryArrayStride = STRIDE(gHotSpotVMLongConstants);</span>













3128 }
3129 
<span class="line-removed">3130 #ifdef ASSERT</span>
3131 static int recursiveFindType(VMTypeEntry* origtypes, const char* typeName, bool isRecurse) {
3132   {
3133     VMTypeEntry* types = origtypes;
3134     while (types-&gt;typeName != NULL) {
3135       if (strcmp(typeName, types-&gt;typeName) == 0) {
3136         // Found it
3137         return 1;
3138       }
3139       ++types;
3140     }
3141   }
3142   // Search for the base type by peeling off const and *
3143   size_t len = strlen(typeName);
3144   if (typeName[len-1] == &#39;*&#39;) {
3145     char * s = NEW_C_HEAP_ARRAY(char, len, mtInternal);
3146     strncpy(s, typeName, len - 1);
3147     s[len-1] = &#39;\0&#39;;
3148     // tty-&gt;print_cr(&quot;checking \&quot;%s\&quot; for \&quot;%s\&quot;&quot;, s, typeName);
3149     if (recursiveFindType(origtypes, s, true) == 1) {
3150       FREE_C_HEAP_ARRAY(char, s);
</pre>
<hr />
<pre>
3177     if (recursiveFindType(origtypes, s, true) == 1) {
3178       return 1;
3179     }
3180   }
3181   if (strstr(typeName, &quot; const&quot;) == typeName + len - 6) {
3182     char * s = os::strdup_check_oom(typeName);
3183     s[len - 6] = &#39;\0&#39;;
3184     // tty-&gt;print_cr(&quot;checking \&quot;%s\&quot; for \&quot;%s\&quot;&quot;, s, typeName);
3185     if (recursiveFindType(origtypes, s, true) == 1) {
3186       os::free(s);
3187       return 1;
3188     }
3189     os::free(s);
3190   }
3191   if (!isRecurse) {
3192     tty-&gt;print_cr(&quot;type \&quot;%s\&quot; not found&quot;, typeName);
3193   }
3194   return 0;
3195 }
3196 
<span class="line-modified">3197 </span>
<span class="line-removed">3198 int</span>
<span class="line-removed">3199 VMStructs::findType(const char* typeName) {</span>
3200   VMTypeEntry* types = gHotSpotVMTypes;
3201 
3202   return recursiveFindType(types, typeName, false);
3203 }
<span class="line-removed">3204 #endif</span>
3205 
3206 void vmStructs_init() {
<span class="line-modified">3207   debug_only(VMStructs::init());</span>
3208 }

</pre>
</td>
<td>
<hr />
<pre>
  89 #include &quot;runtime/java.hpp&quot;
  90 #include &quot;runtime/javaCalls.hpp&quot;
  91 #include &quot;runtime/notificationThread.hpp&quot;
  92 #include &quot;runtime/os.hpp&quot;
  93 #include &quot;runtime/perfMemory.hpp&quot;
  94 #include &quot;runtime/serviceThread.hpp&quot;
  95 #include &quot;runtime/sharedRuntime.hpp&quot;
  96 #include &quot;runtime/stubRoutines.hpp&quot;
  97 #include &quot;runtime/thread.inline.hpp&quot;
  98 #include &quot;runtime/threadSMR.hpp&quot;
  99 #include &quot;runtime/vframeArray.hpp&quot;
 100 #include &quot;runtime/vmStructs.hpp&quot;
 101 #include &quot;utilities/globalDefinitions.hpp&quot;
 102 #include &quot;utilities/hashtable.hpp&quot;
 103 #include &quot;utilities/macros.hpp&quot;
 104 
 105 #include CPU_HEADER(vmStructs)
 106 #include OS_HEADER(vmStructs)
 107 #include OS_CPU_HEADER(vmStructs)
 108 





 109 #ifdef COMPILER2
 110 #include &quot;opto/addnode.hpp&quot;
 111 #include &quot;opto/block.hpp&quot;
 112 #include &quot;opto/callnode.hpp&quot;
 113 #include &quot;opto/castnode.hpp&quot;
 114 #include &quot;opto/cfgnode.hpp&quot;
 115 #include &quot;opto/chaitin.hpp&quot;
 116 #include &quot;opto/convertnode.hpp&quot;
 117 #include &quot;opto/divnode.hpp&quot;
 118 #include &quot;opto/intrinsicnode.hpp&quot;
 119 #include &quot;opto/locknode.hpp&quot;
 120 #include &quot;opto/loopnode.hpp&quot;
 121 #include &quot;opto/machnode.hpp&quot;
 122 #include &quot;opto/matcher.hpp&quot;
 123 #include &quot;opto/mathexactnode.hpp&quot;
 124 #include &quot;opto/movenode.hpp&quot;
 125 #include &quot;opto/mulnode.hpp&quot;
 126 #include &quot;opto/narrowptrnode.hpp&quot;
 127 #include &quot;opto/opaquenode.hpp&quot;
 128 #include &quot;opto/optoreg.hpp&quot;
</pre>
<hr />
<pre>
 500   nonstatic_field(BasicHashtableEntry&lt;mtInternal&gt;, _hash,                                     unsigned int)                          \
 501   nonstatic_field(IntptrHashtableEntry,            _literal,                                  intptr_t)                              \
 502                                                                                                                                      \
 503   /*************/                                                                                                                    \
 504   /* Hashtable */                                                                                                                    \
 505   /*************/                                                                                                                    \
 506                                                                                                                                      \
 507   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _table_size,                                   int)                                   \
 508   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _buckets,                                      HashtableBucket&lt;mtInternal&gt;*)          \
 509   volatile_nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _free_list,                           BasicHashtableEntry&lt;mtInternal&gt;*)      \
 510   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _first_free_entry,                             char*)                                 \
 511   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _end_block,                                    char*)                                 \
 512   nonstatic_field(BasicHashtable&lt;mtInternal&gt;,  _entry_size,                                   int)                                   \
 513                                                                                                                                      \
 514   /*******************/                                                                                                              \
 515   /* ClassLoaderData */                                                                                                              \
 516   /*******************/                                                                                                              \
 517   nonstatic_field(ClassLoaderData,             _class_loader,                                 OopHandle)                             \
 518   nonstatic_field(ClassLoaderData,             _next,                                         ClassLoaderData*)                      \
 519   volatile_nonstatic_field(ClassLoaderData,    _klasses,                                      Klass*)                                \

 520   volatile_nonstatic_field(ClassLoaderData,    _dictionary,                                   Dictionary*)                           \
 521                                                                                                                                      \
 522   static_ptr_volatile_field(ClassLoaderDataGraph, _head,                                      ClassLoaderData*)                      \
 523                                                                                                                                      \
 524   /**********/                                                                                                                       \
 525   /* Arrays */                                                                                                                       \
 526   /**********/                                                                                                                       \
 527                                                                                                                                      \
 528   nonstatic_field(Array&lt;Klass*&gt;,               _length,                                       int)                                   \
 529   nonstatic_field(Array&lt;Klass*&gt;,               _data[0],                                      Klass*)                                \
 530                                                                                                                                      \
 531   /*******************/                                                                                                              \
 532   /* GrowableArrays  */                                                                                                              \
 533   /*******************/                                                                                                              \
 534                                                                                                                                      \
 535   nonstatic_field(GenericGrowableArray,        _len,                                          int)                                   \
 536   nonstatic_field(GenericGrowableArray,        _max,                                          int)                                   \
 537   nonstatic_field(GenericGrowableArray,        _arena,                                        Arena*)                                \
 538   nonstatic_field(GrowableArray&lt;int&gt;,          _data,                                         int*)                                  \
 539                                                                                                                                      \
</pre>
<hr />
<pre>
 768   volatile_nonstatic_field(JavaThread,         _is_method_handle_return,                      int)                                   \
 769   nonstatic_field(JavaThread,                  _special_runtime_exit_condition,               JavaThread::AsyncRequests)             \
 770   nonstatic_field(JavaThread,                  _saved_exception_pc,                           address)                               \
 771   volatile_nonstatic_field(JavaThread,         _thread_state,                                 JavaThreadState)                       \
 772   nonstatic_field(JavaThread,                  _osthread,                                     OSThread*)                             \
 773   nonstatic_field(JavaThread,                  _stack_base,                                   address)                               \
 774   nonstatic_field(JavaThread,                  _stack_size,                                   size_t)                                \
 775   nonstatic_field(JavaThread,                  _vframe_array_head,                            vframeArray*)                          \
 776   nonstatic_field(JavaThread,                  _vframe_array_last,                            vframeArray*)                          \
 777   volatile_nonstatic_field(JavaThread,         _terminated,                                   JavaThread::TerminatedTypes)           \
 778   nonstatic_field(Thread,                      _resource_area,                                ResourceArea*)                         \
 779   nonstatic_field(CompilerThread,              _env,                                          ciEnv*)                                \
 780                                                                                                                                      \
 781   /************/                                                                                                                     \
 782   /* OSThread */                                                                                                                     \
 783   /************/                                                                                                                     \
 784                                                                                                                                      \
 785   volatile_nonstatic_field(OSThread,           _state,                                        ThreadState)                           \
 786                                                                                                                                      \
 787   /************************/                                                                                                         \
<span class="line-modified"> 788   /* ImmutableOopMap      */                                                                                                         \</span>
 789   /************************/                                                                                                         \
 790                                                                                                                                      \







 791   nonstatic_field(ImmutableOopMapSet,          _count,                                        int)                                   \
 792   nonstatic_field(ImmutableOopMapSet,          _size,                                         int)                                   \
 793                                                                                                                                      \
 794   nonstatic_field(ImmutableOopMapPair,         _pc_offset,                                    int)                                   \
 795   nonstatic_field(ImmutableOopMapPair,         _oopmap_offset,                                int)                                   \
 796                                                                                                                                      \
 797   nonstatic_field(ImmutableOopMap,             _count,                                        int)                                   \
 798                                                                                                                                      \
 799   /*********************************/                                                                                                \
 800   /* JNIHandles and JNIHandleBlock */                                                                                                \
 801   /*********************************/                                                                                                \
 802   static_field(JNIHandles,                     _global_handles,                               OopStorage*)                           \
 803   static_field(JNIHandles,                     _weak_global_handles,                          OopStorage*)                           \
 804   unchecked_nonstatic_field(JNIHandleBlock,    _handles,       JNIHandleBlock::block_size_in_oops * sizeof(Oop)) /* Note: no type */ \
 805   nonstatic_field(JNIHandleBlock,              _top,                                          int)                                   \
 806   nonstatic_field(JNIHandleBlock,              _next,                                         JNIHandleBlock*)                       \
 807                                                                                                                                      \
 808   /********************/                                                                                                             \
 809   /* CompressedStream */                                                                                                             \
 810   /********************/                                                                                                             \
</pre>
<hr />
<pre>
1419   declare_type(RuntimeStub,              RuntimeBlob)                     \
1420   declare_type(SingletonBlob,            RuntimeBlob)                     \
1421   declare_type(SafepointBlob,            SingletonBlob)                   \
1422   declare_type(DeoptimizationBlob,       SingletonBlob)                   \
1423   declare_c2_type(ExceptionBlob,         SingletonBlob)                   \
1424   declare_c2_type(UncommonTrapBlob,      RuntimeBlob)                     \
1425                                                                           \
1426   /***************************************/                               \
1427   /* PcDesc and other compiled code info */                               \
1428   /***************************************/                               \
1429                                                                           \
1430   declare_toplevel_type(PcDesc)                                           \
1431   declare_toplevel_type(ExceptionCache)                                   \
1432   declare_toplevel_type(PcDescCache)                                      \
1433   declare_toplevel_type(Dependencies)                                     \
1434   declare_toplevel_type(CompileTask)                                      \
1435   declare_toplevel_type(Deoptimization)                                   \
1436   declare_toplevel_type(Deoptimization::UnrollBlock)                      \
1437                                                                           \
1438   /************************/                                              \
<span class="line-modified">1439   /* ImmutableOopMap      */                                              \</span>
1440   /************************/                                              \
1441                                                                           \


1442   declare_toplevel_type(ImmutableOopMapSet)                               \
1443   declare_toplevel_type(ImmutableOopMapPair)                              \
1444   declare_toplevel_type(ImmutableOopMap)                                  \
1445                                                                           \
1446   /********************/                                                  \
1447   /* CompressedStream */                                                  \
1448   /********************/                                                  \
1449                                                                           \
1450   declare_toplevel_type(CompressedStream)                                 \
1451                                                                           \
1452   /**************/                                                        \
1453   /* VMRegImpl  */                                                        \
1454   /**************/                                                        \
1455                                                                           \
1456   declare_toplevel_type(VMRegImpl)                                        \
1457                                                                           \
1458   /*********************************/                                     \
1459   /* JNIHandles and JNIHandleBlock */                                     \
1460   /*********************************/                                     \
1461                                                                           \
</pre>
<hr />
<pre>
1801   declare_c2_type(FmaVFNode, VectorNode)                                  \
1802   declare_c2_type(CMoveVFNode, VectorNode)                                \
1803   declare_c2_type(CMoveVDNode, VectorNode)                                \
1804   declare_c2_type(MulReductionVDNode, ReductionNode)                      \
1805   declare_c2_type(DivVFNode, VectorNode)                                  \
1806   declare_c2_type(DivVDNode, VectorNode)                                  \
1807   declare_c2_type(PopCountVINode, VectorNode)                             \
1808   declare_c2_type(LShiftVBNode, VectorNode)                               \
1809   declare_c2_type(LShiftVSNode, VectorNode)                               \
1810   declare_c2_type(LShiftVINode, VectorNode)                               \
1811   declare_c2_type(LShiftVLNode, VectorNode)                               \
1812   declare_c2_type(RShiftVBNode, VectorNode)                               \
1813   declare_c2_type(RShiftVSNode, VectorNode)                               \
1814   declare_c2_type(RShiftVINode, VectorNode)                               \
1815   declare_c2_type(RShiftVLNode, VectorNode)                               \
1816   declare_c2_type(URShiftVBNode, VectorNode)                              \
1817   declare_c2_type(URShiftVSNode, VectorNode)                              \
1818   declare_c2_type(URShiftVINode, VectorNode)                              \
1819   declare_c2_type(URShiftVLNode, VectorNode)                              \
1820   declare_c2_type(AndVNode, VectorNode)                                   \
<span class="line-added">1821   declare_c2_type(AndReductionVNode, ReductionNode)                       \</span>
1822   declare_c2_type(OrVNode, VectorNode)                                    \
<span class="line-added">1823   declare_c2_type(OrReductionVNode, ReductionNode)                        \</span>
1824   declare_c2_type(XorVNode, VectorNode)                                   \
<span class="line-added">1825   declare_c2_type(XorReductionVNode, ReductionNode)                       \</span>
1826   declare_c2_type(MaxVNode, VectorNode)                                   \
1827   declare_c2_type(MinVNode, VectorNode)                                   \
1828   declare_c2_type(MaxReductionVNode, ReductionNode)                       \
1829   declare_c2_type(MinReductionVNode, ReductionNode)                       \
1830   declare_c2_type(LoadVectorNode, LoadNode)                               \
1831   declare_c2_type(StoreVectorNode, StoreNode)                             \
1832   declare_c2_type(ReplicateBNode, VectorNode)                             \
1833   declare_c2_type(ReplicateSNode, VectorNode)                             \
1834   declare_c2_type(ReplicateINode, VectorNode)                             \
1835   declare_c2_type(ReplicateLNode, VectorNode)                             \
1836   declare_c2_type(ReplicateFNode, VectorNode)                             \
1837   declare_c2_type(ReplicateDNode, VectorNode)                             \
1838   declare_c2_type(PackNode, VectorNode)                                   \
1839   declare_c2_type(PackBNode, PackNode)                                    \
1840   declare_c2_type(PackSNode, PackNode)                                    \
1841   declare_c2_type(PackINode, PackNode)                                    \
1842   declare_c2_type(PackLNode, PackNode)                                    \
1843   declare_c2_type(PackFNode, PackNode)                                    \
1844   declare_c2_type(PackDNode, PackNode)                                    \
1845   declare_c2_type(Pack2LNode, PackNode)                                   \
</pre>
<hr />
<pre>
1968   declare_toplevel_type(JavaThread *const *const)                         \
1969   declare_toplevel_type(java_lang_Class)                                  \
1970   declare_integer_type(JavaThread::AsyncRequests)                         \
1971   declare_integer_type(JavaThread::TerminatedTypes)                       \
1972   declare_toplevel_type(jbyte*)                                           \
1973   declare_toplevel_type(jbyte**)                                          \
1974   declare_toplevel_type(jint*)                                            \
1975   declare_toplevel_type(jniIdMapBase*)                                    \
1976   declare_unsigned_integer_type(juint)                                    \
1977   declare_unsigned_integer_type(julong)                                   \
1978   declare_toplevel_type(JNIHandleBlock*)                                  \
1979   declare_toplevel_type(JNIid)                                            \
1980   declare_toplevel_type(JNIid*)                                           \
1981   declare_toplevel_type(jmethodID*)                                       \
1982   declare_toplevel_type(Mutex*)                                           \
1983   declare_toplevel_type(nmethod*)                                         \
1984   COMPILER2_PRESENT(declare_unsigned_integer_type(node_idx_t))            \
1985   declare_toplevel_type(ObjectMonitor*)                                   \
1986   declare_toplevel_type(PaddedObjectMonitor*)                             \
1987   declare_toplevel_type(oop*)                                             \

1988   declare_toplevel_type(OopMapCache*)                                     \

1989   declare_toplevel_type(VMReg)                                            \
1990   declare_toplevel_type(OSThread*)                                        \
1991    declare_integer_type(ReferenceType)                                    \
1992   declare_toplevel_type(StubQueue*)                                       \
1993   declare_toplevel_type(Thread*)                                          \
1994   declare_toplevel_type(Universe)                                         \
1995   declare_toplevel_type(CompressedOops)                                   \
1996   declare_toplevel_type(CompressedKlassPointers)                          \
1997   declare_toplevel_type(os)                                               \
1998   declare_toplevel_type(vframeArray)                                      \
1999   declare_toplevel_type(vframeArrayElement)                               \
2000   declare_toplevel_type(Annotations*)                                     \
2001   declare_type(OopMapValue, StackObj)                                     \
2002   declare_type(FileMapInfo, CHeapObj&lt;mtInternal&gt;)                         \
2003   declare_toplevel_type(FileMapHeader)                                    \
2004   declare_toplevel_type(CDSFileMapRegion)                                 \
2005                                                                           \
2006   /************/                                                          \
2007   /* GC types */                                                          \
2008   /************/                                                          \
</pre>
<hr />
<pre>
2663   declare_constant(markWord::biased_lock_pattern)                         \
2664                                                                           \
2665   declare_constant(markWord::no_hash)                                     \
2666   declare_constant(markWord::no_hash_in_place)                            \
2667   declare_constant(markWord::no_lock_in_place)                            \
2668   declare_constant(markWord::max_age)                                     \
2669                                                                           \
2670   /* InvocationCounter constants */                                       \
2671   declare_constant(InvocationCounter::count_increment)                    \
2672   declare_constant(InvocationCounter::count_shift)
2673 
2674 
2675 //--------------------------------------------------------------------------------
2676 //
2677 
2678 // Generate and check a nonstatic field in non-product builds
2679 #ifndef PRODUCT
2680 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2681 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2682 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)



2683 #else
2684 # define GENERATE_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2685 # define CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2686 # define ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT(a, b, c)



2687 #endif /* PRODUCT */
2688 
2689 // Generate and check a nonstatic field in C1 builds
2690 #ifdef COMPILER1
2691 # define GENERATE_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2692 # define CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2693 # define ENSURE_C1_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
2694 #else
2695 # define GENERATE_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2696 # define CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2697 # define ENSURE_C1_FIELD_TYPE_PRESENT(a, b, c)
2698 #endif /* COMPILER1 */
2699 // Generate and check a nonstatic field in C2 builds
2700 #ifdef COMPILER2
2701 # define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c) GENERATE_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2702 # define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)    CHECK_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2703 # define ENSURE_C2_FIELD_TYPE_PRESENT(a, b, c)          ENSURE_FIELD_TYPE_PRESENT(a, b, c)
2704 #else
2705 # define GENERATE_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
2706 # define CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY(a, b, c)
</pre>
<hr />
<pre>
2938 
2939   VM_LONG_CONSTANTS_CPU(GENERATE_VM_LONG_CONSTANT_ENTRY,
2940                         GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
2941                         GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
2942                         GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
2943                         GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
2944 
2945   VM_LONG_CONSTANTS_OS_CPU(GENERATE_VM_LONG_CONSTANT_ENTRY,
2946                            GENERATE_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY,
2947                            GENERATE_C1_VM_LONG_CONSTANT_ENTRY,
2948                            GENERATE_C2_VM_LONG_CONSTANT_ENTRY,
2949                            GENERATE_C2_PREPROCESSOR_VM_LONG_CONSTANT_ENTRY)
2950 
2951   GENERATE_VM_LONG_CONSTANT_LAST_ENTRY()
2952 };
2953 
2954 size_t VMStructs::localHotSpotVMLongConstantsLength() {
2955   return sizeof(localHotSpotVMLongConstants) / sizeof(VMLongConstantEntry);
2956 }
2957 
<span class="line-modified">2958 extern &quot;C&quot; {</span>
<span class="line-modified">2959 </span>
<span class="line-modified">2960 #define STRIDE(array) ((char*)&amp;array[1] - (char*)&amp;array[0])</span>
<span class="line-modified">2961 </span>
<span class="line-added">2962 JNIEXPORT VMStructEntry* gHotSpotVMStructs = VMStructs::localHotSpotVMStructs;</span>
<span class="line-added">2963 JNIEXPORT uint64_t gHotSpotVMStructEntryTypeNameOffset = offset_of(VMStructEntry, typeName);</span>
<span class="line-added">2964 JNIEXPORT uint64_t gHotSpotVMStructEntryFieldNameOffset = offset_of(VMStructEntry, fieldName);</span>
<span class="line-added">2965 JNIEXPORT uint64_t gHotSpotVMStructEntryTypeStringOffset = offset_of(VMStructEntry, typeString);</span>
<span class="line-added">2966 JNIEXPORT uint64_t gHotSpotVMStructEntryIsStaticOffset = offset_of(VMStructEntry, isStatic);</span>
<span class="line-added">2967 JNIEXPORT uint64_t gHotSpotVMStructEntryOffsetOffset = offset_of(VMStructEntry, offset);</span>
<span class="line-added">2968 JNIEXPORT uint64_t gHotSpotVMStructEntryAddressOffset = offset_of(VMStructEntry, address);</span>
<span class="line-added">2969 JNIEXPORT uint64_t gHotSpotVMStructEntryArrayStride = STRIDE(gHotSpotVMStructs);</span>
<span class="line-added">2970 </span>
<span class="line-added">2971 JNIEXPORT VMTypeEntry* gHotSpotVMTypes = VMStructs::localHotSpotVMTypes;</span>
<span class="line-added">2972 JNIEXPORT uint64_t gHotSpotVMTypeEntryTypeNameOffset = offset_of(VMTypeEntry, typeName);</span>
<span class="line-added">2973 JNIEXPORT uint64_t gHotSpotVMTypeEntrySuperclassNameOffset = offset_of(VMTypeEntry, superclassName);</span>
<span class="line-added">2974 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsOopTypeOffset = offset_of(VMTypeEntry, isOopType);</span>
<span class="line-added">2975 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsIntegerTypeOffset = offset_of(VMTypeEntry, isIntegerType);</span>
<span class="line-added">2976 JNIEXPORT uint64_t gHotSpotVMTypeEntryIsUnsignedOffset = offset_of(VMTypeEntry, isUnsigned);</span>
<span class="line-added">2977 JNIEXPORT uint64_t gHotSpotVMTypeEntrySizeOffset = offset_of(VMTypeEntry, size);</span>
<span class="line-added">2978 JNIEXPORT uint64_t gHotSpotVMTypeEntryArrayStride = STRIDE(gHotSpotVMTypes);</span>
<span class="line-added">2979 </span>
<span class="line-added">2980 JNIEXPORT VMIntConstantEntry* gHotSpotVMIntConstants = VMStructs::localHotSpotVMIntConstants;</span>
<span class="line-added">2981 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryNameOffset = offset_of(VMIntConstantEntry, name);</span>
<span class="line-added">2982 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryValueOffset = offset_of(VMIntConstantEntry, value);</span>
<span class="line-added">2983 JNIEXPORT uint64_t gHotSpotVMIntConstantEntryArrayStride = STRIDE(gHotSpotVMIntConstants);</span>
<span class="line-added">2984 </span>
<span class="line-added">2985 JNIEXPORT VMLongConstantEntry* gHotSpotVMLongConstants = VMStructs::localHotSpotVMLongConstants;</span>
<span class="line-added">2986 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryNameOffset = offset_of(VMLongConstantEntry, name);</span>
<span class="line-added">2987 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryValueOffset = offset_of(VMLongConstantEntry, value);</span>
<span class="line-added">2988 JNIEXPORT uint64_t gHotSpotVMLongConstantEntryArrayStride = STRIDE(gHotSpotVMLongConstants);</span>
<span class="line-added">2989 } // &quot;C&quot;</span>
<span class="line-added">2990 </span>
<span class="line-added">2991 #ifdef ASSERT</span>
<span class="line-added">2992 // This is used both to check the types of referenced fields and</span>
<span class="line-added">2993 // to ensure that all of the field types are present.</span>
<span class="line-added">2994 void VMStructs::init() {</span>
2995   VM_STRUCTS(CHECK_NONSTATIC_VM_STRUCT_ENTRY,
2996              CHECK_STATIC_VM_STRUCT_ENTRY,
2997              CHECK_STATIC_PTR_VOLATILE_VM_STRUCT_ENTRY,
2998              CHECK_NO_OP,
2999              CHECK_VOLATILE_NONSTATIC_VM_STRUCT_ENTRY,
3000              CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
3001              CHECK_C1_NONSTATIC_VM_STRUCT_ENTRY,
3002              CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY,
3003              CHECK_NO_OP,
3004              CHECK_NO_OP);
3005 
3006 
3007   VM_STRUCTS_CPU(CHECK_NONSTATIC_VM_STRUCT_ENTRY,
3008                  CHECK_STATIC_VM_STRUCT_ENTRY,
3009                  CHECK_NO_OP,
3010                  CHECK_VOLATILE_NONSTATIC_VM_STRUCT_ENTRY,
3011                  CHECK_NONPRODUCT_NONSTATIC_VM_STRUCT_ENTRY,
3012                  CHECK_C2_NONSTATIC_VM_STRUCT_ENTRY,
3013                  CHECK_NO_OP,
3014                  CHECK_NO_OP);
</pre>
<hr />
<pre>
3050                   CHECK_C2_VM_TYPE_ENTRY,
3051                   CHECK_C2_TOPLEVEL_VM_TYPE_ENTRY);
3052 
3053   //
3054   // Split VM_STRUCTS() invocation into two parts to allow MS VC++ 6.0
3055   // to build with the source mounted over SNC3.2. Symptom was that
3056   // debug build failed with an internal compiler error. Has been seen
3057   // mounting sources from Solaris 2.6 and 2.7 hosts, but so far not
3058   // 2.8 hosts. Appears to occur because line is too long.
3059   //
3060   // If an assertion failure is triggered here it means that an entry
3061   // in VMStructs::localHotSpotVMStructs[] was not found in
3062   // VMStructs::localHotSpotVMTypes[]. (The assertion itself had to be
3063   // made less descriptive because of this above bug -- see the
3064   // definition of ENSURE_FIELD_TYPE_PRESENT.)
3065   //
3066   // NOTE: taken out because this was just not working on everyone&#39;s
3067   // Solstice NFS setup. If everyone switches to local workspaces on
3068   // Win32, we can put this back in.
3069 #ifndef _WINDOWS
<span class="line-modified">3070   VM_STRUCTS(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3071              CHECK_NO_OP,</span>
<span class="line-modified">3072              CHECK_NO_OP,</span>
<span class="line-modified">3073              CHECK_NO_OP,</span>
<span class="line-modified">3074              CHECK_NO_OP,</span>
<span class="line-modified">3075              CHECK_NO_OP,</span>
<span class="line-modified">3076              CHECK_NO_OP,</span>
<span class="line-modified">3077              CHECK_NO_OP,</span>
<span class="line-modified">3078              CHECK_NO_OP,</span>
<span class="line-modified">3079              CHECK_NO_OP);</span>



















































3080 
<span class="line-modified">3081   VM_STRUCTS(CHECK_NO_OP,</span>
<span class="line-modified">3082              ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3083              ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3084              CHECK_NO_OP,</span>
<span class="line-added">3085              ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3086              ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3087              ENSURE_C1_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3088              ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3089              CHECK_NO_OP,</span>
<span class="line-added">3090              CHECK_NO_OP);</span>
3091 
<span class="line-modified">3092   VM_STRUCTS_CPU(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3093                  ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-modified">3094                  CHECK_NO_OP,</span>
<span class="line-modified">3095                  ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3096                  ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3097                  ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3098                  CHECK_NO_OP,</span>
<span class="line-added">3099                  CHECK_NO_OP);</span>
<span class="line-added">3100   VM_STRUCTS_OS_CPU(ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3101                     ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3102                     CHECK_NO_OP,</span>
<span class="line-added">3103                     ENSURE_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3104                     ENSURE_NONPRODUCT_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3105                     ENSURE_C2_FIELD_TYPE_PRESENT,</span>
<span class="line-added">3106                     CHECK_NO_OP,</span>
<span class="line-added">3107                     CHECK_NO_OP);</span>
<span class="line-added">3108 #endif // !_WINDOWS</span>
3109 }
3110 

3111 static int recursiveFindType(VMTypeEntry* origtypes, const char* typeName, bool isRecurse) {
3112   {
3113     VMTypeEntry* types = origtypes;
3114     while (types-&gt;typeName != NULL) {
3115       if (strcmp(typeName, types-&gt;typeName) == 0) {
3116         // Found it
3117         return 1;
3118       }
3119       ++types;
3120     }
3121   }
3122   // Search for the base type by peeling off const and *
3123   size_t len = strlen(typeName);
3124   if (typeName[len-1] == &#39;*&#39;) {
3125     char * s = NEW_C_HEAP_ARRAY(char, len, mtInternal);
3126     strncpy(s, typeName, len - 1);
3127     s[len-1] = &#39;\0&#39;;
3128     // tty-&gt;print_cr(&quot;checking \&quot;%s\&quot; for \&quot;%s\&quot;&quot;, s, typeName);
3129     if (recursiveFindType(origtypes, s, true) == 1) {
3130       FREE_C_HEAP_ARRAY(char, s);
</pre>
<hr />
<pre>
3157     if (recursiveFindType(origtypes, s, true) == 1) {
3158       return 1;
3159     }
3160   }
3161   if (strstr(typeName, &quot; const&quot;) == typeName + len - 6) {
3162     char * s = os::strdup_check_oom(typeName);
3163     s[len - 6] = &#39;\0&#39;;
3164     // tty-&gt;print_cr(&quot;checking \&quot;%s\&quot; for \&quot;%s\&quot;&quot;, s, typeName);
3165     if (recursiveFindType(origtypes, s, true) == 1) {
3166       os::free(s);
3167       return 1;
3168     }
3169     os::free(s);
3170   }
3171   if (!isRecurse) {
3172     tty-&gt;print_cr(&quot;type \&quot;%s\&quot; not found&quot;, typeName);
3173   }
3174   return 0;
3175 }
3176 
<span class="line-modified">3177 int VMStructs::findType(const char* typeName) {</span>


3178   VMTypeEntry* types = gHotSpotVMTypes;
3179 
3180   return recursiveFindType(types, typeName, false);
3181 }

3182 
3183 void vmStructs_init() {
<span class="line-modified">3184   VMStructs::init();</span>
3185 }
<span class="line-added">3186 #endif // ASSERT</span>
</pre>
</td>
</tr>
</table>
<center><a href="vmOperations.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vmStructs.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>