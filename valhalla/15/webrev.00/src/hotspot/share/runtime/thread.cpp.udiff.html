<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/runtime/thread.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="signature.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="thread.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/thread.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -348,10 +348,11 @@</span>
    // Note: at this point, Thread object is not yet initialized. Do not rely on
    // any members being initialized. Do not rely on Thread::current() being set.
    // If possible, refrain from doing anything which may crash or assert since
    // quite probably those crash dumps will be useless.
    set_stack_base(os::current_stack_base());
<span class="udiff-line-added">+   assert(_stack_base != NULL, &quot;current_stack_base failed for %s&quot;, name());</span>
    set_stack_size(os::current_stack_size());
  
  #ifdef SOLARIS
    if (os::is_primordial_thread()) {
      os::Solaris::correct_stack_boundaries_for_primordial_thread(this);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -886,11 +887,13 @@</span>
    }
    return false;
  }
  
  void Thread::oops_do(OopClosure* f, CodeBlobClosure* cf) {
<span class="udiff-line-modified-removed">-   active_handles()-&gt;oops_do(f);</span>
<span class="udiff-line-modified-added">+   if (active_handles() != NULL) {</span>
<span class="udiff-line-added">+     active_handles()-&gt;oops_do(f);</span>
<span class="udiff-line-added">+   }</span>
    // Do oop for ThreadShadow
    f-&gt;do_oop((oop*)&amp;_pending_exception);
    handle_area()-&gt;oops_do(f);
  
    // We scan thread local monitor lists here, and the remaining global
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1240,11 +1243,11 @@</span>
  
    if (HAS_PENDING_EXCEPTION) {
      return;
    }
  
<span class="udiff-line-modified-removed">-   Klass* group =  SystemDictionary::ThreadGroup_klass();</span>
<span class="udiff-line-modified-added">+   Klass* group = SystemDictionary::ThreadGroup_klass();</span>
    Handle threadObj(THREAD, this-&gt;threadObj());
  
    JavaCalls::call_special(&amp;result,
                            thread_group,
                            group,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3616,11 +3619,11 @@</span>
  //
  //     System.initPhase1 initializes the system properties, the static
  //     fields in, out, and err. Set up java signal handlers, OS-specific
  //     system settings, and thread group of the main thread.
  static void call_initPhase1(TRAPS) {
<span class="udiff-line-modified-removed">-   Klass* klass =  SystemDictionary::resolve_or_fail(vmSymbols::java_lang_System(), true, CHECK);</span>
<span class="udiff-line-modified-added">+   Klass* klass = SystemDictionary::System_klass();</span>
    JavaValue result(T_VOID);
    JavaCalls::call_static(&amp;result, klass, vmSymbols::initPhase1_name(),
                                           vmSymbols::void_method_signature(), CHECK);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3636,11 +3639,11 @@</span>
  //
  //     After phase 2, The VM will begin search classes from -Xbootclasspath/a.
  static void call_initPhase2(TRAPS) {
    TraceTime timer(&quot;Initialize module system&quot;, TRACETIME_LOG(Info, startuptime));
  
<span class="udiff-line-modified-removed">-   Klass* klass = SystemDictionary::resolve_or_fail(vmSymbols::java_lang_System(), true, CHECK);</span>
<span class="udiff-line-modified-added">+   Klass* klass = SystemDictionary::System_klass();</span>
  
    JavaValue result(T_INT);
    JavaCallArguments args;
    args.push_int(DisplayVMOutputToStderr);
    args.push_int(log_is_enabled(Debug, init)); // print stack trace if exception thrown
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3658,11 +3661,11 @@</span>
  //     This will instantiate and set the security manager, set the system class
  //     loader as well as the thread context class loader.  The security manager
  //     and system class loader may be a custom class loaded from -Xbootclasspath/a,
  //     other modules or the application&#39;s classpath.
  static void call_initPhase3(TRAPS) {
<span class="udiff-line-modified-removed">-   Klass* klass = SystemDictionary::resolve_or_fail(vmSymbols::java_lang_System(), true, CHECK);</span>
<span class="udiff-line-modified-added">+   Klass* klass = SystemDictionary::System_klass();</span>
    JavaValue result(T_VOID);
    JavaCalls::call_static(&amp;result, klass, vmSymbols::initPhase3_name(),
                                           vmSymbols::void_method_signature(), CHECK);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4329,10 +4332,17 @@</span>
  
  // Last thread running calls java.lang.Shutdown.shutdown()
  void JavaThread::invoke_shutdown_hooks() {
    HandleMark hm(this);
  
<span class="udiff-line-added">+   // Link all classes for dynamic CDS dumping before vm exit.</span>
<span class="udiff-line-added">+   // Same operation is being done in JVM_BeforeHalt for handling the</span>
<span class="udiff-line-added">+   // case where the application calls System.exit().</span>
<span class="udiff-line-added">+   if (DynamicDumpSharedSpaces) {</span>
<span class="udiff-line-added">+     MetaspaceShared::link_and_cleanup_shared_classes(this);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
    // We could get here with a pending exception, if so clear it now.
    if (this-&gt;has_pending_exception()) {
      this-&gt;clear_pending_exception();
    }
  
</pre>
<center><a href="signature.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="thread.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>