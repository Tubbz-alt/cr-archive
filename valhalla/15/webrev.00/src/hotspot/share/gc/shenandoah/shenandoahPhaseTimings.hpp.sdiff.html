<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahPhaseTimings.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahPhaseTimings.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahRootProcessor.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahPhaseTimings.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_GC_SHENANDOAH_SHENANDOAHPHASETIMINGS_HPP
 26 #define SHARE_GC_SHENANDOAH_SHENANDOAHPHASETIMINGS_HPP
 27 

 28 #include &quot;gc/shenandoah/shenandoahNumberSeq.hpp&quot;
 29 #include &quot;gc/shared/workerDataArray.hpp&quot;
 30 #include &quot;memory/allocation.hpp&quot;
 31 
 32 class ShenandoahCollectorPolicy;
<span class="line-removed"> 33 class ShenandoahWorkerTimings;</span>
<span class="line-removed"> 34 class ShenandoahTerminationTimings;</span>
 35 class outputStream;
 36 
<span class="line-modified"> 37 #define SHENANDOAH_GC_PHASE_DO(f)                                                       \</span>
<span class="line-modified"> 38   f(total_pause_gross,                              &quot;Total Pauses (G)&quot;)                 \</span>
<span class="line-modified"> 39   f(total_pause,                                    &quot;Total Pauses (N)&quot;)                 \</span>
<span class="line-modified"> 40   f(init_mark_gross,                                &quot;Pause Init Mark (G)&quot;)              \</span>
<span class="line-modified"> 41   f(init_mark,                                      &quot;Pause Init Mark (N)&quot;)              \</span>
<span class="line-modified"> 42   f(make_parsable,                                  &quot;  Make Parsable&quot;)                  \</span>
<span class="line-modified"> 43   f(clear_liveness,                                 &quot;  Clear Liveness&quot;)                 \</span>
<span class="line-modified"> 44                                                                                         \</span>
<span class="line-modified"> 45   /* Per-thread timer block, should have &quot;roots&quot; counters in consistent order */        \</span>
<span class="line-modified"> 46   f(scan_roots,                                     &quot;  Scan Roots&quot;)                     \</span>
<span class="line-modified"> 47   f(scan_thread_roots,                              &quot;    S: Thread Roots&quot;)              \</span>
<span class="line-modified"> 48   f(scan_code_roots,                                &quot;    S: Code Cache Roots&quot;)          \</span>
<span class="line-modified"> 49   f(scan_universe_roots,                            &quot;    S: Universe Roots&quot;)            \</span>
<span class="line-modified"> 50   f(scan_jni_roots,                                 &quot;    S: JNI Roots&quot;)                 \</span>
<span class="line-modified"> 51   f(scan_jvmti_weak_roots,                          &quot;    S: JVMTI Weak Roots&quot;)          \</span>
<span class="line-modified"> 52   f(scan_jfr_weak_roots,                            &quot;    S: JFR Weak Roots&quot;)            \</span>
<span class="line-modified"> 53   f(scan_jni_weak_roots,                            &quot;    S: JNI Weak Roots&quot;)            \</span>
<span class="line-modified"> 54   f(scan_stringtable_roots,                         &quot;    S: String Table Roots&quot;)        \</span>
<span class="line-modified"> 55   f(scan_resolved_method_table_roots,               &quot;    S: Resolved Table Roots&quot;)      \</span>
<span class="line-modified"> 56   f(scan_vm_global_roots,                           &quot;    S: VM Global Roots&quot;)           \</span>
<span class="line-removed"> 57   f(scan_vm_weak_roots,                             &quot;    S: VM Weak Roots&quot;)             \</span>
<span class="line-removed"> 58   f(scan_synchronizer_roots,                        &quot;    S: Synchronizer Roots&quot;)        \</span>
<span class="line-removed"> 59   f(scan_management_roots,                          &quot;    S: Management Roots&quot;)          \</span>
<span class="line-removed"> 60   f(scan_system_dictionary_roots,                   &quot;    S: System Dict Roots&quot;)         \</span>
<span class="line-removed"> 61   f(scan_cldg_roots,                                &quot;    S: CLDG Roots&quot;)                \</span>
<span class="line-removed"> 62   f(scan_jvmti_roots,                               &quot;    S: JVMTI Roots&quot;)               \</span>
<span class="line-removed"> 63   f(scan_string_dedup_table_roots,                  &quot;    S: Dedup Table Roots&quot;)         \</span>
<span class="line-removed"> 64   f(scan_string_dedup_queue_roots,                  &quot;    S: Dedup Queue Roots&quot;)         \</span>
<span class="line-removed"> 65   f(scan_finish_queues,                             &quot;    S: Finish Queues&quot; )            \</span>
<span class="line-removed"> 66                                                                                         \</span>
<span class="line-removed"> 67   f(resize_tlabs,                                   &quot;  Resize TLABs&quot;)                   \</span>
<span class="line-removed"> 68                                                                                         \</span>
<span class="line-removed"> 69   f(final_mark_gross,                               &quot;Pause Final Mark (G)&quot;)             \</span>
<span class="line-removed"> 70   f(final_mark,                                     &quot;Pause Final Mark (N)&quot;)             \</span>
<span class="line-removed"> 71                                                                                         \</span>
<span class="line-removed"> 72   /* Per-thread timer block, should have &quot;roots&quot; counters in consistent order */        \</span>
<span class="line-removed"> 73   f(update_roots,                                   &quot;  Update Roots&quot;)                   \</span>
<span class="line-removed"> 74   f(update_thread_roots,                            &quot;    U: Thread Roots&quot;)              \</span>
<span class="line-removed"> 75   f(update_code_roots,                              &quot;    U: Code Cache Roots&quot;)          \</span>
<span class="line-removed"> 76   f(update_universe_roots,                          &quot;    U: Universe Roots&quot;)            \</span>
<span class="line-removed"> 77   f(update_jni_roots,                               &quot;    U: JNI Roots&quot;)                 \</span>
<span class="line-removed"> 78   f(update_jvmti_weak_roots,                        &quot;    U: JVMTI Weak Roots&quot;)          \</span>
<span class="line-removed"> 79   f(update_jfr_weak_roots,                          &quot;    U: JFR Weak Roots&quot;)            \</span>
<span class="line-removed"> 80   f(update_jni_weak_roots,                          &quot;    U: JNI Weak Roots&quot;)            \</span>
<span class="line-removed"> 81   f(update_stringtable_roots,                       &quot;    U: String Table Roots&quot;)        \</span>
<span class="line-removed"> 82   f(update_resolved_method_table_roots,             &quot;    U: Resolved Table Roots&quot;)      \</span>
<span class="line-removed"> 83   f(update_vm_global_roots,                         &quot;    U: VM Global Roots&quot;)           \</span>
<span class="line-removed"> 84   f(update_vm_weak_roots,                           &quot;    U: VM Weak Roots&quot;)             \</span>
<span class="line-removed"> 85   f(update_synchronizer_roots,                      &quot;    U: Synchronizer Roots&quot;)        \</span>
<span class="line-removed"> 86   f(update_management_roots,                        &quot;    U: Management Roots&quot;)          \</span>
<span class="line-removed"> 87   f(update_system_dictionary_roots,                 &quot;    U: System Dict Roots&quot;)         \</span>
<span class="line-removed"> 88   f(update_cldg_roots,                              &quot;    U: CLDG Roots&quot;)                \</span>
<span class="line-removed"> 89   f(update_jvmti_roots,                             &quot;    U: JVMTI Roots&quot;)               \</span>
<span class="line-removed"> 90   f(update_string_dedup_table_roots,                &quot;    U: Dedup Table Roots&quot;)         \</span>
<span class="line-removed"> 91   f(update_string_dedup_queue_roots,                &quot;    U: Dedup Queue Roots&quot;)         \</span>
<span class="line-removed"> 92   f(update_finish_queues,                           &quot;    U: Finish Queues&quot;)             \</span>
<span class="line-removed"> 93                                                                                         \</span>
<span class="line-removed"> 94   f(finish_queues,                                  &quot;  Finish Queues&quot;)                  \</span>
<span class="line-removed"> 95   f(termination,                                    &quot;    Termination&quot;)                  \</span>
<span class="line-removed"> 96   f(weakrefs,                                       &quot;  Weak References&quot;)                \</span>
<span class="line-removed"> 97   f(weakrefs_process,                               &quot;    Process&quot;)                      \</span>
<span class="line-removed"> 98   f(weakrefs_termination,                           &quot;      Termination&quot;)                \</span>
<span class="line-removed"> 99   f(purge,                                          &quot;  System Purge&quot;)                   \</span>
<span class="line-removed">100   f(purge_class_unload,                             &quot;    Unload Classes&quot;)               \</span>
<span class="line-removed">101   f(purge_par,                                      &quot;    Parallel Cleanup&quot;)             \</span>
<span class="line-removed">102   f(purge_cldg,                                     &quot;    CLDG&quot;)                         \</span>
<span class="line-removed">103   f(complete_liveness,                              &quot;  Complete Liveness&quot;)              \</span>
<span class="line-removed">104   f(retire_tlabs,                                   &quot;  Retire TLABs&quot;)                   \</span>
<span class="line-removed">105   f(sync_pinned,                                    &quot;  Sync Pinned&quot;)                    \</span>
<span class="line-removed">106   f(trash_cset,                                     &quot;  Trash CSet&quot;)                     \</span>
<span class="line-removed">107   f(prepare_evac,                                   &quot;  Prepare Evacuation&quot;)             \</span>
<span class="line-removed">108                                                                                         \</span>
<span class="line-removed">109   /* Per-thread timer block, should have &quot;roots&quot; counters in consistent order */        \</span>
<span class="line-removed">110   f(init_evac,                                      &quot;  Initial Evacuation&quot;)             \</span>
<span class="line-removed">111   f(evac_thread_roots,                              &quot;    E: Thread Roots&quot;)              \</span>
<span class="line-removed">112   f(evac_code_roots,                                &quot;    E: Code Cache Roots&quot;)          \</span>
<span class="line-removed">113   f(evac_universe_roots,                            &quot;    E: Universe Roots&quot;)            \</span>
<span class="line-removed">114   f(evac_jni_roots,                                 &quot;    E: JNI Roots&quot;)                 \</span>
<span class="line-removed">115   f(evac_jvmti_weak_roots,                          &quot;    E: JVMTI Weak Roots&quot;)          \</span>
<span class="line-removed">116   f(evac_jfr_weak_roots,                            &quot;    E: JFR Weak Roots&quot;)            \</span>
<span class="line-removed">117   f(evac_jni_weak_roots,                            &quot;    E: JNI Weak Roots&quot;)            \</span>
<span class="line-removed">118   f(evac_stringtable_roots,                         &quot;    E: String Table Roots&quot;)        \</span>
<span class="line-removed">119   f(evac_resolved_method_table_roots,               &quot;    E: Resolved Table Roots&quot;)      \</span>
<span class="line-removed">120   f(evac_vm_global_roots,                           &quot;    E: VM Global Roots&quot;)           \</span>
<span class="line-removed">121   f(evac_vm_weak_roots,                             &quot;    E: VM Weak Roots&quot;)             \</span>
<span class="line-removed">122   f(evac_synchronizer_roots,                        &quot;    E: Synchronizer Roots&quot;)        \</span>
<span class="line-removed">123   f(evac_management_roots,                          &quot;    E: Management Roots&quot;)          \</span>
<span class="line-removed">124   f(evac_system_dictionary_roots,                   &quot;    E: System Dict Roots&quot;)         \</span>
<span class="line-removed">125   f(evac_cldg_roots,                                &quot;    E: CLDG Roots&quot;)                \</span>
<span class="line-removed">126   f(evac_jvmti_roots,                               &quot;    E: JVMTI Roots&quot;)               \</span>
<span class="line-removed">127   f(evac_string_dedup_table_roots,                  &quot;    E: String Dedup Table Roots&quot;)  \</span>
<span class="line-removed">128   f(evac_string_dedup_queue_roots,                  &quot;    E: String Dedup Queue Roots&quot;)  \</span>
<span class="line-removed">129   f(evac_finish_queues,                             &quot;    E: Finish Queues&quot;)             \</span>
<span class="line-removed">130                                                                                         \</span>
<span class="line-removed">131   f(final_evac_gross,                               &quot;Pause Final Evac (G)&quot;)             \</span>
<span class="line-removed">132   f(final_evac,                                     &quot;Pause Final Evac (N)&quot;)             \</span>
<span class="line-removed">133   f(final_evac_retire_gclabs,                       &quot;  Retire GCLABs&quot;)                  \</span>
<span class="line-removed">134                                                                                         \</span>
<span class="line-removed">135   f(init_update_refs_gross,                         &quot;Pause Init  Update Refs (G)&quot;)      \</span>
<span class="line-removed">136   f(init_update_refs,                               &quot;Pause Init  Update Refs (N)&quot;)      \</span>
<span class="line-removed">137   f(init_update_refs_retire_gclabs,                 &quot;  Retire GCLABs&quot;)                  \</span>
<span class="line-removed">138   f(init_update_refs_prepare,                       &quot;  Prepare&quot;)                        \</span>
<span class="line-removed">139                                                                                         \</span>
<span class="line-removed">140   f(final_update_refs_gross,                         &quot;Pause Final Update Refs (G)&quot;)     \</span>
<span class="line-removed">141   f(final_update_refs,                               &quot;Pause Final Update Refs (N)&quot;)     \</span>
<span class="line-removed">142   f(final_update_refs_finish_work,                   &quot;  Finish Work&quot;)                   \</span>
<span class="line-removed">143                                                                                         \</span>
<span class="line-removed">144   /* Per-thread timer block, should have &quot;roots&quot; counters in consistent order */        \</span>
<span class="line-removed">145   f(final_update_refs_roots,                         &quot;  Update Roots&quot;)                  \</span>
<span class="line-removed">146   f(final_update_refs_thread_roots,                  &quot;    UR: Thread Roots&quot;)            \</span>
<span class="line-removed">147   f(final_update_refs_code_roots,                    &quot;    UR: Code Cache Roots&quot;)        \</span>
<span class="line-removed">148   f(final_update_refs_universe_roots,                &quot;    UR: Universe Roots&quot;)          \</span>
<span class="line-removed">149   f(final_update_refs_jni_roots,                     &quot;    UR: JNI Roots&quot;)               \</span>
<span class="line-removed">150   f(final_update_jvmti_weak_roots,                   &quot;    UR: JVMTI Weak Roots&quot;)        \</span>
<span class="line-removed">151   f(final_update_jfr_weak_roots,                     &quot;    UR: JFR Weak Roots&quot;)          \</span>
<span class="line-removed">152   f(final_update_jni_weak_roots,                     &quot;    UR: JNI Weak Roots&quot;)          \</span>
<span class="line-removed">153   f(final_update_stringtable_roots,                  &quot;    UR: String Table Roots&quot;)      \</span>
<span class="line-removed">154   f(final_update_resolved_method_table_roots,        &quot;    UR: Resolved Table Roots&quot;)    \</span>
<span class="line-removed">155   f(final_update_vm_global_roots,                    &quot;    UR: VM Global Roots&quot;)         \</span>
<span class="line-removed">156   f(final_update_vm_weak_roots,                      &quot;    UR: VM Weak Roots&quot;)           \</span>
<span class="line-removed">157   f(final_update_refs_synchronizer_roots,            &quot;    UR: Synchronizer Roots&quot;)      \</span>
<span class="line-removed">158   f(final_update_refs_management_roots,              &quot;    UR: Management Roots&quot;)        \</span>
<span class="line-removed">159   f(final_update_refs_system_dict_roots,             &quot;    UR: System Dict Roots&quot;)       \</span>
<span class="line-removed">160   f(final_update_refs_cldg_roots,                    &quot;    UR: CLDG Roots&quot;)              \</span>
<span class="line-removed">161   f(final_update_refs_jvmti_roots,                   &quot;    UR: JVMTI Roots&quot;)             \</span>
<span class="line-removed">162   f(final_update_refs_string_dedup_table_roots,      &quot;    UR: Dedup Table Roots&quot;)       \</span>
<span class="line-removed">163   f(final_update_refs_string_dedup_queue_roots,      &quot;    UR: Dedup Queue Roots&quot;)       \</span>
<span class="line-removed">164   f(final_update_refs_finish_queues,                 &quot;    UR: Finish Queues&quot;)           \</span>
<span class="line-removed">165                                                                                         \</span>
<span class="line-removed">166   f(final_update_refs_sync_pinned,                   &quot;  Sync Pinned&quot;)                   \</span>
<span class="line-removed">167   f(final_update_refs_trash_cset,                    &quot;  Trash CSet&quot;)                    \</span>
<span class="line-removed">168                                                                                         \</span>
<span class="line-removed">169   f(degen_gc_gross,                                  &quot;Pause Degenerated GC (G)&quot;)        \</span>
<span class="line-removed">170   f(degen_gc,                                        &quot;Pause Degenerated GC (N)&quot;)        \</span>
<span class="line-removed">171                                                                                         \</span>
<span class="line-removed">172   /* Per-thread timer block, should have &quot;roots&quot; counters in consistent order */        \</span>
<span class="line-removed">173   f(degen_gc_update_roots,                           &quot;  Degen Update Roots&quot;)            \</span>
<span class="line-removed">174   f(degen_gc_update_thread_roots,                    &quot;    DU: Thread Roots&quot;)            \</span>
<span class="line-removed">175   f(degen_gc_update_code_roots,                      &quot;    DU: Code Cache Roots&quot;)        \</span>
<span class="line-removed">176   f(degen_gc_update_universe_roots,                  &quot;    DU: Universe Roots&quot;)          \</span>
<span class="line-removed">177   f(degen_gc_update_jni_roots,                       &quot;    DU: JNI Roots&quot;)               \</span>
<span class="line-removed">178   f(degen_gc_update_jvmti_weak_roots,                &quot;    DU: JVMTI Weak Roots&quot;)        \</span>
<span class="line-removed">179   f(degen_gc_update_jfr_weak_roots,                  &quot;    DU: JFR Weak Roots&quot;)          \</span>
<span class="line-removed">180   f(degen_gc_update_jni_weak_roots,                  &quot;    DU: JNI Weak Roots&quot;)          \</span>
<span class="line-removed">181   f(degen_gc_update_stringtable_roots,               &quot;    DU: String Table Roots&quot;)      \</span>
<span class="line-removed">182   f(degen_gc_update_resolved_method_table_roots,     &quot;    DU: Resolved Table Roots&quot;)    \</span>
<span class="line-removed">183   f(degen_gc_update_vm_global_roots,                 &quot;    DU: VM Global Roots&quot;)         \</span>
<span class="line-removed">184   f(degen_gc_update_vm_weak_roots,                   &quot;    DU: VM Weak Roots&quot;)           \</span>
<span class="line-removed">185   f(degen_gc_update_synchronizer_roots,              &quot;    DU: Synchronizer Roots&quot;)      \</span>
<span class="line-removed">186   f(degen_gc_update_management_roots,                &quot;    DU: Management Roots&quot;)        \</span>
<span class="line-removed">187   f(degen_gc_update_system_dict_roots,               &quot;    DU: System Dict Roots&quot;)       \</span>
<span class="line-removed">188   f(degen_gc_update_cldg_roots,                      &quot;    DU: CLDG Roots&quot;)              \</span>
<span class="line-removed">189   f(degen_gc_update_jvmti_roots,                     &quot;    DU: JVMTI Roots&quot;)             \</span>
<span class="line-removed">190   f(degen_gc_update_string_dedup_table_roots,        &quot;    DU: Dedup Table Roots&quot;)       \</span>
<span class="line-removed">191   f(degen_gc_update_string_dedup_queue_roots,        &quot;    DU: Dedup Queue Roots&quot;)       \</span>
<span class="line-removed">192   f(degen_gc_update_finish_queues,                   &quot;    DU: Finish Queues&quot;)           \</span>
<span class="line-removed">193                                                                                         \</span>
<span class="line-removed">194   f(init_traversal_gc_gross,                         &quot;Pause Init Traversal (G)&quot;)        \</span>
<span class="line-removed">195   f(init_traversal_gc,                               &quot;Pause Init Traversal (N)&quot;)        \</span>
<span class="line-removed">196   f(traversal_gc_prepare,                            &quot;  Prepare&quot;)                       \</span>
<span class="line-removed">197   f(traversal_gc_make_parsable,                      &quot;    Make Parsable&quot;)               \</span>
<span class="line-removed">198   f(traversal_gc_resize_tlabs,                       &quot;    Resize TLABs&quot;)                \</span>
<span class="line-removed">199   f(traversal_gc_prepare_sync_pinned,                &quot;    Sync Pinned&quot;)                 \</span>
<span class="line-removed">200                                                                                         \</span>
<span class="line-removed">201   /* Per-thread timer block, should have &quot;roots&quot; counters in consistent order */        \</span>
<span class="line-removed">202   f(init_traversal_gc_work,                          &quot;  Work&quot;)                          \</span>
<span class="line-removed">203   f(init_traversal_gc_thread_roots,                  &quot;    TI: Thread Roots&quot;)            \</span>
<span class="line-removed">204   f(init_traversal_gc_code_roots,                    &quot;    TI: Code Cache Roots&quot;)        \</span>
<span class="line-removed">205   f(init_traversal_gc_universe_roots,                &quot;    TI: Universe Roots&quot;)          \</span>
<span class="line-removed">206   f(init_traversal_gc_jni_roots,                     &quot;    TI: JNI Roots&quot;)               \</span>
<span class="line-removed">207   f(init_traversal_gc_jvmti_weak_roots,              &quot;    TI: JVMTI Weak Roots&quot;)        \</span>
<span class="line-removed">208   f(init_traversal_gc_jfr_weak_roots,                &quot;    TI: JFR Weak Roots&quot;)          \</span>
<span class="line-removed">209   f(init_traversal_gc_jni_weak_roots,                &quot;    TI: JNI Weak Roots&quot;)          \</span>
<span class="line-removed">210   f(init_traversal_gc_stringtable_roots,             &quot;    TI: String Table Roots&quot;)      \</span>
<span class="line-removed">211   f(init_traversal_gc_resolved_method_table_roots,   &quot;    TI: Resolved Table Roots&quot;)    \</span>
<span class="line-removed">212   f(init_traversal_gc_vm_global_roots,               &quot;    TI: VM Global Roots&quot;)         \</span>
<span class="line-removed">213   f(init_traversal_gc_vm_weak_roots,                 &quot;    TI: VM Weak Roots&quot;)           \</span>
<span class="line-removed">214   f(init_traversal_gc_synchronizer_roots,            &quot;    TI: Synchronizer Roots&quot;)      \</span>
<span class="line-removed">215   f(init_traversal_gc_management_roots,              &quot;    TI: Management Roots&quot;)        \</span>
<span class="line-removed">216   f(init_traversal_gc_system_dict_roots,             &quot;    TI: System Dict Roots&quot;)       \</span>
<span class="line-removed">217   f(init_traversal_gc_cldg_roots,                    &quot;    TI: CLDG Roots&quot;)              \</span>
<span class="line-removed">218   f(init_traversal_gc_jvmti_roots,                   &quot;    TI: JVMTI Roots&quot;)             \</span>
<span class="line-removed">219   f(init_traversal_gc_string_dedup_table_roots,      &quot;    TI: Dedup Table Roots&quot;)       \</span>
<span class="line-removed">220   f(init_traversal_gc_string_dedup_queue_roots,      &quot;    TI: Dedup Queue Roots&quot;)       \</span>
<span class="line-removed">221   f(init_traversal_gc_finish_queues,                 &quot;    TI: Finish Queues&quot;)           \</span>
<span class="line-removed">222                                                                                         \</span>
<span class="line-removed">223   f(final_traversal_gc_gross,                        &quot;Pause Final Traversal (G)&quot;)       \</span>
<span class="line-removed">224   f(final_traversal_gc,                              &quot;Pause Final Traversal (N)&quot;)       \</span>
<span class="line-removed">225                                                                                         \</span>
<span class="line-removed">226   /* Per-thread timer block, should have &quot;roots&quot; counters in consistent order */        \</span>
<span class="line-removed">227   f(final_traversal_gc_work,                         &quot;  Work&quot;)                          \</span>
<span class="line-removed">228   f(final_traversal_gc_thread_roots,                 &quot;    TF: Thread Roots&quot;)            \</span>
<span class="line-removed">229   f(final_traversal_gc_code_roots,                   &quot;    TF: Code Cache Roots&quot;)        \</span>
<span class="line-removed">230   f(final_traversal_gc_universe_roots,               &quot;    TF: Universe Roots&quot;)          \</span>
<span class="line-removed">231   f(final_traversal_gc_jni_roots,                    &quot;    TF: JNI Roots&quot;)               \</span>
<span class="line-removed">232   f(final_traversal_gc_jvmti_weak_roots,             &quot;    TF: JVMTI Weak Roots&quot;)        \</span>
<span class="line-removed">233   f(final_traversal_gc_jfr_weak_roots,               &quot;    TF: JFR Weak Roots&quot;)          \</span>
<span class="line-removed">234   f(final_traversal_gc_jni_weak_roots,               &quot;    TF: JNI Weak Roots&quot;)          \</span>
<span class="line-removed">235   f(final_traversal_gc_stringtable_roots,            &quot;    TF: String Table Roots&quot;)      \</span>
<span class="line-removed">236   f(final_traversal_gc_resolved_method_table_roots,  &quot;    TF: Resolved Table Roots&quot;)    \</span>
<span class="line-removed">237   f(final_traversal_gc_vm_global_roots,              &quot;    TF: VM Global Roots&quot;)         \</span>
<span class="line-removed">238   f(final_traversal_gc_vm_weak_roots,                &quot;    TF: VM Weak Roots&quot;)           \</span>
<span class="line-removed">239   f(final_traversal_gc_synchronizer_roots,           &quot;    TF: Synchronizer Roots&quot;)      \</span>
<span class="line-removed">240   f(final_traversal_gc_management_roots,             &quot;    TF: Management Roots&quot;)        \</span>
<span class="line-removed">241   f(final_traversal_gc_system_dict_roots,            &quot;    TF: System Dict Roots&quot;)       \</span>
<span class="line-removed">242   f(final_traversal_gc_cldg_roots,                   &quot;    TF: CLDG Roots&quot;)              \</span>
<span class="line-removed">243   f(final_traversal_gc_jvmti_roots,                  &quot;    TF: JVMTI Roots&quot;)             \</span>
<span class="line-removed">244   f(final_traversal_gc_string_dedup_table_roots,     &quot;    TF: Dedup Table Roots&quot;)       \</span>
<span class="line-removed">245   f(final_traversal_gc_string_dedup_queue_roots,     &quot;    TF: Dedup Queue Roots&quot;)       \</span>
<span class="line-removed">246   f(final_traversal_gc_finish_queues,                &quot;    TF: Finish Queues&quot;)           \</span>
<span class="line-removed">247   f(final_traversal_gc_termination,                  &quot;    TF:   Termination&quot;)           \</span>
<span class="line-removed">248                                                                                         \</span>
<span class="line-removed">249   /* Per-thread timer block, should have &quot;roots&quot; counters in consistent order */        \</span>
<span class="line-removed">250   f(final_traversal_update_roots,                       &quot;  Update Roots&quot;)               \</span>
<span class="line-removed">251   f(final_traversal_update_thread_roots,                &quot;    TU: Thread Roots&quot;)         \</span>
<span class="line-removed">252   f(final_traversal_update_code_roots,                  &quot;    TU: Code Cache Roots&quot;)     \</span>
<span class="line-removed">253   f(final_traversal_update_universe_roots,              &quot;    TU: Universe Roots&quot;)       \</span>
<span class="line-removed">254   f(final_traversal_update_jni_roots,                   &quot;    TU: JNI Roots&quot;)            \</span>
<span class="line-removed">255   f(final_traversal_update_jvmti_weak_roots,            &quot;    TU: JVMTI Weak Roots&quot;)     \</span>
<span class="line-removed">256   f(final_traversal_update_jfr_weak_roots,              &quot;    TU: JFR Weak Roots&quot;)       \</span>
<span class="line-removed">257   f(final_traversal_update_jni_weak_roots,              &quot;    TU: JNI Weak Roots&quot;)       \</span>
<span class="line-removed">258   f(final_traversal_update_stringtable_roots,           &quot;    TU: String Table Roots&quot;)   \</span>
<span class="line-removed">259   f(final_traversal_update_resolved_method_table_roots, &quot;    TU: Resolved Table Roots&quot;) \</span>
<span class="line-removed">260   f(final_traversal_update_vm_global_roots,             &quot;    TU: VM Global Roots&quot;)      \</span>
<span class="line-removed">261   f(final_traversal_update_vm_weak_roots,               &quot;    TU: VM Weak Roots&quot;)        \</span>
<span class="line-removed">262   f(final_traversal_update_synchronizer_roots,          &quot;    TU: Synchronizer Roots&quot;)   \</span>
<span class="line-removed">263   f(final_traversal_update_management_roots,            &quot;    TU: Management Roots&quot;)     \</span>
<span class="line-removed">264   f(final_traversal_update_system_dict_roots,           &quot;    TU: System Dict Roots&quot;)    \</span>
<span class="line-removed">265   f(final_traversal_update_cldg_roots,                  &quot;    TU: CLDG Roots&quot;)           \</span>
<span class="line-removed">266   f(final_traversal_update_jvmti_roots,                 &quot;    TU: JVMTI Roots&quot;)          \</span>
<span class="line-removed">267   f(final_traversal_update_string_dedup_table_roots,    &quot;    TU: Dedup Table Roots&quot;)    \</span>
<span class="line-removed">268   f(final_traversal_update_string_dedup_queue_roots,    &quot;    TU: Dedup Queue Roots&quot;)    \</span>
<span class="line-removed">269   f(final_traversal_update_finish_queues,               &quot;    TU: Finish Queues&quot;)        \</span>
<span class="line-removed">270                                                                                         \</span>
<span class="line-removed">271   f(traversal_gc_sync_pinned,                        &quot;  Sync Pinned&quot;)                   \</span>
<span class="line-removed">272   f(traversal_gc_cleanup,                            &quot;  Cleanup&quot;)                       \</span>
<span class="line-removed">273                                                                                         \</span>
<span class="line-removed">274   f(full_gc_gross,                                   &quot;Pause Full GC (G)&quot;)               \</span>
<span class="line-removed">275   f(full_gc,                                         &quot;Pause Full GC (N)&quot;)               \</span>
<span class="line-removed">276   f(full_gc_heapdumps,                               &quot;  Heap Dumps&quot;)                    \</span>
<span class="line-removed">277   f(full_gc_prepare,                                 &quot;  Prepare&quot;)                       \</span>
<span class="line-removed">278                                                                                         \</span>
<span class="line-removed">279   /* Per-thread timer block, should have &quot;roots&quot; counters in consistent order */        \</span>
<span class="line-removed">280   f(full_gc_roots,                                   &quot;  Roots&quot;)                         \</span>
<span class="line-removed">281   f(full_gc_thread_roots,                            &quot;    F: Thread Roots&quot;)             \</span>
<span class="line-removed">282   f(full_gc_code_roots,                              &quot;    F: Code Cache Roots&quot;)         \</span>
<span class="line-removed">283   f(full_gc_universe_roots,                          &quot;    F: Universe Roots&quot;)           \</span>
<span class="line-removed">284   f(full_gc_jni_roots,                               &quot;    F: JNI Roots&quot;)                \</span>
<span class="line-removed">285   f(full_gc_jvmti_weak_roots,                        &quot;    F: JVMTI Weak Roots&quot;)         \</span>
<span class="line-removed">286   f(full_gc_jfr_weak_roots,                          &quot;    F: JFR Weak Roots&quot;)           \</span>
<span class="line-removed">287   f(full_gc_jni_weak_roots,                          &quot;    F: JNI Weak Roots&quot;)           \</span>
<span class="line-removed">288   f(full_gc_stringtable_roots,                       &quot;    F: String Table Roots&quot;)       \</span>
<span class="line-removed">289   f(full_gc_resolved_method_table_roots,             &quot;    F: Resolved Table Roots&quot;)     \</span>
<span class="line-removed">290   f(full_gc_vm_global_roots,                         &quot;    F: VM Global Roots&quot;)          \</span>
<span class="line-removed">291   f(full_gc_vm_weak_roots,                           &quot;    F: VM Weak Roots&quot;)            \</span>
<span class="line-removed">292   f(full_gc_synchronizer_roots,                      &quot;    F: Synchronizer Roots&quot;)       \</span>
<span class="line-removed">293   f(full_gc_management_roots,                        &quot;    F: Management Roots&quot;)         \</span>
<span class="line-removed">294   f(full_gc_system_dictionary_roots,                 &quot;    F: System Dict Roots&quot;)        \</span>
<span class="line-removed">295   f(full_gc_cldg_roots,                              &quot;    F: CLDG Roots&quot;)               \</span>
<span class="line-removed">296   f(full_gc_jvmti_roots,                             &quot;    F: JVMTI Roots&quot;)              \</span>
<span class="line-removed">297   f(full_gc_string_dedup_table_roots,                &quot;    F: Dedup Table Roots&quot;)        \</span>
<span class="line-removed">298   f(full_gc_string_dedup_queue_roots,                &quot;    F: Dedup Queue Roots&quot;)        \</span>
<span class="line-removed">299   f(full_gc_finish_queues,                           &quot;    F: Finish Queues&quot;)            \</span>
<span class="line-removed">300                                                                                         \</span>
<span class="line-removed">301   f(full_gc_mark,                                    &quot;  Mark&quot;)                          \</span>
<span class="line-removed">302   f(full_gc_mark_finish_queues,                      &quot;    Finish Queues&quot;)               \</span>
<span class="line-removed">303   f(full_gc_mark_termination,                        &quot;      Termination&quot;)               \</span>
<span class="line-removed">304   f(full_gc_weakrefs,                                &quot;    Weak References&quot;)             \</span>
<span class="line-removed">305   f(full_gc_weakrefs_process,                        &quot;      Process&quot;)                   \</span>
<span class="line-removed">306   f(full_gc_weakrefs_termination,                    &quot;        Termination&quot;)             \</span>
<span class="line-removed">307   f(full_gc_purge,                                   &quot;    System Purge&quot;)                \</span>
<span class="line-removed">308   f(full_gc_purge_class_unload,                      &quot;      Unload Classes&quot;)            \</span>
<span class="line-removed">309   f(full_gc_purge_par,                               &quot;    Parallel Cleanup&quot;)            \</span>
<span class="line-removed">310   f(full_gc_purge_cldg,                              &quot;    CLDG&quot;)                        \</span>
<span class="line-removed">311   f(full_gc_calculate_addresses,                     &quot;  Calculate Addresses&quot;)           \</span>
<span class="line-removed">312   f(full_gc_calculate_addresses_regular,             &quot;    Regular Objects&quot;)             \</span>
<span class="line-removed">313   f(full_gc_calculate_addresses_humong,              &quot;    Humongous Objects&quot;)           \</span>
<span class="line-removed">314   f(full_gc_adjust_pointers,                         &quot;  Adjust Pointers&quot;)               \</span>
<span class="line-removed">315   f(full_gc_copy_objects,                            &quot;  Copy Objects&quot;)                  \</span>
<span class="line-removed">316   f(full_gc_copy_objects_regular,                    &quot;    Regular Objects&quot;)             \</span>
<span class="line-removed">317   f(full_gc_copy_objects_humong,                     &quot;    Humongous Objects&quot;)           \</span>
<span class="line-removed">318   f(full_gc_copy_objects_reset_complete,             &quot;    Reset Complete Bitmap&quot;)       \</span>
<span class="line-removed">319   f(full_gc_copy_objects_rebuild,                    &quot;    Rebuild Region Sets&quot;)         \</span>
<span class="line-removed">320   f(full_gc_resize_tlabs,                            &quot;  Resize TLABs&quot;)                  \</span>
<span class="line-removed">321                                                                                         \</span>
<span class="line-removed">322   /* Longer concurrent phases at the end */                                             \</span>
<span class="line-removed">323   f(conc_reset,                                      &quot;Concurrent Reset&quot;)                \</span>
<span class="line-removed">324   f(conc_mark,                                       &quot;Concurrent Marking&quot;)              \</span>
<span class="line-removed">325   f(conc_termination,                                &quot;  Termination&quot;)                   \</span>
<span class="line-removed">326   f(conc_preclean,                                   &quot;Concurrent Precleaning&quot;)          \</span>
<span class="line-removed">327   f(conc_roots,                                      &quot;Concurrent Roots&quot;)                \</span>
<span class="line-removed">328   f(conc_evac,                                       &quot;Concurrent Evacuation&quot;)           \</span>
<span class="line-removed">329   f(conc_update_refs,                                &quot;Concurrent Update Refs&quot;)          \</span>
<span class="line-removed">330   f(conc_cleanup,                                    &quot;Concurrent Cleanup&quot;)              \</span>
<span class="line-removed">331   f(conc_traversal,                                  &quot;Concurrent Traversal&quot;)            \</span>
<span class="line-removed">332   f(conc_traversal_termination,                      &quot;  Termination&quot;)                   \</span>
<span class="line-removed">333                                                                                         \</span>
<span class="line-removed">334   f(conc_uncommit,                                   &quot;Concurrent Uncommit&quot;)             \</span>
<span class="line-removed">335                                                                                         \</span>
<span class="line-removed">336   /* Unclassified */                                                                    \</span>
<span class="line-removed">337   f(pause_other,                                     &quot;Pause Other&quot;)                     \</span>
<span class="line-removed">338   f(conc_other,                                      &quot;Concurrent Other&quot;)                \</span>
339   // end
340 
<span class="line-modified">341 #define SHENANDOAH_GC_PAR_PHASE_DO(f)                           \</span>
<span class="line-modified">342   f(ThreadRoots,              &quot;Thread Roots (ms):&quot;)              \</span>
<span class="line-modified">343   f(CodeCacheRoots,           &quot;CodeCache Roots (ms):&quot;)           \</span>
<span class="line-modified">344   f(UniverseRoots,            &quot;Universe Roots (ms):&quot;)            \</span>
<span class="line-modified">345   f(JNIRoots,                 &quot;JNI Handles Roots (ms):&quot;)         \</span>
<span class="line-modified">346   f(JVMTIWeakRoots,           &quot;JVMTI Weak Roots (ms):&quot;)          \</span>
<span class="line-modified">347   f(JFRWeakRoots,             &quot;JFR Weak Roots (ms):&quot;)            \</span>
<span class="line-modified">348   f(JNIWeakRoots,             &quot;JNI Weak Roots (ms):&quot;)            \</span>
<span class="line-modified">349   f(StringTableRoots,         &quot;StringTable Roots(ms):&quot;)          \</span>
<span class="line-modified">350   f(ResolvedMethodTableRoots, &quot;Resolved Table Roots(ms):&quot;)       \</span>
<span class="line-modified">351   f(VMGlobalRoots,            &quot;VM Global Roots(ms)&quot;)             \</span>
<span class="line-modified">352   f(VMWeakRoots,              &quot;VM Weak Roots(ms)&quot;)               \</span>
<span class="line-modified">353   f(ObjectSynchronizerRoots,  &quot;ObjectSynchronizer Roots (ms):&quot;)  \</span>
<span class="line-modified">354   f(ManagementRoots,          &quot;Management Roots (ms):&quot;)          \</span>
<span class="line-modified">355   f(SystemDictionaryRoots,    &quot;SystemDictionary Roots (ms):&quot;)    \</span>
<span class="line-modified">356   f(CLDGRoots,                &quot;CLDG Roots (ms):&quot;)                \</span>
<span class="line-modified">357   f(JVMTIRoots,               &quot;JVMTI Roots (ms):&quot;)               \</span>
<span class="line-modified">358   f(StringDedupTableRoots,    &quot;String Dedup Table Roots (ms):&quot;)  \</span>
<span class="line-modified">359   f(StringDedupQueueRoots,    &quot;String Dedup Queue Roots (ms):&quot;)  \</span>
<span class="line-modified">360   f(FinishQueues,             &quot;Finish Queues (ms):&quot;)             \</span>

























































































361   // end
362 
363 class ShenandoahPhaseTimings : public CHeapObj&lt;mtGC&gt; {
364 public:
365 #define GC_PHASE_DECLARE_ENUM(type, title)   type,
366 
367   enum Phase {
368     SHENANDOAH_GC_PHASE_DO(GC_PHASE_DECLARE_ENUM)
<span class="line-modified">369     _num_phases</span>

370   };
371 
<span class="line-removed">372   // These are the subphases of GC phases (scan_roots, update_roots,</span>
<span class="line-removed">373   // init_evac, final_update_refs_roots and full_gc_roots).</span>
<span class="line-removed">374   // Make sure they are following this order.</span>
375   enum GCParPhases {
<span class="line-modified">376     SHENANDOAH_GC_PAR_PHASE_DO(GC_PHASE_DECLARE_ENUM)</span>
377     GCParPhasesSentinel
378   };
379 
380 #undef GC_PHASE_DECLARE_ENUM
381 
382 private:
<span class="line-modified">383   struct TimingData {</span>
<span class="line-removed">384     HdrSeq _secs;</span>
<span class="line-removed">385     double _start;</span>
<span class="line-removed">386   };</span>
<span class="line-removed">387 </span>
<span class="line-removed">388 private:</span>
<span class="line-removed">389   TimingData          _timing_data[_num_phases];</span>
390   static const char*  _phase_names[_num_phases];
391 
<span class="line-modified">392   ShenandoahWorkerTimings*      _worker_times;</span>
<span class="line-removed">393   ShenandoahTerminationTimings* _termination_times;</span>
<span class="line-removed">394 </span>
395   ShenandoahCollectorPolicy* _policy;
396 
397 public:
398   ShenandoahPhaseTimings();
399 
<span class="line-removed">400   ShenandoahWorkerTimings* const worker_times() const { return _worker_times; }</span>
<span class="line-removed">401   ShenandoahTerminationTimings* const termination_times() const { return _termination_times; }</span>
<span class="line-removed">402 </span>
<span class="line-removed">403   // record phase start</span>
<span class="line-removed">404   void record_phase_start(Phase phase);</span>
<span class="line-removed">405   // record phase end and return elapsed time in seconds for the phase</span>
<span class="line-removed">406   void record_phase_end(Phase phase);</span>
<span class="line-removed">407   // record an elapsed time for the phase</span>
408   void record_phase_time(Phase phase, double time);

409 
410   void record_workers_start(Phase phase);
411   void record_workers_end(Phase phase);
412 
413   static const char* phase_name(Phase phase) {
414     assert(phase &gt;= 0 &amp;&amp; phase &lt; _num_phases, &quot;Out of bound&quot;);
415     return _phase_names[phase];
416   }
417 
418   void print_on(outputStream* out) const;
<span class="line-removed">419 </span>
<span class="line-removed">420 private:</span>
<span class="line-removed">421   void init_phase_names();</span>
<span class="line-removed">422   void print_summary_sd(outputStream* out, const char* str, const HdrSeq* seq) const;</span>
423 };
424 
<span class="line-modified">425 class ShenandoahWorkerTimings : public CHeapObj&lt;mtGC&gt; {</span>
426 private:
<span class="line-modified">427   uint _max_gc_threads;</span>
<span class="line-modified">428   WorkerDataArray&lt;double&gt;* _gc_par_phases[ShenandoahPhaseTimings::GCParPhasesSentinel];</span>
<span class="line-modified">429 </span>
<span class="line-removed">430 public:</span>
<span class="line-removed">431   ShenandoahWorkerTimings(uint max_gc_threads);</span>
<span class="line-removed">432 </span>
<span class="line-removed">433   // record the time a phase took in seconds</span>
<span class="line-removed">434   void record_time_secs(ShenandoahPhaseTimings::GCParPhases phase, uint worker_i, double secs);</span>
<span class="line-removed">435 </span>
<span class="line-removed">436   double average(uint i) const;</span>
<span class="line-removed">437   void reset(uint i);</span>
<span class="line-removed">438   void print() const;</span>
<span class="line-removed">439 };</span>
440 
<span class="line-modified">441 class ShenandoahTerminationTimings : public CHeapObj&lt;mtGC&gt; {</span>
<span class="line-modified">442 private:</span>
<span class="line-removed">443   WorkerDataArray&lt;double&gt;* _gc_termination_phase;</span>
444 public:
<span class="line-modified">445   ShenandoahTerminationTimings(uint max_gc_threads);</span>
<span class="line-modified">446 </span>
<span class="line-removed">447   // record the time a phase took in seconds</span>
<span class="line-removed">448   void record_time_secs(uint worker_i, double secs);</span>
<span class="line-removed">449 </span>
<span class="line-removed">450   double average() const;</span>
<span class="line-removed">451   void reset();</span>
<span class="line-removed">452 </span>
<span class="line-removed">453   void print() const;</span>
454 };
455 
456 #endif // SHARE_GC_SHENANDOAH_SHENANDOAHPHASETIMINGS_HPP
</pre>
</td>
<td>
<hr />
<pre>
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 
 25 #ifndef SHARE_GC_SHENANDOAH_SHENANDOAHPHASETIMINGS_HPP
 26 #define SHARE_GC_SHENANDOAH_SHENANDOAHPHASETIMINGS_HPP
 27 
<span class="line-added"> 28 #include &quot;jfr/jfrEvents.hpp&quot;</span>
 29 #include &quot;gc/shenandoah/shenandoahNumberSeq.hpp&quot;
 30 #include &quot;gc/shared/workerDataArray.hpp&quot;
 31 #include &quot;memory/allocation.hpp&quot;
 32 
 33 class ShenandoahCollectorPolicy;


 34 class outputStream;
 35 
<span class="line-modified"> 36 #define SHENANDOAH_GC_PAR_PHASE_DO(CNT_PREFIX, DESC_PREFIX, f)                         \</span>
<span class="line-modified"> 37   f(CNT_PREFIX ## ThreadRoots,              DESC_PREFIX &quot;Thread Roots&quot;)                \</span>
<span class="line-modified"> 38   f(CNT_PREFIX ## CodeCacheRoots,           DESC_PREFIX &quot;Code Cache Roots&quot;)            \</span>
<span class="line-modified"> 39   f(CNT_PREFIX ## UniverseRoots,            DESC_PREFIX &quot;Universe Roots&quot;)              \</span>
<span class="line-modified"> 40   f(CNT_PREFIX ## JNIRoots,                 DESC_PREFIX &quot;JNI Handles Roots&quot;)           \</span>
<span class="line-modified"> 41   f(CNT_PREFIX ## JVMTIWeakRoots,           DESC_PREFIX &quot;JVMTI Weak Roots&quot;)            \</span>
<span class="line-modified"> 42   f(CNT_PREFIX ## JFRWeakRoots,             DESC_PREFIX &quot;JFR Weak Roots&quot;)              \</span>
<span class="line-modified"> 43   f(CNT_PREFIX ## JNIWeakRoots,             DESC_PREFIX &quot;JNI Weak Roots&quot;)              \</span>
<span class="line-modified"> 44   f(CNT_PREFIX ## StringTableRoots,         DESC_PREFIX &quot;String Table Roots&quot;)          \</span>
<span class="line-modified"> 45   f(CNT_PREFIX ## ResolvedMethodTableRoots, DESC_PREFIX &quot;Resolved Table Roots&quot;)        \</span>
<span class="line-modified"> 46   f(CNT_PREFIX ## VMGlobalRoots,            DESC_PREFIX &quot;VM Global Roots&quot;)             \</span>
<span class="line-modified"> 47   f(CNT_PREFIX ## VMWeakRoots,              DESC_PREFIX &quot;VM Weak Roots&quot;)               \</span>
<span class="line-modified"> 48   f(CNT_PREFIX ## ObjectSynchronizerRoots,  DESC_PREFIX &quot;Synchronizer Roots&quot;)          \</span>
<span class="line-modified"> 49   f(CNT_PREFIX ## ManagementRoots,          DESC_PREFIX &quot;Management Roots&quot;)            \</span>
<span class="line-modified"> 50   f(CNT_PREFIX ## SystemDictionaryRoots,    DESC_PREFIX &quot;System Dict Roots&quot;)           \</span>
<span class="line-modified"> 51   f(CNT_PREFIX ## CLDGRoots,                DESC_PREFIX &quot;CLDG Roots&quot;)                  \</span>
<span class="line-modified"> 52   f(CNT_PREFIX ## JVMTIRoots,               DESC_PREFIX &quot;JVMTI Roots&quot;)                 \</span>
<span class="line-modified"> 53   f(CNT_PREFIX ## StringDedupTableRoots,    DESC_PREFIX &quot;Dedup Table Roots&quot;)           \</span>
<span class="line-modified"> 54   f(CNT_PREFIX ## StringDedupQueueRoots,    DESC_PREFIX &quot;Dedup Queue Roots&quot;)           \</span>
<span class="line-modified"> 55   f(CNT_PREFIX ## FinishQueues,             DESC_PREFIX &quot;Finish Queues&quot;)               \</span>


























































































































































































































































































 56   // end
 57 
<span class="line-modified"> 58 #define SHENANDOAH_GC_PHASE_DO(f)                                                      \</span>
<span class="line-modified"> 59   f(total_pause_gross,                              &quot;Total Pauses (G)&quot;)                \</span>
<span class="line-modified"> 60   f(total_pause,                                    &quot;Total Pauses (N)&quot;)                \</span>
<span class="line-modified"> 61                                                                                        \</span>
<span class="line-modified"> 62   f(init_mark_gross,                                &quot;Pause Init Mark (G)&quot;)             \</span>
<span class="line-modified"> 63   f(init_mark,                                      &quot;Pause Init Mark (N)&quot;)             \</span>
<span class="line-modified"> 64   f(make_parsable,                                  &quot;  Make Parsable&quot;)                 \</span>
<span class="line-modified"> 65   f(clear_liveness,                                 &quot;  Clear Liveness&quot;)                \</span>
<span class="line-modified"> 66   f(scan_roots,                                     &quot;  Scan Roots&quot;)                    \</span>
<span class="line-modified"> 67   SHENANDOAH_GC_PAR_PHASE_DO(scan_,                 &quot;    S: &quot;, f)                      \</span>
<span class="line-modified"> 68   f(resize_tlabs,                                   &quot;  Resize TLABs&quot;)                  \</span>
<span class="line-modified"> 69                                                                                        \</span>
<span class="line-modified"> 70   f(final_mark_gross,                               &quot;Pause Final Mark (G)&quot;)            \</span>
<span class="line-modified"> 71   f(final_mark,                                     &quot;Pause Final Mark (N)&quot;)            \</span>
<span class="line-modified"> 72   f(update_roots,                                   &quot;  Update Roots&quot;)                  \</span>
<span class="line-modified"> 73   SHENANDOAH_GC_PAR_PHASE_DO(update_,               &quot;    U: &quot;, f)                      \</span>
<span class="line-modified"> 74   f(finish_queues,                                  &quot;  Finish Queues&quot;)                 \</span>
<span class="line-modified"> 75   f(weakrefs,                                       &quot;  Weak References&quot;)               \</span>
<span class="line-modified"> 76   f(weakrefs_process,                               &quot;    Process&quot;)                     \</span>
<span class="line-modified"> 77   f(purge,                                          &quot;  System Purge&quot;)                  \</span>
<span class="line-added"> 78   f(purge_class_unload,                             &quot;    Unload Classes&quot;)              \</span>
<span class="line-added"> 79   f(purge_par,                                      &quot;    Parallel Cleanup&quot;)            \</span>
<span class="line-added"> 80   SHENANDOAH_GC_PAR_PHASE_DO(purge_par_roots,       &quot;      PC: &quot;, f)                   \</span>
<span class="line-added"> 81   f(purge_cldg,                                     &quot;    CLDG&quot;)                        \</span>
<span class="line-added"> 82   f(complete_liveness,                              &quot;  Complete Liveness&quot;)             \</span>
<span class="line-added"> 83   f(retire_tlabs,                                   &quot;  Retire TLABs&quot;)                  \</span>
<span class="line-added"> 84   f(sync_pinned,                                    &quot;  Sync Pinned&quot;)                   \</span>
<span class="line-added"> 85   f(trash_cset,                                     &quot;  Trash CSet&quot;)                    \</span>
<span class="line-added"> 86   f(prepare_evac,                                   &quot;  Prepare Evacuation&quot;)            \</span>
<span class="line-added"> 87   f(init_evac,                                      &quot;  Initial Evacuation&quot;)            \</span>
<span class="line-added"> 88   SHENANDOAH_GC_PAR_PHASE_DO(evac_,                 &quot;    E: &quot;, f)                      \</span>
<span class="line-added"> 89                                                                                        \</span>
<span class="line-added"> 90   f(init_update_refs_gross,                         &quot;Pause Init  Update Refs (G)&quot;)     \</span>
<span class="line-added"> 91   f(init_update_refs,                               &quot;Pause Init  Update Refs (N)&quot;)     \</span>
<span class="line-added"> 92   f(init_update_refs_retire_gclabs,                 &quot;  Retire GCLABs&quot;)                 \</span>
<span class="line-added"> 93   f(init_update_refs_prepare,                       &quot;  Prepare&quot;)                       \</span>
<span class="line-added"> 94                                                                                        \</span>
<span class="line-added"> 95   f(final_update_refs_gross,                        &quot;Pause Final Update Refs (G)&quot;)     \</span>
<span class="line-added"> 96   f(final_update_refs,                              &quot;Pause Final Update Refs (N)&quot;)     \</span>
<span class="line-added"> 97   f(final_update_refs_finish_work,                  &quot;  Finish Work&quot;)                   \</span>
<span class="line-added"> 98   f(final_update_refs_roots,                        &quot;  Update Roots&quot;)                  \</span>
<span class="line-added"> 99   SHENANDOAH_GC_PAR_PHASE_DO(final_update_,         &quot;    UR: &quot;, f)                     \</span>
<span class="line-added">100   f(final_update_refs_sync_pinned,                  &quot;  Sync Pinned&quot;)                   \</span>
<span class="line-added">101   f(final_update_refs_trash_cset,                   &quot;  Trash CSet&quot;)                    \</span>
<span class="line-added">102                                                                                        \</span>
<span class="line-added">103   f(degen_gc_gross,                                 &quot;Pause Degenerated GC (G)&quot;)        \</span>
<span class="line-added">104   f(degen_gc,                                       &quot;Pause Degenerated GC (N)&quot;)        \</span>
<span class="line-added">105   f(degen_gc_update_roots,                          &quot;  Degen Update Roots&quot;)            \</span>
<span class="line-added">106   SHENANDOAH_GC_PAR_PHASE_DO(degen_gc_update_,      &quot;    DU: &quot;, f)                     \</span>
<span class="line-added">107                                                                                        \</span>
<span class="line-added">108   f(init_traversal_gc_gross,                        &quot;Pause Init Traversal (G)&quot;)        \</span>
<span class="line-added">109   f(init_traversal_gc,                              &quot;Pause Init Traversal (N)&quot;)        \</span>
<span class="line-added">110   f(traversal_gc_prepare,                           &quot;  Prepare&quot;)                       \</span>
<span class="line-added">111   f(traversal_gc_make_parsable,                     &quot;    Make Parsable&quot;)               \</span>
<span class="line-added">112   f(traversal_gc_resize_tlabs,                      &quot;    Resize TLABs&quot;)                \</span>
<span class="line-added">113   f(traversal_gc_prepare_sync_pinned,               &quot;    Sync Pinned&quot;)                 \</span>
<span class="line-added">114   f(init_traversal_gc_work,                         &quot;  Work&quot;)                          \</span>
<span class="line-added">115   SHENANDOAH_GC_PAR_PHASE_DO(init_traversal_,       &quot;    TI: &quot;, f)                     \</span>
<span class="line-added">116                                                                                        \</span>
<span class="line-added">117   f(final_traversal_gc_gross,                       &quot;Pause Final Traversal (G)&quot;)       \</span>
<span class="line-added">118   f(final_traversal_gc,                             &quot;Pause Final Traversal (N)&quot;)       \</span>
<span class="line-added">119   f(final_traversal_gc_work,                        &quot;  Work&quot;)                          \</span>
<span class="line-added">120   SHENANDOAH_GC_PAR_PHASE_DO(final_trav_gc_,        &quot;    TF: &quot;, f)                     \</span>
<span class="line-added">121   f(final_traversal_update_roots,                   &quot;  Update Roots&quot;)                  \</span>
<span class="line-added">122   SHENANDOAH_GC_PAR_PHASE_DO(final_trav_update_,    &quot;    TU: &quot;, f)                     \</span>
<span class="line-added">123   f(traversal_gc_sync_pinned,                       &quot;  Sync Pinned&quot;)                   \</span>
<span class="line-added">124   f(traversal_gc_cleanup,                           &quot;  Cleanup&quot;)                       \</span>
<span class="line-added">125                                                                                        \</span>
<span class="line-added">126   f(full_gc_gross,                                  &quot;Pause Full GC (G)&quot;)               \</span>
<span class="line-added">127   f(full_gc,                                        &quot;Pause Full GC (N)&quot;)               \</span>
<span class="line-added">128   f(full_gc_heapdumps,                              &quot;  Heap Dumps&quot;)                    \</span>
<span class="line-added">129   f(full_gc_prepare,                                &quot;  Prepare&quot;)                       \</span>
<span class="line-added">130   f(full_gc_roots,                                  &quot;  Roots&quot;)                         \</span>
<span class="line-added">131   SHENANDOAH_GC_PAR_PHASE_DO(full_gc_,              &quot;    F: &quot;, f)                      \</span>
<span class="line-added">132   f(full_gc_mark,                                   &quot;  Mark&quot;)                          \</span>
<span class="line-added">133   f(full_gc_mark_finish_queues,                     &quot;    Finish Queues&quot;)               \</span>
<span class="line-added">134   f(full_gc_weakrefs,                               &quot;    Weak References&quot;)             \</span>
<span class="line-added">135   f(full_gc_weakrefs_process,                       &quot;      Process&quot;)                   \</span>
<span class="line-added">136   f(full_gc_purge,                                  &quot;    System Purge&quot;)                \</span>
<span class="line-added">137   f(full_gc_purge_class_unload,                     &quot;      Unload Classes&quot;)            \</span>
<span class="line-added">138   f(full_gc_purge_par,                              &quot;    Parallel Cleanup&quot;)            \</span>
<span class="line-added">139   SHENANDOAH_GC_PAR_PHASE_DO(full_gc_purge_roots,   &quot;      PC: &quot;, f)                   \</span>
<span class="line-added">140   f(full_gc_purge_cldg,                             &quot;    CLDG&quot;)                        \</span>
<span class="line-added">141   f(full_gc_calculate_addresses,                    &quot;  Calculate Addresses&quot;)           \</span>
<span class="line-added">142   f(full_gc_calculate_addresses_regular,            &quot;    Regular Objects&quot;)             \</span>
<span class="line-added">143   f(full_gc_calculate_addresses_humong,             &quot;    Humongous Objects&quot;)           \</span>
<span class="line-added">144   f(full_gc_adjust_pointers,                        &quot;  Adjust Pointers&quot;)               \</span>
<span class="line-added">145   f(full_gc_copy_objects,                           &quot;  Copy Objects&quot;)                  \</span>
<span class="line-added">146   f(full_gc_copy_objects_regular,                   &quot;    Regular Objects&quot;)             \</span>
<span class="line-added">147   f(full_gc_copy_objects_humong,                    &quot;    Humongous Objects&quot;)           \</span>
<span class="line-added">148   f(full_gc_copy_objects_reset_complete,            &quot;    Reset Complete Bitmap&quot;)       \</span>
<span class="line-added">149   f(full_gc_copy_objects_rebuild,                   &quot;    Rebuild Region Sets&quot;)         \</span>
<span class="line-added">150   f(full_gc_resize_tlabs,                           &quot;  Resize TLABs&quot;)                  \</span>
<span class="line-added">151                                                                                        \</span>
<span class="line-added">152   /* Longer concurrent phases at the end */                                            \</span>
<span class="line-added">153   f(conc_reset,                                     &quot;Concurrent Reset&quot;)                \</span>
<span class="line-added">154   f(conc_mark,                                      &quot;Concurrent Marking&quot;)              \</span>
<span class="line-added">155   f(conc_preclean,                                  &quot;Concurrent Precleaning&quot;)          \</span>
<span class="line-added">156   f(conc_roots,                                     &quot;Concurrent Roots&quot;)                \</span>
<span class="line-added">157   f(conc_evac,                                      &quot;Concurrent Evacuation&quot;)           \</span>
<span class="line-added">158   f(conc_update_refs,                               &quot;Concurrent Update Refs&quot;)          \</span>
<span class="line-added">159   f(conc_cleanup,                                   &quot;Concurrent Cleanup&quot;)              \</span>
<span class="line-added">160   f(conc_traversal,                                 &quot;Concurrent Traversal&quot;)            \</span>
<span class="line-added">161                                                                                        \</span>
<span class="line-added">162   f(conc_uncommit,                                  &quot;Concurrent Uncommit&quot;)             \</span>
<span class="line-added">163                                                                                        \</span>
<span class="line-added">164   /* Unclassified */                                                                   \</span>
<span class="line-added">165   f(pause_other,                                    &quot;Pause Other&quot;)                     \</span>
<span class="line-added">166   f(conc_other,                                     &quot;Concurrent Other&quot;)                \</span>
167   // end
168 
169 class ShenandoahPhaseTimings : public CHeapObj&lt;mtGC&gt; {
170 public:
171 #define GC_PHASE_DECLARE_ENUM(type, title)   type,
172 
173   enum Phase {
174     SHENANDOAH_GC_PHASE_DO(GC_PHASE_DECLARE_ENUM)
<span class="line-modified">175     _num_phases,</span>
<span class="line-added">176     _invalid_phase = _num_phases</span>
177   };
178 



179   enum GCParPhases {
<span class="line-modified">180     SHENANDOAH_GC_PAR_PHASE_DO(,, GC_PHASE_DECLARE_ENUM)</span>
181     GCParPhasesSentinel
182   };
183 
184 #undef GC_PHASE_DECLARE_ENUM
185 
186 private:
<span class="line-modified">187   HdrSeq              _timing_data[_num_phases];</span>






188   static const char*  _phase_names[_num_phases];
189 
<span class="line-modified">190   WorkerDataArray&lt;double&gt;*   _gc_par_phases[ShenandoahPhaseTimings::GCParPhasesSentinel];</span>


191   ShenandoahCollectorPolicy* _policy;
192 
193 public:
194   ShenandoahPhaseTimings();
195 








196   void record_phase_time(Phase phase, double time);
<span class="line-added">197   void record_worker_time(GCParPhases phase, uint worker_id, double time);</span>
198 
199   void record_workers_start(Phase phase);
200   void record_workers_end(Phase phase);
201 
202   static const char* phase_name(Phase phase) {
203     assert(phase &gt;= 0 &amp;&amp; phase &lt; _num_phases, &quot;Out of bound&quot;);
204     return _phase_names[phase];
205   }
206 
207   void print_on(outputStream* out) const;




208 };
209 
<span class="line-modified">210 class ShenandoahWorkerTimingsTracker : public StackObj {</span>
211 private:
<span class="line-modified">212   ShenandoahPhaseTimings::GCParPhases const _phase;</span>
<span class="line-modified">213   ShenandoahPhaseTimings* const _timings;</span>
<span class="line-modified">214   uint const _worker_id;</span>










215 
<span class="line-modified">216   double _start_time;</span>
<span class="line-modified">217   EventGCPhaseParallel _event;</span>

218 public:
<span class="line-modified">219   ShenandoahWorkerTimingsTracker(ShenandoahPhaseTimings::GCParPhases phase, uint worker_id);</span>
<span class="line-modified">220   ~ShenandoahWorkerTimingsTracker();</span>







221 };
222 
223 #endif // SHARE_GC_SHENANDOAH_SHENANDOAHPHASETIMINGS_HPP
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahPhaseTimings.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahRootProcessor.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>