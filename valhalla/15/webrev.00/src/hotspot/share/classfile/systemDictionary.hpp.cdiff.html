<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/classfile/systemDictionary.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="systemDictionary.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="systemDictionaryShared.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/systemDictionary.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 228,11 ***</span>
    /*end*/
  
  class SystemDictionary : AllStatic {
    friend class BootstrapInfo;
    friend class VMStructs;
<span class="line-removed">-   friend class SystemDictionaryHandles;</span>
  
   public:
    enum WKID {
      NO_WKID = 0,
  
<span class="line-new-header">--- 228,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 396,17 ***</span>
    static void resolve_wk_klasses_through(WKID end_id, WKID &amp;start_id, TRAPS) {
      int limit = (int)end_id + 1;
      resolve_wk_klasses_until((WKID) limit, start_id, THREAD);
    }
  public:
    #define WK_KLASS_DECLARE(name, symbol) \
      static InstanceKlass* name() { return check_klass(_well_known_klasses[WK_KLASS_ENUM_NAME(name)]); } \
      static InstanceKlass** name##_addr() {                                                              \
        return &amp;_well_known_klasses[SystemDictionary::WK_KLASS_ENUM_NAME(name)];                          \
      }                                                                                                   \
      static bool name##_is_loaded() {                                                                    \
<span class="line-modified">!       return _well_known_klasses[SystemDictionary::WK_KLASS_ENUM_NAME(name)] != NULL;                   \</span>
      }
    WK_KLASSES_DO(WK_KLASS_DECLARE);
    #undef WK_KLASS_DECLARE
  
    static InstanceKlass* well_known_klass(WKID id) {
<span class="line-new-header">--- 395,19 ---</span>
    static void resolve_wk_klasses_through(WKID end_id, WKID &amp;start_id, TRAPS) {
      int limit = (int)end_id + 1;
      resolve_wk_klasses_until((WKID) limit, start_id, THREAD);
    }
  public:
<span class="line-added">+   #define WK_KLASS(name) _well_known_klasses[SystemDictionary::WK_KLASS_ENUM_NAME(name)]</span>
<span class="line-added">+ </span>
    #define WK_KLASS_DECLARE(name, symbol) \
      static InstanceKlass* name() { return check_klass(_well_known_klasses[WK_KLASS_ENUM_NAME(name)]); } \
      static InstanceKlass** name##_addr() {                                                              \
        return &amp;_well_known_klasses[SystemDictionary::WK_KLASS_ENUM_NAME(name)];                          \
      }                                                                                                   \
      static bool name##_is_loaded() {                                                                    \
<span class="line-modified">!       return is_wk_klass_loaded(WK_KLASS(name));                                                        \</span>
      }
    WK_KLASSES_DO(WK_KLASS_DECLARE);
    #undef WK_KLASS_DECLARE
  
    static InstanceKlass* well_known_klass(WKID id) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 418,13 ***</span>
      assert(id &gt;= (int)FIRST_WKID &amp;&amp; id &lt; (int)WKID_LIMIT, &quot;oob&quot;);
      return &amp;_well_known_klasses[id];
    }
    static void well_known_klasses_do(MetaspaceClosure* it);
  
<span class="line-removed">-   // Local definition for direct access to the private array:</span>
<span class="line-removed">-   #define WK_KLASS(name) _well_known_klasses[SystemDictionary::WK_KLASS_ENUM_NAME(name)]</span>
<span class="line-removed">- </span>
    static InstanceKlass* box_klass(BasicType t) {
      assert((uint)t &lt; T_VOID+1, &quot;range check&quot;);
      return check_klass(_box_klasses[t]);
    }
    static BasicType box_klass_type(Klass* k);  // inverse of box_klass
<span class="line-new-header">--- 419,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 440,16 ***</span>
    // system dictionary.
    static ClassLoaderData *class_loader_data(Handle class_loader) {
      return ClassLoaderData::class_loader_data(class_loader());
    }
  
  public:
<span class="line-modified">!   static bool Parameter_klass_loaded()      { return WK_KLASS(reflect_Parameter_klass) != NULL; }</span>
<span class="line-modified">!   static bool Class_klass_loaded()          { return WK_KLASS(Class_klass) != NULL; }</span>
<span class="line-modified">!   static bool Cloneable_klass_loaded()      { return WK_KLASS(Cloneable_klass) != NULL; }</span>
<span class="line-modified">!   static bool Object_klass_loaded()         { return WK_KLASS(Object_klass) != NULL; }</span>
<span class="line-modified">!   static bool ClassLoader_klass_loaded()    { return WK_KLASS(ClassLoader_klass) != NULL; }</span>
  
    // Returns java system loader
    static oop java_system_loader();
  
    // Returns java platform loader
<span class="line-new-header">--- 438,20 ---</span>
    // system dictionary.
    static ClassLoaderData *class_loader_data(Handle class_loader) {
      return ClassLoaderData::class_loader_data(class_loader());
    }
  
<span class="line-added">+   static bool is_wk_klass_loaded(InstanceKlass* klass) {</span>
<span class="line-added">+     return !(klass == NULL || !klass-&gt;is_loaded());</span>
<span class="line-added">+   }</span>
<span class="line-added">+ </span>
  public:
<span class="line-modified">!   static bool Object_klass_loaded()         { return is_wk_klass_loaded(WK_KLASS(Object_klass));             }</span>
<span class="line-modified">!   static bool Class_klass_loaded()          { return is_wk_klass_loaded(WK_KLASS(Class_klass));              }</span>
<span class="line-modified">!   static bool Cloneable_klass_loaded()      { return is_wk_klass_loaded(WK_KLASS(Cloneable_klass));          }</span>
<span class="line-modified">!   static bool Parameter_klass_loaded()      { return is_wk_klass_loaded(WK_KLASS(reflect_Parameter_klass));  }</span>
<span class="line-modified">!   static bool ClassLoader_klass_loaded()    { return is_wk_klass_loaded(WK_KLASS(ClassLoader_klass));        }</span>
  
    // Returns java system loader
    static oop java_system_loader();
  
    // Returns java platform loader
</pre>
<hr />
<pre>
<span class="line-old-header">*** 600,15 ***</span>
<span class="line-new-header">--- 602,22 ---</span>
    static InstanceKlass* find_or_define_instance_class(Symbol* class_name,
                                                  Handle class_loader,
                                                  InstanceKlass* k, TRAPS);
    static bool is_shared_class_visible(Symbol* class_name, InstanceKlass* ik,
                                        Handle class_loader, TRAPS);
<span class="line-added">+   static bool check_shared_class_super_type(InstanceKlass* child, InstanceKlass* super,</span>
<span class="line-added">+                                             Handle class_loader,  Handle protection_domain,</span>
<span class="line-added">+                                             bool is_superclass, TRAPS);</span>
<span class="line-added">+   static bool check_shared_class_super_types(InstanceKlass* ik, Handle class_loader,</span>
<span class="line-added">+                                                Handle protection_domain, TRAPS);</span>
    static InstanceKlass* load_shared_class(InstanceKlass* ik,
                                            Handle class_loader,
                                            Handle protection_domain,
                                            const ClassFileStream *cfs,
                                            TRAPS);
<span class="line-added">+   // Second part of load_shared_class</span>
<span class="line-added">+   static void load_shared_class_misc(InstanceKlass* ik, ClassLoaderData* loader_data, TRAPS) NOT_CDS_RETURN;</span>
    static InstanceKlass* load_shared_boot_class(Symbol* class_name,
                                                 TRAPS);
    static InstanceKlass* load_instance_class(Symbol* class_name, Handle class_loader, TRAPS);
    static Handle compute_loader_lock_object(Handle class_loader, TRAPS);
    static void check_loader_lock_contention(Handle loader_lock, TRAPS);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 637,10 ***</span>
<span class="line-new-header">--- 646,12 ---</span>
    // Basic find on classes in the midst of being loaded
    static Symbol* find_placeholder(Symbol* name, ClassLoaderData* loader_data);
  
    // Resolve well-known classes so they can be used like SystemDictionary::String_klass()
    static void resolve_well_known_classes(TRAPS);
<span class="line-added">+   // quick resolve using CDS for well-known classes only.</span>
<span class="line-added">+   static void quick_resolve(InstanceKlass* klass, ClassLoaderData* loader_data, Handle domain, TRAPS) NOT_CDS_RETURN;</span>
  
    // Class loader constraints
    static void check_constraints(unsigned int hash,
                                  InstanceKlass* k, Handle loader,
                                  bool defining, TRAPS);
</pre>
<center><a href="systemDictionary.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="systemDictionaryShared.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>