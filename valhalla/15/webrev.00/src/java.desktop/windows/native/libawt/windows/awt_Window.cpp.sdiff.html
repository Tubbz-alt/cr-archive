<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.desktop/windows/native/libawt/windows/awt_Window.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="awt_PrintControl.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../libjsound/PLATFORM_API_WinOS_DirectSound.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.desktop/windows/native/libawt/windows/awt_Window.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
2517         env-&gt;DeleteGlobalRef(self);
2518         delete rfs;
2519         return;
2520     }
2521 
2522     AwtFrame *p = NULL;
2523 
2524     PDATA pData;
2525     JNI_CHECK_PEER_GOTO(self, ret);
2526     p = (AwtFrame *)pData;
2527     if (::IsWindow(p-&gt;GetHWnd()))
2528     {
2529         jobject target = env-&gt;GetObjectField(self, AwtObject::targetID);
2530         if (target != NULL)
2531         {
2532             // enforce tresholds before sending the event
2533             // Fix for 4459064 : do not enforce thresholds for embedded frames
2534             if (!p-&gt;IsEmbeddedFrame())
2535             {
2536                 jobject peer = p-&gt;GetPeer(env);
<span class="line-modified">2537                 int minWidth = ::GetSystemMetrics(SM_CXMIN);</span>
<span class="line-modified">2538                 int minHeight = ::GetSystemMetrics(SM_CYMIN);</span>
2539                 if (w &lt; minWidth)
2540                 {
2541                     env-&gt;SetIntField(target, AwtComponent::widthID,
2542                         w = minWidth);
2543                     env-&gt;SetIntField(peer, AwtWindow::sysWID,
2544                         w);
2545                 }
2546                 if (h &lt; minHeight)
2547                 {
2548                     env-&gt;SetIntField(target, AwtComponent::heightID,
2549                         h = minHeight);
2550                     env-&gt;SetIntField(peer, AwtWindow::sysHID,
2551                         h);
2552                 }
2553             }
2554             env-&gt;DeleteLocalRef(target);
2555 
2556             RECT *r = new RECT;
2557             ::SetRect(r, x, y, x + w, y + h);
2558             p-&gt;SendMessage(WM_AWT_RESHAPE_COMPONENT, 0, (LPARAM)r);
</pre>
<hr />
<pre>
3809 
3810     CATCH_BAD_ALLOC;
3811 }
3812 
3813 /*
3814  * Class:     sun_awt_windows_WWindowPeer
3815  * Method:    setOpacity
3816  * Signature: (I)V
3817  */
3818 JNIEXPORT void JNICALL
3819 Java_sun_awt_windows_WWindowPeer_setOpacity(JNIEnv *env, jobject self,
3820                                               jint iOpacity)
3821 {
3822     TRY;
3823 
3824     OpacityStruct *os = new OpacityStruct;
3825     os-&gt;window = env-&gt;NewGlobalRef(self);
3826     os-&gt;iOpacity = iOpacity;
3827 
3828     AwtToolkit::GetInstance().SyncCall(AwtWindow::_SetOpacity, os);
<span class="line-modified">3829     // global refs and mds are deleted in _SetMinSize</span>
3830 
3831     CATCH_BAD_ALLOC;
3832 }
3833 
3834 /*
3835  * Class:     sun_awt_windows_WWindowPeer
3836  * Method:    setOpaqueImpl
3837  * Signature: (Z)V
3838  */
3839 JNIEXPORT void JNICALL
3840 Java_sun_awt_windows_WWindowPeer_setOpaqueImpl(JNIEnv *env, jobject self,
3841                                               jboolean isOpaque)
3842 {
3843     TRY;
3844 
3845     OpaqueStruct *os = new OpaqueStruct;
3846     os-&gt;window = env-&gt;NewGlobalRef(self);
3847     os-&gt;isOpaque = isOpaque;
3848 
3849     AwtToolkit::GetInstance().SyncCall(AwtWindow::_SetOpaque, os);
<span class="line-modified">3850     // global refs and mds are deleted in _SetMinSize</span>
3851 
3852     CATCH_BAD_ALLOC;
3853 }
3854 
3855 /*
3856  * Class:     sun_awt_windows_WWindowPeer
3857  * Method:    updateWindowImpl
3858  * Signature: ([III)V
3859  */
3860 JNIEXPORT void JNICALL
3861 Java_sun_awt_windows_WWindowPeer_updateWindowImpl(JNIEnv *env, jobject self,
3862                                                   jintArray data,
3863                                                   jint width, jint height)
3864 {
3865     TRY;
3866 
3867     UpdateWindowStruct *uws = new UpdateWindowStruct;
3868     uws-&gt;window = env-&gt;NewGlobalRef(self);
3869     uws-&gt;data = (jintArray)env-&gt;NewGlobalRef(data);
3870     uws-&gt;hBitmap = NULL;
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
2517         env-&gt;DeleteGlobalRef(self);
2518         delete rfs;
2519         return;
2520     }
2521 
2522     AwtFrame *p = NULL;
2523 
2524     PDATA pData;
2525     JNI_CHECK_PEER_GOTO(self, ret);
2526     p = (AwtFrame *)pData;
2527     if (::IsWindow(p-&gt;GetHWnd()))
2528     {
2529         jobject target = env-&gt;GetObjectField(self, AwtObject::targetID);
2530         if (target != NULL)
2531         {
2532             // enforce tresholds before sending the event
2533             // Fix for 4459064 : do not enforce thresholds for embedded frames
2534             if (!p-&gt;IsEmbeddedFrame())
2535             {
2536                 jobject peer = p-&gt;GetPeer(env);
<span class="line-modified">2537                 int minWidth = p-&gt;ScaleDownX(::GetSystemMetrics(SM_CXMIN));</span>
<span class="line-modified">2538                 int minHeight = p-&gt;ScaleDownY(::GetSystemMetrics(SM_CYMIN));</span>
2539                 if (w &lt; minWidth)
2540                 {
2541                     env-&gt;SetIntField(target, AwtComponent::widthID,
2542                         w = minWidth);
2543                     env-&gt;SetIntField(peer, AwtWindow::sysWID,
2544                         w);
2545                 }
2546                 if (h &lt; minHeight)
2547                 {
2548                     env-&gt;SetIntField(target, AwtComponent::heightID,
2549                         h = minHeight);
2550                     env-&gt;SetIntField(peer, AwtWindow::sysHID,
2551                         h);
2552                 }
2553             }
2554             env-&gt;DeleteLocalRef(target);
2555 
2556             RECT *r = new RECT;
2557             ::SetRect(r, x, y, x + w, y + h);
2558             p-&gt;SendMessage(WM_AWT_RESHAPE_COMPONENT, 0, (LPARAM)r);
</pre>
<hr />
<pre>
3809 
3810     CATCH_BAD_ALLOC;
3811 }
3812 
3813 /*
3814  * Class:     sun_awt_windows_WWindowPeer
3815  * Method:    setOpacity
3816  * Signature: (I)V
3817  */
3818 JNIEXPORT void JNICALL
3819 Java_sun_awt_windows_WWindowPeer_setOpacity(JNIEnv *env, jobject self,
3820                                               jint iOpacity)
3821 {
3822     TRY;
3823 
3824     OpacityStruct *os = new OpacityStruct;
3825     os-&gt;window = env-&gt;NewGlobalRef(self);
3826     os-&gt;iOpacity = iOpacity;
3827 
3828     AwtToolkit::GetInstance().SyncCall(AwtWindow::_SetOpacity, os);
<span class="line-modified">3829     // global refs and mds are deleted in _SetOpacity</span>
3830 
3831     CATCH_BAD_ALLOC;
3832 }
3833 
3834 /*
3835  * Class:     sun_awt_windows_WWindowPeer
3836  * Method:    setOpaqueImpl
3837  * Signature: (Z)V
3838  */
3839 JNIEXPORT void JNICALL
3840 Java_sun_awt_windows_WWindowPeer_setOpaqueImpl(JNIEnv *env, jobject self,
3841                                               jboolean isOpaque)
3842 {
3843     TRY;
3844 
3845     OpaqueStruct *os = new OpaqueStruct;
3846     os-&gt;window = env-&gt;NewGlobalRef(self);
3847     os-&gt;isOpaque = isOpaque;
3848 
3849     AwtToolkit::GetInstance().SyncCall(AwtWindow::_SetOpaque, os);
<span class="line-modified">3850     // global refs and mds are deleted in _SetOpaque</span>
3851 
3852     CATCH_BAD_ALLOC;
3853 }
3854 
3855 /*
3856  * Class:     sun_awt_windows_WWindowPeer
3857  * Method:    updateWindowImpl
3858  * Signature: ([III)V
3859  */
3860 JNIEXPORT void JNICALL
3861 Java_sun_awt_windows_WWindowPeer_updateWindowImpl(JNIEnv *env, jobject self,
3862                                                   jintArray data,
3863                                                   jint width, jint height)
3864 {
3865     TRY;
3866 
3867     UpdateWindowStruct *uws = new UpdateWindowStruct;
3868     uws-&gt;window = env-&gt;NewGlobalRef(self);
3869     uws-&gt;data = (jintArray)env-&gt;NewGlobalRef(data);
3870     uws-&gt;hBitmap = NULL;
</pre>
</td>
</tr>
</table>
<center><a href="awt_PrintControl.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../libjsound/PLATFORM_API_WinOS_DirectSound.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>