<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/unix/native/libnet/Inet6AddressImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="Inet4AddressImpl.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="NetworkInterface.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/unix/native/libnet/Inet6AddressImpl.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
396             }
397             iterator = iterator-&gt;ai_next;
398         }
399     }
400 cleanupAndReturn:
401     JNU_ReleaseStringPlatformChars(env, host, hostname);
402     while (resNew != NULL) {
403         last = resNew;
404         resNew = resNew-&gt;ai_next;
405         free(last);
406     }
407     if (res != NULL) {
408         freeaddrinfo(res);
409     }
410     return ret;
411 }
412 
413 /*
414  * Class:     java_net_Inet6AddressImpl
415  * Method:    getHostByAddr
<span class="line-modified">416  * Signature: (I)Ljava/lang/String;</span>
417  *
418  * Theoretically the UnknownHostException could be enriched with gai error
419  * information. But as it is silently ignored anyway, there&#39;s no need for this.
420  * It&#39;s only important that either a valid hostname is returned or an
421  * UnknownHostException is thrown.
422  */
423 JNIEXPORT jstring JNICALL
424 Java_java_net_Inet6AddressImpl_getHostByAddr(JNIEnv *env, jobject this,
425                                              jbyteArray addrArray) {
426     jstring ret = NULL;
427     char host[NI_MAXHOST + 1];
428     int len = 0;
429     jbyte caddr[16];
430     SOCKETADDRESS sa;
431 
432     memset((void *)&amp;sa, 0, sizeof(SOCKETADDRESS));
433 
434     // construct a sockaddr_in structure (AF_INET or AF_INET6)
435     if ((*env)-&gt;GetArrayLength(env, addrArray) == 4) {
436         jint addr;
</pre>
<hr />
<pre>
651                     if (NET_IsEqual((jbyte *)&amp;sa-&gt;sa6.sin6_addr,
652                                     (jbyte *)&amp;sa_recv.sin6_addr)) {
653                         close(fd);
654                         return JNI_TRUE;
655                     } else if (NET_IsZeroAddr((jbyte *)&amp;sa-&gt;sa6.sin6_addr)) {
656                         close(fd);
657                         return JNI_TRUE;
658                     }
659                 }
660             }
661         } while (tmout2 &gt; 0);
662         timeout -= 1000;
663     } while (timeout &gt; 0);
664     close(fd);
665     return JNI_FALSE;
666 }
667 
668 /*
669  * Class:     java_net_Inet6AddressImpl
670  * Method:    isReachable0
<span class="line-modified">671  * Signature: ([bII[bI)Z</span>
672  */
673 JNIEXPORT jboolean JNICALL
674 Java_java_net_Inet6AddressImpl_isReachable0(JNIEnv *env, jobject this,
675                                             jbyteArray addrArray, jint scope,
676                                             jint timeout, jbyteArray ifArray,
677                                             jint ttl, jint if_scope)
678 {
679     jbyte caddr[16];
680     jint sz, fd;
681     SOCKETADDRESS sa, inf, *netif = NULL;
682 
683     // If IPv6 is not enabled, then we can&#39;t reach an IPv6 address, can we?
684     // Actually, we probably shouldn&#39;t even get here.
685     if (!ipv6_available()) {
686         return JNI_FALSE;
687     }
688 
689     // If it&#39;s an IPv4 address, ICMP won&#39;t work with IPv4 mapped address,
690     // therefore, let&#39;s delegate to the Inet4Address method.
691     sz = (*env)-&gt;GetArrayLength(env, addrArray);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
396             }
397             iterator = iterator-&gt;ai_next;
398         }
399     }
400 cleanupAndReturn:
401     JNU_ReleaseStringPlatformChars(env, host, hostname);
402     while (resNew != NULL) {
403         last = resNew;
404         resNew = resNew-&gt;ai_next;
405         free(last);
406     }
407     if (res != NULL) {
408         freeaddrinfo(res);
409     }
410     return ret;
411 }
412 
413 /*
414  * Class:     java_net_Inet6AddressImpl
415  * Method:    getHostByAddr
<span class="line-modified">416  * Signature: ([B)Ljava/lang/String;</span>
417  *
418  * Theoretically the UnknownHostException could be enriched with gai error
419  * information. But as it is silently ignored anyway, there&#39;s no need for this.
420  * It&#39;s only important that either a valid hostname is returned or an
421  * UnknownHostException is thrown.
422  */
423 JNIEXPORT jstring JNICALL
424 Java_java_net_Inet6AddressImpl_getHostByAddr(JNIEnv *env, jobject this,
425                                              jbyteArray addrArray) {
426     jstring ret = NULL;
427     char host[NI_MAXHOST + 1];
428     int len = 0;
429     jbyte caddr[16];
430     SOCKETADDRESS sa;
431 
432     memset((void *)&amp;sa, 0, sizeof(SOCKETADDRESS));
433 
434     // construct a sockaddr_in structure (AF_INET or AF_INET6)
435     if ((*env)-&gt;GetArrayLength(env, addrArray) == 4) {
436         jint addr;
</pre>
<hr />
<pre>
651                     if (NET_IsEqual((jbyte *)&amp;sa-&gt;sa6.sin6_addr,
652                                     (jbyte *)&amp;sa_recv.sin6_addr)) {
653                         close(fd);
654                         return JNI_TRUE;
655                     } else if (NET_IsZeroAddr((jbyte *)&amp;sa-&gt;sa6.sin6_addr)) {
656                         close(fd);
657                         return JNI_TRUE;
658                     }
659                 }
660             }
661         } while (tmout2 &gt; 0);
662         timeout -= 1000;
663     } while (timeout &gt; 0);
664     close(fd);
665     return JNI_FALSE;
666 }
667 
668 /*
669  * Class:     java_net_Inet6AddressImpl
670  * Method:    isReachable0
<span class="line-modified">671  * Signature: ([BII[BII)Z</span>
672  */
673 JNIEXPORT jboolean JNICALL
674 Java_java_net_Inet6AddressImpl_isReachable0(JNIEnv *env, jobject this,
675                                             jbyteArray addrArray, jint scope,
676                                             jint timeout, jbyteArray ifArray,
677                                             jint ttl, jint if_scope)
678 {
679     jbyte caddr[16];
680     jint sz, fd;
681     SOCKETADDRESS sa, inf, *netif = NULL;
682 
683     // If IPv6 is not enabled, then we can&#39;t reach an IPv6 address, can we?
684     // Actually, we probably shouldn&#39;t even get here.
685     if (!ipv6_available()) {
686         return JNI_FALSE;
687     }
688 
689     // If it&#39;s an IPv4 address, ICMP won&#39;t work with IPv4 mapped address,
690     // therefore, let&#39;s delegate to the Inet4Address method.
691     sz = (*env)-&gt;GetArrayLength(env, addrArray);
</pre>
</td>
</tr>
</table>
<center><a href="Inet4AddressImpl.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="NetworkInterface.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>