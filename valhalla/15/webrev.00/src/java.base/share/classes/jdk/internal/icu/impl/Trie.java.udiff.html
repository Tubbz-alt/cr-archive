<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/jdk/internal/icu/impl/Trie.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="StringPrepDataReader.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Trie2.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/jdk/internal/icu/impl/Trie.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -71,26 +71,26 @@</span>
  public abstract class Trie
  {
      // public class declaration ----------------------------------------
  
      /**
<span class="udiff-line-modified-removed">-     * Character data in com.ibm.impl.Trie have different user-specified format</span>
<span class="udiff-line-modified-removed">-     * for different purposes.</span>
<span class="udiff-line-modified-removed">-     * This interface specifies methods to be implemented in order for</span>
<span class="udiff-line-modified-removed">-     * com.ibm.impl.Trie, to surrogate offset information encapsulated within</span>
<span class="udiff-line-modified-removed">-     * the data.</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * Character data in com.ibm.impl.Trie have different user-specified format</span>
<span class="udiff-line-modified-added">+      * for different purposes.</span>
<span class="udiff-line-modified-added">+      * This interface specifies methods to be implemented in order for</span>
<span class="udiff-line-modified-added">+      * com.ibm.impl.Trie, to surrogate offset information encapsulated within</span>
<span class="udiff-line-modified-added">+      * the data.</span>
<span class="udiff-line-modified-added">+      */</span>
      public static interface DataManipulate
      {
          /**
<span class="udiff-line-modified-removed">-         * Called by com.ibm.icu.impl.Trie to extract from a lead surrogate&#39;s</span>
<span class="udiff-line-modified-removed">-         * data</span>
<span class="udiff-line-modified-removed">-         * the index array offset of the indexes for that lead surrogate.</span>
<span class="udiff-line-modified-removed">-         * @param value data value for a surrogate from the trie, including the</span>
<span class="udiff-line-modified-removed">-         *        folding offset</span>
<span class="udiff-line-modified-removed">-         * @return data offset or 0 if there is no data for the lead surrogate</span>
<span class="udiff-line-modified-removed">-         */</span>
<span class="udiff-line-modified-added">+          * Called by com.ibm.icu.impl.Trie to extract from a lead surrogate&#39;s</span>
<span class="udiff-line-modified-added">+          * data</span>
<span class="udiff-line-modified-added">+          * the index array offset of the indexes for that lead surrogate.</span>
<span class="udiff-line-modified-added">+          * @param value data value for a surrogate from the trie, including the</span>
<span class="udiff-line-modified-added">+          *        folding offset</span>
<span class="udiff-line-modified-added">+          * @return data offset or 0 if there is no data for the lead surrogate</span>
<span class="udiff-line-modified-added">+          */</span>
          public int getFoldingOffset(int value);
      }
  
      // default implementation
      private static class DefaultGetFoldingOffset implements DataManipulate {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -100,18 +100,18 @@</span>
      }
  
      // protected constructor -------------------------------------------
  
      /**
<span class="udiff-line-modified-removed">-     * Trie constructor for CharTrie use.</span>
<span class="udiff-line-modified-removed">-     * @param inputStream ICU data file input stream which contains the</span>
<span class="udiff-line-modified-removed">-     *                        trie</span>
<span class="udiff-line-modified-removed">-     * @param dataManipulate object containing the information to parse the</span>
<span class="udiff-line-modified-removed">-     *                       trie data</span>
<span class="udiff-line-modified-removed">-     * @throws IOException thrown when input stream does not have the</span>
<span class="udiff-line-modified-removed">-     *                        right header.</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * Trie constructor for CharTrie use.</span>
<span class="udiff-line-modified-added">+      * @param inputStream ICU data file input stream which contains the</span>
<span class="udiff-line-modified-added">+      *                        trie</span>
<span class="udiff-line-modified-added">+      * @param dataManipulate object containing the information to parse the</span>
<span class="udiff-line-modified-added">+      *                       trie data</span>
<span class="udiff-line-modified-added">+      * @throws IOException thrown when input stream does not have the</span>
<span class="udiff-line-modified-added">+      *                        right header.</span>
<span class="udiff-line-modified-added">+      */</span>
      protected Trie(InputStream inputStream,
                     DataManipulate  dataManipulate) throws IOException
      {
          DataInputStream input = new DataInputStream(inputStream);
          // Magic number to authenticate the data.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -193,61 +193,61 @@</span>
      protected int m_dataLength_;
  
      // protected methods -----------------------------------------------
  
      /**
<span class="udiff-line-modified-removed">-     * Gets the offset to the data which the surrogate pair points to.</span>
<span class="udiff-line-modified-removed">-     * @param lead lead surrogate</span>
<span class="udiff-line-modified-removed">-     * @param trail trailing surrogate</span>
<span class="udiff-line-modified-removed">-     * @return offset to data</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * Gets the offset to the data which the surrogate pair points to.</span>
<span class="udiff-line-modified-added">+      * @param lead lead surrogate</span>
<span class="udiff-line-modified-added">+      * @param trail trailing surrogate</span>
<span class="udiff-line-modified-added">+      * @return offset to data</span>
<span class="udiff-line-modified-added">+      */</span>
      protected abstract int getSurrogateOffset(char lead, char trail);
  
      /**
<span class="udiff-line-modified-removed">-     * Gets the offset to the data which the index ch after variable offset</span>
<span class="udiff-line-modified-removed">-     * points to.</span>
<span class="udiff-line-modified-removed">-     * Note for locating a non-supplementary character data offset, calling</span>
<span class="udiff-line-modified-removed">-     * &lt;p&gt;</span>
<span class="udiff-line-modified-removed">-     * getRawOffset(0, ch);</span>
<span class="udiff-line-modified-removed">-     * &lt;/p&gt;</span>
<span class="udiff-line-modified-removed">-     * will do. Otherwise if it is a supplementary character formed by</span>
<span class="udiff-line-modified-removed">-     * surrogates lead and trail. Then we would have to call getRawOffset()</span>
<span class="udiff-line-modified-removed">-     * with getFoldingIndexOffset(). See getSurrogateOffset().</span>
<span class="udiff-line-modified-removed">-     * @param offset index offset which ch is to start from</span>
<span class="udiff-line-modified-removed">-     * @param ch index to be used after offset</span>
<span class="udiff-line-modified-removed">-     * @return offset to the data</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * Gets the offset to the data which the index ch after variable offset</span>
<span class="udiff-line-modified-added">+      * points to.</span>
<span class="udiff-line-modified-added">+      * Note for locating a non-supplementary character data offset, calling</span>
<span class="udiff-line-modified-added">+      * &lt;p&gt;</span>
<span class="udiff-line-modified-added">+      * getRawOffset(0, ch);</span>
<span class="udiff-line-modified-added">+      * &lt;/p&gt;</span>
<span class="udiff-line-modified-added">+      * will do. Otherwise if it is a supplementary character formed by</span>
<span class="udiff-line-modified-added">+      * surrogates lead and trail. Then we would have to call getRawOffset()</span>
<span class="udiff-line-modified-added">+      * with getFoldingIndexOffset(). See getSurrogateOffset().</span>
<span class="udiff-line-modified-added">+      * @param offset index offset which ch is to start from</span>
<span class="udiff-line-modified-added">+      * @param ch index to be used after offset</span>
<span class="udiff-line-modified-added">+      * @return offset to the data</span>
<span class="udiff-line-modified-added">+      */</span>
      protected final int getRawOffset(int offset, char ch)
      {
          return (m_index_[offset + (ch &gt;&gt; INDEX_STAGE_1_SHIFT_)]
                  &lt;&lt; INDEX_STAGE_2_SHIFT_)
                  + (ch &amp; INDEX_STAGE_3_MASK_);
      }
  
      /**
<span class="udiff-line-modified-removed">-     * Gets the offset to data which the BMP character points to</span>
<span class="udiff-line-modified-removed">-     * Treats a lead surrogate as a normal code point.</span>
<span class="udiff-line-modified-removed">-     * @param ch BMP character</span>
<span class="udiff-line-modified-removed">-     * @return offset to data</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * Gets the offset to data which the BMP character points to</span>
<span class="udiff-line-modified-added">+      * Treats a lead surrogate as a normal code point.</span>
<span class="udiff-line-modified-added">+      * @param ch BMP character</span>
<span class="udiff-line-modified-added">+      * @return offset to data</span>
<span class="udiff-line-modified-added">+      */</span>
      protected final int getBMPOffset(char ch)
      {
          return (ch &gt;= UTF16.LEAD_SURROGATE_MIN_VALUE
                  &amp;&amp; ch &lt;= UTF16.LEAD_SURROGATE_MAX_VALUE)
                  ? getRawOffset(LEAD_INDEX_OFFSET_, ch)
                  : getRawOffset(0, ch);
                  // using a getRawOffset(ch) makes no diff
      }
  
      /**
<span class="udiff-line-modified-removed">-     * Gets the offset to the data which this lead surrogate character points</span>
<span class="udiff-line-modified-removed">-     * to.</span>
<span class="udiff-line-modified-removed">-     * Data at the returned offset may contain folding offset information for</span>
<span class="udiff-line-modified-removed">-     * the next trailing surrogate character.</span>
<span class="udiff-line-modified-removed">-     * @param ch lead surrogate character</span>
<span class="udiff-line-modified-removed">-     * @return offset to data</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * Gets the offset to the data which this lead surrogate character points</span>
<span class="udiff-line-modified-added">+      * to.</span>
<span class="udiff-line-modified-added">+      * Data at the returned offset may contain folding offset information for</span>
<span class="udiff-line-modified-added">+      * the next trailing surrogate character.</span>
<span class="udiff-line-modified-added">+      * @param ch lead surrogate character</span>
<span class="udiff-line-modified-added">+      * @return offset to data</span>
<span class="udiff-line-modified-added">+      */</span>
      protected final int getLeadOffset(char ch)
      {
         return getRawOffset(0, ch);
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -280,15 +280,15 @@</span>
              return -1;
          }
      }
  
      /**
<span class="udiff-line-modified-removed">-     * &lt;p&gt;Parses the inputstream and creates the trie index with it.&lt;/p&gt;</span>
<span class="udiff-line-modified-removed">-     * &lt;p&gt;This is overwritten by the child classes.</span>
<span class="udiff-line-modified-removed">-     * @param inputStream input stream containing the trie information</span>
<span class="udiff-line-modified-removed">-     * @exception IOException thrown when data reading fails.</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * &lt;p&gt;Parses the inputstream and creates the trie index with it.&lt;/p&gt;</span>
<span class="udiff-line-modified-added">+      * &lt;p&gt;This is overwritten by the child classes.</span>
<span class="udiff-line-modified-added">+      * @param inputStream input stream containing the trie information</span>
<span class="udiff-line-modified-added">+      * @exception IOException thrown when data reading fails.</span>
<span class="udiff-line-modified-added">+      */</span>
      protected void unserialize(InputStream inputStream) throws IOException
      {
          //indexLength is a multiple of 1024 &gt;&gt; INDEX_STAGE_2_SHIFT_
          m_index_              = new char[m_dataOffset_];
          DataInputStream input = new DataInputStream(inputStream);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -296,13 +296,13 @@</span>
               m_index_[i] = input.readChar();
          }
      }
  
      /**
<span class="udiff-line-modified-removed">-     * Determines if this is a 16 bit trie</span>
<span class="udiff-line-modified-removed">-     * @return true if this is a 16 bit trie</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * Determines if this is a 16 bit trie</span>
<span class="udiff-line-modified-added">+      * @return true if this is a 16 bit trie</span>
<span class="udiff-line-modified-added">+      */</span>
      protected final boolean isCharTrie()
      {
          return (m_options_ &amp; HEADER_OPTIONS_DATA_IS_32_BIT_) == 0;
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -311,16 +311,16 @@</span>
      /**
       * Latin 1 option mask
       */
      protected static final int HEADER_OPTIONS_LATIN1_IS_LINEAR_MASK_ = 0x200;
      /**
<span class="udiff-line-modified-removed">-     * Constant number to authenticate the byte block</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * Constant number to authenticate the byte block</span>
<span class="udiff-line-modified-added">+      */</span>
      protected static final int HEADER_SIGNATURE_ = 0x54726965;
      /**
<span class="udiff-line-modified-removed">-     * Header option formatting</span>
<span class="udiff-line-modified-removed">-     */</span>
<span class="udiff-line-modified-added">+      * Header option formatting</span>
<span class="udiff-line-modified-added">+      */</span>
      private static final int HEADER_OPTIONS_SHIFT_MASK_ = 0xF;
      protected static final int HEADER_OPTIONS_INDEX_SHIFT_ = 4;
      protected static final int HEADER_OPTIONS_DATA_IS_32_BIT_ = 0x100;
  
      /**
</pre>
<center><a href="StringPrepDataReader.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Trie2.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>