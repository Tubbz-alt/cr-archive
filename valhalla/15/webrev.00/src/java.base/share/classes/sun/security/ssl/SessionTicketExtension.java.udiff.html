<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/sun/security/ssl/SessionTicketExtension.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ServerNameExtension.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SignatureAlgorithmsExtension.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/SessionTicketExtension.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -235,22 +235,25 @@</span>
  
          SessionTicketSpec() {
              data = zero;
          }
  
<span class="udiff-line-modified-removed">-         SessionTicketSpec(byte[] b) throws IOException {</span>
<span class="udiff-line-modified-removed">-             this(ByteBuffer.wrap(b));</span>
<span class="udiff-line-modified-added">+         SessionTicketSpec(HandshakeContext hc, byte[] b) throws IOException {</span>
<span class="udiff-line-modified-added">+             this(hc, ByteBuffer.wrap(b));</span>
          }
  
<span class="udiff-line-modified-removed">-         SessionTicketSpec(ByteBuffer buf) throws IOException {</span>
<span class="udiff-line-modified-added">+         SessionTicketSpec(HandshakeContext hc,</span>
<span class="udiff-line-added">+                 ByteBuffer buf) throws IOException {</span>
              if (buf == null) {
<span class="udiff-line-modified-removed">-                 throw new SSLProtocolException(</span>
<span class="udiff-line-modified-removed">-                         &quot;SessionTicket buffer too small&quot;);</span>
<span class="udiff-line-modified-added">+                 throw hc.conContext.fatal(Alert.DECODE_ERROR,</span>
<span class="udiff-line-modified-added">+                         new SSLProtocolException(</span>
<span class="udiff-line-added">+                     &quot;SessionTicket buffer too small&quot;));</span>
              }
              if (buf.remaining() &gt; 65536) {
<span class="udiff-line-modified-removed">-                 throw new SSLProtocolException(</span>
<span class="udiff-line-modified-removed">-                         &quot;SessionTicket buffer too large. &quot; + buf.remaining());</span>
<span class="udiff-line-modified-added">+                 throw hc.conContext.fatal(Alert.DECODE_ERROR,</span>
<span class="udiff-line-modified-added">+                         new SSLProtocolException(</span>
<span class="udiff-line-added">+                     &quot;SessionTicket buffer too large. &quot; + buf.remaining()));</span>
              }
  
              data = buf;
          }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -364,16 +367,14 @@</span>
              return messageFormat.format(messageFields);
          }
      }
  
      static final class SessionTicketStringizer implements SSLStringizer {
<span class="udiff-line-removed">-         SessionTicketStringizer() {}</span>
<span class="udiff-line-removed">- </span>
          @Override
<span class="udiff-line-modified-removed">-         public String toString(ByteBuffer buffer) {</span>
<span class="udiff-line-modified-added">+         public String toString(HandshakeContext hc, ByteBuffer buffer) {</span>
              try {
<span class="udiff-line-modified-removed">-                 return new SessionTicketSpec(buffer).toString();</span>
<span class="udiff-line-modified-added">+                 return new SessionTicketSpec(hc, buffer).toString();</span>
              } catch (IOException e) {
                  return e.getMessage();
              }
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -453,20 +454,11 @@</span>
                  }
                  return;
              }
  
              // Parse the extension.
<span class="udiff-line-modified-removed">-             SessionTicketSpec spec;</span>
<span class="udiff-line-removed">-             try {</span>
<span class="udiff-line-removed">-                  spec = new SessionTicketSpec(buffer);</span>
<span class="udiff-line-removed">-             } catch (IOException | RuntimeException e) {</span>
<span class="udiff-line-removed">-                 if (SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;ssl,handshake&quot;)) {</span>
<span class="udiff-line-removed">-                     SSLLogger.fine(&quot;SessionTicket data invalid. Doing full &quot; +</span>
<span class="udiff-line-removed">-                             &quot;handshake.&quot;);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 return;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             SessionTicketSpec spec = new SessionTicketSpec(shc, buffer);</span>
              ByteBuffer b = spec.decrypt(shc);
              if (b != null) {
                  shc.resumingSession = new SSLSessionImpl(shc, b);
                  shc.isResumption = true;
                  shc.statelessResumption = true;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -529,16 +521,10 @@</span>
                      engineGetClientSessionContext()).statelessEnabled()) {
                  chc.statelessResumption = false;
                  return;
              }
  
<span class="udiff-line-modified-removed">-             try {</span>
<span class="udiff-line-modified-removed">-                 if (new SessionTicketSpec(buffer) == null) {</span>
<span class="udiff-line-removed">-                     return;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 chc.statelessResumption = true;</span>
<span class="udiff-line-removed">-             } catch (IOException e) {</span>
<span class="udiff-line-removed">-                 throw chc.conContext.fatal(Alert.UNEXPECTED_MESSAGE, e);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+             SessionTicketSpec spec = new SessionTicketSpec(chc, buffer);</span>
<span class="udiff-line-modified-added">+             chc.statelessResumption = true;</span>
          }
      }
  }
</pre>
<center><a href="ServerNameExtension.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SignatureAlgorithmsExtension.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>