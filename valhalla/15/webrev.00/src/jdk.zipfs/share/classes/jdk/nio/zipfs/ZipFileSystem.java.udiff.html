<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileSystem.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../jdk.jshell/share/classes/jdk/jshell/SourceCodeAnalysisImpl.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/failure_handler/src/share/conf/linux.properties.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.zipfs/share/classes/jdk/nio/zipfs/ZipFileSystem.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1716,12 +1716,37 @@</span>
              ArrayList&lt;Entry&gt; elist = new ArrayList&lt;&gt;(inodes.size());
              long written = 0;
              byte[] buf = null;
              Entry e;
  
<span class="udiff-line-added">+             final IndexNode manifestInode = inodes.get(</span>
<span class="udiff-line-added">+                     IndexNode.keyOf(getBytes(&quot;/META-INF/MANIFEST.MF&quot;)));</span>
<span class="udiff-line-added">+             final Iterator&lt;IndexNode&gt; inodeIterator = inodes.values().iterator();</span>
<span class="udiff-line-added">+             boolean manifestProcessed = false;</span>
<span class="udiff-line-added">+ </span>
              // write loc
<span class="udiff-line-modified-removed">-             for (IndexNode inode : inodes.values()) {</span>
<span class="udiff-line-modified-added">+             while (inodeIterator.hasNext()) {</span>
<span class="udiff-line-added">+                 final IndexNode inode;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 // write the manifest inode (if any) first so that</span>
<span class="udiff-line-added">+                 // java.util.jar.JarInputStream can find it</span>
<span class="udiff-line-added">+                 if (manifestInode == null) {</span>
<span class="udiff-line-added">+                     inode = inodeIterator.next();</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     if (manifestProcessed) {</span>
<span class="udiff-line-added">+                         // advance to next node, filtering out the manifest</span>
<span class="udiff-line-added">+                         // which was already written</span>
<span class="udiff-line-added">+                         inode = inodeIterator.next();</span>
<span class="udiff-line-added">+                         if (inode == manifestInode) {</span>
<span class="udiff-line-added">+                             continue;</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                     } else {</span>
<span class="udiff-line-added">+                         inode = manifestInode;</span>
<span class="udiff-line-added">+                         manifestProcessed = true;</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+ </span>
                  if (inode instanceof Entry) {    // an updated inode
                      e = (Entry)inode;
                      try {
                          if (e.type == Entry.COPY) {
                              // entry copy: the only thing changed is the &quot;name&quot;
</pre>
<center><a href="../../../../../../jdk.jshell/share/classes/jdk/jshell/SourceCodeAnalysisImpl.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/failure_handler/src/share/conf/linux.properties.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>