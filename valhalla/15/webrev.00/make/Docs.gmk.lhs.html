<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames make/Docs.gmk</title>
    <link rel="stylesheet" href="../style.css" />
    <script type="text/javascript" src="../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre><a name="1" id="anc1"></a><span class="line-modified">  1 # Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  2 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  3 #
  4 # This code is free software; you can redistribute it and/or modify it
  5 # under the terms of the GNU General Public License version 2 only, as
  6 # published by the Free Software Foundation.  Oracle designates this
  7 # particular file as subject to the &quot;Classpath&quot; exception as provided
  8 # by Oracle in the LICENSE file that accompanied this code.
  9 #
 10 # This code is distributed in the hope that it will be useful, but WITHOUT
 11 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 12 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 13 # version 2 for more details (a copy is included in the LICENSE file that
 14 # accompanied this code).
 15 #
 16 # You should have received a copy of the GNU General Public License version
 17 # 2 along with this work; if not, write to the Free Software Foundation,
 18 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19 #
 20 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21 # or visit www.oracle.com if you need additional information or have any
 22 # questions.
 23 #
 24 
 25 default: all
 26 
 27 include $(SPEC)
 28 include MakeBase.gmk
 29 include Execute.gmk
 30 include Modules.gmk
 31 include ModuleTools.gmk
 32 include ProcessMarkdown.gmk
 33 include ToolsJdk.gmk
 34 include ZipArchive.gmk
 35 include TextFileProcessing.gmk
 36 
 37 # This is needed to properly setup DOCS_MODULES.
 38 $(eval $(call ReadImportMetaData))
 39 
 40 ################################################################################
 41 # Hook to include the corresponding custom file, if present.
 42 $(eval $(call IncludeCustomExtension, Docs.gmk))
 43 
 44 ################################################################################
 45 # This file generates all documentation for OpenJDK.
 46 #
 47 # We will generate API documentation for two different selections of the source
 48 # code: &quot;Java SE&quot;, which contains just the modules covered by the top-level
 49 # module java.se and &quot;JDK&quot;, which covers all of Java SE and also all
 50 # other available modules that should be documented, including imported modules,
 51 # if any.
 52 #
 53 # We will also generate separate, free-standing specifications from either
 54 # markdown or existing html files.
 55 #
 56 
 57 ################################################################################
 58 # Javadoc settings
 59 
<a name="2" id="anc2"></a><span class="line-modified"> 60 # On top of the sources that was used to compile the JDK, we need some</span>
<span class="line-removed"> 61 # extra java.rmi sources that are used just for javadoc.</span>
<span class="line-removed"> 62 MODULES_SOURCE_PATH := $(call PathList, $(call GetModuleSrcPath) \</span>
<span class="line-removed"> 63     $(SUPPORT_OUTPUTDIR)/rmic/* $(TOPDIR)/src/*/share/doc/stub)</span>
 64 
 65 # URLs
 66 JAVADOC_BASE_URL := https://docs.oracle.com/pls/topic/lookup?ctx=javase$(VERSION_NUMBER)&amp;amp;id=homepage
 67 BUG_SUBMIT_URL := https://bugreport.java.com/bugreport/
 68 COPYRIGHT_URL := legal/copyright.html
 69 LICENSE_URL := https://www.oracle.com/technetwork/java/javase/terms/license/java$(VERSION_NUMBER)speclicense.html
 70 REDISTRIBUTION_URL := https://www.oracle.com/technetwork/java/redist-137594.html
 71 
 72 # In order to get a specific ordering it&#39;s necessary to specify the total
 73 # ordering of tags as the tags are otherwise ordered in order of definition.
 74 JAVADOC_TAGS := \
 75     -tag beaninfo:X \
 76     -tag revised:X \
 77     -tag since.unbundled:X \
 78     -tag spec:X \
 79     -tag specdefault:X \
 80     -tag Note:X \
 81     -tag ToDo:X \
 82     -tag &#39;apiNote:a:API Note:&#39; \
 83     -tag &#39;implSpec:a:Implementation Requirements:&#39; \
 84     -tag &#39;implNote:a:Implementation Note:&#39; \
 85     -tag param \
 86     -tag return \
 87     -tag throws \
 88     -taglet build.tools.taglet.JSpec\$$JLS \
 89     -taglet build.tools.taglet.JSpec\$$JVMS \
 90     -taglet build.tools.taglet.ModuleGraph \
 91     -taglet build.tools.taglet.ToolGuide \
 92     -tag since \
 93     -tag serialData \
 94     -tag factory \
 95     -tag see \
 96     -taglet build.tools.taglet.ExtLink \
 97     -taglet build.tools.taglet.Incubating \
 98     -taglet build.tools.taglet.Preview \
 99     -tagletpath $(BUILDTOOLS_OUTPUTDIR)/jdk_tools_classes \
100     $(CUSTOM_JAVADOC_TAGS) \
101     #
102 
103 # The reference tags must stay stable to allow for comparisons across the
104 # development cycle. If JAVADOC_TAGS needs to change, make sure that
105 # REFERENCE_TAGS remains unchanged, by copying and hardcoding, if necessary.
106 REFERENCE_TAGS := $(JAVADOC_TAGS)
107 
108 # Which doclint checks to ignore
109 JAVADOC_DISABLED_DOCLINT := accessibility html missing syntax reference
110 
111 # The initial set of options for javadoc
112 JAVADOC_OPTIONS := -XDignore.symbol.file=true -use -keywords -notimestamp \
113     -serialwarn -encoding ISO-8859-1 -docencoding UTF-8 -breakiterator \
114     -splitIndex --system none -javafx --expand-requires transitive \
115     -XDenableValueTypes \
116     --override-methods=summary
117 
118 # The reference options must stay stable to allow for comparisons across the
119 # development cycle.
120 REFERENCE_OPTIONS := -XDignore.symbol.file=true -use -keywords -notimestamp \
121     -serialwarn -encoding ISO-8859-1 -breakiterator -splitIndex --system none \
122     -html5 -javafx --expand-requires transitive
123 
124 # Should we add DRAFT stamps to the generated javadoc?
125 ifeq ($(VERSION_IS_GA), true)
126   IS_DRAFT := false
127 else
128   IS_DRAFT := true
129 endif
130 
131 ################################################################################
132 # General text snippets
133 
134 FULL_COMPANY_NAME := Oracle and/or its affiliates
135 COMPANY_ADDRESS := 500 Oracle Parkway, Redwood Shores, CA 94065 USA
136 
137 JAVA_PLATFORM := Java Platform
138 
139 ifeq ($(IS_DRAFT), true)
140   DRAFT_MARKER_STR := &lt;br&gt;&lt;strong&gt;DRAFT $(VERSION_STRING)&lt;/strong&gt;
141   ifeq ($(VERSION_BUILD), 0)
142     DRAFT_MARKER_TITLE := $(SPACE)[ad-hoc build]
143   else
144     DRAFT_MARKER_TITLE := $(SPACE)[build $(VERSION_BUILD)]
145   endif
146   DRAFT_TEXT := This specification is not final and is subject to change. \
147       Use is subject to &lt;a href=&quot;$(LICENSE_URL)&quot;&gt;license terms&lt;/a&gt;.
148 
149   # Workaround stylesheet bug
150   HEADER_STYLE := style=&quot;margin-top: 9px;&quot;
151 else
152   HEADER_STYLE := style=&quot;margin-top: 14px;&quot;
153 endif
154 
155 # $1 - Relative prefix to COPYRIGHT_URL
156 COPYRIGHT_BOTTOM = \
157     &lt;a href=&quot;$(strip $1)$(COPYRIGHT_URL)&quot;&gt;Copyright&lt;/a&gt; \
158     &amp;copy; 1993, $(COPYRIGHT_YEAR), $(FULL_COMPANY_NAME), \
159     $(COMPANY_ADDRESS).&lt;br&gt;All rights reserved. \
160     Use is subject to &lt;a href=&quot;$(LICENSE_URL)&quot;&gt;license terms&lt;/a&gt; and the \
161     &lt;a href=&quot;$(REDISTRIBUTION_URL)&quot;&gt;documentation redistribution policy&lt;/a&gt;. \
162     $(DRAFT_MARKER_STR) &lt;!-- Version $(VERSION_STRING) --&gt;
163 
164 JAVADOC_BOTTOM := \
165     &lt;a href=&quot;$(BUG_SUBMIT_URL)&quot;&gt;Report a bug or suggest an enhancement&lt;/a&gt;&lt;br&gt; \
166     For further API reference and developer documentation see the \
167     &lt;a href=&quot;$(JAVADOC_BASE_URL)&quot; target=&quot;_blank&quot;&gt;Java SE \
168     Documentation&lt;/a&gt;, which contains more detailed, \
169     developer-targeted descriptions with conceptual overviews, definitions \
170     of terms, workarounds, and working code examples.&lt;br&gt; \
171     Java is a trademark or registered trademark of $(FULL_COMPANY_NAME) in \
172     the US and other countries.&lt;br&gt; \
173     $(call COPYRIGHT_BOTTOM, {@docroot}/../)
174 
175 JAVADOC_TOP := \
176     &lt;div style=&quot;padding: 6px; text-align: center; font-size: 80%; \
177     font-family: DejaVu Sans, Arial, Helvetica, sans-serif; \
178     font-weight: normal;&quot;&gt;$(DRAFT_TEXT)&lt;/div&gt;
179 
180 ################################################################################
181 # JDK javadoc titles/text snippets
182 
183 JDK_SHORT_NAME := Java SE $(VERSION_SPECIFICATION) &amp;amp; JDK $(VERSION_SPECIFICATION)
184 JDK_LONG_NAME := Java&lt;sup&gt;&amp;reg;&lt;/sup&gt; Platform, Standard Edition \
185     &amp;amp;&amp;nbsp;Java&amp;nbsp;Development&amp;nbsp;Kit
186 
187 ################################################################################
188 # Java SE javadoc titles/text snippets
189 
190 JAVASE_SHORT_NAME := Java SE $(VERSION_SPECIFICATION)
191 JAVASE_LONG_NAME := Java&lt;sup&gt;&amp;reg;&lt;/sup&gt; Platform, Standard Edition
192 
193 ################################################################################
194 # Functions
195 
196 # Helper function for creating a svg file from a dot file generated by the
197 # GenGraphs tool.
198 # param 1: SetupJavadocGeneration namespace ($1)
199 # param 2: module name
200 #
201 define setup_gengraph_dot_to_svg
202   $1_$2_DOT_SRC :=  $$($1_GENGRAPHS_DIR)/$2.dot
203   $1_$2_SVG_TARGET := $$($1_TARGET_DIR)/$2/module-graph.svg
204 
205     # For each module needing a graph, create a svg file from the dot file
206     # generated by the GenGraphs tool and store it in the target dir.
207     $$(eval $$(call SetupExecute, gengraphs_svg_$1_$2, \
208         INFO := Running dot for module graphs for $2, \
209         DEPS := $$(gengraphs_$1_TARGET), \
210         OUTPUT_FILE := $$($1_$2_SVG_TARGET), \
211         SUPPORT_DIR := $$($1_GENGRAPHS_DIR), \
212         COMMAND := $$(DOT) -Tsvg -o $$($1_$2_SVG_TARGET) $$($1_$2_DOT_SRC), \
213     ))
214 
215   $1_MODULEGRAPH_TARGETS += $$($1_$2_SVG_TARGET)
216 endef
217 
218 # Helper function to create the overview.html file to use with the -overview
219 # javadoc option.
220 # Returns the filename as $1_OVERVIEW.
221 #
222 # param 1: SetupJavadocGeneration namespace ($1)
223 define create_overview_file
224   $1_OVERVIEW_TEXT := \
225       &lt;!DOCTYPE html&gt; \
226       &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt; \
227       #
228   ifneq ($$($1_GROUPS),)
229     $1_OVERVIEW_TEXT += \
230       &lt;p&gt;This document is divided into \
231       $$(subst 2,two,$$(subst 3,three,$$(words $$($1_GROUPS)))) sections:&lt;/p&gt; \
232       &lt;blockquote&gt;&lt;dl&gt; \
233       #
234     $1_OVERVIEW_TEXT += $$(foreach g, $$($1_GROUPS), \
235         &lt;dt style=&quot;margin-top: 8px;&quot;&gt;$$($$g_GROUP_NAME)&lt;/dt&gt; \
236         &lt;dd style=&quot;margin-top: 8px;&quot;&gt;$$($$g_GROUP_DESCRIPTION)&lt;/dd&gt; \
237     )
238     $1_OVERVIEW_TEXT += \
239         &lt;/dl&gt;&lt;/blockquote&gt; \
240         #
241   endif
242   $1_OVERVIEW_TEXT += \
243       &lt;/body&gt;&lt;/html&gt; \
244       #
245 
246   $1_OVERVIEW := $$(SUPPORT_OUTPUTDIR)/docs/$1-overview.html
247 
248   $1_OVERVIEW_VARDEPS_FILE := $$(call DependOnVariable, $1_OVERVIEW_TEXT, \
249       $$($1_OVERVIEW).vardeps)
250 
251   $$($1_OVERVIEW): $$($1_OVERVIEW_VARDEPS_FILE)
252 	$$(call LogInfo, Creating overview.html for $1)
253 	$$(call MakeDir, $$(@D))
254 	$$(PRINTF) &gt; $$@ &#39;$$($1_OVERVIEW_TEXT)&#39;
255 endef
256 
257 ################################################################################
258 # Setup make rules to create an API documentation collection, using javadoc and
259 # other tools if needed.
260 #
261 # Parameter 1 is the name of the rule. This name is used as variable prefix.
262 # Targets generated are returned as $1_JAVADOC_TARGETS and
263 # $1_MODULEGRAPH_TARGETS. Note that the index.html file will work as a &quot;touch
264 # file&quot; for all the magnitude of files that are generated by javadoc.
265 #
266 # Remaining parameters are named arguments. These include:
267 #   MODULES - Modules to generate javadoc for
268 #   GROUPS - Name of the groups to divide the modules into, if any
269 #   SHORT_NAME - The short name of this documentation collection
270 #   LONG_NAME - The long name of this documentation collection
271 #   TARGET_DIR - Where to store the output
272 #
273 SetupApiDocsGeneration = $(NamedParamsMacroTemplate)
274 define SetupApiDocsGenerationBody
275 
276   # Figure out all modules, both specified and transitive indirect exports, that
277   # will be processed by javadoc.
278   $1_INDIRECT_EXPORTS := $$(call FindTransitiveIndirectDepsForModules, $$($1_MODULES))
279   $1_ALL_MODULES := $$(sort $$($1_MODULES) $$($1_INDIRECT_EXPORTS))
280 
281   $1_JAVA_ARGS := -Dextlink.spec.version=$$(VERSION_SPECIFICATION) \
282 	-Djspec.version=$$(VERSION_SPECIFICATION)
283 
284   ifeq ($$(ENABLE_FULL_DOCS), true)
285     # Tell the ModuleGraph taglet to generate html links to soon-to-be-created
286     # svg files with module graphs.
287     $1_JAVA_ARGS += -DenableModuleGraph=true
288   endif
289 
290   # Start with basic options and tags
291   ifeq ($$($1_OPTIONS), )
292     $1_OPTIONS := $$(JAVADOC_OPTIONS)
293   endif
294   ifeq ($$($1_TAGS), )
295     $1_TAGS := $$(JAVADOC_TAGS)
296   endif
297   $1_OPTIONS += $$($1_TAGS)
298 
299   $1_OPTIONS += --module-source-path $$(MODULES_SOURCE_PATH)
300   $1_OPTIONS += --module $$(call CommaList, $$($1_MODULES))
301 
302   # Create a string like &quot;-Xdoclint:all,-syntax,-html,...&quot;
303   $1_OPTIONS += -Xdoclint:all,$$(call CommaList, $$(addprefix -, \
304       $$(JAVADOC_DISABLED_DOCLINT)))
305 
306   $1_DOC_TITLE := $$($1_LONG_NAME)&lt;br&gt;Version $$(VERSION_SPECIFICATION) API \
307       Specification
308   $1_WINDOW_TITLE := $$(subst &amp;amp;,&amp;,$$($1_SHORT_NAME))$$(DRAFT_MARKER_TITLE)
309   $1_HEADER_TITLE := &lt;div $$(HEADER_STYLE)&gt;&lt;strong&gt;$$($1_SHORT_NAME)&lt;/strong&gt; \
310       $$(DRAFT_MARKER_STR)&lt;/div&gt;
311 
312   $1_OPTIONS += -doctitle &#39;$$($1_DOC_TITLE)&#39;
313   $1_OPTIONS += -windowtitle &#39;$$($1_WINDOW_TITLE)&#39;
314   $1_OPTIONS += -header &#39;$$($1_HEADER_TITLE)&#39;
315   $1_OPTIONS += -bottom &#39;$$(JAVADOC_BOTTOM)&#39;
316   ifeq ($$(IS_DRAFT), true)
317     $1_OPTIONS += -top &#39;$$(JAVADOC_TOP)&#39;
318   endif
319 
320   # Do not store debug level options in VARDEPS.
321   ifneq ($$(LOG_LEVEL), trace)
322     $1_LOG_OPTION += -quiet
323   else
324     $1_LOG_OPTION += -verbose
325   endif
326 
327   # Generate the overview.html file. This will return the filename in
328   # $1_OVERVIEW.
329   $$(eval $$(call create_overview_file,$1))
330   $1_OPTIONS += -overview $$($1_OVERVIEW)
331 
332   $$(foreach g, $$($1_GROUPS), \
333     $$(eval $1_OPTIONS += -group &quot;$$($$g_GROUP_NAME)&quot; &quot;$$($$g_GROUP_MODULES)&quot;) \
334   )
335 
336   ifeq ($$($1_JAVADOC_CMD), )
337     $1_JAVADOC_CMD := $$(JAVA) -Djava.awt.headless=true $$($1_JAVA_ARGS) \
338         $$(NEW_JAVADOC)
339   else
340     $1_OPTIONS += $$(addprefix -J, $$($1_JAVA_ARGS))
341   endif
342 
343   $1_VARDEPS := $$($1_JAVA_ARGS) $$($1_OPTIONS) $$(MODULES_SOURCE_PATH) \
344       $$($1_ALL_MODULES) $$($1_JAVADOC_CMD)
345   $1_VARDEPS_FILE := $$(call DependOnVariable, $1_VARDEPS, \
346       $$(SUPPORT_OUTPUTDIR)/docs/$1.vardeps)
347 
348   # Get a list of all files in all the source dirs for all included modules
349   $1_SOURCE_DEPS := $$(call FindFiles, $$(wildcard $$(foreach module, \
350       $$($1_ALL_MODULES), $$(call FindModuleSrcDirs, $$(module)))))
351 
352   $$(eval $$(call SetupExecute, javadoc_$1, \
353       WARN := Generating $1 javadoc for $$(words $$($1_ALL_MODULES)) modules, \
354       INFO := Javadoc modules: $$($1_ALL_MODULES), \
355       DEPS := $$(BUILD_TOOLS_JDK) $$($1_VARDEPS_FILE) $$($1_SOURCE_DEPS) \
356           $$($1_OVERVIEW), \
357       OUTPUT_DIR := $$($1_TARGET_DIR), \
358       SUPPORT_DIR := $$(SUPPORT_OUTPUTDIR)/docs, \
359       COMMAND := $$($1_JAVADOC_CMD) -d $$($1_TARGET_DIR) $$($1_OPTIONS) \
360           $$($1_LOG_OPTION), \
361   ))
362 
363   $1_JAVADOC_TARGETS := $$(javadoc_$1_TARGET)
364 
365   ifeq ($$(ENABLE_FULL_DOCS), true)
366     # We have asked ModuleGraph to generate links to svg files. Now we must
367     # produce the svg files.
368 
369     # Locate which modules has the @moduleGraph tag in their module-info.java
370     $1_MODULES_NEEDING_GRAPH := $$(strip $$(foreach m, $$($1_ALL_MODULES), \
371       $$(if $$(shell $$(GREP) -e @moduleGraph \
372           $$(wildcard $$(addsuffix /module-info.java, \
373           $$(call FindModuleSrcDirs, $$m)))), \
374         $$m) \
375     ))
376 
377     # First we run the GenGraph tool. It will query the module structure of the
378     # running JVM and output .dot files for all existing modules.
379     GENGRAPHS_PROPS := \
380         $$(TOPDIR)/make/jdk/src/classes/build/tools/jigsaw/javadoc-graphs.properties
381 
382     $1_GENGRAPHS_DIR := $$(SUPPORT_OUTPUTDIR)/docs/$1-gengraphs
383 
384     $$(eval $$(call SetupExecute, gengraphs_$1, \
385         INFO := Running gengraphs for $1 documentation, \
386         DEPS := $$(BUILD_JIGSAW_TOOLS) $$(GENGRAPHS_PROPS), \
387         OUTPUT_DIR := $$($1_GENGRAPHS_DIR), \
388         COMMAND := $$(TOOL_GENGRAPHS) --spec --output $$($1_GENGRAPHS_DIR) \
389             --dot-attributes $$(GENGRAPHS_PROPS), \
390     ))
391 
392     # For each module needing a graph, create a svg file from the dot file
393     # generated by the GenGraphs tool and store it in the target dir.
394     # They will depend on gengraphs_$1_TARGET, and will be added to $1.
395     $$(foreach m, $$($1_MODULES_NEEDING_GRAPH), \
396       $$(eval $$(call setup_gengraph_dot_to_svg,$1,$$m)) \
397     )
398   endif
399 endef
400 
401 ################################################################################
402 # Setup generation of the JDK API documentation (javadoc + modulegraph)
403 
404 # Define the groups of the JDK API documentation
405 JavaSE_GROUP_NAME := Java SE
406 JavaSE_GROUP_MODULES := $(call ColonList, $(sort java.se \
407     $(call FindTransitiveIndirectDepsForModules, java.se)))
408 JavaSE_GROUP_DESCRIPTION := \
409     The Java Platform, Standard Edition (Java SE) APIs define the core Java \
410     platform for general-purpose computing. These APIs are in modules whose \
411     names start with {@code java}. \
412     #
413 JDK_GROUPS += JavaSE
414 
415 JDK_GROUP_NAME := JDK
416 JDK_GROUP_MODULES := jdk.*
417 JDK_GROUP_DESCRIPTION := \
418     The Java Development Kit (JDK) APIs are specific to the JDK and will not \
419     necessarily be available in all implementations of the Java SE Platform. \
420     These APIs are in modules whose names start with {@code jdk}. \
421     #
422 JDK_GROUPS += JDK
423 
424 # If we are importing JavaFX, we need a JavaFX group. In an ideal world, this
425 # would have been abstracted away to a more proper generic handling of imported
426 # modules.
427 ifneq ($(findstring javafx., $(IMPORTED_MODULES)), )
428   JavaFX_GROUP_NAME := JavaFX
429   JavaFX_GROUP_MODULES := javafx.*
430   JavaFX_GROUP_DESCRIPTION := \
431       The JavaFX APIs define a set of user-interface controls, graphics, \
432       media, and web packages for developing rich client applications. These \
433       APIs are in modules whose names start with {@code javafx}. \
434       #
435   JDK_GROUPS += JavaFX
436 endif
437 
438 # All modules to have docs generated by docs-jdk-api target
439 JDK_MODULES := $(sort $(filter-out $(MODULES_FILTER), $(DOCS_MODULES)))
440 
441 $(eval $(call SetupApiDocsGeneration, JDK_API, \
442     MODULES := $(JDK_MODULES), \
443     GROUPS := $(JDK_GROUPS), \
444     SHORT_NAME := $(JDK_SHORT_NAME), \
445     LONG_NAME := $(JDK_LONG_NAME), \
446     TARGET_DIR := $(DOCS_OUTPUTDIR)/api, \
447 ))
448 
449 # Targets generated are returned in JDK_API_JAVADOC_TARGETS and
450 # JDK_API_MODULEGRAPH_TARGETS.
451 
452 ################################################################################
453 # Setup generation of the Java SE API documentation (javadoc + modulegraph)
454 
455 # The Java SE module scope is just java.se and its transitive indirect
456 # exports.
457 JAVASE_MODULES := java.se
458 
459 $(eval $(call SetupApiDocsGeneration, JAVASE_API, \
460     MODULES := $(JAVASE_MODULES), \
461     SHORT_NAME := $(JAVASE_SHORT_NAME), \
462     LONG_NAME := $(JAVASE_LONG_NAME), \
463     TARGET_DIR := $(IMAGES_OUTPUTDIR)/javase-docs/api, \
464 ))
465 
466 # Targets generated are returned in JAVASE_API_JAVADOC_TARGETS and
467 # JAVASE_API_MODULEGRAPH_TARGETS.
468 
469 ################################################################################
470 # Setup generation of the reference Java SE API documentation (javadoc + modulegraph)
471 
472 # The reference javadoc is just the same as javase, but using the BootJDK javadoc
473 # and a stable set of javadoc options.  Typically it is used for generating
474 # diffs between the reference javadoc and a javadoc bundle of a specific build
475 # generated in the same way.
476 
477 $(eval $(call SetupApiDocsGeneration, REFERENCE_API, \
478     MODULES := $(JAVASE_MODULES), \
479     SHORT_NAME := $(JAVASE_SHORT_NAME), \
480     LONG_NAME := $(JAVASE_LONG_NAME), \
481     TARGET_DIR := $(IMAGES_OUTPUTDIR)/reference-docs/api, \
482     JAVADOC_CMD := $(JAVADOC), \
483     OPTIONS := $(REFERENCE_OPTIONS), \
484     TAGS := $(REFERENCE_TAGS), \
485 ))
486 
487 # Targets generated are returned in REFERENCE_API_JAVADOC_TARGETS and
488 # REFERENCE_API_MODULEGRAPH_TARGETS.
489 
490 ################################################################################
491 
492 # Use this variable to control which spec files are included in the output.
493 # Format: space-delimited list of names, including at most one &#39;%&#39; as a
494 # wildcard. Spec source files match if their filename or any enclosing folder
495 # name matches one of the items in SPEC_FILTER.
496 SPEC_FILTER := %
497 
498 ApplySpecFilter = \
499     $(strip $(foreach file, $(1), \
500         $(eval searchkeys := $(subst /, ,$(subst $(WORKSPACE_ROOT),,$(file)))) \
501         $(if $(filter $(SPEC_FILTER), $(searchkeys)), \
502             $(file) \
503         ) \
504     ))
505 
506 # Copy the global resources, including the top-level redirect index.html
507 GLOBAL_SPECS_RESOURCES_DIR := $(TOPDIR)/make/data/docs-resources
508 $(eval $(call SetupCopyFiles, COPY_GLOBAL_RESOURCES, \
509     SRC := $(GLOBAL_SPECS_RESOURCES_DIR), \
510     FILES := $(call ApplySpecFilter, $(call FindFiles, $(GLOBAL_SPECS_RESOURCES_DIR))), \
511     DEST := $(DOCS_OUTPUTDIR), \
512 ))
513 JDK_INDEX_TARGETS += $(COPY_GLOBAL_RESOURCES)
514 
515 # Copy the legal notices distributed with the docs bundle
516 $(eval $(call SetupCopyFiles, COPY_DOCS_LEGAL_NOTICES, \
517     SRC := $(TOPDIR)/src/jdk.javadoc/share/legal, \
518     FILES := $(call ApplySpecFilter, $(wildcard $(TOPDIR)/src/jdk.javadoc/share/legal/*)), \
519     DEST := $(DOCS_OUTPUTDIR)/legal, \
520 ))
521 JDK_INDEX_TARGETS += $(COPY_DOCS_LEGAL_NOTICES)
522 
523 ################################################################################
524 # Copy JDK specs files
525 
526 # For all non html/md files in $module/share/specs directories, copy them
527 # unmodified
528 
529 ALL_MODULES := $(call FindAllModules)
530 COPY_SPEC_FILTER := %.gif %.jpg %.mib %.css
531 
532 $(foreach m, $(ALL_MODULES), \
533   $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \
534   $(foreach d, $(SPECS_$m), \
535     $(if $(call ApplySpecFilter, $(filter $(COPY_SPEC_FILTER), $(call FindFiles, $d))), \
536       $(eval $(call SetupCopyFiles, COPY_$m, \
537           SRC := $d, \
538           FILES := $(call ApplySpecFilter, $(filter $(COPY_SPEC_FILTER), $(call FindFiles, $d))), \
539           DEST := $(DOCS_OUTPUTDIR)/specs/, \
540       )) \
541       $(eval JDK_SPECS_TARGETS += $(COPY_$m)) \
542     ) \
543   ) \
544 )
545 
546 # Create copyright footer variables. We need different variables for different
547 # relative paths to the copyright.html file. The number 0-2 below represent how
548 # many extra directory levels down below the specs dir the specs html file is
549 # located.
550 SPECS_BOTTOM = &lt;footer class=&quot;legal-footer&quot;&gt;&lt;hr/&gt;$(COPYRIGHT_BOTTOM)&lt;/footer&gt;
551 # The legal dir is one ../ below the specs dir, so start with one ../.
552 specs_bottom_rel_path := ../
553 $(foreach n, 0 1 2, \
554   $(eval SPECS_BOTTOM_$n := $(call SPECS_BOTTOM,$(specs_bottom_rel_path))) \
555   $(eval specs_bottom_rel_path := $(specs_bottom_rel_path)../) \
556 )
557 
558 SPECS_TOP := $(if $(filter true, $(IS_DRAFT)), &lt;header class=&quot;draft-header&quot;&gt;$(DRAFT_TEXT)&lt;/header&gt;)
559 
560 # For all html files in $module/share/specs directories, copy and add the
561 # copyright footer.
562 
563 $(foreach m, $(ALL_MODULES), \
564   $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \
565   $(foreach d, $(SPECS_$m), \
566     $(foreach f, $(call ApplySpecFilter, $(filter %.html, $(call FindFiles, $d))), \
567       $(eval $m_$f_NOF_SUBDIRS := $(words $(subst /, $(SPACE), $(subst $d, , $(dir $f))))) \
568       $(eval $m_$f_NAME := PROCESS_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \
569       $(eval $(call SetupTextFileProcessing, $($m_$f_NAME), \
570           SOURCE_FILES := $f, \
571           SOURCE_BASE_DIR := $d, \
572           OUTPUT_DIR := $(DOCS_OUTPUTDIR)/specs/, \
573           REPLACEMENTS := \
574               &lt;body&gt; =&gt; &lt;body&gt;$(SPECS_TOP) ; \
575               &lt;/body&gt; =&gt; $(SPECS_BOTTOM_$($m_$f_NOF_SUBDIRS))&lt;/body&gt;, \
576       )) \
577       $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \
578     ) \
579   ) \
580 )
581 
582 ifeq ($(ENABLE_PANDOC), true)
583   # For all markdown files in $module/share/specs directories, convert them to
584   # html, if we have pandoc (otherwise we&#39;ll just skip this).
585 
586   GLOBAL_SPECS_DEFAULT_CSS_FILE := $(DOCS_OUTPUTDIR)/resources/jdk-default.css
587 
588   $(foreach m, $(ALL_MODULES), \
589     $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \
590     $(foreach d, $(SPECS_$m), \
591       $(foreach f, $(call ApplySpecFilter, $(filter %.md, $(call FindFiles, $d))), \
592         $(eval $m_$f_NOF_SUBDIRS := $(words $(subst /, $(SPACE), $(subst $d, , $(dir $f))))) \
593         $(eval $m_$f_NAME := SPECS_TO_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \
594         $(eval $(call SetupProcessMarkdown, $($m_$f_NAME), \
595             SRC := $d, \
596             FILES := $f, \
597             DEST := $(DOCS_OUTPUTDIR)/specs/, \
598             CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \
599             OPTIONS := -V include-before=&#39;$(SPECS_TOP)&#39; -V include-after=&#39;$(SPECS_BOTTOM_$($m_$f_NOF_SUBDIRS))&#39;, \
600             REPLACEMENTS := \
601 		@@VERSION_SPECIFICATION@@ =&gt; $(VERSION_SPECIFICATION) ; \
602 		@@VERSION_STRING@@ =&gt; $(VERSION_STRING), \
603             POST_PROCESS := $(TOOL_FIXUPPANDOC), \
604         )) \
605         $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \
606       ) \
607     ) \
608   )
609 
610   # For all markdown files in $module/share/man directories, convert them to
611   # html.
612 
613   # Create dynamic man pages from markdown using pandoc. We need
614   # PANDOC_HTML_MANPAGE_FILTER, a wrapper around
615   # PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT. This is created by buildtools-jdk.
616 
617   # We should also depend on the source javascript filter
618   PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT := \
619       $(TOPDIR)/make/scripts/pandoc-html-manpage-filter.js
620 
621   $(foreach m, $(ALL_MODULES), \
622     $(eval MAN_$m := $(call FindModuleManDirs, $m)) \
623     $(foreach d, $(MAN_$m), \
624       $(foreach f, $(call ApplySpecFilter, $(filter %.md, $(call FindFiles, $d))), \
625         $(eval $m_$f_NAME := MAN_TO_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \
626         $(eval $(call SetupProcessMarkdown, $($m_$f_NAME), \
627             SRC := $d, \
628             FILES := $f, \
629             DEST := $(DOCS_OUTPUTDIR)/specs/man, \
630             FILTER := $(PANDOC_HTML_MANPAGE_FILTER), \
631             CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \
632             REPLACEMENTS := \
633 		@@COPYRIGHT_YEAR@@ =&gt; $(COPYRIGHT_YEAR) ; \
634 		@@VERSION_SHORT@@ =&gt; $(VERSION_SHORT) ; \
635 		@@VERSION_SPECIFICATION@@ =&gt; $(VERSION_SPECIFICATION), \
636             OPTIONS := --toc -V include-before=&#39;$(SPECS_TOP)&#39; -V include-after=&#39;$(SPECS_BOTTOM_1)&#39;, \
637             POST_PROCESS := $(TOOL_FIXUPPANDOC), \
638             EXTRA_DEPS := $(PANDOC_HTML_MANPAGE_FILTER) \
639                 $(PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT), \
640         )) \
641         $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \
642       ) \
643     ) \
644   )
645 
646   # The html generated from markdown also needs the css file
647   JDK_SPECS_TARGETS += $(COPY_GLOBAL_RESOURCES)
648 endif
649 
650 # Special treatment for generated documentation
651 
652 JDWP_PROTOCOL := $(SUPPORT_OUTPUTDIR)/gensrc/jdk.jdi/jdwp-protocol.html
653 ifneq ($(call ApplySpecFilter, $(JDWP_PROTOCOL)), )
654   $(eval $(call SetupTextFileProcessing, PROCESS_JDWP_PROTOCOL, \
655       SOURCE_FILES := $(JDWP_PROTOCOL), \
656       OUTPUT_DIR := $(DOCS_OUTPUTDIR)/specs/jdwp, \
657       REPLACEMENTS := \
658           &lt;body&gt; =&gt; &lt;body&gt;$(SPECS_TOP) ; \
659           &lt;/body&gt; =&gt; $(SPECS_BOTTOM_1)&lt;/body&gt;, \
660   ))
661   JDK_SPECS_TARGETS += $(PROCESS_JDWP_PROTOCOL)
662 endif
663 
664 # Get jvmti.html from the main jvm variant (all variants&#39; jvmti.html are identical).
665 JVMTI_HTML ?= $(HOTSPOT_OUTPUTDIR)/variant-$(JVM_VARIANT_MAIN)/gensrc/jvmtifiles/jvmti.html
666 ifneq ($(call ApplySpecFilter, $(JVMTI_HTML)), )
667   $(eval $(call SetupTextFileProcessing, PROCESS_JVMTI_HTML, \
668       SOURCE_FILES := $(JVMTI_HTML), \
669       OUTPUT_DIR := $(DOCS_OUTPUTDIR)/specs/, \
670       REPLACEMENTS := \
671           &lt;body&gt; =&gt; &lt;body&gt;$(SPECS_TOP) ; \
672           &lt;/body&gt; =&gt; $(SPECS_BOTTOM_0)&lt;/body&gt;, \
673   ))
674   JDK_SPECS_TARGETS += $(PROCESS_JVMTI_HTML)
675 endif
676 
677 ################################################################################
678 # Optional target which bundles all generated javadocs into a zip archive.
679 
680 JAVADOC_ZIP_NAME := jdk-$(VERSION_STRING)-docs.zip
681 JAVADOC_ZIP_FILE := $(OUTPUTDIR)/bundles/$(JAVADOC_ZIP_NAME)
682 
683 $(eval $(call SetupZipArchive, BUILD_JAVADOC_ZIP, \
684     SRC := $(DOCS_OUTPUTDIR), \
685     ZIP := $(JAVADOC_ZIP_FILE), \
686     EXTRA_DEPS := $(JDK_API_JAVADOC_TARGETS) $(JDK_API_MODULEGRAPH_TARGETS) \
687         $(JDK_SPECS_TARGETS), \
688 ))
689 
690 ZIP_TARGETS += $(BUILD_JAVADOC_ZIP)
691 
692 ################################################################################
693 # Hook to include the corresponding custom file, if present.
694 $(eval $(call IncludeCustomExtension, Docs-post.gmk))
695 
696 ################################################################################
697 # Bundles all generated specs into a zip archive, skipping javadocs.
698 
699 SPECS_ZIP_NAME := jdk-$(VERSION_STRING)-specs.zip
700 SPECS_ZIP_FILE := $(OUTPUTDIR)/bundles/$(SPECS_ZIP_NAME)
701 
702 $(eval $(call SetupZipArchive, BUILD_SPECS_ZIP, \
703     SRC := $(DOCS_OUTPUTDIR), \
704     ZIP := $(SPECS_ZIP_FILE), \
705     EXTRA_DEPS := $(JDK_SPECS_TARGETS), \
706 ))
707 
708 SPECS_ZIP_TARGETS += $(BUILD_SPECS_ZIP)
709 
710 ################################################################################
711 
712 docs-jdk-api-javadoc: $(JDK_API_JAVADOC_TARGETS) $(JDK_API_CUSTOM_TARGETS)
713 
714 docs-jdk-api-modulegraph: $(JDK_API_MODULEGRAPH_TARGETS)
715 
716 docs-javase-api-javadoc: $(JAVASE_API_JAVADOC_TARGETS) $(JAVASE_API_CUSTOM_TARGETS)
717 
718 docs-javase-api-modulegraph: $(JAVASE_API_MODULEGRAPH_TARGETS)
719 
720 docs-reference-api-javadoc: $(REFERENCE_API_JAVADOC_TARGETS) $(REFERENCE_API_CUSTOM_TARGETS)
721 
722 docs-reference-api-modulegraph: $(REFERENCE_API_MODULEGRAPH_TARGETS)
723 
724 docs-jdk-specs: $(JDK_SPECS_TARGETS)
725 
726 docs-jdk-index: $(JDK_INDEX_TARGETS)
727 
728 docs-zip: $(ZIP_TARGETS)
729 
730 docs-specs-zip: $(SPECS_ZIP_TARGETS)
731 
732 all: docs-jdk-api-javadoc docs-jdk-api-modulegraph docs-javase-api-javadoc \
733     docs-javase-api-modulegraph docs-reference-api-javadoc \
734     docs-reference-api-modulegraph docs-jdk-specs docs-jdk-index docs-zip \
735     docs-specs-zip
736 
737 .PHONY: default all docs-jdk-api-javadoc docs-jdk-api-modulegraph \
738     docs-javase-api-javadoc docs-javase-api-modulegraph \
739     docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \
740     docs-jdk-index docs-zip docs-specs-zip
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>