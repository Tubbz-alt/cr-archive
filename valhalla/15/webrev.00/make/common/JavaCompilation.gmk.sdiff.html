<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/common/JavaCompilation.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="FindTests.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Modules.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/common/JavaCompilation.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
137     $1_ALL_COPY_CLEAN_TARGETS += $$($1_BIN)$$($1_MODULE_SUBDIR)$$($2_TARGET)
138   endif
139 endef
140 
141 define remove_string
142   $2 := $$(subst $1,,$$($2))
143 endef
144 
145 # Setup make rules for compiling Java source code to class files and/or a
146 # resulting jar file.
147 #
148 # Parameter 1 is the name of the rule. This name is used as variable prefix,
149 # and the targets generated are listed in a variable by that name.
150 #
151 # The target for public API digest is returned in $1_API_TARGET.
152 #
153 # Remaining parameters are named arguments. These include:
154 #   SETUP:=must point to a previously setup java compiler, for example: SETUP:=BOOTJAVAC
155 #   JVM:=path to ..bin/java
156 #   ADD_JAVAC_FLAGS:=javac flags to append to the default ones.

157 #   SRC:=one or more directories to search for sources. The order of the source roots
158 #        is significant. The first found file of a certain name has priority.
159 #   BIN:=store classes here
160 #   MODULE:=Name of module being compiled. If set, classes are put in BIN/MODULE.
161 #   CLASSPATH:=a list of additional entries to set as classpath to javac
162 #   INCLUDES:=myapp.foo means will only compile java files in myapp.foo or any of its sub-packages.
163 #   EXCLUDES:=myapp.foo means will do not compile java files in myapp.foo or any of its sub-packages.
164 #   COPY:=.prp means copy all prp files to the corresponding package in BIN.
165 #   COPY_FILES:=myapp/foo/setting.txt means copy this file over to the package myapp/foo
166 #   CLEAN:=.properties means copy and clean all properties file to the corresponding package in BIN.
167 #   CLEAN_FILES:=myapp/foo/setting.txt means clean this file over to the package myapp/foo
168 #   SRCZIP:=Create a src.zip based on the found sources and copied files.
169 #   INCLUDE_FILES:=&quot;com/sun/SolarisFoobar.java&quot; means only compile this file!
170 #   EXCLUDE_FILES:=&quot;com/sun/SolarisFoobar.java&quot; means do not compile this particular file!
171 #       &quot;SolarisFoobar.java&quot; means do not compile SolarisFoobar, wherever it is found.
172 #   EXTRA_FILES:=List of extra source files to include in compilation. Can be used to
173 #       specify files that need to be generated by other rules first.
174 #   HEADERS:=path to directory where all generated c-headers are written.
175 #   DEPENDS:=Extra dependecy
176 #   DISABLE_SJAVAC:=Explicitly disable the use of sjavac for this compilation unit.
</pre>
<hr />
<pre>
181 #   CREATE_API_DIGEST:=Set to true to use a javac plugin to generate a public API
182 #        hash which can be used for down stream dependencies to only rebuild
183 #        when the API changes. Implicitly used in sjavac.
184 #   KEEP_ALL_TRANSLATIONS:=Set to true to skip translation filtering
185 SetupJavaCompilation = $(NamedParamsMacroTemplate)
186 define SetupJavaCompilationBody
187 
188   # Verify arguments
189   ifeq ($$($1_BIN),)
190     $$(error Must specify BIN (in $1))
191   endif
192 
193   # Extract the info from the java compiler setup.
194   $1_JVM := $$($$($1_SETUP)_JVM)
195   $1_JAVAC := $$($$($1_SETUP)_JAVAC)
196   $1_FLAGS :=
197   ifneq ($$($1_DEBUG_SYMBOLS), false)
198     $1_FLAGS := -g
199   endif
200   $1_FLAGS += $$($$($1_SETUP)_FLAGS) $$($1_ADD_JAVAC_FLAGS) $(JAVAC_FLAGS)





201   ifneq ($$($1_CLASSPATH), )
202     $1_FLAGS += -cp $$(call PathList, $$($1_CLASSPATH))
203   endif

204   ifeq ($$($1_JAVAC),)
205     $$(error The Java compilation $1 refers to a non-existant java compiler setup $$($1_SETUP))
206   endif
207   $1_SJAVAC_PORTFILE := $$($$($1_SETUP)_SJAVAC_PORTFILE)
208   $1_SERVER_JVM := $$($$($1_SETUP)_SERVER_JVM)
209   $1_DISABLE_SJAVAC := $$($$($1_SETUP)_DISABLE_SJAVAC)
210 
211   ifneq ($$($1_MODULE), )
212     $1_MODULE_SUBDIR := /$$($1_MODULE)
213   endif
214 
215   # Make sure the dirs exist, or that one of the EXTRA_FILES, that may not
216   # exist yet, is in it.
217   $$(foreach d, $$($1_SRC), \
218     $$(if $$(wildcard $$d), , \
219       $$(if $$(filter $$d%, $$($1_EXTRA_FILES)), , \
220         $$(error SRC specified to SetupJavaCompilation $1 contains missing directory &gt;$$d&lt;) \
221       ) \
222     ) \
223   )
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
137     $1_ALL_COPY_CLEAN_TARGETS += $$($1_BIN)$$($1_MODULE_SUBDIR)$$($2_TARGET)
138   endif
139 endef
140 
141 define remove_string
142   $2 := $$(subst $1,,$$($2))
143 endef
144 
145 # Setup make rules for compiling Java source code to class files and/or a
146 # resulting jar file.
147 #
148 # Parameter 1 is the name of the rule. This name is used as variable prefix,
149 # and the targets generated are listed in a variable by that name.
150 #
151 # The target for public API digest is returned in $1_API_TARGET.
152 #
153 # Remaining parameters are named arguments. These include:
154 #   SETUP:=must point to a previously setup java compiler, for example: SETUP:=BOOTJAVAC
155 #   JVM:=path to ..bin/java
156 #   ADD_JAVAC_FLAGS:=javac flags to append to the default ones.
<span class="line-added">157 #   DISABLED_WARNINGS:=list of Xlint warnings that should be disabled</span>
158 #   SRC:=one or more directories to search for sources. The order of the source roots
159 #        is significant. The first found file of a certain name has priority.
160 #   BIN:=store classes here
161 #   MODULE:=Name of module being compiled. If set, classes are put in BIN/MODULE.
162 #   CLASSPATH:=a list of additional entries to set as classpath to javac
163 #   INCLUDES:=myapp.foo means will only compile java files in myapp.foo or any of its sub-packages.
164 #   EXCLUDES:=myapp.foo means will do not compile java files in myapp.foo or any of its sub-packages.
165 #   COPY:=.prp means copy all prp files to the corresponding package in BIN.
166 #   COPY_FILES:=myapp/foo/setting.txt means copy this file over to the package myapp/foo
167 #   CLEAN:=.properties means copy and clean all properties file to the corresponding package in BIN.
168 #   CLEAN_FILES:=myapp/foo/setting.txt means clean this file over to the package myapp/foo
169 #   SRCZIP:=Create a src.zip based on the found sources and copied files.
170 #   INCLUDE_FILES:=&quot;com/sun/SolarisFoobar.java&quot; means only compile this file!
171 #   EXCLUDE_FILES:=&quot;com/sun/SolarisFoobar.java&quot; means do not compile this particular file!
172 #       &quot;SolarisFoobar.java&quot; means do not compile SolarisFoobar, wherever it is found.
173 #   EXTRA_FILES:=List of extra source files to include in compilation. Can be used to
174 #       specify files that need to be generated by other rules first.
175 #   HEADERS:=path to directory where all generated c-headers are written.
176 #   DEPENDS:=Extra dependecy
177 #   DISABLE_SJAVAC:=Explicitly disable the use of sjavac for this compilation unit.
</pre>
<hr />
<pre>
182 #   CREATE_API_DIGEST:=Set to true to use a javac plugin to generate a public API
183 #        hash which can be used for down stream dependencies to only rebuild
184 #        when the API changes. Implicitly used in sjavac.
185 #   KEEP_ALL_TRANSLATIONS:=Set to true to skip translation filtering
186 SetupJavaCompilation = $(NamedParamsMacroTemplate)
187 define SetupJavaCompilationBody
188 
189   # Verify arguments
190   ifeq ($$($1_BIN),)
191     $$(error Must specify BIN (in $1))
192   endif
193 
194   # Extract the info from the java compiler setup.
195   $1_JVM := $$($$($1_SETUP)_JVM)
196   $1_JAVAC := $$($$($1_SETUP)_JAVAC)
197   $1_FLAGS :=
198   ifneq ($$($1_DEBUG_SYMBOLS), false)
199     $1_FLAGS := -g
200   endif
201   $1_FLAGS += $$($$($1_SETUP)_FLAGS) $$($1_ADD_JAVAC_FLAGS) $(JAVAC_FLAGS)
<span class="line-added">202 </span>
<span class="line-added">203   ifneq ($$($1_DISABLED_WARNINGS), )</span>
<span class="line-added">204     $1_FLAGS += -Xlint:$$(call CommaList, $$(addprefix -, $$($1_DISABLED_WARNINGS)))</span>
<span class="line-added">205   endif</span>
<span class="line-added">206 </span>
207   ifneq ($$($1_CLASSPATH), )
208     $1_FLAGS += -cp $$(call PathList, $$($1_CLASSPATH))
209   endif
<span class="line-added">210 </span>
211   ifeq ($$($1_JAVAC),)
212     $$(error The Java compilation $1 refers to a non-existant java compiler setup $$($1_SETUP))
213   endif
214   $1_SJAVAC_PORTFILE := $$($$($1_SETUP)_SJAVAC_PORTFILE)
215   $1_SERVER_JVM := $$($$($1_SETUP)_SERVER_JVM)
216   $1_DISABLE_SJAVAC := $$($$($1_SETUP)_DISABLE_SJAVAC)
217 
218   ifneq ($$($1_MODULE), )
219     $1_MODULE_SUBDIR := /$$($1_MODULE)
220   endif
221 
222   # Make sure the dirs exist, or that one of the EXTRA_FILES, that may not
223   # exist yet, is in it.
224   $$(foreach d, $$($1_SRC), \
225     $$(if $$(wildcard $$d), , \
226       $$(if $$(filter $$d%, $$($1_EXTRA_FILES)), , \
227         $$(error SRC specified to SetupJavaCompilation $1 contains missing directory &gt;$$d&lt;) \
228       ) \
229     ) \
230   )
</pre>
</td>
</tr>
</table>
<center><a href="FindTests.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Modules.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>