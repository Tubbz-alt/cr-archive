<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/cpu/x86/macroAssembler_x86.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../index.html" target="_top">index</a> <a href="macroAssembler_x86.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/x86/macroAssembler_x86.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -2624,11 +2624,11 @@</span>
  void MacroAssembler::test_klass_is_empty_value(Register klass, Register temp_reg, Label&amp; is_empty_value) {
  #ifdef ASSERT
    {
      Label done_check;
      test_klass_is_value(klass, temp_reg, done_check);
<span class="udiff-line-modified-removed">-     stop(&quot;test_klass_is_empty_value with none value klass&quot;);</span>
<span class="udiff-line-modified-added">+     stop(&quot;test_klass_is_empty_value with non value klass&quot;);</span>
      bind(done_check);
    }
  #endif
    movl(temp_reg, Address(klass, InstanceKlass::misc_flags_offset()));
    testl(temp_reg, InstanceKlass::misc_flags_is_empty_value());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2659,34 +2659,54 @@</span>
    jcc(Assembler::notZero, is_flattened);
  }
  
  void MacroAssembler::test_flattened_array_oop(Register oop, Register temp_reg,
                                                Label&amp;is_flattened_array) {
<span class="udiff-line-modified-removed">-   load_storage_props(temp_reg, oop);</span>
<span class="udiff-line-modified-removed">-   testb(temp_reg, ArrayStorageProperties::flattened_value);</span>
<span class="udiff-line-modified-removed">-   jcc(Assembler::notZero, is_flattened_array);</span>
<span class="udiff-line-modified-added">+   load_klass(temp_reg, oop);</span>
<span class="udiff-line-modified-added">+   movl(temp_reg, Address(temp_reg, Klass::layout_helper_offset()));</span>
<span class="udiff-line-modified-added">+   test_flattened_array_layout(temp_reg, is_flattened_array);</span>
  }
  
  void MacroAssembler::test_non_flattened_array_oop(Register oop, Register temp_reg,
                                                    Label&amp;is_non_flattened_array) {
<span class="udiff-line-modified-removed">-   load_storage_props(temp_reg, oop);</span>
<span class="udiff-line-modified-removed">-   testb(temp_reg, ArrayStorageProperties::flattened_value);</span>
<span class="udiff-line-modified-removed">-   jcc(Assembler::zero, is_non_flattened_array);</span>
<span class="udiff-line-modified-added">+   load_klass(temp_reg, oop);</span>
<span class="udiff-line-modified-added">+   movl(temp_reg, Address(temp_reg, Klass::layout_helper_offset()));</span>
<span class="udiff-line-modified-added">+   test_non_flattened_array_layout(temp_reg, is_non_flattened_array);</span>
  }
  
  void MacroAssembler::test_null_free_array_oop(Register oop, Register temp_reg, Label&amp;is_null_free_array) {
<span class="udiff-line-modified-removed">-   load_storage_props(temp_reg, oop);</span>
<span class="udiff-line-modified-removed">-   testb(temp_reg, ArrayStorageProperties::null_free_value);</span>
<span class="udiff-line-modified-removed">-   jcc(Assembler::notZero, is_null_free_array);</span>
<span class="udiff-line-modified-added">+   load_klass(temp_reg, oop);</span>
<span class="udiff-line-modified-added">+   movl(temp_reg, Address(temp_reg, Klass::layout_helper_offset()));</span>
<span class="udiff-line-modified-added">+   test_null_free_array_layout(temp_reg, is_null_free_array);</span>
  }
  
  void MacroAssembler::test_non_null_free_array_oop(Register oop, Register temp_reg, Label&amp;is_non_null_free_array) {
<span class="udiff-line-modified-removed">-   load_storage_props(temp_reg, oop);</span>
<span class="udiff-line-modified-removed">-   testb(temp_reg, ArrayStorageProperties::null_free_value);</span>
<span class="udiff-line-modified-added">+   load_klass(temp_reg, oop);</span>
<span class="udiff-line-modified-added">+   movl(temp_reg, Address(temp_reg, Klass::layout_helper_offset()));</span>
<span class="udiff-line-added">+   test_non_null_free_array_layout(temp_reg, is_non_null_free_array);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void MacroAssembler::test_flattened_array_layout(Register lh, Label&amp; is_flattened_array) {</span>
<span class="udiff-line-added">+   testl(lh, Klass::_lh_array_tag_vt_value_bit_inplace);</span>
<span class="udiff-line-added">+   jcc(Assembler::notZero, is_flattened_array);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ void MacroAssembler::test_non_flattened_array_layout(Register lh, Label&amp; is_non_flattened_array) {</span>
<span class="udiff-line-added">+   testl(lh, Klass::_lh_array_tag_vt_value_bit_inplace);</span>
<span class="udiff-line-added">+   jcc(Assembler::zero, is_non_flattened_array);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void MacroAssembler::test_null_free_array_layout(Register lh, Label&amp; is_null_free_array) {</span>
<span class="udiff-line-added">+   testl(lh, Klass::_lh_null_free_bit_inplace);</span>
<span class="udiff-line-added">+   jcc(Assembler::notZero, is_null_free_array);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void MacroAssembler::test_non_null_free_array_layout(Register lh, Label&amp; is_non_null_free_array) {</span>
<span class="udiff-line-added">+   testl(lh, Klass::_lh_null_free_bit_inplace);</span>
    jcc(Assembler::zero, is_non_null_free_array);
  }
  
<span class="udiff-line-added">+ </span>
  void MacroAssembler::os_breakpoint() {
    // instead of directly emitting a breakpoint, call os:breakpoint for better debugability
    // (e.g., MSVC can&#39;t call ps() otherwise)
    call(RuntimeAddress(CAST_FROM_FN_PTR(address, os::breakpoint)));
  }
</pre>
<center>&lt; prev <a href="../../../../index.html" target="_top">index</a> <a href="macroAssembler_x86.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>