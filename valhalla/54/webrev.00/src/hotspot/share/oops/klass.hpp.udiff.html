<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/oops/klass.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="klass.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="objArrayKlass.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/oops/klass.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -353,10 +353,17 @@</span>
  
    static const unsigned int _lh_array_tag_type_value = 0Xfffffffc;
    static const unsigned int _lh_array_tag_vt_value   = 0Xfffffffd;
    static const unsigned int _lh_array_tag_obj_value  = 0Xfffffffe;
  
<span class="udiff-line-added">+   // null-free array flag bit under the array tag bits, shift one more to get array tag value</span>
<span class="udiff-line-added">+   static const int _lh_null_free_shift = _lh_array_tag_shift - 1;</span>
<span class="udiff-line-added">+   static const int _lh_null_free_mask  = 1;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static const jint _lh_array_tag_vt_value_bit_inplace = (jint) (1 &lt;&lt; _lh_array_tag_shift);</span>
<span class="udiff-line-added">+   static const jint _lh_null_free_bit_inplace = (jint) (_lh_null_free_mask &lt;&lt; _lh_null_free_shift);</span>
<span class="udiff-line-added">+ </span>
    static int layout_helper_size_in_bytes(jint lh) {
      assert(lh &gt; (jint)_lh_neutral_value, &quot;must be instance&quot;);
      return (int) lh &amp; ~_lh_instance_slow_path_bit;
    }
    static bool layout_helper_needs_slow_path(jint lh) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -376,10 +383,19 @@</span>
      return (juint)_lh_array_tag_obj_value == (juint)(lh &gt;&gt; _lh_array_tag_shift);
    }
    static bool layout_helper_is_valueArray(jint lh) {
      return (juint)_lh_array_tag_vt_value == (juint)(lh &gt;&gt; _lh_array_tag_shift);
    }
<span class="udiff-line-added">+   static bool layout_helper_is_null_free(jint lh) {</span>
<span class="udiff-line-added">+     assert(layout_helper_is_valueArray(lh) || layout_helper_is_objArray(lh), &quot;must be array of inline types&quot;);</span>
<span class="udiff-line-added">+     return ((lh &gt;&gt; _lh_null_free_shift) &amp; _lh_null_free_mask);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   static jint layout_helper_set_null_free(jint lh) {</span>
<span class="udiff-line-added">+     lh |= (_lh_null_free_mask &lt;&lt; _lh_null_free_shift);</span>
<span class="udiff-line-added">+     assert(layout_helper_is_null_free(lh), &quot;Bad encoding&quot;);</span>
<span class="udiff-line-added">+     return lh;</span>
<span class="udiff-line-added">+   }</span>
    static int layout_helper_header_size(jint lh) {
      assert(lh &lt; (jint)_lh_neutral_value, &quot;must be array&quot;);
      int hsize = (lh &gt;&gt; _lh_header_size_shift) &amp; _lh_header_size_mask;
      assert(hsize &gt; 0 &amp;&amp; hsize &lt; (int)sizeof(oopDesc)*3, &quot;sanity&quot;);
      return hsize;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -410,12 +426,13 @@</span>
      int l2esz = (lh &gt;&gt; _lh_log2_element_size_shift) &amp; _lh_log2_element_size_mask;
      assert(layout_helper_element_type(lh) == T_VALUETYPE || l2esz &lt;= LogBytesPerLong,
             &quot;sanity. l2esz: 0x%x for lh: 0x%x&quot;, (uint)l2esz, (uint)lh);
      return l2esz;
    }
<span class="udiff-line-modified-removed">-   static jint array_layout_helper(jint tag, int hsize, BasicType etype, int log2_esize) {</span>
<span class="udiff-line-modified-added">+   static jint array_layout_helper(jint tag, bool null_free, int hsize, BasicType etype, int log2_esize) {</span>
      return (tag        &lt;&lt; _lh_array_tag_shift)
<span class="udiff-line-added">+       |    ((null_free ? 1 : 0) &lt;&lt;  _lh_null_free_shift)</span>
        |    (hsize      &lt;&lt; _lh_header_size_shift)
        |    ((int)etype &lt;&lt; _lh_element_type_shift)
        |    (log2_esize &lt;&lt; _lh_log2_element_size_shift);
    }
    static jint instance_layout_helper(jint size, bool slow_path_flag) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -605,10 +622,12 @@</span>
                                                      layout_helper_is_valueArray(layout_helper()),
                                                      is_valueArray_klass_slow()); }
  
    #undef assert_same_query
  
<span class="udiff-line-added">+   inline bool is_null_free_array_klass()      const { return layout_helper_is_null_free(layout_helper()); }</span>
<span class="udiff-line-added">+ </span>
    // Access flags
    AccessFlags access_flags() const         { return _access_flags;  }
    void set_access_flags(AccessFlags flags) { _access_flags = flags; }
  
    bool is_public() const                { return _access_flags.is_public(); }
</pre>
<center><a href="klass.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="objArrayKlass.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>