<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/compiler/valhalla/valuetypes/TestArrays.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../src/hotspot/share/opto/parse2.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestLWorld.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/valhalla/valuetypes/TestArrays.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 770         for (int i = 0; i &lt; len; ++i) {
 771             Asserts.assertEQ(((MyValue1)result[i]).hash(), ((MyValue1)va[i]).hash());
 772         }
 773     }
 774 
 775     @Test
 776     public Object[] test33(Object[] va) {
 777         return va.clone();
 778     }
 779 
 780     @DontCompile
 781     public void test33_verifier(boolean warmup) {
 782         int len = Math.abs(rI) % 10;
 783         Object[] va = new Object[len];
 784         for (int i = 0; i &lt; len; ++i) {
 785             va[i] = MyValue1.createWithFieldsInline(rI, rL);
 786         }
 787         Object[] result = test33(va);
 788         for (int i = 0; i &lt; len; ++i) {
 789             Asserts.assertEQ(((MyValue1)result[i]).hash(), ((MyValue1)va[i]).hash());
<span class="line-modified"> 790             // Check that array has correct storage properties (null-ok)</span>
 791             result[i] = null;
 792         }
 793     }
 794 
 795     // clone() as series of loads/stores
 796     static Object[] test34_orig = null;
 797 
 798     @ForceInline
 799     public Object[] test34_helper(boolean flag) {
 800         Object[] va = null;
 801         if (flag) {
 802             va = new MyValue1[8];
 803             for (int i = 0; i &lt; va.length; ++i) {
 804                 va[i] = MyValue1.createWithFieldsDontInline(rI, rL);
 805             }
 806         } else {
 807             va = new Object[8];
 808         }
 809         return va;
 810     }
 811 
 812     @Test
 813     public Object[] test34(boolean flag) {
 814         Object[] va = test34_helper(flag);
 815         test34_orig = va;
 816         return va.clone();
 817     }
 818 
 819     @DontCompile
 820     public void test34_verifier(boolean warmup) {
 821         test34(false);
 822         for (int i = 0; i &lt; 10; i++) { // make sure we do deopt
 823             Object[] result = test34(true);
 824             verify(test34_orig, result);
<span class="line-modified"> 825             // Check that array has correct storage properties (null-free)</span>
 826             try {
 827                 result[0] = null;
 828                 throw new RuntimeException(&quot;Should throw NullPointerException&quot;);
 829             } catch (NullPointerException e) {
 830                 // Expected
 831             }
 832         }
 833         if (compile_and_run_again_if_deoptimized(warmup, &quot;TestArrays::test34&quot;)) {
 834             Object[] result = test34(true);
 835             verify(test34_orig, result);
<span class="line-modified"> 836             // Check that array has correct storage properties (null-free)</span>
 837             try {
 838                 result[0] = null;
 839                 throw new RuntimeException(&quot;Should throw NullPointerException&quot;);
 840             } catch (NullPointerException e) {
 841                 // Expected
 842             }
 843         }
 844     }
 845 
 846     static void verify(Object[] src, Object[] dst) {
 847         for (int i = 0; i &lt; src.length; ++i) {
 848             Asserts.assertEQ(((MyInterface)src[i]).hash(), ((MyInterface)dst[i]).hash());
 849         }
 850     }
 851 
 852     static void verify(MyValue1[] src, MyValue1[] dst) {
 853         for (int i = 0; i &lt; src.length; ++i) {
 854             Asserts.assertEQ(src[i].hash(), dst[i].hash());
 855         }
 856     }
</pre>
<hr />
<pre>
1733         int i = 0;
1734         for (; i &lt; 10; i++);
1735 
1736         Object[] arr = test75_helper(i, va, oa);
1737         return arr.clone();
1738     }
1739 
1740     @DontCompile
1741     public void test75_verifier(boolean warmup) {
1742         int len = Math.abs(rI) % 10;
1743         MyValue1[] va = new MyValue1[len];
1744         Integer[] oa = new Integer[len];
1745         for (int i = 0; i &lt; len; ++i) {
1746             oa[i] = new Integer(rI);
1747         }
1748         test75_helper(42, va, oa);
1749         Object[] result = test75(va, oa);
1750 
1751         for (int i = 0; i &lt; va.length; ++i) {
1752             Asserts.assertEQ(oa[i], result[i]);
<span class="line-modified">1753             // Check that array has correct storage properties (null-ok)</span>
1754             result[i] = null;
1755         }
1756     }
1757 
1758     @ForceInline
1759     public Object[] test76_helper(int i, MyValue1[] va, Integer[] oa) {
1760         Object[] arr = null;
1761         if (i == 10) {
1762             arr = va;
1763         } else {
1764             arr = oa;
1765         }
1766         return arr;
1767     }
1768 
1769     @Test
1770     public Object[] test76(MyValue1[] va, Integer[] oa) {
1771         int i = 0;
1772         for (; i &lt; 10; i++);
1773 
1774         Object[] arr = test76_helper(i, va, oa);
1775         return arr.clone();
1776     }
1777 
1778     @DontCompile
1779     public void test76_verifier(boolean warmup) {
1780         int len = Math.abs(rI) % 10;
1781         MyValue1[] va = new MyValue1[len];
1782         MyValue1[] verif = new MyValue1[len];
1783         for (int i = 0; i &lt; len; ++i) {
1784             va[i] = MyValue1.createWithFieldsInline(rI, rL);
1785             verif[i] = va[i];
1786         }
1787         Integer[] oa = new Integer[len];
1788         test76_helper(42, va, oa);
1789         Object[] result = test76(va, oa);
1790         verify(verif, result);
<span class="line-modified">1791         // Check that array has correct storage properties (null-free)</span>
1792         if (len &gt; 0) {
1793             try {
1794                 result[0] = null;
1795                 throw new RuntimeException(&quot;Should throw NullPointerException&quot;);
1796             } catch (NullPointerException e) {
1797                 // Expected
1798             }
1799         }
1800     }
1801 
1802     @Test
1803     public void test77() {
1804         MyValue1 v0 = MyValue1.createWithFieldsDontInline(rI, rL);
1805         MyValue1 v1 = MyValue1.createWithFieldsDontInline(rI+1, rL+1);
1806         MyValue1[] arr = new MyValue1[1];
1807 
1808         Object[] oa = arr;
1809         Object o1 = v1;
1810         Object o = (o1 == null) ? v0 : o1;
1811 
</pre>
</td>
<td>
<hr />
<pre>
 770         for (int i = 0; i &lt; len; ++i) {
 771             Asserts.assertEQ(((MyValue1)result[i]).hash(), ((MyValue1)va[i]).hash());
 772         }
 773     }
 774 
 775     @Test
 776     public Object[] test33(Object[] va) {
 777         return va.clone();
 778     }
 779 
 780     @DontCompile
 781     public void test33_verifier(boolean warmup) {
 782         int len = Math.abs(rI) % 10;
 783         Object[] va = new Object[len];
 784         for (int i = 0; i &lt; len; ++i) {
 785             va[i] = MyValue1.createWithFieldsInline(rI, rL);
 786         }
 787         Object[] result = test33(va);
 788         for (int i = 0; i &lt; len; ++i) {
 789             Asserts.assertEQ(((MyValue1)result[i]).hash(), ((MyValue1)va[i]).hash());
<span class="line-modified"> 790             // Check that array has correct properties (null-ok)</span>
 791             result[i] = null;
 792         }
 793     }
 794 
 795     // clone() as series of loads/stores
 796     static Object[] test34_orig = null;
 797 
 798     @ForceInline
 799     public Object[] test34_helper(boolean flag) {
 800         Object[] va = null;
 801         if (flag) {
 802             va = new MyValue1[8];
 803             for (int i = 0; i &lt; va.length; ++i) {
 804                 va[i] = MyValue1.createWithFieldsDontInline(rI, rL);
 805             }
 806         } else {
 807             va = new Object[8];
 808         }
 809         return va;
 810     }
 811 
 812     @Test
 813     public Object[] test34(boolean flag) {
 814         Object[] va = test34_helper(flag);
 815         test34_orig = va;
 816         return va.clone();
 817     }
 818 
 819     @DontCompile
 820     public void test34_verifier(boolean warmup) {
 821         test34(false);
 822         for (int i = 0; i &lt; 10; i++) { // make sure we do deopt
 823             Object[] result = test34(true);
 824             verify(test34_orig, result);
<span class="line-modified"> 825             // Check that array has correct properties (null-free)</span>
 826             try {
 827                 result[0] = null;
 828                 throw new RuntimeException(&quot;Should throw NullPointerException&quot;);
 829             } catch (NullPointerException e) {
 830                 // Expected
 831             }
 832         }
 833         if (compile_and_run_again_if_deoptimized(warmup, &quot;TestArrays::test34&quot;)) {
 834             Object[] result = test34(true);
 835             verify(test34_orig, result);
<span class="line-modified"> 836             // Check that array has correct properties (null-free)</span>
 837             try {
 838                 result[0] = null;
 839                 throw new RuntimeException(&quot;Should throw NullPointerException&quot;);
 840             } catch (NullPointerException e) {
 841                 // Expected
 842             }
 843         }
 844     }
 845 
 846     static void verify(Object[] src, Object[] dst) {
 847         for (int i = 0; i &lt; src.length; ++i) {
 848             Asserts.assertEQ(((MyInterface)src[i]).hash(), ((MyInterface)dst[i]).hash());
 849         }
 850     }
 851 
 852     static void verify(MyValue1[] src, MyValue1[] dst) {
 853         for (int i = 0; i &lt; src.length; ++i) {
 854             Asserts.assertEQ(src[i].hash(), dst[i].hash());
 855         }
 856     }
</pre>
<hr />
<pre>
1733         int i = 0;
1734         for (; i &lt; 10; i++);
1735 
1736         Object[] arr = test75_helper(i, va, oa);
1737         return arr.clone();
1738     }
1739 
1740     @DontCompile
1741     public void test75_verifier(boolean warmup) {
1742         int len = Math.abs(rI) % 10;
1743         MyValue1[] va = new MyValue1[len];
1744         Integer[] oa = new Integer[len];
1745         for (int i = 0; i &lt; len; ++i) {
1746             oa[i] = new Integer(rI);
1747         }
1748         test75_helper(42, va, oa);
1749         Object[] result = test75(va, oa);
1750 
1751         for (int i = 0; i &lt; va.length; ++i) {
1752             Asserts.assertEQ(oa[i], result[i]);
<span class="line-modified">1753             // Check that array has correct properties (null-ok)</span>
1754             result[i] = null;
1755         }
1756     }
1757 
1758     @ForceInline
1759     public Object[] test76_helper(int i, MyValue1[] va, Integer[] oa) {
1760         Object[] arr = null;
1761         if (i == 10) {
1762             arr = va;
1763         } else {
1764             arr = oa;
1765         }
1766         return arr;
1767     }
1768 
1769     @Test
1770     public Object[] test76(MyValue1[] va, Integer[] oa) {
1771         int i = 0;
1772         for (; i &lt; 10; i++);
1773 
1774         Object[] arr = test76_helper(i, va, oa);
1775         return arr.clone();
1776     }
1777 
1778     @DontCompile
1779     public void test76_verifier(boolean warmup) {
1780         int len = Math.abs(rI) % 10;
1781         MyValue1[] va = new MyValue1[len];
1782         MyValue1[] verif = new MyValue1[len];
1783         for (int i = 0; i &lt; len; ++i) {
1784             va[i] = MyValue1.createWithFieldsInline(rI, rL);
1785             verif[i] = va[i];
1786         }
1787         Integer[] oa = new Integer[len];
1788         test76_helper(42, va, oa);
1789         Object[] result = test76(va, oa);
1790         verify(verif, result);
<span class="line-modified">1791         // Check that array has correct properties (null-free)</span>
1792         if (len &gt; 0) {
1793             try {
1794                 result[0] = null;
1795                 throw new RuntimeException(&quot;Should throw NullPointerException&quot;);
1796             } catch (NullPointerException e) {
1797                 // Expected
1798             }
1799         }
1800     }
1801 
1802     @Test
1803     public void test77() {
1804         MyValue1 v0 = MyValue1.createWithFieldsDontInline(rI, rL);
1805         MyValue1 v1 = MyValue1.createWithFieldsDontInline(rI+1, rL+1);
1806         MyValue1[] arr = new MyValue1[1];
1807 
1808         Object[] oa = arr;
1809         Object o1 = v1;
1810         Object o = (o1 == null) ? v0 : o1;
1811 
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../src/hotspot/share/opto/parse2.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestLWorld.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>