<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/memory/metaspace.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../jvmci/jvmciCodeInstaller.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../oops/instanceKlass.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/memory/metaspace.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1231   MetaspaceGC::initialize();
1232   bool class_space_inited = false;
1233 #if INCLUDE_CDS
1234   if (DumpSharedSpaces) {
1235     MetaspaceShared::initialize_dumptime_shared_and_meta_spaces();
1236     class_space_inited = true;
1237   } else if (UseSharedSpaces) {
1238     // If any of the archived space fails to map, UseSharedSpaces
1239     // is reset to false.
1240     MetaspaceShared::initialize_runtime_shared_and_meta_spaces();
1241     class_space_inited = UseSharedSpaces;
1242   }
1243 
1244   if (DynamicDumpSharedSpaces &amp;&amp; !UseSharedSpaces) {
1245     vm_exit_during_initialization(&quot;DynamicDumpSharedSpaces is unsupported when base CDS archive is not loaded&quot;, NULL);
1246   }
1247 #endif // INCLUDE_CDS
1248 
1249 #ifdef _LP64
1250   if (using_class_space() &amp;&amp; !class_space_inited) {
<span class="line-modified">1251     char* base = (char*)align_up(CompressedOops::end(), _reserve_alignment);</span>





1252     ReservedSpace dummy;
1253     allocate_metaspace_compressed_klass_ptrs(dummy, base, 0);
1254   }
1255 #endif
1256 
1257   // Initialize these before initializing the VirtualSpaceList
1258   _first_chunk_word_size = InitialBootClassLoaderMetaspaceSize / BytesPerWord;
1259   _first_chunk_word_size = align_word_size_up(_first_chunk_word_size);
1260   // Make the first class chunk bigger than a medium chunk so it&#39;s not put
1261   // on the medium chunk list.   The next chunk will be small and progress
1262   // from there.  This size calculated by -version.
1263   _first_class_chunk_word_size = MIN2((size_t)MediumChunk*6,
1264                                      (CompressedClassSpaceSize/BytesPerWord)*2);
1265   _first_class_chunk_word_size = align_word_size_up(_first_class_chunk_word_size);
1266   // Arbitrarily set the initial virtual space to a multiple
1267   // of the boot class loader size.
1268   size_t word_size = VIRTUALSPACEMULTIPLIER * _first_chunk_word_size;
1269   word_size = align_up(word_size, Metaspace::reserve_alignment_words());
1270 
1271   // Initialize the list of virtual spaces.
</pre>
</td>
<td>
<hr />
<pre>
1231   MetaspaceGC::initialize();
1232   bool class_space_inited = false;
1233 #if INCLUDE_CDS
1234   if (DumpSharedSpaces) {
1235     MetaspaceShared::initialize_dumptime_shared_and_meta_spaces();
1236     class_space_inited = true;
1237   } else if (UseSharedSpaces) {
1238     // If any of the archived space fails to map, UseSharedSpaces
1239     // is reset to false.
1240     MetaspaceShared::initialize_runtime_shared_and_meta_spaces();
1241     class_space_inited = UseSharedSpaces;
1242   }
1243 
1244   if (DynamicDumpSharedSpaces &amp;&amp; !UseSharedSpaces) {
1245     vm_exit_during_initialization(&quot;DynamicDumpSharedSpaces is unsupported when base CDS archive is not loaded&quot;, NULL);
1246   }
1247 #endif // INCLUDE_CDS
1248 
1249 #ifdef _LP64
1250   if (using_class_space() &amp;&amp; !class_space_inited) {
<span class="line-modified">1251     char* base;</span>
<span class="line-added">1252     if (UseCompressedOops) {</span>
<span class="line-added">1253       base = (char*)align_up(CompressedOops::end(), _reserve_alignment);</span>
<span class="line-added">1254     } else {</span>
<span class="line-added">1255       base = (char*)HeapBaseMinAddress;</span>
<span class="line-added">1256     }</span>
1257     ReservedSpace dummy;
1258     allocate_metaspace_compressed_klass_ptrs(dummy, base, 0);
1259   }
1260 #endif
1261 
1262   // Initialize these before initializing the VirtualSpaceList
1263   _first_chunk_word_size = InitialBootClassLoaderMetaspaceSize / BytesPerWord;
1264   _first_chunk_word_size = align_word_size_up(_first_chunk_word_size);
1265   // Make the first class chunk bigger than a medium chunk so it&#39;s not put
1266   // on the medium chunk list.   The next chunk will be small and progress
1267   // from there.  This size calculated by -version.
1268   _first_class_chunk_word_size = MIN2((size_t)MediumChunk*6,
1269                                      (CompressedClassSpaceSize/BytesPerWord)*2);
1270   _first_class_chunk_word_size = align_word_size_up(_first_class_chunk_word_size);
1271   // Arbitrarily set the initial virtual space to a multiple
1272   // of the boot class loader size.
1273   size_t word_size = VIRTUALSPACEMULTIPLIER * _first_chunk_word_size;
1274   word_size = align_up(word_size, Metaspace::reserve_alignment_words());
1275 
1276   // Initialize the list of virtual spaces.
</pre>
</td>
</tr>
</table>
<center><a href="../jvmci/jvmciCodeInstaller.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../oops/instanceKlass.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>