<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/interpreter/linkResolver.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="interpreterRuntime.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../memory/heapInspection.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/interpreter/linkResolver.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1002     // check for errors
1003     if (is_static != fd.is_static()) {
1004       ResourceMark rm(THREAD);
1005       char msg[200];
1006       jio_snprintf(msg, sizeof(msg), &quot;Expected %s field %s.%s&quot;, is_static ? &quot;static&quot; : &quot;non-static&quot;, resolved_klass-&gt;external_name(), fd.name()-&gt;as_C_string());
1007       THROW_MSG(vmSymbols::java_lang_IncompatibleClassChangeError(), msg);
1008     }
1009 
1010     // A final field can be modified only
1011     // (1) by methods declared in the class declaring the field and
1012     // (2) by the &lt;clinit&gt; method (in case of a static field)
1013     //     or by the &lt;init&gt; method (in case of an instance field).
1014     // (3) by withfield when field is in a value type and the
1015     //     selected class and current class are nest mates.
1016     if (is_put &amp;&amp; fd.access_flags().is_final()) {
1017 
1018       if (sel_klass != current_klass) {
1019       // If byte code is a withfield check if they are nestmates.
1020       bool are_nestmates = false;
1021       if (sel_klass-&gt;is_instance_klass() &amp;&amp;
<span class="line-modified">1022           InstanceKlass::cast(sel_klass)-&gt;is_value() &amp;&amp;</span>
1023           current_klass-&gt;is_instance_klass()) {
1024         are_nestmates = InstanceKlass::cast(link_info.current_klass())-&gt;has_nestmate_access_to(
1025                                                         InstanceKlass::cast(sel_klass), THREAD);
1026       }
1027       if (!are_nestmates) {
1028         ResourceMark rm(THREAD);
1029         stringStream ss;
1030         ss.print(&quot;Update to %s final field %s.%s attempted from a different class (%s) than the field&#39;s declaring class&quot;,
1031                  is_static ? &quot;static&quot; : &quot;non-static&quot;, resolved_klass-&gt;external_name(), fd.name()-&gt;as_C_string(),
1032                   current_klass-&gt;external_name());
1033         THROW_MSG(vmSymbols::java_lang_IllegalAccessError(), ss.as_string());
1034       }
1035       }
1036 
1037       if (fd.constants()-&gt;pool_holder()-&gt;major_version() &gt;= 53) {
1038         Method* m = link_info.current_method();
1039         assert(m != NULL, &quot;information about the current method must be available for &#39;put&#39; bytecodes&quot;);
1040         bool is_initialized_static_final_update = (byte == Bytecodes::_putstatic &amp;&amp;
1041                                                    fd.is_static() &amp;&amp;
1042                                                    !m-&gt;is_class_initializer());
</pre>
</td>
<td>
<hr />
<pre>
1002     // check for errors
1003     if (is_static != fd.is_static()) {
1004       ResourceMark rm(THREAD);
1005       char msg[200];
1006       jio_snprintf(msg, sizeof(msg), &quot;Expected %s field %s.%s&quot;, is_static ? &quot;static&quot; : &quot;non-static&quot;, resolved_klass-&gt;external_name(), fd.name()-&gt;as_C_string());
1007       THROW_MSG(vmSymbols::java_lang_IncompatibleClassChangeError(), msg);
1008     }
1009 
1010     // A final field can be modified only
1011     // (1) by methods declared in the class declaring the field and
1012     // (2) by the &lt;clinit&gt; method (in case of a static field)
1013     //     or by the &lt;init&gt; method (in case of an instance field).
1014     // (3) by withfield when field is in a value type and the
1015     //     selected class and current class are nest mates.
1016     if (is_put &amp;&amp; fd.access_flags().is_final()) {
1017 
1018       if (sel_klass != current_klass) {
1019       // If byte code is a withfield check if they are nestmates.
1020       bool are_nestmates = false;
1021       if (sel_klass-&gt;is_instance_klass() &amp;&amp;
<span class="line-modified">1022           InstanceKlass::cast(sel_klass)-&gt;is_inline_klass() &amp;&amp;</span>
1023           current_klass-&gt;is_instance_klass()) {
1024         are_nestmates = InstanceKlass::cast(link_info.current_klass())-&gt;has_nestmate_access_to(
1025                                                         InstanceKlass::cast(sel_klass), THREAD);
1026       }
1027       if (!are_nestmates) {
1028         ResourceMark rm(THREAD);
1029         stringStream ss;
1030         ss.print(&quot;Update to %s final field %s.%s attempted from a different class (%s) than the field&#39;s declaring class&quot;,
1031                  is_static ? &quot;static&quot; : &quot;non-static&quot;, resolved_klass-&gt;external_name(), fd.name()-&gt;as_C_string(),
1032                   current_klass-&gt;external_name());
1033         THROW_MSG(vmSymbols::java_lang_IllegalAccessError(), ss.as_string());
1034       }
1035       }
1036 
1037       if (fd.constants()-&gt;pool_holder()-&gt;major_version() &gt;= 53) {
1038         Method* m = link_info.current_method();
1039         assert(m != NULL, &quot;information about the current method must be available for &#39;put&#39; bytecodes&quot;);
1040         bool is_initialized_static_final_update = (byte == Bytecodes::_putstatic &amp;&amp;
1041                                                    fd.is_static() &amp;&amp;
1042                                                    !m-&gt;is_class_initializer());
</pre>
</td>
</tr>
</table>
<center><a href="interpreterRuntime.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../memory/heapInspection.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>