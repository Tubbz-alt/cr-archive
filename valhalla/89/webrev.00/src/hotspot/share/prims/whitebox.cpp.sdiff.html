<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/prims/whitebox.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="unsafe.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../runtime/biasedLocking.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/prims/whitebox.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1896 
1897 class CollectOops : public BasicOopIterateClosure {
1898  public:
1899   GrowableArray&lt;Handle&gt;* array;
1900 
1901   objArrayOop create_results(TRAPS) {
1902     objArrayOop result_array =
1903         oopFactory::new_objArray(SystemDictionary::Object_klass(), array-&gt;length(), CHECK_NULL);
1904     for (int i = 0 ; i &lt; array-&gt;length(); i++) {
1905       result_array-&gt;obj_at_put(i, array-&gt;at(i)());
1906     }
1907     return result_array;
1908   }
1909 
1910   jobjectArray create_jni_result(JNIEnv* env, TRAPS) {
1911     return (jobjectArray)JNIHandles::make_local(env, create_results(THREAD));
1912   }
1913 
1914   void add_oop(oop o) {
1915     // Value might be oop, but JLS can&#39;t see as Object, just iterate through it...
<span class="line-modified">1916     if (o != NULL &amp;&amp; o-&gt;is_value()) {</span>
1917       o-&gt;oop_iterate(this);
1918     } else {
1919       array-&gt;append(Handle(Thread::current(), o));
1920     }
1921   }
1922 
1923   void do_oop(oop* o) { add_oop(*o); }
1924   void do_oop(narrowOop* v) { add_oop(CompressedOops::decode(*v)); }
1925 };
1926 
1927 
1928 WB_ENTRY(jobjectArray, WB_getObjectsViaOopIterator(JNIEnv* env, jobject wb, jobject thing))
1929   ResourceMark rm(THREAD);
1930   GrowableArray&lt;Handle&gt;* array = new GrowableArray&lt;Handle&gt;(128);
1931   CollectOops collectOops;
1932   collectOops.array = array;
1933 
1934   JNIHandles::resolve(thing)-&gt;oop_iterate(&amp;collectOops);
1935 
1936   return collectOops.create_jni_result(env, THREAD);
</pre>
</td>
<td>
<hr />
<pre>
1896 
1897 class CollectOops : public BasicOopIterateClosure {
1898  public:
1899   GrowableArray&lt;Handle&gt;* array;
1900 
1901   objArrayOop create_results(TRAPS) {
1902     objArrayOop result_array =
1903         oopFactory::new_objArray(SystemDictionary::Object_klass(), array-&gt;length(), CHECK_NULL);
1904     for (int i = 0 ; i &lt; array-&gt;length(); i++) {
1905       result_array-&gt;obj_at_put(i, array-&gt;at(i)());
1906     }
1907     return result_array;
1908   }
1909 
1910   jobjectArray create_jni_result(JNIEnv* env, TRAPS) {
1911     return (jobjectArray)JNIHandles::make_local(env, create_results(THREAD));
1912   }
1913 
1914   void add_oop(oop o) {
1915     // Value might be oop, but JLS can&#39;t see as Object, just iterate through it...
<span class="line-modified">1916     if (o != NULL &amp;&amp; o-&gt;is_inline_type()) {</span>
1917       o-&gt;oop_iterate(this);
1918     } else {
1919       array-&gt;append(Handle(Thread::current(), o));
1920     }
1921   }
1922 
1923   void do_oop(oop* o) { add_oop(*o); }
1924   void do_oop(narrowOop* v) { add_oop(CompressedOops::decode(*v)); }
1925 };
1926 
1927 
1928 WB_ENTRY(jobjectArray, WB_getObjectsViaOopIterator(JNIEnv* env, jobject wb, jobject thing))
1929   ResourceMark rm(THREAD);
1930   GrowableArray&lt;Handle&gt;* array = new GrowableArray&lt;Handle&gt;(128);
1931   CollectOops collectOops;
1932   collectOops.array = array;
1933 
1934   JNIHandles::resolve(thing)-&gt;oop_iterate(&amp;collectOops);
1935 
1936   return collectOops.create_jni_result(env, THREAD);
</pre>
</td>
</tr>
</table>
<center><a href="unsafe.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../runtime/biasedLocking.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>