<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/runtime/valhalla/valuetypes/TestJNIArrays.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../index.html" target="_top">index</a> <a href="ValueTypeArray.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/valhalla/valuetypes/TestJNIArrays.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2019, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -37,832 +37,833 @@</span>
   * @summary Test flattened arrays accesses through JNI
   * @modules java.base/jdk.internal.misc java.base/jdk.internal.vm.jni
   * @library /testlibrary /test/lib
   * @requires (os.simpleArch == &quot;x64&quot;)
   * @requires (os.family == &quot;linux&quot; | os.family == &quot;mac&quot;)
<span class="udiff-line-modified-removed">-  * @compile -XDallowGenericsOverValues -XDallowWithFieldOperator TestJNIArrays.java</span>
<span class="udiff-line-modified-added">+  * @compile -XDallowWithFieldOperator TestJNIArrays.java</span>
   * @run main/othervm/native/timeout=3000 -XX:ValueArrayElemMaxFlatSize=128 -XX:+PrintFlattenableLayouts -XX:+UseCompressedOops TestJNIArrays
   * @run main/othervm/native/timeout=3000 -XX:ValueArrayElemMaxFlatSize=128 -XX:+PrintFlattenableLayouts -XX:-UseCompressedOops TestJNIArrays
   */
<span class="udiff-line-removed">- </span>
  public class TestJNIArrays {
  
      static final Unsafe U = Unsafe.getUnsafe();
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-added">+ </span>
      public static final int ARRAY_SIZE = 1024;
      static long seed;
      static Random random;
  
      static {
<span class="udiff-line-modified-removed">- 	seed = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;Seed = &quot; + seed); </span>
<span class="udiff-line-modified-removed">- 	random = new Random(seed);</span>
<span class="udiff-line-modified-added">+         seed = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;Seed = &quot; + seed);</span>
<span class="udiff-line-modified-added">+         random = new Random(seed);</span>
      }
  
      static {
          System.loadLibrary(&quot;TestJNIArrays&quot;);
      }
  
      static inline class IntInt {
<span class="udiff-line-modified-removed">- 	int i0;</span>
<span class="udiff-line-modified-removed">- 	int i1;</span>
<span class="udiff-line-modified-added">+         int i0;</span>
<span class="udiff-line-modified-added">+         int i1;</span>
  
<span class="udiff-line-modified-removed">- 	public IntInt(int i0, int i1) {</span>
<span class="udiff-line-modified-removed">- 	    this.i0 = i0;</span>
<span class="udiff-line-modified-removed">- 	    this.i1 = i1;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+         public IntInt(int i0, int i1) {</span>
<span class="udiff-line-modified-added">+             this.i0 = i0;</span>
<span class="udiff-line-modified-added">+             this.i1 = i1;</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
<span class="udiff-line-modified-removed">-     static class IntIntComparator implements Comparator&lt;IntInt&gt; {</span>
<span class="udiff-line-modified-removed">- 	public int compare(IntInt a, IntInt b) {</span>
<span class="udiff-line-modified-removed">- 	    if (a.i0 &lt; b.i0) return -1;</span>
<span class="udiff-line-modified-removed">- 	    if (a.i0 &gt; b.i0) return 1;</span>
<span class="udiff-line-modified-removed">- 	    if (a.i1 &lt; b.i1) return -1;</span>
<span class="udiff-line-modified-removed">- 	    if (a.i1 &gt; b.i1) return 1;</span>
<span class="udiff-line-modified-removed">- 	    return 0;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+     static class IntIntComparator implements Comparator&lt;IntInt.ref&gt; {</span>
<span class="udiff-line-modified-added">+         public int compare(IntInt.ref a, IntInt.ref b) {</span>
<span class="udiff-line-modified-added">+             if (a.i0 &lt; b.i0) return -1;</span>
<span class="udiff-line-modified-added">+             if (a.i0 &gt; b.i0) return 1;</span>
<span class="udiff-line-modified-added">+             if (a.i1 &lt; b.i1) return -1;</span>
<span class="udiff-line-modified-added">+             if (a.i1 &gt; b.i1) return 1;</span>
<span class="udiff-line-modified-added">+             return 0;</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
      static inline class Containee {
<span class="udiff-line-modified-removed">- 	float f;</span>
<span class="udiff-line-modified-removed">- 	short s;</span>
<span class="udiff-line-modified-added">+         float f;</span>
<span class="udiff-line-modified-added">+         short s;</span>
  
<span class="udiff-line-modified-removed">- 	Containee(float f, short s) {</span>
<span class="udiff-line-modified-removed">- 	    this.f = f;</span>
<span class="udiff-line-modified-removed">- 	    this.s = s;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+         Containee(float f, short s) {</span>
<span class="udiff-line-modified-added">+             this.f = f;</span>
<span class="udiff-line-modified-added">+             this.s = s;</span>
<span class="udiff-line-modified-added">+         }</span>
      }
<span class="udiff-line-removed">-     </span>
<span class="udiff-line-removed">-     static inline class Container {</span>
<span class="udiff-line-removed">- 	double d;</span>
<span class="udiff-line-removed">- 	Containee c;</span>
<span class="udiff-line-removed">- 	byte b;</span>
  
<span class="udiff-line-modified-removed">- 	Container(double d, Containee c, byte b) {</span>
<span class="udiff-line-modified-removed">- 	    this.d = d ;</span>
<span class="udiff-line-modified-removed">- 	    this.c = c;</span>
<span class="udiff-line-modified-removed">- 	    this.b = b;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+     static inline class Container {</span>
<span class="udiff-line-modified-added">+         double d;</span>
<span class="udiff-line-modified-added">+         Containee c;</span>
<span class="udiff-line-modified-added">+         byte b;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+         Container(double d, Containee c, byte b) {</span>
<span class="udiff-line-added">+             this.d = d ;</span>
<span class="udiff-line-added">+             this.c = c;</span>
<span class="udiff-line-added">+             this.b = b;</span>
<span class="udiff-line-added">+         }</span>
  
<span class="udiff-line-modified-removed">- 	Container setc(Containee c) {</span>
<span class="udiff-line-modified-added">+         Container setc(Containee c) {</span>
              Container res = __WithField(this.c, c);
              return res;
          }
  
      }
  
      static inline class LongLongLongLong {
<span class="udiff-line-modified-removed">- 	long l0, l1, l2, l3;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	public LongLongLongLong(long l0, long l1, long l2, long l3) {</span>
<span class="udiff-line-modified-removed">- 	    this.l0 = l0;</span>
<span class="udiff-line-modified-removed">- 	    this.l1 = l1;</span>
<span class="udiff-line-modified-removed">- 	    this.l2 = l2;</span>
<span class="udiff-line-modified-removed">- 	    this.l3 = l3;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+         long l0, l1, l2, l3;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         public LongLongLongLong(long l0, long l1, long l2, long l3) {</span>
<span class="udiff-line-modified-added">+             this.l0 = l0;</span>
<span class="udiff-line-modified-added">+             this.l1 = l1;</span>
<span class="udiff-line-modified-added">+             this.l2 = l2;</span>
<span class="udiff-line-modified-added">+             this.l3 = l3;</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
      static inline class BigValue {
<span class="udiff-line-modified-removed">- 	long l0 = 0, l1 = 0,   l2 = 0, l3 = 0, l4 = 0, l5 = 0, l6 = 0, l7 = 0, l8 = 0, l9 = 0;</span>
<span class="udiff-line-modified-removed">- 	long l10 = 0, l11 = 0, l12 = 0, l13 = 0, l14 = 0, l15 = 0, l16 = 0, l17 = 0, l18 = 0, l19 = 0;</span>
<span class="udiff-line-modified-removed">- 	long l20 = 0, l21 = 0, l22 = 0, l23 = 0, l24 = 0, l25 = 0, l26 = 0, l27 = 0, l28 = 0, l29 = 0;</span>
<span class="udiff-line-modified-removed">- 	long l30 = 0, l31 = 0, l32 = 0, l33 = 0, l34 = 0, l35 = 0, l36 = 0, l37 = 0, l38 = 0, l39 = 0;</span>
<span class="udiff-line-modified-added">+         long l0 = 0, l1 = 0,   l2 = 0, l3 = 0, l4 = 0, l5 = 0, l6 = 0, l7 = 0, l8 = 0, l9 = 0;</span>
<span class="udiff-line-modified-added">+         long l10 = 0, l11 = 0, l12 = 0, l13 = 0, l14 = 0, l15 = 0, l16 = 0, l17 = 0, l18 = 0, l19 = 0;</span>
<span class="udiff-line-modified-added">+         long l20 = 0, l21 = 0, l22 = 0, l23 = 0, l24 = 0, l25 = 0, l26 = 0, l27 = 0, l28 = 0, l29 = 0;</span>
<span class="udiff-line-modified-added">+         long l30 = 0, l31 = 0, l32 = 0, l33 = 0, l34 = 0, l35 = 0, l36 = 0, l37 = 0, l38 = 0, l39 = 0;</span>
      }
  
      static inline class ValueWithOops {
<span class="udiff-line-modified-removed">- 	String s = &quot;bonjour&quot;;</span>
<span class="udiff-line-modified-removed">- 	int i = 0;</span>
<span class="udiff-line-modified-removed">- 	Containee c = new Containee(2.3f, (short)4);</span>
<span class="udiff-line-modified-removed">- 	BigValue b = new BigValue();</span>
<span class="udiff-line-modified-added">+         String s = &quot;bonjour&quot;;</span>
<span class="udiff-line-modified-added">+         int i = 0;</span>
<span class="udiff-line-modified-added">+         Containee c = new Containee(2.3f, (short)4);</span>
<span class="udiff-line-modified-added">+         BigValue b = new BigValue();</span>
      }
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-added">+ </span>
      public static void main(String[] args) {
<span class="udiff-line-modified-removed">- 	TestJNIArrays test = new TestJNIArrays();</span>
<span class="udiff-line-modified-removed">- 	test.checkGetFlattenedArrayElementSize();</span>
<span class="udiff-line-modified-removed">- 	test.checkGetFlattenedArrayElementClass();</span>
<span class="udiff-line-modified-removed">- 	test.checkGetFieldOffsetInFlattenedLayout();</span>
<span class="udiff-line-modified-removed">- 	test.checkGetFlattenedArrayElements();</span>
<span class="udiff-line-modified-removed">- 	test.checkSubElementAPI();</span>
<span class="udiff-line-modified-removed">- 	test.checkBehaviors();</span>
<span class="udiff-line-modified-removed">- 	// test.mesureInitializationTime(1024 * 1024 * 10 , 1000);</span>
<span class="udiff-line-modified-removed">- 	// test.mesureInitializationTime2(1024 * 1024 * 10 , 1000);</span>
<span class="udiff-line-modified-removed">- 	// test.mesureUpdateTime2(1024 * 1024 * 10, 1000);</span>
<span class="udiff-line-modified-removed">- 	// test.mesureSortingTime(1024 * 1024, 100); // reduced number of iterations because Java sorting is slow (because of generics?)</span>
<span class="udiff-line-modified-removed">- 	test.mesureInitializationTime3(1024 * 1024 * 2 , 1000);</span>
<span class="udiff-line-modified-added">+         TestJNIArrays test = new TestJNIArrays();</span>
<span class="udiff-line-modified-added">+         test.checkGetFlattenedArrayElementSize();</span>
<span class="udiff-line-modified-added">+         test.checkGetFlattenedArrayElementClass();</span>
<span class="udiff-line-modified-added">+         test.checkGetFieldOffsetInFlattenedLayout();</span>
<span class="udiff-line-modified-added">+         test.checkGetFlattenedArrayElements();</span>
<span class="udiff-line-modified-added">+         test.checkSubElementAPI();</span>
<span class="udiff-line-modified-added">+         test.checkBehaviors();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         // TODO: move these to micro-benchmark or out of tier1 testing...</span>
<span class="udiff-line-modified-added">+         // test.measureInitializationTime(1024 * 1024 * 10 , 1000);</span>
<span class="udiff-line-modified-added">+         // test.measureInitializationTime2(1024 * 1024 * 10 , 1000);</span>
<span class="udiff-line-modified-added">+         // test.measureUpdateTime2(1024 * 1024 * 10, 1000);</span>
<span class="udiff-line-added">+         // test.measureSortingTime(1024 * 1024, 100); // reduced number of iterations because Java sorting is slow (because of generics?)</span>
<span class="udiff-line-added">+         //test.measureInitializationTime3(1024 * 1024 * 2 , 10);</span>
      }
  
      void checkSubElementAPI() {
<span class="udiff-line-modified-removed">- 	Throwable e = null;</span>
<span class="udiff-line-modified-removed">- 	ValueWithOops[] arrayWithOops = new ValueWithOops[100];</span>
<span class="udiff-line-modified-removed">- 	ValueWithOops v = new ValueWithOops();</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 100; i++) {</span>
<span class="udiff-line-modified-removed">- 	    arrayWithOops[i] = v;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	SubElementSelector selector1 = createSubElementSelector(arrayWithOops);</span>
<span class="udiff-line-modified-removed">- 	SubElementSelector selector2 = getSubElementSelector(selector1, ValueWithOops.class, &quot;s&quot;, &quot;Ljava/lang/String;&quot;);</span>
<span class="udiff-line-modified-removed">- 	String s = (String) getObjectSubElement(arrayWithOops, selector2, 1);</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;s = &quot; + s);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(s.equals(&quot;bonjour&quot;), true, &quot;Wrong string, expecting \&quot;bonjour\&quot;, got &quot; + s); </span>
<span class="udiff-line-modified-removed">- 	SubElementSelector selector3 = getSubElementSelector(selector1, ValueWithOops.class, &quot;c&quot;, &quot;QTestJNIArrays$Containee;&quot;);</span>
<span class="udiff-line-modified-removed">- 	Containee c = (Containee) getObjectSubElement(arrayWithOops, selector3, 2);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(c.f, 2.3f, &quot;Wrong float value: &quot; + c.f);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(c.s, (short)4, &quot;Wrong short value &quot; + c.s);</span>
<span class="udiff-line-modified-removed">- 	setObjectSubElement(arrayWithOops, selector2, 1, &quot;Hello&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(arrayWithOops[1].s.equals(&quot;Hello&quot;), true, &quot;Wrong string, expecting \&quot;Hello\&quot;, got &quot; + s);</span>
<span class="udiff-line-modified-removed">- 	Integer myInteger = new Integer(345);</span>
<span class="udiff-line-modified-removed">- 	e = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    setObjectSubElement(arrayWithOops, selector2, 1, myInteger);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    e = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(e, &quot;An exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(e.getClass(), java.lang.ArrayStoreException.class, &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	c = new Containee(9.8f, (short)-3);</span>
<span class="udiff-line-modified-removed">- 	setObjectSubElement(arrayWithOops, selector3, 2, c);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(c.f, 9.8f, &quot;Wrong float value: &quot; + c.f);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(c.s, (short)-3, &quot;Wrong short value &quot; + c.s);</span>
<span class="udiff-line-modified-removed">- 	e = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    setObjectSubElement(arrayWithOops, selector3, 2, null);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    e = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(e, &quot;An exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(e.getClass(), java.lang.ArrayStoreException.class, &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	SubElementSelector selector4 = getSubElementSelector(selector3, TestJNIArrays.Containee.class, &quot;s&quot;, &quot;S&quot;);</span>
<span class="udiff-line-modified-removed">- 	short s2 = getShortSubElement(arrayWithOops, selector4, 3);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(s2, (short)4, &quot;Wrong short value &quot; + s2);</span>
<span class="udiff-line-modified-removed">- 	setShortSubElement(arrayWithOops, selector4, 3, (short)7);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(arrayWithOops[3].c.s, (short)7, &quot;Wrong short value &quot; + arrayWithOops[3].c.s);</span>
<span class="udiff-line-modified-removed">- 	e = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    // should fail because selector4 designates a field with type short, not int</span>
<span class="udiff-line-modified-removed">- 	    getIntSubElement(arrayWithOops, selector4, 3);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    e = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(e, &quot;An exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(e.getClass(), java.lang.IllegalArgumentException.class, &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	SubElementSelector selector5 = getSubElementSelector(selector1, ValueWithOops.class, &quot;b&quot;, &quot;QTestJNIArrays$BigValue;&quot;);</span>
<span class="udiff-line-modified-removed">- 	e = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    // Should fail because selector5 designates a non-flattened field</span>
<span class="udiff-line-modified-removed">- 	    SubElementSelector selector6 = getSubElementSelector(selector5, TestJNIArrays.BigValue.class, &quot;l0&quot;, &quot;J&quot;);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    e = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(e, &quot;An exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(e.getClass(), java.lang.IllegalArgumentException.class, &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	System.gc();</span>
<span class="udiff-line-modified-added">+         Throwable e = null;</span>
<span class="udiff-line-modified-added">+         ValueWithOops[] arrayWithOops = new ValueWithOops[100];</span>
<span class="udiff-line-modified-added">+         ValueWithOops v = new ValueWithOops();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 100; i++) {</span>
<span class="udiff-line-modified-added">+             arrayWithOops[i] = v;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         SubElementSelector selector1 = createSubElementSelector(arrayWithOops);</span>
<span class="udiff-line-modified-added">+         SubElementSelector selector2 = getSubElementSelector(selector1, ValueWithOops.class, &quot;s&quot;, &quot;Ljava/lang/String;&quot;);</span>
<span class="udiff-line-modified-added">+         String s = (String) getObjectSubElement(arrayWithOops, selector2, 1);</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;s = &quot; + s);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(s.equals(&quot;bonjour&quot;), true, &quot;Wrong string, expecting \&quot;bonjour\&quot;, got &quot; + s);</span>
<span class="udiff-line-modified-added">+         SubElementSelector selector3 = getSubElementSelector(selector1, ValueWithOops.class, &quot;c&quot;, &quot;QTestJNIArrays$Containee;&quot;);</span>
<span class="udiff-line-modified-added">+         Containee c = (Containee) getObjectSubElement(arrayWithOops, selector3, 2);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(c.f, 2.3f, &quot;Wrong float value: &quot; + c.f);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(c.s, (short)4, &quot;Wrong short value &quot; + c.s);</span>
<span class="udiff-line-modified-added">+         setObjectSubElement(arrayWithOops, selector2, 1, &quot;Hello&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(arrayWithOops[1].s.equals(&quot;Hello&quot;), true, &quot;Wrong string, expecting \&quot;Hello\&quot;, got &quot; + s);</span>
<span class="udiff-line-modified-added">+         Integer myInteger = new Integer(345);</span>
<span class="udiff-line-modified-added">+         e = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             setObjectSubElement(arrayWithOops, selector2, 1, myInteger);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             e = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(e, &quot;An exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(e.getClass(), java.lang.ArrayStoreException.class, &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         c = new Containee(9.8f, (short)-3);</span>
<span class="udiff-line-modified-added">+         setObjectSubElement(arrayWithOops, selector3, 2, c);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(c.f, 9.8f, &quot;Wrong float value: &quot; + c.f);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(c.s, (short)-3, &quot;Wrong short value &quot; + c.s);</span>
<span class="udiff-line-modified-added">+         e = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             setObjectSubElement(arrayWithOops, selector3, 2, null);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             e = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(e, &quot;An exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(e.getClass(), java.lang.ArrayStoreException.class, &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         SubElementSelector selector4 = getSubElementSelector(selector3, TestJNIArrays.Containee.class, &quot;s&quot;, &quot;S&quot;);</span>
<span class="udiff-line-modified-added">+         short s2 = getShortSubElement(arrayWithOops, selector4, 3);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(s2, (short)4, &quot;Wrong short value &quot; + s2);</span>
<span class="udiff-line-modified-added">+         setShortSubElement(arrayWithOops, selector4, 3, (short)7);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(arrayWithOops[3].c.s, (short)7, &quot;Wrong short value &quot; + arrayWithOops[3].c.s);</span>
<span class="udiff-line-modified-added">+         e = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             // should fail because selector4 designates a field with type short, not int</span>
<span class="udiff-line-modified-added">+             getIntSubElement(arrayWithOops, selector4, 3);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             e = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(e, &quot;An exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(e.getClass(), java.lang.IllegalArgumentException.class, &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         SubElementSelector selector5 = getSubElementSelector(selector1, ValueWithOops.class, &quot;b&quot;, &quot;QTestJNIArrays$BigValue;&quot;);</span>
<span class="udiff-line-modified-added">+         e = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             // Should fail because selector5 designates a non-flattened field</span>
<span class="udiff-line-modified-added">+             SubElementSelector selector6 = getSubElementSelector(selector5, TestJNIArrays.BigValue.class, &quot;l0&quot;, &quot;J&quot;);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             e = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(e, &quot;An exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(e.getClass(), java.lang.IllegalArgumentException.class, &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         System.gc();</span>
      }
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-added">+ </span>
      void checkGetFlattenedArrayElementSize() {
<span class="udiff-line-modified-removed">- 	Throwable exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    Object o = new Object();</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementSizeWrapper(o);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    int[] array = new int[16];</span>
<span class="udiff-line-modified-removed">- 	    Object o = array;</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementSizeWrapper(o);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementSizeWrapper(new String[16]);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    // Array of BigValue should not be flattened because BigValue is *big*</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementSizeWrapper(new BigValue[16]);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertTrue(exception instanceof IllegalArgumentException , &quot;Exception should be a IAE&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	int size = -1;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    size = GetFlattenedArrayElementSizeWrapper(new IntInt[16]);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(size, 8, &quot;Wrong size&quot;);</span>
<span class="udiff-line-modified-added">+         Throwable exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             Object o = new Object();</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementSizeWrapper(o);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             int[] array = new int[16];</span>
<span class="udiff-line-modified-added">+             Object o = array;</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementSizeWrapper(o);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementSizeWrapper(new String[16]);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             // Array of BigValue should not be flattened because BigValue is *big*</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementSizeWrapper(new BigValue[16]);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertTrue(exception instanceof IllegalArgumentException , &quot;Exception should be a IAE&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         int size = -1;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             size = GetFlattenedArrayElementSizeWrapper(new IntInt[16]);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(size, 8, &quot;Wrong size&quot;);</span>
      }
  
      void checkGetFlattenedArrayElementClass() {
<span class="udiff-line-modified-removed">- 	Throwable exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    Object o = new Object();</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementClassWrapper(o);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    int[] array = new int[16];</span>
<span class="udiff-line-modified-removed">- 	    Object o = array;</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementClassWrapper(o);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementClassWrapper(new String[16]);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    // Array of BigValue should not be flattened because BigValue is *big*</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementClassWrapper(new BigValue[16]);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertTrue(exception instanceof IllegalArgumentException , &quot;Exception should be a IAE&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	Class c = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    c = GetFlattenedArrayElementClassWrapper(new IntInt[16]);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(c, IntInt.class, &quot;Wrong class&quot;);</span>
<span class="udiff-line-modified-added">+         Throwable exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             Object o = new Object();</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementClassWrapper(o);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             int[] array = new int[16];</span>
<span class="udiff-line-modified-added">+             Object o = array;</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementClassWrapper(o);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementClassWrapper(new String[16]);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             // Array of BigValue should not be flattened because BigValue is *big*</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementClassWrapper(new BigValue[16]);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertTrue(exception instanceof IllegalArgumentException , &quot;Exception should be a IAE&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         Class c = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             c = GetFlattenedArrayElementClassWrapper(new IntInt[16]);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(c, IntInt.class, &quot;Wrong class&quot;);</span>
      }
  
      void checkGetFieldOffsetInFlattenedLayout() {
<span class="udiff-line-modified-removed">- 	Throwable exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    Object o = new Object();</span>
<span class="udiff-line-modified-removed">- 	    GetFieldOffsetInFlattenedLayoutWrapper(o.getClass(), &quot;foo&quot;, &quot;I&quot;, true);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    int[] array = new int[16];</span>
<span class="udiff-line-modified-removed">- 	    GetFieldOffsetInFlattenedLayoutWrapper(array.getClass(), &quot;foo&quot;, &quot;I&quot;, true);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    String[] array = new String[16];</span>
<span class="udiff-line-modified-removed">- 	    GetFieldOffsetInFlattenedLayoutWrapper(array.getClass(), &quot;foo&quot;, &quot;I&quot;, true);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	Containee ce  = new Containee(3.4f, (short)5);</span>
<span class="udiff-line-modified-removed">- 	Container c = new Container(123.876, ce, (byte)7);</span>
<span class="udiff-line-modified-removed">- 	Class&lt;?&gt; cclass = c.getClass();</span>
<span class="udiff-line-modified-removed">- 	Container[] containerArray = new Container[32];</span>
<span class="udiff-line-modified-removed">- 	int elementSize = GetFlattenedArrayElementSizeWrapper(containerArray);</span>
<span class="udiff-line-modified-removed">- 	int offset = -1;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    offset = GetFieldOffsetInFlattenedLayoutWrapper(cclass, &quot;d&quot;, &quot;D&quot;, false);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Field f = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    f = cclass.getDeclaredField(&quot;d&quot;);</span>
<span class="udiff-line-modified-removed">- 	} catch(NoSuchFieldException e) {</span>
<span class="udiff-line-modified-removed">- 	    e.printStackTrace();</span>
<span class="udiff-line-modified-removed">- 	    return;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(U.valueHeaderSize(cclass) + offset, U.objectFieldOffset(cclass, f.getName()),</span>
<span class="udiff-line-modified-removed">- 			     &quot;Incorrect offset&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertLessThan(offset, elementSize, &quot;Invalid offset&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    // Field c should be flattened, so last argument is true, no exception expected</span>
<span class="udiff-line-modified-removed">- 	    GetFieldOffsetInFlattenedLayoutWrapper(cclass, &quot;c&quot;, &quot;QTestJNIArrays$Containee;&quot;, true);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertLessThan(offset, elementSize, &quot;Invalid offset&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    // Field c should be flattened, with last argument being false, exception expected from the wrapper </span>
<span class="udiff-line-modified-removed">- 	    GetFieldOffsetInFlattenedLayoutWrapper(cclass, &quot;c&quot;, &quot;QTestJNIArrays$Containee;&quot;, false);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;Wrapper should have thrown a RuntimeException&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), RuntimeException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         Throwable exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             Object o = new Object();</span>
<span class="udiff-line-modified-added">+             GetFieldOffsetInFlattenedLayoutWrapper(o.getClass(), &quot;foo&quot;, &quot;I&quot;, true);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             int[] array = new int[16];</span>
<span class="udiff-line-modified-added">+             GetFieldOffsetInFlattenedLayoutWrapper(array.getClass(), &quot;foo&quot;, &quot;I&quot;, true);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             String[] array = new String[16];</span>
<span class="udiff-line-modified-added">+             GetFieldOffsetInFlattenedLayoutWrapper(array.getClass(), &quot;foo&quot;, &quot;I&quot;, true);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         Containee ce  = new Containee(3.4f, (short)5);</span>
<span class="udiff-line-modified-added">+         Container c = new Container(123.876, ce, (byte)7);</span>
<span class="udiff-line-modified-added">+         Class&lt;?&gt; cclass = c.getClass();</span>
<span class="udiff-line-modified-added">+         Container[] containerArray = new Container[32];</span>
<span class="udiff-line-modified-added">+         int elementSize = GetFlattenedArrayElementSizeWrapper(containerArray);</span>
<span class="udiff-line-modified-added">+         int offset = -1;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             offset = GetFieldOffsetInFlattenedLayoutWrapper(cclass, &quot;d&quot;, &quot;D&quot;, false);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Field f = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             f = cclass.getDeclaredField(&quot;d&quot;);</span>
<span class="udiff-line-modified-added">+         } catch(NoSuchFieldException e) {</span>
<span class="udiff-line-modified-added">+             e.printStackTrace();</span>
<span class="udiff-line-modified-added">+             return;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(U.valueHeaderSize(cclass) + offset, U.objectFieldOffset(cclass, f.getName()),</span>
<span class="udiff-line-modified-added">+                              &quot;Incorrect offset&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertLessThan(offset, elementSize, &quot;Invalid offset&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             // Field c should be flattened, so last argument is true, no exception expected</span>
<span class="udiff-line-modified-added">+             GetFieldOffsetInFlattenedLayoutWrapper(cclass, &quot;c&quot;, &quot;QTestJNIArrays$Containee;&quot;, true);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertLessThan(offset, elementSize, &quot;Invalid offset&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             // Field c should be flattened, with last argument being false, exception expected from the wrapper</span>
<span class="udiff-line-modified-added">+             GetFieldOffsetInFlattenedLayoutWrapper(cclass, &quot;c&quot;, &quot;QTestJNIArrays$Containee;&quot;, false);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;Wrapper should have thrown a RuntimeException&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), RuntimeException.class , &quot;Wrong exception type&quot;);</span>
      }
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-removed">-      void checkGetFlattenedArrayElements() {</span>
<span class="udiff-line-modified-removed">- 	Throwable exception = null;</span>
<span class="udiff-line-modified-removed">- 	Object o = new Object();</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementsWrapper(o);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	int[] a1 = new int[16];</span>
<span class="udiff-line-modified-removed">- 	o = a1;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementsWrapper(o);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementsWrapper(new String[16]);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    // Array of BigValue should not be flattened because BigValue is *big*</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementsWrapper(new BigValue[16]);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertTrue(exception instanceof IllegalArgumentException , &quot;Exception should be a IAE&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    // Direct native access to flattened arrays is not allowed if elements contain oops</span>
<span class="udiff-line-modified-removed">- 	    GetFlattenedArrayElementsWrapper(new ValueWithOops[16]);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertTrue(exception instanceof IllegalArgumentException , &quot;Exception should be a IAE&quot;);</span>
<span class="udiff-line-modified-removed">- 	exception = null;</span>
<span class="udiff-line-modified-removed">- 	long addr = 0;</span>
<span class="udiff-line-modified-removed">- 	IntInt[] a2 = new IntInt[16];</span>
<span class="udiff-line-modified-removed">- 	try {</span>
<span class="udiff-line-modified-removed">- 	    addr = GetFlattenedArrayElementsWrapper(a2);</span>
<span class="udiff-line-modified-removed">- 	} catch(Throwable t) {</span>
<span class="udiff-line-modified-removed">- 	    exception = t;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-removed">- 	if (exception == null) {</span>
<span class="udiff-line-modified-removed">- 	    ReleaseFlattenedArrayElementsWrapper(a2, addr, 0);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     void checkGetFlattenedArrayElements() {</span>
<span class="udiff-line-modified-added">+         Throwable exception = null;</span>
<span class="udiff-line-modified-added">+         Object o = new Object();</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementsWrapper(o);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         int[] a1 = new int[16];</span>
<span class="udiff-line-modified-added">+         o = a1;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementsWrapper(o);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementsWrapper(new String[16]);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(exception.getClass(), IllegalArgumentException.class , &quot;Wrong exception type&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             // Array of BigValue should not be flattened because BigValue is *big*</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementsWrapper(new BigValue[16]);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertTrue(exception instanceof IllegalArgumentException , &quot;Exception should be a IAE&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             // Direct native access to flattened arrays is not allowed if elements contain oops</span>
<span class="udiff-line-modified-added">+             GetFlattenedArrayElementsWrapper(new ValueWithOops[16]);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNotNull(exception, &quot;An IAE should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertTrue(exception instanceof IllegalArgumentException , &quot;Exception should be a IAE&quot;);</span>
<span class="udiff-line-modified-added">+         exception = null;</span>
<span class="udiff-line-modified-added">+         long addr = 0;</span>
<span class="udiff-line-modified-added">+         IntInt[] a2 = new IntInt[16];</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             addr = GetFlattenedArrayElementsWrapper(a2);</span>
<span class="udiff-line-modified-added">+         } catch(Throwable t) {</span>
<span class="udiff-line-modified-added">+             exception = t;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Asserts.assertNull(exception, &quot;No exception should have been thrown&quot;);</span>
<span class="udiff-line-modified-added">+         if (exception == null) {</span>
<span class="udiff-line-modified-added">+             ReleaseFlattenedArrayElementsWrapper(a2, addr, 0);</span>
<span class="udiff-line-modified-added">+         }</span>
      }
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-added">+ </span>
      void checkBehaviors() {
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;Check 1&quot;);</span>
<span class="udiff-line-modified-removed">- 	IntInt[] array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-removed">- 	int value = getIntFieldAtIndex(array, 1, &quot;i0&quot;, &quot;I&quot;);</span>
<span class="udiff-line-modified-removed">- 	Asserts.assertEquals(value, 0, &quot;Initial value must be zero&quot;);</span>
<span class="udiff-line-modified-removed">- 	printArrayInformation(array);</span>
<span class="udiff-line-modified-removed">- 	int i0_value = 42;</span>
<span class="udiff-line-modified-removed">- 	int i1_value = -314;</span>
<span class="udiff-line-modified-removed">- 	initializeIntIntArrayBuffer(array, i0_value, i1_value);</span>
<span class="udiff-line-modified-removed">- 	System.gc();</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array[i].i0, i0_value, &quot;Bad value of i0 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array[i].i1, i1_value, &quot;Bad value of i1 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;Check 2&quot;);</span>
<span class="udiff-line-modified-removed">- 	array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-removed">- 	i0_value = -194;</span>
<span class="udiff-line-modified-removed">- 	i1_value = 91;</span>
<span class="udiff-line-modified-removed">- 	initializeIntIntArrayFields(array, i0_value, i1_value);</span>
<span class="udiff-line-modified-removed">- 	System.gc();</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array[i].i0, i0_value, &quot;Bad value of i0 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array[i].i1, i1_value, &quot;Bad value of i1 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;Check 3&quot;);</span>
<span class="udiff-line-modified-removed">- 	array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-removed">- 	initializeIntIntArrayJava(array, i0_value, i1_value);</span>
<span class="udiff-line-modified-removed">- 	System.gc();</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array[i].i0, i0_value, &quot;Bad value of i0 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array[i].i1, i1_value, &quot;Bad value of i1 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;Check 4&quot;);</span>
<span class="udiff-line-modified-removed">- 	random = new Random(seed);</span>
<span class="udiff-line-modified-removed">- 	array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; ARRAY_SIZE; i++) {</span>
<span class="udiff-line-modified-removed">- 	    array[i] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	sortIntIntArray(array);</span>
<span class="udiff-line-modified-removed">- 	System.gc();</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array.length - 1; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertLessThanOrEqual(array[i].i0, array[i+1].i0, &quot;Incorrect i0 fields ordering at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    if (array[i].i0 == array[i+1].i0) {</span>
<span class="udiff-line-modified-removed">- 		Asserts.assertLessThanOrEqual(array[i].i1, array[i+1].i1, &quot;Incorrect i1 fields ordering at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;Check 5&quot;);</span>
<span class="udiff-line-modified-removed">- 	random = new Random(seed);</span>
<span class="udiff-line-modified-removed">- 	array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; ARRAY_SIZE; i++) {</span>
<span class="udiff-line-modified-removed">- 	    array[i] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	Arrays.sort(array, new IntIntComparator());</span>
<span class="udiff-line-modified-removed">- 	System.gc();</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array.length - 1; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertLessThanOrEqual(array[i].i0, array[i+1].i0, &quot;Incorrect i0 fields ordering at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    if (array[i].i0 == array[i+1].i0) {</span>
<span class="udiff-line-modified-removed">- 		Asserts.assertLessThanOrEqual(array[i].i1, array[i+1].i1, &quot;Incorrect i1 fields ordering at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;Check 6&quot;);</span>
<span class="udiff-line-modified-removed">- 	Container[] array2 = new Container[ARRAY_SIZE];</span>
<span class="udiff-line-modified-removed">- 	double d  = 1.23456789;</span>
<span class="udiff-line-modified-removed">- 	float f = -987.654321f;</span>
<span class="udiff-line-modified-removed">- 	short s = -512;</span>
<span class="udiff-line-modified-removed">- 	byte b = 127;</span>
<span class="udiff-line-modified-removed">- 	Containee c = new Containee(f,s);</span>
<span class="udiff-line-modified-removed">- 	Container c2 = new Container(d, c, b);</span>
<span class="udiff-line-modified-removed">- 	initializeContainerArray(array2, d, f, s, b);</span>
<span class="udiff-line-modified-removed">- 	System.gc();</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array2.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array2[i], c2, &quot;Incorrect value at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array2[i].d, d, &quot;Incorrect d value at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array2[i].c.f, f, &quot;Incorrect f value at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array2[i].c.s, s, &quot;Incorrect s value at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array2[i].b, b, &quot;Incorrect b value at inde &quot; +i);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;Check 7&quot;);</span>
<span class="udiff-line-modified-removed">- 	f = 19.2837465f;</span>
<span class="udiff-line-modified-removed">- 	s = 231;</span>
<span class="udiff-line-modified-removed">- 	updateContainerArray(array2, f, s);</span>
<span class="udiff-line-modified-removed">- 	System.gc();</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array2.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array2[i].d, d, &quot;Incorrect d value at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array2[i].c.f, f, &quot;Incorrect f value at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array2[i].c.s, s, &quot;Incorrect s value at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array2[i].b, b, &quot;Incorrect b value at inde &quot; +i);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;Check 8&quot;);</span>
<span class="udiff-line-modified-removed">- 	long l0 = 52467923;</span>
<span class="udiff-line-modified-removed">- 	long l1= -7854022;</span>
<span class="udiff-line-modified-removed">- 	long l2 = 230947485;</span>
<span class="udiff-line-modified-removed">- 	long l3 = -752497024;</span>
<span class="udiff-line-modified-removed">- 	LongLongLongLong[] array3 = new LongLongLongLong[ARRAY_SIZE/8];</span>
<span class="udiff-line-modified-removed">- 	initializeLongLongLongLongArray(array3, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-removed">- 	System.gc();</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array3.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array3[i].l0, l0, &quot;Bad value of l0 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array3[i].l1, l1, &quot;Bad value of l1 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array3[i].l2, l2, &quot;Bad value of l2 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	    Asserts.assertEquals(array3[i].l3, l3, &quot;Bad value of l3 at index &quot; + i);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;Check 1&quot;);</span>
<span class="udiff-line-modified-added">+         IntInt[] array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-added">+         int value = getIntFieldAtIndex(array, 1, &quot;i0&quot;, &quot;I&quot;);</span>
<span class="udiff-line-modified-added">+         Asserts.assertEquals(value, 0, &quot;Initial value must be zero&quot;);</span>
<span class="udiff-line-modified-added">+         printArrayInformation(array);</span>
<span class="udiff-line-modified-added">+         int i0_value = 42;</span>
<span class="udiff-line-modified-added">+         int i1_value = -314;</span>
<span class="udiff-line-modified-added">+         initializeIntIntArrayBuffer(array, i0_value, i1_value);</span>
<span class="udiff-line-modified-added">+         System.gc();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array[i].i0, i0_value, &quot;Bad value of i0 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array[i].i1, i1_value, &quot;Bad value of i1 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;Check 2&quot;);</span>
<span class="udiff-line-modified-added">+         array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-added">+         i0_value = -194;</span>
<span class="udiff-line-modified-added">+         i1_value = 91;</span>
<span class="udiff-line-modified-added">+         initializeIntIntArrayFields(array, i0_value, i1_value);</span>
<span class="udiff-line-modified-added">+         System.gc();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array[i].i0, i0_value, &quot;Bad value of i0 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array[i].i1, i1_value, &quot;Bad value of i1 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;Check 3&quot;);</span>
<span class="udiff-line-modified-added">+         array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-added">+         initializeIntIntArrayJava(array, i0_value, i1_value);</span>
<span class="udiff-line-modified-added">+         System.gc();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array[i].i0, i0_value, &quot;Bad value of i0 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array[i].i1, i1_value, &quot;Bad value of i1 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;Check 4&quot;);</span>
<span class="udiff-line-modified-added">+         random = new Random(seed);</span>
<span class="udiff-line-modified-added">+         array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; ARRAY_SIZE; i++) {</span>
<span class="udiff-line-modified-added">+             array[i] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         sortIntIntArray(array);</span>
<span class="udiff-line-modified-added">+         System.gc();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array.length - 1; i++) {</span>
<span class="udiff-line-modified-added">+             Asserts.assertLessThanOrEqual(array[i].i0, array[i+1].i0, &quot;Incorrect i0 fields ordering at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             if (array[i].i0 == array[i+1].i0) {</span>
<span class="udiff-line-modified-added">+                 Asserts.assertLessThanOrEqual(array[i].i1, array[i+1].i1, &quot;Incorrect i1 fields ordering at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;Check 5&quot;);</span>
<span class="udiff-line-modified-added">+         random = new Random(seed);</span>
<span class="udiff-line-modified-added">+         array = new IntInt[ARRAY_SIZE];</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; ARRAY_SIZE; i++) {</span>
<span class="udiff-line-modified-added">+             array[i] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         Arrays.sort(array, new IntIntComparator());</span>
<span class="udiff-line-modified-added">+         System.gc();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array.length - 1; i++) {</span>
<span class="udiff-line-modified-added">+             Asserts.assertLessThanOrEqual(array[i].i0, array[i+1].i0, &quot;Incorrect i0 fields ordering at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             if (array[i].i0 == array[i+1].i0) {</span>
<span class="udiff-line-modified-added">+                 Asserts.assertLessThanOrEqual(array[i].i1, array[i+1].i1, &quot;Incorrect i1 fields ordering at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;Check 6&quot;);</span>
<span class="udiff-line-modified-added">+         Container[] array2 = new Container[ARRAY_SIZE];</span>
<span class="udiff-line-modified-added">+         double d  = 1.23456789;</span>
<span class="udiff-line-modified-added">+         float f = -987.654321f;</span>
<span class="udiff-line-modified-added">+         short s = -512;</span>
<span class="udiff-line-modified-added">+         byte b = 127;</span>
<span class="udiff-line-modified-added">+         Containee c = new Containee(f,s);</span>
<span class="udiff-line-modified-added">+         Container c2 = new Container(d, c, b);</span>
<span class="udiff-line-modified-added">+         initializeContainerArray(array2, d, f, s, b);</span>
<span class="udiff-line-modified-added">+         System.gc();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array2.length; i++) {</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array2[i], c2, &quot;Incorrect value at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array2[i].d, d, &quot;Incorrect d value at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array2[i].c.f, f, &quot;Incorrect f value at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array2[i].c.s, s, &quot;Incorrect s value at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array2[i].b, b, &quot;Incorrect b value at inde &quot; +i);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;Check 7&quot;);</span>
<span class="udiff-line-modified-added">+         f = 19.2837465f;</span>
<span class="udiff-line-modified-added">+         s = 231;</span>
<span class="udiff-line-modified-added">+         updateContainerArray(array2, f, s);</span>
<span class="udiff-line-modified-added">+         System.gc();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array2.length; i++) {</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array2[i].d, d, &quot;Incorrect d value at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array2[i].c.f, f, &quot;Incorrect f value at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array2[i].c.s, s, &quot;Incorrect s value at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array2[i].b, b, &quot;Incorrect b value at inde &quot; +i);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;Check 8&quot;);</span>
<span class="udiff-line-modified-added">+         long l0 = 52467923;</span>
<span class="udiff-line-modified-added">+         long l1= -7854022;</span>
<span class="udiff-line-modified-added">+         long l2 = 230947485;</span>
<span class="udiff-line-modified-added">+         long l3 = -752497024;</span>
<span class="udiff-line-modified-added">+         LongLongLongLong[] array3 = new LongLongLongLong[ARRAY_SIZE/8];</span>
<span class="udiff-line-modified-added">+         initializeLongLongLongLongArray(array3, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-added">+         System.gc();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array3.length; i++) {</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array3[i].l0, l0, &quot;Bad value of l0 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array3[i].l1, l1, &quot;Bad value of l1 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array3[i].l2, l2, &quot;Bad value of l2 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+             Asserts.assertEquals(array3[i].l3, l3, &quot;Bad value of l3 at index &quot; + i);</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
      void initializeIntIntArrayJava(IntInt[] array, int i0, int i1) {
<span class="udiff-line-modified-removed">- 	IntInt ii = new IntInt(i0, i1);</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    array[i] = ii;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+         IntInt ii = new IntInt(i0, i1);</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-added">+             array[i] = ii;</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
      void initializeContainerArrayJava(Container[] array, double d, float f, short s, byte b) {
<span class="udiff-line-modified-removed">- 	Containee c = new Containee(f,s);</span>
<span class="udiff-line-modified-removed">- 	Container c2 = new Container(d, c, b);</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    array[i] = c2;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+         Containee c = new Containee(f,s);</span>
<span class="udiff-line-modified-added">+         Container c2 = new Container(d, c, b);</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-added">+             array[i] = c2;</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
      void updateContainerArrayJava(Container[] array, float f, short s) {
<span class="udiff-line-modified-removed">- 	Containee c = new Containee(f, s);</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    array[i] = array[i].setc(c);;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+         Containee c = new Containee(f, s);</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-added">+             array[i] = array[i].setc(c);;</span>
<span class="udiff-line-modified-added">+         }</span>
      }
  
      void initializeLongLongLongLongArrayJava(LongLongLongLong[] array, long l0, long l1, long l2, long l3) {
<span class="udiff-line-modified-removed">- 	LongLongLongLong llll = new LongLongLongLong(l0, l1, l2, l3);</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-removed">- 	    array[i] = llll;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-added">+         LongLongLongLong llll = new LongLongLongLong(l0, l1, l2, l3);</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; array.length; i++) {</span>
<span class="udiff-line-modified-added">+             array[i] = llll;</span>
<span class="udiff-line-modified-added">+         }</span>
      }
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-removed">-     void mesureInitializationTime(int array_size, int iterations) {</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nInitialization time for IntInt[]:&quot;);</span>
<span class="udiff-line-modified-removed">- 	long[] start = new long[iterations];</span>
<span class="udiff-line-modified-removed">- 	long[] end = new long[iterations];</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    initializeIntIntArrayJava(array, 42, -314);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    initializeIntIntArrayJava(array, 42, -314);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nNative(memcpy):&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    initializeIntIntArrayBuffer(array, 42, -314);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    initializeIntIntArrayBuffer(array, 42, -314);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-removed">- 	</span>
<span class="udiff-line-modified-removed">- 	</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nNative(fields):&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    initializeIntIntArrayFields(array, 42, -314);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    initializeIntIntArrayFields(array, 42, -314);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     void measureInitializationTime(int array_size, int iterations) {</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nInitialization time for IntInt[]:&quot;);</span>
<span class="udiff-line-modified-added">+         long[] start = new long[iterations];</span>
<span class="udiff-line-modified-added">+         long[] end = new long[iterations];</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             initializeIntIntArrayJava(array, 42, -314);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             initializeIntIntArrayJava(array, 42, -314);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nNative(memcpy):&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             initializeIntIntArrayBuffer(array, 42, -314);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             initializeIntIntArrayBuffer(array, 42, -314);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nNative(fields):&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             initializeIntIntArrayFields(array, 42, -314);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             initializeIntIntArrayFields(array, 42, -314);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
      }
  
<span class="udiff-line-modified-removed">-     void mesureInitializationTime2(int array_size, int iterations) {</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nInitialization time for Container[]:&quot;);</span>
<span class="udiff-line-modified-removed">- 	long[] start = new long[iterations];</span>
<span class="udiff-line-modified-removed">- 	long[] end = new long[iterations];</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	double d = 0.369852147;</span>
<span class="udiff-line-modified-removed">- 	float f = -321.654987f;</span>
<span class="udiff-line-modified-removed">- 	short s = -3579;</span>
<span class="udiff-line-modified-removed">- 	byte b = 42;</span>
<span class="udiff-line-modified-removed">- 	</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-removed">- 	    initializeContainerArrayJava(array, d, f, s, b);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    initializeContainerArrayJava(array, d, f, s, b);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nNative:&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-removed">- 	    initializeContainerArray(array, d, f, s, b);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    initializeContainerArray(array, d, f, s, b);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+     void measureInitializationTime2(int array_size, int iterations) {</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nInitialization time for Container[]:&quot;);</span>
<span class="udiff-line-modified-added">+         long[] start = new long[iterations];</span>
<span class="udiff-line-modified-added">+         long[] end = new long[iterations];</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         double d = 0.369852147;</span>
<span class="udiff-line-modified-added">+         float f = -321.654987f;</span>
<span class="udiff-line-modified-added">+         short s = -3579;</span>
<span class="udiff-line-modified-added">+         byte b = 42;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-added">+             initializeContainerArrayJava(array, d, f, s, b);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             initializeContainerArrayJava(array, d, f, s, b);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nNative:&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-added">+             initializeContainerArray(array, d, f, s, b);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             initializeContainerArray(array, d, f, s, b);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
      }
  
<span class="udiff-line-modified-removed">-     void mesureUpdateTime2(int array_size, int iterations) {</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nUpdating Container[]:&quot;);</span>
<span class="udiff-line-modified-removed">- 	long[] start = new long[iterations];</span>
<span class="udiff-line-modified-removed">- 	long[] end = new long[iterations];</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	double d = 0.369852147;</span>
<span class="udiff-line-modified-removed">- 	float f = -321.654987f;</span>
<span class="udiff-line-modified-removed">- 	short s = -3579;</span>
<span class="udiff-line-modified-removed">- 	byte b = 42;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	Containee c = new Containee(f,s);</span>
<span class="udiff-line-modified-removed">- 	Container c2 = new Container(d, c, b);</span>
<span class="udiff-line-modified-removed">- 	</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-removed">- 	    for (int j = 0; j &lt; array.length; j++) {</span>
<span class="udiff-line-modified-removed">- 		array[j] = c2;</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	    updateContainerArrayJava(array, f, s);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-removed">- 	    for (int j = 0; j &lt; array.length; j++) {</span>
<span class="udiff-line-modified-removed">- 		array[i] = c2;</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    updateContainerArrayJava(array, f, s);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nNative:&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-removed">- 	    for (int j = 0; j &lt; array.length; j++) {</span>
<span class="udiff-line-modified-removed">- 		array[i] = c2;</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	    updateContainerArray(array, f, s);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-removed">- 	    for (int j = 0; j &lt; array.length; j++) {</span>
<span class="udiff-line-modified-removed">- 		array[i] = c2;</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    updateContainerArray(array, f, s);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+     void measureUpdateTime2(int array_size, int iterations) {</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nUpdating Container[]:&quot;);</span>
<span class="udiff-line-modified-added">+         long[] start = new long[iterations];</span>
<span class="udiff-line-modified-added">+         long[] end = new long[iterations];</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         double d = 0.369852147;</span>
<span class="udiff-line-modified-added">+         float f = -321.654987f;</span>
<span class="udiff-line-modified-added">+         short s = -3579;</span>
<span class="udiff-line-modified-added">+         byte b = 42;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         Containee c = new Containee(f,s);</span>
<span class="udiff-line-modified-added">+         Container c2 = new Container(d, c, b);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-added">+             for (int j = 0; j &lt; array.length; j++) {</span>
<span class="udiff-line-modified-added">+                 array[j] = c2;</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             updateContainerArrayJava(array, f, s);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-added">+             for (int j = 0; j &lt; array.length; j++) {</span>
<span class="udiff-line-modified-added">+                 array[i] = c2;</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             updateContainerArrayJava(array, f, s);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nNative:&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-added">+             for (int j = 0; j &lt; array.length; j++) {</span>
<span class="udiff-line-modified-added">+                 array[i] = c2;</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             updateContainerArray(array, f, s);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             Container[] array = new Container[array_size];</span>
<span class="udiff-line-modified-added">+             for (int j = 0; j &lt; array.length; j++) {</span>
<span class="udiff-line-modified-added">+                 array[i] = c2;</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             updateContainerArray(array, f, s);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
      }
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-removed">-     void mesureSortingTime(int array_size, int iterations) {</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nSorting time:&quot;);</span>
<span class="udiff-line-modified-removed">- 	long[] start = new long[iterations];</span>
<span class="udiff-line-modified-removed">- 	long[] end = new long[iterations];</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	random = new Random(seed);</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-removed">- 	IntIntComparator comparator = new IntIntComparator();</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    for (int j = 0; j &lt; array_size; j++) {</span>
<span class="udiff-line-modified-removed">- 		array[j] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	    Arrays.sort(array, comparator);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    for (int j = 0; j &lt; array_size; j++) {</span>
<span class="udiff-line-modified-removed">- 		array[j] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    Arrays.sort(array, comparator);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	random = new Random(seed);</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nNative:&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    for (int j = 0; j &lt; array_size; j++) {</span>
<span class="udiff-line-modified-removed">- 		array[j] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	    sortIntIntArray(array);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-removed">- 	    for (int j = 0; j &lt; array_size; j++) {</span>
<span class="udiff-line-modified-removed">- 		array[j] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-removed">- 	    }</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    sortIntIntArray(array);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     void measureSortingTime(int array_size, int iterations) {</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nSorting time:&quot;);</span>
<span class="udiff-line-modified-added">+         long[] start = new long[iterations];</span>
<span class="udiff-line-modified-added">+         long[] end = new long[iterations];</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         random = new Random(seed);</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-added">+         IntIntComparator comparator = new IntIntComparator();</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             for (int j = 0; j &lt; array_size; j++) {</span>
<span class="udiff-line-modified-added">+                 array[j] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             Arrays.sort(array, comparator);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             for (int j = 0; j &lt; array_size; j++) {</span>
<span class="udiff-line-modified-added">+                 array[j] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             Arrays.sort(array, comparator);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         random = new Random(seed);</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nNative:&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             for (int j = 0; j &lt; array_size; j++) {</span>
<span class="udiff-line-modified-added">+                 array[j] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             sortIntIntArray(array);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             IntInt[] array = new IntInt[array_size];</span>
<span class="udiff-line-modified-added">+             for (int j = 0; j &lt; array_size; j++) {</span>
<span class="udiff-line-modified-added">+                 array[j] = new IntInt(random.nextInt(), random.nextInt());</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             sortIntIntArray(array);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
      }
  
  
<span class="udiff-line-modified-removed">-     void mesureInitializationTime3(int array_size, int iterations) {</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nInitialization time for LongLongLongLong[]:&quot;);</span>
<span class="udiff-line-modified-removed">- 	long[] start = new long[iterations];</span>
<span class="udiff-line-modified-removed">- 	long[] end = new long[iterations];</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	long l0 = 123456;</span>
<span class="udiff-line-modified-removed">- 	long l1 = -987654;</span>
<span class="udiff-line-modified-removed">- 	long l2 = 192837;</span>
<span class="udiff-line-modified-removed">- 	long l3 = -56473829;</span>
<span class="udiff-line-modified-removed">- 	</span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    LongLongLongLong[] array = new LongLongLongLong[array_size];</span>
<span class="udiff-line-modified-removed">- 	    initializeLongLongLongLongArrayJava(array, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    LongLongLongLong[] array = new LongLongLongLong[array_size];</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    initializeLongLongLongLongArrayJava(array, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	System.out.println(&quot;\nNative:&quot;);</span>
<span class="udiff-line-modified-removed">- 	// Warmup</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-removed">- 	    LongLongLongLong[] array = new LongLongLongLong[array_size];</span>
<span class="udiff-line-modified-removed">- 	    initializeLongLongLongLongArray(array, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Measure</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    LongLongLongLong[] array = new LongLongLongLong[array_size];</span>
<span class="udiff-line-modified-removed">- 	    start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	    initializeLongLongLongLongArray(array, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-removed">- 	    end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	// Results</span>
<span class="udiff-line-modified-removed">- 	computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+     void measureInitializationTime3(int array_size, int iterations) {</span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nInitialization time for LongLongLongLong[]:&quot;);</span>
<span class="udiff-line-modified-added">+         long[] start = new long[iterations];</span>
<span class="udiff-line-modified-added">+         long[] end = new long[iterations];</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         long l0 = 123456;</span>
<span class="udiff-line-modified-added">+         long l1 = -987654;</span>
<span class="udiff-line-modified-added">+         long l2 = 192837;</span>
<span class="udiff-line-modified-added">+         long l3 = -56473829;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nJava:&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             LongLongLongLong[] array = new LongLongLongLong[array_size];</span>
<span class="udiff-line-modified-added">+             initializeLongLongLongLongArrayJava(array, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             LongLongLongLong[] array = new LongLongLongLong[array_size];</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             initializeLongLongLongLongArrayJava(array, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         System.out.println(&quot;\nNative:&quot;);</span>
<span class="udiff-line-modified-added">+         // Warmup</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; 10; i++) {</span>
<span class="udiff-line-modified-added">+             LongLongLongLong[] array = new LongLongLongLong[array_size];</span>
<span class="udiff-line-modified-added">+             initializeLongLongLongLongArray(array, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Measure</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             LongLongLongLong[] array = new LongLongLongLong[array_size];</span>
<span class="udiff-line-modified-added">+             start[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+             initializeLongLongLongLongArray(array, l0, l1, l2, l3);</span>
<span class="udiff-line-modified-added">+             end[i] = System.nanoTime();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // Results</span>
<span class="udiff-line-modified-added">+         computeStatistics(start, end);</span>
      }
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-added">+ </span>
      void computeStatistics(long[] start, long[] end) {
<span class="udiff-line-modified-removed">- 	int iterations = start.length;</span>
<span class="udiff-line-modified-removed">- 	long[] duration = new long[iterations];</span>
<span class="udiff-line-modified-removed">- 	long sum = 0;</span>
<span class="udiff-line-modified-removed">- 	long min = end[0] - start[0];</span>
<span class="udiff-line-modified-removed">- 	long max = min;</span>
<span class="udiff-line-modified-removed">- 	double var = 0.0;</span>
<span class="udiff-line-modified-removed">- 	for (int i = 0 ; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-removed">- 	    duration[i] = end[i] - start[i];</span>
<span class="udiff-line-modified-removed">- 	    if (duration[i] &lt; min) min = duration[i];</span>
<span class="udiff-line-modified-removed">- 	    if (duration[i] &gt; max) max = duration[i];</span>
<span class="udiff-line-modified-removed">- 	    sum += duration[i];</span>
<span class="udiff-line-modified-removed">- 	    double d = (double) duration[i];</span>
<span class="udiff-line-modified-removed">- 	    var += Math.pow(d, 2);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- 	double avg = (sum/iterations) / 1000;</span>
<span class="udiff-line-modified-removed">- 	double std = (Math.sqrt(var/iterations - Math.pow(sum/iterations, 2))) / 1000;</span>
<span class="udiff-line-modified-removed">- 	System.out.println(String.format(&quot;Avg: %8.2f us&quot;, avg));</span>
<span class="udiff-line-modified-removed">- 	System.out.println(String.format(&quot;Std: %8.2f us&quot;, std));</span>
<span class="udiff-line-modified-removed">- 	System.out.println(String.format(&quot;Min: %8d us&quot;, (min/1000)));</span>
<span class="udiff-line-modified-removed">- 	System.out.println(String.format(&quot;Max: %8d us&quot;, (max/1000)));</span>
<span class="udiff-line-modified-added">+         int iterations = start.length;</span>
<span class="udiff-line-modified-added">+         long[] duration = new long[iterations];</span>
<span class="udiff-line-modified-added">+         long sum = 0;</span>
<span class="udiff-line-modified-added">+         long min = end[0] - start[0];</span>
<span class="udiff-line-modified-added">+         long max = min;</span>
<span class="udiff-line-modified-added">+         double var = 0.0;</span>
<span class="udiff-line-modified-added">+         for (int i = 0 ; i &lt; iterations; i++) {</span>
<span class="udiff-line-modified-added">+             duration[i] = end[i] - start[i];</span>
<span class="udiff-line-modified-added">+             if (duration[i] &lt; min) min = duration[i];</span>
<span class="udiff-line-modified-added">+             if (duration[i] &gt; max) max = duration[i];</span>
<span class="udiff-line-modified-added">+             sum += duration[i];</span>
<span class="udiff-line-modified-added">+             double d = (double) duration[i];</span>
<span class="udiff-line-modified-added">+             var += Math.pow(d, 2);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         double avg = (sum/iterations) / 1000;</span>
<span class="udiff-line-modified-added">+         double std = (Math.sqrt(var/iterations - Math.pow(sum/iterations, 2))) / 1000;</span>
<span class="udiff-line-modified-added">+         System.out.println(String.format(&quot;Avg: %8.2f us&quot;, avg));</span>
<span class="udiff-line-modified-added">+         System.out.println(String.format(&quot;Std: %8.2f us&quot;, std));</span>
<span class="udiff-line-modified-added">+         System.out.println(String.format(&quot;Min: %8d us&quot;, (min/1000)));</span>
<span class="udiff-line-modified-added">+         System.out.println(String.format(&quot;Max: %8d us&quot;, (max/1000)));</span>
      }
  
      native int GetFlattenedArrayElementSizeWrapper(Object array);
      native Class GetFlattenedArrayElementClassWrapper(Object array);
      native long GetFlattenedArrayElementsWrapper(Object array);
      native void ReleaseFlattenedArrayElementsWrapper(Object array, long addr,int mode);
      native int GetFieldOffsetInFlattenedLayoutWrapper(Class klass, String name, String signature, boolean flattened);
<span class="udiff-line-modified-removed">-     </span>
<span class="udiff-line-modified-added">+ </span>
      native int getIntFieldAtIndex(Object[] array, int index, String fieldName, String FieldSignature);
      native void printArrayInformation(Object[] array);
  
      native void initializeIntIntArrayBuffer(Object[] array, int i0, int i1);
      native void initializeIntIntArrayFields(Object[] array, int i0, int i1);
</pre>
<center>&lt; prev <a href="../../../../../../index.html" target="_top">index</a> <a href="ValueTypeArray.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>