<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/langtools/jdk/jshell/ToolSimpleTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
    <script type="text/javascript" src="../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2016, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
<a name="1" id="anc1"></a><span class="line-removed"> 25  * @ignore</span>
 26  * @test
 27  * @bug 8153716 8143955 8151754 8150382 8153920 8156910 8131024 8160089 8153897 8167128 8154513 8170015 8170368 8172102 8172103  8165405 8173073 8173848 8174041 8173916 8174028 8174262 8174797 8177079 8180508 8177466 8172154 8192979 8191842 8198573 8198801 8210596 8210959 8215099 8199623 8236715 8239536
 28  * @summary Simple jshell tool tests
 29  * @modules jdk.compiler/com.sun.tools.javac.api
 30  *          jdk.compiler/com.sun.tools.javac.main
 31  *          jdk.jdeps/com.sun.tools.javap
 32  *          jdk.jshell/jdk.internal.jshell.tool
 33  * @build KullaTesting TestingInputStream
 34  * @run testng/othervm ToolSimpleTest
 35  */
 36 
 37 import java.util.ArrayList;
 38 import java.util.Arrays;
 39 import java.util.List;
 40 import java.util.Locale;
 41 import java.util.function.Consumer;
 42 import java.util.regex.Pattern;
 43 import java.util.stream.Collectors;
 44 import java.util.stream.Stream;
 45 
 46 import org.testng.annotations.Test;
 47 
 48 import static org.testng.Assert.assertEquals;
 49 import static org.testng.Assert.assertTrue;
 50 
 51 public class ToolSimpleTest extends ReplToolTesting {
 52 
 53     @Test
 54     public void testRemaining() {
 55         test(
 56                 (a) -&gt; assertCommand(a, &quot;int z; z =&quot;, &quot;z ==&gt; 0&quot;),
 57                 (a) -&gt; assertCommand(a, &quot;5&quot;, &quot;z ==&gt; 5&quot;),
 58                 (a) -&gt; assertCommand(a, &quot;/*nada*/; int q =&quot;, &quot;&quot;),
 59                 (a) -&gt; assertCommand(a, &quot;77&quot;, &quot;q ==&gt; 77&quot;),
 60                 (a) -&gt; assertCommand(a, &quot;//comment;&quot;, &quot;&quot;),
 61                 (a) -&gt; assertCommand(a, &quot;int v;&quot;, &quot;v ==&gt; 0&quot;),
 62                 (a) -&gt; assertCommand(a, &quot;int v; int c&quot;,
 63                         &quot;v ==&gt; 0\n&quot; +
 64                         &quot;c ==&gt; 0&quot;)
 65         );
 66     }
 67 
 68     @Test
 69     public void testOpenComment() {
 70         test(
 71                 (a) -&gt; assertCommand(a, &quot;int z = /* blah&quot;, &quot;&quot;),
 72                 (a) -&gt; assertCommand(a, &quot;baz */ 5&quot;, &quot;z ==&gt; 5&quot;),
 73                 (a) -&gt; assertCommand(a, &quot;/** hoge &quot;, &quot;&quot;),
 74                 (a) -&gt; assertCommand(a, &quot;baz **/&quot;, &quot;&quot;),
 75                 (a) -&gt; assertCommand(a, &quot;int v&quot;, &quot;v ==&gt; 0&quot;)
 76         );
 77     }
 78 
 79     @Test
 80     public void testSwitchExpression() {
 81         test(false, new String[]{&quot;--enable-preview&quot;, &quot;--no-startup&quot;},
 82                 (a) -&gt; assertCommand(a, &quot;enum Day {MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY }&quot;, &quot;|  created enum Day&quot;),
 83                 (a) -&gt; assertCommand(a, &quot;Day day = Day.FRIDAY;&quot;, &quot;day ==&gt; FRIDAY&quot;),
 84                 (a) -&gt; assertCommand(a, &quot;switch (day) {&quot;, &quot;&quot;),
 85                 (a) -&gt; assertCommand(a, &quot;case MONDAY, FRIDAY, SUNDAY -&gt; 6;&quot;, &quot;&quot;),
 86                 (a) -&gt; assertCommand(a, &quot;case TUESDAY -&gt; 7;&quot;, &quot;&quot;),
 87                 (a) -&gt; assertCommand(a, &quot;case THURSDAY, SATURDAY -&gt; 8;&quot;, &quot;&quot;),
 88                 (a) -&gt; assertCommand(a, &quot;case WEDNESDAY -&gt; 9;&quot;, &quot;&quot;),
 89                 (a) -&gt; assertCommandOutputContains(a, &quot;}&quot;, &quot; ==&gt; 6&quot;)
 90                 );
 91     }
 92 
 93     @Test
 94     public void testSwitchExpressionCompletion() {
 95         test(false, new String[]{&quot;--enable-preview&quot;, &quot;--no-startup&quot;},
 96                 (a) -&gt; assertCommand(a, &quot;enum Day {MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY }&quot;, &quot;|  created enum Day&quot;),
 97                 (a) -&gt; assertCommand(a, &quot;Day day = Day.FRIDAY;&quot;, &quot;day ==&gt; FRIDAY&quot;),
 98                 (a) -&gt; assertCommand(a, &quot;switch (day) {&quot;, &quot;&quot;),
 99                 (a) -&gt; assertCommand(a, &quot;case MONDAY, FRIDAY, SUNDAY -&gt; 6;&quot;, &quot;&quot;),
100                 (a) -&gt; assertCommand(a, &quot;case TUESDAY -&gt; 7;&quot;, &quot;&quot;),
101                 (a) -&gt; assertCommand(a, &quot;case THURSDAY, SATURDAY -&gt; 8;&quot;, &quot;&quot;),
102                 (a) -&gt; assertCommand(a, &quot;case WEDNESDAY -&gt; 9;&quot;, &quot;&quot;),
103                 (a) -&gt; assertCommand(a, &quot;} +&quot;, &quot;&quot;),
104                 (a) -&gt; assertCommandOutputContains(a, &quot;1000&quot;, &quot; ==&gt; 1006&quot;)
105                 );
106     }
107 
108     @Test
109     public void testLessThan() {
110         test(
111                 (a) -&gt; assertCommand(a, &quot;45&quot;, &quot;$1 ==&gt; 45&quot;),
112                 (a) -&gt; assertCommand(a, &quot;72&quot;, &quot;$2 ==&gt; 72&quot;),
113                 (a) -&gt; assertCommand(a, &quot;$1 &lt; $2&quot;, &quot;$3 ==&gt; true&quot;),
114                 (a) -&gt; assertCommand(a, &quot;int a, b&quot;, &quot;a ==&gt; 0\n&quot; +
115                         &quot;b ==&gt; 0&quot;),
116                 (a) -&gt; assertCommand(a, &quot;a &lt; b&quot;, &quot;$6 ==&gt; false&quot;)
117         );
118     }
119 
120     @Test
121     public void testChainedThrow() {
122         test(
123                 (a) -&gt; assertCommand(a, &quot;void p() throws Exception { ((String) null).toString(); }&quot;,
124                         &quot;|  created method p()&quot;),
125                 (a) -&gt; assertCommand(a, &quot;void n() throws Exception { try { p(); } catch (Exception ex) { throw new IOException(\&quot;bar\&quot;, ex); }}&quot;,
126                         &quot;|  created method n()&quot;),
127                 (a) -&gt; assertCommand(a, &quot;void m() { try { n(); } catch (Exception ex) { throw new RuntimeException(\&quot;foo\&quot;, ex); }}&quot;,
128                         &quot;|  created method m()&quot;),
129                 (a) -&gt; assertCommand(a, &quot;m()&quot;,
130                           &quot;|  Exception java.lang.RuntimeException: foo\n&quot;
131                         + &quot;|        at m (#3:1)\n&quot;
132                         + &quot;|        at (#4:1)\n&quot;
133                         + &quot;|  Caused by: java.io.IOException: bar\n&quot;
134                         + &quot;|        at n (#2:1)\n&quot;
135                         + &quot;|        ...\n&quot;
136                         + &quot;|  Caused by: java.lang.NullPointerException\n&quot;
137                         + &quot;|        at p (#1:1)\n&quot;
138                         + &quot;|        ...&quot;),
139                 (a) -&gt; assertCommand(a, &quot;/drop p&quot;,
140                         &quot;|  dropped method p()&quot;),
141                 (a) -&gt; assertCommand(a, &quot;m()&quot;,
142                         &quot;|  attempted to call method n() which cannot be invoked until method p() is declared&quot;)
143         );
144     }
145 
146     @Test
147     public void testThrowWithPercent() {
148         test(
149                 (a) -&gt; assertCommandCheckOutput(a,
150                         &quot;URI u = new URI(\&quot;http\&quot;, null, \&quot;h\&quot;, -1, \&quot;a\&quot; + (char)0x04, null, null);&quot;, (s) -&gt;
151                                 assertTrue(s.contains(&quot;URISyntaxException&quot;) &amp;&amp; !s.contains(&quot;JShellTool&quot;),
152                                         &quot;Output: &#39;&quot; + s + &quot;&#39;&quot;)),
153                 (a) -&gt; assertCommandCheckOutput(a,
154                         &quot;throw new Exception(\&quot;%z\&quot;)&quot;, (s) -&gt;
155                                 assertTrue(s.contains(&quot;java.lang.Exception&quot;) &amp;&amp; !s.contains(&quot;UnknownFormatConversionException&quot;),
156                                         &quot;Output: &#39;&quot; + s + &quot;&#39;&quot;))
157         );
158     }
159 
160     @Test
161     public void oneLineOfError() {
162         test(
163                 (a) -&gt; assertCommand(a, &quot;12+&quot;, null),
164                 (a) -&gt; assertCommandCheckOutput(a, &quot;  true&quot;, (s) -&gt;
165                         assertTrue(s.contains(&quot;12+&quot;) &amp;&amp; !s.contains(&quot;true&quot;), &quot;Output: &#39;&quot; + s + &quot;&#39;&quot;))
166         );
167     }
168 
169     @Test
170     public void defineVariables() {
171         test(
172                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
173                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
174                 (a) -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
175                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
176                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
177                 (a) -&gt; assertVariable(a, &quot;double&quot;, &quot;a&quot;, &quot;1&quot;, &quot;1.0&quot;),
178                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
179                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
180                 (a) -&gt; evaluateExpression(a, &quot;double&quot;, &quot;2 * a&quot;, &quot;2.0&quot;),
181                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
182                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables())
183         );
184     }
185 
186     @Test
187     public void defineMethods() {
188         test(
189                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
190                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
191                 (a) -&gt; assertMethod(a, &quot;int f() { return 0; }&quot;, &quot;()int&quot;, &quot;f&quot;),
192                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
193                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
194                 (a) -&gt; assertMethod(a, &quot;void f(int a) { g(); }&quot;, &quot;(int)void&quot;, &quot;f&quot;),
195                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
196                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
197                 (a) -&gt; assertMethod(a, &quot;void g() {}&quot;, &quot;()void&quot;, &quot;g&quot;),
198                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
199                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods())
200         );
201     }
202 
203     @Test
204     public void defineTypes() {
205         test(
206                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
207                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
208                 (a) -&gt; assertClass(a, &quot;class A { }&quot;, &quot;class&quot;, &quot;A&quot;),
209                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
210                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
211                 (a) -&gt; assertClass(a, &quot;interface A { }&quot;, &quot;interface&quot;, &quot;A&quot;),
212                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
213                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
214                 (a) -&gt; assertClass(a, &quot;enum A { }&quot;, &quot;enum&quot;, &quot;A&quot;),
215                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
216                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
217                 (a) -&gt; assertClass(a, &quot;@interface A { }&quot;, &quot;@interface&quot;, &quot;A&quot;),
218                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
219                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses())
220         );
221     }
222 
223     @Test
224     public void defineImports() {
225         test(
226                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
227                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
228                 (a) -&gt; assertImport(a, &quot;import java.util.stream.Stream;&quot;, &quot;&quot;, &quot;java.util.stream.Stream&quot;),
229                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
230                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
231                 (a) -&gt; assertImport(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;, &quot;java.util.stream.*&quot;),
232                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
233                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
234                 (a) -&gt; assertImport(a, &quot;import static java.lang.Math.PI;&quot;, &quot;static&quot;, &quot;java.lang.Math.PI&quot;),
235                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
236                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
237                 (a) -&gt; assertImport(a, &quot;import static java.lang.Math.*;&quot;, &quot;static&quot;, &quot;java.lang.Math.*&quot;),
238                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
239                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports())
240         );
241     }
242 
243     @Test
244     public void defineVar() {
245         test(
246                 (a) -&gt; assertCommand(a, &quot;int x = 72&quot;, &quot;x ==&gt; 72&quot;),
247                 (a) -&gt; assertCommand(a, &quot;x&quot;, &quot;x ==&gt; 72&quot;),
248                 (a) -&gt; assertCommand(a, &quot;/vars&quot;, &quot;|    int x = 72&quot;)
249         );
250     }
251 
252     @Test
253     public void defineUnresolvedVar() {
254         test(
255                 (a) -&gt; assertCommand(a, &quot;undefined x&quot;,
256                         &quot;|  created variable x, however, it cannot be referenced until class undefined is declared&quot;),
257                 (a) -&gt; assertCommand(a, &quot;/vars&quot;, &quot;|    undefined x = (not-active)&quot;)
258         );
259     }
260 
261     @Test
262     public void testUnresolved() {
263         test(
264                 (a) -&gt; assertCommand(a, &quot;int f() { return g() + x + new A().a; }&quot;,
265                         &quot;|  created method f(), however, it cannot be invoked until method g(), variable x, and class A are declared&quot;),
266                 (a) -&gt; assertCommand(a, &quot;f()&quot;,
267                         &quot;|  attempted to call method f() which cannot be invoked until method g(), variable x, and class A are declared&quot;),
268                 (a) -&gt; assertCommandOutputStartsWith(a, &quot;int g() { return x; }&quot;,
269                         &quot;|  created method g(), however, it cannot be invoked until variable x is declared&quot;),
270                 (a) -&gt; assertCommand(a, &quot;g()&quot;, &quot;|  attempted to call method g() which cannot be invoked until variable x is declared&quot;)
271         );
272     }
273 
274     // 8199623
275     @Test
276     public void testTwoForkedDrop() {
277         test(
278                 (a) -&gt; assertCommand(a, &quot;void p() throws Exception { ((String) null).toString(); }&quot;,
279                         &quot;|  created method p()&quot;),
280                 (a) -&gt; assertCommand(a, &quot;void n() throws Exception { try { p(); } catch (Exception ex) { throw new IOException(\&quot;bar\&quot;, ex); }} &quot;,
281                         &quot;|  created method n()&quot;),
282                 (a) -&gt; assertCommand(a, &quot;void m() { try { n(); } catch (Exception ex) { throw new RuntimeException(\&quot;foo\&quot;, ex); }}&quot;,
283                         &quot;|  created method m()&quot;),
284                 (a) -&gt; assertCommand(a, &quot;void c() throws Throwable { p(); }&quot;,
285                         &quot;|  created method c()&quot;),
286                 (a) -&gt; assertCommand(a, &quot;/drop p&quot;,
287                         &quot;|  dropped method p()&quot;),
288                 (a) -&gt; assertCommand(a, &quot;m()&quot;,
289                         &quot;|  attempted to call method n() which cannot be invoked until method p() is declared&quot;),
290                 (a) -&gt; assertCommand(a, &quot;/meth n&quot;,
291                         &quot;|    void n()\n&quot; +
292                         &quot;|       which cannot be invoked until method p() is declared&quot;),
293                 (a) -&gt; assertCommand(a, &quot;/meth m&quot;,
294                         &quot;|    void m()&quot;),
295                 (a) -&gt; assertCommand(a, &quot;/meth c&quot;,
296                         &quot;|    void c()\n&quot; +
297                                 &quot;|       which cannot be invoked until method p() is declared&quot;)
298         );
299     }
300 
301     @Test
302     public void testUnknownCommand() {
303         test((a) -&gt; assertCommand(a, &quot;/unknown&quot;,
304                 &quot;|  Invalid command: /unknown\n&quot; +
305                 &quot;|  Type /help for help.&quot;));
306     }
307 
308     @Test
309     public void testEmptyClassPath() {
310         test(after -&gt; assertCommand(after, &quot;/env --class-path&quot;, &quot;|  Argument to class-path missing.&quot;));
311     }
312 
313     @Test
314     public void testInvalidClassPath() {
315         test(
316                 a -&gt; assertCommand(a, &quot;/env --class-path snurgefusal&quot;,
317                         &quot;|  File &#39;snurgefusal&#39; for &#39;--class-path&#39; is not found.&quot;),
318                 a -&gt; assertCommand(a, &quot;/env --class-path ?&quot;,
319                         &quot;|  File &#39;?&#39; for &#39;--class-path&#39; is not found.&quot;)
320         );
321     }
322 
323     @Test
324     public void testNoArgument() {
325         test(
326                 (a) -&gt; assertCommand(a, &quot;/save&quot;,
327                         &quot;|  &#39;/save&#39; requires a filename argument.&quot;),
328                 (a) -&gt; assertCommand(a, &quot;/open&quot;,
329                         &quot;|  &#39;/open&#39; requires a filename argument.&quot;),
330                 (a) -&gt; assertCommandOutputStartsWith(a, &quot;/drop&quot;,
331                         &quot;|  In the /drop argument, please specify an import, variable, method, or class to drop.&quot;)
332         );
333     }
334 
335     @Test
336     public void testDebug() {
337         test(
338                 (a) -&gt; assertCommand(a, &quot;/deb&quot;, &quot;|  Debugging on&quot;),
339                 (a) -&gt; assertCommand(a, &quot;/debug&quot;, &quot;|  Debugging off&quot;),
340                 (a) -&gt; assertCommand(a, &quot;/debug&quot;, &quot;|  Debugging on&quot;),
341                 (a) -&gt; assertCommand(a, &quot;/deb&quot;, &quot;|  Debugging off&quot;)
342         );
343     }
344 
345     @Test
346     public void testDrop() {
347         test(false, new String[]{&quot;--no-startup&quot;},
348                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
349                 a -&gt; dropVariable(a, &quot;/drop 1&quot;, &quot;int a = 0&quot;, &quot;|  dropped variable a&quot;),
350                 a -&gt; assertMethod(a, &quot;int b() { return 0; }&quot;, &quot;()int&quot;, &quot;b&quot;),
351                 a -&gt; dropMethod(a, &quot;/drop 2&quot;, &quot;int b()&quot;, &quot;|  dropped method b()&quot;),
352                 a -&gt; assertClass(a, &quot;class A {}&quot;, &quot;class&quot;, &quot;A&quot;),
353                 a -&gt; dropClass(a, &quot;/drop 3&quot;, &quot;class A&quot;, &quot;|  dropped class A&quot;),
354                 a -&gt; assertImport(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;, &quot;java.util.stream.*&quot;),
355                 a -&gt; dropImport(a, &quot;/drop 4&quot;, &quot;import java.util.stream.*&quot;, &quot;&quot;),
356                 a -&gt; assertCommand(a, &quot;for (int i = 0; i &lt; 10; ++i) {}&quot;, &quot;&quot;),
357                 a -&gt; assertCommand(a, &quot;/drop 5&quot;, &quot;&quot;),
358                 a -&gt; assertCommand(a, &quot;/list&quot;, &quot;&quot;),
359                 a -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
360                 a -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
361                 a -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
362                 a -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports())
363         );
364         test(false, new String[]{&quot;--no-startup&quot;},
365                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
366                 a -&gt; dropVariable(a, &quot;/drop a&quot;, &quot;int a = 0&quot;, &quot;|  dropped variable a&quot;),
367                 a -&gt; assertMethod(a, &quot;int b() { return 0; }&quot;, &quot;()int&quot;, &quot;b&quot;),
368                 a -&gt; dropMethod(a, &quot;/drop b&quot;, &quot;int b()&quot;, &quot;|  dropped method b()&quot;),
369                 a -&gt; assertClass(a, &quot;class A {}&quot;, &quot;class&quot;, &quot;A&quot;),
370                 a -&gt; dropClass(a, &quot;/drop A&quot;, &quot;class A&quot;, &quot;|  dropped class A&quot;),
371                 a -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
372                 a -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
373                 a -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
374                 a -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports())
375         );
376     }
377 
378     @Test
379     public void testDropRange() {
380         test(false, new String[]{&quot;--no-startup&quot;},
381                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
382                 a -&gt; assertMethod(a, &quot;int b() { return 0; }&quot;, &quot;()int&quot;, &quot;b&quot;),
383                 a -&gt; assertClass(a, &quot;class A {}&quot;, &quot;class&quot;, &quot;A&quot;),
384                 a -&gt; assertImport(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;, &quot;java.util.stream.*&quot;),
385                 a -&gt; assertCommand(a, &quot;for (int i = 0; i &lt; 10; ++i) {}&quot;, &quot;&quot;),
386                 a -&gt; assertCommand(a, &quot;/drop 3-5 b 1&quot;,
387                         &quot;|  dropped class A\n&quot; +
388                         &quot;|  dropped method b()\n&quot; +
389                         &quot;|  dropped variable a\n&quot;),
390                 a -&gt; assertCommand(a, &quot;/list&quot;, &quot;&quot;)
391         );
392     }
393 
394     @Test
395     public void testDropNegative() {
396         test(false, new String[]{&quot;--no-startup&quot;},
397                 a -&gt; assertCommandOutputStartsWith(a, &quot;/drop 0&quot;, &quot;|  No snippet with ID: 0&quot;),
398                 a -&gt; assertCommandOutputStartsWith(a, &quot;/drop a&quot;, &quot;|  No such snippet: a&quot;),
399                 a -&gt; assertCommandCheckOutput(a, &quot;/drop&quot;,
400                         assertStartsWith(&quot;|  In the /drop argument, please specify an import, variable, method, or class to drop.&quot;)),
401                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
402                 a -&gt; assertCommand(a, &quot;a&quot;, &quot;a ==&gt; 0&quot;),
403                 a -&gt; assertCommand(a, &quot;/drop 2&quot;, &quot;&quot;),
404                 a -&gt; assertCommand(a, &quot;/drop 2&quot;,
405                         &quot;|  This command does not accept the snippet &#39;2&#39; : a\n&quot; +
406                         &quot;|  See /types, /methods, /vars, or /list&quot;)
407         );
408     }
409 
410     @Test
411     public void testAmbiguousDrop() {
412         test(
413                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
414                 a -&gt; assertMethod(a, &quot;int a() { return 0; }&quot;, &quot;()int&quot;, &quot;a&quot;),
415                 a -&gt; assertClass(a, &quot;class a {}&quot;, &quot;class&quot;, &quot;a&quot;),
416                 a -&gt; assertCommand(a, &quot;/drop a&quot;,
417                         &quot;|  dropped variable a\n&quot; +
418                         &quot;|  dropped method a()\n&quot; +
419                         &quot;|  dropped class a&quot;)
420         );
421         test(
422                 a -&gt; assertMethod(a, &quot;int a() { return 0; }&quot;, &quot;()int&quot;, &quot;a&quot;),
423                 a -&gt; assertMethod(a, &quot;double a(int a) { return 0; }&quot;, &quot;(int)double&quot;, &quot;a&quot;),
424                 a -&gt; assertMethod(a, &quot;double a(double a) { return 0; }&quot;, &quot;(double)double&quot;, &quot;a&quot;),
425                 a -&gt; assertCommand(a, &quot;/drop a&quot;,
426                         &quot;|  dropped method a()\n&quot; +
427                         &quot;|  dropped method a(int)\n&quot; +
428                         &quot;|  dropped method a(double)\n&quot;)
429         );
430     }
431 
432     @Test
433     public void testApplicationOfPost() {
434         test(
435                 (a) -&gt; assertCommand(a, &quot;/set mode t normal -command&quot;, &quot;|  Created new feedback mode: t&quot;),
436                 (a) -&gt; assertCommand(a, &quot;/set feedback t&quot;, &quot;|  Feedback mode: t&quot;),
437                 (a) -&gt; assertCommand(a, &quot;/set format t post \&quot;$%n\&quot;&quot;, &quot;&quot;),
438                 (a) -&gt; assertCommand(a, &quot;/set prompt t \&quot;+\&quot; \&quot;-\&quot;&quot;, &quot;&quot;),
439                 (a) -&gt; assertCommand(a, &quot;/set prompt t&quot;, &quot;|  /set prompt t \&quot;+\&quot; \&quot;-\&quot;$&quot;)
440         );
441     }
442 
443     @Test
444     public void testHelpLength() {
445         Consumer&lt;String&gt; testOutput = (s) -&gt; {
446             List&lt;String&gt; ss = Stream.of(s.split(&quot;\n&quot;))
447                     .filter(l -&gt; !l.isEmpty())
448                     .collect(Collectors.toList());
449             assertTrue(ss.size() &gt;= 10, &quot;Help does not print enough lines:&quot; + s);
450         };
451         test(
452                 (a) -&gt; assertCommandCheckOutput(a, &quot;/?&quot;, testOutput),
453                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help&quot;, testOutput),
454                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help /list&quot;, testOutput)
455         );
456     }
457 
458     @Test
459     public void testHelp() {
460         test(
461                 (a) -&gt; assertHelp(a, &quot;/?&quot;, &quot;/list&quot;, &quot;/help&quot;, &quot;/exit&quot;, &quot;intro&quot;),
462                 (a) -&gt; assertHelp(a, &quot;/help&quot;, &quot;/list&quot;, &quot;/help&quot;, &quot;/exit&quot;, &quot;intro&quot;),
463                 (a) -&gt; assertHelp(a, &quot;/help short&quot;, &quot;shortcuts&quot;, &quot;Tab&quot;),
464                 (a) -&gt; assertHelp(a, &quot;/help keys&quot;, &quot;line&quot;, &quot;Shift&quot;, &quot;imports&quot;, &quot;history&quot;),
465                 (a) -&gt; assertHelp(a, &quot;/? /li&quot;, &quot;/list -all&quot;, &quot;snippets&quot;),
466                 (a) -&gt; assertHelp(a, &quot;/help /set prompt&quot;, &quot;optionally contain &#39;%s&#39;&quot;, &quot;quoted&quot;),
467                 (a) -&gt; assertHelp(a, &quot;/help /help&quot;, &quot;/help &lt;command&gt;&quot;),
468                 (a) -&gt; assertHelp(a, &quot;/help li&quot;, &quot;/list -start&quot;),
469                 (a) -&gt; assertHelp(a, &quot;/help fe&quot;, &quot;/set feedback -retain&quot;)
470         );
471     }
472 
473     @Test
474     public void testHelpStart() {
475         test(
476                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help /exit&quot;,
477                         s -&gt; assertTrue(s.replaceAll(&quot;\\r\\n?&quot;, &quot;\n&quot;).startsWith(
478                                 &quot;|  \n&quot; +
479                                 &quot;|                                   /exit\n&quot; +
480                                 &quot;|                                   =====\n&quot; +
481                                 &quot;|  &quot;
482                         ))
483                 )
484         );
485     }
486 
487     @Test
488     public void testHelpFormat() {
489         test(
490                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help&quot;, s -&gt; {
491                     String[] lines = s.split(&quot;\\R&quot;);
492                     assertTrue(lines.length &gt; 20,
493                             &quot;Too few lines of /help output: &quot; + lines.length
494                           + &quot;\n&quot; + s);
495                     for (int i = 0; i &lt; lines.length; ++i) {
496                         String l = lines[i];
497                         assertTrue(l.startsWith(&quot;| &quot;),
498                                 &quot;Expected /help line to start with | :\n&quot; + l);
499                         assertTrue(l.length() &lt;= 80,
500                                 &quot;/help line too long: &quot; + l.length() + &quot;\n&quot; + l);
501                     }
502                  })
503         );
504     }
505 
506     @Test
507     public void testConfusedUserPseudoCommands() {
508         test(
509                 (a) -&gt; assertHelp(a, &quot;/-&lt;n&gt;&quot;, &quot;last snippet&quot;, &quot;digits&quot;),
510                 (a) -&gt; assertHelp(a, &quot;/&lt;id&gt;&quot;, &quot;last snippet&quot;, &quot;digits&quot;)
511         );
512     }
513 
514     private void assertHelp(boolean a, String command, String... find) {
515         assertCommandCheckOutput(a, command, s -&gt; {
516             for (String f : find) {
517                 assertTrue(s.contains(f),
518                         &quot;Expected output of &quot; + command + &quot; to contain: &quot; + f
519                       + &quot;\n&quot; + s);
520             }
521         });
522     }
523 
524     // Check that each line of output contains the corresponding string from the list
525     private void checkLineToList(String in, List&lt;String&gt; match) {
526         String trimmed = in.trim();
527         String[] res = trimmed.isEmpty()
528                 ? new String[0]
529                 : trimmed.split(&quot;\n&quot;);
530         assertEquals(res.length, match.size(), &quot;Got: &quot; + Arrays.asList(res));
531         for (int i = 0; i &lt; match.size(); ++i) {
532             assertTrue(res[i].contains(match.get(i)));
533         }
534     }
535 
536     @Test
537     public void testListArgs() {
538         String arg = &quot;qqqq&quot;;
539         List&lt;String&gt; startVarList = new ArrayList&lt;&gt;(START_UP);
540         startVarList.add(&quot;int aardvark&quot;);
541         startVarList.add(&quot;int weevil&quot;);
542         test(
543                 a -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;,
544                         s -&gt; checkLineToList(s, START_UP)),
545                 a -&gt; assertCommandOutputStartsWith(a, &quot;/list &quot; + arg,
546                         &quot;|  No such snippet: &quot; + arg),
547                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
548                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;weevil&quot;),
549                 a -&gt; assertCommandOutputContains(a, &quot;/list aardvark&quot;, &quot;aardvark&quot;),
550                 a -&gt; assertCommandCheckOutput(a, &quot;/list -start&quot;,
551                         s -&gt; checkLineToList(s, START_UP)),
552                 a -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;,
553                         s -&gt; checkLineToList(s, startVarList)),
554                 a -&gt; assertCommandOutputStartsWith(a, &quot;/list s3&quot;,
555                         &quot;s3 : import&quot;),
556                 a -&gt; assertCommandCheckOutput(a, &quot;/list 1-2 s3&quot;,
557                         s -&gt; {
558                             assertTrue(Pattern.matches(&quot;.*aardvark.*\\R.*weevil.*\\R.*s3.*import.*&quot;, s.trim()),
559                                     &quot;No match: &quot; + s);
560                         }),
561                 a -&gt; assertCommandOutputStartsWith(a, &quot;/list &quot; + arg,
562                         &quot;|  No such snippet: &quot; + arg)
563         );
564     }
565 
566     @Test
567     public void testVarsArgs() {
568         String arg = &quot;qqqq&quot;;
569         List&lt;String&gt; startVarList = new ArrayList&lt;&gt;();
570         test(
571                 a -&gt; assertCommandCheckOutput(a, &quot;/vars -all&quot;,
572                         s -&gt; checkLineToList(s, startVarList)),
573                 a -&gt; assertCommand(a, &quot;/vars &quot; + arg,
574                         &quot;|  No such snippet: &quot; + arg),
575                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
576                 a -&gt; assertMethod(a, &quot;int f() { return 0; }&quot;, &quot;()int&quot;, &quot;f&quot;),
577                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
578                 a -&gt; assertVariable(a, &quot;double&quot;, &quot;a&quot;, &quot;1&quot;, &quot;1.0&quot;),
579                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars aardvark&quot;,
580                         &quot;|    int aardvark = 0&quot;),
581                 a -&gt; assertCommandCheckOutput(a, &quot;/vars -start&quot;,
582                         s -&gt; checkLineToList(s, startVarList)),
583                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars -all&quot;,
584                         &quot;|    int aardvark = 0\n|    int a = &quot;),
585                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars 1-4&quot;,
586                         &quot;|    int aardvark = 0\n|    int a = &quot;),
587                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars f&quot;,
588                         &quot;|  This command does not accept the snippet &#39;f&#39;&quot;),
589                 a -&gt; assertCommand(a, &quot;/var &quot; + arg,
590                         &quot;|  No such snippet: &quot; + arg)
591         );
592     }
593 
594     @Test
595     public void testMethodsArgs() {
596         String arg = &quot;qqqq&quot;;
597         List&lt;String&gt; printingMethodList = new ArrayList&lt;&gt;(PRINTING_CMD_METHOD);
598         test(new String[]{&quot;--startup&quot;, &quot;PRINTING&quot;},
599                 a -&gt; assertCommandCheckOutput(a, &quot;/methods -all&quot;,
600                         s -&gt; checkLineToList(s, printingMethodList)),
601                 a -&gt; assertCommandCheckOutput(a, &quot;/methods -start&quot;,
602                         s -&gt; checkLineToList(s, printingMethodList)),
603                 a -&gt; assertCommandCheckOutput(a, &quot;/methods print println printf&quot;,
604                         s -&gt; checkLineToList(s, printingMethodList)),
605                 a -&gt; assertCommandCheckOutput(a, &quot;/methods println&quot;,
606                         s -&gt; assertEquals(s.trim().split(&quot;\n&quot;).length, 10)),
607                 a -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;,
608                         s -&gt; checkLineToList(s, printingMethodList)),
609                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods &quot; + arg,
610                         &quot;|  No such snippet: &quot; + arg),
611                 a -&gt; assertMethod(a, &quot;int f() { return 0; }&quot;, &quot;()int&quot;, &quot;f&quot;),
612                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
613                 a -&gt; assertMethod(a, &quot;void f(int a) { g(); }&quot;, &quot;(int)void&quot;, &quot;f&quot;),
614                 a -&gt; assertMethod(a, &quot;void g() {}&quot;, &quot;()void&quot;, &quot;g&quot;),
615                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods &quot; + arg,
616                         &quot;|  No such snippet: &quot; + arg),
617                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods aardvark&quot;,
618                         &quot;|  This command does not accept the snippet &#39;aardvark&#39; : int aardvark&quot;),
619                 a -&gt; assertCommandCheckOutput(a, &quot;/methods -start&quot;,
620                         s -&gt; checkLineToList(s, printingMethodList)),
621                 a -&gt; assertCommandCheckOutput(a, &quot;/methods print println printf&quot;,
622                         s -&gt; checkLineToList(s, printingMethodList)),
623                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods g&quot;,
624                         &quot;|    void g()&quot;),
625                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods f&quot;,
626                         &quot;|    int f()\n&quot; +
627                         &quot;|    void f(int)&quot;)
628         );
629     }
630 
631     @Test
632     public void testMethodsWithErrors() {
633         test(new String[]{&quot;--no-startup&quot;},
634                 a -&gt; assertCommand(a, &quot;double m(int x) { return x; }&quot;,
635                         &quot;|  created method m(int)&quot;),
636                 a -&gt; assertCommand(a, &quot;GARBAGE junk() { return TRASH; }&quot;,
637                         &quot;|  created method junk(), however, it cannot be referenced until class GARBAGE, and variable TRASH are declared&quot;),
638                 a -&gt; assertCommand(a, &quot;int w = 5;&quot;,
639                         &quot;w ==&gt; 5&quot;),
640                 a -&gt; assertCommand(a, &quot;int tyer() { return w; }&quot;,
641                         &quot;|  created method tyer()&quot;),
642                 a -&gt; assertCommand(a, &quot;String w = \&quot;hi\&quot;;&quot;,
643                         &quot;w ==&gt; \&quot;hi\&quot;&quot;),
644                 a -&gt; assertCommand(a, &quot;/methods&quot;,
645                         &quot;|    double m(int)\n&quot; +
646                         &quot;|    GARBAGE junk()\n&quot; +
647                         &quot;|       which cannot be referenced until class GARBAGE, and variable TRASH are declared\n&quot; +
648                         &quot;|    int tyer()\n&quot; +
649                         &quot;|       which cannot be invoked until this error is corrected: \n&quot; +
650                         &quot;|          incompatible types: java.lang.String cannot be converted to int\n&quot; +
651                         &quot;|          int tyer() { return w; }\n&quot; +
652                         &quot;|                              ^\n&quot;)
653         );
654     }
655 
656     @Test
657     public void testTypesWithErrors() {
658         test(new String[]{&quot;--no-startup&quot;},
659                 a -&gt; assertCommand(a, &quot;class C extends NONE { int x; }&quot;,
660                         &quot;|  created class C, however, it cannot be referenced until class NONE is declared&quot;),
661                 a -&gt; assertCommand(a, &quot;class D { void m() { System.out.println(nada); } }&quot;,
662                         &quot;|  created class D, however, it cannot be instantiated or its methods invoked until variable nada is declared&quot;),
663                 a -&gt; assertCommand(a, &quot;/types&quot;,
664                         &quot;|    class C\n&quot; +
665                         &quot;|       which cannot be referenced until class NONE is declared\n&quot; +
666                         &quot;|    class D\n&quot; +
667                         &quot;|       which cannot be instantiated or its methods invoked until variable nada is declared\n&quot;)
668         );
669     }
670 
671     @Test
672     public void testTypesArgs() {
673         String arg = &quot;qqqq&quot;;
674         List&lt;String&gt; startTypeList = new ArrayList&lt;&gt;();
675         test(
676                 a -&gt; assertCommandCheckOutput(a, &quot;/types -all&quot;,
677                         s -&gt; checkLineToList(s, startTypeList)),
678                 a -&gt; assertCommandCheckOutput(a, &quot;/types -start&quot;,
679                         s -&gt; checkLineToList(s, startTypeList)),
680                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types &quot; + arg,
681                         &quot;|  No such snippet: &quot; + arg),
682                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
683                 (a) -&gt; assertClass(a, &quot;class A { }&quot;, &quot;class&quot;, &quot;A&quot;),
684                 (a) -&gt; assertClass(a, &quot;interface A { }&quot;, &quot;interface&quot;, &quot;A&quot;),
685                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types -all&quot;,
686                         &quot;|    class A\n&quot; +
687                         &quot;|    interface A&quot;),
688                 (a) -&gt; assertClass(a, &quot;enum E { }&quot;, &quot;enum&quot;, &quot;E&quot;),
689                 (a) -&gt; assertClass(a, &quot;@interface B { }&quot;, &quot;@interface&quot;, &quot;B&quot;),
690                 a -&gt; assertCommand(a, &quot;/types aardvark&quot;,
691                         &quot;|  This command does not accept the snippet &#39;aardvark&#39; : int aardvark;&quot;),
692                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types A&quot;,
693                         &quot;|    interface A&quot;),
694                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types E&quot;,
695                         &quot;|    enum E&quot;),
696                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types B&quot;,
697                         &quot;|    @interface B&quot;),
698                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types &quot; + arg,
699                         &quot;|  No such snippet: &quot; + arg),
700                 a -&gt; assertCommandCheckOutput(a, &quot;/types -start&quot;,
701                         s -&gt; checkLineToList(s, startTypeList))
702         );
703     }
704 
705     @Test
706     public void testBlankLinesInSnippetContinuation() {
707         test(Locale.ROOT, false, new String[]{&quot;--no-startup&quot;}, &quot;&quot;,
708                 a -&gt; assertCommand(a, &quot;class C {&quot;,
709                         &quot;&quot;),
710                 a -&gt; assertCommand(a, &quot;&quot;,
711                         &quot;&quot;),
712                 a -&gt; assertCommand(a, &quot;&quot;,
713                         &quot;&quot;),
714                 a -&gt; assertCommand(a, &quot;  int x;&quot;,
715                         &quot;&quot;),
716                 a -&gt; assertCommand(a, &quot;&quot;,
717                         &quot;&quot;),
718                 a -&gt; assertCommand(a, &quot;&quot;,
719                         &quot;&quot;),
720                 a -&gt; assertCommand(a, &quot;}&quot;,
721                         &quot;|  created class C&quot;),
722                 a -&gt; assertCommand(a, &quot;/list&quot;,
723                         &quot;\n&quot; +
724                         &quot;   1 : class C {\n&quot; +
725                         &quot;       \n&quot; +
726                         &quot;       \n&quot; +
727                         &quot;         int x;\n&quot; +
728                         &quot;       \n&quot; +
729                         &quot;       \n&quot; +
730                         &quot;       }&quot;)
731         );
732     }
733 
734     @Test
735     public void testCompoundStart() {
736         test(new String[]{&quot;--startup&quot;, &quot;DEFAULT&quot;, &quot;--startup&quot;, &quot;PRINTING&quot;},
737                 (a) -&gt; assertCommand(a, &quot;printf(\&quot;%4.2f\&quot;, Math.PI)&quot;,
738                         &quot;&quot;, &quot;&quot;, null, &quot;3.14&quot;, &quot;&quot;)
739         );
740     }
741 
742     @Test
743     public void testJavaSeStart() {
744         test(new String[]{&quot;--startup&quot;, &quot;JAVASE&quot;},
745                 (a) -&gt; assertCommand(a, &quot;ZoneOffsetTransitionRule.TimeDefinition.WALL&quot;,
746                         &quot;$1 ==&gt; WALL&quot;)
747         );
748     }
749 
750     @Test
751     public void testJavaSeSetStart() {
752         test(
753                 (a) -&gt; assertCommand(a, &quot;/set sta JAVASE&quot;, &quot;&quot;),
754                 (a) -&gt; assertCommand(a, &quot;/reset&quot;, &quot;|  Resetting state.&quot;),
755                 (a) -&gt; assertCommandCheckOutput(a, &quot;/li -a&quot;,
756                             s -&gt; assertTrue(s.split(&quot;import &quot;).length &gt; 160,
757                             &quot;not enough imports for JAVASE:\n&quot; + s))
758         );
759     }
760 
761     @Test
762     public void defineClasses() {
763         test(
764                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
765                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
766                 (a) -&gt; assertClass(a, &quot;class A { }&quot;, &quot;class&quot;, &quot;A&quot;),
767                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
768                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
769                 (a) -&gt; assertClass(a, &quot;interface A { }&quot;, &quot;interface&quot;, &quot;A&quot;),
770                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
771                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
772                 (a) -&gt; assertClass(a, &quot;enum A { }&quot;, &quot;enum&quot;, &quot;A&quot;),
773                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
774                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
775                 (a) -&gt; assertClass(a, &quot;@interface A { }&quot;, &quot;@interface&quot;, &quot;A&quot;),
776                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
777                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses())
778         );
779     }
780 
781     @Test
782     public void testCommandPrefix() {
783         test(a -&gt; assertCommandCheckOutput(a, &quot;/s&quot;,
784                       assertStartsWith(&quot;|  Command: &#39;/s&#39; is ambiguous: /save, /set&quot;)),
785              a -&gt; assertCommand(a, &quot;int var&quot;, &quot;var ==&gt; 0&quot;),
786              a -&gt; assertCommandCheckOutput(a, &quot;/va&quot;,
787                       assertStartsWith(&quot;|    int var = 0&quot;)),
788              a -&gt; assertCommandCheckOutput(a, &quot;/save&quot;,
789                       assertStartsWith(&quot;|  &#39;/save&#39; requires a filename argument.&quot;)));
790     }
791 
792     @Test
793     public void testOptionQ() {
794         test(Locale.ROOT, false, new String[]{&quot;-q&quot;, &quot;--no-startup&quot;}, &quot;&quot;,
795                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
796                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
797         );
798     }
799 
800     @Test
801     public void testOptionS() {
802         test(Locale.ROOT, false, new String[]{&quot;-s&quot;, &quot;--no-startup&quot;}, &quot;&quot;,
803                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;&quot;)
804         );
805     }
806 
807     @Test
808     public void testOptionV() {
809         test(new String[]{&quot;-v&quot;, &quot;--no-startup&quot;},
810                 (a) -&gt; assertCommand(a, &quot;1+1&quot;,
811                         &quot;$1 ==&gt; 2\n&quot; +
812                         &quot;|  created scratch variable $1 : int&quot;)
813         );
814     }
815 
816     @Test
817     public void testOptionFeedback() {
818         test(Locale.ROOT, false, new String[]{&quot;--feedback&quot;, &quot;concise&quot;, &quot;--no-startup&quot;}, &quot;&quot;,
819                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
820                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
821         );
822     }
823 
824     @Test
825     public void testCompoundOptions() {
826         Consumer&lt;String&gt; confirmNoStartup = s -&gt; {
827                     assertEquals(0, Stream.of(s.split(&quot;\n&quot;))
828                             .filter(l -&gt; !l.isEmpty())
829                             .count(), &quot;Expected no lines: &quot; + s);
830                 };
831         test(Locale.ROOT, false, new String[]{&quot;-nq&quot;}, &quot;&quot;,
832                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;, confirmNoStartup),
833                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
834                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
835         );
836         test(Locale.ROOT, false, new String[]{&quot;-qn&quot;}, &quot;&quot;,
837                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;, confirmNoStartup),
838                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
839                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
840         );
841         test(Locale.ROOT, false, new String[]{&quot;-ns&quot;}, &quot;&quot;,
842                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;, confirmNoStartup),
843                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;&quot;)
844         );
845     }
846 
847     @Test
848     public void testOptionR() {
849         test(new String[]{&quot;-R-Dthe.sound=blorp&quot;, &quot;--no-startup&quot;},
850                 (a) -&gt; assertCommand(a, &quot;System.getProperty(\&quot;the.sound\&quot;)&quot;,
851                         &quot;$1 ==&gt; \&quot;blorp\&quot;&quot;)
852         );
853     }
854 
855     @Test
856     public void testWrapSourceHandlerDiagCrash() {
857         test(new String[]{&quot;--add-exports&quot;, &quot;jdk.javadoc/ALL-UNNAMED&quot;},
858                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;)
859          );
860     }
861 
862     @Test
863     public void test8156910() {
864         test(
865                 (a) -&gt; assertCommandOutputContains(a, &quot;System.out.println(\&quot;%5d\&quot;, 10);&quot;, &quot;%5d&quot;),
866                 (a) -&gt; assertCommandOutputContains(a, &quot;1234&quot;, &quot;==&gt; 1234&quot;)
867         );
868     }
869 
870     @Test
871     public void testIntersection() {
872         test(
873                 (a) -&gt; assertCommandOutputContains(a, &quot;&lt;Z extends Runnable&amp;CharSequence&gt; Z get1() { return null; }&quot;, &quot;get1()&quot;),
874                 (a) -&gt; assertCommandOutputContains(a, &quot;var g1 = get1()&quot;, &quot;g1&quot;),
875                 (a) -&gt; assertCommand(a, &quot;/vars g1&quot;, &quot;|    CharSequence&amp;Runnable g1 = null&quot;),
876                 (a) -&gt; assertCommandOutputContains(a, &quot;&lt;Z extends Number&amp;CharSequence&gt; Z get2() { return null; }&quot;, &quot;get2()&quot;),
877                 (a) -&gt; assertCommandOutputContains(a, &quot;var g2 = get2()&quot;, &quot;g2&quot;),
878                 (a) -&gt; assertCommand(a, &quot;/vars g2&quot;, &quot;|    Number&amp;CharSequence g2 = null&quot;)
879         );
880     }
881 
882     @Test
883     public void testAnonymous() {
884         test(
885                 (a) -&gt; assertCommandOutputContains(a, &quot;var r1 = new Object() {}&quot;, &quot;r1&quot;),
886                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r1&quot;, &quot;|    &lt;anonymous class extending Object&gt; r1 = &quot;),
887                 (a) -&gt; assertCommandOutputContains(a, &quot;var r2 = new Runnable() { public void run() { } }&quot;, &quot;r2&quot;),
888                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r2&quot;, &quot;|    &lt;anonymous class implementing Runnable&gt; r2 = &quot;),
889                 (a) -&gt; assertCommandOutputContains(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;),
890                 (a) -&gt; assertCommandOutputContains(a, &quot;var list = Stream.of(1, 2, 3).map(j -&gt; new Object() { int i = j; }).collect(Collectors.toList());&quot;,
891                                                       &quot;list&quot;),
892                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars list&quot;, &quot;|    List&lt;&lt;anonymous class extending Object&gt;&gt; list = &quot;)
893         );
894     }
895 
896     // This is mainly interesting in the TestLocalSimpleTest case (8198573)
897     @Test
898     public void testUpdateFalsePositive() {
899         test(
900                 a -&gt; assertClass(a, &quot;class A { int a() { int error = 0; return error; } }&quot;, &quot;class&quot;, &quot;A&quot;),
901                 a -&gt; assertVariable(a, &quot;A&quot;, &quot;a&quot;, &quot;new A()&quot;, &quot;A@.+&quot;),
902                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;error&quot;, &quot;4711&quot;, &quot;4711&quot;),
903                 a -&gt; assertCommandOutputContains(a, &quot;a&quot;, &quot;A@&quot;)
904         );
905     }
906 
907     @Test
908     public void testRecords() {
909         test(new String[] {&quot;--enable-preview&quot;},
910                 (a) -&gt; assertCommandOutputContains(a, &quot;record R(int i) { public int g() { return j; } }&quot;,
911                         &quot;|  created record R, however, it cannot be instantiated or its methods invoked until variable j is declared&quot;),
912                 (a) -&gt; assertCommandOutputContains(a, &quot;new R(0)&quot;,
913                         &quot;|  attempted to use record R which cannot be instantiated or its methods invoked until variable j is declared&quot;)
914         );
915     }
916 
917     @Test
918     public void testImportChange() {
919         for (String feedback : new String[] {&quot;verbose&quot;, &quot;normal&quot;}) {
920             test(
921                     (a) -&gt; assertCommandOutputContains(a, &quot;/set feedback &quot; + feedback, &quot;|  Feedback mode: &quot; + feedback),
922                     (a) -&gt; assertCommand(a, &quot;import java.util.*&quot;, &quot;&quot;),
923                     (a) -&gt; assertCommandOutputContains(a, &quot;var v1 = List.of(1);&quot;, &quot;v1 ==&gt; [1]&quot;),
924                     (a) -&gt; assertCommandOutputContains(a, &quot;import java.awt.List;&quot;,
925                             &quot;|    update replaced variable v1 which cannot be referenced until this error is corrected:&quot;),
926                     (a) -&gt; assertCommandOutputContains(a, &quot;var b = java.util.List.of(\&quot;bb\&quot;)&quot;,
927                             &quot;b ==&gt; [bb]&quot;),
928                     (a) -&gt; assertCommandOutputContains(a, &quot;b&quot;, &quot;b ==&gt; [bb]&quot;)
929             );
930         }
931     }
932 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>