<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/valhalla/valuetypes/ValueArray.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="SubstitutabilityTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>test/jdk/valhalla/valuetypes/ValueArray.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 32 import java.util.Arrays;
 33 
 34 import org.testng.annotations.BeforeTest;
 35 import org.testng.annotations.DataProvider;
 36 import org.testng.annotations.Test;
 37 import static org.testng.Assert.*;
 38 
 39 public class ValueArray {
 40     private final Class&lt;?&gt; arrayClass;
 41     private final Class&lt;?&gt; componentType;
 42     private final Object[] array;
 43     ValueArray(Class&lt;?&gt; arrayClass, Object[] array) {
 44         this.arrayClass = arrayClass;
 45         this.array = array;
 46         this.componentType = arrayClass.getComponentType();
 47         assertTrue(arrayClass.isArray());
 48         assertTrue(array.getClass() == arrayClass);
 49     }
 50 
 51     private static Class&lt;?&gt; nullablePointArrayClass() {
<span class="line-modified"> 52         Object a = new Point?[0];</span>
 53         return a.getClass();
 54     }
 55 
 56     void run() {
 57         testClassName();
 58         testArrayElements();
 59 
 60         if (componentType.isInlineClass()) {
 61             Object[] qArray = (Object[]) Array.newInstance(componentType.asPrimaryType(), 0);
 62             Object[] lArray = (Object[]) Array.newInstance(componentType.asIndirectType(), 0);
 63             testInlineArrayCovariance(componentType, qArray, lArray);
 64         }
 65     }
 66 
 67     void testClassName() {
 68         // test class names
 69         String arrayClassName = arrayClass.getName();
 70         StringBuilder sb = new StringBuilder();
 71         Class&lt;?&gt; c = arrayClass;
 72         while (c.isArray()) {
</pre>
<hr />
<pre>
136         try {
137             qArray.getClass().cast(lArray);
138             assertFalse(true, &quot;cast of Point? to Point should not succeed&quot;);
139         } catch (ClassCastException cce) { }
140     }
141 
142 
143     @DataProvider(name=&quot;arrayTypes&quot;)
144     static Object[][] arrayTypes() {
145         return new Object[][] {
146             new Object[] { Object[].class,
147                            new Object[] { new Object(), new Object()}},
148             new Object[] { Point[].class,
149                            new Point[] { Point.makePoint(1, 2),
150                                          Point.makePoint(10, 20),
151                                          Point.makePoint(100, 200)}},
152             new Object[] { Point[][].class,
153                            new Point[][] { new Point[] { Point.makePoint(1, 2),
154                                                          Point.makePoint(10, 20)}}},
155             new Object[] { nullablePointArrayClass(),
<span class="line-modified">156                            new Point?[] { Point.makePoint(11, 22),</span>
157                                           Point.makePoint(110, 220),
158                                           null }},
159             new Object[] { NonFlattenValue[].class,
160                            new NonFlattenValue[] { NonFlattenValue.make(1, 2),
161                                                    NonFlattenValue.make(10, 20),
162                                                    NonFlattenValue.make(100, 200)}},
163         };
164     }
165 
166     @Test(dataProvider=&quot;arrayTypes&quot;)
167     public static void test(Class&lt;?&gt; arrayClass, Object[] array) {
168         ValueArray test = new ValueArray(arrayClass, array);
169         test.run();
170     }
171 
172     @Test
173     public static void testIntArray() {
174         int[] array = new int[] { 1, 2, 3};
175         for (int i=0; i &lt; array.length; i++) {
176             Array.set(array, i, Integer.valueOf(i*10));
</pre>
<hr />
<pre>
184     }
185 
186     @Test
187     public static void testNonArrayObject() {
188         Object o = new Object();
189         try {
190             Array.get(o, 0);
191             throw new AssertionError(&quot;IAE not thrown&quot;);
192         } catch (IllegalArgumentException e) {}
193 
194         try {
195             Array.set(o, 0, o);
196             throw new AssertionError(&quot;IAE not thrown&quot;);
197         } catch (IllegalArgumentException e) {}
198 
199     }
200 
201     @Test
202     static void testPointArray() {
203         Point[] qArray = new Point[0];
<span class="line-modified">204         Point?[] lArray = new Point?[0];</span>
205 
206         ValueArray test = new ValueArray(Point[].class, qArray);
207         test.run();
208 
<span class="line-modified">209         ValueArray test1 = new ValueArray(Point?[].class, lArray);</span>
210         test.run();
211 
212         // language instanceof
213         assertTrue(qArray instanceof Point[]);
<span class="line-modified">214         assertTrue(lArray instanceof Point?[]);</span>
215     }
216 }
</pre>
</td>
<td>
<hr />
<pre>
 32 import java.util.Arrays;
 33 
 34 import org.testng.annotations.BeforeTest;
 35 import org.testng.annotations.DataProvider;
 36 import org.testng.annotations.Test;
 37 import static org.testng.Assert.*;
 38 
 39 public class ValueArray {
 40     private final Class&lt;?&gt; arrayClass;
 41     private final Class&lt;?&gt; componentType;
 42     private final Object[] array;
 43     ValueArray(Class&lt;?&gt; arrayClass, Object[] array) {
 44         this.arrayClass = arrayClass;
 45         this.array = array;
 46         this.componentType = arrayClass.getComponentType();
 47         assertTrue(arrayClass.isArray());
 48         assertTrue(array.getClass() == arrayClass);
 49     }
 50 
 51     private static Class&lt;?&gt; nullablePointArrayClass() {
<span class="line-modified"> 52         Object a = new Point.ref[0];</span>
 53         return a.getClass();
 54     }
 55 
 56     void run() {
 57         testClassName();
 58         testArrayElements();
 59 
 60         if (componentType.isInlineClass()) {
 61             Object[] qArray = (Object[]) Array.newInstance(componentType.asPrimaryType(), 0);
 62             Object[] lArray = (Object[]) Array.newInstance(componentType.asIndirectType(), 0);
 63             testInlineArrayCovariance(componentType, qArray, lArray);
 64         }
 65     }
 66 
 67     void testClassName() {
 68         // test class names
 69         String arrayClassName = arrayClass.getName();
 70         StringBuilder sb = new StringBuilder();
 71         Class&lt;?&gt; c = arrayClass;
 72         while (c.isArray()) {
</pre>
<hr />
<pre>
136         try {
137             qArray.getClass().cast(lArray);
138             assertFalse(true, &quot;cast of Point? to Point should not succeed&quot;);
139         } catch (ClassCastException cce) { }
140     }
141 
142 
143     @DataProvider(name=&quot;arrayTypes&quot;)
144     static Object[][] arrayTypes() {
145         return new Object[][] {
146             new Object[] { Object[].class,
147                            new Object[] { new Object(), new Object()}},
148             new Object[] { Point[].class,
149                            new Point[] { Point.makePoint(1, 2),
150                                          Point.makePoint(10, 20),
151                                          Point.makePoint(100, 200)}},
152             new Object[] { Point[][].class,
153                            new Point[][] { new Point[] { Point.makePoint(1, 2),
154                                                          Point.makePoint(10, 20)}}},
155             new Object[] { nullablePointArrayClass(),
<span class="line-modified">156                            new Point.ref[] { Point.makePoint(11, 22),</span>
157                                           Point.makePoint(110, 220),
158                                           null }},
159             new Object[] { NonFlattenValue[].class,
160                            new NonFlattenValue[] { NonFlattenValue.make(1, 2),
161                                                    NonFlattenValue.make(10, 20),
162                                                    NonFlattenValue.make(100, 200)}},
163         };
164     }
165 
166     @Test(dataProvider=&quot;arrayTypes&quot;)
167     public static void test(Class&lt;?&gt; arrayClass, Object[] array) {
168         ValueArray test = new ValueArray(arrayClass, array);
169         test.run();
170     }
171 
172     @Test
173     public static void testIntArray() {
174         int[] array = new int[] { 1, 2, 3};
175         for (int i=0; i &lt; array.length; i++) {
176             Array.set(array, i, Integer.valueOf(i*10));
</pre>
<hr />
<pre>
184     }
185 
186     @Test
187     public static void testNonArrayObject() {
188         Object o = new Object();
189         try {
190             Array.get(o, 0);
191             throw new AssertionError(&quot;IAE not thrown&quot;);
192         } catch (IllegalArgumentException e) {}
193 
194         try {
195             Array.set(o, 0, o);
196             throw new AssertionError(&quot;IAE not thrown&quot;);
197         } catch (IllegalArgumentException e) {}
198 
199     }
200 
201     @Test
202     static void testPointArray() {
203         Point[] qArray = new Point[0];
<span class="line-modified">204         Point.ref[] lArray = new Point.ref[0];</span>
205 
206         ValueArray test = new ValueArray(Point[].class, qArray);
207         test.run();
208 
<span class="line-modified">209         ValueArray test1 = new ValueArray(Point.ref[].class, lArray);</span>
210         test.run();
211 
212         // language instanceof
213         assertTrue(qArray instanceof Point[]);
<span class="line-modified">214         assertTrue(lArray instanceof Point.ref[]);</span>
215     }
216 }
</pre>
</td>
</tr>
</table>
<center><a href="SubstitutabilityTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>