<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/valhalla/valuetypes/Reflection.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="QTypeDescriptorTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="StreamTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/valhalla/valuetypes/Reflection.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 47         Point o = Point.makePoint(10, 20);
 48         Reflection test = new Reflection(Point.class, &quot;Point&quot;, o);
 49         test.newInstance();
 50         test.constructor();
 51         test.accessFieldX(o.x);
 52         test.staticField();
 53     }
 54 
 55     static void testLineClass() throws Exception {
 56         Line l = Line.makeLine(10, 20, 30, 40);
 57         Reflection test = new Reflection(Line.class, &quot;Line&quot;, l);
 58         test.checkField(&quot;public final Point Line.p1&quot;, &quot;p1&quot;, Point.class);
 59         test.checkField(&quot;public final Point Line.p2&quot;, &quot;p2&quot;, Point.class);
 60         test.checkMethod(&quot;public Point Line.p1()&quot;,           &quot;p1&quot;, Point.class);
 61         test.checkMethod(&quot;public Point Line.p2()&quot;,           &quot;p2&quot;, Point.class);
 62     }
 63 
 64     static void testNonFlattenValue() throws Exception {
 65         NonFlattenValue nfv = NonFlattenValue.make(10, 20);
 66         Reflection test = new Reflection(NonFlattenValue.class, &quot;NonFlattenValue&quot;, nfv);
<span class="line-modified"> 67         test.checkField(&quot;final Point? NonFlattenValue.nfp&quot;, &quot;nfp&quot;, Point.class.asIndirectType());</span>
 68         test.checkMethod(&quot;public Point NonFlattenValue.pointValue()&quot;, &quot;pointValue&quot;, Point.class);
<span class="line-modified"> 69         test.checkMethod(&quot;public Point? NonFlattenValue.point()&quot;, &quot;point&quot;, Point.class.asIndirectType());</span>
<span class="line-modified"> 70         test.checkMethod(&quot;public boolean NonFlattenValue.has(Point,Point?)&quot;, &quot;has&quot;, boolean.class, Point.class, Point.class.asIndirectType());</span>
 71     }
 72 
 73     /*
 74      * Tests reflection APIs with the primary type and indirect/nullable projection type
 75      */
 76     static void testMirrors() throws Exception {
 77         Class&lt;?&gt; primary = Point.class;
<span class="line-modified"> 78         Class&lt;?&gt; indirect = Point.class.asIndirectType();</span>
 79 
 80         assertEquals(primary, Point.class);
<span class="line-modified"> 81         assertEquals(indirect, Point.class.asNullableType());</span>
 82         assertTrue(primary.isInlineClass());
 83         assertFalse(primary.isIndirectType());
 84         assertFalse(primary.isNullableType());
 85 
<span class="line-modified"> 86         assertTrue(indirect.isInlineClass());</span>
 87         assertTrue(indirect.isIndirectType());
 88         assertTrue(indirect.isNullableType());
 89 
 90         Point o = Point.makePoint(10, 20);
 91         assertTrue(primary.isInstance(o));
 92         assertTrue(indirect.isInstance(o));
 93 
 94         // V &lt;: V? and V &lt;: Object
 95         assertTrue(indirect.isAssignableFrom(primary));
 96         assertTrue(Object.class.isAssignableFrom(primary));
 97         assertFalse(primary.isAssignableFrom(indirect));
 98         assertTrue(Object.class.isAssignableFrom(indirect));
 99 
100         assertEquals(primary, primary.asSubclass(indirect));
101         try {
102             Class&lt;?&gt; c = indirect.asSubclass(primary);
103             assertTrue(false);
104         } catch (ClassCastException e) { }
105 
106         // indirect class
107         assertEquals(Reflection.class.asPrimaryType(), Reflection.class);
108         assertEquals(Reflection.class.asIndirectType(), Reflection.class);
109         assertEquals(Reflection.class.asNullableType(), Reflection.class);
110         assertTrue(Reflection.class.isIndirectType());
111         assertTrue(Reflection.class.isNullableType());
112     }
113 
114     static void testClassName() {
115         assertEquals(Point.class.getName(), &quot;Point&quot;);
116         assertEquals(Point.class.asNullableType().getName(), &quot;Point&quot;);
117         assertEquals(Line.class.getName(), &quot;Line&quot;);
118         assertEquals((new Point[0]).getClass().getName(), &quot;[QPoint;&quot;);
<span class="line-modified">119         assertEquals((new Point?[0][0]).getClass().getName(), &quot;[[LPoint;&quot;);</span>
120     }
121 
122     private final Class&lt;?&gt; c;
123     private final Constructor&lt;?&gt; ctor;
124     private final Object o;
125     Reflection(Class&lt;?&gt; type, String cn, Object o) throws Exception {
126         this.c = Class.forName(cn);
127         if (!c.isInlineClass() || c != type) {
128             throw new RuntimeException(cn + &quot; is not an inline class&quot;);
129         }
130 
131         // V.class, Class.forName, and the type of the object return the primary mirror
132         assertEquals(type, o.getClass());
133         assertEquals(type, c.asPrimaryType());
134         assertEquals(c, c.asPrimaryType());
135 
136         this.ctor = c.getDeclaredConstructor();
137         this.o = o;
138 
139 
</pre>
</td>
<td>
<hr />
<pre>
 47         Point o = Point.makePoint(10, 20);
 48         Reflection test = new Reflection(Point.class, &quot;Point&quot;, o);
 49         test.newInstance();
 50         test.constructor();
 51         test.accessFieldX(o.x);
 52         test.staticField();
 53     }
 54 
 55     static void testLineClass() throws Exception {
 56         Line l = Line.makeLine(10, 20, 30, 40);
 57         Reflection test = new Reflection(Line.class, &quot;Line&quot;, l);
 58         test.checkField(&quot;public final Point Line.p1&quot;, &quot;p1&quot;, Point.class);
 59         test.checkField(&quot;public final Point Line.p2&quot;, &quot;p2&quot;, Point.class);
 60         test.checkMethod(&quot;public Point Line.p1()&quot;,           &quot;p1&quot;, Point.class);
 61         test.checkMethod(&quot;public Point Line.p2()&quot;,           &quot;p2&quot;, Point.class);
 62     }
 63 
 64     static void testNonFlattenValue() throws Exception {
 65         NonFlattenValue nfv = NonFlattenValue.make(10, 20);
 66         Reflection test = new Reflection(NonFlattenValue.class, &quot;NonFlattenValue&quot;, nfv);
<span class="line-modified"> 67         test.checkField(&quot;final Point$ref NonFlattenValue.nfp&quot;, &quot;nfp&quot;, Point.ref.class);</span>
 68         test.checkMethod(&quot;public Point NonFlattenValue.pointValue()&quot;, &quot;pointValue&quot;, Point.class);
<span class="line-modified"> 69         test.checkMethod(&quot;public Point$ref NonFlattenValue.point()&quot;, &quot;point&quot;, Point.ref.class);</span>
<span class="line-modified"> 70         test.checkMethod(&quot;public boolean NonFlattenValue.has(Point,Point$ref)&quot;, &quot;has&quot;, boolean.class, Point.class, Point.ref.class);</span>
 71     }
 72 
 73     /*
 74      * Tests reflection APIs with the primary type and indirect/nullable projection type
 75      */
 76     static void testMirrors() throws Exception {
 77         Class&lt;?&gt; primary = Point.class;
<span class="line-modified"> 78         Class&lt;?&gt; indirect = Point.ref.class;</span>
 79 
 80         assertEquals(primary, Point.class);
<span class="line-modified"> 81         assertEquals(indirect, Point.ref.class);</span>
 82         assertTrue(primary.isInlineClass());
 83         assertFalse(primary.isIndirectType());
 84         assertFalse(primary.isNullableType());
 85 
<span class="line-modified"> 86         assertTrue(!indirect.isInlineClass());</span>
 87         assertTrue(indirect.isIndirectType());
 88         assertTrue(indirect.isNullableType());
 89 
 90         Point o = Point.makePoint(10, 20);
 91         assertTrue(primary.isInstance(o));
 92         assertTrue(indirect.isInstance(o));
 93 
 94         // V &lt;: V? and V &lt;: Object
 95         assertTrue(indirect.isAssignableFrom(primary));
 96         assertTrue(Object.class.isAssignableFrom(primary));
 97         assertFalse(primary.isAssignableFrom(indirect));
 98         assertTrue(Object.class.isAssignableFrom(indirect));
 99 
100         assertEquals(primary, primary.asSubclass(indirect));
101         try {
102             Class&lt;?&gt; c = indirect.asSubclass(primary);
103             assertTrue(false);
104         } catch (ClassCastException e) { }
105 
106         // indirect class
107         assertEquals(Reflection.class.asPrimaryType(), Reflection.class);
108         assertEquals(Reflection.class.asIndirectType(), Reflection.class);
109         assertEquals(Reflection.class.asNullableType(), Reflection.class);
110         assertTrue(Reflection.class.isIndirectType());
111         assertTrue(Reflection.class.isNullableType());
112     }
113 
114     static void testClassName() {
115         assertEquals(Point.class.getName(), &quot;Point&quot;);
116         assertEquals(Point.class.asNullableType().getName(), &quot;Point&quot;);
117         assertEquals(Line.class.getName(), &quot;Line&quot;);
118         assertEquals((new Point[0]).getClass().getName(), &quot;[QPoint;&quot;);
<span class="line-modified">119         assertEquals((new Point.ref[0][0]).getClass().getName(), &quot;[[LPoint$ref;&quot;);</span>
120     }
121 
122     private final Class&lt;?&gt; c;
123     private final Constructor&lt;?&gt; ctor;
124     private final Object o;
125     Reflection(Class&lt;?&gt; type, String cn, Object o) throws Exception {
126         this.c = Class.forName(cn);
127         if (!c.isInlineClass() || c != type) {
128             throw new RuntimeException(cn + &quot; is not an inline class&quot;);
129         }
130 
131         // V.class, Class.forName, and the type of the object return the primary mirror
132         assertEquals(type, o.getClass());
133         assertEquals(type, c.asPrimaryType());
134         assertEquals(c, c.asPrimaryType());
135 
136         this.ctor = c.getDeclaredConstructor();
137         this.o = o;
138 
139 
</pre>
</td>
</tr>
</table>
<center><a href="QTypeDescriptorTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="StreamTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>