<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/jdk/internal/org/objectweb/asm/commons/AnalyzerAdapter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../Type.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="Method.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/jdk/internal/org/objectweb/asm/commons/AnalyzerAdapter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -145,21 +145,22 @@</span>
              final String owner,
              final int access,
              final String name,
              final String descriptor,
              final MethodVisitor methodVisitor) {
<span class="udiff-line-modified-removed">-         this(Opcodes.ASM7, owner, access, name, descriptor, methodVisitor);</span>
<span class="udiff-line-modified-added">+         this(/* latest api = */ Opcodes.ASM8, owner, access, name, descriptor, methodVisitor);</span>
          if (getClass() != AnalyzerAdapter.class) {
              throw new IllegalStateException();
          }
      }
  
      /**
        * Constructs a new {@link AnalyzerAdapter}.
        *
        * @param api the ASM API version implemented by this visitor. Must be one of {@link
<span class="udiff-line-modified-removed">-       *     Opcodes#ASM4}, {@link Opcodes#ASM5}, {@link Opcodes#ASM6} or {@link Opcodes#ASM7}.</span>
<span class="udiff-line-modified-added">+       *     Opcodes#ASM4}, {@link Opcodes#ASM5}, {@link Opcodes#ASM6}, {@link Opcodes#ASM7} or {@link</span>
<span class="udiff-line-added">+       *     Opcodes#ASM8}.</span>
        * @param owner the owner&#39;s class name.
        * @param access the method&#39;s access flags (see {@link Opcodes}).
        * @param name the method&#39;s name.
        * @param descriptor the method&#39;s descriptor (see {@link Type}).
        * @param methodVisitor the method visitor to which this adapter delegates calls. May be {@literal
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -172,13 +173,13 @@</span>
              final String name,
              final String descriptor,
              final MethodVisitor methodVisitor) {
          super(api, methodVisitor);
          this.owner = owner;
<span class="udiff-line-modified-removed">-         locals = new ArrayList&lt;Object&gt;();</span>
<span class="udiff-line-modified-removed">-         stack = new ArrayList&lt;Object&gt;();</span>
<span class="udiff-line-modified-removed">-         uninitializedTypes = new HashMap&lt;Object, Object&gt;();</span>
<span class="udiff-line-modified-added">+         locals = new ArrayList&lt;&gt;();</span>
<span class="udiff-line-modified-added">+         stack = new ArrayList&lt;&gt;();</span>
<span class="udiff-line-modified-added">+         uninitializedTypes = new HashMap&lt;&gt;();</span>
  
          if ((access &amp; Opcodes.ACC_STATIC) == 0) {
              if (&quot;&lt;init&gt;&quot;.equals(name)) {
                  locals.add(Opcodes.UNINITIALIZED_THIS);
              } else {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -234,12 +235,12 @@</span>
  
          if (this.locals != null) {
              this.locals.clear();
              this.stack.clear();
          } else {
<span class="udiff-line-modified-removed">-             this.locals = new ArrayList&lt;Object&gt;();</span>
<span class="udiff-line-modified-removed">-             this.stack = new ArrayList&lt;Object&gt;();</span>
<span class="udiff-line-modified-added">+             this.locals = new ArrayList&lt;&gt;();</span>
<span class="udiff-line-modified-added">+             this.stack = new ArrayList&lt;&gt;();</span>
          }
          visitFrameTypes(numLocal, local, this.locals);
          visitFrameTypes(numStack, stack, this.stack);
          maxLocals = Math.max(maxLocals, this.locals.size());
          maxStack = Math.max(maxStack, this.stack.size());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -287,11 +288,11 @@</span>
      @Override
      public void visitTypeInsn(final int opcode, final String type) {
          if (opcode == Opcodes.NEW) {
              if (labels == null) {
                  Label label = new Label();
<span class="udiff-line-modified-removed">-                 labels = new ArrayList&lt;Label&gt;(3);</span>
<span class="udiff-line-modified-added">+                 labels = new ArrayList&lt;&gt;(3);</span>
                  labels.add(label);
                  if (mv != null) {
                      mv.visitLabel(label);
                  }
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -308,49 +309,25 @@</span>
              final int opcode, final String owner, final String name, final String descriptor) {
          super.visitFieldInsn(opcode, owner, name, descriptor);
          execute(opcode, 0, descriptor);
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-       * Deprecated.</span>
<span class="udiff-line-removed">-       *</span>
<span class="udiff-line-removed">-       * @deprecated use {@link #visitMethodInsn(int, String, String, String, boolean)} instead.</span>
<span class="udiff-line-removed">-       */</span>
<span class="udiff-line-removed">-     @Deprecated</span>
      @Override
      public void visitMethodInsn(
<span class="udiff-line-modified-removed">-             final int opcode, final String owner, final String name, final String descriptor) {</span>
<span class="udiff-line-removed">-         if (api &gt;= Opcodes.ASM5) {</span>
<span class="udiff-line-removed">-             super.visitMethodInsn(opcode, owner, name, descriptor);</span>
<span class="udiff-line-removed">-             return;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         doVisitMethodInsn(opcode, owner, name, descriptor, opcode == Opcodes.INVOKEINTERFACE);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     @Override</span>
<span class="udiff-line-removed">-     public void visitMethodInsn(</span>
<span class="udiff-line-removed">-             final int opcode,</span>
<span class="udiff-line-modified-added">+             final int opcodeAndSource,</span>
              final String owner,
              final String name,
              final String descriptor,
              final boolean isInterface) {
<span class="udiff-line-modified-removed">-         if (api &lt; Opcodes.ASM5) {</span>
<span class="udiff-line-modified-removed">-             super.visitMethodInsn(opcode, owner, name, descriptor, isInterface);</span>
<span class="udiff-line-modified-added">+         if (api &lt; Opcodes.ASM5 &amp;&amp; (opcodeAndSource &amp; Opcodes.SOURCE_DEPRECATED) == 0) {</span>
<span class="udiff-line-modified-added">+             // Redirect the call to the deprecated version of this method.</span>
<span class="udiff-line-added">+             super.visitMethodInsn(opcodeAndSource, owner, name, descriptor, isInterface);</span>
              return;
          }
<span class="udiff-line-modified-removed">-         doVisitMethodInsn(opcode, owner, name, descriptor, isInterface);</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+         super.visitMethodInsn(opcodeAndSource, owner, name, descriptor, isInterface);</span>
<span class="udiff-line-modified-added">+         int opcode = opcodeAndSource &amp; ~Opcodes.SOURCE_MASK;</span>
  
<span class="udiff-line-removed">-     private void doVisitMethodInsn(</span>
<span class="udiff-line-removed">-             final int opcode,</span>
<span class="udiff-line-removed">-             final String owner,</span>
<span class="udiff-line-removed">-             final String name,</span>
<span class="udiff-line-removed">-             final String descriptor,</span>
<span class="udiff-line-removed">-             final boolean isInterface) {</span>
<span class="udiff-line-removed">-         if (mv != null) {</span>
<span class="udiff-line-removed">-             mv.visitMethodInsn(opcode, owner, name, descriptor, isInterface);</span>
<span class="udiff-line-removed">-         }</span>
          if (this.locals == null) {
              labels = null;
              return;
          }
          pop(descriptor);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -407,11 +384,11 @@</span>
  
      @Override
      public void visitLabel(final Label label) {
          super.visitLabel(label);
          if (labels == null) {
<span class="udiff-line-modified-removed">-             labels = new ArrayList&lt;Label&gt;(3);</span>
<span class="udiff-line-modified-added">+             labels = new ArrayList&lt;&gt;(3);</span>
          }
          labels.add(label);
      }
  
      @Override
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -524,13 +501,16 @@</span>
      private void push(final Object type) {
          stack.add(type);
          maxStack = Math.max(maxStack, stack.size());
      }
  
<span class="udiff-line-modified-removed">-     private void pushDescriptor(final String descriptor) {</span>
<span class="udiff-line-modified-removed">-         int index = descriptor.charAt(0) == &#39;(&#39; ? descriptor.indexOf(&#39;)&#39;) + 1 : 0;</span>
<span class="udiff-line-modified-removed">-         switch (descriptor.charAt(index)) {</span>
<span class="udiff-line-modified-added">+     private void pushDescriptor(final String fieldOrMethodDescriptor) {</span>
<span class="udiff-line-modified-added">+         String descriptor =</span>
<span class="udiff-line-modified-added">+                 fieldOrMethodDescriptor.charAt(0) == &#39;(&#39;</span>
<span class="udiff-line-added">+                         ? Type.getReturnType(fieldOrMethodDescriptor).getDescriptor()</span>
<span class="udiff-line-added">+                         : fieldOrMethodDescriptor;</span>
<span class="udiff-line-added">+         switch (descriptor.charAt(0)) {</span>
              case &#39;V&#39;:
                  return;
              case &#39;Z&#39;:
              case &#39;C&#39;:
              case &#39;B&#39;:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -548,23 +528,15 @@</span>
              case &#39;D&#39;:
                  push(Opcodes.DOUBLE);
                  push(Opcodes.TOP);
                  return;
              case &#39;[&#39;:
<span class="udiff-line-modified-removed">-                 if (index == 0) {</span>
<span class="udiff-line-removed">-                     push(descriptor);</span>
<span class="udiff-line-removed">-                 } else {</span>
<span class="udiff-line-removed">-                     push(descriptor.substring(index, descriptor.length()));</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-modified-added">+                 push(descriptor);</span>
                  break;
              case &#39;L&#39;:
<span class="udiff-line-modified-removed">-         // case &#39;Q&#39;:</span>
<span class="udiff-line-modified-removed">-                 if (index == 0) {</span>
<span class="udiff-line-removed">-                     push(descriptor.substring(1, descriptor.length() - 1));</span>
<span class="udiff-line-removed">-                 } else {</span>
<span class="udiff-line-removed">-                     push(descriptor.substring(index + 1, descriptor.length() - 1));</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-modified-added">+             case &#39;Q&#39;:</span>
<span class="udiff-line-modified-added">+                 push(descriptor.substring(1, descriptor.length() - 1));</span>
                  break;
              default:
                  throw new AssertionError();
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -596,10 +568,13 @@</span>
              pop(1);
          }
      }
  
      private void execute(final int opcode, final int intArg, final String stringArg) {
<span class="udiff-line-added">+         if (opcode == Opcodes.JSR || opcode == Opcodes.RET) {</span>
<span class="udiff-line-added">+             throw new IllegalArgumentException(&quot;JSR/RET are not supported&quot;);</span>
<span class="udiff-line-added">+         }</span>
          if (this.locals == null) {
              labels = null;
              return;
          }
          Object value1;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -896,13 +871,10 @@</span>
              case Opcodes.DCMPL:
              case Opcodes.DCMPG:
                  pop(4);
                  push(Opcodes.INTEGER);
                  break;
<span class="udiff-line-removed">-             case Opcodes.JSR:</span>
<span class="udiff-line-removed">-             case Opcodes.RET:</span>
<span class="udiff-line-removed">-                 throw new IllegalArgumentException(&quot;JSR/RET are not supported&quot;);</span>
              case Opcodes.GETSTATIC:
                  pushDescriptor(stringArg);
                  break;
              case Opcodes.PUTSTATIC:
                  pop(stringArg);
</pre>
<center><a href="../Type.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="Method.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>