<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/prims/unsafe.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="methodHandles.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="whitebox.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/prims/unsafe.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 970   if (cp_patches_h.not_null()) {
 971     int alen = cp_patches_h-&gt;length();
 972 
 973     for (int i = alen-1; i &gt;= 0; i--) {
 974       oop p = cp_patches_h-&gt;obj_at(i);
 975       if (p != NULL) {
 976         Handle patch(THREAD, p);
 977 
 978         if (cp_patches == NULL) {
 979           cp_patches = new GrowableArray&lt;Handle&gt;(i+1, i+1, Handle());
 980         }
 981 
 982         cp_patches-&gt;at_put(i, patch);
 983       }
 984     }
 985   }
 986 
 987   ClassFileStream st(class_bytes, class_bytes_length, host_source, ClassFileStream::verify);
 988 
 989   Symbol* no_class_name = NULL;









 990   Klass* anonk = SystemDictionary::parse_stream(no_class_name,
 991                                                 host_loader,
<span class="line-modified"> 992                                                 host_domain,</span>
<span class="line-removed"> 993                                                 &amp;st,</span>
<span class="line-removed"> 994                                                 InstanceKlass::cast(host_klass),</span>
 995                                                 cp_patches,
 996                                                 CHECK_NULL);
 997   if (anonk == NULL) {
 998     return NULL;
 999   }
1000 
1001   return InstanceKlass::cast(anonk);
1002 }
1003 
1004 UNSAFE_ENTRY(jclass, Unsafe_DefineAnonymousClass0(JNIEnv *env, jobject unsafe, jclass host_class, jbyteArray data, jobjectArray cp_patches_jh)) {
1005   ResourceMark rm(THREAD);
1006 
1007   jobject res_jh = NULL;
1008   u1* temp_alloc = NULL;
1009 
1010   InstanceKlass* anon_klass = Unsafe_DefineAnonymousClass_impl(env, host_class, data, cp_patches_jh, &amp;temp_alloc, THREAD);
1011   if (anon_klass != NULL) {
1012     res_jh = JNIHandles::make_local(env, anon_klass-&gt;java_mirror());
1013   }
1014 
</pre>
</td>
<td>
<hr />
<pre>
 970   if (cp_patches_h.not_null()) {
 971     int alen = cp_patches_h-&gt;length();
 972 
 973     for (int i = alen-1; i &gt;= 0; i--) {
 974       oop p = cp_patches_h-&gt;obj_at(i);
 975       if (p != NULL) {
 976         Handle patch(THREAD, p);
 977 
 978         if (cp_patches == NULL) {
 979           cp_patches = new GrowableArray&lt;Handle&gt;(i+1, i+1, Handle());
 980         }
 981 
 982         cp_patches-&gt;at_put(i, patch);
 983       }
 984     }
 985   }
 986 
 987   ClassFileStream st(class_bytes, class_bytes_length, host_source, ClassFileStream::verify);
 988 
 989   Symbol* no_class_name = NULL;
<span class="line-added"> 990   ClassLoadInfo cl_info(host_domain,</span>
<span class="line-added"> 991                         InstanceKlass::cast(host_klass),</span>
<span class="line-added"> 992                         cp_patches,</span>
<span class="line-added"> 993                         NULL,     // dynamic_nest_host</span>
<span class="line-added"> 994                         Handle(), // classData</span>
<span class="line-added"> 995                         false,    // is_hidden</span>
<span class="line-added"> 996                         false,    // is_strong_hidden</span>
<span class="line-added"> 997                         true);    // can_access_vm_annotations</span>
<span class="line-added"> 998 </span>
 999   Klass* anonk = SystemDictionary::parse_stream(no_class_name,
1000                                                 host_loader,
<span class="line-modified">1001                                                 &amp;st,</span>


1002                                                 cl_info,
1003                                                 CHECK_NULL);
1004   if (anonk == NULL) {
1005     return NULL;
1006   }
1007 
1008   return InstanceKlass::cast(anonk);
1009 }
1010 
1011 UNSAFE_ENTRY(jclass, Unsafe_DefineAnonymousClass0(JNIEnv *env, jobject unsafe, jclass host_class, jbyteArray data, jobjectArray cp_patches_jh)) {
1012   ResourceMark rm(THREAD);
1013 
1014   jobject res_jh = NULL;
1015   u1* temp_alloc = NULL;
1016 
1017   InstanceKlass* anon_klass = Unsafe_DefineAnonymousClass_impl(env, host_class, data, cp_patches_jh, &amp;temp_alloc, THREAD);
1018   if (anon_klass != NULL) {
1019     res_jh = JNIHandles::make_local(env, anon_klass-&gt;java_mirror());
1020   }
1021 
</pre>
</td>
</tr>
</table>
<center><a href="methodHandles.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="whitebox.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>