<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/prims/jvmtiRedefineClasses.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="jvmtiEnv.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="methodHandles.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/prims/jvmtiRedefineClasses.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -148,12 +148,12 @@</span>
        _res = JVMTI_ERROR_NULL_POINTER;
        return false;
      }
  
      oop mirror = JNIHandles::resolve_non_null(_class_defs[i].klass);
<span class="udiff-line-modified-removed">-     // classes for primitives and arrays and vm unsafe anonymous classes cannot be redefined</span>
<span class="udiff-line-modified-removed">-     // check here so following code can assume these classes are InstanceKlass</span>
<span class="udiff-line-modified-added">+     // classes for primitives, arrays, hidden and vm unsafe anonymous classes</span>
<span class="udiff-line-modified-added">+     // cannot be redefined.</span>
      if (!is_modifiable_class(mirror)) {
        _res = JVMTI_ERROR_UNMODIFIABLE_CLASS;
        return false;
      }
    }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -291,12 +291,13 @@</span>
    // classes for arrays cannot be redefined
    if (k == NULL || !k-&gt;is_instance_klass()) {
      return false;
    }
  
<span class="udiff-line-modified-removed">-   // Cannot redefine or retransform an unsafe anonymous class.</span>
<span class="udiff-line-modified-removed">-   if (InstanceKlass::cast(k)-&gt;is_unsafe_anonymous()) {</span>
<span class="udiff-line-modified-added">+   // Cannot redefine or retransform a hidden or an unsafe anonymous class.</span>
<span class="udiff-line-modified-added">+   if (InstanceKlass::cast(k)-&gt;is_hidden() ||</span>
<span class="udiff-line-added">+       InstanceKlass::cast(k)-&gt;is_unsafe_anonymous()) {</span>
      return false;
    }
    return true;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1236,14 +1237,15 @@</span>
      // Set redefined class handle in JvmtiThreadState class.
      // This redefined class is sent to agent event handler for class file
      // load hook event.
      state-&gt;set_class_being_redefined(the_class, _class_load_kind);
  
<span class="udiff-line-added">+     ClassLoadInfo cl_info(protection_domain);</span>
      InstanceKlass* scratch_class = SystemDictionary::parse_stream(
                                                        the_class_sym,
                                                        the_class_loader,
<span class="udiff-line-modified-removed">-                                                       protection_domain,</span>
<span class="udiff-line-modified-added">+                                                       &amp;st,</span>
                                                        cl_info,
                                                        THREAD);
      // Clear class_being_redefined just to be sure.
      state-&gt;clear_class_being_redefined();
  
</pre>
<center><a href="jvmtiEnv.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="methodHandles.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>