<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/classfile/systemDictionary.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="systemDictionary.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="verificationType.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/systemDictionary.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -32,10 +32,57 @@</span>
  #include &quot;runtime/mutexLocker.hpp&quot;
  #include &quot;runtime/reflectionUtils.hpp&quot;
  #include &quot;runtime/signature.hpp&quot;
  #include &quot;utilities/hashtable.hpp&quot;
  
<span class="udiff-line-added">+ class ClassInstanceInfo : public StackObj {</span>
<span class="udiff-line-added">+  private:</span>
<span class="udiff-line-added">+   InstanceKlass* _dynamic_nest_host;</span>
<span class="udiff-line-added">+   Handle _class_data;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+  public:</span>
<span class="udiff-line-added">+   ClassInstanceInfo() {</span>
<span class="udiff-line-added">+     _dynamic_nest_host = NULL;</span>
<span class="udiff-line-added">+     _class_data = Handle();</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   ClassInstanceInfo(InstanceKlass* dynamic_nest_host, Handle class_data) {</span>
<span class="udiff-line-added">+     _dynamic_nest_host = dynamic_nest_host;</span>
<span class="udiff-line-added">+     _class_data = class_data;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   InstanceKlass* dynamic_nest_host() const { return _dynamic_nest_host; }</span>
<span class="udiff-line-added">+   Handle class_data() const { return _class_data; }</span>
<span class="udiff-line-added">+   friend class ClassLoadInfo;</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ class ClassLoadInfo : public StackObj {</span>
<span class="udiff-line-added">+  private:</span>
<span class="udiff-line-added">+   Handle                 _protection_domain;</span>
<span class="udiff-line-added">+   const InstanceKlass*   _unsafe_anonymous_host;</span>
<span class="udiff-line-added">+   GrowableArray&lt;Handle&gt;* _cp_patches;</span>
<span class="udiff-line-added">+   ClassInstanceInfo      _class_hidden_info;</span>
<span class="udiff-line-added">+   bool                   _is_hidden;</span>
<span class="udiff-line-added">+   bool                   _is_strong_hidden;</span>
<span class="udiff-line-added">+   bool                   _can_access_vm_annotations;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+  public:</span>
<span class="udiff-line-added">+   ClassLoadInfo();</span>
<span class="udiff-line-added">+   ClassLoadInfo(Handle protection_domain);</span>
<span class="udiff-line-added">+   ClassLoadInfo(Handle protection_domain, const InstanceKlass* unsafe_anonymous_host,</span>
<span class="udiff-line-added">+                 GrowableArray&lt;Handle&gt;* cp_patches, InstanceKlass* dynamic_nest_host,</span>
<span class="udiff-line-added">+                 Handle class_data, bool is_hidden, bool is_strong_hidden,</span>
<span class="udiff-line-added">+                 bool can_access_vm_annotations);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   Handle protection_domain()             const { return _protection_domain; }</span>
<span class="udiff-line-added">+   const InstanceKlass* unsafe_anonymous_host() const { return _unsafe_anonymous_host; }</span>
<span class="udiff-line-added">+   GrowableArray&lt;Handle&gt;* cp_patches()    const { return _cp_patches; }</span>
<span class="udiff-line-added">+   const ClassInstanceInfo* class_hidden_info_ptr() const { return &amp;_class_hidden_info; }</span>
<span class="udiff-line-added">+   bool is_hidden()                       const { return _is_hidden; }</span>
<span class="udiff-line-added">+   bool is_strong_hidden()                const { return _is_strong_hidden; }</span>
<span class="udiff-line-added">+   bool can_access_vm_annotations()       const { return _can_access_vm_annotations; }</span>
<span class="udiff-line-added">+ };</span>
<span class="udiff-line-added">+ </span>
  // The dictionary in each ClassLoaderData stores all loaded classes, either
  // initiatied by its class loader or defined by its class loader:
  //
  //   class loader -&gt; ClassLoaderData -&gt; [class, protection domain set]
  //
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -279,31 +326,16 @@</span>
                                                    Handle class_loader,
                                                    Handle protection_domain,
                                                    bool throw_error,
                                                    TRAPS);
  
<span class="udiff-line-modified-removed">-   // Parse new stream. This won&#39;t update the dictionary or</span>
<span class="udiff-line-modified-removed">-   // class hierarchy, simply parse the stream. Used by JVMTI RedefineClasses.</span>
<span class="udiff-line-modified-removed">-   // Also used by Unsafe_DefineAnonymousClass</span>
<span class="udiff-line-removed">-   static InstanceKlass* parse_stream(Symbol* class_name,</span>
<span class="udiff-line-removed">-                                      Handle class_loader,</span>
<span class="udiff-line-removed">-                                      Handle protection_domain,</span>
<span class="udiff-line-removed">-                                      ClassFileStream* st,</span>
<span class="udiff-line-removed">-                                      TRAPS) {</span>
<span class="udiff-line-removed">-     return parse_stream(class_name,</span>
<span class="udiff-line-removed">-                         class_loader,</span>
<span class="udiff-line-removed">-                         protection_domain,</span>
<span class="udiff-line-removed">-                         st,</span>
<span class="udiff-line-removed">-                         NULL, // unsafe_anonymous_host</span>
<span class="udiff-line-removed">-                         NULL, // cp_patches</span>
<span class="udiff-line-removed">-                         THREAD);</span>
<span class="udiff-line-removed">-   }</span>
<span class="udiff-line-modified-added">+   // Parse new stream. This won&#39;t update the dictionary or class</span>
<span class="udiff-line-modified-added">+   // hierarchy, simply parse the stream. Used by JVMTI RedefineClasses</span>
<span class="udiff-line-modified-added">+   // and by Unsafe_DefineAnonymousClass and jvm_lookup_define_class.</span>
    static InstanceKlass* parse_stream(Symbol* class_name,
                                       Handle class_loader,
<span class="udiff-line-modified-removed">-                                      Handle protection_domain,</span>
<span class="udiff-line-removed">-                                      ClassFileStream* st,</span>
<span class="udiff-line-removed">-                                      const InstanceKlass* unsafe_anonymous_host,</span>
<span class="udiff-line-modified-added">+                                      ClassFileStream* st,</span>
                                       const ClassLoadInfo&amp; cl_info,
                                       TRAPS);
  
    // Resolve from stream (called by jni_DefineClass and JVM_DefineClass)
    static InstanceKlass* resolve_from_stream(Symbol* class_name,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -539,10 +571,15 @@</span>
    static void delete_resolution_error(ConstantPool* pool);
    static Symbol* find_resolution_error(const constantPoolHandle&amp; pool, int which,
                                         Symbol** message);
  
  
<span class="udiff-line-added">+   // Record a nest host resolution/validation error</span>
<span class="udiff-line-added">+   static void add_nest_host_error(const constantPoolHandle&amp; pool, int which,</span>
<span class="udiff-line-added">+                                   const char* message);</span>
<span class="udiff-line-added">+   static const char* find_nest_host_error(const constantPoolHandle&amp; pool, int which);</span>
<span class="udiff-line-added">+ </span>
    static ProtectionDomainCacheEntry* cache_get(Handle protection_domain);
  
   protected:
  
    enum Constants {
</pre>
<center><a href="systemDictionary.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="verificationType.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>