<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/oops/klass.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="instanceKlass.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="klass.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/oops/klass.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -606,11 +606,11 @@</span>
  
    // Only recreate it if not present.  A previous attempt to restore may have
    // gotten an OOM later but keep the mirror if it was created.
    if (java_mirror() == NULL) {
      log_trace(cds, mirror)(&quot;Recreate mirror for %s&quot;, external_name());
<span class="udiff-line-modified-removed">-     java_lang_Class::create_mirror(this, loader, module_handle, protection_domain, CHECK);</span>
<span class="udiff-line-modified-added">+     java_lang_Class::create_mirror(this, loader, module_handle, protection_domain, Handle(), CHECK);</span>
    }
  }
  
  #if INCLUDE_CDS_JAVA_HEAP
  // Used at CDS dump time to access the archived mirror. No GC barrier.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -670,10 +670,24 @@</span>
    } else if (length &lt; 0) {
      THROW_MSG(vmSymbols::java_lang_NegativeArraySizeException(), err_msg(&quot;%d&quot;, length));
    }
  }
  
<span class="udiff-line-added">+ // Replace the last &#39;+&#39; char with &#39;/&#39;.</span>
<span class="udiff-line-added">+ static char* convert_hidden_name_to_java(Symbol* name) {</span>
<span class="udiff-line-added">+   size_t name_len = name-&gt;utf8_length();</span>
<span class="udiff-line-added">+   char* result = NEW_RESOURCE_ARRAY(char, name_len + 1);</span>
<span class="udiff-line-added">+   name-&gt;as_klass_external_name(result, (int)name_len + 1);</span>
<span class="udiff-line-added">+   for (int index = (int)name_len; index &gt; 0; index--) {</span>
<span class="udiff-line-added">+     if (result[index] == &#39;+&#39;) {</span>
<span class="udiff-line-added">+       result[index] = JVM_SIGNATURE_SLASH;</span>
<span class="udiff-line-added">+       break;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   return result;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  // In product mode, this function doesn&#39;t have virtual function calls so
  // there might be some performance advantage to handling InstanceKlass here.
  const char* Klass::external_name() const {
    if (is_instance_klass()) {
      const InstanceKlass* ik = static_cast&lt;const InstanceKlass*&gt;(this);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -686,18 +700,37 @@</span>
        name()-&gt;as_klass_external_name(result, (int) name_len + 1);
        assert(strlen(result) == name_len, &quot;&quot;);
        strcpy(result + name_len, addr_buf);
        assert(strlen(result) == name_len + addr_len, &quot;&quot;);
        return result;
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     } else if (ik-&gt;is_hidden()) {</span>
<span class="udiff-line-added">+       char* result = convert_hidden_name_to_java(name());</span>
<span class="udiff-line-added">+       return result;</span>
      }
<span class="udiff-line-added">+   } else if (is_objArray_klass() &amp;&amp; ObjArrayKlass::cast(this)-&gt;bottom_klass()-&gt;is_hidden()) {</span>
<span class="udiff-line-added">+     char* result = convert_hidden_name_to_java(name());</span>
<span class="udiff-line-added">+     return result;</span>
    }
    if (name() == NULL)  return &quot;&lt;unknown&gt;&quot;;
    return name()-&gt;as_klass_external_name();
  }
  
  const char* Klass::signature_name() const {
    if (name() == NULL)  return &quot;&lt;unknown&gt;&quot;;
<span class="udiff-line-added">+   if (is_objArray_klass() &amp;&amp; ObjArrayKlass::cast(this)-&gt;bottom_klass()-&gt;is_hidden()) {</span>
<span class="udiff-line-added">+     size_t name_len = name()-&gt;utf8_length();</span>
<span class="udiff-line-added">+     char* result = NEW_RESOURCE_ARRAY(char, name_len + 1);</span>
<span class="udiff-line-added">+     name()-&gt;as_C_string(result, (int)name_len + 1);</span>
<span class="udiff-line-added">+     for (int index = (int)name_len; index &gt; 0; index--) {</span>
<span class="udiff-line-added">+       if (result[index] == &#39;+&#39;) {</span>
<span class="udiff-line-added">+         result[index] = JVM_SIGNATURE_DOT;</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return result;</span>
<span class="udiff-line-added">+   }</span>
    return name()-&gt;as_C_string();
  }
  
  const char* Klass::external_kind() const {
    if (is_interface()) return &quot;interface&quot;;
</pre>
<center><a href="instanceKlass.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="klass.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>