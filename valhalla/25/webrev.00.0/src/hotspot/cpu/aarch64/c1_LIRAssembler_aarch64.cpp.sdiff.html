<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/cpu/aarch64/c1_LIRAssembler_aarch64.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="aarch64.ad.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="frame_aarch64.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/aarch64/c1_LIRAssembler_aarch64.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 502     ciType* return_type = method-&gt;return_type();
 503     if (return_type-&gt;is_valuetype()) {
 504       ciValueKlass* vk = return_type-&gt;as_value_klass();
 505       if (vk-&gt;can_be_returned_as_fields()) {
 506         address unpack_handler = vk-&gt;unpack_handler();
 507         assert(unpack_handler != NULL, &quot;must be&quot;);
 508         __ far_call(RuntimeAddress(unpack_handler));
 509         // At this point, rax points to the value object (for interpreter or C1 caller).
 510         // The fields of the object are copied into registers (for C2 caller).
 511       }
 512     }
 513   }
 514 
 515   // Pop the stack before the safepoint code
 516   __ remove_frame(initial_frame_size_in_bytes(), needs_stack_repair());
 517 
 518   if (StackReservedPages &gt; 0 &amp;&amp; compilation()-&gt;has_reserved_stack_access()) {
 519     __ reserved_stack_check();
 520   }
 521 
<span class="line-modified"> 522   address polling_page(os::get_polling_page());</span>
<span class="line-removed"> 523   __ read_polling_page(rscratch1, polling_page, relocInfo::poll_return_type);</span>
 524   __ ret(lr);
 525 }
 526 
 527 int LIR_Assembler::store_value_type_fields_to_buf(ciValueKlass* vk) {
 528   return (__ store_value_type_fields_to_buf(vk, false));
 529 }
 530 
 531 int LIR_Assembler::safepoint_poll(LIR_Opr tmp, CodeEmitInfo* info) {
<span class="line-modified"> 532   address polling_page(os::get_polling_page());</span>
<span class="line-removed"> 533   guarantee(info != NULL, &quot;Shouldn&#39;t be NULL&quot;);</span>
<span class="line-removed"> 534   assert(os::is_poll_address(polling_page), &quot;should be&quot;);</span>
 535   __ get_polling_page(rscratch1, polling_page, relocInfo::poll_type);
 536   add_debug_info_for_branch(info);  // This isn&#39;t just debug info:
 537                                     // it&#39;s the oop map
 538   __ read_polling_page(rscratch1, relocInfo::poll_type);
 539   return __ offset();
 540 }
 541 
 542 
 543 void LIR_Assembler::move_regs(Register from_reg, Register to_reg) {
 544   if (from_reg == r31_sp)
 545     from_reg = sp;
 546   if (to_reg == r31_sp)
 547     to_reg = sp;
 548   __ mov(to_reg, from_reg);
 549 }
 550 
 551 void LIR_Assembler::swap_reg(Register a, Register b) { Unimplemented(); }
 552 
 553 
 554 void LIR_Assembler::const2reg(LIR_Opr src, LIR_Opr dest, LIR_PatchCode patch_code, CodeEmitInfo* info) {
</pre>
</td>
<td>
<hr />
<pre>
 502     ciType* return_type = method-&gt;return_type();
 503     if (return_type-&gt;is_valuetype()) {
 504       ciValueKlass* vk = return_type-&gt;as_value_klass();
 505       if (vk-&gt;can_be_returned_as_fields()) {
 506         address unpack_handler = vk-&gt;unpack_handler();
 507         assert(unpack_handler != NULL, &quot;must be&quot;);
 508         __ far_call(RuntimeAddress(unpack_handler));
 509         // At this point, rax points to the value object (for interpreter or C1 caller).
 510         // The fields of the object are copied into registers (for C2 caller).
 511       }
 512     }
 513   }
 514 
 515   // Pop the stack before the safepoint code
 516   __ remove_frame(initial_frame_size_in_bytes(), needs_stack_repair());
 517 
 518   if (StackReservedPages &gt; 0 &amp;&amp; compilation()-&gt;has_reserved_stack_access()) {
 519     __ reserved_stack_check();
 520   }
 521 
<span class="line-modified"> 522   __ fetch_and_read_polling_page(rscratch1, relocInfo::poll_return_type);</span>

 523   __ ret(lr);
 524 }
 525 
 526 int LIR_Assembler::store_value_type_fields_to_buf(ciValueKlass* vk) {
 527   return (__ store_value_type_fields_to_buf(vk, false));
 528 }
 529 
 530 int LIR_Assembler::safepoint_poll(LIR_Opr tmp, CodeEmitInfo* info) {
<span class="line-modified"> 531   guarantee(info != NULL, &quot;Shouldn&#39;t be NULL&quot;);</span>


 532   __ get_polling_page(rscratch1, relocInfo::poll_type);
 533   add_debug_info_for_branch(info);  // This isn&#39;t just debug info:
 534                                     // it&#39;s the oop map
 535   __ read_polling_page(rscratch1, relocInfo::poll_type);
 536   return __ offset();
 537 }
 538 
 539 
 540 void LIR_Assembler::move_regs(Register from_reg, Register to_reg) {
 541   if (from_reg == r31_sp)
 542     from_reg = sp;
 543   if (to_reg == r31_sp)
 544     to_reg = sp;
 545   __ mov(to_reg, from_reg);
 546 }
 547 
 548 void LIR_Assembler::swap_reg(Register a, Register b) { Unimplemented(); }
 549 
 550 
 551 void LIR_Assembler::const2reg(LIR_Opr src, LIR_Opr dest, LIR_PatchCode patch_code, CodeEmitInfo* info) {
</pre>
</td>
</tr>
</table>
<center><a href="aarch64.ad.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="frame_aarch64.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>