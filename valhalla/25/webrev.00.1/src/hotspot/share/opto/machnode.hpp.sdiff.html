<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/opto/machnode.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="machnode.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="macro.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/opto/machnode.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  34 
  35 class BiasedLockingCounters;
  36 class BufferBlob;
  37 class CodeBuffer;
  38 class JVMState;
  39 class MachCallDynamicJavaNode;
  40 class MachCallJavaNode;
  41 class MachCallLeafNode;
  42 class MachCallNode;
  43 class MachCallRuntimeNode;
  44 class MachCallStaticJavaNode;
  45 class MachEpilogNode;
  46 class MachIfNode;
  47 class MachNullCheckNode;
  48 class MachOper;
  49 class MachProjNode;
  50 class MachPrologNode;
  51 class MachReturnNode;
  52 class MachSafePointNode;
  53 class MachSpillCopyNode;

  54 class Matcher;
  55 class PhaseRegAlloc;
  56 class RegMask;
  57 class RTMLockingCounters;
  58 class State;
  59 
  60 //---------------------------MachOper------------------------------------------
  61 class MachOper : public ResourceObj {
  62 public:
  63   // Allocate right next to the MachNodes in the same arena
  64   void *operator new(size_t x) throw() {
  65     Compile* C = Compile::current();
  66     return C-&gt;node_arena()-&gt;Amalloc_D(x);
  67   }
  68 
  69   // Opcode
  70   virtual uint opcode() const = 0;
  71 
  72   // Number of input edges.
  73   // Generally at least 1
</pre>
<hr />
<pre>
 462     dump();
 463 #endif
 464     ShouldNotCallThis();
 465   }
 466 
 467   virtual const RegMask &amp;in_RegMask(uint idx) const {
 468     if (idx == mach_constant_base_node_input())
 469       return MachConstantBaseNode::static_out_RegMask();
 470     return MachNode::in_RegMask(idx);
 471   }
 472 
 473   // Input edge of MachConstantBaseNode.
 474   virtual uint mach_constant_base_node_input() const { return req() - 1; }
 475 
 476   int  constant_offset();
 477   int  constant_offset() const { return ((MachConstantNode*) this)-&gt;constant_offset(); }
 478   // Unchecked version to avoid assertions in debug output.
 479   int  constant_offset_unchecked() const;
 480 };
 481 






























 482 //------------------------------MachUEPNode-----------------------------------
 483 // Machine Unvalidated Entry Point Node
 484 class MachUEPNode : public MachIdealNode {
 485 public:
 486   MachUEPNode( ) {}
 487   virtual void emit(CodeBuffer &amp;cbuf, PhaseRegAlloc *ra_) const;
<span class="line-removed"> 488   virtual uint size(PhaseRegAlloc *ra_) const;</span>
 489 
 490 #ifndef PRODUCT
 491   virtual const char *Name() const { return &quot;Unvalidated-Entry-Point&quot;; }
 492   virtual void format( PhaseRegAlloc *, outputStream *st ) const;
 493 #endif
 494 };
 495 
 496 //------------------------------MachPrologNode--------------------------------
 497 // Machine function Prolog Node
 498 class MachPrologNode : public MachIdealNode {
 499 public:
<span class="line-modified"> 500   MachPrologNode( ) {}</span>








 501   virtual void emit(CodeBuffer &amp;cbuf, PhaseRegAlloc *ra_) const;
<span class="line-removed"> 502   virtual uint size(PhaseRegAlloc *ra_) const;</span>
 503   virtual int reloc() const;
 504 
 505 #ifndef PRODUCT
 506   virtual const char *Name() const { return &quot;Prolog&quot;; }
 507   virtual void format( PhaseRegAlloc *, outputStream *st ) const;
 508 #endif
 509 };
 510 
 511 //------------------------------MachEpilogNode--------------------------------
 512 // Machine function Epilog Node
 513 class MachEpilogNode : public MachIdealNode {
 514 public:
 515   MachEpilogNode(bool do_poll = false) : _do_polling(do_poll) {}
 516   virtual void emit(CodeBuffer &amp;cbuf, PhaseRegAlloc *ra_) const;
<span class="line-removed"> 517   virtual uint size(PhaseRegAlloc *ra_) const;</span>
 518   virtual int reloc() const;
 519   virtual const Pipeline *pipeline() const;
 520 
 521 private:
 522   bool _do_polling;
 523 
 524 public:
 525   bool do_polling() const { return _do_polling; }
 526 
 527 #ifndef PRODUCT
 528   virtual const char *Name() const { return &quot;Epilog&quot;; }
 529   virtual void format( PhaseRegAlloc *, outputStream *st ) const;
 530 #endif
 531 };
 532 
 533 //------------------------------MachNopNode-----------------------------------
 534 // Machine function Nop Node
 535 class MachNopNode : public MachIdealNode {
 536 private:
 537   int _count;
</pre>
<hr />
<pre>
 890   void set_tf(const TypeFunc* tf) { _tf = tf; }
 891   void set_entry_point(address p) { _entry_point = p; }
 892   void set_cnt(float c)           { _cnt = c; }
 893   void set_argsize(int s)         { _argsize = s; }
 894 
 895   MachCallNode() : MachSafePointNode() {
 896     init_class_id(Class_MachCall);
 897   }
 898 
 899   virtual const Type *bottom_type() const;
 900   virtual bool  pinned() const { return false; }
 901   virtual const Type* Value(PhaseGVN* phase) const;
 902   virtual const RegMask &amp;in_RegMask(uint) const;
 903   virtual int ret_addr_offset() { return 0; }
 904 
 905   bool returns_long() const { return tf()-&gt;return_type() == T_LONG; }
 906   bool return_value_is_used() const;
 907 
 908   // Similar to cousin class CallNode::returns_pointer
 909   bool returns_pointer() const;

 910 
 911 #ifndef PRODUCT
 912   virtual void dump_spec(outputStream *st) const;
 913 #endif
 914 };
 915 
 916 //------------------------------MachCallJavaNode------------------------------
 917 // &quot;Base&quot; class for machine-specific versions of subroutine calls
 918 class MachCallJavaNode : public MachCallNode {
 919 protected:
 920   virtual bool cmp( const Node &amp;n ) const;
 921   virtual uint size_of() const; // Size is bigger
 922 public:
 923   ciMethod* _method;                 // Method being direct called
 924   bool      _override_symbolic_info; // Override symbolic call site info from bytecode
 925   int       _bci;                    // Byte Code index of call byte code
 926   bool      _optimized_virtual;      // Tells if node is a static call or an optimized virtual
 927   bool      _method_handle_invoke;   // Tells if the call has to preserve SP
 928   MachCallJavaNode() : MachCallNode(), _override_symbolic_info(false) {
 929     init_class_id(Class_MachCallJava);
</pre>
</td>
<td>
<hr />
<pre>
  34 
  35 class BiasedLockingCounters;
  36 class BufferBlob;
  37 class CodeBuffer;
  38 class JVMState;
  39 class MachCallDynamicJavaNode;
  40 class MachCallJavaNode;
  41 class MachCallLeafNode;
  42 class MachCallNode;
  43 class MachCallRuntimeNode;
  44 class MachCallStaticJavaNode;
  45 class MachEpilogNode;
  46 class MachIfNode;
  47 class MachNullCheckNode;
  48 class MachOper;
  49 class MachProjNode;
  50 class MachPrologNode;
  51 class MachReturnNode;
  52 class MachSafePointNode;
  53 class MachSpillCopyNode;
<span class="line-added">  54 class MachVEPNode;</span>
  55 class Matcher;
  56 class PhaseRegAlloc;
  57 class RegMask;
  58 class RTMLockingCounters;
  59 class State;
  60 
  61 //---------------------------MachOper------------------------------------------
  62 class MachOper : public ResourceObj {
  63 public:
  64   // Allocate right next to the MachNodes in the same arena
  65   void *operator new(size_t x) throw() {
  66     Compile* C = Compile::current();
  67     return C-&gt;node_arena()-&gt;Amalloc_D(x);
  68   }
  69 
  70   // Opcode
  71   virtual uint opcode() const = 0;
  72 
  73   // Number of input edges.
  74   // Generally at least 1
</pre>
<hr />
<pre>
 463     dump();
 464 #endif
 465     ShouldNotCallThis();
 466   }
 467 
 468   virtual const RegMask &amp;in_RegMask(uint idx) const {
 469     if (idx == mach_constant_base_node_input())
 470       return MachConstantBaseNode::static_out_RegMask();
 471     return MachNode::in_RegMask(idx);
 472   }
 473 
 474   // Input edge of MachConstantBaseNode.
 475   virtual uint mach_constant_base_node_input() const { return req() - 1; }
 476 
 477   int  constant_offset();
 478   int  constant_offset() const { return ((MachConstantNode*) this)-&gt;constant_offset(); }
 479   // Unchecked version to avoid assertions in debug output.
 480   int  constant_offset_unchecked() const;
 481 };
 482 
<span class="line-added"> 483 //------------------------------MachVEPNode-----------------------------------</span>
<span class="line-added"> 484 // Machine Value Type Entry Point Node</span>
<span class="line-added"> 485 class MachVEPNode : public MachIdealNode {</span>
<span class="line-added"> 486 public:</span>
<span class="line-added"> 487   Label* _verified_entry;</span>
<span class="line-added"> 488 </span>
<span class="line-added"> 489   MachVEPNode(Label* verified_entry, bool verified, bool receiver_only) :</span>
<span class="line-added"> 490     _verified_entry(verified_entry),</span>
<span class="line-added"> 491     _verified(verified),</span>
<span class="line-added"> 492     _receiver_only(receiver_only) {</span>
<span class="line-added"> 493     init_class_id(Class_MachVEP);</span>
<span class="line-added"> 494   }</span>
<span class="line-added"> 495   virtual bool cmp(const Node &amp;n) const {</span>
<span class="line-added"> 496     return (_verified_entry == ((MachVEPNode&amp;)n)._verified_entry) &amp;&amp;</span>
<span class="line-added"> 497            (_verified == ((MachVEPNode&amp;)n)._verified) &amp;&amp;</span>
<span class="line-added"> 498            (_receiver_only == ((MachVEPNode&amp;)n)._receiver_only) &amp;&amp;</span>
<span class="line-added"> 499            MachIdealNode::cmp(n);</span>
<span class="line-added"> 500   }</span>
<span class="line-added"> 501   virtual uint size_of() const { return sizeof(*this); }</span>
<span class="line-added"> 502   virtual void emit(CodeBuffer&amp; cbuf, PhaseRegAlloc* ra_) const;</span>
<span class="line-added"> 503 </span>
<span class="line-added"> 504 #ifndef PRODUCT</span>
<span class="line-added"> 505   virtual const char* Name() const { return &quot;ValueType Entry-Point&quot;; }</span>
<span class="line-added"> 506   virtual void format(PhaseRegAlloc*, outputStream* st) const;</span>
<span class="line-added"> 507 #endif</span>
<span class="line-added"> 508 private:</span>
<span class="line-added"> 509   bool   _verified;</span>
<span class="line-added"> 510   bool   _receiver_only;</span>
<span class="line-added"> 511 };</span>
<span class="line-added"> 512 </span>
 513 //------------------------------MachUEPNode-----------------------------------
 514 // Machine Unvalidated Entry Point Node
 515 class MachUEPNode : public MachIdealNode {
 516 public:
 517   MachUEPNode( ) {}
 518   virtual void emit(CodeBuffer &amp;cbuf, PhaseRegAlloc *ra_) const;

 519 
 520 #ifndef PRODUCT
 521   virtual const char *Name() const { return &quot;Unvalidated-Entry-Point&quot;; }
 522   virtual void format( PhaseRegAlloc *, outputStream *st ) const;
 523 #endif
 524 };
 525 
 526 //------------------------------MachPrologNode--------------------------------
 527 // Machine function Prolog Node
 528 class MachPrologNode : public MachIdealNode {
 529 public:
<span class="line-modified"> 530   Label* _verified_entry;</span>
<span class="line-added"> 531 </span>
<span class="line-added"> 532   MachPrologNode(Label* verified_entry) : _verified_entry(verified_entry) {</span>
<span class="line-added"> 533     init_class_id(Class_MachProlog);</span>
<span class="line-added"> 534   }</span>
<span class="line-added"> 535   virtual bool cmp(const Node &amp;n) const {</span>
<span class="line-added"> 536     return (_verified_entry == ((MachPrologNode&amp;)n)._verified_entry) &amp;&amp; MachIdealNode::cmp(n);</span>
<span class="line-added"> 537   }</span>
<span class="line-added"> 538   virtual uint size_of() const { return sizeof(*this); }</span>
 539   virtual void emit(CodeBuffer &amp;cbuf, PhaseRegAlloc *ra_) const;

 540   virtual int reloc() const;
 541 
 542 #ifndef PRODUCT
 543   virtual const char *Name() const { return &quot;Prolog&quot;; }
 544   virtual void format( PhaseRegAlloc *, outputStream *st ) const;
 545 #endif
 546 };
 547 
 548 //------------------------------MachEpilogNode--------------------------------
 549 // Machine function Epilog Node
 550 class MachEpilogNode : public MachIdealNode {
 551 public:
 552   MachEpilogNode(bool do_poll = false) : _do_polling(do_poll) {}
 553   virtual void emit(CodeBuffer &amp;cbuf, PhaseRegAlloc *ra_) const;

 554   virtual int reloc() const;
 555   virtual const Pipeline *pipeline() const;
 556 
 557 private:
 558   bool _do_polling;
 559 
 560 public:
 561   bool do_polling() const { return _do_polling; }
 562 
 563 #ifndef PRODUCT
 564   virtual const char *Name() const { return &quot;Epilog&quot;; }
 565   virtual void format( PhaseRegAlloc *, outputStream *st ) const;
 566 #endif
 567 };
 568 
 569 //------------------------------MachNopNode-----------------------------------
 570 // Machine function Nop Node
 571 class MachNopNode : public MachIdealNode {
 572 private:
 573   int _count;
</pre>
<hr />
<pre>
 926   void set_tf(const TypeFunc* tf) { _tf = tf; }
 927   void set_entry_point(address p) { _entry_point = p; }
 928   void set_cnt(float c)           { _cnt = c; }
 929   void set_argsize(int s)         { _argsize = s; }
 930 
 931   MachCallNode() : MachSafePointNode() {
 932     init_class_id(Class_MachCall);
 933   }
 934 
 935   virtual const Type *bottom_type() const;
 936   virtual bool  pinned() const { return false; }
 937   virtual const Type* Value(PhaseGVN* phase) const;
 938   virtual const RegMask &amp;in_RegMask(uint) const;
 939   virtual int ret_addr_offset() { return 0; }
 940 
 941   bool returns_long() const { return tf()-&gt;return_type() == T_LONG; }
 942   bool return_value_is_used() const;
 943 
 944   // Similar to cousin class CallNode::returns_pointer
 945   bool returns_pointer() const;
<span class="line-added"> 946   bool returns_vt() const;</span>
 947 
 948 #ifndef PRODUCT
 949   virtual void dump_spec(outputStream *st) const;
 950 #endif
 951 };
 952 
 953 //------------------------------MachCallJavaNode------------------------------
 954 // &quot;Base&quot; class for machine-specific versions of subroutine calls
 955 class MachCallJavaNode : public MachCallNode {
 956 protected:
 957   virtual bool cmp( const Node &amp;n ) const;
 958   virtual uint size_of() const; // Size is bigger
 959 public:
 960   ciMethod* _method;                 // Method being direct called
 961   bool      _override_symbolic_info; // Override symbolic call site info from bytecode
 962   int       _bci;                    // Byte Code index of call byte code
 963   bool      _optimized_virtual;      // Tells if node is a static call or an optimized virtual
 964   bool      _method_handle_invoke;   // Tells if the call has to preserve SP
 965   MachCallJavaNode() : MachCallNode(), _override_symbolic_info(false) {
 966     init_class_id(Class_MachCallJava);
</pre>
</td>
</tr>
</table>
<center><a href="machnode.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="macro.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>