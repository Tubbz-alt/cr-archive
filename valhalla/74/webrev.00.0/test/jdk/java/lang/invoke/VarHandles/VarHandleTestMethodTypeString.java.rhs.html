<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/lang/invoke/VarHandles/VarHandleTestMethodTypeString.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
<a name="1" id="anc1"></a><span class="line-modified">   2  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 // -- This file was mechanically generated: Do not edit! -- //
  25 
  26 /*
  27  * @test
  28  * @bug 8156486
  29  * @run testng/othervm VarHandleTestMethodTypeString
<a name="2" id="anc2"></a><span class="line-modified">  30  * @run testng/othervm -Djava.lang.invoke.VarHandle.VAR_HANDLE_GUARDS=true -Djava.lang.invoke.VarHandle.VAR_HANDLE_IDENTITY_ADAPT=true VarHandleTestMethodTypeString</span>
<span class="line-added">  31  * @run testng/othervm -Djava.lang.invoke.VarHandle.VAR_HANDLE_GUARDS=false -Djava.lang.invoke.VarHandle.VAR_HANDLE_IDENTITY_ADAPT=false VarHandleTestMethodTypeString</span>
<span class="line-added">  32  * @run testng/othervm -Djava.lang.invoke.VarHandle.VAR_HANDLE_GUARDS=false -Djava.lang.invoke.VarHandle.VAR_HANDLE_IDENTITY_ADAPT=true VarHandleTestMethodTypeString</span>
  33  */
  34 
  35 import org.testng.annotations.BeforeClass;
  36 import org.testng.annotations.DataProvider;
  37 import org.testng.annotations.Test;
  38 
  39 import java.lang.invoke.MethodHandles;
  40 import java.lang.invoke.VarHandle;
  41 import java.util.ArrayList;
  42 import java.util.Arrays;
  43 import java.util.List;
  44 
  45 import static org.testng.Assert.*;
  46 
  47 import static java.lang.invoke.MethodType.*;
  48 
  49 public class VarHandleTestMethodTypeString extends VarHandleBaseTest {
  50     static final String static_final_v = &quot;foo&quot;;
  51 
  52     static String static_v = &quot;foo&quot;;
  53 
  54     final String final_v = &quot;foo&quot;;
  55 
  56     String v = &quot;foo&quot;;
  57 
  58     VarHandle vhFinalField;
  59 
  60     VarHandle vhField;
  61 
  62     VarHandle vhStaticField;
  63 
  64     VarHandle vhStaticFinalField;
  65 
  66     VarHandle vhArray;
  67 
  68     @BeforeClass
  69     public void setup() throws Exception {
  70         vhFinalField = MethodHandles.lookup().findVarHandle(
  71                 VarHandleTestMethodTypeString.class, &quot;final_v&quot;, String.class);
  72 
  73         vhField = MethodHandles.lookup().findVarHandle(
  74                 VarHandleTestMethodTypeString.class, &quot;v&quot;, String.class);
  75 
  76         vhStaticFinalField = MethodHandles.lookup().findStaticVarHandle(
  77             VarHandleTestMethodTypeString.class, &quot;static_final_v&quot;, String.class);
  78 
  79         vhStaticField = MethodHandles.lookup().findStaticVarHandle(
  80             VarHandleTestMethodTypeString.class, &quot;static_v&quot;, String.class);
  81 
  82         vhArray = MethodHandles.arrayElementVarHandle(String[].class);
  83     }
  84 
  85     @DataProvider
  86     public Object[][] accessTestCaseProvider() throws Exception {
  87         List&lt;AccessTestCase&lt;?&gt;&gt; cases = new ArrayList&lt;&gt;();
  88 
  89         cases.add(new VarHandleAccessTestCase(&quot;Instance field&quot;,
  90                                               vhField, vh -&gt; testInstanceFieldWrongMethodType(this, vh),
  91                                               false));
  92 
  93         cases.add(new VarHandleAccessTestCase(&quot;Static field&quot;,
  94                                               vhStaticField, VarHandleTestMethodTypeString::testStaticFieldWrongMethodType,
  95                                               false));
  96 
  97         cases.add(new VarHandleAccessTestCase(&quot;Array&quot;,
  98                                               vhArray, VarHandleTestMethodTypeString::testArrayWrongMethodType,
  99                                               false));
 100 
 101         for (VarHandleToMethodHandle f : VarHandleToMethodHandle.values()) {
 102             cases.add(new MethodHandleAccessTestCase(&quot;Instance field&quot;,
 103                                                      vhField, f, hs -&gt; testInstanceFieldWrongMethodType(this, hs),
 104                                                      false));
 105 
 106             cases.add(new MethodHandleAccessTestCase(&quot;Static field&quot;,
 107                                                      vhStaticField, f, VarHandleTestMethodTypeString::testStaticFieldWrongMethodType,
 108                                                      false));
 109 
 110             cases.add(new MethodHandleAccessTestCase(&quot;Array&quot;,
 111                                                      vhArray, f, VarHandleTestMethodTypeString::testArrayWrongMethodType,
 112                                                      false));
 113         }
 114         // Work around issue with jtreg summary reporting which truncates
 115         // the String result of Object.toString to 30 characters, hence
 116         // the first dummy argument
 117         return cases.stream().map(tc -&gt; new Object[]{tc.toString(), tc}).toArray(Object[][]::new);
 118     }
 119 
 120     @Test(dataProvider = &quot;accessTestCaseProvider&quot;)
 121     public &lt;T&gt; void testAccess(String desc, AccessTestCase&lt;T&gt; atc) throws Throwable {
 122         T t = atc.get();
 123         int iters = atc.requiresLoop() ? ITERS : 1;
 124         for (int c = 0; c &lt; iters; c++) {
 125             atc.testAccess(t);
 126         }
 127     }
 128 
 129 
 130     static void testInstanceFieldWrongMethodType(VarHandleTestMethodTypeString recv, VarHandle vh) throws Throwable {
 131         // Get
 132         // Incorrect argument types
 133         checkNPE(() -&gt; { // null receiver
 134             String x = (String) vh.get(null);
 135         });
 136         checkCCE(() -&gt; { // receiver reference class
 137             String x = (String) vh.get(Void.class);
 138         });
 139         checkWMTE(() -&gt; { // receiver primitive class
 140             String x = (String) vh.get(0);
 141         });
 142         // Incorrect return type
 143         checkCCE(() -&gt; { // reference class
 144             Void x = (Void) vh.get(recv);
 145         });
 146         checkWMTE(() -&gt; { // primitive class
 147             boolean x = (boolean) vh.get(recv);
 148         });
 149         // Incorrect arity
 150         checkWMTE(() -&gt; { // 0
 151             String x = (String) vh.get();
 152         });
 153         checkWMTE(() -&gt; { // &gt;
 154             String x = (String) vh.get(recv, Void.class);
 155         });
 156 
 157 
 158         // Set
 159         // Incorrect argument types
 160         checkNPE(() -&gt; { // null receiver
 161             vh.set(null, &quot;foo&quot;);
 162         });
 163         checkCCE(() -&gt; { // receiver reference class
 164             vh.set(Void.class, &quot;foo&quot;);
 165         });
 166         checkCCE(() -&gt; { // value reference class
 167             vh.set(recv, Void.class);
 168         });
 169         checkWMTE(() -&gt; { // receiver primitive class
 170             vh.set(0, &quot;foo&quot;);
 171         });
 172         // Incorrect arity
 173         checkWMTE(() -&gt; { // 0
 174             vh.set();
 175         });
 176         checkWMTE(() -&gt; { // &gt;
 177             vh.set(recv, &quot;foo&quot;, Void.class);
 178         });
 179 
 180 
 181         // GetVolatile
 182         // Incorrect argument types
 183         checkNPE(() -&gt; { // null receiver
 184             String x = (String) vh.getVolatile(null);
 185         });
 186         checkCCE(() -&gt; { // receiver reference class
 187             String x = (String) vh.getVolatile(Void.class);
 188         });
 189         checkWMTE(() -&gt; { // receiver primitive class
 190             String x = (String) vh.getVolatile(0);
 191         });
 192         // Incorrect return type
 193         checkCCE(() -&gt; { // reference class
 194             Void x = (Void) vh.getVolatile(recv);
 195         });
 196         checkWMTE(() -&gt; { // primitive class
 197             boolean x = (boolean) vh.getVolatile(recv);
 198         });
 199         // Incorrect arity
 200         checkWMTE(() -&gt; { // 0
 201             String x = (String) vh.getVolatile();
 202         });
 203         checkWMTE(() -&gt; { // &gt;
 204             String x = (String) vh.getVolatile(recv, Void.class);
 205         });
 206 
 207 
 208         // SetVolatile
 209         // Incorrect argument types
 210         checkNPE(() -&gt; { // null receiver
 211             vh.setVolatile(null, &quot;foo&quot;);
 212         });
 213         checkCCE(() -&gt; { // receiver reference class
 214             vh.setVolatile(Void.class, &quot;foo&quot;);
 215         });
 216         checkCCE(() -&gt; { // value reference class
 217             vh.setVolatile(recv, Void.class);
 218         });
 219         checkWMTE(() -&gt; { // receiver primitive class
 220             vh.setVolatile(0, &quot;foo&quot;);
 221         });
 222         // Incorrect arity
 223         checkWMTE(() -&gt; { // 0
 224             vh.setVolatile();
 225         });
 226         checkWMTE(() -&gt; { // &gt;
 227             vh.setVolatile(recv, &quot;foo&quot;, Void.class);
 228         });
 229 
 230 
 231         // GetOpaque
 232         // Incorrect argument types
 233         checkNPE(() -&gt; { // null receiver
 234             String x = (String) vh.getOpaque(null);
 235         });
 236         checkCCE(() -&gt; { // receiver reference class
 237             String x = (String) vh.getOpaque(Void.class);
 238         });
 239         checkWMTE(() -&gt; { // receiver primitive class
 240             String x = (String) vh.getOpaque(0);
 241         });
 242         // Incorrect return type
 243         checkCCE(() -&gt; { // reference class
 244             Void x = (Void) vh.getOpaque(recv);
 245         });
 246         checkWMTE(() -&gt; { // primitive class
 247             boolean x = (boolean) vh.getOpaque(recv);
 248         });
 249         // Incorrect arity
 250         checkWMTE(() -&gt; { // 0
 251             String x = (String) vh.getOpaque();
 252         });
 253         checkWMTE(() -&gt; { // &gt;
 254             String x = (String) vh.getOpaque(recv, Void.class);
 255         });
 256 
 257 
 258         // SetOpaque
 259         // Incorrect argument types
 260         checkNPE(() -&gt; { // null receiver
 261             vh.setOpaque(null, &quot;foo&quot;);
 262         });
 263         checkCCE(() -&gt; { // receiver reference class
 264             vh.setOpaque(Void.class, &quot;foo&quot;);
 265         });
 266         checkCCE(() -&gt; { // value reference class
 267             vh.setOpaque(recv, Void.class);
 268         });
 269         checkWMTE(() -&gt; { // receiver primitive class
 270             vh.setOpaque(0, &quot;foo&quot;);
 271         });
 272         // Incorrect arity
 273         checkWMTE(() -&gt; { // 0
 274             vh.setOpaque();
 275         });
 276         checkWMTE(() -&gt; { // &gt;
 277             vh.setOpaque(recv, &quot;foo&quot;, Void.class);
 278         });
 279 
 280 
 281         // GetAcquire
 282         // Incorrect argument types
 283         checkNPE(() -&gt; { // null receiver
 284             String x = (String) vh.getAcquire(null);
 285         });
 286         checkCCE(() -&gt; { // receiver reference class
 287             String x = (String) vh.getAcquire(Void.class);
 288         });
 289         checkWMTE(() -&gt; { // receiver primitive class
 290             String x = (String) vh.getAcquire(0);
 291         });
 292         // Incorrect return type
 293         checkCCE(() -&gt; { // reference class
 294             Void x = (Void) vh.getAcquire(recv);
 295         });
 296         checkWMTE(() -&gt; { // primitive class
 297             boolean x = (boolean) vh.getAcquire(recv);
 298         });
 299         // Incorrect arity
 300         checkWMTE(() -&gt; { // 0
 301             String x = (String) vh.getAcquire();
 302         });
 303         checkWMTE(() -&gt; { // &gt;
 304             String x = (String) vh.getAcquire(recv, Void.class);
 305         });
 306 
 307 
 308         // SetRelease
 309         // Incorrect argument types
 310         checkNPE(() -&gt; { // null receiver
 311             vh.setRelease(null, &quot;foo&quot;);
 312         });
 313         checkCCE(() -&gt; { // receiver reference class
 314             vh.setRelease(Void.class, &quot;foo&quot;);
 315         });
 316         checkCCE(() -&gt; { // value reference class
 317             vh.setRelease(recv, Void.class);
 318         });
 319         checkWMTE(() -&gt; { // receiver primitive class
 320             vh.setRelease(0, &quot;foo&quot;);
 321         });
 322         // Incorrect arity
 323         checkWMTE(() -&gt; { // 0
 324             vh.setRelease();
 325         });
 326         checkWMTE(() -&gt; { // &gt;
 327             vh.setRelease(recv, &quot;foo&quot;, Void.class);
 328         });
 329 
 330 
 331         // CompareAndSet
 332         // Incorrect argument types
 333         checkNPE(() -&gt; { // null receiver
 334             boolean r = vh.compareAndSet(null, &quot;foo&quot;, &quot;foo&quot;);
 335         });
 336         checkCCE(() -&gt; { // receiver reference class
 337             boolean r = vh.compareAndSet(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 338         });
 339         checkCCE(() -&gt; { // expected reference class
 340             boolean r = vh.compareAndSet(recv, Void.class, &quot;foo&quot;);
 341         });
 342         checkCCE(() -&gt; { // actual reference class
 343             boolean r = vh.compareAndSet(recv, &quot;foo&quot;, Void.class);
 344         });
 345         checkWMTE(() -&gt; { // receiver primitive class
 346             boolean r = vh.compareAndSet(0, &quot;foo&quot;, &quot;foo&quot;);
 347         });
 348         // Incorrect arity
 349         checkWMTE(() -&gt; { // 0
 350             boolean r = vh.compareAndSet();
 351         });
 352         checkWMTE(() -&gt; { // &gt;
 353             boolean r = vh.compareAndSet(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 354         });
 355 
 356 
 357         // WeakCompareAndSet
 358         // Incorrect argument types
 359         checkNPE(() -&gt; { // null receiver
 360             boolean r = vh.weakCompareAndSetPlain(null, &quot;foo&quot;, &quot;foo&quot;);
 361         });
 362         checkCCE(() -&gt; { // receiver reference class
 363             boolean r = vh.weakCompareAndSetPlain(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 364         });
 365         checkCCE(() -&gt; { // expected reference class
 366             boolean r = vh.weakCompareAndSetPlain(recv, Void.class, &quot;foo&quot;);
 367         });
 368         checkCCE(() -&gt; { // actual reference class
 369             boolean r = vh.weakCompareAndSetPlain(recv, &quot;foo&quot;, Void.class);
 370         });
 371         checkWMTE(() -&gt; { // receiver primitive class
 372             boolean r = vh.weakCompareAndSetPlain(0, &quot;foo&quot;, &quot;foo&quot;);
 373         });
 374         // Incorrect arity
 375         checkWMTE(() -&gt; { // 0
 376             boolean r = vh.weakCompareAndSetPlain();
 377         });
 378         checkWMTE(() -&gt; { // &gt;
 379             boolean r = vh.weakCompareAndSetPlain(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 380         });
 381 
 382 
 383         // WeakCompareAndSetVolatile
 384         // Incorrect argument types
 385         checkNPE(() -&gt; { // null receiver
 386             boolean r = vh.weakCompareAndSet(null, &quot;foo&quot;, &quot;foo&quot;);
 387         });
 388         checkCCE(() -&gt; { // receiver reference class
 389             boolean r = vh.weakCompareAndSet(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 390         });
 391         checkCCE(() -&gt; { // expected reference class
 392             boolean r = vh.weakCompareAndSet(recv, Void.class, &quot;foo&quot;);
 393         });
 394         checkCCE(() -&gt; { // actual reference class
 395             boolean r = vh.weakCompareAndSet(recv, &quot;foo&quot;, Void.class);
 396         });
 397         checkWMTE(() -&gt; { // receiver primitive class
 398             boolean r = vh.weakCompareAndSet(0, &quot;foo&quot;, &quot;foo&quot;);
 399         });
 400         // Incorrect arity
 401         checkWMTE(() -&gt; { // 0
 402             boolean r = vh.weakCompareAndSet();
 403         });
 404         checkWMTE(() -&gt; { // &gt;
 405             boolean r = vh.weakCompareAndSet(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 406         });
 407 
 408 
 409         // WeakCompareAndSetAcquire
 410         // Incorrect argument types
 411         checkNPE(() -&gt; { // null receiver
 412             boolean r = vh.weakCompareAndSetAcquire(null, &quot;foo&quot;, &quot;foo&quot;);
 413         });
 414         checkCCE(() -&gt; { // receiver reference class
 415             boolean r = vh.weakCompareAndSetAcquire(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 416         });
 417         checkCCE(() -&gt; { // expected reference class
 418             boolean r = vh.weakCompareAndSetAcquire(recv, Void.class, &quot;foo&quot;);
 419         });
 420         checkCCE(() -&gt; { // actual reference class
 421             boolean r = vh.weakCompareAndSetAcquire(recv, &quot;foo&quot;, Void.class);
 422         });
 423         checkWMTE(() -&gt; { // receiver primitive class
 424             boolean r = vh.weakCompareAndSetAcquire(0, &quot;foo&quot;, &quot;foo&quot;);
 425         });
 426         // Incorrect arity
 427         checkWMTE(() -&gt; { // 0
 428             boolean r = vh.weakCompareAndSetAcquire();
 429         });
 430         checkWMTE(() -&gt; { // &gt;
 431             boolean r = vh.weakCompareAndSetAcquire(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 432         });
 433 
 434 
 435         // WeakCompareAndSetRelease
 436         // Incorrect argument types
 437         checkNPE(() -&gt; { // null receiver
 438             boolean r = vh.weakCompareAndSetRelease(null, &quot;foo&quot;, &quot;foo&quot;);
 439         });
 440         checkCCE(() -&gt; { // receiver reference class
 441             boolean r = vh.weakCompareAndSetRelease(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 442         });
 443         checkCCE(() -&gt; { // expected reference class
 444             boolean r = vh.weakCompareAndSetRelease(recv, Void.class, &quot;foo&quot;);
 445         });
 446         checkCCE(() -&gt; { // actual reference class
 447             boolean r = vh.weakCompareAndSetRelease(recv, &quot;foo&quot;, Void.class);
 448         });
 449         checkWMTE(() -&gt; { // receiver primitive class
 450             boolean r = vh.weakCompareAndSetRelease(0, &quot;foo&quot;, &quot;foo&quot;);
 451         });
 452         // Incorrect arity
 453         checkWMTE(() -&gt; { // 0
 454             boolean r = vh.weakCompareAndSetRelease();
 455         });
 456         checkWMTE(() -&gt; { // &gt;
 457             boolean r = vh.weakCompareAndSetRelease(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 458         });
 459 
 460 
 461         // CompareAndExchange
 462         // Incorrect argument types
 463         checkNPE(() -&gt; { // null receiver
 464             String x = (String) vh.compareAndExchange(null, &quot;foo&quot;, &quot;foo&quot;);
 465         });
 466         checkCCE(() -&gt; { // receiver reference class
 467             String x = (String) vh.compareAndExchange(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 468         });
 469         checkCCE(() -&gt; { // expected reference class
 470             String x = (String) vh.compareAndExchange(recv, Void.class, &quot;foo&quot;);
 471         });
 472         checkCCE(() -&gt; { // actual reference class
 473             String x = (String) vh.compareAndExchange(recv, &quot;foo&quot;, Void.class);
 474         });
 475         checkWMTE(() -&gt; { // reciever primitive class
 476             String x = (String) vh.compareAndExchange(0, &quot;foo&quot;, &quot;foo&quot;);
 477         });
 478         // Incorrect return type
 479         checkCCE(() -&gt; { // reference class
 480             Void r = (Void) vh.compareAndExchange(recv, &quot;foo&quot;, &quot;foo&quot;);
 481         });
 482         checkWMTE(() -&gt; { // primitive class
 483             boolean x = (boolean) vh.compareAndExchange(recv, &quot;foo&quot;, &quot;foo&quot;);
 484         });
 485         // Incorrect arity
 486         checkWMTE(() -&gt; { // 0
 487             String x = (String) vh.compareAndExchange();
 488         });
 489         checkWMTE(() -&gt; { // &gt;
 490             String x = (String) vh.compareAndExchange(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 491         });
 492 
 493 
 494         // CompareAndExchangeAcquire
 495         // Incorrect argument types
 496         checkNPE(() -&gt; { // null receiver
 497             String x = (String) vh.compareAndExchangeAcquire(null, &quot;foo&quot;, &quot;foo&quot;);
 498         });
 499         checkCCE(() -&gt; { // receiver reference class
 500             String x = (String) vh.compareAndExchangeAcquire(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 501         });
 502         checkCCE(() -&gt; { // expected reference class
 503             String x = (String) vh.compareAndExchangeAcquire(recv, Void.class, &quot;foo&quot;);
 504         });
 505         checkCCE(() -&gt; { // actual reference class
 506             String x = (String) vh.compareAndExchangeAcquire(recv, &quot;foo&quot;, Void.class);
 507         });
 508         checkWMTE(() -&gt; { // reciever primitive class
 509             String x = (String) vh.compareAndExchangeAcquire(0, &quot;foo&quot;, &quot;foo&quot;);
 510         });
 511         // Incorrect return type
 512         checkCCE(() -&gt; { // reference class
 513             Void r = (Void) vh.compareAndExchangeAcquire(recv, &quot;foo&quot;, &quot;foo&quot;);
 514         });
 515         checkWMTE(() -&gt; { // primitive class
 516             boolean x = (boolean) vh.compareAndExchangeAcquire(recv, &quot;foo&quot;, &quot;foo&quot;);
 517         });
 518         // Incorrect arity
 519         checkWMTE(() -&gt; { // 0
 520             String x = (String) vh.compareAndExchangeAcquire();
 521         });
 522         checkWMTE(() -&gt; { // &gt;
 523             String x = (String) vh.compareAndExchangeAcquire(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 524         });
 525 
 526 
 527         // CompareAndExchangeRelease
 528         // Incorrect argument types
 529         checkNPE(() -&gt; { // null receiver
 530             String x = (String) vh.compareAndExchangeRelease(null, &quot;foo&quot;, &quot;foo&quot;);
 531         });
 532         checkCCE(() -&gt; { // receiver reference class
 533             String x = (String) vh.compareAndExchangeRelease(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 534         });
 535         checkCCE(() -&gt; { // expected reference class
 536             String x = (String) vh.compareAndExchangeRelease(recv, Void.class, &quot;foo&quot;);
 537         });
 538         checkCCE(() -&gt; { // actual reference class
 539             String x = (String) vh.compareAndExchangeRelease(recv, &quot;foo&quot;, Void.class);
 540         });
 541         checkWMTE(() -&gt; { // reciever primitive class
 542             String x = (String) vh.compareAndExchangeRelease(0, &quot;foo&quot;, &quot;foo&quot;);
 543         });
 544         // Incorrect return type
 545         checkCCE(() -&gt; { // reference class
 546             Void r = (Void) vh.compareAndExchangeRelease(recv, &quot;foo&quot;, &quot;foo&quot;);
 547         });
 548         checkWMTE(() -&gt; { // primitive class
 549             boolean x = (boolean) vh.compareAndExchangeRelease(recv, &quot;foo&quot;, &quot;foo&quot;);
 550         });
 551         // Incorrect arity
 552         checkWMTE(() -&gt; { // 0
 553             String x = (String) vh.compareAndExchangeRelease();
 554         });
 555         checkWMTE(() -&gt; { // &gt;
 556             String x = (String) vh.compareAndExchangeRelease(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 557         });
 558 
 559 
 560         // GetAndSet
 561         // Incorrect argument types
 562         checkNPE(() -&gt; { // null receiver
 563             String x = (String) vh.getAndSet(null, &quot;foo&quot;);
 564         });
 565         checkCCE(() -&gt; { // receiver reference class
 566             String x = (String) vh.getAndSet(Void.class, &quot;foo&quot;);
 567         });
 568         checkCCE(() -&gt; { // value reference class
 569             String x = (String) vh.getAndSet(recv, Void.class);
 570         });
 571         checkWMTE(() -&gt; { // reciever primitive class
 572             String x = (String) vh.getAndSet(0, &quot;foo&quot;);
 573         });
 574         // Incorrect return type
 575         checkCCE(() -&gt; { // reference class
 576             Void r = (Void) vh.getAndSet(recv, &quot;foo&quot;);
 577         });
 578         checkWMTE(() -&gt; { // primitive class
 579             boolean x = (boolean) vh.getAndSet(recv, &quot;foo&quot;);
 580         });
 581         // Incorrect arity
 582         checkWMTE(() -&gt; { // 0
 583             String x = (String) vh.getAndSet();
 584         });
 585         checkWMTE(() -&gt; { // &gt;
 586             String x = (String) vh.getAndSet(recv, &quot;foo&quot;, Void.class);
 587         });
 588 
 589         // GetAndSetAcquire
 590         // Incorrect argument types
 591         checkNPE(() -&gt; { // null receiver
 592             String x = (String) vh.getAndSetAcquire(null, &quot;foo&quot;);
 593         });
 594         checkCCE(() -&gt; { // receiver reference class
 595             String x = (String) vh.getAndSetAcquire(Void.class, &quot;foo&quot;);
 596         });
 597         checkCCE(() -&gt; { // value reference class
 598             String x = (String) vh.getAndSetAcquire(recv, Void.class);
 599         });
 600         checkWMTE(() -&gt; { // reciever primitive class
 601             String x = (String) vh.getAndSetAcquire(0, &quot;foo&quot;);
 602         });
 603         // Incorrect return type
 604         checkCCE(() -&gt; { // reference class
 605             Void r = (Void) vh.getAndSetAcquire(recv, &quot;foo&quot;);
 606         });
 607         checkWMTE(() -&gt; { // primitive class
 608             boolean x = (boolean) vh.getAndSetAcquire(recv, &quot;foo&quot;);
 609         });
 610         // Incorrect arity
 611         checkWMTE(() -&gt; { // 0
 612             String x = (String) vh.getAndSetAcquire();
 613         });
 614         checkWMTE(() -&gt; { // &gt;
 615             String x = (String) vh.getAndSetAcquire(recv, &quot;foo&quot;, Void.class);
 616         });
 617 
 618         // GetAndSetRelease
 619         // Incorrect argument types
 620         checkNPE(() -&gt; { // null receiver
 621             String x = (String) vh.getAndSetRelease(null, &quot;foo&quot;);
 622         });
 623         checkCCE(() -&gt; { // receiver reference class
 624             String x = (String) vh.getAndSetRelease(Void.class, &quot;foo&quot;);
 625         });
 626         checkCCE(() -&gt; { // value reference class
 627             String x = (String) vh.getAndSetRelease(recv, Void.class);
 628         });
 629         checkWMTE(() -&gt; { // reciever primitive class
 630             String x = (String) vh.getAndSetRelease(0, &quot;foo&quot;);
 631         });
 632         // Incorrect return type
 633         checkCCE(() -&gt; { // reference class
 634             Void r = (Void) vh.getAndSetRelease(recv, &quot;foo&quot;);
 635         });
 636         checkWMTE(() -&gt; { // primitive class
 637             boolean x = (boolean) vh.getAndSetRelease(recv, &quot;foo&quot;);
 638         });
 639         // Incorrect arity
 640         checkWMTE(() -&gt; { // 0
 641             String x = (String) vh.getAndSetRelease();
 642         });
 643         checkWMTE(() -&gt; { // &gt;
 644             String x = (String) vh.getAndSetRelease(recv, &quot;foo&quot;, Void.class);
 645         });
 646 
 647 
 648     }
 649 
 650     static void testInstanceFieldWrongMethodType(VarHandleTestMethodTypeString recv, Handles hs) throws Throwable {
 651         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET)) {
 652             // Incorrect argument types
 653             checkNPE(() -&gt; { // null receiver
 654                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class)).
 655                     invokeExact((VarHandleTestMethodTypeString) null);
 656             });
 657             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 658                 String x = (String) hs.get(am, methodType(String.class, Class.class)).
 659                     invokeExact(Void.class);
 660             });
 661             checkWMTE(() -&gt; { // receiver primitive class
 662                 String x = (String) hs.get(am, methodType(String.class, int.class)).
 663                     invokeExact(0);
 664             });
 665             // Incorrect return type
 666             hs.checkWMTEOrCCE(() -&gt; { // reference class
 667                 Void x = (Void) hs.get(am, methodType(Void.class, VarHandleTestMethodTypeString.class)).
 668                     invokeExact(recv);
 669             });
 670             checkWMTE(() -&gt; { // primitive class
 671                 boolean x = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class)).
 672                     invokeExact(recv);
 673             });
 674             // Incorrect arity
 675             checkWMTE(() -&gt; { // 0
 676                 String x = (String) hs.get(am, methodType(String.class)).
 677                     invokeExact();
 678             });
 679             checkWMTE(() -&gt; { // &gt;
 680                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, Class.class)).
 681                     invokeExact(recv, Void.class);
 682             });
 683         }
 684 
 685         for (TestAccessMode am : testAccessModesOfType(TestAccessType.SET)) {
 686             // Incorrect argument types
 687             checkNPE(() -&gt; { // null receiver
 688                 hs.get(am, methodType(void.class, VarHandleTestMethodTypeString.class, String.class)).
 689                     invokeExact((VarHandleTestMethodTypeString) null, &quot;foo&quot;);
 690             });
 691             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 692                 hs.get(am, methodType(void.class, Class.class, String.class)).
 693                     invokeExact(Void.class, &quot;foo&quot;);
 694             });
 695             hs.checkWMTEOrCCE(() -&gt; { // value reference class
 696                 hs.get(am, methodType(void.class, VarHandleTestMethodTypeString.class, Class.class)).
 697                     invokeExact(recv, Void.class);
 698             });
 699             checkWMTE(() -&gt; { // receiver primitive class
 700                 hs.get(am, methodType(void.class, int.class, String.class)).
 701                     invokeExact(0, &quot;foo&quot;);
 702             });
 703             // Incorrect arity
 704             checkWMTE(() -&gt; { // 0
 705                 hs.get(am, methodType(void.class)).
 706                     invokeExact();
 707             });
 708             checkWMTE(() -&gt; { // &gt;
 709                 hs.get(am, methodType(void.class, VarHandleTestMethodTypeString.class, String.class, Class.class)).
 710                     invokeExact(recv, &quot;foo&quot;, Void.class);
 711             });
 712         }
 713 
 714         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_SET)) {
 715             // Incorrect argument types
 716             checkNPE(() -&gt; { // null receiver
 717                 boolean r = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, String.class, String.class)).
 718                     invokeExact((VarHandleTestMethodTypeString) null, &quot;foo&quot;, &quot;foo&quot;);
 719             });
 720             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 721                 boolean r = (boolean) hs.get(am, methodType(boolean.class, Class.class, String.class, String.class)).
 722                     invokeExact(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 723             });
 724             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
 725                 boolean r = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, Class.class, String.class)).
 726                     invokeExact(recv, Void.class, &quot;foo&quot;);
 727             });
 728             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
 729                 boolean r = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, String.class, Class.class)).
 730                     invokeExact(recv, &quot;foo&quot;, Void.class);
 731             });
 732             checkWMTE(() -&gt; { // receiver primitive class
 733                 boolean r = (boolean) hs.get(am, methodType(boolean.class, int.class , String.class, String.class)).
 734                     invokeExact(0, &quot;foo&quot;, &quot;foo&quot;);
 735             });
 736             // Incorrect arity
 737             checkWMTE(() -&gt; { // 0
 738                 boolean r = (boolean) hs.get(am, methodType(boolean.class)).
 739                     invokeExact();
 740             });
 741             checkWMTE(() -&gt; { // &gt;
 742                 boolean r = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, String.class, String.class, Class.class)).
 743                     invokeExact(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 744             });
 745         }
 746 
 747         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_EXCHANGE)) {
 748             checkNPE(() -&gt; { // null receiver
 749                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class, String.class)).
 750                     invokeExact((VarHandleTestMethodTypeString) null, &quot;foo&quot;, &quot;foo&quot;);
 751             });
 752             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 753                 String x = (String) hs.get(am, methodType(String.class, Class.class, String.class, String.class)).
 754                     invokeExact(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 755             });
 756             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
 757                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, Class.class, String.class)).
 758                     invokeExact(recv, Void.class, &quot;foo&quot;);
 759             });
 760             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
 761                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class, Class.class)).
 762                     invokeExact(recv, &quot;foo&quot;, Void.class);
 763             });
 764             checkWMTE(() -&gt; { // reciever primitive class
 765                 String x = (String) hs.get(am, methodType(String.class, int.class , String.class, String.class)).
 766                     invokeExact(0, &quot;foo&quot;, &quot;foo&quot;);
 767             });
 768             // Incorrect return type
 769             hs.checkWMTEOrCCE(() -&gt; { // reference class
 770                 Void r = (Void) hs.get(am, methodType(Void.class, VarHandleTestMethodTypeString.class , String.class, String.class)).
 771                     invokeExact(recv, &quot;foo&quot;, &quot;foo&quot;);
 772             });
 773             checkWMTE(() -&gt; { // primitive class
 774                 boolean x = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class , String.class, String.class)).
 775                     invokeExact(recv, &quot;foo&quot;, &quot;foo&quot;);
 776             });
 777             // Incorrect arity
 778             checkWMTE(() -&gt; { // 0
 779                 String x = (String) hs.get(am, methodType(String.class)).
 780                     invokeExact();
 781             });
 782             checkWMTE(() -&gt; { // &gt;
 783                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class, String.class, Class.class)).
 784                     invokeExact(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 785             });
 786         }
 787 
 788         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET_AND_SET)) {
 789             checkNPE(() -&gt; { // null receiver
 790                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class)).
 791                     invokeExact((VarHandleTestMethodTypeString) null, &quot;foo&quot;);
 792             });
 793             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 794                 String x = (String) hs.get(am, methodType(String.class, Class.class, String.class)).
 795                     invokeExact(Void.class, &quot;foo&quot;);
 796             });
 797             hs.checkWMTEOrCCE(() -&gt; { // value reference class
 798                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, Class.class)).
 799                     invokeExact(recv, Void.class);
 800             });
 801             checkWMTE(() -&gt; { // reciever primitive class
 802                 String x = (String) hs.get(am, methodType(String.class, int.class, String.class)).
 803                     invokeExact(0, &quot;foo&quot;);
 804             });
 805             // Incorrect return type
 806             hs.checkWMTEOrCCE(() -&gt; { // reference class
 807                 Void r = (Void) hs.get(am, methodType(Void.class, VarHandleTestMethodTypeString.class, String.class)).
 808                     invokeExact(recv, &quot;foo&quot;);
 809             });
 810             checkWMTE(() -&gt; { // primitive class
 811                 boolean x = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, String.class)).
 812                     invokeExact(recv, &quot;foo&quot;);
 813             });
 814             // Incorrect arity
 815             checkWMTE(() -&gt; { // 0
 816                 String x = (String) hs.get(am, methodType(String.class)).
 817                     invokeExact();
 818             });
 819             checkWMTE(() -&gt; { // &gt;
 820                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class)).
 821                     invokeExact(recv, &quot;foo&quot;, Void.class);
 822             });
 823         }
 824 
 825 
 826     }
 827 
 828 
 829     static void testStaticFieldWrongMethodType(VarHandle vh) throws Throwable {
 830         // Get
 831         // Incorrect return type
 832         checkCCE(() -&gt; { // reference class
 833             Void x = (Void) vh.get();
 834         });
 835         checkWMTE(() -&gt; { // primitive class
 836             boolean x = (boolean) vh.get();
 837         });
 838         // Incorrect arity
 839         checkWMTE(() -&gt; { // &gt;
 840             String x = (String) vh.get(Void.class);
 841         });
 842 
 843 
 844         // Set
 845         // Incorrect argument types
 846         checkCCE(() -&gt; { // value reference class
 847             vh.set(Void.class);
 848         });
 849         // Incorrect arity
 850         checkWMTE(() -&gt; { // 0
 851             vh.set();
 852         });
 853         checkWMTE(() -&gt; { // &gt;
 854             vh.set(&quot;foo&quot;, Void.class);
 855         });
 856 
 857 
 858         // GetVolatile
 859         // Incorrect return type
 860         checkCCE(() -&gt; { // reference class
 861             Void x = (Void) vh.getVolatile();
 862         });
 863         checkWMTE(() -&gt; { // primitive class
 864             boolean x = (boolean) vh.getVolatile();
 865         });
 866         checkWMTE(() -&gt; { // &gt;
 867             String x = (String) vh.getVolatile(Void.class);
 868         });
 869 
 870 
 871         // SetVolatile
 872         // Incorrect argument types
 873         checkCCE(() -&gt; { // value reference class
 874             vh.setVolatile(Void.class);
 875         });
 876         // Incorrect arity
 877         checkWMTE(() -&gt; { // 0
 878             vh.setVolatile();
 879         });
 880         checkWMTE(() -&gt; { // &gt;
 881             vh.setVolatile(&quot;foo&quot;, Void.class);
 882         });
 883 
 884 
 885         // GetOpaque
 886         // Incorrect return type
 887         checkCCE(() -&gt; { // reference class
 888             Void x = (Void) vh.getOpaque();
 889         });
 890         checkWMTE(() -&gt; { // primitive class
 891             boolean x = (boolean) vh.getOpaque();
 892         });
 893         checkWMTE(() -&gt; { // &gt;
 894             String x = (String) vh.getOpaque(Void.class);
 895         });
 896 
 897 
 898         // SetOpaque
 899         // Incorrect argument types
 900         checkCCE(() -&gt; { // value reference class
 901             vh.setOpaque(Void.class);
 902         });
 903         // Incorrect arity
 904         checkWMTE(() -&gt; { // 0
 905             vh.setOpaque();
 906         });
 907         checkWMTE(() -&gt; { // &gt;
 908             vh.setOpaque(&quot;foo&quot;, Void.class);
 909         });
 910 
 911 
 912         // GetAcquire
 913         // Incorrect return type
 914         checkCCE(() -&gt; { // reference class
 915             Void x = (Void) vh.getAcquire();
 916         });
 917         checkWMTE(() -&gt; { // primitive class
 918             boolean x = (boolean) vh.getAcquire();
 919         });
 920         checkWMTE(() -&gt; { // &gt;
 921             String x = (String) vh.getAcquire(Void.class);
 922         });
 923 
 924 
 925         // SetRelease
 926         // Incorrect argument types
 927         checkCCE(() -&gt; { // value reference class
 928             vh.setRelease(Void.class);
 929         });
 930         // Incorrect arity
 931         checkWMTE(() -&gt; { // 0
 932             vh.setRelease();
 933         });
 934         checkWMTE(() -&gt; { // &gt;
 935             vh.setRelease(&quot;foo&quot;, Void.class);
 936         });
 937 
 938 
 939         // CompareAndSet
 940         // Incorrect argument types
 941         checkCCE(() -&gt; { // expected reference class
 942             boolean r = vh.compareAndSet(Void.class, &quot;foo&quot;);
 943         });
 944         checkCCE(() -&gt; { // actual reference class
 945             boolean r = vh.compareAndSet(&quot;foo&quot;, Void.class);
 946         });
 947         // Incorrect arity
 948         checkWMTE(() -&gt; { // 0
 949             boolean r = vh.compareAndSet();
 950         });
 951         checkWMTE(() -&gt; { // &gt;
 952             boolean r = vh.compareAndSet(&quot;foo&quot;, &quot;foo&quot;, Void.class);
 953         });
 954 
 955 
 956         // WeakCompareAndSet
 957         // Incorrect argument types
 958         checkCCE(() -&gt; { // expected reference class
 959             boolean r = vh.weakCompareAndSetPlain(Void.class, &quot;foo&quot;);
 960         });
 961         checkCCE(() -&gt; { // actual reference class
 962             boolean r = vh.weakCompareAndSetPlain(&quot;foo&quot;, Void.class);
 963         });
 964         // Incorrect arity
 965         checkWMTE(() -&gt; { // 0
 966             boolean r = vh.weakCompareAndSetPlain();
 967         });
 968         checkWMTE(() -&gt; { // &gt;
 969             boolean r = vh.weakCompareAndSetPlain(&quot;foo&quot;, &quot;foo&quot;, Void.class);
 970         });
 971 
 972 
 973         // WeakCompareAndSetVolatile
 974         // Incorrect argument types
 975         checkCCE(() -&gt; { // expected reference class
 976             boolean r = vh.weakCompareAndSet(Void.class, &quot;foo&quot;);
 977         });
 978         checkCCE(() -&gt; { // actual reference class
 979             boolean r = vh.weakCompareAndSet(&quot;foo&quot;, Void.class);
 980         });
 981         // Incorrect arity
 982         checkWMTE(() -&gt; { // 0
 983             boolean r = vh.weakCompareAndSet();
 984         });
 985         checkWMTE(() -&gt; { // &gt;
 986             boolean r = vh.weakCompareAndSet(&quot;foo&quot;, &quot;foo&quot;, Void.class);
 987         });
 988 
 989 
 990         // WeakCompareAndSetAcquire
 991         // Incorrect argument types
 992         checkCCE(() -&gt; { // expected reference class
 993             boolean r = vh.weakCompareAndSetAcquire(Void.class, &quot;foo&quot;);
 994         });
 995         checkCCE(() -&gt; { // actual reference class
 996             boolean r = vh.weakCompareAndSetAcquire(&quot;foo&quot;, Void.class);
 997         });
 998         // Incorrect arity
 999         checkWMTE(() -&gt; { // 0
1000             boolean r = vh.weakCompareAndSetAcquire();
1001         });
1002         checkWMTE(() -&gt; { // &gt;
1003             boolean r = vh.weakCompareAndSetAcquire(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1004         });
1005 
1006 
1007         // WeakCompareAndSetRelease
1008         // Incorrect argument types
1009         checkCCE(() -&gt; { // expected reference class
1010             boolean r = vh.weakCompareAndSetRelease(Void.class, &quot;foo&quot;);
1011         });
1012         checkCCE(() -&gt; { // actual reference class
1013             boolean r = vh.weakCompareAndSetRelease(&quot;foo&quot;, Void.class);
1014         });
1015         // Incorrect arity
1016         checkWMTE(() -&gt; { // 0
1017             boolean r = vh.weakCompareAndSetRelease();
1018         });
1019         checkWMTE(() -&gt; { // &gt;
1020             boolean r = vh.weakCompareAndSetRelease(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1021         });
1022 
1023 
1024         // CompareAndExchange
1025         // Incorrect argument types
1026         checkCCE(() -&gt; { // expected reference class
1027             String x = (String) vh.compareAndExchange(Void.class, &quot;foo&quot;);
1028         });
1029         checkCCE(() -&gt; { // actual reference class
1030             String x = (String) vh.compareAndExchange(&quot;foo&quot;, Void.class);
1031         });
1032         // Incorrect return type
1033         checkCCE(() -&gt; { // reference class
1034             Void r = (Void) vh.compareAndExchange(&quot;foo&quot;, &quot;foo&quot;);
1035         });
1036         checkWMTE(() -&gt; { // primitive class
1037             boolean x = (boolean) vh.compareAndExchange(&quot;foo&quot;, &quot;foo&quot;);
1038         });
1039         // Incorrect arity
1040         checkWMTE(() -&gt; { // 0
1041             String x = (String) vh.compareAndExchange();
1042         });
1043         checkWMTE(() -&gt; { // &gt;
1044             String x = (String) vh.compareAndExchange(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1045         });
1046 
1047 
1048         // CompareAndExchangeAcquire
1049         // Incorrect argument types
1050         checkCCE(() -&gt; { // expected reference class
1051             String x = (String) vh.compareAndExchangeAcquire(Void.class, &quot;foo&quot;);
1052         });
1053         checkCCE(() -&gt; { // actual reference class
1054             String x = (String) vh.compareAndExchangeAcquire(&quot;foo&quot;, Void.class);
1055         });
1056         // Incorrect return type
1057         checkCCE(() -&gt; { // reference class
1058             Void r = (Void) vh.compareAndExchangeAcquire(&quot;foo&quot;, &quot;foo&quot;);
1059         });
1060         checkWMTE(() -&gt; { // primitive class
1061             boolean x = (boolean) vh.compareAndExchangeAcquire(&quot;foo&quot;, &quot;foo&quot;);
1062         });
1063         // Incorrect arity
1064         checkWMTE(() -&gt; { // 0
1065             String x = (String) vh.compareAndExchangeAcquire();
1066         });
1067         checkWMTE(() -&gt; { // &gt;
1068             String x = (String) vh.compareAndExchangeAcquire(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1069         });
1070 
1071 
1072         // CompareAndExchangeRelease
1073         // Incorrect argument types
1074         checkCCE(() -&gt; { // expected reference class
1075             String x = (String) vh.compareAndExchangeRelease(Void.class, &quot;foo&quot;);
1076         });
1077         checkCCE(() -&gt; { // actual reference class
1078             String x = (String) vh.compareAndExchangeRelease(&quot;foo&quot;, Void.class);
1079         });
1080         // Incorrect return type
1081         checkCCE(() -&gt; { // reference class
1082             Void r = (Void) vh.compareAndExchangeRelease(&quot;foo&quot;, &quot;foo&quot;);
1083         });
1084         checkWMTE(() -&gt; { // primitive class
1085             boolean x = (boolean) vh.compareAndExchangeRelease(&quot;foo&quot;, &quot;foo&quot;);
1086         });
1087         // Incorrect arity
1088         checkWMTE(() -&gt; { // 0
1089             String x = (String) vh.compareAndExchangeRelease();
1090         });
1091         checkWMTE(() -&gt; { // &gt;
1092             String x = (String) vh.compareAndExchangeRelease(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1093         });
1094 
1095 
1096         // GetAndSet
1097         // Incorrect argument types
1098         checkCCE(() -&gt; { // value reference class
1099             String x = (String) vh.getAndSet(Void.class);
1100         });
1101         // Incorrect return type
1102         checkCCE(() -&gt; { // reference class
1103             Void r = (Void) vh.getAndSet(&quot;foo&quot;);
1104         });
1105         checkWMTE(() -&gt; { // primitive class
1106             boolean x = (boolean) vh.getAndSet(&quot;foo&quot;);
1107         });
1108         // Incorrect arity
1109         checkWMTE(() -&gt; { // 0
1110             String x = (String) vh.getAndSet();
1111         });
1112         checkWMTE(() -&gt; { // &gt;
1113             String x = (String) vh.getAndSet(&quot;foo&quot;, Void.class);
1114         });
1115 
1116 
1117         // GetAndSetAcquire
1118         // Incorrect argument types
1119         checkCCE(() -&gt; { // value reference class
1120             String x = (String) vh.getAndSetAcquire(Void.class);
1121         });
1122         // Incorrect return type
1123         checkCCE(() -&gt; { // reference class
1124             Void r = (Void) vh.getAndSetAcquire(&quot;foo&quot;);
1125         });
1126         checkWMTE(() -&gt; { // primitive class
1127             boolean x = (boolean) vh.getAndSetAcquire(&quot;foo&quot;);
1128         });
1129         // Incorrect arity
1130         checkWMTE(() -&gt; { // 0
1131             String x = (String) vh.getAndSetAcquire();
1132         });
1133         checkWMTE(() -&gt; { // &gt;
1134             String x = (String) vh.getAndSetAcquire(&quot;foo&quot;, Void.class);
1135         });
1136 
1137 
1138         // GetAndSetRelease
1139         // Incorrect argument types
1140         checkCCE(() -&gt; { // value reference class
1141             String x = (String) vh.getAndSetRelease(Void.class);
1142         });
1143         // Incorrect return type
1144         checkCCE(() -&gt; { // reference class
1145             Void r = (Void) vh.getAndSetRelease(&quot;foo&quot;);
1146         });
1147         checkWMTE(() -&gt; { // primitive class
1148             boolean x = (boolean) vh.getAndSetRelease(&quot;foo&quot;);
1149         });
1150         // Incorrect arity
1151         checkWMTE(() -&gt; { // 0
1152             String x = (String) vh.getAndSetRelease();
1153         });
1154         checkWMTE(() -&gt; { // &gt;
1155             String x = (String) vh.getAndSetRelease(&quot;foo&quot;, Void.class);
1156         });
1157 
1158 
1159     }
1160 
1161     static void testStaticFieldWrongMethodType(Handles hs) throws Throwable {
1162         int i = 0;
1163 
1164         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET)) {
1165             // Incorrect return type
1166             hs.checkWMTEOrCCE(() -&gt; { // reference class
1167                 Void x = (Void) hs.get(am, methodType(Void.class)).
1168                     invokeExact();
1169             });
1170             checkWMTE(() -&gt; { // primitive class
1171                 boolean x = (boolean) hs.get(am, methodType(boolean.class)).
1172                     invokeExact();
1173             });
1174             // Incorrect arity
1175             checkWMTE(() -&gt; { // &gt;
1176                 String x = (String) hs.get(am, methodType(Class.class)).
1177                     invokeExact(Void.class);
1178             });
1179         }
1180 
1181         for (TestAccessMode am : testAccessModesOfType(TestAccessType.SET)) {
1182             hs.checkWMTEOrCCE(() -&gt; { // value reference class
1183                 hs.get(am, methodType(void.class, Class.class)).
1184                     invokeExact(Void.class);
1185             });
1186             // Incorrect arity
1187             checkWMTE(() -&gt; { // 0
1188                 hs.get(am, methodType(void.class)).
1189                     invokeExact();
1190             });
1191             checkWMTE(() -&gt; { // &gt;
1192                 hs.get(am, methodType(void.class, String.class, Class.class)).
1193                     invokeExact(&quot;foo&quot;, Void.class);
1194             });
1195         }
1196         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_SET)) {
1197             // Incorrect argument types
1198             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
1199                 boolean r = (boolean) hs.get(am, methodType(boolean.class, Class.class, String.class)).
1200                     invokeExact(Void.class, &quot;foo&quot;);
1201             });
1202             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
1203                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String.class, Class.class)).
1204                     invokeExact(&quot;foo&quot;, Void.class);
1205             });
1206             // Incorrect arity
1207             checkWMTE(() -&gt; { // 0
1208                 boolean r = (boolean) hs.get(am, methodType(boolean.class)).
1209                     invokeExact();
1210             });
1211             checkWMTE(() -&gt; { // &gt;
1212                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String.class, String.class, Class.class)).
1213                     invokeExact(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1214             });
1215         }
1216 
1217         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_EXCHANGE)) {
1218             // Incorrect argument types
1219             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
1220                 String x = (String) hs.get(am, methodType(String.class, Class.class, String.class)).
1221                     invokeExact(Void.class, &quot;foo&quot;);
1222             });
1223             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
1224                 String x = (String) hs.get(am, methodType(String.class, String.class, Class.class)).
1225                     invokeExact(&quot;foo&quot;, Void.class);
1226             });
1227             // Incorrect return type
1228             hs.checkWMTEOrCCE(() -&gt; { // reference class
1229                 Void r = (Void) hs.get(am, methodType(Void.class, String.class, String.class)).
1230                     invokeExact(&quot;foo&quot;, &quot;foo&quot;);
1231             });
1232             checkWMTE(() -&gt; { // primitive class
1233                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String.class, String.class)).
1234                     invokeExact(&quot;foo&quot;, &quot;foo&quot;);
1235             });
1236             // Incorrect arity
1237             checkWMTE(() -&gt; { // 0
1238                 String x = (String) hs.get(am, methodType(String.class)).
1239                     invokeExact();
1240             });
1241             checkWMTE(() -&gt; { // &gt;
1242                 String x = (String) hs.get(am, methodType(String.class, String.class, String.class, Class.class)).
1243                     invokeExact(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1244             });
1245         }
1246 
1247         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET_AND_SET)) {
1248             // Incorrect argument types
1249             hs.checkWMTEOrCCE(() -&gt; { // value reference class
1250                 String x = (String) hs.get(am, methodType(String.class, Class.class)).
1251                     invokeExact(Void.class);
1252             });
1253             // Incorrect return type
1254             hs.checkWMTEOrCCE(() -&gt; { // reference class
1255                 Void r = (Void) hs.get(am, methodType(Void.class, String.class)).
1256                     invokeExact(&quot;foo&quot;);
1257             });
1258             checkWMTE(() -&gt; { // primitive class
1259                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String.class)).
1260                     invokeExact(&quot;foo&quot;);
1261             });
1262             // Incorrect arity
1263             checkWMTE(() -&gt; { // 0
1264                 String x = (String) hs.get(am, methodType(String.class)).
1265                     invokeExact();
1266             });
1267             checkWMTE(() -&gt; { // &gt;
1268                 String x = (String) hs.get(am, methodType(String.class, String.class, Class.class)).
1269                     invokeExact(&quot;foo&quot;, Void.class);
1270             });
1271         }
1272 
1273 
1274     }
1275 
1276 
1277     static void testArrayWrongMethodType(VarHandle vh) throws Throwable {
1278         String[] array = new String[10];
1279         Arrays.fill(array, &quot;foo&quot;);
1280 
1281         // Get
1282         // Incorrect argument types
1283         checkNPE(() -&gt; { // null array
1284             String x = (String) vh.get(null, 0);
1285         });
1286         checkCCE(() -&gt; { // array reference class
1287             String x = (String) vh.get(Void.class, 0);
1288         });
1289         checkWMTE(() -&gt; { // array primitive class
1290             String x = (String) vh.get(0, 0);
1291         });
1292         checkWMTE(() -&gt; { // index reference class
1293             String x = (String) vh.get(array, Void.class);
1294         });
1295         // Incorrect return type
1296         checkCCE(() -&gt; { // reference class
1297             Void x = (Void) vh.get(array, 0);
1298         });
1299         checkWMTE(() -&gt; { // primitive class
1300             boolean x = (boolean) vh.get(array, 0);
1301         });
1302         // Incorrect arity
1303         checkWMTE(() -&gt; { // 0
1304             String x = (String) vh.get();
1305         });
1306         checkWMTE(() -&gt; { // &gt;
1307             String x = (String) vh.get(array, 0, Void.class);
1308         });
1309 
1310 
1311         // Set
1312         // Incorrect argument types
1313         checkNPE(() -&gt; { // null array
1314             vh.set(null, 0, &quot;foo&quot;);
1315         });
1316         checkCCE(() -&gt; { // array reference class
1317             vh.set(Void.class, 0, &quot;foo&quot;);
1318         });
1319         checkCCE(() -&gt; { // value reference class
1320             vh.set(array, 0, Void.class);
1321         });
1322         checkWMTE(() -&gt; { // receiver primitive class
1323             vh.set(0, 0, &quot;foo&quot;);
1324         });
1325         checkWMTE(() -&gt; { // index reference class
1326             vh.set(array, Void.class, &quot;foo&quot;);
1327         });
1328         // Incorrect arity
1329         checkWMTE(() -&gt; { // 0
1330             vh.set();
1331         });
1332         checkWMTE(() -&gt; { // &gt;
1333             vh.set(array, 0, &quot;foo&quot;, Void.class);
1334         });
1335 
1336 
1337         // GetVolatile
1338         // Incorrect argument types
1339         checkNPE(() -&gt; { // null array
1340             String x = (String) vh.getVolatile(null, 0);
1341         });
1342         checkCCE(() -&gt; { // array reference class
1343             String x = (String) vh.getVolatile(Void.class, 0);
1344         });
1345         checkWMTE(() -&gt; { // array primitive class
1346             String x = (String) vh.getVolatile(0, 0);
1347         });
1348         checkWMTE(() -&gt; { // index reference class
1349             String x = (String) vh.getVolatile(array, Void.class);
1350         });
1351         // Incorrect return type
1352         checkCCE(() -&gt; { // reference class
1353             Void x = (Void) vh.getVolatile(array, 0);
1354         });
1355         checkWMTE(() -&gt; { // primitive class
1356             boolean x = (boolean) vh.getVolatile(array, 0);
1357         });
1358         // Incorrect arity
1359         checkWMTE(() -&gt; { // 0
1360             String x = (String) vh.getVolatile();
1361         });
1362         checkWMTE(() -&gt; { // &gt;
1363             String x = (String) vh.getVolatile(array, 0, Void.class);
1364         });
1365 
1366 
1367         // SetVolatile
1368         // Incorrect argument types
1369         checkNPE(() -&gt; { // null array
1370             vh.setVolatile(null, 0, &quot;foo&quot;);
1371         });
1372         checkCCE(() -&gt; { // array reference class
1373             vh.setVolatile(Void.class, 0, &quot;foo&quot;);
1374         });
1375         checkCCE(() -&gt; { // value reference class
1376             vh.setVolatile(array, 0, Void.class);
1377         });
1378         checkWMTE(() -&gt; { // receiver primitive class
1379             vh.setVolatile(0, 0, &quot;foo&quot;);
1380         });
1381         checkWMTE(() -&gt; { // index reference class
1382             vh.setVolatile(array, Void.class, &quot;foo&quot;);
1383         });
1384         // Incorrect arity
1385         checkWMTE(() -&gt; { // 0
1386             vh.setVolatile();
1387         });
1388         checkWMTE(() -&gt; { // &gt;
1389             vh.setVolatile(array, 0, &quot;foo&quot;, Void.class);
1390         });
1391 
1392 
1393         // GetOpaque
1394         // Incorrect argument types
1395         checkNPE(() -&gt; { // null array
1396             String x = (String) vh.getOpaque(null, 0);
1397         });
1398         checkCCE(() -&gt; { // array reference class
1399             String x = (String) vh.getOpaque(Void.class, 0);
1400         });
1401         checkWMTE(() -&gt; { // array primitive class
1402             String x = (String) vh.getOpaque(0, 0);
1403         });
1404         checkWMTE(() -&gt; { // index reference class
1405             String x = (String) vh.getOpaque(array, Void.class);
1406         });
1407         // Incorrect return type
1408         checkCCE(() -&gt; { // reference class
1409             Void x = (Void) vh.getOpaque(array, 0);
1410         });
1411         checkWMTE(() -&gt; { // primitive class
1412             boolean x = (boolean) vh.getOpaque(array, 0);
1413         });
1414         // Incorrect arity
1415         checkWMTE(() -&gt; { // 0
1416             String x = (String) vh.getOpaque();
1417         });
1418         checkWMTE(() -&gt; { // &gt;
1419             String x = (String) vh.getOpaque(array, 0, Void.class);
1420         });
1421 
1422 
1423         // SetOpaque
1424         // Incorrect argument types
1425         checkNPE(() -&gt; { // null array
1426             vh.setOpaque(null, 0, &quot;foo&quot;);
1427         });
1428         checkCCE(() -&gt; { // array reference class
1429             vh.setOpaque(Void.class, 0, &quot;foo&quot;);
1430         });
1431         checkCCE(() -&gt; { // value reference class
1432             vh.setOpaque(array, 0, Void.class);
1433         });
1434         checkWMTE(() -&gt; { // receiver primitive class
1435             vh.setOpaque(0, 0, &quot;foo&quot;);
1436         });
1437         checkWMTE(() -&gt; { // index reference class
1438             vh.setOpaque(array, Void.class, &quot;foo&quot;);
1439         });
1440         // Incorrect arity
1441         checkWMTE(() -&gt; { // 0
1442             vh.setOpaque();
1443         });
1444         checkWMTE(() -&gt; { // &gt;
1445             vh.setOpaque(array, 0, &quot;foo&quot;, Void.class);
1446         });
1447 
1448 
1449         // GetAcquire
1450         // Incorrect argument types
1451         checkNPE(() -&gt; { // null array
1452             String x = (String) vh.getAcquire(null, 0);
1453         });
1454         checkCCE(() -&gt; { // array reference class
1455             String x = (String) vh.getAcquire(Void.class, 0);
1456         });
1457         checkWMTE(() -&gt; { // array primitive class
1458             String x = (String) vh.getAcquire(0, 0);
1459         });
1460         checkWMTE(() -&gt; { // index reference class
1461             String x = (String) vh.getAcquire(array, Void.class);
1462         });
1463         // Incorrect return type
1464         checkCCE(() -&gt; { // reference class
1465             Void x = (Void) vh.getAcquire(array, 0);
1466         });
1467         checkWMTE(() -&gt; { // primitive class
1468             boolean x = (boolean) vh.getAcquire(array, 0);
1469         });
1470         // Incorrect arity
1471         checkWMTE(() -&gt; { // 0
1472             String x = (String) vh.getAcquire();
1473         });
1474         checkWMTE(() -&gt; { // &gt;
1475             String x = (String) vh.getAcquire(array, 0, Void.class);
1476         });
1477 
1478 
1479         // SetRelease
1480         // Incorrect argument types
1481         checkNPE(() -&gt; { // null array
1482             vh.setRelease(null, 0, &quot;foo&quot;);
1483         });
1484         checkCCE(() -&gt; { // array reference class
1485             vh.setRelease(Void.class, 0, &quot;foo&quot;);
1486         });
1487         checkCCE(() -&gt; { // value reference class
1488             vh.setRelease(array, 0, Void.class);
1489         });
1490         checkWMTE(() -&gt; { // receiver primitive class
1491             vh.setRelease(0, 0, &quot;foo&quot;);
1492         });
1493         checkWMTE(() -&gt; { // index reference class
1494             vh.setRelease(array, Void.class, &quot;foo&quot;);
1495         });
1496         // Incorrect arity
1497         checkWMTE(() -&gt; { // 0
1498             vh.setRelease();
1499         });
1500         checkWMTE(() -&gt; { // &gt;
1501             vh.setRelease(array, 0, &quot;foo&quot;, Void.class);
1502         });
1503 
1504 
1505         // CompareAndSet
1506         // Incorrect argument types
1507         checkNPE(() -&gt; { // null receiver
1508             boolean r = vh.compareAndSet(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1509         });
1510         checkCCE(() -&gt; { // receiver reference class
1511             boolean r = vh.compareAndSet(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1512         });
1513         checkCCE(() -&gt; { // expected reference class
1514             boolean r = vh.compareAndSet(array, 0, Void.class, &quot;foo&quot;);
1515         });
1516         checkCCE(() -&gt; { // actual reference class
1517             boolean r = vh.compareAndSet(array, 0, &quot;foo&quot;, Void.class);
1518         });
1519         checkWMTE(() -&gt; { // receiver primitive class
1520             boolean r = vh.compareAndSet(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1521         });
1522         checkWMTE(() -&gt; { // index reference class
1523             boolean r = vh.compareAndSet(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1524         });
1525         // Incorrect arity
1526         checkWMTE(() -&gt; { // 0
1527             boolean r = vh.compareAndSet();
1528         });
1529         checkWMTE(() -&gt; { // &gt;
1530             boolean r = vh.compareAndSet(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1531         });
1532 
1533 
1534         // WeakCompareAndSet
1535         // Incorrect argument types
1536         checkNPE(() -&gt; { // null receiver
1537             boolean r = vh.weakCompareAndSetPlain(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1538         });
1539         checkCCE(() -&gt; { // receiver reference class
1540             boolean r = vh.weakCompareAndSetPlain(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1541         });
1542         checkCCE(() -&gt; { // expected reference class
1543             boolean r = vh.weakCompareAndSetPlain(array, 0, Void.class, &quot;foo&quot;);
1544         });
1545         checkCCE(() -&gt; { // actual reference class
1546             boolean r = vh.weakCompareAndSetPlain(array, 0, &quot;foo&quot;, Void.class);
1547         });
1548         checkWMTE(() -&gt; { // receiver primitive class
1549             boolean r = vh.weakCompareAndSetPlain(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1550         });
1551         checkWMTE(() -&gt; { // index reference class
1552             boolean r = vh.weakCompareAndSetPlain(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1553         });
1554         // Incorrect arity
1555         checkWMTE(() -&gt; { // 0
1556             boolean r = vh.weakCompareAndSetPlain();
1557         });
1558         checkWMTE(() -&gt; { // &gt;
1559             boolean r = vh.weakCompareAndSetPlain(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1560         });
1561 
1562 
1563         // WeakCompareAndSetVolatile
1564         // Incorrect argument types
1565         checkNPE(() -&gt; { // null receiver
1566             boolean r = vh.weakCompareAndSet(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1567         });
1568         checkCCE(() -&gt; { // receiver reference class
1569             boolean r = vh.weakCompareAndSet(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1570         });
1571         checkCCE(() -&gt; { // expected reference class
1572             boolean r = vh.weakCompareAndSet(array, 0, Void.class, &quot;foo&quot;);
1573         });
1574         checkCCE(() -&gt; { // actual reference class
1575             boolean r = vh.weakCompareAndSet(array, 0, &quot;foo&quot;, Void.class);
1576         });
1577         checkWMTE(() -&gt; { // receiver primitive class
1578             boolean r = vh.weakCompareAndSet(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1579         });
1580         checkWMTE(() -&gt; { // index reference class
1581             boolean r = vh.weakCompareAndSet(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1582         });
1583         // Incorrect arity
1584         checkWMTE(() -&gt; { // 0
1585             boolean r = vh.weakCompareAndSet();
1586         });
1587         checkWMTE(() -&gt; { // &gt;
1588             boolean r = vh.weakCompareAndSet(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1589         });
1590 
1591 
1592         // WeakCompareAndSetAcquire
1593         // Incorrect argument types
1594         checkNPE(() -&gt; { // null receiver
1595             boolean r = vh.weakCompareAndSetAcquire(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1596         });
1597         checkCCE(() -&gt; { // receiver reference class
1598             boolean r = vh.weakCompareAndSetAcquire(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1599         });
1600         checkCCE(() -&gt; { // expected reference class
1601             boolean r = vh.weakCompareAndSetAcquire(array, 0, Void.class, &quot;foo&quot;);
1602         });
1603         checkCCE(() -&gt; { // actual reference class
1604             boolean r = vh.weakCompareAndSetAcquire(array, 0, &quot;foo&quot;, Void.class);
1605         });
1606         checkWMTE(() -&gt; { // receiver primitive class
1607             boolean r = vh.weakCompareAndSetAcquire(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1608         });
1609         checkWMTE(() -&gt; { // index reference class
1610             boolean r = vh.weakCompareAndSetAcquire(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1611         });
1612         // Incorrect arity
1613         checkWMTE(() -&gt; { // 0
1614             boolean r = vh.weakCompareAndSetAcquire();
1615         });
1616         checkWMTE(() -&gt; { // &gt;
1617             boolean r = vh.weakCompareAndSetAcquire(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1618         });
1619 
1620 
1621         // WeakCompareAndSetRelease
1622         // Incorrect argument types
1623         checkNPE(() -&gt; { // null receiver
1624             boolean r = vh.weakCompareAndSetRelease(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1625         });
1626         checkCCE(() -&gt; { // receiver reference class
1627             boolean r = vh.weakCompareAndSetRelease(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1628         });
1629         checkCCE(() -&gt; { // expected reference class
1630             boolean r = vh.weakCompareAndSetRelease(array, 0, Void.class, &quot;foo&quot;);
1631         });
1632         checkCCE(() -&gt; { // actual reference class
1633             boolean r = vh.weakCompareAndSetRelease(array, 0, &quot;foo&quot;, Void.class);
1634         });
1635         checkWMTE(() -&gt; { // receiver primitive class
1636             boolean r = vh.weakCompareAndSetRelease(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1637         });
1638         checkWMTE(() -&gt; { // index reference class
1639             boolean r = vh.weakCompareAndSetRelease(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1640         });
1641         // Incorrect arity
1642         checkWMTE(() -&gt; { // 0
1643             boolean r = vh.weakCompareAndSetRelease();
1644         });
1645         checkWMTE(() -&gt; { // &gt;
1646             boolean r = vh.weakCompareAndSetRelease(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1647         });
1648 
1649 
1650         // CompareAndExchange
1651         // Incorrect argument types
1652         checkNPE(() -&gt; { // null receiver
1653             String x = (String) vh.compareAndExchange(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1654         });
1655         checkCCE(() -&gt; { // array reference class
1656             String x = (String) vh.compareAndExchange(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1657         });
1658         checkCCE(() -&gt; { // expected reference class
1659             String x = (String) vh.compareAndExchange(array, 0, Void.class, &quot;foo&quot;);
1660         });
1661         checkCCE(() -&gt; { // actual reference class
1662             String x = (String) vh.compareAndExchange(array, 0, &quot;foo&quot;, Void.class);
1663         });
1664         checkWMTE(() -&gt; { // array primitive class
1665             String x = (String) vh.compareAndExchange(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1666         });
1667         checkWMTE(() -&gt; { // index reference class
1668             String x = (String) vh.compareAndExchange(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1669         });
1670         // Incorrect return type
1671         checkCCE(() -&gt; { // reference class
1672             Void r = (Void) vh.compareAndExchange(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1673         });
1674         checkWMTE(() -&gt; { // primitive class
1675             boolean x = (boolean) vh.compareAndExchange(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1676         });
1677         // Incorrect arity
1678         checkWMTE(() -&gt; { // 0
1679             String x = (String) vh.compareAndExchange();
1680         });
1681         checkWMTE(() -&gt; { // &gt;
1682             String x = (String) vh.compareAndExchange(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1683         });
1684 
1685 
1686         // CompareAndExchangeAcquire
1687         // Incorrect argument types
1688         checkNPE(() -&gt; { // null receiver
1689             String x = (String) vh.compareAndExchangeAcquire(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1690         });
1691         checkCCE(() -&gt; { // array reference class
1692             String x = (String) vh.compareAndExchangeAcquire(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1693         });
1694         checkCCE(() -&gt; { // expected reference class
1695             String x = (String) vh.compareAndExchangeAcquire(array, 0, Void.class, &quot;foo&quot;);
1696         });
1697         checkCCE(() -&gt; { // actual reference class
1698             String x = (String) vh.compareAndExchangeAcquire(array, 0, &quot;foo&quot;, Void.class);
1699         });
1700         checkWMTE(() -&gt; { // array primitive class
1701             String x = (String) vh.compareAndExchangeAcquire(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1702         });
1703         checkWMTE(() -&gt; { // index reference class
1704             String x = (String) vh.compareAndExchangeAcquire(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1705         });
1706         // Incorrect return type
1707         checkCCE(() -&gt; { // reference class
1708             Void r = (Void) vh.compareAndExchangeAcquire(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1709         });
1710         checkWMTE(() -&gt; { // primitive class
1711             boolean x = (boolean) vh.compareAndExchangeAcquire(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1712         });
1713         // Incorrect arity
1714         checkWMTE(() -&gt; { // 0
1715             String x = (String) vh.compareAndExchangeAcquire();
1716         });
1717         checkWMTE(() -&gt; { // &gt;
1718             String x = (String) vh.compareAndExchangeAcquire(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1719         });
1720 
1721 
1722         // CompareAndExchangeRelease
1723         // Incorrect argument types
1724         checkNPE(() -&gt; { // null receiver
1725             String x = (String) vh.compareAndExchangeRelease(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1726         });
1727         checkCCE(() -&gt; { // array reference class
1728             String x = (String) vh.compareAndExchangeRelease(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1729         });
1730         checkCCE(() -&gt; { // expected reference class
1731             String x = (String) vh.compareAndExchangeRelease(array, 0, Void.class, &quot;foo&quot;);
1732         });
1733         checkCCE(() -&gt; { // actual reference class
1734             String x = (String) vh.compareAndExchangeRelease(array, 0, &quot;foo&quot;, Void.class);
1735         });
1736         checkWMTE(() -&gt; { // array primitive class
1737             String x = (String) vh.compareAndExchangeRelease(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1738         });
1739         checkWMTE(() -&gt; { // index reference class
1740             String x = (String) vh.compareAndExchangeRelease(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1741         });
1742         // Incorrect return type
1743         checkCCE(() -&gt; { // reference class
1744             Void r = (Void) vh.compareAndExchangeRelease(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1745         });
1746         checkWMTE(() -&gt; { // primitive class
1747             boolean x = (boolean) vh.compareAndExchangeRelease(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1748         });
1749         // Incorrect arity
1750         checkWMTE(() -&gt; { // 0
1751             String x = (String) vh.compareAndExchangeRelease();
1752         });
1753         checkWMTE(() -&gt; { // &gt;
1754             String x = (String) vh.compareAndExchangeRelease(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1755         });
1756 
1757 
1758         // GetAndSet
1759         // Incorrect argument types
1760         checkNPE(() -&gt; { // null array
1761             String x = (String) vh.getAndSet(null, 0, &quot;foo&quot;);
1762         });
1763         checkCCE(() -&gt; { // array reference class
1764             String x = (String) vh.getAndSet(Void.class, 0, &quot;foo&quot;);
1765         });
1766         checkCCE(() -&gt; { // value reference class
1767             String x = (String) vh.getAndSet(array, 0, Void.class);
1768         });
1769         checkWMTE(() -&gt; { // reciarrayever primitive class
1770             String x = (String) vh.getAndSet(0, 0, &quot;foo&quot;);
1771         });
1772         checkWMTE(() -&gt; { // index reference class
1773             String x = (String) vh.getAndSet(array, Void.class, &quot;foo&quot;);
1774         });
1775         // Incorrect return type
1776         checkCCE(() -&gt; { // reference class
1777             Void r = (Void) vh.getAndSet(array, 0, &quot;foo&quot;);
1778         });
1779         checkWMTE(() -&gt; { // primitive class
1780             boolean x = (boolean) vh.getAndSet(array, 0, &quot;foo&quot;);
1781         });
1782         // Incorrect arity
1783         checkWMTE(() -&gt; { // 0
1784             String x = (String) vh.getAndSet();
1785         });
1786         checkWMTE(() -&gt; { // &gt;
1787             String x = (String) vh.getAndSet(array, 0, &quot;foo&quot;, Void.class);
1788         });
1789 
1790 
1791         // GetAndSetAcquire
1792         // Incorrect argument types
1793         checkNPE(() -&gt; { // null array
1794             String x = (String) vh.getAndSetAcquire(null, 0, &quot;foo&quot;);
1795         });
1796         checkCCE(() -&gt; { // array reference class
1797             String x = (String) vh.getAndSetAcquire(Void.class, 0, &quot;foo&quot;);
1798         });
1799         checkCCE(() -&gt; { // value reference class
1800             String x = (String) vh.getAndSetAcquire(array, 0, Void.class);
1801         });
1802         checkWMTE(() -&gt; { // reciarrayever primitive class
1803             String x = (String) vh.getAndSetAcquire(0, 0, &quot;foo&quot;);
1804         });
1805         checkWMTE(() -&gt; { // index reference class
1806             String x = (String) vh.getAndSetAcquire(array, Void.class, &quot;foo&quot;);
1807         });
1808         // Incorrect return type
1809         checkCCE(() -&gt; { // reference class
1810             Void r = (Void) vh.getAndSetAcquire(array, 0, &quot;foo&quot;);
1811         });
1812         checkWMTE(() -&gt; { // primitive class
1813             boolean x = (boolean) vh.getAndSetAcquire(array, 0, &quot;foo&quot;);
1814         });
1815         // Incorrect arity
1816         checkWMTE(() -&gt; { // 0
1817             String x = (String) vh.getAndSetAcquire();
1818         });
1819         checkWMTE(() -&gt; { // &gt;
1820             String x = (String) vh.getAndSetAcquire(array, 0, &quot;foo&quot;, Void.class);
1821         });
1822 
1823 
1824         // GetAndSetRelease
1825         // Incorrect argument types
1826         checkNPE(() -&gt; { // null array
1827             String x = (String) vh.getAndSetRelease(null, 0, &quot;foo&quot;);
1828         });
1829         checkCCE(() -&gt; { // array reference class
1830             String x = (String) vh.getAndSetRelease(Void.class, 0, &quot;foo&quot;);
1831         });
1832         checkCCE(() -&gt; { // value reference class
1833             String x = (String) vh.getAndSetRelease(array, 0, Void.class);
1834         });
1835         checkWMTE(() -&gt; { // reciarrayever primitive class
1836             String x = (String) vh.getAndSetRelease(0, 0, &quot;foo&quot;);
1837         });
1838         checkWMTE(() -&gt; { // index reference class
1839             String x = (String) vh.getAndSetRelease(array, Void.class, &quot;foo&quot;);
1840         });
1841         // Incorrect return type
1842         checkCCE(() -&gt; { // reference class
1843             Void r = (Void) vh.getAndSetRelease(array, 0, &quot;foo&quot;);
1844         });
1845         checkWMTE(() -&gt; { // primitive class
1846             boolean x = (boolean) vh.getAndSetRelease(array, 0, &quot;foo&quot;);
1847         });
1848         // Incorrect arity
1849         checkWMTE(() -&gt; { // 0
1850             String x = (String) vh.getAndSetRelease();
1851         });
1852         checkWMTE(() -&gt; { // &gt;
1853             String x = (String) vh.getAndSetRelease(array, 0, &quot;foo&quot;, Void.class);
1854         });
1855 
1856 
1857     }
1858 
1859     static void testArrayWrongMethodType(Handles hs) throws Throwable {
1860         String[] array = new String[10];
1861         Arrays.fill(array, &quot;foo&quot;);
1862 
1863         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET)) {
1864             // Incorrect argument types
1865             checkNPE(() -&gt; { // null array
1866                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class)).
1867                     invokeExact((String[]) null, 0);
1868             });
1869             hs.checkWMTEOrCCE(() -&gt; { // array reference class
1870                 String x = (String) hs.get(am, methodType(String.class, Class.class, int.class)).
1871                     invokeExact(Void.class, 0);
1872             });
1873             checkWMTE(() -&gt; { // array primitive class
1874                 String x = (String) hs.get(am, methodType(String.class, int.class, int.class)).
1875                     invokeExact(0, 0);
1876             });
1877             checkWMTE(() -&gt; { // index reference class
1878                 String x = (String) hs.get(am, methodType(String.class, String[].class, Class.class)).
1879                     invokeExact(array, Void.class);
1880             });
1881             // Incorrect return type
1882             hs.checkWMTEOrCCE(() -&gt; { // reference class
1883                 Void x = (Void) hs.get(am, methodType(Void.class, String[].class, int.class)).
1884                     invokeExact(array, 0);
1885             });
1886             checkWMTE(() -&gt; { // primitive class
1887                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class)).
1888                     invokeExact(array, 0);
1889             });
1890             // Incorrect arity
1891             checkWMTE(() -&gt; { // 0
1892                 String x = (String) hs.get(am, methodType(String.class)).
1893                     invokeExact();
1894             });
1895             checkWMTE(() -&gt; { // &gt;
1896                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, Class.class)).
1897                     invokeExact(array, 0, Void.class);
1898             });
1899         }
1900 
1901         for (TestAccessMode am : testAccessModesOfType(TestAccessType.SET)) {
1902             // Incorrect argument types
1903             checkNPE(() -&gt; { // null array
1904                 hs.get(am, methodType(void.class, String[].class, int.class, String.class)).
1905                     invokeExact((String[]) null, 0, &quot;foo&quot;);
1906             });
1907             hs.checkWMTEOrCCE(() -&gt; { // array reference class
1908                 hs.get(am, methodType(void.class, Class.class, int.class, String.class)).
1909                     invokeExact(Void.class, 0, &quot;foo&quot;);
1910             });
1911             hs.checkWMTEOrCCE(() -&gt; { // value reference class
1912                 hs.get(am, methodType(void.class, String[].class, int.class, Class.class)).
1913                     invokeExact(array, 0, Void.class);
1914             });
1915             checkWMTE(() -&gt; { // receiver primitive class
1916                 hs.get(am, methodType(void.class, int.class, int.class, String.class)).
1917                     invokeExact(0, 0, &quot;foo&quot;);
1918             });
1919             checkWMTE(() -&gt; { // index reference class
1920                 hs.get(am, methodType(void.class, String[].class, Class.class, String.class)).
1921                     invokeExact(array, Void.class, &quot;foo&quot;);
1922             });
1923             // Incorrect arity
1924             checkWMTE(() -&gt; { // 0
1925                 hs.get(am, methodType(void.class)).
1926                     invokeExact();
1927             });
1928             checkWMTE(() -&gt; { // &gt;
1929                 hs.get(am, methodType(void.class, String[].class, int.class, Class.class)).
1930                     invokeExact(array, 0, &quot;foo&quot;, Void.class);
1931             });
1932         }
1933         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_SET)) {
1934             // Incorrect argument types
1935             checkNPE(() -&gt; { // null receiver
1936                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class, String.class)).
1937                     invokeExact((String[]) null, 0, &quot;foo&quot;, &quot;foo&quot;);
1938             });
1939             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
1940                 boolean r = (boolean) hs.get(am, methodType(boolean.class, Class.class, int.class, String.class, String.class)).
1941                     invokeExact(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1942             });
1943             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
1944                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, Class.class, String.class)).
1945                     invokeExact(array, 0, Void.class, &quot;foo&quot;);
1946             });
1947             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
1948                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class, Class.class)).
1949                     invokeExact(array, 0, &quot;foo&quot;, Void.class);
1950             });
1951             checkWMTE(() -&gt; { // receiver primitive class
1952                 boolean r = (boolean) hs.get(am, methodType(boolean.class, int.class, int.class, String.class, String.class)).
1953                     invokeExact(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1954             });
1955             checkWMTE(() -&gt; { // index reference class
1956                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, Class.class, String.class, String.class)).
1957                     invokeExact(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1958             });
1959             // Incorrect arity
1960             checkWMTE(() -&gt; { // 0
1961                 boolean r = (boolean) hs.get(am, methodType(boolean.class)).
1962                     invokeExact();
1963             });
1964             checkWMTE(() -&gt; { // &gt;
1965                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class, String.class, Class.class)).
1966                     invokeExact(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1967             });
1968         }
1969 
1970         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_EXCHANGE)) {
1971             // Incorrect argument types
1972             checkNPE(() -&gt; { // null receiver
1973                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class, String.class)).
1974                     invokeExact((String[]) null, 0, &quot;foo&quot;, &quot;foo&quot;);
1975             });
1976             hs.checkWMTEOrCCE(() -&gt; { // array reference class
1977                 String x = (String) hs.get(am, methodType(String.class, Class.class, int.class, String.class, String.class)).
1978                     invokeExact(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1979             });
1980             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
1981                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, Class.class, String.class)).
1982                     invokeExact(array, 0, Void.class, &quot;foo&quot;);
1983             });
1984             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
1985                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class, Class.class)).
1986                     invokeExact(array, 0, &quot;foo&quot;, Void.class);
1987             });
1988             checkWMTE(() -&gt; { // array primitive class
1989                 String x = (String) hs.get(am, methodType(String.class, int.class, int.class, String.class, String.class)).
1990                     invokeExact(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1991             });
1992             checkWMTE(() -&gt; { // index reference class
1993                 String x = (String) hs.get(am, methodType(String.class, String[].class, Class.class, String.class, String.class)).
1994                     invokeExact(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1995             });
1996             // Incorrect return type
1997             hs.checkWMTEOrCCE(() -&gt; { // reference class
1998                 Void r = (Void) hs.get(am, methodType(Void.class, String[].class, int.class, String.class, String.class)).
1999                     invokeExact(array, 0, &quot;foo&quot;, &quot;foo&quot;);
2000             });
2001             checkWMTE(() -&gt; { // primitive class
2002                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class, String.class)).
2003                     invokeExact(array, 0, &quot;foo&quot;, &quot;foo&quot;);
2004             });
2005             // Incorrect arity
2006             checkWMTE(() -&gt; { // 0
2007                 String x = (String) hs.get(am, methodType(String.class)).
2008                     invokeExact();
2009             });
2010             checkWMTE(() -&gt; { // &gt;
2011                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class, String.class, Class.class)).
2012                     invokeExact(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
2013             });
2014         }
2015 
2016         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET_AND_SET)) {
2017             // Incorrect argument types
2018             checkNPE(() -&gt; { // null array
2019                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class)).
2020                     invokeExact((String[]) null, 0, &quot;foo&quot;);
2021             });
2022             hs.checkWMTEOrCCE(() -&gt; { // array reference class
2023                 String x = (String) hs.get(am, methodType(String.class, Class.class, int.class, String.class)).
2024                     invokeExact(Void.class, 0, &quot;foo&quot;);
2025             });
2026             hs.checkWMTEOrCCE(() -&gt; { // value reference class
2027                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, Class.class)).
2028                     invokeExact(array, 0, Void.class);
2029             });
2030             checkWMTE(() -&gt; { // array primitive class
2031                 String x = (String) hs.get(am, methodType(String.class, int.class, int.class, String.class)).
2032                     invokeExact(0, 0, &quot;foo&quot;);
2033             });
2034             checkWMTE(() -&gt; { // index reference class
2035                 String x = (String) hs.get(am, methodType(String.class, String[].class, Class.class, String.class)).
2036                     invokeExact(array, Void.class, &quot;foo&quot;);
2037             });
2038             // Incorrect return type
2039             hs.checkWMTEOrCCE(() -&gt; { // reference class
2040                 Void r = (Void) hs.get(am, methodType(Void.class, String[].class, int.class, String.class)).
2041                     invokeExact(array, 0, &quot;foo&quot;);
2042             });
2043             checkWMTE(() -&gt; { // primitive class
2044                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class)).
2045                     invokeExact(array, 0, &quot;foo&quot;);
2046             });
2047             // Incorrect arity
2048             checkWMTE(() -&gt; { // 0
2049                 String x = (String) hs.get(am, methodType(String.class)).
2050                     invokeExact();
2051             });
2052             checkWMTE(() -&gt; { // &gt;
2053                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class, Class.class)).
2054                     invokeExact(array, 0, &quot;foo&quot;, Void.class);
2055             });
2056         }
2057 
2058 
2059     }
2060 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>