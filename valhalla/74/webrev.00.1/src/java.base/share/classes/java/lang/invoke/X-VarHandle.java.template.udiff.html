<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/java/lang/invoke/X-VarHandle.java.template</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="VarHandles.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../module-info.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/lang/invoke/X-VarHandle.java.template</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -78,170 +78,178 @@</span>
  
          @ForceInline
          static $type$ get(VarHandle ob, Object holder) {
              FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
              return UNSAFE.get$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                  handle.fieldOffset);</span>
<span class="udiff-line-modified-added">+                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
          }
  
          @ForceInline
          static $type$ getVolatile(VarHandle ob, Object holder) {
              FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
              return UNSAFE.get$Type$Volatile(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                  handle.fieldOffset);</span>
<span class="udiff-line-modified-added">+                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
          }
  
          @ForceInline
          static $type$ getOpaque(VarHandle ob, Object holder) {
              FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
              return UNSAFE.get$Type$Opaque(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                  handle.fieldOffset);</span>
<span class="udiff-line-modified-added">+                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
          }
  
          @ForceInline
          static $type$ getAcquire(VarHandle ob, Object holder) {
              FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
              return UNSAFE.get$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                  handle.fieldOffset);</span>
<span class="udiff-line-modified-added">+                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
          }
  
          static final VarForm FORM = new VarForm(FieldInstanceReadOnly.class, Object.class, $type$.class);
      }
  
      static final class FieldInstanceReadWrite extends FieldInstanceReadOnly {
<span class="udiff-line-removed">- </span>
          FieldInstanceReadWrite(Class&lt;?&gt; receiverType, long fieldOffset{#if[Object]?, Class&lt;?&gt; fieldType}) {
              super(receiverType, fieldOffset{#if[Object]?, fieldType}, FieldInstanceReadWrite.FORM);
          }
  
<span class="udiff-line-added">+ #if[Object]</span>
<span class="udiff-line-added">+         @ForceInline</span>
<span class="udiff-line-added">+         static Object checkCast(FieldInstanceReadWrite handle, $type$ value) {</span>
<span class="udiff-line-added">+             if (handle.fieldType.isInlineClass())</span>
<span class="udiff-line-added">+                 Objects.requireNonNull(value);</span>
<span class="udiff-line-added">+             return handle.fieldType.cast(value);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ #end[Object]</span>
<span class="udiff-line-added">+ </span>
          @ForceInline
          static void set(VarHandle ob, Object holder, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              UNSAFE.put$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                              handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                              {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                              handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                              {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static void setVolatile(VarHandle ob, Object holder, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              UNSAFE.put$Type$Volatile(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                      handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                      {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                      handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                      {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static void setOpaque(VarHandle ob, Object holder, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              UNSAFE.put$Type$Opaque(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                    handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                    {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                    handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                    {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static void setRelease(VarHandle ob, Object holder, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              UNSAFE.put$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                     handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                     {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                     handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                     {#if[Object]?checkCast(handle, value):value});</span>
          }
  #if[CAS]
  
          @ForceInline
          static boolean compareAndSet(VarHandle ob, Object holder, $type$ expected, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.compareAndSet$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ compareAndExchange(VarHandle ob, Object holder, $type$ expected, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.compareAndExchange$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ compareAndExchangeAcquire(VarHandle ob, Object holder, $type$ expected, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.compareAndExchange$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ compareAndExchangeRelease(VarHandle ob, Object holder, $type$ expected, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.compareAndExchange$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static boolean weakCompareAndSetPlain(VarHandle ob, Object holder, $type$ expected, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.weakCompareAndSet$Type$Plain(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static boolean weakCompareAndSet(VarHandle ob, Object holder, $type$ expected, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.weakCompareAndSet$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static boolean weakCompareAndSetAcquire(VarHandle ob, Object holder, $type$ expected, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.weakCompareAndSet$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static boolean weakCompareAndSetRelease(VarHandle ob, Object holder, $type$ expected, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.weakCompareAndSet$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ getAndSet(VarHandle ob, Object holder, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.getAndSet$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                           handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                           {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ getAndSetAcquire(VarHandle ob, Object holder, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.getAndSet$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                           handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                           {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ getAndSetRelease(VarHandle ob, Object holder, $type$ value) {
              FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
              return UNSAFE.getAndSet$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="udiff-line-modified-removed">-                                           handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                           {#if[Object]?checkCast(handle, value):value});</span>
          }
  #end[CAS]
  #if[AtomicAdd]
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -391,171 +399,178 @@</span>
  
          @ForceInline
          static $type$ get(VarHandle ob) {
              FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
              return UNSAFE.get$Type$(handle.base,
<span class="udiff-line-modified-removed">-                                  handle.fieldOffset);</span>
<span class="udiff-line-modified-added">+                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
          }
  
          @ForceInline
          static $type$ getVolatile(VarHandle ob) {
              FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
              return UNSAFE.get$Type$Volatile(handle.base,
<span class="udiff-line-modified-removed">-                                  handle.fieldOffset);</span>
<span class="udiff-line-modified-added">+                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
          }
  
          @ForceInline
          static $type$ getOpaque(VarHandle ob) {
              FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
              return UNSAFE.get$Type$Opaque(handle.base,
<span class="udiff-line-modified-removed">-                                  handle.fieldOffset);</span>
<span class="udiff-line-modified-added">+                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
          }
  
          @ForceInline
          static $type$ getAcquire(VarHandle ob) {
              FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
              return UNSAFE.get$Type$Acquire(handle.base,
<span class="udiff-line-modified-removed">-                                  handle.fieldOffset);</span>
<span class="udiff-line-modified-added">+                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
          }
  
          static final VarForm FORM = new VarForm(FieldStaticReadOnly.class, null, $type$.class);
      }
  
      static final class FieldStaticReadWrite extends FieldStaticReadOnly {
<span class="udiff-line-removed">- </span>
          FieldStaticReadWrite(Object base, long fieldOffset{#if[Object]?, Class&lt;?&gt; fieldType}) {
              super(base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadWrite.FORM);
          }
  
<span class="udiff-line-added">+ #if[Object]</span>
<span class="udiff-line-added">+         static Object checkCast(FieldStaticReadWrite handle, $type$ value) {</span>
<span class="udiff-line-added">+             if (handle.fieldType.isInlineClass())</span>
<span class="udiff-line-added">+                 Objects.requireNonNull(value);</span>
<span class="udiff-line-added">+             return handle.fieldType.cast(value);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ #end[Object]</span>
<span class="udiff-line-added">+ </span>
          @ForceInline
          static void set(VarHandle ob, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              UNSAFE.put$Type$(handle.base,
<span class="udiff-line-modified-removed">-                              handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                              {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                              handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                              {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static void setVolatile(VarHandle ob, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              UNSAFE.put$Type$Volatile(handle.base,
<span class="udiff-line-modified-removed">-                                      handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                      {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                      handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                      {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static void setOpaque(VarHandle ob, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              UNSAFE.put$Type$Opaque(handle.base,
<span class="udiff-line-modified-removed">-                                    handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                    {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                    handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                    {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static void setRelease(VarHandle ob, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              UNSAFE.put$Type$Release(handle.base,
<span class="udiff-line-modified-removed">-                                     handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                     {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                     handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                     {#if[Object]?checkCast(handle, value):value});</span>
          }
  #if[CAS]
  
          @ForceInline
          static boolean compareAndSet(VarHandle ob, $type$ expected, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.compareAndSet$Type$(handle.base,
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
  
          @ForceInline
          static $type$ compareAndExchange(VarHandle ob, $type$ expected, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.compareAndExchange$Type$(handle.base,
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ compareAndExchangeAcquire(VarHandle ob, $type$ expected, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.compareAndExchange$Type$Acquire(handle.base,
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ compareAndExchangeRelease(VarHandle ob, $type$ expected, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.compareAndExchange$Type$Release(handle.base,
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static boolean weakCompareAndSetPlain(VarHandle ob, $type$ expected, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.weakCompareAndSet$Type$Plain(handle.base,
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static boolean weakCompareAndSet(VarHandle ob, $type$ expected, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.weakCompareAndSet$Type$(handle.base,
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static boolean weakCompareAndSetAcquire(VarHandle ob, $type$ expected, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.weakCompareAndSet$Type$Acquire(handle.base,
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static boolean weakCompareAndSetRelease(VarHandle ob, $type$ expected, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.weakCompareAndSet$Type$Release(handle.base,
<span class="udiff-line-modified-removed">-                                                handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="udiff-line-modified-removed">-                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="udiff-line-modified-added">+                                                {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ getAndSet(VarHandle ob, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.getAndSet$Type$(handle.base,
<span class="udiff-line-modified-removed">-                                           handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                           {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ getAndSetAcquire(VarHandle ob, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.getAndSet$Type$Acquire(handle.base,
<span class="udiff-line-modified-removed">-                                           handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                           {#if[Object]?checkCast(handle, value):value});</span>
          }
  
          @ForceInline
          static $type$ getAndSetRelease(VarHandle ob, $type$ value) {
              FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
              return UNSAFE.getAndSet$Type$Release(handle.base,
<span class="udiff-line-modified-removed">-                                           handle.fieldOffset,</span>
<span class="udiff-line-modified-removed">-                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
<span class="udiff-line-modified-added">+                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="udiff-line-modified-added">+                                           {#if[Object]?checkCast(handle, value):value});</span>
          }
  #end[CAS]
  #if[AtomicAdd]
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -658,10 +673,18 @@</span>
  #end[Bitwise]
  
          static final VarForm FORM = new VarForm(FieldStaticReadWrite.class, null, $type$.class);
      }
  
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+     static VarHandle makeVarHandleValuesArray(Class&lt;?&gt; arrayClass) {</span>
<span class="udiff-line-added">+         Class&lt;?&gt; componentType = arrayClass.getComponentType();</span>
<span class="udiff-line-added">+         assert componentType.isInlineClass() &amp;&amp; UNSAFE.isFlattenedArray(arrayClass);</span>
<span class="udiff-line-added">+         // should cache these VarHandle for performance</span>
<span class="udiff-line-added">+         return VarHandles.makeArrayElementHandle(arrayClass);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
  
      static final class Array extends VarHandle {
          final int abase;
          final int ashift;
  #if[Object]
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -694,10 +717,13 @@</span>
          }
  
  #if[Object]
          @ForceInline
          static Object runtimeTypeCheck(Array handle, Object[] oarray, Object value) {
<span class="udiff-line-added">+             if (handle.componentType.isInlineClass())</span>
<span class="udiff-line-added">+                  Objects.requireNonNull(value);</span>
<span class="udiff-line-added">+ </span>
              if (handle.arrayType == oarray.getClass()) {
                  // Fast path: static array type same as argument array type
                  return handle.componentType.cast(value);
              } else {
                  // Slow path: check value against argument array component type
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -732,35 +758,58 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-modified-removed">-             array[index] = {#if[Object]?handle.componentType.cast(value):value};</span>
<span class="udiff-line-modified-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 vh.set(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+                 return;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
<span class="udiff-line-added">+             array[index] = {#if[Object]?runtimeTypeCheck(handle, array, value):value};</span>
          }
  
          @ForceInline
          static $type$ getVolatile(VarHandle ob, Object oarray, int index) {
              Array handle = (Array)ob;
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.getVolatile(oarray, index);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.get$Type$Volatile(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase);</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType});</span>
          }
  
          @ForceInline
          static void setVolatile(VarHandle ob, Object oarray, int index, $type$ value) {
              Array handle = (Array)ob;
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 vh.setVolatile(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+                 return;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              UNSAFE.put$Type$Volatile(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
          static $type$ getOpaque(VarHandle ob, Object oarray, int index) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -768,24 +817,39 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.getOpaque(oarray, index);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.get$Type$Opaque(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase);</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType});</span>
          }
  
          @ForceInline
          static void setOpaque(VarHandle ob, Object oarray, int index, $type$ value) {
              Array handle = (Array)ob;
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 vh.setOpaque(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+                 return;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              UNSAFE.put$Type$Opaque(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
          static $type$ getAcquire(VarHandle ob, Object oarray, int index) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -793,24 +857,39 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.getAcquire(oarray, index);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.get$Type$Acquire(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase);</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType});</span>
          }
  
          @ForceInline
          static void setRelease(VarHandle ob, Object oarray, int index, $type$ value) {
              Array handle = (Array)ob;
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 vh.setRelease(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+                 return;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              UNSAFE.put$Type$Release(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  #if[CAS]
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -819,12 +898,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.compareAndSet(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.compareAndSet$Type$(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
                      {#if[Object]?handle.componentType.cast(expected):expected},
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -833,12 +919,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.compareAndExchange(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.compareAndExchange$Type$(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
                      {#if[Object]?handle.componentType.cast(expected):expected},
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -847,12 +940,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.compareAndExchangeAcquire(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.compareAndExchange$Type$Acquire(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
                      {#if[Object]?handle.componentType.cast(expected):expected},
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -861,12 +961,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.compareAndExchangeRelease(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.compareAndExchange$Type$Release(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
                      {#if[Object]?handle.componentType.cast(expected):expected},
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -875,12 +982,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.weakCompareAndSetPlain(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.weakCompareAndSet$Type$Plain(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
                      {#if[Object]?handle.componentType.cast(expected):expected},
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -889,12 +1003,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.weakCompareAndSet(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.weakCompareAndSet$Type$(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
                      {#if[Object]?handle.componentType.cast(expected):expected},
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -903,12 +1024,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.weakCompareAndSetAcquire(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.weakCompareAndSet$Type$Acquire(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
                      {#if[Object]?handle.componentType.cast(expected):expected},
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -917,12 +1045,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.weakCompareAndSetRelease(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.weakCompareAndSet$Type$Release(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
                      {#if[Object]?handle.componentType.cast(expected):expected},
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -931,12 +1066,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.getAndSet(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.getAndSet$Type$(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
          static $type$ getAndSetAcquire(VarHandle ob, Object oarray, int index, $type$ value) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -944,12 +1086,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.getAndSetAcquire(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.getAndSet$Type$Acquire(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  
          @ForceInline
          static $type$ getAndSetRelease(VarHandle ob, Object oarray, int index, $type$ value) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -957,12 +1106,19 @@</span>
  #if[Object]
              Object[] array = (Object[]) handle.arrayType.cast(oarray);
  #else[Object]
              $type$[] array = ($type$[]) oarray;
  #end[Object]
<span class="udiff-line-added">+ #if[Reference]</span>
<span class="udiff-line-added">+             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="udiff-line-added">+                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="udiff-line-added">+                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="udiff-line-added">+                 return vh.getAndSetRelease(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ #end[Reference]</span>
              return UNSAFE.getAndSet$Type$Release(array,
<span class="udiff-line-modified-removed">-                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
<span class="udiff-line-modified-added">+                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
                      {#if[Object]?runtimeTypeCheck(handle, array, value):value});
          }
  #end[CAS]
  #if[AtomicAdd]
  
</pre>
<center><a href="VarHandles.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../module-info.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>