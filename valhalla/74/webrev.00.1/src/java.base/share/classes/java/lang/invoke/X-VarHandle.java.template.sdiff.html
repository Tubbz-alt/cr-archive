<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/lang/invoke/X-VarHandle.java.template</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="VarHandles.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../module-info.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/lang/invoke/X-VarHandle.java.template</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  63             return accessMode.at.accessModeType(receiverType, {#if[Object]?fieldType:$type$.class});
  64         }
  65 
  66         @Override
  67         public Optional&lt;VarHandleDesc&gt; describeConstable() {
  68             var receiverTypeRef = receiverType.describeConstable();
  69             var fieldTypeRef = {#if[Object]?fieldType:$type$.class}.describeConstable();
  70             if (!receiverTypeRef.isPresent() || !fieldTypeRef.isPresent())
  71                 return Optional.empty();
  72 
  73             // Reflect on this VarHandle to extract the field name
  74             String name = VarHandles.getFieldFromReceiverAndOffset(
  75                 receiverType, fieldOffset, {#if[Object]?fieldType:$type$.class}).getName();
  76             return Optional.of(VarHandleDesc.ofField(receiverTypeRef.get(), name, fieldTypeRef.get()));
  77         }
  78 
  79         @ForceInline
  80         static $type$ get(VarHandle ob, Object holder) {
  81             FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
  82             return UNSAFE.get$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified">  83                                  handle.fieldOffset);</span>
  84         }
  85 
  86         @ForceInline
  87         static $type$ getVolatile(VarHandle ob, Object holder) {
  88             FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
  89             return UNSAFE.get$Type$Volatile(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified">  90                                  handle.fieldOffset);</span>
  91         }
  92 
  93         @ForceInline
  94         static $type$ getOpaque(VarHandle ob, Object holder) {
  95             FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
  96             return UNSAFE.get$Type$Opaque(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified">  97                                  handle.fieldOffset);</span>
  98         }
  99 
 100         @ForceInline
 101         static $type$ getAcquire(VarHandle ob, Object holder) {
 102             FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
 103             return UNSAFE.get$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 104                                  handle.fieldOffset);</span>
 105         }
 106 
 107         static final VarForm FORM = new VarForm(FieldInstanceReadOnly.class, Object.class, $type$.class);
 108     }
 109 
 110     static final class FieldInstanceReadWrite extends FieldInstanceReadOnly {
<span class="line-removed"> 111 </span>
 112         FieldInstanceReadWrite(Class&lt;?&gt; receiverType, long fieldOffset{#if[Object]?, Class&lt;?&gt; fieldType}) {
 113             super(receiverType, fieldOffset{#if[Object]?, fieldType}, FieldInstanceReadWrite.FORM);
 114         }
 115 









 116         @ForceInline
 117         static void set(VarHandle ob, Object holder, $type$ value) {
 118             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 119             UNSAFE.put$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 120                              handle.fieldOffset,</span>
<span class="line-modified"> 121                              {#if[Object]?handle.fieldType.cast(value):value});</span>
 122         }
 123 
 124         @ForceInline
 125         static void setVolatile(VarHandle ob, Object holder, $type$ value) {
 126             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 127             UNSAFE.put$Type$Volatile(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 128                                      handle.fieldOffset,</span>
<span class="line-modified"> 129                                      {#if[Object]?handle.fieldType.cast(value):value});</span>
 130         }
 131 
 132         @ForceInline
 133         static void setOpaque(VarHandle ob, Object holder, $type$ value) {
 134             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 135             UNSAFE.put$Type$Opaque(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 136                                    handle.fieldOffset,</span>
<span class="line-modified"> 137                                    {#if[Object]?handle.fieldType.cast(value):value});</span>
 138         }
 139 
 140         @ForceInline
 141         static void setRelease(VarHandle ob, Object holder, $type$ value) {
 142             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 143             UNSAFE.put$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 144                                     handle.fieldOffset,</span>
<span class="line-modified"> 145                                     {#if[Object]?handle.fieldType.cast(value):value});</span>
 146         }
 147 #if[CAS]
 148 
 149         @ForceInline
 150         static boolean compareAndSet(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 151             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 152             return UNSAFE.compareAndSet$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 153                                                handle.fieldOffset,</span>
<span class="line-modified"> 154                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 155                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 156         }
 157 
 158         @ForceInline
 159         static $type$ compareAndExchange(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 160             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 161             return UNSAFE.compareAndExchange$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 162                                                handle.fieldOffset,</span>
<span class="line-modified"> 163                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 164                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 165         }
 166 
 167         @ForceInline
 168         static $type$ compareAndExchangeAcquire(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 169             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 170             return UNSAFE.compareAndExchange$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 171                                                handle.fieldOffset,</span>
<span class="line-modified"> 172                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 173                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 174         }
 175 
 176         @ForceInline
 177         static $type$ compareAndExchangeRelease(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 178             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 179             return UNSAFE.compareAndExchange$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 180                                                handle.fieldOffset,</span>
<span class="line-modified"> 181                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 182                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 183         }
 184 
 185         @ForceInline
 186         static boolean weakCompareAndSetPlain(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 187             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 188             return UNSAFE.weakCompareAndSet$Type$Plain(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 189                                                handle.fieldOffset,</span>
<span class="line-modified"> 190                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 191                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 192         }
 193 
 194         @ForceInline
 195         static boolean weakCompareAndSet(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 196             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 197             return UNSAFE.weakCompareAndSet$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 198                                                handle.fieldOffset,</span>
<span class="line-modified"> 199                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 200                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 201         }
 202 
 203         @ForceInline
 204         static boolean weakCompareAndSetAcquire(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 205             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 206             return UNSAFE.weakCompareAndSet$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 207                                                handle.fieldOffset,</span>
<span class="line-modified"> 208                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 209                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 210         }
 211 
 212         @ForceInline
 213         static boolean weakCompareAndSetRelease(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 214             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 215             return UNSAFE.weakCompareAndSet$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 216                                                handle.fieldOffset,</span>
<span class="line-modified"> 217                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 218                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 219         }
 220 
 221         @ForceInline
 222         static $type$ getAndSet(VarHandle ob, Object holder, $type$ value) {
 223             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 224             return UNSAFE.getAndSet$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 225                                           handle.fieldOffset,</span>
<span class="line-modified"> 226                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
 227         }
 228 
 229         @ForceInline
 230         static $type$ getAndSetAcquire(VarHandle ob, Object holder, $type$ value) {
 231             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 232             return UNSAFE.getAndSet$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 233                                           handle.fieldOffset,</span>
<span class="line-modified"> 234                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
 235         }
 236 
 237         @ForceInline
 238         static $type$ getAndSetRelease(VarHandle ob, Object holder, $type$ value) {
 239             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 240             return UNSAFE.getAndSet$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 241                                           handle.fieldOffset,</span>
<span class="line-modified"> 242                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
 243         }
 244 #end[CAS]
 245 #if[AtomicAdd]
 246 
 247         @ForceInline
 248         static $type$ getAndAdd(VarHandle ob, Object holder, $type$ value) {
 249             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 250             return UNSAFE.getAndAdd$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
 251                                        handle.fieldOffset,
 252                                        value);
 253         }
 254 
 255         @ForceInline
 256         static $type$ getAndAddAcquire(VarHandle ob, Object holder, $type$ value) {
 257             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 258             return UNSAFE.getAndAdd$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
 259                                        handle.fieldOffset,
 260                                        value);
 261         }
 262 
</pre>
<hr />
<pre>
 376                 return Optional.empty();
 377 
 378             // Reflect on this VarHandle to extract the field name
 379             var staticField = VarHandles.getStaticFieldFromBaseAndOffset(
 380                 base, fieldOffset, {#if[Object]?fieldType:$type$.class});
 381             var receiverTypeRef = staticField.getDeclaringClass().describeConstable();
 382             if (!receiverTypeRef.isPresent())
 383                 return Optional.empty();
 384             return Optional.of(VarHandleDesc.ofStaticField(receiverTypeRef.get(), staticField.getName(), fieldTypeRef.get()));
 385         }
 386 
 387         @Override
 388         final MethodType accessModeTypeUncached(AccessMode accessMode) {
 389             return accessMode.at.accessModeType(null, {#if[Object]?fieldType:$type$.class});
 390         }
 391 
 392         @ForceInline
 393         static $type$ get(VarHandle ob) {
 394             FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
 395             return UNSAFE.get$Type$(handle.base,
<span class="line-modified"> 396                                  handle.fieldOffset);</span>
 397         }
 398 
 399         @ForceInline
 400         static $type$ getVolatile(VarHandle ob) {
 401             FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
 402             return UNSAFE.get$Type$Volatile(handle.base,
<span class="line-modified"> 403                                  handle.fieldOffset);</span>
 404         }
 405 
 406         @ForceInline
 407         static $type$ getOpaque(VarHandle ob) {
 408             FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
 409             return UNSAFE.get$Type$Opaque(handle.base,
<span class="line-modified"> 410                                  handle.fieldOffset);</span>
 411         }
 412 
 413         @ForceInline
 414         static $type$ getAcquire(VarHandle ob) {
 415             FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
 416             return UNSAFE.get$Type$Acquire(handle.base,
<span class="line-modified"> 417                                  handle.fieldOffset);</span>
 418         }
 419 
 420         static final VarForm FORM = new VarForm(FieldStaticReadOnly.class, null, $type$.class);
 421     }
 422 
 423     static final class FieldStaticReadWrite extends FieldStaticReadOnly {
<span class="line-removed"> 424 </span>
 425         FieldStaticReadWrite(Object base, long fieldOffset{#if[Object]?, Class&lt;?&gt; fieldType}) {
 426             super(base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadWrite.FORM);
 427         }
 428 








 429         @ForceInline
 430         static void set(VarHandle ob, $type$ value) {
 431             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 432             UNSAFE.put$Type$(handle.base,
<span class="line-modified"> 433                              handle.fieldOffset,</span>
<span class="line-modified"> 434                              {#if[Object]?handle.fieldType.cast(value):value});</span>
 435         }
 436 
 437         @ForceInline
 438         static void setVolatile(VarHandle ob, $type$ value) {
 439             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 440             UNSAFE.put$Type$Volatile(handle.base,
<span class="line-modified"> 441                                      handle.fieldOffset,</span>
<span class="line-modified"> 442                                      {#if[Object]?handle.fieldType.cast(value):value});</span>
 443         }
 444 
 445         @ForceInline
 446         static void setOpaque(VarHandle ob, $type$ value) {
 447             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 448             UNSAFE.put$Type$Opaque(handle.base,
<span class="line-modified"> 449                                    handle.fieldOffset,</span>
<span class="line-modified"> 450                                    {#if[Object]?handle.fieldType.cast(value):value});</span>
 451         }
 452 
 453         @ForceInline
 454         static void setRelease(VarHandle ob, $type$ value) {
 455             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 456             UNSAFE.put$Type$Release(handle.base,
<span class="line-modified"> 457                                     handle.fieldOffset,</span>
<span class="line-modified"> 458                                     {#if[Object]?handle.fieldType.cast(value):value});</span>
 459         }
 460 #if[CAS]
 461 
 462         @ForceInline
 463         static boolean compareAndSet(VarHandle ob, $type$ expected, $type$ value) {
 464             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 465             return UNSAFE.compareAndSet$Type$(handle.base,
<span class="line-modified"> 466                                                handle.fieldOffset,</span>
<span class="line-modified"> 467                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 468                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 469         }
 470 
 471 
 472         @ForceInline
 473         static $type$ compareAndExchange(VarHandle ob, $type$ expected, $type$ value) {
 474             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 475             return UNSAFE.compareAndExchange$Type$(handle.base,
<span class="line-modified"> 476                                                handle.fieldOffset,</span>
<span class="line-modified"> 477                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 478                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 479         }
 480 
 481         @ForceInline
 482         static $type$ compareAndExchangeAcquire(VarHandle ob, $type$ expected, $type$ value) {
 483             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 484             return UNSAFE.compareAndExchange$Type$Acquire(handle.base,
<span class="line-modified"> 485                                                handle.fieldOffset,</span>
<span class="line-modified"> 486                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 487                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 488         }
 489 
 490         @ForceInline
 491         static $type$ compareAndExchangeRelease(VarHandle ob, $type$ expected, $type$ value) {
 492             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 493             return UNSAFE.compareAndExchange$Type$Release(handle.base,
<span class="line-modified"> 494                                                handle.fieldOffset,</span>
<span class="line-modified"> 495                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 496                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 497         }
 498 
 499         @ForceInline
 500         static boolean weakCompareAndSetPlain(VarHandle ob, $type$ expected, $type$ value) {
 501             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 502             return UNSAFE.weakCompareAndSet$Type$Plain(handle.base,
<span class="line-modified"> 503                                                handle.fieldOffset,</span>
<span class="line-modified"> 504                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 505                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 506         }
 507 
 508         @ForceInline
 509         static boolean weakCompareAndSet(VarHandle ob, $type$ expected, $type$ value) {
 510             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 511             return UNSAFE.weakCompareAndSet$Type$(handle.base,
<span class="line-modified"> 512                                                handle.fieldOffset,</span>
<span class="line-modified"> 513                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 514                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 515         }
 516 
 517         @ForceInline
 518         static boolean weakCompareAndSetAcquire(VarHandle ob, $type$ expected, $type$ value) {
 519             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 520             return UNSAFE.weakCompareAndSet$Type$Acquire(handle.base,
<span class="line-modified"> 521                                                handle.fieldOffset,</span>
<span class="line-modified"> 522                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 523                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 524         }
 525 
 526         @ForceInline
 527         static boolean weakCompareAndSetRelease(VarHandle ob, $type$ expected, $type$ value) {
 528             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 529             return UNSAFE.weakCompareAndSet$Type$Release(handle.base,
<span class="line-modified"> 530                                                handle.fieldOffset,</span>
<span class="line-modified"> 531                                                {#if[Object]?handle.fieldType.cast(expected):expected},</span>
<span class="line-modified"> 532                                                {#if[Object]?handle.fieldType.cast(value):value});</span>
 533         }
 534 
 535         @ForceInline
 536         static $type$ getAndSet(VarHandle ob, $type$ value) {
 537             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 538             return UNSAFE.getAndSet$Type$(handle.base,
<span class="line-modified"> 539                                           handle.fieldOffset,</span>
<span class="line-modified"> 540                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
 541         }
 542 
 543         @ForceInline
 544         static $type$ getAndSetAcquire(VarHandle ob, $type$ value) {
 545             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 546             return UNSAFE.getAndSet$Type$Acquire(handle.base,
<span class="line-modified"> 547                                           handle.fieldOffset,</span>
<span class="line-modified"> 548                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
 549         }
 550 
 551         @ForceInline
 552         static $type$ getAndSetRelease(VarHandle ob, $type$ value) {
 553             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 554             return UNSAFE.getAndSet$Type$Release(handle.base,
<span class="line-modified"> 555                                           handle.fieldOffset,</span>
<span class="line-modified"> 556                                           {#if[Object]?handle.fieldType.cast(value):value});</span>
 557         }
 558 #end[CAS]
 559 #if[AtomicAdd]
 560 
 561         @ForceInline
 562         static $type$ getAndAdd(VarHandle ob, $type$ value) {
 563             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 564             return UNSAFE.getAndAdd$Type$(handle.base,
 565                                        handle.fieldOffset,
 566                                        value);
 567         }
 568 
 569         @ForceInline
 570         static $type$ getAndAddAcquire(VarHandle ob, $type$ value) {
 571             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 572             return UNSAFE.getAndAdd$Type$Acquire(handle.base,
 573                                        handle.fieldOffset,
 574                                        value);
 575         }
 576 
</pre>
<hr />
<pre>
 643         @ForceInline
 644         static $type$ getAndBitwiseXorRelease(VarHandle ob, $type$ value) {
 645             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 646             return UNSAFE.getAndBitwiseXor$Type$Release(handle.base,
 647                                        handle.fieldOffset,
 648                                        value);
 649         }
 650 
 651         @ForceInline
 652         static $type$ getAndBitwiseXorAcquire(VarHandle ob, $type$ value) {
 653             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 654             return UNSAFE.getAndBitwiseXor$Type$Acquire(handle.base,
 655                                        handle.fieldOffset,
 656                                        value);
 657         }
 658 #end[Bitwise]
 659 
 660         static final VarForm FORM = new VarForm(FieldStaticReadWrite.class, null, $type$.class);
 661     }
 662 








 663 
 664     static final class Array extends VarHandle {
 665         final int abase;
 666         final int ashift;
 667 #if[Object]
 668         final Class&lt;{#if[Object]??:$type$[]}&gt; arrayType;
 669         final Class&lt;?&gt; componentType;
 670 #end[Object]
 671 
 672         Array(int abase, int ashift{#if[Object]?, Class&lt;?&gt; arrayType}) {
 673             super(Array.FORM);
 674             this.abase = abase;
 675             this.ashift = ashift;
 676 #if[Object]
 677             this.arrayType = {#if[Object]?arrayType:$type$[].class};
 678             this.componentType = arrayType.getComponentType();
 679 #end[Object]
 680         }
 681 
 682         @Override
 683         public Optional&lt;VarHandleDesc&gt; describeConstable() {
 684             var arrayTypeRef = {#if[Object]?arrayType:$type$[].class}.describeConstable();
 685             if (!arrayTypeRef.isPresent())
 686                 return Optional.empty();
 687 
 688             return Optional.of(VarHandleDesc.ofArray(arrayTypeRef.get()));
 689         }
 690 
 691         @Override
 692         final MethodType accessModeTypeUncached(AccessMode accessMode) {
 693             return accessMode.at.accessModeType({#if[Object]?arrayType:$type$[].class}, {#if[Object]?arrayType.getComponentType():$type$.class}, int.class);
 694         }
 695 
 696 #if[Object]
 697         @ForceInline
 698         static Object runtimeTypeCheck(Array handle, Object[] oarray, Object value) {



 699             if (handle.arrayType == oarray.getClass()) {
 700                 // Fast path: static array type same as argument array type
 701                 return handle.componentType.cast(value);
 702             } else {
 703                 // Slow path: check value against argument array component type
 704                 return reflectiveTypeCheck(oarray, value);
 705             }
 706         }
 707 
 708         @ForceInline
 709         static Object reflectiveTypeCheck(Object[] oarray, Object value) {
 710             try {
 711                 return oarray.getClass().getComponentType().cast(value);
 712             } catch (ClassCastException e) {
 713                 throw new ArrayStoreException();
 714             }
 715         }
 716 #end[Object]
 717 
 718         @ForceInline
 719         static $type$ get(VarHandle ob, Object oarray, int index) {
 720             Array handle = (Array)ob;
 721 #if[Object]
 722             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 723 #else[Object]
 724             $type$[] array = ($type$[]) oarray;
 725 #end[Object]
 726             return array[index];
 727         }
 728 
 729         @ForceInline
 730         static void set(VarHandle ob, Object oarray, int index, $type$ value) {
 731             Array handle = (Array)ob;
 732 #if[Object]
 733             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 734 #else[Object]
 735             $type$[] array = ($type$[]) oarray;
 736 #end[Object]
<span class="line-modified"> 737             array[index] = {#if[Object]?handle.componentType.cast(value):value};</span>








 738         }
 739 
 740         @ForceInline
 741         static $type$ getVolatile(VarHandle ob, Object oarray, int index) {
 742             Array handle = (Array)ob;
 743 #if[Object]
 744             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 745 #else[Object]
 746             $type$[] array = ($type$[]) oarray;
 747 #end[Object]







 748             return UNSAFE.get$Type$Volatile(array,
<span class="line-modified"> 749                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase);</span>
 750         }
 751 
 752         @ForceInline
 753         static void setVolatile(VarHandle ob, Object oarray, int index, $type$ value) {
 754             Array handle = (Array)ob;
 755 #if[Object]
 756             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 757 #else[Object]
 758             $type$[] array = ($type$[]) oarray;
 759 #end[Object]








 760             UNSAFE.put$Type$Volatile(array,
<span class="line-modified"> 761                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 762                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 763         }
 764 
 765         @ForceInline
 766         static $type$ getOpaque(VarHandle ob, Object oarray, int index) {
 767             Array handle = (Array)ob;
 768 #if[Object]
 769             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 770 #else[Object]
 771             $type$[] array = ($type$[]) oarray;
 772 #end[Object]







 773             return UNSAFE.get$Type$Opaque(array,
<span class="line-modified"> 774                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase);</span>
 775         }
 776 
 777         @ForceInline
 778         static void setOpaque(VarHandle ob, Object oarray, int index, $type$ value) {
 779             Array handle = (Array)ob;
 780 #if[Object]
 781             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 782 #else[Object]
 783             $type$[] array = ($type$[]) oarray;
 784 #end[Object]








 785             UNSAFE.put$Type$Opaque(array,
<span class="line-modified"> 786                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 787                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 788         }
 789 
 790         @ForceInline
 791         static $type$ getAcquire(VarHandle ob, Object oarray, int index) {
 792             Array handle = (Array)ob;
 793 #if[Object]
 794             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 795 #else[Object]
 796             $type$[] array = ($type$[]) oarray;
 797 #end[Object]







 798             return UNSAFE.get$Type$Acquire(array,
<span class="line-modified"> 799                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase);</span>
 800         }
 801 
 802         @ForceInline
 803         static void setRelease(VarHandle ob, Object oarray, int index, $type$ value) {
 804             Array handle = (Array)ob;
 805 #if[Object]
 806             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 807 #else[Object]
 808             $type$[] array = ($type$[]) oarray;
 809 #end[Object]








 810             UNSAFE.put$Type$Release(array,
<span class="line-modified"> 811                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 812                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 813         }
 814 #if[CAS]
 815 
 816         @ForceInline
 817         static boolean compareAndSet(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 818             Array handle = (Array)ob;
 819 #if[Object]
 820             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 821 #else[Object]
 822             $type$[] array = ($type$[]) oarray;
 823 #end[Object]







 824             return UNSAFE.compareAndSet$Type$(array,
<span class="line-modified"> 825                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 826                     {#if[Object]?handle.componentType.cast(expected):expected},
 827                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 828         }
 829 
 830         @ForceInline
 831         static $type$ compareAndExchange(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 832             Array handle = (Array)ob;
 833 #if[Object]
 834             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 835 #else[Object]
 836             $type$[] array = ($type$[]) oarray;
 837 #end[Object]







 838             return UNSAFE.compareAndExchange$Type$(array,
<span class="line-modified"> 839                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 840                     {#if[Object]?handle.componentType.cast(expected):expected},
 841                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 842         }
 843 
 844         @ForceInline
 845         static $type$ compareAndExchangeAcquire(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 846             Array handle = (Array)ob;
 847 #if[Object]
 848             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 849 #else[Object]
 850             $type$[] array = ($type$[]) oarray;
 851 #end[Object]







 852             return UNSAFE.compareAndExchange$Type$Acquire(array,
<span class="line-modified"> 853                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 854                     {#if[Object]?handle.componentType.cast(expected):expected},
 855                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 856         }
 857 
 858         @ForceInline
 859         static $type$ compareAndExchangeRelease(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 860             Array handle = (Array)ob;
 861 #if[Object]
 862             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 863 #else[Object]
 864             $type$[] array = ($type$[]) oarray;
 865 #end[Object]







 866             return UNSAFE.compareAndExchange$Type$Release(array,
<span class="line-modified"> 867                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 868                     {#if[Object]?handle.componentType.cast(expected):expected},
 869                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 870         }
 871 
 872         @ForceInline
 873         static boolean weakCompareAndSetPlain(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 874             Array handle = (Array)ob;
 875 #if[Object]
 876             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 877 #else[Object]
 878             $type$[] array = ($type$[]) oarray;
 879 #end[Object]







 880             return UNSAFE.weakCompareAndSet$Type$Plain(array,
<span class="line-modified"> 881                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 882                     {#if[Object]?handle.componentType.cast(expected):expected},
 883                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 884         }
 885 
 886         @ForceInline
 887         static boolean weakCompareAndSet(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 888             Array handle = (Array)ob;
 889 #if[Object]
 890             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 891 #else[Object]
 892             $type$[] array = ($type$[]) oarray;
 893 #end[Object]







 894             return UNSAFE.weakCompareAndSet$Type$(array,
<span class="line-modified"> 895                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 896                     {#if[Object]?handle.componentType.cast(expected):expected},
 897                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 898         }
 899 
 900         @ForceInline
 901         static boolean weakCompareAndSetAcquire(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 902             Array handle = (Array)ob;
 903 #if[Object]
 904             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 905 #else[Object]
 906             $type$[] array = ($type$[]) oarray;
 907 #end[Object]







 908             return UNSAFE.weakCompareAndSet$Type$Acquire(array,
<span class="line-modified"> 909                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 910                     {#if[Object]?handle.componentType.cast(expected):expected},
 911                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 912         }
 913 
 914         @ForceInline
 915         static boolean weakCompareAndSetRelease(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 916             Array handle = (Array)ob;
 917 #if[Object]
 918             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 919 #else[Object]
 920             $type$[] array = ($type$[]) oarray;
 921 #end[Object]







 922             return UNSAFE.weakCompareAndSet$Type$Release(array,
<span class="line-modified"> 923                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 924                     {#if[Object]?handle.componentType.cast(expected):expected},
 925                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 926         }
 927 
 928         @ForceInline
 929         static $type$ getAndSet(VarHandle ob, Object oarray, int index, $type$ value) {
 930             Array handle = (Array)ob;
 931 #if[Object]
 932             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 933 #else[Object]
 934             $type$[] array = ($type$[]) oarray;
 935 #end[Object]







 936             return UNSAFE.getAndSet$Type$(array,
<span class="line-modified"> 937                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 938                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 939         }
 940 
 941         @ForceInline
 942         static $type$ getAndSetAcquire(VarHandle ob, Object oarray, int index, $type$ value) {
 943             Array handle = (Array)ob;
 944 #if[Object]
 945             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 946 #else[Object]
 947             $type$[] array = ($type$[]) oarray;
 948 #end[Object]







 949             return UNSAFE.getAndSet$Type$Acquire(array,
<span class="line-modified"> 950                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 951                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 952         }
 953 
 954         @ForceInline
 955         static $type$ getAndSetRelease(VarHandle ob, Object oarray, int index, $type$ value) {
 956             Array handle = (Array)ob;
 957 #if[Object]
 958             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 959 #else[Object]
 960             $type$[] array = ($type$[]) oarray;
 961 #end[Object]







 962             return UNSAFE.getAndSet$Type$Release(array,
<span class="line-modified"> 963                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,</span>
 964                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 965         }
 966 #end[CAS]
 967 #if[AtomicAdd]
 968 
 969         @ForceInline
 970         static $type$ getAndAdd(VarHandle ob, Object oarray, int index, $type$ value) {
 971             Array handle = (Array)ob;
 972             $type$[] array = ($type$[]) oarray;
 973             return UNSAFE.getAndAdd$Type$(array,
 974                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,
 975                     value);
 976         }
 977 
 978         @ForceInline
 979         static $type$ getAndAddAcquire(VarHandle ob, Object oarray, int index, $type$ value) {
 980             Array handle = (Array)ob;
 981             $type$[] array = ($type$[]) oarray;
 982             return UNSAFE.getAndAdd$Type$Acquire(array,
 983                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,
</pre>
</td>
<td>
<hr />
<pre>
  63             return accessMode.at.accessModeType(receiverType, {#if[Object]?fieldType:$type$.class});
  64         }
  65 
  66         @Override
  67         public Optional&lt;VarHandleDesc&gt; describeConstable() {
  68             var receiverTypeRef = receiverType.describeConstable();
  69             var fieldTypeRef = {#if[Object]?fieldType:$type$.class}.describeConstable();
  70             if (!receiverTypeRef.isPresent() || !fieldTypeRef.isPresent())
  71                 return Optional.empty();
  72 
  73             // Reflect on this VarHandle to extract the field name
  74             String name = VarHandles.getFieldFromReceiverAndOffset(
  75                 receiverType, fieldOffset, {#if[Object]?fieldType:$type$.class}).getName();
  76             return Optional.of(VarHandleDesc.ofField(receiverTypeRef.get(), name, fieldTypeRef.get()));
  77         }
  78 
  79         @ForceInline
  80         static $type$ get(VarHandle ob, Object holder) {
  81             FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
  82             return UNSAFE.get$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified">  83                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
  84         }
  85 
  86         @ForceInline
  87         static $type$ getVolatile(VarHandle ob, Object holder) {
  88             FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
  89             return UNSAFE.get$Type$Volatile(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified">  90                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
  91         }
  92 
  93         @ForceInline
  94         static $type$ getOpaque(VarHandle ob, Object holder) {
  95             FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
  96             return UNSAFE.get$Type$Opaque(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified">  97                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
  98         }
  99 
 100         @ForceInline
 101         static $type$ getAcquire(VarHandle ob, Object holder) {
 102             FieldInstanceReadOnly handle = (FieldInstanceReadOnly)ob;
 103             return UNSAFE.get$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 104                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
 105         }
 106 
 107         static final VarForm FORM = new VarForm(FieldInstanceReadOnly.class, Object.class, $type$.class);
 108     }
 109 
 110     static final class FieldInstanceReadWrite extends FieldInstanceReadOnly {

 111         FieldInstanceReadWrite(Class&lt;?&gt; receiverType, long fieldOffset{#if[Object]?, Class&lt;?&gt; fieldType}) {
 112             super(receiverType, fieldOffset{#if[Object]?, fieldType}, FieldInstanceReadWrite.FORM);
 113         }
 114 
<span class="line-added"> 115 #if[Object]</span>
<span class="line-added"> 116         @ForceInline</span>
<span class="line-added"> 117         static Object checkCast(FieldInstanceReadWrite handle, $type$ value) {</span>
<span class="line-added"> 118             if (handle.fieldType.isInlineClass())</span>
<span class="line-added"> 119                 Objects.requireNonNull(value);</span>
<span class="line-added"> 120             return handle.fieldType.cast(value);</span>
<span class="line-added"> 121         }</span>
<span class="line-added"> 122 #end[Object]</span>
<span class="line-added"> 123 </span>
 124         @ForceInline
 125         static void set(VarHandle ob, Object holder, $type$ value) {
 126             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 127             UNSAFE.put$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 128                              handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 129                              {#if[Object]?checkCast(handle, value):value});</span>
 130         }
 131 
 132         @ForceInline
 133         static void setVolatile(VarHandle ob, Object holder, $type$ value) {
 134             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 135             UNSAFE.put$Type$Volatile(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 136                                      handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 137                                      {#if[Object]?checkCast(handle, value):value});</span>
 138         }
 139 
 140         @ForceInline
 141         static void setOpaque(VarHandle ob, Object holder, $type$ value) {
 142             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 143             UNSAFE.put$Type$Opaque(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 144                                    handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 145                                    {#if[Object]?checkCast(handle, value):value});</span>
 146         }
 147 
 148         @ForceInline
 149         static void setRelease(VarHandle ob, Object holder, $type$ value) {
 150             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 151             UNSAFE.put$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 152                                     handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 153                                     {#if[Object]?checkCast(handle, value):value});</span>
 154         }
 155 #if[CAS]
 156 
 157         @ForceInline
 158         static boolean compareAndSet(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 159             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 160             return UNSAFE.compareAndSet$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 161                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 162                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 163                                                {#if[Object]?checkCast(handle, value):value});</span>
 164         }
 165 
 166         @ForceInline
 167         static $type$ compareAndExchange(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 168             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 169             return UNSAFE.compareAndExchange$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 170                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 171                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 172                                                {#if[Object]?checkCast(handle, value):value});</span>
 173         }
 174 
 175         @ForceInline
 176         static $type$ compareAndExchangeAcquire(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 177             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 178             return UNSAFE.compareAndExchange$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 179                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 180                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 181                                                {#if[Object]?checkCast(handle, value):value});</span>
 182         }
 183 
 184         @ForceInline
 185         static $type$ compareAndExchangeRelease(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 186             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 187             return UNSAFE.compareAndExchange$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 188                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 189                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 190                                                {#if[Object]?checkCast(handle, value):value});</span>
 191         }
 192 
 193         @ForceInline
 194         static boolean weakCompareAndSetPlain(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 195             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 196             return UNSAFE.weakCompareAndSet$Type$Plain(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 197                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 198                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 199                                                {#if[Object]?checkCast(handle, value):value});</span>
 200         }
 201 
 202         @ForceInline
 203         static boolean weakCompareAndSet(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 204             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 205             return UNSAFE.weakCompareAndSet$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 206                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 207                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 208                                                {#if[Object]?checkCast(handle, value):value});</span>
 209         }
 210 
 211         @ForceInline
 212         static boolean weakCompareAndSetAcquire(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 213             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 214             return UNSAFE.weakCompareAndSet$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 215                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 216                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 217                                                {#if[Object]?checkCast(handle, value):value});</span>
 218         }
 219 
 220         @ForceInline
 221         static boolean weakCompareAndSetRelease(VarHandle ob, Object holder, $type$ expected, $type$ value) {
 222             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 223             return UNSAFE.weakCompareAndSet$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 224                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 225                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 226                                                {#if[Object]?checkCast(handle, value):value});</span>
 227         }
 228 
 229         @ForceInline
 230         static $type$ getAndSet(VarHandle ob, Object holder, $type$ value) {
 231             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 232             return UNSAFE.getAndSet$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 233                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 234                                           {#if[Object]?checkCast(handle, value):value});</span>
 235         }
 236 
 237         @ForceInline
 238         static $type$ getAndSetAcquire(VarHandle ob, Object holder, $type$ value) {
 239             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 240             return UNSAFE.getAndSet$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 241                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 242                                           {#if[Object]?checkCast(handle, value):value});</span>
 243         }
 244 
 245         @ForceInline
 246         static $type$ getAndSetRelease(VarHandle ob, Object holder, $type$ value) {
 247             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 248             return UNSAFE.getAndSet$Type$Release(Objects.requireNonNull(handle.receiverType.cast(holder)),
<span class="line-modified"> 249                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 250                                           {#if[Object]?checkCast(handle, value):value});</span>
 251         }
 252 #end[CAS]
 253 #if[AtomicAdd]
 254 
 255         @ForceInline
 256         static $type$ getAndAdd(VarHandle ob, Object holder, $type$ value) {
 257             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 258             return UNSAFE.getAndAdd$Type$(Objects.requireNonNull(handle.receiverType.cast(holder)),
 259                                        handle.fieldOffset,
 260                                        value);
 261         }
 262 
 263         @ForceInline
 264         static $type$ getAndAddAcquire(VarHandle ob, Object holder, $type$ value) {
 265             FieldInstanceReadWrite handle = (FieldInstanceReadWrite)ob;
 266             return UNSAFE.getAndAdd$Type$Acquire(Objects.requireNonNull(handle.receiverType.cast(holder)),
 267                                        handle.fieldOffset,
 268                                        value);
 269         }
 270 
</pre>
<hr />
<pre>
 384                 return Optional.empty();
 385 
 386             // Reflect on this VarHandle to extract the field name
 387             var staticField = VarHandles.getStaticFieldFromBaseAndOffset(
 388                 base, fieldOffset, {#if[Object]?fieldType:$type$.class});
 389             var receiverTypeRef = staticField.getDeclaringClass().describeConstable();
 390             if (!receiverTypeRef.isPresent())
 391                 return Optional.empty();
 392             return Optional.of(VarHandleDesc.ofStaticField(receiverTypeRef.get(), staticField.getName(), fieldTypeRef.get()));
 393         }
 394 
 395         @Override
 396         final MethodType accessModeTypeUncached(AccessMode accessMode) {
 397             return accessMode.at.accessModeType(null, {#if[Object]?fieldType:$type$.class});
 398         }
 399 
 400         @ForceInline
 401         static $type$ get(VarHandle ob) {
 402             FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
 403             return UNSAFE.get$Type$(handle.base,
<span class="line-modified"> 404                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
 405         }
 406 
 407         @ForceInline
 408         static $type$ getVolatile(VarHandle ob) {
 409             FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
 410             return UNSAFE.get$Type$Volatile(handle.base,
<span class="line-modified"> 411                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
 412         }
 413 
 414         @ForceInline
 415         static $type$ getOpaque(VarHandle ob) {
 416             FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
 417             return UNSAFE.get$Type$Opaque(handle.base,
<span class="line-modified"> 418                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
 419         }
 420 
 421         @ForceInline
 422         static $type$ getAcquire(VarHandle ob) {
 423             FieldStaticReadOnly handle = (FieldStaticReadOnly)ob;
 424             return UNSAFE.get$Type$Acquire(handle.base,
<span class="line-modified"> 425                                  handle.fieldOffset{#if[Value]?, handle.fieldType});</span>
 426         }
 427 
 428         static final VarForm FORM = new VarForm(FieldStaticReadOnly.class, null, $type$.class);
 429     }
 430 
 431     static final class FieldStaticReadWrite extends FieldStaticReadOnly {

 432         FieldStaticReadWrite(Object base, long fieldOffset{#if[Object]?, Class&lt;?&gt; fieldType}) {
 433             super(base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadWrite.FORM);
 434         }
 435 
<span class="line-added"> 436 #if[Object]</span>
<span class="line-added"> 437         static Object checkCast(FieldStaticReadWrite handle, $type$ value) {</span>
<span class="line-added"> 438             if (handle.fieldType.isInlineClass())</span>
<span class="line-added"> 439                 Objects.requireNonNull(value);</span>
<span class="line-added"> 440             return handle.fieldType.cast(value);</span>
<span class="line-added"> 441         }</span>
<span class="line-added"> 442 #end[Object]</span>
<span class="line-added"> 443 </span>
 444         @ForceInline
 445         static void set(VarHandle ob, $type$ value) {
 446             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 447             UNSAFE.put$Type$(handle.base,
<span class="line-modified"> 448                              handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 449                              {#if[Object]?checkCast(handle, value):value});</span>
 450         }
 451 
 452         @ForceInline
 453         static void setVolatile(VarHandle ob, $type$ value) {
 454             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 455             UNSAFE.put$Type$Volatile(handle.base,
<span class="line-modified"> 456                                      handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 457                                      {#if[Object]?checkCast(handle, value):value});</span>
 458         }
 459 
 460         @ForceInline
 461         static void setOpaque(VarHandle ob, $type$ value) {
 462             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 463             UNSAFE.put$Type$Opaque(handle.base,
<span class="line-modified"> 464                                    handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 465                                    {#if[Object]?checkCast(handle, value):value});</span>
 466         }
 467 
 468         @ForceInline
 469         static void setRelease(VarHandle ob, $type$ value) {
 470             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 471             UNSAFE.put$Type$Release(handle.base,
<span class="line-modified"> 472                                     handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 473                                     {#if[Object]?checkCast(handle, value):value});</span>
 474         }
 475 #if[CAS]
 476 
 477         @ForceInline
 478         static boolean compareAndSet(VarHandle ob, $type$ expected, $type$ value) {
 479             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 480             return UNSAFE.compareAndSet$Type$(handle.base,
<span class="line-modified"> 481                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 482                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 483                                                {#if[Object]?checkCast(handle, value):value});</span>
 484         }
 485 
 486 
 487         @ForceInline
 488         static $type$ compareAndExchange(VarHandle ob, $type$ expected, $type$ value) {
 489             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 490             return UNSAFE.compareAndExchange$Type$(handle.base,
<span class="line-modified"> 491                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 492                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 493                                                {#if[Object]?checkCast(handle, value):value});</span>
 494         }
 495 
 496         @ForceInline
 497         static $type$ compareAndExchangeAcquire(VarHandle ob, $type$ expected, $type$ value) {
 498             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 499             return UNSAFE.compareAndExchange$Type$Acquire(handle.base,
<span class="line-modified"> 500                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 501                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 502                                                {#if[Object]?checkCast(handle, value):value});</span>
 503         }
 504 
 505         @ForceInline
 506         static $type$ compareAndExchangeRelease(VarHandle ob, $type$ expected, $type$ value) {
 507             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 508             return UNSAFE.compareAndExchange$Type$Release(handle.base,
<span class="line-modified"> 509                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 510                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 511                                                {#if[Object]?checkCast(handle, value):value});</span>
 512         }
 513 
 514         @ForceInline
 515         static boolean weakCompareAndSetPlain(VarHandle ob, $type$ expected, $type$ value) {
 516             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 517             return UNSAFE.weakCompareAndSet$Type$Plain(handle.base,
<span class="line-modified"> 518                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 519                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 520                                                {#if[Object]?checkCast(handle, value):value});</span>
 521         }
 522 
 523         @ForceInline
 524         static boolean weakCompareAndSet(VarHandle ob, $type$ expected, $type$ value) {
 525             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 526             return UNSAFE.weakCompareAndSet$Type$(handle.base,
<span class="line-modified"> 527                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 528                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 529                                                {#if[Object]?checkCast(handle, value):value});</span>
 530         }
 531 
 532         @ForceInline
 533         static boolean weakCompareAndSetAcquire(VarHandle ob, $type$ expected, $type$ value) {
 534             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 535             return UNSAFE.weakCompareAndSet$Type$Acquire(handle.base,
<span class="line-modified"> 536                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 537                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 538                                                {#if[Object]?checkCast(handle, value):value});</span>
 539         }
 540 
 541         @ForceInline
 542         static boolean weakCompareAndSetRelease(VarHandle ob, $type$ expected, $type$ value) {
 543             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 544             return UNSAFE.weakCompareAndSet$Type$Release(handle.base,
<span class="line-modified"> 545                                                handle.fieldOffset{#if[Object]?, handle.fieldType},</span>
<span class="line-modified"> 546                                                {#if[Object]?checkCast(handle, expected):expected},</span>
<span class="line-modified"> 547                                                {#if[Object]?checkCast(handle, value):value});</span>
 548         }
 549 
 550         @ForceInline
 551         static $type$ getAndSet(VarHandle ob, $type$ value) {
 552             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 553             return UNSAFE.getAndSet$Type$(handle.base,
<span class="line-modified"> 554                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 555                                           {#if[Object]?checkCast(handle, value):value});</span>
 556         }
 557 
 558         @ForceInline
 559         static $type$ getAndSetAcquire(VarHandle ob, $type$ value) {
 560             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 561             return UNSAFE.getAndSet$Type$Acquire(handle.base,
<span class="line-modified"> 562                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 563                                           {#if[Object]?checkCast(handle, value):value});</span>
 564         }
 565 
 566         @ForceInline
 567         static $type$ getAndSetRelease(VarHandle ob, $type$ value) {
 568             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 569             return UNSAFE.getAndSet$Type$Release(handle.base,
<span class="line-modified"> 570                                           handle.fieldOffset{#if[Value]?, handle.fieldType},</span>
<span class="line-modified"> 571                                           {#if[Object]?checkCast(handle, value):value});</span>
 572         }
 573 #end[CAS]
 574 #if[AtomicAdd]
 575 
 576         @ForceInline
 577         static $type$ getAndAdd(VarHandle ob, $type$ value) {
 578             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 579             return UNSAFE.getAndAdd$Type$(handle.base,
 580                                        handle.fieldOffset,
 581                                        value);
 582         }
 583 
 584         @ForceInline
 585         static $type$ getAndAddAcquire(VarHandle ob, $type$ value) {
 586             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 587             return UNSAFE.getAndAdd$Type$Acquire(handle.base,
 588                                        handle.fieldOffset,
 589                                        value);
 590         }
 591 
</pre>
<hr />
<pre>
 658         @ForceInline
 659         static $type$ getAndBitwiseXorRelease(VarHandle ob, $type$ value) {
 660             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 661             return UNSAFE.getAndBitwiseXor$Type$Release(handle.base,
 662                                        handle.fieldOffset,
 663                                        value);
 664         }
 665 
 666         @ForceInline
 667         static $type$ getAndBitwiseXorAcquire(VarHandle ob, $type$ value) {
 668             FieldStaticReadWrite handle = (FieldStaticReadWrite)ob;
 669             return UNSAFE.getAndBitwiseXor$Type$Acquire(handle.base,
 670                                        handle.fieldOffset,
 671                                        value);
 672         }
 673 #end[Bitwise]
 674 
 675         static final VarForm FORM = new VarForm(FieldStaticReadWrite.class, null, $type$.class);
 676     }
 677 
<span class="line-added"> 678 #if[Reference]</span>
<span class="line-added"> 679     static VarHandle makeVarHandleValuesArray(Class&lt;?&gt; arrayClass) {</span>
<span class="line-added"> 680         Class&lt;?&gt; componentType = arrayClass.getComponentType();</span>
<span class="line-added"> 681         assert componentType.isInlineClass() &amp;&amp; UNSAFE.isFlattenedArray(arrayClass);</span>
<span class="line-added"> 682         // should cache these VarHandle for performance</span>
<span class="line-added"> 683         return VarHandles.makeArrayElementHandle(arrayClass);</span>
<span class="line-added"> 684     }</span>
<span class="line-added"> 685 #end[Reference]</span>
 686 
 687     static final class Array extends VarHandle {
 688         final int abase;
 689         final int ashift;
 690 #if[Object]
 691         final Class&lt;{#if[Object]??:$type$[]}&gt; arrayType;
 692         final Class&lt;?&gt; componentType;
 693 #end[Object]
 694 
 695         Array(int abase, int ashift{#if[Object]?, Class&lt;?&gt; arrayType}) {
 696             super(Array.FORM);
 697             this.abase = abase;
 698             this.ashift = ashift;
 699 #if[Object]
 700             this.arrayType = {#if[Object]?arrayType:$type$[].class};
 701             this.componentType = arrayType.getComponentType();
 702 #end[Object]
 703         }
 704 
 705         @Override
 706         public Optional&lt;VarHandleDesc&gt; describeConstable() {
 707             var arrayTypeRef = {#if[Object]?arrayType:$type$[].class}.describeConstable();
 708             if (!arrayTypeRef.isPresent())
 709                 return Optional.empty();
 710 
 711             return Optional.of(VarHandleDesc.ofArray(arrayTypeRef.get()));
 712         }
 713 
 714         @Override
 715         final MethodType accessModeTypeUncached(AccessMode accessMode) {
 716             return accessMode.at.accessModeType({#if[Object]?arrayType:$type$[].class}, {#if[Object]?arrayType.getComponentType():$type$.class}, int.class);
 717         }
 718 
 719 #if[Object]
 720         @ForceInline
 721         static Object runtimeTypeCheck(Array handle, Object[] oarray, Object value) {
<span class="line-added"> 722             if (handle.componentType.isInlineClass())</span>
<span class="line-added"> 723                  Objects.requireNonNull(value);</span>
<span class="line-added"> 724 </span>
 725             if (handle.arrayType == oarray.getClass()) {
 726                 // Fast path: static array type same as argument array type
 727                 return handle.componentType.cast(value);
 728             } else {
 729                 // Slow path: check value against argument array component type
 730                 return reflectiveTypeCheck(oarray, value);
 731             }
 732         }
 733 
 734         @ForceInline
 735         static Object reflectiveTypeCheck(Object[] oarray, Object value) {
 736             try {
 737                 return oarray.getClass().getComponentType().cast(value);
 738             } catch (ClassCastException e) {
 739                 throw new ArrayStoreException();
 740             }
 741         }
 742 #end[Object]
 743 
 744         @ForceInline
 745         static $type$ get(VarHandle ob, Object oarray, int index) {
 746             Array handle = (Array)ob;
 747 #if[Object]
 748             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 749 #else[Object]
 750             $type$[] array = ($type$[]) oarray;
 751 #end[Object]
 752             return array[index];
 753         }
 754 
 755         @ForceInline
 756         static void set(VarHandle ob, Object oarray, int index, $type$ value) {
 757             Array handle = (Array)ob;
 758 #if[Object]
 759             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 760 #else[Object]
 761             $type$[] array = ($type$[]) oarray;
 762 #end[Object]
<span class="line-modified"> 763 #if[Reference]</span>
<span class="line-added"> 764             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 765                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 766                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 767                 vh.set(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="line-added"> 768                 return;</span>
<span class="line-added"> 769             }</span>
<span class="line-added"> 770 #end[Reference]</span>
<span class="line-added"> 771             array[index] = {#if[Object]?runtimeTypeCheck(handle, array, value):value};</span>
 772         }
 773 
 774         @ForceInline
 775         static $type$ getVolatile(VarHandle ob, Object oarray, int index) {
 776             Array handle = (Array)ob;
 777 #if[Object]
 778             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 779 #else[Object]
 780             $type$[] array = ($type$[]) oarray;
 781 #end[Object]
<span class="line-added"> 782 #if[Reference]</span>
<span class="line-added"> 783             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 784                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 785                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 786                 return vh.getVolatile(oarray, index);</span>
<span class="line-added"> 787             }</span>
<span class="line-added"> 788 #end[Reference]</span>
 789             return UNSAFE.get$Type$Volatile(array,
<span class="line-modified"> 790                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType});</span>
 791         }
 792 
 793         @ForceInline
 794         static void setVolatile(VarHandle ob, Object oarray, int index, $type$ value) {
 795             Array handle = (Array)ob;
 796 #if[Object]
 797             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 798 #else[Object]
 799             $type$[] array = ($type$[]) oarray;
 800 #end[Object]
<span class="line-added"> 801 #if[Reference]</span>
<span class="line-added"> 802             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 803                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 804                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 805                 vh.setVolatile(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="line-added"> 806                 return;</span>
<span class="line-added"> 807             }</span>
<span class="line-added"> 808 #end[Reference]</span>
 809             UNSAFE.put$Type$Volatile(array,
<span class="line-modified"> 810                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
 811                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 812         }
 813 
 814         @ForceInline
 815         static $type$ getOpaque(VarHandle ob, Object oarray, int index) {
 816             Array handle = (Array)ob;
 817 #if[Object]
 818             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 819 #else[Object]
 820             $type$[] array = ($type$[]) oarray;
 821 #end[Object]
<span class="line-added"> 822 #if[Reference]</span>
<span class="line-added"> 823             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 824                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 825                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 826                 return vh.getOpaque(oarray, index);</span>
<span class="line-added"> 827             }</span>
<span class="line-added"> 828 #end[Reference]</span>
 829             return UNSAFE.get$Type$Opaque(array,
<span class="line-modified"> 830                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType});</span>
 831         }
 832 
 833         @ForceInline
 834         static void setOpaque(VarHandle ob, Object oarray, int index, $type$ value) {
 835             Array handle = (Array)ob;
 836 #if[Object]
 837             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 838 #else[Object]
 839             $type$[] array = ($type$[]) oarray;
 840 #end[Object]
<span class="line-added"> 841 #if[Reference]</span>
<span class="line-added"> 842             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 843                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 844                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 845                 vh.setOpaque(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="line-added"> 846                 return;</span>
<span class="line-added"> 847             }</span>
<span class="line-added"> 848 #end[Reference]</span>
 849             UNSAFE.put$Type$Opaque(array,
<span class="line-modified"> 850                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
 851                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 852         }
 853 
 854         @ForceInline
 855         static $type$ getAcquire(VarHandle ob, Object oarray, int index) {
 856             Array handle = (Array)ob;
 857 #if[Object]
 858             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 859 #else[Object]
 860             $type$[] array = ($type$[]) oarray;
 861 #end[Object]
<span class="line-added"> 862 #if[Reference]</span>
<span class="line-added"> 863             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 864                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 865                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 866                 return vh.getAcquire(oarray, index);</span>
<span class="line-added"> 867             }</span>
<span class="line-added"> 868 #end[Reference]</span>
 869             return UNSAFE.get$Type$Acquire(array,
<span class="line-modified"> 870                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType});</span>
 871         }
 872 
 873         @ForceInline
 874         static void setRelease(VarHandle ob, Object oarray, int index, $type$ value) {
 875             Array handle = (Array)ob;
 876 #if[Object]
 877             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 878 #else[Object]
 879             $type$[] array = ($type$[]) oarray;
 880 #end[Object]
<span class="line-added"> 881 #if[Reference]</span>
<span class="line-added"> 882             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 883                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 884                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 885                 vh.setRelease(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="line-added"> 886                 return;</span>
<span class="line-added"> 887             }</span>
<span class="line-added"> 888 #end[Reference]</span>
 889             UNSAFE.put$Type$Release(array,
<span class="line-modified"> 890                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
 891                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 892         }
 893 #if[CAS]
 894 
 895         @ForceInline
 896         static boolean compareAndSet(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 897             Array handle = (Array)ob;
 898 #if[Object]
 899             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 900 #else[Object]
 901             $type$[] array = ($type$[]) oarray;
 902 #end[Object]
<span class="line-added"> 903 #if[Reference]</span>
<span class="line-added"> 904             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 905                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 906                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 907                 return vh.compareAndSet(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="line-added"> 908             }</span>
<span class="line-added"> 909 #end[Reference]</span>
 910             return UNSAFE.compareAndSet$Type$(array,
<span class="line-modified"> 911                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
 912                     {#if[Object]?handle.componentType.cast(expected):expected},
 913                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 914         }
 915 
 916         @ForceInline
 917         static $type$ compareAndExchange(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 918             Array handle = (Array)ob;
 919 #if[Object]
 920             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 921 #else[Object]
 922             $type$[] array = ($type$[]) oarray;
 923 #end[Object]
<span class="line-added"> 924 #if[Reference]</span>
<span class="line-added"> 925             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 926                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 927                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 928                 return vh.compareAndExchange(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="line-added"> 929             }</span>
<span class="line-added"> 930 #end[Reference]</span>
 931             return UNSAFE.compareAndExchange$Type$(array,
<span class="line-modified"> 932                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
 933                     {#if[Object]?handle.componentType.cast(expected):expected},
 934                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 935         }
 936 
 937         @ForceInline
 938         static $type$ compareAndExchangeAcquire(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 939             Array handle = (Array)ob;
 940 #if[Object]
 941             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 942 #else[Object]
 943             $type$[] array = ($type$[]) oarray;
 944 #end[Object]
<span class="line-added"> 945 #if[Reference]</span>
<span class="line-added"> 946             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 947                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 948                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 949                 return vh.compareAndExchangeAcquire(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="line-added"> 950             }</span>
<span class="line-added"> 951 #end[Reference]</span>
 952             return UNSAFE.compareAndExchange$Type$Acquire(array,
<span class="line-modified"> 953                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
 954                     {#if[Object]?handle.componentType.cast(expected):expected},
 955                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 956         }
 957 
 958         @ForceInline
 959         static $type$ compareAndExchangeRelease(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 960             Array handle = (Array)ob;
 961 #if[Object]
 962             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 963 #else[Object]
 964             $type$[] array = ($type$[]) oarray;
 965 #end[Object]
<span class="line-added"> 966 #if[Reference]</span>
<span class="line-added"> 967             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 968                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 969                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 970                 return vh.compareAndExchangeRelease(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="line-added"> 971             }</span>
<span class="line-added"> 972 #end[Reference]</span>
 973             return UNSAFE.compareAndExchange$Type$Release(array,
<span class="line-modified"> 974                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
 975                     {#if[Object]?handle.componentType.cast(expected):expected},
 976                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 977         }
 978 
 979         @ForceInline
 980         static boolean weakCompareAndSetPlain(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
 981             Array handle = (Array)ob;
 982 #if[Object]
 983             Object[] array = (Object[]) handle.arrayType.cast(oarray);
 984 #else[Object]
 985             $type$[] array = ($type$[]) oarray;
 986 #end[Object]
<span class="line-added"> 987 #if[Reference]</span>
<span class="line-added"> 988             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added"> 989                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added"> 990                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added"> 991                 return vh.weakCompareAndSetPlain(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="line-added"> 992             }</span>
<span class="line-added"> 993 #end[Reference]</span>
 994             return UNSAFE.weakCompareAndSet$Type$Plain(array,
<span class="line-modified"> 995                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
 996                     {#if[Object]?handle.componentType.cast(expected):expected},
 997                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
 998         }
 999 
1000         @ForceInline
1001         static boolean weakCompareAndSet(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
1002             Array handle = (Array)ob;
1003 #if[Object]
1004             Object[] array = (Object[]) handle.arrayType.cast(oarray);
1005 #else[Object]
1006             $type$[] array = ($type$[]) oarray;
1007 #end[Object]
<span class="line-added">1008 #if[Reference]</span>
<span class="line-added">1009             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added">1010                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added">1011                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added">1012                 return vh.weakCompareAndSet(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="line-added">1013             }</span>
<span class="line-added">1014 #end[Reference]</span>
1015             return UNSAFE.weakCompareAndSet$Type$(array,
<span class="line-modified">1016                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
1017                     {#if[Object]?handle.componentType.cast(expected):expected},
1018                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
1019         }
1020 
1021         @ForceInline
1022         static boolean weakCompareAndSetAcquire(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
1023             Array handle = (Array)ob;
1024 #if[Object]
1025             Object[] array = (Object[]) handle.arrayType.cast(oarray);
1026 #else[Object]
1027             $type$[] array = ($type$[]) oarray;
1028 #end[Object]
<span class="line-added">1029 #if[Reference]</span>
<span class="line-added">1030             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added">1031                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added">1032                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added">1033                 return vh.weakCompareAndSetAcquire(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="line-added">1034             }</span>
<span class="line-added">1035 #end[Reference]</span>
1036             return UNSAFE.weakCompareAndSet$Type$Acquire(array,
<span class="line-modified">1037                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
1038                     {#if[Object]?handle.componentType.cast(expected):expected},
1039                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
1040         }
1041 
1042         @ForceInline
1043         static boolean weakCompareAndSetRelease(VarHandle ob, Object oarray, int index, $type$ expected, $type$ value) {
1044             Array handle = (Array)ob;
1045 #if[Object]
1046             Object[] array = (Object[]) handle.arrayType.cast(oarray);
1047 #else[Object]
1048             $type$[] array = ($type$[]) oarray;
1049 #end[Object]
<span class="line-added">1050 #if[Reference]</span>
<span class="line-added">1051             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added">1052                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added">1053                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added">1054                 return vh.weakCompareAndSetRelease(oarray, index, expected, reflectiveTypeCheck(array, value));</span>
<span class="line-added">1055             }</span>
<span class="line-added">1056 #end[Reference]</span>
1057             return UNSAFE.weakCompareAndSet$Type$Release(array,
<span class="line-modified">1058                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Object]?, handle.componentType},</span>
1059                     {#if[Object]?handle.componentType.cast(expected):expected},
1060                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
1061         }
1062 
1063         @ForceInline
1064         static $type$ getAndSet(VarHandle ob, Object oarray, int index, $type$ value) {
1065             Array handle = (Array)ob;
1066 #if[Object]
1067             Object[] array = (Object[]) handle.arrayType.cast(oarray);
1068 #else[Object]
1069             $type$[] array = ($type$[]) oarray;
1070 #end[Object]
<span class="line-added">1071 #if[Reference]</span>
<span class="line-added">1072             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added">1073                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added">1074                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added">1075                 return vh.getAndSet(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="line-added">1076             }</span>
<span class="line-added">1077 #end[Reference]</span>
1078             return UNSAFE.getAndSet$Type$(array,
<span class="line-modified">1079                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
1080                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
1081         }
1082 
1083         @ForceInline
1084         static $type$ getAndSetAcquire(VarHandle ob, Object oarray, int index, $type$ value) {
1085             Array handle = (Array)ob;
1086 #if[Object]
1087             Object[] array = (Object[]) handle.arrayType.cast(oarray);
1088 #else[Object]
1089             $type$[] array = ($type$[]) oarray;
1090 #end[Object]
<span class="line-added">1091 #if[Reference]</span>
<span class="line-added">1092             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added">1093                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added">1094                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added">1095                 return vh.getAndSetAcquire(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="line-added">1096             }</span>
<span class="line-added">1097 #end[Reference]</span>
1098             return UNSAFE.getAndSet$Type$Acquire(array,
<span class="line-modified">1099                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
1100                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
1101         }
1102 
1103         @ForceInline
1104         static $type$ getAndSetRelease(VarHandle ob, Object oarray, int index, $type$ value) {
1105             Array handle = (Array)ob;
1106 #if[Object]
1107             Object[] array = (Object[]) handle.arrayType.cast(oarray);
1108 #else[Object]
1109             $type$[] array = ($type$[]) oarray;
1110 #end[Object]
<span class="line-added">1111 #if[Reference]</span>
<span class="line-added">1112             if (UNSAFE.isFlattenedArray(oarray.getClass())) {</span>
<span class="line-added">1113                 // for flattened array, delegate to VarHandle of the inline type array</span>
<span class="line-added">1114                 VarHandle vh = makeVarHandleValuesArray(oarray.getClass());</span>
<span class="line-added">1115                 return vh.getAndSetRelease(oarray, index, reflectiveTypeCheck(array, value));</span>
<span class="line-added">1116             }</span>
<span class="line-added">1117 #end[Reference]</span>
1118             return UNSAFE.getAndSet$Type$Release(array,
<span class="line-modified">1119                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase{#if[Value]?, handle.componentType},</span>
1120                     {#if[Object]?runtimeTypeCheck(handle, array, value):value});
1121         }
1122 #end[CAS]
1123 #if[AtomicAdd]
1124 
1125         @ForceInline
1126         static $type$ getAndAdd(VarHandle ob, Object oarray, int index, $type$ value) {
1127             Array handle = (Array)ob;
1128             $type$[] array = ($type$[]) oarray;
1129             return UNSAFE.getAndAdd$Type$(array,
1130                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,
1131                     value);
1132         }
1133 
1134         @ForceInline
1135         static $type$ getAndAddAcquire(VarHandle ob, Object oarray, int index, $type$ value) {
1136             Array handle = (Array)ob;
1137             $type$[] array = ($type$[]) oarray;
1138             return UNSAFE.getAndAdd$Type$Acquire(array,
1139                     (((long) Preconditions.checkIndex(index, array.length, AIOOBE_SUPPLIER)) &lt;&lt; handle.ashift) + handle.abase,
</pre>
</td>
</tr>
</table>
<center><a href="VarHandles.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../module-info.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>