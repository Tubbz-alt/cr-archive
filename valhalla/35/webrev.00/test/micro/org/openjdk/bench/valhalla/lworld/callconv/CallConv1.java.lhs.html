<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/micro/org/openjdk/bench/valhalla/lworld/callconv/CallConv1.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 package org.openjdk.bench.valhalla.lworld.callconv;
  2 
  3 import org.openjdk.jmh.annotations.Benchmark;
  4 import org.openjdk.jmh.annotations.CompilerControl;
  5 import org.openjdk.jmh.annotations.OperationsPerInvocation;
  6 import org.openjdk.jmh.annotations.Setup;
  7 import org.openjdk.bench.valhalla.CallBase;
  8 
  9 
 10 public class CallConv1 extends CallBase {
 11 
 12     public static inline class Val {
 13 
 14         public final int f0;
 15 
 16         public Val(int f0) {
 17             this.f0 = f0;
 18         }
 19     }
 20 
 21     abstract static class InvocationLogic {
 22 
<a name="1" id="anc1"></a><span class="line-modified"> 23         public abstract Val? computeBox(Val? v1);</span>
<span class="line-modified"> 24         public abstract Val? computeBox(Val? v1, Val? v2);</span>
<span class="line-modified"> 25         public abstract Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4);</span>
<span class="line-modified"> 26         public abstract Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4, Val? v5, Val? v6, Val? v7, Val? v8);</span>
 27 
 28         public abstract Val compute(Val v1);
 29         public abstract Val compute(Val v1, Val v2);
 30         public abstract Val compute(Val v1, Val v2, Val v3, Val v4);
 31         public abstract Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8);
 32 
 33     }
 34 
 35     static class InvokeImpl1 extends InvocationLogic {
 36 
 37         @Override
<a name="2" id="anc2"></a><span class="line-modified"> 38         public Val? computeBox(Val? v1) {</span>
 39             return v1;
 40         }
 41 
 42         @Override
<a name="3" id="anc3"></a><span class="line-modified"> 43         public Val? computeBox(Val? v1, Val? v2) {</span>
 44             return v1;
 45         }
 46 
 47         @Override
<a name="4" id="anc4"></a><span class="line-modified"> 48         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4) {</span>
 49             return v1;
 50         }
 51 
 52         @Override
<a name="5" id="anc5"></a><span class="line-modified"> 53         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4, Val? v5, Val? v6, Val? v7, Val? v8) {</span>
 54             return v1;
 55         }
 56 
 57         @Override
 58         public Val compute(Val v1) {
 59             return v1;
 60         }
 61 
 62         @Override
 63         public Val compute(Val v1, Val v2) {
 64             return v1;
 65         }
 66 
 67         @Override
 68         public Val compute(Val v1, Val v2, Val v3, Val v4) {
 69             return v1;
 70         }
 71 
 72         @Override
 73         public Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8) {
 74             return v1;
 75         }
 76 
 77     }
 78 
 79     static class InvokeImpl2 extends InvocationLogic {
 80 
 81         @Override
<a name="6" id="anc6"></a><span class="line-modified"> 82         public Val? computeBox(Val? v1) {</span>
 83             return v1;
 84         }
 85 
 86         @Override
<a name="7" id="anc7"></a><span class="line-modified"> 87         public Val? computeBox(Val? v1, Val? v2) {</span>
 88             return v1;
 89         }
 90 
 91         @Override
<a name="8" id="anc8"></a><span class="line-modified"> 92         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4) {</span>
 93             return v1;
 94         }
 95 
 96         @Override
<a name="9" id="anc9"></a><span class="line-modified"> 97         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4, Val? v5, Val? v6, Val? v7, Val? v8) {</span>
 98             return v1;
 99         }
100 
101         @Override
102         public Val compute(Val v1) {
103             return v1;
104         }
105 
106         @Override
107         public Val compute(Val v1, Val v2) {
108             return v1;
109         }
110 
111         @Override
112         public Val compute(Val v1, Val v2, Val v3, Val v4) {
113             return v1;
114         }
115 
116         @Override
117         public Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8) {
118             return v1;
119         }
120 
121     }
122 
123     static class InvokeImpl3 extends InvocationLogic {
124 
125         @Override
<a name="10" id="anc10"></a><span class="line-modified">126         public Val? computeBox(Val? v1) {</span>
127             return v1;
128         }
129 
130         @Override
<a name="11" id="anc11"></a><span class="line-modified">131         public Val? computeBox(Val? v1, Val? v2) {</span>
132             return v1;
133         }
134 
135         @Override
<a name="12" id="anc12"></a><span class="line-modified">136         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4) {</span>
137             return v1;
138         }
139 
140         @Override
<a name="13" id="anc13"></a><span class="line-modified">141         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4, Val? v5, Val? v6, Val? v7, Val? v8) {</span>
142             return v1;
143         }
144 
145         @Override
146         public Val compute(Val v1) {
147             return v1;
148         }
149 
150         @Override
151         public Val compute(Val v1, Val v2) {
152             return v1;
153         }
154 
155         @Override
156         public Val compute(Val v1, Val v2, Val v3, Val v4) {
157             return v1;
158         }
159 
160         @Override
161         public Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8) {
162             return v1;
163         }
164 
165     }
166 
167     public static final int SIZE = 1 * 2 * 3; // all possible targets
168 
169     InvokeImpl1[] logic0;
170     InvocationLogic[] logic1;
171     InvocationLogic[] logic2;
172     InvocationLogic[] logic3;
173 
174 
175 
176     @Setup
177     public void setup() {
178         logic0 = new InvokeImpl1[SIZE];
179         for (int i = 0; i &lt; SIZE; i++) {
180             logic0[i] = new InvokeImpl1();
181         }
182         logic1 = populate(1);
183         logic2 = populate(2);
184         logic3 = populate(3);
185     }
186 
187     private InvocationLogic[] populate(int targets) {
188         assert targets &gt; 0 &amp;&amp; targets &lt;= 3;
189         InvocationLogic[] logic = new InvocationLogic[SIZE];
190         for (int i = 0; i &lt; SIZE; i++) {
191             switch (i % targets) {
192                 case 0:
193                     logic[i] = new InvokeImpl1();
194                     break;
195                 case 1:
196                     logic[i] = new InvokeImpl2();
197                     break;
198                 case 2:
199                     logic[i] = new InvokeImpl3();
200                     break;
201             }
202         }
203         return logic;
204     }
205 
<a name="14" id="anc14"></a><span class="line-modified">206     Val? b1 = new Val(42);</span>
<span class="line-modified">207     Val? b2 = new Val(43);</span>
<span class="line-modified">208     Val? b3 = new Val(44);</span>
<span class="line-modified">209     Val? b4 = new Val(45);</span>
<span class="line-modified">210     Val? b5 = new Val(46);</span>
<span class="line-modified">211     Val? b6 = new Val(47);</span>
<span class="line-modified">212     Val? b7 = new Val(48);</span>
<span class="line-modified">213     Val? b8 = new Val(49);</span>
214 
215     @CompilerControl(CompilerControl.Mode.INLINE)
216     public int boxed1(InvocationLogic[] logic) {
217         int r = 0;
218         for(InvocationLogic t : logic) {
219             r += t.computeBox(b1).f0;
220         }
221         return r;
222     }
223 
224     @CompilerControl(CompilerControl.Mode.INLINE)
225     public int boxed2(InvocationLogic[] logic) {
226         int r = 0;
227         for(InvocationLogic t : logic) {
228             r += t.computeBox(b1, b2).f0;
229         }
230         return r;
231     }
232 
233     @CompilerControl(CompilerControl.Mode.INLINE)
234     public int boxed4(InvocationLogic[] logic) {
235         int r = 0;
236         for(InvocationLogic t : logic) {
237             r += t.computeBox(b1, b2, b3, b4).f0;
238         }
239         return r;
240     }
241 
242     @CompilerControl(CompilerControl.Mode.INLINE)
243     public int boxed8(InvocationLogic[] logic) {
244         int r = 0;
245         for(InvocationLogic t : logic) {
246             r += t.computeBox(b1, b2, b3, b4, b5, b6, b7, b8).f0;
247         }
248         return r;
249     }
250 
251     Val a1 = new Val(42);
252     Val a2 = new Val(43);
253     Val a3 = new Val(44);
254     Val a4 = new Val(45);
255     Val a5 = new Val(46);
256     Val a6 = new Val(47);
257     Val a7 = new Val(48);
258     Val a8 = new Val(49);
259 
260     @CompilerControl(CompilerControl.Mode.INLINE)
261     public int value1(InvocationLogic[] logic) {
262         int r = 0;
263         for(InvocationLogic t : logic) {
264             r += t.compute(a1).f0;
265         }
266         return r;
267     }
268 
269     @CompilerControl(CompilerControl.Mode.INLINE)
270     public int value2(InvocationLogic[] logic) {
271         int r = 0;
272         for(InvocationLogic t : logic) {
273             r += t.compute(a1, a2).f0;
274         }
275         return r;
276     }
277 
278     @CompilerControl(CompilerControl.Mode.INLINE)
279     public int value4(InvocationLogic[] logic) {
280         int r = 0;
281         for(InvocationLogic t : logic) {
282             r += t.compute(a1, a2, a3, a4).f0;
283         }
284         return r;
285     }
286 
287     @CompilerControl(CompilerControl.Mode.INLINE)
288     public int value8(InvocationLogic[] logic) {
289         int r = 0;
290         for(InvocationLogic t : logic) {
291             r += t.compute(a1, a2, a3, a4, a5, a6, a7, a8).f0;
292         }
293         return r;
294     }
295 
296     /* targets 0 - means exact type */
297     @Benchmark
298     @OperationsPerInvocation(SIZE)
299     public int boxed_args1_targets0() {
300         return boxed1(logic0);
301     }
302 
303     @Benchmark
304     @OperationsPerInvocation(SIZE)
305     public int boxed_args1_targets1() {
306         return boxed1(logic1);
307     }
308 
309     @Benchmark
310     @OperationsPerInvocation(SIZE)
311     public int boxed_args1_targets2() {
312         return boxed1(logic2);
313     }
314 
315     @Benchmark
316     @OperationsPerInvocation(SIZE)
317     public int boxed_args1_targets3() {
318         return boxed1(logic3);
319     }
320 
321     /* targets 0 - means exact type */
322     @Benchmark
323     @OperationsPerInvocation(SIZE)
324     public int boxed_args2_targets0() {
325         return boxed2(logic0);
326     }
327 
328     @Benchmark
329     @OperationsPerInvocation(SIZE)
330     public int boxed_args2_targets1() {
331         return boxed2(logic1);
332     }
333 
334     @Benchmark
335     @OperationsPerInvocation(SIZE)
336     public int boxed_args2_targets2() {
337         return boxed2(logic2);
338     }
339 
340     @Benchmark
341     @OperationsPerInvocation(SIZE)
342     public int boxed_args2_targets3() {
343         return boxed2(logic3);
344     }
345 
346     /* targets 0 - means exact type */
347     @Benchmark
348     @OperationsPerInvocation(SIZE)
349     public int boxed_args4_targets0() {
350         return boxed4(logic0);
351     }
352 
353     @Benchmark
354     @OperationsPerInvocation(SIZE)
355     public int boxed_args4_targets1() {
356         return boxed4(logic1);
357     }
358 
359     @Benchmark
360     @OperationsPerInvocation(SIZE)
361     public int boxed_args4_targets2() {
362         return boxed4(logic2);
363     }
364 
365     @Benchmark
366     @OperationsPerInvocation(SIZE)
367     public int boxed_args4_targets3() {
368         return boxed4(logic3);
369     }
370 
371     /* targets 0 - means exact type */
372     @Benchmark
373     @OperationsPerInvocation(SIZE)
374     public int boxed_args8_targets0() {
375         return boxed8(logic0);
376     }
377 
378     @Benchmark
379     @OperationsPerInvocation(SIZE)
380     public int boxed_args8_targets1() {
381         return boxed8(logic1);
382     }
383 
384     @Benchmark
385     @OperationsPerInvocation(SIZE)
386     public int boxed_args8_targets2() {
387         return boxed8(logic2);
388     }
389 
390     @Benchmark
391     @OperationsPerInvocation(SIZE)
392     public int boxed_args8_targets3() {
393         return boxed8(logic3);
394     }
395 
396     /* targets 0 - means exact type */
397     @Benchmark
398     @OperationsPerInvocation(SIZE)
399     public int value_args1_targets0() {
400         return value1(logic0);
401     }
402 
403     @Benchmark
404     @OperationsPerInvocation(SIZE)
405     public int value_args1_targets1() {
406         return value1(logic1);
407     }
408 
409     @Benchmark
410     @OperationsPerInvocation(SIZE)
411     public int value_args1_targets2() {
412         return value1(logic2);
413     }
414 
415     @Benchmark
416     @OperationsPerInvocation(SIZE)
417     public int value_args1_targets3() {
418         return value1(logic3);
419     }
420 
421     /* targets 0 - means exact type */
422     @Benchmark
423     @OperationsPerInvocation(SIZE)
424     public int value_args2_targets0() {
425         return value2(logic0);
426     }
427 
428     @Benchmark
429     @OperationsPerInvocation(SIZE)
430     public int value_args2_targets1() {
431         return value2(logic1);
432     }
433 
434     @Benchmark
435     @OperationsPerInvocation(SIZE)
436     public int value_args2_targets2() {
437         return value2(logic2);
438     }
439 
440     @Benchmark
441     @OperationsPerInvocation(SIZE)
442     public int value_args2_targets3() {
443         return value2(logic3);
444     }
445 
446     /* targets 0 - means exact type */
447     @Benchmark
448     @OperationsPerInvocation(SIZE)
449     public int value_args4_targets0() {
450         return value4(logic0);
451     }
452 
453     @Benchmark
454     @OperationsPerInvocation(SIZE)
455     public int value_args4_targets1() {
456         return value4(logic1);
457     }
458 
459     @Benchmark
460     @OperationsPerInvocation(SIZE)
461     public int value_args4_targets2() {
462         return value4(logic2);
463     }
464 
465     @Benchmark
466     @OperationsPerInvocation(SIZE)
467     public int value_args4_targets3() {
468         return value4(logic3);
469     }
470 
471     /* targets 0 - means exact type */
472     @Benchmark
473     @OperationsPerInvocation(SIZE)
474     public int value_args8_targets0() {
475         return value8(logic0);
476     }
477 
478     @Benchmark
479     @OperationsPerInvocation(SIZE)
480     public int value_args8_targets1() {
481         return value8(logic1);
482     }
483 
484     @Benchmark
485     @OperationsPerInvocation(SIZE)
486     public int value_args8_targets2() {
487         return value8(logic2);
488     }
489 
490     @Benchmark
491     @OperationsPerInvocation(SIZE)
492     public int value_args8_targets3() {
493         return value8(logic3);
494     }
495 
<a name="15" id="anc15"></a><span class="line-modified">496 }</span>
<a name="16" id="anc16"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="16" type="hidden" />
</body>
</html>