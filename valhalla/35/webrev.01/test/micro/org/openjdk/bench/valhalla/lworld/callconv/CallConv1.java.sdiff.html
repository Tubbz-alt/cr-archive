<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/micro/org/openjdk/bench/valhalla/lworld/callconv/CallConv1.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Ackermann8.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../fields/NodeBox1.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/micro/org/openjdk/bench/valhalla/lworld/callconv/CallConv1.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  3 import org.openjdk.jmh.annotations.Benchmark;
  4 import org.openjdk.jmh.annotations.CompilerControl;
  5 import org.openjdk.jmh.annotations.OperationsPerInvocation;
  6 import org.openjdk.jmh.annotations.Setup;
  7 import org.openjdk.bench.valhalla.CallBase;
  8 
  9 
 10 public class CallConv1 extends CallBase {
 11 
 12     public static inline class Val {
 13 
 14         public final int f0;
 15 
 16         public Val(int f0) {
 17             this.f0 = f0;
 18         }
 19     }
 20 
 21     abstract static class InvocationLogic {
 22 
<span class="line-modified"> 23         public abstract Val? computeBox(Val? v1);</span>
<span class="line-modified"> 24         public abstract Val? computeBox(Val? v1, Val? v2);</span>
<span class="line-modified"> 25         public abstract Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4);</span>
<span class="line-modified"> 26         public abstract Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4, Val? v5, Val? v6, Val? v7, Val? v8);</span>
 27 
 28         public abstract Val compute(Val v1);
 29         public abstract Val compute(Val v1, Val v2);
 30         public abstract Val compute(Val v1, Val v2, Val v3, Val v4);
 31         public abstract Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8);
 32 
 33     }
 34 
 35     static class InvokeImpl1 extends InvocationLogic {
 36 
 37         @Override
<span class="line-modified"> 38         public Val? computeBox(Val? v1) {</span>
 39             return v1;
 40         }
 41 
 42         @Override
<span class="line-modified"> 43         public Val? computeBox(Val? v1, Val? v2) {</span>
 44             return v1;
 45         }
 46 
 47         @Override
<span class="line-modified"> 48         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4) {</span>
 49             return v1;
 50         }
 51 
 52         @Override
<span class="line-modified"> 53         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4, Val? v5, Val? v6, Val? v7, Val? v8) {</span>
 54             return v1;
 55         }
 56 
 57         @Override
 58         public Val compute(Val v1) {
 59             return v1;
 60         }
 61 
 62         @Override
 63         public Val compute(Val v1, Val v2) {
 64             return v1;
 65         }
 66 
 67         @Override
 68         public Val compute(Val v1, Val v2, Val v3, Val v4) {
 69             return v1;
 70         }
 71 
 72         @Override
 73         public Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8) {
 74             return v1;
 75         }
 76 
 77     }
 78 
 79     static class InvokeImpl2 extends InvocationLogic {
 80 
 81         @Override
<span class="line-modified"> 82         public Val? computeBox(Val? v1) {</span>
 83             return v1;
 84         }
 85 
 86         @Override
<span class="line-modified"> 87         public Val? computeBox(Val? v1, Val? v2) {</span>
 88             return v1;
 89         }
 90 
 91         @Override
<span class="line-modified"> 92         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4) {</span>
 93             return v1;
 94         }
 95 
 96         @Override
<span class="line-modified"> 97         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4, Val? v5, Val? v6, Val? v7, Val? v8) {</span>
 98             return v1;
 99         }
100 
101         @Override
102         public Val compute(Val v1) {
103             return v1;
104         }
105 
106         @Override
107         public Val compute(Val v1, Val v2) {
108             return v1;
109         }
110 
111         @Override
112         public Val compute(Val v1, Val v2, Val v3, Val v4) {
113             return v1;
114         }
115 
116         @Override
117         public Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8) {
118             return v1;
119         }
120 
121     }
122 
123     static class InvokeImpl3 extends InvocationLogic {
124 
125         @Override
<span class="line-modified">126         public Val? computeBox(Val? v1) {</span>
127             return v1;
128         }
129 
130         @Override
<span class="line-modified">131         public Val? computeBox(Val? v1, Val? v2) {</span>
132             return v1;
133         }
134 
135         @Override
<span class="line-modified">136         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4) {</span>
137             return v1;
138         }
139 
140         @Override
<span class="line-modified">141         public Val? computeBox(Val? v1, Val? v2, Val? v3, Val? v4, Val? v5, Val? v6, Val? v7, Val? v8) {</span>
142             return v1;
143         }
144 
145         @Override
146         public Val compute(Val v1) {
147             return v1;
148         }
149 
150         @Override
151         public Val compute(Val v1, Val v2) {
152             return v1;
153         }
154 
155         @Override
156         public Val compute(Val v1, Val v2, Val v3, Val v4) {
157             return v1;
158         }
159 
160         @Override
161         public Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8) {
</pre>
<hr />
<pre>
186 
187     private InvocationLogic[] populate(int targets) {
188         assert targets &gt; 0 &amp;&amp; targets &lt;= 3;
189         InvocationLogic[] logic = new InvocationLogic[SIZE];
190         for (int i = 0; i &lt; SIZE; i++) {
191             switch (i % targets) {
192                 case 0:
193                     logic[i] = new InvokeImpl1();
194                     break;
195                 case 1:
196                     logic[i] = new InvokeImpl2();
197                     break;
198                 case 2:
199                     logic[i] = new InvokeImpl3();
200                     break;
201             }
202         }
203         return logic;
204     }
205 
<span class="line-modified">206     Val? b1 = new Val(42);</span>
<span class="line-modified">207     Val? b2 = new Val(43);</span>
<span class="line-modified">208     Val? b3 = new Val(44);</span>
<span class="line-modified">209     Val? b4 = new Val(45);</span>
<span class="line-modified">210     Val? b5 = new Val(46);</span>
<span class="line-modified">211     Val? b6 = new Val(47);</span>
<span class="line-modified">212     Val? b7 = new Val(48);</span>
<span class="line-modified">213     Val? b8 = new Val(49);</span>
214 
215     @CompilerControl(CompilerControl.Mode.INLINE)
216     public int boxed1(InvocationLogic[] logic) {
217         int r = 0;
218         for(InvocationLogic t : logic) {
219             r += t.computeBox(b1).f0;
220         }
221         return r;
222     }
223 
224     @CompilerControl(CompilerControl.Mode.INLINE)
225     public int boxed2(InvocationLogic[] logic) {
226         int r = 0;
227         for(InvocationLogic t : logic) {
228             r += t.computeBox(b1, b2).f0;
229         }
230         return r;
231     }
232 
233     @CompilerControl(CompilerControl.Mode.INLINE)
</pre>
<hr />
<pre>
476     }
477 
478     @Benchmark
479     @OperationsPerInvocation(SIZE)
480     public int value_args8_targets1() {
481         return value8(logic1);
482     }
483 
484     @Benchmark
485     @OperationsPerInvocation(SIZE)
486     public int value_args8_targets2() {
487         return value8(logic2);
488     }
489 
490     @Benchmark
491     @OperationsPerInvocation(SIZE)
492     public int value_args8_targets3() {
493         return value8(logic3);
494     }
495 
<span class="line-modified">496 }</span>
</pre>
</td>
<td>
<hr />
<pre>
  3 import org.openjdk.jmh.annotations.Benchmark;
  4 import org.openjdk.jmh.annotations.CompilerControl;
  5 import org.openjdk.jmh.annotations.OperationsPerInvocation;
  6 import org.openjdk.jmh.annotations.Setup;
  7 import org.openjdk.bench.valhalla.CallBase;
  8 
  9 
 10 public class CallConv1 extends CallBase {
 11 
 12     public static inline class Val {
 13 
 14         public final int f0;
 15 
 16         public Val(int f0) {
 17             this.f0 = f0;
 18         }
 19     }
 20 
 21     abstract static class InvocationLogic {
 22 
<span class="line-modified"> 23         public abstract Val.ref computeBox(Val.ref v1);</span>
<span class="line-modified"> 24         public abstract Val.ref computeBox(Val.ref v1, Val.ref v2);</span>
<span class="line-modified"> 25         public abstract Val.ref computeBox(Val.ref v1, Val.ref v2, Val.ref v3, Val.ref v4);</span>
<span class="line-modified"> 26         public abstract Val.ref computeBox(Val.ref v1, Val.ref v2, Val.ref v3, Val.ref v4, Val.ref v5, Val.ref v6, Val.ref v7, Val.ref v8);</span>
 27 
 28         public abstract Val compute(Val v1);
 29         public abstract Val compute(Val v1, Val v2);
 30         public abstract Val compute(Val v1, Val v2, Val v3, Val v4);
 31         public abstract Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8);
 32 
 33     }
 34 
 35     static class InvokeImpl1 extends InvocationLogic {
 36 
 37         @Override
<span class="line-modified"> 38         public Val.ref computeBox(Val.ref v1) {</span>
 39             return v1;
 40         }
 41 
 42         @Override
<span class="line-modified"> 43         public Val.ref computeBox(Val.ref v1, Val.ref v2) {</span>
 44             return v1;
 45         }
 46 
 47         @Override
<span class="line-modified"> 48         public Val.ref computeBox(Val.ref v1, Val.ref v2, Val.ref v3, Val.ref v4) {</span>
 49             return v1;
 50         }
 51 
 52         @Override
<span class="line-modified"> 53         public Val.ref computeBox(Val.ref v1, Val.ref v2, Val.ref v3, Val.ref v4, Val.ref v5, Val.ref v6, Val.ref v7, Val.ref v8) {</span>
 54             return v1;
 55         }
 56 
 57         @Override
 58         public Val compute(Val v1) {
 59             return v1;
 60         }
 61 
 62         @Override
 63         public Val compute(Val v1, Val v2) {
 64             return v1;
 65         }
 66 
 67         @Override
 68         public Val compute(Val v1, Val v2, Val v3, Val v4) {
 69             return v1;
 70         }
 71 
 72         @Override
 73         public Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8) {
 74             return v1;
 75         }
 76 
 77     }
 78 
 79     static class InvokeImpl2 extends InvocationLogic {
 80 
 81         @Override
<span class="line-modified"> 82         public Val.ref computeBox(Val.ref v1) {</span>
 83             return v1;
 84         }
 85 
 86         @Override
<span class="line-modified"> 87         public Val.ref computeBox(Val.ref v1, Val.ref v2) {</span>
 88             return v1;
 89         }
 90 
 91         @Override
<span class="line-modified"> 92         public Val.ref computeBox(Val.ref v1, Val.ref v2, Val.ref v3, Val.ref v4) {</span>
 93             return v1;
 94         }
 95 
 96         @Override
<span class="line-modified"> 97         public Val.ref computeBox(Val.ref v1, Val.ref v2, Val.ref v3, Val.ref v4, Val.ref v5, Val.ref v6, Val.ref v7, Val.ref v8) {</span>
 98             return v1;
 99         }
100 
101         @Override
102         public Val compute(Val v1) {
103             return v1;
104         }
105 
106         @Override
107         public Val compute(Val v1, Val v2) {
108             return v1;
109         }
110 
111         @Override
112         public Val compute(Val v1, Val v2, Val v3, Val v4) {
113             return v1;
114         }
115 
116         @Override
117         public Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8) {
118             return v1;
119         }
120 
121     }
122 
123     static class InvokeImpl3 extends InvocationLogic {
124 
125         @Override
<span class="line-modified">126         public Val.ref computeBox(Val.ref v1) {</span>
127             return v1;
128         }
129 
130         @Override
<span class="line-modified">131         public Val.ref computeBox(Val.ref v1, Val.ref v2) {</span>
132             return v1;
133         }
134 
135         @Override
<span class="line-modified">136         public Val.ref computeBox(Val.ref v1, Val.ref v2, Val.ref v3, Val.ref v4) {</span>
137             return v1;
138         }
139 
140         @Override
<span class="line-modified">141         public Val.ref computeBox(Val.ref v1, Val.ref v2, Val.ref v3, Val.ref v4, Val.ref v5, Val.ref v6, Val.ref v7, Val.ref v8) {</span>
142             return v1;
143         }
144 
145         @Override
146         public Val compute(Val v1) {
147             return v1;
148         }
149 
150         @Override
151         public Val compute(Val v1, Val v2) {
152             return v1;
153         }
154 
155         @Override
156         public Val compute(Val v1, Val v2, Val v3, Val v4) {
157             return v1;
158         }
159 
160         @Override
161         public Val compute(Val v1, Val v2, Val v3, Val v4, Val v5, Val v6, Val v7, Val v8) {
</pre>
<hr />
<pre>
186 
187     private InvocationLogic[] populate(int targets) {
188         assert targets &gt; 0 &amp;&amp; targets &lt;= 3;
189         InvocationLogic[] logic = new InvocationLogic[SIZE];
190         for (int i = 0; i &lt; SIZE; i++) {
191             switch (i % targets) {
192                 case 0:
193                     logic[i] = new InvokeImpl1();
194                     break;
195                 case 1:
196                     logic[i] = new InvokeImpl2();
197                     break;
198                 case 2:
199                     logic[i] = new InvokeImpl3();
200                     break;
201             }
202         }
203         return logic;
204     }
205 
<span class="line-modified">206     Val.ref b1 = new Val(42);</span>
<span class="line-modified">207     Val.ref b2 = new Val(43);</span>
<span class="line-modified">208     Val.ref b3 = new Val(44);</span>
<span class="line-modified">209     Val.ref b4 = new Val(45);</span>
<span class="line-modified">210     Val.ref b5 = new Val(46);</span>
<span class="line-modified">211     Val.ref b6 = new Val(47);</span>
<span class="line-modified">212     Val.ref b7 = new Val(48);</span>
<span class="line-modified">213     Val.ref b8 = new Val(49);</span>
214 
215     @CompilerControl(CompilerControl.Mode.INLINE)
216     public int boxed1(InvocationLogic[] logic) {
217         int r = 0;
218         for(InvocationLogic t : logic) {
219             r += t.computeBox(b1).f0;
220         }
221         return r;
222     }
223 
224     @CompilerControl(CompilerControl.Mode.INLINE)
225     public int boxed2(InvocationLogic[] logic) {
226         int r = 0;
227         for(InvocationLogic t : logic) {
228             r += t.computeBox(b1, b2).f0;
229         }
230         return r;
231     }
232 
233     @CompilerControl(CompilerControl.Mode.INLINE)
</pre>
<hr />
<pre>
476     }
477 
478     @Benchmark
479     @OperationsPerInvocation(SIZE)
480     public int value_args8_targets1() {
481         return value8(logic1);
482     }
483 
484     @Benchmark
485     @OperationsPerInvocation(SIZE)
486     public int value_args8_targets2() {
487         return value8(logic2);
488     }
489 
490     @Benchmark
491     @OperationsPerInvocation(SIZE)
492     public int value_args8_targets3() {
493         return value8(logic3);
494     }
495 
<span class="line-modified">496 }</span>
</pre>
</td>
</tr>
</table>
<center><a href="Ackermann8.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../fields/NodeBox1.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>