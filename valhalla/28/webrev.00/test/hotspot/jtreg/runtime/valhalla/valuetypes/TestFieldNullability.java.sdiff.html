<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/runtime/valhalla/valuetypes/TestFieldNullability.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="QuickeningTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestValue1.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/valhalla/valuetypes/TestFieldNullability.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 36 public class TestFieldNullability {
 37     static inline class MyValue {
 38         int x;
 39 
 40         public MyValue() {
 41             x = 314;
 42         }
 43     }
 44 
 45     static inline class MyBigValue {
 46         long l0, l1, l2, l3, l4, l5, l6, l7, l8, l9;
 47         long l10, l11, l12, l13, l14, l15, l16, l17, l18, l19;
 48 
 49         public MyBigValue() {
 50             l0 = l1 = l2 = l3 = l4 = l5 = l6 = l7 = l8 = l9 = 271;
 51             l10 = l11 = l12 = l13 = l14 = l15 = l16 = l17 = l18 = l19 = 271;
 52         }
 53     }
 54 
 55     static inline class TestValue {
<span class="line-modified"> 56         final MyValue? nullableField;</span>
 57         final MyValue nullfreeField;        // flattened
<span class="line-modified"> 58         final MyValue? nullField;           // src of null</span>
 59         final MyBigValue nullfreeBigField;  // not flattened
<span class="line-modified"> 60         final MyBigValue? nullBigField;     // src of null</span>
 61 
 62         public void test() {
 63             Asserts.assertNull(nullField, &quot;Invalid non null value for uninitialized non flattenable field&quot;);
 64             Asserts.assertNull(nullBigField, &quot;Invalid non null value for uninitialized non flattenable field&quot;);
 65             boolean NPE = false;
 66             try {
 67                 TestValue tv = __WithField(this.nullableField, nullField);
 68             } catch(NullPointerException e) {
 69                 NPE = true;
 70             }
 71             Asserts.assertFalse(NPE, &quot;Invalid NPE when assigning null to a non flattenable field&quot;);
 72             try {
 73                 TestValue tv = __WithField(this.nullfreeField, (MyValue) nullField);
 74             } catch(NullPointerException e) {
 75                 NPE = true;
 76             }
 77             Asserts.assertTrue(NPE, &quot;Missing NPE when assigning null to a flattened field&quot;);
 78             try {
 79                 TestValue tv = __WithField(this.nullfreeBigField, (MyBigValue) nullBigField);
 80             } catch(NullPointerException e) {
 81                 NPE = true;
 82             }
 83             Asserts.assertTrue(NPE, &quot;Missing NPE when assigning null to a flattenable field&quot;);
 84         }
 85 
 86         public TestValue() {
 87             nullableField = MyValue.default;
 88             nullfreeField = MyValue.default;
 89             nullField = MyValue.default;           // fake assignment
 90             nullfreeBigField = MyBigValue.default;
 91             nullBigField = MyBigValue.default;     // fake assignment
 92 
 93         }
 94     }
 95 
 96     static class TestClass {
<span class="line-modified"> 97         MyValue? nullableField;</span>
 98         MyValue nullfreeField;       // flattened
<span class="line-modified"> 99         MyValue? nullField;</span>
100         MyBigValue nullfreeBigField; // not flattened
<span class="line-modified">101         MyBigValue? nullBigField;</span>
102 
103         public void test() {
104             Asserts.assertNull(nullField, &quot;Invalid non null value for uninitialized non flattenable field&quot;);
105             Asserts.assertNull(nullBigField, &quot;Invalid non null value for uninitialized non flattenable field&quot;);
106             boolean NPE = false;
107             try {
108                 nullableField = nullField;
109             } catch(NullPointerException e) {
110                 NPE = true;
111             }
112             Asserts.assertFalse(NPE, &quot;Invalid NPE when assigning null to a non flattenable field&quot;);
113             try {
114                 this.nullfreeField = (MyValue) nullField;
115             } catch(NullPointerException e) {
116                 NPE = true;
117             }
118             Asserts.assertTrue(NPE, &quot;Missing NPE when assigning null to a flattened field&quot;);
119             try {
120                 this.nullfreeBigField = (MyBigValue) nullBigField;
121             } catch(NullPointerException e) {
</pre>
</td>
<td>
<hr />
<pre>
 36 public class TestFieldNullability {
 37     static inline class MyValue {
 38         int x;
 39 
 40         public MyValue() {
 41             x = 314;
 42         }
 43     }
 44 
 45     static inline class MyBigValue {
 46         long l0, l1, l2, l3, l4, l5, l6, l7, l8, l9;
 47         long l10, l11, l12, l13, l14, l15, l16, l17, l18, l19;
 48 
 49         public MyBigValue() {
 50             l0 = l1 = l2 = l3 = l4 = l5 = l6 = l7 = l8 = l9 = 271;
 51             l10 = l11 = l12 = l13 = l14 = l15 = l16 = l17 = l18 = l19 = 271;
 52         }
 53     }
 54 
 55     static inline class TestValue {
<span class="line-modified"> 56         final MyValue.ref nullableField;</span>
 57         final MyValue nullfreeField;        // flattened
<span class="line-modified"> 58         final MyValue.ref nullField;           // src of null</span>
 59         final MyBigValue nullfreeBigField;  // not flattened
<span class="line-modified"> 60         final MyBigValue.ref nullBigField;     // src of null</span>
 61 
 62         public void test() {
 63             Asserts.assertNull(nullField, &quot;Invalid non null value for uninitialized non flattenable field&quot;);
 64             Asserts.assertNull(nullBigField, &quot;Invalid non null value for uninitialized non flattenable field&quot;);
 65             boolean NPE = false;
 66             try {
 67                 TestValue tv = __WithField(this.nullableField, nullField);
 68             } catch(NullPointerException e) {
 69                 NPE = true;
 70             }
 71             Asserts.assertFalse(NPE, &quot;Invalid NPE when assigning null to a non flattenable field&quot;);
 72             try {
 73                 TestValue tv = __WithField(this.nullfreeField, (MyValue) nullField);
 74             } catch(NullPointerException e) {
 75                 NPE = true;
 76             }
 77             Asserts.assertTrue(NPE, &quot;Missing NPE when assigning null to a flattened field&quot;);
 78             try {
 79                 TestValue tv = __WithField(this.nullfreeBigField, (MyBigValue) nullBigField);
 80             } catch(NullPointerException e) {
 81                 NPE = true;
 82             }
 83             Asserts.assertTrue(NPE, &quot;Missing NPE when assigning null to a flattenable field&quot;);
 84         }
 85 
 86         public TestValue() {
 87             nullableField = MyValue.default;
 88             nullfreeField = MyValue.default;
 89             nullField = MyValue.default;           // fake assignment
 90             nullfreeBigField = MyBigValue.default;
 91             nullBigField = MyBigValue.default;     // fake assignment
 92 
 93         }
 94     }
 95 
 96     static class TestClass {
<span class="line-modified"> 97         MyValue.ref nullableField;</span>
 98         MyValue nullfreeField;       // flattened
<span class="line-modified"> 99         MyValue.ref nullField;</span>
100         MyBigValue nullfreeBigField; // not flattened
<span class="line-modified">101         MyBigValue.ref nullBigField;</span>
102 
103         public void test() {
104             Asserts.assertNull(nullField, &quot;Invalid non null value for uninitialized non flattenable field&quot;);
105             Asserts.assertNull(nullBigField, &quot;Invalid non null value for uninitialized non flattenable field&quot;);
106             boolean NPE = false;
107             try {
108                 nullableField = nullField;
109             } catch(NullPointerException e) {
110                 NPE = true;
111             }
112             Asserts.assertFalse(NPE, &quot;Invalid NPE when assigning null to a non flattenable field&quot;);
113             try {
114                 this.nullfreeField = (MyValue) nullField;
115             } catch(NullPointerException e) {
116                 NPE = true;
117             }
118             Asserts.assertTrue(NPE, &quot;Missing NPE when assigning null to a flattened field&quot;);
119             try {
120                 this.nullfreeBigField = (MyBigValue) nullBigField;
121             } catch(NullPointerException e) {
</pre>
</td>
</tr>
</table>
<center><a href="QuickeningTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestValue1.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>