<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/classfile/javaClasses.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="javaClasses.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../oops/instanceKlass.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/javaClasses.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 247   friend class VMStructs;
 248   friend class JVMCIVMStructs;
 249 
 250  private:
 251   // The fake offsets are added by the class loader when java.lang.Class is loaded
 252 
 253   static int _klass_offset;
 254   static int _array_klass_offset;
 255 
 256   static int _oop_size_offset;
 257   static int _static_oop_field_count_offset;
 258 
 259   static int _protection_domain_offset;
 260   static int _init_lock_offset;
 261   static int _signers_offset;
 262   static int _class_loader_offset;
 263   static int _module_offset;
 264   static int _component_mirror_offset;
 265   static int _name_offset;
 266   static int _source_file_offset;
<span class="line-modified"> 267   static int _inline_mirror_offset;</span>
<span class="line-modified"> 268   static int _indirect_mirror_offset;</span>
 269 
 270   static bool offsets_computed;
 271   static int classRedefinedCount_offset;
 272 
 273   static GrowableArray&lt;Klass*&gt;* _fixup_mirror_list;
 274   static GrowableArray&lt;Klass*&gt;* _fixup_module_field_list;
 275 
 276   static void set_init_lock(oop java_class, oop init_lock);
 277   static void set_protection_domain(oop java_class, oop protection_domain);
 278   static void set_class_loader(oop java_class, oop class_loader);
 279   static void set_component_mirror(oop java_class, oop comp_mirror);
 280   static void initialize_mirror_fields(Klass* k, Handle mirror, Handle protection_domain, TRAPS);
 281   static void set_mirror_module_field(Klass* K, Handle mirror, Handle module, TRAPS);
 282  public:
 283   static void allocate_fixup_lists();
 284   static void compute_offsets();
 285 
 286   // Instance creation
 287   static void create_mirror(Klass* k, Handle class_loader, Handle module,
 288                             Handle protection_domain, TRAPS);
 289   static void fixup_mirror(Klass* k, TRAPS);
 290   static oop  create_basic_type_mirror(const char* basic_type_name, BasicType type, TRAPS);
<span class="line-removed"> 291   static oop  create_indirect_type_mirror(Klass* k, Handle mirror, TRAPS);</span>
 292   static void update_archived_primitive_mirror_native_pointers(oop archived_mirror) NOT_CDS_JAVA_HEAP_RETURN;
 293   static void update_archived_mirror_native_pointers(oop archived_mirror) NOT_CDS_JAVA_HEAP_RETURN;
 294 
 295   // Archiving
 296   static void serialize_offsets(SerializeClosure* f) NOT_CDS_RETURN;
 297   static void archive_basic_type_mirrors(TRAPS) NOT_CDS_JAVA_HEAP_RETURN;
 298   static oop  archive_mirror(Klass* k, TRAPS) NOT_CDS_JAVA_HEAP_RETURN_(NULL);
 299   static oop  process_archived_mirror(Klass* k, oop mirror, oop archived_mirror, Thread *THREAD)
 300                                       NOT_CDS_JAVA_HEAP_RETURN_(NULL);
 301   static bool restore_archived_mirror(Klass *k, Handle class_loader, Handle module,
 302                                       Handle protection_domain,
 303                                       TRAPS) NOT_CDS_JAVA_HEAP_RETURN_(false);
 304 
 305   static void fixup_module_field(Klass* k, Handle module);
 306 
 307   // Conversion
 308   static Klass* as_Klass(oop java_class);
 309   static Klass* as_Klass_raw(oop java_class);
 310   static void set_klass(oop java_class, Klass* klass);
 311   static BasicType as_BasicType(oop java_class, Klass** reference_klass = NULL);
 312   static Symbol* as_signature(oop java_class, bool intern_if_not_found);
 313   static void print_signature(oop java_class, outputStream *st);
 314   static const char* as_external_name(oop java_class);
 315   // Testing
 316   static bool is_instance(oop obj);
 317 
 318   static bool is_primitive(oop java_class);
 319   static BasicType primitive_type(oop java_class);
 320   static oop primitive_mirror(BasicType t);
 321   // JVM_NewArray support
 322   static Klass* array_klass_acquire(oop java_class);
 323   static void release_set_array_klass(oop java_class, Klass* klass);
 324   // compiler support for class operations
 325   static int klass_offset_in_bytes()                { return _klass_offset; }
 326   static int array_klass_offset_in_bytes()          { return _array_klass_offset; }
<span class="line-removed"> 327   static int inline_mirror_offset_in_bytes()        { return _inline_mirror_offset; }</span>
 328   static int component_mirror_offset_in_bytes()     { return _component_mirror_offset; }
 329   // Support for classRedefinedCount field
 330   static int classRedefinedCount(oop the_class_mirror);
 331   static void set_classRedefinedCount(oop the_class_mirror, int value);
 332 
 333   // Support for embedded per-class oops
 334   static oop  protection_domain(oop java_class);
 335   static oop  init_lock(oop java_class);
 336   static oop  component_mirror(oop java_class);
 337   static objArrayOop  signers(oop java_class);
 338   static void set_signers(oop java_class, objArrayOop signers);
 339 
 340   static oop class_loader(oop java_class);
 341   static void set_module(oop java_class, oop module);
 342   static oop module(oop java_class);
 343 
<span class="line-modified"> 344   static void set_indirect_type_mirror(oop java_class, oop mirror);</span>
<span class="line-modified"> 345   static oop indirect_type_mirror(oop java_class);</span>
<span class="line-removed"> 346   static bool is_indirect_type(oop java_class) { // Must match &quot;Class.isIndirectType()&quot;</span>
<span class="line-removed"> 347     return indirect_type_mirror(java_class) == NULL || indirect_type_mirror(java_class) == java_class;</span>
<span class="line-removed"> 348   }</span>
 349 
<span class="line-modified"> 350   static void set_inline_type_mirror(oop java_class, oop mirror);</span>
<span class="line-modified"> 351   static oop inline_type_mirror(oop java_class);</span>
 352 
 353   static oop name(Handle java_class, TRAPS);
 354 
 355   static oop source_file(oop java_class);
 356   static void set_source_file(oop java_class, oop source_file);
 357 
 358   static int oop_size(oop java_class);
 359   static int oop_size_raw(oop java_class);
 360   static void set_oop_size(HeapWord* java_class, int size);
 361   static int static_oop_field_count(oop java_class);
 362   static int static_oop_field_count_raw(oop java_class);
 363   static void set_static_oop_field_count(oop java_class, int size);
 364 
 365   static GrowableArray&lt;Klass*&gt;* fixup_mirror_list() {
 366     return _fixup_mirror_list;
 367   }
 368   static void set_fixup_mirror_list(GrowableArray&lt;Klass*&gt;* v) {
 369     _fixup_mirror_list = v;
 370   }
 371 
</pre>
</td>
<td>
<hr />
<pre>
 247   friend class VMStructs;
 248   friend class JVMCIVMStructs;
 249 
 250  private:
 251   // The fake offsets are added by the class loader when java.lang.Class is loaded
 252 
 253   static int _klass_offset;
 254   static int _array_klass_offset;
 255 
 256   static int _oop_size_offset;
 257   static int _static_oop_field_count_offset;
 258 
 259   static int _protection_domain_offset;
 260   static int _init_lock_offset;
 261   static int _signers_offset;
 262   static int _class_loader_offset;
 263   static int _module_offset;
 264   static int _component_mirror_offset;
 265   static int _name_offset;
 266   static int _source_file_offset;
<span class="line-modified"> 267   static int _val_type_mirror_offset;</span>
<span class="line-modified"> 268   static int _ref_type_mirror_offset;</span>
 269 
 270   static bool offsets_computed;
 271   static int classRedefinedCount_offset;
 272 
 273   static GrowableArray&lt;Klass*&gt;* _fixup_mirror_list;
 274   static GrowableArray&lt;Klass*&gt;* _fixup_module_field_list;
 275 
 276   static void set_init_lock(oop java_class, oop init_lock);
 277   static void set_protection_domain(oop java_class, oop protection_domain);
 278   static void set_class_loader(oop java_class, oop class_loader);
 279   static void set_component_mirror(oop java_class, oop comp_mirror);
 280   static void initialize_mirror_fields(Klass* k, Handle mirror, Handle protection_domain, TRAPS);
 281   static void set_mirror_module_field(Klass* K, Handle mirror, Handle module, TRAPS);
 282  public:
 283   static void allocate_fixup_lists();
 284   static void compute_offsets();
 285 
 286   // Instance creation
 287   static void create_mirror(Klass* k, Handle class_loader, Handle module,
 288                             Handle protection_domain, TRAPS);
 289   static void fixup_mirror(Klass* k, TRAPS);
 290   static oop  create_basic_type_mirror(const char* basic_type_name, BasicType type, TRAPS);

 291   static void update_archived_primitive_mirror_native_pointers(oop archived_mirror) NOT_CDS_JAVA_HEAP_RETURN;
 292   static void update_archived_mirror_native_pointers(oop archived_mirror) NOT_CDS_JAVA_HEAP_RETURN;
 293 
 294   // Archiving
 295   static void serialize_offsets(SerializeClosure* f) NOT_CDS_RETURN;
 296   static void archive_basic_type_mirrors(TRAPS) NOT_CDS_JAVA_HEAP_RETURN;
 297   static oop  archive_mirror(Klass* k, TRAPS) NOT_CDS_JAVA_HEAP_RETURN_(NULL);
 298   static oop  process_archived_mirror(Klass* k, oop mirror, oop archived_mirror, Thread *THREAD)
 299                                       NOT_CDS_JAVA_HEAP_RETURN_(NULL);
 300   static bool restore_archived_mirror(Klass *k, Handle class_loader, Handle module,
 301                                       Handle protection_domain,
 302                                       TRAPS) NOT_CDS_JAVA_HEAP_RETURN_(false);
 303 
 304   static void fixup_module_field(Klass* k, Handle module);
 305 
 306   // Conversion
 307   static Klass* as_Klass(oop java_class);
 308   static Klass* as_Klass_raw(oop java_class);
 309   static void set_klass(oop java_class, Klass* klass);
 310   static BasicType as_BasicType(oop java_class, Klass** reference_klass = NULL);
 311   static Symbol* as_signature(oop java_class, bool intern_if_not_found);
 312   static void print_signature(oop java_class, outputStream *st);
 313   static const char* as_external_name(oop java_class);
 314   // Testing
 315   static bool is_instance(oop obj);
 316 
 317   static bool is_primitive(oop java_class);
 318   static BasicType primitive_type(oop java_class);
 319   static oop primitive_mirror(BasicType t);
 320   // JVM_NewArray support
 321   static Klass* array_klass_acquire(oop java_class);
 322   static void release_set_array_klass(oop java_class, Klass* klass);
 323   // compiler support for class operations
 324   static int klass_offset_in_bytes()                { return _klass_offset; }
 325   static int array_klass_offset_in_bytes()          { return _array_klass_offset; }

 326   static int component_mirror_offset_in_bytes()     { return _component_mirror_offset; }
 327   // Support for classRedefinedCount field
 328   static int classRedefinedCount(oop the_class_mirror);
 329   static void set_classRedefinedCount(oop the_class_mirror, int value);
 330 
 331   // Support for embedded per-class oops
 332   static oop  protection_domain(oop java_class);
 333   static oop  init_lock(oop java_class);
 334   static oop  component_mirror(oop java_class);
 335   static objArrayOop  signers(oop java_class);
 336   static void set_signers(oop java_class, objArrayOop signers);
 337 
 338   static oop class_loader(oop java_class);
 339   static void set_module(oop java_class, oop module);
 340   static oop module(oop java_class);
 341 
<span class="line-modified"> 342   static void set_ref_type_mirror(oop java_class, oop mirror);</span>
<span class="line-modified"> 343   static oop ref_type_mirror(oop java_class);</span>



 344 
<span class="line-modified"> 345   static void set_val_type_mirror(oop java_class, oop mirror);</span>
<span class="line-modified"> 346   static oop val_type_mirror(oop java_class);</span>
 347 
 348   static oop name(Handle java_class, TRAPS);
 349 
 350   static oop source_file(oop java_class);
 351   static void set_source_file(oop java_class, oop source_file);
 352 
 353   static int oop_size(oop java_class);
 354   static int oop_size_raw(oop java_class);
 355   static void set_oop_size(HeapWord* java_class, int size);
 356   static int static_oop_field_count(oop java_class);
 357   static int static_oop_field_count_raw(oop java_class);
 358   static void set_static_oop_field_count(oop java_class, int size);
 359 
 360   static GrowableArray&lt;Klass*&gt;* fixup_mirror_list() {
 361     return _fixup_mirror_list;
 362   }
 363   static void set_fixup_mirror_list(GrowableArray&lt;Klass*&gt;* v) {
 364     _fixup_mirror_list = v;
 365   }
 366 
</pre>
</td>
</tr>
</table>
<center><a href="javaClasses.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../oops/instanceKlass.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>