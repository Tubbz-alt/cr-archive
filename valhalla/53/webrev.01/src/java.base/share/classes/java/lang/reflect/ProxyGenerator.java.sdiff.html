<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/lang/reflect/ProxyGenerator.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="Proxy.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../jdk/internal/misc/Unsafe.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/lang/reflect/ProxyGenerator.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
797                         prim.wrapperClassName,
798                         prim.unwrapMethodName, prim.unwrapMethodDesc, false);
799 
800                 if (type == int.class ||
801                         type == boolean.class ||
802                         type == byte.class ||
803                         type == char.class ||
804                         type == short.class) {
805                     mv.visitInsn(IRETURN);
806                 } else if (type == long.class) {
807                     mv.visitInsn(LRETURN);
808                 } else if (type == float.class) {
809                     mv.visitInsn(FRETURN);
810                 } else if (type == double.class) {
811                     mv.visitInsn(DRETURN);
812                 } else {
813                     throw new AssertionError();
814                 }
815             } else {
816                 String internalName = dotToSlash(type.getName());
<span class="line-modified">817                 if (type.isInlineClass() &amp;&amp; !type.isIndirectType()) {</span>
818                     internalName = &#39;Q&#39; + internalName + &quot;;&quot;;
819                 }
820                 mv.visitTypeInsn(CHECKCAST, internalName);
821                 mv.visitInsn(ARETURN);
822             }
823         }
824 
825         /**
826          * Generate code for initializing the static field that stores
827          * the Method object for this proxy method.
828          */
829         private void codeFieldInitialization(MethodVisitor mv, String className) {
830             codeClassForName(mv, fromClass);
831 
832             mv.visitLdcInsn(method.getName());
833 
834             emitIconstInsn(mv, parameterTypes.length);
835 
836             mv.visitTypeInsn(Opcodes.ANEWARRAY, JL_CLASS);
837 
</pre>
<hr />
<pre>
862                     methodFieldName, LJLR_METHOD);
863         }
864 
865         /*
866          * =============== Code Generation Utility Methods ===============
867          */
868 
869         /**
870          * Generate code to invoke the Class.forName with the name of the given
871          * class to get its Class object at runtime.  And also generate code
872          * to invoke Class.asPrimaryType if the class is regular value type.
873          *
874          * The code is written to the supplied stream.  Note that the code generated
875          * by this method may caused the checked ClassNotFoundException to be thrown.
876          */
877         private void codeClassForName(MethodVisitor mv, Class&lt;?&gt; cl) {
878             mv.visitLdcInsn(cl.getName());
879             mv.visitMethodInsn(INVOKESTATIC,
880                     JL_CLASS,
881                     &quot;forName&quot;, &quot;(Ljava/lang/String;)Ljava/lang/Class;&quot;, false);
<span class="line-removed">882             if (cl.isInlineClass() &amp;&amp; cl == cl.asPrimaryType()) {</span>
<span class="line-removed">883                 mv.visitMethodInsn(INVOKEVIRTUAL,</span>
<span class="line-removed">884                     JL_CLASS,</span>
<span class="line-removed">885                     &quot;asPrimaryType&quot;, &quot;()Ljava/lang/Class;&quot;, false);</span>
<span class="line-removed">886             }</span>
887         }
888 
889         /**
890          * Visit a bytecode for a constant.
891          *
892          * @param mv  The MethodVisitor
893          * @param cst The constant value
894          */
895         private void emitIconstInsn(MethodVisitor mv, final int cst) {
896             if (cst &gt;= -1 &amp;&amp; cst &lt;= 5) {
897                 mv.visitInsn(Opcodes.ICONST_0 + cst);
898             } else if (cst &gt;= Byte.MIN_VALUE &amp;&amp; cst &lt;= Byte.MAX_VALUE) {
899                 mv.visitIntInsn(Opcodes.BIPUSH, cst);
900             } else if (cst &gt;= Short.MIN_VALUE &amp;&amp; cst &lt;= Short.MAX_VALUE) {
901                 mv.visitIntInsn(Opcodes.SIPUSH, cst);
902             } else {
903                 mv.visitLdcInsn(cst);
904             }
905         }
906 
</pre>
</td>
<td>
<hr />
<pre>
797                         prim.wrapperClassName,
798                         prim.unwrapMethodName, prim.unwrapMethodDesc, false);
799 
800                 if (type == int.class ||
801                         type == boolean.class ||
802                         type == byte.class ||
803                         type == char.class ||
804                         type == short.class) {
805                     mv.visitInsn(IRETURN);
806                 } else if (type == long.class) {
807                     mv.visitInsn(LRETURN);
808                 } else if (type == float.class) {
809                     mv.visitInsn(FRETURN);
810                 } else if (type == double.class) {
811                     mv.visitInsn(DRETURN);
812                 } else {
813                     throw new AssertionError();
814                 }
815             } else {
816                 String internalName = dotToSlash(type.getName());
<span class="line-modified">817                 if (type.isInlineClass()) {</span>
818                     internalName = &#39;Q&#39; + internalName + &quot;;&quot;;
819                 }
820                 mv.visitTypeInsn(CHECKCAST, internalName);
821                 mv.visitInsn(ARETURN);
822             }
823         }
824 
825         /**
826          * Generate code for initializing the static field that stores
827          * the Method object for this proxy method.
828          */
829         private void codeFieldInitialization(MethodVisitor mv, String className) {
830             codeClassForName(mv, fromClass);
831 
832             mv.visitLdcInsn(method.getName());
833 
834             emitIconstInsn(mv, parameterTypes.length);
835 
836             mv.visitTypeInsn(Opcodes.ANEWARRAY, JL_CLASS);
837 
</pre>
<hr />
<pre>
862                     methodFieldName, LJLR_METHOD);
863         }
864 
865         /*
866          * =============== Code Generation Utility Methods ===============
867          */
868 
869         /**
870          * Generate code to invoke the Class.forName with the name of the given
871          * class to get its Class object at runtime.  And also generate code
872          * to invoke Class.asPrimaryType if the class is regular value type.
873          *
874          * The code is written to the supplied stream.  Note that the code generated
875          * by this method may caused the checked ClassNotFoundException to be thrown.
876          */
877         private void codeClassForName(MethodVisitor mv, Class&lt;?&gt; cl) {
878             mv.visitLdcInsn(cl.getName());
879             mv.visitMethodInsn(INVOKESTATIC,
880                     JL_CLASS,
881                     &quot;forName&quot;, &quot;(Ljava/lang/String;)Ljava/lang/Class;&quot;, false);





882         }
883 
884         /**
885          * Visit a bytecode for a constant.
886          *
887          * @param mv  The MethodVisitor
888          * @param cst The constant value
889          */
890         private void emitIconstInsn(MethodVisitor mv, final int cst) {
891             if (cst &gt;= -1 &amp;&amp; cst &lt;= 5) {
892                 mv.visitInsn(Opcodes.ICONST_0 + cst);
893             } else if (cst &gt;= Byte.MIN_VALUE &amp;&amp; cst &lt;= Byte.MAX_VALUE) {
894                 mv.visitIntInsn(Opcodes.BIPUSH, cst);
895             } else if (cst &gt;= Short.MIN_VALUE &amp;&amp; cst &lt;= Short.MAX_VALUE) {
896                 mv.visitIntInsn(Opcodes.SIPUSH, cst);
897             } else {
898                 mv.visitLdcInsn(cst);
899             }
900         }
901 
</pre>
</td>
</tr>
</table>
<center><a href="Proxy.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../jdk/internal/misc/Unsafe.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>