<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/toolchain.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="version-numbers.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/toolchain.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 955 
 956 # Do some additional checks on the detected tools.
 957 AC_DEFUN_ONCE([TOOLCHAIN_MISC_CHECKS],
 958 [
 959   # Check for extra potential brokenness.
 960   if test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 961     # On Windows, double-check that we got the right compiler.
 962     CC_VERSION_OUTPUT=`$CC 2&gt;&amp;1 | $GREP -v &#39;ERROR.*UtilTranslatePathList&#39; | $HEAD -n 1 | $TR -d &#39;\r&#39;`
 963     COMPILER_CPU_TEST=`$ECHO $CC_VERSION_OUTPUT | $SED -n &quot;s/^.* \(.*\)$/\1/p&quot;`
 964     if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86&quot;; then
 965       if test &quot;x$COMPILER_CPU_TEST&quot; != &quot;x80x86&quot; -a &quot;x$COMPILER_CPU_TEST&quot; != &quot;xx86&quot;; then
 966         AC_MSG_ERROR([Target CPU mismatch. We are building for $OPENJDK_TARGET_CPU but CL is for &quot;$COMPILER_CPU_TEST&quot;; expected &quot;80x86&quot; or &quot;x86&quot;.])
 967       fi
 968     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot;; then
 969       if test &quot;x$COMPILER_CPU_TEST&quot; != &quot;xx64&quot;; then
 970         AC_MSG_ERROR([Target CPU mismatch. We are building for $OPENJDK_TARGET_CPU but CL is for &quot;$COMPILER_CPU_TEST&quot;; expected &quot;x64&quot;.])
 971       fi
 972     fi
 973   fi
 974 
<span class="line-removed"> 975   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then</span>
<span class="line-removed"> 976     # If this is a --hash-style=gnu system, use --hash-style=both, why?</span>
<span class="line-removed"> 977     HAS_GNU_HASH=`$CC -dumpspecs 2&gt;/dev/null | $GREP &#39;hash-style=gnu&#39;`</span>
<span class="line-removed"> 978     # This is later checked when setting flags.</span>
<span class="line-removed"> 979   fi</span>
<span class="line-removed"> 980 </span>
 981   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 982     # Check if linker has -z noexecstack.
 983     HAS_NOEXECSTACK=`$CC -Wl,--help 2&gt;/dev/null | $GREP &#39;z noexecstack&#39;`
 984     # This is later checked when setting flags.
 985   fi
 986 
 987   # Setup hotspot lecagy names for toolchains
 988   HOTSPOT_TOOLCHAIN_TYPE=$TOOLCHAIN_TYPE
 989   if test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 990     HOTSPOT_TOOLCHAIN_TYPE=gcc
 991   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 992     HOTSPOT_TOOLCHAIN_TYPE=visCPP
 993   fi
 994   AC_SUBST(HOTSPOT_TOOLCHAIN_TYPE)
 995 ])
 996 
 997 # Setup the JTReg Regression Test Harness.
 998 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_JTREG],
 999 [
1000   AC_ARG_WITH(jtreg, [AS_HELP_STRING([--with-jtreg],
1001       [Regression Test Harness @&lt;:@probed@:&gt;@])])
1002 
1003   if test &quot;x$with_jtreg&quot; = xno; then
1004     # jtreg disabled
1005     AC_MSG_CHECKING([for jtreg test harness])
1006     AC_MSG_RESULT([no, disabled])
1007   elif test &quot;x$with_jtreg&quot; != xyes &amp;&amp; test &quot;x$with_jtreg&quot; != x; then
<span class="line-modified">1008     # An explicit path is specified, use it.</span>
<span class="line-modified">1009     JT_HOME=&quot;$with_jtreg&quot;</span>



















1010     UTIL_FIXUP_PATH([JT_HOME])
1011     if test ! -d &quot;$JT_HOME&quot;; then
1012       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg does not exist])
1013     fi
1014 
1015     if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1016       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg is not a valid jtreg home])
1017     fi
1018 
1019     AC_MSG_CHECKING([for jtreg test harness])
1020     AC_MSG_RESULT([$JT_HOME])
1021   else
1022     # Try to locate jtreg using the JT_HOME environment variable
1023     if test &quot;x$JT_HOME&quot; != x; then
1024       # JT_HOME set in environment, use it
1025       if test ! -d &quot;$JT_HOME&quot;; then
1026         AC_MSG_WARN([Ignoring JT_HOME pointing to invalid directory: $JT_HOME])
1027         JT_HOME=
1028       else
1029         if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
</pre>
</td>
<td>
<hr />
<pre>
 955 
 956 # Do some additional checks on the detected tools.
 957 AC_DEFUN_ONCE([TOOLCHAIN_MISC_CHECKS],
 958 [
 959   # Check for extra potential brokenness.
 960   if test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 961     # On Windows, double-check that we got the right compiler.
 962     CC_VERSION_OUTPUT=`$CC 2&gt;&amp;1 | $GREP -v &#39;ERROR.*UtilTranslatePathList&#39; | $HEAD -n 1 | $TR -d &#39;\r&#39;`
 963     COMPILER_CPU_TEST=`$ECHO $CC_VERSION_OUTPUT | $SED -n &quot;s/^.* \(.*\)$/\1/p&quot;`
 964     if test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86&quot;; then
 965       if test &quot;x$COMPILER_CPU_TEST&quot; != &quot;x80x86&quot; -a &quot;x$COMPILER_CPU_TEST&quot; != &quot;xx86&quot;; then
 966         AC_MSG_ERROR([Target CPU mismatch. We are building for $OPENJDK_TARGET_CPU but CL is for &quot;$COMPILER_CPU_TEST&quot;; expected &quot;80x86&quot; or &quot;x86&quot;.])
 967       fi
 968     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = &quot;xx86_64&quot;; then
 969       if test &quot;x$COMPILER_CPU_TEST&quot; != &quot;xx64&quot;; then
 970         AC_MSG_ERROR([Target CPU mismatch. We are building for $OPENJDK_TARGET_CPU but CL is for &quot;$COMPILER_CPU_TEST&quot;; expected &quot;x64&quot;.])
 971       fi
 972     fi
 973   fi
 974 






 975   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 976     # Check if linker has -z noexecstack.
 977     HAS_NOEXECSTACK=`$CC -Wl,--help 2&gt;/dev/null | $GREP &#39;z noexecstack&#39;`
 978     # This is later checked when setting flags.
 979   fi
 980 
 981   # Setup hotspot lecagy names for toolchains
 982   HOTSPOT_TOOLCHAIN_TYPE=$TOOLCHAIN_TYPE
 983   if test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 984     HOTSPOT_TOOLCHAIN_TYPE=gcc
 985   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 986     HOTSPOT_TOOLCHAIN_TYPE=visCPP
 987   fi
 988   AC_SUBST(HOTSPOT_TOOLCHAIN_TYPE)
 989 ])
 990 
 991 # Setup the JTReg Regression Test Harness.
 992 AC_DEFUN_ONCE([TOOLCHAIN_SETUP_JTREG],
 993 [
 994   AC_ARG_WITH(jtreg, [AS_HELP_STRING([--with-jtreg],
 995       [Regression Test Harness @&lt;:@probed@:&gt;@])])
 996 
 997   if test &quot;x$with_jtreg&quot; = xno; then
 998     # jtreg disabled
 999     AC_MSG_CHECKING([for jtreg test harness])
1000     AC_MSG_RESULT([no, disabled])
1001   elif test &quot;x$with_jtreg&quot; != xyes &amp;&amp; test &quot;x$with_jtreg&quot; != x; then
<span class="line-modified">1002     if test -d &quot;$with_jtreg&quot;; then</span>
<span class="line-modified">1003       # An explicit path is specified, use it.</span>
<span class="line-added">1004       JT_HOME=&quot;$with_jtreg&quot;</span>
<span class="line-added">1005     else</span>
<span class="line-added">1006       case &quot;$with_jtreg&quot; in</span>
<span class="line-added">1007         *.zip )</span>
<span class="line-added">1008           JTREG_SUPPORT_DIR=$CONFIGURESUPPORT_OUTPUTDIR/jtreg</span>
<span class="line-added">1009           $RM -rf $JTREG_SUPPORT_DIR</span>
<span class="line-added">1010           $MKDIR -p $JTREG_SUPPORT_DIR</span>
<span class="line-added">1011           $UNZIP -qq -d $JTREG_SUPPORT_DIR $with_jtreg</span>
<span class="line-added">1012 </span>
<span class="line-added">1013           # Try to find jtreg to determine JT_HOME path</span>
<span class="line-added">1014           JTREG_PATH=`$FIND $JTREG_SUPPORT_DIR | $GREP &quot;/bin/jtreg&quot;`</span>
<span class="line-added">1015           if test &quot;x$JTREG_PATH&quot; != x; then</span>
<span class="line-added">1016             JT_HOME=$($DIRNAME $($DIRNAME $JTREG_PATH))</span>
<span class="line-added">1017           fi</span>
<span class="line-added">1018           ;;</span>
<span class="line-added">1019         * )</span>
<span class="line-added">1020           ;;</span>
<span class="line-added">1021       esac</span>
<span class="line-added">1022     fi</span>
1023     UTIL_FIXUP_PATH([JT_HOME])
1024     if test ! -d &quot;$JT_HOME&quot;; then
1025       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg does not exist])
1026     fi
1027 
1028     if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
1029       AC_MSG_ERROR([jtreg home directory from --with-jtreg=$with_jtreg is not a valid jtreg home])
1030     fi
1031 
1032     AC_MSG_CHECKING([for jtreg test harness])
1033     AC_MSG_RESULT([$JT_HOME])
1034   else
1035     # Try to locate jtreg using the JT_HOME environment variable
1036     if test &quot;x$JT_HOME&quot; != x; then
1037       # JT_HOME set in environment, use it
1038       if test ! -d &quot;$JT_HOME&quot;; then
1039         AC_MSG_WARN([Ignoring JT_HOME pointing to invalid directory: $JT_HOME])
1040         JT_HOME=
1041       else
1042         if test ! -e &quot;$JT_HOME/lib/jtreg.jar&quot;; then
</pre>
</td>
</tr>
</table>
<center><a href="spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="version-numbers.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>