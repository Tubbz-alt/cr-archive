<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/flags-ldflags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../RunTests.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-version.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags-ldflags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 45   FLAGS_SETUP_LDFLAGS_CPU_DEP([TARGET])
 46 
 47   # Setup the build toolchain
 48 
 49   # When building a buildjdk, it&#39;s always only the server variant
 50   BUILD_JVM_VARIANT_PATH=server
 51 
 52   FLAGS_SETUP_LDFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_])
 53 
 54   LDFLAGS_TESTEXE=&quot;${TARGET_LDFLAGS_JDK_LIBPATH}&quot;
 55   AC_SUBST(LDFLAGS_TESTEXE)
 56 ])
 57 
 58 ################################################################################
 59 
 60 # CPU independent LDFLAGS setup, used for both target and build toolchain.
 61 AC_DEFUN([FLAGS_SETUP_LDFLAGS_HELPER],
 62 [
 63   # Setup basic LDFLAGS
 64   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
<span class="line-removed"> 65     # If this is a --hash-style=gnu system, use --hash-style=both, why?</span>
<span class="line-removed"> 66     # We have previously set HAS_GNU_HASH if this is the case</span>
<span class="line-removed"> 67     if test -n &quot;$HAS_GNU_HASH&quot;; then</span>
<span class="line-removed"> 68       BASIC_LDFLAGS=&quot;-Wl,--hash-style=both&quot;</span>
<span class="line-removed"> 69       LIBJSIG_HASHSTYLE_LDFLAGS=&quot;-Wl,--hash-style=both&quot;</span>
<span class="line-removed"> 70     fi</span>
<span class="line-removed"> 71 </span>
 72     # Add -z,defs, to forbid undefined symbols in object files.
 73     # add -z,relro (mark relocations read only) for all libs
 74     # add -z,now (&quot;full relro&quot; - more of the Global Offset Table GOT is marked read only)
<span class="line-modified"> 75     BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,-z,defs -Wl,-z,relro -Wl,-z,now&quot;</span>
 76     # Linux : remove unused code+data in link step
 77     if test &quot;x$ENABLE_LINKTIME_GC&quot; = xtrue; then
 78       if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then
 79         BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,--gc-sections -Wl,--print-gc-sections&quot;
 80       else
 81         BASIC_LDFLAGS_JDK_ONLY=&quot;$BASIC_LDFLAGS_JDK_ONLY -Wl,--gc-sections&quot;
 82       fi
 83     fi
 84 
 85     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-O1&quot;
 86 
 87   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 88     BASIC_LDFLAGS_JVM_ONLY=&quot;-mno-omit-leaf-frame-pointer -mstack-alignment=16 \
 89         -fPIC&quot;
 90 
 91   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
 92     BASIC_LDFLAGS=&quot;-b64 -brtl -bnorwexec -bnolibpath -bexpall -bernotok -btextpsize:64K \
 93         -bdatapsize:64K -bstackpsize:64K&quot;
 94     # libjvm.so has gotten too large for normal TOC size; compile with qpic=large and link with bigtoc
 95     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-lC_r -bbigtoc&quot;
</pre>
<hr />
<pre>
135 
136   # Setup LDFLAGS for linking executables
137   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
138     EXECUTABLE_LDFLAGS=&quot;$EXECUTABLE_LDFLAGS -Wl,--allow-shlib-undefined&quot;
139     # Enabling pie on 32 bit builds prevents the JVM from allocating a continuous
140     # java heap.
141     if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; != &quot;x32&quot;; then
142       EXECUTABLE_LDFLAGS=&quot;$EXECUTABLE_LDFLAGS -pie&quot;
143     fi
144   fi
145 
146   if test &quot;x$ALLOW_ABSOLUTE_PATHS_IN_OUTPUT&quot; = &quot;xfalse&quot;; then
147     if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
148       BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -pdbaltpath:%_PDB%&quot;
149     fi
150   fi
151 
152   # Export some intermediate variables for compatibility
153   LDFLAGS_CXX_JDK=&quot;$BASIC_LDFLAGS_ONLYCXX $BASIC_LDFLAGS_ONLYCXX_JDK_ONLY $DEBUGLEVEL_LDFLAGS_JDK_ONLY&quot;
154   AC_SUBST(LDFLAGS_CXX_JDK)
<span class="line-removed">155   AC_SUBST(LIBJSIG_HASHSTYLE_LDFLAGS)</span>
<span class="line-removed">156   AC_SUBST(LIBJSIG_NOEXECSTACK_LDFLAGS)</span>
157 ])
158 
159 ################################################################################
160 # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
161 #      conditionals against.
162 # $2 - Optional prefix for each variable defined.
163 AC_DEFUN([FLAGS_SETUP_LDFLAGS_CPU_DEP],
164 [
165   # Setup CPU-dependent basic LDFLAGS. These can differ between the target and
166   # build toolchain.
167   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
168     if test &quot;x${OPENJDK_$1_CPU}&quot; = xx86; then
169       $1_CPU_LDFLAGS_JVM_ONLY=&quot;-march=i586&quot;
170     elif test &quot;x$OPENJDK_$1_CPU&quot; = xarm; then
171       $1_CPU_LDFLAGS_JVM_ONLY=&quot;${$1_CPU_LDFLAGS_JVM_ONLY} -fsigned-char&quot;
172       $1_CPU_LDFLAGS=&quot;$ARM_ARCH_TYPE_FLAGS $ARM_FLOAT_TYPE_FLAGS&quot;
173     fi
174 
175   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
176     if test &quot;x${OPENJDK_$1_CPU}&quot; = &quot;xx86&quot;; then
</pre>
</td>
<td>
<hr />
<pre>
 45   FLAGS_SETUP_LDFLAGS_CPU_DEP([TARGET])
 46 
 47   # Setup the build toolchain
 48 
 49   # When building a buildjdk, it&#39;s always only the server variant
 50   BUILD_JVM_VARIANT_PATH=server
 51 
 52   FLAGS_SETUP_LDFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_])
 53 
 54   LDFLAGS_TESTEXE=&quot;${TARGET_LDFLAGS_JDK_LIBPATH}&quot;
 55   AC_SUBST(LDFLAGS_TESTEXE)
 56 ])
 57 
 58 ################################################################################
 59 
 60 # CPU independent LDFLAGS setup, used for both target and build toolchain.
 61 AC_DEFUN([FLAGS_SETUP_LDFLAGS_HELPER],
 62 [
 63   # Setup basic LDFLAGS
 64   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then







 65     # Add -z,defs, to forbid undefined symbols in object files.
 66     # add -z,relro (mark relocations read only) for all libs
 67     # add -z,now (&quot;full relro&quot; - more of the Global Offset Table GOT is marked read only)
<span class="line-modified"> 68     BASIC_LDFLAGS=&quot;-Wl,--hash-style=gnu -Wl,-z,defs -Wl,-z,relro -Wl,-z,now&quot;</span>
 69     # Linux : remove unused code+data in link step
 70     if test &quot;x$ENABLE_LINKTIME_GC&quot; = xtrue; then
 71       if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then
 72         BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -Wl,--gc-sections -Wl,--print-gc-sections&quot;
 73       else
 74         BASIC_LDFLAGS_JDK_ONLY=&quot;$BASIC_LDFLAGS_JDK_ONLY -Wl,--gc-sections&quot;
 75       fi
 76     fi
 77 
 78     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-O1&quot;
 79 
 80   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 81     BASIC_LDFLAGS_JVM_ONLY=&quot;-mno-omit-leaf-frame-pointer -mstack-alignment=16 \
 82         -fPIC&quot;
 83 
 84   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
 85     BASIC_LDFLAGS=&quot;-b64 -brtl -bnorwexec -bnolibpath -bexpall -bernotok -btextpsize:64K \
 86         -bdatapsize:64K -bstackpsize:64K&quot;
 87     # libjvm.so has gotten too large for normal TOC size; compile with qpic=large and link with bigtoc
 88     BASIC_LDFLAGS_JVM_ONLY=&quot;-Wl,-lC_r -bbigtoc&quot;
</pre>
<hr />
<pre>
128 
129   # Setup LDFLAGS for linking executables
130   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
131     EXECUTABLE_LDFLAGS=&quot;$EXECUTABLE_LDFLAGS -Wl,--allow-shlib-undefined&quot;
132     # Enabling pie on 32 bit builds prevents the JVM from allocating a continuous
133     # java heap.
134     if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; != &quot;x32&quot;; then
135       EXECUTABLE_LDFLAGS=&quot;$EXECUTABLE_LDFLAGS -pie&quot;
136     fi
137   fi
138 
139   if test &quot;x$ALLOW_ABSOLUTE_PATHS_IN_OUTPUT&quot; = &quot;xfalse&quot;; then
140     if test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
141       BASIC_LDFLAGS=&quot;$BASIC_LDFLAGS -pdbaltpath:%_PDB%&quot;
142     fi
143   fi
144 
145   # Export some intermediate variables for compatibility
146   LDFLAGS_CXX_JDK=&quot;$BASIC_LDFLAGS_ONLYCXX $BASIC_LDFLAGS_ONLYCXX_JDK_ONLY $DEBUGLEVEL_LDFLAGS_JDK_ONLY&quot;
147   AC_SUBST(LDFLAGS_CXX_JDK)


148 ])
149 
150 ################################################################################
151 # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
152 #      conditionals against.
153 # $2 - Optional prefix for each variable defined.
154 AC_DEFUN([FLAGS_SETUP_LDFLAGS_CPU_DEP],
155 [
156   # Setup CPU-dependent basic LDFLAGS. These can differ between the target and
157   # build toolchain.
158   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
159     if test &quot;x${OPENJDK_$1_CPU}&quot; = xx86; then
160       $1_CPU_LDFLAGS_JVM_ONLY=&quot;-march=i586&quot;
161     elif test &quot;x$OPENJDK_$1_CPU&quot; = xarm; then
162       $1_CPU_LDFLAGS_JVM_ONLY=&quot;${$1_CPU_LDFLAGS_JVM_ONLY} -fsigned-char&quot;
163       $1_CPU_LDFLAGS=&quot;$ARM_ARCH_TYPE_FLAGS $ARM_FLOAT_TYPE_FLAGS&quot;
164     fi
165 
166   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
167     if test &quot;x${OPENJDK_$1_CPU}&quot; = &quot;xx86&quot;; then
</pre>
</td>
</tr>
</table>
<center><a href="../RunTests.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-version.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>