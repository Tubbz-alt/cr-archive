<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahControlThread.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../shared/gcTimer.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahControlThread.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahControlThread.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 36 #include &quot;gc/shenandoah/shenandoahVMOperations.hpp&quot;
 37 #include &quot;gc/shenandoah/shenandoahWorkerPolicy.hpp&quot;
 38 #include &quot;gc/shenandoah/heuristics/shenandoahHeuristics.hpp&quot;
 39 #include &quot;memory/iterator.hpp&quot;
 40 #include &quot;memory/universe.hpp&quot;
 41 #include &quot;runtime/atomic.hpp&quot;
 42 
 43 ShenandoahControlThread::ShenandoahControlThread() :
 44   ConcurrentGCThread(),
 45   _alloc_failure_waiters_lock(Mutex::leaf, &quot;ShenandoahAllocFailureGC_lock&quot;, true, Monitor::_safepoint_check_always),
 46   _gc_waiters_lock(Mutex::leaf, &quot;ShenandoahRequestedGC_lock&quot;, true, Monitor::_safepoint_check_always),
 47   _periodic_task(this),
 48   _requested_gc_cause(GCCause::_no_cause_specified),
 49   _degen_point(ShenandoahHeap::_degenerated_outside_cycle),
 50   _allocs_seen(0) {
 51 
 52   reset_gc_id();
 53   create_and_start(ShenandoahCriticalControlThreadPriority ? CriticalPriority : NearMaxPriority);
 54   _periodic_task.enroll();
 55   _periodic_satb_flush_task.enroll();



 56 }
 57 
 58 ShenandoahControlThread::~ShenandoahControlThread() {
 59   // This is here so that super is called.
 60 }
 61 
 62 void ShenandoahPeriodicTask::task() {
 63   _thread-&gt;handle_force_counters_update();
 64   _thread-&gt;handle_counters_update();
 65 }
 66 
 67 void ShenandoahPeriodicSATBFlushTask::task() {
 68   ShenandoahHeap::heap()-&gt;force_satb_flush_all_threads();
 69 }
 70 





 71 void ShenandoahControlThread::run_service() {
 72   ShenandoahHeap* heap = ShenandoahHeap::heap();
 73 
 74   GCMode default_mode = concurrent_normal;
 75   GCCause::Cause default_cause = GCCause::_shenandoah_concurrent_gc;
 76   int sleep = ShenandoahControlIntervalMin;
 77 
 78   double last_shrink_time = os::elapsedTime();
 79   double last_sleep_adjust_time = os::elapsedTime();
 80 
 81   // Shrink period avoids constantly polling regions for shrinking.
 82   // Having a period 10x lower than the delay would mean we hit the
 83   // shrinking with lag of less than 1/10-th of true delay.
 84   // ShenandoahUncommitDelay is in msecs, but shrink_period is in seconds.
 85   double shrink_period = (double)ShenandoahUncommitDelay / 1000 / 10;
 86 
 87   ShenandoahCollectorPolicy* policy = heap-&gt;shenandoah_policy();
 88   ShenandoahHeuristics* heuristics = heap-&gt;heuristics();
 89   while (!in_graceful_shutdown() &amp;&amp; !should_terminate()) {
 90     // Figure out if we have pending requests.
</pre>
</td>
<td>
<hr />
<pre>
 36 #include &quot;gc/shenandoah/shenandoahVMOperations.hpp&quot;
 37 #include &quot;gc/shenandoah/shenandoahWorkerPolicy.hpp&quot;
 38 #include &quot;gc/shenandoah/heuristics/shenandoahHeuristics.hpp&quot;
 39 #include &quot;memory/iterator.hpp&quot;
 40 #include &quot;memory/universe.hpp&quot;
 41 #include &quot;runtime/atomic.hpp&quot;
 42 
 43 ShenandoahControlThread::ShenandoahControlThread() :
 44   ConcurrentGCThread(),
 45   _alloc_failure_waiters_lock(Mutex::leaf, &quot;ShenandoahAllocFailureGC_lock&quot;, true, Monitor::_safepoint_check_always),
 46   _gc_waiters_lock(Mutex::leaf, &quot;ShenandoahRequestedGC_lock&quot;, true, Monitor::_safepoint_check_always),
 47   _periodic_task(this),
 48   _requested_gc_cause(GCCause::_no_cause_specified),
 49   _degen_point(ShenandoahHeap::_degenerated_outside_cycle),
 50   _allocs_seen(0) {
 51 
 52   reset_gc_id();
 53   create_and_start(ShenandoahCriticalControlThreadPriority ? CriticalPriority : NearMaxPriority);
 54   _periodic_task.enroll();
 55   _periodic_satb_flush_task.enroll();
<span class="line-added"> 56   if (ShenandoahPacing) {</span>
<span class="line-added"> 57     _periodic_pacer_notify_task.enroll();</span>
<span class="line-added"> 58   }</span>
 59 }
 60 
 61 ShenandoahControlThread::~ShenandoahControlThread() {
 62   // This is here so that super is called.
 63 }
 64 
 65 void ShenandoahPeriodicTask::task() {
 66   _thread-&gt;handle_force_counters_update();
 67   _thread-&gt;handle_counters_update();
 68 }
 69 
 70 void ShenandoahPeriodicSATBFlushTask::task() {
 71   ShenandoahHeap::heap()-&gt;force_satb_flush_all_threads();
 72 }
 73 
<span class="line-added"> 74 void ShenandoahPeriodicPacerNotify::task() {</span>
<span class="line-added"> 75   assert(ShenandoahPacing, &quot;Should not be here otherwise&quot;);</span>
<span class="line-added"> 76   ShenandoahHeap::heap()-&gt;pacer()-&gt;notify_waiters();</span>
<span class="line-added"> 77 }</span>
<span class="line-added"> 78 </span>
 79 void ShenandoahControlThread::run_service() {
 80   ShenandoahHeap* heap = ShenandoahHeap::heap();
 81 
 82   GCMode default_mode = concurrent_normal;
 83   GCCause::Cause default_cause = GCCause::_shenandoah_concurrent_gc;
 84   int sleep = ShenandoahControlIntervalMin;
 85 
 86   double last_shrink_time = os::elapsedTime();
 87   double last_sleep_adjust_time = os::elapsedTime();
 88 
 89   // Shrink period avoids constantly polling regions for shrinking.
 90   // Having a period 10x lower than the delay would mean we hit the
 91   // shrinking with lag of less than 1/10-th of true delay.
 92   // ShenandoahUncommitDelay is in msecs, but shrink_period is in seconds.
 93   double shrink_period = (double)ShenandoahUncommitDelay / 1000 / 10;
 94 
 95   ShenandoahCollectorPolicy* policy = heap-&gt;shenandoah_policy();
 96   ShenandoahHeuristics* heuristics = heap-&gt;heuristics();
 97   while (!in_graceful_shutdown() &amp;&amp; !should_terminate()) {
 98     // Figure out if we have pending requests.
</pre>
</td>
</tr>
</table>
<center><a href="../shared/gcTimer.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahControlThread.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>