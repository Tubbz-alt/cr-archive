<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/jfr/recorder/repository/jfrEmergencyDump.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../jfrRecorder.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../service/jfrOptionSet.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/recorder/repository/jfrEmergencyDump.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
279 }
280 
281 RepositoryIterator::RepositoryIterator(const char* repository_path) :
282   _file_names(NULL),
283   _path_buffer_file_name_offset(0),
284   _iterator(0) {
285     DIR* dirp = os::opendir(repository_path);
286     if (dirp == NULL) {
287       log_error(jfr, system)(&quot;Unable to open repository %s&quot;, repository_path);
288       return;
289     }
290     // store repository path in the path buffer and save that position
291     _path_buffer_file_name_offset = jio_snprintf(_path_buffer,
292                                                  sizeof(_path_buffer),
293                                                  &quot;%s%s&quot;,
294                                                  repository_path,
295                                                  os::file_separator());
296     if (_path_buffer_file_name_offset == -1) {
297       return;
298     }
<span class="line-modified">299     _file_names = new (ResourceObj::C_HEAP, mtTracing) GrowableArray&lt;const char*&gt;(10, true, mtTracing);</span>
300     if (_file_names == NULL) {
301       log_error(jfr, system)(&quot;Unable to malloc memory during jfr emergency dump&quot;);
302       return;
303     }
304     // iterate files in the repository and append filtered file names to the files array
305     struct dirent* dentry;
306     while ((dentry = os::readdir(dirp)) != NULL) {
307       const char* file_name = filter(dentry-&gt;d_name);
308       if (file_name != NULL) {
309         _file_names-&gt;append(file_name);
310       }
311     }
312     os::closedir(dirp);
313     if (_file_names-&gt;length() &gt; 1) {
314       _file_names-&gt;sort(file_sort);
315     }
316 }
317 
318 RepositoryIterator::~RepositoryIterator() {
319   if (_file_names != NULL) {
</pre>
</td>
<td>
<hr />
<pre>
279 }
280 
281 RepositoryIterator::RepositoryIterator(const char* repository_path) :
282   _file_names(NULL),
283   _path_buffer_file_name_offset(0),
284   _iterator(0) {
285     DIR* dirp = os::opendir(repository_path);
286     if (dirp == NULL) {
287       log_error(jfr, system)(&quot;Unable to open repository %s&quot;, repository_path);
288       return;
289     }
290     // store repository path in the path buffer and save that position
291     _path_buffer_file_name_offset = jio_snprintf(_path_buffer,
292                                                  sizeof(_path_buffer),
293                                                  &quot;%s%s&quot;,
294                                                  repository_path,
295                                                  os::file_separator());
296     if (_path_buffer_file_name_offset == -1) {
297       return;
298     }
<span class="line-modified">299     _file_names = new (ResourceObj::C_HEAP, mtTracing) GrowableArray&lt;const char*&gt;(10, mtTracing);</span>
300     if (_file_names == NULL) {
301       log_error(jfr, system)(&quot;Unable to malloc memory during jfr emergency dump&quot;);
302       return;
303     }
304     // iterate files in the repository and append filtered file names to the files array
305     struct dirent* dentry;
306     while ((dentry = os::readdir(dirp)) != NULL) {
307       const char* file_name = filter(dentry-&gt;d_name);
308       if (file_name != NULL) {
309         _file_names-&gt;append(file_name);
310       }
311     }
312     os::closedir(dirp);
313     if (_file_names-&gt;length() &gt; 1) {
314       _file_names-&gt;sort(file_sort);
315     }
316 }
317 
318 RepositoryIterator::~RepositoryIterator() {
319   if (_file_names != NULL) {
</pre>
</td>
</tr>
</table>
<center><a href="../jfrRecorder.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../service/jfrOptionSet.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>