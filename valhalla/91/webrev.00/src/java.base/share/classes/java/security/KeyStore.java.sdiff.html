<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/security/KeyStore.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../lang/StringConcatHelper.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="MessageDigest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/KeyStore.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
1745         if (file == null) {
1746             throw new NullPointerException();
1747         }
1748 
1749         if (file.isFile() == false) {
1750             throw new IllegalArgumentException(
1751                 &quot;File does not exist or it does not refer to a normal file: &quot; +
1752                     file);
1753         }
1754 
1755         KeyStore keystore = null;
1756 
1757         try (DataInputStream dataStream =
1758             new DataInputStream(
1759                 new BufferedInputStream(
1760                     new FileInputStream(file)))) {
1761 
1762             dataStream.mark(Integer.MAX_VALUE);
1763 
1764             // Detect the keystore type
<span class="line-modified">1765             for (String type : Security.getAlgorithms(&quot;KeyStore&quot;)) {</span>
<span class="line-modified">1766                 Object[] objs = null;</span>
<span class="line-modified">1767 </span>
<span class="line-modified">1768                 try {</span>
<span class="line-modified">1769                     objs = Security.getImpl(type, &quot;KeyStore&quot;, (String)null);</span>
<span class="line-modified">1770 </span>
<span class="line-modified">1771                     KeyStoreSpi impl = (KeyStoreSpi)objs[0];</span>
<span class="line-modified">1772                     if (impl.engineProbe(dataStream)) {</span>
<span class="line-modified">1773 </span>
<span class="line-modified">1774                         if (kdebug != null) {</span>
<span class="line-modified">1775                             kdebug.println(type + &quot; keystore detected: &quot; +</span>
<span class="line-modified">1776                                 file);</span>











1777                         }
<span class="line-modified">1778 </span>
<span class="line-removed">1779                         keystore = new KeyStore(impl, (Provider)objs[1], type);</span>
<span class="line-removed">1780                         break;</span>
<span class="line-removed">1781                     }</span>
<span class="line-removed">1782                 } catch (NoSuchAlgorithmException | NoSuchProviderException e) {</span>
<span class="line-removed">1783                     // ignore</span>
<span class="line-removed">1784                     if (kdebug != null) {</span>
<span class="line-removed">1785                         kdebug.println(type + &quot; not found - &quot; + e);</span>
<span class="line-removed">1786                     }</span>
<span class="line-removed">1787                 } catch (IOException e) {</span>
<span class="line-removed">1788                     // ignore</span>
<span class="line-removed">1789                     if (kdebug != null) {</span>
<span class="line-removed">1790                         kdebug.println(&quot;I/O error in &quot; + file + &quot; - &quot; + e);</span>
1791                     }
1792                 }
<span class="line-removed">1793                 dataStream.reset(); // prepare the stream for the next probe</span>
1794             }
1795 
1796             // Load the keystore data
1797             if (keystore != null) {
1798                 dataStream.reset(); // prepare the stream for loading
1799                 if (hasPassword) {
1800                     keystore.load(dataStream, password);
1801                 } else {
1802                     keystore.keyStoreSpi.engineLoad(dataStream, param);
1803                     keystore.initialized = true;
1804                 }
1805                 return keystore;
1806             }
1807         }
1808 
1809         throw new KeyStoreException(&quot;Unrecognized keystore format. &quot;
1810                 + &quot;Please load it with a specified type&quot;);
1811     }
1812 
1813     /**
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
1745         if (file == null) {
1746             throw new NullPointerException();
1747         }
1748 
1749         if (file.isFile() == false) {
1750             throw new IllegalArgumentException(
1751                 &quot;File does not exist or it does not refer to a normal file: &quot; +
1752                     file);
1753         }
1754 
1755         KeyStore keystore = null;
1756 
1757         try (DataInputStream dataStream =
1758             new DataInputStream(
1759                 new BufferedInputStream(
1760                     new FileInputStream(file)))) {
1761 
1762             dataStream.mark(Integer.MAX_VALUE);
1763 
1764             // Detect the keystore type
<span class="line-modified">1765             for (Provider p : Security.getProviders()) {</span>
<span class="line-modified">1766                 for (Provider.Service s : p.getServices()) {</span>
<span class="line-modified">1767                     if (s.getType().equals(&quot;KeyStore&quot;)) {</span>
<span class="line-modified">1768                         try {</span>
<span class="line-modified">1769                             KeyStoreSpi impl = (KeyStoreSpi) s.newInstance(null);</span>
<span class="line-modified">1770                             if (impl.engineProbe(dataStream)) {</span>
<span class="line-modified">1771                                 if (kdebug != null) {</span>
<span class="line-modified">1772                                     kdebug.println(s.getAlgorithm()</span>
<span class="line-modified">1773                                             + &quot; keystore detected: &quot; + file);</span>
<span class="line-modified">1774                                 }</span>
<span class="line-modified">1775                                 keystore = new KeyStore(impl, p, s.getAlgorithm());</span>
<span class="line-modified">1776                                 break;</span>
<span class="line-added">1777                             }</span>
<span class="line-added">1778                         } catch (NoSuchAlgorithmException e) {</span>
<span class="line-added">1779                             // ignore</span>
<span class="line-added">1780                             if (kdebug != null) {</span>
<span class="line-added">1781                                 kdebug.println(&quot;not found - &quot; + e);</span>
<span class="line-added">1782                             }</span>
<span class="line-added">1783                         } catch (IOException e) {</span>
<span class="line-added">1784                             // ignore</span>
<span class="line-added">1785                             if (kdebug != null) {</span>
<span class="line-added">1786                                 kdebug.println(&quot;I/O error in &quot; + file + &quot; - &quot; + e);</span>
<span class="line-added">1787                             }</span>
1788                         }
<span class="line-modified">1789                         dataStream.reset(); // prepare the stream for the next probe</span>












1790                     }
1791                 }

1792             }
1793 
1794             // Load the keystore data
1795             if (keystore != null) {
1796                 dataStream.reset(); // prepare the stream for loading
1797                 if (hasPassword) {
1798                     keystore.load(dataStream, password);
1799                 } else {
1800                     keystore.keyStoreSpi.engineLoad(dataStream, param);
1801                     keystore.initialized = true;
1802                 }
1803                 return keystore;
1804             }
1805         }
1806 
1807         throw new KeyStoreException(&quot;Unrecognized keystore format. &quot;
1808                 + &quot;Please load it with a specified type&quot;);
1809     }
1810 
1811     /**
</pre>
</td>
</tr>
</table>
<center><a href="../lang/StringConcatHelper.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="MessageDigest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>