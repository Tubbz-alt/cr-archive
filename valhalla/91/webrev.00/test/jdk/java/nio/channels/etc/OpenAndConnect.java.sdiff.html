<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/nio/channels/etc/OpenAndConnect.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../net/MulticastSocket/UnreferencedMulticastSockets.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../security/SecureRandom/DefaultAlgo.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/nio/channels/etc/OpenAndConnect.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 77         }
 78     }
 79 
 80     @BeforeTest()
 81     public void setup() {
 82         NetworkConfiguration.printSystemConfiguration(out);
 83         IPSupport.printPlatformSupport(out);
 84         throwSkippedExceptionIfNonOperational();
 85 
 86         out.println(&quot;IA4LOCAL:    &quot; + IA4LOCAL);
 87         out.println(&quot;IA6LOCAL:    &quot; + IA6LOCAL);
 88         out.println(&quot;IA4ANYLOCAL: &quot; + IA4ANYLOCAL);
 89         out.println(&quot;IA6ANYLOCAL: &quot; + IA6ANYLOCAL);
 90         out.println(&quot;IA4LOOPBACK: &quot; + IA4LOOPBACK);
 91         out.println(&quot;IA6LOOPBACK: &quot; + IA6LOOPBACK);
 92     }
 93 
 94     @DataProvider(name = &quot;openConnect&quot;)
 95     public Object[][] openConnect() {
 96         LinkedList&lt;Object[]&gt;  l = new LinkedList&lt;&gt;();
<span class="line-modified"> 97         l.addAll(openConnectGenTests);</span>
<span class="line-modified"> 98         if (IA4LOCAL != null) {</span>
<span class="line-modified"> 99             l.addAll(openConnectV4LocalTests);</span>


100         }
<span class="line-modified">101         if (IA6LOCAL != null) {</span>
<span class="line-modified">102             l.addAll(openConnectV6LocalTests);</span>









103         }
104         return l.toArray(new Object[][]{});
105     }
106 
107     //            +----- sfam is server/first socket family
108     //            |
109     //            |       +------ saddr is bind address for server/first socket
110     //            |       |
111     //            |       |              +---- cfam is family for client/second socket
112     //            |       |              |
113     //            |       |              |        +---- caddr is address client/second
114     //            |       |              |        |     socket binds to. When the server
115     //            |       |              |        |     has bound to a wildcard address
116     //            |       |              |        |     this is address used for connect
117     //            |       |              |        |     also.
118     //            |       |              |        |
119     //            |       |              |        |
120     //            |       |              |        |
121     //            |       |              |        |
122     //            +       +              +        +
123     //      {   sfam,   saddr,         cfam,    caddr,      }
124 
<span class="line-modified">125     public static List&lt;Object[]&gt; openConnectGenTests =</span>

126         Arrays.asList(new Object[][] {
127             {   INET,   IA4LOOPBACK,   INET,    IA4LOOPBACK },
128             {   INET,   IA4LOOPBACK,   null,    IA4LOOPBACK },
129             {   INET,   IA4ANYLOCAL,   null,    IA4LOOPBACK },
130             {   INET,   IA4ANYLOCAL,   INET,    IA4LOOPBACK },
<span class="line-removed">131             {   INET6,  IA6ANYLOCAL,   null,    IA6LOOPBACK },</span>
<span class="line-removed">132             {   INET6,  IA6ANYLOCAL,   INET6,   IA6LOOPBACK },</span>
<span class="line-removed">133             {   INET6,  IA6LOOPBACK,   INET6,   IA6LOOPBACK },</span>
134             {   null,   IA4LOOPBACK,   INET,    IA4ANYLOCAL },
135             {   null,   IA4LOOPBACK,   INET,    IA4LOOPBACK },
136             {   null,   IA4LOOPBACK,   INET,    null        },
<span class="line-modified">137             {   null,   IA4LOOPBACK,   INET6,   IA6ANYLOCAL },</span>
<span class="line-removed">138             {   null,   IA6LOOPBACK,   INET6,   IA6ANYLOCAL },</span>
<span class="line-removed">139             {   null,   IA6LOOPBACK,   INET6,   IA6LOOPBACK },</span>
<span class="line-removed">140             {   null,   IA6LOOPBACK,   INET6,   DONT_BIND   },</span>
<span class="line-removed">141             {   null,   IA4LOOPBACK,   INET6,   DONT_BIND   },</span>
<span class="line-removed">142             {   null,   IA4LOOPBACK,   INET6,   null        },</span>
<span class="line-removed">143             {   null,   IA6LOOPBACK,   INET6,   null        },</span>
<span class="line-removed">144             {   null,   IA4LOOPBACK,   null,    IA6ANYLOCAL },</span>
<span class="line-removed">145             {   null,   IA6LOOPBACK,   null,    IA6ANYLOCAL },</span>
<span class="line-removed">146             {   null,   IA6LOOPBACK,   null,    IA6LOOPBACK },</span>
<span class="line-removed">147             {   null,   IA4LOOPBACK,   null,    null        },</span>
<span class="line-removed">148             {   null,   IA6LOOPBACK,   null,    null        },</span>
<span class="line-removed">149             {   null,   IA6ANYLOCAL,   null,    IA6LOCAL    },</span>
<span class="line-removed">150             {   null,   IA6ANYLOCAL,   null,    IA6LOOPBACK },</span>
<span class="line-removed">151             {   null,   IA6ANYLOCAL,   INET6,   IA6LOCAL    },</span>
<span class="line-removed">152             {   null,   IA6ANYLOCAL,   INET6,   IA6LOOPBACK },</span>
<span class="line-removed">153             {   INET6,  IA6LOOPBACK,   INET6,   IA6LOOPBACK }</span>
154         });
155 
<span class="line-modified">156     // Additional tests for when an IPv4 local address or V6</span>
<span class="line-removed">157     // local address is available</span>
<span class="line-removed">158 </span>
159     public List&lt;Object[]&gt;  openConnectV4LocalTests =
160         Arrays.asList(new Object[][] {
161             {   INET,   IA4LOCAL,      INET,    IA4LOCAL    },
162             {   INET,   IA4LOCAL,      null,    IA4LOCAL    },
163             {   INET,   IA4LOCAL,      null,    DONT_BIND   },
164             {   INET,   IA4ANYLOCAL,   INET,    IA4LOCAL    },
165             {   INET,   IA4ANYLOCAL,   null,    IA4LOCAL    },
166             {   null,   IA4LOCAL,      INET,    IA4ANYLOCAL },
167             {   null,   IA4LOCAL,      INET,    IA4LOCAL    },
168             {   null,   IA4LOCAL,      INET,    null        },
<span class="line-modified">169             {   null,   IA4LOCAL,      INET6,   IA6ANYLOCAL },</span>
<span class="line-modified">170             {   null,   IA4LOCAL,      INET6,   null        },</span>
<span class="line-modified">171             {   null,   IA4LOCAL,      null,    IA6ANYLOCAL }</span>
















172         });
173 

174     public List&lt;Object[]&gt; openConnectV6LocalTests =
175         Arrays.asList(new Object[][] {
176             {   INET6,  IA6ANYLOCAL,   null,    IA6LOCAL    },
177             {   INET6,  IA6ANYLOCAL,   INET6,   IA6LOCAL    },
178             {   INET6,  IA6LOCAL,      INET6,   IA6LOCAL    },
179             {   INET6,  IA6LOCAL,      null,    IA6LOCAL    },
180             {   INET6,  IA6LOCAL,      null,    DONT_BIND   },



181             {   null,   IA6LOCAL,      INET6,   IA6LOCAL    },
182             {   null,   IA6LOCAL,      INET6,   IA6ANYLOCAL },
183             {   null,   IA6LOCAL,      null,    IA6ANYLOCAL },
184             {   null,   IA6LOCAL,      null,    IA6LOCAL    },
185             {   null,   IA6LOCAL,      INET6,   null        },
<span class="line-modified">186             {   null,   IA6LOCAL,      null,    null        },</span>
<span class="line-modified">187             {   null,   IA4LOCAL,      null,    null        },</span>
<span class="line-modified">188             {   INET6,  IA6LOCAL,      INET6,   IA6LOCAL    }</span>







189         });
190 







191 
192     /**
193      * If the destination address is the wildcard, it is replaced by the alternate
194      * using the port number from destination. Otherwise destination is returned.
195      * Only used by dcOpenAndConnect
196      */
197     static InetSocketAddress getDestinationAddress(SocketAddress destination, InetAddress alternate) {
198         InetSocketAddress isa = (InetSocketAddress)destination;
199         if (isa.getAddress().isAnyLocalAddress())
200             return new InetSocketAddress(alternate, isa.getPort());
201         else
202             return isa;
203     }
204 
205     @Test(dataProvider = &quot;openConnect&quot;)
206     public void scOpenAndConnect(ProtocolFamily sfam,
207                                  InetAddress saddr,
208                                  ProtocolFamily cfam,
209                                  InetAddress caddr) throws IOException
210     {
</pre>
</td>
<td>
<hr />
<pre>
 77         }
 78     }
 79 
 80     @BeforeTest()
 81     public void setup() {
 82         NetworkConfiguration.printSystemConfiguration(out);
 83         IPSupport.printPlatformSupport(out);
 84         throwSkippedExceptionIfNonOperational();
 85 
 86         out.println(&quot;IA4LOCAL:    &quot; + IA4LOCAL);
 87         out.println(&quot;IA6LOCAL:    &quot; + IA6LOCAL);
 88         out.println(&quot;IA4ANYLOCAL: &quot; + IA4ANYLOCAL);
 89         out.println(&quot;IA6ANYLOCAL: &quot; + IA6ANYLOCAL);
 90         out.println(&quot;IA4LOOPBACK: &quot; + IA4LOOPBACK);
 91         out.println(&quot;IA6LOOPBACK: &quot; + IA6LOOPBACK);
 92     }
 93 
 94     @DataProvider(name = &quot;openConnect&quot;)
 95     public Object[][] openConnect() {
 96         LinkedList&lt;Object[]&gt;  l = new LinkedList&lt;&gt;();
<span class="line-modified"> 97         if (IPSupport.hasIPv4()) {</span>
<span class="line-modified"> 98             l.addAll(openConnectV4Tests);</span>
<span class="line-modified"> 99             if (IA4LOCAL != null) {</span>
<span class="line-added">100                 l.addAll(openConnectV4LocalTests);</span>
<span class="line-added">101             }</span>
102         }
<span class="line-modified">103         if (IPSupport.hasIPv6()) {</span>
<span class="line-modified">104             l.addAll(openConnectV6Tests);</span>
<span class="line-added">105             if (IA6LOCAL != null) {</span>
<span class="line-added">106                 l.addAll(openConnectV6LocalTests);</span>
<span class="line-added">107             }</span>
<span class="line-added">108         }</span>
<span class="line-added">109         if (IPSupport.hasIPv4() &amp;&amp; IPSupport.hasIPv6()) {</span>
<span class="line-added">110             l.addAll(openConnectV4AndV6Tests);</span>
<span class="line-added">111             if (IA4LOCAL != null) {</span>
<span class="line-added">112                 l.addAll(openConnectV4LocalAndV6Tests);</span>
<span class="line-added">113             }</span>
114         }
115         return l.toArray(new Object[][]{});
116     }
117 
118     //            +----- sfam is server/first socket family
119     //            |
120     //            |       +------ saddr is bind address for server/first socket
121     //            |       |
122     //            |       |              +---- cfam is family for client/second socket
123     //            |       |              |
124     //            |       |              |        +---- caddr is address client/second
125     //            |       |              |        |     socket binds to. When the server
126     //            |       |              |        |     has bound to a wildcard address
127     //            |       |              |        |     this is address used for connect
128     //            |       |              |        |     also.
129     //            |       |              |        |
130     //            |       |              |        |
131     //            |       |              |        |
132     //            |       |              |        |
133     //            +       +              +        +
134     //      {   sfam,   saddr,         cfam,    caddr,      }
135 
<span class="line-modified">136     // Basic tests for when an IPv4 is available</span>
<span class="line-added">137     public static List&lt;Object[]&gt; openConnectV4Tests =</span>
138         Arrays.asList(new Object[][] {
139             {   INET,   IA4LOOPBACK,   INET,    IA4LOOPBACK },
140             {   INET,   IA4LOOPBACK,   null,    IA4LOOPBACK },
141             {   INET,   IA4ANYLOCAL,   null,    IA4LOOPBACK },
142             {   INET,   IA4ANYLOCAL,   INET,    IA4LOOPBACK },



143             {   null,   IA4LOOPBACK,   INET,    IA4ANYLOCAL },
144             {   null,   IA4LOOPBACK,   INET,    IA4LOOPBACK },
145             {   null,   IA4LOOPBACK,   INET,    null        },
<span class="line-modified">146             {   null,   IA4LOOPBACK,   null,    null        }</span>
















147         });
148 
<span class="line-modified">149     // Additional tests for when an IPv4 local address is available</span>


150     public List&lt;Object[]&gt;  openConnectV4LocalTests =
151         Arrays.asList(new Object[][] {
152             {   INET,   IA4LOCAL,      INET,    IA4LOCAL    },
153             {   INET,   IA4LOCAL,      null,    IA4LOCAL    },
154             {   INET,   IA4LOCAL,      null,    DONT_BIND   },
155             {   INET,   IA4ANYLOCAL,   INET,    IA4LOCAL    },
156             {   INET,   IA4ANYLOCAL,   null,    IA4LOCAL    },
157             {   null,   IA4LOCAL,      INET,    IA4ANYLOCAL },
158             {   null,   IA4LOCAL,      INET,    IA4LOCAL    },
159             {   null,   IA4LOCAL,      INET,    null        },
<span class="line-modified">160             {   null,   IA4LOCAL,      null,    null        }</span>
<span class="line-modified">161         });</span>
<span class="line-modified">162 </span>
<span class="line-added">163     // Basic tests for when an IPv6 is available</span>
<span class="line-added">164     public List&lt;Object[]&gt; openConnectV6Tests =</span>
<span class="line-added">165         Arrays.asList(new Object[][] {</span>
<span class="line-added">166             {   INET6,  IA6ANYLOCAL,   null,    IA6LOOPBACK },</span>
<span class="line-added">167             {   INET6,  IA6ANYLOCAL,   INET6,   IA6LOOPBACK },</span>
<span class="line-added">168             {   INET6,  IA6LOOPBACK,   INET6,   IA6LOOPBACK },</span>
<span class="line-added">169             {   INET6,  IA6LOOPBACK,   INET6,   IA6LOOPBACK },</span>
<span class="line-added">170             {   null,   IA6ANYLOCAL,   null,    IA6LOOPBACK },</span>
<span class="line-added">171             {   null,   IA6ANYLOCAL,   INET6,   IA6LOOPBACK },</span>
<span class="line-added">172             {   null,   IA6LOOPBACK,   INET6,   IA6LOOPBACK },</span>
<span class="line-added">173             {   null,   IA6LOOPBACK,   INET6,   DONT_BIND   },</span>
<span class="line-added">174             {   null,   IA6LOOPBACK,   INET6,   null        },</span>
<span class="line-added">175             {   null,   IA6LOOPBACK,   null,    IA6LOOPBACK },</span>
<span class="line-added">176             {   null,   IA6LOOPBACK,   null,    null        },</span>
<span class="line-added">177             {   null,   IA6LOOPBACK,   INET6,   IA6ANYLOCAL },</span>
<span class="line-added">178             {   null,   IA6LOOPBACK,   null,    IA6ANYLOCAL }</span>
179         });
180 
<span class="line-added">181     // Additional tests for when an IPv6 local address is available</span>
182     public List&lt;Object[]&gt; openConnectV6LocalTests =
183         Arrays.asList(new Object[][] {
184             {   INET6,  IA6ANYLOCAL,   null,    IA6LOCAL    },
185             {   INET6,  IA6ANYLOCAL,   INET6,   IA6LOCAL    },
186             {   INET6,  IA6LOCAL,      INET6,   IA6LOCAL    },
187             {   INET6,  IA6LOCAL,      null,    IA6LOCAL    },
188             {   INET6,  IA6LOCAL,      null,    DONT_BIND   },
<span class="line-added">189             {   INET6,  IA6LOCAL,      INET6,   IA6LOCAL    },</span>
<span class="line-added">190             {   null,   IA6ANYLOCAL,   null,    IA6LOCAL    },</span>
<span class="line-added">191             {   null,   IA6ANYLOCAL,   INET6,   IA6LOCAL    },</span>
192             {   null,   IA6LOCAL,      INET6,   IA6LOCAL    },
193             {   null,   IA6LOCAL,      INET6,   IA6ANYLOCAL },
194             {   null,   IA6LOCAL,      null,    IA6ANYLOCAL },
195             {   null,   IA6LOCAL,      null,    IA6LOCAL    },
196             {   null,   IA6LOCAL,      INET6,   null        },
<span class="line-modified">197             {   null,   IA6LOCAL,      null,    null        }</span>
<span class="line-modified">198         });</span>
<span class="line-modified">199 </span>
<span class="line-added">200     // Additional tests for when IPv4 and IPv6 are available</span>
<span class="line-added">201      public List&lt;Object[]&gt; openConnectV4AndV6Tests =</span>
<span class="line-added">202         Arrays.asList(new Object[][] {</span>
<span class="line-added">203             {   null,   IA4LOOPBACK,   INET6,   IA6ANYLOCAL },</span>
<span class="line-added">204             {   null,   IA4LOOPBACK,   null,    IA6ANYLOCAL },</span>
<span class="line-added">205             {   null,   IA4LOOPBACK,   INET6,   DONT_BIND   },</span>
<span class="line-added">206             {   null,   IA4LOOPBACK,   INET6,   null        }</span>
207         });
208 
<span class="line-added">209     // Additional tests for when IPv4 local address and IPv6 are available</span>
<span class="line-added">210     public List&lt;Object[]&gt; openConnectV4LocalAndV6Tests =</span>
<span class="line-added">211         Arrays.asList(new Object[][] {</span>
<span class="line-added">212             {   null,   IA4LOCAL,      INET6,   IA6ANYLOCAL },</span>
<span class="line-added">213             {   null,   IA4LOCAL,      INET6,   null        },</span>
<span class="line-added">214             {   null,   IA4LOCAL,      null,    IA6ANYLOCAL }</span>
<span class="line-added">215         });</span>
216 
217     /**
218      * If the destination address is the wildcard, it is replaced by the alternate
219      * using the port number from destination. Otherwise destination is returned.
220      * Only used by dcOpenAndConnect
221      */
222     static InetSocketAddress getDestinationAddress(SocketAddress destination, InetAddress alternate) {
223         InetSocketAddress isa = (InetSocketAddress)destination;
224         if (isa.getAddress().isAnyLocalAddress())
225             return new InetSocketAddress(alternate, isa.getPort());
226         else
227             return isa;
228     }
229 
230     @Test(dataProvider = &quot;openConnect&quot;)
231     public void scOpenAndConnect(ProtocolFamily sfam,
232                                  InetAddress saddr,
233                                  ProtocolFamily cfam,
234                                  InetAddress caddr) throws IOException
235     {
</pre>
</td>
</tr>
</table>
<center><a href="../../../net/MulticastSocket/UnreferencedMulticastSockets.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../security/SecureRandom/DefaultAlgo.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>