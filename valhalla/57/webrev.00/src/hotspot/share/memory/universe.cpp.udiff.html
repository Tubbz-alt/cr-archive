<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/memory/universe.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../classfile/classFileParser.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="universe.hpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/memory/universe.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -137,10 +137,11 @@</span>
  
  Array&lt;int&gt;* Universe::_the_empty_int_array            = NULL;
  Array&lt;u2&gt;* Universe::_the_empty_short_array           = NULL;
  Array&lt;Klass*&gt;* Universe::_the_empty_klass_array     = NULL;
  Array&lt;InstanceKlass*&gt;* Universe::_the_empty_instance_klass_array  = NULL;
<span class="udiff-line-added">+ Array&lt;InstanceKlass*&gt;* Universe::_the_single_IdentityObject_klass_array = NULL;</span>
  Array&lt;Method*&gt;* Universe::_the_empty_method_array   = NULL;
  
  // These variables are guarded by FullGCALot_lock.
  debug_only(objArrayOop Universe::_fullgc_alot_dummy_array = NULL;)
  debug_only(int Universe::_fullgc_alot_dummy_next      = 0;)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -222,10 +223,11 @@</span>
    it-&gt;push(&amp;_the_empty_short_array);
    it-&gt;push(&amp;_the_empty_klass_array);
    it-&gt;push(&amp;_the_empty_instance_klass_array);
    it-&gt;push(&amp;_the_empty_method_array);
    it-&gt;push(&amp;_the_array_interfaces_array);
<span class="udiff-line-added">+   it-&gt;push(&amp;_the_single_IdentityObject_klass_array);</span>
  
    _finalizer_register_cache-&gt;metaspace_pointers_do(it);
    _loader_addClass_cache-&gt;metaspace_pointers_do(it);
    _throw_illegal_access_error_cache-&gt;metaspace_pointers_do(it);
    _throw_no_such_method_error_cache-&gt;metaspace_pointers_do(it);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -260,10 +262,11 @@</span>
    f-&gt;do_ptr((void**)&amp;_the_empty_int_array);
    f-&gt;do_ptr((void**)&amp;_the_empty_short_array);
    f-&gt;do_ptr((void**)&amp;_the_empty_method_array);
    f-&gt;do_ptr((void**)&amp;_the_empty_klass_array);
    f-&gt;do_ptr((void**)&amp;_the_empty_instance_klass_array);
<span class="udiff-line-added">+   f-&gt;do_ptr((void**)&amp;_the_single_IdentityObject_klass_array);</span>
    _finalizer_register_cache-&gt;serialize(f);
    _loader_addClass_cache-&gt;serialize(f);
    _throw_illegal_access_error_cache-&gt;serialize(f);
    _throw_no_such_method_error_cache-&gt;serialize(f);
    _do_stack_walk_cache-&gt;serialize(f);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -341,10 +344,12 @@</span>
        assert(_the_array_interfaces_array-&gt;at(1) ==
               SystemDictionary::Serializable_klass(), &quot;u3&quot;);
        assert(_the_array_interfaces_array-&gt;at(2) ==
                     SystemDictionary::IdentityObject_klass(), &quot;u3&quot;);
  
<span class="udiff-line-added">+       assert(_the_single_IdentityObject_klass_array-&gt;at(0) ==</span>
<span class="udiff-line-added">+           SystemDictionary::IdentityObject_klass(), &quot;u3&quot;);</span>
      } else
  #endif
      {
        // Set up shared interfaces array.  (Do this before supers are set up.)
        _the_array_interfaces_array-&gt;at_put(0, SystemDictionary::Cloneable_klass());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -469,10 +474,18 @@</span>
      _mirrors[T_VOID]    = _void_mirror;
    //_mirrors[T_OBJECT]  = _object_klass-&gt;java_mirror();
    //_mirrors[T_ARRAY]   = _object_klass-&gt;java_mirror();
  }
  
<span class="udiff-line-added">+ void Universe::initialize_the_single_IdentityObject_klass_array(InstanceKlass* ik, TRAPS) {</span>
<span class="udiff-line-added">+     assert(_the_single_IdentityObject_klass_array == NULL, &quot;Must not be initialized twice&quot;);</span>
<span class="udiff-line-added">+     assert(ik-&gt;name() == vmSymbols::java_lang_IdentityObject(), &quot;Must be&quot;);</span>
<span class="udiff-line-added">+     Array&lt;InstanceKlass*&gt;* array = MetadataFactory::new_array&lt;InstanceKlass*&gt;(ik-&gt;class_loader_data(), 1, NULL, CHECK);</span>
<span class="udiff-line-added">+     array-&gt;at_put(0, ik);</span>
<span class="udiff-line-added">+     _the_single_IdentityObject_klass_array = array;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
  void Universe::fixup_mirrors(TRAPS) {
    // Bootstrap problem: all classes gets a mirror (java.lang.Class instance) assigned eagerly,
    // but we cannot do that for classes created before java.lang.Class is loaded. Here we simply
    // walk over permanent objects created so far (mostly classes) and fixup their mirrors. Note
    // that the number of objects allocated at this point is very small.
</pre>
<center><a href="../classfile/classFileParser.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="universe.hpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>