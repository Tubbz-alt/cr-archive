<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/cpu/aarch64/aarch64.ad</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../../../../.hgtags.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../../share/classfile/javaClasses.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/aarch64/aarch64.ad</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -2379,14 +2379,23 @@</span>
    return true;
  }
  
  const bool Matcher::convi2l_type_required = false;
  
<span class="udiff-line-added">+ // Should the matcher clone input &#39;m&#39; of node &#39;n&#39;?</span>
<span class="udiff-line-added">+ bool Matcher::pd_clone_node(Node* n, Node* m, Matcher::MStack&amp; mstack) {</span>
<span class="udiff-line-added">+   if (is_vshift_con_pattern(n, m)) { // ShiftV src (ShiftCntV con)</span>
<span class="udiff-line-added">+     mstack.push(m, Visit);           // m = ShiftCntV</span>
<span class="udiff-line-added">+     return true;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+   return false;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  // Should the Matcher clone shifts on addressing modes, expecting them
  // to be subsumed into complex addressing expressions or compute them
  // into registers?
<span class="udiff-line-modified-removed">- bool Matcher::clone_address_expressions(AddPNode* m, Matcher::MStack&amp; mstack, VectorSet&amp; address_visited) {</span>
<span class="udiff-line-modified-added">+ bool Matcher::pd_clone_address_expressions(AddPNode* m, Matcher::MStack&amp; mstack, VectorSet&amp; address_visited) {</span>
    if (clone_base_plus_offset_address(m, mstack, address_visited)) {
      return true;
    }
  
    Node *off = m-&gt;in(AddPNode::Offset);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16071,18 +16080,18 @@</span>
    match(Set dst (AddReductionVI src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP tmp, TEMP tmp2);
    format %{ &quot;umov  $tmp, $src2, S, 0\n\t&quot;
              &quot;umov  $tmp2, $src2, S, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;addw  $dst, $src1, $tmp\n\t&quot;</span>
<span class="udiff-line-modified-removed">-             &quot;addw  $dst, $dst, $tmp2\t add reduction2i&quot;</span>
<span class="udiff-line-modified-added">+             &quot;addw  $tmp, $src1, $tmp\n\t&quot;</span>
<span class="udiff-line-modified-added">+             &quot;addw  $dst, $tmp, $tmp2\t# add reduction2I&quot;</span>
    %}
    ins_encode %{
      __ umov($tmp$$Register, as_FloatRegister($src2$$reg), __ S, 0);
      __ umov($tmp2$$Register, as_FloatRegister($src2$$reg), __ S, 1);
<span class="udiff-line-modified-removed">-     __ addw($dst$$Register, $src1$$Register, $tmp$$Register);</span>
<span class="udiff-line-modified-removed">-     __ addw($dst$$Register, $dst$$Register, $tmp2$$Register);</span>
<span class="udiff-line-modified-added">+     __ addw($tmp$$Register, $src1$$Register, $tmp$$Register);</span>
<span class="udiff-line-modified-added">+     __ addw($dst$$Register, $tmp$$Register, $tmp2$$Register);</span>
    %}
    ins_pipe(pipe_class_default);
  %}
  
  instruct reduce_add4I(iRegINoSp dst, iRegIorL2I src1, vecX src2, vecX tmp, iRegINoSp tmp2)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16090,11 +16099,11 @@</span>
    match(Set dst (AddReductionVI src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP tmp, TEMP tmp2);
    format %{ &quot;addv  $tmp, T4S, $src2\n\t&quot;
              &quot;umov  $tmp2, $tmp, S, 0\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;addw  $dst, $tmp2, $src1\t add reduction4i&quot;</span>
<span class="udiff-line-modified-added">+             &quot;addw  $dst, $tmp2, $src1\t# add reduction4I&quot;</span>
    %}
    ins_encode %{
      __ addv(as_FloatRegister($tmp$$reg), __ T4S,
              as_FloatRegister($src2$$reg));
      __ umov($tmp2$$Register, as_FloatRegister($tmp$$reg), __ S, 0);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16109,11 +16118,11 @@</span>
    ins_cost(INSN_COST);
    effect(TEMP tmp, TEMP dst);
    format %{ &quot;umov  $tmp, $src2, S, 0\n\t&quot;
              &quot;mul   $dst, $tmp, $src1\n\t&quot;
              &quot;umov  $tmp, $src2, S, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;mul   $dst, $tmp, $dst\t mul reduction2i\n\t&quot;</span>
<span class="udiff-line-modified-added">+             &quot;mul   $dst, $tmp, $dst\t# mul reduction2I&quot;</span>
    %}
    ins_encode %{
      __ umov($tmp$$Register, as_FloatRegister($src2$$reg), __ S, 0);
      __ mul($dst$$Register, $tmp$$Register, $src1$$Register);
      __ umov($tmp$$Register, as_FloatRegister($src2$$reg), __ S, 1);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16130,11 +16139,11 @@</span>
    format %{ &quot;ins   $tmp, $src2, 0, 1\n\t&quot;
              &quot;mul   $tmp, $tmp, $src2\n\t&quot;
              &quot;umov  $tmp2, $tmp, S, 0\n\t&quot;
              &quot;mul   $dst, $tmp2, $src1\n\t&quot;
              &quot;umov  $tmp2, $tmp, S, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;mul   $dst, $tmp2, $dst\t mul reduction4i\n\t&quot;</span>
<span class="udiff-line-modified-added">+             &quot;mul   $dst, $tmp2, $dst\t# mul reduction4I&quot;</span>
    %}
    ins_encode %{
      __ ins(as_FloatRegister($tmp$$reg), __ D,
             as_FloatRegister($src2$$reg), 0, 1);
      __ mulv(as_FloatRegister($tmp$$reg), __ T2S,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16152,11 +16161,11 @@</span>
    match(Set dst (AddReductionVF src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP tmp, TEMP dst);
    format %{ &quot;fadds $dst, $src1, $src2\n\t&quot;
              &quot;ins   $tmp, S, $src2, 0, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fadds $dst, $dst, $tmp\t add reduction2f&quot;</span>
<span class="udiff-line-modified-added">+             &quot;fadds $dst, $dst, $tmp\t# add reduction2F&quot;</span>
    %}
    ins_encode %{
      __ fadds(as_FloatRegister($dst$$reg),
               as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ S,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16176,11 +16185,11 @@</span>
              &quot;ins   $tmp, S, $src2, 0, 1\n\t&quot;
              &quot;fadds $dst, $dst, $tmp\n\t&quot;
              &quot;ins   $tmp, S, $src2, 0, 2\n\t&quot;
              &quot;fadds $dst, $dst, $tmp\n\t&quot;
              &quot;ins   $tmp, S, $src2, 0, 3\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fadds $dst, $dst, $tmp\t add reduction4f&quot;</span>
<span class="udiff-line-modified-added">+             &quot;fadds $dst, $dst, $tmp\t# add reduction4F&quot;</span>
    %}
    ins_encode %{
      __ fadds(as_FloatRegister($dst$$reg),
               as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ S,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16204,11 +16213,11 @@</span>
    match(Set dst (MulReductionVF src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP tmp, TEMP dst);
    format %{ &quot;fmuls $dst, $src1, $src2\n\t&quot;
              &quot;ins   $tmp, S, $src2, 0, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fmuls $dst, $dst, $tmp\t add reduction4f&quot;</span>
<span class="udiff-line-modified-added">+             &quot;fmuls $dst, $dst, $tmp\t# mul reduction2F&quot;</span>
    %}
    ins_encode %{
      __ fmuls(as_FloatRegister($dst$$reg),
               as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ S,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16228,11 +16237,11 @@</span>
              &quot;ins   $tmp, S, $src2, 0, 1\n\t&quot;
              &quot;fmuls $dst, $dst, $tmp\n\t&quot;
              &quot;ins   $tmp, S, $src2, 0, 2\n\t&quot;
              &quot;fmuls $dst, $dst, $tmp\n\t&quot;
              &quot;ins   $tmp, S, $src2, 0, 3\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fmuls $dst, $dst, $tmp\t add reduction4f&quot;</span>
<span class="udiff-line-modified-added">+             &quot;fmuls $dst, $dst, $tmp\t# mul reduction4F&quot;</span>
    %}
    ins_encode %{
      __ fmuls(as_FloatRegister($dst$$reg),
               as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ S,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16256,11 +16265,11 @@</span>
    match(Set dst (AddReductionVD src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP tmp, TEMP dst);
    format %{ &quot;faddd $dst, $src1, $src2\n\t&quot;
              &quot;ins   $tmp, D, $src2, 0, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;faddd $dst, $dst, $tmp\t add reduction2d&quot;</span>
<span class="udiff-line-modified-added">+             &quot;faddd $dst, $dst, $tmp\t# add reduction2D&quot;</span>
    %}
    ins_encode %{
      __ faddd(as_FloatRegister($dst$$reg),
               as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ D,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16276,11 +16285,11 @@</span>
    match(Set dst (MulReductionVD src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP tmp, TEMP dst);
    format %{ &quot;fmuld $dst, $src1, $src2\n\t&quot;
              &quot;ins   $tmp, D, $src2, 0, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fmuld $dst, $dst, $tmp\t add reduction2d&quot;</span>
<span class="udiff-line-modified-added">+             &quot;fmuld $dst, $dst, $tmp\t# mul reduction2D&quot;</span>
    %}
    ins_encode %{
      __ fmuld(as_FloatRegister($dst$$reg),
               as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ D,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16296,11 +16305,11 @@</span>
    match(Set dst (MaxReductionV src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP_DEF dst, TEMP tmp);
    format %{ &quot;fmaxs $dst, $src1, $src2\n\t&quot;
              &quot;ins   $tmp, S, $src2, 0, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fmaxs $dst, $dst, $tmp\t max reduction2F&quot; %}</span>
<span class="udiff-line-modified-added">+             &quot;fmaxs $dst, $dst, $tmp\t# max reduction2F&quot; %}</span>
    ins_encode %{
      __ fmaxs(as_FloatRegister($dst$$reg), as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ S, as_FloatRegister($src2$$reg), 0, 1);
      __ fmaxs(as_FloatRegister($dst$$reg), as_FloatRegister($dst$$reg), as_FloatRegister($tmp$$reg));
    %}
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16311,11 +16320,11 @@</span>
    predicate(n-&gt;in(2)-&gt;bottom_type()-&gt;is_vect()-&gt;element_basic_type() == T_FLOAT);
    match(Set dst (MaxReductionV src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP_DEF dst);
    format %{ &quot;fmaxv $dst, T4S, $src2\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fmaxs $dst, $dst, $src1\t max reduction4F&quot; %}</span>
<span class="udiff-line-modified-added">+             &quot;fmaxs $dst, $dst, $src1\t# max reduction4F&quot; %}</span>
    ins_encode %{
      __ fmaxv(as_FloatRegister($dst$$reg), __ T4S, as_FloatRegister($src2$$reg));
      __ fmaxs(as_FloatRegister($dst$$reg), as_FloatRegister($dst$$reg), as_FloatRegister($src1$$reg));
    %}
    ins_pipe(pipe_class_default);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16326,11 +16335,11 @@</span>
    match(Set dst (MaxReductionV src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP_DEF dst, TEMP tmp);
    format %{ &quot;fmaxd $dst, $src1, $src2\n\t&quot;
              &quot;ins   $tmp, D, $src2, 0, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fmaxd $dst, $dst, $tmp\t max reduction2D&quot; %}</span>
<span class="udiff-line-modified-added">+             &quot;fmaxd $dst, $dst, $tmp\t# max reduction2D&quot; %}</span>
    ins_encode %{
      __ fmaxd(as_FloatRegister($dst$$reg), as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($src2$$reg), 0, 1);
      __ fmaxd(as_FloatRegister($dst$$reg), as_FloatRegister($dst$$reg), as_FloatRegister($tmp$$reg));
    %}
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16342,11 +16351,11 @@</span>
    match(Set dst (MinReductionV src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP_DEF dst, TEMP tmp);
    format %{ &quot;fmins $dst, $src1, $src2\n\t&quot;
              &quot;ins   $tmp, S, $src2, 0, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fmins $dst, $dst, $tmp\t min reduction2F&quot; %}</span>
<span class="udiff-line-modified-added">+             &quot;fmins $dst, $dst, $tmp\t# min reduction2F&quot; %}</span>
    ins_encode %{
      __ fmins(as_FloatRegister($dst$$reg), as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ S, as_FloatRegister($src2$$reg), 0, 1);
      __ fmins(as_FloatRegister($dst$$reg), as_FloatRegister($dst$$reg), as_FloatRegister($tmp$$reg));
    %}
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16357,11 +16366,11 @@</span>
    predicate(n-&gt;in(2)-&gt;bottom_type()-&gt;is_vect()-&gt;element_basic_type() == T_FLOAT);
    match(Set dst (MinReductionV src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP_DEF dst);
    format %{ &quot;fminv $dst, T4S, $src2\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fmins $dst, $dst, $src1\t min reduction4F&quot; %}</span>
<span class="udiff-line-modified-added">+             &quot;fmins $dst, $dst, $src1\t# min reduction4F&quot; %}</span>
    ins_encode %{
      __ fminv(as_FloatRegister($dst$$reg), __ T4S, as_FloatRegister($src2$$reg));
      __ fmins(as_FloatRegister($dst$$reg), as_FloatRegister($dst$$reg), as_FloatRegister($src1$$reg));
    %}
    ins_pipe(pipe_class_default);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -16372,11 +16381,11 @@</span>
    match(Set dst (MinReductionV src1 src2));
    ins_cost(INSN_COST);
    effect(TEMP_DEF dst, TEMP tmp);
    format %{ &quot;fmind $dst, $src1, $src2\n\t&quot;
              &quot;ins   $tmp, D, $src2, 0, 1\n\t&quot;
<span class="udiff-line-modified-removed">-             &quot;fmind $dst, $dst, $tmp\t min reduction2D&quot; %}</span>
<span class="udiff-line-modified-added">+             &quot;fmind $dst, $dst, $tmp\t# min reduction2D&quot; %}</span>
    ins_encode %{
      __ fmind(as_FloatRegister($dst$$reg), as_FloatRegister($src1$$reg), as_FloatRegister($src2$$reg));
      __ ins(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($src2$$reg), 0, 1);
      __ fmind(as_FloatRegister($dst$$reg), as_FloatRegister($dst$$reg), as_FloatRegister($tmp$$reg));
    %}
</pre>
<center><a href="../../../../.hgtags.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../../share/classfile/javaClasses.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>