<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/cpu/x86/frame_x86.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="c1_MacroAssembler_x86.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../../share/c1/c1_MacroAssembler.hpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/x86/frame_x86.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
698 }
699 
700 #ifndef PRODUCT
701 // This is a generic constructor which is only used by pns() in debug.cpp.
702 frame::frame(void* sp, void* fp, void* pc) {
703   init((intptr_t*)sp, (intptr_t*)fp, (address)pc);
704 }
705 
706 void frame::pd_ps() {}
707 #endif
708 
709 // Check for a method with scalarized value type arguments that needs
710 // a stack repair and return the repaired sender stack pointer.
711 intptr_t* frame::repair_sender_sp(intptr_t* sender_sp, intptr_t** saved_fp_addr) const {
712   CompiledMethod* cm = _cb-&gt;as_compiled_method_or_null();
713   if (cm != NULL &amp;&amp; cm-&gt;needs_stack_repair()) {
714     // The stack increment resides just below the saved rbp on the stack
715     // and does not account for the return address.
716     intptr_t* real_frame_size_addr = (intptr_t*) (saved_fp_addr - 1);
717     int real_frame_size = ((*real_frame_size_addr) + wordSize) / wordSize;
<span class="line-modified">718     assert(real_frame_size &gt;= _cb-&gt;frame_size(), &quot;invalid frame size&quot;);</span>
719     sender_sp = unextended_sp() + real_frame_size;
720   }
721   return sender_sp;
722 }
723 
724 void JavaFrameAnchor::make_walkable(JavaThread* thread) {
725   // last frame set?
726   if (last_Java_sp() == NULL) return;
727   // already walkable?
728   if (walkable()) return;
729   vmassert(Thread::current() == (Thread*)thread, &quot;not current thread&quot;);
730   vmassert(last_Java_sp() != NULL, &quot;not called from Java code?&quot;);
731   vmassert(last_Java_pc() == NULL, &quot;already walkable&quot;);
732   capture_last_Java_pc();
733   vmassert(walkable(), &quot;something went wrong&quot;);
734 }
735 
736 void JavaFrameAnchor::capture_last_Java_pc() {
737   vmassert(_last_Java_sp != NULL, &quot;no last frame set&quot;);
738   vmassert(_last_Java_pc == NULL, &quot;already walkable&quot;);
</pre>
</td>
<td>
<hr />
<pre>
698 }
699 
700 #ifndef PRODUCT
701 // This is a generic constructor which is only used by pns() in debug.cpp.
702 frame::frame(void* sp, void* fp, void* pc) {
703   init((intptr_t*)sp, (intptr_t*)fp, (address)pc);
704 }
705 
706 void frame::pd_ps() {}
707 #endif
708 
709 // Check for a method with scalarized value type arguments that needs
710 // a stack repair and return the repaired sender stack pointer.
711 intptr_t* frame::repair_sender_sp(intptr_t* sender_sp, intptr_t** saved_fp_addr) const {
712   CompiledMethod* cm = _cb-&gt;as_compiled_method_or_null();
713   if (cm != NULL &amp;&amp; cm-&gt;needs_stack_repair()) {
714     // The stack increment resides just below the saved rbp on the stack
715     // and does not account for the return address.
716     intptr_t* real_frame_size_addr = (intptr_t*) (saved_fp_addr - 1);
717     int real_frame_size = ((*real_frame_size_addr) + wordSize) / wordSize;
<span class="line-modified">718     assert(real_frame_size &gt;= _cb-&gt;frame_size() &amp;&amp; real_frame_size &lt;= 1000000, &quot;invalid frame size&quot;);</span>
719     sender_sp = unextended_sp() + real_frame_size;
720   }
721   return sender_sp;
722 }
723 
724 void JavaFrameAnchor::make_walkable(JavaThread* thread) {
725   // last frame set?
726   if (last_Java_sp() == NULL) return;
727   // already walkable?
728   if (walkable()) return;
729   vmassert(Thread::current() == (Thread*)thread, &quot;not current thread&quot;);
730   vmassert(last_Java_sp() != NULL, &quot;not called from Java code?&quot;);
731   vmassert(last_Java_pc() == NULL, &quot;already walkable&quot;);
732   capture_last_Java_pc();
733   vmassert(walkable(), &quot;something went wrong&quot;);
734 }
735 
736 void JavaFrameAnchor::capture_last_Java_pc() {
737   vmassert(_last_Java_sp != NULL, &quot;no last frame set&quot;);
738   vmassert(_last_Java_pc == NULL, &quot;already walkable&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="c1_MacroAssembler_x86.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../../share/c1/c1_MacroAssembler.hpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>