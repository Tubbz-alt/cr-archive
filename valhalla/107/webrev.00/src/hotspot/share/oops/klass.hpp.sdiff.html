<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/oops/klass.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="instanceKlass.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="valueArrayKlass.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/oops/klass.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
400     return (juint)_lh_array_tag_vt_value == (juint)(lh &gt;&gt; _lh_array_tag_shift);
401   }
402   static bool layout_helper_is_null_free(jint lh) {
403     assert(layout_helper_is_valueArray(lh) || layout_helper_is_objArray(lh), &quot;must be array of inline types&quot;);
404     return ((lh &gt;&gt; _lh_null_free_shift) &amp; _lh_null_free_mask);
405   }
406   static jint layout_helper_set_null_free(jint lh) {
407     lh |= (_lh_null_free_mask &lt;&lt; _lh_null_free_shift);
408     assert(layout_helper_is_null_free(lh), &quot;Bad encoding&quot;);
409     return lh;
410   }
411   static int layout_helper_header_size(jint lh) {
412     assert(lh &lt; (jint)_lh_neutral_value, &quot;must be array&quot;);
413     int hsize = (lh &gt;&gt; _lh_header_size_shift) &amp; _lh_header_size_mask;
414     assert(hsize &gt; 0 &amp;&amp; hsize &lt; (int)sizeof(oopDesc)*3, &quot;sanity&quot;);
415     return hsize;
416   }
417   static BasicType layout_helper_element_type(jint lh) {
418     assert(lh &lt; (jint)_lh_neutral_value, &quot;must be array&quot;);
419     int btvalue = (lh &gt;&gt; _lh_element_type_shift) &amp; _lh_element_type_mask;
<span class="line-modified">420     assert((btvalue &gt;= T_BOOLEAN &amp;&amp; btvalue &lt;= T_OBJECT) || btvalue == T_VALUETYPE, &quot;sanity&quot;);</span>
421     return (BasicType) btvalue;
422   }
423 
424   // Want a pattern to quickly diff against layout header in register
425   // find something less clever!
426   static int layout_helper_boolean_diffbit() {
427     jint zlh = array_layout_helper(T_BOOLEAN);
428     jint blh = array_layout_helper(T_BYTE);
429     assert(zlh != blh, &quot;array layout helpers must differ&quot;);
430     int diffbit = 1;
431     while ((diffbit &amp; (zlh ^ blh)) == 0 &amp;&amp; (diffbit &amp; zlh) == 0) {
432       diffbit &lt;&lt;= 1;
433       assert(diffbit != 0, &quot;make sure T_BOOLEAN has a different bit than T_BYTE&quot;);
434     }
435     return diffbit;
436   }
437 
438   static int layout_helper_log2_element_size(jint lh) {
439     assert(lh &lt; (jint)_lh_neutral_value, &quot;must be array&quot;);
440     int l2esz = (lh &gt;&gt; _lh_log2_element_size_shift) &amp; _lh_log2_element_size_mask;
<span class="line-modified">441     assert(layout_helper_element_type(lh) == T_VALUETYPE || l2esz &lt;= LogBytesPerLong,</span>
442            &quot;sanity. l2esz: 0x%x for lh: 0x%x&quot;, (uint)l2esz, (uint)lh);
443     return l2esz;
444   }
445   static jint array_layout_helper(jint tag, bool null_free, int hsize, BasicType etype, int log2_esize) {
446     return (tag        &lt;&lt; _lh_array_tag_shift)
447       |    ((null_free ? 1 : 0) &lt;&lt;  _lh_null_free_shift)
448       |    (hsize      &lt;&lt; _lh_header_size_shift)
449       |    ((int)etype &lt;&lt; _lh_element_type_shift)
450       |    (log2_esize &lt;&lt; _lh_log2_element_size_shift);
451   }
452   static jint instance_layout_helper(jint size, bool slow_path_flag) {
453     return (size &lt;&lt; LogBytesPerWord)
454       |    (slow_path_flag ? _lh_instance_slow_path_bit : 0);
455   }
456   static int layout_helper_to_size_helper(jint lh) {
457     assert(lh &gt; (jint)_lh_neutral_value, &quot;must be instance&quot;);
458     // Note that the following expression discards _lh_instance_slow_path_bit.
459     return lh &gt;&gt; LogBytesPerWord;
460   }
461   // Out-of-line version computes everything based on the etype:
</pre>
</td>
<td>
<hr />
<pre>
400     return (juint)_lh_array_tag_vt_value == (juint)(lh &gt;&gt; _lh_array_tag_shift);
401   }
402   static bool layout_helper_is_null_free(jint lh) {
403     assert(layout_helper_is_valueArray(lh) || layout_helper_is_objArray(lh), &quot;must be array of inline types&quot;);
404     return ((lh &gt;&gt; _lh_null_free_shift) &amp; _lh_null_free_mask);
405   }
406   static jint layout_helper_set_null_free(jint lh) {
407     lh |= (_lh_null_free_mask &lt;&lt; _lh_null_free_shift);
408     assert(layout_helper_is_null_free(lh), &quot;Bad encoding&quot;);
409     return lh;
410   }
411   static int layout_helper_header_size(jint lh) {
412     assert(lh &lt; (jint)_lh_neutral_value, &quot;must be array&quot;);
413     int hsize = (lh &gt;&gt; _lh_header_size_shift) &amp; _lh_header_size_mask;
414     assert(hsize &gt; 0 &amp;&amp; hsize &lt; (int)sizeof(oopDesc)*3, &quot;sanity&quot;);
415     return hsize;
416   }
417   static BasicType layout_helper_element_type(jint lh) {
418     assert(lh &lt; (jint)_lh_neutral_value, &quot;must be array&quot;);
419     int btvalue = (lh &gt;&gt; _lh_element_type_shift) &amp; _lh_element_type_mask;
<span class="line-modified">420     assert((btvalue &gt;= T_BOOLEAN &amp;&amp; btvalue &lt;= T_OBJECT) || btvalue == T_INLINE_TYPE, &quot;sanity&quot;);</span>
421     return (BasicType) btvalue;
422   }
423 
424   // Want a pattern to quickly diff against layout header in register
425   // find something less clever!
426   static int layout_helper_boolean_diffbit() {
427     jint zlh = array_layout_helper(T_BOOLEAN);
428     jint blh = array_layout_helper(T_BYTE);
429     assert(zlh != blh, &quot;array layout helpers must differ&quot;);
430     int diffbit = 1;
431     while ((diffbit &amp; (zlh ^ blh)) == 0 &amp;&amp; (diffbit &amp; zlh) == 0) {
432       diffbit &lt;&lt;= 1;
433       assert(diffbit != 0, &quot;make sure T_BOOLEAN has a different bit than T_BYTE&quot;);
434     }
435     return diffbit;
436   }
437 
438   static int layout_helper_log2_element_size(jint lh) {
439     assert(lh &lt; (jint)_lh_neutral_value, &quot;must be array&quot;);
440     int l2esz = (lh &gt;&gt; _lh_log2_element_size_shift) &amp; _lh_log2_element_size_mask;
<span class="line-modified">441     assert(layout_helper_element_type(lh) == T_INLINE_TYPE || l2esz &lt;= LogBytesPerLong,</span>
442            &quot;sanity. l2esz: 0x%x for lh: 0x%x&quot;, (uint)l2esz, (uint)lh);
443     return l2esz;
444   }
445   static jint array_layout_helper(jint tag, bool null_free, int hsize, BasicType etype, int log2_esize) {
446     return (tag        &lt;&lt; _lh_array_tag_shift)
447       |    ((null_free ? 1 : 0) &lt;&lt;  _lh_null_free_shift)
448       |    (hsize      &lt;&lt; _lh_header_size_shift)
449       |    ((int)etype &lt;&lt; _lh_element_type_shift)
450       |    (log2_esize &lt;&lt; _lh_log2_element_size_shift);
451   }
452   static jint instance_layout_helper(jint size, bool slow_path_flag) {
453     return (size &lt;&lt; LogBytesPerWord)
454       |    (slow_path_flag ? _lh_instance_slow_path_bit : 0);
455   }
456   static int layout_helper_to_size_helper(jint lh) {
457     assert(lh &gt; (jint)_lh_neutral_value, &quot;must be instance&quot;);
458     // Note that the following expression discards _lh_instance_slow_path_bit.
459     return lh &gt;&gt; LogBytesPerWord;
460   }
461   // Out-of-line version computes everything based on the etype:
</pre>
</td>
</tr>
</table>
<center><a href="instanceKlass.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="valueArrayKlass.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>