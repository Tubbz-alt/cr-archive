<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.jdi/share/classes/com/sun/tools/jdi/ObjectReferenceImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JNITypeParser.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ValueImpl.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdi/share/classes/com/sun/tools/jdi/ObjectReferenceImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -74,10 +74,14 @@</span>
          synchronized (vm.state()) {
              cache = markerCache;
          }
      }
  
<span class="udiff-line-added">+     private boolean isInlineType() {</span>
<span class="udiff-line-added">+         return referenceType().signature().startsWith(&quot;Q&quot;);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      // Override in subclasses
      protected Cache newCache() {
          return new Cache();
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -143,15 +147,38 @@</span>
                  return true;
              }
          }
      }
  
<span class="udiff-line-added">+     // The isSubstitutable() method must perform the same comparison on</span>
<span class="udiff-line-added">+     // remote inline objects as the one performed ValueBootstrapMethods.isSubstitutable()</span>
<span class="udiff-line-added">+     // on local instances.</span>
<span class="udiff-line-added">+     private boolean isSubstitutable(ObjectReferenceImpl other) {</span>
<span class="udiff-line-added">+         if (referenceType() != other.referenceType()) return false;</span>
<span class="udiff-line-added">+         List&lt;Field&gt; fields = referenceType().fields();</span>
<span class="udiff-line-added">+         for (Field f : fields) {</span>
<span class="udiff-line-added">+             if (f.isStatic()) {</span>
<span class="udiff-line-added">+                 fields.remove(f);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         Map&lt;Field,Value&gt; thisFields = getValues(fields);</span>
<span class="udiff-line-added">+         Map&lt;Field,Value&gt; otherFields = other.getValues(fields);</span>
<span class="udiff-line-added">+         for (Field f : fields) {</span>
<span class="udiff-line-added">+             if (!thisFields.get(f).equals(otherFields.get(f))) return false;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return true;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      public boolean equals(Object obj) {
          if ((obj != null) &amp;&amp; (obj instanceof ObjectReferenceImpl)) {
<span class="udiff-line-modified-removed">-             ObjectReferenceImpl other = (ObjectReferenceImpl)obj;</span>
<span class="udiff-line-modified-removed">-             return (ref() == other.ref()) &amp;&amp;</span>
<span class="udiff-line-modified-removed">-                    super.equals(obj);</span>
<span class="udiff-line-modified-added">+             ObjectReferenceImpl other = (ObjectReferenceImpl) obj;</span>
<span class="udiff-line-modified-added">+             if (isInlineType()) {</span>
<span class="udiff-line-modified-added">+                 return isSubstitutable(other);</span>
<span class="udiff-line-added">+             } else {</span>
<span class="udiff-line-added">+                 return (ref() == other.ref()) &amp;&amp;</span>
<span class="udiff-line-added">+                         super.equals(obj);</span>
<span class="udiff-line-added">+             }</span>
          } else {
              return false;
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -468,10 +495,13 @@</span>
              throw exc.toJDIException();
          }
      }
  
      public long uniqueID() {
<span class="udiff-line-added">+         if (isInlineType()) {</span>
<span class="udiff-line-added">+             throw new UnsupportedOperationException(&quot;Inline types cannot have unique IDs&quot;);</span>
<span class="udiff-line-added">+         }</span>
          return ref();
      }
  
      JDWP.ObjectReference.MonitorInfo jdwpMonitorInfo()
                               throws IncompatibleThreadStateException {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -608,15 +638,23 @@</span>
                                             &quot; to &quot; + destTypeName);
          }
      }
  
      public String toString() {
<span class="udiff-line-modified-removed">-         return &quot;instance of &quot; + referenceType().name() + &quot;(id=&quot; + uniqueID() + &quot;)&quot;;</span>
<span class="udiff-line-modified-added">+         if (isInlineType()) {</span>
<span class="udiff-line-added">+             return &quot;instance of &quot; + referenceType().name();</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             return &quot;instance of &quot; + referenceType().name() + &quot;(id=&quot; + uniqueID() + &quot;)&quot;;</span>
<span class="udiff-line-added">+         }</span>
      }
  
      byte typeValueKey() {
<span class="udiff-line-modified-removed">-         return JDWP.Tag.OBJECT;</span>
<span class="udiff-line-modified-added">+         if (isInlineType()) {</span>
<span class="udiff-line-added">+             return JDWP.Tag.INLINE_OBJECT;</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             return JDWP.Tag.OBJECT;</span>
<span class="udiff-line-added">+         }</span>
      }
  
      private static boolean isNonVirtual(int options) {
          return (options &amp; INVOKE_NONVIRTUAL) != 0;
      }
</pre>
<center><a href="JNITypeParser.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ValueImpl.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>