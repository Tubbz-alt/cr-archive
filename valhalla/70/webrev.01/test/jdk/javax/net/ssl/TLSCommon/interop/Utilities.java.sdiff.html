<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/javax/net/ssl/TLSCommon/interop/Utilities.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../CipherSuite.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../compatibility/README.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/javax/net/ssl/TLSCommon/interop/Utilities.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 63 
 64     public static final String JAVA_HOME = System.getProperty(&quot;java.home&quot;);
 65     public static final String JAVA
 66             = String.join(File.separator, JAVA_HOME, &quot;bin&quot;, &quot;java&quot;);
 67     public static final String JAVAC
 68             = String.join(File.separator, JAVA_HOME, &quot;bin&quot;, &quot;javac&quot;);
 69 
 70     public static final String TEST_SRC = System.getProperty(&quot;test.src&quot;);
 71     public static final String TEST_CLASSES = System.getProperty(&quot;test.classes&quot;);
 72     public static final String TEST_CLASSPATH = System.getProperty(&quot;test.class.path&quot;);
 73 
 74     public static final Charset CHARSET = StandardCharsets.UTF_8;
 75 
 76     public static final boolean DEBUG = Boolean.getBoolean(&quot;test.debug&quot;);
 77     public static final int TIMEOUT = Integer.getInteger(&quot;test.timeout&quot;, 20);
 78     public static final String LOG_PATH = System.getProperty(&quot;test.log.path&quot;);
 79 
 80     public static final String PARAM_DELIMITER = &quot;;&quot;;
 81     public static final String VALUE_DELIMITER = &quot;,&quot;;
 82 
<span class="line-modified"> 83     public static final CipherSuite[] ALL_CIPHER_SUITES</span>
<span class="line-removed"> 84             = Utilities.getAllCipherSuites();</span>
 85 
 86     /*
 87      * Gets all supported cipher suites.
 88      */
 89     private static CipherSuite[] getAllCipherSuites() {
 90         String[] supportedCipherSuites;
 91         try {
 92             supportedCipherSuites = SSLContext.getDefault()
 93                     .createSSLEngine()
 94                     .getSupportedCipherSuites();
 95         } catch (NoSuchAlgorithmException e) {
 96             throw new RuntimeException(
 97                     &quot;Failed to get supported cipher suites&quot;, e);
 98         }
 99 
100         CipherSuite[] cipherSuites = Arrays.stream(supportedCipherSuites)
101                 .map(cipherSuite -&gt; {
102                     return CipherSuite.cipherSuite(cipherSuite);})
103                 .filter(cipherSuite -&gt; {
<span class="line-modified">104                     return cipherSuite</span>
<span class="line-removed">105                             != CipherSuite.TLS_EMPTY_RENEGOTIATION_INFO_SCSV;})</span>
106                 .toArray(CipherSuite[]::new);
107 
108         return cipherSuites;
109     }
110 
111     /*
112      * Creates SSL context with the specified certificates.
113      */
114     public static SSLContext createSSLContext(CertTuple certTuple)
115             throws Exception {
116         KeyStore trustStore = createTrustStore(certTuple.trustedCerts);
117         TrustManagerFactory tmf = TrustManagerFactory.getInstance(&quot;PKIX&quot;);
118         tmf.init(trustStore);
119 
120         KeyStore keyStore = createKeyStore(certTuple.endEntityCerts);
121         KeyManagerFactory kmf = KeyManagerFactory.getInstance(&quot;NewSunX509&quot;);
122         kmf.init(keyStore, null);
123 
124         SSLContext context = SSLContext.getInstance(&quot;TLS&quot;);
125         context.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);
</pre>
</td>
<td>
<hr />
<pre>
 63 
 64     public static final String JAVA_HOME = System.getProperty(&quot;java.home&quot;);
 65     public static final String JAVA
 66             = String.join(File.separator, JAVA_HOME, &quot;bin&quot;, &quot;java&quot;);
 67     public static final String JAVAC
 68             = String.join(File.separator, JAVA_HOME, &quot;bin&quot;, &quot;javac&quot;);
 69 
 70     public static final String TEST_SRC = System.getProperty(&quot;test.src&quot;);
 71     public static final String TEST_CLASSES = System.getProperty(&quot;test.classes&quot;);
 72     public static final String TEST_CLASSPATH = System.getProperty(&quot;test.class.path&quot;);
 73 
 74     public static final Charset CHARSET = StandardCharsets.UTF_8;
 75 
 76     public static final boolean DEBUG = Boolean.getBoolean(&quot;test.debug&quot;);
 77     public static final int TIMEOUT = Integer.getInteger(&quot;test.timeout&quot;, 20);
 78     public static final String LOG_PATH = System.getProperty(&quot;test.log.path&quot;);
 79 
 80     public static final String PARAM_DELIMITER = &quot;;&quot;;
 81     public static final String VALUE_DELIMITER = &quot;,&quot;;
 82 
<span class="line-modified"> 83     public static final CipherSuite[] ALL_CIPHER_SUITES = getAllCipherSuites();</span>

 84 
 85     /*
 86      * Gets all supported cipher suites.
 87      */
 88     private static CipherSuite[] getAllCipherSuites() {
 89         String[] supportedCipherSuites;
 90         try {
 91             supportedCipherSuites = SSLContext.getDefault()
 92                     .createSSLEngine()
 93                     .getSupportedCipherSuites();
 94         } catch (NoSuchAlgorithmException e) {
 95             throw new RuntimeException(
 96                     &quot;Failed to get supported cipher suites&quot;, e);
 97         }
 98 
 99         CipherSuite[] cipherSuites = Arrays.stream(supportedCipherSuites)
100                 .map(cipherSuite -&gt; {
101                     return CipherSuite.cipherSuite(cipherSuite);})
102                 .filter(cipherSuite -&gt; {
<span class="line-modified">103                     return cipherSuite != CipherSuite.TLS_EMPTY_RENEGOTIATION_INFO_SCSV; })</span>

104                 .toArray(CipherSuite[]::new);
105 
106         return cipherSuites;
107     }
108 
109     /*
110      * Creates SSL context with the specified certificates.
111      */
112     public static SSLContext createSSLContext(CertTuple certTuple)
113             throws Exception {
114         KeyStore trustStore = createTrustStore(certTuple.trustedCerts);
115         TrustManagerFactory tmf = TrustManagerFactory.getInstance(&quot;PKIX&quot;);
116         tmf.init(trustStore);
117 
118         KeyStore keyStore = createKeyStore(certTuple.endEntityCerts);
119         KeyManagerFactory kmf = KeyManagerFactory.getInstance(&quot;NewSunX509&quot;);
120         kmf.init(keyStore, null);
121 
122         SSLContext context = SSLContext.getInstance(&quot;TLS&quot;);
123         context.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);
</pre>
</td>
</tr>
</table>
<center><a href="../CipherSuite.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../compatibility/README.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>