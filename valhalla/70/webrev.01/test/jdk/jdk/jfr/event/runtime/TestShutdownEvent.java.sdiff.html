<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/jdk/jfr/event/runtime/TestShutdownEvent.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../javax/xml/jaxp/common/8035437/org/w3c/dom/Node.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../lib/testlibrary/java/lang/UCDFiles.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/jfr/event/runtime/TestShutdownEvent.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 86                     return;
 87                 }
 88             }
 89             runSubtest(i);
 90         }
 91     }
 92 
 93     private static void runSubtest(int subTestIndex) throws Exception {
 94         ProcessBuilder pb = ProcessTools.createTestJvm(
 95                                 &quot;-Xlog:jfr=debug&quot;,
 96                                 &quot;-XX:-CreateCoredumpOnCrash&quot;,
 97                                 &quot;--add-exports=java.base/jdk.internal.misc=ALL-UNNAMED&quot;,
 98                                 &quot;-XX:StartFlightRecording=filename=./dumped.jfr,dumponexit=true,settings=default&quot;,
 99                                 &quot;jdk.jfr.event.runtime.TestShutdownEvent$TestMain&quot;,
100                                 String.valueOf(subTestIndex));
101         OutputAnalyzer output = ProcessTools.executeProcess(pb);
102         System.out.println(output.getOutput());
103         int exitCode = output.getExitValue();
104         System.out.println(&quot;Exit code: &quot; + exitCode);
105 
<span class="line-modified">106         String recordingName = output.firstMatch(&quot;emergency jfr file: (.*.jfr)&quot;, 1);</span>
107         if (recordingName == null) {
108             recordingName = &quot;./dumped.jfr&quot;;
109         }
110 
111         List&lt;RecordedEvent&gt; events = RecordingFile.readAllEvents(Paths.get(recordingName));
112         List&lt;RecordedEvent&gt; filteredEvents = events.stream()
113             .filter(e -&gt; e.getEventType().getName().equals(EventNames.Shutdown))
114             .sorted(Comparator.comparing(RecordedEvent::getStartTime))
115             .collect(Collectors.toList());
116 
117         Asserts.assertEquals(filteredEvents.size(), 1);
118         RecordedEvent event = filteredEvents.get(0);
119         subTests[subTestIndex].verifyEvents(event, exitCode);
120     }
121 
122     @SuppressWarnings(&quot;unused&quot;)
123     private static class TestMain {
124         public static void main(String[] args) throws Exception {
125             ShutdownEventSubTest subTest = subTests[Integer.parseInt(args[0])];
126             System.out.println(&quot;Running subtest &quot; + args[0] + &quot; (&quot; + subTest.getClass().getName() + &quot;)&quot;);
</pre>
</td>
<td>
<hr />
<pre>
 86                     return;
 87                 }
 88             }
 89             runSubtest(i);
 90         }
 91     }
 92 
 93     private static void runSubtest(int subTestIndex) throws Exception {
 94         ProcessBuilder pb = ProcessTools.createTestJvm(
 95                                 &quot;-Xlog:jfr=debug&quot;,
 96                                 &quot;-XX:-CreateCoredumpOnCrash&quot;,
 97                                 &quot;--add-exports=java.base/jdk.internal.misc=ALL-UNNAMED&quot;,
 98                                 &quot;-XX:StartFlightRecording=filename=./dumped.jfr,dumponexit=true,settings=default&quot;,
 99                                 &quot;jdk.jfr.event.runtime.TestShutdownEvent$TestMain&quot;,
100                                 String.valueOf(subTestIndex));
101         OutputAnalyzer output = ProcessTools.executeProcess(pb);
102         System.out.println(output.getOutput());
103         int exitCode = output.getExitValue();
104         System.out.println(&quot;Exit code: &quot; + exitCode);
105 
<span class="line-modified">106         String recordingName = output.firstMatch(&quot;JFR recording file will be written. Location: (.*.jfr)&quot;, 1);</span>
107         if (recordingName == null) {
108             recordingName = &quot;./dumped.jfr&quot;;
109         }
110 
111         List&lt;RecordedEvent&gt; events = RecordingFile.readAllEvents(Paths.get(recordingName));
112         List&lt;RecordedEvent&gt; filteredEvents = events.stream()
113             .filter(e -&gt; e.getEventType().getName().equals(EventNames.Shutdown))
114             .sorted(Comparator.comparing(RecordedEvent::getStartTime))
115             .collect(Collectors.toList());
116 
117         Asserts.assertEquals(filteredEvents.size(), 1);
118         RecordedEvent event = filteredEvents.get(0);
119         subTests[subTestIndex].verifyEvents(event, exitCode);
120     }
121 
122     @SuppressWarnings(&quot;unused&quot;)
123     private static class TestMain {
124         public static void main(String[] args) throws Exception {
125             ShutdownEventSubTest subTest = subTests[Integer.parseInt(args[0])];
126             System.out.println(&quot;Running subtest &quot; + args[0] + &quot; (&quot; + subTest.getClass().getName() + &quot;)&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../../../../javax/xml/jaxp/common/8035437/org/w3c/dom/Node.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../lib/testlibrary/java/lang/UCDFiles.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>