<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/net/DatagramSocketImpl/TestCreate.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../DatagramSocket/UnreferencedDatagramSockets.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../InetAddress/CheckJNI.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/net/DatagramSocketImpl/TestCreate.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 43 import java.util.Iterator;
 44 import java.util.List;
 45 import java.util.Set;
 46 import java.util.concurrent.atomic.AtomicBoolean;
 47 import static org.testng.Assert.assertTrue;
 48 
 49 public class TestCreate {
 50 
 51     @Test
 52     public void datagramSocketImpl() throws IOException {
 53         CustomDatagramSocketImpl dsi = new CustomDatagramSocketImpl();
 54         CustomDatagramSocket ds = new CustomDatagramSocket(dsi);
 55         ds.bind(new InetSocketAddress(0));
 56         assertTrue(dsi.created.get(), &quot;new CustomDatagramSocket(dsi)&quot;);
 57 
 58         CustomDatagramSocketImpl dsi2 = new CustomDatagramSocketImpl();
 59         CustomDatagramSocketImpl dsi3 = new CustomDatagramSocketImpl();
 60         Iterator&lt;CustomDatagramSocketImpl&gt; iterator = List.of(dsi2, dsi3).iterator();
 61         DatagramSocket.setDatagramSocketImplFactory(() -&gt; iterator.next());
 62 
<span class="line-modified"> 63         DatagramSocket ds2 = new DatagramSocket();</span>
 64         assertTrue(dsi2.created.get(), &quot;new DatagramSocket()&quot;);
 65 
<span class="line-modified"> 66         MulticastSocket ds3 = new MulticastSocket();</span>
 67         assertTrue(dsi3.created.get(), &quot;new MulticastSocket()&quot;);
 68     }
 69 
 70     static class CustomDatagramSocket extends DatagramSocket {
 71         CustomDatagramSocket(DatagramSocketImpl impl) {
 72             super(impl);
 73         }
 74     }
 75 
 76     // A DatagramSocketImpl that delegates the three new-style socket option
 77     // methods to the default java.net.DatagramSocketImpl implementation.
 78     static class CustomDatagramSocketImpl extends DatagramSocketImpl {
 79 
 80         final AtomicBoolean created = new AtomicBoolean(false);
 81 
 82         @Override
 83         public &lt;T&gt; void setOption(SocketOption&lt;T&gt; name, T value) throws IOException {
 84             super.setOption(name, value);
 85         }
 86 
</pre>
</td>
<td>
<hr />
<pre>
 43 import java.util.Iterator;
 44 import java.util.List;
 45 import java.util.Set;
 46 import java.util.concurrent.atomic.AtomicBoolean;
 47 import static org.testng.Assert.assertTrue;
 48 
 49 public class TestCreate {
 50 
 51     @Test
 52     public void datagramSocketImpl() throws IOException {
 53         CustomDatagramSocketImpl dsi = new CustomDatagramSocketImpl();
 54         CustomDatagramSocket ds = new CustomDatagramSocket(dsi);
 55         ds.bind(new InetSocketAddress(0));
 56         assertTrue(dsi.created.get(), &quot;new CustomDatagramSocket(dsi)&quot;);
 57 
 58         CustomDatagramSocketImpl dsi2 = new CustomDatagramSocketImpl();
 59         CustomDatagramSocketImpl dsi3 = new CustomDatagramSocketImpl();
 60         Iterator&lt;CustomDatagramSocketImpl&gt; iterator = List.of(dsi2, dsi3).iterator();
 61         DatagramSocket.setDatagramSocketImplFactory(() -&gt; iterator.next());
 62 
<span class="line-modified"> 63         DatagramSocket ds2 = new DatagramSocket(null);</span>
 64         assertTrue(dsi2.created.get(), &quot;new DatagramSocket()&quot;);
 65 
<span class="line-modified"> 66         MulticastSocket ds3 = new MulticastSocket(null);</span>
 67         assertTrue(dsi3.created.get(), &quot;new MulticastSocket()&quot;);
 68     }
 69 
 70     static class CustomDatagramSocket extends DatagramSocket {
 71         CustomDatagramSocket(DatagramSocketImpl impl) {
 72             super(impl);
 73         }
 74     }
 75 
 76     // A DatagramSocketImpl that delegates the three new-style socket option
 77     // methods to the default java.net.DatagramSocketImpl implementation.
 78     static class CustomDatagramSocketImpl extends DatagramSocketImpl {
 79 
 80         final AtomicBoolean created = new AtomicBoolean(false);
 81 
 82         @Override
 83         public &lt;T&gt; void setOption(SocketOption&lt;T&gt; name, T value) throws IOException {
 84             super.setOption(name, value);
 85         }
 86 
</pre>
</td>
</tr>
</table>
<center><a href="../DatagramSocket/UnreferencedDatagramSockets.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../InetAddress/CheckJNI.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>