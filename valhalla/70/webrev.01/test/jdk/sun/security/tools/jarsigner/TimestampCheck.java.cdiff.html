<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/sun/security/tools/jarsigner/TimestampCheck.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../pkcs12/ParamsTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../keytool/KeyToolTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/security/tools/jarsigner/TimestampCheck.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 61,10 ***</span>
<span class="line-new-header">--- 61,11 ---</span>
  import sun.security.x509.X500Name;
  
  /*
   * @test
   * @bug 6543842 6543440 6939248 8009636 8024302 8163304 8169911 8180289 8172404
<span class="line-added">+  *          8242151</span>
   * @summary checking response of timestamp
   * @modules java.base/sun.security.pkcs
   *          java.base/sun.security.timestamp
   *          java.base/sun.security.x509
   *          java.base/sun.security.util
</pre>
<hr />
<pre>
<span class="line-old-header">*** 132,11 ***</span>
              DerValue messageImprint = value.data.getDerValue();
              AlgorithmId aid = AlgorithmId.parse(
                      messageImprint.data.getDerValue());
              System.out.println(&quot;# AlgorithmId: &quot; + aid);
  
<span class="line-modified">!             ObjectIdentifier policyId = new ObjectIdentifier(defaultPolicyId);</span>
              BigInteger nonce = null;
              while (value.data.available() &gt; 0) {
                  DerValue v = value.data.getDerValue();
                  if (v.tag == DerValue.tag_Integer) {
                      nonce = v.getBigInteger();
<span class="line-new-header">--- 133,11 ---</span>
              DerValue messageImprint = value.data.getDerValue();
              AlgorithmId aid = AlgorithmId.parse(
                      messageImprint.data.getDerValue());
              System.out.println(&quot;# AlgorithmId: &quot; + aid);
  
<span class="line-modified">!             ObjectIdentifier policyId = ObjectIdentifier.of(defaultPolicyId);</span>
              BigInteger nonce = null;
              while (value.data.available() &gt; 0) {
                  DerValue v = value.data.getDerValue();
                  if (v.tag == DerValue.tag_Integer) {
                      nonce = v.getBigInteger();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 156,11 ***</span>
              // If path starts with &quot;ts&quot;, use the TSA it points to.
              // Otherwise, always use &quot;ts&quot;.
              String alias = path.startsWith(&quot;ts&quot;) ? path : &quot;ts&quot;;
  
              if (path.equals(&quot;diffpolicy&quot;)) {
<span class="line-modified">!                 policyId = new ObjectIdentifier(defaultPolicyId);</span>
              }
  
              DerOutputStream statusInfo = new DerOutputStream();
              statusInfo.putInteger(0);
  
<span class="line-new-header">--- 157,11 ---</span>
              // If path starts with &quot;ts&quot;, use the TSA it points to.
              // Otherwise, always use &quot;ts&quot;.
              String alias = path.startsWith(&quot;ts&quot;) ? path : &quot;ts&quot;;
  
              if (path.equals(&quot;diffpolicy&quot;)) {
<span class="line-modified">!                 policyId = ObjectIdentifier.of(defaultPolicyId);</span>
              }
  
              DerOutputStream statusInfo = new DerOutputStream();
              statusInfo.putInteger(0);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 228,11 ***</span>
              Signature sig = Signature.getInstance(sigAlg);
              sig.initSign((PrivateKey)(ks.getKey(
                      alias, &quot;changeit&quot;.toCharArray())));
              sig.update(tstInfo.toByteArray());
  
<span class="line-modified">!             ContentInfo contentInfo = new ContentInfo(new ObjectIdentifier(</span>
                      &quot;1.2.840.113549.1.9.16.1.4&quot;),
                      new DerValue(tstInfo2.toByteArray()));
  
              System.out.println(&quot;# Signing...&quot;);
              System.out.println(&quot;# &quot; + new X500Name(signer
<span class="line-new-header">--- 229,11 ---</span>
              Signature sig = Signature.getInstance(sigAlg);
              sig.initSign((PrivateKey)(ks.getKey(
                      alias, &quot;changeit&quot;.toCharArray())));
              sig.update(tstInfo.toByteArray());
  
<span class="line-modified">!             ContentInfo contentInfo = new ContentInfo(ObjectIdentifier.of(</span>
                      &quot;1.2.840.113549.1.9.16.1.4&quot;),
                      new DerValue(tstInfo2.toByteArray()));
  
              System.out.println(&quot;# Signing...&quot;);
              System.out.println(&quot;# &quot; + new X500Name(signer
</pre>
<hr />
<pre>
<span class="line-old-header">*** 443,11 ***</span>
                          .shouldMatch(&quot;SHA-1.*-tsadigestalg.*will be disabled&quot;)
                          .shouldNotContain(&quot;is disabled&quot;);
                  verify(&quot;sha1tsaalg.jar&quot;, &quot;-strict&quot;)
                          .shouldHaveExitValue(0)
                          .shouldContain(&quot;jar verified, with signer errors&quot;)
<span class="line-modified">!                         .shouldContain(&quot;SHA-1 digest algorithm is considered a security risk&quot;)</span>
                          .shouldNotContain(&quot;is disabled&quot;);
  
                  // Disabled algorithms
                  sign(&quot;tsdisabled&quot;, &quot;-digestalg&quot;, &quot;MD5&quot;,
                                  &quot;-sigalg&quot;, &quot;MD5withRSA&quot;, &quot;-tsadigestalg&quot;, &quot;MD5&quot;)
<span class="line-new-header">--- 444,11 ---</span>
                          .shouldMatch(&quot;SHA-1.*-tsadigestalg.*will be disabled&quot;)
                          .shouldNotContain(&quot;is disabled&quot;);
                  verify(&quot;sha1tsaalg.jar&quot;, &quot;-strict&quot;)
                          .shouldHaveExitValue(0)
                          .shouldContain(&quot;jar verified, with signer errors&quot;)
<span class="line-modified">!                         .shouldContain(&quot;SHA-1 timestamp digest algorithm is considered a security risk&quot;)</span>
                          .shouldNotContain(&quot;is disabled&quot;);
  
                  // Disabled algorithms
                  sign(&quot;tsdisabled&quot;, &quot;-digestalg&quot;, &quot;MD5&quot;,
                                  &quot;-sigalg&quot;, &quot;MD5withRSA&quot;, &quot;-tsadigestalg&quot;, &quot;MD5&quot;)
</pre>
<center><a href="../../pkcs12/ParamsTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../keytool/KeyToolTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>