<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/langtools/tools/javac/versions/Versions.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../records/VarargsRecordsTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../lib/jdk/test/lib/Convert.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/versions/Versions.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2014, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 21,11 ***</span>
   * questions.
   */
  
  /*
   * @test
<span class="line-modified">!  * @bug 4981566 5028634 5094412 6304984 7025786 7025789 8001112 8028545 8000961 8030610 8028546 8188870 8173382 8173382 8193290 8205619 8028563</span>
   * @summary Check interpretation of -target and -source options
   * @modules java.compiler
   *          jdk.compiler
   * @run main Versions
   */
<span class="line-new-header">--- 21,11 ---</span>
   * questions.
   */
  
  /*
   * @test
<span class="line-modified">!  * @bug 4981566 5028634 5094412 6304984 7025786 7025789 8001112 8028545 8000961 8030610 8028546 8188870 8173382 8173382 8193290 8205619 8028563 8245147</span>
   * @summary Check interpretation of -target and -source options
   * @modules java.compiler
   *          jdk.compiler
   * @run main Versions
   */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 41,10 ***</span>
<span class="line-new-header">--- 41,11 ---</span>
  import java.util.List;
  import java.util.ArrayList;
  import java.util.Arrays;
  import java.util.Set;
  import java.util.function.BiConsumer;
<span class="line-added">+ import java.util.function.Consumer;</span>
  
  /*
   * If not explicitly specified the latest source and latest target
   * values are the defaults. If explicitly specified, the target value
   * has to be greater than or equal to the source value.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 72,34 ***</span>
          Set.of(&quot;1.7&quot;, &quot;1.8&quot;, &quot;1.9&quot;, &quot;1.10&quot;, &quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;);
  
      public static final String LATEST_MAJOR_VERSION = &quot;59.0&quot;;
  
      static enum SourceTarget {
<span class="line-modified">!         SEVEN(true,   &quot;51.0&quot;,  &quot;7&quot;, Versions::checksrc17),</span>
<span class="line-modified">!         EIGHT(true,   &quot;52.0&quot;,  &quot;8&quot;, Versions::checksrc18),</span>
<span class="line-modified">!         NINE(true,    &quot;53.0&quot;,  &quot;9&quot;, Versions::checksrc19),</span>
<span class="line-modified">!         TEN(true,     &quot;54.0&quot;, &quot;10&quot;, Versions::checksrc110),</span>
<span class="line-modified">!         ELEVEN(false, &quot;55.0&quot;, &quot;11&quot;, Versions::checksrc111),</span>
<span class="line-modified">!         TWELVE(false, &quot;56.0&quot;, &quot;12&quot;, Versions::checksrc112),</span>
<span class="line-modified">!         THIRTEEN(false, &quot;57.0&quot;, &quot;13&quot;, Versions::checksrc113),</span>
<span class="line-modified">!         FOURTEEN(false, &quot;58.0&quot;, &quot;14&quot;, Versions::checksrc114),</span>
<span class="line-modified">!         FIFTEEN(false,  &quot;59.0&quot;, &quot;15&quot;, Versions::checksrc115);</span>
  
          private final boolean dotOne;
          private final String classFileVer;
          private final String target;
<span class="line-modified">!         private final BiConsumer&lt;Versions, String[]&gt; checker;</span>
  
          private SourceTarget(boolean dotOne, String classFileVer, String target,
<span class="line-modified">!                              BiConsumer&lt;Versions, String[]&gt; checker) {</span>
              this.dotOne = dotOne;
              this.classFileVer = classFileVer;
              this.target = target;
              this.checker = checker;
          }
  
<span class="line-modified">!         public void checksrc(Versions version, String... args) {</span>
              checker.accept(version, args);
          }
  
          public boolean dotOne() {
              return dotOne;
<span class="line-new-header">--- 73,34 ---</span>
          Set.of(&quot;1.7&quot;, &quot;1.8&quot;, &quot;1.9&quot;, &quot;1.10&quot;, &quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;);
  
      public static final String LATEST_MAJOR_VERSION = &quot;59.0&quot;;
  
      static enum SourceTarget {
<span class="line-modified">!         SEVEN(true,   &quot;51.0&quot;,  &quot;7&quot;, Versions::checksrc7),</span>
<span class="line-modified">!         EIGHT(true,   &quot;52.0&quot;,  &quot;8&quot;, Versions::checksrc8),</span>
<span class="line-modified">!         NINE(true,    &quot;53.0&quot;,  &quot;9&quot;, Versions::checksrc9),</span>
<span class="line-modified">!         TEN(true,     &quot;54.0&quot;, &quot;10&quot;, Versions::checksrc10),</span>
<span class="line-modified">!         ELEVEN(false, &quot;55.0&quot;, &quot;11&quot;, Versions::checksrc11),</span>
<span class="line-modified">!         TWELVE(false, &quot;56.0&quot;, &quot;12&quot;, Versions::checksrc12),</span>
<span class="line-modified">!         THIRTEEN(false, &quot;57.0&quot;, &quot;13&quot;, Versions::checksrc13),</span>
<span class="line-modified">!         FOURTEEN(false, &quot;58.0&quot;, &quot;14&quot;, Versions::checksrc14),</span>
<span class="line-modified">!         FIFTEEN(false,  &quot;59.0&quot;, &quot;15&quot;, Versions::checksrc15);</span>
  
          private final boolean dotOne;
          private final String classFileVer;
          private final String target;
<span class="line-modified">!         private final BiConsumer&lt;Versions, List&lt;String&gt;&gt; checker;</span>
  
          private SourceTarget(boolean dotOne, String classFileVer, String target,
<span class="line-modified">!                              BiConsumer&lt;Versions, List&lt;String&gt;&gt; checker) {</span>
              this.dotOne = dotOne;
              this.classFileVer = classFileVer;
              this.target = target;
              this.checker = checker;
          }
  
<span class="line-modified">!         public void checksrc(Versions version, List&lt;String&gt; args) {</span>
              checker.accept(version, args);
          }
  
          public boolean dotOne() {
              return dotOne;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 118,11 ***</span>
          String TC = &quot;&quot;;
          System.out.println(&quot;Version.java: Starting&quot;);
  
          check(LATEST_MAJOR_VERSION);
          for (String source : VALID_SOURCES) {
<span class="line-modified">!             check(LATEST_MAJOR_VERSION, &quot;-source &quot; + source);</span>
          }
  
          // Verify that a -source value less than a -target value is
          // accepted and that the resulting class files are dependent
          // on the target setting alone.
<span class="line-new-header">--- 119,11 ---</span>
          String TC = &quot;&quot;;
          System.out.println(&quot;Version.java: Starting&quot;);
  
          check(LATEST_MAJOR_VERSION);
          for (String source : VALID_SOURCES) {
<span class="line-modified">!             check(LATEST_MAJOR_VERSION, List.of(&quot;-source &quot; + source));</span>
          }
  
          // Verify that a -source value less than a -target value is
          // accepted and that the resulting class files are dependent
          // on the target setting alone.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 130,35 ***</span>
          for (int i = 0; i &lt; sourceTargets.length; i++) {
              SourceTarget st = sourceTargets[i];
              String classFileVer = st.classFileVer();
              String target = st.target();
              boolean dotOne = st.dotOne();
<span class="line-modified">!             check_source_target(dotOne, classFileVer, target, target);</span>
              for (int j = i; j &gt; 0; j--) {
                  String source = sourceTargets[j].target();
<span class="line-modified">!                 check_source_target(dotOne, classFileVer, source, target);</span>
              }
          }
  
          // Verify acceptance of different combinations of -source N,
          // -target M; N &lt;= M
          for (int i = 0; i &lt; sourceTargets.length; i++) {
              SourceTarget st = sourceTargets[i];
  
<span class="line-modified">!             st.checksrc(this, &quot;-source &quot; + st.target());</span>
<span class="line-modified">!             st.checksrc(this, &quot;-source &quot; + st.target(), &quot;-target &quot; + st.target());</span>
  
              if (st.dotOne()) {
<span class="line-modified">!                 st.checksrc(this, &quot;-source 1.&quot; + st.target());</span>
<span class="line-modified">!                 st.checksrc(this, &quot;-source 1.&quot; + st.target(), &quot;-target 1.&quot; + st.target());</span>
              }
  
              if (i == sourceTargets.length) {
                  // Can use -target without -source setting only for
                  // most recent target since the most recent source is
                  // the default.
<span class="line-modified">!                 st.checksrc(this, &quot;-target &quot; + st.target());</span>
  
                  if (!st.classFileVer().equals(LATEST_MAJOR_VERSION)) {
                      throw new RuntimeException(st +
                                                 &quot;does not have class file version&quot; +
                                                 LATEST_MAJOR_VERSION);
<span class="line-new-header">--- 131,35 ---</span>
          for (int i = 0; i &lt; sourceTargets.length; i++) {
              SourceTarget st = sourceTargets[i];
              String classFileVer = st.classFileVer();
              String target = st.target();
              boolean dotOne = st.dotOne();
<span class="line-modified">!             check_source_target(dotOne, List.of(classFileVer, target, target));</span>
              for (int j = i; j &gt; 0; j--) {
                  String source = sourceTargets[j].target();
<span class="line-modified">!                 check_source_target(dotOne, List.of(classFileVer, source, target));</span>
              }
          }
  
          // Verify acceptance of different combinations of -source N,
          // -target M; N &lt;= M
          for (int i = 0; i &lt; sourceTargets.length; i++) {
              SourceTarget st = sourceTargets[i];
  
<span class="line-modified">!             st.checksrc(this, List.of(&quot;-source &quot; + st.target()));</span>
<span class="line-modified">!             st.checksrc(this, List.of(&quot;-source &quot; + st.target(), &quot;-target &quot; + st.target()));</span>
  
              if (st.dotOne()) {
<span class="line-modified">!                 st.checksrc(this, List.of(&quot;-source 1.&quot; + st.target()));</span>
<span class="line-modified">!                 st.checksrc(this, List.of(&quot;-source 1.&quot; + st.target(), &quot;-target 1.&quot; + st.target()));</span>
              }
  
              if (i == sourceTargets.length) {
                  // Can use -target without -source setting only for
                  // most recent target since the most recent source is
                  // the default.
<span class="line-modified">!                 st.checksrc(this, List.of(&quot;-target &quot; + st.target()));</span>
  
                  if (!st.classFileVer().equals(LATEST_MAJOR_VERSION)) {
                      throw new RuntimeException(st +
                                                 &quot;does not have class file version&quot; +
                                                 LATEST_MAJOR_VERSION);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 166,51 ***</span>
              }
          }
  
          // Verify that -source N -target (N-1) is rejected
          for (int i = 1 /* Skip zeroth value */; i &lt; sourceTargets.length; i++) {
<span class="line-modified">!             fail(&quot;-source &quot; + sourceTargets[i].target(),</span>
                   &quot;-target &quot; + sourceTargets[i-1].target(),
<span class="line-modified">!                  &quot;Base.java&quot;);</span>
          }
  
          // Previously supported source/target values
          for (String source  : RETIRED_SOURCES) {
<span class="line-modified">!             fail(&quot;-source &quot; + source, &quot;-target &quot; + source, &quot;Base.java&quot;);</span>
          }
  
          if (failedCases &gt; 0) {
              System.err.println(&quot;failedCases = &quot; + String.valueOf(failedCases));
              throw new Error(&quot;Test failed&quot;);
          }
  
      }
  
<span class="line-modified">!     protected void printargs(String fname,String... args) {</span>
          System.out.printf(&quot;test: %s&quot;, fname);
          for (String onearg : args) {
              System.out.printf(&quot; %s&quot;, onearg);
          }
          System.out.printf(&quot;\n&quot;, fname);
      }
  
<span class="line-modified">!     protected void check_source_target(boolean dotOne, String... args) {</span>
          printargs(&quot;check_source_target&quot;, args);
<span class="line-modified">!         check_target(dotOne, args[0], args[1], args[2]);</span>
          if (dotOne) {
<span class="line-modified">!             check_target(dotOne, args[0], &quot;1.&quot; + args[1], args[2]);</span>
          }
      }
  
<span class="line-modified">!     protected void check_target(boolean dotOne, String... args) {</span>
<span class="line-modified">!         check(args[0], &quot;-source &quot; + args[1], &quot;-target &quot; + args[2]);</span>
          if (dotOne) {
<span class="line-modified">!             check(args[0], &quot;-source &quot; + args[1], &quot;-target 1.&quot; + args[2]);</span>
          }
      }
  
<span class="line-modified">!     protected void check(String major, String... args) {</span>
          printargs(&quot;check&quot;, args);
          List&lt;String&gt; jcargs = new ArrayList&lt;&gt;();
          jcargs.add(&quot;-Xlint:-options&quot;);
  
          // add in args conforming to List requrements of JavaCompiler
<span class="line-new-header">--- 167,55 ---</span>
              }
          }
  
          // Verify that -source N -target (N-1) is rejected
          for (int i = 1 /* Skip zeroth value */; i &lt; sourceTargets.length; i++) {
<span class="line-modified">!             fail(List.of(&quot;-source &quot; + sourceTargets[i].target(),</span>
                   &quot;-target &quot; + sourceTargets[i-1].target(),
<span class="line-modified">!                          &quot;Base.java&quot;));</span>
          }
  
          // Previously supported source/target values
          for (String source  : RETIRED_SOURCES) {
<span class="line-modified">!             fail(List.of(&quot;-source &quot; + source, &quot;-target &quot; + source, &quot;Base.java&quot;));</span>
          }
  
          if (failedCases &gt; 0) {
              System.err.println(&quot;failedCases = &quot; + String.valueOf(failedCases));
              throw new Error(&quot;Test failed&quot;);
          }
  
      }
  
<span class="line-modified">!     protected void printargs(String fname, List&lt;String&gt; args) {</span>
          System.out.printf(&quot;test: %s&quot;, fname);
          for (String onearg : args) {
              System.out.printf(&quot; %s&quot;, onearg);
          }
          System.out.printf(&quot;\n&quot;, fname);
      }
  
<span class="line-modified">!     protected void check_source_target(boolean dotOne, List&lt;String&gt; args) {</span>
          printargs(&quot;check_source_target&quot;, args);
<span class="line-modified">!         check_target(dotOne, List.of(args.get(0), args.get(1), args.get(2)));</span>
          if (dotOne) {
<span class="line-modified">!             check_target(dotOne, List.of(args.get(0), &quot;1.&quot; + args.get(1), args.get(2)));</span>
          }
      }
  
<span class="line-modified">!     protected void check_target(boolean dotOne, List&lt;String&gt; args) {</span>
<span class="line-modified">!         check(args.get(0), List.of(&quot;-source &quot; + args.get(1), &quot;-target &quot; + args.get(2)));</span>
          if (dotOne) {
<span class="line-modified">!             check(args.get(0), List.of(&quot;-source &quot; + args.get(1), &quot;-target 1.&quot; + args.get(2)));</span>
          }
      }
  
<span class="line-modified">!     protected void check(String major) {</span>
<span class="line-added">+         check(major, List.of());</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     protected void check(String major, List&lt;String&gt; args) {</span>
          printargs(&quot;check&quot;, args);
          List&lt;String&gt; jcargs = new ArrayList&lt;&gt;();
          jcargs.add(&quot;-Xlint:-options&quot;);
  
          // add in args conforming to List requrements of JavaCompiler
</pre>
<hr />
<pre>
<span class="line-old-header">*** 232,91 ***</span>
          } else if (!checkClassFileVersion(&quot;Base.class&quot;, major)) {
              failedCases++;
          }
      }
  
<span class="line-modified">!     protected void checksrc17(String... args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc17&quot;, args);</span>
<span class="line-modified">!         int asize = args.length;</span>
<span class="line-modified">!         String[] newargs = new String[asize+1];</span>
<span class="line-modified">!         System.arraycopy(args, 0, newargs,0 , asize);</span>
<span class="line-modified">!         newargs[asize] = &quot;New17.java&quot;;</span>
<span class="line-modified">!         pass(newargs);</span>
<span class="line-modified">!         newargs[asize] = &quot;New18.java&quot;;</span>
<span class="line-modified">!         fail(newargs);</span>
      }
  
<span class="line-modified">!     protected void checksrc18(String... args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc18&quot;, args);</span>
<span class="line-modified">!         int asize = args.length;</span>
<span class="line-modified">!         String[] newargs = new String[asize+1];</span>
<span class="line-removed">-         System.arraycopy(args, 0, newargs,0 , asize);</span>
<span class="line-removed">-         newargs[asize] = &quot;New17.java&quot;;</span>
<span class="line-removed">-         pass(newargs);</span>
<span class="line-removed">-         newargs[asize] = &quot;New18.java&quot;;</span>
<span class="line-removed">-         pass(newargs);</span>
<span class="line-removed">-         newargs[asize] = &quot;New110.java&quot;;</span>
<span class="line-removed">-         fail(newargs);</span>
      }
  
<span class="line-modified">!     protected void checksrc19(String... args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc19&quot;, args);</span>
<span class="line-modified">!         checksrc18(args);</span>
      }
  
<span class="line-modified">!     protected void checksrc110(String... args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc110&quot;, args);</span>
<span class="line-modified">!         int asize = args.length;</span>
<span class="line-modified">!         String[] newargs = new String[asize+1];</span>
<span class="line-removed">-         System.arraycopy(args, 0, newargs,0 , asize);</span>
<span class="line-removed">-         newargs[asize] = &quot;New17.java&quot;;</span>
<span class="line-removed">-         pass(newargs);</span>
<span class="line-removed">-         newargs[asize] = &quot;New18.java&quot;;</span>
<span class="line-removed">-         pass(newargs);</span>
<span class="line-removed">-         newargs[asize] = &quot;New110.java&quot;;</span>
<span class="line-removed">-         pass(newargs);</span>
      }
  
<span class="line-modified">!     protected void checksrc111(String... args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc111&quot;, args);</span>
<span class="line-modified">!         int asize = args.length;</span>
<span class="line-modified">!         String[] newargs = new String[asize+1];</span>
<span class="line-modified">!         System.arraycopy(args, 0, newargs,0 , asize);</span>
<span class="line-removed">-         newargs[asize] = &quot;New17.java&quot;;</span>
<span class="line-removed">-         pass(newargs);</span>
<span class="line-removed">-         newargs[asize] = &quot;New18.java&quot;;</span>
<span class="line-removed">-         pass(newargs);</span>
<span class="line-removed">-         newargs[asize] = &quot;New110.java&quot;;</span>
<span class="line-removed">-         pass(newargs);</span>
<span class="line-removed">-         newargs[asize] = &quot;New111.java&quot;;</span>
<span class="line-removed">-         pass(newargs);</span>
      }
  
<span class="line-modified">!     protected void checksrc112(String... args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc112&quot;, args);</span>
<span class="line-modified">!         checksrc111(args);</span>
      }
  
<span class="line-modified">!     protected void checksrc113(String... args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc113&quot;, args);</span>
<span class="line-modified">!         checksrc111(args);</span>
      }
  
<span class="line-modified">!     protected void checksrc114(String... args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc114&quot;, args);</span>
<span class="line-removed">-         checksrc111(args);</span>
      }
  
<span class="line-modified">!     protected void checksrc115(String... args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc115&quot;, args);</span>
<span class="line-removed">-         checksrc111(args);</span>
      }
  
<span class="line-modified">!     protected void pass(String... args) {</span>
          printargs(&quot;pass&quot;, args);
  
<span class="line-modified">!         List&lt;String&gt; jcargs = new ArrayList&lt;String&gt;();</span>
          jcargs.add(&quot;-Xlint:-options&quot;);
  
          // add in args conforming to List requrements of JavaCompiler
          for (String onearg : args) {
              String[] fields = onearg.split(&quot; &quot;);
<span class="line-new-header">--- 237,89 ---</span>
          } else if (!checkClassFileVersion(&quot;Base.class&quot;, major)) {
              failedCases++;
          }
      }
  
<span class="line-modified">!     protected void checksrc7(List&lt;String&gt; args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc7&quot;, args);</span>
<span class="line-modified">!         expectedPass(args, List.of(&quot;New7.java&quot;));</span>
<span class="line-modified">!         expectedFail(args, List.of(&quot;New8.java&quot;));</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     protected void checksrc8(List&lt;String&gt; args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc8&quot;, args);</span>
<span class="line-modified">!         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;));</span>
<span class="line-added">+         expectedFail(args, List.of(&quot;New10.java&quot;));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     protected void checksrc9(List&lt;String&gt; args) {</span>
<span class="line-added">+         printargs(&quot;checksrc9&quot;, args);</span>
<span class="line-added">+         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;));</span>
<span class="line-added">+         expectedFail(args, List.of(&quot;New10.java&quot;));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     protected void checksrc10(List&lt;String&gt; args) {</span>
<span class="line-added">+         printargs(&quot;checksrc10&quot;, args);</span>
<span class="line-added">+         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;));</span>
<span class="line-added">+         expectedFail(args, List.of(&quot;New11.java&quot;));</span>
      }
  
<span class="line-modified">!     protected void checksrc11(List&lt;String&gt; args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc11&quot;, args);</span>
<span class="line-modified">!         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;));</span>
<span class="line-modified">!         expectedFail(args, List.of(&quot;New14.java&quot;));</span>
      }
  
<span class="line-modified">!     protected void checksrc12(List&lt;String&gt; args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc12&quot;, args);</span>
<span class="line-modified">!         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;));</span>
<span class="line-added">+         expectedFail(args, List.of(&quot;New14.java&quot;));</span>
      }
  
<span class="line-modified">!     protected void checksrc13(List&lt;String&gt; args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc13&quot;, args);</span>
<span class="line-modified">!         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;));</span>
<span class="line-modified">!         expectedFail(args, List.of(&quot;New14.java&quot;));</span>
      }
  
<span class="line-modified">!     protected void checksrc14(List&lt;String&gt; args) {</span>
<span class="line-modified">!         printargs(&quot;checksrc14&quot;, args);</span>
<span class="line-modified">!         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;,</span>
<span class="line-modified">!                                    &quot;New14.java&quot;));</span>
<span class="line-modified">!         expectedFail(args, List.of(&quot;New15.java&quot;));</span>
      }
  
<span class="line-modified">!    protected void checksrc15(List&lt;String&gt; args) {</span>
<span class="line-modified">!        printargs(&quot;checksrc15&quot;, args);</span>
<span class="line-modified">!        expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;,</span>
<span class="line-added">+                                   &quot;New14.java&quot;, &quot;New15.java&quot;));</span>
<span class="line-added">+        // Add expectedFail after new language features added in a later release.</span>
      }
  
<span class="line-modified">!     protected void expected(List&lt;String&gt; args, List&lt;String&gt; fileNames,</span>
<span class="line-modified">!                             Consumer&lt;List&lt;String&gt;&gt; passOrFail) {</span>
<span class="line-modified">!         ArrayList&lt;String&gt; fullArguments = new ArrayList&lt;&gt;(args);</span>
<span class="line-added">+         // Issue compile with each filename in turn.</span>
<span class="line-added">+         for(String fileName : fileNames) {</span>
<span class="line-added">+             fullArguments.add(fileName);</span>
<span class="line-added">+             passOrFail.accept(fullArguments);</span>
<span class="line-added">+             fullArguments.remove(fullArguments.size() - 1);</span>
<span class="line-added">+         }</span>
      }
  
<span class="line-modified">!     protected void expectedPass(List&lt;String&gt; args, List&lt;String&gt; fileNames) {</span>
<span class="line-modified">!         expected(args, fileNames, this::pass);</span>
      }
  
<span class="line-modified">!     protected void expectedFail(List&lt;String&gt; args, List&lt;String&gt; fileNames) {</span>
<span class="line-modified">!         expected(args, fileNames, this::fail);</span>
      }
  
<span class="line-modified">!     protected void pass(List&lt;String&gt; args) {</span>
          printargs(&quot;pass&quot;, args);
  
<span class="line-modified">!         List&lt;String&gt; jcargs = new ArrayList&lt;&gt;();</span>
          jcargs.add(&quot;-Xlint:-options&quot;);
  
          // add in args conforming to List requrements of JavaCompiler
          for (String onearg : args) {
              String[] fields = onearg.split(&quot; &quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 347,14 ***</span>
  
          }
  
      }
  
<span class="line-modified">!     protected void fail(String... args) {</span>
          printargs(&quot;fail&quot;, args);
  
<span class="line-modified">!         List&lt;String&gt; jcargs = new ArrayList&lt;String&gt;();</span>
          jcargs.add(&quot;-Xlint:-options&quot;);
  
          // add in args conforming to List requrements of JavaCompiler
          for (String onearg : args) {
              String[] fields = onearg.split(&quot; &quot;);
<span class="line-new-header">--- 350,14 ---</span>
  
          }
  
      }
  
<span class="line-modified">!     protected void fail(List&lt;String&gt; args) {</span>
          printargs(&quot;fail&quot;, args);
  
<span class="line-modified">!         List&lt;String&gt; jcargs = new ArrayList&lt;&gt;();</span>
          jcargs.add(&quot;-Xlint:-options&quot;);
  
          // add in args conforming to List requrements of JavaCompiler
          for (String onearg : args) {
              String[] fields = onearg.split(&quot; &quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 383,11 ***</span>
              System.err.println(&quot;\t file     :\t&quot; + filename);
              failedCases++;
          }
      }
  
<span class="line-modified">!     protected boolean compile(String sourceFile, List&lt;String&gt;options) {</span>
          JavaCompiler.CompilationTask jctask;
          try (StandardJavaFileManager fm = javacompiler.getStandardFileManager(null, null, null)) {
              Iterable&lt;? extends JavaFileObject&gt; files = fm.getJavaFileObjects(sourceFile);
  
              jctask = javacompiler.getTask(
<span class="line-new-header">--- 386,11 ---</span>
              System.err.println(&quot;\t file     :\t&quot; + filename);
              failedCases++;
          }
      }
  
<span class="line-modified">!     protected boolean compile(String sourceFile, List&lt;String&gt; options) {</span>
          JavaCompiler.CompilationTask jctask;
          try (StandardJavaFileManager fm = javacompiler.getStandardFileManager(null, null, null)) {
              Iterable&lt;? extends JavaFileObject&gt; files = fm.getJavaFileObjects(sourceFile);
  
              jctask = javacompiler.getTask(
</pre>
<hr />
<pre>
<span class="line-old-header">*** 418,50 ***</span>
      protected void genSourceFiles() throws IOException{
          /* Create a file that executes with all supported versions. */
          writeSourceFile(&quot;Base.java&quot;,&quot;public class Base { }\n&quot;);
  
          /*
<span class="line-modified">!          * Create a file with a new feature in 1.7, not in 1.6 : &quot;&lt;&gt;&quot;</span>
           */
<span class="line-modified">!         writeSourceFile(&quot;New17.java&quot;,</span>
<span class="line-modified">!             &quot;import java.util.List;\n&quot; +</span>
<span class="line-modified">!             &quot;import java.util.ArrayList;\n&quot; +</span>
<span class="line-modified">!             &quot;class New17 { List&lt;String&gt; s = new ArrayList&lt;&gt;(); }\n&quot;</span>
          );
  
          /*
<span class="line-modified">!          * Create a file with a new feature in 1.8, not in 1.7 : lambda</span>
           */
<span class="line-modified">!         writeSourceFile(&quot;New18.java&quot;,</span>
<span class="line-modified">!             &quot;public class New18 { \n&quot; +</span>
<span class="line-modified">!             &quot;    void m() { \n&quot; +</span>
<span class="line-modified">!             &quot;    new Thread(() -&gt; { }); \n&quot; +</span>
<span class="line-modified">!             &quot;    } \n&quot; +</span>
<span class="line-modified">!             &quot;} \n&quot;</span>
          );
  
          /*
<span class="line-modified">!          * Create a file with a new feature in 1.10, not in 1.9 : var</span>
           */
<span class="line-modified">!         writeSourceFile(&quot;New110.java&quot;,</span>
<span class="line-modified">!             &quot;public class New110 { \n&quot; +</span>
<span class="line-modified">!             &quot;    void m() { \n&quot; +</span>
<span class="line-modified">!             &quot;    var tmp = new Thread(() -&gt; { }); \n&quot; +</span>
<span class="line-modified">!             &quot;    } \n&quot; +</span>
<span class="line-modified">!             &quot;} \n&quot;</span>
          );
  
          /*
           * Create a file with a new feature in 11, not in 10 : var for lambda parameters
           */
<span class="line-modified">!         writeSourceFile(&quot;New111.java&quot;,</span>
<span class="line-modified">!             &quot;public class New111 { \n&quot; +</span>
<span class="line-modified">!             &quot;    static java.util.function.Function&lt;String,String&gt; f = (var x) -&gt; x.substring(0);\n&quot; +</span>
<span class="line-modified">!             &quot;    void m(String name) { \n&quot; +</span>
<span class="line-modified">!             &quot;    var tmp = new Thread(() -&gt; { }, f.apply(name)); \n&quot; +</span>
<span class="line-modified">!             &quot;    } \n&quot; +</span>
<span class="line-modified">!             &quot;} \n&quot;</span>
          );
      }
  
      protected boolean checkClassFileVersion
          (String filename,String classVersionNumber) {
<span class="line-new-header">--- 421,92 ---</span>
      protected void genSourceFiles() throws IOException{
          /* Create a file that executes with all supported versions. */
          writeSourceFile(&quot;Base.java&quot;,&quot;public class Base { }\n&quot;);
  
          /*
<span class="line-modified">!          * Create a file with a new feature in 7, not in 6 : &quot;&lt;&gt;&quot;</span>
           */
<span class="line-modified">!         writeSourceFile(&quot;New7.java&quot;,</span>
<span class="line-modified">!             &quot;&quot;&quot;</span>
<span class="line-modified">!             import java.util.List;</span>
<span class="line-modified">!             import java.util.ArrayList;</span>
<span class="line-added">+             class New7 { List&lt;String&gt; s = new ArrayList&lt;&gt;(); }</span>
<span class="line-added">+             &quot;&quot;&quot;</span>
          );
  
          /*
<span class="line-modified">!          * Create a file with a new feature in 8, not in 7 : lambda</span>
           */
<span class="line-modified">!         writeSourceFile(&quot;New8.java&quot;,</span>
<span class="line-modified">!             &quot;&quot;&quot;</span>
<span class="line-modified">!             public class New8 {</span>
<span class="line-modified">!                 void m() {</span>
<span class="line-modified">!                 new Thread(() -&gt; { });</span>
<span class="line-modified">!                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+              &quot;&quot;&quot;</span>
          );
  
          /*
<span class="line-modified">!          * Create a file with a new feature in 10, not in 9 : var</span>
           */
<span class="line-modified">!         writeSourceFile(&quot;New10.java&quot;,</span>
<span class="line-modified">!             &quot;&quot;&quot;</span>
<span class="line-modified">!             public class New10 {</span>
<span class="line-modified">!                 void m() {</span>
<span class="line-modified">!                 var tmp = new Thread(() -&gt; { });</span>
<span class="line-modified">!                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+             &quot;&quot;&quot;</span>
          );
  
          /*
           * Create a file with a new feature in 11, not in 10 : var for lambda parameters
           */
<span class="line-modified">!         writeSourceFile(&quot;New11.java&quot;,</span>
<span class="line-modified">!             &quot;&quot;&quot;</span>
<span class="line-modified">!             public class New11 {</span>
<span class="line-modified">!                 static java.util.function.Function&lt;String,String&gt; f = (var x) -&gt; x.substring(0);</span>
<span class="line-modified">!                 void m(String name) {</span>
<span class="line-modified">!                 var tmp = new Thread(() -&gt; { }, f.apply(name));</span>
<span class="line-modified">!                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+             &quot;&quot;&quot;</span>
<span class="line-added">+         );</span>
<span class="line-added">+ </span>
<span class="line-added">+         /*</span>
<span class="line-added">+          * Create a file with a new feature in 14, not in 13 : switch expressions</span>
<span class="line-added">+          */</span>
<span class="line-added">+         writeSourceFile(&quot;New14.java&quot;,</span>
<span class="line-added">+             &quot;&quot;&quot;</span>
<span class="line-added">+             public class New14 {</span>
<span class="line-added">+                 static {</span>
<span class="line-added">+                     int i = 5;</span>
<span class="line-added">+                     System.out.println(</span>
<span class="line-added">+                         switch(i) {</span>
<span class="line-added">+                             case 0 -&gt; false;</span>
<span class="line-added">+                             default -&gt; true;</span>
<span class="line-added">+                         }</span>
<span class="line-added">+                     );</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+             &quot;&quot;&quot;</span>
<span class="line-added">+         );</span>
<span class="line-added">+ </span>
<span class="line-added">+         /*</span>
<span class="line-added">+          * Create a file with a new feature in 15, not in 14 : text blocks</span>
<span class="line-added">+          */</span>
<span class="line-added">+         writeSourceFile(&quot;New15.java&quot;,</span>
<span class="line-added">+             &quot;&quot;&quot;</span>
<span class="line-added">+             public class New15 {</span>
<span class="line-added">+                 public static final String s =</span>
<span class="line-added">+                 \&quot;\&quot;\&quot;</span>
<span class="line-added">+                 Hello, World.</span>
<span class="line-added">+                 \&quot;\&quot;\&quot;</span>
<span class="line-added">+                 ;</span>
<span class="line-added">+             }</span>
<span class="line-added">+             &quot;&quot;&quot;</span>
          );
      }
  
      protected boolean checkClassFileVersion
          (String filename,String classVersionNumber) {
</pre>
<center><a href="../records/VarargsRecordsTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../lib/jdk/test/lib/Convert.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>