<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/versions/Versions.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../records/VarargsRecordsTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../lib/jdk/test/lib/Convert.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/versions/Versions.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 4981566 5028634 5094412 6304984 7025786 7025789 8001112 8028545 8000961 8030610 8028546 8188870 8173382 8173382 8193290 8205619 8028563</span>
 27  * @summary Check interpretation of -target and -source options
 28  * @modules java.compiler
 29  *          jdk.compiler
 30  * @run main Versions
 31  */
 32 
 33 import java.io.*;
 34 import java.nio.*;
 35 import java.nio.channels.*;
 36 
 37 import javax.tools.JavaCompiler;
 38 import javax.tools.ToolProvider;
 39 import javax.tools.JavaFileObject;
 40 import javax.tools.StandardJavaFileManager;
 41 import java.util.List;
 42 import java.util.ArrayList;
 43 import java.util.Arrays;
 44 import java.util.Set;
 45 import java.util.function.BiConsumer;

 46 
 47 /*
 48  * If not explicitly specified the latest source and latest target
 49  * values are the defaults. If explicitly specified, the target value
 50  * has to be greater than or equal to the source value.
 51  */
 52 public class Versions {
 53 
 54     protected JavaCompiler javacompiler;
 55     protected int failedCases;
 56 
 57     public Versions() throws IOException {
 58         javacompiler = ToolProvider.getSystemJavaCompiler();
 59         genSourceFiles();
 60         failedCases = 0;
 61     }
 62 
 63     public static void main(String... args) throws IOException {
 64         Versions versions = new Versions();
 65         versions.run();
 66     }
 67 
 68     public static final Set&lt;String&gt; RETIRED_SOURCES =
 69         Set.of(&quot;1.2&quot;, &quot;1.3&quot;, &quot;1.4&quot;, &quot;1.5&quot;, &quot;1.6&quot;);
 70 
 71     public static final Set&lt;String&gt; VALID_SOURCES =
 72         Set.of(&quot;1.7&quot;, &quot;1.8&quot;, &quot;1.9&quot;, &quot;1.10&quot;, &quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;);
 73 
 74     public static final String LATEST_MAJOR_VERSION = &quot;59.0&quot;;
 75 
 76     static enum SourceTarget {
<span class="line-modified"> 77         SEVEN(true,   &quot;51.0&quot;,  &quot;7&quot;, Versions::checksrc17),</span>
<span class="line-modified"> 78         EIGHT(true,   &quot;52.0&quot;,  &quot;8&quot;, Versions::checksrc18),</span>
<span class="line-modified"> 79         NINE(true,    &quot;53.0&quot;,  &quot;9&quot;, Versions::checksrc19),</span>
<span class="line-modified"> 80         TEN(true,     &quot;54.0&quot;, &quot;10&quot;, Versions::checksrc110),</span>
<span class="line-modified"> 81         ELEVEN(false, &quot;55.0&quot;, &quot;11&quot;, Versions::checksrc111),</span>
<span class="line-modified"> 82         TWELVE(false, &quot;56.0&quot;, &quot;12&quot;, Versions::checksrc112),</span>
<span class="line-modified"> 83         THIRTEEN(false, &quot;57.0&quot;, &quot;13&quot;, Versions::checksrc113),</span>
<span class="line-modified"> 84         FOURTEEN(false, &quot;58.0&quot;, &quot;14&quot;, Versions::checksrc114),</span>
<span class="line-modified"> 85         FIFTEEN(false,  &quot;59.0&quot;, &quot;15&quot;, Versions::checksrc115);</span>
 86 
 87         private final boolean dotOne;
 88         private final String classFileVer;
 89         private final String target;
<span class="line-modified"> 90         private final BiConsumer&lt;Versions, String[]&gt; checker;</span>
 91 
 92         private SourceTarget(boolean dotOne, String classFileVer, String target,
<span class="line-modified"> 93                              BiConsumer&lt;Versions, String[]&gt; checker) {</span>
 94             this.dotOne = dotOne;
 95             this.classFileVer = classFileVer;
 96             this.target = target;
 97             this.checker = checker;
 98         }
 99 
<span class="line-modified">100         public void checksrc(Versions version, String... args) {</span>
101             checker.accept(version, args);
102         }
103 
104         public boolean dotOne() {
105             return dotOne;
106         }
107 
108         public String classFileVer() {
109             return classFileVer;
110         }
111 
112         public String target() {
113             return target;
114         }
115     }
116 
117     void run() {
118         String TC = &quot;&quot;;
119         System.out.println(&quot;Version.java: Starting&quot;);
120 
121         check(LATEST_MAJOR_VERSION);
122         for (String source : VALID_SOURCES) {
<span class="line-modified">123             check(LATEST_MAJOR_VERSION, &quot;-source &quot; + source);</span>
124         }
125 
126         // Verify that a -source value less than a -target value is
127         // accepted and that the resulting class files are dependent
128         // on the target setting alone.
129         SourceTarget[] sourceTargets = SourceTarget.values();
130         for (int i = 0; i &lt; sourceTargets.length; i++) {
131             SourceTarget st = sourceTargets[i];
132             String classFileVer = st.classFileVer();
133             String target = st.target();
134             boolean dotOne = st.dotOne();
<span class="line-modified">135             check_source_target(dotOne, classFileVer, target, target);</span>
136             for (int j = i; j &gt; 0; j--) {
137                 String source = sourceTargets[j].target();
<span class="line-modified">138                 check_source_target(dotOne, classFileVer, source, target);</span>
139             }
140         }
141 
142         // Verify acceptance of different combinations of -source N,
143         // -target M; N &lt;= M
144         for (int i = 0; i &lt; sourceTargets.length; i++) {
145             SourceTarget st = sourceTargets[i];
146 
<span class="line-modified">147             st.checksrc(this, &quot;-source &quot; + st.target());</span>
<span class="line-modified">148             st.checksrc(this, &quot;-source &quot; + st.target(), &quot;-target &quot; + st.target());</span>
149 
150             if (st.dotOne()) {
<span class="line-modified">151                 st.checksrc(this, &quot;-source 1.&quot; + st.target());</span>
<span class="line-modified">152                 st.checksrc(this, &quot;-source 1.&quot; + st.target(), &quot;-target 1.&quot; + st.target());</span>
153             }
154 
155             if (i == sourceTargets.length) {
156                 // Can use -target without -source setting only for
157                 // most recent target since the most recent source is
158                 // the default.
<span class="line-modified">159                 st.checksrc(this, &quot;-target &quot; + st.target());</span>
160 
161                 if (!st.classFileVer().equals(LATEST_MAJOR_VERSION)) {
162                     throw new RuntimeException(st +
163                                                &quot;does not have class file version&quot; +
164                                                LATEST_MAJOR_VERSION);
165                 }
166             }
167         }
168 
169         // Verify that -source N -target (N-1) is rejected
170         for (int i = 1 /* Skip zeroth value */; i &lt; sourceTargets.length; i++) {
<span class="line-modified">171             fail(&quot;-source &quot; + sourceTargets[i].target(),</span>
172                  &quot;-target &quot; + sourceTargets[i-1].target(),
<span class="line-modified">173                  &quot;Base.java&quot;);</span>
174         }
175 
176         // Previously supported source/target values
177         for (String source  : RETIRED_SOURCES) {
<span class="line-modified">178             fail(&quot;-source &quot; + source, &quot;-target &quot; + source, &quot;Base.java&quot;);</span>
179         }
180 
181         if (failedCases &gt; 0) {
182             System.err.println(&quot;failedCases = &quot; + String.valueOf(failedCases));
183             throw new Error(&quot;Test failed&quot;);
184         }
185 
186     }
187 
<span class="line-modified">188     protected void printargs(String fname,String... args) {</span>
189         System.out.printf(&quot;test: %s&quot;, fname);
190         for (String onearg : args) {
191             System.out.printf(&quot; %s&quot;, onearg);
192         }
193         System.out.printf(&quot;\n&quot;, fname);
194     }
195 
<span class="line-modified">196     protected void check_source_target(boolean dotOne, String... args) {</span>
197         printargs(&quot;check_source_target&quot;, args);
<span class="line-modified">198         check_target(dotOne, args[0], args[1], args[2]);</span>
199         if (dotOne) {
<span class="line-modified">200             check_target(dotOne, args[0], &quot;1.&quot; + args[1], args[2]);</span>
201         }
202     }
203 
<span class="line-modified">204     protected void check_target(boolean dotOne, String... args) {</span>
<span class="line-modified">205         check(args[0], &quot;-source &quot; + args[1], &quot;-target &quot; + args[2]);</span>
206         if (dotOne) {
<span class="line-modified">207             check(args[0], &quot;-source &quot; + args[1], &quot;-target 1.&quot; + args[2]);</span>
208         }
209     }
210 
<span class="line-modified">211     protected void check(String major, String... args) {</span>




212         printargs(&quot;check&quot;, args);
213         List&lt;String&gt; jcargs = new ArrayList&lt;&gt;();
214         jcargs.add(&quot;-Xlint:-options&quot;);
215 
216         // add in args conforming to List requrements of JavaCompiler
217         for (String onearg : args) {
218             String[] fields = onearg.split(&quot; &quot;);
219             for (String onefield : fields) {
220                 jcargs.add(onefield);
221             }
222         }
223 
224         boolean creturn = compile(&quot;Base.java&quot;, jcargs);
225         if (!creturn) {
226             // compilation errors note and return.. assume no class file
227             System.err.println(&quot;check: Compilation Failed&quot;);
228             System.err.println(&quot;\t classVersion:\t&quot; + major);
229             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
230             failedCases++;
231 
232         } else if (!checkClassFileVersion(&quot;Base.class&quot;, major)) {
233             failedCases++;
234         }
235     }
236 
<span class="line-modified">237     protected void checksrc17(String... args) {</span>
<span class="line-modified">238         printargs(&quot;checksrc17&quot;, args);</span>
<span class="line-modified">239         int asize = args.length;</span>
<span class="line-modified">240         String[] newargs = new String[asize+1];</span>
<span class="line-modified">241         System.arraycopy(args, 0, newargs,0 , asize);</span>
<span class="line-modified">242         newargs[asize] = &quot;New17.java&quot;;</span>
<span class="line-modified">243         pass(newargs);</span>
<span class="line-modified">244         newargs[asize] = &quot;New18.java&quot;;</span>
<span class="line-modified">245         fail(newargs);</span>













246     }
247 
<span class="line-modified">248     protected void checksrc18(String... args) {</span>
<span class="line-modified">249         printargs(&quot;checksrc18&quot;, args);</span>
<span class="line-modified">250         int asize = args.length;</span>
<span class="line-modified">251         String[] newargs = new String[asize+1];</span>
<span class="line-removed">252         System.arraycopy(args, 0, newargs,0 , asize);</span>
<span class="line-removed">253         newargs[asize] = &quot;New17.java&quot;;</span>
<span class="line-removed">254         pass(newargs);</span>
<span class="line-removed">255         newargs[asize] = &quot;New18.java&quot;;</span>
<span class="line-removed">256         pass(newargs);</span>
<span class="line-removed">257         newargs[asize] = &quot;New110.java&quot;;</span>
<span class="line-removed">258         fail(newargs);</span>
259     }
260 
<span class="line-modified">261     protected void checksrc19(String... args) {</span>
<span class="line-modified">262         printargs(&quot;checksrc19&quot;, args);</span>
<span class="line-modified">263         checksrc18(args);</span>

264     }
265 
<span class="line-modified">266     protected void checksrc110(String... args) {</span>
<span class="line-modified">267         printargs(&quot;checksrc110&quot;, args);</span>
<span class="line-modified">268         int asize = args.length;</span>
<span class="line-modified">269         String[] newargs = new String[asize+1];</span>
<span class="line-removed">270         System.arraycopy(args, 0, newargs,0 , asize);</span>
<span class="line-removed">271         newargs[asize] = &quot;New17.java&quot;;</span>
<span class="line-removed">272         pass(newargs);</span>
<span class="line-removed">273         newargs[asize] = &quot;New18.java&quot;;</span>
<span class="line-removed">274         pass(newargs);</span>
<span class="line-removed">275         newargs[asize] = &quot;New110.java&quot;;</span>
<span class="line-removed">276         pass(newargs);</span>
277     }
278 
<span class="line-modified">279     protected void checksrc111(String... args) {</span>
<span class="line-modified">280         printargs(&quot;checksrc111&quot;, args);</span>
<span class="line-modified">281         int asize = args.length;</span>
<span class="line-modified">282         String[] newargs = new String[asize+1];</span>
<span class="line-modified">283         System.arraycopy(args, 0, newargs,0 , asize);</span>
<span class="line-removed">284         newargs[asize] = &quot;New17.java&quot;;</span>
<span class="line-removed">285         pass(newargs);</span>
<span class="line-removed">286         newargs[asize] = &quot;New18.java&quot;;</span>
<span class="line-removed">287         pass(newargs);</span>
<span class="line-removed">288         newargs[asize] = &quot;New110.java&quot;;</span>
<span class="line-removed">289         pass(newargs);</span>
<span class="line-removed">290         newargs[asize] = &quot;New111.java&quot;;</span>
<span class="line-removed">291         pass(newargs);</span>
292     }
293 
<span class="line-modified">294     protected void checksrc112(String... args) {</span>
<span class="line-modified">295         printargs(&quot;checksrc112&quot;, args);</span>
<span class="line-modified">296         checksrc111(args);</span>


297     }
298 
<span class="line-modified">299     protected void checksrc113(String... args) {</span>
<span class="line-modified">300         printargs(&quot;checksrc113&quot;, args);</span>
<span class="line-modified">301         checksrc111(args);</span>






302     }
303 
<span class="line-modified">304     protected void checksrc114(String... args) {</span>
<span class="line-modified">305         printargs(&quot;checksrc114&quot;, args);</span>
<span class="line-removed">306         checksrc111(args);</span>
307     }
308 
<span class="line-modified">309     protected void checksrc115(String... args) {</span>
<span class="line-modified">310         printargs(&quot;checksrc115&quot;, args);</span>
<span class="line-removed">311         checksrc111(args);</span>
312     }
313 
<span class="line-modified">314     protected void pass(String... args) {</span>
315         printargs(&quot;pass&quot;, args);
316 
<span class="line-modified">317         List&lt;String&gt; jcargs = new ArrayList&lt;String&gt;();</span>
318         jcargs.add(&quot;-Xlint:-options&quot;);
319 
320         // add in args conforming to List requrements of JavaCompiler
321         for (String onearg : args) {
322             String[] fields = onearg.split(&quot; &quot;);
323             for (String onefield : fields) {
324                 jcargs.add(onefield);
325             }
326         }
327 
328         // empty list is error
329         if (jcargs.isEmpty()) {
330             System.err.println(&quot;error: test error in pass() - No arguments&quot;);
331             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
332             failedCases++;
333             return;
334         }
335 
336         // the last argument is the filename *.java
337         String filename = jcargs.get(jcargs.size() - 1);
338         jcargs.remove(jcargs.size() - 1);
339 
340         boolean creturn = compile(filename, jcargs);
341         // expect a compilation failure, failure if otherwise
342         if (!creturn) {
343             System.err.println(&quot;pass: Compilation erroneously failed&quot;);
344             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
345             System.err.println(&quot;\t file     :\t&quot; + filename);
346             failedCases++;
347 
348         }
349 
350     }
351 
<span class="line-modified">352     protected void fail(String... args) {</span>
353         printargs(&quot;fail&quot;, args);
354 
<span class="line-modified">355         List&lt;String&gt; jcargs = new ArrayList&lt;String&gt;();</span>
356         jcargs.add(&quot;-Xlint:-options&quot;);
357 
358         // add in args conforming to List requrements of JavaCompiler
359         for (String onearg : args) {
360             String[] fields = onearg.split(&quot; &quot;);
361             for (String onefield : fields) {
362                 jcargs.add(onefield);
363             }
364         }
365 
366         // empty list is error
367         if (jcargs.isEmpty()) {
368             System.err.println(&quot;error: test error in fail()- No arguments&quot;);
369             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
370             failedCases++;
371             return;
372         }
373 
374         // the last argument is the filename *.java
375         String filename = jcargs.get(jcargs.size() - 1);
376         jcargs.remove(jcargs.size() - 1);
377 
378         boolean creturn = compile(filename, jcargs);
379         // expect a compilation failure, failure if otherwise
380         if (creturn) {
381             System.err.println(&quot;fail: Compilation erroneously succeeded&quot;);
382             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
383             System.err.println(&quot;\t file     :\t&quot; + filename);
384             failedCases++;
385         }
386     }
387 
<span class="line-modified">388     protected boolean compile(String sourceFile, List&lt;String&gt;options) {</span>
389         JavaCompiler.CompilationTask jctask;
390         try (StandardJavaFileManager fm = javacompiler.getStandardFileManager(null, null, null)) {
391             Iterable&lt;? extends JavaFileObject&gt; files = fm.getJavaFileObjects(sourceFile);
392 
393             jctask = javacompiler.getTask(
394                 null,    // Writer
395                 fm,      // JavaFileManager
396                 null,    // DiagnosticListener
397                 options, // Iterable&lt;String&gt;
398                 null,    // Iterable&lt;String&gt; classes
399                 files);  // Iterable&lt;? extends JavaFileObject&gt;
400 
401             try {
402                 return jctask.call();
403             } catch (IllegalStateException e) {
404                 System.err.println(e);
405                 return false;
406             }
407         } catch (IOException e) {
408             throw new Error(e);
409         }
410     }
411 
412     protected void writeSourceFile(String fileName, String body) throws IOException{
413         try (Writer fw = new FileWriter(fileName)) {
414             fw.write(body);
415         }
416     }
417 
418     protected void genSourceFiles() throws IOException{
419         /* Create a file that executes with all supported versions. */
420         writeSourceFile(&quot;Base.java&quot;,&quot;public class Base { }\n&quot;);
421 
422         /*
<span class="line-modified">423          * Create a file with a new feature in 1.7, not in 1.6 : &quot;&lt;&gt;&quot;</span>
424          */
<span class="line-modified">425         writeSourceFile(&quot;New17.java&quot;,</span>
<span class="line-modified">426             &quot;import java.util.List;\n&quot; +</span>
<span class="line-modified">427             &quot;import java.util.ArrayList;\n&quot; +</span>
<span class="line-modified">428             &quot;class New17 { List&lt;String&gt; s = new ArrayList&lt;&gt;(); }\n&quot;</span>


429         );
430 
431         /*
<span class="line-modified">432          * Create a file with a new feature in 1.8, not in 1.7 : lambda</span>
433          */
<span class="line-modified">434         writeSourceFile(&quot;New18.java&quot;,</span>
<span class="line-modified">435             &quot;public class New18 { \n&quot; +</span>
<span class="line-modified">436             &quot;    void m() { \n&quot; +</span>
<span class="line-modified">437             &quot;    new Thread(() -&gt; { }); \n&quot; +</span>
<span class="line-modified">438             &quot;    } \n&quot; +</span>
<span class="line-modified">439             &quot;} \n&quot;</span>


440         );
441 
442         /*
<span class="line-modified">443          * Create a file with a new feature in 1.10, not in 1.9 : var</span>
444          */
<span class="line-modified">445         writeSourceFile(&quot;New110.java&quot;,</span>
<span class="line-modified">446             &quot;public class New110 { \n&quot; +</span>
<span class="line-modified">447             &quot;    void m() { \n&quot; +</span>
<span class="line-modified">448             &quot;    var tmp = new Thread(() -&gt; { }); \n&quot; +</span>
<span class="line-modified">449             &quot;    } \n&quot; +</span>
<span class="line-modified">450             &quot;} \n&quot;</span>


451         );
452 
453         /*
454          * Create a file with a new feature in 11, not in 10 : var for lambda parameters
455          */
<span class="line-modified">456         writeSourceFile(&quot;New111.java&quot;,</span>
<span class="line-modified">457             &quot;public class New111 { \n&quot; +</span>
<span class="line-modified">458             &quot;    static java.util.function.Function&lt;String,String&gt; f = (var x) -&gt; x.substring(0);\n&quot; +</span>
<span class="line-modified">459             &quot;    void m(String name) { \n&quot; +</span>
<span class="line-modified">460             &quot;    var tmp = new Thread(() -&gt; { }, f.apply(name)); \n&quot; +</span>
<span class="line-modified">461             &quot;    } \n&quot; +</span>
<span class="line-modified">462             &quot;} \n&quot;</span>




































463         );
464     }
465 
466     protected boolean checkClassFileVersion
467         (String filename,String classVersionNumber) {
468         ByteBuffer bb = ByteBuffer.allocate(1024);
469         try (FileChannel fc = new FileInputStream(filename).getChannel()) {
470             bb.clear();
471             if (fc.read(bb) &lt; 0)
472                 throw new IOException(&quot;Could not read from file : &quot; + filename);
473             bb.flip();
474             int minor = bb.getShort(4);
475             int major = bb.getShort(6);
476             String fileVersion = major + &quot;.&quot; + minor;
477             if (fileVersion.equals(classVersionNumber)) {
478                 return true;
479             } else {
480                 System.err.println(&quot;checkClassFileVersion : Failed&quot;);
481                 System.err.println(&quot;\tclassfile version mismatch&quot;);
482                 System.err.println(&quot;\texpected : &quot; + classVersionNumber);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 4981566 5028634 5094412 6304984 7025786 7025789 8001112 8028545 8000961 8030610 8028546 8188870 8173382 8173382 8193290 8205619 8028563 8245147</span>
 27  * @summary Check interpretation of -target and -source options
 28  * @modules java.compiler
 29  *          jdk.compiler
 30  * @run main Versions
 31  */
 32 
 33 import java.io.*;
 34 import java.nio.*;
 35 import java.nio.channels.*;
 36 
 37 import javax.tools.JavaCompiler;
 38 import javax.tools.ToolProvider;
 39 import javax.tools.JavaFileObject;
 40 import javax.tools.StandardJavaFileManager;
 41 import java.util.List;
 42 import java.util.ArrayList;
 43 import java.util.Arrays;
 44 import java.util.Set;
 45 import java.util.function.BiConsumer;
<span class="line-added"> 46 import java.util.function.Consumer;</span>
 47 
 48 /*
 49  * If not explicitly specified the latest source and latest target
 50  * values are the defaults. If explicitly specified, the target value
 51  * has to be greater than or equal to the source value.
 52  */
 53 public class Versions {
 54 
 55     protected JavaCompiler javacompiler;
 56     protected int failedCases;
 57 
 58     public Versions() throws IOException {
 59         javacompiler = ToolProvider.getSystemJavaCompiler();
 60         genSourceFiles();
 61         failedCases = 0;
 62     }
 63 
 64     public static void main(String... args) throws IOException {
 65         Versions versions = new Versions();
 66         versions.run();
 67     }
 68 
 69     public static final Set&lt;String&gt; RETIRED_SOURCES =
 70         Set.of(&quot;1.2&quot;, &quot;1.3&quot;, &quot;1.4&quot;, &quot;1.5&quot;, &quot;1.6&quot;);
 71 
 72     public static final Set&lt;String&gt; VALID_SOURCES =
 73         Set.of(&quot;1.7&quot;, &quot;1.8&quot;, &quot;1.9&quot;, &quot;1.10&quot;, &quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;14&quot;, &quot;15&quot;);
 74 
 75     public static final String LATEST_MAJOR_VERSION = &quot;59.0&quot;;
 76 
 77     static enum SourceTarget {
<span class="line-modified"> 78         SEVEN(true,   &quot;51.0&quot;,  &quot;7&quot;, Versions::checksrc7),</span>
<span class="line-modified"> 79         EIGHT(true,   &quot;52.0&quot;,  &quot;8&quot;, Versions::checksrc8),</span>
<span class="line-modified"> 80         NINE(true,    &quot;53.0&quot;,  &quot;9&quot;, Versions::checksrc9),</span>
<span class="line-modified"> 81         TEN(true,     &quot;54.0&quot;, &quot;10&quot;, Versions::checksrc10),</span>
<span class="line-modified"> 82         ELEVEN(false, &quot;55.0&quot;, &quot;11&quot;, Versions::checksrc11),</span>
<span class="line-modified"> 83         TWELVE(false, &quot;56.0&quot;, &quot;12&quot;, Versions::checksrc12),</span>
<span class="line-modified"> 84         THIRTEEN(false, &quot;57.0&quot;, &quot;13&quot;, Versions::checksrc13),</span>
<span class="line-modified"> 85         FOURTEEN(false, &quot;58.0&quot;, &quot;14&quot;, Versions::checksrc14),</span>
<span class="line-modified"> 86         FIFTEEN(false,  &quot;59.0&quot;, &quot;15&quot;, Versions::checksrc15);</span>
 87 
 88         private final boolean dotOne;
 89         private final String classFileVer;
 90         private final String target;
<span class="line-modified"> 91         private final BiConsumer&lt;Versions, List&lt;String&gt;&gt; checker;</span>
 92 
 93         private SourceTarget(boolean dotOne, String classFileVer, String target,
<span class="line-modified"> 94                              BiConsumer&lt;Versions, List&lt;String&gt;&gt; checker) {</span>
 95             this.dotOne = dotOne;
 96             this.classFileVer = classFileVer;
 97             this.target = target;
 98             this.checker = checker;
 99         }
100 
<span class="line-modified">101         public void checksrc(Versions version, List&lt;String&gt; args) {</span>
102             checker.accept(version, args);
103         }
104 
105         public boolean dotOne() {
106             return dotOne;
107         }
108 
109         public String classFileVer() {
110             return classFileVer;
111         }
112 
113         public String target() {
114             return target;
115         }
116     }
117 
118     void run() {
119         String TC = &quot;&quot;;
120         System.out.println(&quot;Version.java: Starting&quot;);
121 
122         check(LATEST_MAJOR_VERSION);
123         for (String source : VALID_SOURCES) {
<span class="line-modified">124             check(LATEST_MAJOR_VERSION, List.of(&quot;-source &quot; + source));</span>
125         }
126 
127         // Verify that a -source value less than a -target value is
128         // accepted and that the resulting class files are dependent
129         // on the target setting alone.
130         SourceTarget[] sourceTargets = SourceTarget.values();
131         for (int i = 0; i &lt; sourceTargets.length; i++) {
132             SourceTarget st = sourceTargets[i];
133             String classFileVer = st.classFileVer();
134             String target = st.target();
135             boolean dotOne = st.dotOne();
<span class="line-modified">136             check_source_target(dotOne, List.of(classFileVer, target, target));</span>
137             for (int j = i; j &gt; 0; j--) {
138                 String source = sourceTargets[j].target();
<span class="line-modified">139                 check_source_target(dotOne, List.of(classFileVer, source, target));</span>
140             }
141         }
142 
143         // Verify acceptance of different combinations of -source N,
144         // -target M; N &lt;= M
145         for (int i = 0; i &lt; sourceTargets.length; i++) {
146             SourceTarget st = sourceTargets[i];
147 
<span class="line-modified">148             st.checksrc(this, List.of(&quot;-source &quot; + st.target()));</span>
<span class="line-modified">149             st.checksrc(this, List.of(&quot;-source &quot; + st.target(), &quot;-target &quot; + st.target()));</span>
150 
151             if (st.dotOne()) {
<span class="line-modified">152                 st.checksrc(this, List.of(&quot;-source 1.&quot; + st.target()));</span>
<span class="line-modified">153                 st.checksrc(this, List.of(&quot;-source 1.&quot; + st.target(), &quot;-target 1.&quot; + st.target()));</span>
154             }
155 
156             if (i == sourceTargets.length) {
157                 // Can use -target without -source setting only for
158                 // most recent target since the most recent source is
159                 // the default.
<span class="line-modified">160                 st.checksrc(this, List.of(&quot;-target &quot; + st.target()));</span>
161 
162                 if (!st.classFileVer().equals(LATEST_MAJOR_VERSION)) {
163                     throw new RuntimeException(st +
164                                                &quot;does not have class file version&quot; +
165                                                LATEST_MAJOR_VERSION);
166                 }
167             }
168         }
169 
170         // Verify that -source N -target (N-1) is rejected
171         for (int i = 1 /* Skip zeroth value */; i &lt; sourceTargets.length; i++) {
<span class="line-modified">172             fail(List.of(&quot;-source &quot; + sourceTargets[i].target(),</span>
173                  &quot;-target &quot; + sourceTargets[i-1].target(),
<span class="line-modified">174                          &quot;Base.java&quot;));</span>
175         }
176 
177         // Previously supported source/target values
178         for (String source  : RETIRED_SOURCES) {
<span class="line-modified">179             fail(List.of(&quot;-source &quot; + source, &quot;-target &quot; + source, &quot;Base.java&quot;));</span>
180         }
181 
182         if (failedCases &gt; 0) {
183             System.err.println(&quot;failedCases = &quot; + String.valueOf(failedCases));
184             throw new Error(&quot;Test failed&quot;);
185         }
186 
187     }
188 
<span class="line-modified">189     protected void printargs(String fname, List&lt;String&gt; args) {</span>
190         System.out.printf(&quot;test: %s&quot;, fname);
191         for (String onearg : args) {
192             System.out.printf(&quot; %s&quot;, onearg);
193         }
194         System.out.printf(&quot;\n&quot;, fname);
195     }
196 
<span class="line-modified">197     protected void check_source_target(boolean dotOne, List&lt;String&gt; args) {</span>
198         printargs(&quot;check_source_target&quot;, args);
<span class="line-modified">199         check_target(dotOne, List.of(args.get(0), args.get(1), args.get(2)));</span>
200         if (dotOne) {
<span class="line-modified">201             check_target(dotOne, List.of(args.get(0), &quot;1.&quot; + args.get(1), args.get(2)));</span>
202         }
203     }
204 
<span class="line-modified">205     protected void check_target(boolean dotOne, List&lt;String&gt; args) {</span>
<span class="line-modified">206         check(args.get(0), List.of(&quot;-source &quot; + args.get(1), &quot;-target &quot; + args.get(2)));</span>
207         if (dotOne) {
<span class="line-modified">208             check(args.get(0), List.of(&quot;-source &quot; + args.get(1), &quot;-target 1.&quot; + args.get(2)));</span>
209         }
210     }
211 
<span class="line-modified">212     protected void check(String major) {</span>
<span class="line-added">213         check(major, List.of());</span>
<span class="line-added">214     }</span>
<span class="line-added">215 </span>
<span class="line-added">216     protected void check(String major, List&lt;String&gt; args) {</span>
217         printargs(&quot;check&quot;, args);
218         List&lt;String&gt; jcargs = new ArrayList&lt;&gt;();
219         jcargs.add(&quot;-Xlint:-options&quot;);
220 
221         // add in args conforming to List requrements of JavaCompiler
222         for (String onearg : args) {
223             String[] fields = onearg.split(&quot; &quot;);
224             for (String onefield : fields) {
225                 jcargs.add(onefield);
226             }
227         }
228 
229         boolean creturn = compile(&quot;Base.java&quot;, jcargs);
230         if (!creturn) {
231             // compilation errors note and return.. assume no class file
232             System.err.println(&quot;check: Compilation Failed&quot;);
233             System.err.println(&quot;\t classVersion:\t&quot; + major);
234             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
235             failedCases++;
236 
237         } else if (!checkClassFileVersion(&quot;Base.class&quot;, major)) {
238             failedCases++;
239         }
240     }
241 
<span class="line-modified">242     protected void checksrc7(List&lt;String&gt; args) {</span>
<span class="line-modified">243         printargs(&quot;checksrc7&quot;, args);</span>
<span class="line-modified">244         expectedPass(args, List.of(&quot;New7.java&quot;));</span>
<span class="line-modified">245         expectedFail(args, List.of(&quot;New8.java&quot;));</span>
<span class="line-modified">246     }</span>
<span class="line-modified">247 </span>
<span class="line-modified">248     protected void checksrc8(List&lt;String&gt; args) {</span>
<span class="line-modified">249         printargs(&quot;checksrc8&quot;, args);</span>
<span class="line-modified">250         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;));</span>
<span class="line-added">251         expectedFail(args, List.of(&quot;New10.java&quot;));</span>
<span class="line-added">252     }</span>
<span class="line-added">253 </span>
<span class="line-added">254     protected void checksrc9(List&lt;String&gt; args) {</span>
<span class="line-added">255         printargs(&quot;checksrc9&quot;, args);</span>
<span class="line-added">256         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;));</span>
<span class="line-added">257         expectedFail(args, List.of(&quot;New10.java&quot;));</span>
<span class="line-added">258     }</span>
<span class="line-added">259 </span>
<span class="line-added">260     protected void checksrc10(List&lt;String&gt; args) {</span>
<span class="line-added">261         printargs(&quot;checksrc10&quot;, args);</span>
<span class="line-added">262         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;));</span>
<span class="line-added">263         expectedFail(args, List.of(&quot;New11.java&quot;));</span>
264     }
265 
<span class="line-modified">266     protected void checksrc11(List&lt;String&gt; args) {</span>
<span class="line-modified">267         printargs(&quot;checksrc11&quot;, args);</span>
<span class="line-modified">268         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;));</span>
<span class="line-modified">269         expectedFail(args, List.of(&quot;New14.java&quot;));</span>







270     }
271 
<span class="line-modified">272     protected void checksrc12(List&lt;String&gt; args) {</span>
<span class="line-modified">273         printargs(&quot;checksrc12&quot;, args);</span>
<span class="line-modified">274         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;));</span>
<span class="line-added">275         expectedFail(args, List.of(&quot;New14.java&quot;));</span>
276     }
277 
<span class="line-modified">278     protected void checksrc13(List&lt;String&gt; args) {</span>
<span class="line-modified">279         printargs(&quot;checksrc13&quot;, args);</span>
<span class="line-modified">280         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;));</span>
<span class="line-modified">281         expectedFail(args, List.of(&quot;New14.java&quot;));</span>







282     }
283 
<span class="line-modified">284     protected void checksrc14(List&lt;String&gt; args) {</span>
<span class="line-modified">285         printargs(&quot;checksrc14&quot;, args);</span>
<span class="line-modified">286         expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;,</span>
<span class="line-modified">287                                    &quot;New14.java&quot;));</span>
<span class="line-modified">288         expectedFail(args, List.of(&quot;New15.java&quot;));</span>








289     }
290 
<span class="line-modified">291    protected void checksrc15(List&lt;String&gt; args) {</span>
<span class="line-modified">292        printargs(&quot;checksrc15&quot;, args);</span>
<span class="line-modified">293        expectedPass(args, List.of(&quot;New7.java&quot;, &quot;New8.java&quot;, &quot;New10.java&quot;, &quot;New11.java&quot;,</span>
<span class="line-added">294                                   &quot;New14.java&quot;, &quot;New15.java&quot;));</span>
<span class="line-added">295        // Add expectedFail after new language features added in a later release.</span>
296     }
297 
<span class="line-modified">298     protected void expected(List&lt;String&gt; args, List&lt;String&gt; fileNames,</span>
<span class="line-modified">299                             Consumer&lt;List&lt;String&gt;&gt; passOrFail) {</span>
<span class="line-modified">300         ArrayList&lt;String&gt; fullArguments = new ArrayList&lt;&gt;(args);</span>
<span class="line-added">301         // Issue compile with each filename in turn.</span>
<span class="line-added">302         for(String fileName : fileNames) {</span>
<span class="line-added">303             fullArguments.add(fileName);</span>
<span class="line-added">304             passOrFail.accept(fullArguments);</span>
<span class="line-added">305             fullArguments.remove(fullArguments.size() - 1);</span>
<span class="line-added">306         }</span>
307     }
308 
<span class="line-modified">309     protected void expectedPass(List&lt;String&gt; args, List&lt;String&gt; fileNames) {</span>
<span class="line-modified">310         expected(args, fileNames, this::pass);</span>

311     }
312 
<span class="line-modified">313     protected void expectedFail(List&lt;String&gt; args, List&lt;String&gt; fileNames) {</span>
<span class="line-modified">314         expected(args, fileNames, this::fail);</span>

315     }
316 
<span class="line-modified">317     protected void pass(List&lt;String&gt; args) {</span>
318         printargs(&quot;pass&quot;, args);
319 
<span class="line-modified">320         List&lt;String&gt; jcargs = new ArrayList&lt;&gt;();</span>
321         jcargs.add(&quot;-Xlint:-options&quot;);
322 
323         // add in args conforming to List requrements of JavaCompiler
324         for (String onearg : args) {
325             String[] fields = onearg.split(&quot; &quot;);
326             for (String onefield : fields) {
327                 jcargs.add(onefield);
328             }
329         }
330 
331         // empty list is error
332         if (jcargs.isEmpty()) {
333             System.err.println(&quot;error: test error in pass() - No arguments&quot;);
334             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
335             failedCases++;
336             return;
337         }
338 
339         // the last argument is the filename *.java
340         String filename = jcargs.get(jcargs.size() - 1);
341         jcargs.remove(jcargs.size() - 1);
342 
343         boolean creturn = compile(filename, jcargs);
344         // expect a compilation failure, failure if otherwise
345         if (!creturn) {
346             System.err.println(&quot;pass: Compilation erroneously failed&quot;);
347             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
348             System.err.println(&quot;\t file     :\t&quot; + filename);
349             failedCases++;
350 
351         }
352 
353     }
354 
<span class="line-modified">355     protected void fail(List&lt;String&gt; args) {</span>
356         printargs(&quot;fail&quot;, args);
357 
<span class="line-modified">358         List&lt;String&gt; jcargs = new ArrayList&lt;&gt;();</span>
359         jcargs.add(&quot;-Xlint:-options&quot;);
360 
361         // add in args conforming to List requrements of JavaCompiler
362         for (String onearg : args) {
363             String[] fields = onearg.split(&quot; &quot;);
364             for (String onefield : fields) {
365                 jcargs.add(onefield);
366             }
367         }
368 
369         // empty list is error
370         if (jcargs.isEmpty()) {
371             System.err.println(&quot;error: test error in fail()- No arguments&quot;);
372             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
373             failedCases++;
374             return;
375         }
376 
377         // the last argument is the filename *.java
378         String filename = jcargs.get(jcargs.size() - 1);
379         jcargs.remove(jcargs.size() - 1);
380 
381         boolean creturn = compile(filename, jcargs);
382         // expect a compilation failure, failure if otherwise
383         if (creturn) {
384             System.err.println(&quot;fail: Compilation erroneously succeeded&quot;);
385             System.err.println(&quot;\t arguments:\t&quot; + jcargs);
386             System.err.println(&quot;\t file     :\t&quot; + filename);
387             failedCases++;
388         }
389     }
390 
<span class="line-modified">391     protected boolean compile(String sourceFile, List&lt;String&gt; options) {</span>
392         JavaCompiler.CompilationTask jctask;
393         try (StandardJavaFileManager fm = javacompiler.getStandardFileManager(null, null, null)) {
394             Iterable&lt;? extends JavaFileObject&gt; files = fm.getJavaFileObjects(sourceFile);
395 
396             jctask = javacompiler.getTask(
397                 null,    // Writer
398                 fm,      // JavaFileManager
399                 null,    // DiagnosticListener
400                 options, // Iterable&lt;String&gt;
401                 null,    // Iterable&lt;String&gt; classes
402                 files);  // Iterable&lt;? extends JavaFileObject&gt;
403 
404             try {
405                 return jctask.call();
406             } catch (IllegalStateException e) {
407                 System.err.println(e);
408                 return false;
409             }
410         } catch (IOException e) {
411             throw new Error(e);
412         }
413     }
414 
415     protected void writeSourceFile(String fileName, String body) throws IOException{
416         try (Writer fw = new FileWriter(fileName)) {
417             fw.write(body);
418         }
419     }
420 
421     protected void genSourceFiles() throws IOException{
422         /* Create a file that executes with all supported versions. */
423         writeSourceFile(&quot;Base.java&quot;,&quot;public class Base { }\n&quot;);
424 
425         /*
<span class="line-modified">426          * Create a file with a new feature in 7, not in 6 : &quot;&lt;&gt;&quot;</span>
427          */
<span class="line-modified">428         writeSourceFile(&quot;New7.java&quot;,</span>
<span class="line-modified">429             &quot;&quot;&quot;</span>
<span class="line-modified">430             import java.util.List;</span>
<span class="line-modified">431             import java.util.ArrayList;</span>
<span class="line-added">432             class New7 { List&lt;String&gt; s = new ArrayList&lt;&gt;(); }</span>
<span class="line-added">433             &quot;&quot;&quot;</span>
434         );
435 
436         /*
<span class="line-modified">437          * Create a file with a new feature in 8, not in 7 : lambda</span>
438          */
<span class="line-modified">439         writeSourceFile(&quot;New8.java&quot;,</span>
<span class="line-modified">440             &quot;&quot;&quot;</span>
<span class="line-modified">441             public class New8 {</span>
<span class="line-modified">442                 void m() {</span>
<span class="line-modified">443                 new Thread(() -&gt; { });</span>
<span class="line-modified">444                 }</span>
<span class="line-added">445             }</span>
<span class="line-added">446              &quot;&quot;&quot;</span>
447         );
448 
449         /*
<span class="line-modified">450          * Create a file with a new feature in 10, not in 9 : var</span>
451          */
<span class="line-modified">452         writeSourceFile(&quot;New10.java&quot;,</span>
<span class="line-modified">453             &quot;&quot;&quot;</span>
<span class="line-modified">454             public class New10 {</span>
<span class="line-modified">455                 void m() {</span>
<span class="line-modified">456                 var tmp = new Thread(() -&gt; { });</span>
<span class="line-modified">457                 }</span>
<span class="line-added">458             }</span>
<span class="line-added">459             &quot;&quot;&quot;</span>
460         );
461 
462         /*
463          * Create a file with a new feature in 11, not in 10 : var for lambda parameters
464          */
<span class="line-modified">465         writeSourceFile(&quot;New11.java&quot;,</span>
<span class="line-modified">466             &quot;&quot;&quot;</span>
<span class="line-modified">467             public class New11 {</span>
<span class="line-modified">468                 static java.util.function.Function&lt;String,String&gt; f = (var x) -&gt; x.substring(0);</span>
<span class="line-modified">469                 void m(String name) {</span>
<span class="line-modified">470                 var tmp = new Thread(() -&gt; { }, f.apply(name));</span>
<span class="line-modified">471                 }</span>
<span class="line-added">472             }</span>
<span class="line-added">473             &quot;&quot;&quot;</span>
<span class="line-added">474         );</span>
<span class="line-added">475 </span>
<span class="line-added">476         /*</span>
<span class="line-added">477          * Create a file with a new feature in 14, not in 13 : switch expressions</span>
<span class="line-added">478          */</span>
<span class="line-added">479         writeSourceFile(&quot;New14.java&quot;,</span>
<span class="line-added">480             &quot;&quot;&quot;</span>
<span class="line-added">481             public class New14 {</span>
<span class="line-added">482                 static {</span>
<span class="line-added">483                     int i = 5;</span>
<span class="line-added">484                     System.out.println(</span>
<span class="line-added">485                         switch(i) {</span>
<span class="line-added">486                             case 0 -&gt; false;</span>
<span class="line-added">487                             default -&gt; true;</span>
<span class="line-added">488                         }</span>
<span class="line-added">489                     );</span>
<span class="line-added">490                 }</span>
<span class="line-added">491             }</span>
<span class="line-added">492             &quot;&quot;&quot;</span>
<span class="line-added">493         );</span>
<span class="line-added">494 </span>
<span class="line-added">495         /*</span>
<span class="line-added">496          * Create a file with a new feature in 15, not in 14 : text blocks</span>
<span class="line-added">497          */</span>
<span class="line-added">498         writeSourceFile(&quot;New15.java&quot;,</span>
<span class="line-added">499             &quot;&quot;&quot;</span>
<span class="line-added">500             public class New15 {</span>
<span class="line-added">501                 public static final String s =</span>
<span class="line-added">502                 \&quot;\&quot;\&quot;</span>
<span class="line-added">503                 Hello, World.</span>
<span class="line-added">504                 \&quot;\&quot;\&quot;</span>
<span class="line-added">505                 ;</span>
<span class="line-added">506             }</span>
<span class="line-added">507             &quot;&quot;&quot;</span>
508         );
509     }
510 
511     protected boolean checkClassFileVersion
512         (String filename,String classVersionNumber) {
513         ByteBuffer bb = ByteBuffer.allocate(1024);
514         try (FileChannel fc = new FileInputStream(filename).getChannel()) {
515             bb.clear();
516             if (fc.read(bb) &lt; 0)
517                 throw new IOException(&quot;Could not read from file : &quot; + filename);
518             bb.flip();
519             int minor = bb.getShort(4);
520             int major = bb.getShort(6);
521             String fileVersion = major + &quot;.&quot; + minor;
522             if (fileVersion.equals(classVersionNumber)) {
523                 return true;
524             } else {
525                 System.err.println(&quot;checkClassFileVersion : Failed&quot;);
526                 System.err.println(&quot;\tclassfile version mismatch&quot;);
527                 System.err.println(&quot;\texpected : &quot; + classVersionNumber);
</pre>
</td>
</tr>
</table>
<center><a href="../records/VarargsRecordsTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../lib/jdk/test/lib/Convert.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>