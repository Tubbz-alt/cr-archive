<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/main/EnvVariableTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../enum/T5081785.out.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../platform/CanHandleClassFilesTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/main/EnvVariableTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8173308
 27  * @summary Check JDK_JAVA_OPTIONS parsing behavior
 28  * @library /tools/lib
 29  * @modules jdk.compiler/com.sun.tools.javac.main
 30  * @build toolbox.ToolBox toolbox.TestRunner
 31  * @run main EnvVariableTest
 32  */
 33 
 34 import java.io.ByteArrayOutputStream;
 35 import java.io.IOException;
 36 import java.io.PrintStream;
 37 import java.nio.file.Path;



 38 
 39 import toolbox.*;
 40 
 41 import com.sun.tools.javac.main.CommandLine;
 42 
 43 public class EnvVariableTest extends TestRunner {
 44     final String testClasses;
 45     final ToolBox tb;
 46     final Path javaExePath;
 47     final ExecTask task;
 48     final PrintStream ostream;
 49     final ByteArrayOutputStream baos;
 50 
 51     public EnvVariableTest() {
 52         super(System.err);
 53         ostream = System.err;
 54         baos = new ByteArrayOutputStream();
 55         testClasses = System.getProperty(&quot;test.classes&quot;);
 56         tb = new ToolBox();
 57         javaExePath = tb.getJDKTool(&quot;java&quot;);
</pre>
<hr />
<pre>
118         task.args(&quot;--add-exports&quot;, &quot;jdk.compiler/com.sun.tools.javac.main=ALL-UNNAMED&quot;,
119                 &quot;-cp&quot;, testClasses, &quot;EnvVariableTest$Tester&quot;);
120         Task.Result tr = task.run(Task.Expect.SUCCESS);
121         String expected = Tester.arrayToString(expectedArgs);
122         String in = tr.getOutput(Task.OutputKind.STDOUT);
123         System.err.println(&quot;Matching...&quot;);
124         System.err.println(&quot;Obtained: &quot; + in);
125         System.err.println(&quot;Expected: &quot; + expected);
126         if (in.contains(expected)) {
127             System.err.println(&quot;....OK&quot;);
128             return;
129         }
130         throw new Exception(&quot;Expected strings not found&quot;);
131     }
132 
133     /**
134      * A tester class that is invoked to invoke the CommandLine class, and
135      * print the result.
136      */
137     public static class Tester {
<span class="line-modified">138         private static final String[] EMPTY_ARRAY = new String[0];</span>
139         static String arrayToString(String... args) {
<span class="line-modified">140             return String.join(&quot;, &quot;, args);</span>
141         }
142         public static void main(String... args) throws IOException {
143             try {
<span class="line-modified">144                 String[] argv = CommandLine.parse(&quot;JDK_JAVAC_OPTIONS&quot;, EMPTY_ARRAY);</span>
<span class="line-modified">145                 System.out.print(arrayToString(argv));</span>
146             } catch (CommandLine.UnmatchedQuote ex) {
147                 System.out.print(&quot;Exception: &quot; + ex.variableName);
148             }
149         }
150     }
151 }
</pre>
</td>
<td>
<hr />
<pre>
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8173308
 27  * @summary Check JDK_JAVA_OPTIONS parsing behavior
 28  * @library /tools/lib
 29  * @modules jdk.compiler/com.sun.tools.javac.main
 30  * @build toolbox.ToolBox toolbox.TestRunner
 31  * @run main EnvVariableTest
 32  */
 33 
 34 import java.io.ByteArrayOutputStream;
 35 import java.io.IOException;
 36 import java.io.PrintStream;
 37 import java.nio.file.Path;
<span class="line-added"> 38 import java.util.Arrays;</span>
<span class="line-added"> 39 import java.util.stream.Collectors;</span>
<span class="line-added"> 40 import java.util.List;</span>
 41 
 42 import toolbox.*;
 43 
 44 import com.sun.tools.javac.main.CommandLine;
 45 
 46 public class EnvVariableTest extends TestRunner {
 47     final String testClasses;
 48     final ToolBox tb;
 49     final Path javaExePath;
 50     final ExecTask task;
 51     final PrintStream ostream;
 52     final ByteArrayOutputStream baos;
 53 
 54     public EnvVariableTest() {
 55         super(System.err);
 56         ostream = System.err;
 57         baos = new ByteArrayOutputStream();
 58         testClasses = System.getProperty(&quot;test.classes&quot;);
 59         tb = new ToolBox();
 60         javaExePath = tb.getJDKTool(&quot;java&quot;);
</pre>
<hr />
<pre>
121         task.args(&quot;--add-exports&quot;, &quot;jdk.compiler/com.sun.tools.javac.main=ALL-UNNAMED&quot;,
122                 &quot;-cp&quot;, testClasses, &quot;EnvVariableTest$Tester&quot;);
123         Task.Result tr = task.run(Task.Expect.SUCCESS);
124         String expected = Tester.arrayToString(expectedArgs);
125         String in = tr.getOutput(Task.OutputKind.STDOUT);
126         System.err.println(&quot;Matching...&quot;);
127         System.err.println(&quot;Obtained: &quot; + in);
128         System.err.println(&quot;Expected: &quot; + expected);
129         if (in.contains(expected)) {
130             System.err.println(&quot;....OK&quot;);
131             return;
132         }
133         throw new Exception(&quot;Expected strings not found&quot;);
134     }
135 
136     /**
137      * A tester class that is invoked to invoke the CommandLine class, and
138      * print the result.
139      */
140     public static class Tester {
<span class="line-modified">141         private static final List&lt;String&gt; EMPTY_LIST = List.of();</span>
142         static String arrayToString(String... args) {
<span class="line-modified">143             return List.of(args).stream().collect(Collectors.joining(&quot;, &quot;));</span>
144         }
145         public static void main(String... args) throws IOException {
146             try {
<span class="line-modified">147                 List&lt;String&gt; argv = CommandLine.parse(&quot;JDK_JAVAC_OPTIONS&quot;, EMPTY_LIST);</span>
<span class="line-modified">148                 System.out.print(argv.stream().collect(Collectors.joining(&quot;, &quot;)));</span>
149             } catch (CommandLine.UnmatchedQuote ex) {
150                 System.out.print(&quot;Exception: &quot; + ex.variableName);
151             }
152         }
153     }
154 }
</pre>
</td>
</tr>
</table>
<center><a href="../enum/T5081785.out.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../platform/CanHandleClassFilesTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>