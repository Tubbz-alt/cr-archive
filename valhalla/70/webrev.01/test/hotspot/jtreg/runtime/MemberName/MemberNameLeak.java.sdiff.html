<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/runtime/MemberName/MemberNameLeak.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../CommandLine/VMDeprecatedOptions.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../ReservedStack/ReservedStackTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/MemberName/MemberNameLeak.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 86           keepAlive.add(mh1);
 87         }
 88 
 89         long after = wb.resolvedMethodItemsCount();
 90 
 91         System.out.println(&quot;wb.resolvedMethodItemsCount() after setup: &quot; + after);
 92 
 93         if (after == before) {
 94           throw new RuntimeException(&quot;Too few resolved methods&quot;);
 95         }
 96 
 97         keepAlive = null;
 98 
 99         // Wait until ServiceThread cleans ResolvedMethod table
100         int cnt = 0;
101         while (true) {
102           if (cnt++ % 30 == 0) {
103             System.gc();  // make mh unused
104           }
105 
<span class="line-modified">106           if (after != wb.resolvedMethodItemsCount()) {</span>
107             // Entries have been removed.
108             break;
109           }
110 
111           Thread.sleep(100);
112         }
113       }
114     }
115 
116     private static Path createGcLogPath(String prefix) throws IOException {
117         Path gcLog = Utils.createTempFile(prefix, &quot;log&quot;);
118         Files.delete(gcLog);
119         return gcLog;
120     }
121 
122     private static DateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
123 
124     public static void test(GC gc, boolean doConcurrent) throws Throwable {
125         Path gcLogPath = createGcLogPath(&quot;gc.&quot; + gc + &quot;.&quot; + doConcurrent);
126         System.err.println(&quot;test(&quot; + gc + &quot;, &quot; + doConcurrent + &quot;)&quot; + &quot; &quot; + dateFormat.format(new Date()));
</pre>
</td>
<td>
<hr />
<pre>
 86           keepAlive.add(mh1);
 87         }
 88 
 89         long after = wb.resolvedMethodItemsCount();
 90 
 91         System.out.println(&quot;wb.resolvedMethodItemsCount() after setup: &quot; + after);
 92 
 93         if (after == before) {
 94           throw new RuntimeException(&quot;Too few resolved methods&quot;);
 95         }
 96 
 97         keepAlive = null;
 98 
 99         // Wait until ServiceThread cleans ResolvedMethod table
100         int cnt = 0;
101         while (true) {
102           if (cnt++ % 30 == 0) {
103             System.gc();  // make mh unused
104           }
105 
<span class="line-modified">106           if (after &gt; wb.resolvedMethodItemsCount() + 50) {</span>
107             // Entries have been removed.
108             break;
109           }
110 
111           Thread.sleep(100);
112         }
113       }
114     }
115 
116     private static Path createGcLogPath(String prefix) throws IOException {
117         Path gcLog = Utils.createTempFile(prefix, &quot;log&quot;);
118         Files.delete(gcLog);
119         return gcLog;
120     }
121 
122     private static DateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
123 
124     public static void test(GC gc, boolean doConcurrent) throws Throwable {
125         Path gcLogPath = createGcLogPath(&quot;gc.&quot; + gc + &quot;.&quot; + doConcurrent);
126         System.err.println(&quot;test(&quot; + gc + &quot;, &quot; + doConcurrent + &quot;)&quot; + &quot; &quot; + dateFormat.format(new Date()));
</pre>
</td>
</tr>
</table>
<center><a href="../CommandLine/VMDeprecatedOptions.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../ReservedStack/ReservedStackTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>