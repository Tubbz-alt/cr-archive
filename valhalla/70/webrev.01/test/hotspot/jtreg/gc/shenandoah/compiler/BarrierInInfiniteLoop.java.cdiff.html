<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/jtreg/gc/shenandoah/compiler/BarrierInInfiniteLoop.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../compiler/profiling/TestProfileCounterOverflow.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../z/TestGarbageCollectorMXBean.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/gc/shenandoah/compiler/BarrierInInfiniteLoop.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 21,31 ***</span>
   * questions.
   */
  
  /**
   * @test
<span class="line-modified">!  * @bug 8237837</span>
   * @summary  Shenandoah: assert(mem == __null) failed: only one safepoint
   * @key gc
   * @requires vm.flavor == &quot;server&quot;
   * @requires vm.gc.Shenandoah &amp; !vm.graal.enabled
   *
<span class="line-modified">!  * @run main/othervm -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -Xcomp -XX:CompileOnly=BarrierInInfiniteLoop::test -XX:CompileCommand=quiet BarrierInInfiniteLoop</span>
   *
   */
  
  public class BarrierInInfiniteLoop {
      private static Object field1 = new Object();
      private static Object field2 = new Object();
  
      public static void main(String[] args) {
<span class="line-modified">!         test(false);</span>
      }
  
<span class="line-modified">!     private static void test(boolean flag) {</span>
          if (flag) {
              for (;;) {
                  field1 = field2;
              }
          }
      }
  }
<span class="line-new-header">--- 21,61 ---</span>
   * questions.
   */
  
  /**
   * @test
<span class="line-modified">!  * @bug 8237837 8244721</span>
   * @summary  Shenandoah: assert(mem == __null) failed: only one safepoint
   * @key gc
   * @requires vm.flavor == &quot;server&quot;
   * @requires vm.gc.Shenandoah &amp; !vm.graal.enabled
   *
<span class="line-modified">!  * @run main/othervm -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -Xcomp -XX:CompileOnly=BarrierInInfiniteLoop::test1</span>
<span class="line-added">+  *                   -XX:CompileOnly=BarrierInInfiniteLoop::test2 -XX:CompileOnly=BarrierInInfiniteLoop::test3 -XX:CompileCommand=quiet BarrierInInfiniteLoop</span>
   *
   */
  
  public class BarrierInInfiniteLoop {
      private static Object field1 = new Object();
      private static Object field2 = new Object();
<span class="line-added">+     private static int field3;</span>
  
      public static void main(String[] args) {
<span class="line-modified">!         test1(false);</span>
<span class="line-added">+         test2(false, false);</span>
<span class="line-added">+         test3(false);</span>
      }
  
<span class="line-modified">!     private static void test1(boolean flag) {</span>
          if (flag) {
              for (;;) {
                  field1 = field2;
              }
          }
      }
<span class="line-added">+ </span>
<span class="line-added">+     private static void test2(boolean flag1, boolean flag2) {</span>
<span class="line-added">+         if (flag1) {</span>
<span class="line-added">+             for (;;) {</span>
<span class="line-added">+                 for (;;) {</span>
<span class="line-added">+                     if (flag2) {</span>
<span class="line-added">+                         break;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                     field1 = field2;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private static void test3(boolean flag) {</span>
<span class="line-added">+         if (flag) {</span>
<span class="line-added">+             for (;;) {</span>
<span class="line-added">+                 for (;;) {</span>
<span class="line-added">+                     field3 = 42;</span>
<span class="line-added">+                     if (field1 == field2) {</span>
<span class="line-added">+                         break;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
  }
</pre>
<center><a href="../../../compiler/profiling/TestProfileCounterOverflow.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../z/TestGarbageCollectorMXBean.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>