<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/jdk/src/classes/build/tools/intpoly/FieldGen.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../generateemojidata/GenerateEmojiData.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../langtools/build.xml.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/jdk/src/classes/build/tools/intpoly/FieldGen.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 19,11 ***</span>
   * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   */
  
<span class="line-removed">- </span>
  /*
   * This file is used to generated optimized finite field implementations.
   */
  package build.tools.intpoly;
  
<span class="line-new-header">--- 19,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 168,10 ***</span>
<span class="line-new-header">--- 167,23 ---</span>
              &quot;P521OrderField&quot;, 28, 19, 1, 521,
              &quot;01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409&quot;,
              o521crSequence(19), orderFieldSmallCrSequence(19)
      );
  
<span class="line-added">+     static FieldParams O25519 = new FieldParams(</span>
<span class="line-added">+             &quot;Curve25519OrderField&quot;, 26, 10, 1, 252,</span>
<span class="line-added">+             &quot;1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed&quot;,</span>
<span class="line-added">+             orderFieldCrSequence(10), orderFieldSmallCrSequence(10)</span>
<span class="line-added">+     );</span>
<span class="line-added">+ </span>
<span class="line-added">+     static FieldParams O448 = new FieldParams(</span>
<span class="line-added">+             &quot;Curve448OrderField&quot;, 28, 16, 1, 446,</span>
<span class="line-added">+             &quot;3fffffffffffffffffffffffffffffffffffffffffffffffffffffff7cca23e9c44edb49aed63690216cc2728dc58f552378c292ab5844f3&quot;,</span>
<span class="line-added">+             //&quot;ffffffffffffffffffffffffffffffffffffffffffffffffffffffff7cca23e9c44edb49aed63690216cc2728dc58f552378c292ab5844f3&quot;,</span>
<span class="line-added">+             orderFieldCrSequence(16), orderFieldSmallCrSequence(16)</span>
<span class="line-added">+     );</span>
<span class="line-added">+ </span>
      private static List&lt;CarryReduce&gt; o521crSequence(int numLimbs) {
  
          // split the full reduce in half, with a carry in between
          List&lt;CarryReduce&gt; result = new ArrayList&lt;CarryReduce&gt;();
          result.addAll(fullCarry(2 * numLimbs));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 210,11 ***</span>
          result.addAll(fullCarry(numLimbs));
          return result;
      }
  
      static final FieldParams[] ALL_FIELDS = {
<span class="line-modified">!             P256, P384, P521, O256, O384, O521,</span>
      };
  
      public static class Term {
          private final int power;
          private final int coefficient;
<span class="line-new-header">--- 222,12 ---</span>
          result.addAll(fullCarry(numLimbs));
          return result;
      }
  
      static final FieldParams[] ALL_FIELDS = {
<span class="line-modified">!             Curve25519, Curve448,</span>
<span class="line-added">+             P256, P384, P521, O256, O384, O521, O25519, O448</span>
      };
  
      public static class Term {
          private final int power;
          private final int coefficient;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 320,20 ***</span>
<span class="line-new-header">--- 333,28 ---</span>
          }
  
          private Iterable&lt;Term&gt; buildTerms(BigInteger sub) {
              // split a large subtrahend into smaller terms
              // that are aligned with limbs
<span class="line-added">+             boolean negate = false;</span>
<span class="line-added">+             if (sub.compareTo(BigInteger.ZERO) &lt; 0) {</span>
<span class="line-added">+                 negate = true;</span>
<span class="line-added">+                 sub = sub.negate();</span>
<span class="line-added">+             }</span>
              List&lt;Term&gt; result = new ArrayList&lt;Term&gt;();
              BigInteger mod = BigInteger.valueOf(1 &lt;&lt; bitsPerLimb);
              int termIndex = 0;
              while (!sub.equals(BigInteger.ZERO)) {
                  int coef = sub.mod(mod).intValue();
                  boolean plusOne = false;
                  if (coef &gt; (1 &lt;&lt; (bitsPerLimb - 1))) {
                      coef = coef - (1 &lt;&lt; bitsPerLimb);
                      plusOne = true;
                  }
<span class="line-added">+                 if (negate) {</span>
<span class="line-added">+                     coef = 0 - coef;</span>
<span class="line-added">+                 }</span>
                  if (coef != 0) {
                      int pow = termIndex * bitsPerLimb;
                      result.add(new Term(pow, -coef));
                  }
                  sub = sub.shiftRight(bitsPerLimb);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 617,10 ***</span>
<span class="line-new-header">--- 638,18 ---</span>
          result.appendLine();
          result.appendLine(&quot;    super(BITS_PER_LIMB, NUM_LIMBS, MAX_ADDS, MODULUS);&quot;);
          result.appendLine();
          result.appendLine(&quot;}&quot;);
  
<span class="line-added">+         StringBuilder coqTerms = new StringBuilder(&quot;//&quot;);</span>
<span class="line-added">+         for (Term t : params.getTerms()) {</span>
<span class="line-added">+             coqTerms.append(&quot;(&quot; + t.getPower() + &quot;%nat,&quot;);</span>
<span class="line-added">+             coqTerms.append(t.getCoefficient() + &quot;)::&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         coqTerms.append(&quot;nil.&quot;);</span>
<span class="line-added">+         result.appendLine(coqTerms.toString());</span>
<span class="line-added">+ </span>
          result.appendLine(&quot;private static BigInteger evaluateModulus() {&quot;);
          result.incrIndent();
          result.appendLine(&quot;BigInteger result = BigInteger.valueOf(2).pow(&quot;
                  + params.getPower() + &quot;);&quot;);
          for (Term t : params.getTerms()) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 648,10 ***</span>
<span class="line-new-header">--- 677,45 ---</span>
          }
          result.appendLine(&quot;return result;&quot;);
          result.decrIndent();
          result.appendLine(&quot;}&quot;);
  
<span class="line-added">+         result.appendLine(&quot;@Override&quot;);</span>
<span class="line-added">+         result.appendLine(&quot;protected void reduceIn(long[] limbs, long v, int i) {&quot;);</span>
<span class="line-added">+         result.incrIndent();</span>
<span class="line-added">+         String c = &quot;v&quot;;</span>
<span class="line-added">+         for (Term t : params.getTerms()) {</span>
<span class="line-added">+             int reduceBits = params.getPower() - t.getPower();</span>
<span class="line-added">+             int coefficient = -1 * t.getCoefficient();</span>
<span class="line-added">+ </span>
<span class="line-added">+             String x = coefficient + &quot; * &quot; + c;</span>
<span class="line-added">+             String accOp = &quot;+=&quot;;</span>
<span class="line-added">+             String temp = null;</span>
<span class="line-added">+             if (coefficient == 1) {</span>
<span class="line-added">+                 x = c;</span>
<span class="line-added">+             } else if (coefficient == -1) {</span>
<span class="line-added">+                 x = c;</span>
<span class="line-added">+                 accOp = &quot;-=&quot;;</span>
<span class="line-added">+             } else {</span>
<span class="line-added">+                 temp = result.getTemporary(&quot;long&quot;, x);</span>
<span class="line-added">+                 x = temp;</span>
<span class="line-added">+             }</span>
<span class="line-added">+ </span>
<span class="line-added">+             if (reduceBits % params.getBitsPerLimb() == 0) {</span>
<span class="line-added">+                 int pos = reduceBits / params.getBitsPerLimb();</span>
<span class="line-added">+                 result.appendLine(&quot;limbs[i - &quot; + pos + &quot;] &quot; + accOp + &quot; &quot; + x + &quot;;&quot;);</span>
<span class="line-added">+             } else {</span>
<span class="line-added">+                 int secondPos = reduceBits / params.getBitsPerLimb();</span>
<span class="line-added">+                 int bitOffset = (secondPos + 1) * params.getBitsPerLimb() - reduceBits;</span>
<span class="line-added">+                 int rightBitOffset = params.getBitsPerLimb() - bitOffset;</span>
<span class="line-added">+                 result.appendLine(&quot;limbs[i - &quot; + (secondPos + 1) + &quot;] &quot; + accOp + &quot; (&quot; + x + &quot; &lt;&lt; &quot; + bitOffset + &quot;) &amp; LIMB_MASK;&quot;);</span>
<span class="line-added">+                 result.appendLine(&quot;limbs[i - &quot; + secondPos + &quot;] &quot; + accOp + &quot; &quot; + x + &quot; &gt;&gt; &quot; + rightBitOffset + &quot;;&quot;);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+         result.decrIndent();</span>
<span class="line-added">+         result.appendLine(&quot;}&quot;);</span>
<span class="line-added">+ </span>
          result.appendLine(&quot;@Override&quot;);
          result.appendLine(&quot;protected void finalCarryReduceLast(long[] limbs) {&quot;);
          result.incrIndent();
          int extraBits = params.getBitsPerLimb() * params.getNumLimbs()
                  - params.getPower();
</pre>
<center><a href="../generateemojidata/GenerateEmojiData.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../langtools/build.xml.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>