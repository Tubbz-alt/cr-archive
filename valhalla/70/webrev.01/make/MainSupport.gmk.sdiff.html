<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/MainSupport.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Main.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="TestImage.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/MainSupport.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
131   $(call Clean-native, $1)
132   $(call Clean-include, $1)
133 endef
134 
135 
136 ################################################################################
137 
138 PHASE_MAKEDIRS := $(TOPDIR)/make
139 
140 # Helper macro for DeclareRecipesForPhase
141 # Declare a recipe for calling the module and phase specific makefile.
142 # If there are multiple makefiles to call, create a rule for each topdir
143 # that contains a makefile with the target $module-$suffix-$repodir,
144 # (i.e: java.base-gensrc-src)
145 # Normally there is only one makefile, and the target will just be
146 # $module-$suffix
147 # Param 1: Name of list to add targets to
148 # Param 2: Module name
149 define DeclareRecipeForModuleMakefile
150   $2-$$($1_TARGET_SUFFIX):
<span class="line-modified">151         ifeq ($$($1_USE_WRAPPER), true)</span>
<span class="line-modified">152 	  +($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \</span>
<span class="line-modified">153 	      -f ModuleWrapper.gmk -I $$(TOPDIR)/make/common/modules  \</span>
<span class="line-modified">154 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \</span>
<span class="line-modified">155 	          $$(addsuffix /modules/$2, $$(PHASE_MAKEDIRS)) \</span>
<span class="line-modified">156 	      ) \</span>
<span class="line-removed">157 	      MODULE=$2 MAKEFILE_PREFIX=$$($1_FILE_PREFIX) $$($1_EXTRA_ARGS))</span>
<span class="line-removed">158         else</span>
<span class="line-removed">159 	  +($(CD) $$(TOPDIR)/make \</span>
<span class="line-removed">160 	  &amp;&amp; $(MAKE) $(MAKE_ARGS) \</span>
<span class="line-removed">161 	      -f modules/$2/$$($1_FILE_PREFIX).gmk -I $$(TOPDIR)/make/common/modules \</span>
<span class="line-removed">162 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \</span>
<span class="line-removed">163 	          $$(addsuffix /modules/$2, $$(PHASE_MAKEDIRS)) \</span>
<span class="line-removed">164 	      ) \</span>
<span class="line-removed">165 	      MODULE=$2 $$($1_EXTRA_ARGS) \</span>
<span class="line-removed">166 	  )</span>
<span class="line-removed">167         endif</span>
168 
169 endef
170 
171 # Helper macro for DeclareRecipesForPhase
172 # Param 1: Name of list to add targets to
173 # Param 2: Module name
174 define DeclareRecipesForPhaseAndModule
175   $1_$2_MAKEFILES := $$(strip $$(wildcard \
176       $$(addsuffix /modules/$2/$$($1_FILE_PREFIX).gmk, $$(PHASE_MAKEDIRS))))
177 
178   # Only declare recipes if there are makefiles to call
179   ifneq ($$($1_$2_MAKEFILES), )
180     # Add the top dir specific target to target list regardless of if recipe
181     # generation is disabled.
182     ifeq ($$($1_MULTIPLE_MAKEFILES), true)
183       $$(foreach d, $$($1_$2_TOPDIRS), \
184         $$(eval $1 += $2-$$($1_TARGET_SUFFIX)-$$(notdir $$d)))
185     endif
186     ifeq ($(NO_RECIPES),)
187       $$(eval $$(call DeclareRecipeForModuleMakefile,$1,$2))
188     endif
189     $1 += $2-$$($1_TARGET_SUFFIX)
190     $1_MODULES += $2
191   endif
192 endef
193 
194 # Declare recipes for a specific module and build phase if there are makefiles
195 # present for the specific combination.
196 # Param 1: Name of list to add targets to
197 # Named params:
198 # TARGET_SUFFIX : Suffix of target to create for recipe
199 # MAKE_SUBDIR : Subdir for this build phase
200 # FILE_PREFIX : File prefix for this build phase
<span class="line-removed">201 # USE_WRAPPER : Set to true to use ModuleWrapper.gmk</span>
202 # CHECK_MODULES : List of modules to try
203 # MULTIPLE_MAKEFILES : Set to true to handle makefiles for the same module and
204 #                      phase in multiple repos
205 # EXTRA_ARGS : Add extra make args to each makefile call
206 # Exported variables:
207 # $1_MODULES : All modules that had rules generated
208 # $1_TARGETS : All targets generated
209 define DeclareRecipesForPhase
210   $(foreach i,2 3 4 5 6 7 8, $(if $(strip $($i)),$(strip $1)_$(strip $($i)))$(NEWLINE))
211   $(if $(9),$(error Internal makefile error: Too many arguments to \
212       DeclareRecipesForPhase, please update MakeHelper.gmk))
213 
214   $$(foreach m, $$($(strip $1)_CHECK_MODULES), \
215       $$(eval $$(call DeclareRecipesForPhaseAndModule,$(strip $1),$$m)))
216 
217   $(strip $1)_TARGETS := $$($(strip $1))
218 endef
219 
220 ################################################################################
221 
</pre>
</td>
<td>
<hr />
<pre>
131   $(call Clean-native, $1)
132   $(call Clean-include, $1)
133 endef
134 
135 
136 ################################################################################
137 
138 PHASE_MAKEDIRS := $(TOPDIR)/make
139 
140 # Helper macro for DeclareRecipesForPhase
141 # Declare a recipe for calling the module and phase specific makefile.
142 # If there are multiple makefiles to call, create a rule for each topdir
143 # that contains a makefile with the target $module-$suffix-$repodir,
144 # (i.e: java.base-gensrc-src)
145 # Normally there is only one makefile, and the target will just be
146 # $module-$suffix
147 # Param 1: Name of list to add targets to
148 # Param 2: Module name
149 define DeclareRecipeForModuleMakefile
150   $2-$$($1_TARGET_SUFFIX):
<span class="line-modified">151 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \</span>
<span class="line-modified">152 	    -f ModuleWrapper.gmk -I $$(TOPDIR)/make/common/modules  \</span>
<span class="line-modified">153 	    $$(addprefix -I, $$(PHASE_MAKEDIRS) \</span>
<span class="line-modified">154 	        $$(addsuffix /modules/$2, $$(PHASE_MAKEDIRS)) \</span>
<span class="line-modified">155 	    ) \</span>
<span class="line-modified">156 	    MODULE=$2 MAKEFILE_PREFIX=$$($1_FILE_PREFIX) $$($1_EXTRA_ARGS))</span>











157 
158 endef
159 
160 # Helper macro for DeclareRecipesForPhase
161 # Param 1: Name of list to add targets to
162 # Param 2: Module name
163 define DeclareRecipesForPhaseAndModule
164   $1_$2_MAKEFILES := $$(strip $$(wildcard \
165       $$(addsuffix /modules/$2/$$($1_FILE_PREFIX).gmk, $$(PHASE_MAKEDIRS))))
166 
167   # Only declare recipes if there are makefiles to call
168   ifneq ($$($1_$2_MAKEFILES), )
169     # Add the top dir specific target to target list regardless of if recipe
170     # generation is disabled.
171     ifeq ($$($1_MULTIPLE_MAKEFILES), true)
172       $$(foreach d, $$($1_$2_TOPDIRS), \
173         $$(eval $1 += $2-$$($1_TARGET_SUFFIX)-$$(notdir $$d)))
174     endif
175     ifeq ($(NO_RECIPES),)
176       $$(eval $$(call DeclareRecipeForModuleMakefile,$1,$2))
177     endif
178     $1 += $2-$$($1_TARGET_SUFFIX)
179     $1_MODULES += $2
180   endif
181 endef
182 
183 # Declare recipes for a specific module and build phase if there are makefiles
184 # present for the specific combination.
185 # Param 1: Name of list to add targets to
186 # Named params:
187 # TARGET_SUFFIX : Suffix of target to create for recipe
188 # MAKE_SUBDIR : Subdir for this build phase
189 # FILE_PREFIX : File prefix for this build phase

190 # CHECK_MODULES : List of modules to try
191 # MULTIPLE_MAKEFILES : Set to true to handle makefiles for the same module and
192 #                      phase in multiple repos
193 # EXTRA_ARGS : Add extra make args to each makefile call
194 # Exported variables:
195 # $1_MODULES : All modules that had rules generated
196 # $1_TARGETS : All targets generated
197 define DeclareRecipesForPhase
198   $(foreach i,2 3 4 5 6 7 8, $(if $(strip $($i)),$(strip $1)_$(strip $($i)))$(NEWLINE))
199   $(if $(9),$(error Internal makefile error: Too many arguments to \
200       DeclareRecipesForPhase, please update MakeHelper.gmk))
201 
202   $$(foreach m, $$($(strip $1)_CHECK_MODULES), \
203       $$(eval $$(call DeclareRecipesForPhaseAndModule,$(strip $1),$$m)))
204 
205   $(strip $1)_TARGETS := $$($(strip $1))
206 endef
207 
208 ################################################################################
209 
</pre>
</td>
</tr>
</table>
<center><a href="Main.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="TestImage.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>