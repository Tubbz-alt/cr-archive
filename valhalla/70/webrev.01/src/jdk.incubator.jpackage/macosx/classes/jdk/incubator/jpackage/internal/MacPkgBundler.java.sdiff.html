<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jpackage/macosx/classes/jdk/incubator/jpackage/internal/MacPkgBundler.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MacDmgBundler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resources/DMGsetup.scpt.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/macosx/classes/jdk/incubator/jpackage/internal/MacPkgBundler.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
159 
160     private File getScripts_PreinstallFile(Map&lt;String, ? super Object&gt; params) {
161         return new File(SCRIPTS_DIR.fetchFrom(params), &quot;preinstall&quot;);
162     }
163 
164     private File getScripts_PostinstallFile(
165             Map&lt;String, ? super Object&gt; params) {
166         return new File(SCRIPTS_DIR.fetchFrom(params), &quot;postinstall&quot;);
167     }
168 
169     private String getAppIdentifier(Map&lt;String, ? super Object&gt; params) {
170         return MAC_CF_BUNDLE_IDENTIFIER.fetchFrom(params);
171     }
172 
173     private void preparePackageScripts(Map&lt;String, ? super Object&gt; params)
174             throws IOException {
175         Log.verbose(I18N.getString(&quot;message.preparing-scripts&quot;));
176 
177         Map&lt;String, String&gt; data = new HashMap&lt;&gt;();
178 
<span class="line-modified">179         Path appLocation = Path.of(MAC_INSTALL_DIR.fetchFrom(params),</span>
180                          APP_NAME.fetchFrom(params) + &quot;.app&quot;, &quot;Contents&quot;, &quot;app&quot;);
181 
<span class="line-modified">182         data.put(&quot;INSTALL_LOCATION&quot;, MAC_INSTALL_DIR.fetchFrom(params));</span>
183         data.put(&quot;APP_LOCATION&quot;, appLocation.toString());
184 
185         createResource(TEMPLATE_PREINSTALL_SCRIPT, params)
186                 .setCategory(I18N.getString(&quot;resource.pkg-preinstall-script&quot;))
187                 .setSubstitutionData(data)
188                 .saveToFile(getScripts_PreinstallFile(params));
189         getScripts_PreinstallFile(params).setExecutable(true, false);
190 
191         createResource(TEMPLATE_POSTINSTALL_SCRIPT, params)
192                 .setCategory(I18N.getString(&quot;resource.pkg-postinstall-script&quot;))
193                 .setSubstitutionData(data)
194                 .saveToFile(getScripts_PostinstallFile(params));
195         getScripts_PostinstallFile(params).setExecutable(true, false);
196     }
197 
198     private static String URLEncoding(String pkgName) throws URISyntaxException {
199         URI uri = new URI(null, null, pkgName, null);
200         return uri.toASCIIString();
201     }
202 
</pre>
<hr />
<pre>
389         IOUtils.copyRecursive(source, dest);
390 
391         return newRoot.toString();
392     }
393 
394     private File createPKG(Map&lt;String, ? super Object&gt; params,
395             File outdir, File appLocation) {
396         // generic find attempt
397         try {
398             File appPKG = getPackages_AppPackage(params);
399 
400             String root = getRoot(params, appLocation);
401 
402             // Generate default CPL file
403             File cpl = new File(CONFIG_ROOT.fetchFrom(params).getAbsolutePath()
404                     + File.separator + &quot;cpl.plist&quot;);
405             ProcessBuilder pb = new ProcessBuilder(&quot;pkgbuild&quot;,
406                     &quot;--root&quot;,
407                     root,
408                     &quot;--install-location&quot;,
<span class="line-modified">409                     MAC_INSTALL_DIR.fetchFrom(params),</span>
410                     &quot;--analyze&quot;,
411                     cpl.getAbsolutePath());
412 
413             IOUtils.exec(pb);
414 
415             patchCPLFile(cpl);
416 
417             preparePackageScripts(params);
418 
419             // build application package
420             pb = new ProcessBuilder(&quot;pkgbuild&quot;,
421                     &quot;--root&quot;,
422                     root,
423                     &quot;--install-location&quot;,
<span class="line-modified">424                     MAC_INSTALL_DIR.fetchFrom(params),</span>
425                     &quot;--component-plist&quot;,
426                     cpl.getAbsolutePath(),
427                     &quot;--scripts&quot;,
428                     SCRIPTS_DIR.fetchFrom(params).getAbsolutePath(),
429                     &quot;--identifier&quot;,
430                      MAC_CF_BUNDLE_IDENTIFIER.fetchFrom(params),
431                     appPKG.getAbsolutePath());
432             IOUtils.exec(pb);
433 
434             // build final package
435             File finalPKG = new File(outdir, INSTALLER_NAME.fetchFrom(params)
436                     + INSTALLER_SUFFIX.fetchFrom(params)
437                     + &quot;.pkg&quot;);
438             outdir.mkdirs();
439 
440             List&lt;String&gt; commandLine = new ArrayList&lt;&gt;();
441             commandLine.add(&quot;productbuild&quot;);
442 
443             commandLine.add(&quot;--resources&quot;);
444             commandLine.add(CONFIG_ROOT.fetchFrom(params).getAbsolutePath());
</pre>
</td>
<td>
<hr />
<pre>
159 
160     private File getScripts_PreinstallFile(Map&lt;String, ? super Object&gt; params) {
161         return new File(SCRIPTS_DIR.fetchFrom(params), &quot;preinstall&quot;);
162     }
163 
164     private File getScripts_PostinstallFile(
165             Map&lt;String, ? super Object&gt; params) {
166         return new File(SCRIPTS_DIR.fetchFrom(params), &quot;postinstall&quot;);
167     }
168 
169     private String getAppIdentifier(Map&lt;String, ? super Object&gt; params) {
170         return MAC_CF_BUNDLE_IDENTIFIER.fetchFrom(params);
171     }
172 
173     private void preparePackageScripts(Map&lt;String, ? super Object&gt; params)
174             throws IOException {
175         Log.verbose(I18N.getString(&quot;message.preparing-scripts&quot;));
176 
177         Map&lt;String, String&gt; data = new HashMap&lt;&gt;();
178 
<span class="line-modified">179         Path appLocation = Path.of(getInstallDir(params),</span>
180                          APP_NAME.fetchFrom(params) + &quot;.app&quot;, &quot;Contents&quot;, &quot;app&quot;);
181 
<span class="line-modified">182         data.put(&quot;INSTALL_LOCATION&quot;, getInstallDir(params));</span>
183         data.put(&quot;APP_LOCATION&quot;, appLocation.toString());
184 
185         createResource(TEMPLATE_PREINSTALL_SCRIPT, params)
186                 .setCategory(I18N.getString(&quot;resource.pkg-preinstall-script&quot;))
187                 .setSubstitutionData(data)
188                 .saveToFile(getScripts_PreinstallFile(params));
189         getScripts_PreinstallFile(params).setExecutable(true, false);
190 
191         createResource(TEMPLATE_POSTINSTALL_SCRIPT, params)
192                 .setCategory(I18N.getString(&quot;resource.pkg-postinstall-script&quot;))
193                 .setSubstitutionData(data)
194                 .saveToFile(getScripts_PostinstallFile(params));
195         getScripts_PostinstallFile(params).setExecutable(true, false);
196     }
197 
198     private static String URLEncoding(String pkgName) throws URISyntaxException {
199         URI uri = new URI(null, null, pkgName, null);
200         return uri.toASCIIString();
201     }
202 
</pre>
<hr />
<pre>
389         IOUtils.copyRecursive(source, dest);
390 
391         return newRoot.toString();
392     }
393 
394     private File createPKG(Map&lt;String, ? super Object&gt; params,
395             File outdir, File appLocation) {
396         // generic find attempt
397         try {
398             File appPKG = getPackages_AppPackage(params);
399 
400             String root = getRoot(params, appLocation);
401 
402             // Generate default CPL file
403             File cpl = new File(CONFIG_ROOT.fetchFrom(params).getAbsolutePath()
404                     + File.separator + &quot;cpl.plist&quot;);
405             ProcessBuilder pb = new ProcessBuilder(&quot;pkgbuild&quot;,
406                     &quot;--root&quot;,
407                     root,
408                     &quot;--install-location&quot;,
<span class="line-modified">409                     getInstallDir(params),</span>
410                     &quot;--analyze&quot;,
411                     cpl.getAbsolutePath());
412 
413             IOUtils.exec(pb);
414 
415             patchCPLFile(cpl);
416 
417             preparePackageScripts(params);
418 
419             // build application package
420             pb = new ProcessBuilder(&quot;pkgbuild&quot;,
421                     &quot;--root&quot;,
422                     root,
423                     &quot;--install-location&quot;,
<span class="line-modified">424                     getInstallDir(params),</span>
425                     &quot;--component-plist&quot;,
426                     cpl.getAbsolutePath(),
427                     &quot;--scripts&quot;,
428                     SCRIPTS_DIR.fetchFrom(params).getAbsolutePath(),
429                     &quot;--identifier&quot;,
430                      MAC_CF_BUNDLE_IDENTIFIER.fetchFrom(params),
431                     appPKG.getAbsolutePath());
432             IOUtils.exec(pb);
433 
434             // build final package
435             File finalPKG = new File(outdir, INSTALLER_NAME.fetchFrom(params)
436                     + INSTALLER_SUFFIX.fetchFrom(params)
437                     + &quot;.pkg&quot;);
438             outdir.mkdirs();
439 
440             List&lt;String&gt; commandLine = new ArrayList&lt;&gt;();
441             commandLine.add(&quot;productbuild&quot;);
442 
443             commandLine.add(&quot;--resources&quot;);
444             commandLine.add(CONFIG_ROOT.fetchFrom(params).getAbsolutePath());
</pre>
</td>
</tr>
</table>
<center><a href="MacDmgBundler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resources/DMGsetup.scpt.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>