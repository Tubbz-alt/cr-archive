<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.incubator.jpackage/windows/native/applauncher/WinLauncher.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../share/classes/jdk/incubator/jpackage/internal/OverridableResource.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.internal.vm.ci/share/classes/jdk.vm.ci.hotspot/src/jdk/vm/ci/hotspot/HotSpotResolvedObjectTypeImpl.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.incubator.jpackage/windows/native/applauncher/WinLauncher.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
119     try {
120         // Try load JVM DLL.
121         jvmDll = std::unique_ptr&lt;Dll&gt;(new Dll(jvm-&gt;getPath()));
122     } catch (const std::exception&amp;) {
123         // JVM DLL load failed, though it exists in file system.
124         try {
125             // Try adjust the DLL search paths with AddDllDirectory() WINAPI CALL
126             jvmDll = loadDllWithAddDllDirectory(jvm-&gt;getPath());
127         } catch (const std::exception&amp;) {
128             // AddDllDirectory() didn&#39;t work. Try altering PATH environment
129             // variable as the last resort.
130             jvmDll = loadDllWithAlteredPATH(jvm-&gt;getPath());
131         }
132     }
133 
134     jvm-&gt;launch();
135 }
136 
137 } // namespace
138 
<span class="line-removed">139 </span>
140 #ifndef JP_LAUNCHERW
141 
<span class="line-modified">142 int APIENTRY wmain() {</span>
143     return AppLauncher::launch(std::nothrow, launchApp);
144 }
145 
146 #else
147 
148 namespace {
149 
150 class LastErrorGuiLogAppender : public LogAppender {
151 public:
152     virtual void append(const LogEvent&amp; v) {
153         JP_TRY;
154 
155         const std::wstring msg = (tstrings::any()
156                 &lt;&lt; AppLauncher::lastErrorMsg()).wstr();
157         MessageBox(0, msg.c_str(),
158             FileUtils::basename(SysInfo::getProcessModulePath()).c_str(),
159             MB_ICONERROR | MB_OK);
160 
161         JP_CATCH_ALL;
162     }
</pre>
<hr />
<pre>
225         FILE *stdFILEHandle;
226     };
227 
228     std::unique_ptr&lt;Channel&gt; stdoutChannel;
229     std::unique_ptr&lt;Channel&gt; stderrChannel;
230 };
231 
232 
233 void launchAppW() {
234     std::unique_ptr&lt;Console&gt; console;
235     if (AppLauncher::isWithLogging()) {
236         console = std::unique_ptr&lt;Console&gt;(new Console());
237     }
238 
239     launchApp();
240 }
241 
242 } // namespace
243 
244 
<span class="line-modified">245 int APIENTRY wWinMain(HINSTANCE, HINSTANCE, LPWSTR, int) {</span>
246     LastErrorGuiLogAppender lastErrorLogAppender;
247     TeeLogAppender logAppender(&amp;AppLauncher::defaultLastErrorLogAppender(),
248             &amp;lastErrorLogAppender);
249     return AppLauncher::launch(std::nothrow, launchAppW, &amp;logAppender);
250 }
251 
252 #endif
</pre>
</td>
<td>
<hr />
<pre>
119     try {
120         // Try load JVM DLL.
121         jvmDll = std::unique_ptr&lt;Dll&gt;(new Dll(jvm-&gt;getPath()));
122     } catch (const std::exception&amp;) {
123         // JVM DLL load failed, though it exists in file system.
124         try {
125             // Try adjust the DLL search paths with AddDllDirectory() WINAPI CALL
126             jvmDll = loadDllWithAddDllDirectory(jvm-&gt;getPath());
127         } catch (const std::exception&amp;) {
128             // AddDllDirectory() didn&#39;t work. Try altering PATH environment
129             // variable as the last resort.
130             jvmDll = loadDllWithAlteredPATH(jvm-&gt;getPath());
131         }
132     }
133 
134     jvm-&gt;launch();
135 }
136 
137 } // namespace
138 

139 #ifndef JP_LAUNCHERW
140 
<span class="line-modified">141 int __cdecl  wmain() {</span>
142     return AppLauncher::launch(std::nothrow, launchApp);
143 }
144 
145 #else
146 
147 namespace {
148 
149 class LastErrorGuiLogAppender : public LogAppender {
150 public:
151     virtual void append(const LogEvent&amp; v) {
152         JP_TRY;
153 
154         const std::wstring msg = (tstrings::any()
155                 &lt;&lt; AppLauncher::lastErrorMsg()).wstr();
156         MessageBox(0, msg.c_str(),
157             FileUtils::basename(SysInfo::getProcessModulePath()).c_str(),
158             MB_ICONERROR | MB_OK);
159 
160         JP_CATCH_ALL;
161     }
</pre>
<hr />
<pre>
224         FILE *stdFILEHandle;
225     };
226 
227     std::unique_ptr&lt;Channel&gt; stdoutChannel;
228     std::unique_ptr&lt;Channel&gt; stderrChannel;
229 };
230 
231 
232 void launchAppW() {
233     std::unique_ptr&lt;Console&gt; console;
234     if (AppLauncher::isWithLogging()) {
235         console = std::unique_ptr&lt;Console&gt;(new Console());
236     }
237 
238     launchApp();
239 }
240 
241 } // namespace
242 
243 
<span class="line-modified">244 int __stdcall wWinMain(HINSTANCE, HINSTANCE, LPWSTR, int) {</span>
245     LastErrorGuiLogAppender lastErrorLogAppender;
246     TeeLogAppender logAppender(&amp;AppLauncher::defaultLastErrorLogAppender(),
247             &amp;lastErrorLogAppender);
248     return AppLauncher::launch(std::nothrow, launchAppW, &amp;logAppender);
249 }
250 
251 #endif
</pre>
</td>
</tr>
</table>
<center><a href="../../../share/classes/jdk/incubator/jpackage/internal/OverridableResource.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.internal.vm.ci/share/classes/jdk.vm.ci.hotspot/src/jdk/vm/ci/hotspot/HotSpotResolvedObjectTypeImpl.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>