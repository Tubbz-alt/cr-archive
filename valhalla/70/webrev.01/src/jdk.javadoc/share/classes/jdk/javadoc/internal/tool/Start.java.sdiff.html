<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/tool/Start.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../doclets/toolkit/builders/ModuleSummaryBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ToolOptions.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/tool/Start.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
223             final Collator collator = Collator.getInstance(Locale.US);
224             { collator.setStrength(Collator.PRIMARY); }
225 
226             @Override
227             public int compare(ToolOption o1, ToolOption o2) {
228                 return collator.compare(o1.primaryName, o2.primaryName);
229             }
230         };
231 
232         options.getSupportedOptions().stream()
233                     .filter(opt -&gt; opt.kind == kind)
234                     .sorted(comp)
235                     .forEach(this::showToolOption);
236     }
237 
238     private void showToolOption(ToolOption option) {
239         List&lt;String&gt; names = option.getNames();
240         String primaryName = option.primaryName;
241         String parameters;
242         if (option.hasArg || primaryName.endsWith(&quot;:&quot;)) {
<span class="line-modified">243             String sep = primaryName.equals(ToolOptions.J) || primaryName.endsWith(&quot;:&quot;) ? &quot;&quot; : &quot; &quot;;</span>



244             parameters = sep + option.getParameters(messager);
245         } else {
246             parameters = &quot;&quot;;
247         }
248         String description = option.getDescription(messager);
249         showOption(names, parameters, description);
250     }
251 
252     private void showDocletOptions(Option.Kind kind) {
253         String name = doclet.getName();
254         Set&lt;? extends Option&gt; options = getSupportedOptionsOf(doclet);
255         if (options.isEmpty()) {
256             return;
257         }
258         messager.notice(&quot;main.doclet.usage.header&quot;, name);
259 
260         Comparator&lt;Doclet.Option&gt; comp = new Comparator&lt;Doclet.Option&gt;() {
261             final Collator collator = Collator.getInstance(Locale.US);
262             { collator.setStrength(Collator.PRIMARY); }
263 
</pre>
<hr />
<pre>
324             }
325         }
326 
327         // Finally, show the description
328         messager.printNotice(LARGE_INDENT + description.replace(&quot;\n&quot;, &quot;\n&quot; + LARGE_INDENT));
329     }
330 
331 
332     /**
333      * Main program - external wrapper. In order to maintain backward
334      * CLI compatibility, the execution is dispatched to the appropriate
335      * Start mechanism, depending on the doclet variant.
336      *
337      * The doclet tests are performed in the begin method, further on,
338      * this is to minimize argument processing and most importantly the impact
339      * of class loader creation, needed to detect the doclet class variants.
340      */
341     @SuppressWarnings(&quot;deprecation&quot;)
342     Result begin(String... argv) {
343         // Preprocess @file arguments

344         try {
<span class="line-modified">345             argv = CommandLine.parse(argv);</span>
346         } catch (IOException e) {
347             error(&quot;main.cant.read&quot;, e.getMessage());
348             return ERROR;
349         }
<span class="line-modified">350         return begin(Arrays.asList(argv), Collections.emptySet());</span>
351     }
352 
353     // Called by the JSR 199 API
354     public boolean begin(Class&lt;?&gt; docletClass,
355                          Iterable&lt;String&gt; options,
356                          Iterable&lt;? extends JavaFileObject&gt; fileObjects)
357     {
358         this.docletClass = docletClass;
359         List&lt;String&gt; opts = new ArrayList&lt;&gt;();
360         for (String opt: options)
361             opts.add(opt);
362 
363         return begin(opts, fileObjects).isOK();
364     }
365 
366     private Result begin(List&lt;String&gt; options, Iterable&lt;? extends JavaFileObject&gt; fileObjects) {
367         fileManager = context.get(JavaFileManager.class);
368         if (fileManager == null) {
369             JavacFileManager.preRegister(context);
370             fileManager = context.get(JavaFileManager.class);
</pre>
</td>
<td>
<hr />
<pre>
223             final Collator collator = Collator.getInstance(Locale.US);
224             { collator.setStrength(Collator.PRIMARY); }
225 
226             @Override
227             public int compare(ToolOption o1, ToolOption o2) {
228                 return collator.compare(o1.primaryName, o2.primaryName);
229             }
230         };
231 
232         options.getSupportedOptions().stream()
233                     .filter(opt -&gt; opt.kind == kind)
234                     .sorted(comp)
235                     .forEach(this::showToolOption);
236     }
237 
238     private void showToolOption(ToolOption option) {
239         List&lt;String&gt; names = option.getNames();
240         String primaryName = option.primaryName;
241         String parameters;
242         if (option.hasArg || primaryName.endsWith(&quot;:&quot;)) {
<span class="line-modified">243             String sep = primaryName.endsWith(&quot;:&quot;)</span>
<span class="line-added">244                     || primaryName.equals(ToolOptions.AT)</span>
<span class="line-added">245                     || primaryName.equals(ToolOptions.J)</span>
<span class="line-added">246                     ? &quot;&quot; : &quot; &quot;;</span>
247             parameters = sep + option.getParameters(messager);
248         } else {
249             parameters = &quot;&quot;;
250         }
251         String description = option.getDescription(messager);
252         showOption(names, parameters, description);
253     }
254 
255     private void showDocletOptions(Option.Kind kind) {
256         String name = doclet.getName();
257         Set&lt;? extends Option&gt; options = getSupportedOptionsOf(doclet);
258         if (options.isEmpty()) {
259             return;
260         }
261         messager.notice(&quot;main.doclet.usage.header&quot;, name);
262 
263         Comparator&lt;Doclet.Option&gt; comp = new Comparator&lt;Doclet.Option&gt;() {
264             final Collator collator = Collator.getInstance(Locale.US);
265             { collator.setStrength(Collator.PRIMARY); }
266 
</pre>
<hr />
<pre>
327             }
328         }
329 
330         // Finally, show the description
331         messager.printNotice(LARGE_INDENT + description.replace(&quot;\n&quot;, &quot;\n&quot; + LARGE_INDENT));
332     }
333 
334 
335     /**
336      * Main program - external wrapper. In order to maintain backward
337      * CLI compatibility, the execution is dispatched to the appropriate
338      * Start mechanism, depending on the doclet variant.
339      *
340      * The doclet tests are performed in the begin method, further on,
341      * this is to minimize argument processing and most importantly the impact
342      * of class loader creation, needed to detect the doclet class variants.
343      */
344     @SuppressWarnings(&quot;deprecation&quot;)
345     Result begin(String... argv) {
346         // Preprocess @file arguments
<span class="line-added">347         List&lt;String&gt; allArgs;</span>
348         try {
<span class="line-modified">349             allArgs = CommandLine.parse(List.of(argv));</span>
350         } catch (IOException e) {
351             error(&quot;main.cant.read&quot;, e.getMessage());
352             return ERROR;
353         }
<span class="line-modified">354         return begin(allArgs, Collections.emptySet());</span>
355     }
356 
357     // Called by the JSR 199 API
358     public boolean begin(Class&lt;?&gt; docletClass,
359                          Iterable&lt;String&gt; options,
360                          Iterable&lt;? extends JavaFileObject&gt; fileObjects)
361     {
362         this.docletClass = docletClass;
363         List&lt;String&gt; opts = new ArrayList&lt;&gt;();
364         for (String opt: options)
365             opts.add(opt);
366 
367         return begin(opts, fileObjects).isOK();
368     }
369 
370     private Result begin(List&lt;String&gt; options, Iterable&lt;? extends JavaFileObject&gt; fileObjects) {
371         fileManager = context.get(JavaFileManager.class);
372         if (fileManager == null) {
373             JavacFileManager.preRegister(context);
374             fileManager = context.get(JavaFileManager.class);
</pre>
</td>
</tr>
</table>
<center><a href="../doclets/toolkit/builders/ModuleSummaryBuilder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ToolOptions.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>