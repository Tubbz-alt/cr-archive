<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.crypto.ec/share/classes/sun/security/ec/XECParameters.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SunEC.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="point/Point.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.crypto.ec/share/classes/sun/security/ec/XECParameters.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -27,22 +27,21 @@</span>
  
  import java.io.IOException;
  import java.math.BigInteger;
  import java.security.spec.AlgorithmParameterSpec;
  import java.security.spec.NamedParameterSpec;
<span class="udiff-line-removed">- import java.util.Collections;</span>
  import java.util.Map;
  import java.util.HashMap;
<span class="udiff-line-removed">- import java.util.Optional;</span>
  import java.util.function.Function;
<span class="udiff-line-removed">- import java.util.function.Supplier;</span>
  
  import sun.security.util.ObjectIdentifier;
  import sun.security.x509.AlgorithmId;
  
  public class XECParameters {
  
<span class="udiff-line-added">+     static ParametersMap&lt;XECParameters&gt; namedParams = new ParametersMap&lt;&gt;();</span>
<span class="udiff-line-added">+ </span>
      // Naming/identification parameters
      private final ObjectIdentifier oid;
      private final String name;
  
      // Curve/field parameters
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -104,14 +103,10 @@</span>
      }
      public String getName() {
          return name;
      }
  
<span class="udiff-line-removed">-     private static final Map&lt;Integer, XECParameters&gt; SIZE_MAP;</span>
<span class="udiff-line-removed">-     private static final Map&lt;ObjectIdentifier, XECParameters&gt; OID_MAP;</span>
<span class="udiff-line-removed">-     private static final Map&lt;String, XECParameters&gt; NAME_MAP;</span>
<span class="udiff-line-removed">- </span>
      static {
          final BigInteger TWO = BigInteger.valueOf(2);
  
          Map&lt;Integer, XECParameters&gt; bySize = new HashMap&lt;&gt;();
          Map&lt;ObjectIdentifier, XECParameters&gt; byOid = new HashMap&lt;&gt;();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -138,126 +133,50 @@</span>
  
          } catch (IOException ex) {
              // Unable to set X448 parameters---it will be disabled
          }
  
<span class="udiff-line-modified-removed">-         SIZE_MAP = Collections.unmodifiableMap(bySize);</span>
<span class="udiff-line-removed">-         OID_MAP = Collections.unmodifiableMap(byOid);</span>
<span class="udiff-line-removed">-         NAME_MAP = Collections.unmodifiableMap(byName);</span>
<span class="udiff-line-modified-added">+         namedParams.fix();</span>
      }
  
      private static void addParameters(int bits, BigInteger p, int a24,
          byte basePoint, int logCofactor, String objectId, String name,
          Map&lt;Integer, XECParameters&gt; bySize,
          Map&lt;ObjectIdentifier, XECParameters&gt; byOid,
          Map&lt;String, XECParameters&gt; byName) throws IOException {
  
<span class="udiff-line-modified-removed">-         ObjectIdentifier oid = new ObjectIdentifier(objectId);</span>
<span class="udiff-line-modified-added">+         ObjectIdentifier oid = ObjectIdentifier.of(objectId);</span>
          XECParameters params =
              new XECParameters(bits, p, a24, basePoint, logCofactor, oid, name);
<span class="udiff-line-modified-removed">-         bySize.put(bits, params);</span>
<span class="udiff-line-removed">-         byOid.put(oid, params);</span>
<span class="udiff-line-removed">-         byName.put(name.toLowerCase(), params);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     public static Optional&lt;XECParameters&gt; getByOid(ObjectIdentifier id) {</span>
<span class="udiff-line-removed">-         return Optional.ofNullable(OID_MAP.get(id));</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     public static Optional&lt;XECParameters&gt; getBySize(int size) {</span>
<span class="udiff-line-removed">-         return Optional.ofNullable(SIZE_MAP.get(size));</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     public static Optional&lt;XECParameters&gt; getByName(String name) {</span>
<span class="udiff-line-removed">-         return Optional.ofNullable(NAME_MAP.get(name.toLowerCase()));</span>
<span class="udiff-line-modified-added">+         namedParams.put(name.toLowerCase(), oid, bits, params);</span>
      }
  
      boolean oidEquals(XECParameters other) {
          return oid.equals(other.getOid());
      }
  
<span class="udiff-line-removed">-     // Utility method that is used by the methods below to handle exception</span>
<span class="udiff-line-removed">-     // suppliers</span>
<span class="udiff-line-removed">-     private static</span>
<span class="udiff-line-removed">-     &lt;A, B&gt; Supplier&lt;B&gt; apply(final Function&lt;A, B&gt; func, final A a) {</span>
<span class="udiff-line-removed">-         return new Supplier&lt;B&gt;() {</span>
<span class="udiff-line-removed">-             @Override</span>
<span class="udiff-line-removed">-             public B get() {</span>
<span class="udiff-line-removed">-                 return func.apply(a);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         };</span>
<span class="udiff-line-removed">-     }</span>
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Get parameters by key size, or throw an exception if no parameters are</span>
<span class="udiff-line-removed">-      * defined for the specified key size. This method is used in several</span>
<span class="udiff-line-removed">-      * contexts that should throw different exceptions when the parameters</span>
<span class="udiff-line-removed">-      * are not found. The first argument is a function that produces the</span>
<span class="udiff-line-removed">-      * desired exception.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param exception a function that produces an exception from a string</span>
<span class="udiff-line-removed">-      * @param size the desired key size</span>
<span class="udiff-line-removed">-      * @param &lt;T&gt; the type of exception that is thrown</span>
<span class="udiff-line-removed">-      * @return the parameters for the specified key size</span>
<span class="udiff-line-removed">-      * @throws T when suitable parameters do not exist</span>
<span class="udiff-line-removed">-      */</span>
      public static
      &lt;T extends Throwable&gt;
      XECParameters getBySize(Function&lt;String, T&gt; exception,
                              int size) throws T {
  
<span class="udiff-line-modified-removed">-         Optional&lt;XECParameters&gt; xecParams = getBySize(size);</span>
<span class="udiff-line-removed">-         return xecParams.orElseThrow(</span>
<span class="udiff-line-removed">-             apply(exception, &quot;Unsupported size: &quot; + size));</span>
<span class="udiff-line-modified-added">+         return namedParams.getBySize(exception, size);</span>
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Get parameters by algorithm ID, or throw an exception if no</span>
<span class="udiff-line-removed">-      * parameters are defined for the specified ID. This method is used in</span>
<span class="udiff-line-removed">-      * several contexts that should throw different exceptions when the</span>
<span class="udiff-line-removed">-      * parameters are not found. The first argument is a function that produces</span>
<span class="udiff-line-removed">-      * the desired exception.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param exception a function that produces an exception from a string</span>
<span class="udiff-line-removed">-      * @param algId the algorithm ID</span>
<span class="udiff-line-removed">-      * @param &lt;T&gt; the type of exception that is thrown</span>
<span class="udiff-line-removed">-      * @return the parameters for the specified algorithm ID</span>
<span class="udiff-line-removed">-      * @throws T when suitable parameters do not exist</span>
<span class="udiff-line-removed">-      */</span>
      public static
      &lt;T extends Throwable&gt;
      XECParameters get(Function&lt;String, T&gt; exception,
                        AlgorithmId algId) throws T {
  
<span class="udiff-line-modified-removed">-         Optional&lt;XECParameters&gt; xecParams = getByOid(algId.getOID());</span>
<span class="udiff-line-removed">-         return xecParams.orElseThrow(</span>
<span class="udiff-line-removed">-             apply(exception, &quot;Unsupported OID: &quot; + algId.getOID()));</span>
<span class="udiff-line-modified-added">+         return namedParams.get(exception, algId);</span>
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Get parameters by algorithm parameter spec, or throw an exception if no</span>
<span class="udiff-line-removed">-      * parameters are defined for the spec. This method is used in</span>
<span class="udiff-line-removed">-      * several contexts that should throw different exceptions when the</span>
<span class="udiff-line-removed">-      * parameters are not found. The first argument is a function that produces</span>
<span class="udiff-line-removed">-      * the desired exception.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param exception a function that produces an exception from a string</span>
<span class="udiff-line-removed">-      * @param params the algorithm parameters spec</span>
<span class="udiff-line-removed">-      * @param &lt;T&gt; the type of exception that is thrown</span>
<span class="udiff-line-removed">-      * @return the parameters for the spec</span>
<span class="udiff-line-removed">-      * @throws T when suitable parameters do not exist</span>
<span class="udiff-line-removed">-      */</span>
      public static
      &lt;T extends Throwable&gt;
      XECParameters get(Function&lt;String, T&gt; exception,
                        AlgorithmParameterSpec params) throws T {
  
<span class="udiff-line-modified-removed">-         if (params instanceof NamedParameterSpec) {</span>
<span class="udiff-line-removed">-             NamedParameterSpec namedParams = (NamedParameterSpec) params;</span>
<span class="udiff-line-removed">-             Optional&lt;XECParameters&gt; xecParams =</span>
<span class="udiff-line-removed">-                 getByName(namedParams.getName());</span>
<span class="udiff-line-removed">-             return xecParams.orElseThrow(</span>
<span class="udiff-line-removed">-                 apply(exception, &quot;Unsupported name: &quot; + namedParams.getName()));</span>
<span class="udiff-line-removed">-         } else {</span>
<span class="udiff-line-removed">-             throw exception.apply(&quot;Only NamedParameterSpec is supported.&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         return namedParams.get(exception, params);</span>
      }
  }
  
</pre>
<center><a href="SunEC.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="point/Point.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>