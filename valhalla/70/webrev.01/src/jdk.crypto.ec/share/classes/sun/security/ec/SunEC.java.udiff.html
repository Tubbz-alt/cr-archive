<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.crypto.ec/share/classes/sun/security/ec/SunEC.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../jdk.crypto.cryptoki/share/classes/sun/security/pkcs11/SunPKCS11.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="XECParameters.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.crypto.ec/share/classes/sun/security/ec/SunEC.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -29,20 +29,24 @@</span>
  import java.security.InvalidParameterException;
  import java.security.NoSuchAlgorithmException;
  import java.security.PrivilegedAction;
  import java.security.Provider;
  import java.security.ProviderException;
<span class="udiff-line-removed">- import java.util.Arrays;</span>
  import java.util.Collection;
  import java.util.Collections;
  import java.util.HashMap;
  import java.util.List;
<span class="udiff-line-modified-removed">- import java.util.regex.Pattern;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+ import sun.security.ec.ed.EdDSAAlgorithmParameters;</span>
<span class="udiff-line-added">+ import sun.security.ec.ed.EdDSAKeyFactory;</span>
<span class="udiff-line-added">+ import sun.security.ec.ed.EdDSAKeyPairGenerator;</span>
<span class="udiff-line-added">+ import sun.security.ec.ed.EdDSASignature;</span>
  import sun.security.util.CurveDB;
  import sun.security.util.NamedCurve;
  
  import static sun.security.util.SecurityConstants.PROVIDER_VER;
<span class="udiff-line-added">+ import static sun.security.util.SecurityProviderConstants.*;</span>
  
  /**
   * Provider class for the Elliptic Curve provider.
   * Supports EC keypair and parameter generation, ECDSA signing and
   * ECDH key agreement.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -90,20 +94,26 @@</span>
      // Check if native library support is disabled.
      static boolean isNativeDisabled() {
          return SunEC.disableNative;
      }
  
<span class="udiff-line-added">+     private static class ProviderServiceA extends ProviderService {</span>
<span class="udiff-line-added">+         ProviderServiceA(Provider p, String type, String algo, String cn,</span>
<span class="udiff-line-added">+             HashMap&lt;String, String&gt; attrs) {</span>
<span class="udiff-line-added">+             super(p, type, algo, cn, getAliases(algo), attrs);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      private static class ProviderService extends Provider.Service {
  
          ProviderService(Provider p, String type, String algo, String cn) {
              super(p, type, algo, cn, null, null);
          }
  
          ProviderService(Provider p, String type, String algo, String cn,
<span class="udiff-line-modified-removed">-             String[] aliases, HashMap&lt;String, String&gt; attrs) {</span>
<span class="udiff-line-modified-removed">-             super(p, type, algo, cn,</span>
<span class="udiff-line-removed">-                   (aliases == null? null : Arrays.asList(aliases)), attrs);</span>
<span class="udiff-line-modified-added">+             List&lt;String&gt; aliases, HashMap&lt;String, String&gt; attrs) {</span>
<span class="udiff-line-modified-added">+             super(p, type, algo, cn, aliases, attrs);</span>
          }
  
          @Override
          public Object newInstance(Object ctrParamObj)
              throws NoSuchAlgorithmException {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -114,10 +124,19 @@</span>
              }
  
              String algo = getAlgorithm();
              try {
                  if (type.equals(&quot;Signature&quot;)) {
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                     if (algo.equalsIgnoreCase(&quot;EdDSA&quot;)) {</span>
<span class="udiff-line-added">+                         return new EdDSASignature();</span>
<span class="udiff-line-added">+                     } else if (algo.equalsIgnoreCase(&quot;Ed25519&quot;)) {</span>
<span class="udiff-line-added">+                         return new EdDSASignature.Ed25519();</span>
<span class="udiff-line-added">+                     } else if (algo.equalsIgnoreCase(&quot;Ed448&quot;)) {</span>
<span class="udiff-line-added">+                         return new EdDSASignature.Ed448();</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+ </span>
                      boolean inP1363 = algo.endsWith(&quot;inP1363Format&quot;);
                      if (inP1363) {
                          algo = algo.substring(0, algo.length() - 13);
                      }
                      if (algo.equals(&quot;SHA1withECDSA&quot;)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -146,10 +165,16 @@</span>
                          return new XDHKeyFactory();
                      } else if (algo.equals(&quot;X25519&quot;)) {
                          return new XDHKeyFactory.X25519();
                      } else if (algo.equals(&quot;X448&quot;)) {
                          return new XDHKeyFactory.X448();
<span class="udiff-line-added">+                     } else if (algo.equalsIgnoreCase(&quot;EdDSA&quot;)) {</span>
<span class="udiff-line-added">+                         return new EdDSAKeyFactory();</span>
<span class="udiff-line-added">+                     } else if (algo.equalsIgnoreCase(&quot;Ed25519&quot;)) {</span>
<span class="udiff-line-added">+                         return new EdDSAKeyFactory.Ed25519();</span>
<span class="udiff-line-added">+                     } else if (algo.equalsIgnoreCase(&quot;Ed448&quot;)) {</span>
<span class="udiff-line-added">+                         return new EdDSAKeyFactory.Ed448();</span>
                      }
                  } else  if (type.equals(&quot;AlgorithmParameters&quot;)) {
                      if (algo.equals(&quot;EC&quot;)) {
                          return new sun.security.util.ECParameters();
                      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -160,10 +185,16 @@</span>
                          return new XDHKeyPairGenerator();
                      } else if (algo.equals(&quot;X25519&quot;)) {
                          return new XDHKeyPairGenerator.X25519();
                      } else if (algo.equals(&quot;X448&quot;)) {
                          return new XDHKeyPairGenerator.X448();
<span class="udiff-line-added">+                     } else if (algo.equalsIgnoreCase(&quot;EdDSA&quot;)) {</span>
<span class="udiff-line-added">+                         return new EdDSAKeyPairGenerator();</span>
<span class="udiff-line-added">+                     } else if (algo.equalsIgnoreCase(&quot;Ed25519&quot;)) {</span>
<span class="udiff-line-added">+                         return new EdDSAKeyPairGenerator.Ed25519();</span>
<span class="udiff-line-added">+                     } else if (algo.equalsIgnoreCase(&quot;Ed448&quot;)) {</span>
<span class="udiff-line-added">+                         return new EdDSAKeyPairGenerator.Ed448();</span>
                      }
                  } else  if (type.equals(&quot;KeyAgreement&quot;)) {
                      if (algo.equals(&quot;ECDH&quot;)) {
                          return new ECDHKeyAgreement();
                      } else if (algo.equals(&quot;XDH&quot;)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -182,12 +213,11 @@</span>
                  &quot; &quot; + type);
          }
      }
  
      public SunEC() {
<span class="udiff-line-modified-removed">-         super(&quot;SunEC&quot;, PROVIDER_VER,</span>
<span class="udiff-line-removed">-             &quot;Sun Elliptic Curve provider (EC, ECDSA, ECDH)&quot;);</span>
<span class="udiff-line-modified-added">+         super(&quot;SunEC&quot;, PROVIDER_VER, &quot;Sun Elliptic Curve provider&quot;);</span>
          AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {
              public Void run() {
                  putEntries();
                  return null;
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -205,19 +235,18 @@</span>
          /*
           *  Key Factory engine
           */
          putService(new ProviderService(this, &quot;KeyFactory&quot;,
              &quot;EC&quot;, &quot;sun.security.ec.ECKeyFactory&quot;,
<span class="udiff-line-modified-removed">-             new String[] { &quot;EllipticCurve&quot; }, ATTRS));</span>
<span class="udiff-line-modified-added">+             List.of(&quot;EllipticCurve&quot;), ATTRS));</span>
  
          /*
           * Algorithm Parameter engine
           */
          // &quot;AlgorithmParameters.EC SupportedCurves&quot; prop used by unit test
          boolean firstCurve = true;
          StringBuilder names = new StringBuilder();
<span class="udiff-line-removed">-         Pattern nameSplitPattern = Pattern.compile(CurveDB.SPLIT_PATTERN);</span>
  
          Collection&lt;? extends NamedCurve&gt; supportedCurves;
          if (SunEC.isNativeDisabled()) {
              supportedCurves = Collections.unmodifiableList(List.of(
                      CurveDB.lookup(&quot;secp256r1&quot;),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -233,56 +262,49 @@</span>
              } else {
                  firstCurve = false;
              }
  
              names.append(&quot;[&quot;);
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-             String[] commonNames = nameSplitPattern.split(namedCurve.getName());</span>
<span class="udiff-line-modified-added">+             String[] commonNames = namedCurve.getNameAndAliases();</span>
              for (String commonName : commonNames) {
<span class="udiff-line-modified-removed">-                 names.append(commonName.trim());</span>
<span class="udiff-line-modified-added">+                 names.append(commonName);</span>
                  names.append(&quot;,&quot;);
              }
  
              names.append(namedCurve.getObjectId());
              names.append(&quot;]&quot;);
          }
  
          HashMap&lt;String, String&gt; apAttrs = new HashMap&lt;&gt;(ATTRS);
          apAttrs.put(&quot;SupportedCurves&quot;, names.toString());
  
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;AlgorithmParameters&quot;,</span>
<span class="udiff-line-modified-removed">-             &quot;EC&quot;, &quot;sun.security.util.ECParameters&quot;,</span>
<span class="udiff-line-removed">-             new String[] { &quot;EllipticCurve&quot;, &quot;1.2.840.10045.2.1&quot;, &quot;OID.1.2.840.10045.2.1&quot; },</span>
<span class="udiff-line-removed">-             apAttrs));</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;AlgorithmParameters&quot;,</span>
<span class="udiff-line-modified-added">+             &quot;EC&quot;, &quot;sun.security.util.ECParameters&quot;, apAttrs));</span>
  
          putXDHEntries();
<span class="udiff-line-added">+         putEdDSAEntries();</span>
  
          /*
           * Signature engines
           */
          putService(new ProviderService(this, &quot;Signature&quot;,
              &quot;NONEwithECDSA&quot;, &quot;sun.security.ec.ECDSASignature$Raw&quot;,
              null, ATTRS));
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;Signature&quot;,</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;Signature&quot;,</span>
              &quot;SHA1withECDSA&quot;, &quot;sun.security.ec.ECDSASignature$SHA1&quot;,
<span class="udiff-line-removed">-             new String[] { &quot;1.2.840.10045.4.1&quot;, &quot;OID.1.2.840.10045.4.1&quot; },</span>
              ATTRS));
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;Signature&quot;,</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;Signature&quot;,</span>
              &quot;SHA224withECDSA&quot;, &quot;sun.security.ec.ECDSASignature$SHA224&quot;,
<span class="udiff-line-removed">-             new String[] { &quot;1.2.840.10045.4.3.1&quot;, &quot;OID.1.2.840.10045.4.3.1&quot;},</span>
              ATTRS));
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;Signature&quot;,</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;Signature&quot;,</span>
              &quot;SHA256withECDSA&quot;, &quot;sun.security.ec.ECDSASignature$SHA256&quot;,
<span class="udiff-line-removed">-             new String[] { &quot;1.2.840.10045.4.3.2&quot;, &quot;OID.1.2.840.10045.4.3.2&quot;},</span>
              ATTRS));
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;Signature&quot;,</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;Signature&quot;,</span>
              &quot;SHA384withECDSA&quot;, &quot;sun.security.ec.ECDSASignature$SHA384&quot;,
<span class="udiff-line-removed">-             new String[] { &quot;1.2.840.10045.4.3.3&quot;, &quot;OID.1.2.840.10045.4.3.3&quot; },</span>
              ATTRS));
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;Signature&quot;,</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;Signature&quot;,</span>
              &quot;SHA512withECDSA&quot;, &quot;sun.security.ec.ECDSASignature$SHA512&quot;,
<span class="udiff-line-removed">-             new String[] { &quot;1.2.840.10045.4.3.4&quot;, &quot;OID.1.2.840.10045.4.3.4&quot; },</span>
              ATTRS));
  
          putService(new ProviderService(this, &quot;Signature&quot;,
               &quot;NONEwithECDSAinP1363Format&quot;,
               &quot;sun.security.ec.ECDSASignature$RawinP1363Format&quot;));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -305,11 +327,11 @@</span>
          /*
           *  Key Pair Generator engine
           */
          putService(new ProviderService(this, &quot;KeyPairGenerator&quot;,
              &quot;EC&quot;, &quot;sun.security.ec.ECKeyPairGenerator&quot;,
<span class="udiff-line-modified-removed">-             new String[] { &quot;EllipticCurve&quot; }, ATTRS));</span>
<span class="udiff-line-modified-added">+             List.of(&quot;EllipticCurve&quot;), ATTRS));</span>
  
          /*
           * Key Agreement engine
           */
          putService(new ProviderService(this, &quot;KeyAgreement&quot;,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -322,32 +344,62 @@</span>
          ATTRS.put(&quot;ImplementedIn&quot;, &quot;Software&quot;);
  
          /* XDH does not require native implementation */
          putService(new ProviderService(this, &quot;KeyFactory&quot;,
              &quot;XDH&quot;, &quot;sun.security.ec.XDHKeyFactory&quot;, null, ATTRS));
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;KeyFactory&quot;,</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;KeyFactory&quot;,</span>
              &quot;X25519&quot;, &quot;sun.security.ec.XDHKeyFactory.X25519&quot;,
<span class="udiff-line-modified-removed">-             new String[]{&quot;1.3.101.110&quot;, &quot;OID.1.3.101.110&quot;}, ATTRS));</span>
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;KeyFactory&quot;,</span>
<span class="udiff-line-modified-added">+             ATTRS));</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;KeyFactory&quot;,</span>
              &quot;X448&quot;, &quot;sun.security.ec.XDHKeyFactory.X448&quot;,
<span class="udiff-line-modified-removed">-             new String[]{&quot;1.3.101.111&quot;, &quot;OID.1.3.101.111&quot;}, ATTRS));</span>
<span class="udiff-line-modified-added">+             ATTRS));</span>
  
          putService(new ProviderService(this, &quot;KeyPairGenerator&quot;,
              &quot;XDH&quot;, &quot;sun.security.ec.XDHKeyPairGenerator&quot;, null, ATTRS));
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;KeyPairGenerator&quot;,</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;KeyPairGenerator&quot;,</span>
              &quot;X25519&quot;, &quot;sun.security.ec.XDHKeyPairGenerator.X25519&quot;,
<span class="udiff-line-modified-removed">-             new String[]{&quot;1.3.101.110&quot;, &quot;OID.1.3.101.110&quot;}, ATTRS));</span>
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;KeyPairGenerator&quot;,</span>
<span class="udiff-line-modified-added">+             ATTRS));</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;KeyPairGenerator&quot;,</span>
              &quot;X448&quot;, &quot;sun.security.ec.XDHKeyPairGenerator.X448&quot;,
<span class="udiff-line-modified-removed">-             new String[]{&quot;1.3.101.111&quot;, &quot;OID.1.3.101.111&quot;}, ATTRS));</span>
<span class="udiff-line-modified-added">+             ATTRS));</span>
  
          putService(new ProviderService(this, &quot;KeyAgreement&quot;,
              &quot;XDH&quot;, &quot;sun.security.ec.XDHKeyAgreement&quot;, null, ATTRS));
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;KeyAgreement&quot;,</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;KeyAgreement&quot;,</span>
              &quot;X25519&quot;, &quot;sun.security.ec.XDHKeyAgreement.X25519&quot;,
<span class="udiff-line-modified-removed">-             new String[]{&quot;1.3.101.110&quot;, &quot;OID.1.3.101.110&quot;}, ATTRS));</span>
<span class="udiff-line-modified-removed">-         putService(new ProviderService(this, &quot;KeyAgreement&quot;,</span>
<span class="udiff-line-modified-added">+             ATTRS));</span>
<span class="udiff-line-modified-added">+         putService(new ProviderServiceA(this, &quot;KeyAgreement&quot;,</span>
              &quot;X448&quot;, &quot;sun.security.ec.XDHKeyAgreement.X448&quot;,
<span class="udiff-line-modified-removed">-             new String[]{&quot;1.3.101.111&quot;, &quot;OID.1.3.101.111&quot;}, ATTRS));</span>
<span class="udiff-line-modified-added">+             ATTRS));</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private void putEdDSAEntries() {</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         HashMap&lt;String, String&gt; ATTRS = new HashMap&lt;&gt;(1);</span>
<span class="udiff-line-added">+         ATTRS.put(&quot;ImplementedIn&quot;, &quot;Software&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /* EdDSA does not require native implementation */</span>
<span class="udiff-line-added">+         putService(new ProviderService(this, &quot;KeyFactory&quot;,</span>
<span class="udiff-line-added">+             &quot;EdDSA&quot;, &quot;sun.security.ec.ed.EdDSAKeyFactory&quot;, null, ATTRS));</span>
<span class="udiff-line-added">+         putService(new ProviderServiceA(this, &quot;KeyFactory&quot;,</span>
<span class="udiff-line-added">+             &quot;Ed25519&quot;, &quot;sun.security.ec.ed.EdDSAKeyFactory.Ed25519&quot;, ATTRS));</span>
<span class="udiff-line-added">+         putService(new ProviderServiceA(this, &quot;KeyFactory&quot;,</span>
<span class="udiff-line-added">+             &quot;Ed448&quot;, &quot;sun.security.ec.ed.EdDSAKeyFactory.Ed448&quot;, ATTRS));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         putService(new ProviderService(this, &quot;KeyPairGenerator&quot;,</span>
<span class="udiff-line-added">+             &quot;EdDSA&quot;, &quot;sun.security.ec.ed.EdDSAKeyPairGenerator&quot;, null, ATTRS));</span>
<span class="udiff-line-added">+         putService(new ProviderServiceA(this, &quot;KeyPairGenerator&quot;,</span>
<span class="udiff-line-added">+             &quot;Ed25519&quot;, &quot;sun.security.ec.ed.EdDSAKeyPairGenerator.Ed25519&quot;,</span>
<span class="udiff-line-added">+             ATTRS));</span>
<span class="udiff-line-added">+         putService(new ProviderServiceA(this, &quot;KeyPairGenerator&quot;,</span>
<span class="udiff-line-added">+             &quot;Ed448&quot;, &quot;sun.security.ec.ed.EdDSAKeyPairGenerator.Ed448&quot;,</span>
<span class="udiff-line-added">+             ATTRS));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         putService(new ProviderService(this, &quot;Signature&quot;,</span>
<span class="udiff-line-added">+             &quot;EdDSA&quot;, &quot;sun.security.ec.ed.EdDSASignature&quot;, null, ATTRS));</span>
<span class="udiff-line-added">+         putService(new ProviderServiceA(this, &quot;Signature&quot;,</span>
<span class="udiff-line-added">+             &quot;Ed25519&quot;, &quot;sun.security.ec.ed.EdDSASignature.Ed25519&quot;, ATTRS));</span>
<span class="udiff-line-added">+         putService(new ProviderServiceA(this, &quot;Signature&quot;,</span>
<span class="udiff-line-added">+             &quot;Ed448&quot;, &quot;sun.security.ec.ed.EdDSASignature.Ed448&quot;, ATTRS));</span>
  
      }
  }
</pre>
<center><a href="../../../../../../jdk.crypto.cryptoki/share/classes/sun/security/pkcs11/SunPKCS11.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="XECParameters.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>