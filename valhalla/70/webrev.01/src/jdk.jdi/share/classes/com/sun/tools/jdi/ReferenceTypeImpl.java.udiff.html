<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.jdi/share/classes/com/sun/tools/jdi/ReferenceTypeImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PrimitiveValueImpl.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ValueImpl.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdi/share/classes/com/sun/tools/jdi/ReferenceTypeImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1149,44 +1149,32 @@</span>
          }
          this.genericSignatureGotten = true;
      }
  
      private static boolean isOneDimensionalPrimitiveArray(String signature) {
<span class="udiff-line-modified-removed">-         int i = signature.lastIndexOf(&#39;[&#39;);</span>
<span class="udiff-line-modified-removed">-         /*</span>
<span class="udiff-line-modified-removed">-          * TO DO: Centralize JNI signature knowledge.</span>
<span class="udiff-line-modified-removed">-          *</span>
<span class="udiff-line-removed">-          * Ref:</span>
<span class="udiff-line-removed">-          *  jdk1.4/doc/guide/jpda/jdi/com/sun/jdi/doc-files/signature.html</span>
<span class="udiff-line-removed">-          */</span>
<span class="udiff-line-removed">-         boolean isPA;</span>
<span class="udiff-line-removed">-         if (i &lt; 0 || signature.startsWith(&quot;[[&quot;)) {</span>
<span class="udiff-line-removed">-             isPA = false;</span>
<span class="udiff-line-removed">-         } else {</span>
<span class="udiff-line-removed">-             char c = signature.charAt(i + 1);</span>
<span class="udiff-line-removed">-             isPA = (c != &#39;L&#39; &amp;&amp; c != &#39;Q&#39;);</span>
<span class="udiff-line-modified-added">+         JNITypeParser sig = new JNITypeParser(signature);</span>
<span class="udiff-line-modified-added">+         if (sig.isArray()) {</span>
<span class="udiff-line-modified-added">+             JNITypeParser componentSig = new JNITypeParser(sig.componentSignature());</span>
<span class="udiff-line-modified-added">+             return componentSig.isPrimitive();</span>
          }
<span class="udiff-line-modified-removed">-         return isPA;</span>
<span class="udiff-line-modified-added">+         return false;</span>
      }
  
      Type findType(String signature) throws ClassNotLoadedException {
          Type type;
<span class="udiff-line-modified-removed">-         if (signature.length() == 1) {</span>
<span class="udiff-line-modified-removed">-             /* OTI FIX: Must be a primitive type or the void type */</span>
<span class="udiff-line-modified-removed">-             char sig = signature.charAt(0);</span>
<span class="udiff-line-modified-removed">-             if (sig == &#39;V&#39;) {</span>
<span class="udiff-line-modified-removed">-                 type = vm.theVoidType();</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 type = vm.primitiveTypeMirror((byte)sig);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+         JNITypeParser sig = new JNITypeParser(signature);</span>
<span class="udiff-line-modified-added">+         if (sig.isVoid()) {</span>
<span class="udiff-line-modified-added">+             type = vm.theVoidType();</span>
<span class="udiff-line-modified-added">+         } else if (sig.isPrimitive()) {</span>
<span class="udiff-line-modified-added">+             type = vm.primitiveTypeMirror(sig.jdwpTag());</span>
          } else {
              // Must be a reference type.
              ClassLoaderReferenceImpl loader =
<span class="udiff-line-modified-removed">-                        (ClassLoaderReferenceImpl)classLoader();</span>
<span class="udiff-line-modified-added">+                     (ClassLoaderReferenceImpl) classLoader();</span>
              if ((loader == null) ||
<span class="udiff-line-modified-removed">-                 (isOneDimensionalPrimitiveArray(signature)) //Work around 4450091</span>
<span class="udiff-line-modified-removed">-                 ) {</span>
<span class="udiff-line-modified-added">+                     (isOneDimensionalPrimitiveArray(signature)) //Work around 4450091</span>
<span class="udiff-line-modified-added">+             ) {</span>
                  // Caller wants type of boot class field
                  type = vm.findBootType(signature);
              } else {
                  // Caller wants type of non-boot class field
                  type = loader.findType(signature);
</pre>
<center><a href="PrimitiveValueImpl.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ValueImpl.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>