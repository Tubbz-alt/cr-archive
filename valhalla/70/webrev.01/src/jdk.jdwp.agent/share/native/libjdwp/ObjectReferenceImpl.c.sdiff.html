<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jdwp.agent/share/native/libjdwp/ObjectReferenceImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="ClassTypeImpl.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="eventHandler.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdwp.agent/share/native/libjdwp/ObjectReferenceImpl.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;util.h&quot;
 27 #include &quot;ObjectReferenceImpl.h&quot;
 28 #include &quot;commonRef.h&quot;
 29 #include &quot;inStream.h&quot;
 30 #include &quot;outStream.h&quot;

 31 
 32 static jboolean
 33 referenceType(PacketInputStream *in, PacketOutputStream *out)
 34 {
 35     JNIEnv *env;
 36     jobject object;
 37 
 38     env = getEnv();
 39 
 40     object = inStream_readObjectRef(env, in);
 41     if (inStream_error(in)) {
 42         return JNI_TRUE;
 43     }
 44 
 45     WITH_LOCAL_REFS(env, 1) {
 46 
 47         jbyte tag;
 48         jclass clazz;
 49 
 50         clazz = JNI_FUNC_PTR(env,GetObjectClass)(env, object);
 51         tag = referenceTypeTag(clazz);
 52 
 53         (void)outStream_writeByte(out, tag);
 54         (void)outStream_writeObjectRef(env, out, clazz);
 55 
 56     } END_WITH_LOCAL_REFS(env);
 57 
 58     return JNI_TRUE;
 59 }
 60 
 61 static jboolean
 62 getValues(PacketInputStream *in, PacketOutputStream *out)
 63 {
 64     sharedGetFieldValues(in, out, JNI_FALSE);
 65     return JNI_TRUE;
 66 }
 67 
<span class="line-removed"> 68 </span>
 69 static jvmtiError
 70 readFieldValue(JNIEnv *env, PacketInputStream *in, jclass clazz,
 71                jobject object, jfieldID field, char *signature)
 72 {
 73     jvalue value;
<span class="line-removed"> 74     jvmtiError error;</span>
<span class="line-removed"> 75 </span>
<span class="line-removed"> 76     switch (signature[0]) {</span>
<span class="line-removed"> 77         case JDWP_TAG(ARRAY):</span>
<span class="line-removed"> 78         case JDWP_TAG(OBJECT):</span>
<span class="line-removed"> 79 	case JDWP_TAG(INLINE_OBJECT):</span>
<span class="line-removed"> 80             value.l = inStream_readObjectRef(env, in);</span>
<span class="line-removed"> 81             JNI_FUNC_PTR(env,SetObjectField)(env, object, field, value.l);</span>
<span class="line-removed"> 82             break;</span>
 83 










 84         case JDWP_TAG(BYTE):
 85             value.b = inStream_readByte(in);
 86             JNI_FUNC_PTR(env,SetByteField)(env, object, field, value.b);
 87             break;
 88 
 89         case JDWP_TAG(CHAR):
 90             value.c = inStream_readChar(in);
 91             JNI_FUNC_PTR(env,SetCharField)(env, object, field, value.c);
 92             break;
 93 
 94         case JDWP_TAG(FLOAT):
 95             value.f = inStream_readFloat(in);
 96             JNI_FUNC_PTR(env,SetFloatField)(env, object, field, value.f);
 97             break;
 98 
 99         case JDWP_TAG(DOUBLE):
100             value.d = inStream_readDouble(in);
101             JNI_FUNC_PTR(env,SetDoubleField)(env, object, field, value.d);
102             break;
103 
</pre>
<hr />
<pre>
105             value.i = inStream_readInt(in);
106             JNI_FUNC_PTR(env,SetIntField)(env, object, field, value.i);
107             break;
108 
109         case JDWP_TAG(LONG):
110             value.j = inStream_readLong(in);
111             JNI_FUNC_PTR(env,SetLongField)(env, object, field, value.j);
112             break;
113 
114         case JDWP_TAG(SHORT):
115             value.s = inStream_readShort(in);
116             JNI_FUNC_PTR(env,SetShortField)(env, object, field, value.s);
117             break;
118 
119         case JDWP_TAG(BOOLEAN):
120             value.z = inStream_readBoolean(in);
121             JNI_FUNC_PTR(env,SetBooleanField)(env, object, field, value.z);
122             break;
123     }
124 
<span class="line-removed">125     error = JVMTI_ERROR_NONE;</span>
126     if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {
<span class="line-modified">127         error = AGENT_ERROR_JNI_EXCEPTION;</span>
128     }
<span class="line-modified">129 </span>
<span class="line-removed">130     return error;</span>
131 }
132 
133 static jboolean
134 setValues(PacketInputStream *in, PacketOutputStream *out)
135 {
136     JNIEnv *env;
137     jint count;
138     jvmtiError error;
139     jobject object;
140 
141     env = getEnv();
142 
143     object = inStream_readObjectRef(env, in);
144     if (inStream_error(in)) {
145         return JNI_TRUE;
146     }
147     count = inStream_readInt(in);
148     if (inStream_error(in)) {
149         return JNI_TRUE;
150     }
</pre>
</td>
<td>
<hr />
<pre>
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;util.h&quot;
 27 #include &quot;ObjectReferenceImpl.h&quot;
 28 #include &quot;commonRef.h&quot;
 29 #include &quot;inStream.h&quot;
 30 #include &quot;outStream.h&quot;
<span class="line-added"> 31 #include &quot;signature.h&quot;</span>
 32 
 33 static jboolean
 34 referenceType(PacketInputStream *in, PacketOutputStream *out)
 35 {
 36     JNIEnv *env;
 37     jobject object;
 38 
 39     env = getEnv();
 40 
 41     object = inStream_readObjectRef(env, in);
 42     if (inStream_error(in)) {
 43         return JNI_TRUE;
 44     }
 45 
 46     WITH_LOCAL_REFS(env, 1) {
 47 
 48         jbyte tag;
 49         jclass clazz;
 50 
 51         clazz = JNI_FUNC_PTR(env,GetObjectClass)(env, object);
 52         tag = referenceTypeTag(clazz);
 53 
 54         (void)outStream_writeByte(out, tag);
 55         (void)outStream_writeObjectRef(env, out, clazz);
 56 
 57     } END_WITH_LOCAL_REFS(env);
 58 
 59     return JNI_TRUE;
 60 }
 61 
 62 static jboolean
 63 getValues(PacketInputStream *in, PacketOutputStream *out)
 64 {
 65     sharedGetFieldValues(in, out, JNI_FALSE);
 66     return JNI_TRUE;
 67 }
 68 

 69 static jvmtiError
 70 readFieldValue(JNIEnv *env, PacketInputStream *in, jclass clazz,
 71                jobject object, jfieldID field, char *signature)
 72 {
 73     jvalue value;









 74 
<span class="line-added"> 75     jbyte typeKey = jdwpTag(signature);</span>
<span class="line-added"> 76     if (isReferenceTag(typeKey)) {</span>
<span class="line-added"> 77         value.l = inStream_readObjectRef(env, in);</span>
<span class="line-added"> 78         JNI_FUNC_PTR(env,SetObjectField)(env, object, field, value.l);</span>
<span class="line-added"> 79         if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {</span>
<span class="line-added"> 80             return AGENT_ERROR_JNI_EXCEPTION;</span>
<span class="line-added"> 81         }</span>
<span class="line-added"> 82         return JVMTI_ERROR_NONE;</span>
<span class="line-added"> 83     }</span>
<span class="line-added"> 84     switch (typeKey) {</span>
 85         case JDWP_TAG(BYTE):
 86             value.b = inStream_readByte(in);
 87             JNI_FUNC_PTR(env,SetByteField)(env, object, field, value.b);
 88             break;
 89 
 90         case JDWP_TAG(CHAR):
 91             value.c = inStream_readChar(in);
 92             JNI_FUNC_PTR(env,SetCharField)(env, object, field, value.c);
 93             break;
 94 
 95         case JDWP_TAG(FLOAT):
 96             value.f = inStream_readFloat(in);
 97             JNI_FUNC_PTR(env,SetFloatField)(env, object, field, value.f);
 98             break;
 99 
100         case JDWP_TAG(DOUBLE):
101             value.d = inStream_readDouble(in);
102             JNI_FUNC_PTR(env,SetDoubleField)(env, object, field, value.d);
103             break;
104 
</pre>
<hr />
<pre>
106             value.i = inStream_readInt(in);
107             JNI_FUNC_PTR(env,SetIntField)(env, object, field, value.i);
108             break;
109 
110         case JDWP_TAG(LONG):
111             value.j = inStream_readLong(in);
112             JNI_FUNC_PTR(env,SetLongField)(env, object, field, value.j);
113             break;
114 
115         case JDWP_TAG(SHORT):
116             value.s = inStream_readShort(in);
117             JNI_FUNC_PTR(env,SetShortField)(env, object, field, value.s);
118             break;
119 
120         case JDWP_TAG(BOOLEAN):
121             value.z = inStream_readBoolean(in);
122             JNI_FUNC_PTR(env,SetBooleanField)(env, object, field, value.z);
123             break;
124     }
125 

126     if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {
<span class="line-modified">127         return AGENT_ERROR_JNI_EXCEPTION;</span>
128     }
<span class="line-modified">129     return JVMTI_ERROR_NONE;</span>

130 }
131 
132 static jboolean
133 setValues(PacketInputStream *in, PacketOutputStream *out)
134 {
135     JNIEnv *env;
136     jint count;
137     jvmtiError error;
138     jobject object;
139 
140     env = getEnv();
141 
142     object = inStream_readObjectRef(env, in);
143     if (inStream_error(in)) {
144         return JNI_TRUE;
145     }
146     count = inStream_readInt(in);
147     if (inStream_error(in)) {
148         return JNI_TRUE;
149     }
</pre>
</td>
</tr>
</table>
<center><a href="ClassTypeImpl.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="eventHandler.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>