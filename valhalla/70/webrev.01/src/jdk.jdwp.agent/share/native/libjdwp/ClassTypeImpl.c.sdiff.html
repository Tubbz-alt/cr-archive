<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jdwp.agent/share/native/libjdwp/ClassTypeImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="ArrayTypeImpl.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ObjectReferenceImpl.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdwp.agent/share/native/libjdwp/ClassTypeImpl.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;util.h&quot;
 27 #include &quot;ClassTypeImpl.h&quot;
 28 #include &quot;inStream.h&quot;
 29 #include &quot;outStream.h&quot;

 30 
 31 static jboolean
 32 superclass(PacketInputStream *in, PacketOutputStream *out)
 33 {
 34     JNIEnv *env;
 35     jclass clazz;
 36 
 37     env = getEnv();
 38 
 39     clazz = inStream_readClassRef(env, in);
 40     if (inStream_error(in)) {
 41         return JNI_TRUE;
 42     }
 43 
 44     WITH_LOCAL_REFS(env, 1) {
 45 
 46         jclass superclass;
 47 
 48         superclass = JNI_FUNC_PTR(env,GetSuperclass)(env,clazz);
 49         (void)outStream_writeObjectRef(env, out, superclass);
 50 
 51     } END_WITH_LOCAL_REFS(env);
 52 
 53     return JNI_TRUE;
 54 }
 55 
 56 static jdwpError
 57 readStaticFieldValue(JNIEnv *env, PacketInputStream *in, jclass clazz,
 58                      jfieldID field, char *signature)
 59 {
 60     jvalue value;
<span class="line-modified"> 61     jdwpError serror = JDWP_ERROR(NONE);</span>
<span class="line-modified"> 62 </span>
<span class="line-modified"> 63     switch (signature[0]) {</span>
<span class="line-modified"> 64         case JDWP_TAG(ARRAY):</span>
<span class="line-modified"> 65         case JDWP_TAG(OBJECT):</span>
<span class="line-modified"> 66         case JDWP_TAG(INLINE_OBJECT):</span>
<span class="line-modified"> 67             value.l = inStream_readObjectRef(env, in);</span>
<span class="line-modified"> 68             JNI_FUNC_PTR(env,SetStaticObjectField)(env, clazz, field, value.l);</span>
<span class="line-modified"> 69             break;</span>

 70 

 71         case JDWP_TAG(BYTE):
 72             value.b = inStream_readByte(in);
 73             JNI_FUNC_PTR(env,SetStaticByteField)(env, clazz, field, value.b);
 74             break;
 75 
 76         case JDWP_TAG(CHAR):
 77             value.c = inStream_readChar(in);
 78             JNI_FUNC_PTR(env,SetStaticCharField)(env, clazz, field, value.c);
 79             break;
 80 
 81         case JDWP_TAG(FLOAT):
 82             value.f = inStream_readFloat(in);
 83             JNI_FUNC_PTR(env,SetStaticFloatField)(env, clazz, field, value.f);
 84             break;
 85 
 86         case JDWP_TAG(DOUBLE):
 87             value.d = inStream_readDouble(in);
 88             JNI_FUNC_PTR(env,SetStaticDoubleField)(env, clazz, field, value.d);
 89             break;
 90 
</pre>
<hr />
<pre>
 93             JNI_FUNC_PTR(env,SetStaticIntField)(env, clazz, field, value.i);
 94             break;
 95 
 96         case JDWP_TAG(LONG):
 97             value.j = inStream_readLong(in);
 98             JNI_FUNC_PTR(env,SetStaticLongField)(env, clazz, field, value.j);
 99             break;
100 
101         case JDWP_TAG(SHORT):
102             value.s = inStream_readShort(in);
103             JNI_FUNC_PTR(env,SetStaticShortField)(env, clazz, field, value.s);
104             break;
105 
106         case JDWP_TAG(BOOLEAN):
107             value.z = inStream_readBoolean(in);
108             JNI_FUNC_PTR(env,SetStaticBooleanField)(env, clazz, field, value.z);
109             break;
110     }
111 
112     if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {
<span class="line-modified">113         serror = JDWP_ERROR(INTERNAL);</span>
114     }
<span class="line-modified">115 </span>
<span class="line-removed">116     return serror;</span>
117 }
118 
119 static jboolean
120 setValues(PacketInputStream *in, PacketOutputStream *out)
121 {
122     JNIEnv *env;
123     jint count;
124     jclass clazz;
125 
126     env = getEnv();
127 
128     clazz = inStream_readClassRef(env, in);
129     if (inStream_error(in)) {
130         return JNI_TRUE;
131     }
132     count = inStream_readInt(in);
133     if (inStream_error(in)) {
134         return JNI_TRUE;
135     }
136 
</pre>
</td>
<td>
<hr />
<pre>
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;util.h&quot;
 27 #include &quot;ClassTypeImpl.h&quot;
 28 #include &quot;inStream.h&quot;
 29 #include &quot;outStream.h&quot;
<span class="line-added"> 30 #include &quot;signature.h&quot;</span>
 31 
 32 static jboolean
 33 superclass(PacketInputStream *in, PacketOutputStream *out)
 34 {
 35     JNIEnv *env;
 36     jclass clazz;
 37 
 38     env = getEnv();
 39 
 40     clazz = inStream_readClassRef(env, in);
 41     if (inStream_error(in)) {
 42         return JNI_TRUE;
 43     }
 44 
 45     WITH_LOCAL_REFS(env, 1) {
 46 
 47         jclass superclass;
 48 
 49         superclass = JNI_FUNC_PTR(env,GetSuperclass)(env,clazz);
 50         (void)outStream_writeObjectRef(env, out, superclass);
 51 
 52     } END_WITH_LOCAL_REFS(env);
 53 
 54     return JNI_TRUE;
 55 }
 56 
 57 static jdwpError
 58 readStaticFieldValue(JNIEnv *env, PacketInputStream *in, jclass clazz,
 59                      jfieldID field, char *signature)
 60 {
 61     jvalue value;
<span class="line-modified"> 62     jbyte typeKey = jdwpTag(signature);</span>
<span class="line-modified"> 63 </span>
<span class="line-modified"> 64     if (isReferenceTag(typeKey)) {</span>
<span class="line-modified"> 65         value.l = inStream_readObjectRef(env, in);</span>
<span class="line-modified"> 66         JNI_FUNC_PTR(env,SetStaticObjectField)(env, clazz, field, value.l);</span>
<span class="line-modified"> 67         if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {</span>
<span class="line-modified"> 68             return JDWP_ERROR(INTERNAL);</span>
<span class="line-modified"> 69         }</span>
<span class="line-modified"> 70         return JDWP_ERROR(NONE);</span>
<span class="line-added"> 71     }</span>
 72 
<span class="line-added"> 73     switch (typeKey) {</span>
 74         case JDWP_TAG(BYTE):
 75             value.b = inStream_readByte(in);
 76             JNI_FUNC_PTR(env,SetStaticByteField)(env, clazz, field, value.b);
 77             break;
 78 
 79         case JDWP_TAG(CHAR):
 80             value.c = inStream_readChar(in);
 81             JNI_FUNC_PTR(env,SetStaticCharField)(env, clazz, field, value.c);
 82             break;
 83 
 84         case JDWP_TAG(FLOAT):
 85             value.f = inStream_readFloat(in);
 86             JNI_FUNC_PTR(env,SetStaticFloatField)(env, clazz, field, value.f);
 87             break;
 88 
 89         case JDWP_TAG(DOUBLE):
 90             value.d = inStream_readDouble(in);
 91             JNI_FUNC_PTR(env,SetStaticDoubleField)(env, clazz, field, value.d);
 92             break;
 93 
</pre>
<hr />
<pre>
 96             JNI_FUNC_PTR(env,SetStaticIntField)(env, clazz, field, value.i);
 97             break;
 98 
 99         case JDWP_TAG(LONG):
100             value.j = inStream_readLong(in);
101             JNI_FUNC_PTR(env,SetStaticLongField)(env, clazz, field, value.j);
102             break;
103 
104         case JDWP_TAG(SHORT):
105             value.s = inStream_readShort(in);
106             JNI_FUNC_PTR(env,SetStaticShortField)(env, clazz, field, value.s);
107             break;
108 
109         case JDWP_TAG(BOOLEAN):
110             value.z = inStream_readBoolean(in);
111             JNI_FUNC_PTR(env,SetStaticBooleanField)(env, clazz, field, value.z);
112             break;
113     }
114 
115     if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {
<span class="line-modified">116         return JDWP_ERROR(INTERNAL);</span>
117     }
<span class="line-modified">118     return JDWP_ERROR(NONE);</span>

119 }
120 
121 static jboolean
122 setValues(PacketInputStream *in, PacketOutputStream *out)
123 {
124     JNIEnv *env;
125     jint count;
126     jclass clazz;
127 
128     env = getEnv();
129 
130     clazz = inStream_readClassRef(env, in);
131     if (inStream_error(in)) {
132         return JNI_TRUE;
133     }
134     count = inStream_readInt(in);
135     if (inStream_error(in)) {
136         return JNI_TRUE;
137     }
138 
</pre>
</td>
</tr>
</table>
<center><a href="ArrayTypeImpl.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ObjectReferenceImpl.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>