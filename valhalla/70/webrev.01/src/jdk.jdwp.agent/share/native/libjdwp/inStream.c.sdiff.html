<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jdwp.agent/share/native/libjdwp/inStream.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="eventHelper.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="inStream.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdwp.agent/share/native/libjdwp/inStream.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
407             jvmtiDeallocate(string);
408             return new_string;
409         }
410     }
411     return string;
412 }
413 
414 jdwpError
415 inStream_error(PacketInputStream *stream)
416 {
417     return stream-&gt;error;
418 }
419 
420 void
421 inStream_clearError(PacketInputStream *stream)
422 {
423     stream-&gt;error = JDWP_ERROR(NONE);
424 }
425 
426 jvalue
<span class="line-modified">427 inStream_readValue(PacketInputStream *stream, jbyte *typeKeyPtr)</span>
428 {
429     jvalue value;
430     jbyte typeKey = inStream_readByte(stream);
431     if (stream-&gt;error) {
432         value.j = 0L;
433         return value;
434     }
435 
436     if (isObjectTag(typeKey)) {
437         value.l = inStream_readObjectRef(getEnv(), stream);
438     } else {
439         switch (typeKey) {
440             case JDWP_TAG(BYTE):
441                 value.b = inStream_readByte(stream);
442                 break;
443 
444             case JDWP_TAG(CHAR):
445                 value.c = inStream_readChar(stream);
446                 break;
447 
</pre>
<hr />
<pre>
456             case JDWP_TAG(INT):
457                 value.i = inStream_readInt(stream);
458                 break;
459 
460             case JDWP_TAG(LONG):
461                 value.j = inStream_readLong(stream);
462                 break;
463 
464             case JDWP_TAG(SHORT):
465                 value.s = inStream_readShort(stream);
466                 break;
467 
468             case JDWP_TAG(BOOLEAN):
469                 value.z = inStream_readBoolean(stream);
470                 break;
471             default:
472                 stream-&gt;error = JDWP_ERROR(INVALID_TAG);
473                 break;
474         }
475     }
<span class="line-removed">476     if (typeKeyPtr) {</span>
<span class="line-removed">477         *typeKeyPtr = typeKey;</span>
<span class="line-removed">478     }</span>
479     return value;
480 }
481 
482 static jboolean
483 deleteRef(void *elementPtr, void *arg)
484 {
485     JNIEnv *env = arg;
486     jobject *refPtr = elementPtr;
487     commonRef_idToRef_delete(env, *refPtr);
488     return JNI_TRUE;
489 }
490 
491 void
492 inStream_destroy(PacketInputStream *stream)
493 {
494     if (stream-&gt;packet.type.cmd.data != NULL) {
495     jvmtiDeallocate(stream-&gt;packet.type.cmd.data);
496     }
497 
498     (void)bagEnumerateOver(stream-&gt;refs, deleteRef, (void *)getEnv());
</pre>
</td>
<td>
<hr />
<pre>
407             jvmtiDeallocate(string);
408             return new_string;
409         }
410     }
411     return string;
412 }
413 
414 jdwpError
415 inStream_error(PacketInputStream *stream)
416 {
417     return stream-&gt;error;
418 }
419 
420 void
421 inStream_clearError(PacketInputStream *stream)
422 {
423     stream-&gt;error = JDWP_ERROR(NONE);
424 }
425 
426 jvalue
<span class="line-modified">427 inStream_readValue(PacketInputStream *stream)</span>
428 {
429     jvalue value;
430     jbyte typeKey = inStream_readByte(stream);
431     if (stream-&gt;error) {
432         value.j = 0L;
433         return value;
434     }
435 
436     if (isObjectTag(typeKey)) {
437         value.l = inStream_readObjectRef(getEnv(), stream);
438     } else {
439         switch (typeKey) {
440             case JDWP_TAG(BYTE):
441                 value.b = inStream_readByte(stream);
442                 break;
443 
444             case JDWP_TAG(CHAR):
445                 value.c = inStream_readChar(stream);
446                 break;
447 
</pre>
<hr />
<pre>
456             case JDWP_TAG(INT):
457                 value.i = inStream_readInt(stream);
458                 break;
459 
460             case JDWP_TAG(LONG):
461                 value.j = inStream_readLong(stream);
462                 break;
463 
464             case JDWP_TAG(SHORT):
465                 value.s = inStream_readShort(stream);
466                 break;
467 
468             case JDWP_TAG(BOOLEAN):
469                 value.z = inStream_readBoolean(stream);
470                 break;
471             default:
472                 stream-&gt;error = JDWP_ERROR(INVALID_TAG);
473                 break;
474         }
475     }



476     return value;
477 }
478 
479 static jboolean
480 deleteRef(void *elementPtr, void *arg)
481 {
482     JNIEnv *env = arg;
483     jobject *refPtr = elementPtr;
484     commonRef_idToRef_delete(env, *refPtr);
485     return JNI_TRUE;
486 }
487 
488 void
489 inStream_destroy(PacketInputStream *stream)
490 {
491     if (stream-&gt;packet.type.cmd.data != NULL) {
492     jvmtiDeallocate(stream-&gt;packet.type.cmd.data);
493     }
494 
495     (void)bagEnumerateOver(stream-&gt;refs, deleteRef, (void *)getEnv());
</pre>
</td>
</tr>
</table>
<center><a href="eventHelper.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="inStream.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>