<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.jdwp.agent/share/native/libjdwp/eventHelper.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="eventHandler.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="inStream.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdwp.agent/share/native/libjdwp/eventHelper.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 26,10 ***</span>
<span class="line-new-header">--- 26,11 ---</span>
  #include &quot;util.h&quot;
  #include &quot;outStream.h&quot;
  #include &quot;eventHandler.h&quot;
  #include &quot;threadControl.h&quot;
  #include &quot;invoker.h&quot;
<span class="line-added">+ #include &quot;signature.h&quot;</span>
  
  
  #define COMMAND_LOOP_THREAD_NAME &quot;JDWP Event Helper Thread&quot;
  
  /*
</pre>
<hr />
<pre>
<span class="line-old-header">*** 477,11 ***</span>
      (void)outStream_writeInt(out, command-&gt;id);
      (void)outStream_writeObjectRef(env, out, command-&gt;thread);
      writeCodeLocation(out, command-&gt;clazz, command-&gt;method, command-&gt;location);
      if (command-&gt;typeKey) {
          (void)outStream_writeValue(env, out, command-&gt;typeKey, command-&gt;returnValue);
<span class="line-modified">!         if (isObjectTag(command-&gt;typeKey) &amp;&amp;</span>
              command-&gt;returnValue.l != NULL) {
              tossGlobalRef(env, &amp;(command-&gt;returnValue.l));
          }
      }
      tossGlobalRef(env, &amp;(command-&gt;thread));
<span class="line-new-header">--- 478,11 ---</span>
      (void)outStream_writeInt(out, command-&gt;id);
      (void)outStream_writeObjectRef(env, out, command-&gt;thread);
      writeCodeLocation(out, command-&gt;clazz, command-&gt;method, command-&gt;location);
      if (command-&gt;typeKey) {
          (void)outStream_writeValue(env, out, command-&gt;typeKey, command-&gt;returnValue);
<span class="line-modified">!         if (isReferenceTag(command-&gt;typeKey) &amp;&amp;</span>
              command-&gt;returnValue.l != NULL) {
              tossGlobalRef(env, &amp;(command-&gt;returnValue.l));
          }
      }
      tossGlobalRef(env, &amp;(command-&gt;thread));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 849,11 ***</span>
                  clazz = *pclazz;
                  *pclazz = NULL;
                  saveGlobalRef(env, clazz, pclazz);
              }
              sig = evinfo-&gt;u.field_modification.signature_type;
<span class="line-modified">!             if ((sig == JDWP_TAG(ARRAY)) || (sig == JDWP_TAG(OBJECT)) || (sig == JDWP_TAG(INLINE_OBJECT))) {</span>
                  if ( evinfo-&gt;u.field_modification.new_value.l != NULL ) {
                      pobject = &amp;(evinfo-&gt;u.field_modification.new_value.l);
                      object = *pobject;
                      *pobject = NULL;
                      saveGlobalRef(env, object, pobject);
<span class="line-new-header">--- 850,11 ---</span>
                  clazz = *pclazz;
                  *pclazz = NULL;
                  saveGlobalRef(env, clazz, pclazz);
              }
              sig = evinfo-&gt;u.field_modification.signature_type;
<span class="line-modified">!             if (isReferenceTag(sig)) {</span>
                  if ( evinfo-&gt;u.field_modification.new_value.l != NULL ) {
                      pobject = &amp;(evinfo-&gt;u.field_modification.new_value.l);
                      object = *pobject;
                      *pobject = NULL;
                      saveGlobalRef(env, object, pobject);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 902,11 ***</span>
          case EI_FIELD_MODIFICATION:
              if ( evinfo-&gt;u.field_modification.field_clazz != NULL ) {
                  tossGlobalRef(env, &amp;(evinfo-&gt;u.field_modification.field_clazz));
              }
              sig = evinfo-&gt;u.field_modification.signature_type;
<span class="line-modified">!             if ((sig == JDWP_TAG(ARRAY)) || (sig == JDWP_TAG(OBJECT)) || (sig == JDWP_TAG(INLINE_OBJECT))) {</span>
                  if ( evinfo-&gt;u.field_modification.new_value.l != NULL ) {
                      tossGlobalRef(env, &amp;(evinfo-&gt;u.field_modification.new_value.l));
                  }
              }
              break;
<span class="line-new-header">--- 903,11 ---</span>
          case EI_FIELD_MODIFICATION:
              if ( evinfo-&gt;u.field_modification.field_clazz != NULL ) {
                  tossGlobalRef(env, &amp;(evinfo-&gt;u.field_modification.field_clazz));
              }
              sig = evinfo-&gt;u.field_modification.signature_type;
<span class="line-modified">!             if (isReferenceTag(sig)) {</span>
                  if ( evinfo-&gt;u.field_modification.new_value.l != NULL ) {
                      tossGlobalRef(env, &amp;(evinfo-&gt;u.field_modification.new_value.l));
                  }
              }
              break;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1106,11 ***</span>
          JDI_ASSERT(err == JVMTI_ERROR_NONE);
  
          /*
           * V or B C D F I J S Z L &lt;classname&gt; ;    [ ComponentType
           */
<span class="line-modified">!         if (isObjectTag(frameCommand-&gt;typeKey) &amp;&amp;</span>
              returnValue.l != NULL) {
              saveGlobalRef(env, returnValue.l, &amp;(frameCommand-&gt;returnValue.l));
          } else {
              frameCommand-&gt;returnValue = returnValue;
          }
<span class="line-new-header">--- 1107,11 ---</span>
          JDI_ASSERT(err == JVMTI_ERROR_NONE);
  
          /*
           * V or B C D F I J S Z L &lt;classname&gt; ;    [ ComponentType
           */
<span class="line-modified">!         if (isReferenceTag(frameCommand-&gt;typeKey) &amp;&amp;</span>
              returnValue.l != NULL) {
              saveGlobalRef(env, returnValue.l, &amp;(frameCommand-&gt;returnValue.l));
          } else {
              frameCommand-&gt;returnValue = returnValue;
          }
</pre>
<center><a href="eventHandler.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="inStream.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>