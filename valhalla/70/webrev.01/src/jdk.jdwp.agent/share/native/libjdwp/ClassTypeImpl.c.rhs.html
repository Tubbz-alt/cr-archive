<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.jdwp.agent/share/native/libjdwp/ClassTypeImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;util.h&quot;
 27 #include &quot;ClassTypeImpl.h&quot;
 28 #include &quot;inStream.h&quot;
 29 #include &quot;outStream.h&quot;
<a name="1" id="anc1"></a><span class="line-added"> 30 #include &quot;signature.h&quot;</span>
 31 
 32 static jboolean
 33 superclass(PacketInputStream *in, PacketOutputStream *out)
 34 {
 35     JNIEnv *env;
 36     jclass clazz;
 37 
 38     env = getEnv();
 39 
 40     clazz = inStream_readClassRef(env, in);
 41     if (inStream_error(in)) {
 42         return JNI_TRUE;
 43     }
 44 
 45     WITH_LOCAL_REFS(env, 1) {
 46 
 47         jclass superclass;
 48 
 49         superclass = JNI_FUNC_PTR(env,GetSuperclass)(env,clazz);
 50         (void)outStream_writeObjectRef(env, out, superclass);
 51 
 52     } END_WITH_LOCAL_REFS(env);
 53 
 54     return JNI_TRUE;
 55 }
 56 
 57 static jdwpError
 58 readStaticFieldValue(JNIEnv *env, PacketInputStream *in, jclass clazz,
 59                      jfieldID field, char *signature)
 60 {
 61     jvalue value;
<a name="2" id="anc2"></a><span class="line-modified"> 62     jbyte typeKey = jdwpTag(signature);</span>
<span class="line-modified"> 63 </span>
<span class="line-modified"> 64     if (isReferenceTag(typeKey)) {</span>
<span class="line-modified"> 65         value.l = inStream_readObjectRef(env, in);</span>
<span class="line-modified"> 66         JNI_FUNC_PTR(env,SetStaticObjectField)(env, clazz, field, value.l);</span>
<span class="line-modified"> 67         if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {</span>
<span class="line-modified"> 68             return JDWP_ERROR(INTERNAL);</span>
<span class="line-modified"> 69         }</span>
<span class="line-modified"> 70         return JDWP_ERROR(NONE);</span>
<span class="line-added"> 71     }</span>
 72 
<a name="3" id="anc3"></a><span class="line-added"> 73     switch (typeKey) {</span>
 74         case JDWP_TAG(BYTE):
 75             value.b = inStream_readByte(in);
 76             JNI_FUNC_PTR(env,SetStaticByteField)(env, clazz, field, value.b);
 77             break;
 78 
 79         case JDWP_TAG(CHAR):
 80             value.c = inStream_readChar(in);
 81             JNI_FUNC_PTR(env,SetStaticCharField)(env, clazz, field, value.c);
 82             break;
 83 
 84         case JDWP_TAG(FLOAT):
 85             value.f = inStream_readFloat(in);
 86             JNI_FUNC_PTR(env,SetStaticFloatField)(env, clazz, field, value.f);
 87             break;
 88 
 89         case JDWP_TAG(DOUBLE):
 90             value.d = inStream_readDouble(in);
 91             JNI_FUNC_PTR(env,SetStaticDoubleField)(env, clazz, field, value.d);
 92             break;
 93 
 94         case JDWP_TAG(INT):
 95             value.i = inStream_readInt(in);
 96             JNI_FUNC_PTR(env,SetStaticIntField)(env, clazz, field, value.i);
 97             break;
 98 
 99         case JDWP_TAG(LONG):
100             value.j = inStream_readLong(in);
101             JNI_FUNC_PTR(env,SetStaticLongField)(env, clazz, field, value.j);
102             break;
103 
104         case JDWP_TAG(SHORT):
105             value.s = inStream_readShort(in);
106             JNI_FUNC_PTR(env,SetStaticShortField)(env, clazz, field, value.s);
107             break;
108 
109         case JDWP_TAG(BOOLEAN):
110             value.z = inStream_readBoolean(in);
111             JNI_FUNC_PTR(env,SetStaticBooleanField)(env, clazz, field, value.z);
112             break;
113     }
114 
115     if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {
<a name="4" id="anc4"></a><span class="line-modified">116         return JDWP_ERROR(INTERNAL);</span>
117     }
<a name="5" id="anc5"></a><span class="line-modified">118     return JDWP_ERROR(NONE);</span>

119 }
120 
121 static jboolean
122 setValues(PacketInputStream *in, PacketOutputStream *out)
123 {
124     JNIEnv *env;
125     jint count;
126     jclass clazz;
127 
128     env = getEnv();
129 
130     clazz = inStream_readClassRef(env, in);
131     if (inStream_error(in)) {
132         return JNI_TRUE;
133     }
134     count = inStream_readInt(in);
135     if (inStream_error(in)) {
136         return JNI_TRUE;
137     }
138 
139     WITH_LOCAL_REFS(env, count) {
140 
141         int i;
142 
143         for (i = 0; i &lt; count; i++) {
144 
145             jfieldID field;
146             char *signature = NULL;
147             jvmtiError error;
148             jdwpError serror;
149 
150             field = inStream_readFieldID(in);
151             if (inStream_error(in)) {
152                 break;
153             }
154 
155             error = fieldSignature(clazz, field, NULL, &amp;signature, NULL);
156             if (error != JVMTI_ERROR_NONE) {
157                 break;
158             }
159 
160             serror = readStaticFieldValue(env, in, clazz, field, signature);
161 
162             jvmtiDeallocate(signature);
163 
164             if ( serror != JDWP_ERROR(NONE) ) {
165                 break;
166             }
167 
168         }
169 
170     } END_WITH_LOCAL_REFS(env);
171 
172     return JNI_TRUE;
173 }
174 
175 static jboolean
176 invokeStatic(PacketInputStream *in, PacketOutputStream *out)
177 {
178     return sharedInvoke(in, out);
179 }
180 
181 Command ClassType_Commands[] = {
182     {superclass, &quot;Superclass&quot;},
183     {setValues, &quot;SetValues&quot;},
184     {invokeStatic, &quot;InvokeMethod&quot;},
185     {invokeStatic, &quot;NewInstance&quot;}
186 };
187 
188 DEBUG_DISPATCH_DEFINE_CMDSET(ClassType)
<a name="6" id="anc6"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="6" type="hidden" />
</body>
</html>