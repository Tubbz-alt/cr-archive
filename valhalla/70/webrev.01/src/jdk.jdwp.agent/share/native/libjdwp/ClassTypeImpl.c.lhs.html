<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.jdwp.agent/share/native/libjdwp/ClassTypeImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;util.h&quot;
 27 #include &quot;ClassTypeImpl.h&quot;
 28 #include &quot;inStream.h&quot;
 29 #include &quot;outStream.h&quot;
<a name="1" id="anc1"></a>
 30 
 31 static jboolean
 32 superclass(PacketInputStream *in, PacketOutputStream *out)
 33 {
 34     JNIEnv *env;
 35     jclass clazz;
 36 
 37     env = getEnv();
 38 
 39     clazz = inStream_readClassRef(env, in);
 40     if (inStream_error(in)) {
 41         return JNI_TRUE;
 42     }
 43 
 44     WITH_LOCAL_REFS(env, 1) {
 45 
 46         jclass superclass;
 47 
 48         superclass = JNI_FUNC_PTR(env,GetSuperclass)(env,clazz);
 49         (void)outStream_writeObjectRef(env, out, superclass);
 50 
 51     } END_WITH_LOCAL_REFS(env);
 52 
 53     return JNI_TRUE;
 54 }
 55 
 56 static jdwpError
 57 readStaticFieldValue(JNIEnv *env, PacketInputStream *in, jclass clazz,
 58                      jfieldID field, char *signature)
 59 {
 60     jvalue value;
<a name="2" id="anc2"></a><span class="line-modified"> 61     jdwpError serror = JDWP_ERROR(NONE);</span>
<span class="line-modified"> 62 </span>
<span class="line-modified"> 63     switch (signature[0]) {</span>
<span class="line-modified"> 64         case JDWP_TAG(ARRAY):</span>
<span class="line-modified"> 65         case JDWP_TAG(OBJECT):</span>
<span class="line-modified"> 66         case JDWP_TAG(INLINE_OBJECT):</span>
<span class="line-modified"> 67             value.l = inStream_readObjectRef(env, in);</span>
<span class="line-modified"> 68             JNI_FUNC_PTR(env,SetStaticObjectField)(env, clazz, field, value.l);</span>
<span class="line-modified"> 69             break;</span>

 70 
<a name="3" id="anc3"></a>
 71         case JDWP_TAG(BYTE):
 72             value.b = inStream_readByte(in);
 73             JNI_FUNC_PTR(env,SetStaticByteField)(env, clazz, field, value.b);
 74             break;
 75 
 76         case JDWP_TAG(CHAR):
 77             value.c = inStream_readChar(in);
 78             JNI_FUNC_PTR(env,SetStaticCharField)(env, clazz, field, value.c);
 79             break;
 80 
 81         case JDWP_TAG(FLOAT):
 82             value.f = inStream_readFloat(in);
 83             JNI_FUNC_PTR(env,SetStaticFloatField)(env, clazz, field, value.f);
 84             break;
 85 
 86         case JDWP_TAG(DOUBLE):
 87             value.d = inStream_readDouble(in);
 88             JNI_FUNC_PTR(env,SetStaticDoubleField)(env, clazz, field, value.d);
 89             break;
 90 
 91         case JDWP_TAG(INT):
 92             value.i = inStream_readInt(in);
 93             JNI_FUNC_PTR(env,SetStaticIntField)(env, clazz, field, value.i);
 94             break;
 95 
 96         case JDWP_TAG(LONG):
 97             value.j = inStream_readLong(in);
 98             JNI_FUNC_PTR(env,SetStaticLongField)(env, clazz, field, value.j);
 99             break;
100 
101         case JDWP_TAG(SHORT):
102             value.s = inStream_readShort(in);
103             JNI_FUNC_PTR(env,SetStaticShortField)(env, clazz, field, value.s);
104             break;
105 
106         case JDWP_TAG(BOOLEAN):
107             value.z = inStream_readBoolean(in);
108             JNI_FUNC_PTR(env,SetStaticBooleanField)(env, clazz, field, value.z);
109             break;
110     }
111 
112     if (JNI_FUNC_PTR(env,ExceptionOccurred)(env)) {
<a name="4" id="anc4"></a><span class="line-modified">113         serror = JDWP_ERROR(INTERNAL);</span>
114     }
<a name="5" id="anc5"></a><span class="line-modified">115 </span>
<span class="line-removed">116     return serror;</span>
117 }
118 
119 static jboolean
120 setValues(PacketInputStream *in, PacketOutputStream *out)
121 {
122     JNIEnv *env;
123     jint count;
124     jclass clazz;
125 
126     env = getEnv();
127 
128     clazz = inStream_readClassRef(env, in);
129     if (inStream_error(in)) {
130         return JNI_TRUE;
131     }
132     count = inStream_readInt(in);
133     if (inStream_error(in)) {
134         return JNI_TRUE;
135     }
136 
137     WITH_LOCAL_REFS(env, count) {
138 
139         int i;
140 
141         for (i = 0; i &lt; count; i++) {
142 
143             jfieldID field;
144             char *signature = NULL;
145             jvmtiError error;
146             jdwpError serror;
147 
148             field = inStream_readFieldID(in);
149             if (inStream_error(in)) {
150                 break;
151             }
152 
153             error = fieldSignature(clazz, field, NULL, &amp;signature, NULL);
154             if (error != JVMTI_ERROR_NONE) {
155                 break;
156             }
157 
158             serror = readStaticFieldValue(env, in, clazz, field, signature);
159 
160             jvmtiDeallocate(signature);
161 
162             if ( serror != JDWP_ERROR(NONE) ) {
163                 break;
164             }
165 
166         }
167 
168     } END_WITH_LOCAL_REFS(env);
169 
170     return JNI_TRUE;
171 }
172 
173 static jboolean
174 invokeStatic(PacketInputStream *in, PacketOutputStream *out)
175 {
176     return sharedInvoke(in, out);
177 }
178 
179 Command ClassType_Commands[] = {
180     {superclass, &quot;Superclass&quot;},
181     {setValues, &quot;SetValues&quot;},
182     {invokeStatic, &quot;InvokeMethod&quot;},
183     {invokeStatic, &quot;NewInstance&quot;}
184 };
185 
186 DEBUG_DISPATCH_DEFINE_CMDSET(ClassType)
<a name="6" id="anc6"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="6" type="hidden" />
</body>
</html>