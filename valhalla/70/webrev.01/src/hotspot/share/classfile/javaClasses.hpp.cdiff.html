<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/classfile/javaClasses.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="javaClasses.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="systemDictionary.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/javaClasses.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 31,28 ***</span>
  #include &quot;runtime/os.hpp&quot;
  
  class RecordComponent;
  
  // Interface for manipulating the basic Java classes.
<span class="line-removed">- //</span>
<span class="line-removed">- // All dependencies on layout of actual Java classes should be kept here.</span>
<span class="line-removed">- // If the layout of any of the classes above changes the offsets must be adjusted.</span>
<span class="line-removed">- //</span>
<span class="line-removed">- // For most classes we hardwire the offsets for performance reasons. In certain</span>
<span class="line-removed">- // cases (e.g. java.security.AccessControlContext) we compute the offsets at</span>
<span class="line-removed">- // startup since the layout here differs between JDK1.2 and JDK1.3.</span>
<span class="line-removed">- //</span>
<span class="line-removed">- // Note that fields (static and non-static) are arranged with oops before non-oops</span>
<span class="line-removed">- // on a per class basis. The offsets below have to reflect this ordering.</span>
<span class="line-removed">- //</span>
<span class="line-removed">- // When editing the layouts please update the check_offset verification code</span>
<span class="line-removed">- // correspondingly. The names in the enums must be identical to the actual field</span>
<span class="line-removed">- // names in order for the verification code to work.</span>
  
  #define BASIC_JAVA_CLASSES_DO_PART1(f) \
    f(java_lang_Class) \
    f(java_lang_String) \
    //end
  
  #define BASIC_JAVA_CLASSES_DO_PART2(f) \
    f(java_lang_System) \
    f(java_lang_ClassLoader) \
<span class="line-new-header">--- 31,15 ---</span>
  #include &quot;runtime/os.hpp&quot;
  
  class RecordComponent;
  
  // Interface for manipulating the basic Java classes.
  
  #define BASIC_JAVA_CLASSES_DO_PART1(f) \
    f(java_lang_Class) \
    f(java_lang_String) \
<span class="line-added">+   f(java_lang_ref_Reference) \</span>
    //end
  
  #define BASIC_JAVA_CLASSES_DO_PART2(f) \
    f(java_lang_System) \
    f(java_lang_ClassLoader) \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 85,10 ***</span>
<span class="line-new-header">--- 72,11 ---</span>
    f(java_lang_StackFrameInfo) \
    f(java_lang_LiveStackFrameInfo) \
    f(java_util_concurrent_locks_AbstractOwnableSynchronizer) \
    f(jdk_internal_misc_UnsafeConstants) \
    f(jdk_internal_vm_jni_SubElementSelector) \
<span class="line-added">+   f(java_lang_boxing_object) \</span>
    //end
  
  #define BASIC_JAVA_CLASSES_DO(f) \
          BASIC_JAVA_CLASSES_DO_PART1(f) \
          BASIC_JAVA_CLASSES_DO_PART2(f)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 537,17 ***</span>
  class java_lang_Throwable: AllStatic {
    friend class BacktraceBuilder;
    friend class BacktraceIterator;
  
   private:
<span class="line-removed">-   // Offsets</span>
<span class="line-removed">-   enum {</span>
<span class="line-removed">-     hc_backtrace_offset     =  0,</span>
<span class="line-removed">-     hc_detailMessage_offset =  1,</span>
<span class="line-removed">-     hc_cause_offset         =  2,  // New since 1.4</span>
<span class="line-removed">-     hc_stackTrace_offset    =  3   // New since 1.4</span>
<span class="line-removed">-   };</span>
    // Trace constants
    enum {
      trace_methods_offset = 0,
      trace_bcis_offset    = 1,
      trace_mirrors_offset = 2,
<span class="line-new-header">--- 525,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 894,13 ***</span>
  
  // This could be separated out into 8 individual classes.
  
  class java_lang_boxing_object: AllStatic {
   private:
<span class="line-removed">-   enum {</span>
<span class="line-removed">-    hc_value_offset = 0</span>
<span class="line-removed">-   };</span>
    static int value_offset;
    static int long_value_offset;
  
    static oop initialize_and_allocate(BasicType type, TRAPS);
   public:
<span class="line-new-header">--- 875,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 918,27 ***</span>
    static int value_offset_in_bytes(BasicType type) {
      return ( type == T_LONG || type == T_DOUBLE ) ? long_value_offset :
                                                      value_offset;
    }
  
    // Debugging
    friend class JavaClasses;
  };
  
  
  
  // Interface to java.lang.ref.Reference objects
  
  class java_lang_ref_Reference: AllStatic {
<span class="line-modified">!  public:</span>
<span class="line-removed">-   enum {</span>
<span class="line-removed">-    hc_referent_offset   = 0,</span>
<span class="line-removed">-    hc_queue_offset      = 1,</span>
<span class="line-removed">-    hc_next_offset       = 2,</span>
<span class="line-removed">-    hc_discovered_offset = 3  // Is not last, see SoftRefs.</span>
<span class="line-removed">-   };</span>
  
    static int referent_offset;
    static int queue_offset;
    static int next_offset;
    static int discovered_offset;
  
<span class="line-new-header">--- 896,25 ---</span>
    static int value_offset_in_bytes(BasicType type) {
      return ( type == T_LONG || type == T_DOUBLE ) ? long_value_offset :
                                                      value_offset;
    }
  
<span class="line-added">+   static void compute_offsets();</span>
<span class="line-added">+   static void serialize_offsets(SerializeClosure* f) NOT_CDS_RETURN;</span>
<span class="line-added">+ </span>
    // Debugging
    friend class JavaClasses;
  };
  
  
  
  // Interface to java.lang.ref.Reference objects
  
  class java_lang_ref_Reference: AllStatic {
<span class="line-modified">!   static bool _offsets_initialized;</span>
  
<span class="line-added">+  public:</span>
    static int referent_offset;
    static int queue_offset;
    static int next_offset;
    static int discovered_offset;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 958,10 ***</span>
<span class="line-new-header">--- 934,13 ---</span>
    static inline oop queue(oop ref);
    static inline void set_queue(oop ref, oop value);
    static bool is_referent_field(oop obj, ptrdiff_t offset);
    static inline bool is_final(oop ref);
    static inline bool is_phantom(oop ref);
<span class="line-added">+ </span>
<span class="line-added">+   static void compute_offsets();</span>
<span class="line-added">+   static void serialize_offsets(SerializeClosure* f) NOT_CDS_RETURN;</span>
  };
  
  
  // Interface to java.lang.ref.SoftReference objects
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1763,11 ***</span>
      MAX_enum
    };
  
    static int compute_injected_offset(InjectedFieldID id);
  
<span class="line-removed">-   static void compute_hard_coded_offsets();</span>
    static void compute_offsets();
    static void check_offsets() PRODUCT_RETURN;
    static void serialize_offsets(SerializeClosure* soc) NOT_CDS_RETURN;
    static InjectedField* get_injected(Symbol* class_name, int* field_count);
    static bool is_supported_for_archiving(oop obj) NOT_CDS_JAVA_HEAP_RETURN_(false);
<span class="line-new-header">--- 1742,10 ---</span>
</pre>
<center><a href="javaClasses.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="systemDictionary.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>