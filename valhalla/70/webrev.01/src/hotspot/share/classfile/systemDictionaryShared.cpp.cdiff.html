<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/classfile/systemDictionaryShared.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="systemDictionary.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vmSymbols.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/systemDictionaryShared.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 196,18 ***</span>
  {
    int _builtin_count;
    int _unregistered_count;
  public:
    DumpTimeSharedClassInfo* find_or_allocate_info_for(InstanceKlass* k) {
<span class="line-modified">!     DumpTimeSharedClassInfo* p = get(k);</span>
<span class="line-modified">!     if (p == NULL) {</span>
        assert(!SystemDictionaryShared::no_class_loading_should_happen(),
               &quot;no new classes can be loaded while dumping archive&quot;);
<span class="line-removed">-       put(k, DumpTimeSharedClassInfo());</span>
<span class="line-removed">-       p = get(k);</span>
<span class="line-removed">-       assert(p != NULL, &quot;sanity&quot;);</span>
        p-&gt;_klass = k;
      }
      return p;
    }
  
    class CountClassByCategory : StackObj {
<span class="line-new-header">--- 196,18 ---</span>
  {
    int _builtin_count;
    int _unregistered_count;
  public:
    DumpTimeSharedClassInfo* find_or_allocate_info_for(InstanceKlass* k) {
<span class="line-modified">!     bool created = false;</span>
<span class="line-modified">!     DumpTimeSharedClassInfo* p = put_if_absent(k, &amp;created);</span>
<span class="line-added">+     if (created) {</span>
        assert(!SystemDictionaryShared::no_class_loading_should_happen(),
               &quot;no new classes can be loaded while dumping archive&quot;);
        p-&gt;_klass = k;
<span class="line-added">+     } else {</span>
<span class="line-added">+       assert(p-&gt;_klass == k, &quot;Sanity&quot;);</span>
      }
      return p;
    }
  
    class CountClassByCategory : StackObj {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1039,23 ***</span>
    primitive_equals&lt;Symbol*&gt;,
    6661,                             // prime number
    ResourceObj::C_HEAP&gt; _loaded_unregistered_classes;
  
  bool SystemDictionaryShared::add_unregistered_class(InstanceKlass* k, TRAPS) {
    assert(DumpSharedSpaces, &quot;only when dumping&quot;);
<span class="line-removed">- </span>
    Symbol* name = k-&gt;name();
<span class="line-modified">!   if (_loaded_unregistered_classes.get(name) != NULL) {</span>
<span class="line-modified">!     // We don&#39;t allow duplicated unregistered classes of the same name.</span>
<span class="line-modified">!     return false;</span>
<span class="line-removed">-   } else {</span>
<span class="line-removed">-     bool isnew = _loaded_unregistered_classes.put(name, true);</span>
<span class="line-removed">-     assert(isnew, &quot;sanity&quot;);</span>
      MutexLocker mu_r(THREAD, Compile_lock); // add_to_hierarchy asserts this.
      SystemDictionary::add_to_hierarchy(k, CHECK_false);
<span class="line-removed">-     return true;</span>
    }
  }
  
  // This function is called to resolve the super/interfaces of shared classes for
  // non-built-in loaders. E.g., ChildClass in the below example
  // where &quot;super:&quot; (and optionally &quot;interface:&quot;) have been specified.
<span class="line-new-header">--- 1039,20 ---</span>
    primitive_equals&lt;Symbol*&gt;,
    6661,                             // prime number
    ResourceObj::C_HEAP&gt; _loaded_unregistered_classes;
  
  bool SystemDictionaryShared::add_unregistered_class(InstanceKlass* k, TRAPS) {
<span class="line-added">+   // We don&#39;t allow duplicated unregistered classes of the same name.</span>
    assert(DumpSharedSpaces, &quot;only when dumping&quot;);
    Symbol* name = k-&gt;name();
<span class="line-modified">!   bool created = false;</span>
<span class="line-modified">!   _loaded_unregistered_classes.put_if_absent(name, true, &amp;created);</span>
<span class="line-modified">!   if (created) {</span>
      MutexLocker mu_r(THREAD, Compile_lock); // add_to_hierarchy asserts this.
      SystemDictionary::add_to_hierarchy(k, CHECK_false);
    }
<span class="line-added">+   return created;</span>
  }
  
  // This function is called to resolve the super/interfaces of shared classes for
  // non-built-in loaders. E.g., ChildClass in the below example
  // where &quot;super:&quot; (and optionally &quot;interface:&quot;) have been specified.
</pre>
<center><a href="systemDictionary.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="vmSymbols.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>