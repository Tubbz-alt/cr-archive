<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/classfile/classLoaderStats.hpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="classLoaderStats.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="javaClasses.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/classfile/classLoaderStats.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 85     _cld(0),
 86     _class_loader(0),
 87     _parent(0),
 88     _chunk_sz(0),
 89     _block_sz(0),
 90     _classes_count(0),
 91     _hidden_chunk_sz(0),
 92     _hidden_block_sz(0),
 93     _hidden_classes_count(0) {
 94   }
 95 };
 96 
 97 
 98 class ClassLoaderStatsClosure : public CLDClosure {
 99 protected:
100   static bool oop_equals(oop const&amp; s1, oop const&amp; s2) {
101     return s1 == s2;
102   }
103 
104   static unsigned oop_hash(oop const&amp; s1) {
<span class="line-modified">105     unsigned hash = (unsigned)((uintptr_t)&amp;s1);</span>
<span class="line-modified">106     return hash ^ (hash &gt;&gt; LogMinObjAlignment);</span>









107   }
108 
<span class="line-modified">109   typedef ResourceHashtable&lt;oop, ClassLoaderStats*,</span>
110       ClassLoaderStatsClosure::oop_hash, ClassLoaderStatsClosure::oop_equals&gt; StatsTable;
111 
112   outputStream* _out;
113   StatsTable* _stats;
114   uintx   _total_loaders;
115   uintx   _total_classes;
116   size_t  _total_chunk_sz;
117   size_t  _total_block_sz;
118 
119 public:
120   ClassLoaderStatsClosure(outputStream* out) :
121     _out(out),
122     _stats(new StatsTable()),
123     _total_loaders(0),
124     _total_classes(0),
125     _total_chunk_sz(0),
126     _total_block_sz(0) {
127   }
128 
129   virtual void do_cld(ClassLoaderData* cld);
<span class="line-modified">130   virtual bool do_entry(oop const&amp; key, ClassLoaderStats* const&amp; cls);</span>
131   void print();
132 
133 private:
134   void addEmptyParents(oop cl);
135 };
136 
137 
138 class ClassLoaderStatsVMOperation : public VM_Operation {
139   outputStream* _out;
140 
141 public:
142   ClassLoaderStatsVMOperation(outputStream* out) :
143     _out(out) {
144   }
145 
146   VMOp_Type type() const {
147     return VMOp_ClassLoaderStatsOperation;
148   }
149 
150   void doit();
</pre>
</td>
<td>
<hr />
<pre>
 85     _cld(0),
 86     _class_loader(0),
 87     _parent(0),
 88     _chunk_sz(0),
 89     _block_sz(0),
 90     _classes_count(0),
 91     _hidden_chunk_sz(0),
 92     _hidden_block_sz(0),
 93     _hidden_classes_count(0) {
 94   }
 95 };
 96 
 97 
 98 class ClassLoaderStatsClosure : public CLDClosure {
 99 protected:
100   static bool oop_equals(oop const&amp; s1, oop const&amp; s2) {
101     return s1 == s2;
102   }
103 
104   static unsigned oop_hash(oop const&amp; s1) {
<span class="line-modified">105     // Robert Jenkins 1996 &amp; Thomas Wang 1997</span>
<span class="line-modified">106     // http://web.archive.org/web/20071223173210/http://www.concentric.net/~Ttwang/tech/inthash.htm</span>
<span class="line-added">107     uintptr_t tmp = cast_from_oop&lt;uintptr_t&gt;(s1);</span>
<span class="line-added">108     unsigned hash = (unsigned)tmp;</span>
<span class="line-added">109     hash = ~hash + (hash &lt;&lt; 15);</span>
<span class="line-added">110     hash = hash ^ (hash &gt;&gt; 12);</span>
<span class="line-added">111     hash = hash + (hash &lt;&lt; 2);</span>
<span class="line-added">112     hash = hash ^ (hash &gt;&gt; 4);</span>
<span class="line-added">113     hash = hash * 2057;</span>
<span class="line-added">114     hash = hash ^ (hash &gt;&gt; 16);</span>
<span class="line-added">115     return hash;</span>
116   }
117 
<span class="line-modified">118   typedef ResourceHashtable&lt;oop, ClassLoaderStats,</span>
119       ClassLoaderStatsClosure::oop_hash, ClassLoaderStatsClosure::oop_equals&gt; StatsTable;
120 
121   outputStream* _out;
122   StatsTable* _stats;
123   uintx   _total_loaders;
124   uintx   _total_classes;
125   size_t  _total_chunk_sz;
126   size_t  _total_block_sz;
127 
128 public:
129   ClassLoaderStatsClosure(outputStream* out) :
130     _out(out),
131     _stats(new StatsTable()),
132     _total_loaders(0),
133     _total_classes(0),
134     _total_chunk_sz(0),
135     _total_block_sz(0) {
136   }
137 
138   virtual void do_cld(ClassLoaderData* cld);
<span class="line-modified">139   virtual bool do_entry(oop const&amp; key, ClassLoaderStats const&amp; cls);</span>
140   void print();
141 
142 private:
143   void addEmptyParents(oop cl);
144 };
145 
146 
147 class ClassLoaderStatsVMOperation : public VM_Operation {
148   outputStream* _out;
149 
150 public:
151   ClassLoaderStatsVMOperation(outputStream* out) :
152     _out(out) {
153   }
154 
155   VMOp_Type type() const {
156     return VMOp_ClassLoaderStatsOperation;
157   }
158 
159   void doit();
</pre>
</td>
</tr>
</table>
<center><a href="classLoaderStats.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="javaClasses.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>