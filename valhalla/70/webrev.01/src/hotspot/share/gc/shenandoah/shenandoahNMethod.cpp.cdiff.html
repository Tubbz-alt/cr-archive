<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/gc/shenandoah/shenandoahNMethod.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahHeap.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahNMethod.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahNMethod.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 108,28 ***</span>
    _has_non_immed_oops = non_immediate_oops;
  
    assert_same_oops();
  }
  
<span class="line-removed">- void ShenandoahNMethod::oops_do(OopClosure* oops, bool fix_relocations) {</span>
<span class="line-removed">-   for (int c = 0; c &lt; _oops_count; c ++) {</span>
<span class="line-removed">-     oops-&gt;do_oop(_oops[c]);</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   oop* const begin = _nm-&gt;oops_begin();</span>
<span class="line-removed">-   oop* const end = _nm-&gt;oops_end();</span>
<span class="line-removed">-   for (oop* p = begin; p &lt; end; p++) {</span>
<span class="line-removed">-     if (*p != Universe::non_oop_word()) {</span>
<span class="line-removed">-       oops-&gt;do_oop(p);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   if (fix_relocations &amp;&amp; _has_non_immed_oops) {</span>
<span class="line-removed">-     _nm-&gt;fix_oop_relocations();</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  void ShenandoahNMethod::detect_reloc_oops(nmethod* nm, GrowableArray&lt;oop*&gt;&amp; oops, bool&amp; has_non_immed_oops) {
    has_non_immed_oops = false;
    // Find all oops relocations
    RelocIterator iter(nm);
    while (iter.next()) {
<span class="line-new-header">--- 108,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 213,12 ***</span>
        ShenandoahKeepNMethodMetadataAliveClosure&lt;false&gt; cl;
        data-&gt;oops_do(&amp;cl);
      }
    } else if (heap-&gt;is_concurrent_weak_root_in_progress()) {
      ShenandoahEvacOOMScope evac_scope;
<span class="line-modified">!     ShenandoahEvacuateUpdateRootsClosure&lt;&gt; cl;</span>
<span class="line-removed">-     data-&gt;oops_do(&amp;cl, true /*fix relocation*/);</span>
    } else {
      // There is possibility that GC is cancelled when it arrives final mark.
      // In this case, concurrent root phase is skipped and degenerated GC should be
      // followed, where nmethods are disarmed.
      assert(heap-&gt;cancelled_gc(), &quot;What else?&quot;);
<span class="line-new-header">--- 195,11 ---</span>
        ShenandoahKeepNMethodMetadataAliveClosure&lt;false&gt; cl;
        data-&gt;oops_do(&amp;cl);
      }
    } else if (heap-&gt;is_concurrent_weak_root_in_progress()) {
      ShenandoahEvacOOMScope evac_scope;
<span class="line-modified">!     heal_nmethod_metadata(data);</span>
    } else {
      // There is possibility that GC is cancelled when it arrives final mark.
      // In this case, concurrent root phase is skipped and degenerated GC should be
      // followed, where nmethods are disarmed.
      assert(heap-&gt;cancelled_gc(), &quot;What else?&quot;);
</pre>
<center><a href="shenandoahHeap.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahNMethod.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>