<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/gc/shenandoah/shenandoahPhaseTimings.hpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="shenandoahPhaseTimings.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahUnload.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/gc/shenandoah/shenandoahPhaseTimings.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 74   f(final_mark,                                     &quot;Pause Final Mark (N)&quot;)            \
 75   f(update_roots,                                   &quot;  Update Roots&quot;)                  \
 76   SHENANDOAH_PAR_PHASE_DO(update_,                  &quot;    U: &quot;, f)                      \
 77   f(finish_queues,                                  &quot;  Finish Queues&quot;)                 \
 78   f(weakrefs,                                       &quot;  Weak References&quot;)               \
 79   f(weakrefs_process,                               &quot;    Process&quot;)                     \
 80   f(purge,                                          &quot;  System Purge&quot;)                  \
 81   f(purge_class_unload,                             &quot;    Unload Classes&quot;)              \
 82   SHENANDOAH_PAR_PHASE_DO(purge_cu_par_,            &quot;      CU: &quot;, f)                   \
 83   f(purge_weak_par,                                 &quot;    Weak Roots&quot;)                  \
 84   SHENANDOAH_PAR_PHASE_DO(purge_weak_par_,          &quot;      WR: &quot;, f)                   \
 85   f(purge_cldg,                                     &quot;    CLDG&quot;)                        \
 86   f(final_update_region_states,                     &quot;  Update Region States&quot;)          \
 87   f(retire_tlabs,                                   &quot;  Retire TLABs&quot;)                  \
 88   f(choose_cset,                                    &quot;  Choose Collection Set&quot;)         \
 89   f(final_rebuild_freeset,                          &quot;  Rebuild Free Set&quot;)              \
 90   f(init_evac,                                      &quot;  Initial Evacuation&quot;)            \
 91   SHENANDOAH_PAR_PHASE_DO(evac_,                    &quot;    E: &quot;, f)                      \
 92                                                                                        \
 93   f(conc_weak_roots,                                &quot;Concurrent Weak Roots&quot;)           \
<span class="line-modified"> 94   SHENANDOAH_PAR_PHASE_DO(conc_weak_roots_,         &quot;  CWR: &quot;, f)                      \</span>


 95   f(conc_cleanup_early,                             &quot;Concurrent Cleanup&quot;)              \
 96   f(conc_class_unload,                              &quot;Concurrent Class Unloading&quot;)      \
 97   f(conc_class_unload_unlink,                       &quot;  Unlink Stale&quot;)                  \
 98   f(conc_class_unload_unlink_sd,                    &quot;    System Dictionary&quot;)           \
 99   f(conc_class_unload_unlink_weak_klass,            &quot;    Weak Class Links&quot;)            \
100   f(conc_class_unload_unlink_code_roots,            &quot;    Code Roots&quot;)                  \
101   f(conc_class_unload_rendezvous,                   &quot;  Rendezvous&quot;)                    \
102   f(conc_class_unload_purge,                        &quot;  Purge Unlinked&quot;)                \
103   f(conc_class_unload_purge_coderoots,              &quot;    Code Roots&quot;)                  \
104   f(conc_class_unload_purge_cldg,                   &quot;    CLDG&quot;)                        \
105   f(conc_class_unload_purge_ec,                     &quot;    Exception Caches&quot;)            \
106   f(conc_strong_roots,                              &quot;Concurrent Strong Roots&quot;)         \
107   SHENANDOAH_PAR_PHASE_DO(conc_strong_roots_,       &quot;  CSR: &quot;, f)                      \
108   f(conc_evac,                                      &quot;Concurrent Evacuation&quot;)           \
109                                                                                        \
110   f(init_update_refs_gross,                         &quot;Pause Init  Update Refs (G)&quot;)     \
111   f(init_update_refs,                               &quot;Pause Init  Update Refs (N)&quot;)     \
112   f(init_update_refs_retire_gclabs,                 &quot;  Retire GCLABs&quot;)                 \
113                                                                                        \
114   f(conc_update_refs,                               &quot;Concurrent Update Refs&quot;)          \
</pre>
<hr />
<pre>
190 
191 private:
192   uint                _max_workers;
193   double              _cycle_data[_num_phases];
194   HdrSeq              _global_data[_num_phases];
195   static const char*  _phase_names[_num_phases];
196 
197   ShenandoahWorkerData* _worker_data[_num_phases];
198   ShenandoahCollectorPolicy* _policy;
199 
200   static bool is_worker_phase(Phase phase);
201   static bool is_root_work_phase(Phase phase);
202 
203   ShenandoahWorkerData* worker_data(Phase phase, ParPhase par_phase);
204   Phase worker_par_phase(Phase phase, ParPhase par_phase);
205 
206   void set_cycle_data(Phase phase, double time);
207   static double uninitialized() { return -1; }
208 
209 public:
<span class="line-modified">210   ShenandoahPhaseTimings(uint _max_workers);</span>
211 
212   void record_phase_time(Phase phase, double time);
213 
214   void record_workers_start(Phase phase);
215   void record_workers_end(Phase phase);
216 
217   void flush_par_workers_to_cycle();
218   void flush_cycle_to_global();
219 
220   static const char* phase_name(Phase phase) {
221     assert(phase &gt;= 0 &amp;&amp; phase &lt; _num_phases, &quot;Out of bound&quot;);
222     return _phase_names[phase];
223   }
224 
225   void print_cycle_on(outputStream* out) const;
226   void print_global_on(outputStream* out) const;
227 };
228 
229 class ShenandoahWorkerTimingsTracker : public StackObj {
230 private:
</pre>
</td>
<td>
<hr />
<pre>
 74   f(final_mark,                                     &quot;Pause Final Mark (N)&quot;)            \
 75   f(update_roots,                                   &quot;  Update Roots&quot;)                  \
 76   SHENANDOAH_PAR_PHASE_DO(update_,                  &quot;    U: &quot;, f)                      \
 77   f(finish_queues,                                  &quot;  Finish Queues&quot;)                 \
 78   f(weakrefs,                                       &quot;  Weak References&quot;)               \
 79   f(weakrefs_process,                               &quot;    Process&quot;)                     \
 80   f(purge,                                          &quot;  System Purge&quot;)                  \
 81   f(purge_class_unload,                             &quot;    Unload Classes&quot;)              \
 82   SHENANDOAH_PAR_PHASE_DO(purge_cu_par_,            &quot;      CU: &quot;, f)                   \
 83   f(purge_weak_par,                                 &quot;    Weak Roots&quot;)                  \
 84   SHENANDOAH_PAR_PHASE_DO(purge_weak_par_,          &quot;      WR: &quot;, f)                   \
 85   f(purge_cldg,                                     &quot;    CLDG&quot;)                        \
 86   f(final_update_region_states,                     &quot;  Update Region States&quot;)          \
 87   f(retire_tlabs,                                   &quot;  Retire TLABs&quot;)                  \
 88   f(choose_cset,                                    &quot;  Choose Collection Set&quot;)         \
 89   f(final_rebuild_freeset,                          &quot;  Rebuild Free Set&quot;)              \
 90   f(init_evac,                                      &quot;  Initial Evacuation&quot;)            \
 91   SHENANDOAH_PAR_PHASE_DO(evac_,                    &quot;    E: &quot;, f)                      \
 92                                                                                        \
 93   f(conc_weak_roots,                                &quot;Concurrent Weak Roots&quot;)           \
<span class="line-modified"> 94   f(conc_weak_roots_work,                           &quot;  Roots&quot;)                         \</span>
<span class="line-added"> 95   SHENANDOAH_PAR_PHASE_DO(conc_weak_roots_work_,    &quot;    CWR: &quot;, f)                    \</span>
<span class="line-added"> 96   f(conc_weak_roots_rendezvous,                     &quot;  Rendezvous&quot;)                    \</span>
 97   f(conc_cleanup_early,                             &quot;Concurrent Cleanup&quot;)              \
 98   f(conc_class_unload,                              &quot;Concurrent Class Unloading&quot;)      \
 99   f(conc_class_unload_unlink,                       &quot;  Unlink Stale&quot;)                  \
100   f(conc_class_unload_unlink_sd,                    &quot;    System Dictionary&quot;)           \
101   f(conc_class_unload_unlink_weak_klass,            &quot;    Weak Class Links&quot;)            \
102   f(conc_class_unload_unlink_code_roots,            &quot;    Code Roots&quot;)                  \
103   f(conc_class_unload_rendezvous,                   &quot;  Rendezvous&quot;)                    \
104   f(conc_class_unload_purge,                        &quot;  Purge Unlinked&quot;)                \
105   f(conc_class_unload_purge_coderoots,              &quot;    Code Roots&quot;)                  \
106   f(conc_class_unload_purge_cldg,                   &quot;    CLDG&quot;)                        \
107   f(conc_class_unload_purge_ec,                     &quot;    Exception Caches&quot;)            \
108   f(conc_strong_roots,                              &quot;Concurrent Strong Roots&quot;)         \
109   SHENANDOAH_PAR_PHASE_DO(conc_strong_roots_,       &quot;  CSR: &quot;, f)                      \
110   f(conc_evac,                                      &quot;Concurrent Evacuation&quot;)           \
111                                                                                        \
112   f(init_update_refs_gross,                         &quot;Pause Init  Update Refs (G)&quot;)     \
113   f(init_update_refs,                               &quot;Pause Init  Update Refs (N)&quot;)     \
114   f(init_update_refs_retire_gclabs,                 &quot;  Retire GCLABs&quot;)                 \
115                                                                                        \
116   f(conc_update_refs,                               &quot;Concurrent Update Refs&quot;)          \
</pre>
<hr />
<pre>
192 
193 private:
194   uint                _max_workers;
195   double              _cycle_data[_num_phases];
196   HdrSeq              _global_data[_num_phases];
197   static const char*  _phase_names[_num_phases];
198 
199   ShenandoahWorkerData* _worker_data[_num_phases];
200   ShenandoahCollectorPolicy* _policy;
201 
202   static bool is_worker_phase(Phase phase);
203   static bool is_root_work_phase(Phase phase);
204 
205   ShenandoahWorkerData* worker_data(Phase phase, ParPhase par_phase);
206   Phase worker_par_phase(Phase phase, ParPhase par_phase);
207 
208   void set_cycle_data(Phase phase, double time);
209   static double uninitialized() { return -1; }
210 
211 public:
<span class="line-modified">212   ShenandoahPhaseTimings(uint max_workers);</span>
213 
214   void record_phase_time(Phase phase, double time);
215 
216   void record_workers_start(Phase phase);
217   void record_workers_end(Phase phase);
218 
219   void flush_par_workers_to_cycle();
220   void flush_cycle_to_global();
221 
222   static const char* phase_name(Phase phase) {
223     assert(phase &gt;= 0 &amp;&amp; phase &lt; _num_phases, &quot;Out of bound&quot;);
224     return _phase_names[phase];
225   }
226 
227   void print_cycle_on(outputStream* out) const;
228   void print_global_on(outputStream* out) const;
229 };
230 
231 class ShenandoahWorkerTimingsTracker : public StackObj {
232 private:
</pre>
</td>
</tr>
</table>
<center><a href="shenandoahPhaseTimings.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="shenandoahUnload.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>