<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/cpu/x86/assembler_x86.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../sparc/stubGenerator_sparc.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_globals_x86.hpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/x86/assembler_x86.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 8787,35 ***</span>
    movq(r9,  Address(rsp, 6 * wordSize));
    movq(r8,  Address(rsp, 7 * wordSize));
    movq(rdi, Address(rsp, 8 * wordSize));
    movq(rsi, Address(rsp, 9 * wordSize));
    movq(rbp, Address(rsp, 10 * wordSize));
<span class="line-modified">!   // skip rsp</span>
    movq(rbx, Address(rsp, 12 * wordSize));
    movq(rdx, Address(rsp, 13 * wordSize));
    movq(rcx, Address(rsp, 14 * wordSize));
    movq(rax, Address(rsp, 15 * wordSize));
  
    addq(rsp, 16 * wordSize);
  }
  
  void Assembler::pusha() { // 64bit
    emit_copy(code_section(), pusha_code, pusha_len);
  }
  
  void Assembler::pusha_uncached() { // 64bit
<span class="line-removed">-   // we have to store original rsp.  ABI says that 128 bytes</span>
<span class="line-removed">-   // below rsp are local scratch.</span>
<span class="line-removed">-   movq(Address(rsp, -5 * wordSize), rsp);</span>
<span class="line-removed">- </span>
    subq(rsp, 16 * wordSize);
  
    movq(Address(rsp, 15 * wordSize), rax);
    movq(Address(rsp, 14 * wordSize), rcx);
    movq(Address(rsp, 13 * wordSize), rdx);
    movq(Address(rsp, 12 * wordSize), rbx);
<span class="line-modified">!   // skip rsp</span>
    movq(Address(rsp, 10 * wordSize), rbp);
    movq(Address(rsp, 9 * wordSize), rsi);
    movq(Address(rsp, 8 * wordSize), rdi);
    movq(Address(rsp, 7 * wordSize), r8);
    movq(Address(rsp, 6 * wordSize), r9);
<span class="line-new-header">--- 8787,38 ---</span>
    movq(r9,  Address(rsp, 6 * wordSize));
    movq(r8,  Address(rsp, 7 * wordSize));
    movq(rdi, Address(rsp, 8 * wordSize));
    movq(rsi, Address(rsp, 9 * wordSize));
    movq(rbp, Address(rsp, 10 * wordSize));
<span class="line-modified">!   // Skip rsp as it is restored automatically to the value</span>
<span class="line-added">+   // before the corresponding pusha when popa is done.</span>
    movq(rbx, Address(rsp, 12 * wordSize));
    movq(rdx, Address(rsp, 13 * wordSize));
    movq(rcx, Address(rsp, 14 * wordSize));
    movq(rax, Address(rsp, 15 * wordSize));
  
    addq(rsp, 16 * wordSize);
  }
  
<span class="line-added">+ // Does not actually store the value of rsp on the stack.</span>
<span class="line-added">+ // The slot for rsp just contains an arbitrary value.</span>
  void Assembler::pusha() { // 64bit
    emit_copy(code_section(), pusha_code, pusha_len);
  }
  
<span class="line-added">+ // Does not actually store the value of rsp on the stack.</span>
<span class="line-added">+ // The slot for rsp just contains an arbitrary value.</span>
  void Assembler::pusha_uncached() { // 64bit
    subq(rsp, 16 * wordSize);
  
    movq(Address(rsp, 15 * wordSize), rax);
    movq(Address(rsp, 14 * wordSize), rcx);
    movq(Address(rsp, 13 * wordSize), rdx);
    movq(Address(rsp, 12 * wordSize), rbx);
<span class="line-modified">!   // Skip rsp as the value is normally not used. There are a few places where</span>
<span class="line-added">+   // the original value of rsp needs to be known but that can be computed</span>
<span class="line-added">+   // from the value of rsp immediately after pusha (rsp + 16 * wordSize).</span>
    movq(Address(rsp, 10 * wordSize), rbp);
    movq(Address(rsp, 9 * wordSize), rsi);
    movq(Address(rsp, 8 * wordSize), rdi);
    movq(Address(rsp, 7 * wordSize), r8);
    movq(Address(rsp, 6 * wordSize), r9);
</pre>
<center><a href="../sparc/stubGenerator_sparc.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="c1_globals_x86.hpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>