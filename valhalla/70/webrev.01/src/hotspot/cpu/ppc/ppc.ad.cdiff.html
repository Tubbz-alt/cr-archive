<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/cpu/ppc/ppc.ad</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="c1_globals_ppc.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="stubGenerator_ppc.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/cpu/ppc/ppc.ad</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 13828,57 ***</span>
  %}
  
  // Load Integer reversed byte order
  instruct loadI_reversed(iRegIdst dst, indirect mem) %{
    match(Set dst (ReverseBytesI (LoadI mem)));
    ins_cost(MEMORY_REF_COST);
  
    size(4);
    ins_encode %{
      __ lwbrx($dst$$Register, $mem$$Register);
    %}
    ins_pipe(pipe_class_default);
  %}
  
  // Load Long - aligned and reversed
  instruct loadL_reversed(iRegLdst dst, indirect mem) %{
    match(Set dst (ReverseBytesL (LoadL mem)));
<span class="line-modified">!   predicate(VM_Version::has_ldbrx());</span>
    ins_cost(MEMORY_REF_COST);
  
    size(4);
    ins_encode %{
      __ ldbrx($dst$$Register, $mem$$Register);
    %}
    ins_pipe(pipe_class_default);
  %}
  
  // Load unsigned short / char reversed byte order
  instruct loadUS_reversed(iRegIdst dst, indirect mem) %{
    match(Set dst (ReverseBytesUS (LoadUS mem)));
    ins_cost(MEMORY_REF_COST);
  
    size(4);
    ins_encode %{
      __ lhbrx($dst$$Register, $mem$$Register);
    %}
    ins_pipe(pipe_class_default);
  %}
  
  // Load short reversed byte order
  instruct loadS_reversed(iRegIdst dst, indirect mem) %{
    match(Set dst (ReverseBytesS (LoadS mem)));
    ins_cost(MEMORY_REF_COST + DEFAULT_COST);
  
    size(8);
    ins_encode %{
      __ lhbrx($dst$$Register, $mem$$Register);
      __ extsh($dst$$Register, $dst$$Register);
    %}
    ins_pipe(pipe_class_default);
  %}
  
  // Store Integer reversed byte order
  instruct storeI_reversed(iRegIsrc src, indirect mem) %{
    match(Set mem (StoreI mem (ReverseBytesI src)));
    ins_cost(MEMORY_REF_COST);
  
<span class="line-new-header">--- 13828,114 ---</span>
  %}
  
  // Load Integer reversed byte order
  instruct loadI_reversed(iRegIdst dst, indirect mem) %{
    match(Set dst (ReverseBytesI (LoadI mem)));
<span class="line-added">+   predicate(n-&gt;in(1)-&gt;as_Load()-&gt;is_unordered() || followed_by_acquire(n-&gt;in(1)));</span>
    ins_cost(MEMORY_REF_COST);
  
    size(4);
    ins_encode %{
      __ lwbrx($dst$$Register, $mem$$Register);
    %}
    ins_pipe(pipe_class_default);
  %}
  
<span class="line-added">+ instruct loadI_reversed_acquire(iRegIdst dst, indirect mem) %{</span>
<span class="line-added">+   match(Set dst (ReverseBytesI (LoadI mem)));</span>
<span class="line-added">+   ins_cost(2 * MEMORY_REF_COST);</span>
<span class="line-added">+ </span>
<span class="line-added">+   size(12);</span>
<span class="line-added">+   ins_encode %{</span>
<span class="line-added">+     __ lwbrx($dst$$Register, $mem$$Register);</span>
<span class="line-added">+     __ twi_0($dst$$Register);</span>
<span class="line-added">+     __ isync();</span>
<span class="line-added">+   %}</span>
<span class="line-added">+   ins_pipe(pipe_class_default);</span>
<span class="line-added">+ %}</span>
<span class="line-added">+ </span>
  // Load Long - aligned and reversed
  instruct loadL_reversed(iRegLdst dst, indirect mem) %{
    match(Set dst (ReverseBytesL (LoadL mem)));
<span class="line-modified">!   predicate(VM_Version::has_ldbrx() &amp;&amp; (n-&gt;in(1)-&gt;as_Load()-&gt;is_unordered() || followed_by_acquire(n-&gt;in(1))));</span>
    ins_cost(MEMORY_REF_COST);
  
    size(4);
    ins_encode %{
      __ ldbrx($dst$$Register, $mem$$Register);
    %}
    ins_pipe(pipe_class_default);
  %}
  
<span class="line-added">+ instruct loadL_reversed_acquire(iRegLdst dst, indirect mem) %{</span>
<span class="line-added">+   match(Set dst (ReverseBytesL (LoadL mem)));</span>
<span class="line-added">+   predicate(VM_Version::has_ldbrx());</span>
<span class="line-added">+   ins_cost(2 * MEMORY_REF_COST);</span>
<span class="line-added">+ </span>
<span class="line-added">+   size(12);</span>
<span class="line-added">+   ins_encode %{</span>
<span class="line-added">+     __ ldbrx($dst$$Register, $mem$$Register);</span>
<span class="line-added">+     __ twi_0($dst$$Register);</span>
<span class="line-added">+     __ isync();</span>
<span class="line-added">+   %}</span>
<span class="line-added">+   ins_pipe(pipe_class_default);</span>
<span class="line-added">+ %}</span>
<span class="line-added">+ </span>
  // Load unsigned short / char reversed byte order
  instruct loadUS_reversed(iRegIdst dst, indirect mem) %{
    match(Set dst (ReverseBytesUS (LoadUS mem)));
<span class="line-added">+   predicate(n-&gt;in(1)-&gt;as_Load()-&gt;is_unordered() || followed_by_acquire(n-&gt;in(1)));</span>
    ins_cost(MEMORY_REF_COST);
  
    size(4);
    ins_encode %{
      __ lhbrx($dst$$Register, $mem$$Register);
    %}
    ins_pipe(pipe_class_default);
  %}
  
<span class="line-added">+ instruct loadUS_reversed_acquire(iRegIdst dst, indirect mem) %{</span>
<span class="line-added">+   match(Set dst (ReverseBytesUS (LoadUS mem)));</span>
<span class="line-added">+   ins_cost(2 * MEMORY_REF_COST);</span>
<span class="line-added">+ </span>
<span class="line-added">+   size(12);</span>
<span class="line-added">+   ins_encode %{</span>
<span class="line-added">+     __ lhbrx($dst$$Register, $mem$$Register);</span>
<span class="line-added">+     __ twi_0($dst$$Register);</span>
<span class="line-added">+     __ isync();</span>
<span class="line-added">+   %}</span>
<span class="line-added">+   ins_pipe(pipe_class_default);</span>
<span class="line-added">+ %}</span>
<span class="line-added">+ </span>
  // Load short reversed byte order
  instruct loadS_reversed(iRegIdst dst, indirect mem) %{
    match(Set dst (ReverseBytesS (LoadS mem)));
<span class="line-added">+   predicate(n-&gt;in(1)-&gt;as_Load()-&gt;is_unordered() || followed_by_acquire(n-&gt;in(1)));</span>
    ins_cost(MEMORY_REF_COST + DEFAULT_COST);
  
    size(8);
    ins_encode %{
      __ lhbrx($dst$$Register, $mem$$Register);
      __ extsh($dst$$Register, $dst$$Register);
    %}
    ins_pipe(pipe_class_default);
  %}
  
<span class="line-added">+ instruct loadS_reversed_acquire(iRegIdst dst, indirect mem) %{</span>
<span class="line-added">+   match(Set dst (ReverseBytesS (LoadS mem)));</span>
<span class="line-added">+   ins_cost(2 * MEMORY_REF_COST + DEFAULT_COST);</span>
<span class="line-added">+ </span>
<span class="line-added">+   size(16);</span>
<span class="line-added">+   ins_encode %{</span>
<span class="line-added">+     __ lhbrx($dst$$Register, $mem$$Register);</span>
<span class="line-added">+     __ twi_0($dst$$Register);</span>
<span class="line-added">+     __ extsh($dst$$Register, $dst$$Register);</span>
<span class="line-added">+     __ isync();</span>
<span class="line-added">+   %}</span>
<span class="line-added">+   ins_pipe(pipe_class_default);</span>
<span class="line-added">+ %}</span>
<span class="line-added">+ </span>
  // Store Integer reversed byte order
  instruct storeI_reversed(iRegIsrc src, indirect mem) %{
    match(Set mem (StoreI mem (ReverseBytesI src)));
    ins_cost(MEMORY_REF_COST);
  
</pre>
<center><a href="c1_globals_ppc.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="stubGenerator_ppc.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>