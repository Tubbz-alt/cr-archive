<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jartool/share/classes/sun/security/tools/jarsigner/TimestampedSigner.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Resources.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/ModuleWriterImpl.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jartool/share/classes/sun/security/tools/jarsigner/TimestampedSigner.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 31 import java.security.cert.CertificateException;
 32 import java.security.cert.X509Certificate;
 33 
 34 import com.sun.jarsigner.*;
 35 import sun.security.pkcs.PKCS7;
 36 import sun.security.util.*;
 37 import sun.security.x509.*;
 38 
 39 /**
 40  * This class implements a content signing service.
 41  * It generates a timestamped signature for a given content according to
 42  * &lt;a href=&quot;http://www.ietf.org/rfc/rfc3161.txt&quot;&gt;RFC 3161&lt;/a&gt;.
 43  * The signature along with a trusted timestamp and the signer&#39;s certificate
 44  * are all packaged into a standard PKCS #7 Signed Data message.
 45  *
 46  * @author Vincent Ryan
 47  */
 48 @SuppressWarnings(&quot;removal&quot;)
 49 public final class TimestampedSigner extends ContentSigner {
 50 
<span class="line-removed"> 51     /*</span>
<span class="line-removed"> 52      * Object identifier for the subject information access X.509 certificate</span>
<span class="line-removed"> 53      * extension.</span>
<span class="line-removed"> 54      */</span>
<span class="line-removed"> 55     private static final String SUBJECT_INFO_ACCESS_OID = &quot;1.3.6.1.5.5.7.1.11&quot;;</span>
<span class="line-removed"> 56 </span>
 57     /*
 58      * Object identifier for the timestamping access descriptors.
 59      */
<span class="line-modified"> 60     private static final ObjectIdentifier AD_TIMESTAMPING_Id;</span>
<span class="line-modified"> 61     static {</span>
<span class="line-removed"> 62         ObjectIdentifier tmp = null;</span>
<span class="line-removed"> 63         try {</span>
<span class="line-removed"> 64             tmp = new ObjectIdentifier(&quot;1.3.6.1.5.5.7.48.3&quot;);</span>
<span class="line-removed"> 65         } catch (IOException e) {</span>
<span class="line-removed"> 66             // ignore</span>
<span class="line-removed"> 67         }</span>
<span class="line-removed"> 68         AD_TIMESTAMPING_Id = tmp;</span>
<span class="line-removed"> 69     }</span>
 70 
 71     /**
 72      * Instantiates a content signer that supports timestamped signatures.
 73      */
 74     public TimestampedSigner() {
 75     }
 76 
 77     /**
 78      * Generates a PKCS #7 signed data message that includes a signature
 79      * timestamp.
 80      * This method is used when a signature has already been generated.
 81      * The signature, a signature timestamp, the signer&#39;s certificate chain,
 82      * and optionally the content that was signed, are packaged into a PKCS #7
 83      * signed data message.
 84      *
 85      * @param params The non-null input parameters.
 86      * @param omitContent true if the content should be omitted from the
 87      *        signed data message. Otherwise the content is included.
 88      * @param applyTimestamp true if the signature should be timestamped.
 89      *        Otherwise timestamping is not performed.
</pre>
<hr />
<pre>
138                                         params.getTSADigestAlg());
139     }
140 
141     /**
142      * Examine the certificate for a Subject Information Access extension
143      * (&lt;a href=&quot;http://tools.ietf.org/html/rfc5280&quot;&gt;RFC 5280&lt;/a&gt;).
144      * The extension&#39;s {@code accessMethod} field should contain the object
145      * identifier defined for timestamping: 1.3.6.1.5.5.7.48.3 and its
146      * {@code accessLocation} field should contain an HTTP or HTTPS URL.
147      *
148      * @param tsaCertificate An X.509 certificate for the TSA.
149      * @return An HTTP or HTTPS URI or null if none was found.
150      */
151     public static URI getTimestampingURI(X509Certificate tsaCertificate) {
152 
153         if (tsaCertificate == null) {
154             return null;
155         }
156         // Parse the extensions
157         try {
<span class="line-modified">158             byte[] extensionValue =</span>
<span class="line-modified">159                 tsaCertificate.getExtensionValue(SUBJECT_INFO_ACCESS_OID);</span>
160             if (extensionValue == null) {
161                 return null;
162             }
163             DerInputStream der = new DerInputStream(extensionValue);
164             der = new DerInputStream(der.getOctetString());
165             DerValue[] derValue = der.getSequence(5);
166             AccessDescription description;
167             GeneralName location;
168             URIName uri;
169             for (int i = 0; i &lt; derValue.length; i++) {
170                 description = new AccessDescription(derValue[i]);
171                 if (description.getAccessMethod()
172                         .equals(AD_TIMESTAMPING_Id)) {
173                     location = description.getAccessLocation();
174                     if (location.getType() == GeneralNameInterface.NAME_URI) {
175                         uri = (URIName) location.getName();
176                         if (uri.getScheme().equalsIgnoreCase(&quot;http&quot;) ||
177                                 uri.getScheme().equalsIgnoreCase(&quot;https&quot;)) {
178                             return uri.getURI();
179                         }
</pre>
</td>
<td>
<hr />
<pre>
 31 import java.security.cert.CertificateException;
 32 import java.security.cert.X509Certificate;
 33 
 34 import com.sun.jarsigner.*;
 35 import sun.security.pkcs.PKCS7;
 36 import sun.security.util.*;
 37 import sun.security.x509.*;
 38 
 39 /**
 40  * This class implements a content signing service.
 41  * It generates a timestamped signature for a given content according to
 42  * &lt;a href=&quot;http://www.ietf.org/rfc/rfc3161.txt&quot;&gt;RFC 3161&lt;/a&gt;.
 43  * The signature along with a trusted timestamp and the signer&#39;s certificate
 44  * are all packaged into a standard PKCS #7 Signed Data message.
 45  *
 46  * @author Vincent Ryan
 47  */
 48 @SuppressWarnings(&quot;removal&quot;)
 49 public final class TimestampedSigner extends ContentSigner {
 50 






 51     /*
 52      * Object identifier for the timestamping access descriptors.
 53      */
<span class="line-modified"> 54     private static final ObjectIdentifier AD_TIMESTAMPING_Id =</span>
<span class="line-modified"> 55             ObjectIdentifier.of(KnownOIDs.AD_TimeStamping);</span>








 56 
 57     /**
 58      * Instantiates a content signer that supports timestamped signatures.
 59      */
 60     public TimestampedSigner() {
 61     }
 62 
 63     /**
 64      * Generates a PKCS #7 signed data message that includes a signature
 65      * timestamp.
 66      * This method is used when a signature has already been generated.
 67      * The signature, a signature timestamp, the signer&#39;s certificate chain,
 68      * and optionally the content that was signed, are packaged into a PKCS #7
 69      * signed data message.
 70      *
 71      * @param params The non-null input parameters.
 72      * @param omitContent true if the content should be omitted from the
 73      *        signed data message. Otherwise the content is included.
 74      * @param applyTimestamp true if the signature should be timestamped.
 75      *        Otherwise timestamping is not performed.
</pre>
<hr />
<pre>
124                                         params.getTSADigestAlg());
125     }
126 
127     /**
128      * Examine the certificate for a Subject Information Access extension
129      * (&lt;a href=&quot;http://tools.ietf.org/html/rfc5280&quot;&gt;RFC 5280&lt;/a&gt;).
130      * The extension&#39;s {@code accessMethod} field should contain the object
131      * identifier defined for timestamping: 1.3.6.1.5.5.7.48.3 and its
132      * {@code accessLocation} field should contain an HTTP or HTTPS URL.
133      *
134      * @param tsaCertificate An X.509 certificate for the TSA.
135      * @return An HTTP or HTTPS URI or null if none was found.
136      */
137     public static URI getTimestampingURI(X509Certificate tsaCertificate) {
138 
139         if (tsaCertificate == null) {
140             return null;
141         }
142         // Parse the extensions
143         try {
<span class="line-modified">144             byte[] extensionValue = tsaCertificate.getExtensionValue</span>
<span class="line-modified">145                     (KnownOIDs.SubjectInfoAccess.value());</span>
146             if (extensionValue == null) {
147                 return null;
148             }
149             DerInputStream der = new DerInputStream(extensionValue);
150             der = new DerInputStream(der.getOctetString());
151             DerValue[] derValue = der.getSequence(5);
152             AccessDescription description;
153             GeneralName location;
154             URIName uri;
155             for (int i = 0; i &lt; derValue.length; i++) {
156                 description = new AccessDescription(derValue[i]);
157                 if (description.getAccessMethod()
158                         .equals(AD_TIMESTAMPING_Id)) {
159                     location = description.getAccessLocation();
160                     if (location.getType() == GeneralNameInterface.NAME_URI) {
161                         uri = (URIName) location.getName();
162                         if (uri.getScheme().equalsIgnoreCase(&quot;http&quot;) ||
163                                 uri.getScheme().equalsIgnoreCase(&quot;https&quot;)) {
164                             return uri.getURI();
165                         }
</pre>
</td>
</tr>
</table>
<center><a href="Resources.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/ModuleWriterImpl.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>