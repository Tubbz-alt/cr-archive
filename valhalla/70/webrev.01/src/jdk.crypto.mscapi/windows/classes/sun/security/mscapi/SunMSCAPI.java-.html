<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.crypto.mscapi/windows/classes/sun/security/mscapi/SunMSCAPI.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.mscapi;
 27 
 28 import java.security.AccessController;
 29 import java.security.PrivilegedAction;
 30 import java.security.Provider;
 31 import java.security.NoSuchAlgorithmException;
 32 import java.security.InvalidParameterException;
 33 import java.security.ProviderException;
 34 import java.util.HashMap;
 35 import java.util.Arrays;
 36 
 37 import static sun.security.util.SecurityConstants.PROVIDER_VER;
 38 
 39 /**
 40  * A Cryptographic Service Provider for the Microsoft Crypto API.
 41  *
 42  * @since 1.6
 43  */
 44 
 45 public final class SunMSCAPI extends Provider {
 46 
 47     private static final long serialVersionUID = 8622598936488630849L; //TODO
 48 
 49     private static final String INFO = &quot;Sun&#39;s Microsoft Crypto API provider&quot;;
 50 
 51     static {
 52         AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {
 53             public Void run() {
 54                 System.loadLibrary(&quot;sunmscapi&quot;);
 55                 return null;
 56             }
 57         });
 58     }
 59 
 60     private static final class ProviderService extends Provider.Service {
 61         ProviderService(Provider p, String type, String algo, String cn) {
 62             super(p, type, algo, cn, null, null);
 63         }
 64 
 65         ProviderService(Provider p, String type, String algo, String cn,
 66             String[] aliases, HashMap&lt;String, String&gt; attrs) {
 67             super(p, type, algo, cn,
 68                   (aliases == null? null : Arrays.asList(aliases)), attrs);
 69         }
 70 
 71         @Override
 72         public Object newInstance(Object ctrParamObj)
 73             throws NoSuchAlgorithmException {
 74             String type = getType();
 75             if (ctrParamObj != null) {
 76                 throw new InvalidParameterException
 77                     (&quot;constructorParameter not used with &quot; + type +
 78                      &quot; engines&quot;);
 79             }
 80             String algo = getAlgorithm();
 81             try {
 82                 if (type.equals(&quot;SecureRandom&quot;)) {
 83                     if (algo.equals(&quot;Windows-PRNG&quot;)) {
 84                         return new PRNG();
 85                     }
 86                 } else if (type.equals(&quot;KeyStore&quot;)) {
 87                     if (algo.equals(&quot;Windows-MY&quot;)) {
 88                         return new CKeyStore.MY();
 89                     } else if (algo.equals(&quot;Windows-ROOT&quot;)) {
 90                         return new CKeyStore.ROOT();
 91                     }
 92                 } else if (type.equals(&quot;Signature&quot;)) {
 93                     if (algo.equals(&quot;NONEwithRSA&quot;)) {
 94                         return new CSignature.NONEwithRSA();
 95                     } else if (algo.equals(&quot;SHA1withRSA&quot;)) {
 96                         return new CSignature.SHA1withRSA();
 97                     } else if (algo.equals(&quot;SHA256withRSA&quot;)) {
 98                         return new CSignature.SHA256withRSA();
 99                     } else if (algo.equals(&quot;SHA384withRSA&quot;)) {
100                         return new CSignature.SHA384withRSA();
101                     } else if (algo.equals(&quot;SHA512withRSA&quot;)) {
102                         return new CSignature.SHA512withRSA();
103                     } else if (algo.equals(&quot;MD5withRSA&quot;)) {
104                         return new CSignature.MD5withRSA();
105                     } else if (algo.equals(&quot;MD2withRSA&quot;)) {
106                         return new CSignature.MD2withRSA();
107                     } else if (algo.equals(&quot;RSASSA-PSS&quot;)) {
108                         return new CSignature.PSS();
109                     } else if (algo.equals(&quot;SHA1withECDSA&quot;)) {
110                         return new CSignature.SHA1withECDSA();
111                     } else if (algo.equals(&quot;SHA224withECDSA&quot;)) {
112                         return new CSignature.SHA224withECDSA();
113                     } else if (algo.equals(&quot;SHA256withECDSA&quot;)) {
114                         return new CSignature.SHA256withECDSA();
115                     } else if (algo.equals(&quot;SHA384withECDSA&quot;)) {
116                         return new CSignature.SHA384withECDSA();
117                     } else if (algo.equals(&quot;SHA512withECDSA&quot;)) {
118                         return new CSignature.SHA512withECDSA();
119                     }
120                 } else if (type.equals(&quot;KeyPairGenerator&quot;)) {
121                     if (algo.equals(&quot;RSA&quot;)) {
122                         return new CKeyPairGenerator.RSA();
123                     }
124                 } else if (type.equals(&quot;Cipher&quot;)) {
125                     if (algo.equals(&quot;RSA&quot;) ||
126                         algo.equals(&quot;RSA/ECB/PKCS1Padding&quot;)) {
127                         return new CRSACipher();
128                     }
129                 }
130             } catch (Exception ex) {
131                 throw new NoSuchAlgorithmException
132                     (&quot;Error constructing &quot; + type + &quot; for &quot; +
133                     algo + &quot; using SunMSCAPI&quot;, ex);
134             }
135             throw new ProviderException(&quot;No impl for &quot; + algo +
136                 &quot; &quot; + type);
137         }
138     }
139 
140     public SunMSCAPI() {
141         super(&quot;SunMSCAPI&quot;, PROVIDER_VER, INFO);
142 
143         final Provider p = this;
144         AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {
145             public Void run() {
146                 /*
147                  * Secure random
148                  */
149                 HashMap&lt;String, String&gt; srattrs = new HashMap&lt;&gt;(1);
150                 srattrs.put(&quot;ThreadSafe&quot;, &quot;true&quot;);
151                 putService(new ProviderService(p, &quot;SecureRandom&quot;,
152                            &quot;Windows-PRNG&quot;, &quot;sun.security.mscapi.PRNG&quot;,
153                            null, srattrs));
154 
155                 /*
156                  * Key store
157                  */
158                 putService(new ProviderService(p, &quot;KeyStore&quot;,
159                            &quot;Windows-MY&quot;, &quot;sun.security.mscapi.CKeyStore$MY&quot;));
160                 putService(new ProviderService(p, &quot;KeyStore&quot;,
161                            &quot;Windows-ROOT&quot;, &quot;sun.security.mscapi.CKeyStore$ROOT&quot;));
162 
163                 /*
164                  * Signature engines
165                  */
166                 HashMap&lt;String, String&gt; attrs = new HashMap&lt;&gt;(1);
167                 attrs.put(&quot;SupportedKeyClasses&quot;, &quot;sun.security.mscapi.CKey&quot;);
168 
169                 // NONEwithRSA must be supplied with a pre-computed message digest.
170                 // Only the following digest algorithms are supported: MD5, SHA-1,
171                 // SHA-256, SHA-384, SHA-512 and a special-purpose digest
172                 // algorithm which is a concatenation of SHA-1 and MD5 digests.
173                 putService(new ProviderService(p, &quot;Signature&quot;,
174                            &quot;NONEwithRSA&quot;, &quot;sun.security.mscapi.CSignature$NONEwithRSA&quot;,
175                            null, attrs));
176                 putService(new ProviderService(p, &quot;Signature&quot;,
177                            &quot;SHA1withRSA&quot;, &quot;sun.security.mscapi.CSignature$SHA1withRSA&quot;,
178                            null, attrs));
179                 putService(new ProviderService(p, &quot;Signature&quot;,
180                            &quot;SHA256withRSA&quot;, &quot;sun.security.mscapi.CSignature$SHA256withRSA&quot;,
181                            new String[] { &quot;1.2.840.113549.1.1.11&quot;, &quot;OID.1.2.840.113549.1.1.11&quot; },
182                            attrs));
183                 putService(new ProviderService(p, &quot;Signature&quot;,
184                            &quot;SHA384withRSA&quot;, &quot;sun.security.mscapi.CSignature$SHA384withRSA&quot;,
185                            new String[] { &quot;1.2.840.113549.1.1.12&quot;, &quot;OID.1.2.840.113549.1.1.12&quot; },
186                            attrs));
187                 putService(new ProviderService(p, &quot;Signature&quot;,
188                            &quot;SHA512withRSA&quot;, &quot;sun.security.mscapi.CSignature$SHA512withRSA&quot;,
189                            new String[] { &quot;1.2.840.113549.1.1.13&quot;, &quot;OID.1.2.840.113549.1.1.13&quot; },
190                            attrs));
191                 putService(new ProviderService(p, &quot;Signature&quot;,
192                         &quot;RSASSA-PSS&quot;, &quot;sun.security.mscapi.CSignature$PSS&quot;,
193                         new String[] { &quot;1.2.840.113549.1.1.10&quot;, &quot;OID.1.2.840.113549.1.1.10&quot; },
194                         attrs));
195                 putService(new ProviderService(p, &quot;Signature&quot;,
196                            &quot;MD5withRSA&quot;, &quot;sun.security.mscapi.CSignature$MD5withRSA&quot;,
197                            null, attrs));
198                 putService(new ProviderService(p, &quot;Signature&quot;,
199                            &quot;MD2withRSA&quot;, &quot;sun.security.mscapi.CSignature$MD2withRSA&quot;,
200                            null, attrs));
201                 putService(new ProviderService(p, &quot;Signature&quot;,
202                         &quot;SHA1withECDSA&quot;, &quot;sun.security.mscapi.CSignature$SHA1withECDSA&quot;,
203                         new String[] { &quot;1.2.840.10045.4.1&quot;, &quot;OID.1.2.840.10045.4.1&quot; },
204                         attrs));
205                 putService(new ProviderService(p, &quot;Signature&quot;,
206                         &quot;SHA224withECDSA&quot;, &quot;sun.security.mscapi.CSignature$SHA224withECDSA&quot;,
207                         new String[] { &quot;1.2.840.10045.4.3.1&quot;, &quot;OID.1.2.840.10045.4.3.1&quot;},
208                         attrs));
209                 putService(new ProviderService(p, &quot;Signature&quot;,
210                         &quot;SHA256withECDSA&quot;, &quot;sun.security.mscapi.CSignature$SHA256withECDSA&quot;,
211                         new String[] { &quot;1.2.840.10045.4.3.2&quot;, &quot;OID.1.2.840.10045.4.3.2&quot;},
212                         attrs));
213                 putService(new ProviderService(p, &quot;Signature&quot;,
214                         &quot;SHA384withECDSA&quot;, &quot;sun.security.mscapi.CSignature$SHA384withECDSA&quot;,
215                         new String[] { &quot;1.2.840.10045.4.3.3&quot;, &quot;OID.1.2.840.10045.4.3.3&quot;},
216                         attrs));
217                 putService(new ProviderService(p, &quot;Signature&quot;,
218                         &quot;SHA512withECDSA&quot;, &quot;sun.security.mscapi.CSignature$SHA512withECDSA&quot;,
219                         new String[] { &quot;1.2.840.10045.4.3.4&quot;, &quot;OID.1.2.840.10045.4.3.4&quot;},
220                         attrs));
221                 /*
222                  * Key Pair Generator engines
223                  */
224                 attrs.clear();
225                 attrs.put(&quot;KeySize&quot;, &quot;16384&quot;);
226                 putService(new ProviderService(p, &quot;KeyPairGenerator&quot;,
227                            &quot;RSA&quot;, &quot;sun.security.mscapi.CKeyPairGenerator$RSA&quot;,
228                            null, attrs));
229 
230                 /*
231                  * Cipher engines
232                  */
233                 attrs.clear();
234                 attrs.put(&quot;SupportedModes&quot;, &quot;ECB&quot;);
235                 attrs.put(&quot;SupportedPaddings&quot;, &quot;PKCS1PADDING&quot;);
236                 attrs.put(&quot;SupportedKeyClasses&quot;, &quot;sun.security.mscapi.CKey&quot;);
237                 putService(new ProviderService(p, &quot;Cipher&quot;,
238                            &quot;RSA&quot;, &quot;sun.security.mscapi.CRSACipher&quot;,
239                            null, attrs));
240                 putService(new ProviderService(p, &quot;Cipher&quot;,
241                            &quot;RSA/ECB/PKCS1Padding&quot;, &quot;sun.security.mscapi.CRSACipher&quot;,
242                            null, attrs));
243                 return null;
244             }
245         });
246     }
247 }
    </pre>
  </body>
</html>