<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/jdk.crypto.mscapi/windows/classes/sun/security/mscapi/SunMSCAPI.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2005, 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.mscapi;
 27 
 28 import java.security.AccessController;
 29 import java.security.PrivilegedAction;
 30 import java.security.Provider;
 31 import java.security.NoSuchAlgorithmException;
 32 import java.security.InvalidParameterException;
 33 import java.security.ProviderException;
 34 import java.util.HashMap;
 35 import java.util.List;
 36 
 37 import static sun.security.util.SecurityConstants.PROVIDER_VER;
 38 import static sun.security.util.SecurityProviderConstants.getAliases;
 39 
 40 /**
 41  * A Cryptographic Service Provider for the Microsoft Crypto API.
 42  *
 43  * @since 1.6
 44  */
 45 
 46 public final class SunMSCAPI extends Provider {
 47 
 48     private static final long serialVersionUID = 8622598936488630849L; //TODO
 49 
 50     private static final String INFO = &quot;Sun&#39;s Microsoft Crypto API provider&quot;;
 51 
 52     static {
 53         AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {
 54             public Void run() {
 55                 System.loadLibrary(&quot;sunmscapi&quot;);
 56                 return null;
 57             }
 58         });
 59     }
 60     private static class ProviderServiceA extends ProviderService {
 61         ProviderServiceA(Provider p, String type, String algo, String cn,
 62                 HashMap&lt;String, String&gt; attrs) {
 63             super(p, type, algo, cn, getAliases(algo), attrs);
 64         }
 65     }
 66 
 67     private static class ProviderService extends Provider.Service {
 68         ProviderService(Provider p, String type, String algo, String cn) {
 69             super(p, type, algo, cn, null, null);
 70         }
 71 
 72         ProviderService(Provider p, String type, String algo, String cn,
 73             List&lt;String&gt; aliases, HashMap&lt;String, String&gt; attrs) {
 74             super(p, type, algo, cn, aliases, attrs);
 75         }
 76 
 77         @Override
 78         public Object newInstance(Object ctrParamObj)
 79             throws NoSuchAlgorithmException {
 80             String type = getType();
 81             if (ctrParamObj != null) {
 82                 throw new InvalidParameterException
 83                     (&quot;constructorParameter not used with &quot; + type +
 84                      &quot; engines&quot;);
 85             }
 86             String algo = getAlgorithm();
 87             try {
 88                 if (type.equals(&quot;SecureRandom&quot;)) {
 89                     if (algo.equals(&quot;Windows-PRNG&quot;)) {
 90                         return new PRNG();
 91                     }
 92                 } else if (type.equals(&quot;KeyStore&quot;)) {
 93                     if (algo.equals(&quot;Windows-MY&quot;)) {
 94                         return new CKeyStore.MY();
 95                     } else if (algo.equals(&quot;Windows-ROOT&quot;)) {
 96                         return new CKeyStore.ROOT();
 97                     }
 98                 } else if (type.equals(&quot;Signature&quot;)) {
 99                     if (algo.equals(&quot;NONEwithRSA&quot;)) {
100                         return new CSignature.NONEwithRSA();
101                     } else if (algo.equals(&quot;SHA1withRSA&quot;)) {
102                         return new CSignature.SHA1withRSA();
103                     } else if (algo.equals(&quot;SHA256withRSA&quot;)) {
104                         return new CSignature.SHA256withRSA();
105                     } else if (algo.equals(&quot;SHA384withRSA&quot;)) {
106                         return new CSignature.SHA384withRSA();
107                     } else if (algo.equals(&quot;SHA512withRSA&quot;)) {
108                         return new CSignature.SHA512withRSA();
109                     } else if (algo.equals(&quot;MD5withRSA&quot;)) {
110                         return new CSignature.MD5withRSA();
111                     } else if (algo.equals(&quot;MD2withRSA&quot;)) {
112                         return new CSignature.MD2withRSA();
113                     } else if (algo.equals(&quot;RSASSA-PSS&quot;)) {
114                         return new CSignature.PSS();
115                     } else if (algo.equals(&quot;SHA1withECDSA&quot;)) {
116                         return new CSignature.SHA1withECDSA();
117                     } else if (algo.equals(&quot;SHA224withECDSA&quot;)) {
118                         return new CSignature.SHA224withECDSA();
119                     } else if (algo.equals(&quot;SHA256withECDSA&quot;)) {
120                         return new CSignature.SHA256withECDSA();
121                     } else if (algo.equals(&quot;SHA384withECDSA&quot;)) {
122                         return new CSignature.SHA384withECDSA();
123                     } else if (algo.equals(&quot;SHA512withECDSA&quot;)) {
124                         return new CSignature.SHA512withECDSA();
125                     }
126                 } else if (type.equals(&quot;KeyPairGenerator&quot;)) {
127                     if (algo.equals(&quot;RSA&quot;)) {
128                         return new CKeyPairGenerator.RSA();
129                     }
130                 } else if (type.equals(&quot;Cipher&quot;)) {
131                     if (algo.equals(&quot;RSA&quot;) ||
132                         algo.equals(&quot;RSA/ECB/PKCS1Padding&quot;)) {
133                         return new CRSACipher();
134                     }
135                 }
136             } catch (Exception ex) {
137                 throw new NoSuchAlgorithmException
138                     (&quot;Error constructing &quot; + type + &quot; for &quot; +
139                     algo + &quot; using SunMSCAPI&quot;, ex);
140             }
141             throw new ProviderException(&quot;No impl for &quot; + algo +
142                 &quot; &quot; + type);
143         }
144     }
145 
146     public SunMSCAPI() {
147         super(&quot;SunMSCAPI&quot;, PROVIDER_VER, INFO);
148 
149         final Provider p = this;
150         AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {
151             public Void run() {
152                 /*
153                  * Secure random
154                  */
155                 HashMap&lt;String, String&gt; srattrs = new HashMap&lt;&gt;(1);
156                 srattrs.put(&quot;ThreadSafe&quot;, &quot;true&quot;);
157                 putService(new ProviderService(p, &quot;SecureRandom&quot;,
158                            &quot;Windows-PRNG&quot;, &quot;sun.security.mscapi.PRNG&quot;,
159                            null, srattrs));
160 
161                 /*
162                  * Key store
163                  */
164                 putService(new ProviderService(p, &quot;KeyStore&quot;,
165                            &quot;Windows-MY&quot;, &quot;sun.security.mscapi.CKeyStore$MY&quot;));
166                 putService(new ProviderService(p, &quot;KeyStore&quot;,
167                            &quot;Windows-ROOT&quot;, &quot;sun.security.mscapi.CKeyStore$ROOT&quot;));
168 
169                 /*
170                  * Signature engines
171                  */
172                 HashMap&lt;String, String&gt; attrs = new HashMap&lt;&gt;(1);
173                 attrs.put(&quot;SupportedKeyClasses&quot;, &quot;sun.security.mscapi.CKey&quot;);
174 
175                 // NONEwithRSA must be supplied with a pre-computed message digest.
176                 // Only the following digest algorithms are supported: MD5, SHA-1,
177                 // SHA-256, SHA-384, SHA-512 and a special-purpose digest
178                 // algorithm which is a concatenation of SHA-1 and MD5 digests.
179                 putService(new ProviderService(p, &quot;Signature&quot;,
180                            &quot;NONEwithRSA&quot;, &quot;sun.security.mscapi.CSignature$NONEwithRSA&quot;,
181                            null, attrs));
182                 putService(new ProviderService(p, &quot;Signature&quot;,
183                            &quot;SHA1withRSA&quot;, &quot;sun.security.mscapi.CSignature$SHA1withRSA&quot;,
184                            null, attrs));
185                 putService(new ProviderServiceA(p, &quot;Signature&quot;,
186                            &quot;SHA256withRSA&quot;,
187                            &quot;sun.security.mscapi.CSignature$SHA256withRSA&quot;,
188                            attrs));
189                 putService(new ProviderServiceA(p, &quot;Signature&quot;,
190                            &quot;SHA384withRSA&quot;,
191                            &quot;sun.security.mscapi.CSignature$SHA384withRSA&quot;,
192                            attrs));
193                 putService(new ProviderServiceA(p, &quot;Signature&quot;,
194                            &quot;SHA512withRSA&quot;,
195                            &quot;sun.security.mscapi.CSignature$SHA512withRSA&quot;,
196                            attrs));
197                 putService(new ProviderServiceA(p, &quot;Signature&quot;,
198                            &quot;RSASSA-PSS&quot;, &quot;sun.security.mscapi.CSignature$PSS&quot;,
199                            attrs));
200                 putService(new ProviderService(p, &quot;Signature&quot;,
201                            &quot;MD5withRSA&quot;, &quot;sun.security.mscapi.CSignature$MD5withRSA&quot;,
202                            null, attrs));
203                 putService(new ProviderService(p, &quot;Signature&quot;,
204                            &quot;MD2withRSA&quot;, &quot;sun.security.mscapi.CSignature$MD2withRSA&quot;,
205                            null, attrs));
206                 putService(new ProviderServiceA(p, &quot;Signature&quot;,
207                            &quot;SHA1withECDSA&quot;,
208                            &quot;sun.security.mscapi.CSignature$SHA1withECDSA&quot;,
209                            attrs));
210                 putService(new ProviderServiceA(p, &quot;Signature&quot;,
211                            &quot;SHA224withECDSA&quot;,
212                            &quot;sun.security.mscapi.CSignature$SHA224withECDSA&quot;,
213                            attrs));
214                 putService(new ProviderServiceA(p, &quot;Signature&quot;,
215                            &quot;SHA256withECDSA&quot;,
216                            &quot;sun.security.mscapi.CSignature$SHA256withECDSA&quot;,
217                            attrs));
218                 putService(new ProviderServiceA(p, &quot;Signature&quot;,
219                            &quot;SHA384withECDSA&quot;,
220                            &quot;sun.security.mscapi.CSignature$SHA384withECDSA&quot;,
221                            attrs));
222                 putService(new ProviderServiceA(p, &quot;Signature&quot;,
223                            &quot;SHA512withECDSA&quot;,
224                            &quot;sun.security.mscapi.CSignature$SHA512withECDSA&quot;,
225                            attrs));
226                 /*
227                  * Key Pair Generator engines
228                  */
229                 attrs.clear();
230                 attrs.put(&quot;KeySize&quot;, &quot;16384&quot;);
231                 putService(new ProviderService(p, &quot;KeyPairGenerator&quot;,
232                            &quot;RSA&quot;, &quot;sun.security.mscapi.CKeyPairGenerator$RSA&quot;,
233                            null, attrs));
234 
235                 /*
236                  * Cipher engines
237                  */
238                 attrs.clear();
239                 attrs.put(&quot;SupportedModes&quot;, &quot;ECB&quot;);
240                 attrs.put(&quot;SupportedPaddings&quot;, &quot;PKCS1PADDING&quot;);
241                 attrs.put(&quot;SupportedKeyClasses&quot;, &quot;sun.security.mscapi.CKey&quot;);
242                 putService(new ProviderService(p, &quot;Cipher&quot;,
243                            &quot;RSA&quot;, &quot;sun.security.mscapi.CRSACipher&quot;,
244                            null, attrs));
245                 putService(new ProviderService(p, &quot;Cipher&quot;,
246                            &quot;RSA/ECB/PKCS1Padding&quot;, &quot;sun.security.mscapi.CRSACipher&quot;,
247                            null, attrs));
248                 return null;
249             }
250         });
251     }
252 }
    </pre>
  </body>
</html>