<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/com/sun/crypto/provider/KeyProtector.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DHPublicKey.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="OAEPParameters.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/com/sun/crypto/provider/KeyProtector.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -46,10 +46,11 @@</span>
  import javax.crypto.spec.*;
  import javax.security.auth.DestroyFailedException;
  
  import sun.security.x509.AlgorithmId;
  import sun.security.util.ObjectIdentifier;
<span class="udiff-line-added">+ import sun.security.util.KnownOIDs;</span>
  import sun.security.util.SecurityProperties;
  
  /**
   * This class implements a protection mechanism for private keys. In JCE, we
   * use a stronger protection mechanism than in the JDK, because we can use
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -65,18 +66,10 @@</span>
   * @see JceKeyStore
   */
  
  final class KeyProtector {
  
<span class="udiff-line-removed">-     // defined by SunSoft (SKI project)</span>
<span class="udiff-line-removed">-     private static final String PBE_WITH_MD5_AND_DES3_CBC_OID</span>
<span class="udiff-line-removed">-             = &quot;1.3.6.1.4.1.42.2.19.1&quot;;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     // JavaSoft proprietary key-protection algorithm (used to protect private</span>
<span class="udiff-line-removed">-     // keys in the keystore implementation that comes with JDK 1.2)</span>
<span class="udiff-line-removed">-     private static final String KEY_PROTECTOR_OID = &quot;1.3.6.1.4.1.42.2.17.1.1&quot;;</span>
<span class="udiff-line-removed">- </span>
      private static final int MAX_ITERATION_COUNT = 5000000;
      private static final int MIN_ITERATION_COUNT = 10000;
      private static final int DEFAULT_ITERATION_COUNT = 200000;
      private static final int SALT_LEN = 20; // the salt length
      private static final int DIGEST_LEN = 20;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -152,11 +145,12 @@</span>
          AlgorithmParameters pbeParams =
              AlgorithmParameters.getInstance(&quot;PBE&quot;, SunJCE.getInstance());
          pbeParams.init(pbeSpec);
  
          AlgorithmId encrAlg = new AlgorithmId
<span class="udiff-line-modified-removed">-             (new ObjectIdentifier(PBE_WITH_MD5_AND_DES3_CBC_OID), pbeParams);</span>
<span class="udiff-line-modified-added">+             (ObjectIdentifier.of(KnownOIDs.JAVASOFT_JCEKeyProtector),</span>
<span class="udiff-line-added">+              pbeParams);</span>
          return new EncryptedPrivateKeyInfo(encrAlg,encrKey).getEncoded();
      }
  
      /*
       * Recovers the cleartext version of the given key (in protected format),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -167,17 +161,17 @@</span>
      {
          byte[] plain = null;
          SecretKey sKey = null;
          try {
              String encrAlg = encrInfo.getAlgorithm().getOID().toString();
<span class="udiff-line-modified-removed">-             if (!encrAlg.equals(PBE_WITH_MD5_AND_DES3_CBC_OID)</span>
<span class="udiff-line-modified-removed">-                 &amp;&amp; !encrAlg.equals(KEY_PROTECTOR_OID)) {</span>
<span class="udiff-line-modified-added">+             if (!encrAlg.equals(KnownOIDs.JAVASOFT_JCEKeyProtector.value())</span>
<span class="udiff-line-modified-added">+                 &amp;&amp; !encrAlg.equals(KnownOIDs.JAVASOFT_JDKKeyProtector.value())) {</span>
                  throw new UnrecoverableKeyException(&quot;Unsupported encryption &quot;
                                                      + &quot;algorithm&quot;);
              }
  
<span class="udiff-line-modified-removed">-             if (encrAlg.equals(KEY_PROTECTOR_OID)) {</span>
<span class="udiff-line-modified-added">+             if (encrAlg.equals(KnownOIDs.JAVASOFT_JDKKeyProtector.value())) {</span>
                  // JDK 1.2 style recovery
                  plain = recover(encrInfo.getEncryptedData());
              } else {
                  byte[] encodedParams =
                      encrInfo.getAlgorithm().getEncodedParams();
</pre>
<center><a href="DHPublicKey.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="OAEPParameters.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>