<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/com/sun/crypto/provider/PBES2Parameters.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="OAEPParameters.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SunJCE.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/com/sun/crypto/provider/PBES2Parameters.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 91,29 ***</span>
   * &lt;/pre&gt;
   */
  abstract class PBES2Parameters extends AlgorithmParametersSpi {
  
      private static ObjectIdentifier pkcs5PBKDF2_OID =
<span class="line-modified">!             ObjectIdentifier.of(&quot;1.2.840.113549.1.5.12&quot;);</span>
      private static ObjectIdentifier pkcs5PBES2_OID =
<span class="line-modified">!             ObjectIdentifier.of(&quot;1.2.840.113549.1.5.13&quot;);</span>
<span class="line-removed">-     private static ObjectIdentifier hmacWithSHA1_OID =</span>
<span class="line-removed">-             ObjectIdentifier.of(&quot;1.2.840.113549.2.7&quot;);</span>
<span class="line-removed">-     private static ObjectIdentifier hmacWithSHA224_OID =</span>
<span class="line-removed">-             ObjectIdentifier.of(&quot;1.2.840.113549.2.8&quot;);</span>
<span class="line-removed">-     private static ObjectIdentifier hmacWithSHA256_OID =</span>
<span class="line-removed">-             ObjectIdentifier.of(&quot;1.2.840.113549.2.9&quot;);</span>
<span class="line-removed">-     private static ObjectIdentifier hmacWithSHA384_OID =</span>
<span class="line-removed">-             ObjectIdentifier.of(&quot;1.2.840.113549.2.10&quot;);</span>
<span class="line-removed">-     private static ObjectIdentifier hmacWithSHA512_OID =</span>
<span class="line-removed">-             ObjectIdentifier.of(&quot;1.2.840.113549.2.11&quot;);</span>
      private static ObjectIdentifier aes128CBC_OID =
<span class="line-modified">!             ObjectIdentifier.of(&quot;2.16.840.1.101.3.4.1.2&quot;);</span>
      private static ObjectIdentifier aes192CBC_OID =
<span class="line-modified">!             ObjectIdentifier.of(&quot;2.16.840.1.101.3.4.1.22&quot;);</span>
      private static ObjectIdentifier aes256CBC_OID =
<span class="line-modified">!             ObjectIdentifier.of(&quot;2.16.840.1.101.3.4.1.42&quot;);</span>
  
      // the PBES2 algorithm name
      private String pbes2AlgorithmName = null;
  
      // the salt
<span class="line-new-header">--- 91,19 ---</span>
   * &lt;/pre&gt;
   */
  abstract class PBES2Parameters extends AlgorithmParametersSpi {
  
      private static ObjectIdentifier pkcs5PBKDF2_OID =
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.PBKDF2WithHmacSHA1);</span>
      private static ObjectIdentifier pkcs5PBES2_OID =
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.PBES2);</span>
      private static ObjectIdentifier aes128CBC_OID =
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.AES_128$CBC$NoPadding);</span>
      private static ObjectIdentifier aes192CBC_OID =
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.AES_192$CBC$NoPadding);</span>
      private static ObjectIdentifier aes256CBC_OID =
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.AES_256$CBC$NoPadding);</span>
  
      // the PBES2 algorithm name
      private String pbes2AlgorithmName = null;
  
      // the salt
</pre>
<hr />
<pre>
<span class="line-old-header">*** 124,11 ***</span>
  
      // the cipher parameter
      private AlgorithmParameterSpec cipherParam = null;
  
      // the key derivation function (default is HmacSHA1)
<span class="line-modified">!     private ObjectIdentifier kdfAlgo_OID = hmacWithSHA1_OID;</span>
  
      // the encryption function
      private ObjectIdentifier cipherAlgo_OID = null;
  
      // the cipher keysize (in bits)
<span class="line-new-header">--- 114,12 ---</span>
  
      // the cipher parameter
      private AlgorithmParameterSpec cipherParam = null;
  
      // the key derivation function (default is HmacSHA1)
<span class="line-modified">!     private ObjectIdentifier kdfAlgo_OID =</span>
<span class="line-added">+             ObjectIdentifier.of(KnownOIDs.HmacSHA1);</span>
  
      // the encryption function
      private ObjectIdentifier cipherAlgo_OID = null;
  
      // the cipher keysize (in bits)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 169,23 ***</span>
                  pbes2AlgorithmName);
          }
  
          switch (kdfAlgo) {
          case &quot;HmacSHA1&quot;:
<span class="line-removed">-             kdfAlgo_OID = hmacWithSHA1_OID;</span>
<span class="line-removed">-             break;</span>
          case &quot;HmacSHA224&quot;:
<span class="line-removed">-             kdfAlgo_OID = hmacWithSHA224_OID;</span>
<span class="line-removed">-             break;</span>
          case &quot;HmacSHA256&quot;:
<span class="line-removed">-             kdfAlgo_OID = hmacWithSHA256_OID;</span>
<span class="line-removed">-             break;</span>
          case &quot;HmacSHA384&quot;:
<span class="line-removed">-             kdfAlgo_OID = hmacWithSHA384_OID;</span>
<span class="line-removed">-             break;</span>
          case &quot;HmacSHA512&quot;:
<span class="line-modified">!             kdfAlgo_OID = hmacWithSHA512_OID;</span>
              break;
          default:
              throw new NoSuchAlgorithmException(
                  &quot;No crypto implementation for &quot; + kdfAlgo);
          }
<span class="line-new-header">--- 160,15 ---</span>
                  pbes2AlgorithmName);
          }
  
          switch (kdfAlgo) {
          case &quot;HmacSHA1&quot;:
          case &quot;HmacSHA224&quot;:
          case &quot;HmacSHA256&quot;:
          case &quot;HmacSHA384&quot;:
          case &quot;HmacSHA512&quot;:
<span class="line-modified">!             kdfAlgo_OID = ObjectIdentifier.of(KnownOIDs.findMatch(kdfAlgo));</span>
              break;
          default:
              throw new NoSuchAlgorithmException(
                  &quot;No crypto implementation for &quot; + kdfAlgo);
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 253,11 ***</span>
              throw new IOException(&quot;PBE parameter parsing error: &quot;
                  + &quot;not an ASN.1 SEQUENCE tag&quot;);
          }
          cipherAlgo = parseES(pBES2_params.data.getDerValue());
  
<span class="line-modified">!         pbes2AlgorithmName = new StringBuilder().append(&quot;PBEWith&quot;)</span>
              .append(kdfAlgo).append(&quot;And&quot;).append(cipherAlgo).toString();
      }
  
      @SuppressWarnings(&quot;deprecation&quot;)
      private String parseKDF(DerValue keyDerivationFunc) throws IOException {
<span class="line-new-header">--- 236,11 ---</span>
              throw new IOException(&quot;PBE parameter parsing error: &quot;
                  + &quot;not an ASN.1 SEQUENCE tag&quot;);
          }
          cipherAlgo = parseES(pBES2_params.data.getDerValue());
  
<span class="line-modified">!         this.pbes2AlgorithmName = new StringBuilder().append(&quot;PBEWith&quot;)</span>
              .append(kdfAlgo).append(&quot;And&quot;).append(cipherAlgo).toString();
      }
  
      @SuppressWarnings(&quot;deprecation&quot;)
      private String parseKDF(DerValue keyDerivationFunc) throws IOException {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 304,25 ***</span>
                  prf = pBKDF2_params.data.getDerValue();
              }
          }
          if (prf != null) {
              kdfAlgo_OID = prf.data.getOID();
<span class="line-modified">!             if (hmacWithSHA1_OID.equals(kdfAlgo_OID)) {</span>
<span class="line-modified">!                 kdfAlgo = &quot;HmacSHA1&quot;;</span>
<span class="line-modified">!             } else if (hmacWithSHA224_OID.equals(kdfAlgo_OID)) {</span>
<span class="line-modified">!                 kdfAlgo = &quot;HmacSHA224&quot;;</span>
<span class="line-modified">!             } else if (hmacWithSHA256_OID.equals(kdfAlgo_OID)) {</span>
<span class="line-modified">!                 kdfAlgo = &quot;HmacSHA256&quot;;</span>
<span class="line-removed">-             } else if (hmacWithSHA384_OID.equals(kdfAlgo_OID)) {</span>
<span class="line-removed">-                 kdfAlgo = &quot;HmacSHA384&quot;;</span>
<span class="line-removed">-             } else if (hmacWithSHA512_OID.equals(kdfAlgo_OID)) {</span>
<span class="line-removed">-                 kdfAlgo = &quot;HmacSHA512&quot;;</span>
<span class="line-removed">-             } else {</span>
                  throw new IOException(&quot;PBE parameter parsing error: &quot;
                          + &quot;expecting the object identifier for a HmacSHA key &quot;
                          + &quot;derivation function&quot;);
              }
              if (prf.data.available() != 0) {
                  // parameter is &#39;NULL&#39; for all HmacSHA KDFs
                  DerValue parameter = prf.data.getDerValue();
                  if (parameter.tag != DerValue.tag_Null) {
                      throw new IOException(&quot;PBE parameter parsing error: &quot;
<span class="line-new-header">--- 287,22 ---</span>
                  prf = pBKDF2_params.data.getDerValue();
              }
          }
          if (prf != null) {
              kdfAlgo_OID = prf.data.getOID();
<span class="line-modified">!             KnownOIDs o = KnownOIDs.findMatch(kdfAlgo_OID.toString());</span>
<span class="line-modified">!             if (o == null || (!o.stdName().equals(&quot;HmacSHA1&quot;) &amp;&amp;</span>
<span class="line-modified">!                 !o.stdName().equals(&quot;HmacSHA224&quot;) &amp;&amp;</span>
<span class="line-modified">!                 !o.stdName().equals(&quot;HmacSHA256&quot;) &amp;&amp;</span>
<span class="line-modified">!                 !o.stdName().equals(&quot;HmacSHA384&quot;) &amp;&amp;</span>
<span class="line-modified">!                 !o.stdName().equals(&quot;HmacSHA512&quot;))) {</span>
                  throw new IOException(&quot;PBE parameter parsing error: &quot;
                          + &quot;expecting the object identifier for a HmacSHA key &quot;
                          + &quot;derivation function&quot;);
              }
<span class="line-added">+             kdfAlgo = o.stdName();</span>
<span class="line-added">+ </span>
              if (prf.data.available() != 0) {
                  // parameter is &#39;NULL&#39; for all HmacSHA KDFs
                  DerValue parameter = prf.data.getDerValue();
                  if (parameter.tag != DerValue.tag_Null) {
                      throw new IOException(&quot;PBE parameter parsing error: &quot;
</pre>
<center><a href="OAEPParameters.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SunJCE.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>