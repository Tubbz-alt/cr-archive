<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/java/net/MulticastSocket.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="DatagramSocketImpl.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../nio/channels/DatagramChannel.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/net/MulticastSocket.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,13 +26,10 @@</span>
  package java.net;
  
  import java.io.IOException;
  import java.nio.channels.DatagramChannel;
  import java.nio.channels.MulticastChannel;
<span class="udiff-line-removed">- import java.util.Collections;</span>
<span class="udiff-line-removed">- import java.util.Enumeration;</span>
<span class="udiff-line-removed">- import java.util.Set;</span>
  
  /**
   * The multicast datagram socket class is useful for sending
   * and receiving IP multicast packets. A MulticastSocket is
   * a (UDP) DatagramSocket, with additional capabilities for
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -133,15 +130,23 @@</span>
   * @author Pavani Diwanji
   * @since 1.1
   */
  public class MulticastSocket extends DatagramSocket {
  
<span class="udiff-line-added">+     @Override</span>
<span class="udiff-line-added">+     final MulticastSocket delegate() {</span>
<span class="udiff-line-added">+         return (MulticastSocket) super.delegate();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
<span class="udiff-line-modified-removed">-      * Used on some platforms to record if an outgoing interface</span>
<span class="udiff-line-modified-removed">-      * has been set for this socket.</span>
<span class="udiff-line-modified-added">+      * Create a MulticastSocket that delegates to the given delegate if not null.</span>
<span class="udiff-line-modified-added">+      * @param delegate the delegate, can be null.</span>
       */
<span class="udiff-line-modified-removed">-     private boolean interfaceSet;</span>
<span class="udiff-line-modified-added">+     MulticastSocket(MulticastSocket delegate)  {</span>
<span class="udiff-line-added">+         super(delegate);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
  
      /**
       * Create a multicast socket.
       *
       * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -214,48 +219,13 @@</span>
       * @see      java.net.DatagramSocket#setReuseAddress(boolean)
       *
       * @since 1.4
       */
      public MulticastSocket(SocketAddress bindaddr) throws IOException {
<span class="udiff-line-modified-removed">-         super((SocketAddress) null);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         // No further initialization when this is a DatagramChannel socket adaptor</span>
<span class="udiff-line-removed">-         if (this instanceof sun.nio.ch.DatagramSocketAdaptor)</span>
<span class="udiff-line-removed">-             return;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         // Enable SO_REUSEADDR before binding</span>
<span class="udiff-line-removed">-         setReuseAddress(true);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (bindaddr != null) {</span>
<span class="udiff-line-removed">-             try {</span>
<span class="udiff-line-removed">-                 bind(bindaddr);</span>
<span class="udiff-line-removed">-             } finally {</span>
<span class="udiff-line-removed">-                 if (!isBound()) {</span>
<span class="udiff-line-removed">-                     close();</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         this(createDelegate(bindaddr, MulticastSocket.class));</span>
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * The lock on the socket&#39;s TTL. This is for set/getTTL and</span>
<span class="udiff-line-removed">-      * send(packet,ttl).</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     private Object ttlLock = new Object();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * The lock on the socket&#39;s interface - used by setInterface</span>
<span class="udiff-line-removed">-      * and getInterface</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     private Object infLock = new Object();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * The &quot;last&quot; interface set by setInterface on this MulticastSocket</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     private InetAddress infAddress = null;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
      /**
       * Set the default time-to-live for multicast packets sent out
       * on this {@code MulticastSocket} in order to control the
       * scope of the multicasts.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -269,13 +239,11 @@</span>
       *             &lt;b&gt;int&lt;/b&gt; instead of &lt;b&gt;byte&lt;/b&gt; as the type for ttl.
       * @see #getTTL()
       */
      @Deprecated
      public void setTTL(byte ttl) throws IOException {
<span class="udiff-line-modified-removed">-         if (isClosed())</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">-         getImpl().setTTL(ttl);</span>
<span class="udiff-line-modified-added">+         delegate().setTTL(ttl);</span>
      }
  
      /**
       * Set the default time-to-live for multicast packets sent out
       * on this {@code MulticastSocket} in order to control the
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -295,16 +263,11 @@</span>
       *
       * @see #getTimeToLive()
       * @since 1.2
       */
      public void setTimeToLive(int ttl) throws IOException {
<span class="udiff-line-modified-removed">-         if (ttl &lt; 0 || ttl &gt; 255) {</span>
<span class="udiff-line-removed">-             throw new IllegalArgumentException(&quot;ttl out of range&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         if (isClosed())</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">-         getImpl().setTimeToLive(ttl);</span>
<span class="udiff-line-modified-added">+         delegate().setTimeToLive(ttl);</span>
      }
  
      /**
       * Get the default time-to-live for multicast packets sent out on
       * the socket.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -316,13 +279,11 @@</span>
       * an &lt;b&gt;int&lt;/b&gt; instead of a &lt;b&gt;byte&lt;/b&gt;.
       * @see #setTTL(byte)
       */
      @Deprecated
      public byte getTTL() throws IOException {
<span class="udiff-line-modified-removed">-         if (isClosed())</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">-         return getImpl().getTTL();</span>
<span class="udiff-line-modified-added">+         return delegate().getTTL();</span>
      }
  
      /**
       * Get the default time-to-live for multicast packets sent out on
       * the socket.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -331,13 +292,11 @@</span>
       * @return the default time-to-live value
       * @see #setTimeToLive(int)
       * @since 1.2
       */
      public int getTimeToLive() throws IOException {
<span class="udiff-line-modified-removed">-         if (isClosed())</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">-         return getImpl().getTimeToLive();</span>
<span class="udiff-line-modified-added">+         return delegate().getTimeToLive();</span>
      }
  
      /**
       * Joins a multicast group. Its behavior may be affected by
       * {@code setInterface} or {@code setNetworkInterface}.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -357,35 +316,11 @@</span>
       *             {@link #joinGroup(SocketAddress, NetworkInterface)} instead.
       * @see        SecurityManager#checkMulticast(InetAddress)
       */
      @Deprecated(since=&quot;14&quot;)
      public void joinGroup(InetAddress mcastaddr) throws IOException {
<span class="udiff-line-modified-removed">-         if (isClosed()) {</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         checkAddress(mcastaddr, &quot;joinGroup&quot;);</span>
<span class="udiff-line-removed">-         SecurityManager security = System.getSecurityManager();</span>
<span class="udiff-line-removed">-         if (security != null) {</span>
<span class="udiff-line-removed">-             security.checkMulticast(mcastaddr);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (!mcastaddr.isMulticastAddress()) {</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Not a multicast address&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         /**</span>
<span class="udiff-line-removed">-          * required for some platforms where it&#39;s not possible to join</span>
<span class="udiff-line-removed">-          * a group without setting the interface first.</span>
<span class="udiff-line-removed">-          */</span>
<span class="udiff-line-removed">-         NetworkInterface defaultInterface = NetworkInterface.getDefault();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (!interfaceSet &amp;&amp; defaultInterface != null) {</span>
<span class="udiff-line-removed">-             setNetworkInterface(defaultInterface);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         getImpl().join(mcastaddr);</span>
<span class="udiff-line-modified-added">+         delegate().joinGroup(mcastaddr);</span>
      }
  
      /**
       * Leave a multicast group. Its behavior may be affected by
       * {@code setInterface} or {@code setNetworkInterface}.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -404,25 +339,11 @@</span>
       *             {@link #leaveGroup(SocketAddress, NetworkInterface)} instead.
       * @see        SecurityManager#checkMulticast(InetAddress)
       */
      @Deprecated(since=&quot;14&quot;)
      public void leaveGroup(InetAddress mcastaddr) throws IOException {
<span class="udiff-line-modified-removed">-         if (isClosed()) {</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         checkAddress(mcastaddr, &quot;leaveGroup&quot;);</span>
<span class="udiff-line-removed">-         SecurityManager security = System.getSecurityManager();</span>
<span class="udiff-line-removed">-         if (security != null) {</span>
<span class="udiff-line-removed">-             security.checkMulticast(mcastaddr);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (!mcastaddr.isMulticastAddress()) {</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Not a multicast address&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         getImpl().leave(mcastaddr);</span>
<span class="udiff-line-modified-added">+         delegate().leaveGroup(mcastaddr);</span>
      }
  
      /**
       * Joins the specified multicast group at the specified interface.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -450,30 +371,11 @@</span>
       * @see    DatagramChannel#join(InetAddress, NetworkInterface)
       * @since  1.4
       */
      public void joinGroup(SocketAddress mcastaddr, NetworkInterface netIf)
          throws IOException {
<span class="udiff-line-modified-removed">-         if (isClosed())</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (mcastaddr == null || !(mcastaddr instanceof InetSocketAddress))</span>
<span class="udiff-line-removed">-             throw new IllegalArgumentException(&quot;Unsupported address type&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (oldImpl)</span>
<span class="udiff-line-removed">-             throw new UnsupportedOperationException();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         checkAddress(((InetSocketAddress)mcastaddr).getAddress(), &quot;joinGroup&quot;);</span>
<span class="udiff-line-removed">-         SecurityManager security = System.getSecurityManager();</span>
<span class="udiff-line-removed">-         if (security != null) {</span>
<span class="udiff-line-removed">-             security.checkMulticast(((InetSocketAddress)mcastaddr).getAddress());</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (!((InetSocketAddress)mcastaddr).getAddress().isMulticastAddress()) {</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Not a multicast address&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         getImpl().joinGroup(mcastaddr, netIf);</span>
<span class="udiff-line-modified-added">+         delegate().joinGroup(mcastaddr, netIf);</span>
      }
  
      /**
       * Leave a multicast group on a specified local interface.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -498,30 +400,11 @@</span>
       * @see    SecurityManager#checkMulticast(InetAddress)
       * @since  1.4
       */
      public void leaveGroup(SocketAddress mcastaddr, NetworkInterface netIf)
          throws IOException {
<span class="udiff-line-modified-removed">-         if (isClosed())</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (mcastaddr == null || !(mcastaddr instanceof InetSocketAddress))</span>
<span class="udiff-line-removed">-             throw new IllegalArgumentException(&quot;Unsupported address type&quot;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (oldImpl)</span>
<span class="udiff-line-removed">-             throw new UnsupportedOperationException();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         checkAddress(((InetSocketAddress)mcastaddr).getAddress(), &quot;leaveGroup&quot;);</span>
<span class="udiff-line-removed">-         SecurityManager security = System.getSecurityManager();</span>
<span class="udiff-line-removed">-         if (security != null) {</span>
<span class="udiff-line-removed">-             security.checkMulticast(((InetSocketAddress)mcastaddr).getAddress());</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (!((InetSocketAddress)mcastaddr).getAddress().isMulticastAddress()) {</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Not a multicast address&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         getImpl().leaveGroup(mcastaddr, netIf);</span>
<span class="udiff-line-modified-added">+         delegate().leaveGroup(mcastaddr, netIf);</span>
       }
  
      /**
       * Set the multicast network interface used by methods
       * whose behavior would be affected by the value of the
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -535,19 +418,11 @@</span>
       *             {@link #setNetworkInterface(NetworkInterface)} instead.
       * @see        #getInterface()
       */
      @Deprecated(since=&quot;14&quot;)
      public void setInterface(InetAddress inf) throws SocketException {
<span class="udiff-line-modified-removed">-         if (isClosed()) {</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         checkAddress(inf, &quot;setInterface&quot;);</span>
<span class="udiff-line-removed">-         synchronized (infLock) {</span>
<span class="udiff-line-removed">-             getImpl().setOption(SocketOptions.IP_MULTICAST_IF, inf);</span>
<span class="udiff-line-removed">-             infAddress = inf;</span>
<span class="udiff-line-removed">-             interfaceSet = true;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         delegate().setInterface(inf);</span>
      }
  
      /**
       * Retrieve the address of the network interface used for
       * multicast packets.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -563,57 +438,11 @@</span>
       *             Use {@link #getNetworkInterface()} instead.
       * @see        #setInterface(java.net.InetAddress)
       */
      @Deprecated(since=&quot;14&quot;)
      public InetAddress getInterface() throws SocketException {
<span class="udiff-line-modified-removed">-         if (isClosed()) {</span>
<span class="udiff-line-removed">-             throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         synchronized (infLock) {</span>
<span class="udiff-line-removed">-             InetAddress ia =</span>
<span class="udiff-line-removed">-                 (InetAddress)getImpl().getOption(SocketOptions.IP_MULTICAST_IF);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             /**</span>
<span class="udiff-line-removed">-              * No previous setInterface or interface can be</span>
<span class="udiff-line-removed">-              * set using setNetworkInterface</span>
<span class="udiff-line-removed">-              */</span>
<span class="udiff-line-removed">-             if (infAddress == null) {</span>
<span class="udiff-line-removed">-                 return ia;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             /**</span>
<span class="udiff-line-removed">-              * Same interface set with setInterface?</span>
<span class="udiff-line-removed">-              */</span>
<span class="udiff-line-removed">-             if (ia.equals(infAddress)) {</span>
<span class="udiff-line-removed">-                 return ia;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             /**</span>
<span class="udiff-line-removed">-              * Different InetAddress from what we set with setInterface</span>
<span class="udiff-line-removed">-              * so enumerate the current interface to see if the</span>
<span class="udiff-line-removed">-              * address set by setInterface is bound to this interface.</span>
<span class="udiff-line-removed">-              */</span>
<span class="udiff-line-removed">-             try {</span>
<span class="udiff-line-removed">-                 NetworkInterface ni = NetworkInterface.getByInetAddress(ia);</span>
<span class="udiff-line-removed">-                 Enumeration&lt;InetAddress&gt; addrs = ni.getInetAddresses();</span>
<span class="udiff-line-removed">-                 while (addrs.hasMoreElements()) {</span>
<span class="udiff-line-removed">-                     InetAddress addr = addrs.nextElement();</span>
<span class="udiff-line-removed">-                     if (addr.equals(infAddress)) {</span>
<span class="udiff-line-removed">-                         return infAddress;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                 /**</span>
<span class="udiff-line-removed">-                  * No match so reset infAddress to indicate that the</span>
<span class="udiff-line-removed">-                  * interface has changed via means</span>
<span class="udiff-line-removed">-                  */</span>
<span class="udiff-line-removed">-                 infAddress = null;</span>
<span class="udiff-line-removed">-                 return ia;</span>
<span class="udiff-line-removed">-             } catch (Exception e) {</span>
<span class="udiff-line-removed">-                 return ia;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         return delegate().getInterface();</span>
      }
  
      /**
       * Specify the network interface for outgoing multicast datagrams
       * sent on this socket.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -624,16 +453,11 @@</span>
       * @see #getNetworkInterface()
       * @since 1.4
       */
      public void setNetworkInterface(NetworkInterface netIf)
          throws SocketException {
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-         synchronized (infLock) {</span>
<span class="udiff-line-removed">-             getImpl().setOption(SocketOptions.IP_MULTICAST_IF2, netIf);</span>
<span class="udiff-line-removed">-             infAddress = null;</span>
<span class="udiff-line-removed">-             interfaceSet = true;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         delegate().setNetworkInterface(netIf);</span>
      }
  
      /**
       * Get the multicast network interface set.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -644,19 +468,11 @@</span>
       *         a single InetAddress to represent any local address.
       * @see    #setNetworkInterface(NetworkInterface)
       * @since  1.4
       */
      public NetworkInterface getNetworkInterface() throws SocketException {
<span class="udiff-line-modified-removed">-         NetworkInterface ni</span>
<span class="udiff-line-removed">-             = (NetworkInterface)getImpl().getOption(SocketOptions.IP_MULTICAST_IF2);</span>
<span class="udiff-line-removed">-         if (ni == null) {</span>
<span class="udiff-line-removed">-             InetAddress[] addrs = new InetAddress[1];</span>
<span class="udiff-line-removed">-             addrs[0] = InetAddress.anyLocalAddress();</span>
<span class="udiff-line-removed">-             return new NetworkInterface(addrs[0].getHostName(), 0, addrs);</span>
<span class="udiff-line-removed">-         } else {</span>
<span class="udiff-line-removed">-             return ni;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         return delegate().getNetworkInterface();</span>
      }
  
      /**
       * Disable/Enable local loopback of multicast datagrams.
       * The option is used by the platform&#39;s networking code as a hint
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -676,11 +492,11 @@</span>
       *             disables it.
       * @see        #getLoopbackMode
       */
      @Deprecated(since=&quot;14&quot;)
      public void setLoopbackMode(boolean disable) throws SocketException {
<span class="udiff-line-modified-removed">-         getImpl().setOption(SocketOptions.IP_MULTICAST_LOOP, Boolean.valueOf(disable));</span>
<span class="udiff-line-modified-added">+         delegate().setLoopbackMode(disable);</span>
      }
  
      /**
       * Get the setting for local loopback of multicast datagrams.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -692,11 +508,11 @@</span>
       *             instead.
       * @see        #setLoopbackMode
       */
      @Deprecated(since=&quot;14&quot;)
      public boolean getLoopbackMode() throws SocketException {
<span class="udiff-line-modified-removed">-         return ((Boolean)getImpl().getOption(SocketOptions.IP_MULTICAST_LOOP)).booleanValue();</span>
<span class="udiff-line-modified-added">+         return delegate().getLoopbackMode();</span>
      }
  
      /**
       * Sends a datagram packet to the destination, with a TTL (time-to-live)
       * other than the default for the socket.  This method
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -753,62 +569,8 @@</span>
       * @see SecurityManager#checkConnect
       */
      @Deprecated
      public void send(DatagramPacket p, byte ttl)
          throws IOException {
<span class="udiff-line-modified-removed">-             if (isClosed())</span>
<span class="udiff-line-modified-removed">-                 throw new SocketException(&quot;Socket is closed&quot;);</span>
<span class="udiff-line-removed">-             synchronized(ttlLock) {</span>
<span class="udiff-line-removed">-                 synchronized(p) {</span>
<span class="udiff-line-removed">-                     InetAddress packetAddress = p.getAddress();</span>
<span class="udiff-line-removed">-                     int packetPort = p.getPort();</span>
<span class="udiff-line-removed">-                     checkAddress(packetAddress, &quot;send&quot;);</span>
<span class="udiff-line-removed">-                     if (connectState == ST_NOT_CONNECTED) {</span>
<span class="udiff-line-removed">-                         if (packetAddress == null) {</span>
<span class="udiff-line-removed">-                             throw new IllegalArgumentException(&quot;Address not set&quot;);</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                         if (packetPort &lt; 0 || packetPort &gt; 0xFFFF)</span>
<span class="udiff-line-removed">-                             throw new IllegalArgumentException(&quot;port out of range:&quot; + packetPort);</span>
<span class="udiff-line-removed">-                         // Security manager makes sure that the multicast address</span>
<span class="udiff-line-removed">-                         // is allowed one and that the ttl used is less</span>
<span class="udiff-line-removed">-                         // than the allowed maxttl.</span>
<span class="udiff-line-removed">-                         SecurityManager security = System.getSecurityManager();</span>
<span class="udiff-line-removed">-                         if (security != null) {</span>
<span class="udiff-line-removed">-                             if (packetAddress.isMulticastAddress()) {</span>
<span class="udiff-line-removed">-                                 security.checkMulticast(packetAddress, ttl);</span>
<span class="udiff-line-removed">-                             } else {</span>
<span class="udiff-line-removed">-                                 security.checkConnect(packetAddress.getHostAddress(),</span>
<span class="udiff-line-removed">-                                         packetPort);</span>
<span class="udiff-line-removed">-                             }</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                     } else {</span>
<span class="udiff-line-removed">-                         // we&#39;re connected</span>
<span class="udiff-line-removed">-                         if (packetAddress == null) {</span>
<span class="udiff-line-removed">-                             p.setAddress(connectedAddress);</span>
<span class="udiff-line-removed">-                             p.setPort(connectedPort);</span>
<span class="udiff-line-removed">-                         } else if ((!packetAddress.equals(connectedAddress)) ||</span>
<span class="udiff-line-removed">-                                 packetPort != connectedPort) {</span>
<span class="udiff-line-removed">-                             throw new IllegalArgumentException(&quot;connected address and packet address&quot; +</span>
<span class="udiff-line-removed">-                                                         &quot; differ&quot;);</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     byte dttl = getTTL();</span>
<span class="udiff-line-removed">-                     try {</span>
<span class="udiff-line-removed">-                         if (ttl != dttl) {</span>
<span class="udiff-line-removed">-                             // set the ttl</span>
<span class="udiff-line-removed">-                             getImpl().setTTL(ttl);</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                         if (packetPort == 0) {</span>
<span class="udiff-line-removed">-                             throw new SocketException(&quot;Can&#39;t send to port 0&quot;);</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                         // call the datagram method to send</span>
<span class="udiff-line-removed">-                         getImpl().send(p);</span>
<span class="udiff-line-removed">-                     } finally {</span>
<span class="udiff-line-removed">-                         // set it back to default</span>
<span class="udiff-line-removed">-                         if (ttl != dttl) {</span>
<span class="udiff-line-removed">-                             getImpl().setTTL(dttl);</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                 } // synch p</span>
<span class="udiff-line-removed">-             }  //synch ttl</span>
<span class="udiff-line-removed">-     } //method</span>
<span class="udiff-line-modified-added">+         delegate().send(p, ttl);</span>
<span class="udiff-line-modified-added">+     }</span>
  }
</pre>
<center><a href="DatagramSocketImpl.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../nio/channels/DatagramChannel.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>