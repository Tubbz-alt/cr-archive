<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/security/cert/X509CertSelector.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="CertificateRevokedException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../spec/NamedParameterSpec.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/cert/X509CertSelector.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package java.security.cert;
  27 
  28 import java.io.IOException;
  29 import java.math.BigInteger;
  30 import java.security.PublicKey;
  31 import java.util.*;
  32 import javax.security.auth.x500.X500Principal;
  33 
<span class="line-modified">  34 import sun.security.util.HexDumpEncoder;</span>
<span class="line-removed">  35 import sun.security.util.Debug;</span>
<span class="line-removed">  36 import sun.security.util.DerInputStream;</span>
<span class="line-removed">  37 import sun.security.util.DerValue;</span>
<span class="line-removed">  38 import sun.security.util.ObjectIdentifier;</span>
  39 import sun.security.x509.*;
  40 
  41 /**
  42  * A {@code CertSelector} that selects {@code X509Certificates} that
  43  * match all specified criteria. This class is particularly useful when
  44  * selecting certificates from a {@code CertStore} to build a
  45  * PKIX-compliant certification path.
  46  * &lt;p&gt;
  47  * When first constructed, an {@code X509CertSelector} has no criteria
  48  * enabled and each of the {@code get} methods return a default value
  49  * ({@code null}, or {@code -1} for the {@link #getBasicConstraints
  50  * getBasicConstraints} method). Therefore, the {@link #match match}
  51  * method would return {@code true} for any {@code X509Certificate}.
  52  * Typically, several criteria are enabled (by calling
  53  * {@link #setIssuer setIssuer} or
  54  * {@link #setKeyUsage setKeyUsage}, for instance) and then the
  55  * {@code X509CertSelector} is passed to
  56  * {@link CertStore#getCertificates CertStore.getCertificates} or some similar
  57  * method.
  58  * &lt;p&gt;
</pre>
<hr />
<pre>
  71  * &lt;p&gt;
  72  * &lt;b&gt;Concurrent Access&lt;/b&gt;
  73  * &lt;p&gt;
  74  * Unless otherwise specified, the methods defined in this class are not
  75  * thread-safe. Multiple threads that need to access a single
  76  * object concurrently should synchronize amongst themselves and
  77  * provide the necessary locking. Multiple threads each manipulating
  78  * separate objects need not synchronize.
  79  *
  80  * @see CertSelector
  81  * @see X509Certificate
  82  *
  83  * @since       1.4
  84  * @author      Steve Hanna
  85  */
  86 public class X509CertSelector implements CertSelector {
  87 
  88     private static final Debug debug = Debug.getInstance(&quot;certpath&quot;);
  89 
  90     private static final ObjectIdentifier ANY_EXTENDED_KEY_USAGE =
<span class="line-modified">  91         ObjectIdentifier.of(&quot;2.5.29.37.0&quot;);</span>
  92 
  93     static {
  94         CertPathHelperImpl.initialize();
  95     }
  96 
  97     private BigInteger serialNumber;
  98     private X500Principal issuer;
  99     private X500Principal subject;
 100     private byte[] subjectKeyID;
 101     private byte[] authorityKeyID;
 102     private Date certificateValid;
 103     private Date privateKeyValid;
 104     private ObjectIdentifier subjectPublicKeyAlgID;
 105     private PublicKey subjectPublicKey;
 106     private byte[] subjectPublicKeyBytes;
 107     private boolean[] keyUsage;
 108     private Set&lt;String&gt; keyPurposeSet;
 109     private Set&lt;ObjectIdentifier&gt; keyPurposeOIDSet;
 110     private Set&lt;List&lt;?&gt;&gt; subjectAlternativeNames;
 111     private Set&lt;GeneralNameInterface&gt; subjectAlternativeGeneralNames;
</pre>
<hr />
<pre>
 489 
 490     /**
 491      * Sets the subjectPublicKeyAlgID criterion. The
 492      * {@code X509Certificate} must contain a subject public key
 493      * with the specified algorithm. If {@code null}, no
 494      * subjectPublicKeyAlgID check will be done.
 495      *
 496      * @param oid The object identifier (OID) of the algorithm to check
 497      *            for (or {@code null}). An OID is represented by a
 498      *            set of nonnegative integers separated by periods.
 499      * @throws IOException if the OID is invalid, such as
 500      * the first component being not 0, 1 or 2 or the second component
 501      * being greater than 39.
 502      *
 503      * @see #getSubjectPublicKeyAlgID
 504      */
 505     public void setSubjectPublicKeyAlgID(String oid) throws IOException {
 506         if (oid == null) {
 507             subjectPublicKeyAlgID = null;
 508         } else {
<span class="line-modified"> 509             subjectPublicKeyAlgID = new ObjectIdentifier(oid);</span>
 510         }
 511     }
 512 
 513     /**
 514      * Sets the subjectPublicKey criterion. The
 515      * {@code X509Certificate} must contain the specified subject public
 516      * key. If {@code null}, no subjectPublicKey check will be done.
 517      *
 518      * @param key the subject public key to check for (or {@code null})
 519      * @see #getSubjectPublicKey
 520      */
 521     public void setSubjectPublicKey(PublicKey key) {
 522         if (key == null) {
 523             subjectPublicKey = null;
 524             subjectPublicKeyBytes = null;
 525         } else {
 526             subjectPublicKey = key;
 527             subjectPublicKeyBytes = key.getEncoded();
 528         }
 529     }
</pre>
<hr />
<pre>
 605      * Note that the {@code Set} is cloned to protect against
 606      * subsequent modifications.
 607      *
 608      * @param keyPurposeSet a {@code Set} of key purpose OIDs in string
 609      * format (or {@code null}). Each OID is represented by a set of
 610      * nonnegative integers separated by periods.
 611      * @throws IOException if the OID is invalid, such as
 612      * the first component being not 0, 1 or 2 or the second component
 613      * being greater than 39.
 614      * @see #getExtendedKeyUsage
 615      */
 616     public void setExtendedKeyUsage(Set&lt;String&gt; keyPurposeSet) throws IOException {
 617         if ((keyPurposeSet == null) || keyPurposeSet.isEmpty()) {
 618             this.keyPurposeSet = null;
 619             keyPurposeOIDSet = null;
 620         } else {
 621             this.keyPurposeSet =
 622                 Collections.unmodifiableSet(new HashSet&lt;&gt;(keyPurposeSet));
 623             keyPurposeOIDSet = new HashSet&lt;&gt;();
 624             for (String s : this.keyPurposeSet) {
<span class="line-modified"> 625                 keyPurposeOIDSet.add(new ObjectIdentifier(s));</span>
 626             }
 627         }
 628     }
 629 
 630     /**
 631      * Enables/disables matching all of the subjectAlternativeNames
 632      * specified in the {@link #setSubjectAlternativeNames
 633      * setSubjectAlternativeNames} or {@link #addSubjectAlternativeName
 634      * addSubjectAlternativeName} methods. If enabled,
 635      * the {@code X509Certificate} must contain all of the
 636      * specified subject alternative names. If disabled, the
 637      * {@code X509Certificate} must contain at least one of the
 638      * specified subject alternative names.
 639      *
 640      * &lt;p&gt;The matchAllNames flag is {@code true} by default.
 641      *
 642      * @param matchAllNames if {@code true}, the flag is enabled;
 643      * if {@code false}, the flag is disabled.
 644      * @see #getMatchAllSubjectAltNames
 645      */
</pre>
<hr />
<pre>
1088      * the first component is not 0, 1 or 2 or the second component is
1089      * greater than 39.
1090      * @see #getPolicy
1091      */
1092     public void setPolicy(Set&lt;String&gt; certPolicySet) throws IOException {
1093         if (certPolicySet == null) {
1094             policySet = null;
1095             policy = null;
1096         } else {
1097             // Snapshot set and parse it
1098             Set&lt;String&gt; tempSet = Collections.unmodifiableSet
1099                                         (new HashSet&lt;&gt;(certPolicySet));
1100             /* Convert to Vector of ObjectIdentifiers */
1101             Iterator&lt;String&gt; i = tempSet.iterator();
1102             Vector&lt;CertificatePolicyId&gt; polIdVector = new Vector&lt;&gt;();
1103             while (i.hasNext()) {
1104                 Object o = i.next();
1105                 if (!(o instanceof String)) {
1106                     throw new IOException(&quot;non String in certPolicySet&quot;);
1107                 }
<span class="line-modified">1108                 polIdVector.add(new CertificatePolicyId(new ObjectIdentifier(</span>
<span class="line-modified">1109                   (String)o)));</span>
1110             }
1111             // If everything went OK, make the changes
1112             policySet = tempSet;
1113             policy = new CertificatePolicySet(polIdVector);
1114         }
1115     }
1116 
1117     /**
1118      * Sets the pathToNames criterion. The {@code X509Certificate} must
1119      * not include name constraints that would prohibit building a
1120      * path to the specified names.
1121      * &lt;p&gt;
1122      * This method allows the caller to specify, with a single method call,
1123      * the complete set of names which the {@code X509Certificates}&#39;s
1124      * name constraints must permit. The specified value replaces
1125      * the previous value for the pathToNames criterion.
1126      * &lt;p&gt;
1127      * This constraint is useful when building a certification path forward
1128      * (from the target toward the trust anchor. If a partial path has been
1129      * built, any candidate certificate must not include name constraints that
</pre>
</td>
<td>
<hr />
<pre>
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package java.security.cert;
  27 
  28 import java.io.IOException;
  29 import java.math.BigInteger;
  30 import java.security.PublicKey;
  31 import java.util.*;
  32 import javax.security.auth.x500.X500Principal;
  33 
<span class="line-modified">  34 import sun.security.util.*;</span>




  35 import sun.security.x509.*;
  36 
  37 /**
  38  * A {@code CertSelector} that selects {@code X509Certificates} that
  39  * match all specified criteria. This class is particularly useful when
  40  * selecting certificates from a {@code CertStore} to build a
  41  * PKIX-compliant certification path.
  42  * &lt;p&gt;
  43  * When first constructed, an {@code X509CertSelector} has no criteria
  44  * enabled and each of the {@code get} methods return a default value
  45  * ({@code null}, or {@code -1} for the {@link #getBasicConstraints
  46  * getBasicConstraints} method). Therefore, the {@link #match match}
  47  * method would return {@code true} for any {@code X509Certificate}.
  48  * Typically, several criteria are enabled (by calling
  49  * {@link #setIssuer setIssuer} or
  50  * {@link #setKeyUsage setKeyUsage}, for instance) and then the
  51  * {@code X509CertSelector} is passed to
  52  * {@link CertStore#getCertificates CertStore.getCertificates} or some similar
  53  * method.
  54  * &lt;p&gt;
</pre>
<hr />
<pre>
  67  * &lt;p&gt;
  68  * &lt;b&gt;Concurrent Access&lt;/b&gt;
  69  * &lt;p&gt;
  70  * Unless otherwise specified, the methods defined in this class are not
  71  * thread-safe. Multiple threads that need to access a single
  72  * object concurrently should synchronize amongst themselves and
  73  * provide the necessary locking. Multiple threads each manipulating
  74  * separate objects need not synchronize.
  75  *
  76  * @see CertSelector
  77  * @see X509Certificate
  78  *
  79  * @since       1.4
  80  * @author      Steve Hanna
  81  */
  82 public class X509CertSelector implements CertSelector {
  83 
  84     private static final Debug debug = Debug.getInstance(&quot;certpath&quot;);
  85 
  86     private static final ObjectIdentifier ANY_EXTENDED_KEY_USAGE =
<span class="line-modified">  87         ObjectIdentifier.of(KnownOIDs.anyExtendedKeyUsage);</span>
  88 
  89     static {
  90         CertPathHelperImpl.initialize();
  91     }
  92 
  93     private BigInteger serialNumber;
  94     private X500Principal issuer;
  95     private X500Principal subject;
  96     private byte[] subjectKeyID;
  97     private byte[] authorityKeyID;
  98     private Date certificateValid;
  99     private Date privateKeyValid;
 100     private ObjectIdentifier subjectPublicKeyAlgID;
 101     private PublicKey subjectPublicKey;
 102     private byte[] subjectPublicKeyBytes;
 103     private boolean[] keyUsage;
 104     private Set&lt;String&gt; keyPurposeSet;
 105     private Set&lt;ObjectIdentifier&gt; keyPurposeOIDSet;
 106     private Set&lt;List&lt;?&gt;&gt; subjectAlternativeNames;
 107     private Set&lt;GeneralNameInterface&gt; subjectAlternativeGeneralNames;
</pre>
<hr />
<pre>
 485 
 486     /**
 487      * Sets the subjectPublicKeyAlgID criterion. The
 488      * {@code X509Certificate} must contain a subject public key
 489      * with the specified algorithm. If {@code null}, no
 490      * subjectPublicKeyAlgID check will be done.
 491      *
 492      * @param oid The object identifier (OID) of the algorithm to check
 493      *            for (or {@code null}). An OID is represented by a
 494      *            set of nonnegative integers separated by periods.
 495      * @throws IOException if the OID is invalid, such as
 496      * the first component being not 0, 1 or 2 or the second component
 497      * being greater than 39.
 498      *
 499      * @see #getSubjectPublicKeyAlgID
 500      */
 501     public void setSubjectPublicKeyAlgID(String oid) throws IOException {
 502         if (oid == null) {
 503             subjectPublicKeyAlgID = null;
 504         } else {
<span class="line-modified"> 505             subjectPublicKeyAlgID = ObjectIdentifier.of(oid);</span>
 506         }
 507     }
 508 
 509     /**
 510      * Sets the subjectPublicKey criterion. The
 511      * {@code X509Certificate} must contain the specified subject public
 512      * key. If {@code null}, no subjectPublicKey check will be done.
 513      *
 514      * @param key the subject public key to check for (or {@code null})
 515      * @see #getSubjectPublicKey
 516      */
 517     public void setSubjectPublicKey(PublicKey key) {
 518         if (key == null) {
 519             subjectPublicKey = null;
 520             subjectPublicKeyBytes = null;
 521         } else {
 522             subjectPublicKey = key;
 523             subjectPublicKeyBytes = key.getEncoded();
 524         }
 525     }
</pre>
<hr />
<pre>
 601      * Note that the {@code Set} is cloned to protect against
 602      * subsequent modifications.
 603      *
 604      * @param keyPurposeSet a {@code Set} of key purpose OIDs in string
 605      * format (or {@code null}). Each OID is represented by a set of
 606      * nonnegative integers separated by periods.
 607      * @throws IOException if the OID is invalid, such as
 608      * the first component being not 0, 1 or 2 or the second component
 609      * being greater than 39.
 610      * @see #getExtendedKeyUsage
 611      */
 612     public void setExtendedKeyUsage(Set&lt;String&gt; keyPurposeSet) throws IOException {
 613         if ((keyPurposeSet == null) || keyPurposeSet.isEmpty()) {
 614             this.keyPurposeSet = null;
 615             keyPurposeOIDSet = null;
 616         } else {
 617             this.keyPurposeSet =
 618                 Collections.unmodifiableSet(new HashSet&lt;&gt;(keyPurposeSet));
 619             keyPurposeOIDSet = new HashSet&lt;&gt;();
 620             for (String s : this.keyPurposeSet) {
<span class="line-modified"> 621                 keyPurposeOIDSet.add(ObjectIdentifier.of(s));</span>
 622             }
 623         }
 624     }
 625 
 626     /**
 627      * Enables/disables matching all of the subjectAlternativeNames
 628      * specified in the {@link #setSubjectAlternativeNames
 629      * setSubjectAlternativeNames} or {@link #addSubjectAlternativeName
 630      * addSubjectAlternativeName} methods. If enabled,
 631      * the {@code X509Certificate} must contain all of the
 632      * specified subject alternative names. If disabled, the
 633      * {@code X509Certificate} must contain at least one of the
 634      * specified subject alternative names.
 635      *
 636      * &lt;p&gt;The matchAllNames flag is {@code true} by default.
 637      *
 638      * @param matchAllNames if {@code true}, the flag is enabled;
 639      * if {@code false}, the flag is disabled.
 640      * @see #getMatchAllSubjectAltNames
 641      */
</pre>
<hr />
<pre>
1084      * the first component is not 0, 1 or 2 or the second component is
1085      * greater than 39.
1086      * @see #getPolicy
1087      */
1088     public void setPolicy(Set&lt;String&gt; certPolicySet) throws IOException {
1089         if (certPolicySet == null) {
1090             policySet = null;
1091             policy = null;
1092         } else {
1093             // Snapshot set and parse it
1094             Set&lt;String&gt; tempSet = Collections.unmodifiableSet
1095                                         (new HashSet&lt;&gt;(certPolicySet));
1096             /* Convert to Vector of ObjectIdentifiers */
1097             Iterator&lt;String&gt; i = tempSet.iterator();
1098             Vector&lt;CertificatePolicyId&gt; polIdVector = new Vector&lt;&gt;();
1099             while (i.hasNext()) {
1100                 Object o = i.next();
1101                 if (!(o instanceof String)) {
1102                     throw new IOException(&quot;non String in certPolicySet&quot;);
1103                 }
<span class="line-modified">1104                 polIdVector.add(new CertificatePolicyId</span>
<span class="line-modified">1105                         (ObjectIdentifier.of((String)o)));</span>
1106             }
1107             // If everything went OK, make the changes
1108             policySet = tempSet;
1109             policy = new CertificatePolicySet(polIdVector);
1110         }
1111     }
1112 
1113     /**
1114      * Sets the pathToNames criterion. The {@code X509Certificate} must
1115      * not include name constraints that would prohibit building a
1116      * path to the specified names.
1117      * &lt;p&gt;
1118      * This method allows the caller to specify, with a single method call,
1119      * the complete set of names which the {@code X509Certificates}&#39;s
1120      * name constraints must permit. The specified value replaces
1121      * the previous value for the pathToNames criterion.
1122      * &lt;p&gt;
1123      * This constraint is useful when building a certification path forward
1124      * (from the target toward the trust anchor. If a partial path has been
1125      * built, any candidate certificate must not include name constraints that
</pre>
</td>
</tr>
</table>
<center><a href="CertificateRevokedException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../spec/NamedParameterSpec.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>