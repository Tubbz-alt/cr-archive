<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/provider/certpath/OCSPResponse.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../SunEntries.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RevocationChecker.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/provider/certpath/OCSPResponse.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 118  *
 119  * @author      Ram Marti
 120  */
 121 
 122 public final class OCSPResponse {
 123 
 124     public enum ResponseStatus {
 125         SUCCESSFUL,            // Response has valid confirmations
 126         MALFORMED_REQUEST,     // Illegal request
 127         INTERNAL_ERROR,        // Internal error in responder
 128         TRY_LATER,             // Try again later
 129         UNUSED,                // is not used
 130         SIG_REQUIRED,          // Must sign the request
 131         UNAUTHORIZED           // Request unauthorized
 132     };
 133     private static final ResponseStatus[] rsvalues = ResponseStatus.values();
 134 
 135     private static final Debug debug = Debug.getInstance(&quot;certpath&quot;);
 136     private static final boolean dump = debug != null &amp;&amp; Debug.isOn(&quot;ocsp&quot;);
 137     private static final ObjectIdentifier OCSP_BASIC_RESPONSE_OID =
<span class="line-modified"> 138         ObjectIdentifier.of(&quot;1.3.6.1.5.5.7.48.1.1&quot;);</span>
 139     private static final int CERT_STATUS_GOOD = 0;
 140     private static final int CERT_STATUS_REVOKED = 1;
 141     private static final int CERT_STATUS_UNKNOWN = 2;
 142 
 143     // ResponderID CHOICE tags
 144     private static final int NAME_TAG = 1;
 145     private static final int KEY_TAG = 2;
 146 
<span class="line-removed"> 147     // Object identifier for the OCSPSigning key purpose</span>
<span class="line-removed"> 148     private static final String KP_OCSP_SIGNING_OID = &quot;1.3.6.1.5.5.7.3.9&quot;;</span>
<span class="line-removed"> 149 </span>
 150     // Default maximum clock skew in milliseconds (15 minutes)
 151     // allowed when checking validity of OCSP responses
 152     private static final int DEFAULT_MAX_CLOCK_SKEW = 900000;
 153 
 154     /**
 155      * Integer value indicating the maximum allowable clock skew,
 156      * in milliseconds, to be used for the OCSP check.
 157      */
 158     private static final int MAX_CLOCK_SKEW = initializeClockSkew();
 159 
 160     /**
 161      * Initialize the maximum allowable clock skew by getting the OCSP
 162      * clock skew system property. If the property has not been set, or if its
 163      * value is negative, set the skew to the default.
 164      */
 165     private static int initializeClockSkew() {
 166         Integer tmp = java.security.AccessController.doPrivileged(
 167                 new GetIntegerAction(&quot;com.sun.security.ocsp.clockSkew&quot;));
 168         if (tmp == null || tmp &lt; 0) {
 169             return DEFAULT_MAX_CLOCK_SKEW;
</pre>
<hr />
<pre>
 476                         &quot;Issuing CA&quot;);
 477                 }
 478                 // cert is trusted, now verify the signed response
 479 
 480             // Check if the response is signed by a trusted responder
 481             } else if (signerCert.equals(responderCert)) {
 482                 if (debug != null) {
 483                     debug.println(&quot;OCSP response is signed by a Trusted &quot; +
 484                         &quot;Responder&quot;);
 485                 }
 486                 // cert is trusted, now verify the signed response
 487 
 488             // Check if the response is signed by an authorized responder
 489             } else if (signerCert.getIssuerX500Principal().equals(
 490                     issuerInfo.getName())) {
 491 
 492                 // Check for the OCSPSigning key purpose
 493                 try {
 494                     List&lt;String&gt; keyPurposes = signerCert.getExtendedKeyUsage();
 495                     if (keyPurposes == null ||
<span class="line-modified"> 496                         !keyPurposes.contains(KP_OCSP_SIGNING_OID)) {</span>
 497                         throw new CertPathValidatorException(
 498                             &quot;Responder&#39;s certificate not valid for signing &quot; +
 499                             &quot;OCSP responses&quot;);
 500                     }
 501                 } catch (CertificateParsingException cpe) {
 502                     // assume cert is not valid for signing
 503                     throw new CertPathValidatorException(
 504                         &quot;Responder&#39;s certificate not valid for signing &quot; +
 505                         &quot;OCSP responses&quot;, cpe);
 506                 }
 507 
 508                 // Check algorithm constraints specified in security property
 509                 // &quot;jdk.certpath.disabledAlgorithms&quot;.
 510                 AlgorithmChecker algChecker =
 511                         new AlgorithmChecker(issuerInfo.getAnchor(), date,
 512                                 variant);
 513                 algChecker.init(false);
 514                 algChecker.check(signerCert, Collections.&lt;String&gt;emptySet());
 515 
 516                 // check the validity
</pre>
</td>
<td>
<hr />
<pre>
 118  *
 119  * @author      Ram Marti
 120  */
 121 
 122 public final class OCSPResponse {
 123 
 124     public enum ResponseStatus {
 125         SUCCESSFUL,            // Response has valid confirmations
 126         MALFORMED_REQUEST,     // Illegal request
 127         INTERNAL_ERROR,        // Internal error in responder
 128         TRY_LATER,             // Try again later
 129         UNUSED,                // is not used
 130         SIG_REQUIRED,          // Must sign the request
 131         UNAUTHORIZED           // Request unauthorized
 132     };
 133     private static final ResponseStatus[] rsvalues = ResponseStatus.values();
 134 
 135     private static final Debug debug = Debug.getInstance(&quot;certpath&quot;);
 136     private static final boolean dump = debug != null &amp;&amp; Debug.isOn(&quot;ocsp&quot;);
 137     private static final ObjectIdentifier OCSP_BASIC_RESPONSE_OID =
<span class="line-modified"> 138         ObjectIdentifier.of(KnownOIDs.OCSPBasicResponse);</span>
 139     private static final int CERT_STATUS_GOOD = 0;
 140     private static final int CERT_STATUS_REVOKED = 1;
 141     private static final int CERT_STATUS_UNKNOWN = 2;
 142 
 143     // ResponderID CHOICE tags
 144     private static final int NAME_TAG = 1;
 145     private static final int KEY_TAG = 2;
 146 



 147     // Default maximum clock skew in milliseconds (15 minutes)
 148     // allowed when checking validity of OCSP responses
 149     private static final int DEFAULT_MAX_CLOCK_SKEW = 900000;
 150 
 151     /**
 152      * Integer value indicating the maximum allowable clock skew,
 153      * in milliseconds, to be used for the OCSP check.
 154      */
 155     private static final int MAX_CLOCK_SKEW = initializeClockSkew();
 156 
 157     /**
 158      * Initialize the maximum allowable clock skew by getting the OCSP
 159      * clock skew system property. If the property has not been set, or if its
 160      * value is negative, set the skew to the default.
 161      */
 162     private static int initializeClockSkew() {
 163         Integer tmp = java.security.AccessController.doPrivileged(
 164                 new GetIntegerAction(&quot;com.sun.security.ocsp.clockSkew&quot;));
 165         if (tmp == null || tmp &lt; 0) {
 166             return DEFAULT_MAX_CLOCK_SKEW;
</pre>
<hr />
<pre>
 473                         &quot;Issuing CA&quot;);
 474                 }
 475                 // cert is trusted, now verify the signed response
 476 
 477             // Check if the response is signed by a trusted responder
 478             } else if (signerCert.equals(responderCert)) {
 479                 if (debug != null) {
 480                     debug.println(&quot;OCSP response is signed by a Trusted &quot; +
 481                         &quot;Responder&quot;);
 482                 }
 483                 // cert is trusted, now verify the signed response
 484 
 485             // Check if the response is signed by an authorized responder
 486             } else if (signerCert.getIssuerX500Principal().equals(
 487                     issuerInfo.getName())) {
 488 
 489                 // Check for the OCSPSigning key purpose
 490                 try {
 491                     List&lt;String&gt; keyPurposes = signerCert.getExtendedKeyUsage();
 492                     if (keyPurposes == null ||
<span class="line-modified"> 493                         !keyPurposes.contains(KnownOIDs.OCSPSigning.value())) {</span>
 494                         throw new CertPathValidatorException(
 495                             &quot;Responder&#39;s certificate not valid for signing &quot; +
 496                             &quot;OCSP responses&quot;);
 497                     }
 498                 } catch (CertificateParsingException cpe) {
 499                     // assume cert is not valid for signing
 500                     throw new CertPathValidatorException(
 501                         &quot;Responder&#39;s certificate not valid for signing &quot; +
 502                         &quot;OCSP responses&quot;, cpe);
 503                 }
 504 
 505                 // Check algorithm constraints specified in security property
 506                 // &quot;jdk.certpath.disabledAlgorithms&quot;.
 507                 AlgorithmChecker algChecker =
 508                         new AlgorithmChecker(issuerInfo.getAnchor(), date,
 509                                 variant);
 510                 algChecker.init(false);
 511                 algChecker.check(signerCert, Collections.&lt;String&gt;emptySet());
 512 
 513                 // check the validity
</pre>
</td>
</tr>
</table>
<center><a href="../SunEntries.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RevocationChecker.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>