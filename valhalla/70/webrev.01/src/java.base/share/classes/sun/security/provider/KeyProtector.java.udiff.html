<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/sun/security/provider/KeyProtector.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../pkcs12/PKCS12KeyStore.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SHA3.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/provider/KeyProtector.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -36,10 +36,11 @@</span>
  
  import sun.security.pkcs.PKCS8Key;
  import sun.security.pkcs.EncryptedPrivateKeyInfo;
  import sun.security.x509.AlgorithmId;
  import sun.security.util.ObjectIdentifier;
<span class="udiff-line-added">+ import sun.security.util.KnownOIDs;</span>
  import sun.security.util.DerValue;
  
  /**
   * This is an implementation of a Sun proprietary, exportable algorithm
   * intended for use when protecting (or recovering the cleartext version of)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -103,13 +104,10 @@</span>
  
      private static final int SALT_LEN = 20; // the salt length
      private static final String DIGEST_ALG = &quot;SHA&quot;;
      private static final int DIGEST_LEN = 20;
  
<span class="udiff-line-removed">-     // defined by JavaSoft</span>
<span class="udiff-line-removed">-     private static final String KEY_PROTECTOR_OID = &quot;1.3.6.1.4.1.42.2.17.1.1&quot;;</span>
<span class="udiff-line-removed">- </span>
      // The password used for protecting/recovering keys passed through this
      // key protector. We store it as a byte array, so that we can digest it.
      private byte[] passwdBytes;
  
      private MessageDigest md;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -211,11 +209,12 @@</span>
  
          // wrap the protected private key in a PKCS#8-style
          // EncryptedPrivateKeyInfo, and returns its encoding
          AlgorithmId encrAlg;
          try {
<span class="udiff-line-modified-removed">-             encrAlg = new AlgorithmId(new ObjectIdentifier(KEY_PROTECTOR_OID));</span>
<span class="udiff-line-modified-added">+             encrAlg = new AlgorithmId(ObjectIdentifier.of</span>
<span class="udiff-line-added">+                     (KnownOIDs.JAVASOFT_JDKKeyProtector));</span>
              return new EncryptedPrivateKeyInfo(encrAlg,encrKey).getEncoded();
          } catch (IOException ioe) {
              throw new KeyStoreException(ioe.getMessage());
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -233,11 +232,12 @@</span>
          int xorOffset; // offset in xorKey where next digest will be stored
          int encrKeyLen; // the length of the encrpyted key
  
          // do we support the algorithm?
          AlgorithmId encrAlg = encrInfo.getAlgorithm();
<span class="udiff-line-modified-removed">-         if (!(encrAlg.getOID().toString().equals(KEY_PROTECTOR_OID))) {</span>
<span class="udiff-line-modified-added">+         if (!(encrAlg.getOID().toString().equals</span>
<span class="udiff-line-added">+                 (KnownOIDs.JAVASOFT_JDKKeyProtector.value()))) {</span>
              throw new UnrecoverableKeyException(&quot;Unsupported key protection &quot;
                                                  + &quot;algorithm&quot;);
          }
  
          byte[] protectedKey = encrInfo.getEncryptedData();
</pre>
<center><a href="../pkcs12/PKCS12KeyStore.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SHA3.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>