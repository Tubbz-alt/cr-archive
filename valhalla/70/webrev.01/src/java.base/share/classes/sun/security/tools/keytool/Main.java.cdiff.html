<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/security/tools/keytool/Main.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../timestamp/TSRequest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../util/ConstraintsParameters.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/tools/keytool/Main.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 80,10 ***</span>
<span class="line-new-header">--- 80,11 ---</span>
  import sun.security.util.ObjectIdentifier;
  import sun.security.pkcs10.PKCS10;
  import sun.security.pkcs10.PKCS10Attribute;
  import sun.security.provider.X509Factory;
  import sun.security.provider.certpath.ssl.SSLServerCertStore;
<span class="line-added">+ import sun.security.util.KnownOIDs;</span>
  import sun.security.util.Password;
  import sun.security.util.SecurityProperties;
  import sun.security.util.SecurityProviderConstants;
  import sun.security.util.SignatureUtil;
  import javax.crypto.KeyGenerator;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1868,10 ***</span>
<span class="line-new-header">--- 1869,16 ---</span>
                      keysize = SecurityProviderConstants.DEF_EC_KEY_SIZE;
                  } else if (&quot;RSA&quot;.equalsIgnoreCase(keyAlgName)) {
                      keysize = SecurityProviderConstants.DEF_RSA_KEY_SIZE;
                  } else if (&quot;DSA&quot;.equalsIgnoreCase(keyAlgName)) {
                      keysize = SecurityProviderConstants.DEF_DSA_KEY_SIZE;
<span class="line-added">+                 } else if (&quot;EdDSA&quot;.equalsIgnoreCase(keyAlgName)) {</span>
<span class="line-added">+                     keysize = SecurityProviderConstants.DEF_ED_KEY_SIZE;</span>
<span class="line-added">+                 } else if (&quot;Ed25519&quot;.equalsIgnoreCase(keyAlgName)) {</span>
<span class="line-added">+                     keysize = 255;</span>
<span class="line-added">+                 } else if (&quot;Ed448&quot;.equalsIgnoreCase(keyAlgName)) {</span>
<span class="line-added">+                     keysize = 448;</span>
                  }
              } else {
                  if (&quot;EC&quot;.equalsIgnoreCase(keyAlgName)) {
                      weakWarnings.add(String.format(
                              rb.getString(&quot;deprecate.keysize.for.ec&quot;),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4117,10 ***</span>
<span class="line-new-header">--- 4124,27 ---</span>
              }
          }
          return c.getTime();
      }
  
<span class="line-added">+     /**</span>
<span class="line-added">+      * Match a command with a command set. The match can be exact, or</span>
<span class="line-added">+      * partial, or case-insensitive.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @param s the command provided by user</span>
<span class="line-added">+      * @param list the legal command set represented by KnownOIDs enums.</span>
<span class="line-added">+      * @return the position of a single match, or -1 if none matched</span>
<span class="line-added">+      * @throws Exception if s is ambiguous</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private static int oneOf(String s, KnownOIDs... list) throws Exception {</span>
<span class="line-added">+         String[] convertedList = new String[list.length];</span>
<span class="line-added">+         for (int i = 0; i &lt; list.length; i++) {</span>
<span class="line-added">+             convertedList[i] = list[i].stdName();</span>
<span class="line-added">+         }</span>
<span class="line-added">+         return oneOf(s, convertedList);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      /**
       * Match a command with a command set. The match can be exact, or
       * partial, or case-insensitive.
       *
       * @param s the command provided by user
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4254,11 ***</span>
              case 3: return PKIXExtensions.SubjectAlternativeName_Id;
              case 4: return PKIXExtensions.IssuerAlternativeName_Id;
              case 5: return PKIXExtensions.SubjectInfoAccess_Id;
              case 6: return PKIXExtensions.AuthInfoAccess_Id;
              case 8: return PKIXExtensions.CRLDistributionPoints_Id;
<span class="line-modified">!             default: return new ObjectIdentifier(type);</span>
          }
      }
  
      // Add an extension into a CertificateExtensions, always using OID as key
      private static void setExt(CertificateExtensions result, Extension ex)
<span class="line-new-header">--- 4278,11 ---</span>
              case 3: return PKIXExtensions.SubjectAlternativeName_Id;
              case 4: return PKIXExtensions.IssuerAlternativeName_Id;
              case 5: return PKIXExtensions.SubjectInfoAccess_Id;
              case 6: return PKIXExtensions.AuthInfoAccess_Id;
              case 8: return PKIXExtensions.CRLDistributionPoints_Id;
<span class="line-modified">!             default: return ObjectIdentifier.of(type);</span>
          }
      }
  
      // Add an extension into a CertificateExtensions, always using OID as key
      private static void setExt(CertificateExtensions result, Extension ex)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4466,34 ***</span>
                          }
                          break;
                      case 2:     // EKU
                          if(value != null) {
                              Vector&lt;ObjectIdentifier&gt; v = new Vector&lt;&gt;();
                              for (String s: value.split(&quot;,&quot;)) {
<span class="line-modified">!                                 int p = oneOf(s,</span>
<span class="line-modified">!                                         &quot;anyExtendedKeyUsage&quot;,</span>
<span class="line-modified">!                                         &quot;serverAuth&quot;,       //1</span>
<span class="line-modified">!                                         &quot;clientAuth&quot;,       //2</span>
<span class="line-modified">!                                         &quot;codeSigning&quot;,      //3</span>
<span class="line-modified">!                                         &quot;emailProtection&quot;,  //4</span>
<span class="line-modified">!                                         &quot;&quot;,                 //5</span>
<span class="line-modified">!                                         &quot;&quot;,                 //6</span>
<span class="line-modified">!                                         &quot;&quot;,                 //7</span>
<span class="line-modified">!                                         &quot;timeStamping&quot;,     //8</span>
<span class="line-removed">-                                         &quot;OCSPSigning&quot;       //9</span>
<span class="line-removed">-                                        );</span>
<span class="line-removed">-                                 if (p &lt; 0) {</span>
<span class="line-removed">-                                     try {</span>
<span class="line-removed">-                                         v.add(new ObjectIdentifier(s));</span>
<span class="line-removed">-                                     } catch (Exception e) {</span>
<span class="line-removed">-                                         throw new Exception(rb.getString(</span>
<span class="line-removed">-                                                 &quot;Unknown.extendedkeyUsage.type.&quot;) + s);</span>
<span class="line-removed">-                                     }</span>
<span class="line-removed">-                                 } else if (p == 0) {</span>
<span class="line-removed">-                                     v.add(new ObjectIdentifier(&quot;2.5.29.37.0&quot;));</span>
<span class="line-removed">-                                 } else {</span>
<span class="line-removed">-                                     v.add(new ObjectIdentifier(&quot;1.3.6.1.5.5.7.3.&quot; + p));</span>
                                  }
                              }
                              setExt(result, new ExtendedKeyUsageExtension(isCritical, v));
                          } else {
                              throw new Exception(rb.getString
<span class="line-new-header">--- 4490,30 ---</span>
                          }
                          break;
                      case 2:     // EKU
                          if(value != null) {
                              Vector&lt;ObjectIdentifier&gt; v = new Vector&lt;&gt;();
<span class="line-added">+                             KnownOIDs[] choices = {</span>
<span class="line-added">+                                     KnownOIDs.anyExtendedKeyUsage,</span>
<span class="line-added">+                                     KnownOIDs.serverAuth,</span>
<span class="line-added">+                                     KnownOIDs.clientAuth,</span>
<span class="line-added">+                                     KnownOIDs.codeSigning,</span>
<span class="line-added">+                                     KnownOIDs.emailProtection,</span>
<span class="line-added">+                                     KnownOIDs.KP_TimeStamping,</span>
<span class="line-added">+                                     KnownOIDs.OCSPSigning</span>
<span class="line-added">+                             };</span>
                              for (String s: value.split(&quot;,&quot;)) {
<span class="line-modified">!                                 int p = oneOf(s, choices);</span>
<span class="line-modified">!                                 String o = s;</span>
<span class="line-modified">!                                 if (p &gt;= 0) {</span>
<span class="line-modified">!                                     o = choices[p].value();</span>
<span class="line-modified">!                                 }</span>
<span class="line-modified">!                                 try {</span>
<span class="line-modified">!                                     v.add(ObjectIdentifier.of(o));</span>
<span class="line-modified">!                                 } catch (Exception e) {</span>
<span class="line-modified">!                                     throw new Exception(rb.getString(</span>
<span class="line-modified">!                                             &quot;Unknown.extendedkeyUsage.type.&quot;) + s);</span>
                                  }
                              }
                              setExt(result, new ExtendedKeyUsageExtension(isCritical, v));
                          } else {
                              throw new Exception(rb.getString
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4544,28 ***</span>
                                              (&quot;Illegal.value.&quot;) + extstr);
                                  }
                                  String m = item.substring(0, colonpos);
                                  String t = item.substring(colonpos+1, colonpos2);
                                  String v = item.substring(colonpos2+1);
<span class="line-modified">!                                 int p = oneOf(m,</span>
<span class="line-modified">!                                         &quot;&quot;,</span>
<span class="line-modified">!                                         &quot;ocsp&quot;,         //1</span>
<span class="line-modified">!                                         &quot;caIssuers&quot;,    //2</span>
<span class="line-modified">!                                         &quot;timeStamping&quot;, //3</span>
<span class="line-modified">!                                         &quot;&quot;,</span>
<span class="line-modified">!                                         &quot;caRepository&quot;  //5</span>
<span class="line-removed">-                                         );</span>
                                  ObjectIdentifier oid;
<span class="line-modified">!                                 if (p &lt; 0) {</span>
                                      try {
<span class="line-modified">!                                         oid = new ObjectIdentifier(m);</span>
                                      } catch (Exception e) {
                                          throw new Exception(rb.getString(
                                                  &quot;Unknown.AccessDescription.type.&quot;) + m);
                                      }
<span class="line-removed">-                                 } else {</span>
<span class="line-removed">-                                     oid = new ObjectIdentifier(&quot;1.3.6.1.5.5.7.48.&quot; + p);</span>
                                  }
                                  accessDescriptions.add(new AccessDescription(
                                          oid, createGeneralName(t, v, exttype)));
                              }
                              if (exttype == 5) {
<span class="line-new-header">--- 4564,27 ---</span>
                                              (&quot;Illegal.value.&quot;) + extstr);
                                  }
                                  String m = item.substring(0, colonpos);
                                  String t = item.substring(colonpos+1, colonpos2);
                                  String v = item.substring(colonpos2+1);
<span class="line-modified">!                                 KnownOIDs[] choices = {</span>
<span class="line-modified">!                                     KnownOIDs.OCSP,</span>
<span class="line-modified">!                                     KnownOIDs.caIssuers,</span>
<span class="line-modified">!                                     KnownOIDs.AD_TimeStamping,</span>
<span class="line-modified">!                                     KnownOIDs.caRepository</span>
<span class="line-modified">!                                 };</span>
<span class="line-modified">!                                 int p = oneOf(m, choices);</span>
                                  ObjectIdentifier oid;
<span class="line-modified">!                                 if (p &gt;= 0) {</span>
<span class="line-added">+                                     oid = ObjectIdentifier.of(choices[p]);</span>
<span class="line-added">+                                 } else {</span>
                                      try {
<span class="line-modified">!                                         oid = ObjectIdentifier.of(m);</span>
                                      } catch (Exception e) {
                                          throw new Exception(rb.getString(
                                                  &quot;Unknown.AccessDescription.type.&quot;) + m);
                                      }
                                  }
                                  accessDescriptions.add(new AccessDescription(
                                          oid, createGeneralName(t, v, exttype)));
                              }
                              if (exttype == 5) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4598,11 ***</span>
                              throw new Exception(rb.getString
                                      (&quot;Illegal.value.&quot;) + extstr);
                          }
                          break;
                      case -1:
<span class="line-modified">!                         ObjectIdentifier oid = new ObjectIdentifier(name);</span>
                          byte[] data = null;
                          if (value != null) {
                              data = new byte[value.length() / 2 + 1];
                              int pos = 0;
                              for (char c: value.toCharArray()) {
<span class="line-new-header">--- 4617,11 ---</span>
                              throw new Exception(rb.getString
                                      (&quot;Illegal.value.&quot;) + extstr);
                          }
                          break;
                      case -1:
<span class="line-modified">!                         ObjectIdentifier oid = ObjectIdentifier.of(name);</span>
                          byte[] data = null;
                          if (value != null) {
                              data = new byte[value.length() / 2 + 1];
                              int pos = 0;
                              for (char c: value.toCharArray()) {
</pre>
<center><a href="../../timestamp/TSRequest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../util/ConstraintsParameters.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>