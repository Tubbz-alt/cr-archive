<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/pkcs/PKCS9Attribute.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="PKCS7.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../pkcs12/PKCS12KeyStore.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/pkcs/PKCS9Attribute.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.pkcs;
 27 
 28 import java.io.IOException;
 29 import java.io.OutputStream;
 30 import java.security.cert.CertificateException;
 31 import java.util.Locale;
 32 import java.util.Date;
 33 import java.util.HashMap;
 34 import sun.security.x509.CertificateExtensions;
<span class="line-modified"> 35 import sun.security.util.Debug;</span>
<span class="line-removed"> 36 import sun.security.util.DerEncoder;</span>
<span class="line-removed"> 37 import sun.security.util.DerValue;</span>
<span class="line-removed"> 38 import sun.security.util.DerInputStream;</span>
<span class="line-removed"> 39 import sun.security.util.DerOutputStream;</span>
<span class="line-removed"> 40 import sun.security.util.ObjectIdentifier;</span>
<span class="line-removed"> 41 import sun.security.util.HexDumpEncoder;</span>
 42 
 43 /**
 44  * Class supporting any PKCS9 attributes.
 45  * Supports DER decoding/encoding and access to attribute values.
 46  *
 47  * &lt;a name=&quot;classTable&quot;&gt;&lt;h3&gt;Type/Class Table&lt;/h3&gt;&lt;/a&gt;
 48  * The following table shows the correspondence between
 49  * PKCS9 attribute types and value component classes.
 50  * For types not listed here, its name is the OID
 51  * in string form, its value is a (single-valued)
 52  * byte array that is the SET&#39;s encoding.
 53  *
 54  * &lt;TABLE BORDER CELLPADDING=8 ALIGN=CENTER&gt;
 55  *
 56  * &lt;TR&gt;
 57  * &lt;TH&gt;Object Identifier&lt;/TH&gt;
 58  * &lt;TH&gt;Attribute Name&lt;/TH&gt;
 59  * &lt;TH&gt;Type&lt;/TH&gt;
 60  * &lt;TH&gt;Value Class&lt;/TH&gt;
 61  * &lt;/TR&gt;
</pre>
<hr />
<pre>
171  * &lt;TD&gt;Single-valued&lt;/TD&gt;
172  * &lt;TD&gt;byte[]&lt;/TD&gt;
173  * &lt;/TR&gt;
174  *
175  * &lt;/TABLE&gt;
176  *
177  * @author Douglas Hoover
178  */
179 public class PKCS9Attribute implements DerEncoder {
180 
181     /* Are we debugging ? */
182     private static final Debug debug = Debug.getInstance(&quot;jar&quot;);
183 
184     /**
185      * Array of attribute OIDs defined in PKCS9, by number.
186      */
187     static final ObjectIdentifier[] PKCS9_OIDS = new ObjectIdentifier[18];
188 
189     private static final Class&lt;?&gt; BYTE_ARRAY_CLASS;
190 
<span class="line-modified">191     static {   // static initializer for PKCS9_OIDS</span>
<span class="line-modified">192         for (int i = 1; i &lt; PKCS9_OIDS.length - 2; i++) {</span>
<span class="line-modified">193             PKCS9_OIDS[i] = ObjectIdentifier.of(&quot;1.2.840.113549.1.9.&quot; + i);</span>
<span class="line-modified">194         }</span>
<span class="line-modified">195         // Initialize SigningCertificate and SignatureTimestampToken</span>
<span class="line-removed">196         // separately (because their values are out of sequence)</span>
<span class="line-removed">197         PKCS9_OIDS[PKCS9_OIDS.length - 2] =</span>
<span class="line-removed">198             ObjectIdentifier.of(&quot;1.2.840.113549.1.9.16.2.12&quot;);</span>
<span class="line-removed">199         PKCS9_OIDS[PKCS9_OIDS.length - 1] =</span>
<span class="line-removed">200             ObjectIdentifier.of(&quot;1.2.840.113549.1.9.16.2.14&quot;);</span>
<span class="line-removed">201 </span>
202         try {
203             BYTE_ARRAY_CLASS = Class.forName(&quot;[B&quot;);
204         } catch (ClassNotFoundException e) {
205             throw new ExceptionInInitializerError(e.toString());
206         }
207     }
208 
<span class="line-modified">209     // first element [0] not used</span>
<span class="line-modified">210     public static final ObjectIdentifier EMAIL_ADDRESS_OID = PKCS9_OIDS[1];</span>
<span class="line-modified">211     public static final ObjectIdentifier UNSTRUCTURED_NAME_OID = PKCS9_OIDS[2];</span>
<span class="line-modified">212     public static final ObjectIdentifier CONTENT_TYPE_OID = PKCS9_OIDS[3];</span>
<span class="line-modified">213     public static final ObjectIdentifier MESSAGE_DIGEST_OID = PKCS9_OIDS[4];</span>
<span class="line-modified">214     public static final ObjectIdentifier SIGNING_TIME_OID = PKCS9_OIDS[5];</span>
<span class="line-modified">215     public static final ObjectIdentifier COUNTERSIGNATURE_OID = PKCS9_OIDS[6];</span>
<span class="line-modified">216     public static final ObjectIdentifier CHALLENGE_PASSWORD_OID = PKCS9_OIDS[7];</span>
<span class="line-modified">217     public static final ObjectIdentifier UNSTRUCTURED_ADDRESS_OID = PKCS9_OIDS[8];</span>
<span class="line-modified">218     public static final ObjectIdentifier EXTENDED_CERTIFICATE_ATTRIBUTES_OID</span>
<span class="line-modified">219                                          = PKCS9_OIDS[9];</span>
<span class="line-modified">220     public static final ObjectIdentifier ISSUER_SERIALNUMBER_OID = PKCS9_OIDS[10];</span>










221     // [11], [12] are RSA DSI proprietary
222     // [13] ==&gt; signingDescription, S/MIME, not used anymore
<span class="line-modified">223     public static final ObjectIdentifier EXTENSION_REQUEST_OID = PKCS9_OIDS[14];</span>
<span class="line-modified">224     public static final ObjectIdentifier SMIME_CAPABILITY_OID = PKCS9_OIDS[15];</span>
<span class="line-modified">225     public static final ObjectIdentifier SIGNING_CERTIFICATE_OID = PKCS9_OIDS[16];</span>

226     public static final ObjectIdentifier SIGNATURE_TIMESTAMP_TOKEN_OID =
<span class="line-modified">227                                 PKCS9_OIDS[17];</span>
<span class="line-modified">228     public static final String EMAIL_ADDRESS_STR = &quot;EmailAddress&quot;;</span>
<span class="line-removed">229     public static final String UNSTRUCTURED_NAME_STR = &quot;UnstructuredName&quot;;</span>
<span class="line-removed">230     public static final String CONTENT_TYPE_STR = &quot;ContentType&quot;;</span>
<span class="line-removed">231     public static final String MESSAGE_DIGEST_STR = &quot;MessageDigest&quot;;</span>
<span class="line-removed">232     public static final String SIGNING_TIME_STR = &quot;SigningTime&quot;;</span>
<span class="line-removed">233     public static final String COUNTERSIGNATURE_STR = &quot;Countersignature&quot;;</span>
<span class="line-removed">234     public static final String CHALLENGE_PASSWORD_STR = &quot;ChallengePassword&quot;;</span>
<span class="line-removed">235     public static final String UNSTRUCTURED_ADDRESS_STR = &quot;UnstructuredAddress&quot;;</span>
<span class="line-removed">236     public static final String EXTENDED_CERTIFICATE_ATTRIBUTES_STR =</span>
<span class="line-removed">237                                &quot;ExtendedCertificateAttributes&quot;;</span>
<span class="line-removed">238     public static final String ISSUER_SERIALNUMBER_STR = &quot;IssuerAndSerialNumber&quot;;</span>
<span class="line-removed">239     // [11], [12] are RSA DSI proprietary</span>
<span class="line-removed">240     private static final String RSA_PROPRIETARY_STR = &quot;RSAProprietary&quot;;</span>
<span class="line-removed">241     // [13] ==&gt; signingDescription, S/MIME, not used anymore</span>
<span class="line-removed">242     private static final String SMIME_SIGNING_DESC_STR = &quot;SMIMESigningDesc&quot;;</span>
<span class="line-removed">243     public static final String EXTENSION_REQUEST_STR = &quot;ExtensionRequest&quot;;</span>
<span class="line-removed">244     public static final String SMIME_CAPABILITY_STR = &quot;SMIMECapability&quot;;</span>
<span class="line-removed">245     public static final String SIGNING_CERTIFICATE_STR = &quot;SigningCertificate&quot;;</span>
<span class="line-removed">246     public static final String SIGNATURE_TIMESTAMP_TOKEN_STR =</span>
<span class="line-removed">247                                 &quot;SignatureTimestampToken&quot;;</span>
<span class="line-removed">248 </span>
<span class="line-removed">249     /**</span>
<span class="line-removed">250      * HashMap mapping names and variant names of supported</span>
<span class="line-removed">251      * attributes to their OIDs. This table contains all name forms</span>
<span class="line-removed">252      * that occur in PKCS9, in lower case.</span>
<span class="line-removed">253      */</span>
<span class="line-removed">254     private static final HashMap&lt;String, ObjectIdentifier&gt; NAME_OID_TABLE =</span>
<span class="line-removed">255         new HashMap&lt;String, ObjectIdentifier&gt;(17);</span>
<span class="line-removed">256 </span>
<span class="line-removed">257     static { // static initializer for PCKS9_NAMES</span>
<span class="line-removed">258         NAME_OID_TABLE.put(&quot;emailaddress&quot;, PKCS9_OIDS[1]);</span>
<span class="line-removed">259         NAME_OID_TABLE.put(&quot;unstructuredname&quot;, PKCS9_OIDS[2]);</span>
<span class="line-removed">260         NAME_OID_TABLE.put(&quot;contenttype&quot;, PKCS9_OIDS[3]);</span>
<span class="line-removed">261         NAME_OID_TABLE.put(&quot;messagedigest&quot;, PKCS9_OIDS[4]);</span>
<span class="line-removed">262         NAME_OID_TABLE.put(&quot;signingtime&quot;, PKCS9_OIDS[5]);</span>
<span class="line-removed">263         NAME_OID_TABLE.put(&quot;countersignature&quot;, PKCS9_OIDS[6]);</span>
<span class="line-removed">264         NAME_OID_TABLE.put(&quot;challengepassword&quot;, PKCS9_OIDS[7]);</span>
<span class="line-removed">265         NAME_OID_TABLE.put(&quot;unstructuredaddress&quot;, PKCS9_OIDS[8]);</span>
<span class="line-removed">266         NAME_OID_TABLE.put(&quot;extendedcertificateattributes&quot;, PKCS9_OIDS[9]);</span>
<span class="line-removed">267         NAME_OID_TABLE.put(&quot;issuerandserialnumber&quot;, PKCS9_OIDS[10]);</span>
<span class="line-removed">268         NAME_OID_TABLE.put(&quot;rsaproprietary&quot;, PKCS9_OIDS[11]);</span>
<span class="line-removed">269         NAME_OID_TABLE.put(&quot;rsaproprietary&quot;, PKCS9_OIDS[12]);</span>
<span class="line-removed">270         NAME_OID_TABLE.put(&quot;signingdescription&quot;, PKCS9_OIDS[13]);</span>
<span class="line-removed">271         NAME_OID_TABLE.put(&quot;extensionrequest&quot;, PKCS9_OIDS[14]);</span>
<span class="line-removed">272         NAME_OID_TABLE.put(&quot;smimecapability&quot;, PKCS9_OIDS[15]);</span>
<span class="line-removed">273         NAME_OID_TABLE.put(&quot;signingcertificate&quot;, PKCS9_OIDS[16]);</span>
<span class="line-removed">274         NAME_OID_TABLE.put(&quot;signaturetimestamptoken&quot;, PKCS9_OIDS[17]);</span>
<span class="line-removed">275     };</span>
<span class="line-removed">276 </span>
<span class="line-removed">277     /**</span>
<span class="line-removed">278      * HashMap mapping attribute OIDs defined in PKCS9 to the</span>
<span class="line-removed">279      * corresponding attribute value type.</span>
<span class="line-removed">280      */</span>
<span class="line-removed">281     private static final HashMap&lt;ObjectIdentifier, String&gt; OID_NAME_TABLE =</span>
<span class="line-removed">282         new HashMap&lt;ObjectIdentifier, String&gt;(17);</span>
<span class="line-removed">283     static {</span>
<span class="line-removed">284         OID_NAME_TABLE.put(PKCS9_OIDS[1], EMAIL_ADDRESS_STR);</span>
<span class="line-removed">285         OID_NAME_TABLE.put(PKCS9_OIDS[2], UNSTRUCTURED_NAME_STR);</span>
<span class="line-removed">286         OID_NAME_TABLE.put(PKCS9_OIDS[3], CONTENT_TYPE_STR);</span>
<span class="line-removed">287         OID_NAME_TABLE.put(PKCS9_OIDS[4], MESSAGE_DIGEST_STR);</span>
<span class="line-removed">288         OID_NAME_TABLE.put(PKCS9_OIDS[5], SIGNING_TIME_STR);</span>
<span class="line-removed">289         OID_NAME_TABLE.put(PKCS9_OIDS[6], COUNTERSIGNATURE_STR);</span>
<span class="line-removed">290         OID_NAME_TABLE.put(PKCS9_OIDS[7], CHALLENGE_PASSWORD_STR);</span>
<span class="line-removed">291         OID_NAME_TABLE.put(PKCS9_OIDS[8], UNSTRUCTURED_ADDRESS_STR);</span>
<span class="line-removed">292         OID_NAME_TABLE.put(PKCS9_OIDS[9], EXTENDED_CERTIFICATE_ATTRIBUTES_STR);</span>
<span class="line-removed">293         OID_NAME_TABLE.put(PKCS9_OIDS[10], ISSUER_SERIALNUMBER_STR);</span>
<span class="line-removed">294         OID_NAME_TABLE.put(PKCS9_OIDS[11], RSA_PROPRIETARY_STR);</span>
<span class="line-removed">295         OID_NAME_TABLE.put(PKCS9_OIDS[12], RSA_PROPRIETARY_STR);</span>
<span class="line-removed">296         OID_NAME_TABLE.put(PKCS9_OIDS[13], SMIME_SIGNING_DESC_STR);</span>
<span class="line-removed">297         OID_NAME_TABLE.put(PKCS9_OIDS[14], EXTENSION_REQUEST_STR);</span>
<span class="line-removed">298         OID_NAME_TABLE.put(PKCS9_OIDS[15], SMIME_CAPABILITY_STR);</span>
<span class="line-removed">299         OID_NAME_TABLE.put(PKCS9_OIDS[16], SIGNING_CERTIFICATE_STR);</span>
<span class="line-removed">300         OID_NAME_TABLE.put(PKCS9_OIDS[17], SIGNATURE_TIMESTAMP_TOKEN_STR);</span>
<span class="line-removed">301     }</span>
302 
303     /**
304      * Acceptable ASN.1 tags for DER encodings of values of PKCS9
305      * attributes, by index in &lt;code&gt;PKCS9_OIDS&lt;/code&gt;.
306      * Sets of acceptable tags are represented as arrays.
307      */
308     private static final Byte[][] PKCS9_VALUE_TAGS = {
309         null,
310         {DerValue.tag_IA5String},   // EMailAddress
311         {DerValue.tag_IA5String,   // UnstructuredName
312          DerValue.tag_PrintableString},
313         {DerValue.tag_ObjectId},    // ContentType
314         {DerValue.tag_OctetString}, // MessageDigest
315         {DerValue.tag_UtcTime},     // SigningTime
316         {DerValue.tag_Sequence},    // Countersignature
317         {DerValue.tag_PrintableString,
318          DerValue.tag_T61String,
319          DerValue.tag_BMPString,
320          DerValue.tag_UniversalString,
321          DerValue.tag_UTF8String},   // ChallengePassword
</pre>
<hr />
<pre>
410 
411     /**
412      * Construct an attribute object from the attribute&#39;s OID and
413      * value.  If the attribute is single-valued, provide only one
414      * value.  If the attribute is multi-valued, provide an array
415      * containing all the values.
416      * Arrays of length zero are accepted, though probably useless.
417      *
418      * &lt;P&gt; The
419      * &lt;a href=#classTable&gt;table&lt;/a&gt; gives the class that &lt;code&gt;value&lt;/code&gt;
420      * must have for a given attribute.
421      *
422      * @exception IllegalArgumentException
423      * if the &lt;code&gt;value&lt;/code&gt; has the wrong type.
424      */
425     public PKCS9Attribute(ObjectIdentifier oid, Object value)
426     throws IllegalArgumentException {
427         init(oid, value);
428     }
429 
<span class="line-removed">430     /**</span>
<span class="line-removed">431      * Construct an attribute object from the attribute&#39;s name and</span>
<span class="line-removed">432      * value.  If the attribute is single-valued, provide only one</span>
<span class="line-removed">433      * value.  If the attribute is multi-valued, provide an array</span>
<span class="line-removed">434      * containing all the values.</span>
<span class="line-removed">435      * Arrays of length zero are accepted, though probably useless.</span>
<span class="line-removed">436      *</span>
<span class="line-removed">437      * &lt;P&gt; The</span>
<span class="line-removed">438      * &lt;a href=#classTable&gt;table&lt;/a&gt; gives the class that &lt;code&gt;value&lt;/code&gt;</span>
<span class="line-removed">439      * must have for a given attribute. Reasonable variants of these</span>
<span class="line-removed">440      * attributes are accepted; in particular, case does not matter.</span>
<span class="line-removed">441      *</span>
<span class="line-removed">442      * @exception IllegalArgumentException</span>
<span class="line-removed">443      * if the &lt;code&gt;name&lt;/code&gt; is not recognized or the</span>
<span class="line-removed">444      * &lt;code&gt;value&lt;/code&gt; has the wrong type.</span>
<span class="line-removed">445      */</span>
<span class="line-removed">446     public PKCS9Attribute(String name, Object value)</span>
<span class="line-removed">447     throws IllegalArgumentException {</span>
<span class="line-removed">448         ObjectIdentifier oid = getOID(name);</span>
<span class="line-removed">449 </span>
<span class="line-removed">450         if (oid == null)</span>
<span class="line-removed">451             throw new IllegalArgumentException(</span>
<span class="line-removed">452                        &quot;Unrecognized attribute name &quot; + name +</span>
<span class="line-removed">453                        &quot; constructing PKCS9Attribute.&quot;);</span>
<span class="line-removed">454 </span>
<span class="line-removed">455         init(oid, value);</span>
<span class="line-removed">456     }</span>
<span class="line-removed">457 </span>
458     private void init(ObjectIdentifier oid, Object value)
459         throws IllegalArgumentException {
460 
461         this.oid = oid;
462         index = indexOf(oid, PKCS9_OIDS, 1);
463         Class&lt;?&gt; clazz = index == -1 ? BYTE_ARRAY_CLASS: VALUE_CLASSES[index];
464         if (!clazz.isInstance(value)) {
465                 throw new IllegalArgumentException(
466                            &quot;Wrong value class &quot; +
467                            &quot; for attribute &quot; + oid +
468                            &quot; constructing PKCS9Attribute; was &quot; +
469                            value.getClass().toString() + &quot;, should be &quot; +
470                            clazz.toString());
471         }
472         this.value = value;
473     }
474 
475 
476     /**
477      * Construct a PKCS9Attribute from its encoding on an input
</pre>
<hr />
<pre>
749     }
750 
751     /**
752      * Show whether this attribute is single-valued.
753      */
754     public boolean isSingleValued() {
755         return index == -1 || SINGLE_VALUED[index];
756     }
757 
758     /**
759      *  Return the OID of this attribute.
760      */
761     public ObjectIdentifier getOID() {
762         return oid;
763     }
764 
765     /**
766      *  Return the name of this attribute.
767      */
768     public String getName() {
<span class="line-modified">769         return index == -1 ?</span>
<span class="line-modified">770                 oid.toString() :</span>
<span class="line-modified">771                 OID_NAME_TABLE.get(PKCS9_OIDS[index]);</span>
772     }
773 
774     /**
775      * Return the OID for a given attribute name or null if we don&#39;t recognize
776      * the name.
777      */
778     public static ObjectIdentifier getOID(String name) {
<span class="line-modified">779         return NAME_OID_TABLE.get(name.toLowerCase(Locale.ENGLISH));</span>





780     }
781 
782     /**
783      * Return the attribute name for a given OID or null if we don&#39;t recognize
784      * the oid.
785      */
786     public static String getName(ObjectIdentifier oid) {
<span class="line-modified">787         return OID_NAME_TABLE.get(oid);</span>
788     }
789 
790     /**
791      * Returns a string representation of this attribute.
792      */
793     @Override
794     public String toString() {
795         StringBuilder sb = new StringBuilder(100);
796 
797         sb.append(&quot;[&quot;);
798 
799         if (index == -1) {
800             sb.append(oid.toString());
801         } else {
<span class="line-modified">802             sb.append(OID_NAME_TABLE.get(PKCS9_OIDS[index]));</span>
803         }
804         sb.append(&quot;: &quot;);
805 
806         if (index == -1 || SINGLE_VALUED[index]) {
807             if (value instanceof byte[]) { // special case for octet string
808                 HexDumpEncoder hexDump = new HexDumpEncoder();
809                 sb.append(hexDump.encodeBuffer((byte[]) value));
810             } else {
811                 sb.append(value.toString());
812             }
813             sb.append(&quot;]&quot;);
814             return sb.toString();
815         } else { // multi-valued
816             boolean first = true;
817             Object[] values = (Object[]) value;
818 
819             for (Object curVal : values) {
820                 if (first)
821                     first = false;
822                 else
</pre>
</td>
<td>
<hr />
<pre>
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.pkcs;
 27 
 28 import java.io.IOException;
 29 import java.io.OutputStream;
 30 import java.security.cert.CertificateException;
 31 import java.util.Locale;
 32 import java.util.Date;
 33 import java.util.HashMap;
 34 import sun.security.x509.CertificateExtensions;
<span class="line-modified"> 35 import sun.security.util.*;</span>






 36 
 37 /**
 38  * Class supporting any PKCS9 attributes.
 39  * Supports DER decoding/encoding and access to attribute values.
 40  *
 41  * &lt;a name=&quot;classTable&quot;&gt;&lt;h3&gt;Type/Class Table&lt;/h3&gt;&lt;/a&gt;
 42  * The following table shows the correspondence between
 43  * PKCS9 attribute types and value component classes.
 44  * For types not listed here, its name is the OID
 45  * in string form, its value is a (single-valued)
 46  * byte array that is the SET&#39;s encoding.
 47  *
 48  * &lt;TABLE BORDER CELLPADDING=8 ALIGN=CENTER&gt;
 49  *
 50  * &lt;TR&gt;
 51  * &lt;TH&gt;Object Identifier&lt;/TH&gt;
 52  * &lt;TH&gt;Attribute Name&lt;/TH&gt;
 53  * &lt;TH&gt;Type&lt;/TH&gt;
 54  * &lt;TH&gt;Value Class&lt;/TH&gt;
 55  * &lt;/TR&gt;
</pre>
<hr />
<pre>
165  * &lt;TD&gt;Single-valued&lt;/TD&gt;
166  * &lt;TD&gt;byte[]&lt;/TD&gt;
167  * &lt;/TR&gt;
168  *
169  * &lt;/TABLE&gt;
170  *
171  * @author Douglas Hoover
172  */
173 public class PKCS9Attribute implements DerEncoder {
174 
175     /* Are we debugging ? */
176     private static final Debug debug = Debug.getInstance(&quot;jar&quot;);
177 
178     /**
179      * Array of attribute OIDs defined in PKCS9, by number.
180      */
181     static final ObjectIdentifier[] PKCS9_OIDS = new ObjectIdentifier[18];
182 
183     private static final Class&lt;?&gt; BYTE_ARRAY_CLASS;
184 
<span class="line-modified">185     static {</span>
<span class="line-modified">186         // set unused PKCS9_OIDS entries to null</span>
<span class="line-modified">187         // rest are initialized with public constants</span>
<span class="line-modified">188         PKCS9_OIDS[0] = PKCS9_OIDS[11] = PKCS9_OIDS[12] = PKCS9_OIDS[13] =</span>
<span class="line-modified">189         PKCS9_OIDS[15] = null;</span>






190         try {
191             BYTE_ARRAY_CLASS = Class.forName(&quot;[B&quot;);
192         } catch (ClassNotFoundException e) {
193             throw new ExceptionInInitializerError(e.toString());
194         }
195     }
196 
<span class="line-modified">197     public static final ObjectIdentifier EMAIL_ADDRESS_OID = PKCS9_OIDS[1] =</span>
<span class="line-modified">198             ObjectIdentifier.of(KnownOIDs.EmailAddress);</span>
<span class="line-modified">199     public static final ObjectIdentifier UNSTRUCTURED_NAME_OID = PKCS9_OIDS[2] =</span>
<span class="line-modified">200             ObjectIdentifier.of(KnownOIDs.UnstructuredName);</span>
<span class="line-modified">201     public static final ObjectIdentifier CONTENT_TYPE_OID = PKCS9_OIDS[3] =</span>
<span class="line-modified">202             ObjectIdentifier.of(KnownOIDs.ContentType);</span>
<span class="line-modified">203     public static final ObjectIdentifier MESSAGE_DIGEST_OID = PKCS9_OIDS[4] =</span>
<span class="line-modified">204             ObjectIdentifier.of(KnownOIDs.MessageDigest);</span>
<span class="line-modified">205     public static final ObjectIdentifier SIGNING_TIME_OID = PKCS9_OIDS[5] =</span>
<span class="line-modified">206             ObjectIdentifier.of(KnownOIDs.SigningTime);</span>
<span class="line-modified">207     public static final ObjectIdentifier COUNTERSIGNATURE_OID = PKCS9_OIDS[6] =</span>
<span class="line-modified">208             ObjectIdentifier.of(KnownOIDs.CounterSignature);</span>
<span class="line-added">209     public static final ObjectIdentifier CHALLENGE_PASSWORD_OID =</span>
<span class="line-added">210             PKCS9_OIDS[7] = ObjectIdentifier.of(KnownOIDs.ChallengePassword);</span>
<span class="line-added">211     public static final ObjectIdentifier UNSTRUCTURED_ADDRESS_OID =</span>
<span class="line-added">212             PKCS9_OIDS[8] = ObjectIdentifier.of(KnownOIDs.UnstructuredAddress);</span>
<span class="line-added">213     public static final ObjectIdentifier EXTENDED_CERTIFICATE_ATTRIBUTES_OID =</span>
<span class="line-added">214             PKCS9_OIDS[9] =</span>
<span class="line-added">215             ObjectIdentifier.of(KnownOIDs.ExtendedCertificateAttributes);</span>
<span class="line-added">216     public static final ObjectIdentifier ISSUER_SERIALNUMBER_OID =</span>
<span class="line-added">217             PKCS9_OIDS[10] =</span>
<span class="line-added">218             ObjectIdentifier.of(KnownOIDs.IssuerAndSerialNumber);</span>
219     // [11], [12] are RSA DSI proprietary
220     // [13] ==&gt; signingDescription, S/MIME, not used anymore
<span class="line-modified">221     public static final ObjectIdentifier EXTENSION_REQUEST_OID =</span>
<span class="line-modified">222             PKCS9_OIDS[14] = ObjectIdentifier.of(KnownOIDs.ExtensionRequest);</span>
<span class="line-modified">223     public static final ObjectIdentifier SIGNING_CERTIFICATE_OID =</span>
<span class="line-added">224             PKCS9_OIDS[16] = ObjectIdentifier.of(KnownOIDs.SigningCertificate);</span>
225     public static final ObjectIdentifier SIGNATURE_TIMESTAMP_TOKEN_OID =
<span class="line-modified">226             PKCS9_OIDS[17] =</span>
<span class="line-modified">227             ObjectIdentifier.of(KnownOIDs.SignatureTimestampToken);</span>









































































228 
229     /**
230      * Acceptable ASN.1 tags for DER encodings of values of PKCS9
231      * attributes, by index in &lt;code&gt;PKCS9_OIDS&lt;/code&gt;.
232      * Sets of acceptable tags are represented as arrays.
233      */
234     private static final Byte[][] PKCS9_VALUE_TAGS = {
235         null,
236         {DerValue.tag_IA5String},   // EMailAddress
237         {DerValue.tag_IA5String,   // UnstructuredName
238          DerValue.tag_PrintableString},
239         {DerValue.tag_ObjectId},    // ContentType
240         {DerValue.tag_OctetString}, // MessageDigest
241         {DerValue.tag_UtcTime},     // SigningTime
242         {DerValue.tag_Sequence},    // Countersignature
243         {DerValue.tag_PrintableString,
244          DerValue.tag_T61String,
245          DerValue.tag_BMPString,
246          DerValue.tag_UniversalString,
247          DerValue.tag_UTF8String},   // ChallengePassword
</pre>
<hr />
<pre>
336 
337     /**
338      * Construct an attribute object from the attribute&#39;s OID and
339      * value.  If the attribute is single-valued, provide only one
340      * value.  If the attribute is multi-valued, provide an array
341      * containing all the values.
342      * Arrays of length zero are accepted, though probably useless.
343      *
344      * &lt;P&gt; The
345      * &lt;a href=#classTable&gt;table&lt;/a&gt; gives the class that &lt;code&gt;value&lt;/code&gt;
346      * must have for a given attribute.
347      *
348      * @exception IllegalArgumentException
349      * if the &lt;code&gt;value&lt;/code&gt; has the wrong type.
350      */
351     public PKCS9Attribute(ObjectIdentifier oid, Object value)
352     throws IllegalArgumentException {
353         init(oid, value);
354     }
355 




























356     private void init(ObjectIdentifier oid, Object value)
357         throws IllegalArgumentException {
358 
359         this.oid = oid;
360         index = indexOf(oid, PKCS9_OIDS, 1);
361         Class&lt;?&gt; clazz = index == -1 ? BYTE_ARRAY_CLASS: VALUE_CLASSES[index];
362         if (!clazz.isInstance(value)) {
363                 throw new IllegalArgumentException(
364                            &quot;Wrong value class &quot; +
365                            &quot; for attribute &quot; + oid +
366                            &quot; constructing PKCS9Attribute; was &quot; +
367                            value.getClass().toString() + &quot;, should be &quot; +
368                            clazz.toString());
369         }
370         this.value = value;
371     }
372 
373 
374     /**
375      * Construct a PKCS9Attribute from its encoding on an input
</pre>
<hr />
<pre>
647     }
648 
649     /**
650      * Show whether this attribute is single-valued.
651      */
652     public boolean isSingleValued() {
653         return index == -1 || SINGLE_VALUED[index];
654     }
655 
656     /**
657      *  Return the OID of this attribute.
658      */
659     public ObjectIdentifier getOID() {
660         return oid;
661     }
662 
663     /**
664      *  Return the name of this attribute.
665      */
666     public String getName() {
<span class="line-modified">667         String n = oid.toString();</span>
<span class="line-modified">668         KnownOIDs os = KnownOIDs.findMatch(n);</span>
<span class="line-modified">669         return (os == null? n : os.stdName());</span>
670     }
671 
672     /**
673      * Return the OID for a given attribute name or null if we don&#39;t recognize
674      * the name.
675      */
676     public static ObjectIdentifier getOID(String name) {
<span class="line-modified">677         KnownOIDs o = KnownOIDs.findMatch(name);</span>
<span class="line-added">678         if (o != null) {</span>
<span class="line-added">679             return ObjectIdentifier.of(o);</span>
<span class="line-added">680         } else {</span>
<span class="line-added">681             return null;</span>
<span class="line-added">682         }</span>
683     }
684 
685     /**
686      * Return the attribute name for a given OID or null if we don&#39;t recognize
687      * the oid.
688      */
689     public static String getName(ObjectIdentifier oid) {
<span class="line-modified">690         return KnownOIDs.findMatch(oid.toString()).stdName();</span>
691     }
692 
693     /**
694      * Returns a string representation of this attribute.
695      */
696     @Override
697     public String toString() {
698         StringBuilder sb = new StringBuilder(100);
699 
700         sb.append(&quot;[&quot;);
701 
702         if (index == -1) {
703             sb.append(oid.toString());
704         } else {
<span class="line-modified">705             sb.append(getName(oid));</span>
706         }
707         sb.append(&quot;: &quot;);
708 
709         if (index == -1 || SINGLE_VALUED[index]) {
710             if (value instanceof byte[]) { // special case for octet string
711                 HexDumpEncoder hexDump = new HexDumpEncoder();
712                 sb.append(hexDump.encodeBuffer((byte[]) value));
713             } else {
714                 sb.append(value.toString());
715             }
716             sb.append(&quot;]&quot;);
717             return sb.toString();
718         } else { // multi-valued
719             boolean first = true;
720             Object[] values = (Object[]) value;
721 
722             for (Object curVal : values) {
723                 if (first)
724                     first = false;
725                 else
</pre>
</td>
</tr>
</table>
<center><a href="PKCS7.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../pkcs12/PKCS12KeyStore.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>