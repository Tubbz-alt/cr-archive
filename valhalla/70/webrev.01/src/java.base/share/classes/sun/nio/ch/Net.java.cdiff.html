<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/nio/ch/Net.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="DatagramSocketAdaptor.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SelectorProviderImpl.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/nio/ch/Net.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 247,10 ***</span>
<span class="line-new-header">--- 247,61 ---</span>
      private static InetSocketAddress getLoopbackAddress(int port) {
          return new InetSocketAddress(InetAddress.getLoopbackAddress(),
                                       port);
      }
  
<span class="line-added">+     private static final InetAddress anyLocalInet4Address;</span>
<span class="line-added">+     private static final InetAddress anyLocalInet6Address;</span>
<span class="line-added">+     private static final InetAddress inet4LoopbackAddress;</span>
<span class="line-added">+     private static final InetAddress inet6LoopbackAddress;</span>
<span class="line-added">+     static {</span>
<span class="line-added">+         try {</span>
<span class="line-added">+             anyLocalInet4Address = inet4FromInt(0);</span>
<span class="line-added">+             assert anyLocalInet4Address instanceof Inet4Address</span>
<span class="line-added">+                     &amp;&amp; anyLocalInet4Address.isAnyLocalAddress();</span>
<span class="line-added">+ </span>
<span class="line-added">+             anyLocalInet6Address = InetAddress.getByAddress(new byte[16]);</span>
<span class="line-added">+             assert anyLocalInet6Address instanceof Inet6Address</span>
<span class="line-added">+                     &amp;&amp; anyLocalInet6Address.isAnyLocalAddress();</span>
<span class="line-added">+ </span>
<span class="line-added">+             inet4LoopbackAddress = inet4FromInt(0x7f000001);</span>
<span class="line-added">+             assert inet4LoopbackAddress instanceof Inet4Address</span>
<span class="line-added">+                     &amp;&amp; inet4LoopbackAddress.isLoopbackAddress();</span>
<span class="line-added">+ </span>
<span class="line-added">+             byte[] bytes = new byte[16];</span>
<span class="line-added">+             bytes[15] = 0x01;</span>
<span class="line-added">+             inet6LoopbackAddress = InetAddress.getByAddress(bytes);</span>
<span class="line-added">+             assert inet6LoopbackAddress instanceof Inet6Address</span>
<span class="line-added">+                     &amp;&amp; inet6LoopbackAddress.isLoopbackAddress();</span>
<span class="line-added">+         } catch (Exception e) {</span>
<span class="line-added">+             throw new InternalError(e);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     static InetAddress inet4LoopbackAddress() {</span>
<span class="line-added">+         return inet4LoopbackAddress;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     static InetAddress inet6LoopbackAddress() {</span>
<span class="line-added">+         return inet6LoopbackAddress;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Returns the wildcard address that corresponds to the given protocol family.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @see InetAddress#isAnyLocalAddress()</span>
<span class="line-added">+      */</span>
<span class="line-added">+     static InetAddress anyLocalAddress(ProtocolFamily family) {</span>
<span class="line-added">+         if (family == StandardProtocolFamily.INET) {</span>
<span class="line-added">+             return anyLocalInet4Address;</span>
<span class="line-added">+         } else if (family == StandardProtocolFamily.INET6) {</span>
<span class="line-added">+             return anyLocalInet6Address;</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             throw new IllegalArgumentException();</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      /**
       * Returns any IPv4 address of the given network interface, or
       * null if the interface does not have any IPv4 addresses.
       */
      static Inet4Address anyInet4Address(final NetworkInterface interf) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 465,11 ***</span>
              (family != StandardProtocolFamily.INET);
          return IOUtil.newFD(socket0(preferIPv6, stream, false, fastLoopback));
      }
  
      static FileDescriptor serverSocket(boolean stream) {
<span class="line-modified">!         return IOUtil.newFD(socket0(isIPv6Available(), stream, true, fastLoopback));</span>
      }
  
      // Due to oddities SO_REUSEADDR on windows reuse is ignored
      private static native int socket0(boolean preferIPv6, boolean stream, boolean reuse,
                                        boolean fastLoopback);
<span class="line-new-header">--- 516,17 ---</span>
              (family != StandardProtocolFamily.INET);
          return IOUtil.newFD(socket0(preferIPv6, stream, false, fastLoopback));
      }
  
      static FileDescriptor serverSocket(boolean stream) {
<span class="line-modified">!         return serverSocket(UNSPEC, stream);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     static FileDescriptor serverSocket(ProtocolFamily family, boolean stream) {</span>
<span class="line-added">+         boolean preferIPv6 = isIPv6Available() &amp;&amp;</span>
<span class="line-added">+             (family != StandardProtocolFamily.INET);</span>
<span class="line-added">+         return IOUtil.newFD(socket0(preferIPv6, stream, true, fastLoopback));</span>
      }
  
      // Due to oddities SO_REUSEADDR on windows reuse is ignored
      private static native int socket0(boolean preferIPv6, boolean stream, boolean reuse,
                                        boolean fastLoopback);
</pre>
<center><a href="DatagramSocketAdaptor.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SelectorProviderImpl.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>