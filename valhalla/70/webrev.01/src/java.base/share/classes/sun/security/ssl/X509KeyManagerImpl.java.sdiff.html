<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/ssl/X509KeyManagerImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SunJSSE.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../timestamp/TSRequest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/X509KeyManagerImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2004, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 26 package sun.security.ssl;
 27 
 28 import java.lang.ref.*;
 29 import java.net.Socket;
 30 import java.security.AlgorithmConstraints;
 31 import java.security.KeyStore;
 32 import java.security.KeyStore.Builder;
 33 import java.security.KeyStore.Entry;
 34 import java.security.KeyStore.PrivateKeyEntry;
 35 import java.security.Principal;
 36 import java.security.PrivateKey;
 37 import java.security.cert.CertPathValidatorException;
 38 import java.security.cert.Certificate;
 39 import java.security.cert.CertificateException;
 40 import java.security.cert.X509Certificate;
 41 import java.util.*;
 42 import java.util.concurrent.atomic.AtomicLong;
 43 import javax.net.ssl.*;
 44 import sun.security.provider.certpath.AlgorithmChecker;
 45 import sun.security.validator.Validator;

 46 
 47 /**
 48  * The new X509 key manager implementation. The main differences to the
 49  * old SunX509 key manager are:
 50  *  . it is based around the KeyStore.Builder API. This allows it to use
 51  *    other forms of KeyStore protection or password input (e.g. a
 52  *    CallbackHandler) or to have keys within one KeyStore protected by
 53  *    different keys.
 54  *  . it can use multiple KeyStores at the same time.
 55  *  . it is explicitly designed to accommodate KeyStores that change over
 56  *    the lifetime of the process.
 57  *  . it makes an effort to choose the key that matches best, i.e. one that
 58  *    is not expired and has the appropriate certificate extensions.
 59  *
 60  * Note that this code is not explicitly performance optimzied yet.
 61  *
 62  * @author  Andreas Sterbenz
 63  */
 64 final class X509KeyManagerImpl extends X509ExtendedKeyManager
 65         implements X509KeyManager {
</pre>
<hr />
<pre>
505         public String toString() {
506             String s = alias + &quot; (verified: &quot; + checkResult + &quot;)&quot;;
507             if (builderIndex == 0) {
508                 return s;
509             } else {
510                 return &quot;Builder #&quot; + builderIndex + &quot;, alias: &quot; + s;
511             }
512         }
513     }
514 
515     // enum for the type of certificate check we want to perform
516     // (client or server)
517     // also includes the check code itself
518     private static enum CheckType {
519 
520         // enum constant for &quot;no check&quot; (currently not used)
521         NONE(Collections.&lt;String&gt;emptySet()),
522 
523         // enum constant for &quot;tls client&quot; check
524         // valid EKU for TLS client: any, tls_client
<span class="line-modified">525         CLIENT(new HashSet&lt;String&gt;(Arrays.asList(new String[] {</span>
<span class="line-modified">526             &quot;2.5.29.37.0&quot;, &quot;1.3.6.1.5.5.7.3.2&quot; }))),</span>


527 
528         // enum constant for &quot;tls server&quot; check
529         // valid EKU for TLS server: any, tls_server, ns_sgc, ms_sgc
<span class="line-modified">530         SERVER(new HashSet&lt;String&gt;(Arrays.asList(new String[] {</span>
<span class="line-modified">531             &quot;2.5.29.37.0&quot;, &quot;1.3.6.1.5.5.7.3.1&quot;, &quot;2.16.840.1.113730.4.1&quot;,</span>
<span class="line-modified">532             &quot;1.3.6.1.4.1.311.10.3.3&quot; })));</span>



533 
534         // set of valid EKU values for this type
535         final Set&lt;String&gt; validEku;
536 
537         CheckType(Set&lt;String&gt; validEku) {
538             this.validEku = validEku;
539         }
540 
541         private static boolean getBit(boolean[] keyUsage, int bit) {
542             return (bit &lt; keyUsage.length) &amp;&amp; keyUsage[bit];
543         }
544 
545         // Check if this certificate is appropriate for this type of use
546         // first check extensions, if they match, check expiration.
547         //
548         // Note: we may want to move this code into the sun.security.validator
549         // package
550         CheckResult check(X509Certificate cert, Date date,
551                 List&lt;SNIServerName&gt; serverNames, String idAlgorithm) {
552 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2004, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 26 package sun.security.ssl;
 27 
 28 import java.lang.ref.*;
 29 import java.net.Socket;
 30 import java.security.AlgorithmConstraints;
 31 import java.security.KeyStore;
 32 import java.security.KeyStore.Builder;
 33 import java.security.KeyStore.Entry;
 34 import java.security.KeyStore.PrivateKeyEntry;
 35 import java.security.Principal;
 36 import java.security.PrivateKey;
 37 import java.security.cert.CertPathValidatorException;
 38 import java.security.cert.Certificate;
 39 import java.security.cert.CertificateException;
 40 import java.security.cert.X509Certificate;
 41 import java.util.*;
 42 import java.util.concurrent.atomic.AtomicLong;
 43 import javax.net.ssl.*;
 44 import sun.security.provider.certpath.AlgorithmChecker;
 45 import sun.security.validator.Validator;
<span class="line-added"> 46 import sun.security.util.KnownOIDs;</span>
 47 
 48 /**
 49  * The new X509 key manager implementation. The main differences to the
 50  * old SunX509 key manager are:
 51  *  . it is based around the KeyStore.Builder API. This allows it to use
 52  *    other forms of KeyStore protection or password input (e.g. a
 53  *    CallbackHandler) or to have keys within one KeyStore protected by
 54  *    different keys.
 55  *  . it can use multiple KeyStores at the same time.
 56  *  . it is explicitly designed to accommodate KeyStores that change over
 57  *    the lifetime of the process.
 58  *  . it makes an effort to choose the key that matches best, i.e. one that
 59  *    is not expired and has the appropriate certificate extensions.
 60  *
 61  * Note that this code is not explicitly performance optimzied yet.
 62  *
 63  * @author  Andreas Sterbenz
 64  */
 65 final class X509KeyManagerImpl extends X509ExtendedKeyManager
 66         implements X509KeyManager {
</pre>
<hr />
<pre>
506         public String toString() {
507             String s = alias + &quot; (verified: &quot; + checkResult + &quot;)&quot;;
508             if (builderIndex == 0) {
509                 return s;
510             } else {
511                 return &quot;Builder #&quot; + builderIndex + &quot;, alias: &quot; + s;
512             }
513         }
514     }
515 
516     // enum for the type of certificate check we want to perform
517     // (client or server)
518     // also includes the check code itself
519     private static enum CheckType {
520 
521         // enum constant for &quot;no check&quot; (currently not used)
522         NONE(Collections.&lt;String&gt;emptySet()),
523 
524         // enum constant for &quot;tls client&quot; check
525         // valid EKU for TLS client: any, tls_client
<span class="line-modified">526         CLIENT(new HashSet&lt;String&gt;(List.of(</span>
<span class="line-modified">527             KnownOIDs.anyExtendedKeyUsage.value(),</span>
<span class="line-added">528             KnownOIDs.clientAuth.value()</span>
<span class="line-added">529         ))),</span>
530 
531         // enum constant for &quot;tls server&quot; check
532         // valid EKU for TLS server: any, tls_server, ns_sgc, ms_sgc
<span class="line-modified">533         SERVER(new HashSet&lt;String&gt;(List.of(</span>
<span class="line-modified">534             KnownOIDs.anyExtendedKeyUsage.value(),</span>
<span class="line-modified">535             KnownOIDs.serverAuth.value(),</span>
<span class="line-added">536             KnownOIDs.NETSCAPE_ExportApproved.value(),</span>
<span class="line-added">537             KnownOIDs.MICROSOFT_ExportApproved.value()</span>
<span class="line-added">538         )));</span>
539 
540         // set of valid EKU values for this type
541         final Set&lt;String&gt; validEku;
542 
543         CheckType(Set&lt;String&gt; validEku) {
544             this.validEku = validEku;
545         }
546 
547         private static boolean getBit(boolean[] keyUsage, int bit) {
548             return (bit &lt; keyUsage.length) &amp;&amp; keyUsage[bit];
549         }
550 
551         // Check if this certificate is appropriate for this type of use
552         // first check extensions, if they match, check expiration.
553         //
554         // Note: we may want to move this code into the sun.security.validator
555         // package
556         CheckResult check(X509Certificate cert, Date date,
557                 List&lt;SNIServerName&gt; serverNames, String idAlgorithm) {
558 
</pre>
</td>
</tr>
</table>
<center><a href="SunJSSE.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../timestamp/TSRequest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>