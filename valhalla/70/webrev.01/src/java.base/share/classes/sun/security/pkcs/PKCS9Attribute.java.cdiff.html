<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/security/pkcs/PKCS9Attribute.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="PKCS7.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../pkcs12/PKCS12KeyStore.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/pkcs/PKCS9Attribute.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 30,17 ***</span>
  import java.security.cert.CertificateException;
  import java.util.Locale;
  import java.util.Date;
  import java.util.HashMap;
  import sun.security.x509.CertificateExtensions;
<span class="line-modified">! import sun.security.util.Debug;</span>
<span class="line-removed">- import sun.security.util.DerEncoder;</span>
<span class="line-removed">- import sun.security.util.DerValue;</span>
<span class="line-removed">- import sun.security.util.DerInputStream;</span>
<span class="line-removed">- import sun.security.util.DerOutputStream;</span>
<span class="line-removed">- import sun.security.util.ObjectIdentifier;</span>
<span class="line-removed">- import sun.security.util.HexDumpEncoder;</span>
  
  /**
   * Class supporting any PKCS9 attributes.
   * Supports DER decoding/encoding and access to attribute values.
   *
<span class="line-new-header">--- 30,11 ---</span>
  import java.security.cert.CertificateException;
  import java.util.Locale;
  import java.util.Date;
  import java.util.HashMap;
  import sun.security.x509.CertificateExtensions;
<span class="line-modified">! import sun.security.util.*;</span>
  
  /**
   * Class supporting any PKCS9 attributes.
   * Supports DER decoding/encoding and access to attribute values.
   *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 186,121 ***</span>
       */
      static final ObjectIdentifier[] PKCS9_OIDS = new ObjectIdentifier[18];
  
      private static final Class&lt;?&gt; BYTE_ARRAY_CLASS;
  
<span class="line-modified">!     static {   // static initializer for PKCS9_OIDS</span>
<span class="line-modified">!         for (int i = 1; i &lt; PKCS9_OIDS.length - 2; i++) {</span>
<span class="line-modified">!             PKCS9_OIDS[i] = ObjectIdentifier.of(&quot;1.2.840.113549.1.9.&quot; + i);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         // Initialize SigningCertificate and SignatureTimestampToken</span>
<span class="line-removed">-         // separately (because their values are out of sequence)</span>
<span class="line-removed">-         PKCS9_OIDS[PKCS9_OIDS.length - 2] =</span>
<span class="line-removed">-             ObjectIdentifier.of(&quot;1.2.840.113549.1.9.16.2.12&quot;);</span>
<span class="line-removed">-         PKCS9_OIDS[PKCS9_OIDS.length - 1] =</span>
<span class="line-removed">-             ObjectIdentifier.of(&quot;1.2.840.113549.1.9.16.2.14&quot;);</span>
<span class="line-removed">- </span>
          try {
              BYTE_ARRAY_CLASS = Class.forName(&quot;[B&quot;);
          } catch (ClassNotFoundException e) {
              throw new ExceptionInInitializerError(e.toString());
          }
      }
  
<span class="line-modified">!     // first element [0] not used</span>
<span class="line-modified">!     public static final ObjectIdentifier EMAIL_ADDRESS_OID = PKCS9_OIDS[1];</span>
<span class="line-modified">!     public static final ObjectIdentifier UNSTRUCTURED_NAME_OID = PKCS9_OIDS[2];</span>
<span class="line-modified">!     public static final ObjectIdentifier CONTENT_TYPE_OID = PKCS9_OIDS[3];</span>
<span class="line-modified">!     public static final ObjectIdentifier MESSAGE_DIGEST_OID = PKCS9_OIDS[4];</span>
<span class="line-modified">!     public static final ObjectIdentifier SIGNING_TIME_OID = PKCS9_OIDS[5];</span>
<span class="line-modified">!     public static final ObjectIdentifier COUNTERSIGNATURE_OID = PKCS9_OIDS[6];</span>
<span class="line-modified">!     public static final ObjectIdentifier CHALLENGE_PASSWORD_OID = PKCS9_OIDS[7];</span>
<span class="line-modified">!     public static final ObjectIdentifier UNSTRUCTURED_ADDRESS_OID = PKCS9_OIDS[8];</span>
<span class="line-modified">!     public static final ObjectIdentifier EXTENDED_CERTIFICATE_ATTRIBUTES_OID</span>
<span class="line-modified">!                                          = PKCS9_OIDS[9];</span>
<span class="line-modified">!     public static final ObjectIdentifier ISSUER_SERIALNUMBER_OID = PKCS9_OIDS[10];</span>
      // [11], [12] are RSA DSI proprietary
      // [13] ==&gt; signingDescription, S/MIME, not used anymore
<span class="line-modified">!     public static final ObjectIdentifier EXTENSION_REQUEST_OID = PKCS9_OIDS[14];</span>
<span class="line-modified">!     public static final ObjectIdentifier SMIME_CAPABILITY_OID = PKCS9_OIDS[15];</span>
<span class="line-modified">!     public static final ObjectIdentifier SIGNING_CERTIFICATE_OID = PKCS9_OIDS[16];</span>
      public static final ObjectIdentifier SIGNATURE_TIMESTAMP_TOKEN_OID =
<span class="line-modified">!                                 PKCS9_OIDS[17];</span>
<span class="line-modified">!     public static final String EMAIL_ADDRESS_STR = &quot;EmailAddress&quot;;</span>
<span class="line-removed">-     public static final String UNSTRUCTURED_NAME_STR = &quot;UnstructuredName&quot;;</span>
<span class="line-removed">-     public static final String CONTENT_TYPE_STR = &quot;ContentType&quot;;</span>
<span class="line-removed">-     public static final String MESSAGE_DIGEST_STR = &quot;MessageDigest&quot;;</span>
<span class="line-removed">-     public static final String SIGNING_TIME_STR = &quot;SigningTime&quot;;</span>
<span class="line-removed">-     public static final String COUNTERSIGNATURE_STR = &quot;Countersignature&quot;;</span>
<span class="line-removed">-     public static final String CHALLENGE_PASSWORD_STR = &quot;ChallengePassword&quot;;</span>
<span class="line-removed">-     public static final String UNSTRUCTURED_ADDRESS_STR = &quot;UnstructuredAddress&quot;;</span>
<span class="line-removed">-     public static final String EXTENDED_CERTIFICATE_ATTRIBUTES_STR =</span>
<span class="line-removed">-                                &quot;ExtendedCertificateAttributes&quot;;</span>
<span class="line-removed">-     public static final String ISSUER_SERIALNUMBER_STR = &quot;IssuerAndSerialNumber&quot;;</span>
<span class="line-removed">-     // [11], [12] are RSA DSI proprietary</span>
<span class="line-removed">-     private static final String RSA_PROPRIETARY_STR = &quot;RSAProprietary&quot;;</span>
<span class="line-removed">-     // [13] ==&gt; signingDescription, S/MIME, not used anymore</span>
<span class="line-removed">-     private static final String SMIME_SIGNING_DESC_STR = &quot;SMIMESigningDesc&quot;;</span>
<span class="line-removed">-     public static final String EXTENSION_REQUEST_STR = &quot;ExtensionRequest&quot;;</span>
<span class="line-removed">-     public static final String SMIME_CAPABILITY_STR = &quot;SMIMECapability&quot;;</span>
<span class="line-removed">-     public static final String SIGNING_CERTIFICATE_STR = &quot;SigningCertificate&quot;;</span>
<span class="line-removed">-     public static final String SIGNATURE_TIMESTAMP_TOKEN_STR =</span>
<span class="line-removed">-                                 &quot;SignatureTimestampToken&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * HashMap mapping names and variant names of supported</span>
<span class="line-removed">-      * attributes to their OIDs. This table contains all name forms</span>
<span class="line-removed">-      * that occur in PKCS9, in lower case.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     private static final HashMap&lt;String, ObjectIdentifier&gt; NAME_OID_TABLE =</span>
<span class="line-removed">-         new HashMap&lt;String, ObjectIdentifier&gt;(17);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     static { // static initializer for PCKS9_NAMES</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;emailaddress&quot;, PKCS9_OIDS[1]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;unstructuredname&quot;, PKCS9_OIDS[2]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;contenttype&quot;, PKCS9_OIDS[3]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;messagedigest&quot;, PKCS9_OIDS[4]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;signingtime&quot;, PKCS9_OIDS[5]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;countersignature&quot;, PKCS9_OIDS[6]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;challengepassword&quot;, PKCS9_OIDS[7]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;unstructuredaddress&quot;, PKCS9_OIDS[8]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;extendedcertificateattributes&quot;, PKCS9_OIDS[9]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;issuerandserialnumber&quot;, PKCS9_OIDS[10]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;rsaproprietary&quot;, PKCS9_OIDS[11]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;rsaproprietary&quot;, PKCS9_OIDS[12]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;signingdescription&quot;, PKCS9_OIDS[13]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;extensionrequest&quot;, PKCS9_OIDS[14]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;smimecapability&quot;, PKCS9_OIDS[15]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;signingcertificate&quot;, PKCS9_OIDS[16]);</span>
<span class="line-removed">-         NAME_OID_TABLE.put(&quot;signaturetimestamptoken&quot;, PKCS9_OIDS[17]);</span>
<span class="line-removed">-     };</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * HashMap mapping attribute OIDs defined in PKCS9 to the</span>
<span class="line-removed">-      * corresponding attribute value type.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     private static final HashMap&lt;ObjectIdentifier, String&gt; OID_NAME_TABLE =</span>
<span class="line-removed">-         new HashMap&lt;ObjectIdentifier, String&gt;(17);</span>
<span class="line-removed">-     static {</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[1], EMAIL_ADDRESS_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[2], UNSTRUCTURED_NAME_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[3], CONTENT_TYPE_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[4], MESSAGE_DIGEST_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[5], SIGNING_TIME_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[6], COUNTERSIGNATURE_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[7], CHALLENGE_PASSWORD_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[8], UNSTRUCTURED_ADDRESS_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[9], EXTENDED_CERTIFICATE_ATTRIBUTES_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[10], ISSUER_SERIALNUMBER_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[11], RSA_PROPRIETARY_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[12], RSA_PROPRIETARY_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[13], SMIME_SIGNING_DESC_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[14], EXTENSION_REQUEST_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[15], SMIME_CAPABILITY_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[16], SIGNING_CERTIFICATE_STR);</span>
<span class="line-removed">-         OID_NAME_TABLE.put(PKCS9_OIDS[17], SIGNATURE_TIMESTAMP_TOKEN_STR);</span>
<span class="line-removed">-     }</span>
  
      /**
       * Acceptable ASN.1 tags for DER encodings of values of PKCS9
       * attributes, by index in &lt;code&gt;PKCS9_OIDS&lt;/code&gt;.
       * Sets of acceptable tags are represented as arrays.
<span class="line-new-header">--- 180,53 ---</span>
       */
      static final ObjectIdentifier[] PKCS9_OIDS = new ObjectIdentifier[18];
  
      private static final Class&lt;?&gt; BYTE_ARRAY_CLASS;
  
<span class="line-modified">!     static {</span>
<span class="line-modified">!         // set unused PKCS9_OIDS entries to null</span>
<span class="line-modified">!         // rest are initialized with public constants</span>
<span class="line-modified">!         PKCS9_OIDS[0] = PKCS9_OIDS[11] = PKCS9_OIDS[12] = PKCS9_OIDS[13] =</span>
<span class="line-modified">!         PKCS9_OIDS[15] = null;</span>
          try {
              BYTE_ARRAY_CLASS = Class.forName(&quot;[B&quot;);
          } catch (ClassNotFoundException e) {
              throw new ExceptionInInitializerError(e.toString());
          }
      }
  
<span class="line-modified">!     public static final ObjectIdentifier EMAIL_ADDRESS_OID = PKCS9_OIDS[1] =</span>
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.EmailAddress);</span>
<span class="line-modified">!     public static final ObjectIdentifier UNSTRUCTURED_NAME_OID = PKCS9_OIDS[2] =</span>
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.UnstructuredName);</span>
<span class="line-modified">!     public static final ObjectIdentifier CONTENT_TYPE_OID = PKCS9_OIDS[3] =</span>
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.ContentType);</span>
<span class="line-modified">!     public static final ObjectIdentifier MESSAGE_DIGEST_OID = PKCS9_OIDS[4] =</span>
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.MessageDigest);</span>
<span class="line-modified">!     public static final ObjectIdentifier SIGNING_TIME_OID = PKCS9_OIDS[5] =</span>
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.SigningTime);</span>
<span class="line-modified">!     public static final ObjectIdentifier COUNTERSIGNATURE_OID = PKCS9_OIDS[6] =</span>
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.CounterSignature);</span>
<span class="line-added">+     public static final ObjectIdentifier CHALLENGE_PASSWORD_OID =</span>
<span class="line-added">+             PKCS9_OIDS[7] = ObjectIdentifier.of(KnownOIDs.ChallengePassword);</span>
<span class="line-added">+     public static final ObjectIdentifier UNSTRUCTURED_ADDRESS_OID =</span>
<span class="line-added">+             PKCS9_OIDS[8] = ObjectIdentifier.of(KnownOIDs.UnstructuredAddress);</span>
<span class="line-added">+     public static final ObjectIdentifier EXTENDED_CERTIFICATE_ATTRIBUTES_OID =</span>
<span class="line-added">+             PKCS9_OIDS[9] =</span>
<span class="line-added">+             ObjectIdentifier.of(KnownOIDs.ExtendedCertificateAttributes);</span>
<span class="line-added">+     public static final ObjectIdentifier ISSUER_SERIALNUMBER_OID =</span>
<span class="line-added">+             PKCS9_OIDS[10] =</span>
<span class="line-added">+             ObjectIdentifier.of(KnownOIDs.IssuerAndSerialNumber);</span>
      // [11], [12] are RSA DSI proprietary
      // [13] ==&gt; signingDescription, S/MIME, not used anymore
<span class="line-modified">!     public static final ObjectIdentifier EXTENSION_REQUEST_OID =</span>
<span class="line-modified">!             PKCS9_OIDS[14] = ObjectIdentifier.of(KnownOIDs.ExtensionRequest);</span>
<span class="line-modified">!     public static final ObjectIdentifier SIGNING_CERTIFICATE_OID =</span>
<span class="line-added">+             PKCS9_OIDS[16] = ObjectIdentifier.of(KnownOIDs.SigningCertificate);</span>
      public static final ObjectIdentifier SIGNATURE_TIMESTAMP_TOKEN_OID =
<span class="line-modified">!             PKCS9_OIDS[17] =</span>
<span class="line-modified">!             ObjectIdentifier.of(KnownOIDs.SignatureTimestampToken);</span>
  
      /**
       * Acceptable ASN.1 tags for DER encodings of values of PKCS9
       * attributes, by index in &lt;code&gt;PKCS9_OIDS&lt;/code&gt;.
       * Sets of acceptable tags are represented as arrays.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 425,38 ***</span>
      public PKCS9Attribute(ObjectIdentifier oid, Object value)
      throws IllegalArgumentException {
          init(oid, value);
      }
  
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Construct an attribute object from the attribute&#39;s name and</span>
<span class="line-removed">-      * value.  If the attribute is single-valued, provide only one</span>
<span class="line-removed">-      * value.  If the attribute is multi-valued, provide an array</span>
<span class="line-removed">-      * containing all the values.</span>
<span class="line-removed">-      * Arrays of length zero are accepted, though probably useless.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * &lt;P&gt; The</span>
<span class="line-removed">-      * &lt;a href=#classTable&gt;table&lt;/a&gt; gives the class that &lt;code&gt;value&lt;/code&gt;</span>
<span class="line-removed">-      * must have for a given attribute. Reasonable variants of these</span>
<span class="line-removed">-      * attributes are accepted; in particular, case does not matter.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * @exception IllegalArgumentException</span>
<span class="line-removed">-      * if the &lt;code&gt;name&lt;/code&gt; is not recognized or the</span>
<span class="line-removed">-      * &lt;code&gt;value&lt;/code&gt; has the wrong type.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public PKCS9Attribute(String name, Object value)</span>
<span class="line-removed">-     throws IllegalArgumentException {</span>
<span class="line-removed">-         ObjectIdentifier oid = getOID(name);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         if (oid == null)</span>
<span class="line-removed">-             throw new IllegalArgumentException(</span>
<span class="line-removed">-                        &quot;Unrecognized attribute name &quot; + name +</span>
<span class="line-removed">-                        &quot; constructing PKCS9Attribute.&quot;);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         init(oid, value);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      private void init(ObjectIdentifier oid, Object value)
          throws IllegalArgumentException {
  
          this.oid = oid;
          index = indexOf(oid, PKCS9_OIDS, 1);
<span class="line-new-header">--- 351,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 764,29 ***</span>
  
      /**
       *  Return the name of this attribute.
       */
      public String getName() {
<span class="line-modified">!         return index == -1 ?</span>
<span class="line-modified">!                 oid.toString() :</span>
<span class="line-modified">!                 OID_NAME_TABLE.get(PKCS9_OIDS[index]);</span>
      }
  
      /**
       * Return the OID for a given attribute name or null if we don&#39;t recognize
       * the name.
       */
      public static ObjectIdentifier getOID(String name) {
<span class="line-modified">!         return NAME_OID_TABLE.get(name.toLowerCase(Locale.ENGLISH));</span>
      }
  
      /**
       * Return the attribute name for a given OID or null if we don&#39;t recognize
       * the oid.
       */
      public static String getName(ObjectIdentifier oid) {
<span class="line-modified">!         return OID_NAME_TABLE.get(oid);</span>
      }
  
      /**
       * Returns a string representation of this attribute.
       */
<span class="line-new-header">--- 662,34 ---</span>
  
      /**
       *  Return the name of this attribute.
       */
      public String getName() {
<span class="line-modified">!         String n = oid.toString();</span>
<span class="line-modified">!         KnownOIDs os = KnownOIDs.findMatch(n);</span>
<span class="line-modified">!         return (os == null? n : os.stdName());</span>
      }
  
      /**
       * Return the OID for a given attribute name or null if we don&#39;t recognize
       * the name.
       */
      public static ObjectIdentifier getOID(String name) {
<span class="line-modified">!         KnownOIDs o = KnownOIDs.findMatch(name);</span>
<span class="line-added">+         if (o != null) {</span>
<span class="line-added">+             return ObjectIdentifier.of(o);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             return null;</span>
<span class="line-added">+         }</span>
      }
  
      /**
       * Return the attribute name for a given OID or null if we don&#39;t recognize
       * the oid.
       */
      public static String getName(ObjectIdentifier oid) {
<span class="line-modified">!         return KnownOIDs.findMatch(oid.toString()).stdName();</span>
      }
  
      /**
       * Returns a string representation of this attribute.
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 797,11 ***</span>
          sb.append(&quot;[&quot;);
  
          if (index == -1) {
              sb.append(oid.toString());
          } else {
<span class="line-modified">!             sb.append(OID_NAME_TABLE.get(PKCS9_OIDS[index]));</span>
          }
          sb.append(&quot;: &quot;);
  
          if (index == -1 || SINGLE_VALUED[index]) {
              if (value instanceof byte[]) { // special case for octet string
<span class="line-new-header">--- 700,11 ---</span>
          sb.append(&quot;[&quot;);
  
          if (index == -1) {
              sb.append(oid.toString());
          } else {
<span class="line-modified">!             sb.append(getName(oid));</span>
          }
          sb.append(&quot;: &quot;);
  
          if (index == -1 || SINGLE_VALUED[index]) {
              if (value instanceof byte[]) { // special case for octet string
</pre>
<center><a href="PKCS7.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../pkcs12/PKCS12KeyStore.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>