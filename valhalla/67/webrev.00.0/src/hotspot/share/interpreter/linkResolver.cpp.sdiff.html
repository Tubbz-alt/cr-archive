<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/interpreter/linkResolver.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../classfile/systemDictionary.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../memory/dynamicArchive.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/interpreter/linkResolver.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 647   if (code == Bytecodes::_invokeinterface) {
 648     return resolve_interface_method(link_info, code, THREAD);
 649   } else if (code == Bytecodes::_invokevirtual) {
 650     return resolve_method(link_info, code, THREAD);
 651   } else if (!resolved_klass-&gt;is_interface()) {
 652     return resolve_method(link_info, code, THREAD);
 653   } else {
 654     return resolve_interface_method(link_info, code, THREAD);
 655   }
 656 }
 657 
 658 // Check and print a loader constraint violation message for method or interface method
 659 void LinkResolver::check_method_loader_constraints(const LinkInfo&amp; link_info,
 660                                                    const methodHandle&amp; resolved_method,
 661                                                    const char* method_type, TRAPS) {
 662   Handle current_loader(THREAD, link_info.current_klass()-&gt;class_loader());
 663   Handle resolved_loader(THREAD, resolved_method-&gt;method_holder()-&gt;class_loader());
 664 
 665   ResourceMark rm(THREAD);
 666   Symbol* failed_type_symbol =
<span class="line-modified"> 667     SystemDictionary::check_signature_loaders(link_info.signature(), current_loader,</span>


 668                                               resolved_loader, true, CHECK);
 669   if (failed_type_symbol != NULL) {
 670     Klass* current_class = link_info.current_klass();
 671     ClassLoaderData* current_loader_data = current_class-&gt;class_loader_data();
 672     assert(current_loader_data != NULL, &quot;current class has no class loader data&quot;);
 673     Klass* resolved_method_class = resolved_method-&gt;method_holder();
 674     ClassLoaderData* target_loader_data = resolved_method_class-&gt;class_loader_data();
 675     assert(target_loader_data != NULL, &quot;resolved method&#39;s class has no class loader data&quot;);
 676 
 677     stringStream ss;
 678     ss.print(&quot;loader constraint violation: when resolving %s &#39;&quot;, method_type);
 679     Method::print_external_name(&amp;ss, link_info.resolved_klass(), link_info.name(), link_info.signature());
 680     ss.print(&quot;&#39; the class loader %s of the current class, %s,&quot;
 681              &quot; and the class loader %s for the method&#39;s defining class, %s, have&quot;
 682              &quot; different Class objects for the type %s used in the signature (%s; %s)&quot;,
 683              current_loader_data-&gt;loader_name_and_id(),
 684              current_class-&gt;name()-&gt;as_C_string(),
 685              target_loader_data-&gt;loader_name_and_id(),
 686              resolved_method_class-&gt;name()-&gt;as_C_string(),
 687              failed_type_symbol-&gt;as_C_string(),
 688              current_class-&gt;class_in_module_of_loader(false, true),
 689              resolved_method_class-&gt;class_in_module_of_loader(false, true));
 690     THROW_MSG(vmSymbols::java_lang_LinkageError(), ss.as_string());
 691   }
 692 }
 693 
 694 void LinkResolver::check_field_loader_constraints(Symbol* field, Symbol* sig,
 695                                                   Klass* current_klass,
 696                                                   Klass* sel_klass, TRAPS) {
 697   Handle ref_loader(THREAD, current_klass-&gt;class_loader());
 698   Handle sel_loader(THREAD, sel_klass-&gt;class_loader());
 699 
 700   ResourceMark rm(THREAD);  // needed for check_signature_loaders
 701   Symbol* failed_type_symbol =
 702     SystemDictionary::check_signature_loaders(sig,

 703                                               ref_loader, sel_loader,
 704                                               false,
 705                                               CHECK);
 706   if (failed_type_symbol != NULL) {
 707     stringStream ss;
 708     const char* failed_type_name = failed_type_symbol-&gt;as_klass_external_name();
 709 
 710     ss.print(&quot;loader constraint violation: when resolving field \&quot;%s\&quot; of type %s, &quot;
 711              &quot;the class loader %s of the current class, %s, &quot;
 712              &quot;and the class loader %s for the field&#39;s defining %s, %s, &quot;
 713              &quot;have different Class objects for type %s (%s; %s)&quot;,
 714              field-&gt;as_C_string(),
 715              failed_type_name,
 716              current_klass-&gt;class_loader_data()-&gt;loader_name_and_id(),
 717              current_klass-&gt;external_name(),
 718              sel_klass-&gt;class_loader_data()-&gt;loader_name_and_id(),
 719              sel_klass-&gt;external_kind(),
 720              sel_klass-&gt;external_name(),
 721              failed_type_name,
 722              current_klass-&gt;class_in_module_of_loader(false, true),
</pre>
</td>
<td>
<hr />
<pre>
 647   if (code == Bytecodes::_invokeinterface) {
 648     return resolve_interface_method(link_info, code, THREAD);
 649   } else if (code == Bytecodes::_invokevirtual) {
 650     return resolve_method(link_info, code, THREAD);
 651   } else if (!resolved_klass-&gt;is_interface()) {
 652     return resolve_method(link_info, code, THREAD);
 653   } else {
 654     return resolve_interface_method(link_info, code, THREAD);
 655   }
 656 }
 657 
 658 // Check and print a loader constraint violation message for method or interface method
 659 void LinkResolver::check_method_loader_constraints(const LinkInfo&amp; link_info,
 660                                                    const methodHandle&amp; resolved_method,
 661                                                    const char* method_type, TRAPS) {
 662   Handle current_loader(THREAD, link_info.current_klass()-&gt;class_loader());
 663   Handle resolved_loader(THREAD, resolved_method-&gt;method_holder()-&gt;class_loader());
 664 
 665   ResourceMark rm(THREAD);
 666   Symbol* failed_type_symbol =
<span class="line-modified"> 667     SystemDictionary::check_signature_loaders(link_info.signature(),</span>
<span class="line-added"> 668                                               /*klass_being_linked*/ NULL, // We are not linking class</span>
<span class="line-added"> 669                                               current_loader,</span>
 670                                               resolved_loader, true, CHECK);
 671   if (failed_type_symbol != NULL) {
 672     Klass* current_class = link_info.current_klass();
 673     ClassLoaderData* current_loader_data = current_class-&gt;class_loader_data();
 674     assert(current_loader_data != NULL, &quot;current class has no class loader data&quot;);
 675     Klass* resolved_method_class = resolved_method-&gt;method_holder();
 676     ClassLoaderData* target_loader_data = resolved_method_class-&gt;class_loader_data();
 677     assert(target_loader_data != NULL, &quot;resolved method&#39;s class has no class loader data&quot;);
 678 
 679     stringStream ss;
 680     ss.print(&quot;loader constraint violation: when resolving %s &#39;&quot;, method_type);
 681     Method::print_external_name(&amp;ss, link_info.resolved_klass(), link_info.name(), link_info.signature());
 682     ss.print(&quot;&#39; the class loader %s of the current class, %s,&quot;
 683              &quot; and the class loader %s for the method&#39;s defining class, %s, have&quot;
 684              &quot; different Class objects for the type %s used in the signature (%s; %s)&quot;,
 685              current_loader_data-&gt;loader_name_and_id(),
 686              current_class-&gt;name()-&gt;as_C_string(),
 687              target_loader_data-&gt;loader_name_and_id(),
 688              resolved_method_class-&gt;name()-&gt;as_C_string(),
 689              failed_type_symbol-&gt;as_C_string(),
 690              current_class-&gt;class_in_module_of_loader(false, true),
 691              resolved_method_class-&gt;class_in_module_of_loader(false, true));
 692     THROW_MSG(vmSymbols::java_lang_LinkageError(), ss.as_string());
 693   }
 694 }
 695 
 696 void LinkResolver::check_field_loader_constraints(Symbol* field, Symbol* sig,
 697                                                   Klass* current_klass,
 698                                                   Klass* sel_klass, TRAPS) {
 699   Handle ref_loader(THREAD, current_klass-&gt;class_loader());
 700   Handle sel_loader(THREAD, sel_klass-&gt;class_loader());
 701 
 702   ResourceMark rm(THREAD);  // needed for check_signature_loaders
 703   Symbol* failed_type_symbol =
 704     SystemDictionary::check_signature_loaders(sig,
<span class="line-added"> 705                                               /*klass_being_linked*/ NULL, // We are not linking class</span>
 706                                               ref_loader, sel_loader,
 707                                               false,
 708                                               CHECK);
 709   if (failed_type_symbol != NULL) {
 710     stringStream ss;
 711     const char* failed_type_name = failed_type_symbol-&gt;as_klass_external_name();
 712 
 713     ss.print(&quot;loader constraint violation: when resolving field \&quot;%s\&quot; of type %s, &quot;
 714              &quot;the class loader %s of the current class, %s, &quot;
 715              &quot;and the class loader %s for the field&#39;s defining %s, %s, &quot;
 716              &quot;have different Class objects for type %s (%s; %s)&quot;,
 717              field-&gt;as_C_string(),
 718              failed_type_name,
 719              current_klass-&gt;class_loader_data()-&gt;loader_name_and_id(),
 720              current_klass-&gt;external_name(),
 721              sel_klass-&gt;class_loader_data()-&gt;loader_name_and_id(),
 722              sel_klass-&gt;external_kind(),
 723              sel_klass-&gt;external_name(),
 724              failed_type_name,
 725              current_klass-&gt;class_in_module_of_loader(false, true),
</pre>
</td>
</tr>
</table>
<center><a href="../classfile/systemDictionary.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="../memory/dynamicArchive.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>