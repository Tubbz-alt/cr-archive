<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/hotspot/share/runtime/safepoint.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="handles.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="synchronizer.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/runtime/safepoint.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 483 
 484   disarm_safepoint();
 485 
 486   Universe::heap()-&gt;safepoint_synchronize_end();
 487 
 488   SafepointTracing::end();
 489 
 490   post_safepoint_end_event(event, safepoint_id());
 491 }
 492 
 493 bool SafepointSynchronize::is_cleanup_needed() {
 494   // Need a safepoint if there are many monitors to deflate.
 495   if (ObjectSynchronizer::is_cleanup_needed()) return true;
 496   // Need a safepoint if some inline cache buffers is non-empty
 497   if (!InlineCacheBuffer::is_empty()) return true;
 498   if (StringTable::needs_rehashing()) return true;
 499   if (SymbolTable::needs_rehashing()) return true;
 500   return false;
 501 }
 502 
<span class="line-removed"> 503 bool SafepointSynchronize::is_forced_cleanup_needed() {</span>
<span class="line-removed"> 504   return ObjectSynchronizer::needs_monitor_scavenge();</span>
<span class="line-removed"> 505 }</span>
<span class="line-removed"> 506 </span>
 507 class ParallelSPCleanupThreadClosure : public ThreadClosure {
 508 private:
 509   CodeBlobClosure* _nmethod_cl;
 510   DeflateMonitorCounters* _counters;
 511 
 512 public:
 513   ParallelSPCleanupThreadClosure(DeflateMonitorCounters* counters) :
 514     _nmethod_cl(UseCodeAging ? NMethodSweeper::prepare_reset_hotness_counters() : NULL),
 515     _counters(counters) {}
 516 
 517   void do_thread(Thread* thread) {
 518     ObjectSynchronizer::deflate_thread_local_monitors(thread, _counters);
 519     if (_nmethod_cl != NULL &amp;&amp; thread-&gt;is_Java_thread() &amp;&amp;
 520         ! thread-&gt;is_Code_cache_sweeper_thread()) {
 521       JavaThread* jt = (JavaThread*) thread;
 522       jt-&gt;nmethods_do(_nmethod_cl);
 523     }
 524   }
 525 };
 526 
</pre>
</td>
<td>
<hr />
<pre>
 483 
 484   disarm_safepoint();
 485 
 486   Universe::heap()-&gt;safepoint_synchronize_end();
 487 
 488   SafepointTracing::end();
 489 
 490   post_safepoint_end_event(event, safepoint_id());
 491 }
 492 
 493 bool SafepointSynchronize::is_cleanup_needed() {
 494   // Need a safepoint if there are many monitors to deflate.
 495   if (ObjectSynchronizer::is_cleanup_needed()) return true;
 496   // Need a safepoint if some inline cache buffers is non-empty
 497   if (!InlineCacheBuffer::is_empty()) return true;
 498   if (StringTable::needs_rehashing()) return true;
 499   if (SymbolTable::needs_rehashing()) return true;
 500   return false;
 501 }
 502 




 503 class ParallelSPCleanupThreadClosure : public ThreadClosure {
 504 private:
 505   CodeBlobClosure* _nmethod_cl;
 506   DeflateMonitorCounters* _counters;
 507 
 508 public:
 509   ParallelSPCleanupThreadClosure(DeflateMonitorCounters* counters) :
 510     _nmethod_cl(UseCodeAging ? NMethodSweeper::prepare_reset_hotness_counters() : NULL),
 511     _counters(counters) {}
 512 
 513   void do_thread(Thread* thread) {
 514     ObjectSynchronizer::deflate_thread_local_monitors(thread, _counters);
 515     if (_nmethod_cl != NULL &amp;&amp; thread-&gt;is_Java_thread() &amp;&amp;
 516         ! thread-&gt;is_Code_cache_sweeper_thread()) {
 517       JavaThread* jt = (JavaThread*) thread;
 518       jt-&gt;nmethods_do(_nmethod_cl);
 519     }
 520   }
 521 };
 522 
</pre>
</td>
</tr>
</table>
<center><a href="handles.hpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="synchronizer.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>