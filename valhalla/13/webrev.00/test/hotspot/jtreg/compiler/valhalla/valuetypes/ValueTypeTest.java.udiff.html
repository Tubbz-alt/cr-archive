<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/compiler/valhalla/valuetypes/ValueTypeTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="TestNullableArrays.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>test/hotspot/jtreg/compiler/valhalla/valuetypes/ValueTypeTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -140,10 +140,11 @@</span>
      private static final int WARMUP = Integer.parseInt(System.getProperty(&quot;Warmup&quot;, &quot;251&quot;));
      private static final boolean DUMP_REPLAY = Boolean.parseBoolean(System.getProperty(&quot;DumpReplay&quot;, &quot;false&quot;));
      private static final boolean FLIP_C1_C2 = Boolean.parseBoolean(System.getProperty(&quot;FlipC1C2&quot;, &quot;false&quot;));
      private static final boolean GC_AFTER = Boolean.parseBoolean(System.getProperty(&quot;GCAfter&quot;, &quot;false&quot;));
      private static final int OSR_TEST_TIMEOUT = Integer.parseInt(System.getProperty(&quot;OSRTestTimeOut&quot;, &quot;5000&quot;));
<span class="udiff-line-added">+     protected static final boolean STRESS_CC = Boolean.parseBoolean(System.getProperty(&quot;StressCC&quot;, &quot;false&quot;));</span>
  
      // &quot;jtreg -DXcomp=true&quot; runs all the scenarios with -Xcomp. This is faster than &quot;jtreg -javaoptions:-Xcomp&quot;.
      protected static final boolean RUN_SCENARIOS_WITH_XCOMP = Boolean.parseBoolean(System.getProperty(&quot;Xcomp&quot;, &quot;false&quot;));
  
      // Pre-defined settings
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -623,10 +624,17 @@</span>
              }
              if (m.isAnnotationPresent(DontInline.class)) {
                  Asserts.assertFalse(m.isAnnotationPresent(ForceInline.class), &quot;Method &quot; + m.getName() + &quot; has contradicting ForceInline annotation&quot;);
                  WHITE_BOX.testSetDontInlineMethod(m, true);
              }
<span class="udiff-line-added">+             if (STRESS_CC) {</span>
<span class="udiff-line-added">+                 // Exclude some methods from compilation with C2 to stress test the calling convention</span>
<span class="udiff-line-added">+                 if (Utils.getRandomInstance().nextBoolean()) {</span>
<span class="udiff-line-added">+                     System.out.println(&quot;Excluding from C2 compilation: &quot; + m);</span>
<span class="udiff-line-added">+                     WHITE_BOX.makeMethodNotCompilable(m, COMP_LEVEL_FULL_OPTIMIZATION, false);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             }</span>
          }
          // Only force compilation now because above annotations affect inlining
          for (Method m : methods) {
              if (m.isAnnotationPresent(ForceCompile.class)) {
                  Asserts.assertFalse(m.isAnnotationPresent(DontCompile.class), &quot;Method &quot; + m.getName() + &quot; has contradicting DontCompile annotation&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -638,11 +646,11 @@</span>
          int compLevel = getCompLevel(null);
          WHITE_BOX.enqueueInitializerForCompilation(clazz, compLevel);
      }
  
      private void run(Class&lt;?&gt;... classes) throws Exception {
<span class="udiff-line-modified-removed">-         if (USE_COMPILER &amp;&amp; PRINT_IDEAL &amp;&amp; !XCOMP) {</span>
<span class="udiff-line-modified-added">+         if (USE_COMPILER &amp;&amp; PRINT_IDEAL &amp;&amp; !XCOMP &amp;&amp; !STRESS_CC) {</span>
              System.out.println(&quot;PrintIdeal enabled&quot;);
          }
          System.out.format(&quot;rI = %d, rL = %d\n&quot;, rI, rL);
  
          setup(getClass());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -699,19 +707,17 @@</span>
  
                      boolean b = WHITE_BOX.isMethodCompiled(test, false);
                      if (VERBOSE) {
                          System.out.println(&quot;Is &quot; + test.getName() + &quot; compiled? &quot; + b);
                      }
<span class="udiff-line-modified-removed">-                     if (b || XCOMP || !USE_COMPILER) {</span>
<span class="udiff-line-modified-added">+                     if (b || XCOMP || STRESS_CC || !USE_COMPILER) {</span>
                          // Don&#39;t control compilation if -Xcomp is enabled, or if compiler is disabled
                          break;
                      }
                      Asserts.assertTrue(OSR_TEST_TIMEOUT &lt; 0 || elapsed &lt; OSR_TEST_TIMEOUT, test + &quot; not compiled after &quot; + OSR_TEST_TIMEOUT + &quot; ms&quot;);
                  }
<span class="udiff-line-modified-removed">-                 if (!XCOMP) {</span>
<span class="udiff-line-removed">-                     Asserts.assertTrue(!USE_COMPILER || WHITE_BOX.isMethodCompiled(test, false), test + &quot; not compiled&quot;);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-modified-added">+                 Asserts.assertTrue(XCOMP || STRESS_CC || !USE_COMPILER || WHITE_BOX.isMethodCompiled(test, false), test + &quot; not compiled&quot;);</span>
              } else {
                  int compLevel = getCompLevel(test.getAnnotation(Test.class));
                  // Trigger compilation
                  enqueueMethodForCompilation(test, compLevel);
                  if (maybeCodeBufferOverflow &amp;&amp; !WHITE_BOX.isMethodCompiled(test, false)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -719,11 +725,11 @@</span>
                      WHITE_BOX.setBooleanVMFlag(&quot;VerifyOops&quot;, false);
                      WHITE_BOX.clearMethodState(test);
                      enqueueMethodForCompilation(test, compLevel);
                      WHITE_BOX.setBooleanVMFlag(&quot;VerifyOops&quot;, true);
                  }
<span class="udiff-line-modified-removed">-                 Asserts.assertTrue(!USE_COMPILER || WHITE_BOX.isMethodCompiled(test, false), test + &quot; not compiled&quot;);</span>
<span class="udiff-line-modified-added">+                 Asserts.assertTrue(STRESS_CC || !USE_COMPILER || WHITE_BOX.isMethodCompiled(test, false), test + &quot; not compiled&quot;);</span>
                  // Check result
                  verifier.invoke(this, false);
              }
              if (PRINT_TIMES || VERBOSE) {
                  long endTime = System.nanoTime();
</pre>
<center><a href="TestNullableArrays.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>