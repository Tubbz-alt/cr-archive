<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/hotspot/share/opto/compile.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../oops/valueArrayKlass.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>src/hotspot/share/opto/compile.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -3385,52 +3385,10 @@</span>
        // Check to see if address types have grounded out somehow.
        const TypeInstPtr *tp = mem-&gt;in(MemNode::Address)-&gt;bottom_type()-&gt;isa_instptr();
        assert( !tp || oop_offset_is_sane(tp), &quot;&quot; );
      }
  #endif
<span class="udiff-line-removed">-     // TODO remove clear_prop_bits bits stuff once the runtime does not set it anymore</span>
<span class="udiff-line-removed">-     if (EnableValhalla &amp;&amp;</span>
<span class="udiff-line-removed">-         ((nop == Op_LoadKlass &amp;&amp; ((LoadKlassNode*)n)-&gt;clear_prop_bits()) ||</span>
<span class="udiff-line-removed">-          (nop == Op_LoadNKlass &amp;&amp; ((LoadNKlassNode*)n)-&gt;clear_prop_bits()))) {</span>
<span class="udiff-line-removed">-       const TypeKlassPtr* tk = n-&gt;bottom_type()-&gt;make_ptr()-&gt;is_klassptr();</span>
<span class="udiff-line-removed">-       assert(!tk-&gt;klass_is_exact(), &quot;should have been folded&quot;);</span>
<span class="udiff-line-removed">-       assert(n-&gt;as_Mem()-&gt;adr_type()-&gt;offset() == oopDesc::klass_offset_in_bytes(), &quot;unexpected LoadKlass&quot;);</span>
<span class="udiff-line-removed">-       if (tk-&gt;klass()-&gt;can_be_value_array_klass()) {</span>
<span class="udiff-line-removed">-         // Array load klass needs to filter out property bits</span>
<span class="udiff-line-removed">-         uint last = unique();</span>
<span class="udiff-line-removed">-         Node* pointer = NULL;</span>
<span class="udiff-line-removed">-         if (nop == Op_LoadKlass) {</span>
<span class="udiff-line-removed">-           Node* cast = new CastP2XNode(NULL, n);</span>
<span class="udiff-line-removed">-           Node* masked = new LShiftXNode(cast, new ConINode(TypeInt::make(oopDesc::storage_props_nof_bits)));</span>
<span class="udiff-line-removed">-           masked = new RShiftXNode(masked, new ConINode(TypeInt::make(oopDesc::storage_props_nof_bits)));</span>
<span class="udiff-line-removed">-           pointer = new CastX2PNode(masked);</span>
<span class="udiff-line-removed">-           pointer = new CheckCastPPNode(NULL, pointer, n-&gt;bottom_type());</span>
<span class="udiff-line-removed">-         } else {</span>
<span class="udiff-line-removed">-           Node* cast = new CastN2INode(n);</span>
<span class="udiff-line-removed">-           Node* masked = new AndINode(cast, new ConINode(TypeInt::make(oopDesc::compressed_klass_mask())));</span>
<span class="udiff-line-removed">-           pointer = new CastI2NNode(masked, n-&gt;bottom_type());</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         for (DUIterator_Fast imax, i = n-&gt;fast_outs(imax); i &lt; imax; i++) {</span>
<span class="udiff-line-removed">-           Node* u = n-&gt;fast_out(i);</span>
<span class="udiff-line-removed">-           if (u-&gt;_idx &lt; last) {</span>
<span class="udiff-line-removed">-             // If user is a comparison with a klass that can&#39;t be a value type</span>
<span class="udiff-line-removed">-             // array klass, we don&#39;t need to clear the storage property bits.</span>
<span class="udiff-line-removed">-             Node* cmp = (u-&gt;is_DecodeNKlass() &amp;&amp; u-&gt;outcnt() == 1) ? u-&gt;unique_out() : u;</span>
<span class="udiff-line-removed">-             if (cmp-&gt;is_Cmp()) {</span>
<span class="udiff-line-removed">-               const TypeKlassPtr* kp1 = cmp-&gt;in(1)-&gt;bottom_type()-&gt;make_ptr()-&gt;isa_klassptr();</span>
<span class="udiff-line-removed">-               const TypeKlassPtr* kp2 = cmp-&gt;in(2)-&gt;bottom_type()-&gt;make_ptr()-&gt;isa_klassptr();</span>
<span class="udiff-line-removed">-               if ((kp1 != NULL &amp;&amp; !kp1-&gt;klass()-&gt;can_be_value_array_klass()) ||</span>
<span class="udiff-line-removed">-                   (kp2 != NULL &amp;&amp; !kp2-&gt;klass()-&gt;can_be_value_array_klass())) {</span>
<span class="udiff-line-removed">-                 continue;</span>
<span class="udiff-line-removed">-               }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             int nb = u-&gt;replace_edge(n, pointer);</span>
<span class="udiff-line-removed">-             --i, imax -= nb;</span>
<span class="udiff-line-removed">-           }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-       }</span>
<span class="udiff-line-removed">-     }</span>
      break;
    }
  
    case Op_AddP: {               // Assert sane base pointers
      Node *addp = n-&gt;in(AddPNode::Address);
</pre>
<center><a href="../oops/valueArrayKlass.hpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>