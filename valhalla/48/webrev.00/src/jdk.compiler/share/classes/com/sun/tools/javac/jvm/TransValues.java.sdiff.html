<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.compiler/share/classes/com/sun/tools/javac/jvm/TransValues.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../comp/LambdaToMethod.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../test/jdk/valhalla/valuetypes/StreamTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.compiler/share/classes/com/sun/tools/javac/jvm/TransValues.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
324                 Symbol symbol = fieldAccess.sym;
325                 if (isInstanceMemberAccess(symbol)) {
326                     final JCIdent facHandle = make.Ident(currentMethod.factoryProduct);
327                     result = make.Select(facHandle, symbol);
328                     return;
329                 }
330             }
331         }
332         // Rewrite any accesses of the form V.ref.member to ((V) V.ref).member
333         fieldAccess.selected = translate(fieldAccess.selected);
334         if (fieldAccess.name != names._class &amp;&amp; fieldAccess.name != names._default) {  // TODO: this and super ??
335             Symbol sym = TreeInfo.symbol(fieldAccess);
336             TypeSymbol selectedType = fieldAccess.selected.type.tsym;
337             if (selectedType.isReferenceProjection()) {
338                 switch (sym.kind) {
339                     case MTH:
340                     case VAR:
341                         fieldAccess.selected =
342                                 make.TypeCast(types.erasure(selectedType.valueProjection().type), fieldAccess.selected);
343                         if (sym.owner.isReferenceProjection()) // is an empty class file.
<span class="line-modified">344                             sym = sym.valueProjection();</span>
345                         break;
346                     case TYP:
347                         fieldAccess.selected = make.Type(types.erasure(selectedType.valueProjection().type));
348                         break;
349                 }
350             }
351         }
352         result = fieldAccess;
353     }
354 
355     // Translate a reference style instance creation attempt on a value type to a static factory call.
356     @Override
357     public void visitNewClass(JCNewClass tree) {
358         if (types.isValue(tree.clazz.type)) {
359             // Enclosing instances or anonymous classes should have been eliminated by now.
360             Assert.check(tree.encl == null &amp;&amp; tree.def == null);
361             tree.args = translate(tree.args);
362             Assert.check(tree.def == null);
363             MethodSymbol sFactory = getValueFactory((MethodSymbol) tree.constructor);
364             make.at(tree.pos());
</pre>
</td>
<td>
<hr />
<pre>
324                 Symbol symbol = fieldAccess.sym;
325                 if (isInstanceMemberAccess(symbol)) {
326                     final JCIdent facHandle = make.Ident(currentMethod.factoryProduct);
327                     result = make.Select(facHandle, symbol);
328                     return;
329                 }
330             }
331         }
332         // Rewrite any accesses of the form V.ref.member to ((V) V.ref).member
333         fieldAccess.selected = translate(fieldAccess.selected);
334         if (fieldAccess.name != names._class &amp;&amp; fieldAccess.name != names._default) {  // TODO: this and super ??
335             Symbol sym = TreeInfo.symbol(fieldAccess);
336             TypeSymbol selectedType = fieldAccess.selected.type.tsym;
337             if (selectedType.isReferenceProjection()) {
338                 switch (sym.kind) {
339                     case MTH:
340                     case VAR:
341                         fieldAccess.selected =
342                                 make.TypeCast(types.erasure(selectedType.valueProjection().type), fieldAccess.selected);
343                         if (sym.owner.isReferenceProjection()) // is an empty class file.
<span class="line-modified">344                             TreeInfo.setSymbol(fieldAccess, sym.valueProjection());</span>
345                         break;
346                     case TYP:
347                         fieldAccess.selected = make.Type(types.erasure(selectedType.valueProjection().type));
348                         break;
349                 }
350             }
351         }
352         result = fieldAccess;
353     }
354 
355     // Translate a reference style instance creation attempt on a value type to a static factory call.
356     @Override
357     public void visitNewClass(JCNewClass tree) {
358         if (types.isValue(tree.clazz.type)) {
359             // Enclosing instances or anonymous classes should have been eliminated by now.
360             Assert.check(tree.encl == null &amp;&amp; tree.def == null);
361             tree.args = translate(tree.args);
362             Assert.check(tree.def == null);
363             MethodSymbol sFactory = getValueFactory((MethodSymbol) tree.constructor);
364             make.at(tree.pos());
</pre>
</td>
</tr>
</table>
<center><a href="../comp/LambdaToMethod.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../test/jdk/valhalla/valuetypes/StreamTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>