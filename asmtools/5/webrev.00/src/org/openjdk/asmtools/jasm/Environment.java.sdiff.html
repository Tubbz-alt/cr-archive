<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/org/openjdk/asmtools/jasm/Environment.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../build/build.xml.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Parser.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/org/openjdk/asmtools/jasm/Environment.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 package org.openjdk.asmtools.jasm;
 24 
 25 import static org.openjdk.asmtools.jasm.Constants.EOF;
 26 import static org.openjdk.asmtools.jasm.Constants.OFFSETBITS;
 27 import org.openjdk.asmtools.util.I18NResourceBundle;
 28 
 29 import java.io.*;

 30 import java.text.MessageFormat;
 31 
 32 /**
 33  * An input stream for java programs. The stream treats either &quot;\n&quot;, &quot;\r&quot; or &quot;\r\n&quot; as the
 34  * end of a line, it always returns \n. It also parses UNICODE characters expressed as
 35  * \uffff. However, if it sees &quot;\\&quot;, the second slash cannot begin a unicode sequence. It
 36  * keeps track of the current position in the input stream.
 37  *
 38  * An position consists of: ((linenr &amp;lt;&amp;lt; OFFSETBITS) | offset) this means that both
 39  * the line number and the exact offset into the file are encoded in each position
 40  * value.&lt;p&gt;
 41  */
 42 public class Environment {
 43 
 44     /*-------------------------------------------------------- */
 45     /* Environment Inner Classes */
 46     /**
 47      * A sorted list of error messages
 48      */
 49     final class ErrorMessage {
</pre>
<hr />
<pre>
 77     /*-------------------------------------------------------- */
 78 
 79     public Environment(DataInputStream dis, String inputFileName, PrintWriter out, boolean nowarn) throws IOException {
 80         this.out = out;
 81         this.inputFileName = inputFileName;
 82         this.nowarn = nowarn;
 83         // Read the file
 84         data = new byte[dis.available()];
 85         dis.read(data);
 86         dis.close();
 87         bytepos = 0;
 88         linepos = 1;
 89     }
 90 
 91     public String getInputFileName() {
 92         return inputFileName;
 93     }
 94 
 95     public String getSimpleInputFileName() {
 96         if( simpleInputFileName == null ) {
<span class="line-modified"> 97             char separatorChar = (inputFileName.matches(&quot;^[A-Za-z]+:.*&quot;)) ? &#39;/&#39; : File.separatorChar;</span>
<span class="line-removed"> 98             int index = inputFileName.lastIndexOf(separatorChar);</span>
<span class="line-removed"> 99             simpleInputFileName = (index &lt; 0) ? inputFileName.substring(0) : inputFileName.substring(index + 1);</span>
100         }
101         return simpleInputFileName;
102     }
103 
104     int lookForward() {
105         try {
106             return data[bytepos];
107         } catch (ArrayIndexOutOfBoundsException e) {
108             return EOF;
109         }
110     }
111 
112     int convertUnicode() {
113         int c;
114         try {
115             while ((c = data[bytepos]) == &#39;u&#39;) {
116                 bytepos++;
117             }
118             int d = 0;
119             for (int i = 0; i &lt; 4; i++) {
</pre>
</td>
<td>
<hr />
<pre>
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 package org.openjdk.asmtools.jasm;
 24 
 25 import static org.openjdk.asmtools.jasm.Constants.EOF;
 26 import static org.openjdk.asmtools.jasm.Constants.OFFSETBITS;
 27 import org.openjdk.asmtools.util.I18NResourceBundle;
 28 
 29 import java.io.*;
<span class="line-added"> 30 import java.nio.file.Paths;</span>
 31 import java.text.MessageFormat;
 32 
 33 /**
 34  * An input stream for java programs. The stream treats either &quot;\n&quot;, &quot;\r&quot; or &quot;\r\n&quot; as the
 35  * end of a line, it always returns \n. It also parses UNICODE characters expressed as
 36  * \uffff. However, if it sees &quot;\\&quot;, the second slash cannot begin a unicode sequence. It
 37  * keeps track of the current position in the input stream.
 38  *
 39  * An position consists of: ((linenr &amp;lt;&amp;lt; OFFSETBITS) | offset) this means that both
 40  * the line number and the exact offset into the file are encoded in each position
 41  * value.&lt;p&gt;
 42  */
 43 public class Environment {
 44 
 45     /*-------------------------------------------------------- */
 46     /* Environment Inner Classes */
 47     /**
 48      * A sorted list of error messages
 49      */
 50     final class ErrorMessage {
</pre>
<hr />
<pre>
 78     /*-------------------------------------------------------- */
 79 
 80     public Environment(DataInputStream dis, String inputFileName, PrintWriter out, boolean nowarn) throws IOException {
 81         this.out = out;
 82         this.inputFileName = inputFileName;
 83         this.nowarn = nowarn;
 84         // Read the file
 85         data = new byte[dis.available()];
 86         dis.read(data);
 87         dis.close();
 88         bytepos = 0;
 89         linepos = 1;
 90     }
 91 
 92     public String getInputFileName() {
 93         return inputFileName;
 94     }
 95 
 96     public String getSimpleInputFileName() {
 97         if( simpleInputFileName == null ) {
<span class="line-modified"> 98             simpleInputFileName = Paths.get(inputFileName).getFileName().toString();</span>


 99         }
100         return simpleInputFileName;
101     }
102 
103     int lookForward() {
104         try {
105             return data[bytepos];
106         } catch (ArrayIndexOutOfBoundsException e) {
107             return EOF;
108         }
109     }
110 
111     int convertUnicode() {
112         int c;
113         try {
114             while ((c = data[bytepos]) == &#39;u&#39;) {
115                 bytepos++;
116             }
117             int d = 0;
118             for (int i = 0; i &lt; 4; i++) {
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../build/build.xml.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Parser.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>