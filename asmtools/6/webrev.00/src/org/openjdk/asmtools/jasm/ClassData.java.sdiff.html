<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/org/openjdk/asmtools/jasm/ClassData.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="ClassArrayAttr.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Environment.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/org/openjdk/asmtools/jasm/ClassData.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 38 class ClassData extends MemberData {
 39 
 40     /* ClassData Fields */
 41     CFVersion cfv;
 42     ConstantPool.ConstCell me, father;
 43     String myClassName;
 44     AttrData sourceFileNameAttr;
 45     ArrayList&lt;Argument&gt; interfaces;
 46     ArrayList&lt;FieldData&gt; fields = new ArrayList&lt;&gt;();
 47     ArrayList&lt;MethodData&gt; methods = new ArrayList&lt;&gt;();
 48     DataVectorAttr&lt;InnerClassData&gt; innerClasses = null;
 49     DataVectorAttr&lt;BootstrapMethodData&gt; bootstrapMethodsAttr = null;
 50 
 51     // JEP 181 - NestHost, NestMembers attributes since class version 55.0
 52     CPXAttr nestHostAttr;
 53     NestMembersAttr nestMembersAttr;
 54 
 55     // JEP 359 - Record attribute since class file 58.65535
 56     private RecordData recordData;
 57 
<span class="line-modified"> 58     // JEP 360 - PermittedSubtypes attribute since class file 59.65535</span>
<span class="line-modified"> 59     private PermittedTypesAttr permittedTypesAttr;</span>
 60 
 61     ModuleAttr moduleAttribute = null;
 62     Environment env;
 63     protected ConstantPool pool;
 64 
 65     private static final String DEFAULT_EXTENSION = &quot;.class&quot;;
 66     String fileExtension = DEFAULT_EXTENSION;
 67     public CDOutputStream cdos;
 68 
 69     /**
 70      * Initializes the ClassData.
 71      *
 72      * @param me The constant pool reference to this class
 73      * @param father The constant pool reference to the super class
 74      * @param interfaces A list of interfaces that this class implements
 75      */
 76     public final void init(int access, ConstantPool.ConstCell me, ConstantPool.ConstCell father, ArrayList&lt;Argument&gt; interfaces) {
 77         this.access = access;
 78 
 79         // normalize the modifiers to access flags
</pre>
<hr />
<pre>
294     }
295 
296     public void addBootstrapMethod(BootstrapMethodData bsmData) {
297         env.traceln(&quot;addBootstrapMethod&quot;);
298         if (bootstrapMethodsAttr == null) {
299             bootstrapMethodsAttr = new DataVectorAttr&lt;&gt;(this, AttrTag.ATT_BootstrapMethods.parsekey());
300         }
301         bootstrapMethodsAttr.add(bsmData);
302     }
303 
304     public void addNestHost(ConstantPool.ConstCell hostClass) {
305         env.traceln(&quot;addNestHost&quot;);
306         nestHostAttr = new CPXAttr(this, AttrTag.ATT_NestHost.parsekey(), hostClass);
307     }
308 
309     public void addNestMembers(List&lt;ConstantPool.ConstCell&gt; classes) {
310         env.traceln(&quot;addNestMembers&quot;);
311         nestMembersAttr = new NestMembersAttr(this, classes);
312     }
313 
<span class="line-modified">314     public void addPermittedSubtypes(List&lt;ConstantPool.ConstCell&gt; classes) {</span>
<span class="line-modified">315         env.traceln(&quot;addPermittedSubtypes&quot;);</span>
<span class="line-modified">316         permittedTypesAttr = new PermittedTypesAttr(this, classes);</span>
317     }
318 
319 
320     public void endClass() {
321         sourceFileNameAttr = new CPXAttr(this,
322                 AttrTag.ATT_SourceFile.parsekey(),
323                 pool.FindCellAsciz(env.getSimpleInputFileName()));
324         pool.NumberizePool();
325         pool.CheckGlobals();
326         numberBootstrapMethods();
327         try {
328             me = pool.uncheckedGetCell(me.arg);
329             env.traceln(&quot;me=&quot; + me);
330             ConstantPool.ConstValue_Cell me_value = (ConstantPool.ConstValue_Cell) me.ref;
331             ConstantPool.ConstCell ascicell = me_value.cell;
332             env.traceln(&quot;ascicell=&quot; + ascicell);
333             ConstantPool.ConstValue_String me_str = (ConstantPool.ConstValue_String) ascicell.ref;
334             myClassName = me_str.value;
335             env.traceln(&quot;-------------------&quot;);
336             env.traceln(&quot;-- Constant Pool --&quot;);
</pre>
<hr />
<pre>
442             if (syntheticAttr != null)
443                 attrs.add(syntheticAttr);
444             if (deprecatedAttr != null)
445                 attrs.add(deprecatedAttr);
446             if (annotAttrVis != null)
447                 attrs.add(annotAttrVis);
448             if (annotAttrInv != null)
449                 attrs.add(annotAttrInv);
450             if (type_annotAttrVis != null)
451                 attrs.add(type_annotAttrVis);
452             if (type_annotAttrInv != null)
453                 attrs.add(type_annotAttrInv);
454             if (bootstrapMethodsAttr != null)
455                 attrs.add(bootstrapMethodsAttr);
456             // since class version 55.0
457             if(nestHostAttributeExists())
458                 attrs.add(nestHostAttr);
459             if(nestMembersAttributesExist())
460                 attrs.add(nestMembersAttr);
461             // since class version 59.65535 (JEP 360)
<span class="line-modified">462             if ( permittedSubtypesAttributesExist() )</span>
<span class="line-modified">463                 attrs.add(permittedTypesAttr);</span>
464         }
465         return attrs;
466     }
467 
468     static char fileSeparator; //=System.getProperty(&quot;file.separator&quot;);
469 
470     /**
471      * Writes to the directory passed with -d option
472      */
473     public void write(File destdir) throws IOException {
474         File outfile;
475         if (destdir == null) {
476             int startofname = myClassName.lastIndexOf(&quot;/&quot;);
477             if (startofname != -1) {
478                 myClassName = myClassName.substring(startofname + 1);
479             }
480             outfile = new File(myClassName + fileExtension);
481         } else {
482             env.traceln(&quot;writing -d &quot; + destdir.getPath());
483             if (fileSeparator == 0) {
</pre>
<hr />
<pre>
498                 new BufferedOutputStream(new FileOutputStream(outfile)));
499         cdos.setDataOutputStream(dos);
500         try {
501             write(cdos);
502         } finally {
503             dos.close();
504         }
505     }  // end write()
506 
507     public void setByteLimit(int bytelimit) {
508         cdos.enable();
509         cdos.setLimit(bytelimit);
510     }
511 
512     public boolean nestHostAttributeExists() {
513         return nestHostAttr != null;
514     }
515 
516     public boolean nestMembersAttributesExist() { return nestMembersAttr != null;  }
517 
<span class="line-modified">518     public boolean permittedSubtypesAttributesExist() { return permittedTypesAttr != null;  }</span>
519 
520     public boolean recordAttributeExists() { return recordData != null;  }
521 
522     /**
523      * This is a wrapper for DataOutputStream, used for debugging purposes. it allows
524      * writing the byte-stream of a class up to a given byte number.
525      */
526     static private class CDOutputStream implements CheckedDataOutputStream {
527 
528         private int bytelimit;
529         private DataOutputStream dos;
530         public boolean enabled = false;
531 
532         public CDOutputStream() {
533             dos = null;
534         }
535 
536         public CDOutputStream(OutputStream out) {
537             setOutputStream(out);
538         }
</pre>
</td>
<td>
<hr />
<pre>
 38 class ClassData extends MemberData {
 39 
 40     /* ClassData Fields */
 41     CFVersion cfv;
 42     ConstantPool.ConstCell me, father;
 43     String myClassName;
 44     AttrData sourceFileNameAttr;
 45     ArrayList&lt;Argument&gt; interfaces;
 46     ArrayList&lt;FieldData&gt; fields = new ArrayList&lt;&gt;();
 47     ArrayList&lt;MethodData&gt; methods = new ArrayList&lt;&gt;();
 48     DataVectorAttr&lt;InnerClassData&gt; innerClasses = null;
 49     DataVectorAttr&lt;BootstrapMethodData&gt; bootstrapMethodsAttr = null;
 50 
 51     // JEP 181 - NestHost, NestMembers attributes since class version 55.0
 52     CPXAttr nestHostAttr;
 53     NestMembersAttr nestMembersAttr;
 54 
 55     // JEP 359 - Record attribute since class file 58.65535
 56     private RecordData recordData;
 57 
<span class="line-modified"> 58     // JEP 360 - PermittedSubclasses attribute since class file 59.65535</span>
<span class="line-modified"> 59     private PermittedSubclassesAttr permittedSubclassesAttr;</span>
 60 
 61     ModuleAttr moduleAttribute = null;
 62     Environment env;
 63     protected ConstantPool pool;
 64 
 65     private static final String DEFAULT_EXTENSION = &quot;.class&quot;;
 66     String fileExtension = DEFAULT_EXTENSION;
 67     public CDOutputStream cdos;
 68 
 69     /**
 70      * Initializes the ClassData.
 71      *
 72      * @param me The constant pool reference to this class
 73      * @param father The constant pool reference to the super class
 74      * @param interfaces A list of interfaces that this class implements
 75      */
 76     public final void init(int access, ConstantPool.ConstCell me, ConstantPool.ConstCell father, ArrayList&lt;Argument&gt; interfaces) {
 77         this.access = access;
 78 
 79         // normalize the modifiers to access flags
</pre>
<hr />
<pre>
294     }
295 
296     public void addBootstrapMethod(BootstrapMethodData bsmData) {
297         env.traceln(&quot;addBootstrapMethod&quot;);
298         if (bootstrapMethodsAttr == null) {
299             bootstrapMethodsAttr = new DataVectorAttr&lt;&gt;(this, AttrTag.ATT_BootstrapMethods.parsekey());
300         }
301         bootstrapMethodsAttr.add(bsmData);
302     }
303 
304     public void addNestHost(ConstantPool.ConstCell hostClass) {
305         env.traceln(&quot;addNestHost&quot;);
306         nestHostAttr = new CPXAttr(this, AttrTag.ATT_NestHost.parsekey(), hostClass);
307     }
308 
309     public void addNestMembers(List&lt;ConstantPool.ConstCell&gt; classes) {
310         env.traceln(&quot;addNestMembers&quot;);
311         nestMembersAttr = new NestMembersAttr(this, classes);
312     }
313 
<span class="line-modified">314     public void addPermittedSubclasses(List&lt;ConstantPool.ConstCell&gt; classes) {</span>
<span class="line-modified">315         env.traceln(&quot;addPermittedSubclasses&quot;);</span>
<span class="line-modified">316         permittedSubclassesAttr = new PermittedSubclassesAttr(this, classes);</span>
317     }
318 
319 
320     public void endClass() {
321         sourceFileNameAttr = new CPXAttr(this,
322                 AttrTag.ATT_SourceFile.parsekey(),
323                 pool.FindCellAsciz(env.getSimpleInputFileName()));
324         pool.NumberizePool();
325         pool.CheckGlobals();
326         numberBootstrapMethods();
327         try {
328             me = pool.uncheckedGetCell(me.arg);
329             env.traceln(&quot;me=&quot; + me);
330             ConstantPool.ConstValue_Cell me_value = (ConstantPool.ConstValue_Cell) me.ref;
331             ConstantPool.ConstCell ascicell = me_value.cell;
332             env.traceln(&quot;ascicell=&quot; + ascicell);
333             ConstantPool.ConstValue_String me_str = (ConstantPool.ConstValue_String) ascicell.ref;
334             myClassName = me_str.value;
335             env.traceln(&quot;-------------------&quot;);
336             env.traceln(&quot;-- Constant Pool --&quot;);
</pre>
<hr />
<pre>
442             if (syntheticAttr != null)
443                 attrs.add(syntheticAttr);
444             if (deprecatedAttr != null)
445                 attrs.add(deprecatedAttr);
446             if (annotAttrVis != null)
447                 attrs.add(annotAttrVis);
448             if (annotAttrInv != null)
449                 attrs.add(annotAttrInv);
450             if (type_annotAttrVis != null)
451                 attrs.add(type_annotAttrVis);
452             if (type_annotAttrInv != null)
453                 attrs.add(type_annotAttrInv);
454             if (bootstrapMethodsAttr != null)
455                 attrs.add(bootstrapMethodsAttr);
456             // since class version 55.0
457             if(nestHostAttributeExists())
458                 attrs.add(nestHostAttr);
459             if(nestMembersAttributesExist())
460                 attrs.add(nestMembersAttr);
461             // since class version 59.65535 (JEP 360)
<span class="line-modified">462             if ( permittedSubclassesAttributesExist() )</span>
<span class="line-modified">463                 attrs.add(permittedSubclassesAttr);</span>
464         }
465         return attrs;
466     }
467 
468     static char fileSeparator; //=System.getProperty(&quot;file.separator&quot;);
469 
470     /**
471      * Writes to the directory passed with -d option
472      */
473     public void write(File destdir) throws IOException {
474         File outfile;
475         if (destdir == null) {
476             int startofname = myClassName.lastIndexOf(&quot;/&quot;);
477             if (startofname != -1) {
478                 myClassName = myClassName.substring(startofname + 1);
479             }
480             outfile = new File(myClassName + fileExtension);
481         } else {
482             env.traceln(&quot;writing -d &quot; + destdir.getPath());
483             if (fileSeparator == 0) {
</pre>
<hr />
<pre>
498                 new BufferedOutputStream(new FileOutputStream(outfile)));
499         cdos.setDataOutputStream(dos);
500         try {
501             write(cdos);
502         } finally {
503             dos.close();
504         }
505     }  // end write()
506 
507     public void setByteLimit(int bytelimit) {
508         cdos.enable();
509         cdos.setLimit(bytelimit);
510     }
511 
512     public boolean nestHostAttributeExists() {
513         return nestHostAttr != null;
514     }
515 
516     public boolean nestMembersAttributesExist() { return nestMembersAttr != null;  }
517 
<span class="line-modified">518     public boolean permittedSubclassesAttributesExist() { return permittedSubclassesAttr != null;  }</span>
519 
520     public boolean recordAttributeExists() { return recordData != null;  }
521 
522     /**
523      * This is a wrapper for DataOutputStream, used for debugging purposes. it allows
524      * writing the byte-stream of a class up to a given byte number.
525      */
526     static private class CDOutputStream implements CheckedDataOutputStream {
527 
528         private int bytelimit;
529         private DataOutputStream dos;
530         public boolean enabled = false;
531 
532         public CDOutputStream() {
533             dos = null;
534         }
535 
536         public CDOutputStream(OutputStream out) {
537             setOutputStream(out);
538         }
</pre>
</td>
</tr>
</table>
<center><a href="ClassArrayAttr.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Environment.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>