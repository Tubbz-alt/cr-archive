<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/VirtualMachine/canUnrestrictedlyRedefineClasses/curc001.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../canRequestVMDeathEvent/canreqvmdev001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../canUseInstanceFilters/canusefilters001.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/VirtualMachine/canUnrestrictedlyRedefineClasses/curc001.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
113 
114     //====================================================== test program
115     //------------------------------------------------------ common section
116 
117     static Debugee          debuggee;
118     static ArgumentHandler  argsHandler;
119 
120     static int waitTime;
121 
122     static VirtualMachine      vm            = null;
123     static EventRequestManager eventRManager = null;
124     static EventQueue          eventQueue    = null;
125     static EventSet            eventSet      = null;
126     static EventIterator       eventIterator = null;
127 
128     static ReferenceType       debuggeeClass = null;
129 
130     static int  testExitCode = PASSED;
131 
132 
<span class="line-removed">133     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">134         JDITestRuntimeException(String str) {</span>
<span class="line-removed">135             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">136         }</span>
<span class="line-removed">137     }</span>
<span class="line-removed">138 </span>
139     //------------------------------------------------------ methods
140 
141     private int runThis (String argv[], PrintStream out) {
142 
143         argsHandler     = new ArgumentHandler(argv);
144         logHandler      = new Log(out, argsHandler);
145         Binder binder   = new Binder(argsHandler, logHandler);
146 
147         waitTime        = argsHandler.getWaitTime() * 60000;
148 
149         try {
150             log2(&quot;launching a debuggee :&quot;);
151             log2(&quot;       &quot; + debuggeeName);
152             if (argsHandler.verbose()) {
153                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
154             } else {
155                 debuggee = binder.bindToDebugee(debuggeeName);
156             }
157             if (debuggee == null) {
158                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
263         cpRequest.addClassFilter(debuggeeName);
264 
265         cpRequest.enable();
266         vm.resume();
267         getEventSet();
268         cpRequest.disable();
269 
270         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
271         debuggeeClass = event.referenceType();
272 
273         if (!debuggeeClass.name().equals(debuggeeName))
274            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
275 
276         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
277 
278         String bPointMethod = &quot;methodForCommunication&quot;;
279         String lineForComm  = &quot;lineForComm&quot;;
280         BreakpointRequest bpRequest;
281 
282         try {
<span class="line-modified">283             bpRequest = settingBreakpoint(threadByName(&quot;main&quot;),</span>
284                                           debuggeeClass,
285                                           bPointMethod, lineForComm, &quot;zero&quot;);
286         } catch ( Exception e ) {
287             throw e;
288         }
289         bpRequest.enable();
290 
291     //------------------------------------------------------  testing section
292 
293         log1(&quot;     TESTING BEGINS&quot;);
294 
295         for (int i = 0; ; i++) {
296 
297             vm.resume();
298             breakpointForCommunication();
299 
300             int instruction = ((IntegerValue)
301                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
302 
303             if (instruction == 0) {
304                 vm.resume();
305                 break;
306             }
307 
308             log1(&quot;  new check: # &quot; + i);
309 
310             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
311 
312             log2(&quot;...... vm.canUnrestrictedlyRedefineClasses()&quot;);
313             if ( vm.canUnrestrictedlyRedefineClasses() )
314                 log2(&quot;      vm.canUnrestrictedlyRedefineClasses() == true&quot;);
315             else
316                 log2(&quot;      vm.canUnrestrictedlyRedefineClasses() == false&quot;);
317 
318             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
319         }
320         log1(&quot;    TESTING ENDS&quot;);
321         return;
322     }
323 
<span class="line-removed">324     private ThreadReference threadByName(String name)</span>
<span class="line-removed">325                  throws JDITestRuntimeException {</span>
<span class="line-removed">326 </span>
<span class="line-removed">327         List         all = vm.allThreads();</span>
<span class="line-removed">328         ListIterator li  = all.listIterator();</span>
<span class="line-removed">329 </span>
<span class="line-removed">330         for (; li.hasNext(); ) {</span>
<span class="line-removed">331             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">332             if (thread.name().equals(name))</span>
<span class="line-removed">333                 return thread;</span>
<span class="line-removed">334         }</span>
<span class="line-removed">335         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">336     }</span>
<span class="line-removed">337 </span>
338    /*
339     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
340     *                                             String, String, String)
341     *
342     * It sets up a breakpoint at given line number within a given method in a given class
343     * for a given thread.
344     *
345     * Return value: BreakpointRequest object  in case of success
346     *
347     * JDITestRuntimeException   in case of an Exception thrown within the method
348     */
349 
350     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
351                                                   ReferenceType testedClass,
352                                                   String methodName,
353                                                   String bpLine,
354                                                   String property)
355             throws JDITestRuntimeException {
356 
357         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
<td>
<hr />
<pre>
113 
114     //====================================================== test program
115     //------------------------------------------------------ common section
116 
117     static Debugee          debuggee;
118     static ArgumentHandler  argsHandler;
119 
120     static int waitTime;
121 
122     static VirtualMachine      vm            = null;
123     static EventRequestManager eventRManager = null;
124     static EventQueue          eventQueue    = null;
125     static EventSet            eventSet      = null;
126     static EventIterator       eventIterator = null;
127 
128     static ReferenceType       debuggeeClass = null;
129 
130     static int  testExitCode = PASSED;
131 
132 






133     //------------------------------------------------------ methods
134 
135     private int runThis (String argv[], PrintStream out) {
136 
137         argsHandler     = new ArgumentHandler(argv);
138         logHandler      = new Log(out, argsHandler);
139         Binder binder   = new Binder(argsHandler, logHandler);
140 
141         waitTime        = argsHandler.getWaitTime() * 60000;
142 
143         try {
144             log2(&quot;launching a debuggee :&quot;);
145             log2(&quot;       &quot; + debuggeeName);
146             if (argsHandler.verbose()) {
147                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
148             } else {
149                 debuggee = binder.bindToDebugee(debuggeeName);
150             }
151             if (debuggee == null) {
152                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
257         cpRequest.addClassFilter(debuggeeName);
258 
259         cpRequest.enable();
260         vm.resume();
261         getEventSet();
262         cpRequest.disable();
263 
264         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
265         debuggeeClass = event.referenceType();
266 
267         if (!debuggeeClass.name().equals(debuggeeName))
268            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
269 
270         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
271 
272         String bPointMethod = &quot;methodForCommunication&quot;;
273         String lineForComm  = &quot;lineForComm&quot;;
274         BreakpointRequest bpRequest;
275 
276         try {
<span class="line-modified">277             bpRequest = settingBreakpoint(debuggee.threadByNameOrThrow(&quot;main&quot;),</span>
278                                           debuggeeClass,
279                                           bPointMethod, lineForComm, &quot;zero&quot;);
280         } catch ( Exception e ) {
281             throw e;
282         }
283         bpRequest.enable();
284 
285     //------------------------------------------------------  testing section
286 
287         log1(&quot;     TESTING BEGINS&quot;);
288 
289         for (int i = 0; ; i++) {
290 
291             vm.resume();
292             breakpointForCommunication();
293 
294             int instruction = ((IntegerValue)
295                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
296 
297             if (instruction == 0) {
298                 vm.resume();
299                 break;
300             }
301 
302             log1(&quot;  new check: # &quot; + i);
303 
304             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
305 
306             log2(&quot;...... vm.canUnrestrictedlyRedefineClasses()&quot;);
307             if ( vm.canUnrestrictedlyRedefineClasses() )
308                 log2(&quot;      vm.canUnrestrictedlyRedefineClasses() == true&quot;);
309             else
310                 log2(&quot;      vm.canUnrestrictedlyRedefineClasses() == false&quot;);
311 
312             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
313         }
314         log1(&quot;    TESTING ENDS&quot;);
315         return;
316     }
317 














318    /*
319     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
320     *                                             String, String, String)
321     *
322     * It sets up a breakpoint at given line number within a given method in a given class
323     * for a given thread.
324     *
325     * Return value: BreakpointRequest object  in case of success
326     *
327     * JDITestRuntimeException   in case of an Exception thrown within the method
328     */
329 
330     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
331                                                   ReferenceType testedClass,
332                                                   String methodName,
333                                                   String bpLine,
334                                                   String property)
335             throws JDITestRuntimeException {
336 
337         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../canRequestVMDeathEvent/canreqvmdev001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../canUseInstanceFilters/canusefilters001.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>