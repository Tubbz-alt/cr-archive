<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/VMDeathEvent/_itself_/vmdeath002.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../ThreadStartRequest/addThreadFilter/addthreadfilter005.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="vmdeath003.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/VMDeathEvent/_itself_/vmdeath002.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
117 
118     //====================================================== test program
119     //------------------------------------------------------ common section
120 
121     static Debugee          debuggee;
122     static ArgumentHandler  argsHandler;
123 
124     static int waitTime;
125 
126     static VirtualMachine      vm            = null;
127     static EventRequestManager eventRManager = null;
128     static EventQueue          eventQueue    = null;
129     static EventSet            eventSet      = null;
130     static EventIterator       eventIterator = null;
131 
132     static ReferenceType       debuggeeClass = null;
133 
134     static int  testExitCode = PASSED;
135 
136 
<span class="line-removed">137     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">138         JDITestRuntimeException(String str) {</span>
<span class="line-removed">139             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">140         }</span>
<span class="line-removed">141     }</span>
<span class="line-removed">142 </span>
143     //------------------------------------------------------ methods
144 
145     private int runThis (String argv[], PrintStream out) {
146 
147         argsHandler     = new ArgumentHandler(argv);
148         logHandler      = new Log(out, argsHandler);
149         Binder binder   = new Binder(argsHandler, logHandler);
150 
151         waitTime        = argsHandler.getWaitTime() * 60000;
152 
153         try {
154             log2(&quot;launching a debuggee :&quot;);
155             log2(&quot;       &quot; + debuggeeName);
156             if (argsHandler.verbose()) {
157                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
158             } else {
159                 debuggee = binder.bindToDebugee(debuggeeName);
160             }
161             if (debuggee == null) {
162                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
274         cpRequest.setSuspendPolicy( EventRequest.SUSPEND_EVENT_THREAD);
275         cpRequest.addClassFilter(debuggeeName);
276 
277         cpRequest.enable();
278         vm.resume();
279         getEventSet();
280         cpRequest.disable();
281 
282         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
283         debuggeeClass = event.referenceType();
284 
285         if (!debuggeeClass.name().equals(debuggeeName))
286            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
287 
288         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
289 
290         String bPointMethod = &quot;methodForCommunication&quot;;
291         String lineForComm  = &quot;lineForComm&quot;;
292         BreakpointRequest bpRequest;
293 
<span class="line-modified">294         bpRequest = settingBreakpoint(threadByName(&quot;main&quot;),</span>
295                                       debuggeeClass,
296                                       bPointMethod, lineForComm, &quot;zero&quot;);
297         bpRequest.enable();
298 
299     //------------------------------------------------------  testing section
300 
301         log1(&quot;     TESTING BEGINS&quot;);
302 
303         for (int i = 0; ; i++) {
304 
305             vm.resume();
306             breakpointForCommunication();
307 
308             int instruction = ((IntegerValue)
309                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
310 
311             if (instruction == 0) {
312                 vm.resume();
313                 break;
314             }
315 
316             log1(&quot;:::::: case: # &quot; + i);
317 
318             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
319 
320             //vm.eventRequestManager().createVMDeathRequest().enable();
321 
322             log2(&quot;......vm.exit(PASS_BASE);  :: VMDeathEvent is excpected&quot;);
323 
324             //vm.exit(PASS_BASE);
325             break;
326 
327             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
328         }
329         log1(&quot;    TESTING ENDS&quot;);
330         return;
331     }
332 
<span class="line-removed">333     private ThreadReference threadByName(String name)</span>
<span class="line-removed">334                  throws JDITestRuntimeException {</span>
<span class="line-removed">335 </span>
<span class="line-removed">336         List         all = vm.allThreads();</span>
<span class="line-removed">337         ListIterator li  = all.listIterator();</span>
<span class="line-removed">338 </span>
<span class="line-removed">339         for (; li.hasNext(); ) {</span>
<span class="line-removed">340             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">341             if (thread.name().equals(name))</span>
<span class="line-removed">342                 return thread;</span>
<span class="line-removed">343         }</span>
<span class="line-removed">344         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">345     }</span>
346 
347    /*
348     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
349     *                                             String, String, String)
350     *
351     * It sets up a breakpoint at given line number within a given method in a given class
352     * for a given thread.
353     *
354     * Return value: BreakpointRequest object  in case of success
355     *
356     * JDITestRuntimeException   in case of an Exception thrown within the method
357     */
358 
359     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
360                                                   ReferenceType testedClass,
361                                                   String methodName,
362                                                   String bpLine,
363                                                   String property)
364             throws JDITestRuntimeException {
365 
</pre>
</td>
<td>
<hr />
<pre>
117 
118     //====================================================== test program
119     //------------------------------------------------------ common section
120 
121     static Debugee          debuggee;
122     static ArgumentHandler  argsHandler;
123 
124     static int waitTime;
125 
126     static VirtualMachine      vm            = null;
127     static EventRequestManager eventRManager = null;
128     static EventQueue          eventQueue    = null;
129     static EventSet            eventSet      = null;
130     static EventIterator       eventIterator = null;
131 
132     static ReferenceType       debuggeeClass = null;
133 
134     static int  testExitCode = PASSED;
135 
136 






137     //------------------------------------------------------ methods
138 
139     private int runThis (String argv[], PrintStream out) {
140 
141         argsHandler     = new ArgumentHandler(argv);
142         logHandler      = new Log(out, argsHandler);
143         Binder binder   = new Binder(argsHandler, logHandler);
144 
145         waitTime        = argsHandler.getWaitTime() * 60000;
146 
147         try {
148             log2(&quot;launching a debuggee :&quot;);
149             log2(&quot;       &quot; + debuggeeName);
150             if (argsHandler.verbose()) {
151                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
152             } else {
153                 debuggee = binder.bindToDebugee(debuggeeName);
154             }
155             if (debuggee == null) {
156                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
268         cpRequest.setSuspendPolicy( EventRequest.SUSPEND_EVENT_THREAD);
269         cpRequest.addClassFilter(debuggeeName);
270 
271         cpRequest.enable();
272         vm.resume();
273         getEventSet();
274         cpRequest.disable();
275 
276         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
277         debuggeeClass = event.referenceType();
278 
279         if (!debuggeeClass.name().equals(debuggeeName))
280            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
281 
282         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
283 
284         String bPointMethod = &quot;methodForCommunication&quot;;
285         String lineForComm  = &quot;lineForComm&quot;;
286         BreakpointRequest bpRequest;
287 
<span class="line-modified">288         bpRequest = settingBreakpoint(debuggee.threadByNameOrThrow(&quot;main&quot;),</span>
289                                       debuggeeClass,
290                                       bPointMethod, lineForComm, &quot;zero&quot;);
291         bpRequest.enable();
292 
293     //------------------------------------------------------  testing section
294 
295         log1(&quot;     TESTING BEGINS&quot;);
296 
297         for (int i = 0; ; i++) {
298 
299             vm.resume();
300             breakpointForCommunication();
301 
302             int instruction = ((IntegerValue)
303                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
304 
305             if (instruction == 0) {
306                 vm.resume();
307                 break;
308             }
309 
310             log1(&quot;:::::: case: # &quot; + i);
311 
312             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
313 
314             //vm.eventRequestManager().createVMDeathRequest().enable();
315 
316             log2(&quot;......vm.exit(PASS_BASE);  :: VMDeathEvent is excpected&quot;);
317 
318             //vm.exit(PASS_BASE);
319             break;
320 
321             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
322         }
323         log1(&quot;    TESTING ENDS&quot;);
324         return;
325     }
326 













327 
328    /*
329     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
330     *                                             String, String, String)
331     *
332     * It sets up a breakpoint at given line number within a given method in a given class
333     * for a given thread.
334     *
335     * Return value: BreakpointRequest object  in case of success
336     *
337     * JDITestRuntimeException   in case of an Exception thrown within the method
338     */
339 
340     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
341                                                   ReferenceType testedClass,
342                                                   String methodName,
343                                                   String bpLine,
344                                                   String property)
345             throws JDITestRuntimeException {
346 
</pre>
</td>
</tr>
</table>
<center><a href="../../ThreadStartRequest/addThreadFilter/addthreadfilter005.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="vmdeath003.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>