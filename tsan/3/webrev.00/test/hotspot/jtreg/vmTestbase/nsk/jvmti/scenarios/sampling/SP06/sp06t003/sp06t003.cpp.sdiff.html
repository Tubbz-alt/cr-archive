<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jvmti/scenarios/sampling/SP06/sp06t003/sp06t003.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../SP02/sp02t003/sp02t003.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../unit/FollowReferences/followref001/followref001.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jvmti/scenarios/sampling/SP06/sp06t003/sp06t003.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
312 
313         /* get stack trace */
314         if (!NSK_JVMTI_VERIFY(
315                 jvmti-&gt;GetStackTrace(threadsDesc[i].thread, 0, MAX_STACK_SIZE, frameStack, &amp;frameStackSize))) {
316             nsk_jvmti_setFailStatus();
317             return NSK_TRUE;
318         }
319         NSK_DISPLAY1(&quot;    stack depth: %d\n&quot;, (int)frameStackSize);
320 
321         found = 0;
322         for (j = 0; j &lt; frameStackSize; j++) {
323             jmethodID qMethod = (jmethodID)NULL;
324             jlocation qLocation = NSK_JVMTI_INVALID_JLOCATION;
325 
326             NSK_DISPLAY3(&quot;      %d frame: method: 0x%p, location: %ld\n&quot;,
327                                         j, (void*)frameStack[j].method,
328                                         (long)frameStack[j].location);
329             /* query frame location */
330             if (!NSK_JVMTI_VERIFY(
331                     jvmti-&gt;GetFrameLocation(threadsDesc[i].thread, j, &amp;qMethod, &amp;qLocation))
<span class="line-modified">332                 &amp;&amp; (suspended == NSK_TRUE)) {</span>
333                 nsk_jvmti_setFailStatus();
334                 continue;
335             }
336 
337             NSK_DISPLAY2(&quot;      queried: method: 0x%p, location: %ld\n&quot;,
338                                         (void*)qMethod, (long)qLocation);
339 
340             /* check frame equality */
<span class="line-modified">341             if ((suspended == NSK_TRUE) &amp;&amp; (frameStack[j].method != qMethod)) {</span>
342                 NSK_COMPLAIN6(&quot;Different method in stack frame #%d for %s thread #%d (%s):\n&quot;
343                             &quot;#   GetStackTrace():    0x%p\n&quot;
344                             &quot;#   GetFrameLocation(): 0x%p\n&quot;,
345                             j, kind, i, threadsDesc[i].threadName,
346                             (void*)frameStack[j].method, (void*)qMethod);
347                 nsk_jvmti_setFailStatus();
348             }
<span class="line-modified">349             if ((suspended == NSK_TRUE) &amp;&amp; (frameStack[j].location != qLocation)) {</span>
350                 NSK_COMPLAIN6(&quot;Different location in stack frame #%d for %s thread #%d (%s):\n&quot;
351                             &quot;#   GetStackTrace():    %ld\n&quot;
352                             &quot;#   GetFrameLocation(): %ld\n&quot;,
353                             j, kind, i, threadsDesc[i].threadName,
354                             (long)frameStack[j].location, (long)qLocation);
355                 nsk_jvmti_setFailStatus();
356             }
357 
358             /* find expected method */
359             if (frameStack[j].method == threadsDesc[i].method) {
360                 found++;
361                 NSK_DISPLAY1(&quot;        found expected method: %s\n&quot;,
362                                                 threadsDesc[i].methodName);
363             }
364         }
365 
366         /* check if expected method frame found */
367         if (found &lt;= 0) {
368             NSK_COMPLAIN3(&quot;No expected method frame for %s thread #%d (%s)\n&quot;,
369                                 kind, i, threadsDesc[i].threadName);
</pre>
</td>
<td>
<hr />
<pre>
312 
313         /* get stack trace */
314         if (!NSK_JVMTI_VERIFY(
315                 jvmti-&gt;GetStackTrace(threadsDesc[i].thread, 0, MAX_STACK_SIZE, frameStack, &amp;frameStackSize))) {
316             nsk_jvmti_setFailStatus();
317             return NSK_TRUE;
318         }
319         NSK_DISPLAY1(&quot;    stack depth: %d\n&quot;, (int)frameStackSize);
320 
321         found = 0;
322         for (j = 0; j &lt; frameStackSize; j++) {
323             jmethodID qMethod = (jmethodID)NULL;
324             jlocation qLocation = NSK_JVMTI_INVALID_JLOCATION;
325 
326             NSK_DISPLAY3(&quot;      %d frame: method: 0x%p, location: %ld\n&quot;,
327                                         j, (void*)frameStack[j].method,
328                                         (long)frameStack[j].location);
329             /* query frame location */
330             if (!NSK_JVMTI_VERIFY(
331                     jvmti-&gt;GetFrameLocation(threadsDesc[i].thread, j, &amp;qMethod, &amp;qLocation))
<span class="line-modified">332                 &amp;&amp; suspended) {</span>
333                 nsk_jvmti_setFailStatus();
334                 continue;
335             }
336 
337             NSK_DISPLAY2(&quot;      queried: method: 0x%p, location: %ld\n&quot;,
338                                         (void*)qMethod, (long)qLocation);
339 
340             /* check frame equality */
<span class="line-modified">341             if (suspended &amp;&amp; (frameStack[j].method != qMethod)) {</span>
342                 NSK_COMPLAIN6(&quot;Different method in stack frame #%d for %s thread #%d (%s):\n&quot;
343                             &quot;#   GetStackTrace():    0x%p\n&quot;
344                             &quot;#   GetFrameLocation(): 0x%p\n&quot;,
345                             j, kind, i, threadsDesc[i].threadName,
346                             (void*)frameStack[j].method, (void*)qMethod);
347                 nsk_jvmti_setFailStatus();
348             }
<span class="line-modified">349             if (suspended &amp;&amp; (frameStack[j].location != qLocation)) {</span>
350                 NSK_COMPLAIN6(&quot;Different location in stack frame #%d for %s thread #%d (%s):\n&quot;
351                             &quot;#   GetStackTrace():    %ld\n&quot;
352                             &quot;#   GetFrameLocation(): %ld\n&quot;,
353                             j, kind, i, threadsDesc[i].threadName,
354                             (long)frameStack[j].location, (long)qLocation);
355                 nsk_jvmti_setFailStatus();
356             }
357 
358             /* find expected method */
359             if (frameStack[j].method == threadsDesc[i].method) {
360                 found++;
361                 NSK_DISPLAY1(&quot;        found expected method: %s\n&quot;,
362                                                 threadsDesc[i].methodName);
363             }
364         }
365 
366         /* check if expected method frame found */
367         if (found &lt;= 0) {
368             NSK_COMPLAIN3(&quot;No expected method frame for %s thread #%d (%s)\n&quot;,
369                                 kind, i, threadsDesc[i].threadName);
</pre>
</td>
</tr>
</table>
<center><a href="../../SP02/sp02t003/sp02t003.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../unit/FollowReferences/followref001/followref001.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>