<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/hotspot/jtreg/vmTestbase/nsk/jvmti/scenarios/contention/TC02/tc02t001.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2004, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package nsk.jvmti.scenarios.contention.TC02;
 25 
 26 import java.io.PrintStream;
 27 
 28 import nsk.share.*;
 29 import nsk.share.jvmti.*;
 30 
<a name="2" id="anc2"></a><span class="line-modified"> 31 //    THIS TEST IS LINE NUMBER SENSITIVE</span>

































 32 
 33 public class tc02t001 extends DebugeeClass {
 34 
 35     // run test from command line
 36     public static void main(String argv[]) {
 37         argv = nsk.share.jvmti.JVMTITest.commonInit(argv);
 38 
 39         // JCK-compatible exit
 40         System.exit(run(argv, System.out) + Consts.JCK_STATUS_BASE);
 41     }
 42 
 43     // run test from JCK-compatible environment
 44     public static int run(String argv[], PrintStream out) {
 45         return new tc02t001().runIt(argv, out);
 46     }
 47 
 48     /* =================================================================== */
 49 
 50     // scaffold objects
 51     ArgumentHandler argHandler = null;
 52     Log log = null;
 53     int status = Consts.TEST_PASSED;
 54     static long timeout = 0;
 55 
<a name="3" id="anc3"></a>


 56     // tested thread
 57     tc02t001Thread thread = null;
 58 
<a name="4" id="anc4"></a>




















 59     // run debuggee
 60     public int runIt(String argv[], PrintStream out) {
 61         argHandler = new ArgumentHandler(argv);
 62         log = new Log(out, argHandler);
 63         timeout = argHandler.getWaitTime() * 60 * 1000;
 64         log.display(&quot;Timeout = &quot; + timeout + &quot; msc.&quot;);
 65 
 66         thread = new tc02t001Thread(&quot;Debuggee Thread&quot;);
 67         synchronized (thread.M) {
 68             thread.start();
 69             thread.startingBarrier.waitFor();
 70             status = checkStatus(status);
 71 
<a name="5" id="anc5"></a>
 72             thread.waitingBarrier1.unlock();
<a name="6" id="anc6"></a><span class="line-modified"> 73             try {</span>
<span class="line-modified"> 74                 Thread.sleep(1000); // Wait for contended &quot;synchronized (M)&quot;</span>
<span class="line-removed"> 75                 thread.M.wait(timeout);</span>
<span class="line-removed"> 76             } catch (InterruptedException e) {</span>
<span class="line-removed"> 77                 throw new Failure(e);</span>
<span class="line-removed"> 78             }</span>
 79 
<a name="7" id="anc7"></a>
 80             thread.waitingBarrier2.unlock();
<a name="8" id="anc8"></a><span class="line-modified"> 81             try {</span>
<span class="line-modified"> 82                 Thread.sleep(1000); // Wait for contended &quot;synchronized (M)&quot;</span>
<span class="line-removed"> 83                 thread.M.wait(timeout);</span>
<span class="line-removed"> 84             } catch (InterruptedException e) {</span>
<span class="line-removed"> 85                 throw new Failure(e);</span>
<span class="line-removed"> 86             }</span>
 87 
<a name="9" id="anc9"></a>
 88             thread.waitingBarrier3.unlock();
<a name="10" id="anc10"></a><span class="line-modified"> 89             try {</span>
<span class="line-modified"> 90                 Thread.sleep(1000); // Wait for contended &quot;synchronized (M)&quot;</span>
<span class="line-removed"> 91                 thread.M.wait(timeout);</span>
<span class="line-removed"> 92             } catch (InterruptedException e) {</span>
<span class="line-removed"> 93                 throw new Failure(e);</span>
<span class="line-removed"> 94             }</span>
 95         }
 96 
 97         try {
 98             thread.join(timeout);
 99         } catch (InterruptedException e) {
100             throw new Failure(e);
101         }
102 
103         log.display(&quot;Debugee finished&quot;);
104         status = checkStatus(status);
105 
106         return status;
107     }
108 }
<a name="11" id="anc11"></a><span class="line-removed">109 </span>
<span class="line-removed">110 /* =================================================================== */</span>
<span class="line-removed">111 </span>
<span class="line-removed">112 class tc02t001Thread extends Thread {</span>
<span class="line-removed">113     public Wicket startingBarrier = new Wicket();</span>
<span class="line-removed">114     public Wicket waitingBarrier1 = new Wicket();</span>
<span class="line-removed">115     public Wicket waitingBarrier2 = new Wicket();</span>
<span class="line-removed">116     public Wicket waitingBarrier3 = new Wicket();</span>
<span class="line-removed">117     public Object M = new Object();</span>
<span class="line-removed">118 </span>
<span class="line-removed">119     public tc02t001Thread(String name) {</span>
<span class="line-removed">120         super(name);</span>
<span class="line-removed">121     }</span>
<span class="line-removed">122 </span>
<span class="line-removed">123     public void run() {</span>
<span class="line-removed">124         startingBarrier.unlock();</span>
<span class="line-removed">125 </span>
<span class="line-removed">126         waitingBarrier1.waitFor();</span>
<span class="line-removed">127         synchronized (M) { // tc02t001.c::lines[0]</span>
<span class="line-removed">128             M.notify();</span>
<span class="line-removed">129         }</span>
<span class="line-removed">130 </span>
<span class="line-removed">131         waitingBarrier2.waitFor();</span>
<span class="line-removed">132         synchronized (M) { // tc02t001.c::lines[1]</span>
<span class="line-removed">133             M.notify();</span>
<span class="line-removed">134         }</span>
<span class="line-removed">135 </span>
<span class="line-removed">136         waitingBarrier3.waitFor();</span>
<span class="line-removed">137         synchronized (M) { // tc02t001.c::lines[2]</span>
<span class="line-removed">138             M.notify();</span>
<span class="line-removed">139         }</span>
<span class="line-removed">140     }</span>
<span class="line-removed">141 }</span>
<a name="12" id="anc12"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="12" type="hidden" />
</body>
</html>