<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jvmti/scenarios/sampling/SP02/sp02t003/sp02t003.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../hotswap/HS302/hs302t012/hs302t012.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../SP06/sp06t003/sp06t003.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jvmti/scenarios/sampling/SP02/sp02t003/sp02t003.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
289 
290         /* get stack trace */
291         if (!NSK_JVMTI_VERIFY(
292                 jvmti-&gt;GetStackTrace(threadsDesc[i].thread, 0, MAX_STACK_SIZE, frameStack, &amp;frameStackSize))) {
293             nsk_jvmti_setFailStatus();
294             return NSK_TRUE;
295         }
296         NSK_DISPLAY1(&quot;    stack depth: %d\n&quot;, (int)frameStackSize);
297 
298         found = 0;
299         for (j = 0; j &lt; frameStackSize; j++) {
300             jmethodID qMethod = (jmethodID)NULL;
301             jlocation qLocation = NSK_JVMTI_INVALID_JLOCATION;
302 
303             NSK_DISPLAY3(&quot;      %d frame: method: %p, location: %ld\n&quot;,
304                                         j, (void*)frameStack[j].method,
305                                         (long)frameStack[j].location);
306             /* query frame location */
307             if (!NSK_JVMTI_VERIFY(
308                     jvmti-&gt;GetFrameLocation(threadsDesc[i].thread, j, &amp;qMethod, &amp;qLocation))
<span class="line-modified">309                 &amp;&amp; (suspended == NSK_TRUE)) {</span>
310                 nsk_jvmti_setFailStatus();
311                 continue;
312             }
313 
314             NSK_DISPLAY2(&quot;      queried: method: %p, location: %ld\n&quot;,
315                                         (void*)qMethod, (long)qLocation);
316 
317             /* check frame equality */
<span class="line-modified">318             if ((suspended == NSK_TRUE) &amp;&amp; (frameStack[j].method != qMethod)) {</span>
319                 NSK_COMPLAIN6(&quot;Different method in stack frame #%d for %s thread #%d (%s):\n&quot;
320                             &quot;#   GetStackTrace():    %p\n&quot;
321                             &quot;#   GetFrameLocation(): %p\n&quot;,
322                             j, kind, i, threadsDesc[i].threadName,
323                             (void*)frameStack[j].method, (void*)qMethod);
324                 nsk_jvmti_setFailStatus();
325             }
<span class="line-modified">326             if ((suspended == NSK_TRUE) &amp;&amp; (frameStack[j].location != qLocation)) {</span>
327                 NSK_COMPLAIN6(&quot;Different location in stack frame #%d for %s thread #%d (%s):\n&quot;
328                             &quot;#   GetStackTrace():    %ld\n&quot;
329                             &quot;#   GetFrameLocation(): %ld\n&quot;,
330                             j, kind, i, threadsDesc[i].threadName,
331                             (long)frameStack[j].location, (long)qLocation);
332                 nsk_jvmti_setFailStatus();
333             }
334 
335             /* find expected method */
336             if (frameStack[j].method == threadsDesc[i].method) {
337                 found++;
338                 NSK_DISPLAY1(&quot;        found expected method: %s\n&quot;,
339                                                 threadsDesc[i].methodName);
340             }
341         }
342 
343         /* check if expected method frame found */
344         if (found &lt;= 0) {
345             NSK_COMPLAIN3(&quot;No expected method frame for %s thread #%d (%s)\n&quot;,
346                                 kind, i, threadsDesc[i].threadName);
</pre>
</td>
<td>
<hr />
<pre>
289 
290         /* get stack trace */
291         if (!NSK_JVMTI_VERIFY(
292                 jvmti-&gt;GetStackTrace(threadsDesc[i].thread, 0, MAX_STACK_SIZE, frameStack, &amp;frameStackSize))) {
293             nsk_jvmti_setFailStatus();
294             return NSK_TRUE;
295         }
296         NSK_DISPLAY1(&quot;    stack depth: %d\n&quot;, (int)frameStackSize);
297 
298         found = 0;
299         for (j = 0; j &lt; frameStackSize; j++) {
300             jmethodID qMethod = (jmethodID)NULL;
301             jlocation qLocation = NSK_JVMTI_INVALID_JLOCATION;
302 
303             NSK_DISPLAY3(&quot;      %d frame: method: %p, location: %ld\n&quot;,
304                                         j, (void*)frameStack[j].method,
305                                         (long)frameStack[j].location);
306             /* query frame location */
307             if (!NSK_JVMTI_VERIFY(
308                     jvmti-&gt;GetFrameLocation(threadsDesc[i].thread, j, &amp;qMethod, &amp;qLocation))
<span class="line-modified">309                 &amp;&amp; suspended) {</span>
310                 nsk_jvmti_setFailStatus();
311                 continue;
312             }
313 
314             NSK_DISPLAY2(&quot;      queried: method: %p, location: %ld\n&quot;,
315                                         (void*)qMethod, (long)qLocation);
316 
317             /* check frame equality */
<span class="line-modified">318             if (suspended &amp;&amp; (frameStack[j].method != qMethod)) {</span>
319                 NSK_COMPLAIN6(&quot;Different method in stack frame #%d for %s thread #%d (%s):\n&quot;
320                             &quot;#   GetStackTrace():    %p\n&quot;
321                             &quot;#   GetFrameLocation(): %p\n&quot;,
322                             j, kind, i, threadsDesc[i].threadName,
323                             (void*)frameStack[j].method, (void*)qMethod);
324                 nsk_jvmti_setFailStatus();
325             }
<span class="line-modified">326             if (suspended &amp;&amp; (frameStack[j].location != qLocation)) {</span>
327                 NSK_COMPLAIN6(&quot;Different location in stack frame #%d for %s thread #%d (%s):\n&quot;
328                             &quot;#   GetStackTrace():    %ld\n&quot;
329                             &quot;#   GetFrameLocation(): %ld\n&quot;,
330                             j, kind, i, threadsDesc[i].threadName,
331                             (long)frameStack[j].location, (long)qLocation);
332                 nsk_jvmti_setFailStatus();
333             }
334 
335             /* find expected method */
336             if (frameStack[j].method == threadsDesc[i].method) {
337                 found++;
338                 NSK_DISPLAY1(&quot;        found expected method: %s\n&quot;,
339                                                 threadsDesc[i].methodName);
340             }
341         }
342 
343         /* check if expected method frame found */
344         if (found &lt;= 0) {
345             NSK_COMPLAIN3(&quot;No expected method frame for %s thread #%d (%s)\n&quot;,
346                                 kind, i, threadsDesc[i].threadName);
</pre>
</td>
</tr>
</table>
<center><a href="../../../hotswap/HS302/hs302t012/hs302t012.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../SP06/sp06t003/sp06t003.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>