<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/EventRequestManager/createStepRequest/crstepreq010.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="crstepreq009.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../createThreadDeathRequest/tdreg001.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/EventRequestManager/createStepRequest/crstepreq010.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
202     //--------------------------------------------------------- test specific methods
203 
204     private StepRequest setStepRequest ( BreakpointRequest bpRequest,
205                                          String threadName,
206                                          int testCase,
207                                          String property ) {
208         StepRequest stepRequest = null;
209         for (;;) {
210             display(&quot;Wait for initial brakepoint event in &quot; + threadName);
211             BreakpointEvent bpEvent = (BreakpointEvent)waitForEvent(bpRequest);
212 
213             // check location of breakpoint event
214             int lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
215             if (lineOfEvent != lineForBreak) {
216                 complain(&quot;Wrong line number of initial brakepoint event for &quot; + threadName);
217                 complain(&quot;\texpected value : &quot; + lineForBreak + &quot;; got one : &quot; + lineOfEvent);
218                 break;
219             }
220 
221             display(&quot;Getting mirror of thread: &quot; + threadName);
<span class="line-modified">222             ThreadReference thread = threadByName(threadName);</span>
223 
224             display(&quot;Getting ReferenceType of thread: &quot; + threadName);
225             ReferenceType debuggeeThread = debuggee.classByName(debuggeeThreadName);
226 
227             // set second breakpoint to suspend checked thread at the right location before
228             // setting step request
229             BreakpointRequest bpRequest1 = setBreakpoint( thread,
230                                                          debuggeeThread,
231                                                          brakeMethods[testCase],
232                                                          checkedLines[testCase][0],
233                                                          &quot;&quot;);
234             bpRequest1.addCountFilter(1);
235             bpRequest1.enable();
236 
237             display(&quot;Wait for additional brakepoint event in &quot; + threadName);
238             bpEvent = (BreakpointEvent)waitForEvent(bpRequest1);
239 
240             // check location of breakpoint event
241             lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
242             if (lineOfEvent != checkedLines[testCase][0]) {
</pre>
<hr />
<pre>
426                 }
427             }
428         } catch (Exception e) {
429             throw new Failure(&quot;Unexpected exception while waiting for an event: &quot; + e);
430         }
431         return resultEvent;
432     }
433 
434     private void getEventSet() {
435         try {
436             eventSet = vm.eventQueue().remove(waitTime);
437             if (eventSet == null) {
438                 throw new Failure(&quot;TIMEOUT while waiting for an event&quot;);
439             }
440             eventIterator = eventSet.eventIterator();
441         } catch (Exception e) {
442             throw new Failure(&quot;getEventSet(): Unexpected exception while waiting for an event: &quot; + e);
443         }
444     }
445 
<span class="line-removed">446 </span>
<span class="line-removed">447     private ThreadReference threadByName(String name) throws Failure{</span>
<span class="line-removed">448         List all = vm.allThreads();</span>
<span class="line-removed">449         ListIterator li = all.listIterator();</span>
<span class="line-removed">450 </span>
<span class="line-removed">451         while (li.hasNext()) {</span>
<span class="line-removed">452             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">453             if (thread.name().equals(name))</span>
<span class="line-removed">454                 return thread;</span>
<span class="line-removed">455         }</span>
<span class="line-removed">456         throw new Failure(&quot;Thread with searching for name is not found: &quot; + name);</span>
<span class="line-removed">457     }</span>
<span class="line-removed">458 </span>
459     private ReferenceType waitForDebuggeeClassPrepared () {
460         display(&quot;Creating request for ClassPrepareEvent for debuggee.&quot;);
461         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
462         cpRequest.addClassFilter(debuggeeName);
463         cpRequest.addCountFilter(1);
464         cpRequest.enable();
465 
466         ClassPrepareEvent event = (ClassPrepareEvent) waitForEvent(cpRequest);
467         cpRequest.disable();
468 
469         if (!event.referenceType().name().equals(debuggeeName)) {
470            throw new Failure(&quot;Unexpected class name for ClassPrepareEvent : &quot; + debuggeeClass.name());
471         }
472         return event.referenceType();
473     }
474 
475     private int getInstruction () {
476         if (debuggeeClass == null) {
477             throw new Failure(&quot;getInstruction() :: debuggeeClass reference is null&quot;);
478         }
</pre>
</td>
<td>
<hr />
<pre>
202     //--------------------------------------------------------- test specific methods
203 
204     private StepRequest setStepRequest ( BreakpointRequest bpRequest,
205                                          String threadName,
206                                          int testCase,
207                                          String property ) {
208         StepRequest stepRequest = null;
209         for (;;) {
210             display(&quot;Wait for initial brakepoint event in &quot; + threadName);
211             BreakpointEvent bpEvent = (BreakpointEvent)waitForEvent(bpRequest);
212 
213             // check location of breakpoint event
214             int lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
215             if (lineOfEvent != lineForBreak) {
216                 complain(&quot;Wrong line number of initial brakepoint event for &quot; + threadName);
217                 complain(&quot;\texpected value : &quot; + lineForBreak + &quot;; got one : &quot; + lineOfEvent);
218                 break;
219             }
220 
221             display(&quot;Getting mirror of thread: &quot; + threadName);
<span class="line-modified">222             ThreadReference thread = debuggee.threadByNameOrThrow(threadName);</span>
223 
224             display(&quot;Getting ReferenceType of thread: &quot; + threadName);
225             ReferenceType debuggeeThread = debuggee.classByName(debuggeeThreadName);
226 
227             // set second breakpoint to suspend checked thread at the right location before
228             // setting step request
229             BreakpointRequest bpRequest1 = setBreakpoint( thread,
230                                                          debuggeeThread,
231                                                          brakeMethods[testCase],
232                                                          checkedLines[testCase][0],
233                                                          &quot;&quot;);
234             bpRequest1.addCountFilter(1);
235             bpRequest1.enable();
236 
237             display(&quot;Wait for additional brakepoint event in &quot; + threadName);
238             bpEvent = (BreakpointEvent)waitForEvent(bpRequest1);
239 
240             // check location of breakpoint event
241             lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
242             if (lineOfEvent != checkedLines[testCase][0]) {
</pre>
<hr />
<pre>
426                 }
427             }
428         } catch (Exception e) {
429             throw new Failure(&quot;Unexpected exception while waiting for an event: &quot; + e);
430         }
431         return resultEvent;
432     }
433 
434     private void getEventSet() {
435         try {
436             eventSet = vm.eventQueue().remove(waitTime);
437             if (eventSet == null) {
438                 throw new Failure(&quot;TIMEOUT while waiting for an event&quot;);
439             }
440             eventIterator = eventSet.eventIterator();
441         } catch (Exception e) {
442             throw new Failure(&quot;getEventSet(): Unexpected exception while waiting for an event: &quot; + e);
443         }
444     }
445 













446     private ReferenceType waitForDebuggeeClassPrepared () {
447         display(&quot;Creating request for ClassPrepareEvent for debuggee.&quot;);
448         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
449         cpRequest.addClassFilter(debuggeeName);
450         cpRequest.addCountFilter(1);
451         cpRequest.enable();
452 
453         ClassPrepareEvent event = (ClassPrepareEvent) waitForEvent(cpRequest);
454         cpRequest.disable();
455 
456         if (!event.referenceType().name().equals(debuggeeName)) {
457            throw new Failure(&quot;Unexpected class name for ClassPrepareEvent : &quot; + debuggeeClass.name());
458         }
459         return event.referenceType();
460     }
461 
462     private int getInstruction () {
463         if (debuggeeClass == null) {
464             throw new Failure(&quot;getInstruction() :: debuggeeClass reference is null&quot;);
465         }
</pre>
</td>
</tr>
</table>
<center><a href="crstepreq009.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../createThreadDeathRequest/tdreg001.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>