<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/EventSet/eventIterator/eventiterator001.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../EventRequestManager/vmDeathRequests/vmdeathreq001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="eventiterator002.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/EventSet/eventIterator/eventiterator001.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
127 
128     //====================================================== test program
129     //------------------------------------------------------ common section
130 
131     static Debugee          debuggee;
132     static ArgumentHandler  argsHandler;
133 
134     static int waitTime;
135 
136     static VirtualMachine      vm            = null;
137     static EventRequestManager eventRManager = null;
138     static EventQueue          eventQueue    = null;
139     static EventSet            eventSet      = null;
140     static EventIterator       eventIterator = null;
141 
142     static ReferenceType       debuggeeClass = null;
143 
144     static int  testExitCode = PASSED;
145 
146 
<span class="line-removed">147     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">148         JDITestRuntimeException(String str) {</span>
<span class="line-removed">149             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">150         }</span>
<span class="line-removed">151     }</span>
<span class="line-removed">152 </span>
153 
154     //------------------------------------------------------ methods
155 
156     private int runThis (String argv[], PrintStream out) {
157 
158         argsHandler     = new ArgumentHandler(argv);
159         logHandler      = new Log(out, argsHandler);
160         Binder binder   = new Binder(argsHandler, logHandler);
161 
162         waitTime        = argsHandler.getWaitTime() * 60000;
163 
164         try {
165             log2(&quot;launching a debuggee :&quot;);
166             log2(&quot;       &quot; + debuggeeName);
167             if (argsHandler.verbose()) {
168                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
169             } else {
170                 debuggee = binder.bindToDebugee(debuggeeName);
171             }
172             if (debuggee == null) {
</pre>
<hr />
<pre>
303             getEventSet();
304 
305             ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
306 
307             log2(&quot;String property = (String) event.request().getProperty(&#39;number&#39;);&quot;);
308             String property = (String) event.request().getProperty(&quot;number&quot;);
309 
310             if (property.equals(&quot;debuggeeClass&quot;)) {
311 
312                 log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
313 
314                 nn1++;
315                 if (nn1 &gt; 1)
316                     throw new JDITestRuntimeException(&quot;** 2-nd event for debuggeeClass **&quot;);
317 
318                 cpRequest.disable();
319                 debuggeeClass = event.referenceType();
320 
321                 String          bPointMethod = &quot;methodForCommunication&quot;;
322                 String          lineForComm  = &quot;lineForComm&quot;;
<span class="line-modified">323                 ThreadReference mainThread   = threadByName(&quot;main&quot;);</span>
324 
325                 BreakpointRequest bpRequest = settingBreakpoint(mainThread,
326                                               debuggeeClass,
327                                               bPointMethod, lineForComm, &quot;zero&quot;);
328                 bpRequest.enable();
329 
330             } else if (property.equals(&quot;TestClassPrepareRequest&quot;)) {
331                 nn2++;
332                 if (nn2 &gt; 1)
333                     throw new JDITestRuntimeException(&quot;** 2-nd event for TestClass **&quot;);
334 
335                 if (eventIterator == null) {
336                     testExitCode = FAILED;
337                     log3(&quot;ERROR: eventIterator == null&quot;);
338                 }
339                 if ( !(eventIterator instanceof Iterator) ) {
340                     testExitCode = FAILED;
341                     log3(&quot;ERROR: eventIterator is NOT instanceof Iterator&quot;);
342                 }
343             } else {
</pre>
<hr />
<pre>
350 
351         log1(&quot;     TESTING BEGINS&quot;);
352 
353         vm.resume();
354         breakpointForCommunication();
355 
356         int instruction = ((IntegerValue)
357                            (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
358 
359         if (instruction != 0) {
360             throw new JDITestRuntimeException(&quot;** instruction != 0 **&quot;);
361         }
362         vm.resume();
363             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
364             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
365 
366         log1(&quot;    TESTING ENDS&quot;);
367         return;
368     }
369 
<span class="line-removed">370     private ThreadReference threadByName(String name)</span>
<span class="line-removed">371                  throws JDITestRuntimeException {</span>
<span class="line-removed">372 </span>
<span class="line-removed">373         List         all = vm.allThreads();</span>
<span class="line-removed">374         ListIterator li  = all.listIterator();</span>
<span class="line-removed">375 </span>
<span class="line-removed">376         for (; li.hasNext(); ) {</span>
<span class="line-removed">377             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">378             if (thread.name().equals(name))</span>
<span class="line-removed">379                 return thread;</span>
<span class="line-removed">380         }</span>
<span class="line-removed">381         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">382     }</span>
<span class="line-removed">383 </span>
384    /*
385     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
386     *                                             String, String, String)
387     *
388     * It sets up a breakpoint at given line number within a given method in a given class
389     * for a given thread.
390     *
391     * Return value: BreakpointRequest object  in case of success
392     *
393     * JDITestRuntimeException   in case of an Exception thrown within the method
394     */
395 
396     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
397                                                   ReferenceType testedClass,
398                                                   String methodName,
399                                                   String bpLine,
400                                                   String property)
401             throws JDITestRuntimeException {
402 
403         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
<td>
<hr />
<pre>
127 
128     //====================================================== test program
129     //------------------------------------------------------ common section
130 
131     static Debugee          debuggee;
132     static ArgumentHandler  argsHandler;
133 
134     static int waitTime;
135 
136     static VirtualMachine      vm            = null;
137     static EventRequestManager eventRManager = null;
138     static EventQueue          eventQueue    = null;
139     static EventSet            eventSet      = null;
140     static EventIterator       eventIterator = null;
141 
142     static ReferenceType       debuggeeClass = null;
143 
144     static int  testExitCode = PASSED;
145 
146 






147 
148     //------------------------------------------------------ methods
149 
150     private int runThis (String argv[], PrintStream out) {
151 
152         argsHandler     = new ArgumentHandler(argv);
153         logHandler      = new Log(out, argsHandler);
154         Binder binder   = new Binder(argsHandler, logHandler);
155 
156         waitTime        = argsHandler.getWaitTime() * 60000;
157 
158         try {
159             log2(&quot;launching a debuggee :&quot;);
160             log2(&quot;       &quot; + debuggeeName);
161             if (argsHandler.verbose()) {
162                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
163             } else {
164                 debuggee = binder.bindToDebugee(debuggeeName);
165             }
166             if (debuggee == null) {
</pre>
<hr />
<pre>
297             getEventSet();
298 
299             ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
300 
301             log2(&quot;String property = (String) event.request().getProperty(&#39;number&#39;);&quot;);
302             String property = (String) event.request().getProperty(&quot;number&quot;);
303 
304             if (property.equals(&quot;debuggeeClass&quot;)) {
305 
306                 log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
307 
308                 nn1++;
309                 if (nn1 &gt; 1)
310                     throw new JDITestRuntimeException(&quot;** 2-nd event for debuggeeClass **&quot;);
311 
312                 cpRequest.disable();
313                 debuggeeClass = event.referenceType();
314 
315                 String          bPointMethod = &quot;methodForCommunication&quot;;
316                 String          lineForComm  = &quot;lineForComm&quot;;
<span class="line-modified">317                 ThreadReference mainThread   = debuggee.threadByNameOrThrow(&quot;main&quot;);</span>
318 
319                 BreakpointRequest bpRequest = settingBreakpoint(mainThread,
320                                               debuggeeClass,
321                                               bPointMethod, lineForComm, &quot;zero&quot;);
322                 bpRequest.enable();
323 
324             } else if (property.equals(&quot;TestClassPrepareRequest&quot;)) {
325                 nn2++;
326                 if (nn2 &gt; 1)
327                     throw new JDITestRuntimeException(&quot;** 2-nd event for TestClass **&quot;);
328 
329                 if (eventIterator == null) {
330                     testExitCode = FAILED;
331                     log3(&quot;ERROR: eventIterator == null&quot;);
332                 }
333                 if ( !(eventIterator instanceof Iterator) ) {
334                     testExitCode = FAILED;
335                     log3(&quot;ERROR: eventIterator is NOT instanceof Iterator&quot;);
336                 }
337             } else {
</pre>
<hr />
<pre>
344 
345         log1(&quot;     TESTING BEGINS&quot;);
346 
347         vm.resume();
348         breakpointForCommunication();
349 
350         int instruction = ((IntegerValue)
351                            (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
352 
353         if (instruction != 0) {
354             throw new JDITestRuntimeException(&quot;** instruction != 0 **&quot;);
355         }
356         vm.resume();
357             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
358             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
359 
360         log1(&quot;    TESTING ENDS&quot;);
361         return;
362     }
363 














364    /*
365     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
366     *                                             String, String, String)
367     *
368     * It sets up a breakpoint at given line number within a given method in a given class
369     * for a given thread.
370     *
371     * Return value: BreakpointRequest object  in case of success
372     *
373     * JDITestRuntimeException   in case of an Exception thrown within the method
374     */
375 
376     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
377                                                   ReferenceType testedClass,
378                                                   String methodName,
379                                                   String bpLine,
380                                                   String property)
381             throws JDITestRuntimeException {
382 
383         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../../EventRequestManager/vmDeathRequests/vmdeathreq001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="eventiterator002.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>