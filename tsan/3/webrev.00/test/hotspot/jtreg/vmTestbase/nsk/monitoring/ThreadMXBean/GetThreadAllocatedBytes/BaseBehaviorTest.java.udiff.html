<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/vmTestbase/nsk/monitoring/ThreadMXBean/GetThreadAllocatedBytes/BaseBehaviorTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="BaseBehaviorTest.README.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../share/server/ServerThreadMXBeanNew.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/monitoring/ThreadMXBean/GetThreadAllocatedBytes/BaseBehaviorTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -25,11 +25,12 @@</span>
  import nsk.share.*;
  import nsk.monitoring.share.*;
  import nsk.monitoring.ThreadMXBean.*;
  
  /**
<span class="udiff-line-modified-removed">-  * Tests getThreadAllocatedBytes(long id) and  getThreadAllocatedBytes(long[] ids),</span>
<span class="udiff-line-modified-added">+  * Tests getCurrentThreadAllocatedBytes(), getThreadAllocatedBytes(long id).</span>
<span class="udiff-line-added">+  * and getThreadAllocatedBytes(long[] ids),</span>
   * functions of com.sun.management.ThreadMXBean
   * &lt;p&gt;
   * All methods should
   * &lt;br&gt;
   * -  return -1 if ThreadAllocatedMemory allocation is
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -47,15 +48,35 @@</span>
       * Actually runs the test
       */
      public void run() {
          if (threadMXBean == null)
              return;
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // Expect -1 if thread allocated memory is disabled</span>
<span class="udiff-line-added">+         threadMXBean.setThreadAllocatedMemoryEnabled(false);</span>
<span class="udiff-line-added">+         long result = threadMXBean.getCurrentThreadAllocatedBytes();</span>
<span class="udiff-line-added">+         if (result != -1)</span>
<span class="udiff-line-added">+             throw new TestFailure(&quot;Failure! getCurrentThreadAllocatedBytes() should &quot;</span>
<span class="udiff-line-added">+                     + &quot;return -1 if ThreadAllocatedMemoryEnabled is set to false. &quot;</span>
<span class="udiff-line-added">+                     + &quot;Received : &quot; + result);</span>
<span class="udiff-line-added">+         threadMXBean.setThreadAllocatedMemoryEnabled(true);</span>
<span class="udiff-line-added">+         // Expect &gt;= 0 value for current thread</span>
<span class="udiff-line-added">+         result = threadMXBean.getCurrentThreadAllocatedBytes();</span>
<span class="udiff-line-added">+         if (result &lt; 0)</span>
<span class="udiff-line-added">+             throw new TestFailure(&quot;Failure! getCurrentThreadAllocatedBytes() should &quot;</span>
<span class="udiff-line-added">+                     + &quot;return &gt;= 0 value for current thread. Received : &quot; + result);</span>
<span class="udiff-line-added">+         // Expect &gt;= 0 value for current thread from getThreadAllocatedBytes(id)</span>
<span class="udiff-line-added">+         result = threadMXBean.getThreadAllocatedBytes(Thread.currentThread().getId());</span>
<span class="udiff-line-added">+         if (result &lt; 0)</span>
<span class="udiff-line-added">+             throw new TestFailure(&quot;Failure! getThreadAllocatedBytes(id) should &quot;</span>
<span class="udiff-line-added">+                     + &quot;return &gt;= 0 value for current thread. Received : &quot; + result);</span>
<span class="udiff-line-added">+ </span>
          MXBeanTestThread thread = new MXBeanTestThread();
          long id = thread.getId();
          long[] idArr = new long[] { id };
<span class="udiff-line-removed">-         long result;</span>
          long[] resultArr;
<span class="udiff-line-added">+ </span>
          // Expect -1 for not started threads
          result = threadMXBean.getThreadAllocatedBytes(id);
          if (result != -1)
              throw new TestFailure(&quot;Failure! getThreadAllocatedBytes(long id) should &quot;
                      + &quot;return -1 for not started threads. Recieved : &quot; + result);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -78,11 +99,11 @@</span>
                  throw new TestFailure(&quot;Failure! getThreadAllocatedBytes(long[] ids) should &quot;
                      + &quot;return -1 if ThreadAllocatedMemoryEnabled is set to false. &quot;
                      + &quot;Recieved : &quot; + resultArr[0]);
  
              threadMXBean.setThreadAllocatedMemoryEnabled(true);
<span class="udiff-line-modified-removed">-             // Expect &gt; 0 value for running threads</span>
<span class="udiff-line-modified-added">+             // Expect &gt;= 0 value for running threads</span>
              result = threadMXBean.getThreadAllocatedBytes(id);
              if (result &lt; 0)
              throw new TestFailure(&quot;Failure! getThreadAllocatedBytes(long id) should &quot;
                      + &quot;return &gt; 0 value for RUNNING thread. Recieved : &quot; + result);
              resultArr = threadMXBean.getThreadAllocatedBytes(idArr);
</pre>
<center><a href="BaseBehaviorTest.README.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../share/server/ServerThreadMXBeanNew.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>