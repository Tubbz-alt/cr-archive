<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/EventRequest/setEnabled/setenabled001.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../putProperty/putproperty001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="setenabled002.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/EventRequest/setEnabled/setenabled001.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
133 
134     //====================================================== test program
135     //------------------------------------------------------ common section
136 
137     static Debugee          debuggee;
138     static ArgumentHandler  argsHandler;
139 
140     static int waitTime;
141 
142     static VirtualMachine      vm            = null;
143     static EventRequestManager eventRManager = null;
144     static EventQueue          eventQueue    = null;
145     static EventSet            eventSet      = null;
146     static EventIterator       eventIterator = null;
147 
148     static ReferenceType       debuggeeClass = null;
149 
150     static int  testExitCode = PASSED;
151 
152 
<span class="line-removed">153     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">154         JDITestRuntimeException(String str) {</span>
<span class="line-removed">155             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">156         }</span>
<span class="line-removed">157     }</span>
<span class="line-removed">158 </span>
159     //------------------------------------------------------ methods
160 
161     private int runThis (String argv[], PrintStream out) {
162 
163         argsHandler     = new ArgumentHandler(argv);
164         logHandler      = new Log(out, argsHandler);
165         Binder binder   = new Binder(argsHandler, logHandler);
166 
167         waitTime        = argsHandler.getWaitTime() * 60000;
168 
169         try {
170             log2(&quot;launching a debuggee :&quot;);
171             log2(&quot;       &quot; + debuggeeName);
172             if (argsHandler.verbose()) {
173                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
174             } else {
175                 debuggee = binder.bindToDebugee(debuggeeName);
176             }
177             if (debuggee == null) {
178                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
281         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
282         cpRequest.setSuspendPolicy( EventRequest.SUSPEND_EVENT_THREAD);
283         cpRequest.addClassFilter(debuggeeName);
284 
285         cpRequest.enable();
286         vm.resume();
287         getEventSet();
288         cpRequest.disable();
289 
290         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
291         debuggeeClass = event.referenceType();
292 
293         if (!debuggeeClass.name().equals(debuggeeName))
294            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
295 
296         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
297 
298         String bPointMethod = &quot;methodForCommunication&quot;;
299         String lineForComm  = &quot;lineForComm&quot;;
300 
<span class="line-modified">301         ThreadReference   mainThread = threadByName(&quot;main&quot;);</span>
302 
303         BreakpointRequest bpRequest = settingBreakpoint(mainThread,
304                                              debuggeeClass,
305                                             bPointMethod, lineForComm, &quot;zero&quot;);
306         bpRequest.enable();
307 
308     //------------------------------------------------------  testing section
309 
310 
311         EventRequest  eventRequest1 = null;
312 
313         String        fieldName1    = &quot;var101&quot;;
314         String        fieldName2    = &quot;excObj&quot;;
315 
316         ThreadReference thread1     = null;
317         String          threadName1 = &quot;thread1&quot;;
318 
319         ReferenceType testClassReference = null;
320 
321 
</pre>
<hr />
<pre>
325 
326             vm.resume();
327             breakpointForCommunication();
328 
329             int instruction = ((IntegerValue)
330                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
331 
332             if (instruction == 0) {
333                 vm.resume();
334                 break;
335             }
336 
337             log1(&quot;:::::: case: # &quot; + i);
338 
339             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
340 
341 
342             switch (i) {
343 
344               case 0:
<span class="line-modified">345                      thread1 = threadByName(threadName1);</span>
346 
347                      log2(&quot;......setting up StepRequest&quot;);
348                      eventRequest1 = eventRManager.createStepRequest
349                                      (thread1, StepRequest.STEP_MIN, StepRequest.STEP_INTO);
350                      break;
351 
352               case 1:
353                      testClassReference = (ReferenceType) vm.classesByName(testedClassName).get(0);
354 
355                      log2(&quot;......setting up AccessWatchpointRequest&quot;);
356                      eventRequest1 = eventRManager.createAccessWatchpointRequest
357                                     (testClassReference.fieldByName(fieldName1));
358                      break;
359 
360               case 2:
361                      log2(&quot;.....setting up ModificationWatchpointRequest&quot;);
362                      eventRequest1 = eventRManager.createModificationWatchpointRequest
363                                     (testClassReference.fieldByName(fieldName1));
364                      break;
365 
</pre>
<hr />
<pre>
422             if ( !eventRequest1.isEnabled() ) {
423                 testExitCode = FAILED;
424                 log3(&quot;ERROR: EventRequest is not enabled&quot;);
425             }
426 
427             log2(&quot;......eventRequest1.setEnable(false);&quot;);
428             eventRequest1.setEnabled(false);
429             log2(&quot;      checking up on eventRequest1&quot;);
430             if ( eventRequest1.isEnabled() ) {
431                 testExitCode = FAILED;
432                 log3(&quot;ERROR: EventRequest is enabled&quot;);
433             }
434 
435 
436             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
437         }
438         log1(&quot;    TESTING ENDS&quot;);
439         return;
440     }
441 
<span class="line-removed">442     private ThreadReference threadByName(String name)</span>
<span class="line-removed">443                  throws JDITestRuntimeException {</span>
<span class="line-removed">444 </span>
<span class="line-removed">445         List         all = vm.allThreads();</span>
<span class="line-removed">446         ListIterator li  = all.listIterator();</span>
<span class="line-removed">447 </span>
<span class="line-removed">448         for (; li.hasNext(); ) {</span>
<span class="line-removed">449             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">450             if (thread.name().equals(name))</span>
<span class="line-removed">451                 return thread;</span>
<span class="line-removed">452         }</span>
<span class="line-removed">453         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">454     }</span>
<span class="line-removed">455 </span>
456    /*
457     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
458     *                                             String, String, String)
459     *
460     * It sets up a breakpoint at given line number within a given method in a given class
461     * for a given thread.
462     *
463     * Return value: BreakpointRequest object  in case of success
464     *
465     * JDITestRuntimeException   in case of an Exception thrown within the method
466     */
467 
468     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
469                                                   ReferenceType testedClass,
470                                                   String methodName,
471                                                   String bpLine,
472                                                   String property)
473             throws JDITestRuntimeException {
474 
475         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
<td>
<hr />
<pre>
133 
134     //====================================================== test program
135     //------------------------------------------------------ common section
136 
137     static Debugee          debuggee;
138     static ArgumentHandler  argsHandler;
139 
140     static int waitTime;
141 
142     static VirtualMachine      vm            = null;
143     static EventRequestManager eventRManager = null;
144     static EventQueue          eventQueue    = null;
145     static EventSet            eventSet      = null;
146     static EventIterator       eventIterator = null;
147 
148     static ReferenceType       debuggeeClass = null;
149 
150     static int  testExitCode = PASSED;
151 
152 






153     //------------------------------------------------------ methods
154 
155     private int runThis (String argv[], PrintStream out) {
156 
157         argsHandler     = new ArgumentHandler(argv);
158         logHandler      = new Log(out, argsHandler);
159         Binder binder   = new Binder(argsHandler, logHandler);
160 
161         waitTime        = argsHandler.getWaitTime() * 60000;
162 
163         try {
164             log2(&quot;launching a debuggee :&quot;);
165             log2(&quot;       &quot; + debuggeeName);
166             if (argsHandler.verbose()) {
167                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
168             } else {
169                 debuggee = binder.bindToDebugee(debuggeeName);
170             }
171             if (debuggee == null) {
172                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
275         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
276         cpRequest.setSuspendPolicy( EventRequest.SUSPEND_EVENT_THREAD);
277         cpRequest.addClassFilter(debuggeeName);
278 
279         cpRequest.enable();
280         vm.resume();
281         getEventSet();
282         cpRequest.disable();
283 
284         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
285         debuggeeClass = event.referenceType();
286 
287         if (!debuggeeClass.name().equals(debuggeeName))
288            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
289 
290         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
291 
292         String bPointMethod = &quot;methodForCommunication&quot;;
293         String lineForComm  = &quot;lineForComm&quot;;
294 
<span class="line-modified">295         ThreadReference   mainThread = debuggee.threadByNameOrThrow(&quot;main&quot;);</span>
296 
297         BreakpointRequest bpRequest = settingBreakpoint(mainThread,
298                                              debuggeeClass,
299                                             bPointMethod, lineForComm, &quot;zero&quot;);
300         bpRequest.enable();
301 
302     //------------------------------------------------------  testing section
303 
304 
305         EventRequest  eventRequest1 = null;
306 
307         String        fieldName1    = &quot;var101&quot;;
308         String        fieldName2    = &quot;excObj&quot;;
309 
310         ThreadReference thread1     = null;
311         String          threadName1 = &quot;thread1&quot;;
312 
313         ReferenceType testClassReference = null;
314 
315 
</pre>
<hr />
<pre>
319 
320             vm.resume();
321             breakpointForCommunication();
322 
323             int instruction = ((IntegerValue)
324                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
325 
326             if (instruction == 0) {
327                 vm.resume();
328                 break;
329             }
330 
331             log1(&quot;:::::: case: # &quot; + i);
332 
333             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
334 
335 
336             switch (i) {
337 
338               case 0:
<span class="line-modified">339                      thread1 = debuggee.threadByNameOrThrow(threadName1);</span>
340 
341                      log2(&quot;......setting up StepRequest&quot;);
342                      eventRequest1 = eventRManager.createStepRequest
343                                      (thread1, StepRequest.STEP_MIN, StepRequest.STEP_INTO);
344                      break;
345 
346               case 1:
347                      testClassReference = (ReferenceType) vm.classesByName(testedClassName).get(0);
348 
349                      log2(&quot;......setting up AccessWatchpointRequest&quot;);
350                      eventRequest1 = eventRManager.createAccessWatchpointRequest
351                                     (testClassReference.fieldByName(fieldName1));
352                      break;
353 
354               case 2:
355                      log2(&quot;.....setting up ModificationWatchpointRequest&quot;);
356                      eventRequest1 = eventRManager.createModificationWatchpointRequest
357                                     (testClassReference.fieldByName(fieldName1));
358                      break;
359 
</pre>
<hr />
<pre>
416             if ( !eventRequest1.isEnabled() ) {
417                 testExitCode = FAILED;
418                 log3(&quot;ERROR: EventRequest is not enabled&quot;);
419             }
420 
421             log2(&quot;......eventRequest1.setEnable(false);&quot;);
422             eventRequest1.setEnabled(false);
423             log2(&quot;      checking up on eventRequest1&quot;);
424             if ( eventRequest1.isEnabled() ) {
425                 testExitCode = FAILED;
426                 log3(&quot;ERROR: EventRequest is enabled&quot;);
427             }
428 
429 
430             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
431         }
432         log1(&quot;    TESTING ENDS&quot;);
433         return;
434     }
435 














436    /*
437     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
438     *                                             String, String, String)
439     *
440     * It sets up a breakpoint at given line number within a given method in a given class
441     * for a given thread.
442     *
443     * Return value: BreakpointRequest object  in case of success
444     *
445     * JDITestRuntimeException   in case of an Exception thrown within the method
446     */
447 
448     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
449                                                   ReferenceType testedClass,
450                                                   String methodName,
451                                                   String bpLine,
452                                                   String property)
453             throws JDITestRuntimeException {
454 
455         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../putProperty/putproperty001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="setenabled002.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>