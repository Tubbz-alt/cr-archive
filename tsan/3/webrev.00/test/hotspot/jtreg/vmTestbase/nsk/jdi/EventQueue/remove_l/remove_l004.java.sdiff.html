<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/EventQueue/remove_l/remove_l004.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../remove/remove004/TestDescription.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="remove_l004/TestDescription.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/EventQueue/remove_l/remove_l004.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
123     //====================================================== test program
124     //------------------------------------------------------ common section
125 
126     static Debugee          debuggee;
127     static ArgumentHandler  argsHandler;
128 
129     static long waitTime;
130 
131     static VirtualMachine      vm            = null;
132     static EventRequestManager eventRManager = null;
133     static EventQueue          eventQueue    = null;
134     static EventSet            eventSet      = null;
135     static EventIterator       eventIterator = null;
136 
137     static ReferenceType       debuggeeClass = null;
138 
139     static Value trueValue;
140 
141     static int  testExitCode = PASSED;
142 
<span class="line-removed">143     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">144         JDITestRuntimeException(String str) {</span>
<span class="line-removed">145             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">146         }</span>
<span class="line-removed">147     }</span>
<span class="line-removed">148 </span>
149     //------------------------------------------------------ methods
150 
151     private int runThis (String argv[], PrintStream out) {
152 
153         argsHandler     = new ArgumentHandler(argv);
154         logHandler      = new Log(out, argsHandler);
155         Binder binder   = new Binder(argsHandler, logHandler);
156 
157         waitTime        = Utils.adjustTimeout(argsHandler.getWaitTime() * 1000);
158 
159         try {
160             log2(&quot;launching a debuggee :&quot;);
161             log2(&quot;       &quot; + debuggeeName);
162             if (argsHandler.verbose()) {
163                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
164             } else {
165                 debuggee = binder.bindToDebugee(debuggeeName);
166             }
167             if (debuggee == null) {
168                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
275         cpRequest.enable();
276         vm.resume();
277         getEventSet();
278         cpRequest.disable();
279 
280         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
281         debuggeeClass = event.referenceType();
282 
283         if (!debuggeeClass.name().equals(debuggeeName))
284            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
285 
286         trueValue = debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;BOOLEAN_TRUE_VALUE&quot;));
287 
288         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
289 
290         String bPointMethod = &quot;methodForCommunication&quot;;
291         String lineForComm  = &quot;lineForComm&quot;;
292         BreakpointRequest bpRequest;
293 
294         try {
<span class="line-modified">295             bpRequest = settingBreakpoint(threadByName(&quot;main&quot;),</span>
296                                           debuggeeClass,
297                                           bPointMethod, lineForComm, &quot;zero&quot;);
298         } catch ( Exception e ) {
299             throw e;
300         }
301         bpRequest.enable();
302 
303     //------------------------------------------------------  testing section
304 
305         log1(&quot;     TESTING BEGINS&quot;);
306 
307 
308             vm.resume();
309             breakpointForCommunication();
310 
311             int instruction = ((IntegerValue)
312                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
313 
314             if (instruction != 1) {
315                 testExitCode = FAILED;
</pre>
<hr />
<pre>
337 
338             }
339             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
340 
341             log2(&quot;...... waiting for breakpoint event&quot;);
342 
343             breakpointForCommunication();
344 
345             instruction = ((IntegerValue)
346                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
347             if (instruction != 0) {
348                 testExitCode = FAILED;
349                 throw new JDITestRuntimeException(&quot;** unexpected instruction **&quot;);
350             }
351             vm.resume();
352 
353         log1(&quot;    TESTING ENDS&quot;);
354         return;
355     }
356 
<span class="line-removed">357     private ThreadReference threadByName(String name)</span>
<span class="line-removed">358                  throws JDITestRuntimeException {</span>
<span class="line-removed">359 </span>
<span class="line-removed">360         List         all = vm.allThreads();</span>
<span class="line-removed">361         ListIterator li  = all.listIterator();</span>
<span class="line-removed">362 </span>
<span class="line-removed">363         for (; li.hasNext(); ) {</span>
<span class="line-removed">364             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">365             if (thread.name().equals(name))</span>
<span class="line-removed">366                 return thread;</span>
<span class="line-removed">367         }</span>
<span class="line-removed">368         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">369     }</span>
<span class="line-removed">370 </span>
371    /*
372     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
373     *                                             String, String, String)
374     *
375     * It sets up a breakpoint at given line number within a given method in a given class
376     * for a given thread.
377     *
378     * Return value: BreakpointRequest object  in case of success
379     *
380     * JDITestRuntimeException   in case of an Exception thrown within the method
381     */
382 
383     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
384                                                   ReferenceType testedClass,
385                                                   String methodName,
386                                                   String bpLine,
387                                                   String property)
388             throws JDITestRuntimeException {
389 
390         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
<td>
<hr />
<pre>
123     //====================================================== test program
124     //------------------------------------------------------ common section
125 
126     static Debugee          debuggee;
127     static ArgumentHandler  argsHandler;
128 
129     static long waitTime;
130 
131     static VirtualMachine      vm            = null;
132     static EventRequestManager eventRManager = null;
133     static EventQueue          eventQueue    = null;
134     static EventSet            eventSet      = null;
135     static EventIterator       eventIterator = null;
136 
137     static ReferenceType       debuggeeClass = null;
138 
139     static Value trueValue;
140 
141     static int  testExitCode = PASSED;
142 






143     //------------------------------------------------------ methods
144 
145     private int runThis (String argv[], PrintStream out) {
146 
147         argsHandler     = new ArgumentHandler(argv);
148         logHandler      = new Log(out, argsHandler);
149         Binder binder   = new Binder(argsHandler, logHandler);
150 
151         waitTime        = Utils.adjustTimeout(argsHandler.getWaitTime() * 1000);
152 
153         try {
154             log2(&quot;launching a debuggee :&quot;);
155             log2(&quot;       &quot; + debuggeeName);
156             if (argsHandler.verbose()) {
157                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
158             } else {
159                 debuggee = binder.bindToDebugee(debuggeeName);
160             }
161             if (debuggee == null) {
162                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
269         cpRequest.enable();
270         vm.resume();
271         getEventSet();
272         cpRequest.disable();
273 
274         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
275         debuggeeClass = event.referenceType();
276 
277         if (!debuggeeClass.name().equals(debuggeeName))
278            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
279 
280         trueValue = debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;BOOLEAN_TRUE_VALUE&quot;));
281 
282         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
283 
284         String bPointMethod = &quot;methodForCommunication&quot;;
285         String lineForComm  = &quot;lineForComm&quot;;
286         BreakpointRequest bpRequest;
287 
288         try {
<span class="line-modified">289             bpRequest = settingBreakpoint(debuggee.threadByNameOrThrow(&quot;main&quot;),</span>
290                                           debuggeeClass,
291                                           bPointMethod, lineForComm, &quot;zero&quot;);
292         } catch ( Exception e ) {
293             throw e;
294         }
295         bpRequest.enable();
296 
297     //------------------------------------------------------  testing section
298 
299         log1(&quot;     TESTING BEGINS&quot;);
300 
301 
302             vm.resume();
303             breakpointForCommunication();
304 
305             int instruction = ((IntegerValue)
306                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
307 
308             if (instruction != 1) {
309                 testExitCode = FAILED;
</pre>
<hr />
<pre>
331 
332             }
333             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
334 
335             log2(&quot;...... waiting for breakpoint event&quot;);
336 
337             breakpointForCommunication();
338 
339             instruction = ((IntegerValue)
340                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
341             if (instruction != 0) {
342                 testExitCode = FAILED;
343                 throw new JDITestRuntimeException(&quot;** unexpected instruction **&quot;);
344             }
345             vm.resume();
346 
347         log1(&quot;    TESTING ENDS&quot;);
348         return;
349     }
350 














351    /*
352     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
353     *                                             String, String, String)
354     *
355     * It sets up a breakpoint at given line number within a given method in a given class
356     * for a given thread.
357     *
358     * Return value: BreakpointRequest object  in case of success
359     *
360     * JDITestRuntimeException   in case of an Exception thrown within the method
361     */
362 
363     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
364                                                   ReferenceType testedClass,
365                                                   String methodName,
366                                                   String bpLine,
367                                                   String property)
368             throws JDITestRuntimeException {
369 
370         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../remove/remove004/TestDescription.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="remove_l004/TestDescription.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>