<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/EventSet/resume/resume012.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="resume011.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resume013.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/EventSet/resume/resume012.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
126 
127     //====================================================== test program
128     //------------------------------------------------------ common section
129 
130     static Debugee          debuggee;
131     static ArgumentHandler  argsHandler;
132 
133     static int waitTime;
134 
135     static VirtualMachine      vm            = null;
136     static EventRequestManager eventRManager = null;
137     static EventQueue          eventQueue    = null;
138     static EventSet            eventSet      = null;
139     static EventIterator       eventIterator = null;
140 
141     static ReferenceType       debuggeeClass = null;
142 
143     static int  testExitCode = PASSED;
144 
145 
<span class="line-removed">146     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">147         JDITestRuntimeException(String str) {</span>
<span class="line-removed">148             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">149         }</span>
<span class="line-removed">150     }</span>
<span class="line-removed">151 </span>
152     //------------------------------------------------------ methods
153 
154     private int runThis (String argv[], PrintStream out) {
155 
156         argsHandler     = new ArgumentHandler(argv);
157         logHandler      = new Log(out, argsHandler);
158         Binder binder   = new Binder(argsHandler, logHandler);
159 
160         waitTime        = argsHandler.getWaitTime() * 60000;
161 
162         try {
163             log2(&quot;launching a debuggee :&quot;);
164             log2(&quot;       &quot; + debuggeeName);
165             if (argsHandler.verbose()) {
166                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
167             } else {
168                 debuggee = binder.bindToDebugee(debuggeeName);
169             }
170             if (debuggee == null) {
171                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
291         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
292         cpRequest.setSuspendPolicy( EventRequest.SUSPEND_EVENT_THREAD);
293         cpRequest.addClassFilter(debuggeeName);
294 
295         cpRequest.enable();
296         vm.resume();
297         getEventSet();
298         cpRequest.disable();
299 
300         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
301         debuggeeClass = event.referenceType();
302 
303         if (!debuggeeClass.name().equals(debuggeeName))
304            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
305 
306         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
307 
308         String bPointMethod = &quot;methodForCommunication&quot;;
309         String lineForComm  = &quot;lineForComm&quot;;
310         BreakpointRequest bpRequest;
<span class="line-modified">311         ThreadReference   mainThread = threadByName(&quot;main&quot;);</span>
312         bpRequest = settingBreakpoint(mainThread,
313                                       debuggeeClass,
314                                       bPointMethod, lineForComm, &quot;zero&quot;);
315         bpRequest.enable();
316 
317         vm.resume();
318 
319     //------------------------------------------------------  testing section
320 
321         log1(&quot;     TESTING BEGINS&quot;);
322 
323 //        EventRequest eventRequest1 = null;
324         EventRequest eventRequest2 = null;
325 //        EventRequest eventRequest3 = null;
326 
327         final int SUSPEND_NONE   = EventRequest.SUSPEND_NONE;
328         final int SUSPEND_THREAD = EventRequest.SUSPEND_EVENT_THREAD;
329         final int SUSPEND_ALL    = EventRequest.SUSPEND_ALL;
330 
331 
332 
333         breakpointForCommunication();
334 
335             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
336 
337         eventRequest2 = settingVMDeathRequest ( SUSPEND_THREAD, &quot;VMDeathRequest2&quot;);
338         eventRequest2.enable();
339 
340         mainThread.resume();
341 
342             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
343 
344         log1(&quot;    TESTING ENDS&quot;);
345         return;
346     }
347 
<span class="line-removed">348     private ThreadReference threadByName(String name)</span>
<span class="line-removed">349                  throws JDITestRuntimeException {</span>
<span class="line-removed">350 </span>
<span class="line-removed">351         List         all = vm.allThreads();</span>
<span class="line-removed">352         ListIterator li  = all.listIterator();</span>
<span class="line-removed">353 </span>
<span class="line-removed">354         for (; li.hasNext(); ) {</span>
<span class="line-removed">355             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">356             if (thread.name().equals(name))</span>
<span class="line-removed">357                 return thread;</span>
<span class="line-removed">358         }</span>
<span class="line-removed">359         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">360     }</span>
<span class="line-removed">361 </span>
362    /*
363     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
364     *                                             String, String, String)
365     *
366     * It sets up a breakpoint at given line number within a given method in a given class
367     * for a given thread.
368     *
369     * Return value: BreakpointRequest object  in case of success
370     *
371     * JDITestRuntimeException   in case of an Exception thrown within the method
372     */
373 
374     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
375                                                   ReferenceType testedClass,
376                                                   String methodName,
377                                                   String bpLine,
378                                                   String property)
379             throws JDITestRuntimeException {
380 
381         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
<td>
<hr />
<pre>
126 
127     //====================================================== test program
128     //------------------------------------------------------ common section
129 
130     static Debugee          debuggee;
131     static ArgumentHandler  argsHandler;
132 
133     static int waitTime;
134 
135     static VirtualMachine      vm            = null;
136     static EventRequestManager eventRManager = null;
137     static EventQueue          eventQueue    = null;
138     static EventSet            eventSet      = null;
139     static EventIterator       eventIterator = null;
140 
141     static ReferenceType       debuggeeClass = null;
142 
143     static int  testExitCode = PASSED;
144 
145 






146     //------------------------------------------------------ methods
147 
148     private int runThis (String argv[], PrintStream out) {
149 
150         argsHandler     = new ArgumentHandler(argv);
151         logHandler      = new Log(out, argsHandler);
152         Binder binder   = new Binder(argsHandler, logHandler);
153 
154         waitTime        = argsHandler.getWaitTime() * 60000;
155 
156         try {
157             log2(&quot;launching a debuggee :&quot;);
158             log2(&quot;       &quot; + debuggeeName);
159             if (argsHandler.verbose()) {
160                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
161             } else {
162                 debuggee = binder.bindToDebugee(debuggeeName);
163             }
164             if (debuggee == null) {
165                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
285         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
286         cpRequest.setSuspendPolicy( EventRequest.SUSPEND_EVENT_THREAD);
287         cpRequest.addClassFilter(debuggeeName);
288 
289         cpRequest.enable();
290         vm.resume();
291         getEventSet();
292         cpRequest.disable();
293 
294         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
295         debuggeeClass = event.referenceType();
296 
297         if (!debuggeeClass.name().equals(debuggeeName))
298            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
299 
300         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
301 
302         String bPointMethod = &quot;methodForCommunication&quot;;
303         String lineForComm  = &quot;lineForComm&quot;;
304         BreakpointRequest bpRequest;
<span class="line-modified">305         ThreadReference   mainThread = debuggee.threadByNameOrThrow(&quot;main&quot;);</span>
306         bpRequest = settingBreakpoint(mainThread,
307                                       debuggeeClass,
308                                       bPointMethod, lineForComm, &quot;zero&quot;);
309         bpRequest.enable();
310 
311         vm.resume();
312 
313     //------------------------------------------------------  testing section
314 
315         log1(&quot;     TESTING BEGINS&quot;);
316 
317 //        EventRequest eventRequest1 = null;
318         EventRequest eventRequest2 = null;
319 //        EventRequest eventRequest3 = null;
320 
321         final int SUSPEND_NONE   = EventRequest.SUSPEND_NONE;
322         final int SUSPEND_THREAD = EventRequest.SUSPEND_EVENT_THREAD;
323         final int SUSPEND_ALL    = EventRequest.SUSPEND_ALL;
324 
325 
326 
327         breakpointForCommunication();
328 
329             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
330 
331         eventRequest2 = settingVMDeathRequest ( SUSPEND_THREAD, &quot;VMDeathRequest2&quot;);
332         eventRequest2.enable();
333 
334         mainThread.resume();
335 
336             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
337 
338         log1(&quot;    TESTING ENDS&quot;);
339         return;
340     }
341 














342    /*
343     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
344     *                                             String, String, String)
345     *
346     * It sets up a breakpoint at given line number within a given method in a given class
347     * for a given thread.
348     *
349     * Return value: BreakpointRequest object  in case of success
350     *
351     * JDITestRuntimeException   in case of an Exception thrown within the method
352     */
353 
354     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
355                                                   ReferenceType testedClass,
356                                                   String methodName,
357                                                   String bpLine,
358                                                   String property)
359             throws JDITestRuntimeException {
360 
361         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="resume011.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="resume013.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>