<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/Event/request/request001.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../DoubleType/_itself_/doubletype001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../EventIterator/nextEvent/nextevent001.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/Event/request/request001.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
151 
152     //====================================================== test program
153     //------------------------------------------------------ common section
154 
155     static Debugee          debuggee;
156     static ArgumentHandler  argsHandler;
157 
158     static int waitTime;
159 
160     static VirtualMachine      vm            = null;
161     static EventRequestManager eventRManager = null;
162     static EventQueue          eventQueue    = null;
163     static EventSet            eventSet      = null;
164     static EventIterator       eventIterator = null;
165 
166     static ReferenceType       debuggeeClass = null;
167 
168     static int  testExitCode = PASSED;
169 
170 
<span class="line-removed">171     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">172         JDITestRuntimeException(String str) {</span>
<span class="line-removed">173             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">174         }</span>
<span class="line-removed">175     }</span>
<span class="line-removed">176 </span>
177 
178     //  Event #:
179     //  0-6  : AccessWatchpoint, ModificationWatchpoint, Breakpoint, Exception,
180     //         MethodEntry, MethodExit, Step
181     //  7-8  : ClassPrepare, ClassUnload
182     //  9-10 : ThreadDeath, ThreadStart
183     // 11-13 : VMDeath, VMDisconnect, VMStart
184 
185     EventSet     eventSets[] = new EventSet [14];
186     EventRequest eRequests[] = new EventRequest[14];
187 
188     int eventFlags[] = { 0,0,0,0, 0,0,0,0, 3,0,0,0, 1,1 };
189 
190     //------------------------------------------------------ methods
191 
192     private int runThis (String argv[], PrintStream out) {
193 
194         argsHandler     = new ArgumentHandler(argv);
195         logHandler      = new Log(out, argsHandler);
196         Binder binder   = new Binder(argsHandler, logHandler);
</pre>
<hr />
<pre>
344 
345         getEventSet();
346         eventSets[7] = eventSet;
347 
348         cpRequest.disable();
349 
350         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
351         debuggeeClass = event.referenceType();
352 
353         if (!debuggeeClass.name().equals(debuggeeName))
354            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
355 
356         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
357 
358         log2(&quot;......setting up ClassPrepareEvent&quot;);
359 
360         String bPointMethod = &quot;methodForCommunication&quot;;
361         String lineForComm  = &quot;lineForComm&quot;;
362         BreakpointRequest bpRequest;
363 
<span class="line-modified">364         ThreadReference mainThread = threadByName(&quot;main&quot;);</span>
365 
366         bpRequest = settingBreakpoint(mainThread,
367                                       debuggeeClass,
368                                       bPointMethod, lineForComm, &quot;zero&quot;);
369         bpRequest.enable();
370 
371     //------------------------------------------------------  testing section
372 
373         log1(&quot;     TESTING BEGINS&quot;);
374 
375         {
376             log2(&quot;...... setting up VMDeathRequest&quot;);
377             if (vm.canRequestVMDeathEvent()) {
378                 VMDeathRequest vmdr = eventRManager.createVMDeathRequest();
379                 vmdr.putProperty(&quot;number&quot;, &quot;VMDeathRequest&quot;);
380                 vmdr.setSuspendPolicy(EventRequest.SUSPEND_NONE);
381                 vmdr.enable();
382                 eRequests[11] = vmdr;
383             } else {
384                 eventFlags[11] = 2;
</pre>
<hr />
<pre>
615                     testExitCode = FAILED;
616                 } else {
617                     flagsCopy ^= flag;
618                     flags |= flag;
619                 }
620 
621                 eventSets[index] = eventSet;
622             }
623 
624             if (testExitCode == FAILED)
625                 break;
626 
627             breakpointForCommunication();
628 
629             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
630         }
631         log1(&quot;    TESTING ENDS&quot;);
632         return;
633     }
634 
<span class="line-removed">635     private ThreadReference threadByName(String name)</span>
<span class="line-removed">636                  throws JDITestRuntimeException {</span>
<span class="line-removed">637 </span>
<span class="line-removed">638         List         all = vm.allThreads();</span>
<span class="line-removed">639         ListIterator li  = all.listIterator();</span>
<span class="line-removed">640 </span>
<span class="line-removed">641         for (; li.hasNext(); ) {</span>
<span class="line-removed">642             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">643             if (thread.name().equals(name))</span>
<span class="line-removed">644                 return thread;</span>
<span class="line-removed">645         }</span>
<span class="line-removed">646         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">647     }</span>
<span class="line-removed">648 </span>
649    /*
650     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
651     *                                             String, String, String)
652     *
653     * It sets up a breakpoint at given line number within a given method in a given class
654     * for a given thread.
655     *
656     * Return value: BreakpointRequest object  in case of success
657     *
658     * JDITestRuntimeException   in case of an Exception thrown within the method
659     */
660 
661     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
662                                                   ReferenceType testedClass,
663                                                   String methodName,
664                                                   String bpLine,
665                                                   String property)
666             throws JDITestRuntimeException {
667 
668         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
<td>
<hr />
<pre>
151 
152     //====================================================== test program
153     //------------------------------------------------------ common section
154 
155     static Debugee          debuggee;
156     static ArgumentHandler  argsHandler;
157 
158     static int waitTime;
159 
160     static VirtualMachine      vm            = null;
161     static EventRequestManager eventRManager = null;
162     static EventQueue          eventQueue    = null;
163     static EventSet            eventSet      = null;
164     static EventIterator       eventIterator = null;
165 
166     static ReferenceType       debuggeeClass = null;
167 
168     static int  testExitCode = PASSED;
169 
170 






171 
172     //  Event #:
173     //  0-6  : AccessWatchpoint, ModificationWatchpoint, Breakpoint, Exception,
174     //         MethodEntry, MethodExit, Step
175     //  7-8  : ClassPrepare, ClassUnload
176     //  9-10 : ThreadDeath, ThreadStart
177     // 11-13 : VMDeath, VMDisconnect, VMStart
178 
179     EventSet     eventSets[] = new EventSet [14];
180     EventRequest eRequests[] = new EventRequest[14];
181 
182     int eventFlags[] = { 0,0,0,0, 0,0,0,0, 3,0,0,0, 1,1 };
183 
184     //------------------------------------------------------ methods
185 
186     private int runThis (String argv[], PrintStream out) {
187 
188         argsHandler     = new ArgumentHandler(argv);
189         logHandler      = new Log(out, argsHandler);
190         Binder binder   = new Binder(argsHandler, logHandler);
</pre>
<hr />
<pre>
338 
339         getEventSet();
340         eventSets[7] = eventSet;
341 
342         cpRequest.disable();
343 
344         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
345         debuggeeClass = event.referenceType();
346 
347         if (!debuggeeClass.name().equals(debuggeeName))
348            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
349 
350         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
351 
352         log2(&quot;......setting up ClassPrepareEvent&quot;);
353 
354         String bPointMethod = &quot;methodForCommunication&quot;;
355         String lineForComm  = &quot;lineForComm&quot;;
356         BreakpointRequest bpRequest;
357 
<span class="line-modified">358         ThreadReference mainThread = debuggee.threadByNameOrThrow(&quot;main&quot;);</span>
359 
360         bpRequest = settingBreakpoint(mainThread,
361                                       debuggeeClass,
362                                       bPointMethod, lineForComm, &quot;zero&quot;);
363         bpRequest.enable();
364 
365     //------------------------------------------------------  testing section
366 
367         log1(&quot;     TESTING BEGINS&quot;);
368 
369         {
370             log2(&quot;...... setting up VMDeathRequest&quot;);
371             if (vm.canRequestVMDeathEvent()) {
372                 VMDeathRequest vmdr = eventRManager.createVMDeathRequest();
373                 vmdr.putProperty(&quot;number&quot;, &quot;VMDeathRequest&quot;);
374                 vmdr.setSuspendPolicy(EventRequest.SUSPEND_NONE);
375                 vmdr.enable();
376                 eRequests[11] = vmdr;
377             } else {
378                 eventFlags[11] = 2;
</pre>
<hr />
<pre>
609                     testExitCode = FAILED;
610                 } else {
611                     flagsCopy ^= flag;
612                     flags |= flag;
613                 }
614 
615                 eventSets[index] = eventSet;
616             }
617 
618             if (testExitCode == FAILED)
619                 break;
620 
621             breakpointForCommunication();
622 
623             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
624         }
625         log1(&quot;    TESTING ENDS&quot;);
626         return;
627     }
628 














629    /*
630     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
631     *                                             String, String, String)
632     *
633     * It sets up a breakpoint at given line number within a given method in a given class
634     * for a given thread.
635     *
636     * Return value: BreakpointRequest object  in case of success
637     *
638     * JDITestRuntimeException   in case of an Exception thrown within the method
639     */
640 
641     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
642                                                   ReferenceType testedClass,
643                                                   String methodName,
644                                                   String bpLine,
645                                                   String property)
646             throws JDITestRuntimeException {
647 
648         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../../DoubleType/_itself_/doubletype001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../EventIterator/nextEvent/nextevent001.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>