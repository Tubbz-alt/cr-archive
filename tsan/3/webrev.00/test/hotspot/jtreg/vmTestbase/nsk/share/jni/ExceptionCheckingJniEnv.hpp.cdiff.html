<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/jtreg/vmTestbase/nsk/share/jni/ExceptionCheckingJniEnv.hpp</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ExceptionCheckingJniEnv.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="README.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/share/jni/ExceptionCheckingJniEnv.hpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,8 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="line-modified">!  * Copyright (c) 2018, Google and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,8 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="line-modified">!  * Copyright (c) 2018, 2019, Google and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 44,44 ***</span>
   *    ...
   *  }
   *
   *  Can be simplified to:
   * ... ExceptionCheckingJniEnv* env ...
<span class="line-modified">!  *  jclass klass = env-&gt;GetObjectClass(o);</span>
   *
   *  Where now the JNI Exception checking and the NULL return checking are done
   *  internally and will perform whatever action the ErrorHandler requires.
   *
   *  By default, the error handler describes the exception via the JNI
   *  ExceptionDescribe method and calls FatalError.
<span class="line-removed">-  *</span>
<span class="line-removed">-  *  Note: at a future date, this will also include the tracing mechanism done in</span>
<span class="line-removed">-  *  NSK_VERIFY, which will thus embed its logic into the ExceptionCheckingJniEnv</span>
<span class="line-removed">-  *  and clearing that up for the code readers and writers.</span>
   */
  class ExceptionCheckingJniEnv {
   public:
    // JNIEnv API redefinitions.
<span class="line-modified">!   jfieldID GetFieldID(jclass klass, const char *name, const char* type);</span>
<span class="line-modified">!   jclass GetObjectClass(jobject obj);</span>
<span class="line-modified">!   jobject GetObjectField(jobject obj, jfieldID field);</span>
<span class="line-modified">!   void SetObjectField(jobject obj, jfieldID field, jobject value);</span>
  
<span class="line-modified">!   jsize GetArrayLength(jarray array);</span>
<span class="line-modified">!   jsize GetStringLength(jstring str);</span>
  
<span class="line-modified">!   void* GetPrimitiveArrayCritical(jarray array, jboolean* isCopy);</span>
<span class="line-modified">!   void ReleasePrimitiveArrayCritical(jarray array, void* carray, jint mode);</span>
<span class="line-removed">-   const jchar* GetStringCritical(jstring str, jboolean* isCopy);</span>
<span class="line-removed">-   void ReleaseStringCritical(jstring str, const jchar* carray);</span>
  
<span class="line-modified">!   jobject NewGlobalRef(jobject obj);</span>
<span class="line-modified">!   void DeleteGlobalRef(jobject obj);</span>
<span class="line-modified">!   jobject NewLocalRef(jobject ref);</span>
<span class="line-modified">!   void DeleteLocalRef(jobject ref);</span>
<span class="line-removed">-   jweak NewWeakGlobalRef(jobject obj);</span>
<span class="line-removed">-   void DeleteWeakGlobalRef(jweak obj);</span>
  
    // ExceptionCheckingJniEnv methods.
    JNIEnv* GetJNIEnv() {
      return _jni_env;
    }
<span class="line-new-header">--- 44,80 ---</span>
   *    ...
   *  }
   *
   *  Can be simplified to:
   * ... ExceptionCheckingJniEnv* env ...
<span class="line-modified">!  *  jclass klass = env-&gt;GetObjectClass(o, TRACE_JNI_CALL);</span>
   *
   *  Where now the JNI Exception checking and the NULL return checking are done
   *  internally and will perform whatever action the ErrorHandler requires.
   *
<span class="line-added">+  *  Note the TRACE_JNI_CALL parameter that allows to trace where the call is</span>
<span class="line-added">+  *  happening from for debugging.</span>
<span class="line-added">+  *</span>
   *  By default, the error handler describes the exception via the JNI
   *  ExceptionDescribe method and calls FatalError.
   */
<span class="line-added">+ </span>
<span class="line-added">+ #define TRACE_JNI_CALL __LINE__, __FILE__</span>
<span class="line-added">+ #define TRACE_JNI_CALL_VARARGS(...) __LINE__, __FILE__, __VA_ARGS__</span>
<span class="line-added">+ </span>
  class ExceptionCheckingJniEnv {
   public:
    // JNIEnv API redefinitions.
<span class="line-modified">!   jclass FindClass(const char *name, int line, const char* file_name);</span>
<span class="line-modified">! </span>
<span class="line-modified">!   jfieldID GetStaticFieldID(jclass klass, const char* name, const char* type,</span>
<span class="line-modified">!                             int line, const char* file_name);</span>
<span class="line-added">+   jfieldID GetFieldID(jclass klass, const char* name, const char* type,</span>
<span class="line-added">+                       int line, const char* file_name);</span>
<span class="line-added">+   jmethodID GetStaticMethodID(jclass klass, const char* name, const char* sig,</span>
<span class="line-added">+                               int line, const char* file_name);</span>
<span class="line-added">+   jmethodID GetMethodID(jclass klass, const char* name, const char* sig,</span>
<span class="line-added">+                         int line, const char* file_name);</span>
<span class="line-added">+ </span>
<span class="line-added">+   jclass GetObjectClass(jobject obj, int line, const char* file_name);</span>
<span class="line-added">+   jobject GetObjectField(jobject obj, jfieldID field, int line, const char* file_name);</span>
<span class="line-added">+   jobject GetStaticObjectField(jclass kls, jfieldID field, int line, const char* file_name);</span>
<span class="line-added">+   void SetObjectField(jobject obj, jfieldID field, jobject value,</span>
<span class="line-added">+                       int line, const char* file_name);</span>
<span class="line-added">+ </span>
<span class="line-added">+   jsize GetArrayLength(jarray array, int line, const char* file_name);</span>
<span class="line-added">+   jsize GetStringLength(jstring str, int line, const char* file_name);</span>
<span class="line-added">+ </span>
<span class="line-added">+   void* GetPrimitiveArrayCritical(jarray array, jboolean* isCopy,</span>
<span class="line-added">+                                   int line, const char* file_name);</span>
<span class="line-added">+   void ReleasePrimitiveArrayCritical(jarray array, void* carray, jint mode,</span>
<span class="line-added">+                                      int line, const char* file_name);</span>
<span class="line-added">+   const jchar* GetStringCritical(jstring str, jboolean* isCopy,</span>
<span class="line-added">+                                  int line, const char* file_name);</span>
<span class="line-added">+   void ReleaseStringCritical(jstring str, const jchar* carray,</span>
<span class="line-added">+                              int line, const char* file_name);</span>
<span class="line-added">+ </span>
<span class="line-added">+   jbyte* GetByteArrayElements(jbyteArray array, jboolean* isCopy,</span>
<span class="line-added">+                               int line, const char* file_name);</span>
<span class="line-added">+   void ReleaseByteArrayElements(jbyteArray array, jbyte* byte_array, jint mode,</span>
<span class="line-added">+                                 int line, const char* file_name);</span>
<span class="line-added">+   jint RegisterNatives(jclass clazz, const JNINativeMethod *methods, jint nMethods,</span>
<span class="line-added">+                        int line, const char* file_name);</span>
  
<span class="line-modified">!   jobject NewObject(jclass kls, jmethodID methodID,</span>
<span class="line-modified">!                     int line, const char* file_name, ...);</span>
<span class="line-added">+   jobject NewGlobalRef(jobject obj, int line, const char* file_name);</span>
<span class="line-added">+   void DeleteGlobalRef(jobject obj, int line, const char* file_name);</span>
<span class="line-added">+   jobject NewLocalRef(jobject ref, int line, const char* file_name);</span>
<span class="line-added">+   void DeleteLocalRef(jobject ref, int line, const char* file_name);</span>
<span class="line-added">+   jweak NewWeakGlobalRef(jobject obj, int line, const char* file_name);</span>
<span class="line-added">+   void DeleteWeakGlobalRef(jweak obj, int line, const char* file_name);</span>
  
<span class="line-modified">!   jboolean IsSameObject(jobject ref1, jobject ref2, int line,</span>
<span class="line-modified">!                         const char* file_name);</span>
  
<span class="line-modified">!   jobject CallObjectMethod(jobject obj, jmethodID methodID, int line,</span>
<span class="line-modified">!                            const char* file_name, ...);</span>
<span class="line-modified">!   void CallVoidMethod(jobject obj, jmethodID methodID, int line,</span>
<span class="line-modified">!                       const char* file_name, ...);</span>
  
    // ExceptionCheckingJniEnv methods.
    JNIEnv* GetJNIEnv() {
      return _jni_env;
    }
</pre>
<center><a href="ExceptionCheckingJniEnv.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="README.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>