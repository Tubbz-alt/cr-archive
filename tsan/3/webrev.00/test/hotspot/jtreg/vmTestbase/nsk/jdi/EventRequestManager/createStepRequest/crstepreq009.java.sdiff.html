<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/EventRequestManager/createStepRequest/crstepreq009.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="crstepreq008.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="crstepreq010.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/EventRequestManager/createStepRequest/crstepreq009.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
198     //--------------------------------------------------------- test specific methods
199 
200     private StepRequest setStepRequest ( BreakpointRequest bpRequest,
201                                          String threadName,
202                                          int testCase,
203                                          String property ) {
204         StepRequest stepRequest = null;
205         for (;;) {
206             display(&quot;Wait for initial brakepoint event in &quot; + threadName);
207             BreakpointEvent bpEvent = (BreakpointEvent)waitForEvent(bpRequest);
208 
209             // check location of breakpoint event
210             int lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
211             if (lineOfEvent != lineForBreak) {
212                 complain(&quot;Wrong line number of initial brakepoint event for &quot; + threadName);
213                 complain(&quot;\texpected value : &quot; + lineForBreak + &quot;; got one : &quot; + lineOfEvent);
214                 break;
215             }
216 
217             display(&quot;Getting mirror of thread: &quot; + threadName);
<span class="line-modified">218             ThreadReference thread = threadByName(threadName);</span>
219 
220             display(&quot;Getting ReferenceType of thread: &quot; + threadName);
221             ReferenceType debuggeeThread = debuggee.classByName(debuggeeThreadName);
222 
223             // set second breakpoint to suspend checked thread at the right location before
224             // setting step request
225             BreakpointRequest bpRequest1 = setBreakpoint( thread,
226                                                          debuggeeThread,
227                                                          brakeMethods[testCase],
228                                                          checkedLines[testCase][0],
229                                                          &quot;&quot;);
230             bpRequest1.addCountFilter(1);
231             bpRequest1.enable();
232 
233             display(&quot;Wait for additional brakepoint event in &quot; + threadName);
234             bpEvent = (BreakpointEvent)waitForEvent(bpRequest1);
235 
236             // check location of breakpoint event
237             lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
238             if (lineOfEvent != checkedLines[testCase][0]) {
</pre>
<hr />
<pre>
422                 }
423             }
424         } catch (Exception e) {
425             throw new Failure(&quot;Unexpected exception while waiting for an event: &quot; + e);
426         }
427         return resultEvent;
428     }
429 
430     private void getEventSet() {
431         try {
432             eventSet = vm.eventQueue().remove(waitTime);
433             if (eventSet == null) {
434                 throw new Failure(&quot;TIMEOUT while waiting for an event&quot;);
435             }
436             eventIterator = eventSet.eventIterator();
437         } catch (Exception e) {
438             throw new Failure(&quot;getEventSet(): Unexpected exception while waiting for an event: &quot; + e);
439         }
440     }
441 
<span class="line-removed">442 </span>
<span class="line-removed">443     private ThreadReference threadByName(String name) throws Failure{</span>
<span class="line-removed">444         List all = vm.allThreads();</span>
<span class="line-removed">445         ListIterator li = all.listIterator();</span>
<span class="line-removed">446 </span>
<span class="line-removed">447         while (li.hasNext()) {</span>
<span class="line-removed">448             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">449             if (thread.name().equals(name))</span>
<span class="line-removed">450                 return thread;</span>
<span class="line-removed">451         }</span>
<span class="line-removed">452         throw new Failure(&quot;Thread with searching for name is not found: &quot; + name);</span>
<span class="line-removed">453     }</span>
<span class="line-removed">454 </span>
455     private ReferenceType waitForDebuggeeClassPrepared () {
456         display(&quot;Creating request for ClassPrepareEvent for debuggee.&quot;);
457         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
458         cpRequest.addClassFilter(debuggeeName);
459         cpRequest.addCountFilter(1);
460         cpRequest.enable();
461 
462         ClassPrepareEvent event = (ClassPrepareEvent) waitForEvent(cpRequest);
463         cpRequest.disable();
464 
465         if (!event.referenceType().name().equals(debuggeeName)) {
466            throw new Failure(&quot;Unexpected class name for ClassPrepareEvent : &quot; + debuggeeClass.name());
467         }
468         return event.referenceType();
469     }
470 
471     private int getInstruction () {
472         if (debuggeeClass == null) {
473             throw new Failure(&quot;getInstruction() :: debuggeeClass reference is null&quot;);
474         }
</pre>
</td>
<td>
<hr />
<pre>
198     //--------------------------------------------------------- test specific methods
199 
200     private StepRequest setStepRequest ( BreakpointRequest bpRequest,
201                                          String threadName,
202                                          int testCase,
203                                          String property ) {
204         StepRequest stepRequest = null;
205         for (;;) {
206             display(&quot;Wait for initial brakepoint event in &quot; + threadName);
207             BreakpointEvent bpEvent = (BreakpointEvent)waitForEvent(bpRequest);
208 
209             // check location of breakpoint event
210             int lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
211             if (lineOfEvent != lineForBreak) {
212                 complain(&quot;Wrong line number of initial brakepoint event for &quot; + threadName);
213                 complain(&quot;\texpected value : &quot; + lineForBreak + &quot;; got one : &quot; + lineOfEvent);
214                 break;
215             }
216 
217             display(&quot;Getting mirror of thread: &quot; + threadName);
<span class="line-modified">218             ThreadReference thread = debuggee.threadByNameOrThrow(threadName);</span>
219 
220             display(&quot;Getting ReferenceType of thread: &quot; + threadName);
221             ReferenceType debuggeeThread = debuggee.classByName(debuggeeThreadName);
222 
223             // set second breakpoint to suspend checked thread at the right location before
224             // setting step request
225             BreakpointRequest bpRequest1 = setBreakpoint( thread,
226                                                          debuggeeThread,
227                                                          brakeMethods[testCase],
228                                                          checkedLines[testCase][0],
229                                                          &quot;&quot;);
230             bpRequest1.addCountFilter(1);
231             bpRequest1.enable();
232 
233             display(&quot;Wait for additional brakepoint event in &quot; + threadName);
234             bpEvent = (BreakpointEvent)waitForEvent(bpRequest1);
235 
236             // check location of breakpoint event
237             lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
238             if (lineOfEvent != checkedLines[testCase][0]) {
</pre>
<hr />
<pre>
422                 }
423             }
424         } catch (Exception e) {
425             throw new Failure(&quot;Unexpected exception while waiting for an event: &quot; + e);
426         }
427         return resultEvent;
428     }
429 
430     private void getEventSet() {
431         try {
432             eventSet = vm.eventQueue().remove(waitTime);
433             if (eventSet == null) {
434                 throw new Failure(&quot;TIMEOUT while waiting for an event&quot;);
435             }
436             eventIterator = eventSet.eventIterator();
437         } catch (Exception e) {
438             throw new Failure(&quot;getEventSet(): Unexpected exception while waiting for an event: &quot; + e);
439         }
440     }
441 













442     private ReferenceType waitForDebuggeeClassPrepared () {
443         display(&quot;Creating request for ClassPrepareEvent for debuggee.&quot;);
444         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
445         cpRequest.addClassFilter(debuggeeName);
446         cpRequest.addCountFilter(1);
447         cpRequest.enable();
448 
449         ClassPrepareEvent event = (ClassPrepareEvent) waitForEvent(cpRequest);
450         cpRequest.disable();
451 
452         if (!event.referenceType().name().equals(debuggeeName)) {
453            throw new Failure(&quot;Unexpected class name for ClassPrepareEvent : &quot; + debuggeeClass.name());
454         }
455         return event.referenceType();
456     }
457 
458     private int getInstruction () {
459         if (debuggeeClass == null) {
460             throw new Failure(&quot;getInstruction() :: debuggeeClass reference is null&quot;);
461         }
</pre>
</td>
</tr>
</table>
<center><a href="crstepreq008.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="crstepreq010.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>