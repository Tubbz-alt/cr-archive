<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/ThreadReference/popFrames/popframes005.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="popframes004.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../ThreadStartRequest/addThreadFilter/addthreadfilter001.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/ThreadReference/popFrames/popframes005.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
141 
142     static Debugee          debuggee;
143     static ArgumentHandler  argsHandler;
144 
145     static int waitTime;
146 
147     static VirtualMachine      vm            = null;
148     static EventRequestManager eventRManager = null;
149     static EventQueue          eventQueue    = null;
150     static EventSet            eventSet      = null;
151     static EventIterator       eventIterator = null;
152 
153     static ReferenceType       debuggeeClass = null;
154 
155     static int  testExitCode = PASSED;
156 
157     BreakpointRequest bpRequest;
158     BreakpointRequest breakpointRequest2;
159 
160 
<span class="line-removed">161     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">162         JDITestRuntimeException(String str) {</span>
<span class="line-removed">163             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">164         }</span>
<span class="line-removed">165     }</span>
<span class="line-removed">166 </span>
167     //------------------------------------------------------ methods
168 
169     private int runThis (String argv[], PrintStream out) {
170 
171         argsHandler     = new ArgumentHandler(argv);
172         logHandler      = new Log(out, argsHandler);
173         Binder binder   = new Binder(argsHandler, logHandler);
174 
175         waitTime        = argsHandler.getWaitTime() * 60000;
176 
177         try {
178             log2(&quot;launching a debuggee :&quot;);
179             log2(&quot;       &quot; + debuggeeName);
180             if (argsHandler.verbose()) {
181                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
182             } else {
183                 debuggee = binder.bindToDebugee(debuggeeName);
184             }
185             if (debuggee == null) {
186                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
296         cpRequest.disable();
297 
298         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
299         debuggeeClass = event.referenceType();
300 
301         if (!debuggeeClass.name().equals(debuggeeName))
302            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
303 
304         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
305 
306         if ( !vm.canPopFrames() ) {
307             log2(&quot;......vm.canPopFrames() == false : test is cancelled&quot;);
308             vm.resume();
309             return;
310         }
311 
312         String bPointMethod = &quot;methodForCommunication&quot;;
313         String lineForComm  = &quot;lineForComm&quot;;
314 
315         log2(&quot;......setting BreakpointRequest (bpRequest) in main thread&quot;);
<span class="line-modified">316         bpRequest = settingBreakpoint(threadByName(&quot;main&quot;),</span>
317                                           debuggeeClass,
318                                           bPointMethod, lineForComm, &quot;zero&quot;);
319         log2(&quot;bpRequest.enable();&quot;);
320         bpRequest.enable();
321 
322     //------------------------------------------------------  testing section
323 
324         log1(&quot;     TESTING BEGINS&quot;);
325 
326         label0:
327         {
328             vm.resume();
329             breakpointForCommunication();
330 
331             String thread2Name         = &quot;thread2&quot;;
<span class="line-modified">332             ThreadReference thread2Ref = threadByName(thread2Name);</span>
333 
334             StackFrame stackFrame0 = null;
335             StackFrame stackFrame1 = null;
336             StackFrame stackFrame2 = null;
337 
338             String breakpointMethod = &quot;breakpointMethod&quot;;
339             String breakpointLine    = &quot;breakpointLine&quot;;
340 
341             log2(&quot;......setting breakpoint in breakpointMethod&quot;);
342             breakpointRequest2 = settingBreakpoint(thread2Ref, debuggeeClass,
343                                           breakpointMethod, breakpointLine, &quot;one&quot;);
344             log2(&quot;......breakpointRequest2.enable();&quot;);
345             breakpointRequest2.enable();
346 
347             {  // to get mainThread suspended; otherwise its end results in
348                // no suspention for breakpointRequest2 (bug or not?), end of test,
349                // and VMDisconnectedException
350             thread2Ref.suspend();
351             log2(&quot;......eventSet.resume();&quot;);
352             eventSet.resume();
</pre>
<hr />
<pre>
383             try {
384                 stackFrame1 = thread2Ref.frame(1);
385                 log3(&quot;ERROR: no IndexOutOfBoundsException&quot;);
386                 testExitCode = FAILED;
387             } catch ( IndexOutOfBoundsException e ) {
388                 log2(&quot;      IndexOutOfBoundsException&quot;);
389             }
390 
391 
392             log2(&quot;......breakpointRequest2.disable();&quot;);
393             breakpointRequest2.disable();
394 
395             vm.resume();
396 
397             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
398         }
399         log1(&quot;    TESTING ENDS&quot;);
400         return;
401     }
402 
<span class="line-removed">403     private ThreadReference threadByName(String name)</span>
<span class="line-removed">404                  throws JDITestRuntimeException {</span>
<span class="line-removed">405 </span>
<span class="line-removed">406         List         all = vm.allThreads();</span>
<span class="line-removed">407         ListIterator li  = all.listIterator();</span>
<span class="line-removed">408 </span>
<span class="line-removed">409         for (; li.hasNext(); ) {</span>
<span class="line-removed">410             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">411             if (thread.name().equals(name))</span>
<span class="line-removed">412                 return thread;</span>
<span class="line-removed">413         }</span>
<span class="line-removed">414         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">415     }</span>
<span class="line-removed">416 </span>
417    /*
418     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
419     *                                             String, String, String)
420     *
421     * It sets up a breakpoint at given line number within a given method in a given class
422     * for a given thread.
423     *
424     * Return value: BreakpointRequest object  in case of success
425     *
426     * JDITestRuntimeException   in case of an Exception thrown within the method
427     */
428 
429     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
430                                                   ReferenceType testedClass,
431                                                   String methodName,
432                                                   String bpLine,
433                                                   String property)
434             throws JDITestRuntimeException {
435 
436         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
<td>
<hr />
<pre>
141 
142     static Debugee          debuggee;
143     static ArgumentHandler  argsHandler;
144 
145     static int waitTime;
146 
147     static VirtualMachine      vm            = null;
148     static EventRequestManager eventRManager = null;
149     static EventQueue          eventQueue    = null;
150     static EventSet            eventSet      = null;
151     static EventIterator       eventIterator = null;
152 
153     static ReferenceType       debuggeeClass = null;
154 
155     static int  testExitCode = PASSED;
156 
157     BreakpointRequest bpRequest;
158     BreakpointRequest breakpointRequest2;
159 
160 






161     //------------------------------------------------------ methods
162 
163     private int runThis (String argv[], PrintStream out) {
164 
165         argsHandler     = new ArgumentHandler(argv);
166         logHandler      = new Log(out, argsHandler);
167         Binder binder   = new Binder(argsHandler, logHandler);
168 
169         waitTime        = argsHandler.getWaitTime() * 60000;
170 
171         try {
172             log2(&quot;launching a debuggee :&quot;);
173             log2(&quot;       &quot; + debuggeeName);
174             if (argsHandler.verbose()) {
175                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
176             } else {
177                 debuggee = binder.bindToDebugee(debuggeeName);
178             }
179             if (debuggee == null) {
180                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
290         cpRequest.disable();
291 
292         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
293         debuggeeClass = event.referenceType();
294 
295         if (!debuggeeClass.name().equals(debuggeeName))
296            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
297 
298         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
299 
300         if ( !vm.canPopFrames() ) {
301             log2(&quot;......vm.canPopFrames() == false : test is cancelled&quot;);
302             vm.resume();
303             return;
304         }
305 
306         String bPointMethod = &quot;methodForCommunication&quot;;
307         String lineForComm  = &quot;lineForComm&quot;;
308 
309         log2(&quot;......setting BreakpointRequest (bpRequest) in main thread&quot;);
<span class="line-modified">310         bpRequest = settingBreakpoint(debuggee.threadByNameOrThrow(&quot;main&quot;),</span>
311                                           debuggeeClass,
312                                           bPointMethod, lineForComm, &quot;zero&quot;);
313         log2(&quot;bpRequest.enable();&quot;);
314         bpRequest.enable();
315 
316     //------------------------------------------------------  testing section
317 
318         log1(&quot;     TESTING BEGINS&quot;);
319 
320         label0:
321         {
322             vm.resume();
323             breakpointForCommunication();
324 
325             String thread2Name         = &quot;thread2&quot;;
<span class="line-modified">326             ThreadReference thread2Ref = debuggee.threadByNameOrThrow(thread2Name);</span>
327 
328             StackFrame stackFrame0 = null;
329             StackFrame stackFrame1 = null;
330             StackFrame stackFrame2 = null;
331 
332             String breakpointMethod = &quot;breakpointMethod&quot;;
333             String breakpointLine    = &quot;breakpointLine&quot;;
334 
335             log2(&quot;......setting breakpoint in breakpointMethod&quot;);
336             breakpointRequest2 = settingBreakpoint(thread2Ref, debuggeeClass,
337                                           breakpointMethod, breakpointLine, &quot;one&quot;);
338             log2(&quot;......breakpointRequest2.enable();&quot;);
339             breakpointRequest2.enable();
340 
341             {  // to get mainThread suspended; otherwise its end results in
342                // no suspention for breakpointRequest2 (bug or not?), end of test,
343                // and VMDisconnectedException
344             thread2Ref.suspend();
345             log2(&quot;......eventSet.resume();&quot;);
346             eventSet.resume();
</pre>
<hr />
<pre>
377             try {
378                 stackFrame1 = thread2Ref.frame(1);
379                 log3(&quot;ERROR: no IndexOutOfBoundsException&quot;);
380                 testExitCode = FAILED;
381             } catch ( IndexOutOfBoundsException e ) {
382                 log2(&quot;      IndexOutOfBoundsException&quot;);
383             }
384 
385 
386             log2(&quot;......breakpointRequest2.disable();&quot;);
387             breakpointRequest2.disable();
388 
389             vm.resume();
390 
391             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
392         }
393         log1(&quot;    TESTING ENDS&quot;);
394         return;
395     }
396 














397    /*
398     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
399     *                                             String, String, String)
400     *
401     * It sets up a breakpoint at given line number within a given method in a given class
402     * for a given thread.
403     *
404     * Return value: BreakpointRequest object  in case of success
405     *
406     * JDITestRuntimeException   in case of an Exception thrown within the method
407     */
408 
409     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
410                                                   ReferenceType testedClass,
411                                                   String methodName,
412                                                   String bpLine,
413                                                   String property)
414             throws JDITestRuntimeException {
415 
416         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="popframes004.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../ThreadStartRequest/addThreadFilter/addthreadfilter001.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>