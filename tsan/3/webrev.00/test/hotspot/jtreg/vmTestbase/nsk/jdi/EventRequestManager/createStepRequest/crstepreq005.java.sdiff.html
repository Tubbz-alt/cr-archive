<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/EventRequestManager/createStepRequest/crstepreq005.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="crstepreq004.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="crstepreq006.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/EventRequestManager/createStepRequest/crstepreq005.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
200     //--------------------------------------------------------- test specific methods
201 
202     private StepRequest setStepRequest ( BreakpointRequest bpRequest,
203                                          String threadName,
204                                          int testCase,
205                                          String property ) {
206         StepRequest stepRequest = null;
207         for (;;) {
208             display(&quot;Wait for initial brakepoint event in &quot; + threadName);
209             BreakpointEvent bpEvent = (BreakpointEvent)waitForEvent(bpRequest);
210 
211             // check location of breakpoint event
212             int lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
213             if (lineOfEvent != lineForBreak) {
214                 complain(&quot;Wrong line number of initial brakepoint event for &quot; + threadName);
215                 complain(&quot;\texpected value : &quot; + lineForBreak + &quot;; got one : &quot; + lineOfEvent);
216                 break;
217             }
218 
219             display(&quot;Getting mirror of thread: &quot; + threadName);
<span class="line-modified">220             ThreadReference thread = threadByName(threadName);</span>
221 
222             display(&quot;Getting ReferenceType of thread: &quot; + threadName);
223             ReferenceType debuggeeThread = debuggee.classByName(debuggeeThreadName);
224 
225             // set second breakpoint to suspend checked thread at the right location before
226             // setting step request
227             BreakpointRequest bpRequest1 = setBreakpoint( thread,
228                                                          debuggeeThread,
229                                                          brakeMethods[testCase],
230                                                          checkedLines[testCase][0],
231                                                          &quot;&quot;);
232             bpRequest1.addCountFilter(1);
233             bpRequest1.enable();
234 
235             display(&quot;Wait for additional brakepoint event in &quot; + threadName);
236             bpEvent = (BreakpointEvent)waitForEvent(bpRequest1);
237 
238             // check location of breakpoint event
239             lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
240             if (lineOfEvent != checkedLines[testCase][0]) {
</pre>
<hr />
<pre>
424                 }
425             }
426         } catch (Exception e) {
427             throw new Failure(&quot;Unexpected exception while waiting for an event: &quot; + e);
428         }
429         return resultEvent;
430     }
431 
432     private void getEventSet() {
433         try {
434             eventSet = vm.eventQueue().remove(waitTime);
435             if (eventSet == null) {
436                 throw new Failure(&quot;TIMEOUT while waiting for an event&quot;);
437             }
438             eventIterator = eventSet.eventIterator();
439         } catch (Exception e) {
440             throw new Failure(&quot;getEventSet(): Unexpected exception while waiting for an event: &quot; + e);
441         }
442     }
443 
<span class="line-removed">444 </span>
<span class="line-removed">445     private ThreadReference threadByName(String name) throws Failure{</span>
<span class="line-removed">446         List all = vm.allThreads();</span>
<span class="line-removed">447         ListIterator li = all.listIterator();</span>
<span class="line-removed">448 </span>
<span class="line-removed">449         while (li.hasNext()) {</span>
<span class="line-removed">450             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">451             if (thread.name().equals(name))</span>
<span class="line-removed">452                 return thread;</span>
<span class="line-removed">453         }</span>
<span class="line-removed">454         throw new Failure(&quot;Thread with searching for name is not found: &quot; + name);</span>
<span class="line-removed">455     }</span>
<span class="line-removed">456 </span>
457     private ReferenceType waitForDebuggeeClassPrepared () {
458         display(&quot;Creating request for ClassPrepareEvent for debuggee.&quot;);
459         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
460         cpRequest.addClassFilter(debuggeeName);
461         cpRequest.addCountFilter(1);
462         cpRequest.enable();
463 
464         ClassPrepareEvent event = (ClassPrepareEvent) waitForEvent(cpRequest);
465         cpRequest.disable();
466 
467         if (!event.referenceType().name().equals(debuggeeName)) {
468            throw new Failure(&quot;Unexpected class name for ClassPrepareEvent : &quot; + debuggeeClass.name());
469         }
470         return event.referenceType();
471     }
472 
473     private int getInstruction () {
474         if (debuggeeClass == null) {
475             throw new Failure(&quot;getInstruction() :: debuggeeClass reference is null&quot;);
476         }
</pre>
</td>
<td>
<hr />
<pre>
200     //--------------------------------------------------------- test specific methods
201 
202     private StepRequest setStepRequest ( BreakpointRequest bpRequest,
203                                          String threadName,
204                                          int testCase,
205                                          String property ) {
206         StepRequest stepRequest = null;
207         for (;;) {
208             display(&quot;Wait for initial brakepoint event in &quot; + threadName);
209             BreakpointEvent bpEvent = (BreakpointEvent)waitForEvent(bpRequest);
210 
211             // check location of breakpoint event
212             int lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
213             if (lineOfEvent != lineForBreak) {
214                 complain(&quot;Wrong line number of initial brakepoint event for &quot; + threadName);
215                 complain(&quot;\texpected value : &quot; + lineForBreak + &quot;; got one : &quot; + lineOfEvent);
216                 break;
217             }
218 
219             display(&quot;Getting mirror of thread: &quot; + threadName);
<span class="line-modified">220             ThreadReference thread = debuggee.threadByNameOrThrow(threadName);</span>
221 
222             display(&quot;Getting ReferenceType of thread: &quot; + threadName);
223             ReferenceType debuggeeThread = debuggee.classByName(debuggeeThreadName);
224 
225             // set second breakpoint to suspend checked thread at the right location before
226             // setting step request
227             BreakpointRequest bpRequest1 = setBreakpoint( thread,
228                                                          debuggeeThread,
229                                                          brakeMethods[testCase],
230                                                          checkedLines[testCase][0],
231                                                          &quot;&quot;);
232             bpRequest1.addCountFilter(1);
233             bpRequest1.enable();
234 
235             display(&quot;Wait for additional brakepoint event in &quot; + threadName);
236             bpEvent = (BreakpointEvent)waitForEvent(bpRequest1);
237 
238             // check location of breakpoint event
239             lineOfEvent = ((LocatableEvent)bpEvent).location().lineNumber();
240             if (lineOfEvent != checkedLines[testCase][0]) {
</pre>
<hr />
<pre>
424                 }
425             }
426         } catch (Exception e) {
427             throw new Failure(&quot;Unexpected exception while waiting for an event: &quot; + e);
428         }
429         return resultEvent;
430     }
431 
432     private void getEventSet() {
433         try {
434             eventSet = vm.eventQueue().remove(waitTime);
435             if (eventSet == null) {
436                 throw new Failure(&quot;TIMEOUT while waiting for an event&quot;);
437             }
438             eventIterator = eventSet.eventIterator();
439         } catch (Exception e) {
440             throw new Failure(&quot;getEventSet(): Unexpected exception while waiting for an event: &quot; + e);
441         }
442     }
443 













444     private ReferenceType waitForDebuggeeClassPrepared () {
445         display(&quot;Creating request for ClassPrepareEvent for debuggee.&quot;);
446         ClassPrepareRequest cpRequest = eventRManager.createClassPrepareRequest();
447         cpRequest.addClassFilter(debuggeeName);
448         cpRequest.addCountFilter(1);
449         cpRequest.enable();
450 
451         ClassPrepareEvent event = (ClassPrepareEvent) waitForEvent(cpRequest);
452         cpRequest.disable();
453 
454         if (!event.referenceType().name().equals(debuggeeName)) {
455            throw new Failure(&quot;Unexpected class name for ClassPrepareEvent : &quot; + debuggeeClass.name());
456         }
457         return event.referenceType();
458     }
459 
460     private int getInstruction () {
461         if (debuggeeClass == null) {
462             throw new Failure(&quot;getInstruction() :: debuggeeClass reference is null&quot;);
463         }
</pre>
</td>
</tr>
</table>
<center><a href="crstepreq004.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="crstepreq006.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>