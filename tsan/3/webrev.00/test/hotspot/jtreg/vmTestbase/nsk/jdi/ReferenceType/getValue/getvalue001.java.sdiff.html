<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/ReferenceType/getValue/getvalue001.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../classLoader/classloader001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="getvalue002.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/ReferenceType/getValue/getvalue001.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
118       &quot;nsk.jdi.ReferenceType.getValue.getvalue001aTestClass&quot;;
119 
120     //====================================================== test program
121     //------------------------------------------------------ common section
122 
123     static Debugee          debuggee;
124     static ArgumentHandler  argsHandler;
125 
126     static int waitTime;
127 
128     static VirtualMachine      vm            = null;
129     static EventRequestManager eventRManager = null;
130     static EventQueue          eventQueue    = null;
131     static EventSet            eventSet      = null;
132     static EventIterator       eventIterator = null;
133 
134     static ReferenceType       debuggeeClass = null;
135 
136     static int  testExitCode = PASSED;
137 
<span class="line-removed">138     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">139         JDITestRuntimeException(String str) {</span>
<span class="line-removed">140             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">141         }</span>
<span class="line-removed">142     }</span>
<span class="line-removed">143 </span>
144     //------------------------------------------------------ methods
145 
146     private int runThis (String argv[], PrintStream out) {
147 
148         argsHandler     = new ArgumentHandler(argv);
149         logHandler      = new Log(out, argsHandler);
150         Binder binder   = new Binder(argsHandler, logHandler);
151 
152         waitTime        = argsHandler.getWaitTime() * 60000;
153 
154         try {
155             log2(&quot;launching a debuggee :&quot;);
156             log2(&quot;       &quot; + debuggeeName);
157             if (argsHandler.verbose()) {
158                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
159             } else {
160                 debuggee = binder.bindToDebugee(debuggeeName);
161             }
162             if (debuggee == null) {
163                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
268         cpRequest.addClassFilter(debuggeeName);
269 
270         cpRequest.enable();
271         vm.resume();
272         getEventSet();
273         cpRequest.disable();
274 
275         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
276         debuggeeClass = event.referenceType();
277 
278         if (!debuggeeClass.name().equals(debuggeeName))
279            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
280 
281         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
282 
283         String bPointMethod = &quot;methodForCommunication&quot;;
284         String lineForComm  = &quot;lineForComm&quot;;
285         BreakpointRequest bpRequest;
286 
287         try {
<span class="line-modified">288             bpRequest = settingBreakpoint(threadByName(&quot;main&quot;),</span>
289                                           debuggeeClass,
290                                           bPointMethod, lineForComm, &quot;zero&quot;);
291         } catch ( Exception e ) {
292             throw e;
293         }
294         bpRequest.enable();
295 
296     //------------------------------------------------------  testing section
297 
298         log1(&quot;     TESTING BEGINS&quot;);
299 
300         for (int i = 0; ; i++) {
301 
302             vm.resume();
303             breakpointForCommunication();
304 
305             int instruction = ((IntegerValue)
306                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
307 
308             if (instruction == 0) {
</pre>
<hr />
<pre>
351                 Value value = testedClass.getValue(field);
352                 if (value == null) {
353                     log3(&quot;ERROR: value == null&quot;);
354                     testExitCode = FAILED;
355                     continue;
356                 }
357                 try {
358                     log2(&quot;      getting Class cast: PrimitiveValue primitiveValue = (PrimitiveValue) value;&quot;);
359                     PrimitiveValue primitiveValue = (PrimitiveValue) value;
360                 } catch ( ClassCastException e ) {
361                     log3(&quot;ERROR: ClassCastException&quot;);
362                     testExitCode = FAILED;
363                 }
364             }
365             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
366         }
367         log1(&quot;    TESTING ENDS&quot;);
368         return;
369     }
370 
<span class="line-removed">371     private ThreadReference threadByName(String name)</span>
<span class="line-removed">372                  throws JDITestRuntimeException {</span>
<span class="line-removed">373 </span>
<span class="line-removed">374         List         all = vm.allThreads();</span>
<span class="line-removed">375         ListIterator li  = all.listIterator();</span>
<span class="line-removed">376 </span>
<span class="line-removed">377         for (; li.hasNext(); ) {</span>
<span class="line-removed">378             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">379             if (thread.name().equals(name))</span>
<span class="line-removed">380                 return thread;</span>
<span class="line-removed">381         }</span>
<span class="line-removed">382         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">383     }</span>
<span class="line-removed">384 </span>
385    /*
386     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
387     *                                             String, String, String)
388     *
389     * It sets up a breakpoint at given line number within a given method in a given class
390     * for a given thread.
391     *
392     * Return value: BreakpointRequest object  in case of success
393     *
394     * JDITestRuntimeException   in case of an Exception thrown within the method
395     */
396 
397     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
398                                                   ReferenceType testedClass,
399                                                   String methodName,
400                                                   String bpLine,
401                                                   String property)
402             throws JDITestRuntimeException {
403 
404         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
<td>
<hr />
<pre>
118       &quot;nsk.jdi.ReferenceType.getValue.getvalue001aTestClass&quot;;
119 
120     //====================================================== test program
121     //------------------------------------------------------ common section
122 
123     static Debugee          debuggee;
124     static ArgumentHandler  argsHandler;
125 
126     static int waitTime;
127 
128     static VirtualMachine      vm            = null;
129     static EventRequestManager eventRManager = null;
130     static EventQueue          eventQueue    = null;
131     static EventSet            eventSet      = null;
132     static EventIterator       eventIterator = null;
133 
134     static ReferenceType       debuggeeClass = null;
135 
136     static int  testExitCode = PASSED;
137 






138     //------------------------------------------------------ methods
139 
140     private int runThis (String argv[], PrintStream out) {
141 
142         argsHandler     = new ArgumentHandler(argv);
143         logHandler      = new Log(out, argsHandler);
144         Binder binder   = new Binder(argsHandler, logHandler);
145 
146         waitTime        = argsHandler.getWaitTime() * 60000;
147 
148         try {
149             log2(&quot;launching a debuggee :&quot;);
150             log2(&quot;       &quot; + debuggeeName);
151             if (argsHandler.verbose()) {
152                 debuggee = binder.bindToDebugee(debuggeeName + &quot; -vbs&quot;);
153             } else {
154                 debuggee = binder.bindToDebugee(debuggeeName);
155             }
156             if (debuggee == null) {
157                 log3(&quot;ERROR: no debuggee launched&quot;);
</pre>
<hr />
<pre>
262         cpRequest.addClassFilter(debuggeeName);
263 
264         cpRequest.enable();
265         vm.resume();
266         getEventSet();
267         cpRequest.disable();
268 
269         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
270         debuggeeClass = event.referenceType();
271 
272         if (!debuggeeClass.name().equals(debuggeeName))
273            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
274 
275         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
276 
277         String bPointMethod = &quot;methodForCommunication&quot;;
278         String lineForComm  = &quot;lineForComm&quot;;
279         BreakpointRequest bpRequest;
280 
281         try {
<span class="line-modified">282             bpRequest = settingBreakpoint(debuggee.threadByNameOrThrow(&quot;main&quot;),</span>
283                                           debuggeeClass,
284                                           bPointMethod, lineForComm, &quot;zero&quot;);
285         } catch ( Exception e ) {
286             throw e;
287         }
288         bpRequest.enable();
289 
290     //------------------------------------------------------  testing section
291 
292         log1(&quot;     TESTING BEGINS&quot;);
293 
294         for (int i = 0; ; i++) {
295 
296             vm.resume();
297             breakpointForCommunication();
298 
299             int instruction = ((IntegerValue)
300                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
301 
302             if (instruction == 0) {
</pre>
<hr />
<pre>
345                 Value value = testedClass.getValue(field);
346                 if (value == null) {
347                     log3(&quot;ERROR: value == null&quot;);
348                     testExitCode = FAILED;
349                     continue;
350                 }
351                 try {
352                     log2(&quot;      getting Class cast: PrimitiveValue primitiveValue = (PrimitiveValue) value;&quot;);
353                     PrimitiveValue primitiveValue = (PrimitiveValue) value;
354                 } catch ( ClassCastException e ) {
355                     log3(&quot;ERROR: ClassCastException&quot;);
356                     testExitCode = FAILED;
357                 }
358             }
359             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
360         }
361         log1(&quot;    TESTING ENDS&quot;);
362         return;
363     }
364 














365    /*
366     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
367     *                                             String, String, String)
368     *
369     * It sets up a breakpoint at given line number within a given method in a given class
370     * for a given thread.
371     *
372     * Return value: BreakpointRequest object  in case of success
373     *
374     * JDITestRuntimeException   in case of an Exception thrown within the method
375     */
376 
377     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
378                                                   ReferenceType testedClass,
379                                                   String methodName,
380                                                   String bpLine,
381                                                   String property)
382             throws JDITestRuntimeException {
383 
384         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../classLoader/classloader001.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="getvalue002.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>