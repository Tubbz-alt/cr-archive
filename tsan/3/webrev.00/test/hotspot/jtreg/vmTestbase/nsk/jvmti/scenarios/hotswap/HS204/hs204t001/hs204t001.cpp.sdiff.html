<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jvmti/scenarios/hotswap/HS204/hs204t001/hs204t001.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../HS203/hs203t004/hs203t004.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../hs204t002/hs204t002.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jvmti/scenarios/hotswap/HS204/hs204t001/hs204t001.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 52     char * className;
 53     char * generic;
 54     if (!NSK_JVMTI_VERIFY(jvmti-&gt;GetClassSignature(klass, &amp;className, &amp;generic))) {
 55         nsk_jvmti_setFailStatus();
 56     }
 57     return className;
 58 }
 59 
 60 JNIEXPORT void JNICALL
 61 callbackClassLoad(jvmtiEnv *jvmti_env,
 62         JNIEnv* jni_env,
 63         jthread thread,
 64         jclass klass) {
 65     char * name;
 66     name = getClassName(jvmti_env,klass);
 67     if ((strcmp(name,CLASS_NAME) == 0) &amp;&amp; (redefineNumber == 1)) {
 68        char fileName[512];
 69         nsk_jvmti_getFileName(redefineNumber, FILE_NAME, fileName,
 70                         sizeof(fileName)/sizeof(char));
 71         NSK_DISPLAY1(&quot;&gt;&gt;&gt;&gt;&gt;&gt;CallbackClassLoad ... Name=%s...  &gt;&gt;\n&quot;,name);
<span class="line-modified"> 72         if (nsk_jvmti_redefineClass(jvmti, klass, fileName) == NSK_TRUE) {</span>
 73             NSK_DISPLAY0(&quot;\nMyClass :: Successfully redefined..\n&quot;);
 74             redefineNumber++;
 75         } else {
 76             NSK_COMPLAIN0(&quot;\nMyClass :: Failed to redefine ..\n&quot;);
 77         }
 78         /* if ((myTestClass = jni_env-&gt;NewGlobalRef(klass)) == NULL) {
 79            NSK_COMPLAIN0(&quot;Failed to create global ref...&quot;);
 80            }
 81          */
 82     }
 83 }
 84 
 85 JNIEXPORT void JNICALL
 86 callbackClassPrepare(jvmtiEnv *jvmti_env,
 87         JNIEnv* jni_env,
 88         jthread thread,
 89         jclass klass) {
 90     char *  name;
 91     name = getClassName(jvmti_env, klass);
 92     if ((strcmp(name, CLASS_NAME) == 0) &amp;&amp; (redefineNumber == 0)) {
 93         char fileName[512];
 94         nsk_jvmti_getFileName(redefineNumber, FILE_NAME, fileName,
 95                         sizeof(fileName)/sizeof(char));
 96         NSK_DISPLAY1(&quot;&gt;&gt;&gt;&gt;&gt;&gt;callbackClassPrepare ... Name=%s...  &gt;&gt;\n&quot;,name);
<span class="line-modified"> 97         if (nsk_jvmti_redefineClass(jvmti, klass, fileName) == NSK_TRUE) {</span>
 98             NSK_DISPLAY0(&quot;\nMyClass :: Successfully redefined..\n&quot;);
 99             redefineNumber++;
100         } else {
101             NSK_COMPLAIN0(&quot;\nMyClass :: Failed to redefine ..\n&quot;);
102         }
103         myTestClass = (jclass) jni_env-&gt;NewGlobalRef(klass);
104         if (myTestClass == NULL) {
105             NSK_COMPLAIN0(&quot;Failed to create global ref...&quot;);
106         }
107     }
108 }
109 
110 JNIEXPORT void JNICALL
111 callbackClassFileLoadHock(jvmtiEnv *jvmti_env,
112         JNIEnv* jni_env,
113         jclass class_being_redefined,
114         jobject loader,
115         const char* name,
116         jobject protection_domain,
117         jint class_data_len,
</pre>
</td>
<td>
<hr />
<pre>
 52     char * className;
 53     char * generic;
 54     if (!NSK_JVMTI_VERIFY(jvmti-&gt;GetClassSignature(klass, &amp;className, &amp;generic))) {
 55         nsk_jvmti_setFailStatus();
 56     }
 57     return className;
 58 }
 59 
 60 JNIEXPORT void JNICALL
 61 callbackClassLoad(jvmtiEnv *jvmti_env,
 62         JNIEnv* jni_env,
 63         jthread thread,
 64         jclass klass) {
 65     char * name;
 66     name = getClassName(jvmti_env,klass);
 67     if ((strcmp(name,CLASS_NAME) == 0) &amp;&amp; (redefineNumber == 1)) {
 68        char fileName[512];
 69         nsk_jvmti_getFileName(redefineNumber, FILE_NAME, fileName,
 70                         sizeof(fileName)/sizeof(char));
 71         NSK_DISPLAY1(&quot;&gt;&gt;&gt;&gt;&gt;&gt;CallbackClassLoad ... Name=%s...  &gt;&gt;\n&quot;,name);
<span class="line-modified"> 72         if (nsk_jvmti_redefineClass(jvmti, klass, fileName)) {</span>
 73             NSK_DISPLAY0(&quot;\nMyClass :: Successfully redefined..\n&quot;);
 74             redefineNumber++;
 75         } else {
 76             NSK_COMPLAIN0(&quot;\nMyClass :: Failed to redefine ..\n&quot;);
 77         }
 78         /* if ((myTestClass = jni_env-&gt;NewGlobalRef(klass)) == NULL) {
 79            NSK_COMPLAIN0(&quot;Failed to create global ref...&quot;);
 80            }
 81          */
 82     }
 83 }
 84 
 85 JNIEXPORT void JNICALL
 86 callbackClassPrepare(jvmtiEnv *jvmti_env,
 87         JNIEnv* jni_env,
 88         jthread thread,
 89         jclass klass) {
 90     char *  name;
 91     name = getClassName(jvmti_env, klass);
 92     if ((strcmp(name, CLASS_NAME) == 0) &amp;&amp; (redefineNumber == 0)) {
 93         char fileName[512];
 94         nsk_jvmti_getFileName(redefineNumber, FILE_NAME, fileName,
 95                         sizeof(fileName)/sizeof(char));
 96         NSK_DISPLAY1(&quot;&gt;&gt;&gt;&gt;&gt;&gt;callbackClassPrepare ... Name=%s...  &gt;&gt;\n&quot;,name);
<span class="line-modified"> 97         if (nsk_jvmti_redefineClass(jvmti, klass, fileName)) {</span>
 98             NSK_DISPLAY0(&quot;\nMyClass :: Successfully redefined..\n&quot;);
 99             redefineNumber++;
100         } else {
101             NSK_COMPLAIN0(&quot;\nMyClass :: Failed to redefine ..\n&quot;);
102         }
103         myTestClass = (jclass) jni_env-&gt;NewGlobalRef(klass);
104         if (myTestClass == NULL) {
105             NSK_COMPLAIN0(&quot;Failed to create global ref...&quot;);
106         }
107     }
108 }
109 
110 JNIEXPORT void JNICALL
111 callbackClassFileLoadHock(jvmtiEnv *jvmti_env,
112         JNIEnv* jni_env,
113         jclass class_being_redefined,
114         jobject loader,
115         const char* name,
116         jobject protection_domain,
117         jint class_data_len,
</pre>
</td>
</tr>
</table>
<center><a href="../../HS203/hs203t004/hs203t004.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../hs204t002/hs204t002.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>