<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/jtreg/vmTestbase/nsk/jvmti/GetTime/gettime001/gettime001.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../GetThreadState/thrstat001/thrstat001.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../GetTimerInfo/timerinfo001/timerinfo001.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jvmti/GetTime/gettime001/gettime001.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 47,22 ***</span>
  
  /* ============================================================================= */
  
  /**
   * Get time and optionally compare it with previous one.
<span class="line-modified">!  * @returns NSK_FALSE if any error occured.</span>
   */
<span class="line-modified">! static int checkTime(jvmtiEnv* jvmti, julong* time,</span>
<span class="line-modified">!                                 julong* prevTime, const char where[]) {</span>
  
      char buf[32], buf2[32], buf3[32];
<span class="line-modified">!     int success = NSK_TRUE;</span>
  
      NSK_DISPLAY0(&quot;GetTime() for current JVMTI env\n&quot;);
      if (!NSK_JVMTI_VERIFY(
              jvmti-&gt;GetTime((jlong *)time))) {
<span class="line-modified">!         return NSK_FALSE;</span>
      }
      NSK_DISPLAY1(&quot;  ... got time: %s\n&quot;, julong_to_string(*time, buf));
  
      if (prevTime != NULL) {
          julong diff = *time - *prevTime;
<span class="line-new-header">--- 47,22 ---</span>
  
  /* ============================================================================= */
  
  /**
   * Get time and optionally compare it with previous one.
<span class="line-modified">!  * @returns false if any error occured.</span>
   */
<span class="line-modified">! static bool checkTime(jvmtiEnv* jvmti, julong* time,</span>
<span class="line-modified">!                       julong* prevTime, const char where[]) {</span>
  
      char buf[32], buf2[32], buf3[32];
<span class="line-modified">!     bool success = true;</span>
  
      NSK_DISPLAY0(&quot;GetTime() for current JVMTI env\n&quot;);
      if (!NSK_JVMTI_VERIFY(
              jvmti-&gt;GetTime((jlong *)time))) {
<span class="line-modified">!         return false;</span>
      }
      NSK_DISPLAY1(&quot;  ... got time: %s\n&quot;, julong_to_string(*time, buf));
  
      if (prevTime != NULL) {
          julong diff = *time - *prevTime;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 79,11 ***</span>
                            &quot;#   difference: %s\n&quot;,
                              where,
                              julong_to_string(*time, buf),
                              julong_to_string(*prevTime, buf2),
                              julong_to_string(diff, buf3));
<span class="line-modified">!             success = NSK_FALSE;</span>
          }
          *prevTime = *time;
      }
  
      return success;
<span class="line-new-header">--- 79,11 ---</span>
                            &quot;#   difference: %s\n&quot;,
                              where,
                              julong_to_string(*time, buf),
                              julong_to_string(*prevTime, buf2),
                              julong_to_string(diff, buf3));
<span class="line-modified">!             success = false;</span>
          }
          *prevTime = *time;
      }
  
      return success;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 130,26 ***</span>
  /**
   * Callback for VM_DEATH event.
   */
  JNIEXPORT void JNICALL
  callbackVMDeath(jvmtiEnv* jvmti, JNIEnv* jni) {
<span class="line-modified">!     int success = NSK_TRUE;</span>
  
      NSK_DISPLAY0(&quot;&gt;&gt;&gt; Testcase #4: Check time in VM_DEATH callback\n&quot;);
      {
          julong time;
          success = checkTime(jvmti, &amp;time, &amp;prevTime, &quot;VM_DEATH callback&quot;);
      }
  
      NSK_DISPLAY1(&quot;Disable events: %d events\n&quot;, EVENTS_COUNT);
      if (!nsk_jvmti_enableEvents(JVMTI_DISABLE, EVENTS_COUNT, events, NULL)) {
<span class="line-modified">!         success = NSK_FALSE;</span>
      } else {
          NSK_DISPLAY0(&quot;  ... disabled\n&quot;);
      }
  
<span class="line-modified">!     if (success != NSK_TRUE) {</span>
          NSK_DISPLAY1(&quot;Exit with FAIL exit status: %d\n&quot;, STATUS_FAIL);
          NSK_BEFORE_TRACE(exit(STATUS_FAIL));
      }
  }
  
<span class="line-new-header">--- 130,26 ---</span>
  /**
   * Callback for VM_DEATH event.
   */
  JNIEXPORT void JNICALL
  callbackVMDeath(jvmtiEnv* jvmti, JNIEnv* jni) {
<span class="line-modified">!     bool success = true;</span>
  
      NSK_DISPLAY0(&quot;&gt;&gt;&gt; Testcase #4: Check time in VM_DEATH callback\n&quot;);
      {
          julong time;
          success = checkTime(jvmti, &amp;time, &amp;prevTime, &quot;VM_DEATH callback&quot;);
      }
  
      NSK_DISPLAY1(&quot;Disable events: %d events\n&quot;, EVENTS_COUNT);
      if (!nsk_jvmti_enableEvents(JVMTI_DISABLE, EVENTS_COUNT, events, NULL)) {
<span class="line-modified">!         success = false;</span>
      } else {
          NSK_DISPLAY0(&quot;  ... disabled\n&quot;);
      }
  
<span class="line-modified">!     if (!success) {</span>
          NSK_DISPLAY1(&quot;Exit with FAIL exit status: %d\n&quot;, STATUS_FAIL);
          NSK_BEFORE_TRACE(exit(STATUS_FAIL));
      }
  }
  
</pre>
<center><a href="../../GetThreadState/thrstat001/thrstat001.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../GetTimerInfo/timerinfo001/timerinfo001.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>