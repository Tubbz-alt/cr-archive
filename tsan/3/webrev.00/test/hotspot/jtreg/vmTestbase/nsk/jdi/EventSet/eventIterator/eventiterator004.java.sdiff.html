<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/vmTestbase/nsk/jdi/EventSet/eventIterator/eventiterator004.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="eventiterator003.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../resume/resume002.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/nsk/jdi/EventSet/eventIterator/eventiterator004.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
121 
122     //====================================================== test program
123     //------------------------------------------------------ common section
124 
125     static Debugee          debuggee;
126     static ArgumentHandler  argsHandler;
127 
128     static int waitTime;
129 
130     static VirtualMachine      vm            = null;
131     static EventRequestManager eventRManager = null;
132     static EventQueue          eventQueue    = null;
133     static EventSet            eventSet      = null;
134     static EventIterator       eventIterator = null;
135 
136     static ReferenceType       debuggeeClass = null;
137 
138     static int  testExitCode = PASSED;
139 
140 
<span class="line-removed">141     class JDITestRuntimeException extends RuntimeException {</span>
<span class="line-removed">142         JDITestRuntimeException(String str) {</span>
<span class="line-removed">143             super(&quot;JDITestRuntimeException : &quot; + str);</span>
<span class="line-removed">144         }</span>
<span class="line-removed">145     }</span>
<span class="line-removed">146 </span>
147     //  Event #:
148     //  0-6  : AccessWatchpoint, ModificationWatchpoint, Breakpoint, Exception,
149     //         MethodEntry, MethodExit, Step
150     //  7-8  : ClassPrepare, ClassUnload
151     //  9-10 : ThreadDeath, ThreadStart
152     // 11-13 : VMDeath, VMDisconnect, VMStart
153 
154     EventSet     eventSets[] = new EventSet [14];
155     EventRequest eRequests[] = new EventRequest[14];
156 
157     int eventFlags[] = { 0,0,0,0, 0,0,0,0, 3,0,0,0, 1,1 };
158 
159     //------------------------------------------------------ methods
160 
161     private int runThis (String argv[], PrintStream out) {
162 
163         argsHandler     = new ArgumentHandler(argv);
164         logHandler      = new Log(out, argsHandler);
165         Binder binder   = new Binder(argsHandler, logHandler);
166 
</pre>
<hr />
<pre>
313 
314         getEventSet();
315         eventSets[7] = eventSet;
316 
317         cpRequest.disable();
318 
319         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
320         debuggeeClass = event.referenceType();
321 
322         if (!debuggeeClass.name().equals(debuggeeName))
323            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
324 
325         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
326 
327         log2(&quot;......setting up ClassPrepareEvent&quot;);
328 
329         String bPointMethod = &quot;methodForCommunication&quot;;
330         String lineForComm  = &quot;lineForComm&quot;;
331         BreakpointRequest bpRequest;
332 
<span class="line-modified">333         ThreadReference mainThread = threadByName(&quot;main&quot;);</span>
334 
335         bpRequest = settingBreakpoint(mainThread,
336                                       debuggeeClass,
337                                       bPointMethod, lineForComm, &quot;zero&quot;);
338         bpRequest.enable();
339 
340     //------------------------------------------------------  testing section
341 
342         log1(&quot;     TESTING BEGINS&quot;);
343 
344         for (int i = 0; ; i++) {
345 
346             vm.resume();
347             breakpointForCommunication();
348 
349             int instruction = ((IntegerValue)
350                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
351 
352             if (instruction == 0) {
353                 vm.resume();
354                 break;
355             }
356 
357             log1(&quot;:::::: case: # &quot; + i);
358 
359             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
360             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
361         }
362         log1(&quot;    TESTING ENDS&quot;);
363         return;
364     }
365 
<span class="line-removed">366     private ThreadReference threadByName(String name)</span>
<span class="line-removed">367                  throws JDITestRuntimeException {</span>
<span class="line-removed">368 </span>
<span class="line-removed">369         List         all = vm.allThreads();</span>
<span class="line-removed">370         ListIterator li  = all.listIterator();</span>
<span class="line-removed">371 </span>
<span class="line-removed">372         for (; li.hasNext(); ) {</span>
<span class="line-removed">373             ThreadReference thread = (ThreadReference) li.next();</span>
<span class="line-removed">374             if (thread.name().equals(name))</span>
<span class="line-removed">375                 return thread;</span>
<span class="line-removed">376         }</span>
<span class="line-removed">377         throw new JDITestRuntimeException(&quot;** Thread IS NOT found ** : &quot; + name);</span>
<span class="line-removed">378     }</span>
<span class="line-removed">379 </span>
380    /*
381     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
382     *                                             String, String, String)
383     *
384     * It sets up a breakpoint at given line number within a given method in a given class
385     * for a given thread.
386     *
387     * Return value: BreakpointRequest object  in case of success
388     *
389     * JDITestRuntimeException   in case of an Exception thrown within the method
390     */
391 
392     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
393                                                   ReferenceType testedClass,
394                                                   String methodName,
395                                                   String bpLine,
396                                                   String property)
397             throws JDITestRuntimeException {
398 
399         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
<td>
<hr />
<pre>
121 
122     //====================================================== test program
123     //------------------------------------------------------ common section
124 
125     static Debugee          debuggee;
126     static ArgumentHandler  argsHandler;
127 
128     static int waitTime;
129 
130     static VirtualMachine      vm            = null;
131     static EventRequestManager eventRManager = null;
132     static EventQueue          eventQueue    = null;
133     static EventSet            eventSet      = null;
134     static EventIterator       eventIterator = null;
135 
136     static ReferenceType       debuggeeClass = null;
137 
138     static int  testExitCode = PASSED;
139 
140 






141     //  Event #:
142     //  0-6  : AccessWatchpoint, ModificationWatchpoint, Breakpoint, Exception,
143     //         MethodEntry, MethodExit, Step
144     //  7-8  : ClassPrepare, ClassUnload
145     //  9-10 : ThreadDeath, ThreadStart
146     // 11-13 : VMDeath, VMDisconnect, VMStart
147 
148     EventSet     eventSets[] = new EventSet [14];
149     EventRequest eRequests[] = new EventRequest[14];
150 
151     int eventFlags[] = { 0,0,0,0, 0,0,0,0, 3,0,0,0, 1,1 };
152 
153     //------------------------------------------------------ methods
154 
155     private int runThis (String argv[], PrintStream out) {
156 
157         argsHandler     = new ArgumentHandler(argv);
158         logHandler      = new Log(out, argsHandler);
159         Binder binder   = new Binder(argsHandler, logHandler);
160 
</pre>
<hr />
<pre>
307 
308         getEventSet();
309         eventSets[7] = eventSet;
310 
311         cpRequest.disable();
312 
313         ClassPrepareEvent event = (ClassPrepareEvent) eventIterator.next();
314         debuggeeClass = event.referenceType();
315 
316         if (!debuggeeClass.name().equals(debuggeeName))
317            throw new JDITestRuntimeException(&quot;** Unexpected ClassName for ClassPrepareEvent **&quot;);
318 
319         log2(&quot;      received: ClassPrepareEvent for debuggeeClass&quot;);
320 
321         log2(&quot;......setting up ClassPrepareEvent&quot;);
322 
323         String bPointMethod = &quot;methodForCommunication&quot;;
324         String lineForComm  = &quot;lineForComm&quot;;
325         BreakpointRequest bpRequest;
326 
<span class="line-modified">327         ThreadReference mainThread = debuggee.threadByNameOrThrow(&quot;main&quot;);</span>
328 
329         bpRequest = settingBreakpoint(mainThread,
330                                       debuggeeClass,
331                                       bPointMethod, lineForComm, &quot;zero&quot;);
332         bpRequest.enable();
333 
334     //------------------------------------------------------  testing section
335 
336         log1(&quot;     TESTING BEGINS&quot;);
337 
338         for (int i = 0; ; i++) {
339 
340             vm.resume();
341             breakpointForCommunication();
342 
343             int instruction = ((IntegerValue)
344                                (debuggeeClass.getValue(debuggeeClass.fieldByName(&quot;instruction&quot;)))).value();
345 
346             if (instruction == 0) {
347                 vm.resume();
348                 break;
349             }
350 
351             log1(&quot;:::::: case: # &quot; + i);
352 
353             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ variable part
354             //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
355         }
356         log1(&quot;    TESTING ENDS&quot;);
357         return;
358     }
359 














360    /*
361     * private BreakpointRequest settingBreakpoint(ThreadReference, ReferenceType,
362     *                                             String, String, String)
363     *
364     * It sets up a breakpoint at given line number within a given method in a given class
365     * for a given thread.
366     *
367     * Return value: BreakpointRequest object  in case of success
368     *
369     * JDITestRuntimeException   in case of an Exception thrown within the method
370     */
371 
372     private BreakpointRequest settingBreakpoint ( ThreadReference thread,
373                                                   ReferenceType testedClass,
374                                                   String methodName,
375                                                   String bpLine,
376                                                   String property)
377             throws JDITestRuntimeException {
378 
379         log2(&quot;......setting up a breakpoint:&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="eventiterator003.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../resume/resume002.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>