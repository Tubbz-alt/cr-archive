<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/hotspot/jtreg/vmTestbase/jit/graph/RBTree.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
<a name="2" id="anc2"></a>


 23 
<a name="3" id="anc3"></a><span class="line-modified"> 24 package jit.graph;</span>
 25 
 26 // This class defines the tree object.
<a name="4" id="anc4"></a><span class="line-modified"> 27 public class RBTree {</span>
<span class="line-modified"> 28     public final static int maxNodes = 70;      // maximum nodes allowed.</span>
<span class="line-modified"> 29     public final static int INSERT = 0;         // constants indicating</span>
<span class="line-modified"> 30     public final static int DELETE = 1;         // the current operation</span>
<span class="line-modified"> 31     public final static int NOP = 2;</span>
<span class="line-modified"> 32     public final static Node treeNull = new Node(); // the tree NULL node.</span>
<span class="line-modified"> 33 </span>
<span class="line-modified"> 34     private Node root;</span>
<span class="line-modified"> 35     private int num_of_nodes;</span>
<span class="line-modified"> 36     private int height;           // The tree height, it is updated</span>
<span class="line-modified"> 37     // in each operation.</span>
<span class="line-modified"> 38 </span>
<span class="line-modified"> 39     // since the algorithm is executed in stages I have to remember data</span>
<span class="line-modified"> 40     // on the state.</span>
<span class="line-modified"> 41     private Node node;  // The current operation is being done on it.</span>
<span class="line-modified"> 42     private int action; // The operation being performed (insert / delete)</span>
<span class="line-modified"> 43     private int stage;  // The current stage of execution</span>
<span class="line-modified"> 44 </span>
<span class="line-modified"> 45     // the constructor initializes the object fields.</span>
<span class="line-modified"> 46     public RBTree() {</span>
<span class="line-modified"> 47         root = treeNull;</span>
<span class="line-modified"> 48         node = treeNull;</span>
<span class="line-modified"> 49         num_of_nodes = 0;</span>
<span class="line-modified"> 50         height = 0;</span>
<span class="line-modified"> 51         action = NOP;</span>
<span class="line-modified"> 52         stage = 0;</span>
<span class="line-modified"> 53     }</span>
<span class="line-modified"> 54 </span>
<span class="line-modified"> 55     // This method returns the root of the tree.</span>
<span class="line-modified"> 56     public Node getRoot() {</span>
<span class="line-modified"> 57         return root;</span>
<span class="line-modified"> 58     }</span>
<span class="line-modified"> 59 </span>
<span class="line-modified"> 60     // This method returns the number of nodes in the tree.</span>
<span class="line-modified"> 61     public int getNodes() {</span>
<span class="line-modified"> 62         return num_of_nodes;</span>
<span class="line-modified"> 63     }</span>
<span class="line-modified"> 64 </span>
<span class="line-modified"> 65     // This method returns the height of the tree.</span>
<span class="line-modified"> 66     public int getHeight() {</span>
<span class="line-modified"> 67         return height;</span>
<span class="line-modified"> 68     }</span>
<span class="line-modified"> 69 </span>
<span class="line-modified"> 70 </span>
<span class="line-modified"> 71     // This method inserts k into the Red Black Tree</span>
<span class="line-modified"> 72     public boolean RBInsert(int k) {</span>
<span class="line-modified"> 73         // checking similar to the RB_Insert method</span>
<span class="line-modified"> 74         if (action != NOP) {</span>
<span class="line-modified"> 75             System.out.println(&quot;Only one operation can be done at a time.&quot;);</span>
<span class="line-modified"> 76             return false;</span>
<span class="line-modified"> 77         }</span>
<span class="line-modified"> 78 </span>
<span class="line-modified"> 79         if (num_of_nodes == maxNodes) {</span>
<span class="line-modified"> 80             System.out.println(&quot;The maximum nodes allowed is already reached.&quot;);</span>
<span class="line-modified"> 81             return false;</span>
<span class="line-modified"> 82         }</span>
<span class="line-modified"> 83 </span>
<span class="line-modified"> 84         // Check if there is already node with key k.</span>
<span class="line-modified"> 85         if (Search(k) == treeNull) {</span>
<span class="line-modified"> 86             action = INSERT;</span>
<span class="line-modified"> 87             node = new Node(k);</span>
<span class="line-modified"> 88             node.setNode(Node.Left_son, treeNull);</span>
<span class="line-modified"> 89             node.setNode(Node.Right_son, treeNull);</span>
<span class="line-modified"> 90             node.setNode(Node.Parent, treeNull);</span>
<span class="line-modified"> 91             stage = 1;</span>
<span class="line-modified"> 92             // This is the loop that perform all the operation steps.</span>
<span class="line-modified"> 93             while (stage != 0) {</span>
<span class="line-modified"> 94                 // perform one step</span>
<span class="line-modified"> 95                 InsertStep();</span>
<span class="line-modified"> 96                 // update the tree height</span>
<span class="line-modified"> 97                 updateHeight();</span>
<span class="line-modified"> 98             }</span>
<span class="line-modified"> 99             // set the action to NoOPretion.</span>
<span class="line-modified">100             action = NOP;</span>
<span class="line-modified">101             return true;</span>
<span class="line-modified">102         } else</span>
<span class="line-modified">103             System.out.println(&quot;Insertion failed. This key already exist.&quot;);</span>
<span class="line-modified">104         return false;</span>
<span class="line-modified">105     }</span>
<span class="line-modified">106 </span>
<span class="line-modified">107 </span>
<span class="line-modified">108     // This method deletes the element k from the Red Black tree</span>
<span class="line-modified">109     public boolean RBDelete(int k) {</span>
<span class="line-modified">110         // checking like in RB_Delete method</span>
<span class="line-modified">111         if (action != NOP) {</span>
<span class="line-modified">112             System.out.println(&quot;Only one operation can be done at a time.&quot;);</span>
<span class="line-modified">113             return false;</span>
<span class="line-modified">114         }</span>
<span class="line-modified">115         node = Search(k);</span>
<span class="line-modified">116         // Check if there is a node with key k.</span>
<span class="line-modified">117         if (node != treeNull) {</span>
<span class="line-modified">118             action = DELETE;</span>
<span class="line-modified">119             stage = 1;</span>
<span class="line-modified">120             // this loop perform all the operation steps.</span>
<span class="line-modified">121             while (stage != 0) {</span>
<span class="line-modified">122                 // perform one step</span>
<span class="line-modified">123                 DeleteStep();</span>
<span class="line-modified">124                 // update the tree height</span>
<span class="line-modified">125                 updateHeight();</span>
<span class="line-modified">126             }</span>
<span class="line-modified">127             action = NOP;</span>
<span class="line-modified">128             return true;</span>
<span class="line-modified">129         } else</span>
<span class="line-modified">130             System.out.println(&quot;Deletion failed. This key doesn&#39;t exist.&quot;);</span>
<span class="line-modified">131         return false;</span>
<span class="line-modified">132     }</span>
<span class="line-modified">133 </span>
<span class="line-modified">134     // This method performs one step in the insertion operation.</span>
<span class="line-modified">135     // It performs a step according to the stage variable.</span>
<span class="line-modified">136     // I will not explain exactly what each stage do, just that they</span>
<span class="line-modified">137     // divided to 4 categories:</span>
<span class="line-modified">138     // 1. inserting a node to the tree.</span>
<span class="line-modified">139     // 2. marking nodes that will be recolored.</span>
<span class="line-modified">140     // 3. recoloring nodes.</span>
<span class="line-modified">141     // 4. rotating right or left.</span>
<span class="line-modified">142     private void InsertStep() {</span>
<span class="line-modified">143         // Pr is parent, GrPr is grandparent and Un is uncle.</span>
<span class="line-modified">144         Node Pr, GrPr, Un;</span>
<span class="line-modified">145         switch (stage) {</span>
<span class="line-modified">146             // Inserting a node to the tree</span>
<span class="line-modified">147             case 1:</span>
<span class="line-modified">148                 Tree_Insert();</span>
<span class="line-modified">149                 break;</span>
<span class="line-modified">150             // mid stage that moves the algorithm to the proper next stage</span>
<span class="line-modified">151             case 2:</span>
<span class="line-modified">152                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">153                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">154                 if (Pr == GrPr.getNode(Node.Left_son)) {</span>
<span class="line-modified">155                     Un = GrPr.getNode(Node.Right_son);</span>
<span class="line-modified">156                     if (Un.getColor() == Node.Red) {</span>
































157                         stage = 3;
<a name="5" id="anc5"></a><span class="line-modified">158                     } else if (node == Pr.getNode(Node.Right_son)) {</span>
<span class="line-modified">159                         node = Pr;</span>
<span class="line-modified">160                         stage = 5;</span>
<span class="line-modified">161                     } else {</span>
<span class="line-modified">162                         stage = 6;</span>
<span class="line-modified">163                     }</span>
<span class="line-modified">164                 } else {</span>
<span class="line-modified">165                     Un = GrPr.getNode(Node.Left_son);</span>
<span class="line-modified">166                     if (Un.getColor() == Node.Red) {</span>








167                         stage = 3;
<a name="6" id="anc6"></a><span class="line-modified">168                     } else if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-modified">169                         node = Pr;</span>
<span class="line-modified">170                         stage = 5;</span>
<span class="line-modified">171                     } else {</span>
<span class="line-modified">172                         stage = 6;</span>
<span class="line-modified">173                     }</span>
<span class="line-modified">174                 }</span>
<span class="line-modified">175                 break;</span>
<span class="line-modified">176             // This stage marks node that will be recolored</span>
<span class="line-modified">177             case 3:</span>
<span class="line-modified">178                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">179                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">180                 if (Pr == GrPr.getNode(Node.Left_son)) {</span>
<span class="line-modified">181                     Un = GrPr.getNode(Node.Right_son);</span>
<span class="line-modified">182                 } else {</span>
<span class="line-modified">183                     Un = GrPr.getNode(Node.Left_son);</span>
<span class="line-modified">184                 }</span>
<span class="line-modified">185                 node = GrPr;</span>
<span class="line-modified">186                 stage = 4;</span>
<span class="line-modified">187                 break;</span>
<span class="line-modified">188             // This stage recolors marked nodes.</span>
<span class="line-modified">189             case 4:</span>
<span class="line-modified">190                 node.setColor(Node.Red);</span>
<span class="line-modified">191                 node.getNode(Node.Left_son).setColor(Node.Black);</span>
<span class="line-modified">192                 node.getNode(Node.Right_son).setColor(Node.Black);</span>
<span class="line-modified">193 </span>
<span class="line-modified">194                 if ((node == root) ||</span>
<span class="line-modified">195                         (node.getNode(Node.Parent).getColor() == Node.Black)) {</span>
<span class="line-modified">196                     if (root.getColor() == Node.Red) {</span>




197                         stage = 9;
<a name="7" id="anc7"></a><span class="line-modified">198                     } else</span>

199                         stage = 0;
<a name="8" id="anc8"></a><span class="line-modified">200                 } else {</span>
<span class="line-modified">201                     stage = 2;</span>
<span class="line-modified">202                     InsertStep();</span>
<span class="line-modified">203                 }</span>
<span class="line-modified">204                 break;</span>
<span class="line-modified">205             // This stage performs rotation operation</span>
<span class="line-modified">206             case 5:</span>
<span class="line-modified">207                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">208                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-modified">209                     Left_Rotate(node);</span>
<span class="line-modified">210                 } else {</span>
<span class="line-modified">211                     Right_Rotate(node);</span>
<span class="line-modified">212                 }</span>
<span class="line-modified">213                 stage = 6;</span>
<span class="line-modified">214                 break;</span>
<span class="line-modified">215             // This stage marks nodes that will be recolor.</span>
<span class="line-modified">216             case 6:</span>
<span class="line-modified">217                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">218                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">219 </span>
<span class="line-modified">220                 stage = 7;</span>
<span class="line-modified">221                 break;</span>
<span class="line-modified">222             // This stage recolors marked nodes.</span>
<span class="line-modified">223             case 7:</span>
<span class="line-modified">224                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">225                 Pr.setColor(Node.Black);</span>
<span class="line-modified">226                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">227                 GrPr.setColor(Node.Red);</span>
<span class="line-modified">228 </span>
<span class="line-modified">229                 stage = 8;</span>
<span class="line-modified">230                 break;</span>
<span class="line-modified">231             // This stage performs rotation operation</span>
<span class="line-modified">232             case 8:</span>
<span class="line-modified">233                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">234                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">235                 if (Pr == GrPr.getNode(Node.Left_son)) {</span>
<span class="line-modified">236                     Right_Rotate(GrPr);</span>
<span class="line-modified">237                 } else {</span>
<span class="line-modified">238                     Left_Rotate(GrPr);</span>
<span class="line-modified">239                 }</span>
<span class="line-modified">240                 if (root.getColor() == Node.Red) {</span>






































































































































































241                     stage = 9;
<a name="9" id="anc9"></a><span class="line-modified">242                 } else</span>
<span class="line-modified">243                     stage = 0;</span>
<span class="line-modified">244                 break;</span>
<span class="line-modified">245             // this stage marks the root.</span>
<span class="line-modified">246             case 9:</span>
<span class="line-modified">247                 stage = 10;</span>
<span class="line-modified">248                 break;</span>
<span class="line-modified">249             // This stage recolors the root.</span>
<span class="line-modified">250             case 10:</span>
<span class="line-modified">251                 root.setColor(Node.Black);</span>
<span class="line-modified">252                 stage = 0;</span>
<span class="line-modified">253                 break;</span>
<span class="line-modified">254         }</span>
<span class="line-modified">255     }</span>
<span class="line-modified">256 </span>
<span class="line-modified">257     // This method performs one step in the deletion operation.</span>
<span class="line-modified">258     // It perform sa step according to the stage variable.</span>
<span class="line-modified">259     // I will explain exactly what each stage do, just that they</span>
<span class="line-modified">260     // divided to 4 categories:</span>
<span class="line-modified">261     // 1. deleting a node from the tree.</span>
<span class="line-modified">262     // 2. marking nodes that will be recolored.</span>
<span class="line-modified">263     // 3. recoloring nodes.</span>
<span class="line-modified">264     // 4. rotating right or left.</span>
<span class="line-modified">265     public void DeleteStep() {</span>
<span class="line-modified">266         // Pr is Parent, Br is Brother</span>
<span class="line-modified">267         Node Pr, Br;</span>
<span class="line-modified">268         switch (stage) {</span>
<span class="line-modified">269             // This stage delete a node from the tree.</span>
<span class="line-modified">270             case 1:</span>
<span class="line-modified">271                 Tree_Delete();</span>
<span class="line-modified">272                 break;</span>
<span class="line-modified">273             // This stage marks a nodes that will be recolored or perform other stage.</span>
<span class="line-modified">274             case 2:</span>
<span class="line-modified">275                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">276                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-modified">277                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">278                 } else {</span>
<span class="line-modified">279                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">280                 }</span>
<span class="line-modified">281                 if (Br.getColor() == Node.Red) {</span>
<span class="line-modified">282                     stage = 3;</span>
<span class="line-modified">283                 } else if ((Br.getNode(Node.Right_son).getColor() == Node.Black)</span>
<span class="line-added">284                         &amp;&amp; (Br.getNode(Node.Left_son).getColor() == Node.Black)) {</span>
<span class="line-added">285                     stage = 5;</span>
<span class="line-added">286                     DeleteStep();</span>
<span class="line-added">287                 } else {</span>
<span class="line-added">288                     stage = 7;</span>
<span class="line-added">289                     DeleteStep();</span>
<span class="line-added">290                 }</span>
<span class="line-added">291                 break;</span>
<span class="line-added">292             // This stage recolors marked nodes.</span>
<span class="line-added">293             case 3:</span>
<span class="line-added">294                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">295                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">296                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">297                 } else {</span>
<span class="line-added">298                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">299                 }</span>
<span class="line-added">300                 Br.setColor(Node.Black);</span>
<span class="line-added">301                 Pr.setColor(Node.Red);</span>
<span class="line-added">302 </span>
<span class="line-added">303                 stage = 4;</span>
<span class="line-added">304                 break;</span>
<span class="line-added">305             // This stage performs rotation operation</span>
<span class="line-added">306             case 4:</span>
<span class="line-added">307                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">308                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">309                     Left_Rotate(Pr);</span>
<span class="line-added">310                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">311                 } else {</span>
<span class="line-added">312                     Right_Rotate(Pr);</span>
<span class="line-added">313                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">314                 }</span>
<span class="line-added">315                 if ((Br.getNode(Node.Right_son).getColor() == Node.Black)</span>
<span class="line-added">316                         &amp;&amp; (Br.getNode(Node.Left_son).getColor() == Node.Black)) {</span>
<span class="line-added">317                     stage = 5;</span>
<span class="line-added">318                 } else {</span>
<span class="line-added">319                     stage = 7;</span>
<span class="line-added">320                 }</span>
<span class="line-added">321 </span>
<span class="line-added">322                 break;</span>
<span class="line-added">323             // This stage marks nodes that will be recolor.</span>
<span class="line-added">324             case 5:</span>
<span class="line-added">325                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">326                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">327                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">328                 } else {</span>
<span class="line-added">329                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">330                 }</span>
<span class="line-added">331                 stage = 6;</span>
<span class="line-added">332                 break;</span>
<span class="line-added">333             // This stage recolors marked nodes.</span>
<span class="line-added">334             case 6:</span>
<span class="line-added">335                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">336                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">337                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">338                 } else {</span>
<span class="line-added">339                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">340                 }</span>
<span class="line-added">341                 Br.setColor(Node.Red);</span>
<span class="line-added">342                 node = Pr;</span>
<span class="line-added">343 </span>
<span class="line-added">344                 if ((node != root) &amp;&amp; (node.getColor() == Node.Black)) {</span>
<span class="line-added">345                     stage = 2;</span>
<span class="line-added">346                 } else if (node.getColor() == Node.Red) {</span>
<span class="line-added">347                     stage = 13;</span>
<span class="line-added">348                 } else</span>
<span class="line-added">349                     stage = 0;</span>
<span class="line-added">350                 break;</span>
<span class="line-added">351             // This stage marks nodes that will be recolor or perform other stage.</span>
<span class="line-added">352             case 7:</span>
<span class="line-added">353                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">354                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">355                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">356                     if ((Br.getNode(Node.Right_son)).getColor() == Node.Black) {</span>
<span class="line-added">357                         stage = 8;</span>
<span class="line-added">358                     } else {</span>
<span class="line-added">359                         stage = 10;</span>
<span class="line-added">360                         DeleteStep();</span>
361                     }
<a name="10" id="anc10"></a><span class="line-modified">362                 } else {</span>
<span class="line-modified">363                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">364                     if ((Br.getNode(Node.Left_son)).getColor() == Node.Black) {</span>
<span class="line-modified">365                         stage = 8;</span>
<span class="line-modified">366                     } else {</span>
<span class="line-modified">367                         stage = 10;</span>
<span class="line-modified">368                         DeleteStep();</span>










369                     }
<a name="11" id="anc11"></a><span class="line-modified">370                 }</span>
<span class="line-modified">371                 break;</span>
<span class="line-modified">372             // This stage recolors marked nodes.</span>
<span class="line-modified">373             case 8:</span>
<span class="line-modified">374                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">375                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-modified">376                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">377                     Br.getNode(Node.Left_son).setColor(Node.Black);</span>
<span class="line-added">378                 } else {</span>
<span class="line-added">379                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">380                     Br.getNode(Node.Right_son).setColor(Node.Black);</span>
<span class="line-added">381                 }</span>
<span class="line-added">382                 Br.setColor(Node.Red);</span>
<span class="line-added">383                 stage = 9;</span>
<span class="line-added">384                 break;</span>
<span class="line-added">385             // This stage performs rotation operation</span>
<span class="line-added">386             case 9:</span>
<span class="line-added">387                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">388                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">389                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">390                     Right_Rotate(Br);</span>
<span class="line-added">391                 } else {</span>
<span class="line-added">392                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">393                     Left_Rotate(Br);</span>
<span class="line-added">394                 }</span>
<span class="line-added">395 </span>
<span class="line-added">396                 stage = 10;</span>
<span class="line-added">397                 break;</span>
<span class="line-added">398             // This stage marks node that will be recolor.</span>
<span class="line-added">399             case 10:</span>
<span class="line-added">400                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">401                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">402                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">403                 } else {</span>
<span class="line-added">404                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">405                 }</span>
<span class="line-added">406 </span>
<span class="line-added">407                 stage = 11;</span>
<span class="line-added">408                 break;</span>
<span class="line-added">409             // This stage recolors marked nodes.</span>
<span class="line-added">410             case 11:</span>
<span class="line-added">411                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">412                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">413                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">414                     Br.getNode(Node.Right_son).setColor(Node.Black);</span>
<span class="line-added">415                 } else {</span>
<span class="line-added">416                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">417                     Br.getNode(Node.Left_son).setColor(Node.Black);</span>
<span class="line-added">418 </span>
<span class="line-added">419                 }</span>
<span class="line-added">420                 if (Br.getColor() != Pr.getColor()) {</span>
<span class="line-added">421                     Br.setColor(Pr.getColor());</span>
<span class="line-added">422                 }</span>
<span class="line-added">423                 if (Pr.getColor() != Node.Black) {</span>
<span class="line-added">424                     Pr.setColor(Node.Black);</span>
<span class="line-added">425                 }</span>
<span class="line-added">426 </span>
<span class="line-added">427                 stage = 12;</span>
<span class="line-added">428                 break;</span>
<span class="line-added">429             // This stage performs rotation operation.</span>
<span class="line-added">430             case 12:</span>
<span class="line-added">431                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">432                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">433                     Left_Rotate(Pr);</span>
<span class="line-added">434                 } else {</span>
<span class="line-added">435                     Right_Rotate(Pr);</span>
<span class="line-added">436                 }</span>
<span class="line-added">437                 node = root;</span>
<span class="line-added">438                 if (node.getColor() == Node.Red) {</span>
<span class="line-added">439                     stage = 13;</span>
<span class="line-added">440                 } else {</span>
441                     stage = 0;
<a name="12" id="anc12"></a><span class="line-modified">442                 }</span>
<span class="line-modified">443                 break;</span>
<span class="line-modified">444             // This stage marks a node that will be recolored</span>
<span class="line-modified">445             case 13:</span>
<span class="line-modified">446                 stage = 14;</span>
<span class="line-modified">447                 break;</span>
<span class="line-modified">448             // This stage recolors marked node.</span>
<span class="line-modified">449             case 14:</span>
<span class="line-modified">450                 node.setColor(Node.Black);</span>
<span class="line-modified">451                 stage = 0;</span>
<span class="line-modified">452                 break;</span>
<span class="line-modified">453         }</span>
<span class="line-modified">454     }</span>
<span class="line-modified">455 </span>
<span class="line-modified">456     // This method inserts the node &#39;node&#39; to the tree.</span>
<span class="line-modified">457     // it called from the first stage in the InsertStep method.</span>
<span class="line-modified">458     // we &#39;dive&#39; from the root to a leaf according to the node key</span>
<span class="line-modified">459     // and insert the node in the proper place.</span>
<span class="line-modified">460     private void Tree_Insert() {</span>
<span class="line-modified">461         Node n1, n2;</span>
<span class="line-modified">462         n1 = root;</span>
<span class="line-modified">463         n2 = treeNull;</span>
<span class="line-modified">464         while (n1 != treeNull) {</span>
<span class="line-modified">465             n2 = n1;</span>
<span class="line-modified">466             if (node.getKey() &lt; n1.getKey()) {</span>
<span class="line-modified">467                 n1 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">468             } else {</span>
<span class="line-modified">469                 n1 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">470             }</span>
<span class="line-modified">471         }</span>
<span class="line-modified">472         node.setNode(Node.Parent, n2);</span>
<span class="line-modified">473         if (n2 == treeNull) {</span>
<span class="line-modified">474             root = node;</span>
<span class="line-modified">475         }</span>
<span class="line-modified">476         else {</span>
<span class="line-modified">477             if (node.getKey() &lt; n2.getKey()) {</span>
<span class="line-modified">478                 n2.setNode(Node.Left_son, node);</span>
<span class="line-modified">479             } else {</span>
<span class="line-modified">480                 n2.setNode(Node.Right_son, node);</span>
<span class="line-modified">481             }</span>
<span class="line-modified">482         }</span>
<span class="line-modified">483         // updating the insertion stage.</span>
<span class="line-modified">484         if ((node == root) ||</span>
<span class="line-modified">485                 (node.getNode(Node.Parent).getColor() == Node.Black)) {</span>
<span class="line-modified">486             if (root.getColor() == Node.Red) {</span>
<span class="line-modified">487                 stage = 9;</span>
<span class="line-modified">488             } else {</span>
<span class="line-modified">489                 stage = 0;</span>
<span class="line-modified">490             }</span>
<span class="line-modified">491         } else {</span>






































492             stage = 2;
<a name="13" id="anc13"></a><span class="line-modified">493             InsertStep();</span>
<span class="line-modified">494         }</span>
<span class="line-modified">495         num_of_nodes++;   // increasing the number of nodes</span>
<span class="line-modified">496     }</span>
<span class="line-modified">497 </span>
<span class="line-modified">498     // This method deletes the node &#39;node&#39; from the tree.</span>
<span class="line-modified">499     // it called from the first stage in the DeleteStep method.</span>
<span class="line-modified">500     // if node has at most one son we just remove it and connect</span>
<span class="line-modified">501     // his son and parent. If it has 2 sons we delete his successor</span>
<span class="line-modified">502     // that has at most one son and replace him with the successor.</span>
<span class="line-modified">503     private void Tree_Delete() {</span>
<span class="line-modified">504         Node n1, n2, n3;</span>
<span class="line-modified">505         if ((node.getNode(Node.Left_son) == treeNull) ||</span>
<span class="line-modified">506                 (node.getNode(Node.Right_son) == treeNull)) {</span>
<span class="line-modified">507             n1 = node;</span>
<span class="line-modified">508         } else {</span>
<span class="line-modified">509             n1 = Tree_Successor(node);</span>
<span class="line-modified">510         }</span>
<span class="line-modified">511 </span>
<span class="line-modified">512         if (n1.getNode(Node.Left_son) != treeNull) {</span>
<span class="line-modified">513             n2 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">514         } else {</span>
<span class="line-modified">515             n2 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">516         }</span>
<span class="line-modified">517 </span>
<span class="line-modified">518         n3 = n1.getNode(Node.Parent);</span>
<span class="line-modified">519         n2.setNode(Node.Parent, n3);</span>
<span class="line-modified">520         if (n3 == treeNull) {</span>
<span class="line-modified">521             root = n2;</span>
<span class="line-modified">522         } else if (n1 == n3.getNode(Node.Left_son)) {</span>
<span class="line-modified">523             n3.setNode(Node.Left_son, n2);</span>
<span class="line-modified">524         } else {</span>
<span class="line-modified">525             n3.setNode(Node.Right_son, n2);</span>
<span class="line-modified">526         }</span>
<span class="line-modified">527 </span>
<span class="line-modified">528         if (n1 != node) {</span>
<span class="line-modified">529             node.setKey(n1.getKey());</span>
<span class="line-modified">530         }</span>
<span class="line-modified">531 </span>
<span class="line-modified">532         node = n2;</span>
<span class="line-modified">533         if (n1.getColor() == Node.Black) {</span>
<span class="line-modified">534             if ((node != root) &amp;&amp; (node.getColor() == Node.Black)) {</span>
<span class="line-modified">535                 stage = 2;</span>
<span class="line-modified">536             } else if (node.getColor() == Node.Red) {</span>
<span class="line-modified">537                 stage = 13;</span>
<span class="line-modified">538             } else {</span>
<span class="line-modified">539                 stage = 0;</span>
<span class="line-modified">540             }</span>
<span class="line-modified">541         } else {</span>
<span class="line-modified">542             stage = 0;</span>
<span class="line-modified">543         }</span>
<span class="line-modified">544         // decrease the number of nodes.</span>
<span class="line-modified">545         num_of_nodes--;</span>
<span class="line-modified">546     }</span>
<span class="line-modified">547 </span>
<span class="line-modified">548     // This method returns the successor of the node n in the tree.</span>
<span class="line-modified">549     private Node Tree_Successor(Node n) {</span>
<span class="line-modified">550         Node n1;</span>
<span class="line-modified">551         if (n.getNode(Node.Right_son) != treeNull) {</span>
<span class="line-modified">552             n = n.getNode(Node.Right_son);</span>
<span class="line-modified">553             while (n.getNode(Node.Left_son) != treeNull) {</span>
<span class="line-modified">554                 n = n.getNode(Node.Left_son);</span>
<span class="line-modified">555             }</span>
<span class="line-modified">556             return n;</span>
<span class="line-modified">557         }</span>
<span class="line-modified">558         n1 = n.getNode(Node.Parent);</span>
<span class="line-modified">559         while ((n1 != treeNull) &amp;&amp; (n == n1.getNode(Node.Right_son))) {</span>
<span class="line-modified">560             n = n1;</span>
<span class="line-modified">561             n1 = n1.getNode(Node.Parent);</span>
<span class="line-modified">562         }</span>
<span class="line-modified">563         return n1;</span>
<span class="line-modified">564     }</span>
<span class="line-modified">565 </span>
<span class="line-modified">566     // This method performs Left Rotation with n1.</span>
<span class="line-modified">567     private void Left_Rotate(Node n1) {</span>
<span class="line-modified">568         Node n2;</span>
<span class="line-modified">569 </span>
<span class="line-modified">570         n2 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">571         n1.setNode(Node.Right_son, n2.getNode(Node.Left_son));</span>
<span class="line-modified">572         if (n2.getNode(Node.Left_son) != treeNull) {</span>
<span class="line-modified">573             n2.getNode(Node.Left_son).setNode(Node.Parent, n1);</span>
<span class="line-modified">574         }</span>
<span class="line-modified">575         n2.setNode(Node.Parent, n1.getNode(Node.Parent));</span>
<span class="line-modified">576         if (n1.getNode(Node.Parent) == treeNull) {</span>
<span class="line-modified">577             root = n2;</span>
<span class="line-modified">578         } else if (n1 == n1.getNode(Node.Parent).getNode(Node.Left_son)) {</span>
<span class="line-modified">579             n1.getNode(Node.Parent).setNode(Node.Left_son, n2);</span>
<span class="line-modified">580         } else {</span>
<span class="line-modified">581             n1.getNode(Node.Parent).setNode(Node.Right_son, n2);</span>
<span class="line-modified">582         }</span>
<span class="line-modified">583         n2.setNode(Node.Left_son, n1);</span>
<span class="line-modified">584         n1.setNode(Node.Parent, n2);</span>
<span class="line-modified">585     }</span>
<span class="line-modified">586 </span>
<span class="line-modified">587     // This method performs Right Rotation with n1.</span>
<span class="line-modified">588     private void Right_Rotate(Node n1) {</span>
<span class="line-modified">589         Node n2;</span>
<span class="line-modified">590 </span>
<span class="line-modified">591         n2 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">592         n1.setNode(Node.Left_son, n2.getNode(Node.Right_son));</span>
<span class="line-modified">593         if (n2.getNode(Node.Right_son) != treeNull) {</span>
<span class="line-modified">594             n2.getNode(Node.Right_son).setNode(Node.Parent, n1);</span>
<span class="line-modified">595         }</span>
<span class="line-modified">596         n2.setNode(Node.Parent, n1.getNode(Node.Parent));</span>
<span class="line-modified">597         if (n1.getNode(Node.Parent) == treeNull) {</span>
<span class="line-modified">598             root = n2;</span>
<span class="line-modified">599         } else if (n1 == (n1.getNode(Node.Parent)).getNode(Node.Left_son)) {</span>
<span class="line-modified">600             n1.getNode(Node.Parent).setNode(Node.Left_son, n2);</span>
<span class="line-modified">601         } else {</span>
<span class="line-modified">602             n1.getNode(Node.Parent).setNode(Node.Right_son, n2);</span>
<span class="line-modified">603         }</span>
<span class="line-added">604         n2.setNode(Node.Right_son, n1);</span>
<span class="line-added">605         n1.setNode(Node.Parent, n2);</span>
<span class="line-added">606     }</span>
<span class="line-added">607 </span>
<span class="line-added">608     // This method searches the tree for a node with key &#39;key&#39;, and</span>
<span class="line-added">609     // returns the node on success otherwise treeNull.</span>
<span class="line-added">610     public Node Search(int key) {</span>
<span class="line-added">611         Node node;</span>
<span class="line-added">612         node = root;</span>
<span class="line-added">613         while ((node != treeNull) &amp;&amp; (key != node.getKey())) {</span>
<span class="line-added">614             if (key &lt; node.getKey()) {</span>
<span class="line-added">615                 node = node.getNode(Node.Left_son);</span>
<span class="line-added">616             } else {</span>
<span class="line-added">617                 node = node.getNode(Node.Right_son);</span>
<span class="line-added">618             }</span>
<span class="line-added">619         }</span>
<span class="line-added">620         return node;</span>
<span class="line-added">621     }</span>
<span class="line-added">622 </span>
<span class="line-added">623     // This method updates the tree height. it uses a recursive method</span>
<span class="line-added">624     // findHeight.</span>
<span class="line-added">625     private void updateHeight() {</span>
<span class="line-added">626         height = 0;</span>
<span class="line-added">627         if (root != treeNull) {</span>
<span class="line-added">628             findHeight(root, 1);</span>
<span class="line-added">629         }</span>
<span class="line-added">630     }</span>
<span class="line-added">631 </span>
<span class="line-added">632     // This is a recursive method that find a node height.</span>
<span class="line-added">633     private void findHeight(Node n, int curr) {</span>
<span class="line-added">634         if (height &lt; curr) {</span>
<span class="line-added">635             height = curr;</span>
<span class="line-added">636         }</span>
<span class="line-added">637         if (n.getNode(Node.Left_son) != treeNull) {</span>
<span class="line-added">638             findHeight(n.getNode(Node.Left_son), curr + 1);</span>
<span class="line-added">639         }</span>
<span class="line-added">640         if (n.getNode(Node.Right_son) != treeNull) {</span>
<span class="line-added">641             findHeight(n.getNode(Node.Right_son), curr + 1);</span>
<span class="line-added">642         }</span>
<span class="line-added">643     }</span>
644 
645 }
<a name="14" id="anc14"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="14" type="hidden" />
</body>
</html>