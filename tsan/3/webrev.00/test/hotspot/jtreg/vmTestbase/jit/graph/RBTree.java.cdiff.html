<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/jtreg/vmTestbase/jit/graph/RBTree.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="Node.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="test1.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/jit/graph/RBTree.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2008, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 18,710 ***</span>
   *
   * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   */
<span class="line-removed">- package jit.graph;</span>
<span class="line-removed">- </span>
<span class="line-removed">- import nsk.share.TestFailure;</span>
  
<span class="line-modified">! //import Node;</span>
  
  // This class defines the tree object.
<span class="line-modified">! </span>
<span class="line-modified">! public class RBTree</span>
<span class="line-modified">! {</span>
<span class="line-modified">!    public final static int  maxNodes = 70;        // maximum nodes allowed.</span>
<span class="line-modified">!    public final static int  INSERT   = 0;         // constants indicating</span>
<span class="line-modified">!    public final static int  DELETE   = 1;         // the current operation</span>
<span class="line-modified">!    public final static int  NOP      = 2;</span>
<span class="line-modified">!    public final static Node treeNull = new Node(); // the tree NULL node.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    private Node    root;</span>
<span class="line-modified">!    private int     num_of_nodes;</span>
<span class="line-modified">!    private int     height;           // The tree heigth ,it is updated</span>
<span class="line-modified">!                                      // in each operation.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // since the algorithem is executed in stages I have to remember data</span>
<span class="line-modified">!    // on the state.</span>
<span class="line-modified">!    private Node    node;  // The current operation is being done on it.</span>
<span class="line-modified">!    private int     action;// The operation being performed (insert / delete)</span>
<span class="line-modified">!    private int     stage; // The current stage of execution</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // the constructor initialize the object fields.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    public RBTree()</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       root         = treeNull;</span>
<span class="line-modified">!       node         = treeNull;</span>
<span class="line-modified">!       num_of_nodes = 0;</span>
<span class="line-modified">!       height       = 0;</span>
<span class="line-modified">!       action       = NOP;</span>
<span class="line-modified">!       stage        = 0;</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method return the root of the tree.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    public Node getRoot()</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       return root;</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method return the number of nodes in the tree.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    public int getNodes()</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       return num_of_nodes;</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method return the heigth of the tree.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    public int getHeight()</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       return height;</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method inserts k into the Red Black Tree</span>
<span class="line-modified">! </span>
<span class="line-modified">!    public boolean RBInsert(int k)</span>
<span class="line-modified">!    {</span>
<span class="line-modified">! </span>
<span class="line-modified">!       Thread Pause = new Thread();   // this thread is used for delay</span>
<span class="line-modified">!                                      // between the stages.</span>
<span class="line-modified">!       if (action != NOP)  // checking similar to the RB_Insert method</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!          System.out.println</span>
<span class="line-modified">!          (&quot;Only one operation can be done at a time.&quot;);</span>
<span class="line-modified">!          return false;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!       if (num_of_nodes == maxNodes)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!          System.out.println</span>
<span class="line-modified">!          (&quot;The maximum nodes allowed is already reached.&quot;);</span>
<span class="line-modified">!          return false;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!       if (Search(k) == treeNull) // Check if there is already node with key k.</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!          action = INSERT;</span>
<span class="line-modified">!          node = new Node(k);</span>
<span class="line-modified">!          node.setNode(Node.Left_son,treeNull);</span>
<span class="line-modified">!          node.setNode(Node.Right_son,treeNull);</span>
<span class="line-modified">!          node.setNode(Node.Parent,treeNull);</span>
<span class="line-modified">!          stage = 1;</span>
<span class="line-modified">!          while (stage != 0)     // This is the loop that perform all the</span>
<span class="line-modified">!          {                      // operation steps.</span>
<span class="line-modified">!             InsertStep();       // perform one step</span>
<span class="line-modified">!             updateHeight();     // update the tree height</span>
<span class="line-modified">!          }</span>
<span class="line-modified">!          action = NOP;           // set the action to NoOPretion.</span>
<span class="line-modified">!          return true;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         System.out.println</span>
<span class="line-modified">!         (&quot;Insertion failed. This key already exist.&quot;);</span>
<span class="line-modified">!       return false;</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method deletes the element k from the Red Black tree</span>
<span class="line-modified">! </span>
<span class="line-modified">!    public boolean RBDelete(int k)</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       Thread Pause = new Thread();   // this thread is used for delay</span>
<span class="line-modified">!                                      // between the stages.</span>
<span class="line-modified">!       if (action != NOP)</span>
<span class="line-modified">!       {                              // checking like in RB_Delete method</span>
<span class="line-modified">!          System.out.println</span>
<span class="line-modified">!          (&quot;Only one operation can be done at a time.&quot;);</span>
<span class="line-modified">!          return false;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!       node = Search(k);</span>
<span class="line-modified">!       if (node != treeNull)       // Check if there is a node with key k.</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!          action = DELETE;</span>
<span class="line-modified">!          stage = 1;</span>
<span class="line-modified">!          while (stage != 0)    // this loop perform all the operation</span>
<span class="line-modified">!          {                     // steps.</span>
<span class="line-modified">!             DeleteStep();               // perform one step</span>
<span class="line-modified">!             updateHeight();             // update the tree height</span>
<span class="line-modified">! </span>
<span class="line-modified">!          }</span>
<span class="line-modified">!          action = NOP;</span>
<span class="line-modified">!          return true;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!          System.out.println</span>
<span class="line-modified">!          (&quot;Deletion failed. This key doesn&#39;t exist.&quot;);</span>
<span class="line-modified">!       return false;</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method perform one step in the insertion operation.</span>
<span class="line-removed">-    // If perform a step acording to the stage variable.</span>
<span class="line-removed">-    // I will not explain exactly what each stage do, just that they</span>
<span class="line-removed">-    // divided to 4 categories:</span>
<span class="line-removed">-    // 1. inserting a node to the tree.</span>
<span class="line-removed">-    // 2. marking nodes that will be recolored.</span>
<span class="line-removed">-    // 3. recoloring nodes.</span>
<span class="line-removed">-    // 4. rotating right or left.</span>
<span class="line-removed">- </span>
<span class="line-removed">-    private void InsertStep()</span>
<span class="line-removed">-    {</span>
<span class="line-removed">-       Node Pr,GrPr,Un; // Pr is parent, GrPr is grandparent</span>
<span class="line-removed">-                        // and Un is uncle.</span>
<span class="line-removed">-       switch (stage)</span>
<span class="line-removed">-       {</span>
<span class="line-removed">-            case 1: // Inserting a node to the tree</span>
<span class="line-removed">-                /*</span>
<span class="line-removed">-                   System.out.println  // send a message to the screen</span>
<span class="line-removed">-                   (new String(&quot;Inserting &quot;)</span>
<span class="line-removed">-                   .concat(Integer.toString(node.getKey())));</span>
<span class="line-removed">-                */</span>
<span class="line-removed">-                   Tree_Insert();        // inserting an element to the tree</span>
<span class="line-removed">-                   break;</span>
<span class="line-removed">-            case 2:       // mid stage that move to algorithem to the</span>
<span class="line-removed">-                          // proper next stage, and send proper message</span>
<span class="line-removed">-                          // to the screen</span>
<span class="line-removed">-                   Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">-                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-removed">-                   if (Pr == GrPr.getNode(Node.Left_son))</span>
<span class="line-removed">-                   {</span>
<span class="line-removed">-                      Un = GrPr.getNode(Node.Right_son);</span>
<span class="line-removed">-                      if (Un.getColor() == Node.Red)</span>
<span class="line-removed">-                      {</span>
                          stage = 3;
<span class="line-modified">!                      }</span>
<span class="line-modified">!                      else</span>
<span class="line-modified">!                         if (node == Pr.getNode(Node.Right_son))</span>
<span class="line-modified">!                         {</span>
<span class="line-modified">!                            node = Pr;</span>
<span class="line-modified">!                            stage = 5;</span>
<span class="line-modified">!                         }</span>
<span class="line-modified">!                         else</span>
<span class="line-modified">!                         {</span>
<span class="line-removed">-                            stage = 6;</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                   }</span>
<span class="line-removed">-                   else</span>
<span class="line-removed">-                   {</span>
<span class="line-removed">-                      Un = GrPr.getNode(Node.Left_son);</span>
<span class="line-removed">-                      if (Un.getColor() == Node.Red)</span>
<span class="line-removed">-                      {</span>
                          stage = 3;
<span class="line-modified">!                      }</span>
<span class="line-modified">!                      else</span>
<span class="line-modified">!                         if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">!                         {</span>
<span class="line-modified">!                            node = Pr;</span>
<span class="line-modified">!                            stage = 5;</span>
<span class="line-modified">!                         }</span>
<span class="line-modified">!                         else</span>
<span class="line-modified">!                         {</span>
<span class="line-modified">!                            stage = 6;</span>
<span class="line-modified">!                         }</span>
<span class="line-modified">!                   }</span>
<span class="line-modified">!                   break;</span>
<span class="line-modified">!            case 3:       // This stage marks node that will be recolored</span>
<span class="line-modified">!                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">!                   if (Pr == GrPr.getNode(Node.Left_son))</span>
<span class="line-modified">!                      Un = GrPr.getNode(Node.Right_son);</span>
<span class="line-modified">!                   else</span>
<span class="line-modified">!                       Un = GrPr.getNode(Node.Left_son);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                   node = GrPr;</span>
<span class="line-modified">!                   stage = 4;</span>
<span class="line-modified">!                   break;</span>
<span class="line-modified">!            case 4:          // this stage recolor marked nodes.</span>
<span class="line-modified">!                   node.setColor(Node.Red);</span>
<span class="line-modified">!                   (node.getNode(Node.Left_son)).setColor(Node.Black);</span>
<span class="line-modified">!                   (node.getNode(Node.Right_son)).setColor(Node.Black);</span>
<span class="line-modified">! </span>
<span class="line-removed">-                   if ((node == root) ||</span>
<span class="line-removed">-                      ((node.getNode(Node.Parent)).getColor() == Node.Black))</span>
<span class="line-removed">-                      if (root.getColor() == Node.Red)</span>
<span class="line-removed">-                      {</span>
                          stage = 9;
<span class="line-modified">!                      }</span>
<span class="line-removed">-                      else</span>
                          stage = 0;
<span class="line-modified">!                   else</span>
<span class="line-modified">!                   {</span>
<span class="line-modified">!                      stage = 2;</span>
<span class="line-modified">!                      InsertStep();</span>
<span class="line-modified">!                   }</span>
<span class="line-modified">!                   break;</span>
<span class="line-modified">!            case 5:        // This stage perform rotation operation</span>
<span class="line-modified">!                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                   if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">!                      Left_Rotate(node);</span>
<span class="line-modified">!                   else</span>
<span class="line-modified">!                      Right_Rotate(node);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                   stage = 6;</span>
<span class="line-modified">!                   break;</span>
<span class="line-modified">!            case 6:        // This stage marks nodes that will be recolor.</span>
<span class="line-modified">!                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                   stage = 7;</span>
<span class="line-modified">!                   break;</span>
<span class="line-modified">!            case 7:        // This stage recolor marked nodes.</span>
<span class="line-modified">!                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                   Pr.setColor(Node.Black);</span>
<span class="line-modified">!                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">!                   GrPr.setColor(Node.Red);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                   stage = 8;</span>
<span class="line-modified">!                   break;</span>
<span class="line-modified">!            case 8:        // This stage perform rotation operation</span>
<span class="line-modified">!                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">!                   if (Pr == GrPr.getNode(Node.Left_son))</span>
<span class="line-modified">!                      Right_Rotate(GrPr);</span>
<span class="line-modified">!                   else</span>
<span class="line-modified">!                      Left_Rotate(GrPr);</span>
<span class="line-modified">!                   if (root.getColor() == Node.Red)</span>
<span class="line-modified">!                   {</span>
<span class="line-modified">!                      stage = 9;</span>
<span class="line-modified">!                   }</span>
<span class="line-modified">!                   else</span>
<span class="line-removed">-                      stage = 0;</span>
<span class="line-removed">-                   break;</span>
<span class="line-removed">-            case 9:        // this stage mark the root.</span>
<span class="line-removed">-                    stage = 10;</span>
<span class="line-removed">-                   break;</span>
<span class="line-removed">-            case 10:       // This stage recolor the root.</span>
<span class="line-removed">-                   root.setColor(Node.Black);</span>
<span class="line-removed">-                   stage = 0;</span>
<span class="line-removed">-                   break;</span>
<span class="line-removed">-       }</span>
<span class="line-removed">-    }</span>
<span class="line-removed">- </span>
<span class="line-removed">-    // This method perform one step in the deletion operation.</span>
<span class="line-removed">-    // If perform a step acording to the stage variable.</span>
<span class="line-removed">-    // I will explain exactly what each stage do, just that they</span>
<span class="line-removed">-    // divided to 4 categories:</span>
<span class="line-removed">-    // 1. deleting a node from the tree.</span>
<span class="line-removed">-    // 2. marking nodes that will be recolored.</span>
<span class="line-removed">-    // 3. recoloring nodes.</span>
<span class="line-removed">-    // 4. rotating right or left.</span>
<span class="line-removed">- </span>
<span class="line-removed">-    public void DeleteStep()</span>
<span class="line-removed">-    {</span>
<span class="line-removed">-        Node Pr,Br;     // Pr is Parent ,Br is Brother</span>
<span class="line-removed">-        switch (stage)</span>
<span class="line-removed">-        {</span>
<span class="line-removed">-              case 1:   // This stage delete a node from the tree.</span>
<span class="line-removed">-                  /*</span>
<span class="line-removed">-                     System.out.println</span>
<span class="line-removed">-                     (new String(&quot;Deleting &quot;)</span>
<span class="line-removed">-                     .concat(Integer.toString(node.getKey())));</span>
<span class="line-removed">-                  */</span>
<span class="line-removed">-                     Tree_Delete();</span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">-              case 2:   // This stage marks a nodes that will be recolored</span>
<span class="line-removed">-                        // or perform other stage.</span>
<span class="line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">-                     if (Br.getColor() == Node.Red)</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                         stage = 3;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                        if (((Br.getNode(Node.Right_son)).getColor() == Node.Black)</span>
<span class="line-removed">-                           &amp;&amp; ((Br.getNode(Node.Left_son)).getColor() == Node.Black))</span>
<span class="line-removed">-                        {</span>
<span class="line-removed">-                           stage = 5;</span>
<span class="line-removed">-                           DeleteStep();</span>
<span class="line-removed">-                        }</span>
<span class="line-removed">-                        else</span>
<span class="line-removed">-                        {</span>
<span class="line-removed">-                           stage = 7;</span>
<span class="line-removed">-                           DeleteStep();</span>
<span class="line-removed">-                        }</span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">-              case 3:    // this stage recolor marked nodes.</span>
<span class="line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     Br.setColor(Node.Black);</span>
<span class="line-removed">-                     Pr.setColor(Node.Red);</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     stage = 4;</span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">-              case 4:     // this stage perform rotation operation</span>
<span class="line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                        Left_Rotate(Pr);</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                        Right_Rotate(Pr);</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     if (((Br.getNode(Node.Right_son)).getColor() == Node.Black)</span>
<span class="line-removed">-                        &amp;&amp; ((Br.getNode(Node.Left_son)).getColor() == Node.Black))</span>
<span class="line-removed">-                        stage = 5;</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                        stage = 7;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">-              case 5:     // this stage marks nodes that will be recolor.</span>
<span class="line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     stage = 6;</span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">-              case 6:     // This stage recolor marked nodes.</span>
<span class="line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">-                     Br.setColor(Node.Red);</span>
<span class="line-removed">-                     node = Pr;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     if ((node != root) &amp;&amp; (node.getColor() == Node.Black))</span>
<span class="line-removed">-                        stage = 2;</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                        if (node.getColor() == Node.Red)</span>
<span class="line-removed">-                        {</span>
<span class="line-removed">-                           stage = 13;</span>
<span class="line-removed">-                        }</span>
<span class="line-removed">-                        else</span>
<span class="line-removed">-                           stage = 0;</span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">-              case 7:     // this stage marks nodes that will be recolor</span>
<span class="line-removed">-                          // or perform other stage.</span>
<span class="line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">-                        if ((Br.getNode(Node.Right_son)).getColor() == Node.Black)</span>
<span class="line-removed">-                        {</span>
<span class="line-removed">-                           stage = 8;</span>
<span class="line-removed">-                        }</span>
<span class="line-removed">-                        else</span>
<span class="line-removed">-                        {</span>
<span class="line-removed">-                           stage = 10;</span>
<span class="line-removed">-                           DeleteStep();</span>
<span class="line-removed">-                        }</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">-                        if ((Br.getNode(Node.Left_son)).getColor() == Node.Black)</span>
<span class="line-removed">-                        {</span>
<span class="line-removed">-                           stage = 8;</span>
<span class="line-removed">-                        }</span>
<span class="line-removed">-                        else</span>
<span class="line-removed">-                        {</span>
<span class="line-removed">-                           stage = 10;</span>
<span class="line-removed">-                           DeleteStep();</span>
<span class="line-removed">-                        }</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">-              case 8:     // this stage recolor marked nodes.</span>
<span class="line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">-                        (Br.getNode(Node.Left_son)).setColor(Node.Black);</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">-                        (Br.getNode(Node.Right_son)).setColor(Node.Black);</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     Br.setColor(Node.Red);</span>
                      stage = 9;
<span class="line-modified">!                     break;</span>
<span class="line-modified">!              case 9:    // this stage perform rotation operation</span>
<span class="line-modified">!                     Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">!                     {</span>
<span class="line-modified">!                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">!                        Right_Rotate(Br);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     else</span>
<span class="line-modified">!                     {</span>
<span class="line-modified">!                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">!                        Left_Rotate(Br);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     stage = 10;</span>
<span class="line-modified">!                     break;</span>
<span class="line-modified">!              case 10:   // This stage marks node that will be recolor.</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">!                     {</span>
<span class="line-modified">!                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     else</span>
<span class="line-modified">!                     {</span>
<span class="line-modified">!                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     stage = 11;</span>
<span class="line-modified">!                     break;</span>
<span class="line-modified">!              case 11:    // this stage recolor marked nodes.</span>
<span class="line-modified">!                     Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">!                     {</span>
<span class="line-modified">!                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">!                        (Br.getNode(Node.Right_son)).setColor(Node.Black);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     else</span>
<span class="line-modified">!                     {</span>
<span class="line-modified">!                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">!                        (Br.getNode(Node.Left_son)).setColor(Node.Black);</span>
<span class="line-modified">! </span>
                      }
<span class="line-modified">!                     if (Br.getColor() != Pr.getColor())</span>
<span class="line-modified">!                        Br.setColor(Pr.getColor());</span>
<span class="line-modified">!                     if (Pr.getColor() != Node.Black)</span>
<span class="line-modified">!                        Pr.setColor(Node.Black);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     stage = 12;</span>
<span class="line-modified">!                     break;</span>
<span class="line-removed">-              case 12:    // this stage perform rotation operation.</span>
<span class="line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">-                        Left_Rotate(Pr);</span>
<span class="line-removed">-                     else</span>
<span class="line-removed">-                        Right_Rotate(Pr);</span>
<span class="line-removed">-                     node = root;</span>
<span class="line-removed">-                     if (node.getColor() == Node.Red)</span>
<span class="line-removed">-                     {</span>
<span class="line-removed">-                        stage = 13;</span>
                      }
<span class="line-modified">!                     else</span>
<span class="line-modified">!                        stage = 0;</span>
<span class="line-modified">!                     break;</span>
<span class="line-modified">!              case 13:    // this stage marks a node that will be recolor</span>
<span class="line-modified">!                     stage = 14;</span>
<span class="line-modified">!                     break;</span>
<span class="line-modified">!              case 14:    // this stage recolor marked node.</span>
<span class="line-modified">!                     node.setColor(Node.Black);</span>
                      stage = 0;
<span class="line-modified">!                     break;</span>
<span class="line-modified">!        }</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method insert the node &#39;node&#39; to the tree.</span>
<span class="line-modified">!    // it called from the first stage in the InsertStep method.</span>
<span class="line-modified">!    // we &#39;dive&#39; from the root to a leaf acording to the node key</span>
<span class="line-modified">!    // and insert the node in the proper place.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    private void Tree_Insert()</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!        Node n1,n2;</span>
<span class="line-modified">!        n1 = root;</span>
<span class="line-modified">!        n2 = treeNull;</span>
<span class="line-modified">!        while (n1 != treeNull)</span>
<span class="line-modified">!        {</span>
<span class="line-modified">!           n2 = n1;</span>
<span class="line-modified">!           if (node.getKey() &lt; n1.getKey())</span>
<span class="line-modified">!              n1 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">!           else</span>
<span class="line-modified">!              n1 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">!        }</span>
<span class="line-modified">!        node.setNode(Node.Parent,n2);</span>
<span class="line-modified">!        if (n2 == treeNull)</span>
<span class="line-modified">!           root = node;</span>
<span class="line-modified">!        else</span>
<span class="line-modified">!        {</span>
<span class="line-modified">!           if (node.getKey() &lt; n2.getKey())</span>
<span class="line-modified">!              n2.setNode(Node.Left_son,node);</span>
<span class="line-modified">!           else</span>
<span class="line-modified">!              n2.setNode(Node.Right_son,node);</span>
<span class="line-modified">!        }</span>
<span class="line-modified">!        //Parent.display.drawTree();</span>
<span class="line-modified">!        // updating the insertion stage.</span>
<span class="line-modified">!        if ((node == root) ||</span>
<span class="line-modified">!           ((node.getNode(Node.Parent)).getColor() == Node.Black))</span>
<span class="line-modified">!           if (root.getColor() == Node.Red)</span>
<span class="line-modified">!           {</span>
<span class="line-modified">!              stage = 9;</span>
<span class="line-modified">!           }</span>
<span class="line-modified">!           else</span>
<span class="line-modified">!              stage = 0;</span>
<span class="line-modified">!        else</span>
<span class="line-modified">!        {</span>
<span class="line-modified">!           stage = 2;</span>
<span class="line-modified">!           InsertStep();</span>
<span class="line-modified">!        }</span>
<span class="line-modified">!        num_of_nodes++;   // increasing the number of nodes</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-removed">-    // This method delete the node &#39;node&#39; from the tree.</span>
<span class="line-removed">-    // it called from the first stage in the DeleteStep method.</span>
<span class="line-removed">-    // if node has at most one son we just remove it and connect</span>
<span class="line-removed">-    // his son and parent. If it has 2 sons we delete his successor</span>
<span class="line-removed">-    // that has at most one son and replace him with the successor.</span>
<span class="line-removed">- </span>
<span class="line-removed">-    private void Tree_Delete()</span>
<span class="line-removed">-    {</span>
<span class="line-removed">-       Node n1,n2,n3;</span>
<span class="line-removed">-       if ((node.getNode(Node.Left_son) == treeNull) ||</span>
<span class="line-removed">-           (node.getNode(Node.Right_son) == treeNull))</span>
<span class="line-removed">-          n1 = node;</span>
<span class="line-removed">-       else</span>
<span class="line-removed">-          n1 = Tree_Successor(node);</span>
<span class="line-removed">-       if (n1.getNode(node.Left_son) != treeNull)</span>
<span class="line-removed">-          n2 = n1.getNode(Node.Left_son);</span>
<span class="line-removed">-       else</span>
<span class="line-removed">-          n2 = n1.getNode(Node.Right_son);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       n3 = n1.getNode(Node.Parent);</span>
<span class="line-removed">-       n2.setNode(Node.Parent,n3);</span>
<span class="line-removed">-       if (n3 == treeNull)</span>
<span class="line-removed">-          root = n2;</span>
<span class="line-removed">-       else</span>
<span class="line-removed">-          if (n1 == n3.getNode(Node.Left_son))</span>
<span class="line-removed">-             n3.setNode(Node.Left_son,n2);</span>
<span class="line-removed">-          else</span>
<span class="line-removed">-             n3.setNode(Node.Right_son,n2);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       if (n1 != node)</span>
<span class="line-removed">-       {</span>
<span class="line-removed">-          node.setKey(n1.getKey());</span>
<span class="line-removed">-       }</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
<span class="line-removed">-       node = n2;</span>
<span class="line-removed">-       if (n1.getColor() == Node.Black)</span>
<span class="line-removed">-          if ((node != root) &amp;&amp; (node.getColor() == Node.Black))</span>
              stage = 2;
<span class="line-modified">!          else</span>
<span class="line-modified">!             if (node.getColor() == Node.Red)</span>
<span class="line-modified">!                stage = 13;</span>
<span class="line-modified">!             else</span>
<span class="line-modified">!                stage = 0;</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!          stage = 0;</span>
<span class="line-modified">!       num_of_nodes--;      // decrease the number of nodes.</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method return the successor of the node n in the tree.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    private Node Tree_Successor(Node n)</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       Node n1;</span>
<span class="line-modified">!       if (n.getNode(Node.Right_son) != treeNull)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!          n = n.getNode(Node.Right_son);</span>
<span class="line-modified">!          while (n.getNode(Node.Left_son) != treeNull)</span>
<span class="line-modified">!              n = n.getNode(Node.Left_son);</span>
<span class="line-modified">!          return n;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!       n1 = n.getNode(Node.Parent);</span>
<span class="line-modified">!       while ((n1 != treeNull) &amp;&amp; (n == n1.getNode(Node.Right_son)))</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!          n = n1;</span>
<span class="line-modified">!          n1 = n1.getNode(Node.Parent);</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!       return n1;</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method perform Left Rotation with n1.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    private void Left_Rotate(Node n1)</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       Node n2;</span>
<span class="line-modified">! </span>
<span class="line-modified">!       n2 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">!       n1.setNode(Node.Right_son,n2.getNode(Node.Left_son));</span>
<span class="line-modified">!       if (n2.getNode(Node.Left_son) != treeNull)</span>
<span class="line-modified">!          (n2.getNode(Node.Left_son)).setNode(Node.Parent,n1);</span>
<span class="line-modified">!       n2.setNode(Node.Parent,n1.getNode(Node.Parent));</span>
<span class="line-modified">!       if (n1.getNode(Node.Parent) == treeNull)</span>
<span class="line-modified">!          root = n2;</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!          if (n1 == (n1.getNode(Node.Parent)).getNode(Node.Left_son))</span>
<span class="line-modified">!             (n1.getNode(Node.Parent)).setNode(Node.Left_son,n2);</span>
<span class="line-modified">!          else</span>
<span class="line-modified">!             (n1.getNode(Node.Parent)).setNode(Node.Right_son,n2);</span>
<span class="line-modified">!       n2.setNode(Node.Left_son,n1);</span>
<span class="line-modified">!       n1.setNode(Node.Parent,n2);</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method perform Right Rotation with n1.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    private void Right_Rotate(Node n1)</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       Node n2;</span>
<span class="line-modified">! </span>
<span class="line-modified">!       n2 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">!       n1.setNode(Node.Left_son,n2.getNode(Node.Right_son));</span>
<span class="line-modified">!       if (n2.getNode(Node.Right_son) != treeNull)</span>
<span class="line-modified">!          (n2.getNode(Node.Right_son)).setNode(Node.Parent,n1);</span>
<span class="line-modified">!       n2.setNode(Node.Parent,n1.getNode(Node.Parent));</span>
<span class="line-modified">!       if (n1.getNode(Node.Parent) == treeNull)</span>
<span class="line-modified">!          root = n2;</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!          if (n1 == (n1.getNode(Node.Parent)).getNode(Node.Left_son))</span>
<span class="line-modified">!             (n1.getNode(Node.Parent)).setNode(Node.Left_son,n2);</span>
<span class="line-modified">!          else</span>
<span class="line-modified">!             (n1.getNode(Node.Parent)).setNode(Node.Right_son,n2);</span>
<span class="line-modified">!       n2.setNode(Node.Right_son,n1);</span>
<span class="line-modified">!       n1.setNode(Node.Parent,n2);</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method search the tree for a node with key &#39;key&#39;, and</span>
<span class="line-modified">!    // return the node on success otherwise treeNull.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    public Node Search(int key)</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       Node node;</span>
<span class="line-modified">!       node = root;</span>
<span class="line-modified">!       while ((node != treeNull) &amp;&amp; (key != node.getKey()))</span>
<span class="line-modified">!          if (key &lt; node.getKey())</span>
<span class="line-modified">!             node = node.getNode(Node.Left_son);</span>
<span class="line-modified">!          else</span>
<span class="line-modified">!             node = node.getNode(Node.Right_son);</span>
<span class="line-modified">!       return node;</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This method update the tree height it uses a recursive method</span>
<span class="line-modified">!    // findheight.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    private void updateHeight()</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       height = 0;</span>
<span class="line-modified">!       if (root != treeNull)</span>
<span class="line-modified">!          findHeight(root,1);</span>
<span class="line-modified">!    }</span>
<span class="line-modified">! </span>
<span class="line-modified">!    // This is a recursive method that find a node height.</span>
<span class="line-modified">! </span>
<span class="line-modified">!    private void findHeight(Node n,int curr)</span>
<span class="line-modified">!    {</span>
<span class="line-modified">!       if (height &lt; curr)</span>
<span class="line-modified">!          height = curr;</span>
<span class="line-modified">!       if (n.getNode(Node.Left_son) != treeNull)</span>
<span class="line-modified">!          findHeight(n.getNode(Node.Left_son),curr+1);</span>
<span class="line-modified">!       if (n.getNode(Node.Right_son) != treeNull)</span>
<span class="line-modified">!          findHeight(n.getNode(Node.Right_son),curr+1);</span>
<span class="line-modified">!    }</span>
  
  }
<span class="line-new-header">--- 18,628 ---</span>
   *
   * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   */
  
<span class="line-modified">! package jit.graph;</span>
  
  // This class defines the tree object.
<span class="line-modified">! public class RBTree {</span>
<span class="line-modified">!     public final static int maxNodes = 70;      // maximum nodes allowed.</span>
<span class="line-modified">!     public final static int INSERT = 0;         // constants indicating</span>
<span class="line-modified">!     public final static int DELETE = 1;         // the current operation</span>
<span class="line-modified">!     public final static int NOP = 2;</span>
<span class="line-modified">!     public final static Node treeNull = new Node(); // the tree NULL node.</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private Node root;</span>
<span class="line-modified">!     private int num_of_nodes;</span>
<span class="line-modified">!     private int height;           // The tree height, it is updated</span>
<span class="line-modified">!     // in each operation.</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // since the algorithm is executed in stages I have to remember data</span>
<span class="line-modified">!     // on the state.</span>
<span class="line-modified">!     private Node node;  // The current operation is being done on it.</span>
<span class="line-modified">!     private int action; // The operation being performed (insert / delete)</span>
<span class="line-modified">!     private int stage;  // The current stage of execution</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // the constructor initializes the object fields.</span>
<span class="line-modified">!     public RBTree() {</span>
<span class="line-modified">!         root = treeNull;</span>
<span class="line-modified">!         node = treeNull;</span>
<span class="line-modified">!         num_of_nodes = 0;</span>
<span class="line-modified">!         height = 0;</span>
<span class="line-modified">!         action = NOP;</span>
<span class="line-modified">!         stage = 0;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method returns the root of the tree.</span>
<span class="line-modified">!     public Node getRoot() {</span>
<span class="line-modified">!         return root;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method returns the number of nodes in the tree.</span>
<span class="line-modified">!     public int getNodes() {</span>
<span class="line-modified">!         return num_of_nodes;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method returns the height of the tree.</span>
<span class="line-modified">!     public int getHeight() {</span>
<span class="line-modified">!         return height;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method inserts k into the Red Black Tree</span>
<span class="line-modified">!     public boolean RBInsert(int k) {</span>
<span class="line-modified">!         // checking similar to the RB_Insert method</span>
<span class="line-modified">!         if (action != NOP) {</span>
<span class="line-modified">!             System.out.println(&quot;Only one operation can be done at a time.&quot;);</span>
<span class="line-modified">!             return false;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">! </span>
<span class="line-modified">!         if (num_of_nodes == maxNodes) {</span>
<span class="line-modified">!             System.out.println(&quot;The maximum nodes allowed is already reached.&quot;);</span>
<span class="line-modified">!             return false;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">! </span>
<span class="line-modified">!         // Check if there is already node with key k.</span>
<span class="line-modified">!         if (Search(k) == treeNull) {</span>
<span class="line-modified">!             action = INSERT;</span>
<span class="line-modified">!             node = new Node(k);</span>
<span class="line-modified">!             node.setNode(Node.Left_son, treeNull);</span>
<span class="line-modified">!             node.setNode(Node.Right_son, treeNull);</span>
<span class="line-modified">!             node.setNode(Node.Parent, treeNull);</span>
<span class="line-modified">!             stage = 1;</span>
<span class="line-modified">!             // This is the loop that perform all the operation steps.</span>
<span class="line-modified">!             while (stage != 0) {</span>
<span class="line-modified">!                 // perform one step</span>
<span class="line-modified">!                 InsertStep();</span>
<span class="line-modified">!                 // update the tree height</span>
<span class="line-modified">!                 updateHeight();</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             // set the action to NoOPretion.</span>
<span class="line-modified">!             action = NOP;</span>
<span class="line-modified">!             return true;</span>
<span class="line-modified">!         } else</span>
<span class="line-modified">!             System.out.println(&quot;Insertion failed. This key already exist.&quot;);</span>
<span class="line-modified">!         return false;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method deletes the element k from the Red Black tree</span>
<span class="line-modified">!     public boolean RBDelete(int k) {</span>
<span class="line-modified">!         // checking like in RB_Delete method</span>
<span class="line-modified">!         if (action != NOP) {</span>
<span class="line-modified">!             System.out.println(&quot;Only one operation can be done at a time.&quot;);</span>
<span class="line-modified">!             return false;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         node = Search(k);</span>
<span class="line-modified">!         // Check if there is a node with key k.</span>
<span class="line-modified">!         if (node != treeNull) {</span>
<span class="line-modified">!             action = DELETE;</span>
<span class="line-modified">!             stage = 1;</span>
<span class="line-modified">!             // this loop perform all the operation steps.</span>
<span class="line-modified">!             while (stage != 0) {</span>
<span class="line-modified">!                 // perform one step</span>
<span class="line-modified">!                 DeleteStep();</span>
<span class="line-modified">!                 // update the tree height</span>
<span class="line-modified">!                 updateHeight();</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             action = NOP;</span>
<span class="line-modified">!             return true;</span>
<span class="line-modified">!         } else</span>
<span class="line-modified">!             System.out.println(&quot;Deletion failed. This key doesn&#39;t exist.&quot;);</span>
<span class="line-modified">!         return false;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method performs one step in the insertion operation.</span>
<span class="line-modified">!     // It performs a step according to the stage variable.</span>
<span class="line-modified">!     // I will not explain exactly what each stage do, just that they</span>
<span class="line-modified">!     // divided to 4 categories:</span>
<span class="line-modified">!     // 1. inserting a node to the tree.</span>
<span class="line-modified">!     // 2. marking nodes that will be recolored.</span>
<span class="line-modified">!     // 3. recoloring nodes.</span>
<span class="line-modified">!     // 4. rotating right or left.</span>
<span class="line-modified">!     private void InsertStep() {</span>
<span class="line-modified">!         // Pr is parent, GrPr is grandparent and Un is uncle.</span>
<span class="line-modified">!         Node Pr, GrPr, Un;</span>
<span class="line-modified">!         switch (stage) {</span>
<span class="line-modified">!             // Inserting a node to the tree</span>
<span class="line-modified">!             case 1:</span>
<span class="line-modified">!                 Tree_Insert();</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // mid stage that moves the algorithm to the proper next stage</span>
<span class="line-modified">!             case 2:</span>
<span class="line-modified">!                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">!                 if (Pr == GrPr.getNode(Node.Left_son)) {</span>
<span class="line-modified">!                     Un = GrPr.getNode(Node.Right_son);</span>
<span class="line-modified">!                     if (Un.getColor() == Node.Red) {</span>
                          stage = 3;
<span class="line-modified">!                     } else if (node == Pr.getNode(Node.Right_son)) {</span>
<span class="line-modified">!                         node = Pr;</span>
<span class="line-modified">!                         stage = 5;</span>
<span class="line-modified">!                     } else {</span>
<span class="line-modified">!                         stage = 6;</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     Un = GrPr.getNode(Node.Left_son);</span>
<span class="line-modified">!                     if (Un.getColor() == Node.Red) {</span>
                          stage = 3;
<span class="line-modified">!                     } else if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-modified">!                         node = Pr;</span>
<span class="line-modified">!                         stage = 5;</span>
<span class="line-modified">!                     } else {</span>
<span class="line-modified">!                         stage = 6;</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage marks node that will be recolored</span>
<span class="line-modified">!             case 3:</span>
<span class="line-modified">!                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">!                 if (Pr == GrPr.getNode(Node.Left_son)) {</span>
<span class="line-modified">!                     Un = GrPr.getNode(Node.Right_son);</span>
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     Un = GrPr.getNode(Node.Left_son);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 node = GrPr;</span>
<span class="line-modified">!                 stage = 4;</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage recolors marked nodes.</span>
<span class="line-modified">!             case 4:</span>
<span class="line-modified">!                 node.setColor(Node.Red);</span>
<span class="line-modified">!                 node.getNode(Node.Left_son).setColor(Node.Black);</span>
<span class="line-modified">!                 node.getNode(Node.Right_son).setColor(Node.Black);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 if ((node == root) ||</span>
<span class="line-modified">!                         (node.getNode(Node.Parent).getColor() == Node.Black)) {</span>
<span class="line-modified">!                     if (root.getColor() == Node.Red) {</span>
                          stage = 9;
<span class="line-modified">!                     } else</span>
                          stage = 0;
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     stage = 2;</span>
<span class="line-modified">!                     InsertStep();</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage performs rotation operation</span>
<span class="line-modified">!             case 5:</span>
<span class="line-modified">!                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-modified">!                     Left_Rotate(node);</span>
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     Right_Rotate(node);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 stage = 6;</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage marks nodes that will be recolor.</span>
<span class="line-modified">!             case 6:</span>
<span class="line-modified">!                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 stage = 7;</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage recolors marked nodes.</span>
<span class="line-modified">!             case 7:</span>
<span class="line-modified">!                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                 Pr.setColor(Node.Black);</span>
<span class="line-modified">!                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">!                 GrPr.setColor(Node.Red);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 stage = 8;</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage performs rotation operation</span>
<span class="line-modified">!             case 8:</span>
<span class="line-modified">!                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">!                 if (Pr == GrPr.getNode(Node.Left_son)) {</span>
<span class="line-modified">!                     Right_Rotate(GrPr);</span>
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     Left_Rotate(GrPr);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 if (root.getColor() == Node.Red) {</span>
                      stage = 9;
<span class="line-modified">!                 } else</span>
<span class="line-modified">!                     stage = 0;</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // this stage marks the root.</span>
<span class="line-modified">!             case 9:</span>
<span class="line-modified">!                 stage = 10;</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage recolors the root.</span>
<span class="line-modified">!             case 10:</span>
<span class="line-modified">!                 root.setColor(Node.Black);</span>
<span class="line-modified">!                 stage = 0;</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method performs one step in the deletion operation.</span>
<span class="line-modified">!     // It perform sa step according to the stage variable.</span>
<span class="line-modified">!     // I will explain exactly what each stage do, just that they</span>
<span class="line-modified">!     // divided to 4 categories:</span>
<span class="line-modified">!     // 1. deleting a node from the tree.</span>
<span class="line-modified">!     // 2. marking nodes that will be recolored.</span>
<span class="line-modified">!     // 3. recoloring nodes.</span>
<span class="line-modified">!     // 4. rotating right or left.</span>
<span class="line-modified">!     public void DeleteStep() {</span>
<span class="line-modified">!         // Pr is Parent, Br is Brother</span>
<span class="line-modified">!         Node Pr, Br;</span>
<span class="line-modified">!         switch (stage) {</span>
<span class="line-modified">!             // This stage delete a node from the tree.</span>
<span class="line-modified">!             case 1:</span>
<span class="line-modified">!                 Tree_Delete();</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage marks a nodes that will be recolored or perform other stage.</span>
<span class="line-modified">!             case 2:</span>
<span class="line-modified">!                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-modified">!                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 if (Br.getColor() == Node.Red) {</span>
<span class="line-modified">!                     stage = 3;</span>
<span class="line-modified">!                 } else if ((Br.getNode(Node.Right_son).getColor() == Node.Black)</span>
<span class="line-added">+                         &amp;&amp; (Br.getNode(Node.Left_son).getColor() == Node.Black)) {</span>
<span class="line-added">+                     stage = 5;</span>
<span class="line-added">+                     DeleteStep();</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     stage = 7;</span>
<span class="line-added">+                     DeleteStep();</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             // This stage recolors marked nodes.</span>
<span class="line-added">+             case 3:</span>
<span class="line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 Br.setColor(Node.Black);</span>
<span class="line-added">+                 Pr.setColor(Node.Red);</span>
<span class="line-added">+ </span>
<span class="line-added">+                 stage = 4;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             // This stage performs rotation operation</span>
<span class="line-added">+             case 4:</span>
<span class="line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">+                     Left_Rotate(Pr);</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     Right_Rotate(Pr);</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 if ((Br.getNode(Node.Right_son).getColor() == Node.Black)</span>
<span class="line-added">+                         &amp;&amp; (Br.getNode(Node.Left_son).getColor() == Node.Black)) {</span>
<span class="line-added">+                     stage = 5;</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     stage = 7;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             // This stage marks nodes that will be recolor.</span>
<span class="line-added">+             case 5:</span>
<span class="line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 stage = 6;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             // This stage recolors marked nodes.</span>
<span class="line-added">+             case 6:</span>
<span class="line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 Br.setColor(Node.Red);</span>
<span class="line-added">+                 node = Pr;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 if ((node != root) &amp;&amp; (node.getColor() == Node.Black)) {</span>
<span class="line-added">+                     stage = 2;</span>
<span class="line-added">+                 } else if (node.getColor() == Node.Red) {</span>
<span class="line-added">+                     stage = 13;</span>
<span class="line-added">+                 } else</span>
<span class="line-added">+                     stage = 0;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             // This stage marks nodes that will be recolor or perform other stage.</span>
<span class="line-added">+             case 7:</span>
<span class="line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">+                     if ((Br.getNode(Node.Right_son)).getColor() == Node.Black) {</span>
<span class="line-added">+                         stage = 8;</span>
<span class="line-added">+                     } else {</span>
<span class="line-added">+                         stage = 10;</span>
<span class="line-added">+                         DeleteStep();</span>
                      }
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">!                     if ((Br.getNode(Node.Left_son)).getColor() == Node.Black) {</span>
<span class="line-modified">!                         stage = 8;</span>
<span class="line-modified">!                     } else {</span>
<span class="line-modified">!                         stage = 10;</span>
<span class="line-modified">!                         DeleteStep();</span>
                      }
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage recolors marked nodes.</span>
<span class="line-modified">!             case 8:</span>
<span class="line-modified">!                 Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">!                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-modified">!                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">!                     Br.getNode(Node.Left_son).setColor(Node.Black);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">+                     Br.getNode(Node.Right_son).setColor(Node.Black);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 Br.setColor(Node.Red);</span>
<span class="line-added">+                 stage = 9;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             // This stage performs rotation operation</span>
<span class="line-added">+             case 9:</span>
<span class="line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">+                     Right_Rotate(Br);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">+                     Left_Rotate(Br);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+                 stage = 10;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             // This stage marks node that will be recolor.</span>
<span class="line-added">+             case 10:</span>
<span class="line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+                 stage = 11;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             // This stage recolors marked nodes.</span>
<span class="line-added">+             case 11:</span>
<span class="line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="line-added">+                     Br.getNode(Node.Right_son).setColor(Node.Black);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="line-added">+                     Br.getNode(Node.Left_son).setColor(Node.Black);</span>
<span class="line-added">+ </span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 if (Br.getColor() != Pr.getColor()) {</span>
<span class="line-added">+                     Br.setColor(Pr.getColor());</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 if (Pr.getColor() != Node.Black) {</span>
<span class="line-added">+                     Pr.setColor(Node.Black);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+                 stage = 12;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             // This stage performs rotation operation.</span>
<span class="line-added">+             case 12:</span>
<span class="line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="line-added">+                     Left_Rotate(Pr);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     Right_Rotate(Pr);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 node = root;</span>
<span class="line-added">+                 if (node.getColor() == Node.Red) {</span>
<span class="line-added">+                     stage = 13;</span>
<span class="line-added">+                 } else {</span>
                      stage = 0;
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage marks a node that will be recolored</span>
<span class="line-modified">!             case 13:</span>
<span class="line-modified">!                 stage = 14;</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!             // This stage recolors marked node.</span>
<span class="line-modified">!             case 14:</span>
<span class="line-modified">!                 node.setColor(Node.Black);</span>
<span class="line-modified">!                 stage = 0;</span>
<span class="line-modified">!                 break;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method inserts the node &#39;node&#39; to the tree.</span>
<span class="line-modified">!     // it called from the first stage in the InsertStep method.</span>
<span class="line-modified">!     // we &#39;dive&#39; from the root to a leaf according to the node key</span>
<span class="line-modified">!     // and insert the node in the proper place.</span>
<span class="line-modified">!     private void Tree_Insert() {</span>
<span class="line-modified">!         Node n1, n2;</span>
<span class="line-modified">!         n1 = root;</span>
<span class="line-modified">!         n2 = treeNull;</span>
<span class="line-modified">!         while (n1 != treeNull) {</span>
<span class="line-modified">!             n2 = n1;</span>
<span class="line-modified">!             if (node.getKey() &lt; n1.getKey()) {</span>
<span class="line-modified">!                 n1 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">!             } else {</span>
<span class="line-modified">!                 n1 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         node.setNode(Node.Parent, n2);</span>
<span class="line-modified">!         if (n2 == treeNull) {</span>
<span class="line-modified">!             root = node;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         else {</span>
<span class="line-modified">!             if (node.getKey() &lt; n2.getKey()) {</span>
<span class="line-modified">!                 n2.setNode(Node.Left_son, node);</span>
<span class="line-modified">!             } else {</span>
<span class="line-modified">!                 n2.setNode(Node.Right_son, node);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         // updating the insertion stage.</span>
<span class="line-modified">!         if ((node == root) ||</span>
<span class="line-modified">!                 (node.getNode(Node.Parent).getColor() == Node.Black)) {</span>
<span class="line-modified">!             if (root.getColor() == Node.Red) {</span>
<span class="line-modified">!                 stage = 9;</span>
<span class="line-modified">!             } else {</span>
<span class="line-modified">!                 stage = 0;</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         } else {</span>
              stage = 2;
<span class="line-modified">!             InsertStep();</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         num_of_nodes++;   // increasing the number of nodes</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method deletes the node &#39;node&#39; from the tree.</span>
<span class="line-modified">!     // it called from the first stage in the DeleteStep method.</span>
<span class="line-modified">!     // if node has at most one son we just remove it and connect</span>
<span class="line-modified">!     // his son and parent. If it has 2 sons we delete his successor</span>
<span class="line-modified">!     // that has at most one son and replace him with the successor.</span>
<span class="line-modified">!     private void Tree_Delete() {</span>
<span class="line-modified">!         Node n1, n2, n3;</span>
<span class="line-modified">!         if ((node.getNode(Node.Left_son) == treeNull) ||</span>
<span class="line-modified">!                 (node.getNode(Node.Right_son) == treeNull)) {</span>
<span class="line-modified">!             n1 = node;</span>
<span class="line-modified">!         } else {</span>
<span class="line-modified">!             n1 = Tree_Successor(node);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">! </span>
<span class="line-modified">!         if (n1.getNode(Node.Left_son) != treeNull) {</span>
<span class="line-modified">!             n2 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">!         } else {</span>
<span class="line-modified">!             n2 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">! </span>
<span class="line-modified">!         n3 = n1.getNode(Node.Parent);</span>
<span class="line-modified">!         n2.setNode(Node.Parent, n3);</span>
<span class="line-modified">!         if (n3 == treeNull) {</span>
<span class="line-modified">!             root = n2;</span>
<span class="line-modified">!         } else if (n1 == n3.getNode(Node.Left_son)) {</span>
<span class="line-modified">!             n3.setNode(Node.Left_son, n2);</span>
<span class="line-modified">!         } else {</span>
<span class="line-modified">!             n3.setNode(Node.Right_son, n2);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">! </span>
<span class="line-modified">!         if (n1 != node) {</span>
<span class="line-modified">!             node.setKey(n1.getKey());</span>
<span class="line-modified">!         }</span>
<span class="line-modified">! </span>
<span class="line-modified">!         node = n2;</span>
<span class="line-modified">!         if (n1.getColor() == Node.Black) {</span>
<span class="line-modified">!             if ((node != root) &amp;&amp; (node.getColor() == Node.Black)) {</span>
<span class="line-modified">!                 stage = 2;</span>
<span class="line-modified">!             } else if (node.getColor() == Node.Red) {</span>
<span class="line-modified">!                 stage = 13;</span>
<span class="line-modified">!             } else {</span>
<span class="line-modified">!                 stage = 0;</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         } else {</span>
<span class="line-modified">!             stage = 0;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         // decrease the number of nodes.</span>
<span class="line-modified">!         num_of_nodes--;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method returns the successor of the node n in the tree.</span>
<span class="line-modified">!     private Node Tree_Successor(Node n) {</span>
<span class="line-modified">!         Node n1;</span>
<span class="line-modified">!         if (n.getNode(Node.Right_son) != treeNull) {</span>
<span class="line-modified">!             n = n.getNode(Node.Right_son);</span>
<span class="line-modified">!             while (n.getNode(Node.Left_son) != treeNull) {</span>
<span class="line-modified">!                 n = n.getNode(Node.Left_son);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             return n;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         n1 = n.getNode(Node.Parent);</span>
<span class="line-modified">!         while ((n1 != treeNull) &amp;&amp; (n == n1.getNode(Node.Right_son))) {</span>
<span class="line-modified">!             n = n1;</span>
<span class="line-modified">!             n1 = n1.getNode(Node.Parent);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         return n1;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method performs Left Rotation with n1.</span>
<span class="line-modified">!     private void Left_Rotate(Node n1) {</span>
<span class="line-modified">!         Node n2;</span>
<span class="line-modified">! </span>
<span class="line-modified">!         n2 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">!         n1.setNode(Node.Right_son, n2.getNode(Node.Left_son));</span>
<span class="line-modified">!         if (n2.getNode(Node.Left_son) != treeNull) {</span>
<span class="line-modified">!             n2.getNode(Node.Left_son).setNode(Node.Parent, n1);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         n2.setNode(Node.Parent, n1.getNode(Node.Parent));</span>
<span class="line-modified">!         if (n1.getNode(Node.Parent) == treeNull) {</span>
<span class="line-modified">!             root = n2;</span>
<span class="line-modified">!         } else if (n1 == n1.getNode(Node.Parent).getNode(Node.Left_son)) {</span>
<span class="line-modified">!             n1.getNode(Node.Parent).setNode(Node.Left_son, n2);</span>
<span class="line-modified">!         } else {</span>
<span class="line-modified">!             n1.getNode(Node.Parent).setNode(Node.Right_son, n2);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         n2.setNode(Node.Left_son, n1);</span>
<span class="line-modified">!         n1.setNode(Node.Parent, n2);</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     // This method performs Right Rotation with n1.</span>
<span class="line-modified">!     private void Right_Rotate(Node n1) {</span>
<span class="line-modified">!         Node n2;</span>
<span class="line-modified">! </span>
<span class="line-modified">!         n2 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">!         n1.setNode(Node.Left_son, n2.getNode(Node.Right_son));</span>
<span class="line-modified">!         if (n2.getNode(Node.Right_son) != treeNull) {</span>
<span class="line-modified">!             n2.getNode(Node.Right_son).setNode(Node.Parent, n1);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         n2.setNode(Node.Parent, n1.getNode(Node.Parent));</span>
<span class="line-modified">!         if (n1.getNode(Node.Parent) == treeNull) {</span>
<span class="line-modified">!             root = n2;</span>
<span class="line-modified">!         } else if (n1 == (n1.getNode(Node.Parent)).getNode(Node.Left_son)) {</span>
<span class="line-modified">!             n1.getNode(Node.Parent).setNode(Node.Left_son, n2);</span>
<span class="line-modified">!         } else {</span>
<span class="line-modified">!             n1.getNode(Node.Parent).setNode(Node.Right_son, n2);</span>
<span class="line-modified">!         }</span>
<span class="line-added">+         n2.setNode(Node.Right_son, n1);</span>
<span class="line-added">+         n1.setNode(Node.Parent, n2);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     // This method searches the tree for a node with key &#39;key&#39;, and</span>
<span class="line-added">+     // returns the node on success otherwise treeNull.</span>
<span class="line-added">+     public Node Search(int key) {</span>
<span class="line-added">+         Node node;</span>
<span class="line-added">+         node = root;</span>
<span class="line-added">+         while ((node != treeNull) &amp;&amp; (key != node.getKey())) {</span>
<span class="line-added">+             if (key &lt; node.getKey()) {</span>
<span class="line-added">+                 node = node.getNode(Node.Left_son);</span>
<span class="line-added">+             } else {</span>
<span class="line-added">+                 node = node.getNode(Node.Right_son);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+         return node;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     // This method updates the tree height. it uses a recursive method</span>
<span class="line-added">+     // findHeight.</span>
<span class="line-added">+     private void updateHeight() {</span>
<span class="line-added">+         height = 0;</span>
<span class="line-added">+         if (root != treeNull) {</span>
<span class="line-added">+             findHeight(root, 1);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     // This is a recursive method that find a node height.</span>
<span class="line-added">+     private void findHeight(Node n, int curr) {</span>
<span class="line-added">+         if (height &lt; curr) {</span>
<span class="line-added">+             height = curr;</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (n.getNode(Node.Left_son) != treeNull) {</span>
<span class="line-added">+             findHeight(n.getNode(Node.Left_son), curr + 1);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (n.getNode(Node.Right_son) != treeNull) {</span>
<span class="line-added">+             findHeight(n.getNode(Node.Right_son), curr + 1);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
  
  }
</pre>
<center><a href="Node.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="test1.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>