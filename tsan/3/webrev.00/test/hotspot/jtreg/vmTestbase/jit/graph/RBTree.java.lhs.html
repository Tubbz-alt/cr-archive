<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/hotspot/jtreg/vmTestbase/jit/graph/RBTree.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2008, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
<a name="2" id="anc2"></a><span class="line-removed"> 23 package jit.graph;</span>
<span class="line-removed"> 24 </span>
<span class="line-removed"> 25 import nsk.share.TestFailure;</span>
 26 
<a name="3" id="anc3"></a><span class="line-modified"> 27 //import Node;</span>
 28 
 29 // This class defines the tree object.
<a name="4" id="anc4"></a><span class="line-modified"> 30 </span>
<span class="line-modified"> 31 public class RBTree</span>
<span class="line-modified"> 32 {</span>
<span class="line-modified"> 33    public final static int  maxNodes = 70;        // maximum nodes allowed.</span>
<span class="line-modified"> 34    public final static int  INSERT   = 0;         // constants indicating</span>
<span class="line-modified"> 35    public final static int  DELETE   = 1;         // the current operation</span>
<span class="line-modified"> 36    public final static int  NOP      = 2;</span>
<span class="line-modified"> 37    public final static Node treeNull = new Node(); // the tree NULL node.</span>
<span class="line-modified"> 38 </span>
<span class="line-modified"> 39    private Node    root;</span>
<span class="line-modified"> 40    private int     num_of_nodes;</span>
<span class="line-modified"> 41    private int     height;           // The tree heigth ,it is updated</span>
<span class="line-modified"> 42                                      // in each operation.</span>
<span class="line-modified"> 43 </span>
<span class="line-modified"> 44    // since the algorithem is executed in stages I have to remember data</span>
<span class="line-modified"> 45    // on the state.</span>
<span class="line-modified"> 46    private Node    node;  // The current operation is being done on it.</span>
<span class="line-modified"> 47    private int     action;// The operation being performed (insert / delete)</span>
<span class="line-modified"> 48    private int     stage; // The current stage of execution</span>
<span class="line-modified"> 49 </span>
<span class="line-modified"> 50    // the constructor initialize the object fields.</span>
<span class="line-modified"> 51 </span>
<span class="line-modified"> 52    public RBTree()</span>
<span class="line-modified"> 53    {</span>
<span class="line-modified"> 54       root         = treeNull;</span>
<span class="line-modified"> 55       node         = treeNull;</span>
<span class="line-modified"> 56       num_of_nodes = 0;</span>
<span class="line-modified"> 57       height       = 0;</span>
<span class="line-modified"> 58       action       = NOP;</span>
<span class="line-modified"> 59       stage        = 0;</span>
<span class="line-modified"> 60    }</span>
<span class="line-modified"> 61 </span>
<span class="line-modified"> 62    // This method return the root of the tree.</span>
<span class="line-modified"> 63 </span>
<span class="line-modified"> 64    public Node getRoot()</span>
<span class="line-modified"> 65    {</span>
<span class="line-modified"> 66       return root;</span>
<span class="line-modified"> 67    }</span>
<span class="line-modified"> 68 </span>
<span class="line-modified"> 69    // This method return the number of nodes in the tree.</span>
<span class="line-modified"> 70 </span>
<span class="line-modified"> 71    public int getNodes()</span>
<span class="line-modified"> 72    {</span>
<span class="line-modified"> 73       return num_of_nodes;</span>
<span class="line-modified"> 74    }</span>
<span class="line-modified"> 75 </span>
<span class="line-modified"> 76    // This method return the heigth of the tree.</span>
<span class="line-modified"> 77 </span>
<span class="line-modified"> 78    public int getHeight()</span>
<span class="line-modified"> 79    {</span>
<span class="line-modified"> 80       return height;</span>
<span class="line-modified"> 81    }</span>
<span class="line-modified"> 82 </span>
<span class="line-modified"> 83 </span>
<span class="line-modified"> 84 </span>
<span class="line-modified"> 85    // This method inserts k into the Red Black Tree</span>
<span class="line-modified"> 86 </span>
<span class="line-modified"> 87    public boolean RBInsert(int k)</span>
<span class="line-modified"> 88    {</span>
<span class="line-modified"> 89 </span>
<span class="line-modified"> 90       Thread Pause = new Thread();   // this thread is used for delay</span>
<span class="line-modified"> 91                                      // between the stages.</span>
<span class="line-modified"> 92       if (action != NOP)  // checking similar to the RB_Insert method</span>
<span class="line-modified"> 93       {</span>
<span class="line-modified"> 94          System.out.println</span>
<span class="line-modified"> 95          (&quot;Only one operation can be done at a time.&quot;);</span>
<span class="line-modified"> 96          return false;</span>
<span class="line-modified"> 97       }</span>
<span class="line-modified"> 98       if (num_of_nodes == maxNodes)</span>
<span class="line-modified"> 99       {</span>
<span class="line-modified">100          System.out.println</span>
<span class="line-modified">101          (&quot;The maximum nodes allowed is already reached.&quot;);</span>
<span class="line-modified">102          return false;</span>
<span class="line-modified">103       }</span>
<span class="line-modified">104       if (Search(k) == treeNull) // Check if there is already node with key k.</span>
<span class="line-modified">105       {</span>
<span class="line-modified">106          action = INSERT;</span>
<span class="line-modified">107          node = new Node(k);</span>
<span class="line-modified">108          node.setNode(Node.Left_son,treeNull);</span>
<span class="line-modified">109          node.setNode(Node.Right_son,treeNull);</span>
<span class="line-modified">110          node.setNode(Node.Parent,treeNull);</span>
<span class="line-modified">111          stage = 1;</span>
<span class="line-modified">112          while (stage != 0)     // This is the loop that perform all the</span>
<span class="line-modified">113          {                      // operation steps.</span>
<span class="line-modified">114             InsertStep();       // perform one step</span>
<span class="line-modified">115             updateHeight();     // update the tree height</span>
<span class="line-modified">116          }</span>
<span class="line-modified">117          action = NOP;           // set the action to NoOPretion.</span>
<span class="line-modified">118          return true;</span>
<span class="line-modified">119       }</span>
<span class="line-modified">120       else</span>
<span class="line-modified">121         System.out.println</span>
<span class="line-modified">122         (&quot;Insertion failed. This key already exist.&quot;);</span>
<span class="line-modified">123       return false;</span>
<span class="line-modified">124    }</span>
<span class="line-modified">125 </span>
<span class="line-modified">126 </span>
<span class="line-modified">127    // This method deletes the element k from the Red Black tree</span>
<span class="line-modified">128 </span>
<span class="line-modified">129    public boolean RBDelete(int k)</span>
<span class="line-modified">130    {</span>
<span class="line-modified">131       Thread Pause = new Thread();   // this thread is used for delay</span>
<span class="line-modified">132                                      // between the stages.</span>
<span class="line-modified">133       if (action != NOP)</span>
<span class="line-modified">134       {                              // checking like in RB_Delete method</span>
<span class="line-modified">135          System.out.println</span>
<span class="line-modified">136          (&quot;Only one operation can be done at a time.&quot;);</span>
<span class="line-modified">137          return false;</span>
<span class="line-modified">138       }</span>
<span class="line-modified">139       node = Search(k);</span>
<span class="line-modified">140       if (node != treeNull)       // Check if there is a node with key k.</span>
<span class="line-modified">141       {</span>
<span class="line-modified">142          action = DELETE;</span>
<span class="line-modified">143          stage = 1;</span>
<span class="line-modified">144          while (stage != 0)    // this loop perform all the operation</span>
<span class="line-modified">145          {                     // steps.</span>
<span class="line-modified">146             DeleteStep();               // perform one step</span>
<span class="line-modified">147             updateHeight();             // update the tree height</span>
<span class="line-modified">148 </span>
<span class="line-modified">149          }</span>
<span class="line-modified">150          action = NOP;</span>
<span class="line-modified">151          return true;</span>
<span class="line-modified">152       }</span>
<span class="line-modified">153       else</span>
<span class="line-modified">154          System.out.println</span>
<span class="line-modified">155          (&quot;Deletion failed. This key doesn&#39;t exist.&quot;);</span>
<span class="line-modified">156       return false;</span>
<span class="line-modified">157    }</span>
<span class="line-modified">158 </span>
<span class="line-modified">159    // This method perform one step in the insertion operation.</span>
<span class="line-removed">160    // If perform a step acording to the stage variable.</span>
<span class="line-removed">161    // I will not explain exactly what each stage do, just that they</span>
<span class="line-removed">162    // divided to 4 categories:</span>
<span class="line-removed">163    // 1. inserting a node to the tree.</span>
<span class="line-removed">164    // 2. marking nodes that will be recolored.</span>
<span class="line-removed">165    // 3. recoloring nodes.</span>
<span class="line-removed">166    // 4. rotating right or left.</span>
<span class="line-removed">167 </span>
<span class="line-removed">168    private void InsertStep()</span>
<span class="line-removed">169    {</span>
<span class="line-removed">170       Node Pr,GrPr,Un; // Pr is parent, GrPr is grandparent</span>
<span class="line-removed">171                        // and Un is uncle.</span>
<span class="line-removed">172       switch (stage)</span>
<span class="line-removed">173       {</span>
<span class="line-removed">174            case 1: // Inserting a node to the tree</span>
<span class="line-removed">175                /*</span>
<span class="line-removed">176                   System.out.println  // send a message to the screen</span>
<span class="line-removed">177                   (new String(&quot;Inserting &quot;)</span>
<span class="line-removed">178                   .concat(Integer.toString(node.getKey())));</span>
<span class="line-removed">179                */</span>
<span class="line-removed">180                   Tree_Insert();        // inserting an element to the tree</span>
<span class="line-removed">181                   break;</span>
<span class="line-removed">182            case 2:       // mid stage that move to algorithem to the</span>
<span class="line-removed">183                          // proper next stage, and send proper message</span>
<span class="line-removed">184                          // to the screen</span>
<span class="line-removed">185                   Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">186                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-removed">187                   if (Pr == GrPr.getNode(Node.Left_son))</span>
<span class="line-removed">188                   {</span>
<span class="line-removed">189                      Un = GrPr.getNode(Node.Right_son);</span>
<span class="line-removed">190                      if (Un.getColor() == Node.Red)</span>
<span class="line-removed">191                      {</span>
192                         stage = 3;
<a name="5" id="anc5"></a><span class="line-modified">193                      }</span>
<span class="line-modified">194                      else</span>
<span class="line-modified">195                         if (node == Pr.getNode(Node.Right_son))</span>
<span class="line-modified">196                         {</span>
<span class="line-modified">197                            node = Pr;</span>
<span class="line-modified">198                            stage = 5;</span>
<span class="line-modified">199                         }</span>
<span class="line-modified">200                         else</span>
<span class="line-modified">201                         {</span>
<span class="line-removed">202                            stage = 6;</span>
<span class="line-removed">203                         }</span>
<span class="line-removed">204                   }</span>
<span class="line-removed">205                   else</span>
<span class="line-removed">206                   {</span>
<span class="line-removed">207                      Un = GrPr.getNode(Node.Left_son);</span>
<span class="line-removed">208                      if (Un.getColor() == Node.Red)</span>
<span class="line-removed">209                      {</span>
210                         stage = 3;
<a name="6" id="anc6"></a><span class="line-modified">211                      }</span>
<span class="line-modified">212                      else</span>
<span class="line-modified">213                         if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">214                         {</span>
<span class="line-modified">215                            node = Pr;</span>
<span class="line-modified">216                            stage = 5;</span>
<span class="line-modified">217                         }</span>
<span class="line-modified">218                         else</span>
<span class="line-modified">219                         {</span>
<span class="line-modified">220                            stage = 6;</span>
<span class="line-modified">221                         }</span>
<span class="line-modified">222                   }</span>
<span class="line-modified">223                   break;</span>
<span class="line-modified">224            case 3:       // This stage marks node that will be recolored</span>
<span class="line-modified">225                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">226                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">227                   if (Pr == GrPr.getNode(Node.Left_son))</span>
<span class="line-modified">228                      Un = GrPr.getNode(Node.Right_son);</span>
<span class="line-modified">229                   else</span>
<span class="line-modified">230                       Un = GrPr.getNode(Node.Left_son);</span>
<span class="line-modified">231 </span>
<span class="line-modified">232                   node = GrPr;</span>
<span class="line-modified">233                   stage = 4;</span>
<span class="line-modified">234                   break;</span>
<span class="line-modified">235            case 4:          // this stage recolor marked nodes.</span>
<span class="line-modified">236                   node.setColor(Node.Red);</span>
<span class="line-modified">237                   (node.getNode(Node.Left_son)).setColor(Node.Black);</span>
<span class="line-modified">238                   (node.getNode(Node.Right_son)).setColor(Node.Black);</span>
<span class="line-modified">239 </span>
<span class="line-removed">240                   if ((node == root) ||</span>
<span class="line-removed">241                      ((node.getNode(Node.Parent)).getColor() == Node.Black))</span>
<span class="line-removed">242                      if (root.getColor() == Node.Red)</span>
<span class="line-removed">243                      {</span>
244                         stage = 9;
<a name="7" id="anc7"></a><span class="line-modified">245                      }</span>
<span class="line-removed">246                      else</span>
247                         stage = 0;
<a name="8" id="anc8"></a><span class="line-modified">248                   else</span>
<span class="line-modified">249                   {</span>
<span class="line-modified">250                      stage = 2;</span>
<span class="line-modified">251                      InsertStep();</span>
<span class="line-modified">252                   }</span>
<span class="line-modified">253                   break;</span>
<span class="line-modified">254            case 5:        // This stage perform rotation operation</span>
<span class="line-modified">255                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">256                   if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">257                      Left_Rotate(node);</span>
<span class="line-modified">258                   else</span>
<span class="line-modified">259                      Right_Rotate(node);</span>
<span class="line-modified">260 </span>
<span class="line-modified">261                   stage = 6;</span>
<span class="line-modified">262                   break;</span>
<span class="line-modified">263            case 6:        // This stage marks nodes that will be recolor.</span>
<span class="line-modified">264                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">265                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">266 </span>
<span class="line-modified">267                   stage = 7;</span>
<span class="line-modified">268                   break;</span>
<span class="line-modified">269            case 7:        // This stage recolor marked nodes.</span>
<span class="line-modified">270                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">271                   Pr.setColor(Node.Black);</span>
<span class="line-modified">272                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">273                   GrPr.setColor(Node.Red);</span>
<span class="line-modified">274 </span>
<span class="line-modified">275                   stage = 8;</span>
<span class="line-modified">276                   break;</span>
<span class="line-modified">277            case 8:        // This stage perform rotation operation</span>
<span class="line-modified">278                   Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">279                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="line-modified">280                   if (Pr == GrPr.getNode(Node.Left_son))</span>
<span class="line-modified">281                      Right_Rotate(GrPr);</span>
<span class="line-modified">282                   else</span>
<span class="line-modified">283                      Left_Rotate(GrPr);</span>
<span class="line-modified">284                   if (root.getColor() == Node.Red)</span>
<span class="line-modified">285                   {</span>
<span class="line-modified">286                      stage = 9;</span>
<span class="line-modified">287                   }</span>
<span class="line-modified">288                   else</span>
<span class="line-removed">289                      stage = 0;</span>
<span class="line-removed">290                   break;</span>
<span class="line-removed">291            case 9:        // this stage mark the root.</span>
<span class="line-removed">292                    stage = 10;</span>
<span class="line-removed">293                   break;</span>
<span class="line-removed">294            case 10:       // This stage recolor the root.</span>
<span class="line-removed">295                   root.setColor(Node.Black);</span>
<span class="line-removed">296                   stage = 0;</span>
<span class="line-removed">297                   break;</span>
<span class="line-removed">298       }</span>
<span class="line-removed">299    }</span>
<span class="line-removed">300 </span>
<span class="line-removed">301    // This method perform one step in the deletion operation.</span>
<span class="line-removed">302    // If perform a step acording to the stage variable.</span>
<span class="line-removed">303    // I will explain exactly what each stage do, just that they</span>
<span class="line-removed">304    // divided to 4 categories:</span>
<span class="line-removed">305    // 1. deleting a node from the tree.</span>
<span class="line-removed">306    // 2. marking nodes that will be recolored.</span>
<span class="line-removed">307    // 3. recoloring nodes.</span>
<span class="line-removed">308    // 4. rotating right or left.</span>
<span class="line-removed">309 </span>
<span class="line-removed">310    public void DeleteStep()</span>
<span class="line-removed">311    {</span>
<span class="line-removed">312        Node Pr,Br;     // Pr is Parent ,Br is Brother</span>
<span class="line-removed">313        switch (stage)</span>
<span class="line-removed">314        {</span>
<span class="line-removed">315              case 1:   // This stage delete a node from the tree.</span>
<span class="line-removed">316                  /*</span>
<span class="line-removed">317                     System.out.println</span>
<span class="line-removed">318                     (new String(&quot;Deleting &quot;)</span>
<span class="line-removed">319                     .concat(Integer.toString(node.getKey())));</span>
<span class="line-removed">320                  */</span>
<span class="line-removed">321                     Tree_Delete();</span>
<span class="line-removed">322                     break;</span>
<span class="line-removed">323              case 2:   // This stage marks a nodes that will be recolored</span>
<span class="line-removed">324                        // or perform other stage.</span>
<span class="line-removed">325                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">326                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">327                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">328                     else</span>
<span class="line-removed">329                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">330                     if (Br.getColor() == Node.Red)</span>
<span class="line-removed">331                     {</span>
<span class="line-removed">332                         stage = 3;</span>
<span class="line-removed">333                     }</span>
<span class="line-removed">334                     else</span>
<span class="line-removed">335                        if (((Br.getNode(Node.Right_son)).getColor() == Node.Black)</span>
<span class="line-removed">336                           &amp;&amp; ((Br.getNode(Node.Left_son)).getColor() == Node.Black))</span>
<span class="line-removed">337                        {</span>
<span class="line-removed">338                           stage = 5;</span>
<span class="line-removed">339                           DeleteStep();</span>
<span class="line-removed">340                        }</span>
<span class="line-removed">341                        else</span>
<span class="line-removed">342                        {</span>
<span class="line-removed">343                           stage = 7;</span>
<span class="line-removed">344                           DeleteStep();</span>
<span class="line-removed">345                        }</span>
<span class="line-removed">346                     break;</span>
<span class="line-removed">347              case 3:    // this stage recolor marked nodes.</span>
<span class="line-removed">348                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">349                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">350                     {</span>
<span class="line-removed">351                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">352 </span>
<span class="line-removed">353                     }</span>
<span class="line-removed">354                     else</span>
<span class="line-removed">355                     {</span>
<span class="line-removed">356                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">357                     }</span>
<span class="line-removed">358                     Br.setColor(Node.Black);</span>
<span class="line-removed">359                     Pr.setColor(Node.Red);</span>
<span class="line-removed">360 </span>
<span class="line-removed">361                     stage = 4;</span>
<span class="line-removed">362                     break;</span>
<span class="line-removed">363              case 4:     // this stage perform rotation operation</span>
<span class="line-removed">364                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">365                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">366                     {</span>
<span class="line-removed">367                        Left_Rotate(Pr);</span>
<span class="line-removed">368                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">369                     }</span>
<span class="line-removed">370                     else</span>
<span class="line-removed">371                     {</span>
<span class="line-removed">372                        Right_Rotate(Pr);</span>
<span class="line-removed">373                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">374                     }</span>
<span class="line-removed">375                     if (((Br.getNode(Node.Right_son)).getColor() == Node.Black)</span>
<span class="line-removed">376                        &amp;&amp; ((Br.getNode(Node.Left_son)).getColor() == Node.Black))</span>
<span class="line-removed">377                        stage = 5;</span>
<span class="line-removed">378                     else</span>
<span class="line-removed">379                        stage = 7;</span>
<span class="line-removed">380 </span>
<span class="line-removed">381                     break;</span>
<span class="line-removed">382              case 5:     // this stage marks nodes that will be recolor.</span>
<span class="line-removed">383                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">384                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">385                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">386                     else</span>
<span class="line-removed">387                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">388 </span>
<span class="line-removed">389                     stage = 6;</span>
<span class="line-removed">390                     break;</span>
<span class="line-removed">391              case 6:     // This stage recolor marked nodes.</span>
<span class="line-removed">392                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">393                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">394                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">395                     else</span>
<span class="line-removed">396                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">397                     Br.setColor(Node.Red);</span>
<span class="line-removed">398                     node = Pr;</span>
<span class="line-removed">399 </span>
<span class="line-removed">400                     if ((node != root) &amp;&amp; (node.getColor() == Node.Black))</span>
<span class="line-removed">401                        stage = 2;</span>
<span class="line-removed">402                     else</span>
<span class="line-removed">403                        if (node.getColor() == Node.Red)</span>
<span class="line-removed">404                        {</span>
<span class="line-removed">405                           stage = 13;</span>
<span class="line-removed">406                        }</span>
<span class="line-removed">407                        else</span>
<span class="line-removed">408                           stage = 0;</span>
<span class="line-removed">409                     break;</span>
<span class="line-removed">410              case 7:     // this stage marks nodes that will be recolor</span>
<span class="line-removed">411                          // or perform other stage.</span>
<span class="line-removed">412                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">413                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">414                     {</span>
<span class="line-removed">415                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">416                        if ((Br.getNode(Node.Right_son)).getColor() == Node.Black)</span>
<span class="line-removed">417                        {</span>
<span class="line-removed">418                           stage = 8;</span>
<span class="line-removed">419                        }</span>
<span class="line-removed">420                        else</span>
<span class="line-removed">421                        {</span>
<span class="line-removed">422                           stage = 10;</span>
<span class="line-removed">423                           DeleteStep();</span>
<span class="line-removed">424                        }</span>
<span class="line-removed">425                     }</span>
<span class="line-removed">426                     else</span>
<span class="line-removed">427                     {</span>
<span class="line-removed">428                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">429                        if ((Br.getNode(Node.Left_son)).getColor() == Node.Black)</span>
<span class="line-removed">430                        {</span>
<span class="line-removed">431                           stage = 8;</span>
<span class="line-removed">432                        }</span>
<span class="line-removed">433                        else</span>
<span class="line-removed">434                        {</span>
<span class="line-removed">435                           stage = 10;</span>
<span class="line-removed">436                           DeleteStep();</span>
<span class="line-removed">437                        }</span>
<span class="line-removed">438                     }</span>
<span class="line-removed">439                     break;</span>
<span class="line-removed">440              case 8:     // this stage recolor marked nodes.</span>
<span class="line-removed">441                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">442                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">443                     {</span>
<span class="line-removed">444                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-removed">445                        (Br.getNode(Node.Left_son)).setColor(Node.Black);</span>
<span class="line-removed">446 </span>
<span class="line-removed">447                     }</span>
<span class="line-removed">448                     else</span>
<span class="line-removed">449                     {</span>
<span class="line-removed">450                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-removed">451                        (Br.getNode(Node.Right_son)).setColor(Node.Black);</span>
<span class="line-removed">452 </span>
<span class="line-removed">453                     }</span>
<span class="line-removed">454                     Br.setColor(Node.Red);</span>
455                     stage = 9;
<a name="9" id="anc9"></a><span class="line-modified">456                     break;</span>
<span class="line-modified">457              case 9:    // this stage perform rotation operation</span>
<span class="line-modified">458                     Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">459                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">460                     {</span>
<span class="line-modified">461                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">462                        Right_Rotate(Br);</span>
<span class="line-modified">463                     }</span>
<span class="line-modified">464                     else</span>
<span class="line-modified">465                     {</span>
<span class="line-modified">466                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">467                        Left_Rotate(Br);</span>
<span class="line-modified">468                     }</span>
<span class="line-modified">469 </span>
<span class="line-modified">470                     stage = 10;</span>
<span class="line-modified">471                     break;</span>
<span class="line-modified">472              case 10:   // This stage marks node that will be recolor.</span>
<span class="line-modified">473 </span>
<span class="line-modified">474                     Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">475                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">476                     {</span>
<span class="line-modified">477                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">478                     }</span>
<span class="line-modified">479                     else</span>
<span class="line-modified">480                     {</span>
<span class="line-modified">481                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">482                     }</span>
<span class="line-modified">483 </span>
<span class="line-modified">484                     stage = 11;</span>
<span class="line-modified">485                     break;</span>
<span class="line-modified">486              case 11:    // this stage recolor marked nodes.</span>
<span class="line-modified">487                     Pr = node.getNode(Node.Parent);</span>
<span class="line-modified">488                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-modified">489                     {</span>
<span class="line-modified">490                        Br = Pr.getNode(Node.Right_son);</span>
<span class="line-modified">491                        (Br.getNode(Node.Right_son)).setColor(Node.Black);</span>
<span class="line-modified">492                     }</span>
<span class="line-modified">493                     else</span>
<span class="line-modified">494                     {</span>
<span class="line-modified">495                        Br = Pr.getNode(Node.Left_son);</span>
<span class="line-modified">496                        (Br.getNode(Node.Left_son)).setColor(Node.Black);</span>
<span class="line-modified">497 </span>













































































498                     }
<a name="10" id="anc10"></a><span class="line-modified">499                     if (Br.getColor() != Pr.getColor())</span>
<span class="line-modified">500                        Br.setColor(Pr.getColor());</span>
<span class="line-modified">501                     if (Pr.getColor() != Node.Black)</span>
<span class="line-modified">502                        Pr.setColor(Node.Black);</span>
<span class="line-modified">503 </span>
<span class="line-modified">504                     stage = 12;</span>
<span class="line-modified">505                     break;</span>
<span class="line-removed">506              case 12:    // this stage perform rotation operation.</span>
<span class="line-removed">507                     Pr = node.getNode(Node.Parent);</span>
<span class="line-removed">508                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="line-removed">509                        Left_Rotate(Pr);</span>
<span class="line-removed">510                     else</span>
<span class="line-removed">511                        Right_Rotate(Pr);</span>
<span class="line-removed">512                     node = root;</span>
<span class="line-removed">513                     if (node.getColor() == Node.Red)</span>
<span class="line-removed">514                     {</span>
<span class="line-removed">515                        stage = 13;</span>
516                     }
<a name="11" id="anc11"></a><span class="line-modified">517                     else</span>
<span class="line-modified">518                        stage = 0;</span>
<span class="line-modified">519                     break;</span>
<span class="line-modified">520              case 13:    // this stage marks a node that will be recolor</span>
<span class="line-modified">521                     stage = 14;</span>
<span class="line-modified">522                     break;</span>
<span class="line-modified">523              case 14:    // this stage recolor marked node.</span>
<span class="line-modified">524                     node.setColor(Node.Black);</span>































































525                     stage = 0;
<a name="12" id="anc12"></a><span class="line-modified">526                     break;</span>
<span class="line-modified">527        }</span>
<span class="line-modified">528    }</span>
<span class="line-modified">529 </span>
<span class="line-modified">530    // This method insert the node &#39;node&#39; to the tree.</span>
<span class="line-modified">531    // it called from the first stage in the InsertStep method.</span>
<span class="line-modified">532    // we &#39;dive&#39; from the root to a leaf acording to the node key</span>
<span class="line-modified">533    // and insert the node in the proper place.</span>
<span class="line-modified">534 </span>
<span class="line-modified">535    private void Tree_Insert()</span>
<span class="line-modified">536    {</span>
<span class="line-modified">537        Node n1,n2;</span>
<span class="line-modified">538        n1 = root;</span>
<span class="line-modified">539        n2 = treeNull;</span>
<span class="line-modified">540        while (n1 != treeNull)</span>
<span class="line-modified">541        {</span>
<span class="line-modified">542           n2 = n1;</span>
<span class="line-modified">543           if (node.getKey() &lt; n1.getKey())</span>
<span class="line-modified">544              n1 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">545           else</span>
<span class="line-modified">546              n1 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">547        }</span>
<span class="line-modified">548        node.setNode(Node.Parent,n2);</span>
<span class="line-modified">549        if (n2 == treeNull)</span>
<span class="line-modified">550           root = node;</span>
<span class="line-modified">551        else</span>
<span class="line-modified">552        {</span>
<span class="line-modified">553           if (node.getKey() &lt; n2.getKey())</span>
<span class="line-modified">554              n2.setNode(Node.Left_son,node);</span>
<span class="line-modified">555           else</span>
<span class="line-modified">556              n2.setNode(Node.Right_son,node);</span>
<span class="line-modified">557        }</span>
<span class="line-modified">558        //Parent.display.drawTree();</span>
<span class="line-modified">559        // updating the insertion stage.</span>
<span class="line-modified">560        if ((node == root) ||</span>
<span class="line-modified">561           ((node.getNode(Node.Parent)).getColor() == Node.Black))</span>
<span class="line-modified">562           if (root.getColor() == Node.Red)</span>
<span class="line-modified">563           {</span>
<span class="line-modified">564              stage = 9;</span>
<span class="line-modified">565           }</span>
<span class="line-modified">566           else</span>
<span class="line-modified">567              stage = 0;</span>
<span class="line-modified">568        else</span>
<span class="line-modified">569        {</span>
<span class="line-modified">570           stage = 2;</span>
<span class="line-modified">571           InsertStep();</span>
<span class="line-modified">572        }</span>
<span class="line-modified">573        num_of_nodes++;   // increasing the number of nodes</span>
<span class="line-modified">574    }</span>
<span class="line-modified">575 </span>
<span class="line-removed">576    // This method delete the node &#39;node&#39; from the tree.</span>
<span class="line-removed">577    // it called from the first stage in the DeleteStep method.</span>
<span class="line-removed">578    // if node has at most one son we just remove it and connect</span>
<span class="line-removed">579    // his son and parent. If it has 2 sons we delete his successor</span>
<span class="line-removed">580    // that has at most one son and replace him with the successor.</span>
<span class="line-removed">581 </span>
<span class="line-removed">582    private void Tree_Delete()</span>
<span class="line-removed">583    {</span>
<span class="line-removed">584       Node n1,n2,n3;</span>
<span class="line-removed">585       if ((node.getNode(Node.Left_son) == treeNull) ||</span>
<span class="line-removed">586           (node.getNode(Node.Right_son) == treeNull))</span>
<span class="line-removed">587          n1 = node;</span>
<span class="line-removed">588       else</span>
<span class="line-removed">589          n1 = Tree_Successor(node);</span>
<span class="line-removed">590       if (n1.getNode(node.Left_son) != treeNull)</span>
<span class="line-removed">591          n2 = n1.getNode(Node.Left_son);</span>
<span class="line-removed">592       else</span>
<span class="line-removed">593          n2 = n1.getNode(Node.Right_son);</span>
<span class="line-removed">594 </span>
<span class="line-removed">595       n3 = n1.getNode(Node.Parent);</span>
<span class="line-removed">596       n2.setNode(Node.Parent,n3);</span>
<span class="line-removed">597       if (n3 == treeNull)</span>
<span class="line-removed">598          root = n2;</span>
<span class="line-removed">599       else</span>
<span class="line-removed">600          if (n1 == n3.getNode(Node.Left_son))</span>
<span class="line-removed">601             n3.setNode(Node.Left_son,n2);</span>
<span class="line-removed">602          else</span>
<span class="line-removed">603             n3.setNode(Node.Right_son,n2);</span>
<span class="line-removed">604 </span>
<span class="line-removed">605       if (n1 != node)</span>
<span class="line-removed">606       {</span>
<span class="line-removed">607          node.setKey(n1.getKey());</span>
<span class="line-removed">608       }</span>
<span class="line-removed">609 </span>
<span class="line-removed">610 </span>
<span class="line-removed">611       node = n2;</span>
<span class="line-removed">612       if (n1.getColor() == Node.Black)</span>
<span class="line-removed">613          if ((node != root) &amp;&amp; (node.getColor() == Node.Black))</span>
614             stage = 2;
<a name="13" id="anc13"></a><span class="line-modified">615          else</span>
<span class="line-modified">616             if (node.getColor() == Node.Red)</span>
<span class="line-modified">617                stage = 13;</span>
<span class="line-modified">618             else</span>
<span class="line-modified">619                stage = 0;</span>
<span class="line-modified">620       else</span>
<span class="line-modified">621          stage = 0;</span>
<span class="line-modified">622       num_of_nodes--;      // decrease the number of nodes.</span>
<span class="line-modified">623    }</span>
<span class="line-modified">624 </span>
<span class="line-modified">625    // This method return the successor of the node n in the tree.</span>
<span class="line-modified">626 </span>
<span class="line-modified">627    private Node Tree_Successor(Node n)</span>
<span class="line-modified">628    {</span>
<span class="line-modified">629       Node n1;</span>
<span class="line-modified">630       if (n.getNode(Node.Right_son) != treeNull)</span>
<span class="line-modified">631       {</span>
<span class="line-modified">632          n = n.getNode(Node.Right_son);</span>
<span class="line-modified">633          while (n.getNode(Node.Left_son) != treeNull)</span>
<span class="line-modified">634              n = n.getNode(Node.Left_son);</span>
<span class="line-modified">635          return n;</span>
<span class="line-modified">636       }</span>
<span class="line-modified">637       n1 = n.getNode(Node.Parent);</span>
<span class="line-modified">638       while ((n1 != treeNull) &amp;&amp; (n == n1.getNode(Node.Right_son)))</span>
<span class="line-modified">639       {</span>
<span class="line-modified">640          n = n1;</span>
<span class="line-modified">641          n1 = n1.getNode(Node.Parent);</span>
<span class="line-modified">642       }</span>
<span class="line-modified">643       return n1;</span>
<span class="line-modified">644    }</span>
<span class="line-modified">645 </span>
<span class="line-modified">646    // This method perform Left Rotation with n1.</span>
<span class="line-modified">647 </span>
<span class="line-modified">648    private void Left_Rotate(Node n1)</span>
<span class="line-modified">649    {</span>
<span class="line-modified">650       Node n2;</span>
<span class="line-modified">651 </span>
<span class="line-modified">652       n2 = n1.getNode(Node.Right_son);</span>
<span class="line-modified">653       n1.setNode(Node.Right_son,n2.getNode(Node.Left_son));</span>
<span class="line-modified">654       if (n2.getNode(Node.Left_son) != treeNull)</span>
<span class="line-modified">655          (n2.getNode(Node.Left_son)).setNode(Node.Parent,n1);</span>
<span class="line-modified">656       n2.setNode(Node.Parent,n1.getNode(Node.Parent));</span>
<span class="line-modified">657       if (n1.getNode(Node.Parent) == treeNull)</span>
<span class="line-modified">658          root = n2;</span>
<span class="line-modified">659       else</span>
<span class="line-modified">660          if (n1 == (n1.getNode(Node.Parent)).getNode(Node.Left_son))</span>
<span class="line-modified">661             (n1.getNode(Node.Parent)).setNode(Node.Left_son,n2);</span>
<span class="line-modified">662          else</span>
<span class="line-modified">663             (n1.getNode(Node.Parent)).setNode(Node.Right_son,n2);</span>
<span class="line-modified">664       n2.setNode(Node.Left_son,n1);</span>
<span class="line-modified">665       n1.setNode(Node.Parent,n2);</span>
<span class="line-modified">666    }</span>
<span class="line-modified">667 </span>
<span class="line-modified">668    // This method perform Right Rotation with n1.</span>
<span class="line-modified">669 </span>
<span class="line-modified">670    private void Right_Rotate(Node n1)</span>
<span class="line-modified">671    {</span>
<span class="line-modified">672       Node n2;</span>
<span class="line-modified">673 </span>
<span class="line-modified">674       n2 = n1.getNode(Node.Left_son);</span>
<span class="line-modified">675       n1.setNode(Node.Left_son,n2.getNode(Node.Right_son));</span>
<span class="line-modified">676       if (n2.getNode(Node.Right_son) != treeNull)</span>
<span class="line-modified">677          (n2.getNode(Node.Right_son)).setNode(Node.Parent,n1);</span>
<span class="line-modified">678       n2.setNode(Node.Parent,n1.getNode(Node.Parent));</span>
<span class="line-modified">679       if (n1.getNode(Node.Parent) == treeNull)</span>
<span class="line-modified">680          root = n2;</span>
<span class="line-modified">681       else</span>
<span class="line-modified">682          if (n1 == (n1.getNode(Node.Parent)).getNode(Node.Left_son))</span>
<span class="line-modified">683             (n1.getNode(Node.Parent)).setNode(Node.Left_son,n2);</span>
<span class="line-modified">684          else</span>
<span class="line-modified">685             (n1.getNode(Node.Parent)).setNode(Node.Right_son,n2);</span>
<span class="line-modified">686       n2.setNode(Node.Right_son,n1);</span>
<span class="line-modified">687       n1.setNode(Node.Parent,n2);</span>
<span class="line-modified">688    }</span>
<span class="line-modified">689 </span>
<span class="line-modified">690    // This method search the tree for a node with key &#39;key&#39;, and</span>
<span class="line-modified">691    // return the node on success otherwise treeNull.</span>
<span class="line-modified">692 </span>
<span class="line-modified">693    public Node Search(int key)</span>
<span class="line-modified">694    {</span>
<span class="line-modified">695       Node node;</span>
<span class="line-modified">696       node = root;</span>
<span class="line-modified">697       while ((node != treeNull) &amp;&amp; (key != node.getKey()))</span>
<span class="line-modified">698          if (key &lt; node.getKey())</span>
<span class="line-modified">699             node = node.getNode(Node.Left_son);</span>
<span class="line-modified">700          else</span>
<span class="line-modified">701             node = node.getNode(Node.Right_son);</span>
<span class="line-modified">702       return node;</span>
<span class="line-modified">703    }</span>
<span class="line-modified">704 </span>
<span class="line-modified">705    // This method update the tree height it uses a recursive method</span>
<span class="line-modified">706    // findheight.</span>
<span class="line-modified">707 </span>
<span class="line-modified">708    private void updateHeight()</span>
<span class="line-modified">709    {</span>
<span class="line-modified">710       height = 0;</span>
<span class="line-modified">711       if (root != treeNull)</span>
<span class="line-modified">712          findHeight(root,1);</span>
<span class="line-modified">713    }</span>
<span class="line-modified">714 </span>
<span class="line-modified">715    // This is a recursive method that find a node height.</span>
<span class="line-modified">716 </span>
<span class="line-modified">717    private void findHeight(Node n,int curr)</span>
<span class="line-modified">718    {</span>
<span class="line-modified">719       if (height &lt; curr)</span>
<span class="line-modified">720          height = curr;</span>
<span class="line-modified">721       if (n.getNode(Node.Left_son) != treeNull)</span>
<span class="line-modified">722          findHeight(n.getNode(Node.Left_son),curr+1);</span>
<span class="line-modified">723       if (n.getNode(Node.Right_son) != treeNull)</span>
<span class="line-modified">724          findHeight(n.getNode(Node.Right_son),curr+1);</span>
<span class="line-modified">725    }</span>








































726 
727 }
<a name="14" id="anc14"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="14" type="hidden" />
</body>
</html>