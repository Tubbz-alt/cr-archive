<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/vmTestbase/jit/graph/RBTree.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="Node.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="test1.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/vmTestbase/jit/graph/RBTree.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2008, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -18,710 +18,628 @@</span>
   *
   * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   */
<span class="udiff-line-removed">- package jit.graph;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- import nsk.share.TestFailure;</span>
  
<span class="udiff-line-modified-removed">- //import Node;</span>
<span class="udiff-line-modified-added">+ package jit.graph;</span>
  
  // This class defines the tree object.
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- public class RBTree</span>
<span class="udiff-line-modified-removed">- {</span>
<span class="udiff-line-modified-removed">-    public final static int  maxNodes = 70;        // maximum nodes allowed.</span>
<span class="udiff-line-modified-removed">-    public final static int  INSERT   = 0;         // constants indicating</span>
<span class="udiff-line-modified-removed">-    public final static int  DELETE   = 1;         // the current operation</span>
<span class="udiff-line-modified-removed">-    public final static int  NOP      = 2;</span>
<span class="udiff-line-modified-removed">-    public final static Node treeNull = new Node(); // the tree NULL node.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    private Node    root;</span>
<span class="udiff-line-modified-removed">-    private int     num_of_nodes;</span>
<span class="udiff-line-modified-removed">-    private int     height;           // The tree heigth ,it is updated</span>
<span class="udiff-line-modified-removed">-                                      // in each operation.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // since the algorithem is executed in stages I have to remember data</span>
<span class="udiff-line-modified-removed">-    // on the state.</span>
<span class="udiff-line-modified-removed">-    private Node    node;  // The current operation is being done on it.</span>
<span class="udiff-line-modified-removed">-    private int     action;// The operation being performed (insert / delete)</span>
<span class="udiff-line-modified-removed">-    private int     stage; // The current stage of execution</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // the constructor initialize the object fields.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    public RBTree()</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       root         = treeNull;</span>
<span class="udiff-line-modified-removed">-       node         = treeNull;</span>
<span class="udiff-line-modified-removed">-       num_of_nodes = 0;</span>
<span class="udiff-line-modified-removed">-       height       = 0;</span>
<span class="udiff-line-modified-removed">-       action       = NOP;</span>
<span class="udiff-line-modified-removed">-       stage        = 0;</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method return the root of the tree.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    public Node getRoot()</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       return root;</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method return the number of nodes in the tree.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    public int getNodes()</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       return num_of_nodes;</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method return the heigth of the tree.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    public int getHeight()</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       return height;</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method inserts k into the Red Black Tree</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    public boolean RBInsert(int k)</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-       Thread Pause = new Thread();   // this thread is used for delay</span>
<span class="udiff-line-modified-removed">-                                      // between the stages.</span>
<span class="udiff-line-modified-removed">-       if (action != NOP)  // checking similar to the RB_Insert method</span>
<span class="udiff-line-modified-removed">-       {</span>
<span class="udiff-line-modified-removed">-          System.out.println</span>
<span class="udiff-line-modified-removed">-          (&quot;Only one operation can be done at a time.&quot;);</span>
<span class="udiff-line-modified-removed">-          return false;</span>
<span class="udiff-line-modified-removed">-       }</span>
<span class="udiff-line-modified-removed">-       if (num_of_nodes == maxNodes)</span>
<span class="udiff-line-modified-removed">-       {</span>
<span class="udiff-line-modified-removed">-          System.out.println</span>
<span class="udiff-line-modified-removed">-          (&quot;The maximum nodes allowed is already reached.&quot;);</span>
<span class="udiff-line-modified-removed">-          return false;</span>
<span class="udiff-line-modified-removed">-       }</span>
<span class="udiff-line-modified-removed">-       if (Search(k) == treeNull) // Check if there is already node with key k.</span>
<span class="udiff-line-modified-removed">-       {</span>
<span class="udiff-line-modified-removed">-          action = INSERT;</span>
<span class="udiff-line-modified-removed">-          node = new Node(k);</span>
<span class="udiff-line-modified-removed">-          node.setNode(Node.Left_son,treeNull);</span>
<span class="udiff-line-modified-removed">-          node.setNode(Node.Right_son,treeNull);</span>
<span class="udiff-line-modified-removed">-          node.setNode(Node.Parent,treeNull);</span>
<span class="udiff-line-modified-removed">-          stage = 1;</span>
<span class="udiff-line-modified-removed">-          while (stage != 0)     // This is the loop that perform all the</span>
<span class="udiff-line-modified-removed">-          {                      // operation steps.</span>
<span class="udiff-line-modified-removed">-             InsertStep();       // perform one step</span>
<span class="udiff-line-modified-removed">-             updateHeight();     // update the tree height</span>
<span class="udiff-line-modified-removed">-          }</span>
<span class="udiff-line-modified-removed">-          action = NOP;           // set the action to NoOPretion.</span>
<span class="udiff-line-modified-removed">-          return true;</span>
<span class="udiff-line-modified-removed">-       }</span>
<span class="udiff-line-modified-removed">-       else</span>
<span class="udiff-line-modified-removed">-         System.out.println</span>
<span class="udiff-line-modified-removed">-         (&quot;Insertion failed. This key already exist.&quot;);</span>
<span class="udiff-line-modified-removed">-       return false;</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method deletes the element k from the Red Black tree</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    public boolean RBDelete(int k)</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       Thread Pause = new Thread();   // this thread is used for delay</span>
<span class="udiff-line-modified-removed">-                                      // between the stages.</span>
<span class="udiff-line-modified-removed">-       if (action != NOP)</span>
<span class="udiff-line-modified-removed">-       {                              // checking like in RB_Delete method</span>
<span class="udiff-line-modified-removed">-          System.out.println</span>
<span class="udiff-line-modified-removed">-          (&quot;Only one operation can be done at a time.&quot;);</span>
<span class="udiff-line-modified-removed">-          return false;</span>
<span class="udiff-line-modified-removed">-       }</span>
<span class="udiff-line-modified-removed">-       node = Search(k);</span>
<span class="udiff-line-modified-removed">-       if (node != treeNull)       // Check if there is a node with key k.</span>
<span class="udiff-line-modified-removed">-       {</span>
<span class="udiff-line-modified-removed">-          action = DELETE;</span>
<span class="udiff-line-modified-removed">-          stage = 1;</span>
<span class="udiff-line-modified-removed">-          while (stage != 0)    // this loop perform all the operation</span>
<span class="udiff-line-modified-removed">-          {                     // steps.</span>
<span class="udiff-line-modified-removed">-             DeleteStep();               // perform one step</span>
<span class="udiff-line-modified-removed">-             updateHeight();             // update the tree height</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-          }</span>
<span class="udiff-line-modified-removed">-          action = NOP;</span>
<span class="udiff-line-modified-removed">-          return true;</span>
<span class="udiff-line-modified-removed">-       }</span>
<span class="udiff-line-modified-removed">-       else</span>
<span class="udiff-line-modified-removed">-          System.out.println</span>
<span class="udiff-line-modified-removed">-          (&quot;Deletion failed. This key doesn&#39;t exist.&quot;);</span>
<span class="udiff-line-modified-removed">-       return false;</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method perform one step in the insertion operation.</span>
<span class="udiff-line-removed">-    // If perform a step acording to the stage variable.</span>
<span class="udiff-line-removed">-    // I will not explain exactly what each stage do, just that they</span>
<span class="udiff-line-removed">-    // divided to 4 categories:</span>
<span class="udiff-line-removed">-    // 1. inserting a node to the tree.</span>
<span class="udiff-line-removed">-    // 2. marking nodes that will be recolored.</span>
<span class="udiff-line-removed">-    // 3. recoloring nodes.</span>
<span class="udiff-line-removed">-    // 4. rotating right or left.</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-    private void InsertStep()</span>
<span class="udiff-line-removed">-    {</span>
<span class="udiff-line-removed">-       Node Pr,GrPr,Un; // Pr is parent, GrPr is grandparent</span>
<span class="udiff-line-removed">-                        // and Un is uncle.</span>
<span class="udiff-line-removed">-       switch (stage)</span>
<span class="udiff-line-removed">-       {</span>
<span class="udiff-line-removed">-            case 1: // Inserting a node to the tree</span>
<span class="udiff-line-removed">-                /*</span>
<span class="udiff-line-removed">-                   System.out.println  // send a message to the screen</span>
<span class="udiff-line-removed">-                   (new String(&quot;Inserting &quot;)</span>
<span class="udiff-line-removed">-                   .concat(Integer.toString(node.getKey())));</span>
<span class="udiff-line-removed">-                */</span>
<span class="udiff-line-removed">-                   Tree_Insert();        // inserting an element to the tree</span>
<span class="udiff-line-removed">-                   break;</span>
<span class="udiff-line-removed">-            case 2:       // mid stage that move to algorithem to the</span>
<span class="udiff-line-removed">-                          // proper next stage, and send proper message</span>
<span class="udiff-line-removed">-                          // to the screen</span>
<span class="udiff-line-removed">-                   Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                   if (Pr == GrPr.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-                   {</span>
<span class="udiff-line-removed">-                      Un = GrPr.getNode(Node.Right_son);</span>
<span class="udiff-line-removed">-                      if (Un.getColor() == Node.Red)</span>
<span class="udiff-line-removed">-                      {</span>
<span class="udiff-line-modified-added">+ public class RBTree {</span>
<span class="udiff-line-modified-added">+     public final static int maxNodes = 70;      // maximum nodes allowed.</span>
<span class="udiff-line-modified-added">+     public final static int INSERT = 0;         // constants indicating</span>
<span class="udiff-line-modified-added">+     public final static int DELETE = 1;         // the current operation</span>
<span class="udiff-line-modified-added">+     public final static int NOP = 2;</span>
<span class="udiff-line-modified-added">+     public final static Node treeNull = new Node(); // the tree NULL node.</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private Node root;</span>
<span class="udiff-line-modified-added">+     private int num_of_nodes;</span>
<span class="udiff-line-modified-added">+     private int height;           // The tree height, it is updated</span>
<span class="udiff-line-modified-added">+     // in each operation.</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // since the algorithm is executed in stages I have to remember data</span>
<span class="udiff-line-modified-added">+     // on the state.</span>
<span class="udiff-line-modified-added">+     private Node node;  // The current operation is being done on it.</span>
<span class="udiff-line-modified-added">+     private int action; // The operation being performed (insert / delete)</span>
<span class="udiff-line-modified-added">+     private int stage;  // The current stage of execution</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // the constructor initializes the object fields.</span>
<span class="udiff-line-modified-added">+     public RBTree() {</span>
<span class="udiff-line-modified-added">+         root = treeNull;</span>
<span class="udiff-line-modified-added">+         node = treeNull;</span>
<span class="udiff-line-modified-added">+         num_of_nodes = 0;</span>
<span class="udiff-line-modified-added">+         height = 0;</span>
<span class="udiff-line-modified-added">+         action = NOP;</span>
<span class="udiff-line-modified-added">+         stage = 0;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method returns the root of the tree.</span>
<span class="udiff-line-modified-added">+     public Node getRoot() {</span>
<span class="udiff-line-modified-added">+         return root;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method returns the number of nodes in the tree.</span>
<span class="udiff-line-modified-added">+     public int getNodes() {</span>
<span class="udiff-line-modified-added">+         return num_of_nodes;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method returns the height of the tree.</span>
<span class="udiff-line-modified-added">+     public int getHeight() {</span>
<span class="udiff-line-modified-added">+         return height;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method inserts k into the Red Black Tree</span>
<span class="udiff-line-modified-added">+     public boolean RBInsert(int k) {</span>
<span class="udiff-line-modified-added">+         // checking similar to the RB_Insert method</span>
<span class="udiff-line-modified-added">+         if (action != NOP) {</span>
<span class="udiff-line-modified-added">+             System.out.println(&quot;Only one operation can be done at a time.&quot;);</span>
<span class="udiff-line-modified-added">+             return false;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         if (num_of_nodes == maxNodes) {</span>
<span class="udiff-line-modified-added">+             System.out.println(&quot;The maximum nodes allowed is already reached.&quot;);</span>
<span class="udiff-line-modified-added">+             return false;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         // Check if there is already node with key k.</span>
<span class="udiff-line-modified-added">+         if (Search(k) == treeNull) {</span>
<span class="udiff-line-modified-added">+             action = INSERT;</span>
<span class="udiff-line-modified-added">+             node = new Node(k);</span>
<span class="udiff-line-modified-added">+             node.setNode(Node.Left_son, treeNull);</span>
<span class="udiff-line-modified-added">+             node.setNode(Node.Right_son, treeNull);</span>
<span class="udiff-line-modified-added">+             node.setNode(Node.Parent, treeNull);</span>
<span class="udiff-line-modified-added">+             stage = 1;</span>
<span class="udiff-line-modified-added">+             // This is the loop that perform all the operation steps.</span>
<span class="udiff-line-modified-added">+             while (stage != 0) {</span>
<span class="udiff-line-modified-added">+                 // perform one step</span>
<span class="udiff-line-modified-added">+                 InsertStep();</span>
<span class="udiff-line-modified-added">+                 // update the tree height</span>
<span class="udiff-line-modified-added">+                 updateHeight();</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             // set the action to NoOPretion.</span>
<span class="udiff-line-modified-added">+             action = NOP;</span>
<span class="udiff-line-modified-added">+             return true;</span>
<span class="udiff-line-modified-added">+         } else</span>
<span class="udiff-line-modified-added">+             System.out.println(&quot;Insertion failed. This key already exist.&quot;);</span>
<span class="udiff-line-modified-added">+         return false;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method deletes the element k from the Red Black tree</span>
<span class="udiff-line-modified-added">+     public boolean RBDelete(int k) {</span>
<span class="udiff-line-modified-added">+         // checking like in RB_Delete method</span>
<span class="udiff-line-modified-added">+         if (action != NOP) {</span>
<span class="udiff-line-modified-added">+             System.out.println(&quot;Only one operation can be done at a time.&quot;);</span>
<span class="udiff-line-modified-added">+             return false;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         node = Search(k);</span>
<span class="udiff-line-modified-added">+         // Check if there is a node with key k.</span>
<span class="udiff-line-modified-added">+         if (node != treeNull) {</span>
<span class="udiff-line-modified-added">+             action = DELETE;</span>
<span class="udiff-line-modified-added">+             stage = 1;</span>
<span class="udiff-line-modified-added">+             // this loop perform all the operation steps.</span>
<span class="udiff-line-modified-added">+             while (stage != 0) {</span>
<span class="udiff-line-modified-added">+                 // perform one step</span>
<span class="udiff-line-modified-added">+                 DeleteStep();</span>
<span class="udiff-line-modified-added">+                 // update the tree height</span>
<span class="udiff-line-modified-added">+                 updateHeight();</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             action = NOP;</span>
<span class="udiff-line-modified-added">+             return true;</span>
<span class="udiff-line-modified-added">+         } else</span>
<span class="udiff-line-modified-added">+             System.out.println(&quot;Deletion failed. This key doesn&#39;t exist.&quot;);</span>
<span class="udiff-line-modified-added">+         return false;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method performs one step in the insertion operation.</span>
<span class="udiff-line-modified-added">+     // It performs a step according to the stage variable.</span>
<span class="udiff-line-modified-added">+     // I will not explain exactly what each stage do, just that they</span>
<span class="udiff-line-modified-added">+     // divided to 4 categories:</span>
<span class="udiff-line-modified-added">+     // 1. inserting a node to the tree.</span>
<span class="udiff-line-modified-added">+     // 2. marking nodes that will be recolored.</span>
<span class="udiff-line-modified-added">+     // 3. recoloring nodes.</span>
<span class="udiff-line-modified-added">+     // 4. rotating right or left.</span>
<span class="udiff-line-modified-added">+     private void InsertStep() {</span>
<span class="udiff-line-modified-added">+         // Pr is parent, GrPr is grandparent and Un is uncle.</span>
<span class="udiff-line-modified-added">+         Node Pr, GrPr, Un;</span>
<span class="udiff-line-modified-added">+         switch (stage) {</span>
<span class="udiff-line-modified-added">+             // Inserting a node to the tree</span>
<span class="udiff-line-modified-added">+             case 1:</span>
<span class="udiff-line-modified-added">+                 Tree_Insert();</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // mid stage that moves the algorithm to the proper next stage</span>
<span class="udiff-line-modified-added">+             case 2:</span>
<span class="udiff-line-modified-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 if (Pr == GrPr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+                     Un = GrPr.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-added">+                     if (Un.getColor() == Node.Red) {</span>
                          stage = 3;
<span class="udiff-line-modified-removed">-                      }</span>
<span class="udiff-line-modified-removed">-                      else</span>
<span class="udiff-line-modified-removed">-                         if (node == Pr.getNode(Node.Right_son))</span>
<span class="udiff-line-modified-removed">-                         {</span>
<span class="udiff-line-modified-removed">-                            node = Pr;</span>
<span class="udiff-line-modified-removed">-                            stage = 5;</span>
<span class="udiff-line-modified-removed">-                         }</span>
<span class="udiff-line-modified-removed">-                         else</span>
<span class="udiff-line-modified-removed">-                         {</span>
<span class="udiff-line-removed">-                            stage = 6;</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                   }</span>
<span class="udiff-line-removed">-                   else</span>
<span class="udiff-line-removed">-                   {</span>
<span class="udiff-line-removed">-                      Un = GrPr.getNode(Node.Left_son);</span>
<span class="udiff-line-removed">-                      if (Un.getColor() == Node.Red)</span>
<span class="udiff-line-removed">-                      {</span>
<span class="udiff-line-modified-added">+                     } else if (node == Pr.getNode(Node.Right_son)) {</span>
<span class="udiff-line-modified-added">+                         node = Pr;</span>
<span class="udiff-line-modified-added">+                         stage = 5;</span>
<span class="udiff-line-modified-added">+                     } else {</span>
<span class="udiff-line-modified-added">+                         stage = 6;</span>
<span class="udiff-line-modified-added">+                     }</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-modified-added">+                     Un = GrPr.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-added">+                     if (Un.getColor() == Node.Red) {</span>
                          stage = 3;
<span class="udiff-line-modified-removed">-                      }</span>
<span class="udiff-line-modified-removed">-                      else</span>
<span class="udiff-line-modified-removed">-                         if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-modified-removed">-                         {</span>
<span class="udiff-line-modified-removed">-                            node = Pr;</span>
<span class="udiff-line-modified-removed">-                            stage = 5;</span>
<span class="udiff-line-modified-removed">-                         }</span>
<span class="udiff-line-modified-removed">-                         else</span>
<span class="udiff-line-modified-removed">-                         {</span>
<span class="udiff-line-modified-removed">-                            stage = 6;</span>
<span class="udiff-line-modified-removed">-                         }</span>
<span class="udiff-line-modified-removed">-                   }</span>
<span class="udiff-line-modified-removed">-                   break;</span>
<span class="udiff-line-modified-removed">-            case 3:       // This stage marks node that will be recolored</span>
<span class="udiff-line-modified-removed">-                   Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                   if (Pr == GrPr.getNode(Node.Left_son))</span>
<span class="udiff-line-modified-removed">-                      Un = GrPr.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-removed">-                   else</span>
<span class="udiff-line-modified-removed">-                       Un = GrPr.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                   node = GrPr;</span>
<span class="udiff-line-modified-removed">-                   stage = 4;</span>
<span class="udiff-line-modified-removed">-                   break;</span>
<span class="udiff-line-modified-removed">-            case 4:          // this stage recolor marked nodes.</span>
<span class="udiff-line-modified-removed">-                   node.setColor(Node.Red);</span>
<span class="udiff-line-modified-removed">-                   (node.getNode(Node.Left_son)).setColor(Node.Black);</span>
<span class="udiff-line-modified-removed">-                   (node.getNode(Node.Right_son)).setColor(Node.Black);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-                   if ((node == root) ||</span>
<span class="udiff-line-removed">-                      ((node.getNode(Node.Parent)).getColor() == Node.Black))</span>
<span class="udiff-line-removed">-                      if (root.getColor() == Node.Red)</span>
<span class="udiff-line-removed">-                      {</span>
<span class="udiff-line-modified-added">+                     } else if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+                         node = Pr;</span>
<span class="udiff-line-modified-added">+                         stage = 5;</span>
<span class="udiff-line-modified-added">+                     } else {</span>
<span class="udiff-line-modified-added">+                         stage = 6;</span>
<span class="udiff-line-modified-added">+                     }</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage marks node that will be recolored</span>
<span class="udiff-line-modified-added">+             case 3:</span>
<span class="udiff-line-modified-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 if (Pr == GrPr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+                     Un = GrPr.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-modified-added">+                     Un = GrPr.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 node = GrPr;</span>
<span class="udiff-line-modified-added">+                 stage = 4;</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage recolors marked nodes.</span>
<span class="udiff-line-modified-added">+             case 4:</span>
<span class="udiff-line-modified-added">+                 node.setColor(Node.Red);</span>
<span class="udiff-line-modified-added">+                 node.getNode(Node.Left_son).setColor(Node.Black);</span>
<span class="udiff-line-modified-added">+                 node.getNode(Node.Right_son).setColor(Node.Black);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                 if ((node == root) ||</span>
<span class="udiff-line-modified-added">+                         (node.getNode(Node.Parent).getColor() == Node.Black)) {</span>
<span class="udiff-line-modified-added">+                     if (root.getColor() == Node.Red) {</span>
                          stage = 9;
<span class="udiff-line-modified-removed">-                      }</span>
<span class="udiff-line-removed">-                      else</span>
<span class="udiff-line-modified-added">+                     } else</span>
                          stage = 0;
<span class="udiff-line-modified-removed">-                   else</span>
<span class="udiff-line-modified-removed">-                   {</span>
<span class="udiff-line-modified-removed">-                      stage = 2;</span>
<span class="udiff-line-modified-removed">-                      InsertStep();</span>
<span class="udiff-line-modified-removed">-                   }</span>
<span class="udiff-line-modified-removed">-                   break;</span>
<span class="udiff-line-modified-removed">-            case 5:        // This stage perform rotation operation</span>
<span class="udiff-line-modified-removed">-                   Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                   if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-modified-removed">-                      Left_Rotate(node);</span>
<span class="udiff-line-modified-removed">-                   else</span>
<span class="udiff-line-modified-removed">-                      Right_Rotate(node);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                   stage = 6;</span>
<span class="udiff-line-modified-removed">-                   break;</span>
<span class="udiff-line-modified-removed">-            case 6:        // This stage marks nodes that will be recolor.</span>
<span class="udiff-line-modified-removed">-                   Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                   stage = 7;</span>
<span class="udiff-line-modified-removed">-                   break;</span>
<span class="udiff-line-modified-removed">-            case 7:        // This stage recolor marked nodes.</span>
<span class="udiff-line-modified-removed">-                   Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                   Pr.setColor(Node.Black);</span>
<span class="udiff-line-modified-removed">-                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                   GrPr.setColor(Node.Red);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                   stage = 8;</span>
<span class="udiff-line-modified-removed">-                   break;</span>
<span class="udiff-line-modified-removed">-            case 8:        // This stage perform rotation operation</span>
<span class="udiff-line-modified-removed">-                   Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                   GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                   if (Pr == GrPr.getNode(Node.Left_son))</span>
<span class="udiff-line-modified-removed">-                      Right_Rotate(GrPr);</span>
<span class="udiff-line-modified-removed">-                   else</span>
<span class="udiff-line-modified-removed">-                      Left_Rotate(GrPr);</span>
<span class="udiff-line-modified-removed">-                   if (root.getColor() == Node.Red)</span>
<span class="udiff-line-modified-removed">-                   {</span>
<span class="udiff-line-modified-removed">-                      stage = 9;</span>
<span class="udiff-line-modified-removed">-                   }</span>
<span class="udiff-line-modified-removed">-                   else</span>
<span class="udiff-line-removed">-                      stage = 0;</span>
<span class="udiff-line-removed">-                   break;</span>
<span class="udiff-line-removed">-            case 9:        // this stage mark the root.</span>
<span class="udiff-line-removed">-                    stage = 10;</span>
<span class="udiff-line-removed">-                   break;</span>
<span class="udiff-line-removed">-            case 10:       // This stage recolor the root.</span>
<span class="udiff-line-removed">-                   root.setColor(Node.Black);</span>
<span class="udiff-line-removed">-                   stage = 0;</span>
<span class="udiff-line-removed">-                   break;</span>
<span class="udiff-line-removed">-       }</span>
<span class="udiff-line-removed">-    }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-    // This method perform one step in the deletion operation.</span>
<span class="udiff-line-removed">-    // If perform a step acording to the stage variable.</span>
<span class="udiff-line-removed">-    // I will explain exactly what each stage do, just that they</span>
<span class="udiff-line-removed">-    // divided to 4 categories:</span>
<span class="udiff-line-removed">-    // 1. deleting a node from the tree.</span>
<span class="udiff-line-removed">-    // 2. marking nodes that will be recolored.</span>
<span class="udiff-line-removed">-    // 3. recoloring nodes.</span>
<span class="udiff-line-removed">-    // 4. rotating right or left.</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-    public void DeleteStep()</span>
<span class="udiff-line-removed">-    {</span>
<span class="udiff-line-removed">-        Node Pr,Br;     // Pr is Parent ,Br is Brother</span>
<span class="udiff-line-removed">-        switch (stage)</span>
<span class="udiff-line-removed">-        {</span>
<span class="udiff-line-removed">-              case 1:   // This stage delete a node from the tree.</span>
<span class="udiff-line-removed">-                  /*</span>
<span class="udiff-line-removed">-                     System.out.println</span>
<span class="udiff-line-removed">-                     (new String(&quot;Deleting &quot;)</span>
<span class="udiff-line-removed">-                     .concat(Integer.toString(node.getKey())));</span>
<span class="udiff-line-removed">-                  */</span>
<span class="udiff-line-removed">-                     Tree_Delete();</span>
<span class="udiff-line-removed">-                     break;</span>
<span class="udiff-line-removed">-              case 2:   // This stage marks a nodes that will be recolored</span>
<span class="udiff-line-removed">-                        // or perform other stage.</span>
<span class="udiff-line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-removed">-                     if (Br.getColor() == Node.Red)</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                         stage = 3;</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                        if (((Br.getNode(Node.Right_son)).getColor() == Node.Black)</span>
<span class="udiff-line-removed">-                           &amp;&amp; ((Br.getNode(Node.Left_son)).getColor() == Node.Black))</span>
<span class="udiff-line-removed">-                        {</span>
<span class="udiff-line-removed">-                           stage = 5;</span>
<span class="udiff-line-removed">-                           DeleteStep();</span>
<span class="udiff-line-removed">-                        }</span>
<span class="udiff-line-removed">-                        else</span>
<span class="udiff-line-removed">-                        {</span>
<span class="udiff-line-removed">-                           stage = 7;</span>
<span class="udiff-line-removed">-                           DeleteStep();</span>
<span class="udiff-line-removed">-                        }</span>
<span class="udiff-line-removed">-                     break;</span>
<span class="udiff-line-removed">-              case 3:    // this stage recolor marked nodes.</span>
<span class="udiff-line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     Br.setColor(Node.Black);</span>
<span class="udiff-line-removed">-                     Pr.setColor(Node.Red);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                     stage = 4;</span>
<span class="udiff-line-removed">-                     break;</span>
<span class="udiff-line-removed">-              case 4:     // this stage perform rotation operation</span>
<span class="udiff-line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                        Left_Rotate(Pr);</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                        Right_Rotate(Pr);</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     if (((Br.getNode(Node.Right_son)).getColor() == Node.Black)</span>
<span class="udiff-line-removed">-                        &amp;&amp; ((Br.getNode(Node.Left_son)).getColor() == Node.Black))</span>
<span class="udiff-line-removed">-                        stage = 5;</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                        stage = 7;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                     break;</span>
<span class="udiff-line-removed">-              case 5:     // this stage marks nodes that will be recolor.</span>
<span class="udiff-line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                     stage = 6;</span>
<span class="udiff-line-removed">-                     break;</span>
<span class="udiff-line-removed">-              case 6:     // This stage recolor marked nodes.</span>
<span class="udiff-line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-removed">-                     Br.setColor(Node.Red);</span>
<span class="udiff-line-removed">-                     node = Pr;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                     if ((node != root) &amp;&amp; (node.getColor() == Node.Black))</span>
<span class="udiff-line-removed">-                        stage = 2;</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                        if (node.getColor() == Node.Red)</span>
<span class="udiff-line-removed">-                        {</span>
<span class="udiff-line-removed">-                           stage = 13;</span>
<span class="udiff-line-removed">-                        }</span>
<span class="udiff-line-removed">-                        else</span>
<span class="udiff-line-removed">-                           stage = 0;</span>
<span class="udiff-line-removed">-                     break;</span>
<span class="udiff-line-removed">-              case 7:     // this stage marks nodes that will be recolor</span>
<span class="udiff-line-removed">-                          // or perform other stage.</span>
<span class="udiff-line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-removed">-                        if ((Br.getNode(Node.Right_son)).getColor() == Node.Black)</span>
<span class="udiff-line-removed">-                        {</span>
<span class="udiff-line-removed">-                           stage = 8;</span>
<span class="udiff-line-removed">-                        }</span>
<span class="udiff-line-removed">-                        else</span>
<span class="udiff-line-removed">-                        {</span>
<span class="udiff-line-removed">-                           stage = 10;</span>
<span class="udiff-line-removed">-                           DeleteStep();</span>
<span class="udiff-line-removed">-                        }</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-removed">-                        if ((Br.getNode(Node.Left_son)).getColor() == Node.Black)</span>
<span class="udiff-line-removed">-                        {</span>
<span class="udiff-line-removed">-                           stage = 8;</span>
<span class="udiff-line-removed">-                        }</span>
<span class="udiff-line-removed">-                        else</span>
<span class="udiff-line-removed">-                        {</span>
<span class="udiff-line-removed">-                           stage = 10;</span>
<span class="udiff-line-removed">-                           DeleteStep();</span>
<span class="udiff-line-removed">-                        }</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     break;</span>
<span class="udiff-line-removed">-              case 8:     // this stage recolor marked nodes.</span>
<span class="udiff-line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-removed">-                        (Br.getNode(Node.Left_son)).setColor(Node.Black);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-removed">-                        (Br.getNode(Node.Right_son)).setColor(Node.Black);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                     Br.setColor(Node.Red);</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-modified-added">+                     stage = 2;</span>
<span class="udiff-line-modified-added">+                     InsertStep();</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage performs rotation operation</span>
<span class="udiff-line-modified-added">+             case 5:</span>
<span class="udiff-line-modified-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+                     Left_Rotate(node);</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-modified-added">+                     Right_Rotate(node);</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 stage = 6;</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage marks nodes that will be recolor.</span>
<span class="udiff-line-modified-added">+             case 6:</span>
<span class="udiff-line-modified-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                 stage = 7;</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage recolors marked nodes.</span>
<span class="udiff-line-modified-added">+             case 7:</span>
<span class="udiff-line-modified-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 Pr.setColor(Node.Black);</span>
<span class="udiff-line-modified-added">+                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 GrPr.setColor(Node.Red);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                 stage = 8;</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage performs rotation operation</span>
<span class="udiff-line-modified-added">+             case 8:</span>
<span class="udiff-line-modified-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 GrPr = Pr.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 if (Pr == GrPr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+                     Right_Rotate(GrPr);</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-modified-added">+                     Left_Rotate(GrPr);</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 if (root.getColor() == Node.Red) {</span>
                      stage = 9;
<span class="udiff-line-modified-removed">-                     break;</span>
<span class="udiff-line-modified-removed">-              case 9:    // this stage perform rotation operation</span>
<span class="udiff-line-modified-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-modified-removed">-                     {</span>
<span class="udiff-line-modified-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-removed">-                        Right_Rotate(Br);</span>
<span class="udiff-line-modified-removed">-                     }</span>
<span class="udiff-line-modified-removed">-                     else</span>
<span class="udiff-line-modified-removed">-                     {</span>
<span class="udiff-line-modified-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-removed">-                        Left_Rotate(Br);</span>
<span class="udiff-line-modified-removed">-                     }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                     stage = 10;</span>
<span class="udiff-line-modified-removed">-                     break;</span>
<span class="udiff-line-modified-removed">-              case 10:   // This stage marks node that will be recolor.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-modified-removed">-                     {</span>
<span class="udiff-line-modified-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-removed">-                     }</span>
<span class="udiff-line-modified-removed">-                     else</span>
<span class="udiff-line-modified-removed">-                     {</span>
<span class="udiff-line-modified-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-removed">-                     }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                     stage = 11;</span>
<span class="udiff-line-modified-removed">-                     break;</span>
<span class="udiff-line-modified-removed">-              case 11:    // this stage recolor marked nodes.</span>
<span class="udiff-line-modified-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-modified-removed">-                     {</span>
<span class="udiff-line-modified-removed">-                        Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-removed">-                        (Br.getNode(Node.Right_son)).setColor(Node.Black);</span>
<span class="udiff-line-modified-removed">-                     }</span>
<span class="udiff-line-modified-removed">-                     else</span>
<span class="udiff-line-modified-removed">-                     {</span>
<span class="udiff-line-modified-removed">-                        Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-removed">-                        (Br.getNode(Node.Left_son)).setColor(Node.Black);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+                 } else</span>
<span class="udiff-line-modified-added">+                     stage = 0;</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // this stage marks the root.</span>
<span class="udiff-line-modified-added">+             case 9:</span>
<span class="udiff-line-modified-added">+                 stage = 10;</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage recolors the root.</span>
<span class="udiff-line-modified-added">+             case 10:</span>
<span class="udiff-line-modified-added">+                 root.setColor(Node.Black);</span>
<span class="udiff-line-modified-added">+                 stage = 0;</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method performs one step in the deletion operation.</span>
<span class="udiff-line-modified-added">+     // It perform sa step according to the stage variable.</span>
<span class="udiff-line-modified-added">+     // I will explain exactly what each stage do, just that they</span>
<span class="udiff-line-modified-added">+     // divided to 4 categories:</span>
<span class="udiff-line-modified-added">+     // 1. deleting a node from the tree.</span>
<span class="udiff-line-modified-added">+     // 2. marking nodes that will be recolored.</span>
<span class="udiff-line-modified-added">+     // 3. recoloring nodes.</span>
<span class="udiff-line-modified-added">+     // 4. rotating right or left.</span>
<span class="udiff-line-modified-added">+     public void DeleteStep() {</span>
<span class="udiff-line-modified-added">+         // Pr is Parent, Br is Brother</span>
<span class="udiff-line-modified-added">+         Node Pr, Br;</span>
<span class="udiff-line-modified-added">+         switch (stage) {</span>
<span class="udiff-line-modified-added">+             // This stage delete a node from the tree.</span>
<span class="udiff-line-modified-added">+             case 1:</span>
<span class="udiff-line-modified-added">+                 Tree_Delete();</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage marks a nodes that will be recolored or perform other stage.</span>
<span class="udiff-line-modified-added">+             case 2:</span>
<span class="udiff-line-modified-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-modified-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 if (Br.getColor() == Node.Red) {</span>
<span class="udiff-line-modified-added">+                     stage = 3;</span>
<span class="udiff-line-modified-added">+                 } else if ((Br.getNode(Node.Right_son).getColor() == Node.Black)</span>
<span class="udiff-line-added">+                         &amp;&amp; (Br.getNode(Node.Left_son).getColor() == Node.Black)) {</span>
<span class="udiff-line-added">+                     stage = 5;</span>
<span class="udiff-line-added">+                     DeleteStep();</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     stage = 7;</span>
<span class="udiff-line-added">+                     DeleteStep();</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             // This stage recolors marked nodes.</span>
<span class="udiff-line-added">+             case 3:</span>
<span class="udiff-line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 Br.setColor(Node.Black);</span>
<span class="udiff-line-added">+                 Pr.setColor(Node.Red);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 stage = 4;</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             // This stage performs rotation operation</span>
<span class="udiff-line-added">+             case 4:</span>
<span class="udiff-line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-added">+                     Left_Rotate(Pr);</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     Right_Rotate(Pr);</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 if ((Br.getNode(Node.Right_son).getColor() == Node.Black)</span>
<span class="udiff-line-added">+                         &amp;&amp; (Br.getNode(Node.Left_son).getColor() == Node.Black)) {</span>
<span class="udiff-line-added">+                     stage = 5;</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     stage = 7;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             // This stage marks nodes that will be recolor.</span>
<span class="udiff-line-added">+             case 5:</span>
<span class="udiff-line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 stage = 6;</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             // This stage recolors marked nodes.</span>
<span class="udiff-line-added">+             case 6:</span>
<span class="udiff-line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 Br.setColor(Node.Red);</span>
<span class="udiff-line-added">+                 node = Pr;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 if ((node != root) &amp;&amp; (node.getColor() == Node.Black)) {</span>
<span class="udiff-line-added">+                     stage = 2;</span>
<span class="udiff-line-added">+                 } else if (node.getColor() == Node.Red) {</span>
<span class="udiff-line-added">+                     stage = 13;</span>
<span class="udiff-line-added">+                 } else</span>
<span class="udiff-line-added">+                     stage = 0;</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             // This stage marks nodes that will be recolor or perform other stage.</span>
<span class="udiff-line-added">+             case 7:</span>
<span class="udiff-line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-added">+                     if ((Br.getNode(Node.Right_son)).getColor() == Node.Black) {</span>
<span class="udiff-line-added">+                         stage = 8;</span>
<span class="udiff-line-added">+                     } else {</span>
<span class="udiff-line-added">+                         stage = 10;</span>
<span class="udiff-line-added">+                         DeleteStep();</span>
                      }
<span class="udiff-line-modified-removed">-                     if (Br.getColor() != Pr.getColor())</span>
<span class="udiff-line-modified-removed">-                        Br.setColor(Pr.getColor());</span>
<span class="udiff-line-modified-removed">-                     if (Pr.getColor() != Node.Black)</span>
<span class="udiff-line-modified-removed">-                        Pr.setColor(Node.Black);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                     stage = 12;</span>
<span class="udiff-line-modified-removed">-                     break;</span>
<span class="udiff-line-removed">-              case 12:    // this stage perform rotation operation.</span>
<span class="udiff-line-removed">-                     Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-                     if (node == Pr.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-                        Left_Rotate(Pr);</span>
<span class="udiff-line-removed">-                     else</span>
<span class="udiff-line-removed">-                        Right_Rotate(Pr);</span>
<span class="udiff-line-removed">-                     node = root;</span>
<span class="udiff-line-removed">-                     if (node.getColor() == Node.Red)</span>
<span class="udiff-line-removed">-                     {</span>
<span class="udiff-line-removed">-                        stage = 13;</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-modified-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-added">+                     if ((Br.getNode(Node.Left_son)).getColor() == Node.Black) {</span>
<span class="udiff-line-modified-added">+                         stage = 8;</span>
<span class="udiff-line-modified-added">+                     } else {</span>
<span class="udiff-line-modified-added">+                         stage = 10;</span>
<span class="udiff-line-modified-added">+                         DeleteStep();</span>
                      }
<span class="udiff-line-modified-removed">-                     else</span>
<span class="udiff-line-modified-removed">-                        stage = 0;</span>
<span class="udiff-line-modified-removed">-                     break;</span>
<span class="udiff-line-modified-removed">-              case 13:    // this stage marks a node that will be recolor</span>
<span class="udiff-line-modified-removed">-                     stage = 14;</span>
<span class="udiff-line-modified-removed">-                     break;</span>
<span class="udiff-line-modified-removed">-              case 14:    // this stage recolor marked node.</span>
<span class="udiff-line-modified-removed">-                     node.setColor(Node.Black);</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage recolors marked nodes.</span>
<span class="udiff-line-modified-added">+             case 8:</span>
<span class="udiff-line-modified-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-added">+                     Br.getNode(Node.Left_son).setColor(Node.Black);</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-added">+                     Br.getNode(Node.Right_son).setColor(Node.Black);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 Br.setColor(Node.Red);</span>
<span class="udiff-line-added">+                 stage = 9;</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             // This stage performs rotation operation</span>
<span class="udiff-line-added">+             case 9:</span>
<span class="udiff-line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-added">+                     Right_Rotate(Br);</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-added">+                     Left_Rotate(Br);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 stage = 10;</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             // This stage marks node that will be recolor.</span>
<span class="udiff-line-added">+             case 10:</span>
<span class="udiff-line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 stage = 11;</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             // This stage recolors marked nodes.</span>
<span class="udiff-line-added">+             case 11:</span>
<span class="udiff-line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Right_son);</span>
<span class="udiff-line-added">+                     Br.getNode(Node.Right_son).setColor(Node.Black);</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     Br = Pr.getNode(Node.Left_son);</span>
<span class="udiff-line-added">+                     Br.getNode(Node.Left_son).setColor(Node.Black);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 if (Br.getColor() != Pr.getColor()) {</span>
<span class="udiff-line-added">+                     Br.setColor(Pr.getColor());</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 if (Pr.getColor() != Node.Black) {</span>
<span class="udiff-line-added">+                     Pr.setColor(Node.Black);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 stage = 12;</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+             // This stage performs rotation operation.</span>
<span class="udiff-line-added">+             case 12:</span>
<span class="udiff-line-added">+                 Pr = node.getNode(Node.Parent);</span>
<span class="udiff-line-added">+                 if (node == Pr.getNode(Node.Left_son)) {</span>
<span class="udiff-line-added">+                     Left_Rotate(Pr);</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     Right_Rotate(Pr);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 node = root;</span>
<span class="udiff-line-added">+                 if (node.getColor() == Node.Red) {</span>
<span class="udiff-line-added">+                     stage = 13;</span>
<span class="udiff-line-added">+                 } else {</span>
                      stage = 0;
<span class="udiff-line-modified-removed">-                     break;</span>
<span class="udiff-line-modified-removed">-        }</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method insert the node &#39;node&#39; to the tree.</span>
<span class="udiff-line-modified-removed">-    // it called from the first stage in the InsertStep method.</span>
<span class="udiff-line-modified-removed">-    // we &#39;dive&#39; from the root to a leaf acording to the node key</span>
<span class="udiff-line-modified-removed">-    // and insert the node in the proper place.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    private void Tree_Insert()</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-        Node n1,n2;</span>
<span class="udiff-line-modified-removed">-        n1 = root;</span>
<span class="udiff-line-modified-removed">-        n2 = treeNull;</span>
<span class="udiff-line-modified-removed">-        while (n1 != treeNull)</span>
<span class="udiff-line-modified-removed">-        {</span>
<span class="udiff-line-modified-removed">-           n2 = n1;</span>
<span class="udiff-line-modified-removed">-           if (node.getKey() &lt; n1.getKey())</span>
<span class="udiff-line-modified-removed">-              n1 = n1.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-removed">-           else</span>
<span class="udiff-line-modified-removed">-              n1 = n1.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-removed">-        }</span>
<span class="udiff-line-modified-removed">-        node.setNode(Node.Parent,n2);</span>
<span class="udiff-line-modified-removed">-        if (n2 == treeNull)</span>
<span class="udiff-line-modified-removed">-           root = node;</span>
<span class="udiff-line-modified-removed">-        else</span>
<span class="udiff-line-modified-removed">-        {</span>
<span class="udiff-line-modified-removed">-           if (node.getKey() &lt; n2.getKey())</span>
<span class="udiff-line-modified-removed">-              n2.setNode(Node.Left_son,node);</span>
<span class="udiff-line-modified-removed">-           else</span>
<span class="udiff-line-modified-removed">-              n2.setNode(Node.Right_son,node);</span>
<span class="udiff-line-modified-removed">-        }</span>
<span class="udiff-line-modified-removed">-        //Parent.display.drawTree();</span>
<span class="udiff-line-modified-removed">-        // updating the insertion stage.</span>
<span class="udiff-line-modified-removed">-        if ((node == root) ||</span>
<span class="udiff-line-modified-removed">-           ((node.getNode(Node.Parent)).getColor() == Node.Black))</span>
<span class="udiff-line-modified-removed">-           if (root.getColor() == Node.Red)</span>
<span class="udiff-line-modified-removed">-           {</span>
<span class="udiff-line-modified-removed">-              stage = 9;</span>
<span class="udiff-line-modified-removed">-           }</span>
<span class="udiff-line-modified-removed">-           else</span>
<span class="udiff-line-modified-removed">-              stage = 0;</span>
<span class="udiff-line-modified-removed">-        else</span>
<span class="udiff-line-modified-removed">-        {</span>
<span class="udiff-line-modified-removed">-           stage = 2;</span>
<span class="udiff-line-modified-removed">-           InsertStep();</span>
<span class="udiff-line-modified-removed">-        }</span>
<span class="udiff-line-modified-removed">-        num_of_nodes++;   // increasing the number of nodes</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-    // This method delete the node &#39;node&#39; from the tree.</span>
<span class="udiff-line-removed">-    // it called from the first stage in the DeleteStep method.</span>
<span class="udiff-line-removed">-    // if node has at most one son we just remove it and connect</span>
<span class="udiff-line-removed">-    // his son and parent. If it has 2 sons we delete his successor</span>
<span class="udiff-line-removed">-    // that has at most one son and replace him with the successor.</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-    private void Tree_Delete()</span>
<span class="udiff-line-removed">-    {</span>
<span class="udiff-line-removed">-       Node n1,n2,n3;</span>
<span class="udiff-line-removed">-       if ((node.getNode(Node.Left_son) == treeNull) ||</span>
<span class="udiff-line-removed">-           (node.getNode(Node.Right_son) == treeNull))</span>
<span class="udiff-line-removed">-          n1 = node;</span>
<span class="udiff-line-removed">-       else</span>
<span class="udiff-line-removed">-          n1 = Tree_Successor(node);</span>
<span class="udiff-line-removed">-       if (n1.getNode(node.Left_son) != treeNull)</span>
<span class="udiff-line-removed">-          n2 = n1.getNode(Node.Left_son);</span>
<span class="udiff-line-removed">-       else</span>
<span class="udiff-line-removed">-          n2 = n1.getNode(Node.Right_son);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-       n3 = n1.getNode(Node.Parent);</span>
<span class="udiff-line-removed">-       n2.setNode(Node.Parent,n3);</span>
<span class="udiff-line-removed">-       if (n3 == treeNull)</span>
<span class="udiff-line-removed">-          root = n2;</span>
<span class="udiff-line-removed">-       else</span>
<span class="udiff-line-removed">-          if (n1 == n3.getNode(Node.Left_son))</span>
<span class="udiff-line-removed">-             n3.setNode(Node.Left_son,n2);</span>
<span class="udiff-line-removed">-          else</span>
<span class="udiff-line-removed">-             n3.setNode(Node.Right_son,n2);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-       if (n1 != node)</span>
<span class="udiff-line-removed">-       {</span>
<span class="udiff-line-removed">-          node.setKey(n1.getKey());</span>
<span class="udiff-line-removed">-       }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-       node = n2;</span>
<span class="udiff-line-removed">-       if (n1.getColor() == Node.Black)</span>
<span class="udiff-line-removed">-          if ((node != root) &amp;&amp; (node.getColor() == Node.Black))</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage marks a node that will be recolored</span>
<span class="udiff-line-modified-added">+             case 13:</span>
<span class="udiff-line-modified-added">+                 stage = 14;</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+             // This stage recolors marked node.</span>
<span class="udiff-line-modified-added">+             case 14:</span>
<span class="udiff-line-modified-added">+                 node.setColor(Node.Black);</span>
<span class="udiff-line-modified-added">+                 stage = 0;</span>
<span class="udiff-line-modified-added">+                 break;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method inserts the node &#39;node&#39; to the tree.</span>
<span class="udiff-line-modified-added">+     // it called from the first stage in the InsertStep method.</span>
<span class="udiff-line-modified-added">+     // we &#39;dive&#39; from the root to a leaf according to the node key</span>
<span class="udiff-line-modified-added">+     // and insert the node in the proper place.</span>
<span class="udiff-line-modified-added">+     private void Tree_Insert() {</span>
<span class="udiff-line-modified-added">+         Node n1, n2;</span>
<span class="udiff-line-modified-added">+         n1 = root;</span>
<span class="udiff-line-modified-added">+         n2 = treeNull;</span>
<span class="udiff-line-modified-added">+         while (n1 != treeNull) {</span>
<span class="udiff-line-modified-added">+             n2 = n1;</span>
<span class="udiff-line-modified-added">+             if (node.getKey() &lt; n1.getKey()) {</span>
<span class="udiff-line-modified-added">+                 n1 = n1.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-added">+             } else {</span>
<span class="udiff-line-modified-added">+                 n1 = n1.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         node.setNode(Node.Parent, n2);</span>
<span class="udiff-line-modified-added">+         if (n2 == treeNull) {</span>
<span class="udiff-line-modified-added">+             root = node;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         else {</span>
<span class="udiff-line-modified-added">+             if (node.getKey() &lt; n2.getKey()) {</span>
<span class="udiff-line-modified-added">+                 n2.setNode(Node.Left_son, node);</span>
<span class="udiff-line-modified-added">+             } else {</span>
<span class="udiff-line-modified-added">+                 n2.setNode(Node.Right_son, node);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // updating the insertion stage.</span>
<span class="udiff-line-modified-added">+         if ((node == root) ||</span>
<span class="udiff-line-modified-added">+                 (node.getNode(Node.Parent).getColor() == Node.Black)) {</span>
<span class="udiff-line-modified-added">+             if (root.getColor() == Node.Red) {</span>
<span class="udiff-line-modified-added">+                 stage = 9;</span>
<span class="udiff-line-modified-added">+             } else {</span>
<span class="udiff-line-modified-added">+                 stage = 0;</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         } else {</span>
              stage = 2;
<span class="udiff-line-modified-removed">-          else</span>
<span class="udiff-line-modified-removed">-             if (node.getColor() == Node.Red)</span>
<span class="udiff-line-modified-removed">-                stage = 13;</span>
<span class="udiff-line-modified-removed">-             else</span>
<span class="udiff-line-modified-removed">-                stage = 0;</span>
<span class="udiff-line-modified-removed">-       else</span>
<span class="udiff-line-modified-removed">-          stage = 0;</span>
<span class="udiff-line-modified-removed">-       num_of_nodes--;      // decrease the number of nodes.</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method return the successor of the node n in the tree.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    private Node Tree_Successor(Node n)</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       Node n1;</span>
<span class="udiff-line-modified-removed">-       if (n.getNode(Node.Right_son) != treeNull)</span>
<span class="udiff-line-modified-removed">-       {</span>
<span class="udiff-line-modified-removed">-          n = n.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-removed">-          while (n.getNode(Node.Left_son) != treeNull)</span>
<span class="udiff-line-modified-removed">-              n = n.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-removed">-          return n;</span>
<span class="udiff-line-modified-removed">-       }</span>
<span class="udiff-line-modified-removed">-       n1 = n.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-       while ((n1 != treeNull) &amp;&amp; (n == n1.getNode(Node.Right_son)))</span>
<span class="udiff-line-modified-removed">-       {</span>
<span class="udiff-line-modified-removed">-          n = n1;</span>
<span class="udiff-line-modified-removed">-          n1 = n1.getNode(Node.Parent);</span>
<span class="udiff-line-modified-removed">-       }</span>
<span class="udiff-line-modified-removed">-       return n1;</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method perform Left Rotation with n1.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    private void Left_Rotate(Node n1)</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       Node n2;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-       n2 = n1.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-removed">-       n1.setNode(Node.Right_son,n2.getNode(Node.Left_son));</span>
<span class="udiff-line-modified-removed">-       if (n2.getNode(Node.Left_son) != treeNull)</span>
<span class="udiff-line-modified-removed">-          (n2.getNode(Node.Left_son)).setNode(Node.Parent,n1);</span>
<span class="udiff-line-modified-removed">-       n2.setNode(Node.Parent,n1.getNode(Node.Parent));</span>
<span class="udiff-line-modified-removed">-       if (n1.getNode(Node.Parent) == treeNull)</span>
<span class="udiff-line-modified-removed">-          root = n2;</span>
<span class="udiff-line-modified-removed">-       else</span>
<span class="udiff-line-modified-removed">-          if (n1 == (n1.getNode(Node.Parent)).getNode(Node.Left_son))</span>
<span class="udiff-line-modified-removed">-             (n1.getNode(Node.Parent)).setNode(Node.Left_son,n2);</span>
<span class="udiff-line-modified-removed">-          else</span>
<span class="udiff-line-modified-removed">-             (n1.getNode(Node.Parent)).setNode(Node.Right_son,n2);</span>
<span class="udiff-line-modified-removed">-       n2.setNode(Node.Left_son,n1);</span>
<span class="udiff-line-modified-removed">-       n1.setNode(Node.Parent,n2);</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method perform Right Rotation with n1.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    private void Right_Rotate(Node n1)</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       Node n2;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-       n2 = n1.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-removed">-       n1.setNode(Node.Left_son,n2.getNode(Node.Right_son));</span>
<span class="udiff-line-modified-removed">-       if (n2.getNode(Node.Right_son) != treeNull)</span>
<span class="udiff-line-modified-removed">-          (n2.getNode(Node.Right_son)).setNode(Node.Parent,n1);</span>
<span class="udiff-line-modified-removed">-       n2.setNode(Node.Parent,n1.getNode(Node.Parent));</span>
<span class="udiff-line-modified-removed">-       if (n1.getNode(Node.Parent) == treeNull)</span>
<span class="udiff-line-modified-removed">-          root = n2;</span>
<span class="udiff-line-modified-removed">-       else</span>
<span class="udiff-line-modified-removed">-          if (n1 == (n1.getNode(Node.Parent)).getNode(Node.Left_son))</span>
<span class="udiff-line-modified-removed">-             (n1.getNode(Node.Parent)).setNode(Node.Left_son,n2);</span>
<span class="udiff-line-modified-removed">-          else</span>
<span class="udiff-line-modified-removed">-             (n1.getNode(Node.Parent)).setNode(Node.Right_son,n2);</span>
<span class="udiff-line-modified-removed">-       n2.setNode(Node.Right_son,n1);</span>
<span class="udiff-line-modified-removed">-       n1.setNode(Node.Parent,n2);</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method search the tree for a node with key &#39;key&#39;, and</span>
<span class="udiff-line-modified-removed">-    // return the node on success otherwise treeNull.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    public Node Search(int key)</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       Node node;</span>
<span class="udiff-line-modified-removed">-       node = root;</span>
<span class="udiff-line-modified-removed">-       while ((node != treeNull) &amp;&amp; (key != node.getKey()))</span>
<span class="udiff-line-modified-removed">-          if (key &lt; node.getKey())</span>
<span class="udiff-line-modified-removed">-             node = node.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-removed">-          else</span>
<span class="udiff-line-modified-removed">-             node = node.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-removed">-       return node;</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This method update the tree height it uses a recursive method</span>
<span class="udiff-line-modified-removed">-    // findheight.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    private void updateHeight()</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       height = 0;</span>
<span class="udiff-line-modified-removed">-       if (root != treeNull)</span>
<span class="udiff-line-modified-removed">-          findHeight(root,1);</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    // This is a recursive method that find a node height.</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-    private void findHeight(Node n,int curr)</span>
<span class="udiff-line-modified-removed">-    {</span>
<span class="udiff-line-modified-removed">-       if (height &lt; curr)</span>
<span class="udiff-line-modified-removed">-          height = curr;</span>
<span class="udiff-line-modified-removed">-       if (n.getNode(Node.Left_son) != treeNull)</span>
<span class="udiff-line-modified-removed">-          findHeight(n.getNode(Node.Left_son),curr+1);</span>
<span class="udiff-line-modified-removed">-       if (n.getNode(Node.Right_son) != treeNull)</span>
<span class="udiff-line-modified-removed">-          findHeight(n.getNode(Node.Right_son),curr+1);</span>
<span class="udiff-line-modified-removed">-    }</span>
<span class="udiff-line-modified-added">+             InsertStep();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         num_of_nodes++;   // increasing the number of nodes</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method deletes the node &#39;node&#39; from the tree.</span>
<span class="udiff-line-modified-added">+     // it called from the first stage in the DeleteStep method.</span>
<span class="udiff-line-modified-added">+     // if node has at most one son we just remove it and connect</span>
<span class="udiff-line-modified-added">+     // his son and parent. If it has 2 sons we delete his successor</span>
<span class="udiff-line-modified-added">+     // that has at most one son and replace him with the successor.</span>
<span class="udiff-line-modified-added">+     private void Tree_Delete() {</span>
<span class="udiff-line-modified-added">+         Node n1, n2, n3;</span>
<span class="udiff-line-modified-added">+         if ((node.getNode(Node.Left_son) == treeNull) ||</span>
<span class="udiff-line-modified-added">+                 (node.getNode(Node.Right_son) == treeNull)) {</span>
<span class="udiff-line-modified-added">+             n1 = node;</span>
<span class="udiff-line-modified-added">+         } else {</span>
<span class="udiff-line-modified-added">+             n1 = Tree_Successor(node);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         if (n1.getNode(Node.Left_son) != treeNull) {</span>
<span class="udiff-line-modified-added">+             n2 = n1.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-added">+         } else {</span>
<span class="udiff-line-modified-added">+             n2 = n1.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         n3 = n1.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+         n2.setNode(Node.Parent, n3);</span>
<span class="udiff-line-modified-added">+         if (n3 == treeNull) {</span>
<span class="udiff-line-modified-added">+             root = n2;</span>
<span class="udiff-line-modified-added">+         } else if (n1 == n3.getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+             n3.setNode(Node.Left_son, n2);</span>
<span class="udiff-line-modified-added">+         } else {</span>
<span class="udiff-line-modified-added">+             n3.setNode(Node.Right_son, n2);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         if (n1 != node) {</span>
<span class="udiff-line-modified-added">+             node.setKey(n1.getKey());</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         node = n2;</span>
<span class="udiff-line-modified-added">+         if (n1.getColor() == Node.Black) {</span>
<span class="udiff-line-modified-added">+             if ((node != root) &amp;&amp; (node.getColor() == Node.Black)) {</span>
<span class="udiff-line-modified-added">+                 stage = 2;</span>
<span class="udiff-line-modified-added">+             } else if (node.getColor() == Node.Red) {</span>
<span class="udiff-line-modified-added">+                 stage = 13;</span>
<span class="udiff-line-modified-added">+             } else {</span>
<span class="udiff-line-modified-added">+                 stage = 0;</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         } else {</span>
<span class="udiff-line-modified-added">+             stage = 0;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         // decrease the number of nodes.</span>
<span class="udiff-line-modified-added">+         num_of_nodes--;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method returns the successor of the node n in the tree.</span>
<span class="udiff-line-modified-added">+     private Node Tree_Successor(Node n) {</span>
<span class="udiff-line-modified-added">+         Node n1;</span>
<span class="udiff-line-modified-added">+         if (n.getNode(Node.Right_son) != treeNull) {</span>
<span class="udiff-line-modified-added">+             n = n.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-added">+             while (n.getNode(Node.Left_son) != treeNull) {</span>
<span class="udiff-line-modified-added">+                 n = n.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             return n;</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         n1 = n.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+         while ((n1 != treeNull) &amp;&amp; (n == n1.getNode(Node.Right_son))) {</span>
<span class="udiff-line-modified-added">+             n = n1;</span>
<span class="udiff-line-modified-added">+             n1 = n1.getNode(Node.Parent);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         return n1;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method performs Left Rotation with n1.</span>
<span class="udiff-line-modified-added">+     private void Left_Rotate(Node n1) {</span>
<span class="udiff-line-modified-added">+         Node n2;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         n2 = n1.getNode(Node.Right_son);</span>
<span class="udiff-line-modified-added">+         n1.setNode(Node.Right_son, n2.getNode(Node.Left_son));</span>
<span class="udiff-line-modified-added">+         if (n2.getNode(Node.Left_son) != treeNull) {</span>
<span class="udiff-line-modified-added">+             n2.getNode(Node.Left_son).setNode(Node.Parent, n1);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         n2.setNode(Node.Parent, n1.getNode(Node.Parent));</span>
<span class="udiff-line-modified-added">+         if (n1.getNode(Node.Parent) == treeNull) {</span>
<span class="udiff-line-modified-added">+             root = n2;</span>
<span class="udiff-line-modified-added">+         } else if (n1 == n1.getNode(Node.Parent).getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+             n1.getNode(Node.Parent).setNode(Node.Left_son, n2);</span>
<span class="udiff-line-modified-added">+         } else {</span>
<span class="udiff-line-modified-added">+             n1.getNode(Node.Parent).setNode(Node.Right_son, n2);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         n2.setNode(Node.Left_son, n1);</span>
<span class="udiff-line-modified-added">+         n1.setNode(Node.Parent, n2);</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     // This method performs Right Rotation with n1.</span>
<span class="udiff-line-modified-added">+     private void Right_Rotate(Node n1) {</span>
<span class="udiff-line-modified-added">+         Node n2;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         n2 = n1.getNode(Node.Left_son);</span>
<span class="udiff-line-modified-added">+         n1.setNode(Node.Left_son, n2.getNode(Node.Right_son));</span>
<span class="udiff-line-modified-added">+         if (n2.getNode(Node.Right_son) != treeNull) {</span>
<span class="udiff-line-modified-added">+             n2.getNode(Node.Right_son).setNode(Node.Parent, n1);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         n2.setNode(Node.Parent, n1.getNode(Node.Parent));</span>
<span class="udiff-line-modified-added">+         if (n1.getNode(Node.Parent) == treeNull) {</span>
<span class="udiff-line-modified-added">+             root = n2;</span>
<span class="udiff-line-modified-added">+         } else if (n1 == (n1.getNode(Node.Parent)).getNode(Node.Left_son)) {</span>
<span class="udiff-line-modified-added">+             n1.getNode(Node.Parent).setNode(Node.Left_son, n2);</span>
<span class="udiff-line-modified-added">+         } else {</span>
<span class="udiff-line-modified-added">+             n1.getNode(Node.Parent).setNode(Node.Right_son, n2);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-added">+         n2.setNode(Node.Right_son, n1);</span>
<span class="udiff-line-added">+         n1.setNode(Node.Parent, n2);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // This method searches the tree for a node with key &#39;key&#39;, and</span>
<span class="udiff-line-added">+     // returns the node on success otherwise treeNull.</span>
<span class="udiff-line-added">+     public Node Search(int key) {</span>
<span class="udiff-line-added">+         Node node;</span>
<span class="udiff-line-added">+         node = root;</span>
<span class="udiff-line-added">+         while ((node != treeNull) &amp;&amp; (key != node.getKey())) {</span>
<span class="udiff-line-added">+             if (key &lt; node.getKey()) {</span>
<span class="udiff-line-added">+                 node = node.getNode(Node.Left_son);</span>
<span class="udiff-line-added">+             } else {</span>
<span class="udiff-line-added">+                 node = node.getNode(Node.Right_son);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return node;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // This method updates the tree height. it uses a recursive method</span>
<span class="udiff-line-added">+     // findHeight.</span>
<span class="udiff-line-added">+     private void updateHeight() {</span>
<span class="udiff-line-added">+         height = 0;</span>
<span class="udiff-line-added">+         if (root != treeNull) {</span>
<span class="udiff-line-added">+             findHeight(root, 1);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // This is a recursive method that find a node height.</span>
<span class="udiff-line-added">+     private void findHeight(Node n, int curr) {</span>
<span class="udiff-line-added">+         if (height &lt; curr) {</span>
<span class="udiff-line-added">+             height = curr;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (n.getNode(Node.Left_son) != treeNull) {</span>
<span class="udiff-line-added">+             findHeight(n.getNode(Node.Left_son), curr + 1);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         if (n.getNode(Node.Right_son) != treeNull) {</span>
<span class="udiff-line-added">+             findHeight(n.getNode(Node.Right_son), curr + 1);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
  
  }
</pre>
<center><a href="Node.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="test1.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>