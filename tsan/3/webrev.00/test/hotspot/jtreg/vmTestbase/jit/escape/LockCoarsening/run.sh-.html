<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/hotspot/jtreg/vmTestbase/jit/escape/LockCoarsening/run.sh</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 #!/bin/sh
 2 #
 3 # Copyright (c) 2014, 2018, Oracle and/or its affiliates. All rights reserved.
 4 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 5 #
 6 # This code is free software; you can redistribute it and/or modify it
 7 # under the terms of the GNU General Public License version 2 only, as
 8 # published by the Free Software Foundation.
 9 #
10 # This code is distributed in the hope that it will be useful, but WITHOUT
11 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
12 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
13 # version 2 for more details (a copy is included in the LICENSE file that
14 # accompanied this code).
15 #
16 # You should have received a copy of the GNU General Public License version
17 # 2 along with this work; if not, write to the Free Software Foundation,
18 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
19 #
20 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
21 # or visit www.oracle.com if you need additional information or have any
22 # questions.
23 #
24 
25 EXECUTE_CLASS=jit.escape.LockCoarsening.LockCoarsening
26 JAVA=&quot;$TESTJAVA/bin/java&quot;
27 JAVA_OPTS=&quot;-cp $TESTCLASSPATH $TESTJAVAOPTS $TESTVMOPTS&quot;
28 
29 #
30 # Run the test in EA mode if -server and -Xcomp JVM options specified
31 # Set EliminateLocks commandline option to enable -XX:+EliminateLocks
32 #
33 
34 if [ &quot;$1&quot; = &quot;EliminateLocks&quot; ]; then
35     EA_OPTS=&quot;-XX:+DoEscapeAnalysis -XX:+EliminateLocks&quot;
36     TEST_ARGS=&quot;$TEST_ARGS -eliminateLocks&quot;
37 else
38     EA_OPTS=&quot;-XX:-DoEscapeAnalysis -XX:-EliminateLocks&quot;
39 fi
40 
41 # Additional VM options
42 ADD_OPTS=&quot;-XX:-TieredCompilation -XX:+IgnoreUnrecognizedVMOptions -XX:-DeoptimizeALot&quot;
43 
44 echo &quot;Check if EscapeAnalysis is supported&quot;
45 $JAVA $JAVA_OPTS $EA_OPTS -version
46 
47 if [ &quot;$?&quot; = 0 ]; then
48         echo &quot;EA options &#39;$EA_OPTS&#39; are supported&quot;
49 
50         b1=0
51         b2=0
52 
53         for param in $JAVA_OPTS; do
54                 case &quot;$param&quot; in
55                         -server )
56                                 b1=1
57                                 ;;
58                         -Xcomp )
59                                 b2=1
60                                 ;;
61                 esac
62         done
63 
64         if [ &quot;$b1$b2&quot; = 11 ]; then
65                 JAVA_OPTS=&quot;$JAVA_OPTS $ADD_OPTS $EA_OPTS&quot;
66                 echo &quot;Java options: $JAVA_OPTS&quot;
67 
68                 $JAVA $JAVA_OPTS $EXECUTE_CLASS $TEST_ARGS
69 
70                 exit $?
71         else
72                 echo &quot;JVM options &#39;-server -Xcomp&#39; not specified&quot;
73 
74                 exit 0
75         fi
76 fi
77 
78 echo &quot;EA not supported, passing test&quot;
79 
80 exit 0
    </pre>
  </body>
</html>