<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/runtime/LoaderConstraints/vtableLdrConstraint/Test.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../itableLdrConstraint/Test.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../MemberName/MemberNameLeak.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/LoaderConstraints/vtableLdrConstraint/Test.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
21  * questions.
22  */
23 
24 /*
25  * @test
26  * @bug 8186092 8199852
27  * @compile ../common/Foo.java
28  *          ../common/J.java
29  *          I.java
30  *          ../common/C.jasm
31  *          Task.java
32  *          ../common/PreemptingClassLoader.java
33  * @run main/othervm Test
34  */
35 
36 public class Test {
37 
38     // Break expected error messages into 3 parts since the loader name includes its identity
39     // hash which is unique and can&#39;t be compared against.
40     static String expectedErrorMessage1_part1 = &quot;loader constraint violation for class test.Task: when &quot; +
<span class="line-modified">41                                                 &quot;selecting overriding method test.Task.m()Ltest/Foo; the &quot; +</span>
42                                                 &quot;class loader PreemptingClassLoader @&quot;;
43     static String expectedErrorMessage1_part2 = &quot; of the selected method&#39;s type test.Task, and the class &quot; +
44                                                 &quot;loader &#39;app&#39; for its super type test.J have different Class objects &quot; +
45                                                 &quot;for the type test.Foo used in the signature (test.Task is in unnamed &quot; +
46                                                 &quot;module of loader PreemptingClassLoader @&quot;;
47     static String expectedErrorMessage1_part3 = &quot;, parent loader &#39;app&#39;; test.J is in unnamed module of loader &#39;app&#39;)&quot;;
48 
49     static String expectedErrorMessage2_part1 = &quot;loader constraint violation for class test.Task: when &quot; +
<span class="line-modified">50                                                 &quot;selecting overriding method test.Task.m()Ltest/Foo; the &quot; +</span>
51                                                 &quot;class loader &#39;VtableLdrCnstrnt_Test_Loader&#39; @&quot;;
52     static String expectedErrorMessage2_part2 = &quot; of the selected method&#39;s type test.Task, and the class &quot; +
53                                                 &quot;loader &#39;app&#39; for its super type test.J have different Class objects &quot; +
54                                                 &quot;for the type test.Foo used in the signature (test.Task is in unnamed &quot; +
55                                                 &quot;module of loader &#39;VtableLdrCnstrnt_Test_Loader&#39; @&quot;;
56     static String expectedErrorMessage2_part3 = &quot;, parent loader &#39;app&#39;; test.J is in unnamed module of loader &#39;app&#39;)&quot;;
57 
58     // Test that the error message is correct when a loader constraint error is
59     // detected during vtable creation.
60     //
61     // In this test, during vtable creation for class Task, method &quot;Task.m()LFoo;&quot;
62     // overrides &quot;J.m()LFoo;&quot;.  But, Task&#39;s class Foo and super type J&#39;s class Foo
63     // are different.  So, a LinkageError exception should be thrown because the
64     // loader constraint check will fail.
65     public static void test(String loaderName,
66                             String expectedErrorMessage_part1,
67                             String expectedErrorMessage_part2,
68                             String expectedErrorMessage_part3) throws Exception {
69         Class&lt;?&gt; c = test.Foo.class; // Forces standard class loader to load Foo.
70         String[] classNames = {&quot;test.Task&quot;, &quot;test.Foo&quot;, &quot;test.I&quot;};
</pre>
</td>
<td>
<hr />
<pre>
21  * questions.
22  */
23 
24 /*
25  * @test
26  * @bug 8186092 8199852
27  * @compile ../common/Foo.java
28  *          ../common/J.java
29  *          I.java
30  *          ../common/C.jasm
31  *          Task.java
32  *          ../common/PreemptingClassLoader.java
33  * @run main/othervm Test
34  */
35 
36 public class Test {
37 
38     // Break expected error messages into 3 parts since the loader name includes its identity
39     // hash which is unique and can&#39;t be compared against.
40     static String expectedErrorMessage1_part1 = &quot;loader constraint violation for class test.Task: when &quot; +
<span class="line-modified">41                                                 &quot;selecting overriding method &#39;test.Foo test.Task.m()&#39; the &quot; +</span>
42                                                 &quot;class loader PreemptingClassLoader @&quot;;
43     static String expectedErrorMessage1_part2 = &quot; of the selected method&#39;s type test.Task, and the class &quot; +
44                                                 &quot;loader &#39;app&#39; for its super type test.J have different Class objects &quot; +
45                                                 &quot;for the type test.Foo used in the signature (test.Task is in unnamed &quot; +
46                                                 &quot;module of loader PreemptingClassLoader @&quot;;
47     static String expectedErrorMessage1_part3 = &quot;, parent loader &#39;app&#39;; test.J is in unnamed module of loader &#39;app&#39;)&quot;;
48 
49     static String expectedErrorMessage2_part1 = &quot;loader constraint violation for class test.Task: when &quot; +
<span class="line-modified">50                                                 &quot;selecting overriding method &#39;test.Foo test.Task.m()&#39; the &quot; +</span>
51                                                 &quot;class loader &#39;VtableLdrCnstrnt_Test_Loader&#39; @&quot;;
52     static String expectedErrorMessage2_part2 = &quot; of the selected method&#39;s type test.Task, and the class &quot; +
53                                                 &quot;loader &#39;app&#39; for its super type test.J have different Class objects &quot; +
54                                                 &quot;for the type test.Foo used in the signature (test.Task is in unnamed &quot; +
55                                                 &quot;module of loader &#39;VtableLdrCnstrnt_Test_Loader&#39; @&quot;;
56     static String expectedErrorMessage2_part3 = &quot;, parent loader &#39;app&#39;; test.J is in unnamed module of loader &#39;app&#39;)&quot;;
57 
58     // Test that the error message is correct when a loader constraint error is
59     // detected during vtable creation.
60     //
61     // In this test, during vtable creation for class Task, method &quot;Task.m()LFoo;&quot;
62     // overrides &quot;J.m()LFoo;&quot;.  But, Task&#39;s class Foo and super type J&#39;s class Foo
63     // are different.  So, a LinkageError exception should be thrown because the
64     // loader constraint check will fail.
65     public static void test(String loaderName,
66                             String expectedErrorMessage_part1,
67                             String expectedErrorMessage_part2,
68                             String expectedErrorMessage_part3) throws Exception {
69         Class&lt;?&gt; c = test.Foo.class; // Forces standard class loader to load Foo.
70         String[] classNames = {&quot;test.Task&quot;, &quot;test.Foo&quot;, &quot;test.I&quot;};
</pre>
</td>
</tr>
</table>
<center><a href="../itableLdrConstraint/Test.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../MemberName/MemberNameLeak.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>