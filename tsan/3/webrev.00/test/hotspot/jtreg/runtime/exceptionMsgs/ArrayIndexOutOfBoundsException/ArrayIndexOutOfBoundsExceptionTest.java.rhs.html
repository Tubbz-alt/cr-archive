<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/hotspot/jtreg/runtime/exceptionMsgs/ArrayIndexOutOfBoundsException/ArrayIndexOutOfBoundsExceptionTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * Copyright (c) 2018, 2019 SAP SE. All rights reserved.
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * This code is free software; you can redistribute it and/or modify it
  7  * under the terms of the GNU General Public License version 2 only, as
  8  * published by the Free Software Foundation.
  9  *
 10  * This code is distributed in the hope that it will be useful, but WITHOUT
 11  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 12  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 13  * version 2 for more details (a copy is included in the LICENSE file that
 14  * accompanied this code).
 15  *
 16  * You should have received a copy of the GNU General Public License version
 17  * 2 along with this work; if not, write to the Free Software Foundation,
 18  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19  *
 20  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21  * or visit www.oracle.com if you need additional information or have any
 22  * questions.
 23  */
 24 
 25 /**
 26  * @test
 27  * @summary Test extended ArrayIndexOutOfBoundsException message. The
 28  *   message lists information about the array and the indexes involved.
<a name="1" id="anc1"></a><span class="line-modified"> 29  * @comment This will run in &#39;normal&#39; mode when Graal is not enabled, else</span>
<span class="line-added"> 30  *   Graal mode.</span>
 31  * @run testng ArrayIndexOutOfBoundsExceptionTest
<a name="2" id="anc2"></a><span class="line-added"> 32  */</span>
<span class="line-added"> 33 /**</span>
<span class="line-added"> 34  * @test</span>
<span class="line-added"> 35  * @requires !vm.graal.enabled</span>
<span class="line-added"> 36  * @comment These test C1 and C2 so make no sense when Graal is enabled.</span>
 37  * @run testng/othervm -Xcomp -XX:-TieredCompilation  ArrayIndexOutOfBoundsExceptionTest
 38  * @run testng/othervm -Xcomp -XX:TieredStopAtLevel=1 ArrayIndexOutOfBoundsExceptionTest
 39  */
 40 
 41 import java.io.ByteArrayInputStream;
 42 import java.io.ByteArrayOutputStream;
 43 import java.io.ObjectInputStream;
 44 import java.io.ObjectOutputStream;
 45 import java.util.ArrayList;
 46 
 47 import org.testng.annotations.Test;
 48 
 49 import static org.testng.Assert.assertEquals;
 50 import static org.testng.Assert.assertNull;
 51 import static org.testng.Assert.assertNotNull;
 52 import static org.testng.Assert.assertTrue;
 53 import static org.testng.Assert.fail;
 54 
 55 /**
 56  * Tests the detailed messages of the ArrayIndexOutOfBoundsException.
 57  */
 58 public class ArrayIndexOutOfBoundsExceptionTest {
 59 
 60     static {
 61         System.loadLibrary(&quot;ArrayIndexOutOfBoundsExceptionTest&quot;);
 62     }
 63 
 64     // Some fields used in the test.
 65     static int[] staticArray = new int[0];
 66     static long[][] staticLongArray = new long[0][0];
 67     ArrayList&lt;String&gt; names = new ArrayList&lt;&gt;();
 68     ArrayList&lt;String&gt; curr;
 69 
 70     public static void main(String[] args) {
 71         ArrayIndexOutOfBoundsExceptionTest t = new ArrayIndexOutOfBoundsExceptionTest();
 72         try {
 73             t.testAIOOBMessages();
 74         } catch (Exception e) {}
 75     }
 76 
 77     /**
 78      *
 79      */
 80     public static class ArrayGenerator {
 81 
 82         /**
 83          * @param dummy1
 84          * @return Object Array
 85          */
 86         public static Object[] arrayReturner(boolean dummy1) {
 87             return new Object[0];
 88         }
 89 
 90         /**
 91          * @param dummy1
 92          * @param dummy2
 93          * @param dummy3
 94          * @return Object Array
 95          */
 96         public Object[] returnMyArray(double dummy1, long dummy2, short dummy3) {
 97             return new Object[0];
 98         }
 99     }
100 
101     static native void  doNativeArrayStore(Object[] dst, Object element, int index);
102     static native Object doNativeArrayLoad(Object[] src, int index);
103 
104     static native void doNativeBooleanArrayRegionLoad (boolean[] source, int start, int len);
105     static native void doNativeBooleanArrayRegionStore(boolean[] source, int start, int len);
106     static native void doNativeByteArrayRegionLoad    (byte[] source,    int start, int len);
107     static native void doNativeByteArrayRegionStore   (byte[] source,    int start, int len);
108     static native void doNativeShortArrayRegionLoad   (short[] source,   int start, int len);
109     static native void doNativeShortArrayRegionStore  (short[] source,   int start, int len);
110     static native void doNativeCharArrayRegionLoad    (char[] source,    int start, int len);
111     static native void doNativeCharArrayRegionStore   (char[] source,    int start, int len);
112     static native void doNativeIntArrayRegionLoad     (int[] source,     int start, int len);
113     static native void doNativeIntArrayRegionStore    (int[] source,     int start, int len);
114     static native void doNativeLongArrayRegionLoad    (long[] source,    int start, int len);
115     static native void doNativeLongArrayRegionStore   (long[] source,    int start, int len);
116     static native void doNativeFloatArrayRegionLoad   (float[] source,   int start, int len);
117     static native void doNativeFloatArrayRegionStore  (float[] source,   int start, int len);
118     static native void doNativeDoubleArrayRegionLoad  (double[] source,  int start, int len);
119     static native void doNativeDoubleArrayRegionStore (double[] source,  int start, int len);
120 
121     /**
122      *
123      */
124     @Test
125     public void testAIOOBMessages() {
126         boolean[] za1 = new boolean[0];
127         byte[]    ba1 = new byte[0];
128         short[]   sa1 = new short[0];
129         char[]    ca1 = new char[0];
130         int[]     ia1 = new int[0];
131         long[]    la1 = new long[0];
132         float[]   fa1 = new float[0];
133         double[]  da1 = new double[0];
134         Object[]  oa1 = new Object[10];
135         Object[]  oa2 = new Object[5];
136 
137         boolean[] za2 = new boolean[10];
138         boolean[] za3 = new boolean[5];
139         byte[]    ba2 = new byte[10];
140         byte[]    ba3 = new byte[5];
141         short[]   sa2 = new short[10];
142         short[]   sa3 = new short[5];
143         char[]    ca2 = new char[10];
144         char[]    ca3 = new char[5];
145         int[]     ia2 = new int[10];
146         int[]     ia3 = new int[5];
147         long[]    la2 = new long[10];
148         long[]    la3 = new long[5];
149         float[]   fa2 = new float[10];
150         float[]   fa3 = new float[5];
151         double[]  da2 = new double[10];
152         double[]  da3 = new double[5];
153 
154         try {
155             System.out.println(za1[-5]);
156             fail();
157         }
158         catch (ArrayIndexOutOfBoundsException e) {
159             assertEquals(e.getMessage(),
160                 &quot;Index -5 out of bounds for length 0&quot;);
161         }
162 
163         try {
164             System.out.println(ba1[0]);
165             fail();
166         }
167         catch (ArrayIndexOutOfBoundsException e) {
168             assertEquals(e.getMessage(),
169                 &quot;Index 0 out of bounds for length 0&quot;);
170         }
171 
172         try {
173             System.out.println(sa1[0]);
174             fail();
175         }
176         catch (ArrayIndexOutOfBoundsException e) {
177             assertEquals(e.getMessage(),
178                 &quot;Index 0 out of bounds for length 0&quot;);
179         }
180 
181         try {
182             System.out.println(ca1[0]);
183             fail();
184         }
185         catch (ArrayIndexOutOfBoundsException e) {
186             assertEquals(e.getMessage(),
187                 &quot;Index 0 out of bounds for length 0&quot;);
188         }
189 
190         try {
191             System.out.println(ia1[0]);
192             fail();
193         }
194         catch (ArrayIndexOutOfBoundsException e) {
195             assertEquals(e.getMessage(),
196                 &quot;Index 0 out of bounds for length 0&quot;);
197         }
198 
199         try {
200             System.out.println(la1[0]);
201             fail();
202         }
203         catch (ArrayIndexOutOfBoundsException e) {
204             assertEquals(e.getMessage(),
205                 &quot;Index 0 out of bounds for length 0&quot;);
206         }
207 
208         try {
209             System.out.println(fa1[0]);
210             fail();
211         }
212         catch (ArrayIndexOutOfBoundsException e) {
213             assertEquals(e.getMessage(),
214                 &quot;Index 0 out of bounds for length 0&quot;);
215         }
216 
217         try {
218             System.out.println(da1[0]);
219             fail();
220         }
221         catch (ArrayIndexOutOfBoundsException e) {
222             assertEquals(e.getMessage(),
223                 &quot;Index 0 out of bounds for length 0&quot;);
224         }
225 
226         try {
227             System.out.println(oa1[12]);
228             fail();
229         }
230         catch (ArrayIndexOutOfBoundsException e) {
231             assertEquals(e.getMessage(),
232                 &quot;Index 12 out of bounds for length 10&quot;);
233         }
234 
235         try {
236             System.out.println(za1[0] = false);
237             fail();
238         }
239         catch (ArrayIndexOutOfBoundsException e) {
240             assertEquals(e.getMessage(),
241                 &quot;Index 0 out of bounds for length 0&quot;);
242         }
243 
244         try {
245             System.out.println(ba1[0] = 0);
246             fail();
247         }
248         catch (ArrayIndexOutOfBoundsException e) {
249             assertEquals(e.getMessage(),
250                 &quot;Index 0 out of bounds for length 0&quot;);
251         }
252 
253         try {
254             System.out.println(sa1[0] = 0);
255             fail();
256         }
257         catch (ArrayIndexOutOfBoundsException e) {
258             assertEquals(e.getMessage(),
259                 &quot;Index 0 out of bounds for length 0&quot;);
260         }
261 
262         try {
263             System.out.println(ca1[0] = 0);
264             fail();
265         }
266         catch (ArrayIndexOutOfBoundsException e) {
267             assertEquals(e.getMessage(),
268                 &quot;Index 0 out of bounds for length 0&quot;);
269         }
270 
271         try {
272             System.out.println(ia1[0] = 0);
273             fail();
274         }
275         catch (ArrayIndexOutOfBoundsException e) {
276             assertEquals(e.getMessage(),
277                 &quot;Index 0 out of bounds for length 0&quot;);
278         }
279 
280         try {
281             System.out.println(la1[0] = 0);
282             fail();
283         }
284         catch (ArrayIndexOutOfBoundsException e) {
285             assertEquals(e.getMessage(),
286                 &quot;Index 0 out of bounds for length 0&quot;);
287         }
288 
289         try {
290             System.out.println(fa1[0] = 0);
291             fail();
292         }
293         catch (ArrayIndexOutOfBoundsException e) {
294             assertEquals(e.getMessage(),
295                 &quot;Index 0 out of bounds for length 0&quot;);
296         }
297 
298         try {
299             System.out.println(da1[0] = 0);
300             fail();
301         }
302         catch (ArrayIndexOutOfBoundsException e) {
303             assertEquals(e.getMessage(),
304                 &quot;Index 0 out of bounds for length 0&quot;);
305         }
306 
307         try {
308             System.out.println(oa1[-2] = null);
309             fail();
310         }
311         catch (ArrayIndexOutOfBoundsException e) {
312             assertEquals(e.getMessage(),
313                 &quot;Index -2 out of bounds for length 10&quot;);
314         }
315 
316         try {
317             assertTrue((ArrayGenerator.arrayReturner(false))[0] == null);
318             fail();
319         } catch (ArrayIndexOutOfBoundsException e) {
320             assertEquals(e.getMessage(),
321                 &quot;Index 0 out of bounds for length 0&quot;);
322         }
323         try {
324             staticArray[0] = 2;
325             fail();
326         } catch (ArrayIndexOutOfBoundsException e) {
327             assertEquals(e.getMessage(),
328                 &quot;Index 0 out of bounds for length 0&quot;);
329         }
330 
331         // Test all five possible messages of arraycopy exceptions thrown in ObjArrayKlass::copy_array().
332 
333         try {
334             System.arraycopy(oa1, -17, oa2, 0, 5);
335             fail();
336         } catch (ArrayIndexOutOfBoundsException e) {
337             assertEquals(e.getMessage(),
338                 &quot;arraycopy: source index -17 out of bounds for object array[10]&quot;);
339         }
340 
341         try {
342             System.arraycopy(oa1, 2, oa2, -18, 5);
343             fail();
344         } catch (ArrayIndexOutOfBoundsException e) {
345             assertEquals(e.getMessage(),
346                 &quot;arraycopy: destination index -18 out of bounds for object array[5]&quot;);
347         }
348 
349         try {
350             System.arraycopy(oa1, 2, oa2, 0, -19);
351             fail();
352         } catch (ArrayIndexOutOfBoundsException e) {
353             assertEquals(e.getMessage(),
354                 &quot;arraycopy: length -19 is negative&quot;);
355         }
356 
357         try {
358             System.arraycopy(oa1, 8, oa2, 0, 5);
359             fail();
360         } catch (ArrayIndexOutOfBoundsException e) {
361             assertEquals(e.getMessage(),
362                 &quot;arraycopy: last source index 13 out of bounds for object array[10]&quot;);
363         }
364 
365         try {
366             System.arraycopy(oa1, 1, oa2, 0, 7);
367             fail();
368         } catch (ArrayIndexOutOfBoundsException e) {
369             assertEquals(e.getMessage(),
370                 &quot;arraycopy: last destination index 7 out of bounds for object array[5]&quot;);
371         }
372 
373         // Test all five possible messages of arraycopy exceptions thrown in TypeArrayKlass::copy_array().
374 
375         try {
376             System.arraycopy(da2, -17, da3, 0, 5);
377             fail();
378         } catch (ArrayIndexOutOfBoundsException e) {
379             assertEquals(e.getMessage(),
380                 &quot;arraycopy: source index -17 out of bounds for double[10]&quot;);
381         }
382 
383         try {
384             System.arraycopy(da2, 2, da3, -18, 5);
385             fail();
386         } catch (ArrayIndexOutOfBoundsException e) {
387             assertEquals(e.getMessage(),
388                 &quot;arraycopy: destination index -18 out of bounds for double[5]&quot;);
389         }
390 
391         try {
392             System.arraycopy(da2, 2, da3, 0, -19);
393             fail();
394         } catch (ArrayIndexOutOfBoundsException e) {
395             assertEquals(e.getMessage(),
396                 &quot;arraycopy: length -19 is negative&quot;);
397         }
398 
399         try {
400             System.arraycopy(da2, 8, da3, 0, 5);
401             fail();
402         } catch (ArrayIndexOutOfBoundsException e) {
403             assertEquals(e.getMessage(),
404                 &quot;arraycopy: last source index 13 out of bounds for double[10]&quot;);
405         }
406 
407         try {
408             System.arraycopy(da2, 1, da3, 0, 7);
409             fail();
410         } catch (ArrayIndexOutOfBoundsException e) {
411             assertEquals(e.getMessage(),
412                 &quot;arraycopy: last destination index 7 out of bounds for double[5]&quot;);
413         }
414 
415         // Test all possible basic types in the messages of arraycopy exceptions thrown in TypeArrayKlass::copy_array().
416 
417         try {
418             System.arraycopy(za2, -17, za3, 0, 5);
419             fail();
420         } catch (ArrayIndexOutOfBoundsException e) {
421             assertEquals(e.getMessage(),
422                 &quot;arraycopy: source index -17 out of bounds for boolean[10]&quot;);
423         }
424 
425         try {
426             System.arraycopy(ba2, 2, ba3, -18, 5);
427             fail();
428         } catch (ArrayIndexOutOfBoundsException e) {
429             assertEquals(e.getMessage(),
430                 &quot;arraycopy: destination index -18 out of bounds for byte[5]&quot;);
431         }
432 
433         try {
434             System.arraycopy(sa2, 2, sa3, 0, -19);
435             fail();
436         } catch (ArrayIndexOutOfBoundsException e) {
437             assertEquals(e.getMessage(),
438                 &quot;arraycopy: length -19 is negative&quot;);
439         }
440 
441         try {
442             System.arraycopy(ca2, 8, ca3, 0, 5);
443             fail();
444         } catch (ArrayIndexOutOfBoundsException e) {
445             assertEquals(e.getMessage(),
446                 &quot;arraycopy: last source index 13 out of bounds for char[10]&quot;);
447         }
448 
449         try {
450             System.arraycopy(ia2, 2, ia3, 0, -19);
451             fail();
452         } catch (ArrayIndexOutOfBoundsException e) {
453             assertEquals(e.getMessage(),
454                 &quot;arraycopy: length -19 is negative&quot;);
455         }
456 
457         try {
458             System.arraycopy(la2, 1, la3, 0, 7);
459             fail();
460         } catch (ArrayIndexOutOfBoundsException e) {
461             assertEquals(e.getMessage(),
462                 &quot;arraycopy: last destination index 7 out of bounds for long[5]&quot;);
463         }
464 
465         try {
466             System.arraycopy(fa2, 1, fa3, 0, 7);
467             fail();
468         } catch (ArrayIndexOutOfBoundsException e) {
469             assertEquals(e.getMessage(),
470                 &quot;arraycopy: last destination index 7 out of bounds for float[5]&quot;);
471         }
472 
473 
474         // Test native array access.
475 
476 
477         try {
478             System.out.println(doNativeArrayLoad(oa2, 77));
479             fail();
480         } catch (ArrayIndexOutOfBoundsException e) {
481             assertEquals(e.getMessage(),
482                 &quot;Index 77 out of bounds for length 5&quot;);
483         }
484         try {
485             System.out.println(doNativeArrayLoad(oa1, -1));
486             fail();
487         } catch (ArrayIndexOutOfBoundsException e) {
488             assertEquals(e.getMessage(),
489                 &quot;Index -1 out of bounds for length 10&quot;);
490         }
491 
492         try {
493             doNativeArrayStore(oa1, &quot;Some String&quot;, Integer.MIN_VALUE);
494             fail();
495         } catch (ArrayIndexOutOfBoundsException e) {
496             assertEquals(e.getMessage(),
497                 &quot;Index -2147483648 out of bounds for length 10&quot;);
498         }
499         try {
500             doNativeArrayStore(oa1, &quot;Some String&quot;, 13);
501             fail();
502         } catch (ArrayIndexOutOfBoundsException e) {
503             assertEquals(e.getMessage(),
504                 &quot;Index 13 out of bounds for length 10&quot;);
505         }
506 
507         // Boolean
508 
509         // Native array region loads.
510         // Boolean, len negative.
511         try {
512             doNativeBooleanArrayRegionLoad(za2, 3, -77);
513             fail();
514         } catch (ArrayIndexOutOfBoundsException e) {
515             assertEquals(e.getMessage(),
516                 &quot;Length -77 is negative&quot;);
517         }
518         // Boolean, index negative.
519         try {
520             doNativeBooleanArrayRegionLoad(za2, -3, 3);
521             fail();
522         } catch (ArrayIndexOutOfBoundsException e) {
523             assertEquals(e.getMessage(),
524                 &quot;Array region -3..0 out of bounds for length 10&quot;);
525         }
526         // Boolean, index+len too big.
527         try {
528             doNativeBooleanArrayRegionLoad(za2, 3, Integer.MAX_VALUE-1);
529             fail();
530         } catch (ArrayIndexOutOfBoundsException e) {
531             assertEquals(e.getMessage(),
532                 &quot;Array region 3..2147483649 out of bounds for length 10&quot;);
533         }
534         // Native array region stores
535         // Boolean, len negative.
536         try {
537             doNativeBooleanArrayRegionStore(za2, 3, -77);
538             fail();
539         } catch (ArrayIndexOutOfBoundsException e) {
540             assertEquals(e.getMessage(),
541                 &quot;Length -77 is negative&quot;);
542         }
543         // Boolean, index negative.
544         try {
545             doNativeBooleanArrayRegionStore(za2, -3, 3);
546             fail();
547         } catch (ArrayIndexOutOfBoundsException e) {
548             assertEquals(e.getMessage(),
549                 &quot;Array region -3..0 out of bounds for length 10&quot;);
550         }
551         // Boolean, index+len too big.
552         try {
553             doNativeBooleanArrayRegionStore(za2, 3, Integer.MAX_VALUE);
554             fail();
555         } catch (ArrayIndexOutOfBoundsException e) {
556             assertEquals(e.getMessage(),
557                 &quot;Array region 3..2147483650 out of bounds for length 10&quot;);
558         }
559 
560         // Byte
561 
562         // Native array region loads.
563         // Byte, len negative.
564         try {
565             doNativeByteArrayRegionLoad(ba1, 3, -77);
566             fail();
567         } catch (ArrayIndexOutOfBoundsException e) {
568             assertEquals(e.getMessage(),
569                 &quot;Length -77 is negative&quot;);
570         }
571         // Byte, index negative.
572         try {
573             doNativeByteArrayRegionLoad(ba1, -3, 3);
574             fail();
575         } catch (ArrayIndexOutOfBoundsException e) {
576             assertEquals(e.getMessage(),
577                 &quot;Array region -3..0 out of bounds for length 0&quot;);
578         }
579         // Byte, index+len too big.
580         try {
581             doNativeByteArrayRegionLoad(ba2, 3, Integer.MAX_VALUE-1);
582             fail();
583         } catch (ArrayIndexOutOfBoundsException e) {
584             assertEquals(e.getMessage(),
585                 &quot;Array region 3..2147483649 out of bounds for length 10&quot;);
586         }
587         // Native array region stores
588         // Byte, len negative.
589         try {
590             doNativeByteArrayRegionStore(ba2, 3, -77);
591             fail();
592         } catch (ArrayIndexOutOfBoundsException e) {
593             assertEquals(e.getMessage(),
594                 &quot;Length -77 is negative&quot;);
595         }
596         // Byte, index negative.
597         try {
598             doNativeByteArrayRegionStore(ba2, -3, 3);
599             fail();
600         } catch (ArrayIndexOutOfBoundsException e) {
601             assertEquals(e.getMessage(),
602                 &quot;Array region -3..0 out of bounds for length 10&quot;);
603         }
604         // Byte, index+len too big.
605         try {
606             doNativeByteArrayRegionStore(ba2, 3, Integer.MAX_VALUE);
607             fail();
608         } catch (ArrayIndexOutOfBoundsException e) {
609             assertEquals(e.getMessage(),
610                 &quot;Array region 3..2147483650 out of bounds for length 10&quot;);
611         }
612 
613         // Short
614 
615         // Native array region loads.
616         // Short, len negative.
617         try {
618             doNativeShortArrayRegionLoad(sa2, 3, -77);
619             fail();
620         } catch (ArrayIndexOutOfBoundsException e) {
621             assertEquals(e.getMessage(),
622                 &quot;Length -77 is negative&quot;);
623         }
624         // Short, index negative.
625         try {
626             doNativeShortArrayRegionLoad(sa2, -3, 3);
627             fail();
628         } catch (ArrayIndexOutOfBoundsException e) {
629             assertEquals(e.getMessage(),
630                 &quot;Array region -3..0 out of bounds for length 10&quot;);
631         }
632         // Short, index+len too big.
633         try {
634             doNativeShortArrayRegionLoad(sa2, 3, Integer.MAX_VALUE-1);
635             fail();
636         } catch (ArrayIndexOutOfBoundsException e) {
637             assertEquals(e.getMessage(),
638                 &quot;Array region 3..2147483649 out of bounds for length 10&quot;);
639         }
640         // Native array region stores
641         // Short, len negative.
642         try {
643             doNativeShortArrayRegionStore(sa2, 3, -77);
644             fail();
645         } catch (ArrayIndexOutOfBoundsException e) {
646             assertEquals(e.getMessage(),
647                 &quot;Length -77 is negative&quot;);
648         }
649         // Short, index negative.
650         try {
651             doNativeShortArrayRegionStore(sa2, -3, 3);
652             fail();
653         } catch (ArrayIndexOutOfBoundsException e) {
654             assertEquals(e.getMessage(),
655                 &quot;Array region -3..0 out of bounds for length 10&quot;);
656         }
657         // Short, index+len too big.
658         try {
659             doNativeShortArrayRegionStore(sa2, 3, Integer.MAX_VALUE);
660             fail();
661         } catch (ArrayIndexOutOfBoundsException e) {
662             assertEquals(e.getMessage(),
663                 &quot;Array region 3..2147483650 out of bounds for length 10&quot;);
664         }
665 
666         // Char
667 
668         // Native array region loads.
669         // Char, len negative.
670         try {
671             doNativeCharArrayRegionLoad(ca2, 3, -77);
672             fail();
673         } catch (ArrayIndexOutOfBoundsException e) {
674             assertEquals(e.getMessage(),
675                 &quot;Length -77 is negative&quot;);
676         }
677         // Char, index negative.
678         try {
679             doNativeCharArrayRegionLoad(ca2, -3, 3);
680             fail();
681         } catch (ArrayIndexOutOfBoundsException e) {
682             assertEquals(e.getMessage(),
683                 &quot;Array region -3..0 out of bounds for length 10&quot;);
684         }
685         // Char, index+len too big.
686         try {
687             doNativeCharArrayRegionLoad(ca2, 3, Integer.MAX_VALUE-1);
688             fail();
689         } catch (ArrayIndexOutOfBoundsException e) {
690             assertEquals(e.getMessage(),
691                 &quot;Array region 3..2147483649 out of bounds for length 10&quot;);
692         }
693         // Native array region stores
694         // Char, len negative.
695         try {
696             doNativeCharArrayRegionStore(ca2, 3, -77);
697             fail();
698         } catch (ArrayIndexOutOfBoundsException e) {
699             assertEquals(e.getMessage(),
700                 &quot;Length -77 is negative&quot;);
701         }
702         // Char, index negative.
703         try {
704             doNativeCharArrayRegionStore(ca2, -3, 3);
705             fail();
706         } catch (ArrayIndexOutOfBoundsException e) {
707             assertEquals(e.getMessage(),
708                 &quot;Array region -3..0 out of bounds for length 10&quot;);
709         }
710         // Char, index+len too big.
711         try {
712             doNativeCharArrayRegionStore(ca2, 3, Integer.MAX_VALUE);
713             fail();
714         } catch (ArrayIndexOutOfBoundsException e) {
715             assertEquals(e.getMessage(),
716                 &quot;Array region 3..2147483650 out of bounds for length 10&quot;);
717         }
718 
719         // Int
720 
721         // Native array region loads.
722         // Int, len negative.
723         try {
724             doNativeIntArrayRegionLoad(ia2, 3, -77);
725             fail();
726         } catch (ArrayIndexOutOfBoundsException e) {
727             assertEquals(e.getMessage(),
728                 &quot;Length -77 is negative&quot;);
729         }
730         // Int, index negative.
731         try {
732             doNativeIntArrayRegionLoad(ia2, -3, 3);
733             fail();
734         } catch (ArrayIndexOutOfBoundsException e) {
735             assertEquals(e.getMessage(),
736                 &quot;Array region -3..0 out of bounds for length 10&quot;);
737         }
738         // Int, index+len too big.
739         try {
740             doNativeIntArrayRegionLoad(ia2, 3, Integer.MAX_VALUE-1);
741             fail();
742         } catch (ArrayIndexOutOfBoundsException e) {
743             assertEquals(e.getMessage(),
744                 &quot;Array region 3..2147483649 out of bounds for length 10&quot;);
745         }
746         // Native array region stores
747         // Int, len negative.
748         try {
749             doNativeIntArrayRegionStore(ia2, 3, -77);
750             fail();
751         } catch (ArrayIndexOutOfBoundsException e) {
752             assertEquals(e.getMessage(),
753                 &quot;Length -77 is negative&quot;);
754         }
755         // Int, index negative.
756         try {
757             doNativeIntArrayRegionStore(ia2, -3, 3);
758             fail();
759         } catch (ArrayIndexOutOfBoundsException e) {
760             assertEquals(e.getMessage(),
761                 &quot;Array region -3..0 out of bounds for length 10&quot;);
762         }
763         // Int, index+len too big.
764         try {
765             doNativeIntArrayRegionStore(ia2, 3, Integer.MAX_VALUE);
766             fail();
767         } catch (ArrayIndexOutOfBoundsException e) {
768             assertEquals(e.getMessage(),
769                 &quot;Array region 3..2147483650 out of bounds for length 10&quot;);
770         }
771 
772         // Long
773 
774         // Native array region loads.
775         // Long, len negative.
776         try {
777             doNativeLongArrayRegionLoad(la2, 3, -77);
778             fail();
779         } catch (ArrayIndexOutOfBoundsException e) {
780             assertEquals(e.getMessage(),
781                 &quot;Length -77 is negative&quot;);
782         }
783         // Long, index negative.
784         try {
785             doNativeLongArrayRegionLoad(la2, -3, 3);
786             fail();
787         } catch (ArrayIndexOutOfBoundsException e) {
788             assertEquals(e.getMessage(),
789                 &quot;Array region -3..0 out of bounds for length 10&quot;);
790         }
791         // Long, index+len too big.
792         try {
793             doNativeLongArrayRegionLoad(la2, 3, Integer.MAX_VALUE-1);
794             fail();
795         } catch (ArrayIndexOutOfBoundsException e) {
796             assertEquals(e.getMessage(),
797                 &quot;Array region 3..2147483649 out of bounds for length 10&quot;);
798         }
799         // Native array region stores
800         // Long, len negative.
801         try {
802             doNativeLongArrayRegionStore(la2, 3, -77);
803             fail();
804         } catch (ArrayIndexOutOfBoundsException e) {
805             assertEquals(e.getMessage(),
806                 &quot;Length -77 is negative&quot;);
807         }
808         // Long, index negative.
809         try {
810             doNativeLongArrayRegionStore(la2, -3, 3);
811             fail();
812         } catch (ArrayIndexOutOfBoundsException e) {
813             assertEquals(e.getMessage(),
814                 &quot;Array region -3..0 out of bounds for length 10&quot;);
815         }
816         // Long, index+len too big.
817         try {
818             doNativeLongArrayRegionStore(la2, 3, Integer.MAX_VALUE);
819             fail();
820         } catch (ArrayIndexOutOfBoundsException e) {
821             assertEquals(e.getMessage(),
822                 &quot;Array region 3..2147483650 out of bounds for length 10&quot;);
823         }
824 
825         // Float
826 
827         // Native array region loads.
828         // Float, len negative.
829         try {
830             doNativeFloatArrayRegionLoad(fa2, 3, -77);
831             fail();
832         } catch (ArrayIndexOutOfBoundsException e) {
833             assertEquals(e.getMessage(),
834                 &quot;Length -77 is negative&quot;);
835         }
836         // Float, index negative.
837         try {
838             doNativeFloatArrayRegionLoad(fa2, -3, 3);
839             fail();
840         } catch (ArrayIndexOutOfBoundsException e) {
841             assertEquals(e.getMessage(),
842                 &quot;Array region -3..0 out of bounds for length 10&quot;);
843         }
844         // Float, index+len too big.
845         try {
846             doNativeFloatArrayRegionLoad(fa2, 3, Integer.MAX_VALUE-1);
847             fail();
848         } catch (ArrayIndexOutOfBoundsException e) {
849             assertEquals(e.getMessage(),
850                 &quot;Array region 3..2147483649 out of bounds for length 10&quot;);
851         }
852         // Native array region stores
853         // Float, len negative.
854         try {
855             doNativeFloatArrayRegionStore(fa2, 3, -77);
856             fail();
857         } catch (ArrayIndexOutOfBoundsException e) {
858             assertEquals(e.getMessage(),
859                 &quot;Length -77 is negative&quot;);
860         }
861         // Float, index negative.
862         try {
863             doNativeFloatArrayRegionStore(fa2, -3, 3);
864             fail();
865         } catch (ArrayIndexOutOfBoundsException e) {
866             assertEquals(e.getMessage(),
867                 &quot;Array region -3..0 out of bounds for length 10&quot;);
868         }
869         // Float, index+len too big.
870         try {
871             doNativeFloatArrayRegionStore(fa2, 3, Integer.MAX_VALUE);
872             fail();
873         } catch (ArrayIndexOutOfBoundsException e) {
874             assertEquals(e.getMessage(),
875                 &quot;Array region 3..2147483650 out of bounds for length 10&quot;);
876         }
877 
878         // Double
879 
880         // Native array region loads.
881         // Double, len negative.
882         try {
883             doNativeDoubleArrayRegionLoad(da2, 3, -77);
884             fail();
885         } catch (ArrayIndexOutOfBoundsException e) {
886             assertEquals(e.getMessage(),
887                 &quot;Length -77 is negative&quot;);
888         }
889         // Double, index negative.
890         try {
891             doNativeDoubleArrayRegionLoad(da2, -3, 3);
892             fail();
893         } catch (ArrayIndexOutOfBoundsException e) {
894             assertEquals(e.getMessage(),
895                 &quot;Array region -3..0 out of bounds for length 10&quot;);
896         }
897         // Double, index+len too big.
898         try {
899             doNativeDoubleArrayRegionLoad(da2, 3, Integer.MAX_VALUE-1);
900             fail();
901         } catch (ArrayIndexOutOfBoundsException e) {
902             assertEquals(e.getMessage(),
903                 &quot;Array region 3..2147483649 out of bounds for length 10&quot;);
904         }
905         // Native array region stores
906         // Double, len negative.
907         try {
908             doNativeDoubleArrayRegionStore(da2, 3, -77);
909             fail();
910         } catch (ArrayIndexOutOfBoundsException e) {
911             assertEquals(e.getMessage(),
912                 &quot;Length -77 is negative&quot;);
913         }
914         // Double, index negative.
915         try {
916             doNativeDoubleArrayRegionStore(da2, -3, 3);
917             fail();
918         } catch (ArrayIndexOutOfBoundsException e) {
919             assertEquals(e.getMessage(),
920                 &quot;Array region -3..0 out of bounds for length 10&quot;);
921         }
922         // Double, index+len too big.
923         try {
924             doNativeDoubleArrayRegionStore(da2, 3, Integer.MAX_VALUE);
925             fail();
926         } catch (ArrayIndexOutOfBoundsException e) {
927             assertEquals(e.getMessage(),
928                 &quot;Array region 3..2147483650 out of bounds for length 10&quot;);
929         }
930     }
931 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>