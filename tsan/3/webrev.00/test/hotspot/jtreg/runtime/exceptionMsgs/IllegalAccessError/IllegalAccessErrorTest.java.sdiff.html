<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/runtime/exceptionMsgs/IllegalAccessError/IllegalAccessErrorTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../ArrayIndexOutOfBoundsException/ArrayIndexOutOfBoundsExceptionTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../execstack/Test.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/exceptionMsgs/IllegalAccessError/IllegalAccessErrorTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
124         mv.visitInsn(RETURN);
125         mv.visitMaxs(0, 0);
126         mv.visitEnd();
127 
128         // run()
129         String tc = targetClass.replace(&quot;.&quot;, &quot;/&quot;);
130         mv = cw.visitMethod(ACC_PUBLIC, &quot;run&quot;, &quot;()V&quot;, null, null);
131         mv.visitMethodInsn(INVOKESTATIC, tc, targetMethod, &quot;()V&quot;, false);
132         mv.visitInsn(RETURN);
133         mv.visitMaxs(0, 0);
134         mv.visitEnd();
135 
136         cw.visitEnd();
137         return cw.toByteArray();
138     }
139 
140     // Private method that should raise IllegalAccessError when called.
141     private static void iae4_m() { }
142 
143     private static String expectedErrorMessage4 =
<span class="line-modified">144         &quot;class test.Runner4 tried to access private method test.IllegalAccessErrorTest.iae4_m()V &quot; +</span>
145         &quot;(test.Runner4 and test.IllegalAccessErrorTest are in unnamed module of loader &#39;app&#39;)&quot;;
146 
147     // Test according to java/lang/invoke/DefineClassTest.java
148     public static void test4_privateMethod() throws Exception {
149         final String THIS_PACKAGE = IllegalAccessErrorTest.class.getPackageName();
150         final String THIS_CLASS   = IllegalAccessErrorTest.class.getName();
151         final String CLASS_NAME   = THIS_PACKAGE + &quot;.Runner4&quot;;
152         Lookup lookup = lookup();
153 
154         // private
155         byte[] classBytes = iae4_generateRunner(CLASS_NAME, THIS_CLASS, &quot;iae4_m&quot;);
156         Class&lt;?&gt; clazz = lookup.defineClass(classBytes);
157         Runnable r = (Runnable) clazz.getDeclaredConstructor().newInstance();
158         try {
159             r.run();
160             throw new RuntimeException(&quot;Expected IllegalAccessError was not thrown.&quot;);
161         } catch (IllegalAccessError exc) {
162             String errorMsg = exc.getMessage();
163             if (!errorMsg.equals(expectedErrorMessage4)) {
164                 System.out.println(&quot;Expected: &quot; + expectedErrorMessage4 + &quot;\n&quot; +
</pre>
<hr />
<pre>
247         Class&lt;?&gt; cl = loader.loadClass(IAE6_B.class.getName());
248         Method m = cl.getDeclaredMethod(&quot;create&quot;, new Class[0]);
249         m.setAccessible(true);
250 
251         try {
252             m.invoke(null, new Object[0]);
253             throw new RuntimeException(&quot;Expected IllegalAccessError was not thrown.&quot;);
254         } catch (InvocationTargetException e) {
255             IllegalAccessError iae = (IllegalAccessError) e.getCause();
256             String errorMsg = iae.getMessage();
257             if (!errorMsg.contains(expectedErrorMessage6)) {
258                 System.out.println(&quot;Expected: &quot; + expectedErrorMessage6 + &quot;id)\n&quot; +
259                                    &quot;but got:  &quot; + errorMsg);
260                 throw new RuntimeException(&quot;Wrong error message of IllegalAccessError.&quot;);
261             }
262             System.out.println(&quot;Passed with message: &quot; + errorMsg);
263         }
264     }
265 
266     private static String expectedErrorMessage7_1 =
<span class="line-modified">267         &quot;class test.IAE78_B tried to access method test.IAE78_A.&lt;init&gt;()V &quot; +</span>
268         &quot;(test.IAE78_B is in unnamed module of loader &#39;test7_method_CL&#39; @&quot;;
269     private static String expectedErrorMessage7_2 =
270         &quot;; test.IAE78_A is in unnamed module of loader &#39;app&#39;)&quot;;
271 
272     // Similar to test4.
273     public static void test7_method() throws Exception {
274         ClassLoader base = IllegalAccessErrorTest.class.getClassLoader();
275         IAE_Loader2 loader = new IAE_Loader2(&quot;test7_method_CL&quot;, base.getParent(), base, new String[0],
276                 new String[] {IAE78_A.class.getName()});
277         Class&lt;?&gt; cl = loader.loadClass(IAE78_B.class.getName());
278         Method m = cl.getDeclaredMethod(&quot;create&quot;, new Class[0]);
279 
280         try {
281             m.invoke(null, new Object[0]);
282         } catch (InvocationTargetException e) {
283             IllegalAccessError iae = (IllegalAccessError) e.getCause();
284             String errorMsg = iae.getMessage();
285             if (!(errorMsg.contains(expectedErrorMessage7_1) &amp;&amp;
286                   errorMsg.contains(expectedErrorMessage7_2))) {
287                 System.out.println(&quot;Expected: &quot; + expectedErrorMessage7_1 + &quot;id&quot; + expectedErrorMessage7_2 + &quot;\n&quot; +
</pre>
</td>
<td>
<hr />
<pre>
124         mv.visitInsn(RETURN);
125         mv.visitMaxs(0, 0);
126         mv.visitEnd();
127 
128         // run()
129         String tc = targetClass.replace(&quot;.&quot;, &quot;/&quot;);
130         mv = cw.visitMethod(ACC_PUBLIC, &quot;run&quot;, &quot;()V&quot;, null, null);
131         mv.visitMethodInsn(INVOKESTATIC, tc, targetMethod, &quot;()V&quot;, false);
132         mv.visitInsn(RETURN);
133         mv.visitMaxs(0, 0);
134         mv.visitEnd();
135 
136         cw.visitEnd();
137         return cw.toByteArray();
138     }
139 
140     // Private method that should raise IllegalAccessError when called.
141     private static void iae4_m() { }
142 
143     private static String expectedErrorMessage4 =
<span class="line-modified">144         &quot;class test.Runner4 tried to access private method &#39;void test.IllegalAccessErrorTest.iae4_m()&#39; &quot; +</span>
145         &quot;(test.Runner4 and test.IllegalAccessErrorTest are in unnamed module of loader &#39;app&#39;)&quot;;
146 
147     // Test according to java/lang/invoke/DefineClassTest.java
148     public static void test4_privateMethod() throws Exception {
149         final String THIS_PACKAGE = IllegalAccessErrorTest.class.getPackageName();
150         final String THIS_CLASS   = IllegalAccessErrorTest.class.getName();
151         final String CLASS_NAME   = THIS_PACKAGE + &quot;.Runner4&quot;;
152         Lookup lookup = lookup();
153 
154         // private
155         byte[] classBytes = iae4_generateRunner(CLASS_NAME, THIS_CLASS, &quot;iae4_m&quot;);
156         Class&lt;?&gt; clazz = lookup.defineClass(classBytes);
157         Runnable r = (Runnable) clazz.getDeclaredConstructor().newInstance();
158         try {
159             r.run();
160             throw new RuntimeException(&quot;Expected IllegalAccessError was not thrown.&quot;);
161         } catch (IllegalAccessError exc) {
162             String errorMsg = exc.getMessage();
163             if (!errorMsg.equals(expectedErrorMessage4)) {
164                 System.out.println(&quot;Expected: &quot; + expectedErrorMessage4 + &quot;\n&quot; +
</pre>
<hr />
<pre>
247         Class&lt;?&gt; cl = loader.loadClass(IAE6_B.class.getName());
248         Method m = cl.getDeclaredMethod(&quot;create&quot;, new Class[0]);
249         m.setAccessible(true);
250 
251         try {
252             m.invoke(null, new Object[0]);
253             throw new RuntimeException(&quot;Expected IllegalAccessError was not thrown.&quot;);
254         } catch (InvocationTargetException e) {
255             IllegalAccessError iae = (IllegalAccessError) e.getCause();
256             String errorMsg = iae.getMessage();
257             if (!errorMsg.contains(expectedErrorMessage6)) {
258                 System.out.println(&quot;Expected: &quot; + expectedErrorMessage6 + &quot;id)\n&quot; +
259                                    &quot;but got:  &quot; + errorMsg);
260                 throw new RuntimeException(&quot;Wrong error message of IllegalAccessError.&quot;);
261             }
262             System.out.println(&quot;Passed with message: &quot; + errorMsg);
263         }
264     }
265 
266     private static String expectedErrorMessage7_1 =
<span class="line-modified">267         &quot;class test.IAE78_B tried to access method &#39;void test.IAE78_A.&lt;init&gt;()&#39; &quot; +</span>
268         &quot;(test.IAE78_B is in unnamed module of loader &#39;test7_method_CL&#39; @&quot;;
269     private static String expectedErrorMessage7_2 =
270         &quot;; test.IAE78_A is in unnamed module of loader &#39;app&#39;)&quot;;
271 
272     // Similar to test4.
273     public static void test7_method() throws Exception {
274         ClassLoader base = IllegalAccessErrorTest.class.getClassLoader();
275         IAE_Loader2 loader = new IAE_Loader2(&quot;test7_method_CL&quot;, base.getParent(), base, new String[0],
276                 new String[] {IAE78_A.class.getName()});
277         Class&lt;?&gt; cl = loader.loadClass(IAE78_B.class.getName());
278         Method m = cl.getDeclaredMethod(&quot;create&quot;, new Class[0]);
279 
280         try {
281             m.invoke(null, new Object[0]);
282         } catch (InvocationTargetException e) {
283             IllegalAccessError iae = (IllegalAccessError) e.getCause();
284             String errorMsg = iae.getMessage();
285             if (!(errorMsg.contains(expectedErrorMessage7_1) &amp;&amp;
286                   errorMsg.contains(expectedErrorMessage7_2))) {
287                 System.out.println(&quot;Expected: &quot; + expectedErrorMessage7_1 + &quot;id&quot; + expectedErrorMessage7_2 + &quot;\n&quot; +
</pre>
</td>
</tr>
</table>
<center><a href="../ArrayIndexOutOfBoundsException/ArrayIndexOutOfBoundsExceptionTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../execstack/Test.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>