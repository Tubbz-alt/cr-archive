<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/runtime/NMT/MallocSiteTypeChange.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="CheckForProperDetailStackTrace.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="MallocStressTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/NMT/MallocSiteTypeChange.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
43         OutputAnalyzer output;
44         WhiteBox wb = WhiteBox.getWhiteBox();
45 
46         // Grab my own PID
47         String pid = Long.toString(ProcessTools.getProcessId());
48         ProcessBuilder pb = new ProcessBuilder();
49 
50         int pc = 1;
51         long addr = wb.NMTMallocWithPseudoStack(4 * 1024, pc);
52 
53         // Verify that current tracking level is &quot;detail&quot;
54         pb.command(new String[] { JDKToolFinder.getJDKTool(&quot;jcmd&quot;), pid, &quot;VM.native_memory&quot;, &quot;summary&quot;});
55         output = new OutputAnalyzer(pb.start());
56         output.shouldContain(&quot;Test (reserved=4KB, committed=4KB)&quot;);
57 
58         pb.command(new String[] { JDKToolFinder.getJDKTool(&quot;jcmd&quot;), pid, &quot;VM.native_memory&quot;, &quot;baseline&quot;});
59         output = new OutputAnalyzer(pb.start());
60         output.shouldContain(&quot;Baseline succeeded&quot;);
61 
62         wb.NMTFree(addr);
<span class="line-modified">63         addr = wb.NMTMallocWithPseudoStackAndType(2 * 1024, pc, 7 /* mtInternal */ );</span>
64         pb.command(new String[] { JDKToolFinder.getJDKTool(&quot;jcmd&quot;), pid, &quot;VM.native_memory&quot;, &quot;detail.diff&quot;});
65         output = new OutputAnalyzer(pb.start());
66         output.shouldContain(&quot;(malloc=0KB type=Test -4KB)&quot;);
67         output.shouldContain(&quot;(malloc=2KB type=Internal +2KB #1 +1)&quot;);
68         output.shouldHaveExitValue(0);
69   }
70 }
</pre>
</td>
<td>
<hr />
<pre>
43         OutputAnalyzer output;
44         WhiteBox wb = WhiteBox.getWhiteBox();
45 
46         // Grab my own PID
47         String pid = Long.toString(ProcessTools.getProcessId());
48         ProcessBuilder pb = new ProcessBuilder();
49 
50         int pc = 1;
51         long addr = wb.NMTMallocWithPseudoStack(4 * 1024, pc);
52 
53         // Verify that current tracking level is &quot;detail&quot;
54         pb.command(new String[] { JDKToolFinder.getJDKTool(&quot;jcmd&quot;), pid, &quot;VM.native_memory&quot;, &quot;summary&quot;});
55         output = new OutputAnalyzer(pb.start());
56         output.shouldContain(&quot;Test (reserved=4KB, committed=4KB)&quot;);
57 
58         pb.command(new String[] { JDKToolFinder.getJDKTool(&quot;jcmd&quot;), pid, &quot;VM.native_memory&quot;, &quot;baseline&quot;});
59         output = new OutputAnalyzer(pb.start());
60         output.shouldContain(&quot;Baseline succeeded&quot;);
61 
62         wb.NMTFree(addr);
<span class="line-modified">63         addr = wb.NMTMallocWithPseudoStackAndType(2 * 1024, pc, 8 /* mtInternal */ );</span>
64         pb.command(new String[] { JDKToolFinder.getJDKTool(&quot;jcmd&quot;), pid, &quot;VM.native_memory&quot;, &quot;detail.diff&quot;});
65         output = new OutputAnalyzer(pb.start());
66         output.shouldContain(&quot;(malloc=0KB type=Test -4KB)&quot;);
67         output.shouldContain(&quot;(malloc=2KB type=Internal +2KB #1 +1)&quot;);
68         output.shouldHaveExitValue(0);
69   }
70 }
</pre>
</td>
</tr>
</table>
<center><a href="CheckForProperDetailStackTrace.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="MallocStressTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>