<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/runtime/8024804/RegisterNatives.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../8007320/ConstMethodTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../8176717/TestInheritFD.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/8024804/RegisterNatives.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -21,27 +21,47 @@</span>
   * questions.
   */
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8024804</span>
<span class="udiff-line-removed">-  * @bug 8028741</span>
<span class="udiff-line-modified-added">+  * @bug 8024804 8028741 8232613</span>
   * @summary interface method resolution should skip finding j.l.Object&#39;s registerNatives() and succeed in selecting class B&#39;s registerNatives()
   * @run main RegisterNatives
   */
  public class RegisterNatives {
<span class="udiff-line-modified-removed">-   interface I { void registerNatives(); }</span>
<span class="udiff-line-modified-added">+   interface I {</span>
<span class="udiff-line-added">+     void registerNatives();</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
    interface J extends I {}
<span class="udiff-line-modified-removed">-   static class B implements J { public void registerNatives() { System.out.println(&quot;B&quot;); } }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+   interface K {</span>
<span class="udiff-line-added">+     default public void registerNatives() { System.out.println(&quot;K&quot;); }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static class B implements J {</span>
<span class="udiff-line-added">+     public void registerNatives() { System.out.println(&quot;B&quot;); }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   static class C implements K {}</span>
<span class="udiff-line-added">+ </span>
    public static void main(String... args) {
      System.out.println(&quot;Regression test for JDK-8024804, crash when InterfaceMethodref resolves to Object.registerNatives\n&quot;);
      J val = new B();
      try {
        val.registerNatives();
      } catch (IllegalAccessError e) {
        System.out.println(&quot;TEST FAILS - JDK 8 JVMS, static and non-public methods of j.l.Object should be ignored during interface method resolution\n&quot;);
        e.printStackTrace();
        throw e;
      }
<span class="udiff-line-added">+     C cval = new C();</span>
<span class="udiff-line-added">+     try {</span>
<span class="udiff-line-added">+       cval.registerNatives();</span>
<span class="udiff-line-added">+     } catch (IllegalAccessError e) {</span>
<span class="udiff-line-added">+       System.out.println(&quot;TEST FAILS - a default method named registerNatives should no longer be masked by removed Object.registerNatives\n&quot;);</span>
<span class="udiff-line-added">+       e.printStackTrace();</span>
<span class="udiff-line-added">+       throw e;</span>
<span class="udiff-line-added">+     }</span>
      System.out.println(&quot;TEST PASSES - no IAE resulted\n&quot;);
    }
  }
</pre>
<center><a href="../8007320/ConstMethodTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../8176717/TestInheritFD.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>