<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/hotspot/jtreg/runtime/clone/invokevirtual/HasLocalClone.jasm</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre> 1 /*
 2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  *
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  *
23  */
24 
25 /*
26  * @test
27  * @bug 8154587
28  * @summary Check that invokevirtual of clone() finds the clone() method that
29  *          is local to the calling class.
30  * @compile DefMethClone.jasm SuperClass.jasm I1.java HasLocalClone.jasm
<a name="1" id="anc1"></a><span class="line-modified">31  * @run main/othervm -XX:-BytecodeVerificationRemote -XX:-BytecodeVerificationLocal HasLocalClone</span>
32  */
33 
34 // The below .jasm code implements the following java code:
35 //
36 // public class HasLocalClone extends SuperClass implements I1 {
37 //
38 //     public Object clone() {
39 //         return &quot;In HasLocalClone&#39;s clone()&quot;;
40 //     }
41 //
42 //     static Object test(SuperClass a) { return a.clone(); }
43 //
44 //     public static void main(String[] args) {
45 //         String s = (String)test(new HasLocalClone());
46 //         if (!s.equals(&quot;In HasLocalCloneC&#39;s clone()&quot;)) {
47 //             throw new RuntimeException(&quot;Wrong clone() called: &quot; + s);
48 //         }
49 //     }
50 // }
51 
52 
53 super public class HasLocalClone extends SuperClass implements I1 version 54:0 {
54 
55     public Method &quot;&lt;init&gt;&quot;:&quot;()V&quot; stack 1 locals 1 {
56         aload_0;
57         invokespecial    Method SuperClass.&quot;&lt;init&gt;&quot;:&quot;()V&quot;;
58         return;
59     }
60 
61     public Method clone:&quot;()Ljava/lang/Object;&quot; stack 1 locals 1 {
62         ldc    String &quot;In HasLocalClone\&#39;s clone()&quot;;
63         areturn;
64     }
65 
66     static Method test:&quot;(LSuperClass;)Ljava/lang/Object;&quot; stack 1 locals 1 {
67         aload_0;
68         invokevirtual    Method SuperClass.clone:&quot;()Ljava/lang/Object;&quot;;
69         areturn;
70     }
71 
72     public static Method main:&quot;([Ljava/lang/String;)V&quot; stack 3 locals 2 {
73         new    class HasLocalClone;
74         dup;
75         invokespecial    Method &quot;&lt;init&gt;&quot;:&quot;()V&quot;;
76         invokestatic    Method test:&quot;(LSuperClass;)Ljava/lang/Object;&quot;;
77         checkcast    class java/lang/String;
78         astore_1;
79         aload_1;
80         ldc    String &quot;In HasLocalClone\&#39;s clone()&quot;;
81         invokevirtual    Method java/lang/String.equals:&quot;(Ljava/lang/Object;)Z&quot;;
82         ifne    L37;
83         new    class java/lang/RuntimeException;
84         dup;
85         aload_1;
86         invokedynamic    InvokeDynamic REF_invokeStatic:java/lang/invoke/StringConcatFactory.makeConcatWithConstants:&quot;(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;&quot;:makeConcatWithConstants:&quot;(Ljava/lang/String;)Ljava/lang/String;&quot; String &quot;Wrong clone() called: &quot;;
87         invokespecial    Method java/lang/RuntimeException.&quot;&lt;init&gt;&quot;:&quot;(Ljava/lang/String;)V&quot;;
88         athrow;
89       L37:    stack_frame_type append;
90         locals_map class java/lang/String;
91         return;
92     }
93 
94     public static final InnerClass Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandles;
95 
96 } // end Class HasLocalClone
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>