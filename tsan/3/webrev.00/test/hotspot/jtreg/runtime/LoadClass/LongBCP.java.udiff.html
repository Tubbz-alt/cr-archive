<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/runtime/LoadClass/LongBCP.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../ErrorHandling/TimeoutInErrorHandlingTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../LoaderConstraints/itableLdrConstraint/Test.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/runtime/LoadClass/LongBCP.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -37,11 +37,10 @@</span>
  import java.nio.file.Files;
  import java.nio.file.FileStore;
  import java.nio.file.Path;
  import java.nio.file.Paths;
  import java.util.Arrays;
<span class="udiff-line-removed">- import jdk.test.lib.Platform;</span>
  import jdk.test.lib.compiler.CompilerUtils;
  import jdk.test.lib.process.ProcessTools;
  import jdk.test.lib.process.OutputAnalyzer;
  
  public class LongBCP {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -101,12 +100,10 @@</span>
          output = new OutputAnalyzer(pb.start());
          output.shouldContain(&quot;Hello World&quot;)
                .shouldHaveExitValue(0);
  
          // relative path tests
<span class="udiff-line-removed">-         // We currently cannot handle relative path specified in the</span>
<span class="udiff-line-removed">-         // -Xbootclasspath/a on windows.</span>
          //
          // relative path length within the file system limit
          int fn_max_length = 255;
          // In AUFS file system, the maximal file name length is 242
          FileStore store = Files.getFileStore(new File(&quot;.&quot;).toPath());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -124,17 +121,28 @@</span>
          bootCP = &quot;-Xbootclasspath/a:&quot; + destDir.toString();
          pb = ProcessTools.createJavaProcessBuilder(
              bootCP, &quot;Hello&quot;);
  
          output = new OutputAnalyzer(pb.start());
<span class="udiff-line-modified-removed">-         if (!Platform.isWindows()) {</span>
<span class="udiff-line-modified-removed">-             output.shouldContain(&quot;Hello World&quot;)</span>
<span class="udiff-line-modified-removed">-                   .shouldHaveExitValue(0);</span>
<span class="udiff-line-modified-removed">-         } else {</span>
<span class="udiff-line-modified-removed">-             output.shouldContain(&quot;Could not find or load main class Hello&quot;)</span>
<span class="udiff-line-modified-removed">-                   .shouldHaveExitValue(1);</span>
<span class="udiff-line-modified-added">+         output.shouldContain(&quot;Hello World&quot;)</span>
<span class="udiff-line-modified-added">+               .shouldHaveExitValue(0);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         // Test a relative path for a jar file &lt; MAX_PATH, but where the</span>
<span class="udiff-line-modified-added">+         // absolute path is &gt; MAX_PATH.</span>
<span class="udiff-line-modified-added">+         Path jarDir = Paths.get(&quot;.&quot;);</span>
<span class="udiff-line-added">+         for (int i = 0; i &lt; 21; ++i) {</span>
<span class="udiff-line-added">+             jarDir = jarDir.resolve(&quot;0123456789&quot;);</span>
          }
<span class="udiff-line-added">+         Files.createDirectories(jarDir);</span>
<span class="udiff-line-added">+         Path jarPath = jarDir.resolve(&quot;hello.jar&quot;);</span>
<span class="udiff-line-added">+         Files.copy(Paths.get(helloJar), jarPath);</span>
<span class="udiff-line-added">+         bootCP = &quot;-Xbootclasspath/a:&quot; + jarPath.toString();</span>
<span class="udiff-line-added">+         pb = ProcessTools.createJavaProcessBuilder(bootCP, &quot;Hello&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         output = new OutputAnalyzer(pb.start());</span>
<span class="udiff-line-added">+         output.shouldContain(&quot;Hello World&quot;)</span>
<span class="udiff-line-added">+               .shouldHaveExitValue(0);</span>
  
          // total relative path length exceeds MAX_PATH
          destDir = Paths.get(destDir.toString(), &quot;yyyyyyyy&quot;);
  
          CompilerUtils.compile(sourceDir, destDir);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -142,14 +150,9 @@</span>
          bootCP = &quot;-Xbootclasspath/a:&quot; + destDir.toString();
          pb = ProcessTools.createJavaProcessBuilder(
              bootCP, &quot;Hello&quot;);
  
          output = new OutputAnalyzer(pb.start());
<span class="udiff-line-modified-removed">-         if (!Platform.isWindows()) {</span>
<span class="udiff-line-modified-removed">-             output.shouldContain(&quot;Hello World&quot;)</span>
<span class="udiff-line-removed">-                   .shouldHaveExitValue(0);</span>
<span class="udiff-line-removed">-         } else {</span>
<span class="udiff-line-removed">-             output.shouldContain(&quot;Could not find or load main class Hello&quot;)</span>
<span class="udiff-line-removed">-                   .shouldHaveExitValue(1);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         output.shouldContain(&quot;Hello World&quot;)</span>
<span class="udiff-line-modified-added">+               .shouldHaveExitValue(0);</span>
      }
  }
</pre>
<center><a href="../ErrorHandling/TimeoutInErrorHandlingTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../LoaderConstraints/itableLdrConstraint/Test.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>