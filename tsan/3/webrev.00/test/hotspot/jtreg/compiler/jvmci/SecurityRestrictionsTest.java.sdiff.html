<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/compiler/jvmci/SecurityRestrictionsTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../jsr292/patches/java.base/java/lang/invoke/MethodHandleHelper.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestJVMCIPrintProperties.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/jvmci/SecurityRestrictionsTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 67         try {
 68             // to init Utils before call SecurityManager
 69             Class.forName(Utils.class.getName(), true,
 70                     Utils.class.getClassLoader());
 71         } catch (ClassNotFoundException e) {
 72             throw new Error(&quot;[TEST BUG]: jdk.test.lib.Utils not found&quot;, e);
 73         }
 74         try {
 75             TestCase mode = TestCase.valueOf(args[0]);
 76             mode.run();
 77         } catch (IllegalArgumentException e) {
 78             throw new Error(&quot;[TEST BUG]: Unknown mode &quot; + args[0], e);
 79         }
 80     }
 81 
 82     private enum TestCase {
 83         NO_SEC_MAN,
 84         NO_JVMCI {
 85             @Override
 86             public Class&lt;? extends Throwable&gt; getExpectedException() {
<span class="line-modified"> 87                 return InternalError.class;</span>
 88             }
 89         },
 90         ALL_PERM {
 91             @Override
 92             public SecurityManager getSecurityManager() {
 93                 return new SecurityManager() {
 94                     @Override
 95                     public void checkPermission(Permission perm) {
 96                     }
 97                 };
 98             }
 99         },
100         NO_PERM {
101             @Override
102             public SecurityManager getSecurityManager() {
103                 return new SecurityManager();
104             }
105 
106             @Override
107             public Class&lt;? extends Throwable&gt; getExpectedException() {
</pre>
<hr />
<pre>
155                     }
156                 } else {
157                     String message = name() + &quot;: Got unexpected exception &quot;
158                             + e.getClass().getSimpleName();
159                     if (getExpectedException() == null){
160                         throw new AssertionError(message, e);
161                     }
162 
163                     Throwable t = e;
164                     while (t.getCause() != null) {
165                         t = t.getCause();
166                     }
167                     if (!getExpectedException().isAssignableFrom(t.getClass())) {
168                         message += &quot; instead of &quot; + getExpectedException()
169                                 .getSimpleName();
170                         throw new AssertionError(message, e);
171                     }
172                 }
173             };
174             Utils.runAndCheckException(() -&gt; {
<span class="line-modified">175                 try {</span>
<span class="line-modified">176                     // CompilerToVM::&lt;cinit&gt; provokes CompilerToVM::&lt;init&gt;</span>
<span class="line-removed">177                     Class.forName(&quot;jdk.vm.ci.hotspot.CompilerToVMHelper&quot;);</span>
<span class="line-removed">178                 } catch (ClassNotFoundException e) {</span>
<span class="line-removed">179                     throw new Error(&quot;TESTBUG : &quot; + e, e);</span>
<span class="line-removed">180                 }</span>
181             }, exceptionCheck);
182         }
183 
184         public SecurityManager getSecurityManager() {
185             return null;
186         }
187 
188         public Class&lt;? extends Throwable&gt; getExpectedException() {
189             return null;
190         }
191 
192         private static final String JVMCI_RT_PERM_START
193                 = &quot;accessClassInPackage.jdk.vm.ci&quot;;
194         private static final String JVMCI_SERVICES = &quot;jvmciServices&quot;;
195         private static final String JVMCI_PROP_START = &quot;jvmci.&quot;;
196 
197     }
198 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 67         try {
 68             // to init Utils before call SecurityManager
 69             Class.forName(Utils.class.getName(), true,
 70                     Utils.class.getClassLoader());
 71         } catch (ClassNotFoundException e) {
 72             throw new Error(&quot;[TEST BUG]: jdk.test.lib.Utils not found&quot;, e);
 73         }
 74         try {
 75             TestCase mode = TestCase.valueOf(args[0]);
 76             mode.run();
 77         } catch (IllegalArgumentException e) {
 78             throw new Error(&quot;[TEST BUG]: Unknown mode &quot; + args[0], e);
 79         }
 80     }
 81 
 82     private enum TestCase {
 83         NO_SEC_MAN,
 84         NO_JVMCI {
 85             @Override
 86             public Class&lt;? extends Throwable&gt; getExpectedException() {
<span class="line-modified"> 87                 return Error.class;</span>
 88             }
 89         },
 90         ALL_PERM {
 91             @Override
 92             public SecurityManager getSecurityManager() {
 93                 return new SecurityManager() {
 94                     @Override
 95                     public void checkPermission(Permission perm) {
 96                     }
 97                 };
 98             }
 99         },
100         NO_PERM {
101             @Override
102             public SecurityManager getSecurityManager() {
103                 return new SecurityManager();
104             }
105 
106             @Override
107             public Class&lt;? extends Throwable&gt; getExpectedException() {
</pre>
<hr />
<pre>
155                     }
156                 } else {
157                     String message = name() + &quot;: Got unexpected exception &quot;
158                             + e.getClass().getSimpleName();
159                     if (getExpectedException() == null){
160                         throw new AssertionError(message, e);
161                     }
162 
163                     Throwable t = e;
164                     while (t.getCause() != null) {
165                         t = t.getCause();
166                     }
167                     if (!getExpectedException().isAssignableFrom(t.getClass())) {
168                         message += &quot; instead of &quot; + getExpectedException()
169                                 .getSimpleName();
170                         throw new AssertionError(message, e);
171                     }
172                 }
173             };
174             Utils.runAndCheckException(() -&gt; {
<span class="line-modified">175                 // CompilerToVM::&lt;cinit&gt; provokes CompilerToVM::&lt;init&gt;</span>
<span class="line-modified">176                 Class.forName(&quot;jdk.vm.ci.hotspot.CompilerToVMHelper&quot;);</span>




177             }, exceptionCheck);
178         }
179 
180         public SecurityManager getSecurityManager() {
181             return null;
182         }
183 
184         public Class&lt;? extends Throwable&gt; getExpectedException() {
185             return null;
186         }
187 
188         private static final String JVMCI_RT_PERM_START
189                 = &quot;accessClassInPackage.jdk.vm.ci&quot;;
190         private static final String JVMCI_SERVICES = &quot;jvmciServices&quot;;
191         private static final String JVMCI_PROP_START = &quot;jvmci.&quot;;
192 
193     }
194 }
</pre>
</td>
</tr>
</table>
<center><a href="../jsr292/patches/java.base/java/lang/invoke/MethodHandleHelper.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestJVMCIPrintProperties.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>