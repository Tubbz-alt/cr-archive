<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/compiler/jvmci/jdk.vm.ci.code.test/src/jdk/vm/ci/code/test/DebugInfoTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DataPatchTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="InterpreterFrameSizeTest.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/jvmci/jdk.vm.ci.code.test/src/jdk/vm/ci/code/test/DebugInfoTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -60,36 +60,36 @@</span>
          JavaValue[] values = new JavaValue[slotKinds.length];
          test(asm -&gt; {
              /*
               * Ensure that any objects mentioned in the VirtualObjects are also in the OopMap.
               */
<span class="udiff-line-modified-removed">-             List&lt;Location&gt; newLocations = new ArrayList&lt;Location&gt;(Arrays.asList(objects));</span>
<span class="udiff-line-modified-removed">-             List&lt;Location&gt; newDerived = new ArrayList&lt;Location&gt;(Arrays.asList(derivedBase));</span>
<span class="udiff-line-modified-added">+             List&lt;Location&gt; newLocations = new ArrayList&lt;&gt;(Arrays.asList(objects));</span>
<span class="udiff-line-modified-added">+             List&lt;Location&gt; newDerived = new ArrayList&lt;&gt;(Arrays.asList(derivedBase));</span>
              int[] newSizeInBytes = sizeInBytes;
              VirtualObject[] vobjs = compiler.compile(asm, values);
              if (vobjs != null) {
                  for (VirtualObject obj : vobjs) {
                      JavaValue[] objValues = obj.getValues();
                      for (int i = 0; i &lt; objValues.length; i++) {
<span class="udiff-line-modified-removed">-                             if (obj.getSlotKind(i) == JavaKind.Object) {</span>
<span class="udiff-line-modified-removed">-                                     Location oopLocation = null;</span>
<span class="udiff-line-modified-removed">-                                     int bytes = -1;</span>
<span class="udiff-line-modified-removed">-                                     if (objValues[i] instanceof RegisterValue) {</span>
<span class="udiff-line-modified-removed">-                                             RegisterValue reg = (RegisterValue) objValues[i];</span>
<span class="udiff-line-modified-removed">-                                             oopLocation = Location.register(reg.getRegister());</span>
<span class="udiff-line-modified-removed">-                                             bytes = reg.getValueKind().getPlatformKind().getSizeInBytes();</span>
<span class="udiff-line-modified-removed">-                                     } else if (objValues[i] instanceof StackSlot) {</span>
<span class="udiff-line-modified-removed">-                                             StackSlot slot = (StackSlot) objValues[i];</span>
<span class="udiff-line-modified-removed">-                                             oopLocation = Location.stack(asm.getOffset(slot));</span>
<span class="udiff-line-modified-removed">-                                             bytes = slot.getValueKind().getPlatformKind().getSizeInBytes();</span>
<span class="udiff-line-modified-removed">-                                     }</span>
<span class="udiff-line-modified-removed">-                                     if (oopLocation != null &amp;&amp; !newLocations.contains(oopLocation)) {</span>
<span class="udiff-line-modified-removed">-                                             newLocations.add(oopLocation);</span>
<span class="udiff-line-modified-removed">-                                             newDerived.add(null);</span>
<span class="udiff-line-modified-removed">-                                             newSizeInBytes = Arrays.copyOf(newSizeInBytes, newSizeInBytes.length + 1);</span>
<span class="udiff-line-modified-removed">-                                         newSizeInBytes[newSizeInBytes.length - 1] = bytes;</span>
<span class="udiff-line-modified-removed">-                                 }</span>
<span class="udiff-line-modified-added">+                         if (obj.getSlotKind(i) == JavaKind.Object) {</span>
<span class="udiff-line-modified-added">+                             Location oopLocation = null;</span>
<span class="udiff-line-modified-added">+                             int bytes = -1;</span>
<span class="udiff-line-modified-added">+                             if (objValues[i] instanceof RegisterValue) {</span>
<span class="udiff-line-modified-added">+                                 RegisterValue reg = (RegisterValue) objValues[i];</span>
<span class="udiff-line-modified-added">+                                 oopLocation = Location.register(reg.getRegister());</span>
<span class="udiff-line-modified-added">+                                 bytes = reg.getValueKind().getPlatformKind().getSizeInBytes();</span>
<span class="udiff-line-modified-added">+                             } else if (objValues[i] instanceof StackSlot) {</span>
<span class="udiff-line-modified-added">+                                 StackSlot slot = (StackSlot) objValues[i];</span>
<span class="udiff-line-modified-added">+                                 oopLocation = Location.stack(asm.getOffset(slot));</span>
<span class="udiff-line-modified-added">+                                 bytes = slot.getValueKind().getPlatformKind().getSizeInBytes();</span>
<span class="udiff-line-modified-added">+                             }</span>
<span class="udiff-line-modified-added">+                             if (oopLocation != null &amp;&amp; !newLocations.contains(oopLocation)) {</span>
<span class="udiff-line-modified-added">+                                 newLocations.add(oopLocation);</span>
<span class="udiff-line-modified-added">+                                 newDerived.add(null);</span>
<span class="udiff-line-modified-added">+                                 newSizeInBytes = Arrays.copyOf(newSizeInBytes, newSizeInBytes.length + 1);</span>
<span class="udiff-line-modified-added">+                                 newSizeInBytes[newSizeInBytes.length - 1] = bytes;</span>
<span class="udiff-line-modified-added">+                             }</span>
                          }
                      }
                  }
              }
  
</pre>
<center><a href="DataPatchTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="InterpreterFrameSizeTest.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>