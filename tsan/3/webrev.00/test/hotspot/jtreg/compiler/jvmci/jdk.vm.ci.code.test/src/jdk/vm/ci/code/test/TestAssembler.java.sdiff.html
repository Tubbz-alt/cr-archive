<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/compiler/jvmci/jdk.vm.ci.code.test/src/jdk/vm/ci/code/test/TestAssembler.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SimpleDebugInfoTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="TestHotSpotVMConfig.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/jvmci/jdk.vm.ci.code.test/src/jdk/vm/ci/code/test/TestAssembler.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
189 
190     public final ValueKind&lt;?&gt; narrowOopKind;
191 
192     protected final Buffer code;
193     protected final Buffer data;
194     private final ArrayList&lt;Site&gt; sites;
195     private final ArrayList&lt;DataPatch&gt; dataPatches;
196 
197     protected final CodeCacheProvider codeCache;
198     protected final TestHotSpotVMConfig config;
199 
200     private final Register[] registers;
201     private int nextRegister;
202 
203     protected int frameSize;
204     private int stackAlignment;
205     private int curStackSlot;
206 
207     private StackSlot deoptRescue;
208 
<span class="line-modified">209     public ValueKindFactory&lt;TestValueKind&gt; valueKindFactory = new ValueKindFactory&lt;TestAssembler.TestValueKind&gt;() {</span>
210         public TestValueKind getValueKind(JavaKind javaKind) {
211             return (TestValueKind) TestAssembler.this.getValueKind(javaKind);
212         }
213     };
214 
215     static class TestValueKind extends ValueKind&lt;TestValueKind&gt; {
216 
217         TestValueKind(PlatformKind kind) {
218             super(kind);
219         }
220 
221         @Override
222         public TestValueKind changeType(PlatformKind kind) {
223             return new TestValueKind(kind);
224         }
225     }
226 
227     protected TestAssembler(CodeCacheProvider codeCache, TestHotSpotVMConfig config, int initialFrameSize, int stackAlignment, PlatformKind narrowOopKind, Register... registers) {
228         this.narrowOopKind = new TestValueKind(narrowOopKind);
229 
</pre>
<hr />
<pre>
372             int pos = data.position();
373             int misaligned = pos % alignment;
374             if (misaligned != 0) {
375                 pos += alignment - misaligned;
376                 data.position(pos);
377             }
378         }
379 
380         private byte[] finish() {
381             return Arrays.copyOf(data.array(), data.position());
382         }
383     }
384 
385     /**
386      * Loads a primitive into the Allocatable &lt;code&gt;av&lt;/code&gt;. Implementors may only implement
387      * primitive types.
388      */
389     public abstract void emitLoad(AllocatableValue av, Object prim);
390 
391     /**
<span class="line-modified">392      * Emit a call to a fixed address &lt;code&gt;addr&lt;/code&gt;</span>
393      */
394     public abstract void emitCall(long addr);
395 
396     /**
397      * Emit code which is necessary to call a method with {@link CallingConvention} &lt;code&gt;cc&lt;/code&gt;
398      * and arguments &lt;coe&gt;prim&lt;/code&gt;.
399      */
400     public abstract void emitCallPrologue(CallingConvention cc, Object... prim);
401 
402     /**
403      * Emit code which is necessary after calling a method with CallingConvention &lt;code&gt;cc&lt;/code&gt;.
404      */
405     public abstract void emitCallEpilogue(CallingConvention cc);
406 
407 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
189 
190     public final ValueKind&lt;?&gt; narrowOopKind;
191 
192     protected final Buffer code;
193     protected final Buffer data;
194     private final ArrayList&lt;Site&gt; sites;
195     private final ArrayList&lt;DataPatch&gt; dataPatches;
196 
197     protected final CodeCacheProvider codeCache;
198     protected final TestHotSpotVMConfig config;
199 
200     private final Register[] registers;
201     private int nextRegister;
202 
203     protected int frameSize;
204     private int stackAlignment;
205     private int curStackSlot;
206 
207     private StackSlot deoptRescue;
208 
<span class="line-modified">209     public ValueKindFactory&lt;TestValueKind&gt; valueKindFactory = new ValueKindFactory&lt;&gt;() {</span>
210         public TestValueKind getValueKind(JavaKind javaKind) {
211             return (TestValueKind) TestAssembler.this.getValueKind(javaKind);
212         }
213     };
214 
215     static class TestValueKind extends ValueKind&lt;TestValueKind&gt; {
216 
217         TestValueKind(PlatformKind kind) {
218             super(kind);
219         }
220 
221         @Override
222         public TestValueKind changeType(PlatformKind kind) {
223             return new TestValueKind(kind);
224         }
225     }
226 
227     protected TestAssembler(CodeCacheProvider codeCache, TestHotSpotVMConfig config, int initialFrameSize, int stackAlignment, PlatformKind narrowOopKind, Register... registers) {
228         this.narrowOopKind = new TestValueKind(narrowOopKind);
229 
</pre>
<hr />
<pre>
372             int pos = data.position();
373             int misaligned = pos % alignment;
374             if (misaligned != 0) {
375                 pos += alignment - misaligned;
376                 data.position(pos);
377             }
378         }
379 
380         private byte[] finish() {
381             return Arrays.copyOf(data.array(), data.position());
382         }
383     }
384 
385     /**
386      * Loads a primitive into the Allocatable &lt;code&gt;av&lt;/code&gt;. Implementors may only implement
387      * primitive types.
388      */
389     public abstract void emitLoad(AllocatableValue av, Object prim);
390 
391     /**
<span class="line-modified">392      * Emit a call to a fixed address &lt;code&gt;addr&lt;/code&gt;.</span>
393      */
394     public abstract void emitCall(long addr);
395 
396     /**
397      * Emit code which is necessary to call a method with {@link CallingConvention} &lt;code&gt;cc&lt;/code&gt;
398      * and arguments &lt;coe&gt;prim&lt;/code&gt;.
399      */
400     public abstract void emitCallPrologue(CallingConvention cc, Object... prim);
401 
402     /**
403      * Emit code which is necessary after calling a method with CallingConvention &lt;code&gt;cc&lt;/code&gt;.
404      */
405     public abstract void emitCallEpilogue(CallingConvention cc);
406 
407 }
</pre>
</td>
</tr>
</table>
<center><a href="SimpleDebugInfoTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="TestHotSpotVMConfig.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>