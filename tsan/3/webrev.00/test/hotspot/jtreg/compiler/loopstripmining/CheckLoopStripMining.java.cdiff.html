<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/hotspot/jtreg/compiler/loopstripmining/CheckLoopStripMining.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../loopopts/superword/Vec_MulAddS2I.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../profiling/TestTypeProfiling.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/loopstripmining/CheckLoopStripMining.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 25,29 ***</span>
   * @test
   * @bug 8220374
   * @summary C2: LoopStripMining doesn&#39;t strip as expected
   * @requires vm.compiler2.enabled
   *
<span class="line-modified">!  * @run main/othervm -XX:+UnlockDiagnosticVMOptions -XX:+SafepointTimeout -XX:+SafepointALot</span>
<span class="line-modified">!  *                   -XX:+AbortVMOnSafepointTimeout -XX:SafepointTimeoutDelay=500 -XX:GuaranteedSafepointInterval=500</span>
<span class="line-removed">-  *                   -XX:-TieredCompilation -XX:+UseCountedLoopSafepoints -XX:LoopStripMiningIter=1000</span>
<span class="line-removed">-  *                   -XX:LoopUnrollLimit=0 -XX:CompileCommand=compileonly,CheckLoopStripMining::test_loop -Xcomp CheckLoopStripMining</span>
<span class="line-removed">-  *</span>
   */
  
  public class CheckLoopStripMining {
  
<span class="line-modified">!   public static int test_loop(int x) {</span>
        int sum = 0;
        if (x != 0) {
            for (int y = 1; y &lt; Integer.MAX_VALUE; ++y) {
                if (y % x == 0) ++sum;
            }
        }
        return sum;
<span class="line-modified">!   }</span>
  
<span class="line-modified">!   public static void main(String args[]) {</span>
<span class="line-modified">!     int sum = test_loop(3);</span>
<span class="line-modified">!     System.out.println(&quot;sum: &quot; + sum);</span>
    }
  }
<span class="line-new-header">--- 25,52 ---</span>
   * @test
   * @bug 8220374
   * @summary C2: LoopStripMining doesn&#39;t strip as expected
   * @requires vm.compiler2.enabled
   *
<span class="line-modified">!  * @library /test/lib</span>
<span class="line-modified">!  * @run driver compiler.loopstripmining.CheckLoopStripMining</span>
   */
  
<span class="line-added">+ package compiler.loopstripmining;</span>
<span class="line-added">+ </span>
<span class="line-added">+ import jdk.test.lib.Utils;</span>
<span class="line-added">+ import jdk.test.lib.process.ProcessTools;</span>
<span class="line-added">+ </span>
  public class CheckLoopStripMining {
<span class="line-added">+   public static void main(String args[]) throws Exception {</span>
<span class="line-added">+     ProcessTools.executeTestJvm(</span>
<span class="line-added">+         &quot;-XX:+UnlockDiagnosticVMOptions&quot;,</span>
<span class="line-added">+         // to prevent biased locking handshakes from changing the timing of this test</span>
<span class="line-added">+         &quot;-XX:-UseBiasedLocking&quot;,</span>
<span class="line-added">+         &quot;-XX:+SafepointTimeout&quot;,</span>
<span class="line-added">+         &quot;-XX:+SafepointALot&quot;,</span>
<span class="line-added">+         &quot;-XX:+AbortVMOnSafepointTimeout&quot;,</span>
<span class="line-added">+         &quot;-XX:SafepointTimeoutDelay=&quot; + Utils.adjustTimeout(500),</span>
<span class="line-added">+         &quot;-XX:GuaranteedSafepointInterval=&quot; + Utils.adjustTimeout(500),</span>
<span class="line-added">+         &quot;-XX:-TieredCompilation&quot;,</span>
<span class="line-added">+         &quot;-XX:+UseCountedLoopSafepoints&quot;,</span>
<span class="line-added">+         &quot;-XX:LoopStripMiningIter=1000&quot;,</span>
<span class="line-added">+         &quot;-XX:LoopUnrollLimit=0&quot;,</span>
<span class="line-added">+         &quot;-XX:CompileCommand=compileonly,compiler.loopstripmining.CheckLoopStripMining$Test::test_loop&quot;,</span>
<span class="line-added">+         &quot;-Xcomp&quot;,</span>
<span class="line-added">+         Test.class.getName()).shouldHaveExitValue(0)</span>
<span class="line-added">+                              .stdoutShouldContain(&quot;sum: 715827882&quot;);</span>
<span class="line-added">+   }</span>
  
<span class="line-modified">!   public static class Test {</span>
<span class="line-added">+     public static int test_loop(int x) {</span>
        int sum = 0;
        if (x != 0) {
            for (int y = 1; y &lt; Integer.MAX_VALUE; ++y) {
                if (y % x == 0) ++sum;
            }
        }
        return sum;
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     public static void main(String args[]) {</span>
<span class="line-modified">!       int sum = test_loop(3);</span>
<span class="line-modified">!       System.out.println(&quot;sum: &quot; + sum);</span>
<span class="line-added">+     }</span>
    }
  }
</pre>
<center><a href="../loopopts/superword/Vec_MulAddS2I.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../profiling/TestTypeProfiling.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>