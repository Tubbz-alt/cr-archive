<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/compiler/intrinsics/klass/TestIsPrimitive.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="CastNullCheckDroppingsTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../sha/cli/SHAOptionsBase.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/compiler/intrinsics/klass/TestIsPrimitive.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8150669

 27  * @summary C1 intrinsic for Class.isPrimitive
 28  * @modules java.base/jdk.internal.misc
 29  *
 30  * @run main/othervm -ea -Diters=200   -Xint
 31  *      compiler.intrinsics.klass.TestIsPrimitive
<span class="line-modified"> 32  * @run main/othervm -ea -Diters=30000 -XX:TieredStopAtLevel=1</span>
 33  *      compiler.intrinsics.klass.TestIsPrimitive
 34  * @run main/othervm -ea -Diters=30000 -XX:TieredStopAtLevel=4
 35  *      compiler.intrinsics.klass.TestIsPrimitive
 36  */
 37 
 38 package compiler.intrinsics.klass;
 39 
 40 import java.util.concurrent.Callable;
 41 
 42 public class TestIsPrimitive {
 43     static final int ITERS = Integer.getInteger(&quot;iters&quot;, 1);
 44 
 45     public static void main(String... args) throws Exception {
 46         testOK(true,  InlineConstants::testBoolean);
 47         testOK(true,  InlineConstants::testByte);
 48         testOK(true,  InlineConstants::testShort);
 49         testOK(true,  InlineConstants::testChar);
 50         testOK(true,  InlineConstants::testInt);
 51         testOK(true,  InlineConstants::testFloat);
 52         testOK(true,  InlineConstants::testLong);
 53         testOK(true,  InlineConstants::testDouble);
 54         testOK(false, InlineConstants::testObject);
 55         testOK(false, InlineConstants::testArray);

 56 
 57         testOK(true,  StaticConstants::testBoolean);
 58         testOK(true,  StaticConstants::testByte);
 59         testOK(true,  StaticConstants::testShort);
 60         testOK(true,  StaticConstants::testChar);
 61         testOK(true,  StaticConstants::testInt);
 62         testOK(true,  StaticConstants::testFloat);
 63         testOK(true,  StaticConstants::testLong);
 64         testOK(true,  StaticConstants::testDouble);
 65         testOK(false, StaticConstants::testObject);
 66         testOK(false, StaticConstants::testArray);

 67         testNPE(      StaticConstants::testNull);
 68 
 69         testOK(true,  NoConstants::testBoolean);
 70         testOK(true,  NoConstants::testByte);
 71         testOK(true,  NoConstants::testShort);
 72         testOK(true,  NoConstants::testChar);
 73         testOK(true,  NoConstants::testInt);
 74         testOK(true,  NoConstants::testFloat);
 75         testOK(true,  NoConstants::testLong);
 76         testOK(true,  NoConstants::testDouble);
 77         testOK(false, NoConstants::testObject);
 78         testOK(false, NoConstants::testArray);

 79         testNPE(      NoConstants::testNull);
 80     }
 81 
 82     public static void testOK(boolean expected, Callable&lt;Object&gt; test) throws Exception {
 83         for (int c = 0; c &lt; ITERS; c++) {
 84             Object res = test.call();
 85             if (!res.equals(expected)) {
 86                 throw new IllegalStateException(&quot;Wrong result: expected = &quot; + expected + &quot;, but got &quot; + res);
 87             }
 88         }
 89     }
 90 
 91     static volatile Object sink;
 92 
 93     public static void testNPE(Callable&lt;Object&gt; test) throws Exception {
 94         for (int c = 0; c &lt; ITERS; c++) {
 95             try {
 96                sink = test.call();
 97                throw new IllegalStateException(&quot;Expected NPE&quot;);
 98             } catch (NullPointerException iae) {
 99                // expected
100             }
101         }
102     }
103 
104     static volatile Class&lt;?&gt; classBoolean = boolean.class;
105     static volatile Class&lt;?&gt; classByte    = byte.class;
106     static volatile Class&lt;?&gt; classShort   = short.class;
107     static volatile Class&lt;?&gt; classChar    = char.class;
108     static volatile Class&lt;?&gt; classInt     = int.class;
109     static volatile Class&lt;?&gt; classFloat   = float.class;
110     static volatile Class&lt;?&gt; classLong    = long.class;
111     static volatile Class&lt;?&gt; classDouble  = double.class;
112     static volatile Class&lt;?&gt; classObject  = Object.class;
113     static volatile Class&lt;?&gt; classArray   = Object[].class;
114     static volatile Class&lt;?&gt; classNull    = null;

115 
116     static final Class&lt;?&gt; staticClassBoolean = boolean.class;
117     static final Class&lt;?&gt; staticClassByte    = byte.class;
118     static final Class&lt;?&gt; staticClassShort   = short.class;
119     static final Class&lt;?&gt; staticClassChar    = char.class;
120     static final Class&lt;?&gt; staticClassInt     = int.class;
121     static final Class&lt;?&gt; staticClassFloat   = float.class;
122     static final Class&lt;?&gt; staticClassLong    = long.class;
123     static final Class&lt;?&gt; staticClassDouble  = double.class;
124     static final Class&lt;?&gt; staticClassObject  = Object.class;
125     static final Class&lt;?&gt; staticClassArray   = Object[].class;
126     static final Class&lt;?&gt; staticClassNull    = null;

127 
128     static class InlineConstants {
129         static boolean testBoolean() { return boolean.class.isPrimitive();  }
130         static boolean testByte()    { return byte.class.isPrimitive();     }
131         static boolean testShort()   { return short.class.isPrimitive();    }
132         static boolean testChar()    { return char.class.isPrimitive();     }
133         static boolean testInt()     { return int.class.isPrimitive();      }
134         static boolean testFloat()   { return float.class.isPrimitive();    }
135         static boolean testLong()    { return long.class.isPrimitive();     }
136         static boolean testDouble()  { return double.class.isPrimitive();   }
137         static boolean testObject()  { return Object.class.isPrimitive();   }
138         static boolean testArray()   { return Object[].class.isPrimitive(); }

139     }
140 
141     static class StaticConstants {
142         static boolean testBoolean() { return staticClassBoolean.isPrimitive(); }
143         static boolean testByte()    { return staticClassByte.isPrimitive();    }
144         static boolean testShort()   { return staticClassShort.isPrimitive();   }
145         static boolean testChar()    { return staticClassChar.isPrimitive();    }
146         static boolean testInt()     { return staticClassInt.isPrimitive();     }
147         static boolean testFloat()   { return staticClassFloat.isPrimitive();   }
148         static boolean testLong()    { return staticClassLong.isPrimitive();    }
149         static boolean testDouble()  { return staticClassDouble.isPrimitive();  }
150         static boolean testObject()  { return staticClassObject.isPrimitive();  }
151         static boolean testArray()   { return staticClassArray.isPrimitive();   }
152         static boolean testNull()    { return staticClassNull.isPrimitive();    }

153     }
154 
155     static class NoConstants {
156         static boolean testBoolean() { return classBoolean.isPrimitive(); }
157         static boolean testByte()    { return classByte.isPrimitive();    }
158         static boolean testShort()   { return classShort.isPrimitive();   }
159         static boolean testChar()    { return classChar.isPrimitive();    }
160         static boolean testInt()     { return classInt.isPrimitive();     }
161         static boolean testFloat()   { return classFloat.isPrimitive();   }
162         static boolean testLong()    { return classLong.isPrimitive();    }
163         static boolean testDouble()  { return classDouble.isPrimitive();  }
164         static boolean testObject()  { return classObject.isPrimitive();  }
165         static boolean testArray()   { return classArray.isPrimitive();   }
166         static boolean testNull()    { return classNull.isPrimitive();    }

167     }
168 

169 }
170 
</pre>
</td>
<td>
<hr />
<pre>
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8150669
<span class="line-added"> 27  * @bug 8233019</span>
 28  * @summary C1 intrinsic for Class.isPrimitive
 29  * @modules java.base/jdk.internal.misc
 30  *
 31  * @run main/othervm -ea -Diters=200   -Xint
 32  *      compiler.intrinsics.klass.TestIsPrimitive
<span class="line-modified"> 33  * @run main/othervm -ea -XX:-UseSharedSpaces -Diters=30000 -XX:TieredStopAtLevel=1</span>
 34  *      compiler.intrinsics.klass.TestIsPrimitive
 35  * @run main/othervm -ea -Diters=30000 -XX:TieredStopAtLevel=4
 36  *      compiler.intrinsics.klass.TestIsPrimitive
 37  */
 38 
 39 package compiler.intrinsics.klass;
 40 
 41 import java.util.concurrent.Callable;
 42 
 43 public class TestIsPrimitive {
 44     static final int ITERS = Integer.getInteger(&quot;iters&quot;, 1);
 45 
 46     public static void main(String... args) throws Exception {
 47         testOK(true,  InlineConstants::testBoolean);
 48         testOK(true,  InlineConstants::testByte);
 49         testOK(true,  InlineConstants::testShort);
 50         testOK(true,  InlineConstants::testChar);
 51         testOK(true,  InlineConstants::testInt);
 52         testOK(true,  InlineConstants::testFloat);
 53         testOK(true,  InlineConstants::testLong);
 54         testOK(true,  InlineConstants::testDouble);
 55         testOK(false, InlineConstants::testObject);
 56         testOK(false, InlineConstants::testArray);
<span class="line-added"> 57         testOK(false, InlineConstants::testBooleanArray);</span>
 58 
 59         testOK(true,  StaticConstants::testBoolean);
 60         testOK(true,  StaticConstants::testByte);
 61         testOK(true,  StaticConstants::testShort);
 62         testOK(true,  StaticConstants::testChar);
 63         testOK(true,  StaticConstants::testInt);
 64         testOK(true,  StaticConstants::testFloat);
 65         testOK(true,  StaticConstants::testLong);
 66         testOK(true,  StaticConstants::testDouble);
 67         testOK(false, StaticConstants::testObject);
 68         testOK(false, StaticConstants::testArray);
<span class="line-added"> 69         testOK(false, StaticConstants::testBooleanArray);</span>
 70         testNPE(      StaticConstants::testNull);
 71 
 72         testOK(true,  NoConstants::testBoolean);
 73         testOK(true,  NoConstants::testByte);
 74         testOK(true,  NoConstants::testShort);
 75         testOK(true,  NoConstants::testChar);
 76         testOK(true,  NoConstants::testInt);
 77         testOK(true,  NoConstants::testFloat);
 78         testOK(true,  NoConstants::testLong);
 79         testOK(true,  NoConstants::testDouble);
 80         testOK(false, NoConstants::testObject);
 81         testOK(false, NoConstants::testArray);
<span class="line-added"> 82         testOK(false, NoConstants::testBooleanArray);</span>
 83         testNPE(      NoConstants::testNull);
 84     }
 85 
 86     public static void testOK(boolean expected, Callable&lt;Object&gt; test) throws Exception {
 87         for (int c = 0; c &lt; ITERS; c++) {
 88             Object res = test.call();
 89             if (!res.equals(expected)) {
 90                 throw new IllegalStateException(&quot;Wrong result: expected = &quot; + expected + &quot;, but got &quot; + res);
 91             }
 92         }
 93     }
 94 
 95     static volatile Object sink;
 96 
 97     public static void testNPE(Callable&lt;Object&gt; test) throws Exception {
 98         for (int c = 0; c &lt; ITERS; c++) {
 99             try {
100                sink = test.call();
101                throw new IllegalStateException(&quot;Expected NPE&quot;);
102             } catch (NullPointerException iae) {
103                // expected
104             }
105         }
106     }
107 
108     static volatile Class&lt;?&gt; classBoolean = boolean.class;
109     static volatile Class&lt;?&gt; classByte    = byte.class;
110     static volatile Class&lt;?&gt; classShort   = short.class;
111     static volatile Class&lt;?&gt; classChar    = char.class;
112     static volatile Class&lt;?&gt; classInt     = int.class;
113     static volatile Class&lt;?&gt; classFloat   = float.class;
114     static volatile Class&lt;?&gt; classLong    = long.class;
115     static volatile Class&lt;?&gt; classDouble  = double.class;
116     static volatile Class&lt;?&gt; classObject  = Object.class;
117     static volatile Class&lt;?&gt; classArray   = Object[].class;
118     static volatile Class&lt;?&gt; classNull    = null;
<span class="line-added">119     static volatile Class&lt;?&gt; classBooleanArray = boolean[].class;</span>
120 
121     static final Class&lt;?&gt; staticClassBoolean = boolean.class;
122     static final Class&lt;?&gt; staticClassByte    = byte.class;
123     static final Class&lt;?&gt; staticClassShort   = short.class;
124     static final Class&lt;?&gt; staticClassChar    = char.class;
125     static final Class&lt;?&gt; staticClassInt     = int.class;
126     static final Class&lt;?&gt; staticClassFloat   = float.class;
127     static final Class&lt;?&gt; staticClassLong    = long.class;
128     static final Class&lt;?&gt; staticClassDouble  = double.class;
129     static final Class&lt;?&gt; staticClassObject  = Object.class;
130     static final Class&lt;?&gt; staticClassArray   = Object[].class;
131     static final Class&lt;?&gt; staticClassNull    = null;
<span class="line-added">132     static final Class&lt;?&gt; staticClassBooleanArray = boolean[].class;</span>
133 
134     static class InlineConstants {
135         static boolean testBoolean() { return boolean.class.isPrimitive();  }
136         static boolean testByte()    { return byte.class.isPrimitive();     }
137         static boolean testShort()   { return short.class.isPrimitive();    }
138         static boolean testChar()    { return char.class.isPrimitive();     }
139         static boolean testInt()     { return int.class.isPrimitive();      }
140         static boolean testFloat()   { return float.class.isPrimitive();    }
141         static boolean testLong()    { return long.class.isPrimitive();     }
142         static boolean testDouble()  { return double.class.isPrimitive();   }
143         static boolean testObject()  { return Object.class.isPrimitive();   }
144         static boolean testArray()   { return Object[].class.isPrimitive(); }
<span class="line-added">145         static boolean testBooleanArray() { return boolean[].class.isPrimitive(); }</span>
146     }
147 
148     static class StaticConstants {
149         static boolean testBoolean() { return staticClassBoolean.isPrimitive(); }
150         static boolean testByte()    { return staticClassByte.isPrimitive();    }
151         static boolean testShort()   { return staticClassShort.isPrimitive();   }
152         static boolean testChar()    { return staticClassChar.isPrimitive();    }
153         static boolean testInt()     { return staticClassInt.isPrimitive();     }
154         static boolean testFloat()   { return staticClassFloat.isPrimitive();   }
155         static boolean testLong()    { return staticClassLong.isPrimitive();    }
156         static boolean testDouble()  { return staticClassDouble.isPrimitive();  }
157         static boolean testObject()  { return staticClassObject.isPrimitive();  }
158         static boolean testArray()   { return staticClassArray.isPrimitive();   }
159         static boolean testNull()    { return staticClassNull.isPrimitive();    }
<span class="line-added">160         static boolean testBooleanArray() { return staticClassBooleanArray.isPrimitive(); }</span>
161     }
162 
163     static class NoConstants {
164         static boolean testBoolean() { return classBoolean.isPrimitive(); }
165         static boolean testByte()    { return classByte.isPrimitive();    }
166         static boolean testShort()   { return classShort.isPrimitive();   }
167         static boolean testChar()    { return classChar.isPrimitive();    }
168         static boolean testInt()     { return classInt.isPrimitive();     }
169         static boolean testFloat()   { return classFloat.isPrimitive();   }
170         static boolean testLong()    { return classLong.isPrimitive();    }
171         static boolean testDouble()  { return classDouble.isPrimitive();  }
172         static boolean testObject()  { return classObject.isPrimitive();  }
173         static boolean testArray()   { return classArray.isPrimitive();   }
174         static boolean testNull()    { return classNull.isPrimitive();    }
<span class="line-added">175         static boolean testBooleanArray() { return classBooleanArray.isPrimitive();    }</span>
176     }
177 
<span class="line-added">178 </span>
179 }
180 
</pre>
</td>
</tr>
</table>
<center><a href="CastNullCheckDroppingsTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../sha/cli/SHAOptionsBase.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>