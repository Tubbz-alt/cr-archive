<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/gc/arguments/TestObjectTenuringFlags.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="TestNewSizeThreadIncrease.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestParallelGCThreads.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/gc/arguments/TestObjectTenuringFlags.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
146     runTenuringFlagsConsistencyTest(
147         new String[]{&quot;-XX:InitialTenuringThreshold=16&quot;},
148         true /* shouldFail */,
149         new ExpectedTenuringFlags());
150 
151     runTenuringFlagsConsistencyTest(
152         new String[]{&quot;-XX:InitialTenuringThreshold=17&quot;},
153         true /* shouldFail */,
154         new ExpectedTenuringFlags());
155   }
156 
157   private static void runTenuringFlagsConsistencyTest(String[] tenuringFlags,
158           boolean shouldFail,
159           ExpectedTenuringFlags expectedFlags) throws Exception {
160     List&lt;String&gt; vmOpts = new ArrayList&lt;&gt;();
161     if (tenuringFlags.length &gt; 0) {
162       Collections.addAll(vmOpts, tenuringFlags);
163     }
164     Collections.addAll(vmOpts, &quot;-XX:+UseParallelGC&quot;, &quot;-XX:+PrintFlagsFinal&quot;, &quot;-version&quot;);
165 
<span class="line-modified">166     ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(vmOpts.toArray(new String[vmOpts.size()]));</span>
167     OutputAnalyzer output = new OutputAnalyzer(pb.start());
168 
169     if (shouldFail) {
170       output.shouldHaveExitValue(1);
171     } else {
172       output.shouldHaveExitValue(0);
173       String stdout = output.getStdout();
174       checkTenuringFlagsConsistency(stdout, expectedFlags);
175     }
176   }
177 
178   private static void checkTenuringFlagsConsistency(String output, ExpectedTenuringFlags expectedFlags) {
179     if (expectedFlags.alwaysTenure != FlagsValue.getFlagBoolValue(&quot;AlwaysTenure&quot;, output)) {
180       throw new RuntimeException(
181             &quot;Actual flag AlwaysTenure &quot; + FlagsValue.getFlagBoolValue(&quot;AlwaysTenure&quot;, output) +
182             &quot; is not equal to expected flag AlwaysTenure &quot; + expectedFlags.alwaysTenure);
183     }
184 
185     if (expectedFlags.neverTenure != FlagsValue.getFlagBoolValue(&quot;NeverTenure&quot;, output)) {
186       throw new RuntimeException(
</pre>
</td>
<td>
<hr />
<pre>
146     runTenuringFlagsConsistencyTest(
147         new String[]{&quot;-XX:InitialTenuringThreshold=16&quot;},
148         true /* shouldFail */,
149         new ExpectedTenuringFlags());
150 
151     runTenuringFlagsConsistencyTest(
152         new String[]{&quot;-XX:InitialTenuringThreshold=17&quot;},
153         true /* shouldFail */,
154         new ExpectedTenuringFlags());
155   }
156 
157   private static void runTenuringFlagsConsistencyTest(String[] tenuringFlags,
158           boolean shouldFail,
159           ExpectedTenuringFlags expectedFlags) throws Exception {
160     List&lt;String&gt; vmOpts = new ArrayList&lt;&gt;();
161     if (tenuringFlags.length &gt; 0) {
162       Collections.addAll(vmOpts, tenuringFlags);
163     }
164     Collections.addAll(vmOpts, &quot;-XX:+UseParallelGC&quot;, &quot;-XX:+PrintFlagsFinal&quot;, &quot;-version&quot;);
165 
<span class="line-modified">166     ProcessBuilder pb = GCArguments.createJavaProcessBuilder(vmOpts.toArray(new String[vmOpts.size()]));</span>
167     OutputAnalyzer output = new OutputAnalyzer(pb.start());
168 
169     if (shouldFail) {
170       output.shouldHaveExitValue(1);
171     } else {
172       output.shouldHaveExitValue(0);
173       String stdout = output.getStdout();
174       checkTenuringFlagsConsistency(stdout, expectedFlags);
175     }
176   }
177 
178   private static void checkTenuringFlagsConsistency(String output, ExpectedTenuringFlags expectedFlags) {
179     if (expectedFlags.alwaysTenure != FlagsValue.getFlagBoolValue(&quot;AlwaysTenure&quot;, output)) {
180       throw new RuntimeException(
181             &quot;Actual flag AlwaysTenure &quot; + FlagsValue.getFlagBoolValue(&quot;AlwaysTenure&quot;, output) +
182             &quot; is not equal to expected flag AlwaysTenure &quot; + expectedFlags.alwaysTenure);
183     }
184 
185     if (expectedFlags.neverTenure != FlagsValue.getFlagBoolValue(&quot;NeverTenure&quot;, output)) {
186       throw new RuntimeException(
</pre>
</td>
</tr>
</table>
<center><a href="TestNewSizeThreadIncrease.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestParallelGCThreads.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>