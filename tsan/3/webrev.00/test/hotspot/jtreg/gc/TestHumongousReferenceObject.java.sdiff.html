<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/gc/TestHumongousReferenceObject.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="TestGenerationPerfCounter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestMemoryMXBeansAndPoolsPresence.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/gc/TestHumongousReferenceObject.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package gc;
 25 
 26 import jdk.internal.vm.annotation.Contended;
 27 
 28 /*
<span class="line-modified"> 29  * @test</span>
<span class="line-modified"> 30  * @summary Test that verifies that iteration over large, plain Java objects, that potentially cross region boundaries on G1, with references in them works.</span>
<span class="line-modified"> 31  * @requires vm.gc == &quot;null&quot;</span>
 32  * @bug 8151499 8153734
 33  * @modules java.base/jdk.internal.vm.annotation
 34  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseParallelGC -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject








 35  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseG1GC -XX:G1HeapRegionSize=1M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject
 36  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseG1GC -XX:G1HeapRegionSize=2M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject
 37  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseG1GC -XX:G1HeapRegionSize=4M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject
 38  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseG1GC -XX:G1HeapRegionSize=8M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject
 39  */
 40 
 41 /*
 42  * @test TestHumongousReferenceObjectShenandoah
 43  * @summary Test that verifies that iteration over large, plain Java objects, that potentially cross region boundaries, with references in them works.
<span class="line-modified"> 44  * @requires vm.gc.Shenandoah</span>
 45  * @bug 8151499 8153734
 46  * @modules java.base/jdk.internal.vm.annotation
<span class="line-modified"> 47  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahHeapRegionSize=8M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject</span>
<span class="line-modified"> 48  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahHeapRegionSize=8M -XX:ContendedPaddingWidth=8192 -XX:+UnlockDiagnosticVMOptions -XX:+ShenandoahVerify gc.TestHumongousReferenceObject</span>
 49  */
 50 public class TestHumongousReferenceObject {
 51 
 52     /*
 53       Due to 300 fields with 8K @Contended padding around each field, it takes 2.4M bytes per instance.
 54       With small G1 regions, it is bound to cross regions. G1 should properly (card) mark the object nevertheless.
 55       With 128M heap, it is enough to allocate ~100 of these objects to provoke at least one GC.
 56      */
 57 
 58     static volatile Object instance;
 59 
 60     public static void main(String[] args) {
 61         for (int c = 0; c &lt; 100; c++) {
 62             instance = new TestHumongousReferenceObject();
 63         }
 64     }
 65 
 66     @Contended Integer int_1 = new Integer(1);
 67     @Contended Integer int_2 = new Integer(2);
 68     @Contended Integer int_3 = new Integer(3);
</pre>
</td>
<td>
<hr />
<pre>
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package gc;
 25 
 26 import jdk.internal.vm.annotation.Contended;
 27 
 28 /*
<span class="line-modified"> 29  * @test TestHumongousReferenceObjectParallel</span>
<span class="line-modified"> 30  * @summary Test that verifies that iteration over large, plain Java objects, that potentially cross region boundaries, with references in them works.</span>
<span class="line-modified"> 31  * @requires vm.gc.Parallel</span>
 32  * @bug 8151499 8153734
 33  * @modules java.base/jdk.internal.vm.annotation
 34  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseParallelGC -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject
<span class="line-added"> 35  */</span>
<span class="line-added"> 36 </span>
<span class="line-added"> 37 /*</span>
<span class="line-added"> 38  * @test TestHumongousReferenceObjectG1</span>
<span class="line-added"> 39  * @summary Test that verifies that iteration over large, plain Java objects, that potentially cross region boundaries on G1, with references in them works.</span>
<span class="line-added"> 40  * @requires vm.gc.G1</span>
<span class="line-added"> 41  * @bug 8151499 8153734</span>
<span class="line-added"> 42  * @modules java.base/jdk.internal.vm.annotation</span>
 43  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseG1GC -XX:G1HeapRegionSize=1M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject
 44  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseG1GC -XX:G1HeapRegionSize=2M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject
 45  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseG1GC -XX:G1HeapRegionSize=4M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject
 46  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xmx128m -XX:+UseG1GC -XX:G1HeapRegionSize=8M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject
 47  */
 48 
 49 /*
 50  * @test TestHumongousReferenceObjectShenandoah
 51  * @summary Test that verifies that iteration over large, plain Java objects, that potentially cross region boundaries, with references in them works.
<span class="line-modified"> 52  * @requires vm.gc.Shenandoah &amp; !vm.graal.enabled</span>
 53  * @bug 8151499 8153734
 54  * @modules java.base/jdk.internal.vm.annotation
<span class="line-modified"> 55  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xms128m -Xmx128m -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahHeapRegionSize=8M -XX:ContendedPaddingWidth=8192 gc.TestHumongousReferenceObject</span>
<span class="line-modified"> 56  * @run main/othervm -XX:+EnableContended -XX:-RestrictContended -Xms128m -Xmx128m -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahHeapRegionSize=8M -XX:ContendedPaddingWidth=8192 -XX:+UnlockDiagnosticVMOptions -XX:+ShenandoahVerify gc.TestHumongousReferenceObject</span>
 57  */
 58 public class TestHumongousReferenceObject {
 59 
 60     /*
 61       Due to 300 fields with 8K @Contended padding around each field, it takes 2.4M bytes per instance.
 62       With small G1 regions, it is bound to cross regions. G1 should properly (card) mark the object nevertheless.
 63       With 128M heap, it is enough to allocate ~100 of these objects to provoke at least one GC.
 64      */
 65 
 66     static volatile Object instance;
 67 
 68     public static void main(String[] args) {
 69         for (int c = 0; c &lt; 100; c++) {
 70             instance = new TestHumongousReferenceObject();
 71         }
 72     }
 73 
 74     @Contended Integer int_1 = new Integer(1);
 75     @Contended Integer int_2 = new Integer(2);
 76     @Contended Integer int_3 = new Integer(3);
</pre>
</td>
</tr>
</table>
<center><a href="TestGenerationPerfCounter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestMemoryMXBeansAndPoolsPresence.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>