<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/jtreg/testlibrary/ctw/src/sun/hotspot/tools/ctw/CtwRunner.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Compiler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../jittester/src/jdk/test/lib/jittester/AotTestGeneratorsFactory.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/testlibrary/ctw/src/sun/hotspot/tools/ctw/CtwRunner.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
241             String line = reader.lines()
242                     .filter(IS_CLASS_LINE)
243                     .reduce((a, b) -&gt; b)
244                     .orElse(null);
245             if (line != null) {
246                 int open = line.indexOf(&#39;[&#39;) + 1;
247                 int close = line.indexOf(&#39;]&#39;);
248                 long index = Long.parseLong(line.substring(open, close));
249                 String name = line.substring(close + 1).trim().replace(&#39;.&#39;, &#39;/&#39;);
250                 return new Pair&lt;&gt;(name, index);
251             }
252         } catch (IOException ioe) {
253             throw new Error(&quot;can not read &quot; + errFile + &quot; : &quot;
254                     + ioe.getMessage(), ioe);
255         }
256         return null;
257     }
258 
259     private String[] cmd(long classStart, long classStop) {
260         String phase = phaseName(classStart);
<span class="line-modified">261         return new String[] {</span>
<span class="line-modified">262                 &quot;-Xbatch&quot;,</span>
<span class="line-modified">263                 &quot;-XX:-UseCounterDecay&quot;,</span>
<span class="line-modified">264                 &quot;-XX:-ShowMessageBoxOnError&quot;,</span>
<span class="line-modified">265                 &quot;-XX:+UnlockDiagnosticVMOptions&quot;,</span>
<span class="line-modified">266                 // redirect VM output to cerr so it won&#39;t collide w/ ctw output</span>
<span class="line-modified">267                 &quot;-XX:+DisplayVMOutputToStderr&quot;,</span>
<span class="line-modified">268                 // define phase start</span>
<span class="line-modified">269                 &quot;-DCompileTheWorldStartAt=&quot; + classStart,</span>
<span class="line-modified">270                 &quot;-DCompileTheWorldStopAt=&quot; + classStop,</span>
<span class="line-modified">271                 // CTW library uses WhiteBox API</span>
<span class="line-modified">272                 &quot;-XX:+WhiteBoxAPI&quot;, &quot;-Xbootclasspath/a:.&quot;,</span>
<span class="line-modified">273                 // export jdk.internal packages used by CTW library</span>
<span class="line-modified">274                 &quot;--add-exports&quot;, &quot;java.base/jdk.internal.jimage=ALL-UNNAMED&quot;,</span>
<span class="line-modified">275                 &quot;--add-exports&quot;, &quot;java.base/jdk.internal.misc=ALL-UNNAMED&quot;,</span>
<span class="line-modified">276                 &quot;--add-exports&quot;, &quot;java.base/jdk.internal.reflect=ALL-UNNAMED&quot;,</span>
<span class="line-modified">277                 &quot;--add-exports&quot;, &quot;java.base/jdk.internal.access=ALL-UNNAMED&quot;,</span>
<span class="line-modified">278                 // enable diagnostic logging</span>
<span class="line-modified">279                 &quot;-XX:+LogCompilation&quot;,</span>
<span class="line-modified">280                 // use phase specific log, hs_err and ciReplay files</span>
<span class="line-modified">281                 String.format(&quot;-XX:LogFile=hotspot_%s_%%p.log&quot;, phase),</span>
<span class="line-modified">282                 String.format(&quot;-XX:ErrorFile=hs_err_%s_%%p.log&quot;, phase),</span>
<span class="line-modified">283                 String.format(&quot;-XX:ReplayDataFile=replay_%s_%%p.log&quot;, phase),</span>
<span class="line-modified">284                 // MethodHandle MUST NOT be compiled</span>
<span class="line-modified">285                 &quot;-XX:CompileCommand=exclude,java/lang/invoke/MethodHandle.*&quot;,</span>
<span class="line-modified">286                 // CTW entry point</span>
<span class="line-modified">287                 CompileTheWorld.class.getName(),</span>
<span class="line-modified">288                 target,</span>
<span class="line-modified">289         };</span>





290     }
291 
292     private String phaseName(long classStart) {
293         return String.format(&quot;%s_%d&quot;, targetName, classStart);
294     }
295 
296 }
</pre>
</td>
<td>
<hr />
<pre>
241             String line = reader.lines()
242                     .filter(IS_CLASS_LINE)
243                     .reduce((a, b) -&gt; b)
244                     .orElse(null);
245             if (line != null) {
246                 int open = line.indexOf(&#39;[&#39;) + 1;
247                 int close = line.indexOf(&#39;]&#39;);
248                 long index = Long.parseLong(line.substring(open, close));
249                 String name = line.substring(close + 1).trim().replace(&#39;.&#39;, &#39;/&#39;);
250                 return new Pair&lt;&gt;(name, index);
251             }
252         } catch (IOException ioe) {
253             throw new Error(&quot;can not read &quot; + errFile + &quot; : &quot;
254                     + ioe.getMessage(), ioe);
255         }
256         return null;
257     }
258 
259     private String[] cmd(long classStart, long classStop) {
260         String phase = phaseName(classStart);
<span class="line-modified">261         Path file = Paths.get(phase + &quot;.cmd&quot;);</span>
<span class="line-modified">262         try {</span>
<span class="line-modified">263             Files.write(file, List.of(</span>
<span class="line-modified">264                     &quot;-Xbatch&quot;,</span>
<span class="line-modified">265                     &quot;-XX:-UseCounterDecay&quot;,</span>
<span class="line-modified">266                     &quot;-XX:-ShowMessageBoxOnError&quot;,</span>
<span class="line-modified">267                     &quot;-XX:+UnlockDiagnosticVMOptions&quot;,</span>
<span class="line-modified">268                     // redirect VM output to cerr so it won&#39;t collide w/ ctw output</span>
<span class="line-modified">269                     &quot;-XX:+DisplayVMOutputToStderr&quot;,</span>
<span class="line-modified">270                     // define phase start</span>
<span class="line-modified">271                     &quot;-DCompileTheWorldStartAt=&quot; + classStart,</span>
<span class="line-modified">272                     &quot;-DCompileTheWorldStopAt=&quot; + classStop,</span>
<span class="line-modified">273                     // CTW library uses WhiteBox API</span>
<span class="line-modified">274                     &quot;-XX:+WhiteBoxAPI&quot;, &quot;-Xbootclasspath/a:.&quot;,</span>
<span class="line-modified">275                     // export jdk.internal packages used by CTW library</span>
<span class="line-modified">276                     &quot;--add-exports&quot;, &quot;java.base/jdk.internal.jimage=ALL-UNNAMED&quot;,</span>
<span class="line-modified">277                     &quot;--add-exports&quot;, &quot;java.base/jdk.internal.misc=ALL-UNNAMED&quot;,</span>
<span class="line-modified">278                     &quot;--add-exports&quot;, &quot;java.base/jdk.internal.reflect=ALL-UNNAMED&quot;,</span>
<span class="line-modified">279                     &quot;--add-exports&quot;, &quot;java.base/jdk.internal.access=ALL-UNNAMED&quot;,</span>
<span class="line-modified">280                     // enable diagnostic logging</span>
<span class="line-modified">281                     &quot;-XX:+LogCompilation&quot;,</span>
<span class="line-modified">282                     // use phase specific log, hs_err and ciReplay files</span>
<span class="line-modified">283                     String.format(&quot;-XX:LogFile=hotspot_%s_%%p.log&quot;, phase),</span>
<span class="line-modified">284                     String.format(&quot;-XX:ErrorFile=hs_err_%s_%%p.log&quot;, phase),</span>
<span class="line-modified">285                     String.format(&quot;-XX:ReplayDataFile=replay_%s_%%p.log&quot;, phase),</span>
<span class="line-modified">286                     // MethodHandle MUST NOT be compiled</span>
<span class="line-modified">287                     &quot;-XX:CompileCommand=exclude,java/lang/invoke/MethodHandle.*&quot;,</span>
<span class="line-modified">288                     // CTW entry point</span>
<span class="line-modified">289                     CompileTheWorld.class.getName(),</span>
<span class="line-added">290                     target));</span>
<span class="line-added">291         } catch (IOException e) {</span>
<span class="line-added">292             throw new Error(&quot;can&#39;t create &quot; + file, e);</span>
<span class="line-added">293         }</span>
<span class="line-added">294         return new String[]{ &quot;@&quot; + file.toAbsolutePath() };</span>
295     }
296 
297     private String phaseName(long classStart) {
298         return String.format(&quot;%s_%d&quot;, targetName, classStart);
299     }
300 
301 }
</pre>
</td>
</tr>
</table>
<center><a href="Compiler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../jittester/src/jdk/test/lib/jittester/AotTestGeneratorsFactory.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>