<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/jtreg/testlibrary/ctw/src/sun/hotspot/tools/ctw/CtwRunner.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Compiler.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../jittester/src/jdk/test/lib/jittester/AotTestGeneratorsFactory.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/jtreg/testlibrary/ctw/src/sun/hotspot/tools/ctw/CtwRunner.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -256,39 +256,44 @@</span>
          return null;
      }
  
      private String[] cmd(long classStart, long classStop) {
          String phase = phaseName(classStart);
<span class="udiff-line-modified-removed">-         return new String[] {</span>
<span class="udiff-line-modified-removed">-                 &quot;-Xbatch&quot;,</span>
<span class="udiff-line-modified-removed">-                 &quot;-XX:-UseCounterDecay&quot;,</span>
<span class="udiff-line-modified-removed">-                 &quot;-XX:-ShowMessageBoxOnError&quot;,</span>
<span class="udiff-line-modified-removed">-                 &quot;-XX:+UnlockDiagnosticVMOptions&quot;,</span>
<span class="udiff-line-modified-removed">-                 // redirect VM output to cerr so it won&#39;t collide w/ ctw output</span>
<span class="udiff-line-modified-removed">-                 &quot;-XX:+DisplayVMOutputToStderr&quot;,</span>
<span class="udiff-line-modified-removed">-                 // define phase start</span>
<span class="udiff-line-modified-removed">-                 &quot;-DCompileTheWorldStartAt=&quot; + classStart,</span>
<span class="udiff-line-modified-removed">-                 &quot;-DCompileTheWorldStopAt=&quot; + classStop,</span>
<span class="udiff-line-modified-removed">-                 // CTW library uses WhiteBox API</span>
<span class="udiff-line-modified-removed">-                 &quot;-XX:+WhiteBoxAPI&quot;, &quot;-Xbootclasspath/a:.&quot;,</span>
<span class="udiff-line-modified-removed">-                 // export jdk.internal packages used by CTW library</span>
<span class="udiff-line-modified-removed">-                 &quot;--add-exports&quot;, &quot;java.base/jdk.internal.jimage=ALL-UNNAMED&quot;,</span>
<span class="udiff-line-modified-removed">-                 &quot;--add-exports&quot;, &quot;java.base/jdk.internal.misc=ALL-UNNAMED&quot;,</span>
<span class="udiff-line-modified-removed">-                 &quot;--add-exports&quot;, &quot;java.base/jdk.internal.reflect=ALL-UNNAMED&quot;,</span>
<span class="udiff-line-modified-removed">-                 &quot;--add-exports&quot;, &quot;java.base/jdk.internal.access=ALL-UNNAMED&quot;,</span>
<span class="udiff-line-modified-removed">-                 // enable diagnostic logging</span>
<span class="udiff-line-modified-removed">-                 &quot;-XX:+LogCompilation&quot;,</span>
<span class="udiff-line-modified-removed">-                 // use phase specific log, hs_err and ciReplay files</span>
<span class="udiff-line-modified-removed">-                 String.format(&quot;-XX:LogFile=hotspot_%s_%%p.log&quot;, phase),</span>
<span class="udiff-line-modified-removed">-                 String.format(&quot;-XX:ErrorFile=hs_err_%s_%%p.log&quot;, phase),</span>
<span class="udiff-line-modified-removed">-                 String.format(&quot;-XX:ReplayDataFile=replay_%s_%%p.log&quot;, phase),</span>
<span class="udiff-line-modified-removed">-                 // MethodHandle MUST NOT be compiled</span>
<span class="udiff-line-modified-removed">-                 &quot;-XX:CompileCommand=exclude,java/lang/invoke/MethodHandle.*&quot;,</span>
<span class="udiff-line-modified-removed">-                 // CTW entry point</span>
<span class="udiff-line-modified-removed">-                 CompileTheWorld.class.getName(),</span>
<span class="udiff-line-modified-removed">-                 target,</span>
<span class="udiff-line-modified-removed">-         };</span>
<span class="udiff-line-modified-added">+         Path file = Paths.get(phase + &quot;.cmd&quot;);</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             Files.write(file, List.of(</span>
<span class="udiff-line-modified-added">+                     &quot;-Xbatch&quot;,</span>
<span class="udiff-line-modified-added">+                     &quot;-XX:-UseCounterDecay&quot;,</span>
<span class="udiff-line-modified-added">+                     &quot;-XX:-ShowMessageBoxOnError&quot;,</span>
<span class="udiff-line-modified-added">+                     &quot;-XX:+UnlockDiagnosticVMOptions&quot;,</span>
<span class="udiff-line-modified-added">+                     // redirect VM output to cerr so it won&#39;t collide w/ ctw output</span>
<span class="udiff-line-modified-added">+                     &quot;-XX:+DisplayVMOutputToStderr&quot;,</span>
<span class="udiff-line-modified-added">+                     // define phase start</span>
<span class="udiff-line-modified-added">+                     &quot;-DCompileTheWorldStartAt=&quot; + classStart,</span>
<span class="udiff-line-modified-added">+                     &quot;-DCompileTheWorldStopAt=&quot; + classStop,</span>
<span class="udiff-line-modified-added">+                     // CTW library uses WhiteBox API</span>
<span class="udiff-line-modified-added">+                     &quot;-XX:+WhiteBoxAPI&quot;, &quot;-Xbootclasspath/a:.&quot;,</span>
<span class="udiff-line-modified-added">+                     // export jdk.internal packages used by CTW library</span>
<span class="udiff-line-modified-added">+                     &quot;--add-exports&quot;, &quot;java.base/jdk.internal.jimage=ALL-UNNAMED&quot;,</span>
<span class="udiff-line-modified-added">+                     &quot;--add-exports&quot;, &quot;java.base/jdk.internal.misc=ALL-UNNAMED&quot;,</span>
<span class="udiff-line-modified-added">+                     &quot;--add-exports&quot;, &quot;java.base/jdk.internal.reflect=ALL-UNNAMED&quot;,</span>
<span class="udiff-line-modified-added">+                     &quot;--add-exports&quot;, &quot;java.base/jdk.internal.access=ALL-UNNAMED&quot;,</span>
<span class="udiff-line-modified-added">+                     // enable diagnostic logging</span>
<span class="udiff-line-modified-added">+                     &quot;-XX:+LogCompilation&quot;,</span>
<span class="udiff-line-modified-added">+                     // use phase specific log, hs_err and ciReplay files</span>
<span class="udiff-line-modified-added">+                     String.format(&quot;-XX:LogFile=hotspot_%s_%%p.log&quot;, phase),</span>
<span class="udiff-line-modified-added">+                     String.format(&quot;-XX:ErrorFile=hs_err_%s_%%p.log&quot;, phase),</span>
<span class="udiff-line-modified-added">+                     String.format(&quot;-XX:ReplayDataFile=replay_%s_%%p.log&quot;, phase),</span>
<span class="udiff-line-modified-added">+                     // MethodHandle MUST NOT be compiled</span>
<span class="udiff-line-modified-added">+                     &quot;-XX:CompileCommand=exclude,java/lang/invoke/MethodHandle.*&quot;,</span>
<span class="udiff-line-modified-added">+                     // CTW entry point</span>
<span class="udiff-line-modified-added">+                     CompileTheWorld.class.getName(),</span>
<span class="udiff-line-added">+                     target));</span>
<span class="udiff-line-added">+         } catch (IOException e) {</span>
<span class="udiff-line-added">+             throw new Error(&quot;can&#39;t create &quot; + file, e);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return new String[]{ &quot;@&quot; + file.toAbsolutePath() };</span>
      }
  
      private String phaseName(long classStart) {
          return String.format(&quot;%s_%d&quot;, targetName, classStart);
      }
</pre>
<center><a href="Compiler.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../jittester/src/jdk/test/lib/jittester/AotTestGeneratorsFactory.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>