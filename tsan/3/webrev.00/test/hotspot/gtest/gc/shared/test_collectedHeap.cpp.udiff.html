<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/gtest/gc/shared/test_collectedHeap.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../parallel/test_psParallelCompact.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="test_collectorPolicy.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/gtest/gc/shared/test_collectedHeap.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -21,33 +21,21 @@</span>
   * questions.
   */
  
  #include &quot;precompiled.hpp&quot;
  #include &quot;gc/shared/collectedHeap.hpp&quot;
<span class="udiff-line-added">+ #include &quot;memory/universe.hpp&quot;</span>
  #include &quot;unittest.hpp&quot;
  
  TEST_VM(CollectedHeap, is_in) {
    CollectedHeap* heap = Universe::heap();
  
    uintptr_t epsilon = (uintptr_t) MinObjAlignment;
<span class="udiff-line-modified-removed">-   uintptr_t heap_start = (uintptr_t) heap-&gt;reserved_region().start();</span>
<span class="udiff-line-removed">-   uintptr_t heap_end = (uintptr_t) heap-&gt;reserved_region().end();</span>
<span class="udiff-line-modified-added">+   uintptr_t outside_heap = (uintptr_t) &amp;epsilon;</span>
  
    // Test that NULL is not in the heap.
    ASSERT_FALSE(heap-&gt;is_in(NULL)) &lt;&lt; &quot;NULL is unexpectedly in the heap&quot;;
  
<span class="udiff-line-modified-removed">-   // Test that a pointer to before the heap start is reported as outside the heap.</span>
<span class="udiff-line-modified-removed">-   ASSERT_GE(heap_start, ((uintptr_t) NULL + epsilon))</span>
<span class="udiff-line-removed">-           &lt;&lt; &quot;Sanity check - heap should not start at 0&quot;;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   void* before_heap = (void*) (heap_start - epsilon);</span>
<span class="udiff-line-removed">-   ASSERT_FALSE(heap-&gt;is_in(before_heap)) &lt;&lt; &quot;before_heap: &quot; &lt;&lt; p2i(before_heap)</span>
<span class="udiff-line-removed">-           &lt;&lt; &quot; is unexpectedly in the heap&quot;;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   // Test that a pointer to after the heap end is reported as outside the heap.</span>
<span class="udiff-line-removed">-   ASSERT_LE(heap_end, ((uintptr_t)-1 - epsilon))</span>
<span class="udiff-line-removed">-           &lt;&lt; &quot;Sanity check - heap should not end at the end of address space&quot;;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-   void* after_heap = (void*) (heap_end + epsilon);</span>
<span class="udiff-line-removed">-   ASSERT_FALSE(heap-&gt;is_in(after_heap)) &lt;&lt; &quot;after_heap: &quot; &lt;&lt; p2i(after_heap)</span>
<span class="udiff-line-modified-added">+   // Test that a pointer to outside the heap start is reported as outside the heap.</span>
<span class="udiff-line-modified-added">+   ASSERT_FALSE(heap-&gt;is_in((void*)outside_heap)) &lt;&lt; &quot;outside_heap: &quot; &lt;&lt; outside_heap</span>
            &lt;&lt; &quot; is unexpectedly in the heap&quot;;
  }
</pre>
<center><a href="../parallel/test_psParallelCompact.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="test_collectorPolicy.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>