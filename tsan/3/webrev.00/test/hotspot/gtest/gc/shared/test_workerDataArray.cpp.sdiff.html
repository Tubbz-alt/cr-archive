<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/gtest/gc/shared/test_workerDataArray.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="test_ptrQueueBufferAllocator.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../z/test_zAddress.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/gtest/gc/shared/test_workerDataArray.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 #include &quot;precompiled.hpp&quot;
 25 #include &quot;gc/shared/workerDataArray.inline.hpp&quot;
 26 #include &quot;memory/resourceArea.hpp&quot;
 27 #include &quot;unittest.hpp&quot;
 28 #include &quot;utilities/ostream.hpp&quot;
 29 
 30 static const double epsilon = 0.0001;
 31 
 32 template&lt;typename T&gt;
 33 class WorkerDataArrayTest : public ::testing::Test {
 34  protected:
 35   WorkerDataArrayTest() :
 36     title(&quot;Test array&quot;),
<span class="line-modified"> 37     array(3, title),</span>
<span class="line-modified"> 38     sub_item_title(&quot;Sub item array&quot;),</span>
<span class="line-removed"> 39     sub_item(3, sub_item_title) {</span>
 40 
<span class="line-modified"> 41     array.link_thread_work_items(&amp;sub_item);</span>
 42   }
 43 
 44   const char* print_summary() {
 45     stringStream out;
 46     array.print_summary_on(&amp;out);
 47     return out.as_string();
 48   }
 49 
 50   const char* print_details() {
 51     stringStream out;
 52     array.print_details_on(&amp;out);
 53     return out.as_string();
 54   }
 55 
 56   const char* print_expected_summary() {
 57     return prepend_with(title, expected_summary());
 58   }
 59 
 60   const char* print_expected_details() {
 61     return prepend_with(&quot;&quot;, expected_details());
 62   }
 63 
 64   // returns expected summary for array without uninitialized elements
 65   // used it because string representation of double depends on locale
 66   static const char* format_summary(
 67     T min, double avg, T max, T diff, T sum, size_t workers);
 68 
 69   const char* title;
 70   WorkerDataArray&lt;T&gt; array;
 71 
 72   const char* sub_item_title;
<span class="line-removed"> 73   WorkerDataArray&lt;size_t&gt; sub_item;</span>
 74 
 75  private:
 76   virtual const char* expected_summary() = 0;
 77   virtual const char* expected_details() = 0;
 78 
 79   static const char* prepend_with(const char* str, const char* orig) {
 80     stringStream out;
 81     out.print(&quot;%-25s&quot;, str);
 82     out.print(&quot;%s&quot;, orig);
 83     return out.as_string();
 84   }
 85 
 86   ResourceMark rm;
 87 };
 88 
 89 template&lt;&gt;
 90 const char* WorkerDataArrayTest&lt;size_t&gt;::format_summary(
 91   size_t min, double avg, size_t max, size_t diff, size_t sum, size_t workers) {
 92 
 93   stringStream out;
</pre>
</td>
<td>
<hr />
<pre>
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 #include &quot;precompiled.hpp&quot;
 25 #include &quot;gc/shared/workerDataArray.inline.hpp&quot;
 26 #include &quot;memory/resourceArea.hpp&quot;
 27 #include &quot;unittest.hpp&quot;
 28 #include &quot;utilities/ostream.hpp&quot;
 29 
 30 static const double epsilon = 0.0001;
 31 
 32 template&lt;typename T&gt;
 33 class WorkerDataArrayTest : public ::testing::Test {
 34  protected:
 35   WorkerDataArrayTest() :
 36     title(&quot;Test array&quot;),
<span class="line-modified"> 37     array(title, 3),</span>
<span class="line-modified"> 38     sub_item_title(&quot;Sub item array&quot;) {</span>

 39 
<span class="line-modified"> 40     array.create_thread_work_items(sub_item_title);</span>
 41   }
 42 
 43   const char* print_summary() {
 44     stringStream out;
 45     array.print_summary_on(&amp;out);
 46     return out.as_string();
 47   }
 48 
 49   const char* print_details() {
 50     stringStream out;
 51     array.print_details_on(&amp;out);
 52     return out.as_string();
 53   }
 54 
 55   const char* print_expected_summary() {
 56     return prepend_with(title, expected_summary());
 57   }
 58 
 59   const char* print_expected_details() {
 60     return prepend_with(&quot;&quot;, expected_details());
 61   }
 62 
 63   // returns expected summary for array without uninitialized elements
 64   // used it because string representation of double depends on locale
 65   static const char* format_summary(
 66     T min, double avg, T max, T diff, T sum, size_t workers);
 67 
 68   const char* title;
 69   WorkerDataArray&lt;T&gt; array;
 70 
 71   const char* sub_item_title;

 72 
 73  private:
 74   virtual const char* expected_summary() = 0;
 75   virtual const char* expected_details() = 0;
 76 
 77   static const char* prepend_with(const char* str, const char* orig) {
 78     stringStream out;
 79     out.print(&quot;%-25s&quot;, str);
 80     out.print(&quot;%s&quot;, orig);
 81     return out.as_string();
 82   }
 83 
 84   ResourceMark rm;
 85 };
 86 
 87 template&lt;&gt;
 88 const char* WorkerDataArrayTest&lt;size_t&gt;::format_summary(
 89   size_t min, double avg, size_t max, size_t diff, size_t sum, size_t workers) {
 90 
 91   stringStream out;
</pre>
</td>
</tr>
</table>
<center><a href="test_ptrQueueBufferAllocator.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../z/test_zAddress.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>