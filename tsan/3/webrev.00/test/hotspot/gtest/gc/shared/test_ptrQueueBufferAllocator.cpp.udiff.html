<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/gtest/gc/shared/test_ptrQueueBufferAllocator.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="test_preservedMarks.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="test_workerDataArray.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/gtest/gc/shared/test_ptrQueueBufferAllocator.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -24,11 +24,11 @@</span>
  
  #include &quot;precompiled.hpp&quot;
  #include &quot;gc/shared/ptrQueue.hpp&quot;
  #include &quot;memory/allocation.hpp&quot;
  #include &quot;runtime/interfaceSupport.inline.hpp&quot;
<span class="udiff-line-modified-removed">- #include &quot;runtime/orderAccess.hpp&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;runtime/atomic.hpp&quot;</span>
  #include &quot;runtime/semaphore.inline.hpp&quot;
  #include &quot;runtime/thread.hpp&quot;
  #include &quot;utilities/globalCounter.inline.hpp&quot;
  #include &quot;utilities/globalDefinitions.hpp&quot;
  #include &quot;utilities/ostream.hpp&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -148,18 +148,18 @@</span>
      _continue_running(continue_running),
      _allocations(0)
    {}
  
    virtual void main_run() {
<span class="udiff-line-modified-removed">-     while (OrderAccess::load_acquire(_continue_running)) {</span>
<span class="udiff-line-modified-added">+     while (Atomic::load_acquire(_continue_running)) {</span>
        BufferNode* node = _allocator-&gt;allocate();
        _cbl-&gt;push(node);
        ++_allocations;
        ThreadBlockInVM tbiv(this); // Safepoint check.
      }
      tty-&gt;print_cr(&quot;allocations: &quot; SIZE_FORMAT, _allocations);
<span class="udiff-line-modified-removed">-     Atomic::add(_allocations, _total_allocations);</span>
<span class="udiff-line-modified-added">+     Atomic::add(_total_allocations, _allocations);</span>
    }
  };
  
  // Simulate a GC thread, taking buffers from the completed buffer list
  // and returning them to the allocator.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -182,11 +182,11 @@</span>
    virtual void main_run() {
      while (true) {
        BufferNode* node = _cbl-&gt;pop();
        if (node != NULL) {
          _allocator-&gt;release(node);
<span class="udiff-line-modified-removed">-       } else if (!OrderAccess::load_acquire(_continue_running)) {</span>
<span class="udiff-line-modified-added">+       } else if (!Atomic::load_acquire(_continue_running)) {</span>
          return;
        }
        ThreadBlockInVM tbiv(this); // Safepoint check.
      }
    }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -222,18 +222,18 @@</span>
  
    JavaThread* this_thread = JavaThread::current();
    tty-&gt;print_cr(&quot;Stressing allocator for %u ms&quot;, milliseconds_to_run);
    {
      ThreadInVMfromNative invm(this_thread);
<span class="udiff-line-modified-removed">-     os::sleep(this_thread, milliseconds_to_run, true);</span>
<span class="udiff-line-modified-added">+     this_thread-&gt;sleep(milliseconds_to_run);</span>
    }
<span class="udiff-line-modified-removed">-   OrderAccess::release_store(&amp;allocator_running, false);</span>
<span class="udiff-line-modified-added">+   Atomic::release_store(&amp;allocator_running, false);</span>
    for (uint i = 0; i &lt; nthreads; ++i) {
      ThreadInVMfromNative invm(this_thread);
      post.wait_with_safepoint_check(this_thread);
    }
<span class="udiff-line-modified-removed">-   OrderAccess::release_store(&amp;processor_running, false);</span>
<span class="udiff-line-modified-added">+   Atomic::release_store(&amp;processor_running, false);</span>
    for (uint i = 0; i &lt; nthreads; ++i) {
      ThreadInVMfromNative invm(this_thread);
      post.wait_with_safepoint_check(this_thread);
    }
    ASSERT_TRUE(BufferNode::TestSupport::try_transfer_pending(allocator));
</pre>
<center><a href="test_preservedMarks.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="test_workerDataArray.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>