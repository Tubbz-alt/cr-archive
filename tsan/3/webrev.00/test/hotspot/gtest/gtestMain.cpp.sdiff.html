<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/hotspot/gtest/gtestMain.cpp</title>
    <link rel="stylesheet" href="../../../style.css" />
  </head>
<body>
<center><a href="gc/z/test_zVirtualMemory.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="jfr/test_networkUtilization.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/gtest/gtestMain.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
178   char** new_argv = (char**) malloc(sizeof(char*) * argc);
179   int new_argc = 0;
180 
181   int i = 0;
182   while (i &lt; argc) {
183     int args_to_skip = num_args_to_skip(argv[i]);
184     if (args_to_skip == 0) {
185       new_argv[new_argc] = argv[i];
186       i++;
187       new_argc++;
188     } else {
189       i += num_args_to_skip(argv[i]);
190     }
191   }
192 
193   *argcp = new_argc;
194   return new_argv;
195 }
196 
197 static void runUnitTestsInner(int argc, char** argv) {
<span class="line-modified">198   ::testing::InitGoogleTest(&amp;argc, argv);</span>
199   ::testing::GTEST_FLAG(death_test_style) = &quot;threadsafe&quot;;
200 
201   bool is_vmassert_test = false;
202   bool is_othervm_test = false;
203   // death tests facility is used for both regular death tests, other vm and vmassert tests
204   if (::testing::internal::GTEST_FLAG(internal_run_death_test).length() &gt; 0) {
205     // when we execute death test, filter value equals to test name
206     const char* test_name = ::testing::GTEST_FLAG(filter).c_str();
207     const char* const othervm_suffix = &quot;_other_vm_test&quot;; // TEST_OTHER_VM
208     const char* const vmassert_suffix = &quot;_vm_assert_test&quot;; // TEST_VM_ASSERT(_MSG)
209     if (is_suffix(othervm_suffix, test_name)) {
210       is_othervm_test = true;
211     } else if (is_suffix(vmassert_suffix, test_name)) {
212       is_vmassert_test = true;
213     }
214   }
215 
216   char* java_home = get_java_home_arg(argc, argv);
217   if (java_home == NULL) {
218     fprintf(stderr, &quot;ERROR: You must specify a JDK to use for running the unit tests.\n&quot;);
219     exit(1);
220   }
221 #ifndef _WIN32
222   int overwrite = 1; // overwrite an eventual existing value for JAVA_HOME
223   setenv(&quot;JAVA_HOME&quot;, java_home, overwrite);
224 
225 // workaround for JDK-7131356
226 #ifdef __APPLE__
227   size_t len = strlen(java_home) + strlen(&quot;/lib/jli/libjli.dylib&quot;) + 1;
228   char* path = new char[len];
229   snprintf(path, len, &quot;%s/lib/jli/libjli.dylib&quot;, java_home);
230   dlopen(path, RTLD_NOW | RTLD_GLOBAL);
231 #endif // __APPLE__
232 
233 #else  // _WIN32
<span class="line-modified">234   char* java_home_var = &quot;_ALT_JAVA_HOME_DIR&quot;;</span>
235   size_t len = strlen(java_home) + strlen(java_home_var) + 2;
236   char * envString = new char[len];
237   sprintf_s(envString, len, &quot;%s=%s&quot;, java_home_var, java_home);
238   _putenv(envString);
239 #endif // _WIN32
240   argv = remove_test_runner_arguments(&amp;argc, argv);
241 
242   if (is_vmassert_test || is_othervm_test) {
243     // both vmassert and other vm tests require inited jvm
244     // but only vmassert tests disable hs_err and core file generation
245     if (init_jvm(argc, argv, is_vmassert_test) != 0) {
246       abort();
247     }
248   } else {
249     ::testing::TestEventListeners&amp; listeners = ::testing::UnitTest::GetInstance()-&gt;listeners();
250     listeners.Append(new JVMInitializerListener(argc, argv));
251   }
252 
253   int result = RUN_ALL_TESTS();
254   if (result != 0) {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
</pre>
<hr />
<pre>
178   char** new_argv = (char**) malloc(sizeof(char*) * argc);
179   int new_argc = 0;
180 
181   int i = 0;
182   while (i &lt; argc) {
183     int args_to_skip = num_args_to_skip(argv[i]);
184     if (args_to_skip == 0) {
185       new_argv[new_argc] = argv[i];
186       i++;
187       new_argc++;
188     } else {
189       i += num_args_to_skip(argv[i]);
190     }
191   }
192 
193   *argcp = new_argc;
194   return new_argv;
195 }
196 
197 static void runUnitTestsInner(int argc, char** argv) {
<span class="line-modified">198   ::testing::InitGoogleMock(&amp;argc, argv);</span>
199   ::testing::GTEST_FLAG(death_test_style) = &quot;threadsafe&quot;;
200 
201   bool is_vmassert_test = false;
202   bool is_othervm_test = false;
203   // death tests facility is used for both regular death tests, other vm and vmassert tests
204   if (::testing::internal::GTEST_FLAG(internal_run_death_test).length() &gt; 0) {
205     // when we execute death test, filter value equals to test name
206     const char* test_name = ::testing::GTEST_FLAG(filter).c_str();
207     const char* const othervm_suffix = &quot;_other_vm_test&quot;; // TEST_OTHER_VM
208     const char* const vmassert_suffix = &quot;_vm_assert_test&quot;; // TEST_VM_ASSERT(_MSG)
209     if (is_suffix(othervm_suffix, test_name)) {
210       is_othervm_test = true;
211     } else if (is_suffix(vmassert_suffix, test_name)) {
212       is_vmassert_test = true;
213     }
214   }
215 
216   char* java_home = get_java_home_arg(argc, argv);
217   if (java_home == NULL) {
218     fprintf(stderr, &quot;ERROR: You must specify a JDK to use for running the unit tests.\n&quot;);
219     exit(1);
220   }
221 #ifndef _WIN32
222   int overwrite = 1; // overwrite an eventual existing value for JAVA_HOME
223   setenv(&quot;JAVA_HOME&quot;, java_home, overwrite);
224 
225 // workaround for JDK-7131356
226 #ifdef __APPLE__
227   size_t len = strlen(java_home) + strlen(&quot;/lib/jli/libjli.dylib&quot;) + 1;
228   char* path = new char[len];
229   snprintf(path, len, &quot;%s/lib/jli/libjli.dylib&quot;, java_home);
230   dlopen(path, RTLD_NOW | RTLD_GLOBAL);
231 #endif // __APPLE__
232 
233 #else  // _WIN32
<span class="line-modified">234   const char* java_home_var = &quot;_ALT_JAVA_HOME_DIR&quot;;</span>
235   size_t len = strlen(java_home) + strlen(java_home_var) + 2;
236   char * envString = new char[len];
237   sprintf_s(envString, len, &quot;%s=%s&quot;, java_home_var, java_home);
238   _putenv(envString);
239 #endif // _WIN32
240   argv = remove_test_runner_arguments(&amp;argc, argv);
241 
242   if (is_vmassert_test || is_othervm_test) {
243     // both vmassert and other vm tests require inited jvm
244     // but only vmassert tests disable hs_err and core file generation
245     if (init_jvm(argc, argv, is_vmassert_test) != 0) {
246       abort();
247     }
248   } else {
249     ::testing::TestEventListeners&amp; listeners = ::testing::UnitTest::GetInstance()-&gt;listeners();
250     listeners.Append(new JVMInitializerListener(argc, argv));
251   }
252 
253   int result = RUN_ALL_TESTS();
254   if (result != 0) {
</pre>
</td>
</tr>
</table>
<center><a href="gc/z/test_zVirtualMemory.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="jfr/test_networkUtilization.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>