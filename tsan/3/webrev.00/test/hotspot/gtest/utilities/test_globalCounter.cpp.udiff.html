<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/gtest/utilities/test_globalCounter.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="test_count_leading_zeros.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="test_globalCounter_nested.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/gtest/utilities/test_globalCounter.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -21,11 +21,10 @@</span>
   * questions.
   */
  
  #include &quot;precompiled.hpp&quot;
  #include &quot;runtime/atomic.hpp&quot;
<span class="udiff-line-removed">- #include &quot;runtime/orderAccess.hpp&quot;</span>
  #include &quot;runtime/os.hpp&quot;
  #include &quot;utilities/globalCounter.hpp&quot;
  #include &quot;utilities/globalCounter.inline.hpp&quot;
  #include &quot;threadHelper.inline.hpp&quot;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -46,18 +45,18 @@</span>
    virtual ~RCUReaderThread(){}
    void main_run() {
      _wrt_start-&gt;signal();
      while (!_exit) {
        GlobalCounter::CSContext cs_context = GlobalCounter::critical_section_begin(this);
<span class="udiff-line-modified-removed">-       volatile TestData* test = OrderAccess::load_acquire(_test);</span>
<span class="udiff-line-modified-removed">-       long value = OrderAccess::load_acquire(&amp;test-&gt;test_value);</span>
<span class="udiff-line-modified-added">+       volatile TestData* test = Atomic::load_acquire(_test);</span>
<span class="udiff-line-modified-added">+       long value = Atomic::load_acquire(&amp;test-&gt;test_value);</span>
        ASSERT_EQ(value, GOOD_VALUE);
        GlobalCounter::critical_section_end(this, cs_context);
        {
          GlobalCounter::CriticalSection cs(this);
<span class="udiff-line-modified-removed">-         volatile TestData* test = OrderAccess::load_acquire(_test);</span>
<span class="udiff-line-modified-removed">-         long value = OrderAccess::load_acquire(&amp;test-&gt;test_value);</span>
<span class="udiff-line-modified-added">+         volatile TestData* test = Atomic::load_acquire(_test);</span>
<span class="udiff-line-modified-added">+         long value = Atomic::load_acquire(&amp;test-&gt;test_value);</span>
          ASSERT_EQ(value, GOOD_VALUE);
        }
      }
    }
  };
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -80,11 +79,11 @@</span>
      RCUReaderThread* reader3 = new RCUReaderThread(&amp;post, &amp;test, &amp;wrt_start);
      RCUReaderThread* reader4 = new RCUReaderThread(&amp;post, &amp;test, &amp;wrt_start);
  
      TestData* tmp = new TestData();
      tmp-&gt;test_value = GOOD_VALUE;
<span class="udiff-line-modified-removed">-     OrderAccess::release_store_fence(&amp;test, tmp);</span>
<span class="udiff-line-modified-added">+     Atomic::release_store_fence(&amp;test, tmp);</span>
  
      reader1-&gt;doit();
      reader2-&gt;doit();
      reader3-&gt;doit();
      reader4-&gt;doit();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,11 +96,11 @@</span>
      jlong stop_ms = os::javaTimeMillis() + 1000; // 1 seconds max test time
      for (int i = 0; i &lt; 100000 &amp;&amp; stop_ms &gt; os::javaTimeMillis(); i++) {
        volatile TestData* free_tmp = test;
        tmp = new TestData();
        tmp-&gt;test_value = GOOD_VALUE;
<span class="udiff-line-modified-removed">-       OrderAccess::release_store(&amp;test, tmp);</span>
<span class="udiff-line-modified-added">+       Atomic::release_store(&amp;test, tmp);</span>
        GlobalCounter::write_synchronize();
        free_tmp-&gt;test_value = BAD_VALUE;
        delete free_tmp;
      }
      RCUReaderThread::_exit = true;
</pre>
<center><a href="test_count_leading_zeros.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="test_globalCounter_nested.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>