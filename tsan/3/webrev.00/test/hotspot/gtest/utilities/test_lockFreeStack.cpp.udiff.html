<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/hotspot/gtest/utilities/test_lockFreeStack.cpp</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="test_globalDefinitions.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="test_population_count.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>test/hotspot/gtest/utilities/test_lockFreeStack.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -22,11 +22,10 @@</span>
   */
  
  #include &quot;precompiled.hpp&quot;
  #include &quot;memory/allocation.inline.hpp&quot;
  #include &quot;runtime/atomic.hpp&quot;
<span class="udiff-line-removed">- #include &quot;runtime/orderAccess.hpp&quot;</span>
  #include &quot;utilities/globalDefinitions.hpp&quot;
  #include &quot;utilities/lockFreeStack.hpp&quot;
  #include &quot;threadHelper.inline.hpp&quot;
  #include &quot;unittest.hpp&quot;
  #include &lt;new&gt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -224,25 +223,25 @@</span>
      _local_processed(0),
      _ready(false)
    {}
  
    virtual void main_run() {
<span class="udiff-line-modified-removed">-     OrderAccess::release_store_fence(&amp;_ready, true);</span>
<span class="udiff-line-modified-added">+     Atomic::release_store_fence(&amp;_ready, true);</span>
      while (true) {
        Element* e = _from-&gt;pop();
        if (e != NULL) {
          _to-&gt;push(*e);
          Atomic::inc(_processed);
          ++_local_processed;
<span class="udiff-line-modified-removed">-       } else if (OrderAccess::load_acquire(_processed) == _process_limit) {</span>
<span class="udiff-line-modified-added">+       } else if (Atomic::load_acquire(_processed) == _process_limit) {</span>
          tty-&gt;print_cr(&quot;thread %u processed &quot; SIZE_FORMAT, _id, _local_processed);
          return;
        }
      }
    }
  
<span class="udiff-line-modified-removed">-   bool ready() const { return OrderAccess::load_acquire(&amp;_ready); }</span>
<span class="udiff-line-modified-added">+   bool ready() const { return Atomic::load_acquire(&amp;_ready); }</span>
  };
  
  TEST_VM(LockFreeStackTest, stress) {
    Semaphore post;
    TestStack initial_stack;
</pre>
<center><a href="test_globalDefinitions.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="test_population_count.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>