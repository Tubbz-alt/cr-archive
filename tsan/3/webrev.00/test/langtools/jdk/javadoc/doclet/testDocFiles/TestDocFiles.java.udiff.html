<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/langtools/jdk/javadoc/doclet/testDocFiles/TestDocFiles.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../testDocFileDir/TestDocFileDir.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../testDocRootInlineTag/TestDocRootInlineTag.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/javadoc/doclet/testDocFiles/TestDocFiles.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -21,33 +21,111 @@</span>
   * questions.
   */
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8008949</span>
<span class="udiff-line-modified-removed">-  * @summary verify that doc-files get copied</span>
<span class="udiff-line-modified-removed">-  * @library ../../lib</span>
<span class="udiff-line-modified-added">+  * @bug 8008949 8234051</span>
<span class="udiff-line-modified-added">+  * @summary doclet crashes if HTML files in module doc-files directories</span>
<span class="udiff-line-modified-added">+  * @library /tools/lib ../../lib</span>
   * @modules jdk.javadoc/jdk.javadoc.internal.tool
<span class="udiff-line-modified-removed">-  * @build javadoc.tester.*</span>
<span class="udiff-line-modified-added">+  * @build toolbox.ToolBox javadoc.tester.*</span>
   * @run main TestDocFiles
   */
  
<span class="udiff-line-added">+ import java.io.IOException;</span>
<span class="udiff-line-added">+ import java.nio.file.Path;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ import toolbox.ToolBox;</span>
  import javadoc.tester.JavadocTester;
  
  public class TestDocFiles extends JavadocTester {
  
      public static void main(String... args) throws Exception {
          TestDocFiles tester = new TestDocFiles();
<span class="udiff-line-modified-removed">-         tester.runTests();</span>
<span class="udiff-line-modified-added">+         tester.runTests(m -&gt; new Object[] { Path.of(m.getName()) });</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ToolBox tb = new ToolBox();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Check doc-files support for a package that is not in a module.</span>
<span class="udiff-line-added">+      * @param base the base directory for scratch files</span>
<span class="udiff-line-added">+      * @throws IOException if an exception occurs</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     @Test</span>
<span class="udiff-line-added">+     public void testPackage(Path base) throws IOException {</span>
<span class="udiff-line-added">+         Path src = base.resolve(&quot;src&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // write the skeletal Java files</span>
<span class="udiff-line-added">+         tb.writeJavaFiles(src,</span>
<span class="udiff-line-added">+                 &quot;package p; public class C { }\n&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // write the doc files for the package</span>
<span class="udiff-line-added">+         Path pkgDocFiles = src.resolve(&quot;p&quot;).resolve(&quot;doc-files&quot;);</span>
<span class="udiff-line-added">+         tb.writeFile(pkgDocFiles.resolve(&quot;pkg-file.txt&quot;),</span>
<span class="udiff-line-added">+                 &quot;package text file\n&quot;);</span>
<span class="udiff-line-added">+         tb.writeFile(pkgDocFiles.resolve(&quot;pkg-file.html&quot;),</span>
<span class="udiff-line-added">+                 &quot;&lt;html&gt;\n&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;head&gt;&lt;title&gt;Package HTML file&lt;/title&gt;&lt;/head&gt;\n&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;body&gt;&lt;h1&gt;Package HTML file&lt;/h1&gt;File content&lt;/body&gt;\n&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;/html&gt;\n&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         javadoc(&quot;-d&quot;, base.resolve(&quot;out&quot;).toString(),</span>
<span class="udiff-line-added">+                 &quot;--source-path&quot;, src.toString(),</span>
<span class="udiff-line-added">+                 &quot;p&quot;);</span>
<span class="udiff-line-added">+         checkExit(Exit.OK);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         checkOutput(&quot;p/doc-files/pkg-file.txt&quot;, true,</span>
<span class="udiff-line-added">+                 &quot;package text file&quot;);</span>
<span class="udiff-line-added">+         checkOutput(&quot;p/doc-files/pkg-file.html&quot;, true,</span>
<span class="udiff-line-added">+                 &quot;Package HTML file&quot;);</span>
      }
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Check doc-files support for a module and a package that is in a module.</span>
<span class="udiff-line-added">+      * @param base the base directory for scratch files</span>
<span class="udiff-line-added">+      * @throws IOException if an exception occurs</span>
<span class="udiff-line-added">+      */</span>
      @Test
<span class="udiff-line-modified-removed">-     public void test() {</span>
<span class="udiff-line-modified-removed">-         javadoc(&quot;-d&quot;, &quot;out&quot;,</span>
<span class="udiff-line-modified-removed">-                 &quot;-sourcepath&quot;, testSrc,</span>
<span class="udiff-line-modified-removed">-                 &quot;pkg&quot;);</span>
<span class="udiff-line-modified-added">+     public void testModules(Path base) throws IOException {</span>
<span class="udiff-line-modified-added">+         Path src = base.resolve(&quot;src&quot;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         // write the skeletal Java files</span>
<span class="udiff-line-added">+         tb.writeJavaFiles(src,</span>
<span class="udiff-line-added">+                 &quot;module m { exports p; }\n&quot;,</span>
<span class="udiff-line-added">+                 &quot;package p; public class C { }\n&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // write the doc files for the module</span>
<span class="udiff-line-added">+         Path mdlDocFiles = src.resolve(&quot;doc-files&quot;);</span>
<span class="udiff-line-added">+         tb.writeFile(mdlDocFiles.resolve(&quot;mdl-file.txt&quot;),</span>
<span class="udiff-line-added">+                 &quot;module text file\n&quot;);</span>
<span class="udiff-line-added">+         tb.writeFile(mdlDocFiles.resolve(&quot;mdl-file.html&quot;),</span>
<span class="udiff-line-added">+                 &quot;&lt;html&gt;\n&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;head&gt;&lt;title&gt;Module HTML file&lt;/title&gt;&lt;/head&gt;\n&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;body&gt;&lt;h1&gt;Module HTML file&lt;/h1&gt;File content&lt;/body&gt;\n&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;/html&gt;\n&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // write the doc files for a package in the module</span>
<span class="udiff-line-added">+         Path pkgDocFiles = src.resolve(&quot;p&quot;).resolve(&quot;doc-files&quot;);</span>
<span class="udiff-line-added">+         tb.writeFile(pkgDocFiles.resolve(&quot;pkg-file.txt&quot;),</span>
<span class="udiff-line-added">+                 &quot;package text file\n&quot;);</span>
<span class="udiff-line-added">+         tb.writeFile(pkgDocFiles.resolve(&quot;pkg-file.html&quot;),</span>
<span class="udiff-line-added">+                 &quot;&lt;html&gt;\n&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;head&gt;&lt;title&gt;Package HTML file&lt;/title&gt;&lt;/head&gt;\n&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;body&gt;&lt;h1&gt;Package HTML file&lt;/h1&gt;File content&lt;/body&gt;\n&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;/html&gt;\n&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         javadoc(&quot;-d&quot;, base.resolve(&quot;out&quot;).toString(),</span>
<span class="udiff-line-added">+                 &quot;--source-path&quot;, src.toString(),</span>
<span class="udiff-line-added">+                 &quot;--module&quot;, &quot;m&quot;);</span>
          checkExit(Exit.OK);
  
<span class="udiff-line-modified-removed">-         checkOutput(&quot;pkg/doc-files/test.txt&quot;, true,</span>
<span class="udiff-line-modified-removed">-                 &quot;test file&quot;);</span>
<span class="udiff-line-modified-added">+         checkOutput(&quot;m/doc-files/mdl-file.txt&quot;, true,</span>
<span class="udiff-line-modified-added">+                 &quot;module text file&quot;);</span>
<span class="udiff-line-added">+         checkOutput(&quot;m/doc-files/mdl-file.html&quot;, true,</span>
<span class="udiff-line-added">+                 &quot;Module HTML file&quot;);</span>
<span class="udiff-line-added">+         checkOutput(&quot;m/p/doc-files/pkg-file.txt&quot;, true,</span>
<span class="udiff-line-added">+                 &quot;package text file&quot;);</span>
<span class="udiff-line-added">+         checkOutput(&quot;m/p/doc-files/pkg-file.html&quot;, true,</span>
<span class="udiff-line-added">+                 &quot;Package HTML file&quot;);</span>
      }
  }
</pre>
<center><a href="../testDocFileDir/TestDocFileDir.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../testDocRootInlineTag/TestDocRootInlineTag.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>