<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/javadoc/doclet/testMetadata/TestMetadata.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../testMemberSummary/TestMemberSummary.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../testMethodTypes/TestMethodTypes.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/javadoc/doclet/testMetadata/TestMetadata.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8218998 8219946</span>
 27  * @summary Add metadata to generated API documentation files
 28  * @library /tools/lib ../../lib
 29  * @modules jdk.javadoc/jdk.javadoc.internal.tool
 30  * @modules jdk.compiler/com.sun.tools.javac.api
 31  *          jdk.compiler/com.sun.tools.javac.main
 32  *          jdk.javadoc/jdk.javadoc.internal.api
 33  *          jdk.javadoc/jdk.javadoc.internal.tool
 34  * @build toolbox.ToolBox toolbox.JavacTask javadoc.tester.*
 35  * @run main TestMetadata
 36  */
 37 
 38 import java.io.IOException;
 39 import java.nio.file.Path;
 40 import java.util.ArrayList;
 41 import java.util.HashSet;
 42 import java.util.List;
 43 import java.util.Set;
 44 import java.util.TreeSet;
 45 import java.util.regex.Matcher;
 46 import java.util.regex.Pattern;
 47 import java.util.stream.Collectors;
 48 
 49 import toolbox.ModuleBuilder;
 50 import toolbox.ToolBox;
 51 
 52 import javadoc.tester.JavadocTester;
 53 
 54 public class TestMetadata extends JavadocTester {
 55     public static void main(String... args) throws Exception {
 56         TestMetadata tester = new TestMetadata();
 57         tester.runTests();
 58     }
 59 
<span class="line-removed"> 60     enum Frames { NO_FRAMES, FRAMES };</span>
 61     enum Index  { SINGLE, SPLIT };
 62     enum Source { PACKAGES, MODULES };
 63 
 64     final ToolBox tb = new ToolBox();
 65     final Set&lt;String&gt; allBodyClassesFound = new HashSet&lt;&gt;();
 66     final Set&lt;String&gt; allGeneratorsFound = new HashSet&lt;&gt;();
 67 
 68     public void runTests() throws Exception {
 69         for (Source s : Source.values()) {
 70             Path src = genSource(s);
<span class="line-removed"> 71             for (Frames f : Frames.values()) {</span>
 72                  for (Index i : Index.values()) {
 73                      List&lt;String&gt; args = new ArrayList&lt;&gt;();
 74                      args.add(&quot;-d&quot;);
<span class="line-modified"> 75                      args.add(String.format(&quot;out-%s-%s-%s&quot;, s, f, i));</span>
 76                      args.add(&quot;-use&quot;);
<span class="line-modified"> 77                      if (s != Source.MODULES) {</span>
<span class="line-removed"> 78                          args.add(&quot;-linksource&quot;); // broken, with modules: JDK-8219060</span>
<span class="line-removed"> 79                      }</span>
<span class="line-removed"> 80                      args.add(f == Frames.NO_FRAMES ? &quot;--no-frames&quot; : &quot;--frames&quot;);</span>
 81                      if (i == Index.SPLIT) {
 82                          args.add(&quot;-splitIndex&quot;);
 83                      }
 84                      if (s == Source.PACKAGES) {
 85                          args.add(&quot;-sourcepath&quot;);
 86                          args.add(src.toString());
 87                          args.add(&quot;pA&quot;);
 88                          args.add(&quot;pB&quot;);
 89                      } else {
 90                          args.add(&quot;--module-source-path&quot;);
 91                          args.add(src.toString());
 92                          args.add(&quot;--module&quot;);
 93                          args.add(&quot;mA,mB&quot;);
 94                      }
 95                      javadoc(args.toArray(new String[args.size()]));
 96                      checkExit(Exit.OK);
 97                      checkBodyClasses();
 98                      checkMetadata();
 99 
100                      // spot check the descriptions for declarations
101                      switch (s) {
102                          case PACKAGES:
103                              checkOutput(&quot;pA/package-summary.html&quot;, true,
104                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: package: pA\&quot;&gt;&quot;);
105                              checkOutput(&quot;pA/CA.html&quot;, true,
106                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: package: pA, class: CA\&quot;&gt;&quot;);
107                              break;
108 
109                          case MODULES:
110                              checkOutput(&quot;mA/module-summary.html&quot;, true,
111                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: module: mA\&quot;&gt;&quot;);
112                              checkOutput(&quot;mA/pA/package-summary.html&quot;, true,
113                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: module: mA, package: pA\&quot;&gt;&quot;);
114                              checkOutput(&quot;mA/pA/CA.html&quot;, true,
115                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: module: mA, package: pA, class: CA\&quot;&gt;&quot;);
116                              break;
117                      }
118                  }
<span class="line-removed">119             }</span>
120         }
121 
122         checking (&quot;all generators&quot;);
123         if (allGeneratorsFound.equals(allGenerators)) {
124             passed(&quot;all generators found&quot;);
125         } else {
126             Set&lt;String&gt; notFound = new TreeSet&lt;&gt;(allGenerators);
127             notFound.removeAll(allGeneratorsFound);
128             failed(&quot;not found: &quot; + notFound);
129         }
130 
131         checking (&quot;all body classes&quot;);
132         if (allBodyClassesFound.equals(allBodyClasses)) {
<span class="line-modified">133             passed(&quot;all gbody classes found&quot;);</span>
134         } else {
135             Set&lt;String&gt; notFound = new TreeSet&lt;&gt;(allBodyClasses);
136             notFound.removeAll(allBodyClassesFound);
137             failed(&quot;not found: &quot; + notFound);
138         }
139 
140         printSummary();
141     }
142 
143     final Pattern nl = Pattern.compile(&quot;[\\r\\n]+&quot;);
144     final Pattern bodyPattern = Pattern.compile(&quot;&lt;body [^&gt;]*class=\&quot;([^\&quot;]+)\&quot;&quot;);
145     final Set&lt;String&gt; allBodyClasses = Set.of(
<span class="line-removed">146         &quot;all-classes-frame&quot;,</span>
147         &quot;all-classes-index&quot;,
148         &quot;all-packages-index&quot;,
149         &quot;class-declaration&quot;,
150         &quot;class-use&quot;,
151         &quot;constants-summary&quot;,
152         &quot;deprecated-list&quot;,
153         &quot;doc-file&quot;,
<span class="line-removed">154         &quot;frames&quot;,</span>
155         &quot;help&quot;,
156         &quot;index-redirect&quot;,
157         &quot;module-declaration&quot;,
<span class="line-removed">158         &quot;module-frame&quot;,</span>
159         &quot;module-index&quot;,
<span class="line-removed">160         &quot;module-index-frame&quot;,</span>
<span class="line-removed">161         &quot;module-package-index-frame&quot;,</span>
162         &quot;package-declaration&quot;,
<span class="line-removed">163         &quot;package-frame&quot;,</span>
164         &quot;package-index&quot;,
<span class="line-removed">165         &quot;package-index-frame&quot;,</span>
166         &quot;package-tree&quot;,
167         &quot;package-use&quot;,
168         &quot;serialized-form&quot;,
169         &quot;single-index&quot;,
170         &quot;source&quot;,
171         &quot;split-index&quot;,

172         &quot;tree&quot;
173     );
174 
175     void checkBodyClasses() throws IOException {
176         Path outputDirPath = outputDir.toPath();
177         for (Path p : tb.findFiles(&quot;.html&quot;, outputDirPath)) {
178             checkBodyClass(outputDirPath.relativize(p));
179         }
180     }
181 
182     void checkBodyClass(Path p) {
183         checking(&quot;Check body: &quot; + p);
184 
185         List&lt;String&gt; bodyLines = nl.splitAsStream(readOutputFile(p.toString()))
186                 .filter(s -&gt; s.contains(&quot;&lt;body class=&quot;))
187                 .collect(Collectors.toList());
188 
189         String bodyLine;
190         switch (bodyLines.size()) {
191             case 0:
</pre>
<hr />
<pre>
199                  return;
200         }
201 
202         Matcher m = bodyPattern.matcher(bodyLine);
203         if (m.find()) {
204             String bodyClass = m.group(1);
205             if (allBodyClasses.contains(bodyClass)) {
206                 passed(&quot;found: &quot; + bodyClass);
207                 allBodyClassesFound.add(bodyClass);
208             } else {
209                 failed(&quot;Unrecognized body class: &quot; + bodyClass);
210             }
211         } else {
212             failed(&quot;Unrecognized line:\n&quot; + bodyLine);
213         }
214     }
215 
216     final Pattern contentPattern = Pattern.compile(&quot;content=\&quot;([^\&quot;]+)\&quot;&gt;&quot;);
217     final Pattern generatorPattern = Pattern.compile(&quot;content=\&quot;javadoc/([^\&quot;]+)\&quot;&gt;&quot;);
218     final Set&lt;String&gt; allGenerators = Set.of(
<span class="line-removed">219             &quot;AllClassesFrameWriter&quot;,</span>
220             &quot;AllClassesIndexWriter&quot;,
221             &quot;AllPackagesIndexWriter&quot;,
222             &quot;AnnotationTypeWriterImpl&quot;,
223             &quot;ClassUseWriter&quot;,
224             &quot;ClassWriterImpl&quot;,
225             &quot;ConstantsSummaryWriterImpl&quot;,
226             &quot;DeprecatedListWriter&quot;,
227             &quot;DocFileWriter&quot;,
<span class="line-removed">228             &quot;FrameOutputWriter&quot;,</span>
229             &quot;HelpWriter&quot;,
230             &quot;IndexRedirectWriter&quot;,
<span class="line-removed">231             &quot;ModuleFrameWriter&quot;,</span>
<span class="line-removed">232             &quot;ModuleIndexFrameWriter&quot;,</span>
233             &quot;ModuleIndexWriter&quot;,
<span class="line-removed">234             &quot;ModulePackageIndexFrameWriter&quot;,</span>
235             &quot;ModuleWriterImpl&quot;,
<span class="line-removed">236             &quot;PackageFrameWriter&quot;,</span>
<span class="line-removed">237             &quot;PackageIndexFrameWriter&quot;,</span>
238             &quot;PackageIndexWriter&quot;,
239             &quot;PackageTreeWriter&quot;,
240             &quot;PackageUseWriter&quot;,
241             &quot;PackageWriterImpl&quot;,
242             &quot;SerializedFormWriterImpl&quot;,
243             &quot;SingleIndexWriter&quot;,
244             &quot;SourceToHTMLConverter&quot;,
245             &quot;SplitIndexWriter&quot;,

246             &quot;TreeWriter&quot;
247             );
248 
249     void checkMetadata() throws IOException {
250         Path outputDirPath = outputDir.toPath();
251         for (Path p : tb.findFiles(&quot;.html&quot;, outputDirPath)) {
252             checkMetadata(outputDirPath.relativize(p));
253         }
254     }
255 
256     void checkMetadata(Path p) {
257         checking(&quot;Check generator: &quot; + p);
258 
259         List&lt;String&gt; generators = nl.splitAsStream(readOutputFile(p.toString()))
260                 .filter(s -&gt; s.contains(&quot;&lt;meta name=\&quot;generator\&quot;&quot;))
261                 .collect(Collectors.toList());
262 
263         String generator;
264         switch (generators.size()) {
265             case 0:
</pre>
<hr />
<pre>
306                 }
307                 return;
308             case 1:
309                 description = descriptions.get(0);
310                 break;
311             default:
312                 failed(&quot;Multiple found: &lt;meta name=\&quot;description\&quot;&quot;);
313                 return;
314         }
315 
316         String content;
317         Matcher m = contentPattern.matcher(description);
318         if (m.find()) {
319             content = m.group(1);
320         } else {
321             failed(&quot;Unrecognized line:\n&quot; + description);
322             return;
323         }
324 
325         switch (generator) {
<span class="line-removed">326             case &quot;AllClassesFrameWriter&quot;:</span>
<span class="line-removed">327             case &quot;FrameOutputWriter&quot;:</span>
<span class="line-removed">328             case &quot;ModuleFrameWriter&quot;:</span>
<span class="line-removed">329             case &quot;ModuleIndexFrameWriter&quot;:</span>
<span class="line-removed">330             case &quot;ModulePackageIndexFrameWriter&quot;:</span>
<span class="line-removed">331             case &quot;PackageFrameWriter&quot;:</span>
<span class="line-removed">332             case &quot;PackageIndexFrameWriter&quot;:</span>
<span class="line-removed">333                 check(generator, content, content.contains(&quot;frame&quot;));</span>
<span class="line-removed">334                 break;</span>
<span class="line-removed">335 </span>
336             case &quot;AllClassesIndexWriter&quot;:
337             case &quot;AllPackagesIndexWriter&quot;:
338             case &quot;ModuleIndexWriter&quot;:
339             case &quot;PackageIndexWriter&quot;:
340                 check(generator, content, content.contains(&quot;index&quot;));
341                 break;
342 
343 
344             case &quot;AnnotationTypeWriterImpl&quot;:
345             case &quot;ClassWriterImpl&quot;:
346             case &quot;ModuleWriterImpl&quot;:
347             case &quot;PackageWriterImpl&quot;:
348                 check(generator, content, content.startsWith(&quot;declaration: &quot;));
349                 break;
350 
351             case &quot;ClassUseWriter&quot;:
352             case &quot;PackageUseWriter&quot;:
353                 check(generator, content, content.startsWith(&quot;use: &quot;));
354                 break;
355 
</pre>
<hr />
<pre>
374                 break;
375 
376             case &quot;PackageTreeWriter&quot;:
377             case &quot;TreeWriter&quot;:
378                 check(generator, content, content.contains(&quot;tree&quot;));
379                 break;
380 
381             case &quot;SerializedFormWriterImpl&quot;:
382                 check(generator, content, content.contains(&quot;serialized&quot;));
383                 break;
384 
385             case &quot;SingleIndexWriter&quot;:
386             case &quot;SplitIndexWriter&quot;:
387                 check(generator, content, content.startsWith(&quot;index&quot;));
388                 break;
389 
390             case &quot;SourceToHTMLConverter&quot;:
391                 check(generator, content, content.startsWith(&quot;source:&quot;));
392                 break;
393 




394             default:
395                 failed(&quot;unexpected generator: &quot; + generator);
396                 break;
397         }
398     }
399 
400     void check(String generator, String content, boolean ok) {
401         if (ok) {
402             passed(&quot;OK: &quot; + generator + &quot; &quot; + content);
403         } else {
404             failed(&quot;unexpected value for &quot; + generator + &quot;: &quot; + content);
405         }
406     }
407 
408     Path genSource(Source s) throws IOException {
409         Path src = Path.of(&quot;src-&quot; + s);
410         switch (s) {
411             case PACKAGES:
412                 tb.writeJavaFiles(src,
413                     &quot;/** Package pA. */ package pA;&quot;,
</pre>
</td>
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8218998 8219946 8219060</span>
 27  * @summary Add metadata to generated API documentation files
 28  * @library /tools/lib ../../lib
 29  * @modules jdk.javadoc/jdk.javadoc.internal.tool
 30  * @modules jdk.compiler/com.sun.tools.javac.api
 31  *          jdk.compiler/com.sun.tools.javac.main
 32  *          jdk.javadoc/jdk.javadoc.internal.api
 33  *          jdk.javadoc/jdk.javadoc.internal.tool
 34  * @build toolbox.ToolBox toolbox.JavacTask javadoc.tester.*
 35  * @run main TestMetadata
 36  */
 37 
 38 import java.io.IOException;
 39 import java.nio.file.Path;
 40 import java.util.ArrayList;
 41 import java.util.HashSet;
 42 import java.util.List;
 43 import java.util.Set;
 44 import java.util.TreeSet;
 45 import java.util.regex.Matcher;
 46 import java.util.regex.Pattern;
 47 import java.util.stream.Collectors;
 48 
 49 import toolbox.ModuleBuilder;
 50 import toolbox.ToolBox;
 51 
 52 import javadoc.tester.JavadocTester;
 53 
 54 public class TestMetadata extends JavadocTester {
 55     public static void main(String... args) throws Exception {
 56         TestMetadata tester = new TestMetadata();
 57         tester.runTests();
 58     }
 59 

 60     enum Index  { SINGLE, SPLIT };
 61     enum Source { PACKAGES, MODULES };
 62 
 63     final ToolBox tb = new ToolBox();
 64     final Set&lt;String&gt; allBodyClassesFound = new HashSet&lt;&gt;();
 65     final Set&lt;String&gt; allGeneratorsFound = new HashSet&lt;&gt;();
 66 
 67     public void runTests() throws Exception {
 68         for (Source s : Source.values()) {
 69             Path src = genSource(s);

 70                  for (Index i : Index.values()) {
 71                      List&lt;String&gt; args = new ArrayList&lt;&gt;();
 72                      args.add(&quot;-d&quot;);
<span class="line-modified"> 73                      args.add(String.format(&quot;out-%s-%s&quot;, s, i));</span>
 74                      args.add(&quot;-use&quot;);
<span class="line-modified"> 75                      args.add(&quot;-linksource&quot;);</span>



 76                      if (i == Index.SPLIT) {
 77                          args.add(&quot;-splitIndex&quot;);
 78                      }
 79                      if (s == Source.PACKAGES) {
 80                          args.add(&quot;-sourcepath&quot;);
 81                          args.add(src.toString());
 82                          args.add(&quot;pA&quot;);
 83                          args.add(&quot;pB&quot;);
 84                      } else {
 85                          args.add(&quot;--module-source-path&quot;);
 86                          args.add(src.toString());
 87                          args.add(&quot;--module&quot;);
 88                          args.add(&quot;mA,mB&quot;);
 89                      }
 90                      javadoc(args.toArray(new String[args.size()]));
 91                      checkExit(Exit.OK);
 92                      checkBodyClasses();
 93                      checkMetadata();
 94 
 95                      // spot check the descriptions for declarations
 96                      switch (s) {
 97                          case PACKAGES:
 98                              checkOutput(&quot;pA/package-summary.html&quot;, true,
 99                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: package: pA\&quot;&gt;&quot;);
100                              checkOutput(&quot;pA/CA.html&quot;, true,
101                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: package: pA, class: CA\&quot;&gt;&quot;);
102                              break;
103 
104                          case MODULES:
105                              checkOutput(&quot;mA/module-summary.html&quot;, true,
106                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: module: mA\&quot;&gt;&quot;);
107                              checkOutput(&quot;mA/pA/package-summary.html&quot;, true,
108                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: module: mA, package: pA\&quot;&gt;&quot;);
109                              checkOutput(&quot;mA/pA/CA.html&quot;, true,
110                                      &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: module: mA, package: pA, class: CA\&quot;&gt;&quot;);
111                              break;
112                      }
113                  }

114         }
115 
116         checking (&quot;all generators&quot;);
117         if (allGeneratorsFound.equals(allGenerators)) {
118             passed(&quot;all generators found&quot;);
119         } else {
120             Set&lt;String&gt; notFound = new TreeSet&lt;&gt;(allGenerators);
121             notFound.removeAll(allGeneratorsFound);
122             failed(&quot;not found: &quot; + notFound);
123         }
124 
125         checking (&quot;all body classes&quot;);
126         if (allBodyClassesFound.equals(allBodyClasses)) {
<span class="line-modified">127             passed(&quot;all body classes found&quot;);</span>
128         } else {
129             Set&lt;String&gt; notFound = new TreeSet&lt;&gt;(allBodyClasses);
130             notFound.removeAll(allBodyClassesFound);
131             failed(&quot;not found: &quot; + notFound);
132         }
133 
134         printSummary();
135     }
136 
137     final Pattern nl = Pattern.compile(&quot;[\\r\\n]+&quot;);
138     final Pattern bodyPattern = Pattern.compile(&quot;&lt;body [^&gt;]*class=\&quot;([^\&quot;]+)\&quot;&quot;);
139     final Set&lt;String&gt; allBodyClasses = Set.of(

140         &quot;all-classes-index&quot;,
141         &quot;all-packages-index&quot;,
142         &quot;class-declaration&quot;,
143         &quot;class-use&quot;,
144         &quot;constants-summary&quot;,
145         &quot;deprecated-list&quot;,
146         &quot;doc-file&quot;,

147         &quot;help&quot;,
148         &quot;index-redirect&quot;,
149         &quot;module-declaration&quot;,

150         &quot;module-index&quot;,


151         &quot;package-declaration&quot;,

152         &quot;package-index&quot;,

153         &quot;package-tree&quot;,
154         &quot;package-use&quot;,
155         &quot;serialized-form&quot;,
156         &quot;single-index&quot;,
157         &quot;source&quot;,
158         &quot;split-index&quot;,
<span class="line-added">159         &quot;system-properties&quot;,</span>
160         &quot;tree&quot;
161     );
162 
163     void checkBodyClasses() throws IOException {
164         Path outputDirPath = outputDir.toPath();
165         for (Path p : tb.findFiles(&quot;.html&quot;, outputDirPath)) {
166             checkBodyClass(outputDirPath.relativize(p));
167         }
168     }
169 
170     void checkBodyClass(Path p) {
171         checking(&quot;Check body: &quot; + p);
172 
173         List&lt;String&gt; bodyLines = nl.splitAsStream(readOutputFile(p.toString()))
174                 .filter(s -&gt; s.contains(&quot;&lt;body class=&quot;))
175                 .collect(Collectors.toList());
176 
177         String bodyLine;
178         switch (bodyLines.size()) {
179             case 0:
</pre>
<hr />
<pre>
187                  return;
188         }
189 
190         Matcher m = bodyPattern.matcher(bodyLine);
191         if (m.find()) {
192             String bodyClass = m.group(1);
193             if (allBodyClasses.contains(bodyClass)) {
194                 passed(&quot;found: &quot; + bodyClass);
195                 allBodyClassesFound.add(bodyClass);
196             } else {
197                 failed(&quot;Unrecognized body class: &quot; + bodyClass);
198             }
199         } else {
200             failed(&quot;Unrecognized line:\n&quot; + bodyLine);
201         }
202     }
203 
204     final Pattern contentPattern = Pattern.compile(&quot;content=\&quot;([^\&quot;]+)\&quot;&gt;&quot;);
205     final Pattern generatorPattern = Pattern.compile(&quot;content=\&quot;javadoc/([^\&quot;]+)\&quot;&gt;&quot;);
206     final Set&lt;String&gt; allGenerators = Set.of(

207             &quot;AllClassesIndexWriter&quot;,
208             &quot;AllPackagesIndexWriter&quot;,
209             &quot;AnnotationTypeWriterImpl&quot;,
210             &quot;ClassUseWriter&quot;,
211             &quot;ClassWriterImpl&quot;,
212             &quot;ConstantsSummaryWriterImpl&quot;,
213             &quot;DeprecatedListWriter&quot;,
214             &quot;DocFileWriter&quot;,

215             &quot;HelpWriter&quot;,
216             &quot;IndexRedirectWriter&quot;,


217             &quot;ModuleIndexWriter&quot;,

218             &quot;ModuleWriterImpl&quot;,


219             &quot;PackageIndexWriter&quot;,
220             &quot;PackageTreeWriter&quot;,
221             &quot;PackageUseWriter&quot;,
222             &quot;PackageWriterImpl&quot;,
223             &quot;SerializedFormWriterImpl&quot;,
224             &quot;SingleIndexWriter&quot;,
225             &quot;SourceToHTMLConverter&quot;,
226             &quot;SplitIndexWriter&quot;,
<span class="line-added">227             &quot;SystemPropertiesWriter&quot;,</span>
228             &quot;TreeWriter&quot;
229             );
230 
231     void checkMetadata() throws IOException {
232         Path outputDirPath = outputDir.toPath();
233         for (Path p : tb.findFiles(&quot;.html&quot;, outputDirPath)) {
234             checkMetadata(outputDirPath.relativize(p));
235         }
236     }
237 
238     void checkMetadata(Path p) {
239         checking(&quot;Check generator: &quot; + p);
240 
241         List&lt;String&gt; generators = nl.splitAsStream(readOutputFile(p.toString()))
242                 .filter(s -&gt; s.contains(&quot;&lt;meta name=\&quot;generator\&quot;&quot;))
243                 .collect(Collectors.toList());
244 
245         String generator;
246         switch (generators.size()) {
247             case 0:
</pre>
<hr />
<pre>
288                 }
289                 return;
290             case 1:
291                 description = descriptions.get(0);
292                 break;
293             default:
294                 failed(&quot;Multiple found: &lt;meta name=\&quot;description\&quot;&quot;);
295                 return;
296         }
297 
298         String content;
299         Matcher m = contentPattern.matcher(description);
300         if (m.find()) {
301             content = m.group(1);
302         } else {
303             failed(&quot;Unrecognized line:\n&quot; + description);
304             return;
305         }
306 
307         switch (generator) {










308             case &quot;AllClassesIndexWriter&quot;:
309             case &quot;AllPackagesIndexWriter&quot;:
310             case &quot;ModuleIndexWriter&quot;:
311             case &quot;PackageIndexWriter&quot;:
312                 check(generator, content, content.contains(&quot;index&quot;));
313                 break;
314 
315 
316             case &quot;AnnotationTypeWriterImpl&quot;:
317             case &quot;ClassWriterImpl&quot;:
318             case &quot;ModuleWriterImpl&quot;:
319             case &quot;PackageWriterImpl&quot;:
320                 check(generator, content, content.startsWith(&quot;declaration: &quot;));
321                 break;
322 
323             case &quot;ClassUseWriter&quot;:
324             case &quot;PackageUseWriter&quot;:
325                 check(generator, content, content.startsWith(&quot;use: &quot;));
326                 break;
327 
</pre>
<hr />
<pre>
346                 break;
347 
348             case &quot;PackageTreeWriter&quot;:
349             case &quot;TreeWriter&quot;:
350                 check(generator, content, content.contains(&quot;tree&quot;));
351                 break;
352 
353             case &quot;SerializedFormWriterImpl&quot;:
354                 check(generator, content, content.contains(&quot;serialized&quot;));
355                 break;
356 
357             case &quot;SingleIndexWriter&quot;:
358             case &quot;SplitIndexWriter&quot;:
359                 check(generator, content, content.startsWith(&quot;index&quot;));
360                 break;
361 
362             case &quot;SourceToHTMLConverter&quot;:
363                 check(generator, content, content.startsWith(&quot;source:&quot;));
364                 break;
365 
<span class="line-added">366             case &quot;SystemPropertiesWriter&quot;:</span>
<span class="line-added">367                 check(generator, content, content.contains(&quot;system properties&quot;));</span>
<span class="line-added">368                 break;</span>
<span class="line-added">369 </span>
370             default:
371                 failed(&quot;unexpected generator: &quot; + generator);
372                 break;
373         }
374     }
375 
376     void check(String generator, String content, boolean ok) {
377         if (ok) {
378             passed(&quot;OK: &quot; + generator + &quot; &quot; + content);
379         } else {
380             failed(&quot;unexpected value for &quot; + generator + &quot;: &quot; + content);
381         }
382     }
383 
384     Path genSource(Source s) throws IOException {
385         Path src = Path.of(&quot;src-&quot; + s);
386         switch (s) {
387             case PACKAGES:
388                 tb.writeJavaFiles(src,
389                     &quot;/** Package pA. */ package pA;&quot;,
</pre>
</td>
</tr>
</table>
<center><a href="../testMemberSummary/TestMemberSummary.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../testMethodTypes/TestMethodTypes.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>