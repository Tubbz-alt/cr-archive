<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/langtools/jdk/javadoc/doclet/testMetadata/TestMetadata.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../testMemberSummary/TestMemberSummary.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../testMethodTypes/TestMethodTypes.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/javadoc/doclet/testMetadata/TestMetadata.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -21,11 +21,11 @@</span>
   * questions.
   */
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8218998 8219946</span>
<span class="udiff-line-modified-added">+  * @bug 8218998 8219946 8219060</span>
   * @summary Add metadata to generated API documentation files
   * @library /tools/lib ../../lib
   * @modules jdk.javadoc/jdk.javadoc.internal.tool
   * @modules jdk.compiler/com.sun.tools.javac.api
   *          jdk.compiler/com.sun.tools.javac.main
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -55,31 +55,26 @@</span>
      public static void main(String... args) throws Exception {
          TestMetadata tester = new TestMetadata();
          tester.runTests();
      }
  
<span class="udiff-line-removed">-     enum Frames { NO_FRAMES, FRAMES };</span>
      enum Index  { SINGLE, SPLIT };
      enum Source { PACKAGES, MODULES };
  
      final ToolBox tb = new ToolBox();
      final Set&lt;String&gt; allBodyClassesFound = new HashSet&lt;&gt;();
      final Set&lt;String&gt; allGeneratorsFound = new HashSet&lt;&gt;();
  
      public void runTests() throws Exception {
          for (Source s : Source.values()) {
              Path src = genSource(s);
<span class="udiff-line-removed">-             for (Frames f : Frames.values()) {</span>
                   for (Index i : Index.values()) {
                       List&lt;String&gt; args = new ArrayList&lt;&gt;();
                       args.add(&quot;-d&quot;);
<span class="udiff-line-modified-removed">-                      args.add(String.format(&quot;out-%s-%s-%s&quot;, s, f, i));</span>
<span class="udiff-line-modified-added">+                      args.add(String.format(&quot;out-%s-%s&quot;, s, i));</span>
                       args.add(&quot;-use&quot;);
<span class="udiff-line-modified-removed">-                      if (s != Source.MODULES) {</span>
<span class="udiff-line-removed">-                          args.add(&quot;-linksource&quot;); // broken, with modules: JDK-8219060</span>
<span class="udiff-line-removed">-                      }</span>
<span class="udiff-line-removed">-                      args.add(f == Frames.NO_FRAMES ? &quot;--no-frames&quot; : &quot;--frames&quot;);</span>
<span class="udiff-line-modified-added">+                      args.add(&quot;-linksource&quot;);</span>
                       if (i == Index.SPLIT) {
                           args.add(&quot;-splitIndex&quot;);
                       }
                       if (s == Source.PACKAGES) {
                           args.add(&quot;-sourcepath&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -114,11 +109,10 @@</span>
                               checkOutput(&quot;mA/pA/CA.html&quot;, true,
                                       &quot;&lt;meta name=\&quot;description\&quot; content=\&quot;declaration: module: mA, package: pA, class: CA\&quot;&gt;&quot;);
                               break;
                       }
                   }
<span class="udiff-line-removed">-             }</span>
          }
  
          checking (&quot;all generators&quot;);
          if (allGeneratorsFound.equals(allGenerators)) {
              passed(&quot;all generators found&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -128,11 +122,11 @@</span>
              failed(&quot;not found: &quot; + notFound);
          }
  
          checking (&quot;all body classes&quot;);
          if (allBodyClassesFound.equals(allBodyClasses)) {
<span class="udiff-line-modified-removed">-             passed(&quot;all gbody classes found&quot;);</span>
<span class="udiff-line-modified-added">+             passed(&quot;all body classes found&quot;);</span>
          } else {
              Set&lt;String&gt; notFound = new TreeSet&lt;&gt;(allBodyClasses);
              notFound.removeAll(allBodyClassesFound);
              failed(&quot;not found: &quot; + notFound);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -141,36 +135,30 @@</span>
      }
  
      final Pattern nl = Pattern.compile(&quot;[\\r\\n]+&quot;);
      final Pattern bodyPattern = Pattern.compile(&quot;&lt;body [^&gt;]*class=\&quot;([^\&quot;]+)\&quot;&quot;);
      final Set&lt;String&gt; allBodyClasses = Set.of(
<span class="udiff-line-removed">-         &quot;all-classes-frame&quot;,</span>
          &quot;all-classes-index&quot;,
          &quot;all-packages-index&quot;,
          &quot;class-declaration&quot;,
          &quot;class-use&quot;,
          &quot;constants-summary&quot;,
          &quot;deprecated-list&quot;,
          &quot;doc-file&quot;,
<span class="udiff-line-removed">-         &quot;frames&quot;,</span>
          &quot;help&quot;,
          &quot;index-redirect&quot;,
          &quot;module-declaration&quot;,
<span class="udiff-line-removed">-         &quot;module-frame&quot;,</span>
          &quot;module-index&quot;,
<span class="udiff-line-removed">-         &quot;module-index-frame&quot;,</span>
<span class="udiff-line-removed">-         &quot;module-package-index-frame&quot;,</span>
          &quot;package-declaration&quot;,
<span class="udiff-line-removed">-         &quot;package-frame&quot;,</span>
          &quot;package-index&quot;,
<span class="udiff-line-removed">-         &quot;package-index-frame&quot;,</span>
          &quot;package-tree&quot;,
          &quot;package-use&quot;,
          &quot;serialized-form&quot;,
          &quot;single-index&quot;,
          &quot;source&quot;,
          &quot;split-index&quot;,
<span class="udiff-line-added">+         &quot;system-properties&quot;,</span>
          &quot;tree&quot;
      );
  
      void checkBodyClasses() throws IOException {
          Path outputDirPath = outputDir.toPath();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -214,37 +202,31 @@</span>
      }
  
      final Pattern contentPattern = Pattern.compile(&quot;content=\&quot;([^\&quot;]+)\&quot;&gt;&quot;);
      final Pattern generatorPattern = Pattern.compile(&quot;content=\&quot;javadoc/([^\&quot;]+)\&quot;&gt;&quot;);
      final Set&lt;String&gt; allGenerators = Set.of(
<span class="udiff-line-removed">-             &quot;AllClassesFrameWriter&quot;,</span>
              &quot;AllClassesIndexWriter&quot;,
              &quot;AllPackagesIndexWriter&quot;,
              &quot;AnnotationTypeWriterImpl&quot;,
              &quot;ClassUseWriter&quot;,
              &quot;ClassWriterImpl&quot;,
              &quot;ConstantsSummaryWriterImpl&quot;,
              &quot;DeprecatedListWriter&quot;,
              &quot;DocFileWriter&quot;,
<span class="udiff-line-removed">-             &quot;FrameOutputWriter&quot;,</span>
              &quot;HelpWriter&quot;,
              &quot;IndexRedirectWriter&quot;,
<span class="udiff-line-removed">-             &quot;ModuleFrameWriter&quot;,</span>
<span class="udiff-line-removed">-             &quot;ModuleIndexFrameWriter&quot;,</span>
              &quot;ModuleIndexWriter&quot;,
<span class="udiff-line-removed">-             &quot;ModulePackageIndexFrameWriter&quot;,</span>
              &quot;ModuleWriterImpl&quot;,
<span class="udiff-line-removed">-             &quot;PackageFrameWriter&quot;,</span>
<span class="udiff-line-removed">-             &quot;PackageIndexFrameWriter&quot;,</span>
              &quot;PackageIndexWriter&quot;,
              &quot;PackageTreeWriter&quot;,
              &quot;PackageUseWriter&quot;,
              &quot;PackageWriterImpl&quot;,
              &quot;SerializedFormWriterImpl&quot;,
              &quot;SingleIndexWriter&quot;,
              &quot;SourceToHTMLConverter&quot;,
              &quot;SplitIndexWriter&quot;,
<span class="udiff-line-added">+             &quot;SystemPropertiesWriter&quot;,</span>
              &quot;TreeWriter&quot;
              );
  
      void checkMetadata() throws IOException {
          Path outputDirPath = outputDir.toPath();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -321,20 +303,10 @@</span>
              failed(&quot;Unrecognized line:\n&quot; + description);
              return;
          }
  
          switch (generator) {
<span class="udiff-line-removed">-             case &quot;AllClassesFrameWriter&quot;:</span>
<span class="udiff-line-removed">-             case &quot;FrameOutputWriter&quot;:</span>
<span class="udiff-line-removed">-             case &quot;ModuleFrameWriter&quot;:</span>
<span class="udiff-line-removed">-             case &quot;ModuleIndexFrameWriter&quot;:</span>
<span class="udiff-line-removed">-             case &quot;ModulePackageIndexFrameWriter&quot;:</span>
<span class="udiff-line-removed">-             case &quot;PackageFrameWriter&quot;:</span>
<span class="udiff-line-removed">-             case &quot;PackageIndexFrameWriter&quot;:</span>
<span class="udiff-line-removed">-                 check(generator, content, content.contains(&quot;frame&quot;));</span>
<span class="udiff-line-removed">-                 break;</span>
<span class="udiff-line-removed">- </span>
              case &quot;AllClassesIndexWriter&quot;:
              case &quot;AllPackagesIndexWriter&quot;:
              case &quot;ModuleIndexWriter&quot;:
              case &quot;PackageIndexWriter&quot;:
                  check(generator, content, content.contains(&quot;index&quot;));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -389,10 +361,14 @@</span>
  
              case &quot;SourceToHTMLConverter&quot;:
                  check(generator, content, content.startsWith(&quot;source:&quot;));
                  break;
  
<span class="udiff-line-added">+             case &quot;SystemPropertiesWriter&quot;:</span>
<span class="udiff-line-added">+                 check(generator, content, content.contains(&quot;system properties&quot;));</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+ </span>
              default:
                  failed(&quot;unexpected generator: &quot; + generator);
                  break;
          }
      }
</pre>
<center><a href="../testMemberSummary/TestMemberSummary.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../testMethodTypes/TestMethodTypes.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>