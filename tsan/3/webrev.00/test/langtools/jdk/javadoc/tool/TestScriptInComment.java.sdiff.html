<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/javadoc/tool/TestScriptInComment.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="T6551367.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="XWerror.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/javadoc/tool/TestScriptInComment.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  * @test
<span class="line-modified"> 26  * @bug 8138725</span>
 27  * @summary test --allow-script-in-comments
 28  * @modules jdk.javadoc/jdk.javadoc.internal.tool
 29  */
 30 
 31 import java.io.File;
 32 import java.io.FileWriter;
 33 import java.io.IOException;
 34 import java.io.PrintStream;
 35 import java.io.PrintWriter;
 36 import java.io.StringWriter;
 37 import java.util.ArrayList;
 38 import java.util.Arrays;
 39 import java.util.Collections;
 40 import java.util.List;
 41 import java.util.regex.Matcher;
 42 import java.util.regex.Pattern;
 43 
 44 /**
 45  * Combo-style test, exercising combinations of different HTML fragments that may contain
 46  * JavaScript, different places to place those fragments, and whether or not to allow the use
 47  * of JavaScript.
 48  */
 49 public class TestScriptInComment {
 50     public static void main(String... args) throws Exception {
 51         new TestScriptInComment().run();
 52     }
 53 
 54     /**
 55      * Representative samples of different fragments of HTML that may contain JavaScript.
 56      * To facilitate checking the output manually in a browser, the text &quot;#ALERT&quot; will be
 57      * replaced by a JavaScript call of &quot;alert(msg)&quot;, using a message string that is specific
 58      * to the test case.
 59      */
 60     enum Comment {
 61         LC(&quot;&lt;script&gt;#ALERT&lt;/script&gt;&quot;, true), // script tag in Lower Case
 62         UC(&quot;&lt;SCRIPT&gt;#ALERT&lt;/script&gt;&quot;, true), // script tag in Upper Case
 63         WS(&quot;&lt; script &gt;#ALERT&lt;/script&gt;&quot;, false, &quot;-Xdoclint:none&quot;), // script tag with invalid white space
 64         SP(&quot;&lt;script src=\&quot;file\&quot;&gt; #ALERT &lt;/script&gt;&quot;, true), // script tag with an attribute
 65         ON(&quot;&lt;a onclick=&#39;#ALERT&#39;&gt;x&lt;/a&gt;&quot;, true), // event handler attribute




 66         URI(&quot;&lt;a href=&#39;javascript:#ALERT&#39;&gt;x&lt;/a&gt;&quot;, true); // javascript URI
 67 
 68         /**
 69          * Creates an HTML fragment to be injected into a template.
 70          * @param text the HTML fragment to put into a doc comment or option.
 71          * @param hasScript whether or not this fragment does contain legal JavaScript
 72          * @param opts any additional options to be specified when javadoc is run
 73          */
 74         Comment(String text, boolean hasScript, String... opts) {
 75             this.text = text;
 76             this.hasScript = hasScript;
 77             this.opts = Arrays.asList(opts);
 78         }
 79 
 80         final String text;
 81         final boolean hasScript;
 82         final List&lt;String&gt; opts;
 83     };
 84 
 85     /**
</pre>
<hr />
<pre>
223         String test = template + &quot;-&quot; + comment + &quot;-&quot; + option;
224         out.println(&quot;Test: &quot; + test);
225 
226         File dir = new File(test);
227         dir.mkdirs();
228         File srcDir = new File(dir, &quot;src&quot;);
229         File outDir = new File(dir, &quot;out&quot;);
230 
231         String alert = &quot;alert(\&quot;&quot; + test + &quot;\&quot;);&quot;;
232         for (String src: template.sources) {
233             writeFile(template.getSrcFile(srcDir, src),
234                 src.replace(&quot;#COMMENT&quot;,
235                         &quot;/** &quot; + comment.text.replace(&quot;#ALERT&quot;, alert) + &quot; **/&quot;));
236         }
237 
238         List&lt;String&gt; opts = new ArrayList&lt;String&gt;();
239         opts.add(&quot;-sourcepath&quot;);
240         opts.add(srcDir.getPath());
241         opts.add(&quot;-d&quot;);
242         opts.add(outDir.getPath());
<span class="line-removed">243         opts.add(&quot;--frames&quot;);</span>
244         if (option.text != null)
245             opts.add(option.text);
246         for (String opt: template.getOpts(srcDir)) {
247             opts.add(opt.replace(&quot;#COMMENT&quot;, comment.text.replace(&quot;#ALERT&quot;, alert)));
248         }
249         opts.addAll(comment.opts);
250         opts.add(&quot;-noindex&quot;);   // index not required; save time/space writing files
251         opts.add(&quot;p&quot;);
252 
253         StringWriter sw = new StringWriter();
254         PrintWriter pw = new PrintWriter(sw);
255         int rc = javadoc(opts, pw);
256         pw.close();
257         String log = sw.toString();
258         writeFile(new File(dir, &quot;log.txt&quot;), log);
259 
260         out.println(&quot;opts: &quot; + opts);
261         out.println(&quot;  rc: &quot; + rc);
262         out.println(&quot; log:&quot;);
263         out.println(log);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  * @test
<span class="line-modified"> 26  * @bug 8138725 8226765</span>
 27  * @summary test --allow-script-in-comments
 28  * @modules jdk.javadoc/jdk.javadoc.internal.tool
 29  */
 30 
 31 import java.io.File;
 32 import java.io.FileWriter;
 33 import java.io.IOException;
 34 import java.io.PrintStream;
 35 import java.io.PrintWriter;
 36 import java.io.StringWriter;
 37 import java.util.ArrayList;
 38 import java.util.Arrays;
 39 import java.util.Collections;
 40 import java.util.List;
 41 import java.util.regex.Matcher;
 42 import java.util.regex.Pattern;
 43 
 44 /**
 45  * Combo-style test, exercising combinations of different HTML fragments that may contain
 46  * JavaScript, different places to place those fragments, and whether or not to allow the use
 47  * of JavaScript.
 48  */
 49 public class TestScriptInComment {
 50     public static void main(String... args) throws Exception {
 51         new TestScriptInComment().run();
 52     }
 53 
 54     /**
 55      * Representative samples of different fragments of HTML that may contain JavaScript.
 56      * To facilitate checking the output manually in a browser, the text &quot;#ALERT&quot; will be
 57      * replaced by a JavaScript call of &quot;alert(msg)&quot;, using a message string that is specific
 58      * to the test case.
 59      */
 60     enum Comment {
 61         LC(&quot;&lt;script&gt;#ALERT&lt;/script&gt;&quot;, true), // script tag in Lower Case
 62         UC(&quot;&lt;SCRIPT&gt;#ALERT&lt;/script&gt;&quot;, true), // script tag in Upper Case
 63         WS(&quot;&lt; script &gt;#ALERT&lt;/script&gt;&quot;, false, &quot;-Xdoclint:none&quot;), // script tag with invalid white space
 64         SP(&quot;&lt;script src=\&quot;file\&quot;&gt; #ALERT &lt;/script&gt;&quot;, true), // script tag with an attribute
 65         ON(&quot;&lt;a onclick=&#39;#ALERT&#39;&gt;x&lt;/a&gt;&quot;, true), // event handler attribute
<span class="line-added"> 66         OME(&quot;&lt;img alt=&#39;1&#39; onmouseenter=&#39;#ALERT&#39;&gt;&quot;, true), // onmouseenter event handler attribute</span>
<span class="line-added"> 67         OML(&quot;&lt;img alt=&#39;1&#39; onmouseleave=&#39;#ALERT&#39;&gt;&quot;, true), // onmouseleave event handler attribute</span>
<span class="line-added"> 68         OFI(&quot;&lt;a href=&#39;#&#39; onfocusin=&#39;#ALERT&#39;&gt;x&lt;/a&gt;&quot;, true), // onfocusin event handler attribute</span>
<span class="line-added"> 69         OBE(&quot;&lt;a onbogusevent=&#39;#ALERT&#39;&gt;x&lt;/a&gt;&quot;, true), // bogus/future event handler attribute</span>
 70         URI(&quot;&lt;a href=&#39;javascript:#ALERT&#39;&gt;x&lt;/a&gt;&quot;, true); // javascript URI
 71 
 72         /**
 73          * Creates an HTML fragment to be injected into a template.
 74          * @param text the HTML fragment to put into a doc comment or option.
 75          * @param hasScript whether or not this fragment does contain legal JavaScript
 76          * @param opts any additional options to be specified when javadoc is run
 77          */
 78         Comment(String text, boolean hasScript, String... opts) {
 79             this.text = text;
 80             this.hasScript = hasScript;
 81             this.opts = Arrays.asList(opts);
 82         }
 83 
 84         final String text;
 85         final boolean hasScript;
 86         final List&lt;String&gt; opts;
 87     };
 88 
 89     /**
</pre>
<hr />
<pre>
227         String test = template + &quot;-&quot; + comment + &quot;-&quot; + option;
228         out.println(&quot;Test: &quot; + test);
229 
230         File dir = new File(test);
231         dir.mkdirs();
232         File srcDir = new File(dir, &quot;src&quot;);
233         File outDir = new File(dir, &quot;out&quot;);
234 
235         String alert = &quot;alert(\&quot;&quot; + test + &quot;\&quot;);&quot;;
236         for (String src: template.sources) {
237             writeFile(template.getSrcFile(srcDir, src),
238                 src.replace(&quot;#COMMENT&quot;,
239                         &quot;/** &quot; + comment.text.replace(&quot;#ALERT&quot;, alert) + &quot; **/&quot;));
240         }
241 
242         List&lt;String&gt; opts = new ArrayList&lt;String&gt;();
243         opts.add(&quot;-sourcepath&quot;);
244         opts.add(srcDir.getPath());
245         opts.add(&quot;-d&quot;);
246         opts.add(outDir.getPath());

247         if (option.text != null)
248             opts.add(option.text);
249         for (String opt: template.getOpts(srcDir)) {
250             opts.add(opt.replace(&quot;#COMMENT&quot;, comment.text.replace(&quot;#ALERT&quot;, alert)));
251         }
252         opts.addAll(comment.opts);
253         opts.add(&quot;-noindex&quot;);   // index not required; save time/space writing files
254         opts.add(&quot;p&quot;);
255 
256         StringWriter sw = new StringWriter();
257         PrintWriter pw = new PrintWriter(sw);
258         int rc = javadoc(opts, pw);
259         pw.close();
260         String log = sw.toString();
261         writeFile(new File(dir, &quot;log.txt&quot;), log);
262 
263         out.println(&quot;opts: &quot; + opts);
264         out.println(&quot;  rc: &quot; + rc);
265         out.println(&quot; log:&quot;);
266         out.println(log);
</pre>
</td>
</tr>
</table>
<center><a href="T6551367.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="XWerror.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>