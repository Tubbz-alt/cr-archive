<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/javadoc/tool/modules/ModuleTestBase.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../dupOk/DupOk.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../outputRedirect/Test.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/javadoc/tool/modules/ModuleTestBase.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 24 import java.io.IOException;
 25 import java.io.PrintWriter;
 26 import java.io.StringWriter;
 27 import java.nio.file.Path;
 28 import java.nio.file.Paths;
 29 import java.util.Arrays;
 30 import java.util.HashSet;
 31 import java.util.List;
 32 import java.util.Locale;
 33 import java.util.Set;
 34 import java.util.TreeSet;
 35 import java.util.stream.Collectors;
 36 
 37 import javax.lang.model.SourceVersion;
 38 import javax.lang.model.element.Element;
 39 import javax.lang.model.element.ElementKind;
 40 import javax.lang.model.element.ModuleElement;
 41 import javax.lang.model.element.PackageElement;
 42 import javax.lang.model.element.TypeElement;
 43 import javax.lang.model.util.ElementFilter;
<span class="line-modified"> 44 import javax.lang.model.util.SimpleElementVisitor9;</span>
 45 
 46 import jdk.javadoc.doclet.Doclet;
 47 import jdk.javadoc.doclet.DocletEnvironment;
 48 import jdk.javadoc.doclet.Reporter;
 49 
 50 import toolbox.JavadocTask;
 51 import toolbox.Task;
 52 import toolbox.Task.Expect;
 53 import toolbox.TestRunner;
 54 import toolbox.ToolBox;
 55 
 56 import static toolbox.Task.OutputKind.*;
 57 
 58 /**
 59  * Base class for module tests.
 60  */
 61 public class ModuleTestBase extends TestRunner {
 62 
 63     // Field Separator
 64     private static final String FS = &quot; &quot;;
</pre>
<hr />
<pre>
284 
285     public static class ModulesTesterDoclet implements Doclet {
286         StringWriter sw = new StringWriter();
287         PrintWriter ps = new PrintWriter(sw);
288 
289         DocletEnvironment docEnv = null;
290 
291         boolean hasDocComments = false;
292 
293         String hasDocComments(Element e) {
294             String comment = docEnv.getElementUtils().getDocComment(e);
295             return comment != null &amp;&amp; !comment.isEmpty()
296                     ? &quot;hasDocComments&quot;
297                     : &quot;noDocComments&quot;;
298         }
299 
300         // csv style output, for simple regex verification
301         void printDataSet(String header, Set&lt;? extends Element&gt; set) {
302             for (Element e : set) {
303                 ps.print(header);
<span class="line-modified">304                 new SimpleElementVisitor9&lt;Void, Void&gt;() {</span>
305                     @Override
306                     public Void visitModule(ModuleElement e, Void p) {
307                         ps.print(FS);
308                         ps.print(e.getKind());
309                         ps.print(FS);
310                         ps.print(e.getQualifiedName());
311                         if (hasDocComments) {
312                             ps.print(FS);
313                             ps.print(hasDocComments(e));
314                         }
315                         ps.println();
316                         return null;
317                     }
318 
319                     @Override
320                     public Void visitPackage(PackageElement e, Void p) {
321                         ps.print(FS);
322                         ps.print(e.getKind());
323                         ps.print(FS);
324                         ps.print(e.getQualifiedName());
</pre>
<hr />
<pre>
330                         return null;
331                     }
332 
333                     @Override
334                     public Void visitType(TypeElement e, Void p) {
335                         ps.print(FS);
336                         ps.print(ElementKind.CLASS);
337                         ps.print(FS);
338                         ps.print(e.getQualifiedName());
339                         if (hasDocComments) {
340                             ps.print(FS);
341                             ps.print(hasDocComments(e));
342                         }
343                         ps.println();
344                         return null;
345                     }
346 
347                     @Override
348                     protected Void defaultAction(Element e, Void p) {
349                         Element encl = e.getEnclosingElement();
<span class="line-modified">350                         CharSequence fqn = new SimpleElementVisitor9&lt;CharSequence, Void&gt;() {</span>
351                             @Override
352                             public CharSequence visitModule(ModuleElement e, Void p) {
353                                 return e.getQualifiedName();
354                             }
355 
356                             @Override
357                             public CharSequence visitType(TypeElement e, Void p) {
358                                 return e.getQualifiedName();
359                             }
360 
361                             @Override
362                             public CharSequence visitPackage(PackageElement e, Void p) {
363                                 return e.getQualifiedName();
364                             }
365 
366                         }.visit(encl);
367 
368                         ps.print(FS);
369                         ps.print(ElementKind.METHOD); // always METHOD
370                         ps.print(FS);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 24 import java.io.IOException;
 25 import java.io.PrintWriter;
 26 import java.io.StringWriter;
 27 import java.nio.file.Path;
 28 import java.nio.file.Paths;
 29 import java.util.Arrays;
 30 import java.util.HashSet;
 31 import java.util.List;
 32 import java.util.Locale;
 33 import java.util.Set;
 34 import java.util.TreeSet;
 35 import java.util.stream.Collectors;
 36 
 37 import javax.lang.model.SourceVersion;
 38 import javax.lang.model.element.Element;
 39 import javax.lang.model.element.ElementKind;
 40 import javax.lang.model.element.ModuleElement;
 41 import javax.lang.model.element.PackageElement;
 42 import javax.lang.model.element.TypeElement;
 43 import javax.lang.model.util.ElementFilter;
<span class="line-modified"> 44 import javax.lang.model.util.SimpleElementVisitor14;</span>
 45 
 46 import jdk.javadoc.doclet.Doclet;
 47 import jdk.javadoc.doclet.DocletEnvironment;
 48 import jdk.javadoc.doclet.Reporter;
 49 
 50 import toolbox.JavadocTask;
 51 import toolbox.Task;
 52 import toolbox.Task.Expect;
 53 import toolbox.TestRunner;
 54 import toolbox.ToolBox;
 55 
 56 import static toolbox.Task.OutputKind.*;
 57 
 58 /**
 59  * Base class for module tests.
 60  */
 61 public class ModuleTestBase extends TestRunner {
 62 
 63     // Field Separator
 64     private static final String FS = &quot; &quot;;
</pre>
<hr />
<pre>
284 
285     public static class ModulesTesterDoclet implements Doclet {
286         StringWriter sw = new StringWriter();
287         PrintWriter ps = new PrintWriter(sw);
288 
289         DocletEnvironment docEnv = null;
290 
291         boolean hasDocComments = false;
292 
293         String hasDocComments(Element e) {
294             String comment = docEnv.getElementUtils().getDocComment(e);
295             return comment != null &amp;&amp; !comment.isEmpty()
296                     ? &quot;hasDocComments&quot;
297                     : &quot;noDocComments&quot;;
298         }
299 
300         // csv style output, for simple regex verification
301         void printDataSet(String header, Set&lt;? extends Element&gt; set) {
302             for (Element e : set) {
303                 ps.print(header);
<span class="line-modified">304                 new SimpleElementVisitor14&lt;Void, Void&gt;() {</span>
305                     @Override
306                     public Void visitModule(ModuleElement e, Void p) {
307                         ps.print(FS);
308                         ps.print(e.getKind());
309                         ps.print(FS);
310                         ps.print(e.getQualifiedName());
311                         if (hasDocComments) {
312                             ps.print(FS);
313                             ps.print(hasDocComments(e));
314                         }
315                         ps.println();
316                         return null;
317                     }
318 
319                     @Override
320                     public Void visitPackage(PackageElement e, Void p) {
321                         ps.print(FS);
322                         ps.print(e.getKind());
323                         ps.print(FS);
324                         ps.print(e.getQualifiedName());
</pre>
<hr />
<pre>
330                         return null;
331                     }
332 
333                     @Override
334                     public Void visitType(TypeElement e, Void p) {
335                         ps.print(FS);
336                         ps.print(ElementKind.CLASS);
337                         ps.print(FS);
338                         ps.print(e.getQualifiedName());
339                         if (hasDocComments) {
340                             ps.print(FS);
341                             ps.print(hasDocComments(e));
342                         }
343                         ps.println();
344                         return null;
345                     }
346 
347                     @Override
348                     protected Void defaultAction(Element e, Void p) {
349                         Element encl = e.getEnclosingElement();
<span class="line-modified">350                         CharSequence fqn = new SimpleElementVisitor14&lt;CharSequence, Void&gt;() {</span>
351                             @Override
352                             public CharSequence visitModule(ModuleElement e, Void p) {
353                                 return e.getQualifiedName();
354                             }
355 
356                             @Override
357                             public CharSequence visitType(TypeElement e, Void p) {
358                                 return e.getQualifiedName();
359                             }
360 
361                             @Override
362                             public CharSequence visitPackage(PackageElement e, Void p) {
363                                 return e.getQualifiedName();
364                             }
365 
366                         }.visit(encl);
367 
368                         ps.print(FS);
369                         ps.print(ElementKind.METHOD); // always METHOD
370                         ps.print(FS);
</pre>
</td>
</tr>
</table>
<center><a href="../dupOk/DupOk.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../outputRedirect/Test.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>