<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/javadoc/lib/javadoc/tester/HtmlChecker.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="A11yChecker.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="HtmlParser.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/javadoc/lib/javadoc/tester/HtmlChecker.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 26 import java.io.IOException;
 27 import java.io.PrintStream;
 28 import java.nio.file.FileVisitResult;
 29 import java.nio.file.Files;
 30 import java.nio.file.Path;
 31 import java.nio.file.Paths;
 32 import java.nio.file.SimpleFileVisitor;
 33 import java.nio.file.attribute.BasicFileAttributes;
 34 import java.util.Collections;
 35 import java.util.List;
 36 import java.util.Set;
 37 import java.util.function.Function;
 38 
 39 public abstract class HtmlChecker extends HtmlParser {
 40     static final Path currDir = Paths.get(&quot;.&quot;).toAbsolutePath().normalize();
 41 
 42     protected Path currFile;
 43     protected int files;
 44     protected int errors;
 45 
<span class="line-modified"> 46     HtmlChecker(PrintStream out, Function&lt;Path,String&gt; fileReader) {</span>
 47         super(out, fileReader);
 48     }
 49 
<span class="line-modified"> 50     void checkDirectory(Path dir) throws IOException {</span>
 51         checkFiles(List.of(dir), false, Collections.emptySet());
 52     }
 53 
<span class="line-modified"> 54     void checkFiles(List&lt;Path&gt; files, boolean skipSubdirs, Set&lt;Path&gt; excludeFiles) throws IOException {</span>
 55         for (Path file : files) {
 56             Files.walkFileTree(file, new SimpleFileVisitor&lt;Path&gt;() {
 57                 int depth = 0;
 58 
 59                 @Override
 60                 public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) {
 61                     if ((skipSubdirs &amp;&amp; depth &gt; 0) || excludeFiles.contains(dir)) {
 62                         return FileVisitResult.SKIP_SUBTREE;
 63                     }
 64                     depth++;
 65                     return FileVisitResult.CONTINUE;
 66                 }
 67 
 68                 @Override
 69                 public FileVisitResult visitFile(Path p, BasicFileAttributes attrs) {
 70                     if (excludeFiles.contains(p)) {
 71                         return FileVisitResult.CONTINUE;
 72                     }
 73 
 74                     if (Files.isRegularFile(p) &amp;&amp; p.getFileName().toString().endsWith(&quot;.html&quot;)) {
 75                         checkFile(p);
 76                     }
 77                     return FileVisitResult.CONTINUE;
 78                 }
 79 
 80                 @Override
 81                 public FileVisitResult postVisitDirectory(Path dir, IOException e) throws IOException {
 82                     depth--;
 83                     return super.postVisitDirectory(dir, e);
 84                 }
 85             });
 86         }
 87     }
 88 
<span class="line-modified"> 89     void checkFile(Path file) {</span>
 90         try {
 91             currFile = file.toAbsolutePath().normalize();
 92             read(file);
 93             files++;
 94         } catch (IOException e) {
 95             error(file, 0, e);
 96         }
 97     }
 98 
<span class="line-modified"> 99     abstract void report();</span>
100 
<span class="line-modified">101     int getErrorCount() {</span>
102         return errors;
103     }
104 
105     @Override
106     protected void error(Path file, int lineNumber, String message) {
107         super.error(relativePath(file), lineNumber, message);
108         errors++;
109     }
110 
111     @Override
112     protected void error(Path file, int lineNumber, Throwable t) {
113         super.error(relativePath(file), lineNumber, t);
114         errors++;
115     }
116 
117     protected Path relativePath(Path path) {
118         return path.startsWith(currDir) ? currDir.relativize(path) : path;
119     }
120 }
</pre>
</td>
<td>
<hr />
<pre>
 26 import java.io.IOException;
 27 import java.io.PrintStream;
 28 import java.nio.file.FileVisitResult;
 29 import java.nio.file.Files;
 30 import java.nio.file.Path;
 31 import java.nio.file.Paths;
 32 import java.nio.file.SimpleFileVisitor;
 33 import java.nio.file.attribute.BasicFileAttributes;
 34 import java.util.Collections;
 35 import java.util.List;
 36 import java.util.Set;
 37 import java.util.function.Function;
 38 
 39 public abstract class HtmlChecker extends HtmlParser {
 40     static final Path currDir = Paths.get(&quot;.&quot;).toAbsolutePath().normalize();
 41 
 42     protected Path currFile;
 43     protected int files;
 44     protected int errors;
 45 
<span class="line-modified"> 46     protected HtmlChecker(PrintStream out, Function&lt;Path,String&gt; fileReader) {</span>
 47         super(out, fileReader);
 48     }
 49 
<span class="line-modified"> 50     public void checkDirectory(Path dir) throws IOException {</span>
 51         checkFiles(List.of(dir), false, Collections.emptySet());
 52     }
 53 
<span class="line-modified"> 54     public void checkFiles(List&lt;Path&gt; files, boolean skipSubdirs, Set&lt;Path&gt; excludeFiles) throws IOException {</span>
 55         for (Path file : files) {
 56             Files.walkFileTree(file, new SimpleFileVisitor&lt;Path&gt;() {
 57                 int depth = 0;
 58 
 59                 @Override
 60                 public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) {
 61                     if ((skipSubdirs &amp;&amp; depth &gt; 0) || excludeFiles.contains(dir)) {
 62                         return FileVisitResult.SKIP_SUBTREE;
 63                     }
 64                     depth++;
 65                     return FileVisitResult.CONTINUE;
 66                 }
 67 
 68                 @Override
 69                 public FileVisitResult visitFile(Path p, BasicFileAttributes attrs) {
 70                     if (excludeFiles.contains(p)) {
 71                         return FileVisitResult.CONTINUE;
 72                     }
 73 
 74                     if (Files.isRegularFile(p) &amp;&amp; p.getFileName().toString().endsWith(&quot;.html&quot;)) {
 75                         checkFile(p);
 76                     }
 77                     return FileVisitResult.CONTINUE;
 78                 }
 79 
 80                 @Override
 81                 public FileVisitResult postVisitDirectory(Path dir, IOException e) throws IOException {
 82                     depth--;
 83                     return super.postVisitDirectory(dir, e);
 84                 }
 85             });
 86         }
 87     }
 88 
<span class="line-modified"> 89     protected void checkFile(Path file) {</span>
 90         try {
 91             currFile = file.toAbsolutePath().normalize();
 92             read(file);
 93             files++;
 94         } catch (IOException e) {
 95             error(file, 0, e);
 96         }
 97     }
 98 
<span class="line-modified"> 99     protected abstract void report();</span>
100 
<span class="line-modified">101     protected int getErrorCount() {</span>
102         return errors;
103     }
104 
105     @Override
106     protected void error(Path file, int lineNumber, String message) {
107         super.error(relativePath(file), lineNumber, message);
108         errors++;
109     }
110 
111     @Override
112     protected void error(Path file, int lineNumber, Throwable t) {
113         super.error(relativePath(file), lineNumber, t);
114         errors++;
115     }
116 
117     protected Path relativePath(Path path) {
118         return path.startsWith(currDir) ? currDir.relativize(path) : path;
119     }
120 }
</pre>
</td>
</tr>
</table>
<center><a href="A11yChecker.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="HtmlParser.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>