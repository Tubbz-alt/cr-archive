<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/langtools/jdk/javadoc/lib/javadoc/tester/A11yChecker.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package javadoc.tester;
 25 
 26 import java.io.PrintStream;
 27 import java.nio.file.Path;
 28 import java.util.Map;
 29 import java.util.Stack;
 30 import java.util.function.Function;
 31 
 32 /**
 33  * A class to check various aspects of accessibility in a set of HTML files.
 34  */
 35 public class A11yChecker extends HtmlChecker {
 36 
 37     private boolean html5;
 38 
 39     private int currRank;
 40     private int headingErrors;
 41 
 42     private boolean inBody;
 43     private boolean inNoScript;
 44     private Stack&lt;String&gt; regions = new Stack&lt;&gt;();
 45     private int regionErrors;
 46 
 47     A11yChecker(PrintStream out, Function&lt;Path,String&gt; fileReader) {
 48         super(out, fileReader);
 49     }
 50 
 51     int getErrorCount() {
 52         return errors;
 53     }
 54 
 55     @Override
 56     public void report() {
 57         if (headingErrors == 0) {
 58             out.println(&quot;All headings OK&quot;);
 59         } else {
 60             out.println(headingErrors + &quot; bad headings&quot;);
 61         }
 62 
 63         if (regionErrors == 0) {
 64             out.println(&quot;All regions OK&quot;);
 65         } else {
 66             out.println(regionErrors + &quot; errors in regions&quot;);
 67         }
 68     }
 69 
 70     @Override
 71     public void startFile(Path path) {
 72         html5 = false;
 73     }
 74 
 75     @Override
 76     public void endFile() {
 77     }
 78 
 79     @Override
 80     public void docType(String doctype) {
 81         html5 = doctype.matches(&quot;(?i)&lt;\\?doctype\\s+html&gt;&quot;);
 82     }
 83 
 84     @Override
 85     public void startElement(String name, Map&lt;String,String&gt; attrs, boolean selfClosing) {
 86         switch (name) {
 87             case &quot;body&quot;:
 88                 inBody = true;
 89                 currRank = 0;
 90                 break;
 91 
 92             case &quot;h1&quot;: case &quot;h2&quot;: case &quot;h3&quot;: case &quot;h4&quot;: case &quot;h5&quot;: case &quot;h6&quot;:
 93                 checkHeading(name);
 94                 break;
 95 
 96             case &quot;header&quot;: case &quot;footer&quot;: case &quot;main&quot;: case &quot;nav&quot;: case &quot;aside&quot;:
 97                 regions.push(name);
 98                 break;
 99 
100             case &quot;noscript&quot;:
101                 inNoScript = true;
102                 break;
103         }
104     }
105 
106     @Override
107     public void endElement(String name) {
108         switch (name) {
109             case &quot;body&quot;:
110                 inBody = false;
111                 break;
112 
113             case &quot;header&quot;: case &quot;footer&quot;: case &quot;main&quot;: case &quot;nav&quot;: case &quot;aside&quot;:
114                 if (regions.size() &gt; 0 &amp;&amp; regions.peek().equals(name)) {
115                     regions.pop();
116                 } else {
117                     error(currFile, getLineNumber(), &quot;unmatched tag: &quot; + name);
118                     regionErrors++;
119                 }
120                 break;
121 
122             case &quot;noscript&quot;:
123                 inNoScript = false;
124                 break;
125         }
126 
127     }
128 
129     private void checkHeading(String h) {
130         int rank = Character.digit(h.charAt(1), 10);
131         if (rank &gt; currRank + 1) {
132             headingErrors++;
133             StringBuilder sb = new StringBuilder();
134             String sep = &quot;&quot;;
135             for (int i = currRank + 1; i &lt; rank; i++) {
136                 sb.append(sep).append(&quot;h&quot;).append(i);
137                 sep = &quot;, &quot;;
138             }
139             error(currFile, getLineNumber(), &quot;missing headings: &quot; + sb);
140         }
141         currRank = rank;
142     }
143 
144     @Override
145     public void content(String s) {
146         if (html5 &amp;&amp; inBody &amp;&amp; !inNoScript &amp;&amp; !s.isBlank() &amp;&amp; regions.isEmpty()) {
147             error(currFile, getLineNumber(), &quot;content outside of any region&quot;);
148         }
149     }
150 }
    </pre>
  </body>
</html>