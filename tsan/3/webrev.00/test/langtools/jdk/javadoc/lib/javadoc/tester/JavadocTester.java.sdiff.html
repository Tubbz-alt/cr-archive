<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/javadoc/lib/javadoc/tester/JavadocTester.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="HtmlParser.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../tool/NoStar.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/javadoc/lib/javadoc/tester/JavadocTester.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  79  * &lt;dl&gt;
  80  * &lt;dt&gt;checkExitCode
  81  * &lt;dd&gt;Check the exit code returned from javadoc.
  82  * &lt;dt&gt;checkOutput
  83  * &lt;dd&gt;Perform a series of checks on the contents on a file or output stream
  84  *     generated by javadoc.
  85  *     The checks can be either that a series of strings are found or are not found.
  86  * &lt;dt&gt;checkFiles
  87  * &lt;dd&gt;Perform a series of checks on the files generated by javadoc.
  88  *     The checks can be that a series of files are found or are not found.
  89  * &lt;/dl&gt;
  90  *
  91  * &lt;pre&gt;&lt;code&gt;
  92  *  public class MyTester extends JavadocTester {
  93  *      public static void main(String... args) throws Exception {
  94  *          MyTester tester = new MyTester();
  95  *          tester.runTests();
  96  *      }
  97  *
  98  *      // test methods...
<span class="line-modified">  99  *      @Test</span>
 100  *      void test() {
 101  *          javadoc(&lt;i&gt;args&lt;/i&gt;);
 102  *          checkExit(Exit.OK);
 103  *          checkOutput(&lt;i&gt;file&lt;/i&gt;, true,
 104  *              &lt;i&gt;strings-to-find&lt;/i&gt;);
 105  *          checkOutput(&lt;i&gt;file&lt;/i&gt;, false,
 106  *              &lt;i&gt;strings-to-not-find&lt;/i&gt;);
 107  *      }
 108  *  }
 109  * &lt;/code&gt;&lt;/pre&gt;
 110  *
 111  * &lt;p&gt;
 112  * If javadoc is run more than once in a test method, you can compare the
 113  * results that are generated with the diff method. Since files written by
 114  * javadoc typically contain a timestamp, you may want to use the -notimestamp
 115  * option if you are going to compare the results from two runs of javadoc.
 116  *
 117  * &lt;p&gt;
 118  * If you have many calls of checkOutput that are very similar, you can write
 119  * your own check... method to reduce the amount of duplication. For example,
 120  * if you want to check that many files contain the same string, you could
 121  * write a method that takes a varargs list of files and calls checkOutput
 122  * on each file in turn with the string to be checked.
 123  *
 124  * &lt;p&gt;
 125  * You can also write you own custom check methods, which can use
 126  * readFile to get the contents of a file generated by javadoc,
 127  * and then use pass(...) or fail(...) to report whether the check
 128  * succeeded or not.
 129  *
 130  * &lt;p&gt;
 131  * You can have many separate test methods, each identified with a @Test
 132  * annotation. However, you should &lt;b&gt;not&lt;/b&gt; assume they will be called
 133  * in the order declared in your source file.  If the order of a series
 134  * of javadoc invocations is important, do that within a single method.
 135  * If the invocations are independent, for better clarity, use separate
 136  * test methods, each with their own set of checks on the results.
<span class="line-removed"> 137  *</span>
<span class="line-removed"> 138  * @author Doug Kramer</span>
<span class="line-removed"> 139  * @author Jamie Ho</span>
<span class="line-removed"> 140  * @author Jonathan Gibbons (rewrite)</span>
 141  */
 142 public abstract class JavadocTester {
 143 
 144     public static final String FS = System.getProperty(&quot;file.separator&quot;);
 145     public static final String PS = System.getProperty(&quot;path.separator&quot;);
 146     public static final String NL = System.getProperty(&quot;line.separator&quot;);


 147     public static final Path currDir = Paths.get(&quot;.&quot;).toAbsolutePath().normalize();
 148 
 149     public enum Output {
 150         /** The name of the output stream from javadoc. */
 151         OUT,
 152         /** The name for any output written to System.out. */
 153         STDOUT,
 154         /** The name for any output written to System.err. */
 155         STDERR
 156     }
 157 
 158     /** The output directory used in the most recent call of javadoc. */
 159     protected File outputDir;
 160 
 161     /** The output charset used in the most recent call of javadoc. */
 162     protected Charset charset = Charset.defaultCharset();
 163 
 164     /** The exit code of the most recent call of javadoc. */
 165     private int exitCode;
 166 
</pre>
<hr />
<pre>
 755     }
 756 
 757     /**
 758      * Read a file from the output directory.
 759      *
 760      * @param fileName  the name of the file to read
 761      * @return          the file in string format
 762      */
 763     public String readOutputFile(String fileName) throws Error {
 764         return readFile(outputDir, fileName);
 765     }
 766 
 767     protected String readFile(String fileName) throws Error {
 768         return readFile(outputDir, fileName);
 769     }
 770 
 771     protected String readFile(String baseDir, String fileName) throws Error {
 772         return readFile(new File(baseDir), fileName);
 773     }
 774 
<span class="line-modified"> 775     private String readFile(Path file) {</span>
 776         File baseDir;
 777         if (file.startsWith(outputDir.toPath())) {
 778             baseDir = outputDir;
 779         } else if (file.startsWith(currDir)) {
 780             baseDir = currDir.toFile();
 781         } else {
 782             baseDir = file.getParent().toFile();
 783         }
 784         String fileName = baseDir.toPath().relativize(file).toString();
 785         return readFile(baseDir, fileName);
 786     }
 787 
 788     /**
 789      * Reads the file and return it as a string.
 790      *
 791      * @param baseDir   the directory in which to locate the file
 792      * @param fileName  the name of the file to read
 793      * @return          the file in string format
 794      */
 795     private String readFile(File baseDir, String fileName) throws Error {
</pre>
</td>
<td>
<hr />
<pre>
  79  * &lt;dl&gt;
  80  * &lt;dt&gt;checkExitCode
  81  * &lt;dd&gt;Check the exit code returned from javadoc.
  82  * &lt;dt&gt;checkOutput
  83  * &lt;dd&gt;Perform a series of checks on the contents on a file or output stream
  84  *     generated by javadoc.
  85  *     The checks can be either that a series of strings are found or are not found.
  86  * &lt;dt&gt;checkFiles
  87  * &lt;dd&gt;Perform a series of checks on the files generated by javadoc.
  88  *     The checks can be that a series of files are found or are not found.
  89  * &lt;/dl&gt;
  90  *
  91  * &lt;pre&gt;&lt;code&gt;
  92  *  public class MyTester extends JavadocTester {
  93  *      public static void main(String... args) throws Exception {
  94  *          MyTester tester = new MyTester();
  95  *          tester.runTests();
  96  *      }
  97  *
  98  *      // test methods...
<span class="line-modified">  99  *      {@literal @}Test</span>
 100  *      void test() {
 101  *          javadoc(&lt;i&gt;args&lt;/i&gt;);
 102  *          checkExit(Exit.OK);
 103  *          checkOutput(&lt;i&gt;file&lt;/i&gt;, true,
 104  *              &lt;i&gt;strings-to-find&lt;/i&gt;);
 105  *          checkOutput(&lt;i&gt;file&lt;/i&gt;, false,
 106  *              &lt;i&gt;strings-to-not-find&lt;/i&gt;);
 107  *      }
 108  *  }
 109  * &lt;/code&gt;&lt;/pre&gt;
 110  *
 111  * &lt;p&gt;
 112  * If javadoc is run more than once in a test method, you can compare the
 113  * results that are generated with the diff method. Since files written by
 114  * javadoc typically contain a timestamp, you may want to use the -notimestamp
 115  * option if you are going to compare the results from two runs of javadoc.
 116  *
 117  * &lt;p&gt;
 118  * If you have many calls of checkOutput that are very similar, you can write
 119  * your own check... method to reduce the amount of duplication. For example,
 120  * if you want to check that many files contain the same string, you could
 121  * write a method that takes a varargs list of files and calls checkOutput
 122  * on each file in turn with the string to be checked.
 123  *
 124  * &lt;p&gt;
 125  * You can also write you own custom check methods, which can use
 126  * readFile to get the contents of a file generated by javadoc,
 127  * and then use pass(...) or fail(...) to report whether the check
 128  * succeeded or not.
 129  *
 130  * &lt;p&gt;
 131  * You can have many separate test methods, each identified with a @Test
 132  * annotation. However, you should &lt;b&gt;not&lt;/b&gt; assume they will be called
 133  * in the order declared in your source file.  If the order of a series
 134  * of javadoc invocations is important, do that within a single method.
 135  * If the invocations are independent, for better clarity, use separate
 136  * test methods, each with their own set of checks on the results.




 137  */
 138 public abstract class JavadocTester {
 139 
 140     public static final String FS = System.getProperty(&quot;file.separator&quot;);
 141     public static final String PS = System.getProperty(&quot;path.separator&quot;);
 142     public static final String NL = System.getProperty(&quot;line.separator&quot;);
<span class="line-added"> 143     public static final String thisRelease = System.getProperty(&quot;java.specification.version&quot;);</span>
<span class="line-added"> 144 </span>
 145     public static final Path currDir = Paths.get(&quot;.&quot;).toAbsolutePath().normalize();
 146 
 147     public enum Output {
 148         /** The name of the output stream from javadoc. */
 149         OUT,
 150         /** The name for any output written to System.out. */
 151         STDOUT,
 152         /** The name for any output written to System.err. */
 153         STDERR
 154     }
 155 
 156     /** The output directory used in the most recent call of javadoc. */
 157     protected File outputDir;
 158 
 159     /** The output charset used in the most recent call of javadoc. */
 160     protected Charset charset = Charset.defaultCharset();
 161 
 162     /** The exit code of the most recent call of javadoc. */
 163     private int exitCode;
 164 
</pre>
<hr />
<pre>
 753     }
 754 
 755     /**
 756      * Read a file from the output directory.
 757      *
 758      * @param fileName  the name of the file to read
 759      * @return          the file in string format
 760      */
 761     public String readOutputFile(String fileName) throws Error {
 762         return readFile(outputDir, fileName);
 763     }
 764 
 765     protected String readFile(String fileName) throws Error {
 766         return readFile(outputDir, fileName);
 767     }
 768 
 769     protected String readFile(String baseDir, String fileName) throws Error {
 770         return readFile(new File(baseDir), fileName);
 771     }
 772 
<span class="line-modified"> 773     protected String readFile(Path file) {</span>
 774         File baseDir;
 775         if (file.startsWith(outputDir.toPath())) {
 776             baseDir = outputDir;
 777         } else if (file.startsWith(currDir)) {
 778             baseDir = currDir.toFile();
 779         } else {
 780             baseDir = file.getParent().toFile();
 781         }
 782         String fileName = baseDir.toPath().relativize(file).toString();
 783         return readFile(baseDir, fileName);
 784     }
 785 
 786     /**
 787      * Reads the file and return it as a string.
 788      *
 789      * @param baseDir   the directory in which to locate the file
 790      * @param fileName  the name of the file to read
 791      * @return          the file in string format
 792      */
 793     private String readFile(File baseDir, String fileName) throws Error {
</pre>
</td>
</tr>
</table>
<center><a href="HtmlParser.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../tool/NoStar.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>