<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/jshell/DropTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="CustomEditor.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ExceptionsTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/jshell/DropTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8081431 8080069 8167128</span>
 27  * @summary Test of JShell#drop().
 28  * @build KullaTesting TestingInputStream
 29  * @run testng DropTest
 30  */
 31 
 32 import jdk.jshell.DeclarationSnippet;
 33 import jdk.jshell.Snippet;

 34 import jdk.jshell.VarSnippet;
 35 import org.testng.annotations.Test;
 36 
 37 import static jdk.jshell.Snippet.Status.*;
 38 
 39 @Test
 40 public class DropTest extends KullaTesting {
 41 
 42     public void testDrop() {
 43         Snippet var = varKey(assertEval(&quot;int x;&quot;));
 44         Snippet method = methodKey(assertEval(&quot;int mu() { return x * 4; }&quot;));
 45         Snippet clazz = classKey(assertEval(&quot;class C { String v() { return \&quot;#\&quot; + mu(); } }&quot;));
 46         assertDrop(var,
 47                 ste(var, VALID, DROPPED, true, null),
 48                 ste(method, VALID, RECOVERABLE_DEFINED, false, var));
 49         assertDrop(method,
 50                 ste(method, RECOVERABLE_DEFINED, DROPPED, true, null),
 51                 ste(clazz, VALID, RECOVERABLE_DEFINED, false, method));
 52         VarSnippet cc = varKey(assertEval(&quot;C c;&quot;));
 53         assertEvalUnresolvedException(&quot;new C();&quot;, &quot;C&quot;, 1, 0);
</pre>
<hr />
<pre>
208         String as2 = &quot;class A extends java.util.ArrayList&lt;Boolean&gt; {}&quot;;
209         Snippet a = classKey(assertEval(as1, added(VALID)));
210         Snippet b = classKey(assertEval(&quot;class B extends A {}&quot;, added(VALID)));
211         Snippet ax = classKey(assertEval(as2,
212                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
213                 ste(a, VALID, OVERWRITTEN, false, MAIN_SNIPPET),
214                 ste(b, VALID, VALID, true, MAIN_SNIPPET)));
215         ax = classKey(assertEval(as1,
216                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
217                 ste(ax, VALID, OVERWRITTEN, false, MAIN_SNIPPET),
218                 ste(b, VALID, VALID, true, MAIN_SNIPPET)));
219         assertDrop(b,
220                 ste(b, VALID, DROPPED, true, null));
221         ax = classKey(assertEval(as2,
222                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
223                 ste(ax, VALID, OVERWRITTEN, false, MAIN_SNIPPET)));
224         assertEval(as1,
225                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
226                 ste(ax, VALID, OVERWRITTEN, false, MAIN_SNIPPET));
227     }













228 }
</pre>
</td>
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8081431 8080069 8167128 8199623</span>
 27  * @summary Test of JShell#drop().
 28  * @build KullaTesting TestingInputStream
 29  * @run testng DropTest
 30  */
 31 
 32 import jdk.jshell.DeclarationSnippet;
 33 import jdk.jshell.Snippet;
<span class="line-added"> 34 import jdk.jshell.MethodSnippet;</span>
 35 import jdk.jshell.VarSnippet;
 36 import org.testng.annotations.Test;
 37 
 38 import static jdk.jshell.Snippet.Status.*;
 39 
 40 @Test
 41 public class DropTest extends KullaTesting {
 42 
 43     public void testDrop() {
 44         Snippet var = varKey(assertEval(&quot;int x;&quot;));
 45         Snippet method = methodKey(assertEval(&quot;int mu() { return x * 4; }&quot;));
 46         Snippet clazz = classKey(assertEval(&quot;class C { String v() { return \&quot;#\&quot; + mu(); } }&quot;));
 47         assertDrop(var,
 48                 ste(var, VALID, DROPPED, true, null),
 49                 ste(method, VALID, RECOVERABLE_DEFINED, false, var));
 50         assertDrop(method,
 51                 ste(method, RECOVERABLE_DEFINED, DROPPED, true, null),
 52                 ste(clazz, VALID, RECOVERABLE_DEFINED, false, method));
 53         VarSnippet cc = varKey(assertEval(&quot;C c;&quot;));
 54         assertEvalUnresolvedException(&quot;new C();&quot;, &quot;C&quot;, 1, 0);
</pre>
<hr />
<pre>
209         String as2 = &quot;class A extends java.util.ArrayList&lt;Boolean&gt; {}&quot;;
210         Snippet a = classKey(assertEval(as1, added(VALID)));
211         Snippet b = classKey(assertEval(&quot;class B extends A {}&quot;, added(VALID)));
212         Snippet ax = classKey(assertEval(as2,
213                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
214                 ste(a, VALID, OVERWRITTEN, false, MAIN_SNIPPET),
215                 ste(b, VALID, VALID, true, MAIN_SNIPPET)));
216         ax = classKey(assertEval(as1,
217                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
218                 ste(ax, VALID, OVERWRITTEN, false, MAIN_SNIPPET),
219                 ste(b, VALID, VALID, true, MAIN_SNIPPET)));
220         assertDrop(b,
221                 ste(b, VALID, DROPPED, true, null));
222         ax = classKey(assertEval(as2,
223                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
224                 ste(ax, VALID, OVERWRITTEN, false, MAIN_SNIPPET)));
225         assertEval(as1,
226                 ste(MAIN_SNIPPET, VALID, VALID, true, null),
227                 ste(ax, VALID, OVERWRITTEN, false, MAIN_SNIPPET));
228     }
<span class="line-added">229 </span>
<span class="line-added">230     // 8199623</span>
<span class="line-added">231     public void testTwoForkedDrop() {</span>
<span class="line-added">232         MethodSnippet p = methodKey(assertEval(&quot;void p() throws Exception { ((String) null).toString(); }&quot;));</span>
<span class="line-added">233         MethodSnippet n = methodKey(assertEval(&quot;void n() throws Exception { try { p(); } catch (Exception ex) { throw new RuntimeException(\&quot;bar\&quot;, ex); }}&quot;));</span>
<span class="line-added">234         MethodSnippet m = methodKey(assertEval(&quot;void m() { try { n(); } catch (Exception ex) { throw new RuntimeException(\&quot;foo\&quot;, ex); }}&quot;));</span>
<span class="line-added">235         MethodSnippet c = methodKey(assertEval(&quot;void c() throws Throwable { p(); }&quot;));</span>
<span class="line-added">236         assertDrop(p,</span>
<span class="line-added">237                 ste(p, VALID, DROPPED, true, null),</span>
<span class="line-added">238                 ste(n, VALID, RECOVERABLE_DEFINED, false, p),</span>
<span class="line-added">239                 ste(c, VALID, RECOVERABLE_DEFINED, false, p));</span>
<span class="line-added">240         assertActiveKeys();</span>
<span class="line-added">241     }</span>
242 }
</pre>
</td>
</tr>
</table>
<center><a href="CustomEditor.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ExceptionsTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>