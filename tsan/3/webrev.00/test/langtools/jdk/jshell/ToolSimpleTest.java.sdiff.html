<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/jshell/ToolSimpleTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="ToolLocalSimpleTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ToolTabSnippetTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/jshell/ToolSimpleTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8153716 8143955 8151754 8150382 8153920 8156910 8131024 8160089 8153897 8167128 8154513 8170015 8170368 8172102 8172103  8165405 8173073 8173848 8174041 8173916 8174028 8174262 8174797 8177079 8180508 8177466 8172154 8192979 8191842 8198573 8198801 8210596 8210959 8215099</span>
 27  * @summary Simple jshell tool tests
 28  * @modules jdk.compiler/com.sun.tools.javac.api
 29  *          jdk.compiler/com.sun.tools.javac.main
 30  *          jdk.jdeps/com.sun.tools.javap
 31  *          jdk.jshell/jdk.internal.jshell.tool
 32  * @build KullaTesting TestingInputStream
 33  * @run testng/othervm ToolSimpleTest
 34  */
 35 
 36 import java.util.ArrayList;
 37 import java.util.Arrays;
 38 import java.util.List;
 39 import java.util.Locale;
 40 import java.util.function.Consumer;
 41 import java.util.regex.Pattern;
 42 import java.util.stream.Collectors;
 43 import java.util.stream.Stream;
 44 
 45 import org.testng.annotations.Test;
 46 
</pre>
<hr />
<pre>
253         test(
254                 (a) -&gt; assertCommand(a, &quot;undefined x&quot;,
255                         &quot;|  created variable x, however, it cannot be referenced until class undefined is declared&quot;),
256                 (a) -&gt; assertCommand(a, &quot;/vars&quot;, &quot;|    undefined x = (not-active)&quot;)
257         );
258     }
259 
260     @Test
261     public void testUnresolved() {
262         test(
263                 (a) -&gt; assertCommand(a, &quot;int f() { return g() + x + new A().a; }&quot;,
264                         &quot;|  created method f(), however, it cannot be invoked until method g(), variable x, and class A are declared&quot;),
265                 (a) -&gt; assertCommand(a, &quot;f()&quot;,
266                         &quot;|  attempted to call method f() which cannot be invoked until method g(), variable x, and class A are declared&quot;),
267                 (a) -&gt; assertCommandOutputStartsWith(a, &quot;int g() { return x; }&quot;,
268                         &quot;|  created method g(), however, it cannot be invoked until variable x is declared&quot;),
269                 (a) -&gt; assertCommand(a, &quot;g()&quot;, &quot;|  attempted to call method g() which cannot be invoked until variable x is declared&quot;)
270         );
271     }
272 



























273     @Test
274     public void testUnknownCommand() {
275         test((a) -&gt; assertCommand(a, &quot;/unknown&quot;,
276                 &quot;|  Invalid command: /unknown\n&quot; +
277                 &quot;|  Type /help for help.&quot;));
278     }
279 
280     @Test
281     public void testEmptyClassPath() {
282         test(after -&gt; assertCommand(after, &quot;/env --class-path&quot;, &quot;|  Argument to class-path missing.&quot;));
283     }
284 
285     @Test
286     public void testInvalidClassPath() {
287         test(
288                 a -&gt; assertCommand(a, &quot;/env --class-path snurgefusal&quot;,
289                         &quot;|  File &#39;snurgefusal&#39; for &#39;--class-path&#39; is not found.&quot;),
290                 a -&gt; assertCommand(a, &quot;/env --class-path ?&quot;,
291                         &quot;|  File &#39;?&#39; for &#39;--class-path&#39; is not found.&quot;)
292         );
</pre>
<hr />
<pre>
858                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r1&quot;, &quot;|    &lt;anonymous class extending Object&gt; r1 = &quot;),
859                 (a) -&gt; assertCommandOutputContains(a, &quot;var r2 = new Runnable() { public void run() { } }&quot;, &quot;r2&quot;),
860                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r2&quot;, &quot;|    &lt;anonymous class implementing Runnable&gt; r2 = &quot;),
861                 (a) -&gt; assertCommandOutputContains(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;),
862                 (a) -&gt; assertCommandOutputContains(a, &quot;var list = Stream.of(1, 2, 3).map(j -&gt; new Object() { int i = j; }).collect(Collectors.toList());&quot;,
863                                                       &quot;list&quot;),
864                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars list&quot;, &quot;|    List&lt;&lt;anonymous class extending Object&gt;&gt; list = &quot;)
865         );
866     }
867 
868     // This is mainly interesting in the TestLocalSimpleTest case (8198573)
869     @Test
870     public void testUpdateFalsePositive() {
871         test(
872                 a -&gt; assertClass(a, &quot;class A { int a() { int error = 0; return error; } }&quot;, &quot;class&quot;, &quot;A&quot;),
873                 a -&gt; assertVariable(a, &quot;A&quot;, &quot;a&quot;, &quot;new A()&quot;, &quot;A@.+&quot;),
874                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;error&quot;, &quot;4711&quot;, &quot;4711&quot;),
875                 a -&gt; assertCommandOutputContains(a, &quot;a&quot;, &quot;A@&quot;)
876         );
877     }










878 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8153716 8143955 8151754 8150382 8153920 8156910 8131024 8160089 8153897 8167128 8154513 8170015 8170368 8172102 8172103  8165405 8173073 8173848 8174041 8173916 8174028 8174262 8174797 8177079 8180508 8177466 8172154 8192979 8191842 8198573 8198801 8210596 8210959 8215099 8199623 8236715</span>
 27  * @summary Simple jshell tool tests
 28  * @modules jdk.compiler/com.sun.tools.javac.api
 29  *          jdk.compiler/com.sun.tools.javac.main
 30  *          jdk.jdeps/com.sun.tools.javap
 31  *          jdk.jshell/jdk.internal.jshell.tool
 32  * @build KullaTesting TestingInputStream
 33  * @run testng/othervm ToolSimpleTest
 34  */
 35 
 36 import java.util.ArrayList;
 37 import java.util.Arrays;
 38 import java.util.List;
 39 import java.util.Locale;
 40 import java.util.function.Consumer;
 41 import java.util.regex.Pattern;
 42 import java.util.stream.Collectors;
 43 import java.util.stream.Stream;
 44 
 45 import org.testng.annotations.Test;
 46 
</pre>
<hr />
<pre>
253         test(
254                 (a) -&gt; assertCommand(a, &quot;undefined x&quot;,
255                         &quot;|  created variable x, however, it cannot be referenced until class undefined is declared&quot;),
256                 (a) -&gt; assertCommand(a, &quot;/vars&quot;, &quot;|    undefined x = (not-active)&quot;)
257         );
258     }
259 
260     @Test
261     public void testUnresolved() {
262         test(
263                 (a) -&gt; assertCommand(a, &quot;int f() { return g() + x + new A().a; }&quot;,
264                         &quot;|  created method f(), however, it cannot be invoked until method g(), variable x, and class A are declared&quot;),
265                 (a) -&gt; assertCommand(a, &quot;f()&quot;,
266                         &quot;|  attempted to call method f() which cannot be invoked until method g(), variable x, and class A are declared&quot;),
267                 (a) -&gt; assertCommandOutputStartsWith(a, &quot;int g() { return x; }&quot;,
268                         &quot;|  created method g(), however, it cannot be invoked until variable x is declared&quot;),
269                 (a) -&gt; assertCommand(a, &quot;g()&quot;, &quot;|  attempted to call method g() which cannot be invoked until variable x is declared&quot;)
270         );
271     }
272 
<span class="line-added">273     // 8199623</span>
<span class="line-added">274     @Test</span>
<span class="line-added">275     public void testTwoForkedDrop() {</span>
<span class="line-added">276         test(</span>
<span class="line-added">277                 (a) -&gt; assertCommand(a, &quot;void p() throws Exception { ((String) null).toString(); }&quot;,</span>
<span class="line-added">278                         &quot;|  created method p()&quot;),</span>
<span class="line-added">279                 (a) -&gt; assertCommand(a, &quot;void n() throws Exception { try { p(); } catch (Exception ex) { throw new IOException(\&quot;bar\&quot;, ex); }} &quot;,</span>
<span class="line-added">280                         &quot;|  created method n()&quot;),</span>
<span class="line-added">281                 (a) -&gt; assertCommand(a, &quot;void m() { try { n(); } catch (Exception ex) { throw new RuntimeException(\&quot;foo\&quot;, ex); }}&quot;,</span>
<span class="line-added">282                         &quot;|  created method m()&quot;),</span>
<span class="line-added">283                 (a) -&gt; assertCommand(a, &quot;void c() throws Throwable { p(); }&quot;,</span>
<span class="line-added">284                         &quot;|  created method c()&quot;),</span>
<span class="line-added">285                 (a) -&gt; assertCommand(a, &quot;/drop p&quot;,</span>
<span class="line-added">286                         &quot;|  dropped method p()&quot;),</span>
<span class="line-added">287                 (a) -&gt; assertCommand(a, &quot;m()&quot;,</span>
<span class="line-added">288                         &quot;|  attempted to call method n() which cannot be invoked until method p() is declared&quot;),</span>
<span class="line-added">289                 (a) -&gt; assertCommand(a, &quot;/meth n&quot;,</span>
<span class="line-added">290                         &quot;|    void n()\n&quot; +</span>
<span class="line-added">291                         &quot;|       which cannot be invoked until method p() is declared&quot;),</span>
<span class="line-added">292                 (a) -&gt; assertCommand(a, &quot;/meth m&quot;,</span>
<span class="line-added">293                         &quot;|    void m()&quot;),</span>
<span class="line-added">294                 (a) -&gt; assertCommand(a, &quot;/meth c&quot;,</span>
<span class="line-added">295                         &quot;|    void c()\n&quot; +</span>
<span class="line-added">296                                 &quot;|       which cannot be invoked until method p() is declared&quot;)</span>
<span class="line-added">297         );</span>
<span class="line-added">298     }</span>
<span class="line-added">299 </span>
300     @Test
301     public void testUnknownCommand() {
302         test((a) -&gt; assertCommand(a, &quot;/unknown&quot;,
303                 &quot;|  Invalid command: /unknown\n&quot; +
304                 &quot;|  Type /help for help.&quot;));
305     }
306 
307     @Test
308     public void testEmptyClassPath() {
309         test(after -&gt; assertCommand(after, &quot;/env --class-path&quot;, &quot;|  Argument to class-path missing.&quot;));
310     }
311 
312     @Test
313     public void testInvalidClassPath() {
314         test(
315                 a -&gt; assertCommand(a, &quot;/env --class-path snurgefusal&quot;,
316                         &quot;|  File &#39;snurgefusal&#39; for &#39;--class-path&#39; is not found.&quot;),
317                 a -&gt; assertCommand(a, &quot;/env --class-path ?&quot;,
318                         &quot;|  File &#39;?&#39; for &#39;--class-path&#39; is not found.&quot;)
319         );
</pre>
<hr />
<pre>
885                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r1&quot;, &quot;|    &lt;anonymous class extending Object&gt; r1 = &quot;),
886                 (a) -&gt; assertCommandOutputContains(a, &quot;var r2 = new Runnable() { public void run() { } }&quot;, &quot;r2&quot;),
887                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r2&quot;, &quot;|    &lt;anonymous class implementing Runnable&gt; r2 = &quot;),
888                 (a) -&gt; assertCommandOutputContains(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;),
889                 (a) -&gt; assertCommandOutputContains(a, &quot;var list = Stream.of(1, 2, 3).map(j -&gt; new Object() { int i = j; }).collect(Collectors.toList());&quot;,
890                                                       &quot;list&quot;),
891                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars list&quot;, &quot;|    List&lt;&lt;anonymous class extending Object&gt;&gt; list = &quot;)
892         );
893     }
894 
895     // This is mainly interesting in the TestLocalSimpleTest case (8198573)
896     @Test
897     public void testUpdateFalsePositive() {
898         test(
899                 a -&gt; assertClass(a, &quot;class A { int a() { int error = 0; return error; } }&quot;, &quot;class&quot;, &quot;A&quot;),
900                 a -&gt; assertVariable(a, &quot;A&quot;, &quot;a&quot;, &quot;new A()&quot;, &quot;A@.+&quot;),
901                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;error&quot;, &quot;4711&quot;, &quot;4711&quot;),
902                 a -&gt; assertCommandOutputContains(a, &quot;a&quot;, &quot;A@&quot;)
903         );
904     }
<span class="line-added">905 </span>
<span class="line-added">906     @Test</span>
<span class="line-added">907     public void testRecords() {</span>
<span class="line-added">908         test(new String[] {&quot;--enable-preview&quot;},</span>
<span class="line-added">909                 (a) -&gt; assertCommandOutputContains(a, &quot;record R(int i) { public int g() { return j; } }&quot;,</span>
<span class="line-added">910                         &quot;|  created record R, however, it cannot be instantiated or its methods invoked until variable j is declared&quot;),</span>
<span class="line-added">911                 (a) -&gt; assertCommandOutputContains(a, &quot;new R(0)&quot;,</span>
<span class="line-added">912                         &quot;|  attempted to use record R which cannot be instantiated or its methods invoked until variable j is declared&quot;)</span>
<span class="line-added">913         );</span>
<span class="line-added">914     }</span>
915 }
</pre>
</td>
</tr>
</table>
<center><a href="ToolLocalSimpleTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ToolTabSnippetTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>