<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/langtools/jdk/jshell/ToolSimpleTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8153716 8143955 8151754 8150382 8153920 8156910 8131024 8160089 8153897 8167128 8154513 8170015 8170368 8172102 8172103  8165405 8173073 8173848 8174041 8173916 8174028 8174262 8174797 8177079 8180508 8177466 8172154 8192979 8191842 8198573 8198801 8210596 8210959 8215099
 27  * @summary Simple jshell tool tests
 28  * @modules jdk.compiler/com.sun.tools.javac.api
 29  *          jdk.compiler/com.sun.tools.javac.main
 30  *          jdk.jdeps/com.sun.tools.javap
 31  *          jdk.jshell/jdk.internal.jshell.tool
 32  * @build KullaTesting TestingInputStream
 33  * @run testng/othervm ToolSimpleTest
 34  */
 35 
 36 import java.util.ArrayList;
 37 import java.util.Arrays;
 38 import java.util.List;
 39 import java.util.Locale;
 40 import java.util.function.Consumer;
 41 import java.util.regex.Pattern;
 42 import java.util.stream.Collectors;
 43 import java.util.stream.Stream;
 44 
 45 import org.testng.annotations.Test;
 46 
 47 import static org.testng.Assert.assertEquals;
 48 import static org.testng.Assert.assertTrue;
 49 
 50 public class ToolSimpleTest extends ReplToolTesting {
 51 
 52     @Test
 53     public void testRemaining() {
 54         test(
 55                 (a) -&gt; assertCommand(a, &quot;int z; z =&quot;, &quot;z ==&gt; 0&quot;),
 56                 (a) -&gt; assertCommand(a, &quot;5&quot;, &quot;z ==&gt; 5&quot;),
 57                 (a) -&gt; assertCommand(a, &quot;/*nada*/; int q =&quot;, &quot;&quot;),
 58                 (a) -&gt; assertCommand(a, &quot;77&quot;, &quot;q ==&gt; 77&quot;),
 59                 (a) -&gt; assertCommand(a, &quot;//comment;&quot;, &quot;&quot;),
 60                 (a) -&gt; assertCommand(a, &quot;int v;&quot;, &quot;v ==&gt; 0&quot;),
 61                 (a) -&gt; assertCommand(a, &quot;int v; int c&quot;,
 62                         &quot;v ==&gt; 0\n&quot; +
 63                         &quot;c ==&gt; 0&quot;)
 64         );
 65     }
 66 
 67     @Test
 68     public void testOpenComment() {
 69         test(
 70                 (a) -&gt; assertCommand(a, &quot;int z = /* blah&quot;, &quot;&quot;),
 71                 (a) -&gt; assertCommand(a, &quot;baz */ 5&quot;, &quot;z ==&gt; 5&quot;),
 72                 (a) -&gt; assertCommand(a, &quot;/** hoge &quot;, &quot;&quot;),
 73                 (a) -&gt; assertCommand(a, &quot;baz **/&quot;, &quot;&quot;),
 74                 (a) -&gt; assertCommand(a, &quot;int v&quot;, &quot;v ==&gt; 0&quot;)
 75         );
 76     }
 77 
 78     @Test
 79     public void testSwitchExpression() {
 80         test(false, new String[]{&quot;--enable-preview&quot;, &quot;--no-startup&quot;},
 81                 (a) -&gt; assertCommand(a, &quot;enum Day {MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY }&quot;, &quot;|  created enum Day&quot;),
 82                 (a) -&gt; assertCommand(a, &quot;Day day = Day.FRIDAY;&quot;, &quot;day ==&gt; FRIDAY&quot;),
 83                 (a) -&gt; assertCommand(a, &quot;switch (day) {&quot;, &quot;&quot;),
 84                 (a) -&gt; assertCommand(a, &quot;case MONDAY, FRIDAY, SUNDAY -&gt; 6;&quot;, &quot;&quot;),
 85                 (a) -&gt; assertCommand(a, &quot;case TUESDAY -&gt; 7;&quot;, &quot;&quot;),
 86                 (a) -&gt; assertCommand(a, &quot;case THURSDAY, SATURDAY -&gt; 8;&quot;, &quot;&quot;),
 87                 (a) -&gt; assertCommand(a, &quot;case WEDNESDAY -&gt; 9;&quot;, &quot;&quot;),
 88                 (a) -&gt; assertCommandOutputContains(a, &quot;}&quot;, &quot; ==&gt; 6&quot;)
 89                 );
 90     }
 91 
 92     @Test
 93     public void testSwitchExpressionCompletion() {
 94         test(false, new String[]{&quot;--enable-preview&quot;, &quot;--no-startup&quot;},
 95                 (a) -&gt; assertCommand(a, &quot;enum Day {MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY }&quot;, &quot;|  created enum Day&quot;),
 96                 (a) -&gt; assertCommand(a, &quot;Day day = Day.FRIDAY;&quot;, &quot;day ==&gt; FRIDAY&quot;),
 97                 (a) -&gt; assertCommand(a, &quot;switch (day) {&quot;, &quot;&quot;),
 98                 (a) -&gt; assertCommand(a, &quot;case MONDAY, FRIDAY, SUNDAY -&gt; 6;&quot;, &quot;&quot;),
 99                 (a) -&gt; assertCommand(a, &quot;case TUESDAY -&gt; 7;&quot;, &quot;&quot;),
100                 (a) -&gt; assertCommand(a, &quot;case THURSDAY, SATURDAY -&gt; 8;&quot;, &quot;&quot;),
101                 (a) -&gt; assertCommand(a, &quot;case WEDNESDAY -&gt; 9;&quot;, &quot;&quot;),
102                 (a) -&gt; assertCommand(a, &quot;} +&quot;, &quot;&quot;),
103                 (a) -&gt; assertCommandOutputContains(a, &quot;1000&quot;, &quot; ==&gt; 1006&quot;)
104                 );
105     }
106 
107     @Test
108     public void testLessThan() {
109         test(
110                 (a) -&gt; assertCommand(a, &quot;45&quot;, &quot;$1 ==&gt; 45&quot;),
111                 (a) -&gt; assertCommand(a, &quot;72&quot;, &quot;$2 ==&gt; 72&quot;),
112                 (a) -&gt; assertCommand(a, &quot;$1 &lt; $2&quot;, &quot;$3 ==&gt; true&quot;),
113                 (a) -&gt; assertCommand(a, &quot;int a, b&quot;, &quot;a ==&gt; 0\n&quot; +
114                         &quot;b ==&gt; 0&quot;),
115                 (a) -&gt; assertCommand(a, &quot;a &lt; b&quot;, &quot;$6 ==&gt; false&quot;)
116         );
117     }
118 
119     @Test
120     public void testChainedThrow() {
121         test(
122                 (a) -&gt; assertCommand(a, &quot;void p() throws Exception { ((String) null).toString(); }&quot;,
123                         &quot;|  created method p()&quot;),
124                 (a) -&gt; assertCommand(a, &quot;void n() throws Exception { try { p(); } catch (Exception ex) { throw new IOException(\&quot;bar\&quot;, ex); }}&quot;,
125                         &quot;|  created method n()&quot;),
126                 (a) -&gt; assertCommand(a, &quot;void m() { try { n(); } catch (Exception ex) { throw new RuntimeException(\&quot;foo\&quot;, ex); }}&quot;,
127                         &quot;|  created method m()&quot;),
128                 (a) -&gt; assertCommand(a, &quot;m()&quot;,
129                           &quot;|  Exception java.lang.RuntimeException: foo\n&quot;
130                         + &quot;|        at m (#3:1)\n&quot;
131                         + &quot;|        at (#4:1)\n&quot;
132                         + &quot;|  Caused by: java.io.IOException: bar\n&quot;
133                         + &quot;|        at n (#2:1)\n&quot;
134                         + &quot;|        ...\n&quot;
135                         + &quot;|  Caused by: java.lang.NullPointerException\n&quot;
136                         + &quot;|        at p (#1:1)\n&quot;
137                         + &quot;|        ...&quot;),
138                 (a) -&gt; assertCommand(a, &quot;/drop p&quot;,
139                         &quot;|  dropped method p()&quot;),
140                 (a) -&gt; assertCommand(a, &quot;m()&quot;,
141                         &quot;|  attempted to call method n() which cannot be invoked until method p() is declared&quot;)
142         );
143     }
144 
145     @Test
146     public void testThrowWithPercent() {
147         test(
148                 (a) -&gt; assertCommandCheckOutput(a,
149                         &quot;URI u = new URI(\&quot;http\&quot;, null, \&quot;h\&quot;, -1, \&quot;a\&quot; + (char)0x04, null, null);&quot;, (s) -&gt;
150                                 assertTrue(s.contains(&quot;URISyntaxException&quot;) &amp;&amp; !s.contains(&quot;JShellTool&quot;),
151                                         &quot;Output: &#39;&quot; + s + &quot;&#39;&quot;)),
152                 (a) -&gt; assertCommandCheckOutput(a,
153                         &quot;throw new Exception(\&quot;%z\&quot;)&quot;, (s) -&gt;
154                                 assertTrue(s.contains(&quot;java.lang.Exception&quot;) &amp;&amp; !s.contains(&quot;UnknownFormatConversionException&quot;),
155                                         &quot;Output: &#39;&quot; + s + &quot;&#39;&quot;))
156         );
157     }
158 
159     @Test
160     public void oneLineOfError() {
161         test(
162                 (a) -&gt; assertCommand(a, &quot;12+&quot;, null),
163                 (a) -&gt; assertCommandCheckOutput(a, &quot;  true&quot;, (s) -&gt;
164                         assertTrue(s.contains(&quot;12+&quot;) &amp;&amp; !s.contains(&quot;true&quot;), &quot;Output: &#39;&quot; + s + &quot;&#39;&quot;))
165         );
166     }
167 
168     @Test
169     public void defineVariables() {
170         test(
171                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
172                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
173                 (a) -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
174                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
175                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
176                 (a) -&gt; assertVariable(a, &quot;double&quot;, &quot;a&quot;, &quot;1&quot;, &quot;1.0&quot;),
177                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
178                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
179                 (a) -&gt; evaluateExpression(a, &quot;double&quot;, &quot;2 * a&quot;, &quot;2.0&quot;),
180                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
181                 (a) -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables())
182         );
183     }
184 
185     @Test
186     public void defineMethods() {
187         test(
188                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
189                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
190                 (a) -&gt; assertMethod(a, &quot;int f() { return 0; }&quot;, &quot;()int&quot;, &quot;f&quot;),
191                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
192                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
193                 (a) -&gt; assertMethod(a, &quot;void f(int a) { g(); }&quot;, &quot;(int)void&quot;, &quot;f&quot;),
194                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
195                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
196                 (a) -&gt; assertMethod(a, &quot;void g() {}&quot;, &quot;()void&quot;, &quot;g&quot;),
197                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
198                 (a) -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods())
199         );
200     }
201 
202     @Test
203     public void defineTypes() {
204         test(
205                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
206                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
207                 (a) -&gt; assertClass(a, &quot;class A { }&quot;, &quot;class&quot;, &quot;A&quot;),
208                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
209                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
210                 (a) -&gt; assertClass(a, &quot;interface A { }&quot;, &quot;interface&quot;, &quot;A&quot;),
211                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
212                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
213                 (a) -&gt; assertClass(a, &quot;enum A { }&quot;, &quot;enum&quot;, &quot;A&quot;),
214                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
215                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
216                 (a) -&gt; assertClass(a, &quot;@interface A { }&quot;, &quot;@interface&quot;, &quot;A&quot;),
217                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
218                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses())
219         );
220     }
221 
222     @Test
223     public void defineImports() {
224         test(
225                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
226                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
227                 (a) -&gt; assertImport(a, &quot;import java.util.stream.Stream;&quot;, &quot;&quot;, &quot;java.util.stream.Stream&quot;),
228                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
229                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
230                 (a) -&gt; assertImport(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;, &quot;java.util.stream.*&quot;),
231                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
232                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
233                 (a) -&gt; assertImport(a, &quot;import static java.lang.Math.PI;&quot;, &quot;static&quot;, &quot;java.lang.Math.PI&quot;),
234                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
235                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports()),
236                 (a) -&gt; assertImport(a, &quot;import static java.lang.Math.*;&quot;, &quot;static&quot;, &quot;java.lang.Math.*&quot;),
237                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
238                 (a) -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports())
239         );
240     }
241 
242     @Test
243     public void defineVar() {
244         test(
245                 (a) -&gt; assertCommand(a, &quot;int x = 72&quot;, &quot;x ==&gt; 72&quot;),
246                 (a) -&gt; assertCommand(a, &quot;x&quot;, &quot;x ==&gt; 72&quot;),
247                 (a) -&gt; assertCommand(a, &quot;/vars&quot;, &quot;|    int x = 72&quot;)
248         );
249     }
250 
251     @Test
252     public void defineUnresolvedVar() {
253         test(
254                 (a) -&gt; assertCommand(a, &quot;undefined x&quot;,
255                         &quot;|  created variable x, however, it cannot be referenced until class undefined is declared&quot;),
256                 (a) -&gt; assertCommand(a, &quot;/vars&quot;, &quot;|    undefined x = (not-active)&quot;)
257         );
258     }
259 
260     @Test
261     public void testUnresolved() {
262         test(
263                 (a) -&gt; assertCommand(a, &quot;int f() { return g() + x + new A().a; }&quot;,
264                         &quot;|  created method f(), however, it cannot be invoked until method g(), variable x, and class A are declared&quot;),
265                 (a) -&gt; assertCommand(a, &quot;f()&quot;,
266                         &quot;|  attempted to call method f() which cannot be invoked until method g(), variable x, and class A are declared&quot;),
267                 (a) -&gt; assertCommandOutputStartsWith(a, &quot;int g() { return x; }&quot;,
268                         &quot;|  created method g(), however, it cannot be invoked until variable x is declared&quot;),
269                 (a) -&gt; assertCommand(a, &quot;g()&quot;, &quot;|  attempted to call method g() which cannot be invoked until variable x is declared&quot;)
270         );
271     }
272 
273     @Test
274     public void testUnknownCommand() {
275         test((a) -&gt; assertCommand(a, &quot;/unknown&quot;,
276                 &quot;|  Invalid command: /unknown\n&quot; +
277                 &quot;|  Type /help for help.&quot;));
278     }
279 
280     @Test
281     public void testEmptyClassPath() {
282         test(after -&gt; assertCommand(after, &quot;/env --class-path&quot;, &quot;|  Argument to class-path missing.&quot;));
283     }
284 
285     @Test
286     public void testInvalidClassPath() {
287         test(
288                 a -&gt; assertCommand(a, &quot;/env --class-path snurgefusal&quot;,
289                         &quot;|  File &#39;snurgefusal&#39; for &#39;--class-path&#39; is not found.&quot;),
290                 a -&gt; assertCommand(a, &quot;/env --class-path ?&quot;,
291                         &quot;|  File &#39;?&#39; for &#39;--class-path&#39; is not found.&quot;)
292         );
293     }
294 
295     @Test
296     public void testNoArgument() {
297         test(
298                 (a) -&gt; assertCommand(a, &quot;/save&quot;,
299                         &quot;|  &#39;/save&#39; requires a filename argument.&quot;),
300                 (a) -&gt; assertCommand(a, &quot;/open&quot;,
301                         &quot;|  &#39;/open&#39; requires a filename argument.&quot;),
302                 (a) -&gt; assertCommandOutputStartsWith(a, &quot;/drop&quot;,
303                         &quot;|  In the /drop argument, please specify an import, variable, method, or class to drop.&quot;)
304         );
305     }
306 
307     @Test
308     public void testDebug() {
309         test(
310                 (a) -&gt; assertCommand(a, &quot;/deb&quot;, &quot;|  Debugging on&quot;),
311                 (a) -&gt; assertCommand(a, &quot;/debug&quot;, &quot;|  Debugging off&quot;),
312                 (a) -&gt; assertCommand(a, &quot;/debug&quot;, &quot;|  Debugging on&quot;),
313                 (a) -&gt; assertCommand(a, &quot;/deb&quot;, &quot;|  Debugging off&quot;)
314         );
315     }
316 
317     @Test
318     public void testDrop() {
319         test(false, new String[]{&quot;--no-startup&quot;},
320                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
321                 a -&gt; dropVariable(a, &quot;/drop 1&quot;, &quot;int a = 0&quot;, &quot;|  dropped variable a&quot;),
322                 a -&gt; assertMethod(a, &quot;int b() { return 0; }&quot;, &quot;()int&quot;, &quot;b&quot;),
323                 a -&gt; dropMethod(a, &quot;/drop 2&quot;, &quot;int b()&quot;, &quot;|  dropped method b()&quot;),
324                 a -&gt; assertClass(a, &quot;class A {}&quot;, &quot;class&quot;, &quot;A&quot;),
325                 a -&gt; dropClass(a, &quot;/drop 3&quot;, &quot;class A&quot;, &quot;|  dropped class A&quot;),
326                 a -&gt; assertImport(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;, &quot;java.util.stream.*&quot;),
327                 a -&gt; dropImport(a, &quot;/drop 4&quot;, &quot;import java.util.stream.*&quot;, &quot;&quot;),
328                 a -&gt; assertCommand(a, &quot;for (int i = 0; i &lt; 10; ++i) {}&quot;, &quot;&quot;),
329                 a -&gt; assertCommand(a, &quot;/drop 5&quot;, &quot;&quot;),
330                 a -&gt; assertCommand(a, &quot;/list&quot;, &quot;&quot;),
331                 a -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
332                 a -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
333                 a -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
334                 a -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports())
335         );
336         test(false, new String[]{&quot;--no-startup&quot;},
337                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
338                 a -&gt; dropVariable(a, &quot;/drop a&quot;, &quot;int a = 0&quot;, &quot;|  dropped variable a&quot;),
339                 a -&gt; assertMethod(a, &quot;int b() { return 0; }&quot;, &quot;()int&quot;, &quot;b&quot;),
340                 a -&gt; dropMethod(a, &quot;/drop b&quot;, &quot;int b()&quot;, &quot;|  dropped method b()&quot;),
341                 a -&gt; assertClass(a, &quot;class A {}&quot;, &quot;class&quot;, &quot;A&quot;),
342                 a -&gt; dropClass(a, &quot;/drop A&quot;, &quot;class A&quot;, &quot;|  dropped class A&quot;),
343                 a -&gt; assertCommandCheckOutput(a, &quot;/vars&quot;, assertVariables()),
344                 a -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;, assertMethods()),
345                 a -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
346                 a -&gt; assertCommandCheckOutput(a, &quot;/imports&quot;, assertImports())
347         );
348     }
349 
350     @Test
351     public void testDropRange() {
352         test(false, new String[]{&quot;--no-startup&quot;},
353                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
354                 a -&gt; assertMethod(a, &quot;int b() { return 0; }&quot;, &quot;()int&quot;, &quot;b&quot;),
355                 a -&gt; assertClass(a, &quot;class A {}&quot;, &quot;class&quot;, &quot;A&quot;),
356                 a -&gt; assertImport(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;, &quot;java.util.stream.*&quot;),
357                 a -&gt; assertCommand(a, &quot;for (int i = 0; i &lt; 10; ++i) {}&quot;, &quot;&quot;),
358                 a -&gt; assertCommand(a, &quot;/drop 3-5 b 1&quot;,
359                         &quot;|  dropped class A\n&quot; +
360                         &quot;|  dropped method b()\n&quot; +
361                         &quot;|  dropped variable a\n&quot;),
362                 a -&gt; assertCommand(a, &quot;/list&quot;, &quot;&quot;)
363         );
364     }
365 
366     @Test
367     public void testDropNegative() {
368         test(false, new String[]{&quot;--no-startup&quot;},
369                 a -&gt; assertCommandOutputStartsWith(a, &quot;/drop 0&quot;, &quot;|  No snippet with ID: 0&quot;),
370                 a -&gt; assertCommandOutputStartsWith(a, &quot;/drop a&quot;, &quot;|  No such snippet: a&quot;),
371                 a -&gt; assertCommandCheckOutput(a, &quot;/drop&quot;,
372                         assertStartsWith(&quot;|  In the /drop argument, please specify an import, variable, method, or class to drop.&quot;)),
373                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
374                 a -&gt; assertCommand(a, &quot;a&quot;, &quot;a ==&gt; 0&quot;),
375                 a -&gt; assertCommand(a, &quot;/drop 2&quot;, &quot;&quot;),
376                 a -&gt; assertCommand(a, &quot;/drop 2&quot;,
377                         &quot;|  This command does not accept the snippet &#39;2&#39; : a\n&quot; +
378                         &quot;|  See /types, /methods, /vars, or /list&quot;)
379         );
380     }
381 
382     @Test
383     public void testAmbiguousDrop() {
384         test(
385                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
386                 a -&gt; assertMethod(a, &quot;int a() { return 0; }&quot;, &quot;()int&quot;, &quot;a&quot;),
387                 a -&gt; assertClass(a, &quot;class a {}&quot;, &quot;class&quot;, &quot;a&quot;),
388                 a -&gt; assertCommand(a, &quot;/drop a&quot;,
389                         &quot;|  dropped variable a\n&quot; +
390                         &quot;|  dropped method a()\n&quot; +
391                         &quot;|  dropped class a&quot;)
392         );
393         test(
394                 a -&gt; assertMethod(a, &quot;int a() { return 0; }&quot;, &quot;()int&quot;, &quot;a&quot;),
395                 a -&gt; assertMethod(a, &quot;double a(int a) { return 0; }&quot;, &quot;(int)double&quot;, &quot;a&quot;),
396                 a -&gt; assertMethod(a, &quot;double a(double a) { return 0; }&quot;, &quot;(double)double&quot;, &quot;a&quot;),
397                 a -&gt; assertCommand(a, &quot;/drop a&quot;,
398                         &quot;|  dropped method a()\n&quot; +
399                         &quot;|  dropped method a(int)\n&quot; +
400                         &quot;|  dropped method a(double)\n&quot;)
401         );
402     }
403 
404     @Test
405     public void testApplicationOfPost() {
406         test(
407                 (a) -&gt; assertCommand(a, &quot;/set mode t normal -command&quot;, &quot;|  Created new feedback mode: t&quot;),
408                 (a) -&gt; assertCommand(a, &quot;/set feedback t&quot;, &quot;|  Feedback mode: t&quot;),
409                 (a) -&gt; assertCommand(a, &quot;/set format t post \&quot;$%n\&quot;&quot;, &quot;&quot;),
410                 (a) -&gt; assertCommand(a, &quot;/set prompt t \&quot;+\&quot; \&quot;-\&quot;&quot;, &quot;&quot;),
411                 (a) -&gt; assertCommand(a, &quot;/set prompt t&quot;, &quot;|  /set prompt t \&quot;+\&quot; \&quot;-\&quot;$&quot;)
412         );
413     }
414 
415     @Test
416     public void testHelpLength() {
417         Consumer&lt;String&gt; testOutput = (s) -&gt; {
418             List&lt;String&gt; ss = Stream.of(s.split(&quot;\n&quot;))
419                     .filter(l -&gt; !l.isEmpty())
420                     .collect(Collectors.toList());
421             assertTrue(ss.size() &gt;= 10, &quot;Help does not print enough lines:&quot; + s);
422         };
423         test(
424                 (a) -&gt; assertCommandCheckOutput(a, &quot;/?&quot;, testOutput),
425                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help&quot;, testOutput),
426                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help /list&quot;, testOutput)
427         );
428     }
429 
430     @Test
431     public void testHelp() {
432         test(
433                 (a) -&gt; assertHelp(a, &quot;/?&quot;, &quot;/list&quot;, &quot;/help&quot;, &quot;/exit&quot;, &quot;intro&quot;),
434                 (a) -&gt; assertHelp(a, &quot;/help&quot;, &quot;/list&quot;, &quot;/help&quot;, &quot;/exit&quot;, &quot;intro&quot;),
435                 (a) -&gt; assertHelp(a, &quot;/help short&quot;, &quot;shortcuts&quot;, &quot;Tab&quot;),
436                 (a) -&gt; assertHelp(a, &quot;/help keys&quot;, &quot;line&quot;, &quot;Shift&quot;, &quot;imports&quot;, &quot;history&quot;),
437                 (a) -&gt; assertHelp(a, &quot;/? /li&quot;, &quot;/list -all&quot;, &quot;snippets&quot;),
438                 (a) -&gt; assertHelp(a, &quot;/help /set prompt&quot;, &quot;optionally contain &#39;%s&#39;&quot;, &quot;quoted&quot;),
439                 (a) -&gt; assertHelp(a, &quot;/help /help&quot;, &quot;/help &lt;command&gt;&quot;),
440                 (a) -&gt; assertHelp(a, &quot;/help li&quot;, &quot;/list -start&quot;),
441                 (a) -&gt; assertHelp(a, &quot;/help fe&quot;, &quot;/set feedback -retain&quot;)
442         );
443     }
444 
445     @Test
446     public void testHelpStart() {
447         test(
448                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help /exit&quot;,
449                         s -&gt; assertTrue(s.replaceAll(&quot;\\r\\n?&quot;, &quot;\n&quot;).startsWith(
450                                 &quot;|  \n&quot; +
451                                 &quot;|                                   /exit\n&quot; +
452                                 &quot;|                                   =====\n&quot; +
453                                 &quot;|  &quot;
454                         ))
455                 )
456         );
457     }
458 
459     @Test
460     public void testHelpFormat() {
461         test(
462                 (a) -&gt; assertCommandCheckOutput(a, &quot;/help&quot;, s -&gt; {
463                     String[] lines = s.split(&quot;\\R&quot;);
464                     assertTrue(lines.length &gt; 20,
465                             &quot;Too few lines of /help output: &quot; + lines.length
466                           + &quot;\n&quot; + s);
467                     for (int i = 0; i &lt; lines.length; ++i) {
468                         String l = lines[i];
469                         assertTrue(l.startsWith(&quot;| &quot;),
470                                 &quot;Expected /help line to start with | :\n&quot; + l);
471                         assertTrue(l.length() &lt;= 80,
472                                 &quot;/help line too long: &quot; + l.length() + &quot;\n&quot; + l);
473                     }
474                  })
475         );
476     }
477 
478     @Test
479     public void testConfusedUserPseudoCommands() {
480         test(
481                 (a) -&gt; assertHelp(a, &quot;/-&lt;n&gt;&quot;, &quot;last snippet&quot;, &quot;digits&quot;),
482                 (a) -&gt; assertHelp(a, &quot;/&lt;id&gt;&quot;, &quot;last snippet&quot;, &quot;digits&quot;)
483         );
484     }
485 
486     private void assertHelp(boolean a, String command, String... find) {
487         assertCommandCheckOutput(a, command, s -&gt; {
488             for (String f : find) {
489                 assertTrue(s.contains(f),
490                         &quot;Expected output of &quot; + command + &quot; to contain: &quot; + f
491                       + &quot;\n&quot; + s);
492             }
493         });
494     }
495 
496     // Check that each line of output contains the corresponding string from the list
497     private void checkLineToList(String in, List&lt;String&gt; match) {
498         String trimmed = in.trim();
499         String[] res = trimmed.isEmpty()
500                 ? new String[0]
501                 : trimmed.split(&quot;\n&quot;);
502         assertEquals(res.length, match.size(), &quot;Got: &quot; + Arrays.asList(res));
503         for (int i = 0; i &lt; match.size(); ++i) {
504             assertTrue(res[i].contains(match.get(i)));
505         }
506     }
507 
508     @Test
509     public void testListArgs() {
510         String arg = &quot;qqqq&quot;;
511         List&lt;String&gt; startVarList = new ArrayList&lt;&gt;(START_UP);
512         startVarList.add(&quot;int aardvark&quot;);
513         startVarList.add(&quot;int weevil&quot;);
514         test(
515                 a -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;,
516                         s -&gt; checkLineToList(s, START_UP)),
517                 a -&gt; assertCommandOutputStartsWith(a, &quot;/list &quot; + arg,
518                         &quot;|  No such snippet: &quot; + arg),
519                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
520                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;weevil&quot;),
521                 a -&gt; assertCommandOutputContains(a, &quot;/list aardvark&quot;, &quot;aardvark&quot;),
522                 a -&gt; assertCommandCheckOutput(a, &quot;/list -start&quot;,
523                         s -&gt; checkLineToList(s, START_UP)),
524                 a -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;,
525                         s -&gt; checkLineToList(s, startVarList)),
526                 a -&gt; assertCommandOutputStartsWith(a, &quot;/list s3&quot;,
527                         &quot;s3 : import&quot;),
528                 a -&gt; assertCommandCheckOutput(a, &quot;/list 1-2 s3&quot;,
529                         s -&gt; {
530                             assertTrue(Pattern.matches(&quot;.*aardvark.*\\R.*weevil.*\\R.*s3.*import.*&quot;, s.trim()),
531                                     &quot;No match: &quot; + s);
532                         }),
533                 a -&gt; assertCommandOutputStartsWith(a, &quot;/list &quot; + arg,
534                         &quot;|  No such snippet: &quot; + arg)
535         );
536     }
537 
538     @Test
539     public void testVarsArgs() {
540         String arg = &quot;qqqq&quot;;
541         List&lt;String&gt; startVarList = new ArrayList&lt;&gt;();
542         test(
543                 a -&gt; assertCommandCheckOutput(a, &quot;/vars -all&quot;,
544                         s -&gt; checkLineToList(s, startVarList)),
545                 a -&gt; assertCommand(a, &quot;/vars &quot; + arg,
546                         &quot;|  No such snippet: &quot; + arg),
547                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
548                 a -&gt; assertMethod(a, &quot;int f() { return 0; }&quot;, &quot;()int&quot;, &quot;f&quot;),
549                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;a&quot;),
550                 a -&gt; assertVariable(a, &quot;double&quot;, &quot;a&quot;, &quot;1&quot;, &quot;1.0&quot;),
551                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars aardvark&quot;,
552                         &quot;|    int aardvark = 0&quot;),
553                 a -&gt; assertCommandCheckOutput(a, &quot;/vars -start&quot;,
554                         s -&gt; checkLineToList(s, startVarList)),
555                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars -all&quot;,
556                         &quot;|    int aardvark = 0\n|    int a = &quot;),
557                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars 1-4&quot;,
558                         &quot;|    int aardvark = 0\n|    int a = &quot;),
559                 a -&gt; assertCommandOutputStartsWith(a, &quot;/vars f&quot;,
560                         &quot;|  This command does not accept the snippet &#39;f&#39;&quot;),
561                 a -&gt; assertCommand(a, &quot;/var &quot; + arg,
562                         &quot;|  No such snippet: &quot; + arg)
563         );
564     }
565 
566     @Test
567     public void testMethodsArgs() {
568         String arg = &quot;qqqq&quot;;
569         List&lt;String&gt; printingMethodList = new ArrayList&lt;&gt;(PRINTING_CMD_METHOD);
570         test(new String[]{&quot;--startup&quot;, &quot;PRINTING&quot;},
571                 a -&gt; assertCommandCheckOutput(a, &quot;/methods -all&quot;,
572                         s -&gt; checkLineToList(s, printingMethodList)),
573                 a -&gt; assertCommandCheckOutput(a, &quot;/methods -start&quot;,
574                         s -&gt; checkLineToList(s, printingMethodList)),
575                 a -&gt; assertCommandCheckOutput(a, &quot;/methods print println printf&quot;,
576                         s -&gt; checkLineToList(s, printingMethodList)),
577                 a -&gt; assertCommandCheckOutput(a, &quot;/methods println&quot;,
578                         s -&gt; assertEquals(s.trim().split(&quot;\n&quot;).length, 10)),
579                 a -&gt; assertCommandCheckOutput(a, &quot;/methods&quot;,
580                         s -&gt; checkLineToList(s, printingMethodList)),
581                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods &quot; + arg,
582                         &quot;|  No such snippet: &quot; + arg),
583                 a -&gt; assertMethod(a, &quot;int f() { return 0; }&quot;, &quot;()int&quot;, &quot;f&quot;),
584                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
585                 a -&gt; assertMethod(a, &quot;void f(int a) { g(); }&quot;, &quot;(int)void&quot;, &quot;f&quot;),
586                 a -&gt; assertMethod(a, &quot;void g() {}&quot;, &quot;()void&quot;, &quot;g&quot;),
587                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods &quot; + arg,
588                         &quot;|  No such snippet: &quot; + arg),
589                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods aardvark&quot;,
590                         &quot;|  This command does not accept the snippet &#39;aardvark&#39; : int aardvark&quot;),
591                 a -&gt; assertCommandCheckOutput(a, &quot;/methods -start&quot;,
592                         s -&gt; checkLineToList(s, printingMethodList)),
593                 a -&gt; assertCommandCheckOutput(a, &quot;/methods print println printf&quot;,
594                         s -&gt; checkLineToList(s, printingMethodList)),
595                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods g&quot;,
596                         &quot;|    void g()&quot;),
597                 a -&gt; assertCommandOutputStartsWith(a, &quot;/methods f&quot;,
598                         &quot;|    int f()\n&quot; +
599                         &quot;|    void f(int)&quot;)
600         );
601     }
602 
603     @Test
604     public void testMethodsWithErrors() {
605         test(new String[]{&quot;--no-startup&quot;},
606                 a -&gt; assertCommand(a, &quot;double m(int x) { return x; }&quot;,
607                         &quot;|  created method m(int)&quot;),
608                 a -&gt; assertCommand(a, &quot;GARBAGE junk() { return TRASH; }&quot;,
609                         &quot;|  created method junk(), however, it cannot be referenced until class GARBAGE, and variable TRASH are declared&quot;),
610                 a -&gt; assertCommand(a, &quot;int w = 5;&quot;,
611                         &quot;w ==&gt; 5&quot;),
612                 a -&gt; assertCommand(a, &quot;int tyer() { return w; }&quot;,
613                         &quot;|  created method tyer()&quot;),
614                 a -&gt; assertCommand(a, &quot;String w = \&quot;hi\&quot;;&quot;,
615                         &quot;w ==&gt; \&quot;hi\&quot;&quot;),
616                 a -&gt; assertCommand(a, &quot;/methods&quot;,
617                         &quot;|    double m(int)\n&quot; +
618                         &quot;|    GARBAGE junk()\n&quot; +
619                         &quot;|       which cannot be referenced until class GARBAGE, and variable TRASH are declared\n&quot; +
620                         &quot;|    int tyer()\n&quot; +
621                         &quot;|       which cannot be invoked until this error is corrected: \n&quot; +
622                         &quot;|          incompatible types: java.lang.String cannot be converted to int\n&quot; +
623                         &quot;|          int tyer() { return w; }\n&quot; +
624                         &quot;|                              ^\n&quot;)
625         );
626     }
627 
628     @Test
629     public void testTypesWithErrors() {
630         test(new String[]{&quot;--no-startup&quot;},
631                 a -&gt; assertCommand(a, &quot;class C extends NONE { int x; }&quot;,
632                         &quot;|  created class C, however, it cannot be referenced until class NONE is declared&quot;),
633                 a -&gt; assertCommand(a, &quot;class D { void m() { System.out.println(nada); } }&quot;,
634                         &quot;|  created class D, however, it cannot be instantiated or its methods invoked until variable nada is declared&quot;),
635                 a -&gt; assertCommand(a, &quot;/types&quot;,
636                         &quot;|    class C\n&quot; +
637                         &quot;|       which cannot be referenced until class NONE is declared\n&quot; +
638                         &quot;|    class D\n&quot; +
639                         &quot;|       which cannot be instantiated or its methods invoked until variable nada is declared\n&quot;)
640         );
641     }
642 
643     @Test
644     public void testTypesArgs() {
645         String arg = &quot;qqqq&quot;;
646         List&lt;String&gt; startTypeList = new ArrayList&lt;&gt;();
647         test(
648                 a -&gt; assertCommandCheckOutput(a, &quot;/types -all&quot;,
649                         s -&gt; checkLineToList(s, startTypeList)),
650                 a -&gt; assertCommandCheckOutput(a, &quot;/types -start&quot;,
651                         s -&gt; checkLineToList(s, startTypeList)),
652                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types &quot; + arg,
653                         &quot;|  No such snippet: &quot; + arg),
654                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;aardvark&quot;),
655                 (a) -&gt; assertClass(a, &quot;class A { }&quot;, &quot;class&quot;, &quot;A&quot;),
656                 (a) -&gt; assertClass(a, &quot;interface A { }&quot;, &quot;interface&quot;, &quot;A&quot;),
657                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types -all&quot;,
658                         &quot;|    class A\n&quot; +
659                         &quot;|    interface A&quot;),
660                 (a) -&gt; assertClass(a, &quot;enum E { }&quot;, &quot;enum&quot;, &quot;E&quot;),
661                 (a) -&gt; assertClass(a, &quot;@interface B { }&quot;, &quot;@interface&quot;, &quot;B&quot;),
662                 a -&gt; assertCommand(a, &quot;/types aardvark&quot;,
663                         &quot;|  This command does not accept the snippet &#39;aardvark&#39; : int aardvark;&quot;),
664                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types A&quot;,
665                         &quot;|    interface A&quot;),
666                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types E&quot;,
667                         &quot;|    enum E&quot;),
668                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types B&quot;,
669                         &quot;|    @interface B&quot;),
670                 a -&gt; assertCommandOutputStartsWith(a, &quot;/types &quot; + arg,
671                         &quot;|  No such snippet: &quot; + arg),
672                 a -&gt; assertCommandCheckOutput(a, &quot;/types -start&quot;,
673                         s -&gt; checkLineToList(s, startTypeList))
674         );
675     }
676 
677     @Test
678     public void testBlankLinesInSnippetContinuation() {
679         test(Locale.ROOT, false, new String[]{&quot;--no-startup&quot;}, &quot;&quot;,
680                 a -&gt; assertCommand(a, &quot;class C {&quot;,
681                         &quot;&quot;),
682                 a -&gt; assertCommand(a, &quot;&quot;,
683                         &quot;&quot;),
684                 a -&gt; assertCommand(a, &quot;&quot;,
685                         &quot;&quot;),
686                 a -&gt; assertCommand(a, &quot;  int x;&quot;,
687                         &quot;&quot;),
688                 a -&gt; assertCommand(a, &quot;&quot;,
689                         &quot;&quot;),
690                 a -&gt; assertCommand(a, &quot;&quot;,
691                         &quot;&quot;),
692                 a -&gt; assertCommand(a, &quot;}&quot;,
693                         &quot;|  created class C&quot;),
694                 a -&gt; assertCommand(a, &quot;/list&quot;,
695                         &quot;\n&quot; +
696                         &quot;   1 : class C {\n&quot; +
697                         &quot;       \n&quot; +
698                         &quot;       \n&quot; +
699                         &quot;         int x;\n&quot; +
700                         &quot;       \n&quot; +
701                         &quot;       \n&quot; +
702                         &quot;       }&quot;)
703         );
704     }
705 
706     @Test
707     public void testCompoundStart() {
708         test(new String[]{&quot;--startup&quot;, &quot;DEFAULT&quot;, &quot;--startup&quot;, &quot;PRINTING&quot;},
709                 (a) -&gt; assertCommand(a, &quot;printf(\&quot;%4.2f\&quot;, Math.PI)&quot;,
710                         &quot;&quot;, &quot;&quot;, null, &quot;3.14&quot;, &quot;&quot;)
711         );
712     }
713 
714     @Test
715     public void testJavaSeStart() {
716         test(new String[]{&quot;--startup&quot;, &quot;JAVASE&quot;},
717                 (a) -&gt; assertCommand(a, &quot;ZoneOffsetTransitionRule.TimeDefinition.WALL&quot;,
718                         &quot;$1 ==&gt; WALL&quot;)
719         );
720     }
721 
722     @Test
723     public void testJavaSeSetStart() {
724         test(
725                 (a) -&gt; assertCommand(a, &quot;/set sta JAVASE&quot;, &quot;&quot;),
726                 (a) -&gt; assertCommand(a, &quot;/reset&quot;, &quot;|  Resetting state.&quot;),
727                 (a) -&gt; assertCommandCheckOutput(a, &quot;/li -a&quot;,
728                             s -&gt; assertTrue(s.split(&quot;import &quot;).length &gt; 160,
729                             &quot;not enough imports for JAVASE:\n&quot; + s))
730         );
731     }
732 
733     @Test
734     public void defineClasses() {
735         test(
736                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
737                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
738                 (a) -&gt; assertClass(a, &quot;class A { }&quot;, &quot;class&quot;, &quot;A&quot;),
739                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
740                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
741                 (a) -&gt; assertClass(a, &quot;interface A { }&quot;, &quot;interface&quot;, &quot;A&quot;),
742                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
743                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
744                 (a) -&gt; assertClass(a, &quot;enum A { }&quot;, &quot;enum&quot;, &quot;A&quot;),
745                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
746                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses()),
747                 (a) -&gt; assertClass(a, &quot;@interface A { }&quot;, &quot;@interface&quot;, &quot;A&quot;),
748                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, assertList()),
749                 (a) -&gt; assertCommandCheckOutput(a, &quot;/types&quot;, assertClasses())
750         );
751     }
752 
753     @Test
754     public void testCommandPrefix() {
755         test(a -&gt; assertCommandCheckOutput(a, &quot;/s&quot;,
756                       assertStartsWith(&quot;|  Command: &#39;/s&#39; is ambiguous: /save, /set&quot;)),
757              a -&gt; assertCommand(a, &quot;int var&quot;, &quot;var ==&gt; 0&quot;),
758              a -&gt; assertCommandCheckOutput(a, &quot;/va&quot;,
759                       assertStartsWith(&quot;|    int var = 0&quot;)),
760              a -&gt; assertCommandCheckOutput(a, &quot;/save&quot;,
761                       assertStartsWith(&quot;|  &#39;/save&#39; requires a filename argument.&quot;)));
762     }
763 
764     @Test
765     public void testOptionQ() {
766         test(Locale.ROOT, false, new String[]{&quot;-q&quot;, &quot;--no-startup&quot;}, &quot;&quot;,
767                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
768                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
769         );
770     }
771 
772     @Test
773     public void testOptionS() {
774         test(Locale.ROOT, false, new String[]{&quot;-s&quot;, &quot;--no-startup&quot;}, &quot;&quot;,
775                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;&quot;)
776         );
777     }
778 
779     @Test
780     public void testOptionV() {
781         test(new String[]{&quot;-v&quot;, &quot;--no-startup&quot;},
782                 (a) -&gt; assertCommand(a, &quot;1+1&quot;,
783                         &quot;$1 ==&gt; 2\n&quot; +
784                         &quot;|  created scratch variable $1 : int&quot;)
785         );
786     }
787 
788     @Test
789     public void testOptionFeedback() {
790         test(Locale.ROOT, false, new String[]{&quot;--feedback&quot;, &quot;concise&quot;, &quot;--no-startup&quot;}, &quot;&quot;,
791                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
792                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
793         );
794     }
795 
796     @Test
797     public void testCompoundOptions() {
798         Consumer&lt;String&gt; confirmNoStartup = s -&gt; {
799                     assertEquals(0, Stream.of(s.split(&quot;\n&quot;))
800                             .filter(l -&gt; !l.isEmpty())
801                             .count(), &quot;Expected no lines: &quot; + s);
802                 };
803         test(Locale.ROOT, false, new String[]{&quot;-nq&quot;}, &quot;&quot;,
804                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;, confirmNoStartup),
805                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
806                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
807         );
808         test(Locale.ROOT, false, new String[]{&quot;-qn&quot;}, &quot;&quot;,
809                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;, confirmNoStartup),
810                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;),
811                 (a) -&gt; assertCommand(a, &quot;int x = 5&quot;, &quot;&quot;)
812         );
813         test(Locale.ROOT, false, new String[]{&quot;-ns&quot;}, &quot;&quot;,
814                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list -all&quot;, confirmNoStartup),
815                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;&quot;)
816         );
817     }
818 
819     @Test
820     public void testOptionR() {
821         test(new String[]{&quot;-R-Dthe.sound=blorp&quot;, &quot;--no-startup&quot;},
822                 (a) -&gt; assertCommand(a, &quot;System.getProperty(\&quot;the.sound\&quot;)&quot;,
823                         &quot;$1 ==&gt; \&quot;blorp\&quot;&quot;)
824         );
825     }
826 
827     @Test
828     public void testWrapSourceHandlerDiagCrash() {
829         test(new String[]{&quot;--add-exports&quot;, &quot;jdk.javadoc/ALL-UNNAMED&quot;},
830                 (a) -&gt; assertCommand(a, &quot;1+1&quot;, &quot;$1 ==&gt; 2&quot;)
831          );
832     }
833 
834     @Test
835     public void test8156910() {
836         test(
837                 (a) -&gt; assertCommandOutputContains(a, &quot;System.out.println(\&quot;%5d\&quot;, 10);&quot;, &quot;%5d&quot;),
838                 (a) -&gt; assertCommandOutputContains(a, &quot;1234&quot;, &quot;==&gt; 1234&quot;)
839         );
840     }
841 
842     @Test
843     public void testIntersection() {
844         test(
845                 (a) -&gt; assertCommandOutputContains(a, &quot;&lt;Z extends Runnable&amp;CharSequence&gt; Z get1() { return null; }&quot;, &quot;get1()&quot;),
846                 (a) -&gt; assertCommandOutputContains(a, &quot;var g1 = get1()&quot;, &quot;g1&quot;),
847                 (a) -&gt; assertCommand(a, &quot;/vars g1&quot;, &quot;|    CharSequence&amp;Runnable g1 = null&quot;),
848                 (a) -&gt; assertCommandOutputContains(a, &quot;&lt;Z extends Number&amp;CharSequence&gt; Z get2() { return null; }&quot;, &quot;get2()&quot;),
849                 (a) -&gt; assertCommandOutputContains(a, &quot;var g2 = get2()&quot;, &quot;g2&quot;),
850                 (a) -&gt; assertCommand(a, &quot;/vars g2&quot;, &quot;|    Number&amp;CharSequence g2 = null&quot;)
851         );
852     }
853 
854     @Test
855     public void testAnonymous() {
856         test(
857                 (a) -&gt; assertCommandOutputContains(a, &quot;var r1 = new Object() {}&quot;, &quot;r1&quot;),
858                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r1&quot;, &quot;|    &lt;anonymous class extending Object&gt; r1 = &quot;),
859                 (a) -&gt; assertCommandOutputContains(a, &quot;var r2 = new Runnable() { public void run() { } }&quot;, &quot;r2&quot;),
860                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars r2&quot;, &quot;|    &lt;anonymous class implementing Runnable&gt; r2 = &quot;),
861                 (a) -&gt; assertCommandOutputContains(a, &quot;import java.util.stream.*;&quot;, &quot;&quot;),
862                 (a) -&gt; assertCommandOutputContains(a, &quot;var list = Stream.of(1, 2, 3).map(j -&gt; new Object() { int i = j; }).collect(Collectors.toList());&quot;,
863                                                       &quot;list&quot;),
864                 (a) -&gt; assertCommandOutputContains(a, &quot;/vars list&quot;, &quot;|    List&lt;&lt;anonymous class extending Object&gt;&gt; list = &quot;)
865         );
866     }
867 
868     // This is mainly interesting in the TestLocalSimpleTest case (8198573)
869     @Test
870     public void testUpdateFalsePositive() {
871         test(
872                 a -&gt; assertClass(a, &quot;class A { int a() { int error = 0; return error; } }&quot;, &quot;class&quot;, &quot;A&quot;),
873                 a -&gt; assertVariable(a, &quot;A&quot;, &quot;a&quot;, &quot;new A()&quot;, &quot;A@.+&quot;),
874                 a -&gt; assertVariable(a, &quot;int&quot;, &quot;error&quot;, &quot;4711&quot;, &quot;4711&quot;),
875                 a -&gt; assertCommandOutputContains(a, &quot;a&quot;, &quot;A@&quot;)
876         );
877     }
878 }
    </pre>
  </body>
</html>