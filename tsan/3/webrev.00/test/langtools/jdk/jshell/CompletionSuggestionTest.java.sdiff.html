<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/jshell/CompletionSuggestionTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="CompletenessTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="CustomEditor.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/jshell/CompletionSuggestionTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8131025 8141092 8153761 8145263 8131019 8175886 8176184 8176241 8176110 8177466 8197439</span>
 27  * @summary Test Completion and Documentation
 28  * @library /tools/lib
 29  * @modules jdk.compiler/com.sun.tools.javac.api
 30  *          jdk.compiler/com.sun.tools.javac.main
 31  *          jdk.jdeps/com.sun.tools.javap
 32  *          jdk.jshell/jdk.jshell:open
 33  * @build toolbox.ToolBox toolbox.JarTask toolbox.JavacTask
 34  * @build KullaTesting TestingInputStream Compiler
 35  * @run testng CompletionSuggestionTest
 36  */
 37 
 38 import java.io.IOException;
 39 import java.lang.reflect.Field;
 40 import java.nio.file.Files;
 41 import java.nio.file.Path;
 42 import java.nio.file.Paths;
 43 import java.util.Arrays;
 44 import java.util.Collections;
 45 import java.util.Set;
 46 import java.util.HashSet;
</pre>
<hr />
<pre>
 90                 new HashSet&lt;&gt;(Collections.emptyList()),
 91                 new HashSet&lt;&gt;(Arrays.asList(&quot;String(&quot;)));
 92         assertEval(&quot;double d = 0;&quot;);
 93         assertEval(&quot;void m() {}&quot;);
 94         assertCompletionIncludesExcludes(&quot;d.|&quot;,
 95                 new HashSet&lt;&gt;(Collections.emptyList()),
 96                 new HashSet&lt;&gt;(Arrays.asList(&quot;class&quot;)));
 97         assertCompletionIncludesExcludes(&quot;m().|&quot;,
 98                 new HashSet&lt;&gt;(Collections.emptyList()),
 99                 new HashSet&lt;&gt;(Arrays.asList(&quot;class&quot;)));
100         assertEval(&quot;class C {class D {} static class E {} enum F {} interface H {} void method() {} int number;}&quot;);
101         assertCompletionIncludesExcludes(&quot;C.|&quot;,
102                 new HashSet&lt;&gt;(Arrays.asList(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;H&quot;, &quot;class&quot;)),
103                 new HashSet&lt;&gt;(Arrays.asList(&quot;method()&quot;, &quot;number&quot;)));
104         assertCompletionIncludesExcludes(&quot;new C().|&quot;,
105                 new HashSet&lt;&gt;(Arrays.asList(&quot;method()&quot;, &quot;number&quot;)),
106                 new HashSet&lt;&gt;(Arrays.asList(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;H&quot;, &quot;class&quot;)));
107         assertCompletionIncludesExcludes(&quot;new C() {}.|&quot;,
108                 new HashSet&lt;&gt;(Arrays.asList(&quot;method()&quot;, &quot;number&quot;)),
109                 new HashSet&lt;&gt;(Arrays.asList(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;H&quot;, &quot;class&quot;)));


110     }
111 
112     public void testStartOfExpression() {
113         assertEval(&quot;int ccTest = 0;&quot;);
114         assertCompletion(&quot;System.err.println(cc|&quot;, &quot;ccTest&quot;);
115         assertCompletion(&quot;for (int i = cc|&quot;, &quot;ccTest&quot;);
116     }
117 
118     public void testParameter() {
119         assertCompletion(&quot;class C{void method(int num){num|&quot;, &quot;num&quot;);
120     }
121 
122     public void testPrimitive() {
123         Set&lt;String&gt; primitives = new HashSet&lt;&gt;(Arrays.asList(&quot;boolean&quot;, &quot;char&quot;, &quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;));
124         Set&lt;String&gt; onlyVoid = new HashSet&lt;&gt;(Collections.singletonList(&quot;void&quot;));
125         Set&lt;String&gt; primitivesOrVoid = new HashSet&lt;&gt;(primitives);
126         primitivesOrVoid.addAll(onlyVoid);
127 
128         assertCompletionIncludesExcludes(&quot;|&quot;,
129                 primitivesOrVoid,
</pre>
<hr />
<pre>
308         assertCompletion(&quot;import inner.|&quot;);
309     }
310 
311     public void testDocumentation() throws Exception {
312         dontReadParameterNamesFromClassFile();
313         assertSignature(&quot;System.getProperty(|&quot;,
314                 &quot;String System.getProperty(String key)&quot;,
315                 &quot;String System.getProperty(String key, String def)&quot;);
316         assertEval(&quot;char[] chars = null;&quot;);
317         assertSignature(&quot;new String(chars, |&quot;,
318                 &quot;String(char[], int, int)&quot;);
319         assertSignature(&quot;String.format(|&quot;,
320                 &quot;String String.format(String, Object...)&quot;,
321                 &quot;String String.format(java.util.Locale, String, Object...)&quot;);
322         assertSignature(&quot;\&quot;\&quot;.getBytes(\&quot;\&quot;|&quot;, &quot;void String.getBytes(int, int, byte[], int)&quot;,
323                                                     &quot;byte[] String.getBytes(String) throws java.io.UnsupportedEncodingException&quot;,
324                                                     &quot;byte[] String.getBytes(java.nio.charset.Charset)&quot;);
325         assertSignature(&quot;\&quot;\&quot;.getBytes(\&quot;\&quot; |&quot;, &quot;void String.getBytes(int, int, byte[], int)&quot;,
326                                                      &quot;byte[] String.getBytes(String) throws java.io.UnsupportedEncodingException&quot;,
327                                                      &quot;byte[] String.getBytes(java.nio.charset.Charset)&quot;);








328     }
329 
330     public void testMethodsWithNoArguments() throws Exception {
331         dontReadParameterNamesFromClassFile();
332         assertSignature(&quot;System.out.println(|&quot;,
333                 &quot;void java.io.PrintStream.println()&quot;,
334                 &quot;void java.io.PrintStream.println(boolean)&quot;,
335                 &quot;void java.io.PrintStream.println(char)&quot;,
336                 &quot;void java.io.PrintStream.println(int)&quot;,
337                 &quot;void java.io.PrintStream.println(long)&quot;,
338                 &quot;void java.io.PrintStream.println(float)&quot;,
339                 &quot;void java.io.PrintStream.println(double)&quot;,
340                 &quot;void java.io.PrintStream.println(char[])&quot;,
341                 &quot;void java.io.PrintStream.println(String)&quot;,
342                 &quot;void java.io.PrintStream.println(Object)&quot;);
343     }
344 
345     public void testErroneous() {
346         assertCompletion(&quot;Undefined.|&quot;);
347         assertSignature(&quot;does.not.exist|&quot;);
</pre>
</td>
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8131025 8141092 8153761 8145263 8131019 8175886 8176184 8176241 8176110 8177466 8197439 8221759</span>
 27  * @summary Test Completion and Documentation
 28  * @library /tools/lib
 29  * @modules jdk.compiler/com.sun.tools.javac.api
 30  *          jdk.compiler/com.sun.tools.javac.main
 31  *          jdk.jdeps/com.sun.tools.javap
 32  *          jdk.jshell/jdk.jshell:open
 33  * @build toolbox.ToolBox toolbox.JarTask toolbox.JavacTask
 34  * @build KullaTesting TestingInputStream Compiler
 35  * @run testng CompletionSuggestionTest
 36  */
 37 
 38 import java.io.IOException;
 39 import java.lang.reflect.Field;
 40 import java.nio.file.Files;
 41 import java.nio.file.Path;
 42 import java.nio.file.Paths;
 43 import java.util.Arrays;
 44 import java.util.Collections;
 45 import java.util.Set;
 46 import java.util.HashSet;
</pre>
<hr />
<pre>
 90                 new HashSet&lt;&gt;(Collections.emptyList()),
 91                 new HashSet&lt;&gt;(Arrays.asList(&quot;String(&quot;)));
 92         assertEval(&quot;double d = 0;&quot;);
 93         assertEval(&quot;void m() {}&quot;);
 94         assertCompletionIncludesExcludes(&quot;d.|&quot;,
 95                 new HashSet&lt;&gt;(Collections.emptyList()),
 96                 new HashSet&lt;&gt;(Arrays.asList(&quot;class&quot;)));
 97         assertCompletionIncludesExcludes(&quot;m().|&quot;,
 98                 new HashSet&lt;&gt;(Collections.emptyList()),
 99                 new HashSet&lt;&gt;(Arrays.asList(&quot;class&quot;)));
100         assertEval(&quot;class C {class D {} static class E {} enum F {} interface H {} void method() {} int number;}&quot;);
101         assertCompletionIncludesExcludes(&quot;C.|&quot;,
102                 new HashSet&lt;&gt;(Arrays.asList(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;H&quot;, &quot;class&quot;)),
103                 new HashSet&lt;&gt;(Arrays.asList(&quot;method()&quot;, &quot;number&quot;)));
104         assertCompletionIncludesExcludes(&quot;new C().|&quot;,
105                 new HashSet&lt;&gt;(Arrays.asList(&quot;method()&quot;, &quot;number&quot;)),
106                 new HashSet&lt;&gt;(Arrays.asList(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;H&quot;, &quot;class&quot;)));
107         assertCompletionIncludesExcludes(&quot;new C() {}.|&quot;,
108                 new HashSet&lt;&gt;(Arrays.asList(&quot;method()&quot;, &quot;number&quot;)),
109                 new HashSet&lt;&gt;(Arrays.asList(&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;H&quot;, &quot;class&quot;)));
<span class="line-added">110         assertCompletion(&quot;\&quot;\&quot;.leng|&quot;, &quot;length()&quot;);</span>
<span class="line-added">111         assertCompletion(&quot;\&quot;\&quot;\&quot;\n\&quot;\&quot;\&quot;.leng|&quot;, &quot;length()&quot;);</span>
112     }
113 
114     public void testStartOfExpression() {
115         assertEval(&quot;int ccTest = 0;&quot;);
116         assertCompletion(&quot;System.err.println(cc|&quot;, &quot;ccTest&quot;);
117         assertCompletion(&quot;for (int i = cc|&quot;, &quot;ccTest&quot;);
118     }
119 
120     public void testParameter() {
121         assertCompletion(&quot;class C{void method(int num){num|&quot;, &quot;num&quot;);
122     }
123 
124     public void testPrimitive() {
125         Set&lt;String&gt; primitives = new HashSet&lt;&gt;(Arrays.asList(&quot;boolean&quot;, &quot;char&quot;, &quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;));
126         Set&lt;String&gt; onlyVoid = new HashSet&lt;&gt;(Collections.singletonList(&quot;void&quot;));
127         Set&lt;String&gt; primitivesOrVoid = new HashSet&lt;&gt;(primitives);
128         primitivesOrVoid.addAll(onlyVoid);
129 
130         assertCompletionIncludesExcludes(&quot;|&quot;,
131                 primitivesOrVoid,
</pre>
<hr />
<pre>
310         assertCompletion(&quot;import inner.|&quot;);
311     }
312 
313     public void testDocumentation() throws Exception {
314         dontReadParameterNamesFromClassFile();
315         assertSignature(&quot;System.getProperty(|&quot;,
316                 &quot;String System.getProperty(String key)&quot;,
317                 &quot;String System.getProperty(String key, String def)&quot;);
318         assertEval(&quot;char[] chars = null;&quot;);
319         assertSignature(&quot;new String(chars, |&quot;,
320                 &quot;String(char[], int, int)&quot;);
321         assertSignature(&quot;String.format(|&quot;,
322                 &quot;String String.format(String, Object...)&quot;,
323                 &quot;String String.format(java.util.Locale, String, Object...)&quot;);
324         assertSignature(&quot;\&quot;\&quot;.getBytes(\&quot;\&quot;|&quot;, &quot;void String.getBytes(int, int, byte[], int)&quot;,
325                                                     &quot;byte[] String.getBytes(String) throws java.io.UnsupportedEncodingException&quot;,
326                                                     &quot;byte[] String.getBytes(java.nio.charset.Charset)&quot;);
327         assertSignature(&quot;\&quot;\&quot;.getBytes(\&quot;\&quot; |&quot;, &quot;void String.getBytes(int, int, byte[], int)&quot;,
328                                                      &quot;byte[] String.getBytes(String) throws java.io.UnsupportedEncodingException&quot;,
329                                                      &quot;byte[] String.getBytes(java.nio.charset.Charset)&quot;);
<span class="line-added">330         //JDK-8221759:</span>
<span class="line-added">331         Compiler compiler = new Compiler();</span>
<span class="line-added">332         Path testOutDir = Paths.get(&quot;WithPrivateField&quot;);</span>
<span class="line-added">333         String input = &quot;package field; public class FieldTest { private static String field; private static String field2; }&quot;;</span>
<span class="line-added">334         compiler.compile(testOutDir, input);</span>
<span class="line-added">335         addToClasspath(compiler.getPath(testOutDir));</span>
<span class="line-added">336         assertSignature(&quot;field.FieldTest.field|&quot;);</span>
<span class="line-added">337         assertSignature(&quot;field.FieldTest.field2|&quot;);</span>
338     }
339 
340     public void testMethodsWithNoArguments() throws Exception {
341         dontReadParameterNamesFromClassFile();
342         assertSignature(&quot;System.out.println(|&quot;,
343                 &quot;void java.io.PrintStream.println()&quot;,
344                 &quot;void java.io.PrintStream.println(boolean)&quot;,
345                 &quot;void java.io.PrintStream.println(char)&quot;,
346                 &quot;void java.io.PrintStream.println(int)&quot;,
347                 &quot;void java.io.PrintStream.println(long)&quot;,
348                 &quot;void java.io.PrintStream.println(float)&quot;,
349                 &quot;void java.io.PrintStream.println(double)&quot;,
350                 &quot;void java.io.PrintStream.println(char[])&quot;,
351                 &quot;void java.io.PrintStream.println(String)&quot;,
352                 &quot;void java.io.PrintStream.println(Object)&quot;);
353     }
354 
355     public void testErroneous() {
356         assertCompletion(&quot;Undefined.|&quot;);
357         assertSignature(&quot;does.not.exist|&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="CompletenessTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="CustomEditor.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>