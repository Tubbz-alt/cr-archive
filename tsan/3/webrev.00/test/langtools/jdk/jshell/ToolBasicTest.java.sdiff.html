<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/jdk/jshell/ToolBasicTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="MethodsTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ToolLocalSimpleTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/jdk/jshell/ToolBasicTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8143037 8142447 8144095 8140265 8144906 8146138 8147887 8147886 8148316 8148317 8143955 8157953 8080347 8154714 8166649 8167643 8170162 8172102 8165405 8174796 8174797 8175304 8167554 8180508 8166232 8196133 8199912 8211694</span>
 27  * @summary Tests for Basic tests for REPL tool
 28  * @modules jdk.compiler/com.sun.tools.javac.api
 29  *          jdk.compiler/com.sun.tools.javac.main
 30  *          jdk.jdeps/com.sun.tools.javap
 31  *          jdk.jshell/jdk.internal.jshell.tool
 32  * @library /tools/lib
 33  * @build toolbox.ToolBox toolbox.JarTask toolbox.JavacTask
 34  * @build KullaTesting TestingInputStream Compiler
 35  * @run testng/timeout=600 ToolBasicTest
 36  * @key intermittent
 37  */
 38 
 39 import java.io.File;
 40 import java.io.IOException;
 41 import java.io.PrintWriter;
 42 import java.io.StringWriter;
 43 import java.net.InetAddress;
 44 import java.net.InetSocketAddress;
 45 import java.nio.file.Files;
 46 import java.nio.file.Path;
 47 import java.nio.file.Paths;
 48 import java.util.ArrayList;
 49 import java.util.Arrays;
 50 import java.util.List;
 51 import java.util.Scanner;
 52 import java.util.function.BiFunction;
 53 import java.util.function.Consumer;
 54 import java.util.function.Function;
 55 import java.util.stream.Collectors;
 56 import java.util.stream.Stream;
 57 
 58 import com.sun.net.httpserver.HttpServer;
 59 import org.testng.annotations.Test;
 60 
 61 import static org.testng.Assert.assertEquals;
 62 import static org.testng.Assert.assertTrue;

 63 import static org.testng.Assert.fail;
 64 
 65 @Test
 66 public class ToolBasicTest extends ReplToolTesting {
 67 
 68     public void elideStartUpFromList() {
 69         test(
 70                 (a) -&gt; assertCommandOutputContains(a, &quot;123&quot;, &quot;==&gt; 123&quot;),
 71                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, (s) -&gt; {
 72                     int cnt;
 73                     try (Scanner scanner = new Scanner(s)) {
 74                         cnt = 0;
 75                         while (scanner.hasNextLine()) {
 76                             String line = scanner.nextLine();
 77                             if (!line.trim().isEmpty()) {
 78                                 ++cnt;
 79                             }
 80                         }
 81                     }
 82                     assertEquals(cnt, 1, &quot;Expected only one listed line&quot;);
</pre>
<hr />
<pre>
850                 a -&gt; assertImport(a, &quot;import jdk.internal.misc.VM;&quot;, &quot;&quot;, &quot;jdk.internal.misc.VM&quot;),
851                 a -&gt; assertCommand(a, &quot;System.err.println(VM.isBooted())&quot;, &quot;&quot;, &quot;&quot;, null, &quot;&quot;, &quot;true\n&quot;)
852         );
853         test(false, new String[]{&quot;--no-startup&quot;, &quot;--add-exports&quot;, &quot;java.base/jdk.internal.misc&quot;},
854                 a -&gt; assertImport(a, &quot;import jdk.internal.misc.VM;&quot;, &quot;&quot;, &quot;jdk.internal.misc.VM&quot;),
855                 a -&gt; assertCommand(a, &quot;System.err.println(VM.isBooted())&quot;, &quot;&quot;, &quot;&quot;, null, &quot;&quot;, &quot;true\n&quot;)
856         );
857     }
858 
859     public void testRedeclareVariableNoInit() {
860         test(
861                 a -&gt; assertCommand(a, &quot;Integer a;&quot;, &quot;a ==&gt; null&quot;),
862                 a -&gt; assertCommand(a, &quot;a instanceof Integer;&quot;, &quot;$2 ==&gt; false&quot;),
863                 a -&gt; assertCommand(a, &quot;a = 1;&quot;, &quot;a ==&gt; 1&quot;),
864                 a -&gt; assertCommand(a, &quot;Integer a;&quot;, &quot;a ==&gt; null&quot;),
865                 a -&gt; assertCommand(a, &quot;a instanceof Integer;&quot;, &quot;$5 ==&gt; false&quot;),
866                 a -&gt; assertCommand(a, &quot;a&quot;, &quot;a ==&gt; null&quot;)
867         );
868      }
869 











870 }
</pre>
</td>
<td>
<hr />
<pre>
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8143037 8142447 8144095 8140265 8144906 8146138 8147887 8147886 8148316 8148317 8143955 8157953 8080347 8154714 8166649 8167643 8170162 8172102 8165405 8174796 8174797 8175304 8167554 8180508 8166232 8196133 8199912 8211694 8223688</span>
 27  * @summary Tests for Basic tests for REPL tool
 28  * @modules jdk.compiler/com.sun.tools.javac.api
 29  *          jdk.compiler/com.sun.tools.javac.main
 30  *          jdk.jdeps/com.sun.tools.javap
 31  *          jdk.jshell/jdk.internal.jshell.tool
 32  * @library /tools/lib
 33  * @build toolbox.ToolBox toolbox.JarTask toolbox.JavacTask
 34  * @build KullaTesting TestingInputStream Compiler
 35  * @run testng/timeout=600 ToolBasicTest
 36  * @key intermittent
 37  */
 38 
 39 import java.io.File;
 40 import java.io.IOException;
 41 import java.io.PrintWriter;
 42 import java.io.StringWriter;
 43 import java.net.InetAddress;
 44 import java.net.InetSocketAddress;
 45 import java.nio.file.Files;
 46 import java.nio.file.Path;
 47 import java.nio.file.Paths;
 48 import java.util.ArrayList;
 49 import java.util.Arrays;
 50 import java.util.List;
 51 import java.util.Scanner;
 52 import java.util.function.BiFunction;
 53 import java.util.function.Consumer;
 54 import java.util.function.Function;
 55 import java.util.stream.Collectors;
 56 import java.util.stream.Stream;
 57 
 58 import com.sun.net.httpserver.HttpServer;
 59 import org.testng.annotations.Test;
 60 
 61 import static org.testng.Assert.assertEquals;
 62 import static org.testng.Assert.assertTrue;
<span class="line-added"> 63 import static org.testng.Assert.assertFalse;</span>
 64 import static org.testng.Assert.fail;
 65 
 66 @Test
 67 public class ToolBasicTest extends ReplToolTesting {
 68 
 69     public void elideStartUpFromList() {
 70         test(
 71                 (a) -&gt; assertCommandOutputContains(a, &quot;123&quot;, &quot;==&gt; 123&quot;),
 72                 (a) -&gt; assertCommandCheckOutput(a, &quot;/list&quot;, (s) -&gt; {
 73                     int cnt;
 74                     try (Scanner scanner = new Scanner(s)) {
 75                         cnt = 0;
 76                         while (scanner.hasNextLine()) {
 77                             String line = scanner.nextLine();
 78                             if (!line.trim().isEmpty()) {
 79                                 ++cnt;
 80                             }
 81                         }
 82                     }
 83                     assertEquals(cnt, 1, &quot;Expected only one listed line&quot;);
</pre>
<hr />
<pre>
851                 a -&gt; assertImport(a, &quot;import jdk.internal.misc.VM;&quot;, &quot;&quot;, &quot;jdk.internal.misc.VM&quot;),
852                 a -&gt; assertCommand(a, &quot;System.err.println(VM.isBooted())&quot;, &quot;&quot;, &quot;&quot;, null, &quot;&quot;, &quot;true\n&quot;)
853         );
854         test(false, new String[]{&quot;--no-startup&quot;, &quot;--add-exports&quot;, &quot;java.base/jdk.internal.misc&quot;},
855                 a -&gt; assertImport(a, &quot;import jdk.internal.misc.VM;&quot;, &quot;&quot;, &quot;jdk.internal.misc.VM&quot;),
856                 a -&gt; assertCommand(a, &quot;System.err.println(VM.isBooted())&quot;, &quot;&quot;, &quot;&quot;, null, &quot;&quot;, &quot;true\n&quot;)
857         );
858     }
859 
860     public void testRedeclareVariableNoInit() {
861         test(
862                 a -&gt; assertCommand(a, &quot;Integer a;&quot;, &quot;a ==&gt; null&quot;),
863                 a -&gt; assertCommand(a, &quot;a instanceof Integer;&quot;, &quot;$2 ==&gt; false&quot;),
864                 a -&gt; assertCommand(a, &quot;a = 1;&quot;, &quot;a ==&gt; 1&quot;),
865                 a -&gt; assertCommand(a, &quot;Integer a;&quot;, &quot;a ==&gt; null&quot;),
866                 a -&gt; assertCommand(a, &quot;a instanceof Integer;&quot;, &quot;$5 ==&gt; false&quot;),
867                 a -&gt; assertCommand(a, &quot;a&quot;, &quot;a ==&gt; null&quot;)
868         );
869      }
870 
<span class="line-added">871     public void testWarningUnchecked() { //8223688</span>
<span class="line-added">872         test(false, new String[]{&quot;--no-startup&quot;},</span>
<span class="line-added">873                 a -&gt; assertCommand(a, &quot;abstract class A&lt;T&gt; { A(T t){} }&quot;, &quot;|  created class A&quot;),</span>
<span class="line-added">874                 a -&gt; assertCommandCheckOutput(a, &quot;new A(\&quot;\&quot;) {}&quot;, s -&gt; {</span>
<span class="line-added">875                             assertStartsWith(&quot;|  Warning:&quot;);</span>
<span class="line-added">876                             assertTrue(s.contains(&quot;unchecked call&quot;));</span>
<span class="line-added">877                             assertFalse(s.contains(&quot;Exception&quot;));</span>
<span class="line-added">878                         })</span>
<span class="line-added">879         );</span>
<span class="line-added">880     }</span>
<span class="line-added">881 </span>
882 }
</pre>
</td>
</tr>
</table>
<center><a href="MethodsTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ToolLocalSimpleTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>