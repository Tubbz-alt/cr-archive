<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/langtools/tools/javac/annotations/typeAnnotations/classfile/CombinationsTargetTest2.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8005085 8005877 8004829 8005681 8006734 8006775 8006507
 27  * @summary Combinations of Target ElementTypes on (repeated)type annotations.
 28  * @modules jdk.jdeps/com.sun.tools.classfile
 29  */
 30 
 31 import com.sun.tools.classfile.*;
 32 import java.io.File;
 33 import java.util.List;
 34 
 35 public class CombinationsTargetTest2 extends ClassfileTestHelper {
 36 
 37     private static final String JDK_VERSION =
 38             Integer.toString(Runtime.getRuntime().version().feature());
 39 
 40     // Test count helps identify test case in event of failure.
 41     int testcount = 0;
 42 
 43     // Base test case template descriptions;true==annotations in code attribute.
 44     enum srce  {
 45         src1(&quot;(repeating) type annotations on on field in method body&quot;,true),
 46         src2(&quot;(repeating) type annotations on type parameters, bounds and  type arguments&quot;, true),
 47         src3(&quot;(repeating) type annotations on type parameters of class, method return value in method&quot;, true),
 48         src4(&quot;(repeating) type annotations on field in anonymous class&quot;, false),
 49         src5(&quot;(repeating) type annotations on field in anonymous class&quot;, false),
 50         src6(&quot;(repeating) type annotations on void method declaration&quot;, false),
 51         src7(&quot;(repeating) type annotations in use of instanceof&quot;, true),
 52         src7p(&quot;(repeating) type annotations in use of instanceof with type test pattern&quot;, true),
 53         src8(&quot;(repeating) type annotations in use of instanceof in method&quot;, true),
 54         src8p(&quot;(repeating) type annotations in use of instanceof with type test pattern in method&quot;, true);
 55 
 56         String description;
 57         Boolean local;
 58 
 59         srce(String desc, Boolean b) {
 60             this.description = this + &quot;: &quot; +desc;
 61             this.local = b;
 62         }
 63     }
 64 
 65 
 66     String[] ETypes={&quot;TYPE&quot;, &quot;FIELD&quot;, &quot;METHOD&quot;, &quot;PARAMETER&quot;, &quot;CONSTRUCTOR&quot;,
 67                      &quot;LOCAL_VARIABLE&quot;, &quot;ANNOTATION_TYPE&quot;, &quot;PACKAGE&quot;};
 68 
 69     // local class tests will have an inner class.
 70     Boolean hasInnerClass=false;
 71     String innerClassname=&quot;&quot;;
 72 
 73     public static void main(String[] args) throws Exception {
 74         new CombinationsTargetTest2().run();
 75     }
 76 
 77     void run() throws Exception {
 78         // Determines which repeat and order in source(ABMix).
 79         Boolean As= false, BDs=true, ABMix=false;
 80         int testrun=0;
 81         Boolean [][] bRepeat = new Boolean[][]{{false,false,false},//no repeats
 82                                                {true,false,false}, //repeat @A
 83                                                {false,true,false}, //repeat @B
 84                                                {true,true,false},  //repeat both
 85                                                {false,false,true}  //repeat mix
 86         };
 87 
 88         for(Boolean[] bCombo : bRepeat) {
 89             As=bCombo[0]; BDs=bCombo[1]; ABMix=bCombo[2];
 90             for(String et : ETypes) {
 91                switch(et) {
 92                    case &quot;METHOD&quot;:
 93                        test( 8, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src1);
 94                        test( 0, 8, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src1);
 95                        test( 2, 0, 2, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src5);
 96                        test( 0, 2, 0, 2, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src5);
 97                        test( 0, 0, 2, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src6);
 98                        test( 0, 0, 0, 2, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src6);
 99                        test( 2, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src7);
100                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src7);
101                        test( 2, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src7p);
102                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src7p);
103                        test( 4, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src8);
104                        test( 0, 4, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src8);
105                        test( 4, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src8p);
106                        test( 0, 4, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src8p);
107                        break;
108                    case &quot;FIELD&quot;:
109                        test( 8, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src1);
110                        test( 8, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src2);
111                        test( 6, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src3);
112                        test( 2, 0, 2, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src4);
113                        test( 0, 8, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src1);
114                        test( 0, 8, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src2);
115                        test( 0, 6, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src3);
116                        test( 0, 2, 0, 2, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src4);
117                        break;
118                    default:/*TYPE,PARAMETER,LOCAL_VARIABLE,ANNOTATION_TYPE,PACKAGE*/
119                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src4);
120                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src5);
121                        break;
122                }
123             }
124         }
125     }
126 
127     public void test(int tinv, int tvis, int inv, int vis, Boolean Arepeats,
128                      Boolean BDrepeats, Boolean ABmix, String rtn, String et2,
129                      Integer N, srce source) throws Exception {
130         ++testcount;
131         expected_tvisibles = tvis;
132         expected_tinvisibles = tinv;
133         expected_visibles = vis;
134         expected_invisibles = inv;
135         extraOptions = List.of();
136         File testFile = null;
137         String tname=&quot;Test&quot; + N.toString();
138         hasInnerClass=false;
139         String testDef = &quot;Test &quot; + testcount + &quot; parameters: tinv=&quot; + tinv +
140                 &quot;, tvis=&quot; + tvis + &quot;, inv=&quot; + inv + &quot;, vis=&quot; + vis +
141                 &quot;, Arepeats=&quot; + Arepeats + &quot;, BDrepeats=&quot; + BDrepeats +
142                 &quot;, ABmix=&quot; + ABmix + &quot;, retention: &quot; + rtn + &quot;, anno2: &quot; +
143                 et2 + &quot;, src=&quot; + source + &quot;\n    &quot; + source.description;
144 
145         println(testDef);
146         // Create test source and File.
147         String sourceString = sourceString(tname, rtn, et2, Arepeats,
148                                            BDrepeats, ABmix, source);
149         testFile = writeTestFile(tname+&quot;.java&quot;, sourceString);
150         // Compile test source and read classfile.
151         File classFile = null;
152         try {
153             classFile = compile(testFile);
154         } catch (Error err) {
155             System.err.println(&quot;Failed compile. Source:\n&quot; + sourceString);
156             throw err;
157         }
158         //if sourcString() set hasInnerClass it also set innerClassname.
159         if(hasInnerClass) {
160             StringBuffer sb = new StringBuffer(classFile.getAbsolutePath());
161             classFile=new File(sb.insert(sb.lastIndexOf(&quot;.class&quot;),innerClassname).toString());
162             println(&quot;classfile: &quot; + classFile.getAbsolutePath());
163         }
164         ClassFile cf = ClassFile.read(classFile);
165 
166         //Test class,fields and method counts.
167         test(cf);
168 
169         for (Field f : cf.fields) {
170             if(source.local)
171                 test(cf, f, true);
172             else
173                 test(cf,f);
174         }
175         for (Method m: cf.methods) {
176             if(source.local)
177                 test(cf, m, true);
178             else
179                 test(cf, m);
180         }
181         countAnnotations();
182         if (errors &gt; 0) {
183             System.err.println( testDef );
184             System.err.println( &quot;Source:\n&quot; + sourceString );
185             throw new Exception( errors + &quot; errors found&quot; );
186         }
187         println(&quot;Pass&quot;);
188     }
189 
190     // Source for test cases
191     String sourceString(String testname, String retentn, String annot2,
192                         Boolean Arepeats, Boolean BDrepeats, Boolean ABmix,
193                         srce src) {
194 
195         String As = &quot;@A&quot;, Bs = &quot;@B&quot;, Ds = &quot;@D&quot;;
196         if(Arepeats) As = &quot;@A @A&quot;;
197         if(BDrepeats) {
198             Bs = &quot;@B @B&quot;;
199             Ds = &quot;@D @D&quot;;
200         }
201         if(ABmix) { As = &quot;@A @B&quot;; Bs = &quot;@A @B&quot;; Ds = &quot;@D @D&quot;; }
202 
203         // Source to check for TYPE_USE and TYPE_PARAMETER annotations.
204         // Source base (annotations) is same for all test cases.
205         String source = new String();
206         String imports = new String(&quot;import java.lang.annotation.*; \n&quot; +
207             &quot;import static java.lang.annotation.RetentionPolicy.*; \n&quot; +
208             &quot;import static java.lang.annotation.ElementType.*; \n&quot; +
209             &quot;import java.util.List; \n&quot; +
210             &quot;import java.util.HashMap; \n&quot; +
211             &quot;import java.util.Map; \n\n&quot;);
212 
213             String sourceBase = new String(&quot;@Retention(&quot;+retentn+&quot;)\n&quot; +
214             &quot;@Target({TYPE_USE,_OTHER_})\n&quot; +
215             &quot;@Repeatable( AC.class )\n&quot; +
216             &quot;@interface A { }\n\n&quot; +
217 
218             &quot;@Retention(&quot;+retentn+&quot;)\n&quot; +
219             &quot;@Target({TYPE_USE,_OTHER_})\n&quot; +
220             &quot;@interface AC { A[] value(); }\n\n&quot; +
221 
222             &quot;@Retention(&quot;+retentn+&quot;)\n&quot; +
223             &quot;@Target({TYPE_USE,_OTHER_})\n&quot; +
224             &quot;@Repeatable( BC.class )\n&quot; +
225             &quot;@interface B { }\n\n&quot; +
226 
227             &quot;@Retention(&quot;+retentn+&quot;)\n&quot; +
228             &quot;@Target({TYPE_USE,_OTHER_})\n&quot; +
229             &quot;@interface BC { B[] value(); } \n\n&quot; +
230 
231             &quot;@Retention(&quot;+retentn+&quot;)\n&quot; +
232             &quot;@Target({TYPE_USE,TYPE_PARAMETER,_OTHER_})\n&quot; +
233             &quot;@Repeatable(DC.class)\n&quot; +
234             &quot;@interface D { }\n\n&quot; +
235 
236             &quot;@Retention(&quot;+retentn+&quot;)\n&quot; +
237             &quot;@Target({TYPE_USE,TYPE_PARAMETER,_OTHER_})\n&quot; +
238             &quot;@interface DC { D[] value(); }\n\n&quot;);
239 
240         // Test case sources with sample generated source
241         switch(src) {
242             case src1: // (repeating) type annotations on field in method body
243                     /*
244                      * class Test1 {
245                      * Test1(){}
246                      * // type usage in method body
247                      * String test(Test1 this, String param, String ... vararg) {
248                      *     @A @B
249                      *     Object o = new @A @B  String @A @B  [3];
250                      *         return (@A @B  String) null;
251                      * }}
252                       */
253                 source = new String(
254                     &quot;// &quot; + src.description + &quot;\n&quot; +
255                     &quot;class &quot; + testname + &quot; {\n&quot; +
256                     &quot;&quot; + testname +&quot;(){} \n&quot; +
257                     &quot;// type usage in method body \n&quot; +
258                     &quot;String test(&quot;+testname+&quot; this, &quot; +
259                        &quot;String param, String ... vararg) { \n&quot; +
260                     &quot;    _As_ _Bs_\n    Object o = new _As_ _Bs_  String _As_ _Bs_  [3]; \n&quot; +
261                     &quot;        return (_As_ _Bs_  String) null; \n&quot; +
262                     &quot;} \n&quot; +
263                     &quot;} \n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
264                     &quot;\n\n&quot;;
265                     break;
266             case src2: // (repeating) annotations on type parameters, bounds and  type arguments in new statement.
267                     /*
268                      * class Test2&lt;T extends Object&gt; {
269                      *     Map&lt;List&lt;String&gt;, Integer&gt; map =
270                      *         new HashMap&lt;@A @B List&lt;@A @B String&gt;, @A @B Integer&gt;();
271                      *     Map&lt;List&lt;String&gt;, Integer&gt; map2 = new @A @B HashMap&lt;&gt;();
272                      *     String test(Test2&lt;T&gt; this) { return null;}
273                      *     &lt;T&gt; String genericMethod(T t) { return null; }
274                      * }
275                      */
276                 source = new String( source +
277                     &quot;// &quot; + src.description + &quot;\n&quot; +
278                     &quot;class &quot; + testname + &quot;&lt;T extends Object&gt; {\n&quot; +
279                     &quot;    Map&lt;List&lt;String&gt;, Integer&gt; map =\n&quot; +
280                     &quot;        new HashMap&lt;_As_ _Bs_ List&lt;_As_ _Bs_ String&gt;, _As_ _Bs_ Integer&gt;();\n&quot; +
281                     &quot;    Map&lt;List&lt;String&gt;, Integer&gt; map2 = new _As_ _Bs_ HashMap&lt;&gt;();\n&quot; +
282                     &quot;    String test(&quot; + testname + &quot;&lt;T&gt; this) { return null;}\n&quot; +
283                     &quot;    &lt;T&gt; String genericMethod(T t) { return null; }\n&quot; +
284                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
285                     &quot;\n\n&quot;;
286                 break;
287             case src3: // (repeating)annotations on type parameters of class, method return value in method.
288                     /*
289                      * class Test3{
290                      *     &lt;E extends Comparable&gt; Map&lt;List&lt;E&gt;, E &gt; foo(E e) {
291                      *         class maptest &lt;E&gt; {
292                      *             Map&lt;List&lt;E&gt;,E&gt; getMap() {
293                      *                 Map&lt;List&lt;E&gt;,E&gt; Em = new HashMap&lt;List&lt;@A @B @D E&gt;,@A @B @D E&gt;();
294                      *                 return Em;
295                      *             }
296                      *         }
297                      *         return new maptest&lt;E&gt;().getMap();
298                      *    }
299                      *    Map&lt;List&lt;String&gt;,String&gt; shm = foo(new String(&quot;hello&quot;));
300                      * }
301                      */
302                 source = new String( source +
303                     &quot;// &quot; + src.description + &quot;\n&quot; +
304                     &quot;class &quot;+ testname + &quot;{\n&quot; +
305                     &quot;    &lt;E extends Comparable&gt; Map&lt;List&lt;E&gt;, E &gt; foo(E e) {\n&quot; +
306                     &quot;        class maptest &lt;E&gt; {\n&quot; +                  // inner class $1maptest
307                     &quot;            Map&lt;List&lt;E&gt;,E&gt; getMap() { \n&quot; +
308                     &quot;                Map&lt;List&lt;E&gt;,E&gt; Em = new HashMap&lt;List&lt;_As_ _Bs_ _Ds_ E&gt;,_As_ _Bs_ _Ds_ E&gt;();\n&quot; +
309                     &quot;                return Em;\n&quot; +
310                     &quot;            }\n&quot; +
311                     &quot;        }\n&quot; +
312                     &quot;        return new maptest&lt;E&gt;().getMap();\n&quot; +
313                     &quot;   }\n&quot; +
314                     &quot;   Map&lt;List&lt;String&gt;,String&gt; shm = foo(new String(\&quot;hello\&quot;));\n&quot; +
315                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs).replace(&quot;_Ds_&quot;,Ds) +
316                     &quot;\n\n&quot;;
317                     hasInnerClass=true;
318                     innerClassname=&quot;$1maptest&quot;;
319                 break;
320             case src4: // (repeating)annotations on field in anonymous class
321                     /*
322                      * class Test95{
323                      *     void mtest( Test95 t){  }
324                      *     public void test() {
325                      *         mtest( new Test95() {
326                      *             @A @A @B @B String data2 = &quot;test&quot;;
327                      *         });
328                      *     }
329                      * }
330                      */
331                 source = new String( source +
332                     &quot;// &quot; + src.description + &quot;\n&quot; +
333                     &quot;class &quot;+ testname + &quot;{\n&quot; +
334                     &quot;    void mtest( &quot;+ testname + &quot; t){  }\n&quot; +
335                     &quot;    public void test() {\n&quot; +
336                     &quot;        mtest( new &quot;+ testname + &quot;() {\n&quot; +
337                     &quot;            _As_ _Bs_ String data2 = \&quot;test\&quot;;\n&quot; +
338                     &quot;        });\n&quot; +
339                     &quot;    }\n&quot; +
340                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
341                     &quot;\n\n&quot;;
342                     hasInnerClass=true;
343                     innerClassname=&quot;$1&quot;;
344                 break;
345             case src5: // (repeating)annotations on method in anonymous class
346                     /*
347                      * class Test120{
348                      *     void mtest( Test120 t){  }
349                      *     public void test() {
350                      *         mtest( new Test120() {
351                      *             @A @B @A @B String m2(){return null;};
352                      *         });
353                      *     }
354                      */
355                 source = new String( source +
356                     &quot;// &quot; + src.description + &quot;\n&quot; +
357                     &quot;class &quot;+ testname + &quot;{\n&quot; +
358                     &quot;    void mtest( &quot;+ testname + &quot; t){  }\n&quot; +
359                     &quot;    public void test() {\n&quot; +
360                     &quot;        mtest( new &quot;+ testname + &quot;() {\n&quot; +
361                     &quot;            _As_ _Bs_ String m2(){return null;};\n&quot; +
362                     &quot;        });\n&quot; +
363                     &quot;    }\n&quot; +
364                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
365                     &quot;\n\n&quot;;
366                     hasInnerClass=true;
367                     innerClassname=&quot;$1&quot;;
368                 break;
369             case src6: // (repeating)annotations on void method declaration
370                     /*
371                      * class Test95{
372                      *     @A @A @B @B public void test() { };
373                      * }
374                      */
375                 source = new String( source +
376                     &quot;// &quot; + src.description + &quot;\n&quot; +
377                     &quot;class &quot;+ testname + &quot;{\n&quot; +
378                     &quot;    _As_ _Bs_ public void test() { }\n&quot; +
379                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
380                     &quot;\n\n&quot;;
381                     hasInnerClass=false;
382                 break;
383             case src7: // (repeating) type annotations in use of instanceof
384                     /*
385                      *   class Test10{
386                      *       String data = &quot;test&quot;;
387                      *       boolean dataIsString = ( data instanceof @A @B @A @B String);
388                      *   }
389                      */
390                 source = new String( source +
391                     &quot;// &quot; + src.description + &quot;\n&quot; +
392                     &quot;class &quot;+ testname + &quot;{\n&quot; +
393                     &quot;    String data = \&quot;test\&quot;;\n&quot; +
394                     &quot;    boolean dataIsString = ( data instanceof _As_ _Bs_ String);\n&quot; +
395                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
396                     &quot;\n\n&quot;;
397                     hasInnerClass=false;
398                 break;
399             case src7p: // (repeating) type annotations in use of instanceof with type test pattern
400                     /*
401                      *   class Test10{
402                      *       String data = &quot;test&quot;;
403                      *       boolean dataIsString = ( data instanceof @A @B @A @B String str);
404                      *   }
405                      */
406                 source = new String( source +
407                     &quot;// &quot; + src.description + &quot;\n&quot; +
408                     &quot;class &quot;+ testname + &quot;{\n&quot; +
409                     &quot;    String data = \&quot;test\&quot;;\n&quot; +
410                     &quot;    boolean dataIsString = ( data instanceof _As_ _Bs_ String str &amp;&amp; str.isEmpty());\n&quot; +
411                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
412                     &quot;\n\n&quot;;
413                 extraOptions = List.of(&quot;--enable-preview&quot;,
414                                        &quot;-source&quot;, JDK_VERSION);
415                 hasInnerClass=false;
416                 break;
417             case src8: // (repeating) type annotations in use of instanceof
418                     /*
419                      *   class Test20{
420                      *       String data = &quot;test&quot;;
421                      *       Boolean isString() {
422                      *           if( data instanceof @A @B @A @B String )
423                      *               return true;
424                      *           else
425                      *               return( data instanceof @A @B @A @B String );
426                      *       }
427                      *   }
428                      */
429                 source = new String( source +
430                     &quot;// &quot; + src.description + &quot;\n&quot; +
431                     &quot;class &quot;+ testname + &quot;{\n&quot; +
432                     &quot;    String data = \&quot;test\&quot;;\n&quot; +
433                     &quot;    Boolean isString() { \n&quot; +
434                     &quot;        if( data instanceof _As_ _Bs_ String )\n&quot; +
435                     &quot;            return true;\n&quot; +
436                     &quot;        else\n&quot; +
437                     &quot;            return( data instanceof _As_ _Bs_ String );\n&quot; +
438                     &quot;    }\n&quot; +
439                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
440                     &quot;\n\n&quot;;
441                     hasInnerClass=false;
442                 break;
443             case src8p: // (repeating) type annotations in use of instanceof with type test pattern
444                    /*
445                      *   class Test20{
446                      *       String data = &quot;test&quot;;
447                      *       Boolean isString() {
448                      *           if( data instanceof @A @B @A @B String )
449                      *               return true;
450                      *           else
451                      *               return( data instanceof @A @B @A @B String );
452                      *       }
453                      *   }
454                      */
455                 source = new String( source +
456                     &quot;// &quot; + src.description + &quot;\n&quot; +
457                     &quot;class &quot;+ testname + &quot;{\n&quot; +
458                     &quot;    String data = \&quot;test\&quot;;\n&quot; +
459                     &quot;    Boolean isString() { \n&quot; +
460                     &quot;        if( data instanceof _As_ _Bs_ String str)\n&quot; +
461                     &quot;            return true;\n&quot; +
462                     &quot;        else\n&quot; +
463                     &quot;            return( data instanceof _As_ _Bs_ String str &amp;&amp; str.isEmpty());\n&quot; +
464                     &quot;    }\n&quot; +
465                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
466                     &quot;\n\n&quot;;
467                 extraOptions = List.of(&quot;--enable-preview&quot;,
468                                        &quot;-source&quot;, JDK_VERSION);
469                 hasInnerClass=false;
470                 break;
471 
472         }
473         return imports + source;
474     }
475 }
    </pre>
  </body>
</html>