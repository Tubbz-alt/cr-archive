<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/annotations/typeAnnotations/classfile/CombinationsTargetTest2.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ClassfileTestHelper.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="NestedLambdasCastedTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/annotations/typeAnnotations/classfile/CombinationsTargetTest2.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2015, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8005085 8005877 8004829 8005681 8006734 8006775 8006507
 27  * @summary Combinations of Target ElementTypes on (repeated)type annotations.
 28  * @modules jdk.jdeps/com.sun.tools.classfile
 29  */
 30 
 31 import com.sun.tools.classfile.*;
 32 import java.io.File;

 33 
 34 public class CombinationsTargetTest2 extends ClassfileTestHelper {
 35 



 36     // Test count helps identify test case in event of failure.
 37     int testcount = 0;
 38 
 39     // Base test case template descriptions;true==annotations in code attribute.
 40     enum srce  {
 41         src1(&quot;(repeating) type annotations on on field in method body&quot;,true),
 42         src2(&quot;(repeating) type annotations on type parameters, bounds and  type arguments&quot;, true),
 43         src3(&quot;(repeating) type annotations on type parameters of class, method return value in method&quot;, true),
 44         src4(&quot;(repeating) type annotations on field in anonymous class&quot;, false),
 45         src5(&quot;(repeating) type annotations on field in anonymous class&quot;, false),
 46         src6(&quot;(repeating) type annotations on void method declaration&quot;, false),
 47         src7(&quot;(repeating) type annotations in use of instanceof&quot;, true),
<span class="line-modified"> 48         src8(&quot;(repeating) type annotations in use of instanceof in method&quot;, true);</span>


 49 
 50         String description;
 51         Boolean local;
 52 
 53         srce(String desc, Boolean b) {
 54             this.description = this + &quot;: &quot; +desc;
 55             this.local = b;
 56         }
 57     }
 58 
 59 
 60     String[] ETypes={&quot;TYPE&quot;, &quot;FIELD&quot;, &quot;METHOD&quot;, &quot;PARAMETER&quot;, &quot;CONSTRUCTOR&quot;,
 61                      &quot;LOCAL_VARIABLE&quot;, &quot;ANNOTATION_TYPE&quot;, &quot;PACKAGE&quot;};
 62 
 63     // local class tests will have an inner class.
 64     Boolean hasInnerClass=false;
 65     String innerClassname=&quot;&quot;;
 66 
 67     public static void main(String[] args) throws Exception {
 68         new CombinationsTargetTest2().run();
</pre>
<hr />
<pre>
 75         Boolean [][] bRepeat = new Boolean[][]{{false,false,false},//no repeats
 76                                                {true,false,false}, //repeat @A
 77                                                {false,true,false}, //repeat @B
 78                                                {true,true,false},  //repeat both
 79                                                {false,false,true}  //repeat mix
 80         };
 81 
 82         for(Boolean[] bCombo : bRepeat) {
 83             As=bCombo[0]; BDs=bCombo[1]; ABMix=bCombo[2];
 84             for(String et : ETypes) {
 85                switch(et) {
 86                    case &quot;METHOD&quot;:
 87                        test( 8, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src1);
 88                        test( 0, 8, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src1);
 89                        test( 2, 0, 2, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src5);
 90                        test( 0, 2, 0, 2, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src5);
 91                        test( 0, 0, 2, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src6);
 92                        test( 0, 0, 0, 2, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src6);
 93                        test( 2, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src7);
 94                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src7);


 95                        test( 4, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src8);
 96                        test( 0, 4, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src8);


 97                        break;
 98                    case &quot;FIELD&quot;:
 99                        test( 8, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src1);
100                        test( 8, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src2);
101                        test( 6, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src3);
102                        test( 2, 0, 2, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src4);
103                        test( 0, 8, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src1);
104                        test( 0, 8, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src2);
105                        test( 0, 6, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src3);
106                        test( 0, 2, 0, 2, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src4);
107                        break;
108                    default:/*TYPE,PARAMETER,LOCAL_VARIABLE,ANNOTATION_TYPE,PACKAGE*/
109                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src4);
110                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src5);
111                        break;
112                }
113             }
114         }
115     }
116 
117     public void test(int tinv, int tvis, int inv, int vis, Boolean Arepeats,
118                      Boolean BDrepeats, Boolean ABmix, String rtn, String et2,
119                      Integer N, srce source) throws Exception {
120         ++testcount;
121         expected_tvisibles = tvis;
122         expected_tinvisibles = tinv;
123         expected_visibles = vis;
124         expected_invisibles = inv;

125         File testFile = null;
126         String tname=&quot;Test&quot; + N.toString();
127         hasInnerClass=false;
128         String testDef = &quot;Test &quot; + testcount + &quot; parameters: tinv=&quot; + tinv +
129                 &quot;, tvis=&quot; + tvis + &quot;, inv=&quot; + inv + &quot;, vis=&quot; + vis +
130                 &quot;, Arepeats=&quot; + Arepeats + &quot;, BDrepeats=&quot; + BDrepeats +
131                 &quot;, ABmix=&quot; + ABmix + &quot;, retention: &quot; + rtn + &quot;, anno2: &quot; +
132                 et2 + &quot;, src=&quot; + source + &quot;\n    &quot; + source.description;
133 
134         println(testDef);
135         // Create test source and File.
136         String sourceString = sourceString(tname, rtn, et2, Arepeats,
137                                            BDrepeats, ABmix, source);
138         testFile = writeTestFile(tname+&quot;.java&quot;, sourceString);
139         // Compile test source and read classfile.
140         File classFile = null;
141         try {
142             classFile = compile(testFile);
143         } catch (Error err) {
144             System.err.println(&quot;Failed compile. Source:\n&quot; + sourceString);
</pre>
<hr />
<pre>
368                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
369                     &quot;\n\n&quot;;
370                     hasInnerClass=false;
371                 break;
372             case src7: // (repeating) type annotations in use of instanceof
373                     /*
374                      *   class Test10{
375                      *       String data = &quot;test&quot;;
376                      *       boolean dataIsString = ( data instanceof @A @B @A @B String);
377                      *   }
378                      */
379                 source = new String( source +
380                     &quot;// &quot; + src.description + &quot;\n&quot; +
381                     &quot;class &quot;+ testname + &quot;{\n&quot; +
382                     &quot;    String data = \&quot;test\&quot;;\n&quot; +
383                     &quot;    boolean dataIsString = ( data instanceof _As_ _Bs_ String);\n&quot; +
384                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
385                     &quot;\n\n&quot;;
386                     hasInnerClass=false;
387                 break;


















388             case src8: // (repeating) type annotations in use of instanceof
389                     /*
390                      *   class Test20{
391                      *       String data = &quot;test&quot;;
392                      *       Boolean isString() {
393                      *           if( data instanceof @A @B @A @B String )
394                      *               return true;
395                      *           else
396                      *               return( data instanceof @A @B @A @B String );
397                      *       }
398                      *   }
399                      */
400                 source = new String( source +
401                     &quot;// &quot; + src.description + &quot;\n&quot; +
402                     &quot;class &quot;+ testname + &quot;{\n&quot; +
403                     &quot;    String data = \&quot;test\&quot;;\n&quot; +
404                     &quot;    Boolean isString() { \n&quot; +
405                     &quot;        if( data instanceof _As_ _Bs_ String )\n&quot; +
406                     &quot;            return true;\n&quot; +
407                     &quot;        else\n&quot; +
408                     &quot;            return( data instanceof _As_ _Bs_ String );\n&quot; +
409                     &quot;    }\n&quot; +
410                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
411                     &quot;\n\n&quot;;
412                     hasInnerClass=false;
413                 break;




























414 
415         }
416         return imports + source;
417     }
418 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8005085 8005877 8004829 8005681 8006734 8006775 8006507
 27  * @summary Combinations of Target ElementTypes on (repeated)type annotations.
 28  * @modules jdk.jdeps/com.sun.tools.classfile
 29  */
 30 
 31 import com.sun.tools.classfile.*;
 32 import java.io.File;
<span class="line-added"> 33 import java.util.List;</span>
 34 
 35 public class CombinationsTargetTest2 extends ClassfileTestHelper {
 36 
<span class="line-added"> 37     private static final String JDK_VERSION =</span>
<span class="line-added"> 38             Integer.toString(Runtime.getRuntime().version().feature());</span>
<span class="line-added"> 39 </span>
 40     // Test count helps identify test case in event of failure.
 41     int testcount = 0;
 42 
 43     // Base test case template descriptions;true==annotations in code attribute.
 44     enum srce  {
 45         src1(&quot;(repeating) type annotations on on field in method body&quot;,true),
 46         src2(&quot;(repeating) type annotations on type parameters, bounds and  type arguments&quot;, true),
 47         src3(&quot;(repeating) type annotations on type parameters of class, method return value in method&quot;, true),
 48         src4(&quot;(repeating) type annotations on field in anonymous class&quot;, false),
 49         src5(&quot;(repeating) type annotations on field in anonymous class&quot;, false),
 50         src6(&quot;(repeating) type annotations on void method declaration&quot;, false),
 51         src7(&quot;(repeating) type annotations in use of instanceof&quot;, true),
<span class="line-modified"> 52         src7p(&quot;(repeating) type annotations in use of instanceof with type test pattern&quot;, true),</span>
<span class="line-added"> 53         src8(&quot;(repeating) type annotations in use of instanceof in method&quot;, true),</span>
<span class="line-added"> 54         src8p(&quot;(repeating) type annotations in use of instanceof with type test pattern in method&quot;, true);</span>
 55 
 56         String description;
 57         Boolean local;
 58 
 59         srce(String desc, Boolean b) {
 60             this.description = this + &quot;: &quot; +desc;
 61             this.local = b;
 62         }
 63     }
 64 
 65 
 66     String[] ETypes={&quot;TYPE&quot;, &quot;FIELD&quot;, &quot;METHOD&quot;, &quot;PARAMETER&quot;, &quot;CONSTRUCTOR&quot;,
 67                      &quot;LOCAL_VARIABLE&quot;, &quot;ANNOTATION_TYPE&quot;, &quot;PACKAGE&quot;};
 68 
 69     // local class tests will have an inner class.
 70     Boolean hasInnerClass=false;
 71     String innerClassname=&quot;&quot;;
 72 
 73     public static void main(String[] args) throws Exception {
 74         new CombinationsTargetTest2().run();
</pre>
<hr />
<pre>
 81         Boolean [][] bRepeat = new Boolean[][]{{false,false,false},//no repeats
 82                                                {true,false,false}, //repeat @A
 83                                                {false,true,false}, //repeat @B
 84                                                {true,true,false},  //repeat both
 85                                                {false,false,true}  //repeat mix
 86         };
 87 
 88         for(Boolean[] bCombo : bRepeat) {
 89             As=bCombo[0]; BDs=bCombo[1]; ABMix=bCombo[2];
 90             for(String et : ETypes) {
 91                switch(et) {
 92                    case &quot;METHOD&quot;:
 93                        test( 8, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src1);
 94                        test( 0, 8, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src1);
 95                        test( 2, 0, 2, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src5);
 96                        test( 0, 2, 0, 2, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src5);
 97                        test( 0, 0, 2, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src6);
 98                        test( 0, 0, 0, 2, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src6);
 99                        test( 2, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src7);
100                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src7);
<span class="line-added">101                        test( 2, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src7p);</span>
<span class="line-added">102                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src7p);</span>
103                        test( 4, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src8);
104                        test( 0, 4, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src8);
<span class="line-added">105                        test( 4, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;, et, ++testrun, srce.src8p);</span>
<span class="line-added">106                        test( 0, 4, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src8p);</span>
107                        break;
108                    case &quot;FIELD&quot;:
109                        test( 8, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src1);
110                        test( 8, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src2);
111                        test( 6, 0, 0, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src3);
112                        test( 2, 0, 2, 0, As, BDs, ABMix, &quot;CLASS&quot;,   et, ++testrun, srce.src4);
113                        test( 0, 8, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src1);
114                        test( 0, 8, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src2);
115                        test( 0, 6, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src3);
116                        test( 0, 2, 0, 2, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src4);
117                        break;
118                    default:/*TYPE,PARAMETER,LOCAL_VARIABLE,ANNOTATION_TYPE,PACKAGE*/
119                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src4);
120                        test( 0, 2, 0, 0, As, BDs, ABMix, &quot;RUNTIME&quot;, et, ++testrun, srce.src5);
121                        break;
122                }
123             }
124         }
125     }
126 
127     public void test(int tinv, int tvis, int inv, int vis, Boolean Arepeats,
128                      Boolean BDrepeats, Boolean ABmix, String rtn, String et2,
129                      Integer N, srce source) throws Exception {
130         ++testcount;
131         expected_tvisibles = tvis;
132         expected_tinvisibles = tinv;
133         expected_visibles = vis;
134         expected_invisibles = inv;
<span class="line-added">135         extraOptions = List.of();</span>
136         File testFile = null;
137         String tname=&quot;Test&quot; + N.toString();
138         hasInnerClass=false;
139         String testDef = &quot;Test &quot; + testcount + &quot; parameters: tinv=&quot; + tinv +
140                 &quot;, tvis=&quot; + tvis + &quot;, inv=&quot; + inv + &quot;, vis=&quot; + vis +
141                 &quot;, Arepeats=&quot; + Arepeats + &quot;, BDrepeats=&quot; + BDrepeats +
142                 &quot;, ABmix=&quot; + ABmix + &quot;, retention: &quot; + rtn + &quot;, anno2: &quot; +
143                 et2 + &quot;, src=&quot; + source + &quot;\n    &quot; + source.description;
144 
145         println(testDef);
146         // Create test source and File.
147         String sourceString = sourceString(tname, rtn, et2, Arepeats,
148                                            BDrepeats, ABmix, source);
149         testFile = writeTestFile(tname+&quot;.java&quot;, sourceString);
150         // Compile test source and read classfile.
151         File classFile = null;
152         try {
153             classFile = compile(testFile);
154         } catch (Error err) {
155             System.err.println(&quot;Failed compile. Source:\n&quot; + sourceString);
</pre>
<hr />
<pre>
379                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
380                     &quot;\n\n&quot;;
381                     hasInnerClass=false;
382                 break;
383             case src7: // (repeating) type annotations in use of instanceof
384                     /*
385                      *   class Test10{
386                      *       String data = &quot;test&quot;;
387                      *       boolean dataIsString = ( data instanceof @A @B @A @B String);
388                      *   }
389                      */
390                 source = new String( source +
391                     &quot;// &quot; + src.description + &quot;\n&quot; +
392                     &quot;class &quot;+ testname + &quot;{\n&quot; +
393                     &quot;    String data = \&quot;test\&quot;;\n&quot; +
394                     &quot;    boolean dataIsString = ( data instanceof _As_ _Bs_ String);\n&quot; +
395                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
396                     &quot;\n\n&quot;;
397                     hasInnerClass=false;
398                 break;
<span class="line-added">399             case src7p: // (repeating) type annotations in use of instanceof with type test pattern</span>
<span class="line-added">400                     /*</span>
<span class="line-added">401                      *   class Test10{</span>
<span class="line-added">402                      *       String data = &quot;test&quot;;</span>
<span class="line-added">403                      *       boolean dataIsString = ( data instanceof @A @B @A @B String str);</span>
<span class="line-added">404                      *   }</span>
<span class="line-added">405                      */</span>
<span class="line-added">406                 source = new String( source +</span>
<span class="line-added">407                     &quot;// &quot; + src.description + &quot;\n&quot; +</span>
<span class="line-added">408                     &quot;class &quot;+ testname + &quot;{\n&quot; +</span>
<span class="line-added">409                     &quot;    String data = \&quot;test\&quot;;\n&quot; +</span>
<span class="line-added">410                     &quot;    boolean dataIsString = ( data instanceof _As_ _Bs_ String str &amp;&amp; str.isEmpty());\n&quot; +</span>
<span class="line-added">411                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +</span>
<span class="line-added">412                     &quot;\n\n&quot;;</span>
<span class="line-added">413                 extraOptions = List.of(&quot;--enable-preview&quot;,</span>
<span class="line-added">414                                        &quot;-source&quot;, JDK_VERSION);</span>
<span class="line-added">415                 hasInnerClass=false;</span>
<span class="line-added">416                 break;</span>
417             case src8: // (repeating) type annotations in use of instanceof
418                     /*
419                      *   class Test20{
420                      *       String data = &quot;test&quot;;
421                      *       Boolean isString() {
422                      *           if( data instanceof @A @B @A @B String )
423                      *               return true;
424                      *           else
425                      *               return( data instanceof @A @B @A @B String );
426                      *       }
427                      *   }
428                      */
429                 source = new String( source +
430                     &quot;// &quot; + src.description + &quot;\n&quot; +
431                     &quot;class &quot;+ testname + &quot;{\n&quot; +
432                     &quot;    String data = \&quot;test\&quot;;\n&quot; +
433                     &quot;    Boolean isString() { \n&quot; +
434                     &quot;        if( data instanceof _As_ _Bs_ String )\n&quot; +
435                     &quot;            return true;\n&quot; +
436                     &quot;        else\n&quot; +
437                     &quot;            return( data instanceof _As_ _Bs_ String );\n&quot; +
438                     &quot;    }\n&quot; +
439                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +
440                     &quot;\n\n&quot;;
441                     hasInnerClass=false;
442                 break;
<span class="line-added">443             case src8p: // (repeating) type annotations in use of instanceof with type test pattern</span>
<span class="line-added">444                    /*</span>
<span class="line-added">445                      *   class Test20{</span>
<span class="line-added">446                      *       String data = &quot;test&quot;;</span>
<span class="line-added">447                      *       Boolean isString() {</span>
<span class="line-added">448                      *           if( data instanceof @A @B @A @B String )</span>
<span class="line-added">449                      *               return true;</span>
<span class="line-added">450                      *           else</span>
<span class="line-added">451                      *               return( data instanceof @A @B @A @B String );</span>
<span class="line-added">452                      *       }</span>
<span class="line-added">453                      *   }</span>
<span class="line-added">454                      */</span>
<span class="line-added">455                 source = new String( source +</span>
<span class="line-added">456                     &quot;// &quot; + src.description + &quot;\n&quot; +</span>
<span class="line-added">457                     &quot;class &quot;+ testname + &quot;{\n&quot; +</span>
<span class="line-added">458                     &quot;    String data = \&quot;test\&quot;;\n&quot; +</span>
<span class="line-added">459                     &quot;    Boolean isString() { \n&quot; +</span>
<span class="line-added">460                     &quot;        if( data instanceof _As_ _Bs_ String str)\n&quot; +</span>
<span class="line-added">461                     &quot;            return true;\n&quot; +</span>
<span class="line-added">462                     &quot;        else\n&quot; +</span>
<span class="line-added">463                     &quot;            return( data instanceof _As_ _Bs_ String str &amp;&amp; str.isEmpty());\n&quot; +</span>
<span class="line-added">464                     &quot;    }\n&quot; +</span>
<span class="line-added">465                     &quot;}\n&quot;).concat(sourceBase).replace(&quot;_OTHER_&quot;, annot2).replace(&quot;_As_&quot;,As).replace(&quot;_Bs_&quot;,Bs) +</span>
<span class="line-added">466                     &quot;\n\n&quot;;</span>
<span class="line-added">467                 extraOptions = List.of(&quot;--enable-preview&quot;,</span>
<span class="line-added">468                                        &quot;-source&quot;, JDK_VERSION);</span>
<span class="line-added">469                 hasInnerClass=false;</span>
<span class="line-added">470                 break;</span>
471 
472         }
473         return imports + source;
474     }
475 }
</pre>
</td>
</tr>
</table>
<center><a href="ClassfileTestHelper.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="NestedLambdasCastedTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>