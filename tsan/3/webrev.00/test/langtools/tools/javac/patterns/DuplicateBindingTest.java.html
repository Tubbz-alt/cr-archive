<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/langtools/tools/javac/patterns/DuplicateBindingTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * @test /nodynamiccopyright/
 3  * @bug 8231827
 4  * @summary Basic pattern bindings scope test
 5  * @compile/fail/ref=DuplicateBindingTest.out -XDrawDiagnostics --enable-preview -source ${jdk.version} DuplicateBindingTest.java
 6  */
 7 
 8 public class DuplicateBindingTest {
 9 
10     int f;
11 
12     public static boolean main(String[] args) {
13 
14         if (args != null) {
15             int s;
16             if (args[0] instanceof String s) { // NOT OK. Redef same scope.
17             }
18             if (args[0] instanceof String f) { // OK to redef field.
19             }
20         }
21 
22         Object o1 = &quot;&quot;;
23         Object o2 = &quot;&quot;;
24 
25         if (o1 instanceof String s &amp;&amp; o2 instanceof String s) {} //error - already in scope on RHS (in scope due to LHS when true)
26         if (o1 instanceof String s &amp;&amp; !(o2 instanceof String s)) {} //error - already in scope on RHS (in scope due to LHS when true)
27         if (!(o1 instanceof String s) &amp;&amp; !(o2 instanceof String s)) {} //error - the same binding variable on LHS and RHS when false
28         if (!(o1 instanceof String s) &amp;&amp; (o2 instanceof String s)) {} //ok
29 
30         if (!(o1 instanceof String s) || o2 instanceof String s) {} //error - already in scope on RHS (in scope due to LHS when false)
31         if (!(o1 instanceof String s) || !(o2 instanceof String s)) {} //error - already in scope on RHS (in scope due to LHS when false)
32         if (o1 instanceof String s || o2 instanceof String s) {} //error - the same binding variable on LHS and RHS when true
33         if (o1 instanceof String s || !(o2 instanceof String s)) {} //ok
34 
35         if (o1 instanceof String s ? o2 instanceof String s : true) {} //error - already in scope in the true section (due to condition when true)
36         if (o1 instanceof String s ? true : o2 instanceof String s) {} //error - the same binding variable in condition when true and false section when true
37         if (!(o1 instanceof String s) ? o2 instanceof String s : true) {} //error - the same binding variable in condition when false and true section when true
38         if (args.length == 1 ? o2 instanceof String s : o2 instanceof String s) {} //error - the same binding variable in true section when true and false section when true
39         if (o1 instanceof String s ? true : !(o2 instanceof String s)) {} //error - the same binding variable in condition when true and false section when false
40         if (!(o1 instanceof String s) ? !(o2 instanceof String s) : true) {} //error - the same binding variable in condition when false and true section when false
41         if (args.length == 1 ? !(o2 instanceof String s) : !(o2 instanceof String s)) {} //error - the same binding variable in true section when false and false section when false
42 
43         //verify that errors are reported to clashes in expression in non-conditional statements:
44         boolean b = o1 instanceof String s &amp;&amp; o2 instanceof String s;
45         b = o1 instanceof String s &amp;&amp; o2 instanceof String s;
46         b &amp;= o1 instanceof String s &amp;&amp; o2 instanceof String s;
47         assert o1 instanceof String s &amp;&amp; o2 instanceof String s;
48         testMethod(o1 instanceof String s &amp;&amp; o2 instanceof String s, false);
49         b = switch (args.length) { default -&gt; o1 instanceof String s &amp;&amp; o2 instanceof String s; };
50         b = switch (args.length) { default -&gt; { yield o1 instanceof String s &amp;&amp; o2 instanceof String s; } };
51         if (true) return o1 instanceof String s &amp;&amp; o2 instanceof String s;
52 
53         //verify the bindings don&#39;t go through method invocation parameters or outside a lambda:
54         b = ((VoidPredicate) () -&gt; o1 instanceof String s).get() &amp;&amp; s.isEmpty();
55         testMethod(o1 instanceof String s, s.isEmpty());
56     }
57 
58     static void testMethod(boolean b1, boolean b2) {}
59     interface VoidPredicate {
60         public boolean get();
61     }
62 }
    </pre>
  </body>
</html>