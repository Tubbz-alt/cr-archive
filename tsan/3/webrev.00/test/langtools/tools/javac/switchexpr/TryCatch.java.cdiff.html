<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/langtools/tools/javac/switchexpr/TryCatch.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="SwitchExpressionSimpleVisitorTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../switchextra/CaseTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/switchexpr/TryCatch.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 23,12 ***</span>
  
  /**
   * @test
   * @bug 8214114
   * @summary Verify try-catch inside a switch expression works properly.
<span class="line-modified">!  * @compile --enable-preview -source ${jdk.version} TryCatch.java</span>
<span class="line-modified">!  * @run main/othervm --enable-preview TryCatch</span>
   */
  public class TryCatch {
      public static void main(String[] args) {
          {
              int val = 3;
<span class="line-new-header">--- 23,12 ---</span>
  
  /**
   * @test
   * @bug 8214114
   * @summary Verify try-catch inside a switch expression works properly.
<span class="line-modified">!  * @compile TryCatch.java</span>
<span class="line-modified">!  * @run main TryCatch</span>
   */
  public class TryCatch {
      public static void main(String[] args) {
          {
              int val = 3;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 36,38 ***</span>
                  int res = 1 + new TryCatch().id(switch(p) {
                      case 0 -&gt; switch (p + 1) {
                          case 1:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break -1;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 break val;</span>
                              }
<span class="line-modified">!                         default: break -1;</span>
                      };
                      case 1 -&gt; {
                          try {
<span class="line-modified">!                             break new TryCatch().id(switch (p + 1) {</span>
                                  case 2:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         break -1;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: break -1;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             break val;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             break -1;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             break val;</span>
                          }
                      }
                  } - 1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
<span class="line-new-header">--- 36,38 ---</span>
                  int res = 1 + new TryCatch().id(switch(p) {
                      case 0 -&gt; switch (p + 1) {
                          case 1:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield -1;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 yield val;</span>
                              }
<span class="line-modified">!                         default: yield -1;</span>
                      };
                      case 1 -&gt; {
                          try {
<span class="line-modified">!                             yield new TryCatch().id(switch (p + 1) {</span>
                                  case 2:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         yield -1;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: yield -1;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield val;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             yield -1;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield val;</span>
                          }
                      }
                  } - 1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 81,38 ***</span>
                  int res = new TryCatch().id(val == 3 &amp;&amp; switch(p) {
                      case 0 -&gt; switch (p + 1) {
                          case 1:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break false;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 break true;</span>
                              }
<span class="line-modified">!                         default: break false;</span>
                      };
                      case 1 -&gt; {
                          try {
<span class="line-modified">!                             break new TryCatch().id(switch (p + 1) {</span>
                                  case 2:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         break false;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: break false;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             break true;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             break false;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             break true;</span>
                          }
                      }
                  } &amp;&amp; (x = 1) == 1 &amp;&amp; x == 1 ? val : -1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
<span class="line-new-header">--- 81,38 ---</span>
                  int res = new TryCatch().id(val == 3 &amp;&amp; switch(p) {
                      case 0 -&gt; switch (p + 1) {
                          case 1:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield false;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 yield true;</span>
                              }
<span class="line-modified">!                         default: yield false;</span>
                      };
                      case 1 -&gt; {
                          try {
<span class="line-modified">!                             yield new TryCatch().id(switch (p + 1) {</span>
                                  case 2:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         yield false;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: yield false;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield true;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             yield false;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield true;</span>
                          }
                      }
                  } &amp;&amp; (x = 1) == 1 &amp;&amp; x == 1 ? val : -1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 125,38 ***</span>
                  int res = 1 + new TryCatch().id(switch(e) {
                      case A -&gt; switch (e.next()) {
                          case B:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break -1;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 break val;</span>
                              }
<span class="line-modified">!                         default: break -1;</span>
                      };
                      case B -&gt; {
                          try {
<span class="line-modified">!                             break new TryCatch().id(switch (e.next()) {</span>
                                  case C:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         break -1;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: break -1;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             break val;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             break -1;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             break val;</span>
                          }
                      }
                  } - 1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
<span class="line-new-header">--- 125,38 ---</span>
                  int res = 1 + new TryCatch().id(switch(e) {
                      case A -&gt; switch (e.next()) {
                          case B:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield -1;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 yield val;</span>
                              }
<span class="line-modified">!                         default: yield -1;</span>
                      };
                      case B -&gt; {
                          try {
<span class="line-modified">!                             yield new TryCatch().id(switch (e.next()) {</span>
                                  case C:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         yield -1;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: yield -1;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield val;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             yield -1;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield val;</span>
                          }
                      }
                  } - 1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 170,38 ***</span>
                  int res = new TryCatch().id(val == 3 &amp;&amp; switch(e) {
                      case A -&gt; switch (e.next()) {
                          case B:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break false;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 break true;</span>
                              }
<span class="line-modified">!                         default: break false;</span>
                      };
                      case B -&gt; {
                          try {
<span class="line-modified">!                             break new TryCatch().id(switch (e.next()) {</span>
                                  case C:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         break false;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: break false;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             break true;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             break false;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             break true;</span>
                          }
                      }
                  } &amp;&amp; (x = 1) == 1 &amp;&amp; x == 1 ? val : -1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
<span class="line-new-header">--- 170,38 ---</span>
                  int res = new TryCatch().id(val == 3 &amp;&amp; switch(e) {
                      case A -&gt; switch (e.next()) {
                          case B:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield false;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 yield true;</span>
                              }
<span class="line-modified">!                         default: yield false;</span>
                      };
                      case B -&gt; {
                          try {
<span class="line-modified">!                             yield new TryCatch().id(switch (e.next()) {</span>
                                  case C:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         yield false;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: yield false;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield true;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             yield false;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield true;</span>
                          }
                      }
                  } &amp;&amp; (x = 1) == 1 &amp;&amp; x == 1 ? val : -1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 214,38 ***</span>
                  int res = 1 + new TryCatch().id(switch(s) {
                      case &quot;&quot; -&gt; switch (s + &quot;c&quot;) {
                          case &quot;c&quot;:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break -1;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 break val;</span>
                              }
<span class="line-modified">!                         default: break -1;</span>
                      };
                      case &quot;a&quot; -&gt; {
                          try {
<span class="line-modified">!                             break new TryCatch().id(switch (s + &quot;c&quot;) {</span>
                                  case &quot;ac&quot;:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         break -1;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: break -1;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             break val;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             break -1;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             break val;</span>
                          }
                      }
                  } - 1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
<span class="line-new-header">--- 214,38 ---</span>
                  int res = 1 + new TryCatch().id(switch(s) {
                      case &quot;&quot; -&gt; switch (s + &quot;c&quot;) {
                          case &quot;c&quot;:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield -1;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 yield val;</span>
                              }
<span class="line-modified">!                         default: yield -1;</span>
                      };
                      case &quot;a&quot; -&gt; {
                          try {
<span class="line-modified">!                             yield new TryCatch().id(switch (s + &quot;c&quot;) {</span>
                                  case &quot;ac&quot;:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         yield -1;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: yield -1;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield val;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             yield -1;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield val;</span>
                          }
                      }
                  } - 1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 259,38 ***</span>
                  int res = new TryCatch().id(val == 3 &amp;&amp; switch(s) {
                      case &quot;&quot; -&gt; switch (s + &quot;c&quot;) {
                          case &quot;c&quot;:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break false;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 break true;</span>
                              }
<span class="line-modified">!                         default: break false;</span>
                      };
                      case &quot;a&quot; -&gt; {
                          try {
<span class="line-modified">!                             break new TryCatch().id(switch (s + &quot;c&quot;) {</span>
                                  case &quot;ac&quot;:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         break false;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: break false;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             break true;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             break false;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             break true;</span>
                          }
                      }
                  } &amp;&amp; (x = 1) == 1 &amp;&amp; x == 1 ? val : -1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
<span class="line-new-header">--- 259,38 ---</span>
                  int res = new TryCatch().id(val == 3 &amp;&amp; switch(s) {
                      case &quot;&quot; -&gt; switch (s + &quot;c&quot;) {
                          case &quot;c&quot;:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield false;</span>
                              } catch(Throwable ex) {
<span class="line-modified">!                                 yield true;</span>
                              }
<span class="line-modified">!                         default: yield false;</span>
                      };
                      case &quot;a&quot; -&gt; {
                          try {
<span class="line-modified">!                             yield new TryCatch().id(switch (s + &quot;c&quot;) {</span>
                                  case &quot;ac&quot;:
                                      try {
                                          new TryCatch().throwException();
<span class="line-modified">!                                         yield false;</span>
                                      } catch(Throwable ex) {
                                          throw ex;
                                      }
<span class="line-modified">!                                 default: yield false;</span>
                              });
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield true;</span>
                          }
                      }
                      default -&gt; {
                          try {
                              new TryCatch().throwException();
<span class="line-modified">!                             yield false;</span>
                          } catch(Throwable ex) {
<span class="line-modified">!                             yield true;</span>
                          }
                      }
                  } &amp;&amp; (x = 1) == 1 &amp;&amp; x == 1 ? val : -1);
                  if (res != 3) {
                      throw new AssertionError(&quot;Unexpected result: &quot; + res);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 328,79 ***</span>
          }
      }
  
      static class FieldHolder {
          private final int intTest = switch (0) {
<span class="line-modified">!             case -1: break -1;</span>
              default:
                  try {
<span class="line-modified">!                     break new TryCatch().id(switch (2) {</span>
                          case 2:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break -1;</span>
                              } catch(Throwable ex) {
                                  throw ex;
                              }
<span class="line-modified">!                         default: break -1;</span>
                      });
                  } catch(Throwable ex) {
<span class="line-modified">!                     break 3;</span>
                  }
          };
          private static final int intStaticTest = switch (0) {
<span class="line-modified">!             case -1: break -1;</span>
              default:
                  try {
<span class="line-modified">!                     break new TryCatch().id(switch (2) {</span>
                          case 2:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break -1;</span>
                              } catch(Throwable ex) {
                                  throw ex;
                              }
<span class="line-modified">!                         default: break -1;</span>
                      });
                  } catch(Throwable ex) {
<span class="line-modified">!                     break 3;</span>
                  }
          };
          private final boolean booleanTest = switch (0) {
<span class="line-modified">!             case -1: break false;</span>
              default:
                  try {
<span class="line-modified">!                     break new TryCatch().id(switch (2) {</span>
                          case 2:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break false;</span>
                              } catch(Throwable ex) {
                                  throw ex;
                              }
<span class="line-modified">!                         default: break false;</span>
                      });
                  } catch(Throwable ex) {
<span class="line-modified">!                     break true;</span>
                  }
          };
          private static final boolean booleanStaticTest = switch (0) {
<span class="line-modified">!             case -1: break false;</span>
              default:
                  try {
<span class="line-modified">!                     break new TryCatch().id(switch (2) {</span>
                          case 2:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 break false;</span>
                              } catch(Throwable ex) {
                                  throw ex;
                              }
<span class="line-modified">!                         default: break false;</span>
                      });
                  } catch(Throwable ex) {
<span class="line-modified">!                     break true;</span>
                  }
          };
      }
  
      private int id(int i) {
<span class="line-new-header">--- 328,79 ---</span>
          }
      }
  
      static class FieldHolder {
          private final int intTest = switch (0) {
<span class="line-modified">!             case -1: yield -1;</span>
              default:
                  try {
<span class="line-modified">!                     yield new TryCatch().id(switch (2) {</span>
                          case 2:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield -1;</span>
                              } catch(Throwable ex) {
                                  throw ex;
                              }
<span class="line-modified">!                         default: yield -1;</span>
                      });
                  } catch(Throwable ex) {
<span class="line-modified">!                     yield 3;</span>
                  }
          };
          private static final int intStaticTest = switch (0) {
<span class="line-modified">!             case -1: yield -1;</span>
              default:
                  try {
<span class="line-modified">!                     yield new TryCatch().id(switch (2) {</span>
                          case 2:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield -1;</span>
                              } catch(Throwable ex) {
                                  throw ex;
                              }
<span class="line-modified">!                         default: yield -1;</span>
                      });
                  } catch(Throwable ex) {
<span class="line-modified">!                     yield 3;</span>
                  }
          };
          private final boolean booleanTest = switch (0) {
<span class="line-modified">!             case -1: yield false;</span>
              default:
                  try {
<span class="line-modified">!                     yield new TryCatch().id(switch (2) {</span>
                          case 2:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield false;</span>
                              } catch(Throwable ex) {
                                  throw ex;
                              }
<span class="line-modified">!                         default: yield false;</span>
                      });
                  } catch(Throwable ex) {
<span class="line-modified">!                     yield true;</span>
                  }
          };
          private static final boolean booleanStaticTest = switch (0) {
<span class="line-modified">!             case -1: yield false;</span>
              default:
                  try {
<span class="line-modified">!                     yield new TryCatch().id(switch (2) {</span>
                          case 2:
                              try {
                                  new TryCatch().throwException();
<span class="line-modified">!                                 yield false;</span>
                              } catch(Throwable ex) {
                                  throw ex;
                              }
<span class="line-modified">!                         default: yield false;</span>
                      });
                  } catch(Throwable ex) {
<span class="line-modified">!                     yield true;</span>
                  }
          };
      }
  
      private int id(int i) {
</pre>
<center><a href="SwitchExpressionSimpleVisitorTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../switchextra/CaseTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>