<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/langtools/tools/javac/switchexpr/ExpressionSwitchEmbedding.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="ExpressionSwitchDA.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ExpressionSwitchFallThrough.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/switchexpr/ExpressionSwitchEmbedding.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2018, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,14 +21,14 @@</span>
   * questions.
   */
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8214031 8214114</span>
<span class="udiff-line-modified-added">+  * @bug 8214031 8214114 8236546</span>
   * @summary Verify switch expressions embedded in various statements work properly.
<span class="udiff-line-modified-removed">-  * @compile --enable-preview -source ${jdk.version} ExpressionSwitchEmbedding.java</span>
<span class="udiff-line-modified-removed">-  * @run main/othervm --enable-preview ExpressionSwitchEmbedding</span>
<span class="udiff-line-modified-added">+  * @compile ExpressionSwitchEmbedding.java</span>
<span class="udiff-line-modified-added">+  * @run main ExpressionSwitchEmbedding</span>
   */
  
  public class ExpressionSwitchEmbedding {
      public static void main(String... args) {
          new ExpressionSwitchEmbedding().run();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -37,23 +37,23 @@</span>
      private void run() {
          {
              int i = 6;
              int o = 0;
              while (switch (i) {
<span class="udiff-line-modified-removed">-                 case 1: i = 0; break true;</span>
<span class="udiff-line-modified-removed">-                 case 2: i = 1; break true;</span>
<span class="udiff-line-modified-added">+                 case 1: i = 0; yield true;</span>
<span class="udiff-line-modified-added">+                 case 2: i = 1; yield true;</span>
                  case 3, 4: i--;
                      if (i == 2 || i == 4) {
<span class="udiff-line-modified-removed">-                         break switch (i) {</span>
<span class="udiff-line-modified-added">+                         yield switch (i) {</span>
                              case 2 -&gt; true;
                              case 4 -&gt; false;
                              default -&gt; throw new IllegalStateException();
                          };
                      } else {
<span class="udiff-line-modified-removed">-                         break true;</span>
<span class="udiff-line-modified-added">+                         yield true;</span>
                      }
<span class="udiff-line-modified-removed">-                 default: i--; break switch (i) {</span>
<span class="udiff-line-modified-added">+                 default: i--; yield switch (i) {</span>
                      case -1 -&gt; false;
                      case 3 -&gt; true;
                      default -&gt; true;
                  };
              }) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -65,37 +65,37 @@</span>
          }
          {
              int i = 6;
              int o = 0;
              while (switch (i) {
<span class="udiff-line-modified-removed">-                 case 1: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 0; break true; }</span>
<span class="udiff-line-modified-removed">-                 case 2: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 1; break true; }</span>
<span class="udiff-line-modified-added">+                 case 1: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 0; yield true; }</span>
<span class="udiff-line-modified-added">+                 case 2: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 1; yield true; }</span>
                  case 3, 4:
                      try {
                          new ExpressionSwitchEmbedding().throwException();
                      } catch (Throwable t) {
                          i--;
                          if (i == 2 || i == 4) {
                              try {
<span class="udiff-line-modified-removed">-                                 break switch (i) {</span>
<span class="udiff-line-modified-added">+                                 yield switch (i) {</span>
                                      case 2 -&gt; throw new ResultException(true);
                                      case 4 -&gt; false;
                                      default -&gt; throw new IllegalStateException();
                                  };
                              } catch (ResultException ex) {
<span class="udiff-line-modified-removed">-                                 break ex.result;</span>
<span class="udiff-line-modified-added">+                                 yield ex.result;</span>
                              }
                          } else {
<span class="udiff-line-modified-removed">-                             break true;</span>
<span class="udiff-line-modified-added">+                             yield true;</span>
                          }
                      }
                  default:
                      try {
                          new ExpressionSwitchEmbedding().throwException();
                      } catch (Throwable t) {
                          i--;
<span class="udiff-line-modified-removed">-                         break switch (i) {</span>
<span class="udiff-line-modified-added">+                         yield switch (i) {</span>
                              case -1 -&gt; false;
                              case 3 -&gt; true;
                              default -&gt; true;
                          };
                      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -109,23 +109,23 @@</span>
          }
          {
              int i = 6;
              int o = 0;
              if (switch (i) {
<span class="udiff-line-modified-removed">-                 case 1: i = 0; break true;</span>
<span class="udiff-line-modified-removed">-                 case 2: i = 1; break true;</span>
<span class="udiff-line-modified-added">+                 case 1: i = 0; yield true;</span>
<span class="udiff-line-modified-added">+                 case 2: i = 1; yield true;</span>
                  case 3, 4: i--;
                      if (i == 2 || i == 4) {
<span class="udiff-line-modified-removed">-                         break (switch (i) {</span>
<span class="udiff-line-modified-added">+                         yield (switch (i) {</span>
                              case 2 -&gt; 3;
                              case 4 -&gt; 5;
                              default -&gt; throw new IllegalStateException();
                          }) == i + 1;
                      } else {
<span class="udiff-line-modified-removed">-                         break true;</span>
<span class="udiff-line-modified-added">+                         yield true;</span>
                      }
<span class="udiff-line-modified-removed">-                 default: i--; break switch (i) {</span>
<span class="udiff-line-modified-added">+                 default: i--; yield switch (i) {</span>
                      case -1 -&gt; false;
                      case 3 -&gt; true;
                      default -&gt; true;
                  };
              }) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -137,37 +137,37 @@</span>
          }
          {
              int i = 6;
              int o = 0;
              if (switch (i) {
<span class="udiff-line-modified-removed">-                 case 1: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 0; break true; }</span>
<span class="udiff-line-modified-removed">-                 case 2: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 1; break true; }</span>
<span class="udiff-line-modified-added">+                 case 1: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 0; yield true; }</span>
<span class="udiff-line-modified-added">+                 case 2: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 1; yield true; }</span>
                  case 3, 4:
                      try {
                          new ExpressionSwitchEmbedding().throwException();
                      } catch (Throwable t) {
                          i--;
                          if (i == 2 || i == 4) {
                              try {
<span class="udiff-line-modified-removed">-                                 break switch (i) {</span>
<span class="udiff-line-modified-added">+                                 yield switch (i) {</span>
                                      case 2 -&gt; throw new ResultException(true);
                                      case 4 -&gt; false;
                                      default -&gt; throw new IllegalStateException();
                                  };
                              } catch (ResultException ex) {
<span class="udiff-line-modified-removed">-                                 break ex.result;</span>
<span class="udiff-line-modified-added">+                                 yield ex.result;</span>
                              }
                          } else {
<span class="udiff-line-modified-removed">-                             break true;</span>
<span class="udiff-line-modified-added">+                             yield true;</span>
                          }
                      }
                  default:
                      try {
                          new ExpressionSwitchEmbedding().throwException();
                      } catch (Throwable t) {
                          i--;
<span class="udiff-line-modified-removed">-                         break switch (i) {</span>
<span class="udiff-line-modified-added">+                         yield switch (i) {</span>
                              case -1 -&gt; false;
                              case 3 -&gt; true;
                              default -&gt; true;
                          };
                      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -180,23 +180,23 @@</span>
              }
          }
          {
              int o = 0;
              for (int i = 6; (switch (i) {
<span class="udiff-line-modified-removed">-                 case 1: i = 0; break true;</span>
<span class="udiff-line-modified-removed">-                 case 2: i = 1; break true;</span>
<span class="udiff-line-modified-added">+                 case 1: i = 0; yield true;</span>
<span class="udiff-line-modified-added">+                 case 2: i = 1; yield true;</span>
                  case 3, 4: i--;
                      if (i == 2 || i == 4) {
<span class="udiff-line-modified-removed">-                         break switch (i) {</span>
<span class="udiff-line-modified-added">+                         yield switch (i) {</span>
                              case 2 -&gt; true;
                              case 4 -&gt; false;
                              default -&gt; throw new IllegalStateException();
                          };
                      } else {
<span class="udiff-line-modified-removed">-                         break true;</span>
<span class="udiff-line-modified-added">+                         yield true;</span>
                      }
<span class="udiff-line-modified-removed">-                 default: i--; break switch (i) {</span>
<span class="udiff-line-modified-added">+                 default: i--; yield switch (i) {</span>
                      case -1 -&gt; false;
                      case 3 -&gt; true;
                      default -&gt; true;
                  };
              }); ) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -207,37 +207,37 @@</span>
              }
          }
          {
              int o = 0;
              for (int i = 6; (switch (i) {
<span class="udiff-line-modified-removed">-                 case 1: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 0; break true; }</span>
<span class="udiff-line-modified-removed">-                 case 2: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 1; break true; }</span>
<span class="udiff-line-modified-added">+                 case 1: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 0; yield true; }</span>
<span class="udiff-line-modified-added">+                 case 2: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 1; yield true; }</span>
                  case 3, 4:
                      try {
                          new ExpressionSwitchEmbedding().throwException();
                      } catch (Throwable t) {
                          i--;
                          if (i == 2 || i == 4) {
                              try {
<span class="udiff-line-modified-removed">-                                 break switch (i) {</span>
<span class="udiff-line-modified-added">+                                 yield switch (i) {</span>
                                      case 2 -&gt; throw new ResultException(true);
                                      case 4 -&gt; false;
                                      default -&gt; throw new IllegalStateException();
                                  };
                              } catch (ResultException ex) {
<span class="udiff-line-modified-removed">-                                 break ex.result;</span>
<span class="udiff-line-modified-added">+                                 yield ex.result;</span>
                              }
                          } else {
<span class="udiff-line-modified-removed">-                             break true;</span>
<span class="udiff-line-modified-added">+                             yield true;</span>
                          }
                      }
                  default:
                      try {
                          new ExpressionSwitchEmbedding().throwException();
                      } catch (Throwable t) {
                          i--;
<span class="udiff-line-modified-removed">-                         break switch (i) {</span>
<span class="udiff-line-modified-added">+                         yield switch (i) {</span>
                              case -1 -&gt; false;
                              case 3 -&gt; true;
                              default -&gt; true;
                          };
                      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -253,23 +253,23 @@</span>
              int i = 6;
              int o = 0;
              do {
                  o++;
              } while (switch (i) {
<span class="udiff-line-modified-removed">-                 case 1: i = 0; break true;</span>
<span class="udiff-line-modified-removed">-                 case 2: i = 1; break true;</span>
<span class="udiff-line-modified-added">+                 case 1: i = 0; yield true;</span>
<span class="udiff-line-modified-added">+                 case 2: i = 1; yield true;</span>
                  case 3, 4: i--;
                      if (i == 2 || i == 4) {
<span class="udiff-line-modified-removed">-                         break switch (i) {</span>
<span class="udiff-line-modified-added">+                         yield switch (i) {</span>
                              case 2 -&gt; true;
                              case 4 -&gt; false;
                              default -&gt; throw new IllegalStateException();
                          };
                      } else {
<span class="udiff-line-modified-removed">-                         break true;</span>
<span class="udiff-line-modified-added">+                         yield true;</span>
                      }
<span class="udiff-line-modified-removed">-                 default: i--; break switch (i) {</span>
<span class="udiff-line-modified-added">+                 default: i--; yield switch (i) {</span>
                      case -1 -&gt; false;
                      case 3 -&gt; true;
                      default -&gt; true;
                  };
              });
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -281,37 +281,37 @@</span>
              int i = 6;
              int o = 0;
              do {
                  o++;
              } while (switch (i) {
<span class="udiff-line-modified-removed">-                 case 1: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 0; break true; }</span>
<span class="udiff-line-modified-removed">-                 case 2: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 1; break true; }</span>
<span class="udiff-line-modified-added">+                 case 1: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 0; yield true; }</span>
<span class="udiff-line-modified-added">+                 case 2: try { new ExpressionSwitchEmbedding().throwException(); } catch (Throwable t) { i = 1; yield true; }</span>
                  case 3, 4:
                      try {
                          new ExpressionSwitchEmbedding().throwException();
                      } catch (Throwable t) {
                          i--;
                          if (i == 2 || i == 4) {
                              try {
<span class="udiff-line-modified-removed">-                                 break switch (i) {</span>
<span class="udiff-line-modified-added">+                                 yield switch (i) {</span>
                                      case 2 -&gt; throw new ResultException(true);
                                      case 4 -&gt; false;
                                      default -&gt; throw new IllegalStateException();
                                  };
                              } catch (ResultException ex) {
<span class="udiff-line-modified-removed">-                                 break ex.result;</span>
<span class="udiff-line-modified-added">+                                 yield ex.result;</span>
                              }
                          } else {
<span class="udiff-line-modified-removed">-                             break true;</span>
<span class="udiff-line-modified-added">+                             yield true;</span>
                          }
                      }
                  default:
                      try {
                          new ExpressionSwitchEmbedding().throwException();
                      } catch (Throwable t) {
                          i--;
<span class="udiff-line-modified-removed">-                         break switch (i) {</span>
<span class="udiff-line-modified-added">+                         yield switch (i) {</span>
                              case -1 -&gt; false;
                              case 3 -&gt; true;
                              default -&gt; true;
                          };
                      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -319,10 +319,17 @@</span>
              });
              if (o != 6 &amp;&amp; i &gt;= 0) {
                  throw new IllegalStateException();
              }
          }
<span class="udiff-line-added">+         {</span>
<span class="udiff-line-added">+             String s = &quot;&quot;;</span>
<span class="udiff-line-added">+             Object o = switch (s) { default -&gt; s != null &amp;&amp; s == s; };</span>
<span class="udiff-line-added">+             if (!(Boolean) o) {</span>
<span class="udiff-line-added">+                 throw new IllegalStateException();</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
      }
  
      private void throwException() {
          throw new RuntimeException();
      }
</pre>
<center><a href="ExpressionSwitchDA.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ExpressionSwitchFallThrough.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>