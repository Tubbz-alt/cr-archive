<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/switchexpr/ExpressionSwitch.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="ExpressionSwitch-old.out.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ExpressionSwitchBreaks1.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/switchexpr/ExpressionSwitch.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
  2  * @test /nodynamiccopyright/
<span class="line-modified">  3  * @bug 8206986</span>
  4  * @summary Check expression switch works.
  5  * @compile/fail/ref=ExpressionSwitch-old.out -source 9 -Xlint:-options -XDrawDiagnostics ExpressionSwitch.java
<span class="line-modified">  6  * @compile --enable-preview -source ${jdk.version} ExpressionSwitch.java</span>
<span class="line-modified">  7  * @run main/othervm --enable-preview ExpressionSwitch</span>
  8  */
  9 
 10 import java.util.Objects;
 11 import java.util.function.Supplier;
 12 
 13 public class ExpressionSwitch {
 14     public static void main(String... args) {
 15         new ExpressionSwitch().run();
 16     }
 17 
 18     private void run() {
 19         check(T.A, &quot;A&quot;);
 20         check(T.B, &quot;B&quot;);
 21         check(T.C, &quot;other&quot;);
 22         assertEquals(exhaustive1(T.C), &quot;C&quot;);
 23         assertEquals(scopesIsolated(T.B), &quot;B&quot;);
 24         assertEquals(lambdas1(T.B).get(), &quot;B&quot;);
 25         assertEquals(lambdas2(T.B).get(), &quot;B&quot;);
 26         assertEquals(convert1(&quot;A&quot;), 0);
 27         assertEquals(convert1(&quot;B&quot;), 0);
 28         assertEquals(convert1(&quot;C&quot;), 1);
 29         assertEquals(convert1(&quot;&quot;), -1);

 30         assertEquals(convert2(&quot;A&quot;), 0);
 31         assertEquals(convert2(&quot;B&quot;), 0);
 32         assertEquals(convert2(&quot;C&quot;), 1);
 33         assertEquals(convert2(&quot;&quot;), -1);
 34         localClass(T.A);

 35     }
 36 
 37     private String print(T t) {
 38         return switch (t) {
 39             case A -&gt; &quot;A&quot;;
<span class="line-modified"> 40             case B -&gt; { break &quot;B&quot;; }</span>
<span class="line-modified"> 41             default -&gt; { break &quot;other&quot;; }</span>
 42         };
 43     }
 44 
 45     private String exhaustive1(T t) {
 46         return switch (t) {
 47             case A -&gt; &quot;A&quot;;
<span class="line-modified"> 48             case B -&gt; { break &quot;B&quot;; }</span>
 49             case C -&gt; &quot;C&quot;;
 50             case D -&gt; &quot;D&quot;;
 51         };
 52     }
 53 
 54     private String exhaustive2(T t) {
 55         return switch (t) {
 56             case A -&gt; &quot;A&quot;;
 57             case B -&gt; &quot;B&quot;;
 58             case C -&gt; &quot;C&quot;;
 59             case D -&gt; &quot;D&quot;;
 60         };
 61     }
 62 
 63     private String scopesIsolated(T t) {
 64         return switch (t) {
<span class="line-modified"> 65             case A -&gt; { String res = &quot;A&quot;; break res;}</span>
<span class="line-modified"> 66             case B -&gt; { String res = &quot;B&quot;; break res;}</span>
<span class="line-modified"> 67             default -&gt; { String res = &quot;default&quot;; break res;}</span>
 68         };
 69     }
 70 
 71     private Supplier&lt;String&gt; lambdas1(T t) {
 72         return switch (t) {
 73             case A -&gt; () -&gt; &quot;A&quot;;
<span class="line-modified"> 74             case B -&gt; { break () -&gt; &quot;B&quot;; }</span>
 75             default -&gt; () -&gt; &quot;default&quot;;
 76         };
 77     }
 78 
 79     private Supplier&lt;String&gt; lambdas2(T t) {
 80         return switch (t) {
<span class="line-modified"> 81             case A: break () -&gt; &quot;A&quot;;</span>
<span class="line-modified"> 82             case B: { break () -&gt; &quot;B&quot;; }</span>
<span class="line-modified"> 83             default: break () -&gt; &quot;default&quot;;</span>
 84         };
 85     }
 86 
 87     private int convert1(String s) {
<span class="line-modified"> 88         return switch (s) {</span>
<span class="line-modified"> 89             case &quot;A&quot;, &quot;B&quot; -&gt; 0;</span>
<span class="line-modified"> 90             case &quot;C&quot; -&gt; { break 1; }</span>
<span class="line-modified"> 91             default -&gt; -1;</span>
<span class="line-modified"> 92         };</span>


 93     }
 94 
 95     private int convert2(String s) {
 96         return switch (s) {
<span class="line-modified"> 97             case &quot;A&quot;, &quot;B&quot;: break 0;</span>
<span class="line-modified"> 98             case &quot;C&quot;: break 1;</span>
<span class="line-modified"> 99             default: break -1;</span>
100         };
101     }
102 
103     private void localClass(T t) {
104         String good = &quot;good&quot;;
105         class L {
106             public String c() {
107                 STOP: switch (t) {
108                     default: break STOP;
109                 }
110                 return switch (t) {
<span class="line-modified">111                     default: break good;</span>
112                 };
113             }
114         }
115         String result = new L().c();
116         if (!Objects.equals(result, good)) {
117             throw new AssertionError(&quot;Unexpected result: &quot; + result);
118         }
119     }
120 







121     private void check(T t, String expected) {
122         String result = print(t);
123         assertEquals(result, expected);
124     }
125 
126     private void assertEquals(Object result, Object expected) {
127         if (!Objects.equals(result, expected)) {
128             throw new AssertionError(&quot;Unexpected result: &quot; + result);
129         }
130     }
131 
132     enum T {
133         A, B, C, D;
134     }
135     void t() {
136         Runnable r = () -&gt; {};
137         r.run();
138     }
139 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
  2  * @test /nodynamiccopyright/
<span class="line-modified">  3  * @bug 8206986 8222169 8224031</span>
  4  * @summary Check expression switch works.
  5  * @compile/fail/ref=ExpressionSwitch-old.out -source 9 -Xlint:-options -XDrawDiagnostics ExpressionSwitch.java
<span class="line-modified">  6  * @compile ExpressionSwitch.java</span>
<span class="line-modified">  7  * @run main ExpressionSwitch</span>
  8  */
  9 
 10 import java.util.Objects;
 11 import java.util.function.Supplier;
 12 
 13 public class ExpressionSwitch {
 14     public static void main(String... args) {
 15         new ExpressionSwitch().run();
 16     }
 17 
 18     private void run() {
 19         check(T.A, &quot;A&quot;);
 20         check(T.B, &quot;B&quot;);
 21         check(T.C, &quot;other&quot;);
 22         assertEquals(exhaustive1(T.C), &quot;C&quot;);
 23         assertEquals(scopesIsolated(T.B), &quot;B&quot;);
 24         assertEquals(lambdas1(T.B).get(), &quot;B&quot;);
 25         assertEquals(lambdas2(T.B).get(), &quot;B&quot;);
 26         assertEquals(convert1(&quot;A&quot;), 0);
 27         assertEquals(convert1(&quot;B&quot;), 0);
 28         assertEquals(convert1(&quot;C&quot;), 1);
 29         assertEquals(convert1(&quot;&quot;), -1);
<span class="line-added"> 30         assertEquals(convert1(null), -2);</span>
 31         assertEquals(convert2(&quot;A&quot;), 0);
 32         assertEquals(convert2(&quot;B&quot;), 0);
 33         assertEquals(convert2(&quot;C&quot;), 1);
 34         assertEquals(convert2(&quot;&quot;), -1);
 35         localClass(T.A);
<span class="line-added"> 36         assertEquals(castSwitchExpressions(T.A), &quot;A&quot;);</span>
 37     }
 38 
 39     private String print(T t) {
 40         return switch (t) {
 41             case A -&gt; &quot;A&quot;;
<span class="line-modified"> 42             case B -&gt; { yield &quot;B&quot;; }</span>
<span class="line-modified"> 43             default -&gt; { yield &quot;other&quot;; }</span>
 44         };
 45     }
 46 
 47     private String exhaustive1(T t) {
 48         return switch (t) {
 49             case A -&gt; &quot;A&quot;;
<span class="line-modified"> 50             case B -&gt; { yield &quot;B&quot;; }</span>
 51             case C -&gt; &quot;C&quot;;
 52             case D -&gt; &quot;D&quot;;
 53         };
 54     }
 55 
 56     private String exhaustive2(T t) {
 57         return switch (t) {
 58             case A -&gt; &quot;A&quot;;
 59             case B -&gt; &quot;B&quot;;
 60             case C -&gt; &quot;C&quot;;
 61             case D -&gt; &quot;D&quot;;
 62         };
 63     }
 64 
 65     private String scopesIsolated(T t) {
 66         return switch (t) {
<span class="line-modified"> 67             case A -&gt; { String res = &quot;A&quot;; yield res;}</span>
<span class="line-modified"> 68             case B -&gt; { String res = &quot;B&quot;; yield res;}</span>
<span class="line-modified"> 69             default -&gt; { String res = &quot;default&quot;; yield res;}</span>
 70         };
 71     }
 72 
 73     private Supplier&lt;String&gt; lambdas1(T t) {
 74         return switch (t) {
 75             case A -&gt; () -&gt; &quot;A&quot;;
<span class="line-modified"> 76             case B -&gt; { yield () -&gt; &quot;B&quot;; }</span>
 77             default -&gt; () -&gt; &quot;default&quot;;
 78         };
 79     }
 80 
 81     private Supplier&lt;String&gt; lambdas2(T t) {
 82         return switch (t) {
<span class="line-modified"> 83             case A: yield () -&gt; &quot;A&quot;;</span>
<span class="line-modified"> 84             case B: { yield () -&gt; &quot;B&quot;; }</span>
<span class="line-modified"> 85             default: yield () -&gt; &quot;default&quot;;</span>
 86         };
 87     }
 88 
 89     private int convert1(String s) {
<span class="line-modified"> 90         return s == null</span>
<span class="line-modified"> 91                 ? -2</span>
<span class="line-modified"> 92                 : switch (s) {</span>
<span class="line-modified"> 93                       case &quot;A&quot;, &quot;B&quot; -&gt; 0;</span>
<span class="line-modified"> 94                       case &quot;C&quot; -&gt; { yield 1; }</span>
<span class="line-added"> 95                       default -&gt; -1;</span>
<span class="line-added"> 96                   };</span>
 97     }
 98 
 99     private int convert2(String s) {
100         return switch (s) {
<span class="line-modified">101             case &quot;A&quot;, &quot;B&quot;: yield 0;</span>
<span class="line-modified">102             case &quot;C&quot;: yield 1;</span>
<span class="line-modified">103             default: yield -1;</span>
104         };
105     }
106 
107     private void localClass(T t) {
108         String good = &quot;good&quot;;
109         class L {
110             public String c() {
111                 STOP: switch (t) {
112                     default: break STOP;
113                 }
114                 return switch (t) {
<span class="line-modified">115                     default: yield good;</span>
116                 };
117             }
118         }
119         String result = new L().c();
120         if (!Objects.equals(result, good)) {
121             throw new AssertionError(&quot;Unexpected result: &quot; + result);
122         }
123     }
124 
<span class="line-added">125     private String castSwitchExpressions(T t) {</span>
<span class="line-added">126         return (String) switch (t) {</span>
<span class="line-added">127             case A -&gt; &quot;A&quot;;</span>
<span class="line-added">128             default -&gt; 1;</span>
<span class="line-added">129         };</span>
<span class="line-added">130     }</span>
<span class="line-added">131 </span>
132     private void check(T t, String expected) {
133         String result = print(t);
134         assertEquals(result, expected);
135     }
136 
137     private void assertEquals(Object result, Object expected) {
138         if (!Objects.equals(result, expected)) {
139             throw new AssertionError(&quot;Unexpected result: &quot; + result);
140         }
141     }
142 
143     enum T {
144         A, B, C, D;
145     }
146     void t() {
147         Runnable r = () -&gt; {};
148         r.run();
149     }
150 }
</pre>
</td>
</tr>
</table>
<center><a href="ExpressionSwitch-old.out.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ExpressionSwitchBreaks1.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>