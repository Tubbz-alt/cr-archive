<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/langtools/tools/javac/switchexpr/DefiniteAssignment1.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="CRT.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="DefiniteAssignment2.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/switchexpr/DefiniteAssignment1.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -21,26 +21,26 @@</span>
   * questions.
   */
  
  /**
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8214031</span>
<span class="udiff-line-modified-added">+  * @bug 8214031 8221413</span>
   * @summary Verify that definite assignment when true works (legal code)
<span class="udiff-line-modified-removed">-  * @compile --enable-preview --source ${jdk.version} DefiniteAssignment1.java</span>
<span class="udiff-line-modified-removed">-  * @run main/othervm --enable-preview DefiniteAssignment1</span>
<span class="udiff-line-modified-added">+  * @compile DefiniteAssignment1.java</span>
<span class="udiff-line-modified-added">+  * @run main DefiniteAssignment1</span>
   */
  public class DefiniteAssignment1 {
      public static void main(String[] args) {
          int a = 0;
          boolean b = true;
  
          {
          int x;
  
          boolean t1 = (b &amp;&amp; switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t1) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -48,12 +48,12 @@</span>
  
          {
          int x;
  
          boolean t1 = (b &amp;&amp; switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t1) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -61,12 +61,12 @@</span>
  
          {
          int x;
  
          boolean t1a = (b &amp;&amp; switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t1a) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -74,12 +74,12 @@</span>
  
          {
          int x;
  
          boolean t1b = (switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t1b) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -87,12 +87,12 @@</span>
  
          {
          int x;
  
          boolean t2 = !(b &amp;&amp; switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) || x == 1;
  
          if (!t2) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -100,12 +100,12 @@</span>
  
          {
          int x;
  
          boolean t2 = !(b &amp;&amp; switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) || x == 1;
  
          if (!t2) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -113,12 +113,12 @@</span>
  
          {
          int x;
  
          boolean t3 = !(switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) || x == 2;
  
          if (t3) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -126,12 +126,12 @@</span>
  
          {
          int x;
  
          boolean t3 = !(switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) || x == 2;
  
          if (t3) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -139,11 +139,11 @@</span>
  
          {
          int x;
  
          boolean t4 = (b &amp;&amp; switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1 || true;</span>
              default: throw new IllegalStateException();
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t4) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -153,11 +153,11 @@</span>
  
          {
          int x;
  
          boolean t4 = (b &amp;&amp; switch(a) {
<span class="udiff-line-modified-removed">-             case 0: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             case 0: yield (x = 1) == 1 || isTrue();</span>
              default: throw new IllegalStateException();
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t4) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -168,12 +168,12 @@</span>
          int x;
  
          String s = &quot;a&quot;;
  
          boolean t5 = (switch(s) {
<span class="udiff-line-modified-removed">-             case &quot;a&quot;: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case &quot;a&quot;: yield (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t5) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -183,12 +183,12 @@</span>
          int x;
  
          String s = &quot;a&quot;;
  
          boolean t5 = (switch(s) {
<span class="udiff-line-modified-removed">-             case &quot;a&quot;: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case &quot;a&quot;: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t5) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -197,12 +197,12 @@</span>
          {
          int x;
          E e = E.B;
  
          boolean t6 = (switch(e) {
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t6) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -211,12 +211,12 @@</span>
          {
          int x;
          E e = E.B;
  
          boolean t6 = (switch(e) {
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t6) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -249,13 +249,13 @@</span>
          {
          int x;
          E e = E.B;
  
          boolean t8 = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: x = 1; break true;</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: x = 1; yield true;</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t8) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -264,13 +264,13 @@</span>
          {
          int x;
          E e = E.B;
  
          boolean t8 = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: x = 1; break isTrue();</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: x = 1; yield isTrue();</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t8) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -279,13 +279,13 @@</span>
          {
          int x;
          E e = E.A;
  
          boolean t9 = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: x = 1; break true;</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: x = 1; yield true;</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t9) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -294,13 +294,13 @@</span>
          {
          int x;
          E e = E.A;
  
          boolean t9 = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: x = 1; break isTrue();</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: x = 1; yield isTrue();</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!t9) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -309,13 +309,13 @@</span>
          {
          int x;
          E e = E.C;
  
          boolean tA = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: x = 1; break true;</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: x = 1; yield true;</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (tA) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -324,13 +324,13 @@</span>
          {
          int x;
          E e = E.C;
  
          boolean tA = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: x = 1; break isTrue();</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: x = 1; yield isTrue();</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (tA) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -339,13 +339,13 @@</span>
          {
          final int x;
          E e = E.C;
  
          boolean tA = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: x = 1; break true;</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 2) == 2 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: x = 1; yield true;</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 2) == 2 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) || (x = 3) == 3; //x is definitelly unassigned here
  
          if (x != 3) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -354,13 +354,13 @@</span>
          {
          int x;
          E e = E.A;
  
          boolean tA = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: break isTrue() &amp;&amp; (x = 1) == 1;</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: yield isTrue() &amp;&amp; (x = 1) == 1;</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!tA) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -369,13 +369,13 @@</span>
          {
          int x;
          E e = E.A;
  
          boolean tA = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: break isTrue() &amp;&amp; e != E.C ? (x = 1) == 1 &amp;&amp; e != E.B : false;</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: yield isTrue() &amp;&amp; e != E.C ? (x = 1) == 1 &amp;&amp; e != E.B : false;</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || true;</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!tA) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -384,13 +384,43 @@</span>
          {
          int x;
          E e = E.A;
  
          boolean tA = (switch(e) {
<span class="udiff-line-modified-removed">-             case A: break isTrue() &amp;&amp; e != E.C ? (x = 1) == 1 &amp;&amp; e != E.B : false;</span>
<span class="udiff-line-modified-removed">-             case B: break (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-removed">-             default: break false;</span>
<span class="udiff-line-modified-added">+             case A: yield isTrue() &amp;&amp; e != E.C ? (x = 1) == 1 &amp;&amp; e != E.B : false;</span>
<span class="udiff-line-modified-added">+             case B: yield (x = 1) == 1 || isTrue();</span>
<span class="udiff-line-modified-added">+             default: yield false;</span>
<span class="udiff-line-added">+         }) &amp;&amp; x == 1; //x is definitelly assigned here</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (!tA) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException(&quot;Unexpected result.&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         { //JDK-8221413: definite assignment for implicit default in switch expressions</span>
<span class="udiff-line-added">+         int x;</span>
<span class="udiff-line-added">+         E e = E.A;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         int v = (switch(e) {</span>
<span class="udiff-line-added">+             case A -&gt; x = 0;</span>
<span class="udiff-line-added">+             case B -&gt; x = 0;</span>
<span class="udiff-line-added">+             case C -&gt; x = 0;</span>
<span class="udiff-line-added">+         });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (x != 0 || v != 0) {</span>
<span class="udiff-line-added">+             throw new IllegalStateException(&quot;Unexpected result.&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         { //JDK-8221413: definite assignment for implicit default in switch expressions</span>
<span class="udiff-line-added">+         int x;</span>
<span class="udiff-line-added">+         E e = E.A;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         boolean tA = (switch(e) {</span>
<span class="udiff-line-added">+             case A -&gt; { x = 1; yield true; }</span>
<span class="udiff-line-added">+             case B -&gt; { x = 1; yield true; }</span>
<span class="udiff-line-added">+             case C -&gt; { x = 1; yield true; }</span>
          }) &amp;&amp; x == 1; //x is definitelly assigned here
  
          if (!tA) {
              throw new IllegalStateException(&quot;Unexpected result.&quot;);
          }
</pre>
<center><a href="CRT.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="DefiniteAssignment2.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>