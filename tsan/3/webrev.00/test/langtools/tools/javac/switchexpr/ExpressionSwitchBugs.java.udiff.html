<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/langtools/tools/javac/switchexpr/ExpressionSwitchBugs.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="ExpressionSwitchBreaks2.out.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ExpressionSwitchBugsInGen.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/switchexpr/ExpressionSwitchBugs.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -23,60 +23,62 @@</span>
  
  /*
   * @test
   * @bug 8206986 8214114 8214529
   * @summary Verify various corner cases with nested switch expressions.
<span class="udiff-line-modified-removed">-  * @compile --enable-preview -source ${jdk.version} ExpressionSwitchBugs.java</span>
<span class="udiff-line-modified-removed">-  * @run main/othervm --enable-preview ExpressionSwitchBugs</span>
<span class="udiff-line-modified-added">+  * @compile ExpressionSwitchBugs.java</span>
<span class="udiff-line-modified-added">+  * @run main ExpressionSwitchBugs</span>
   */
  
  public class ExpressionSwitchBugs {
      public static void main(String... args) {
          new ExpressionSwitchBugs().testNested();
          new ExpressionSwitchBugs().testAnonymousClasses();
          new ExpressionSwitchBugs().testFields();
<span class="udiff-line-added">+         check(3, new C(-1, 3).test(false));</span>
<span class="udiff-line-added">+         check(3, new C(3, -1).test(true));</span>
      }
  
      private void testNested() {
          int i = 0;
          check(42, id(switch (42) {
<span class="udiff-line-modified-removed">-             default: i++; break 42;</span>
<span class="udiff-line-modified-added">+             default: i++; yield 42;</span>
          }));
          i = 0;
          check(43, id(switch (42) {
              case 42: while (i == 0) {
                  i++;
              }
<span class="udiff-line-modified-removed">-             break 42 + i;</span>
<span class="udiff-line-modified-removed">-             default: i++; break 42;</span>
<span class="udiff-line-modified-added">+             yield 42 + i;</span>
<span class="udiff-line-modified-added">+             default: i++; yield 42;</span>
          }));
          i = 0;
          check(42, id(switch (42) {
              case 42: if (i == 0) {
<span class="udiff-line-modified-removed">-                 break 42;</span>
<span class="udiff-line-modified-added">+                 yield 42;</span>
              }
<span class="udiff-line-modified-removed">-             default: i++; break 43;</span>
<span class="udiff-line-modified-added">+             default: i++; yield 43;</span>
          }));
          i = 0;
          check(42, id(switch (42) {
              case 42: if (i == 0) {
<span class="udiff-line-modified-removed">-                 break 41 + switch (0) {</span>
<span class="udiff-line-modified-added">+                 yield 41 + switch (0) {</span>
                      case 0 -&gt; 1;
                      default -&gt; -1;
                  };
              }
<span class="udiff-line-modified-removed">-             default: i++; break 43;</span>
<span class="udiff-line-modified-added">+             default: i++; yield 43;</span>
          }));
      }
  
      private void testAnonymousClasses() {
          for (int i : new int[] {1, 2}) {
              check(3, id((switch (i) {
<span class="udiff-line-modified-removed">-                 case 1: break new I() {</span>
<span class="udiff-line-modified-added">+                 case 1: yield new I() {</span>
                      public int g() { return 3; }
                  };
<span class="udiff-line-modified-removed">-                 default: break (I) () -&gt; { return 3; };</span>
<span class="udiff-line-modified-added">+                 default: yield (I) () -&gt; { return 3; };</span>
              }).g()));
              check(3, id((switch (i) {
                  case 1 -&gt; new I() {
                      public int g() { return 3; }
                  };
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -94,22 +96,22 @@</span>
      private final int field = id(switch(value) {
          case 0 -&gt; -1;
          case 2 -&gt; {
              int temp = 0;
              temp += 3;
<span class="udiff-line-modified-removed">-             break temp;</span>
<span class="udiff-line-modified-added">+             yield temp;</span>
          }
          default -&gt; throw new IllegalStateException();
      });
  
      private static final int staticValue = 2;
      private static final int staticField = new ExpressionSwitchBugs().id(switch(staticValue) {
          case 0 -&gt; -1;
          case 2 -&gt; {
              int temp = 0;
              temp += 3;
<span class="udiff-line-modified-removed">-             break temp;</span>
<span class="udiff-line-modified-added">+             yield temp;</span>
          }
          default -&gt; throw new IllegalStateException();
      });
  
      private int id(int i) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -118,15 +120,43 @@</span>
  
      private int id(Object o) {
          return -1;
      }
  
<span class="udiff-line-modified-removed">-     private void check(int actual, int expected) {</span>
<span class="udiff-line-modified-added">+     private static void check(int actual, int expected) {</span>
          if (actual != expected) {
              throw new AssertionError(&quot;Unexpected result: &quot; + actual);
          }
      }
  
      public interface I {
          public int g();
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static class Super {</span>
<span class="udiff-line-added">+         public final int i;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public Super(int i) {</span>
<span class="udiff-line-added">+             this.i = i;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     static class C extends Super {</span>
<span class="udiff-line-added">+         public final int i;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public C(int superI, int i) {</span>
<span class="udiff-line-added">+             super(superI);</span>
<span class="udiff-line-added">+             this.i = i;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         public int test(boolean fromSuper) {</span>
<span class="udiff-line-added">+             return switch (fromSuper ? 0 : 1) {</span>
<span class="udiff-line-added">+                 case 0 -&gt; {</span>
<span class="udiff-line-added">+                     yield super.i;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 default -&gt; {</span>
<span class="udiff-line-added">+                     yield this.i;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             };</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
  }
</pre>
<center><a href="ExpressionSwitchBreaks2.out.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ExpressionSwitchBugsInGen.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>