<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/langtools/tools/javac/switchexpr/SwitchExpressionSimpleVisitorTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="SwitchExpressionScopesIsolated.out.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TryCatch.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/switchexpr/SwitchExpressionSimpleVisitorTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -36,10 +36,11 @@</span>
  
  import javax.tools.*;
  
  import com.sun.source.tree.CompilationUnitTree;
  import com.sun.source.tree.SwitchExpressionTree;
<span class="udiff-line-added">+ import com.sun.source.tree.YieldTree;</span>
  import com.sun.source.tree.Tree;
  import com.sun.source.util.JavacTask;
  import com.sun.source.util.SimpleTreeVisitor;
  import com.sun.source.util.TreePathScanner;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -51,16 +52,17 @@</span>
  
      void run() throws Exception {
          String code = &quot;class Test {\n&quot; +
                        &quot;    int t(int i) {\n&quot; +
                        &quot;         return switch(i) {\n&quot; +
<span class="udiff-line-modified-removed">-                       &quot;              default: break -1;\n&quot; +</span>
<span class="udiff-line-modified-added">+                       &quot;              default: yield -1;\n&quot; +</span>
                        &quot;         }\n&quot; +
                        &quot;    }\n&quot; +
                        &quot;}\n&quot;;
          int[] callCount = new int[1];
          int[] switchExprNodeCount = new int[1];
<span class="udiff-line-added">+         int[] yieldNodeCount = new int[1];</span>
          new TreePathScanner&lt;Void, Void&gt;() {
              @Override
              public Void visitSwitchExpression(SwitchExpressionTree node, Void p) {
                  node.accept(new SimpleTreeVisitor&lt;Void, Void&gt;() {
                      @Override
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -72,26 +74,42 @@</span>
                          return null;
                      }
                  }, null);
                  return super.visitSwitchExpression(node, p);
              }
<span class="udiff-line-added">+             @Override</span>
<span class="udiff-line-added">+             public Void visitYield(YieldTree node, Void p) {</span>
<span class="udiff-line-added">+                 node.accept(new SimpleTreeVisitor&lt;Void, Void&gt;() {</span>
<span class="udiff-line-added">+                     @Override</span>
<span class="udiff-line-added">+                     protected Void defaultAction(Tree defaultActionNode, Void p) {</span>
<span class="udiff-line-added">+                         callCount[0]++;</span>
<span class="udiff-line-added">+                         if (node == defaultActionNode) {</span>
<span class="udiff-line-added">+                             yieldNodeCount[0]++;</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                         return null;</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                 }, null);</span>
<span class="udiff-line-added">+                 return super.visitYield(node, p);</span>
<span class="udiff-line-added">+             }</span>
          }.scan(parse(code), null);
  
<span class="udiff-line-modified-removed">-         if (callCount[0] != 1 || switchExprNodeCount[0] != 1) {</span>
<span class="udiff-line-modified-added">+         if (callCount[0] != 2 || switchExprNodeCount[0] != 1 ||</span>
<span class="udiff-line-added">+             yieldNodeCount[0] != 1) {</span>
              throw new AssertionError(&quot;Unexpected counts; callCount=&quot; + callCount[0] +
<span class="udiff-line-modified-removed">-                                      &quot;, switchExprNodeCount=&quot; + switchExprNodeCount[0]);</span>
<span class="udiff-line-modified-added">+                                      &quot;, switchExprNodeCount=&quot; + switchExprNodeCount[0] +</span>
<span class="udiff-line-added">+                                      &quot;, yieldNodeCount=&quot; + yieldNodeCount[0]);</span>
          }
      }
  
      private CompilationUnitTree parse(String code) throws IOException {
          final JavaCompiler tool = ToolProvider.getSystemJavaCompiler();
          assert tool != null;
          DiagnosticListener&lt;JavaFileObject&gt; noErrors = d -&gt; {};
  
          StringWriter out = new StringWriter();
          JavacTask ct = (JavacTask) tool.getTask(out, null, noErrors,
<span class="udiff-line-modified-removed">-             List.of(&quot;--enable-preview&quot;, &quot;-source&quot;, Integer.toString(Runtime.version().feature())), null,</span>
<span class="udiff-line-modified-added">+             List.of(), null,</span>
              Arrays.asList(new MyFileObject(code)));
          return ct.parse().iterator().next();
      }
  
      static class MyFileObject extends SimpleJavaFileObject {
</pre>
<center><a href="SwitchExpressionScopesIsolated.out.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TryCatch.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>