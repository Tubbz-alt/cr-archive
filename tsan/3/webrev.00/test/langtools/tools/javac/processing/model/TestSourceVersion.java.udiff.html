<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/langtools/tools/javac/processing/model/TestSourceVersion.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../messager/6388543/T6388543.out.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestSymtabItems.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/processing/model/TestSourceVersion.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,41 +21,45 @@</span>
   * questions.
   */
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  * @bug 7025809 8028543 6415644 8028544 8029942 8187951 8193291 8196551</span>
<span class="udiff-line-modified-added">+  * @bug 7025809 8028543 6415644 8028544 8029942 8187951 8193291 8196551 8233096</span>
   * @summary Test latest, latestSupported, underscore as keyword, etc.
   * @author  Joseph D. Darcy
   * @modules java.compiler
   *          jdk.compiler
   */
  
  import java.util.*;
<span class="udiff-line-added">+ import java.util.function.Predicate;</span>
  import javax.lang.model.SourceVersion;
  import static javax.lang.model.SourceVersion.*;
  
  /**
<span class="udiff-line-modified-removed">-  * Verify latest[Supported] behavior.</span>
<span class="udiff-line-modified-added">+  * Verify behavior of latest[Supported] and other methods.</span>
   */
  public class TestSourceVersion {
      public static void main(String... args) {
          testLatestSupported();
          testVersionVaryingKeywords();
          testRestrictedKeywords();
          testVar();
<span class="udiff-line-added">+         testYield();</span>
      }
  
      private static void testLatestSupported() {
          SourceVersion[] values = SourceVersion.values();
          SourceVersion last = values[values.length - 1];
          SourceVersion latest = SourceVersion.latest();
          SourceVersion latestSupported = SourceVersion.latestSupported();
  
          if (latest == last &amp;&amp;
<span class="udiff-line-modified-removed">-             latestSupported == SourceVersion.valueOf(&quot;RELEASE_&quot; + Runtime.version().feature()) &amp;&amp;</span>
<span class="udiff-line-modified-removed">-             (latest == latestSupported || (latest.ordinal() - latestSupported.ordinal() == 1)) )</span>
<span class="udiff-line-modified-added">+             latestSupported == SourceVersion.valueOf(&quot;RELEASE_&quot; +</span>
<span class="udiff-line-modified-added">+                                                      Runtime.version().feature()) &amp;&amp;</span>
<span class="udiff-line-added">+             (latest == latestSupported ||</span>
<span class="udiff-line-added">+              (latest.ordinal() - latestSupported.ordinal() == 1)) )</span>
              return;
          else {
              throw new RuntimeException(&quot;Unexpected release value(s) found:\n&quot; +
                                         &quot;latest:\t&quot; + latest + &quot;\n&quot; +
                                         &quot;latestSupported:\t&quot; + latestSupported);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -71,18 +75,18 @@</span>
  
          for (Map.Entry&lt;String, SourceVersion&gt; entry : keyWordStart.entrySet()) {
              String key = entry.getKey();
              SourceVersion value = entry.getValue();
  
<span class="udiff-line-modified-removed">-             check(true, isKeyword(key), &quot;keyword&quot;, latest());</span>
<span class="udiff-line-modified-removed">-             check(false, isName(key),   &quot;name&quot;,    latest());</span>
<span class="udiff-line-modified-added">+             check(true,  key, (String s) -&gt; isKeyword(s), &quot;keyword&quot;, latest());</span>
<span class="udiff-line-modified-added">+             check(false, key, (String s) -&gt; isName(s),    &quot;name&quot;,    latest());</span>
  
              for(SourceVersion version : SourceVersion.values()) {
                  boolean isKeyword = version.compareTo(value) &gt;= 0;
  
<span class="udiff-line-modified-removed">-                 check(isKeyword,  isKeyword(key, version), &quot;keyword&quot;, version);</span>
<span class="udiff-line-modified-removed">-                 check(!isKeyword, isName(key, version),    &quot;name&quot;,    version);</span>
<span class="udiff-line-modified-added">+                 check(isKeyword,  key, (String s) -&gt; isKeyword(s, version), &quot;keyword&quot;, version);</span>
<span class="udiff-line-modified-added">+                 check(!isKeyword, key, (String s) -&gt; isName(s, version),    &quot;name&quot;,    version);</span>
              }
          }
      }
  
      private static void testRestrictedKeywords() {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -94,35 +98,53 @@</span>
           * keywords: open, module, requires, transitive, exports,
           * opens, to, uses, provides, and with&quot;
           */
          Set&lt;String&gt; restrictedKeywords =
              Set.of(&quot;open&quot;, &quot;module&quot;, &quot;requires&quot;, &quot;transitive&quot;, &quot;exports&quot;,
<span class="udiff-line-modified-removed">-                    &quot;opens&quot;, &quot;to&quot;, &quot;uses&quot;, &quot;provides&quot;, &quot;with&quot;);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         for(String key : restrictedKeywords) {</span>
<span class="udiff-line-modified-removed">-             for(SourceVersion version : SourceVersion.values()) {</span>
<span class="udiff-line-modified-removed">-                 check(false, isKeyword(key, version), &quot;keyword&quot;, version);</span>
<span class="udiff-line-modified-removed">-                 check(true,  isName(key, version),    &quot;name&quot;,    version);</span>
<span class="udiff-line-modified-added">+                    &quot;opens&quot;, &quot;to&quot;, &quot;uses&quot;, &quot;provides&quot;, &quot;with&quot;,</span>
<span class="udiff-line-modified-added">+                    // Assume &quot;record&quot; will be a restricted keyword.</span>
<span class="udiff-line-modified-added">+                    &quot;record&quot;);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         for (String key : restrictedKeywords) {</span>
<span class="udiff-line-modified-added">+             for (SourceVersion version : SourceVersion.values()) {</span>
<span class="udiff-line-added">+                 check(false, key, (String s) -&gt; isKeyword(s, version), &quot;keyword&quot;, version);</span>
<span class="udiff-line-added">+                 check(true,  key, (String s) -&gt; isName(s, version),    &quot;name&quot;,    version);</span>
              }
          }
      }
  
      private static void testVar() {
<span class="udiff-line-added">+         for (SourceVersion version : SourceVersion.values()) {</span>
<span class="udiff-line-added">+             Predicate&lt;String&gt; isKeywordVersion = (String s) -&gt; isKeyword(s, version);</span>
<span class="udiff-line-added">+             Predicate&lt;String&gt; isNameVersion = (String s) -&gt; isName(s, version);</span>
  
<span class="udiff-line-modified-removed">-         for(SourceVersion version : SourceVersion.values()) {</span>
<span class="udiff-line-modified-removed">-             check(false, isKeyword(&quot;var&quot;,     version), &quot;keyword&quot;, version);</span>
<span class="udiff-line-modified-removed">-             check(false, isKeyword(&quot;foo.var&quot;, version), &quot;keyword&quot;, version);</span>
<span class="udiff-line-modified-removed">-             check(false, isKeyword(&quot;var.foo&quot;, version), &quot;keyword&quot;, version);</span>
<span class="udiff-line-modified-added">+             for (String name : List.of(&quot;var&quot;, &quot;foo.var&quot;, &quot;var.foo&quot;)) {</span>
<span class="udiff-line-modified-added">+                 check(false, name, isKeywordVersion, &quot;keyword&quot;, version);</span>
<span class="udiff-line-modified-added">+                 check(true, name,  isNameVersion, &quot;name&quot;, version);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static void testYield() {</span>
<span class="udiff-line-added">+         for (SourceVersion version : SourceVersion.values()) {</span>
<span class="udiff-line-added">+             Predicate&lt;String&gt; isKeywordVersion = (String s) -&gt; isKeyword(s, version);</span>
<span class="udiff-line-added">+             Predicate&lt;String&gt; isNameVersion = (String s) -&gt; isName(s, version);</span>
  
<span class="udiff-line-modified-removed">-             check(true, isName(&quot;var&quot;, version),     &quot;name&quot;, version);</span>
<span class="udiff-line-modified-removed">-             check(true, isName(&quot;foo.var&quot;, version), &quot;name&quot;, version);</span>
<span class="udiff-line-modified-removed">-             check(true, isName(&quot;var.foo&quot;, version), &quot;name&quot;, version);</span>
<span class="udiff-line-modified-added">+             for  (String name : List.of(&quot;yield&quot;, &quot;foo.yield&quot;, &quot;yield.foo&quot;)) {</span>
<span class="udiff-line-modified-added">+                 check(false, name, isKeywordVersion, &quot;keyword&quot;, version);</span>
<span class="udiff-line-modified-added">+                 check(true, name,  isNameVersion, &quot;name&quot;, version);</span>
<span class="udiff-line-added">+             }</span>
          }
      }
  
<span class="udiff-line-modified-removed">-     private static void check(boolean result, boolean expected,</span>
<span class="udiff-line-modified-removed">-                               String message, SourceVersion version) {</span>
<span class="udiff-line-modified-added">+     private static void check(boolean expected,</span>
<span class="udiff-line-modified-added">+                               String input,</span>
<span class="udiff-line-added">+                               Predicate&lt;String&gt; predicate,</span>
<span class="udiff-line-added">+                               String message,</span>
<span class="udiff-line-added">+                               SourceVersion version) {</span>
<span class="udiff-line-added">+         boolean result  = predicate.test(input);</span>
          if (result != expected) {
<span class="udiff-line-modified-removed">-             throw new RuntimeException(&quot;Unexpected &quot; + message +  &quot;-ness of _ on &quot; + version);</span>
<span class="udiff-line-modified-added">+             throw new RuntimeException(&quot;Unexpected &quot; + message +  &quot;-ness of &quot; + input +</span>
<span class="udiff-line-added">+                                        &quot; on &quot; + version);</span>
          }
      }
  }
</pre>
<center><a href="../messager/6388543/T6388543.out.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestSymtabItems.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>