<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/parser/JavacParserTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../nestmates/CheckNestmateAttrs.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="extend/TrialParser.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/parser/JavacParserTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1066     @Test
1067     void testCaseBodyStatements() throws IOException {
1068         String code = &quot;class C {&quot; +
1069                       &quot;    void t(int i) {&quot; +
1070                       &quot;        switch (i) {&quot; +
1071                       &quot;            case 0 -&gt; i++;&quot; +
1072                       &quot;            case 1 -&gt; { i++; }&quot; +
1073                       &quot;            case 2 -&gt; throw new RuntimeException();&quot; +
1074                       &quot;            case 3 -&gt; if (true) ;&quot; +
1075                       &quot;            default -&gt; i++;&quot; +
1076                       &quot;        }&quot; +
1077                       &quot;        switch (i) {&quot; +
1078                       &quot;            case 0: i++; break;&quot; +
1079                       &quot;            case 1: { i++; break;}&quot; +
1080                       &quot;            case 2: throw new RuntimeException();&quot; +
1081                       &quot;            case 3: if (true) ; break;&quot; +
1082                       &quot;            default: i++; break;&quot; +
1083                       &quot;        }&quot; +
1084                       &quot;        int j = switch (i) {&quot; +
1085                       &quot;            case 0 -&gt; i + 1;&quot; +
<span class="line-modified">1086                       &quot;            case 1 -&gt; { break i + 1; }&quot; +</span>
1087                       &quot;            default -&gt; throw new RuntimeException();&quot; +
1088                       &quot;        };&quot; +
1089                       &quot;        int k = switch (i) {&quot; +
<span class="line-modified">1090                       &quot;            case 0: break i + 1;&quot; +</span>
<span class="line-modified">1091                       &quot;            case 1: { break i + 1; }&quot; +</span>
1092                       &quot;            default: throw new RuntimeException();&quot; +
1093                       &quot;        };&quot; +
1094                       &quot;    }&quot; +
1095                       &quot;}&quot;;
1096         String expectedErrors = &quot;Test.java:1:178: compiler.err.switch.case.unexpected.statement\n&quot;;
1097         StringWriter out = new StringWriter();
1098         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(out, fm, null,
<span class="line-modified">1099                 Arrays.asList(&quot;-XDrawDiagnostics&quot;, &quot;--enable-preview&quot;, &quot;-source&quot;, SOURCE_VERSION),</span>
1100                 null, Arrays.asList(new MyFileObject(code)));
1101 
1102         CompilationUnitTree cut = ct.parse().iterator().next();
1103         Trees trees = Trees.instance(ct);
1104         List&lt;String&gt; spans = new ArrayList&lt;&gt;();
1105 
1106         new TreePathScanner&lt;Void, Void&gt;() {
1107             @Override
1108             public Void visitCase(CaseTree tree, Void v) {
1109                 if (tree.getBody() != null) {
1110                     int start = (int) trees.getSourcePositions().getStartPosition(cut, tree.getBody());
1111                     int end = (int) trees.getSourcePositions().getEndPosition(cut, tree.getBody());
1112                     spans.add(code.substring(start, end));
1113                 } else {
1114                     spans.add(&quot;&lt;null&gt;&quot;);
1115                 }
1116                 return super.visitCase(tree, v);
1117             }
1118         }.scan(cut, null);
1119 
1120         List&lt;String&gt; expectedSpans = List.of(
1121                 &quot;i++;&quot;, &quot;{ i++; }&quot;, &quot;throw new RuntimeException();&quot;, &quot;if (true) ;&quot;, &quot;i++;&quot;,
1122                 &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;,
<span class="line-modified">1123                 &quot;i + 1&quot;/*TODO semicolon?*/, &quot;{ break i + 1; }&quot;, &quot;throw new RuntimeException();&quot;,</span>
1124                 &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;);
1125         assertEquals(&quot;the error spans are not correct; actual:&quot; + spans, expectedSpans, spans);
1126         String toString = normalize(cut.toString());
1127         String expectedToString =
1128                 &quot;\n&quot; +
1129                 &quot;class C {\n&quot; +
1130                 &quot;    \n&quot; +
1131                 &quot;    void t(int i) {\n&quot; +
1132                 &quot;        switch (i) {\n&quot; +
1133                 &quot;        case 0 -&gt; i++;\n&quot; +
1134                 &quot;        case 1 -&gt; {\n&quot; +
1135                 &quot;            i++;\n&quot; +
1136                 &quot;        }\n&quot; +
1137                 &quot;        case 2 -&gt; throw new RuntimeException();\n&quot; +
1138                 &quot;        case 3 -&gt; if (true) ;\n&quot; +
1139                 &quot;        default -&gt; i++;\n&quot; +
1140                 &quot;        }\n&quot; +
1141                 &quot;        switch (i) {\n&quot; +
1142                 &quot;        case 0:\n&quot; +
1143                 &quot;            i++;\n&quot; +
</pre>
<hr />
<pre>
1145                 &quot;        \n&quot; +
1146                 &quot;        case 1:\n&quot; +
1147                 &quot;            {\n&quot; +
1148                 &quot;                i++;\n&quot; +
1149                 &quot;                break;\n&quot; +
1150                 &quot;            }\n&quot; +
1151                 &quot;        \n&quot; +
1152                 &quot;        case 2:\n&quot; +
1153                 &quot;            throw new RuntimeException();\n&quot; +
1154                 &quot;        \n&quot; +
1155                 &quot;        case 3:\n&quot; +
1156                 &quot;            if (true) ;\n&quot; +
1157                 &quot;            break;\n&quot; +
1158                 &quot;        \n&quot; +
1159                 &quot;        default:\n&quot; +
1160                 &quot;            i++;\n&quot; +
1161                 &quot;            break;\n&quot; +
1162                 &quot;        \n&quot; +
1163                 &quot;        }\n&quot; +
1164                 &quot;        int j = switch (i) {\n&quot; +
<span class="line-modified">1165                 &quot;        case 0 -&gt; break i + 1;\n&quot; +</span>
1166                 &quot;        case 1 -&gt; {\n&quot; +
<span class="line-modified">1167                 &quot;            break i + 1;\n&quot; +</span>
1168                 &quot;        }\n&quot; +
1169                 &quot;        default -&gt; throw new RuntimeException();\n&quot; +
1170                 &quot;        };\n&quot; +
1171                 &quot;        int k = switch (i) {\n&quot; +
1172                 &quot;        case 0:\n&quot; +
<span class="line-modified">1173                 &quot;            break i + 1;\n&quot; +</span>
1174                 &quot;        \n&quot; +
1175                 &quot;        case 1:\n&quot; +
1176                 &quot;            {\n&quot; +
<span class="line-modified">1177                 &quot;                break i + 1;\n&quot; +</span>
1178                 &quot;            }\n&quot; +
1179                 &quot;        \n&quot; +
1180                 &quot;        default:\n&quot; +
1181                 &quot;            throw new RuntimeException();\n&quot; +
1182                 &quot;        \n&quot; +
1183                 &quot;        };\n&quot; +
1184                 &quot;    }\n&quot; +
1185                 &quot;}&quot;;
1186         System.err.println(&quot;toString:&quot;);
1187         System.err.println(toString);
1188         System.err.println(&quot;expectedToString:&quot;);
1189         System.err.println(expectedToString);
1190         assertEquals(&quot;the error spans are not correct; actual:&quot; + toString, expectedToString, toString);
1191         String actualErrors = normalize(out.toString());
1192         assertEquals(&quot;the error message is not correct, actual: &quot; + actualErrors, expectedErrors, actualErrors);
1193     }
1194 
1195     @Test
1196     void testTypeParamsWithoutMethod() throws IOException {
1197         assert tool != null;
</pre>
<hr />
<pre>
1274         CompilationUnitTree cut = ct.parse().iterator().next();
1275         boolean[] found = new boolean[1];
1276 
1277         new TreeScanner&lt;Void, Void&gt;() {
1278             @Override
1279             public Void visitLambdaExpression(LambdaExpressionTree tree, Void v) {
1280                 found[0] = true;
1281                 int lambdaStart = parts[0].length();
1282                 int lambdaEnd = parts[0].length() + parts[1].length();
1283                 assertEquals(&quot;testAnalyzeParensWithComma2&quot;,
1284                         lambdaStart, pos.getStartPosition(cut, tree));
1285                 assertEquals(&quot;testAnalyzeParensWithComma2&quot;,
1286                         lambdaEnd, pos.getEndPosition(cut, tree));
1287                 return null;
1288             }
1289         }.scan(cut, null);
1290 
1291         assertTrue(&quot;testAnalyzeParensWithComma2&quot;, found[0]);
1292     }
1293 













































































































































































1294     void run(String[] args) throws Exception {
1295         int passed = 0, failed = 0;
1296         final Pattern p = (args != null &amp;&amp; args.length &gt; 0)
1297                 ? Pattern.compile(args[0])
1298                 : null;
1299         for (Method m : this.getClass().getDeclaredMethods()) {
1300             boolean selected = (p == null)
1301                     ? m.isAnnotationPresent(Test.class)
1302                     : p.matcher(m.getName()).matches();
1303             if (selected) {
1304                 try {
1305                     m.invoke(this, (Object[]) null);
1306                     System.out.println(m.getName() + &quot;: OK&quot;);
1307                     passed++;
1308                 } catch (Throwable ex) {
1309                     System.out.printf(&quot;Test %s failed: %s %n&quot;, m, ex.getCause());
1310                     failed++;
1311                 }
1312             }
1313         }
</pre>
</td>
<td>
<hr />
<pre>
1066     @Test
1067     void testCaseBodyStatements() throws IOException {
1068         String code = &quot;class C {&quot; +
1069                       &quot;    void t(int i) {&quot; +
1070                       &quot;        switch (i) {&quot; +
1071                       &quot;            case 0 -&gt; i++;&quot; +
1072                       &quot;            case 1 -&gt; { i++; }&quot; +
1073                       &quot;            case 2 -&gt; throw new RuntimeException();&quot; +
1074                       &quot;            case 3 -&gt; if (true) ;&quot; +
1075                       &quot;            default -&gt; i++;&quot; +
1076                       &quot;        }&quot; +
1077                       &quot;        switch (i) {&quot; +
1078                       &quot;            case 0: i++; break;&quot; +
1079                       &quot;            case 1: { i++; break;}&quot; +
1080                       &quot;            case 2: throw new RuntimeException();&quot; +
1081                       &quot;            case 3: if (true) ; break;&quot; +
1082                       &quot;            default: i++; break;&quot; +
1083                       &quot;        }&quot; +
1084                       &quot;        int j = switch (i) {&quot; +
1085                       &quot;            case 0 -&gt; i + 1;&quot; +
<span class="line-modified">1086                       &quot;            case 1 -&gt; { yield i + 1; }&quot; +</span>
1087                       &quot;            default -&gt; throw new RuntimeException();&quot; +
1088                       &quot;        };&quot; +
1089                       &quot;        int k = switch (i) {&quot; +
<span class="line-modified">1090                       &quot;            case 0: yield i + 1;&quot; +</span>
<span class="line-modified">1091                       &quot;            case 1: { yield i + 1; }&quot; +</span>
1092                       &quot;            default: throw new RuntimeException();&quot; +
1093                       &quot;        };&quot; +
1094                       &quot;    }&quot; +
1095                       &quot;}&quot;;
1096         String expectedErrors = &quot;Test.java:1:178: compiler.err.switch.case.unexpected.statement\n&quot;;
1097         StringWriter out = new StringWriter();
1098         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(out, fm, null,
<span class="line-modified">1099                 Arrays.asList(&quot;-XDrawDiagnostics&quot;),</span>
1100                 null, Arrays.asList(new MyFileObject(code)));
1101 
1102         CompilationUnitTree cut = ct.parse().iterator().next();
1103         Trees trees = Trees.instance(ct);
1104         List&lt;String&gt; spans = new ArrayList&lt;&gt;();
1105 
1106         new TreePathScanner&lt;Void, Void&gt;() {
1107             @Override
1108             public Void visitCase(CaseTree tree, Void v) {
1109                 if (tree.getBody() != null) {
1110                     int start = (int) trees.getSourcePositions().getStartPosition(cut, tree.getBody());
1111                     int end = (int) trees.getSourcePositions().getEndPosition(cut, tree.getBody());
1112                     spans.add(code.substring(start, end));
1113                 } else {
1114                     spans.add(&quot;&lt;null&gt;&quot;);
1115                 }
1116                 return super.visitCase(tree, v);
1117             }
1118         }.scan(cut, null);
1119 
1120         List&lt;String&gt; expectedSpans = List.of(
1121                 &quot;i++;&quot;, &quot;{ i++; }&quot;, &quot;throw new RuntimeException();&quot;, &quot;if (true) ;&quot;, &quot;i++;&quot;,
1122                 &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;,
<span class="line-modified">1123                 &quot;i + 1&quot;/*TODO semicolon?*/, &quot;{ yield i + 1; }&quot;, &quot;throw new RuntimeException();&quot;,</span>
1124                 &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;);
1125         assertEquals(&quot;the error spans are not correct; actual:&quot; + spans, expectedSpans, spans);
1126         String toString = normalize(cut.toString());
1127         String expectedToString =
1128                 &quot;\n&quot; +
1129                 &quot;class C {\n&quot; +
1130                 &quot;    \n&quot; +
1131                 &quot;    void t(int i) {\n&quot; +
1132                 &quot;        switch (i) {\n&quot; +
1133                 &quot;        case 0 -&gt; i++;\n&quot; +
1134                 &quot;        case 1 -&gt; {\n&quot; +
1135                 &quot;            i++;\n&quot; +
1136                 &quot;        }\n&quot; +
1137                 &quot;        case 2 -&gt; throw new RuntimeException();\n&quot; +
1138                 &quot;        case 3 -&gt; if (true) ;\n&quot; +
1139                 &quot;        default -&gt; i++;\n&quot; +
1140                 &quot;        }\n&quot; +
1141                 &quot;        switch (i) {\n&quot; +
1142                 &quot;        case 0:\n&quot; +
1143                 &quot;            i++;\n&quot; +
</pre>
<hr />
<pre>
1145                 &quot;        \n&quot; +
1146                 &quot;        case 1:\n&quot; +
1147                 &quot;            {\n&quot; +
1148                 &quot;                i++;\n&quot; +
1149                 &quot;                break;\n&quot; +
1150                 &quot;            }\n&quot; +
1151                 &quot;        \n&quot; +
1152                 &quot;        case 2:\n&quot; +
1153                 &quot;            throw new RuntimeException();\n&quot; +
1154                 &quot;        \n&quot; +
1155                 &quot;        case 3:\n&quot; +
1156                 &quot;            if (true) ;\n&quot; +
1157                 &quot;            break;\n&quot; +
1158                 &quot;        \n&quot; +
1159                 &quot;        default:\n&quot; +
1160                 &quot;            i++;\n&quot; +
1161                 &quot;            break;\n&quot; +
1162                 &quot;        \n&quot; +
1163                 &quot;        }\n&quot; +
1164                 &quot;        int j = switch (i) {\n&quot; +
<span class="line-modified">1165                 &quot;        case 0 -&gt; yield i + 1;\n&quot; +</span>
1166                 &quot;        case 1 -&gt; {\n&quot; +
<span class="line-modified">1167                 &quot;            yield i + 1;\n&quot; +</span>
1168                 &quot;        }\n&quot; +
1169                 &quot;        default -&gt; throw new RuntimeException();\n&quot; +
1170                 &quot;        };\n&quot; +
1171                 &quot;        int k = switch (i) {\n&quot; +
1172                 &quot;        case 0:\n&quot; +
<span class="line-modified">1173                 &quot;            yield i + 1;\n&quot; +</span>
1174                 &quot;        \n&quot; +
1175                 &quot;        case 1:\n&quot; +
1176                 &quot;            {\n&quot; +
<span class="line-modified">1177                 &quot;                yield i + 1;\n&quot; +</span>
1178                 &quot;            }\n&quot; +
1179                 &quot;        \n&quot; +
1180                 &quot;        default:\n&quot; +
1181                 &quot;            throw new RuntimeException();\n&quot; +
1182                 &quot;        \n&quot; +
1183                 &quot;        };\n&quot; +
1184                 &quot;    }\n&quot; +
1185                 &quot;}&quot;;
1186         System.err.println(&quot;toString:&quot;);
1187         System.err.println(toString);
1188         System.err.println(&quot;expectedToString:&quot;);
1189         System.err.println(expectedToString);
1190         assertEquals(&quot;the error spans are not correct; actual:&quot; + toString, expectedToString, toString);
1191         String actualErrors = normalize(out.toString());
1192         assertEquals(&quot;the error message is not correct, actual: &quot; + actualErrors, expectedErrors, actualErrors);
1193     }
1194 
1195     @Test
1196     void testTypeParamsWithoutMethod() throws IOException {
1197         assert tool != null;
</pre>
<hr />
<pre>
1274         CompilationUnitTree cut = ct.parse().iterator().next();
1275         boolean[] found = new boolean[1];
1276 
1277         new TreeScanner&lt;Void, Void&gt;() {
1278             @Override
1279             public Void visitLambdaExpression(LambdaExpressionTree tree, Void v) {
1280                 found[0] = true;
1281                 int lambdaStart = parts[0].length();
1282                 int lambdaEnd = parts[0].length() + parts[1].length();
1283                 assertEquals(&quot;testAnalyzeParensWithComma2&quot;,
1284                         lambdaStart, pos.getStartPosition(cut, tree));
1285                 assertEquals(&quot;testAnalyzeParensWithComma2&quot;,
1286                         lambdaEnd, pos.getEndPosition(cut, tree));
1287                 return null;
1288             }
1289         }.scan(cut, null);
1290 
1291         assertTrue(&quot;testAnalyzeParensWithComma2&quot;, found[0]);
1292     }
1293 
<span class="line-added">1294     @Test</span>
<span class="line-added">1295     void testBrokenEnum1() throws IOException {</span>
<span class="line-added">1296         assert tool != null;</span>
<span class="line-added">1297 </span>
<span class="line-added">1298         String code = &quot;package test; class Test { enum E { A, B, C. D, E, F; } }&quot;;</span>
<span class="line-added">1299         StringWriter output = new StringWriter();</span>
<span class="line-added">1300         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">1301                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">1302         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">1303         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">1304         List&lt;String&gt; expected = List.of(&quot;Test.java:1:44: compiler.err.expected3: &#39;,&#39;, &#39;}&#39;, &#39;;&#39;&quot;);</span>
<span class="line-added">1305 </span>
<span class="line-added">1306         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">1307                      actual,</span>
<span class="line-added">1308                      expected);</span>
<span class="line-added">1309 </span>
<span class="line-added">1310         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">1311         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">1312                              &quot;\n&quot; +</span>
<span class="line-added">1313                              &quot;class Test {\n&quot; +</span>
<span class="line-added">1314                              &quot;    \n&quot; +</span>
<span class="line-added">1315                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">1316                              &quot;        /*public static final*/ A /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1317                              &quot;        /*public static final*/ B /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1318                              &quot;        /*public static final*/ C /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1319                              &quot;        /*public static final*/ D /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1320                              &quot;        /*public static final*/ E /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1321                              &quot;        /*public static final*/ F /* = new E() */ /*enum*/ ;\n&quot; +</span>
<span class="line-added">1322                              &quot;        (ERROR) &lt;error&gt;;\n&quot; +</span>
<span class="line-added">1323                              &quot;    }\n&quot; +</span>
<span class="line-added">1324                              &quot;}&quot;;</span>
<span class="line-added">1325         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">1326                      actualAST,</span>
<span class="line-added">1327                      expectedAST);</span>
<span class="line-added">1328     }</span>
<span class="line-added">1329 </span>
<span class="line-added">1330     @Test</span>
<span class="line-added">1331     void testBrokenEnum2() throws IOException {</span>
<span class="line-added">1332         assert tool != null;</span>
<span class="line-added">1333 </span>
<span class="line-added">1334         String code = &quot;package test; class Test { enum E { A, B, C void t() {} } }&quot;;</span>
<span class="line-added">1335         StringWriter output = new StringWriter();</span>
<span class="line-added">1336         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">1337                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">1338         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">1339         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">1340         List&lt;String&gt; expected = List.of(&quot;Test.java:1:44: compiler.err.expected3: &#39;,&#39;, &#39;}&#39;, &#39;;&#39;&quot;);</span>
<span class="line-added">1341 </span>
<span class="line-added">1342         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">1343                      actual,</span>
<span class="line-added">1344                      expected);</span>
<span class="line-added">1345 </span>
<span class="line-added">1346         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">1347         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">1348                              &quot;\n&quot; +</span>
<span class="line-added">1349                              &quot;class Test {\n&quot; +</span>
<span class="line-added">1350                              &quot;    \n&quot; +</span>
<span class="line-added">1351                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">1352                              &quot;        /*public static final*/ A /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1353                              &quot;        /*public static final*/ B /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1354                              &quot;        /*public static final*/ C /* = new E() */ /*enum*/ ;\n&quot; +</span>
<span class="line-added">1355                              &quot;        \n&quot; +</span>
<span class="line-added">1356                              &quot;        void t() {\n&quot; +</span>
<span class="line-added">1357                              &quot;        }\n&quot; +</span>
<span class="line-added">1358                              &quot;    }\n&quot; +</span>
<span class="line-added">1359                              &quot;}&quot;;</span>
<span class="line-added">1360         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">1361                      actualAST,</span>
<span class="line-added">1362                      expectedAST);</span>
<span class="line-added">1363     }</span>
<span class="line-added">1364 </span>
<span class="line-added">1365     @Test</span>
<span class="line-added">1366     void testBrokenEnum3() throws IOException {</span>
<span class="line-added">1367         assert tool != null;</span>
<span class="line-added">1368 </span>
<span class="line-added">1369         String code = &quot;package test; class Test { enum E { , void t() {} } }&quot;;</span>
<span class="line-added">1370         StringWriter output = new StringWriter();</span>
<span class="line-added">1371         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">1372                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">1373         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">1374         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">1375         List&lt;String&gt; expected = List.of(&quot;Test.java:1:38: compiler.err.expected2: &#39;}&#39;, &#39;;&#39;&quot;);</span>
<span class="line-added">1376 </span>
<span class="line-added">1377         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">1378                      actual,</span>
<span class="line-added">1379                      expected);</span>
<span class="line-added">1380 </span>
<span class="line-added">1381         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">1382         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">1383                              &quot;\n&quot; +</span>
<span class="line-added">1384                              &quot;class Test {\n&quot; +</span>
<span class="line-added">1385                              &quot;    \n&quot; +</span>
<span class="line-added">1386                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">1387                              &quot;;\n&quot; +</span>
<span class="line-added">1388                              &quot;        \n&quot; +</span>
<span class="line-added">1389                              &quot;        void t() {\n&quot; +</span>
<span class="line-added">1390                              &quot;        }\n&quot; +</span>
<span class="line-added">1391                              &quot;    }\n&quot; +</span>
<span class="line-added">1392                              &quot;}&quot;;</span>
<span class="line-added">1393         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">1394                      actualAST,</span>
<span class="line-added">1395                      expectedAST);</span>
<span class="line-added">1396     }</span>
<span class="line-added">1397 </span>
<span class="line-added">1398     @Test</span>
<span class="line-added">1399     void testBrokenEnum4() throws IOException {</span>
<span class="line-added">1400         assert tool != null;</span>
<span class="line-added">1401 </span>
<span class="line-added">1402         String code = &quot;package test; class Test { enum E { A, B, C, void t() {} } }&quot;;</span>
<span class="line-added">1403         StringWriter output = new StringWriter();</span>
<span class="line-added">1404         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">1405                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">1406         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">1407         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">1408         List&lt;String&gt; expected = List.of(&quot;Test.java:1:46: compiler.err.enum.constant.expected&quot;);</span>
<span class="line-added">1409 </span>
<span class="line-added">1410         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">1411                      actual,</span>
<span class="line-added">1412                      expected);</span>
<span class="line-added">1413 </span>
<span class="line-added">1414         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">1415         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">1416                              &quot;\n&quot; +</span>
<span class="line-added">1417                              &quot;class Test {\n&quot; +</span>
<span class="line-added">1418                              &quot;    \n&quot; +</span>
<span class="line-added">1419                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">1420                              &quot;        /*public static final*/ A /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1421                              &quot;        /*public static final*/ B /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1422                              &quot;        /*public static final*/ C /* = new E() */ /*enum*/ ;\n&quot; +</span>
<span class="line-added">1423                              &quot;        \n&quot; +</span>
<span class="line-added">1424                              &quot;        void t() {\n&quot; +</span>
<span class="line-added">1425                              &quot;        }\n&quot; +</span>
<span class="line-added">1426                              &quot;    }\n&quot; +</span>
<span class="line-added">1427                              &quot;}&quot;;</span>
<span class="line-added">1428         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">1429                      actualAST,</span>
<span class="line-added">1430                      expectedAST);</span>
<span class="line-added">1431     }</span>
<span class="line-added">1432 </span>
<span class="line-added">1433     @Test</span>
<span class="line-added">1434     void testBrokenEnum5() throws IOException {</span>
<span class="line-added">1435         assert tool != null;</span>
<span class="line-added">1436 </span>
<span class="line-added">1437         String code = &quot;package test; class Test { enum E { A; void t() {} B; } }&quot;;</span>
<span class="line-added">1438         StringWriter output = new StringWriter();</span>
<span class="line-added">1439         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">1440                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">1441         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">1442         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">1443         List&lt;String&gt; expected = List.of(&quot;Test.java:1:52: compiler.err.enum.constant.not.expected&quot;);</span>
<span class="line-added">1444 </span>
<span class="line-added">1445         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">1446                      actual,</span>
<span class="line-added">1447                      expected);</span>
<span class="line-added">1448 </span>
<span class="line-added">1449         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">1450         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">1451                              &quot;\n&quot; +</span>
<span class="line-added">1452                              &quot;class Test {\n&quot; +</span>
<span class="line-added">1453                              &quot;    \n&quot; +</span>
<span class="line-added">1454                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">1455                              &quot;        /*public static final*/ A /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">1456                              &quot;        /*public static final*/ B /* = new E() */ /*enum*/ ;\n&quot; +</span>
<span class="line-added">1457                              &quot;        \n&quot; +</span>
<span class="line-added">1458                              &quot;        void t() {\n&quot; +</span>
<span class="line-added">1459                              &quot;        }\n&quot; +</span>
<span class="line-added">1460                              &quot;    }\n&quot; +</span>
<span class="line-added">1461                              &quot;}&quot;;</span>
<span class="line-added">1462         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">1463                      actualAST,</span>
<span class="line-added">1464                      expectedAST);</span>
<span class="line-added">1465     }</span>
<span class="line-added">1466 </span>
1467     void run(String[] args) throws Exception {
1468         int passed = 0, failed = 0;
1469         final Pattern p = (args != null &amp;&amp; args.length &gt; 0)
1470                 ? Pattern.compile(args[0])
1471                 : null;
1472         for (Method m : this.getClass().getDeclaredMethods()) {
1473             boolean selected = (p == null)
1474                     ? m.isAnnotationPresent(Test.class)
1475                     : p.matcher(m.getName()).matches();
1476             if (selected) {
1477                 try {
1478                     m.invoke(this, (Object[]) null);
1479                     System.out.println(m.getName() + &quot;: OK&quot;);
1480                     passed++;
1481                 } catch (Throwable ex) {
1482                     System.out.printf(&quot;Test %s failed: %s %n&quot;, m, ex.getCause());
1483                     failed++;
1484                 }
1485             }
1486         }
</pre>
</td>
</tr>
</table>
<center><a href="../nestmates/CheckNestmateAttrs.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="extend/TrialParser.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>