<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/langtools/tools/javac/parser/JavacParserTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../nestmates/CheckNestmateAttrs.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="extend/TrialParser.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/parser/JavacParserTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1081,24 ***</span>
                        &quot;            case 3: if (true) ; break;&quot; +
                        &quot;            default: i++; break;&quot; +
                        &quot;        }&quot; +
                        &quot;        int j = switch (i) {&quot; +
                        &quot;            case 0 -&gt; i + 1;&quot; +
<span class="line-modified">!                       &quot;            case 1 -&gt; { break i + 1; }&quot; +</span>
                        &quot;            default -&gt; throw new RuntimeException();&quot; +
                        &quot;        };&quot; +
                        &quot;        int k = switch (i) {&quot; +
<span class="line-modified">!                       &quot;            case 0: break i + 1;&quot; +</span>
<span class="line-modified">!                       &quot;            case 1: { break i + 1; }&quot; +</span>
                        &quot;            default: throw new RuntimeException();&quot; +
                        &quot;        };&quot; +
                        &quot;    }&quot; +
                        &quot;}&quot;;
          String expectedErrors = &quot;Test.java:1:178: compiler.err.switch.case.unexpected.statement\n&quot;;
          StringWriter out = new StringWriter();
          JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(out, fm, null,
<span class="line-modified">!                 Arrays.asList(&quot;-XDrawDiagnostics&quot;, &quot;--enable-preview&quot;, &quot;-source&quot;, SOURCE_VERSION),</span>
                  null, Arrays.asList(new MyFileObject(code)));
  
          CompilationUnitTree cut = ct.parse().iterator().next();
          Trees trees = Trees.instance(ct);
          List&lt;String&gt; spans = new ArrayList&lt;&gt;();
<span class="line-new-header">--- 1081,24 ---</span>
                        &quot;            case 3: if (true) ; break;&quot; +
                        &quot;            default: i++; break;&quot; +
                        &quot;        }&quot; +
                        &quot;        int j = switch (i) {&quot; +
                        &quot;            case 0 -&gt; i + 1;&quot; +
<span class="line-modified">!                       &quot;            case 1 -&gt; { yield i + 1; }&quot; +</span>
                        &quot;            default -&gt; throw new RuntimeException();&quot; +
                        &quot;        };&quot; +
                        &quot;        int k = switch (i) {&quot; +
<span class="line-modified">!                       &quot;            case 0: yield i + 1;&quot; +</span>
<span class="line-modified">!                       &quot;            case 1: { yield i + 1; }&quot; +</span>
                        &quot;            default: throw new RuntimeException();&quot; +
                        &quot;        };&quot; +
                        &quot;    }&quot; +
                        &quot;}&quot;;
          String expectedErrors = &quot;Test.java:1:178: compiler.err.switch.case.unexpected.statement\n&quot;;
          StringWriter out = new StringWriter();
          JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(out, fm, null,
<span class="line-modified">!                 Arrays.asList(&quot;-XDrawDiagnostics&quot;),</span>
                  null, Arrays.asList(new MyFileObject(code)));
  
          CompilationUnitTree cut = ct.parse().iterator().next();
          Trees trees = Trees.instance(ct);
          List&lt;String&gt; spans = new ArrayList&lt;&gt;();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1118,11 ***</span>
          }.scan(cut, null);
  
          List&lt;String&gt; expectedSpans = List.of(
                  &quot;i++;&quot;, &quot;{ i++; }&quot;, &quot;throw new RuntimeException();&quot;, &quot;if (true) ;&quot;, &quot;i++;&quot;,
                  &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;,
<span class="line-modified">!                 &quot;i + 1&quot;/*TODO semicolon?*/, &quot;{ break i + 1; }&quot;, &quot;throw new RuntimeException();&quot;,</span>
                  &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;);
          assertEquals(&quot;the error spans are not correct; actual:&quot; + spans, expectedSpans, spans);
          String toString = normalize(cut.toString());
          String expectedToString =
                  &quot;\n&quot; +
<span class="line-new-header">--- 1118,11 ---</span>
          }.scan(cut, null);
  
          List&lt;String&gt; expectedSpans = List.of(
                  &quot;i++;&quot;, &quot;{ i++; }&quot;, &quot;throw new RuntimeException();&quot;, &quot;if (true) ;&quot;, &quot;i++;&quot;,
                  &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;,
<span class="line-modified">!                 &quot;i + 1&quot;/*TODO semicolon?*/, &quot;{ yield i + 1; }&quot;, &quot;throw new RuntimeException();&quot;,</span>
                  &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;, &quot;&lt;null&gt;&quot;);
          assertEquals(&quot;the error spans are not correct; actual:&quot; + spans, expectedSpans, spans);
          String toString = normalize(cut.toString());
          String expectedToString =
                  &quot;\n&quot; +
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1160,23 ***</span>
                  &quot;            i++;\n&quot; +
                  &quot;            break;\n&quot; +
                  &quot;        \n&quot; +
                  &quot;        }\n&quot; +
                  &quot;        int j = switch (i) {\n&quot; +
<span class="line-modified">!                 &quot;        case 0 -&gt; break i + 1;\n&quot; +</span>
                  &quot;        case 1 -&gt; {\n&quot; +
<span class="line-modified">!                 &quot;            break i + 1;\n&quot; +</span>
                  &quot;        }\n&quot; +
                  &quot;        default -&gt; throw new RuntimeException();\n&quot; +
                  &quot;        };\n&quot; +
                  &quot;        int k = switch (i) {\n&quot; +
                  &quot;        case 0:\n&quot; +
<span class="line-modified">!                 &quot;            break i + 1;\n&quot; +</span>
                  &quot;        \n&quot; +
                  &quot;        case 1:\n&quot; +
                  &quot;            {\n&quot; +
<span class="line-modified">!                 &quot;                break i + 1;\n&quot; +</span>
                  &quot;            }\n&quot; +
                  &quot;        \n&quot; +
                  &quot;        default:\n&quot; +
                  &quot;            throw new RuntimeException();\n&quot; +
                  &quot;        \n&quot; +
<span class="line-new-header">--- 1160,23 ---</span>
                  &quot;            i++;\n&quot; +
                  &quot;            break;\n&quot; +
                  &quot;        \n&quot; +
                  &quot;        }\n&quot; +
                  &quot;        int j = switch (i) {\n&quot; +
<span class="line-modified">!                 &quot;        case 0 -&gt; yield i + 1;\n&quot; +</span>
                  &quot;        case 1 -&gt; {\n&quot; +
<span class="line-modified">!                 &quot;            yield i + 1;\n&quot; +</span>
                  &quot;        }\n&quot; +
                  &quot;        default -&gt; throw new RuntimeException();\n&quot; +
                  &quot;        };\n&quot; +
                  &quot;        int k = switch (i) {\n&quot; +
                  &quot;        case 0:\n&quot; +
<span class="line-modified">!                 &quot;            yield i + 1;\n&quot; +</span>
                  &quot;        \n&quot; +
                  &quot;        case 1:\n&quot; +
                  &quot;            {\n&quot; +
<span class="line-modified">!                 &quot;                yield i + 1;\n&quot; +</span>
                  &quot;            }\n&quot; +
                  &quot;        \n&quot; +
                  &quot;        default:\n&quot; +
                  &quot;            throw new RuntimeException();\n&quot; +
                  &quot;        \n&quot; +
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1289,10 ***</span>
<span class="line-new-header">--- 1289,183 ---</span>
          }.scan(cut, null);
  
          assertTrue(&quot;testAnalyzeParensWithComma2&quot;, found[0]);
      }
  
<span class="line-added">+     @Test</span>
<span class="line-added">+     void testBrokenEnum1() throws IOException {</span>
<span class="line-added">+         assert tool != null;</span>
<span class="line-added">+ </span>
<span class="line-added">+         String code = &quot;package test; class Test { enum E { A, B, C. D, E, F; } }&quot;;</span>
<span class="line-added">+         StringWriter output = new StringWriter();</span>
<span class="line-added">+         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">+                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">+         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">+         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">+         List&lt;String&gt; expected = List.of(&quot;Test.java:1:44: compiler.err.expected3: &#39;,&#39;, &#39;}&#39;, &#39;;&#39;&quot;);</span>
<span class="line-added">+ </span>
<span class="line-added">+         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">+                      actual,</span>
<span class="line-added">+                      expected);</span>
<span class="line-added">+ </span>
<span class="line-added">+         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">+         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">+                              &quot;\n&quot; +</span>
<span class="line-added">+                              &quot;class Test {\n&quot; +</span>
<span class="line-added">+                              &quot;    \n&quot; +</span>
<span class="line-added">+                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ A /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ B /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ C /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ D /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ E /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ F /* = new E() */ /*enum*/ ;\n&quot; +</span>
<span class="line-added">+                              &quot;        (ERROR) &lt;error&gt;;\n&quot; +</span>
<span class="line-added">+                              &quot;    }\n&quot; +</span>
<span class="line-added">+                              &quot;}&quot;;</span>
<span class="line-added">+         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">+                      actualAST,</span>
<span class="line-added">+                      expectedAST);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Test</span>
<span class="line-added">+     void testBrokenEnum2() throws IOException {</span>
<span class="line-added">+         assert tool != null;</span>
<span class="line-added">+ </span>
<span class="line-added">+         String code = &quot;package test; class Test { enum E { A, B, C void t() {} } }&quot;;</span>
<span class="line-added">+         StringWriter output = new StringWriter();</span>
<span class="line-added">+         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">+                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">+         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">+         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">+         List&lt;String&gt; expected = List.of(&quot;Test.java:1:44: compiler.err.expected3: &#39;,&#39;, &#39;}&#39;, &#39;;&#39;&quot;);</span>
<span class="line-added">+ </span>
<span class="line-added">+         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">+                      actual,</span>
<span class="line-added">+                      expected);</span>
<span class="line-added">+ </span>
<span class="line-added">+         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">+         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">+                              &quot;\n&quot; +</span>
<span class="line-added">+                              &quot;class Test {\n&quot; +</span>
<span class="line-added">+                              &quot;    \n&quot; +</span>
<span class="line-added">+                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ A /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ B /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ C /* = new E() */ /*enum*/ ;\n&quot; +</span>
<span class="line-added">+                              &quot;        \n&quot; +</span>
<span class="line-added">+                              &quot;        void t() {\n&quot; +</span>
<span class="line-added">+                              &quot;        }\n&quot; +</span>
<span class="line-added">+                              &quot;    }\n&quot; +</span>
<span class="line-added">+                              &quot;}&quot;;</span>
<span class="line-added">+         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">+                      actualAST,</span>
<span class="line-added">+                      expectedAST);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Test</span>
<span class="line-added">+     void testBrokenEnum3() throws IOException {</span>
<span class="line-added">+         assert tool != null;</span>
<span class="line-added">+ </span>
<span class="line-added">+         String code = &quot;package test; class Test { enum E { , void t() {} } }&quot;;</span>
<span class="line-added">+         StringWriter output = new StringWriter();</span>
<span class="line-added">+         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">+                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">+         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">+         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">+         List&lt;String&gt; expected = List.of(&quot;Test.java:1:38: compiler.err.expected2: &#39;}&#39;, &#39;;&#39;&quot;);</span>
<span class="line-added">+ </span>
<span class="line-added">+         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">+                      actual,</span>
<span class="line-added">+                      expected);</span>
<span class="line-added">+ </span>
<span class="line-added">+         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">+         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">+                              &quot;\n&quot; +</span>
<span class="line-added">+                              &quot;class Test {\n&quot; +</span>
<span class="line-added">+                              &quot;    \n&quot; +</span>
<span class="line-added">+                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">+                              &quot;;\n&quot; +</span>
<span class="line-added">+                              &quot;        \n&quot; +</span>
<span class="line-added">+                              &quot;        void t() {\n&quot; +</span>
<span class="line-added">+                              &quot;        }\n&quot; +</span>
<span class="line-added">+                              &quot;    }\n&quot; +</span>
<span class="line-added">+                              &quot;}&quot;;</span>
<span class="line-added">+         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">+                      actualAST,</span>
<span class="line-added">+                      expectedAST);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Test</span>
<span class="line-added">+     void testBrokenEnum4() throws IOException {</span>
<span class="line-added">+         assert tool != null;</span>
<span class="line-added">+ </span>
<span class="line-added">+         String code = &quot;package test; class Test { enum E { A, B, C, void t() {} } }&quot;;</span>
<span class="line-added">+         StringWriter output = new StringWriter();</span>
<span class="line-added">+         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">+                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">+         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">+         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">+         List&lt;String&gt; expected = List.of(&quot;Test.java:1:46: compiler.err.enum.constant.expected&quot;);</span>
<span class="line-added">+ </span>
<span class="line-added">+         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">+                      actual,</span>
<span class="line-added">+                      expected);</span>
<span class="line-added">+ </span>
<span class="line-added">+         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">+         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">+                              &quot;\n&quot; +</span>
<span class="line-added">+                              &quot;class Test {\n&quot; +</span>
<span class="line-added">+                              &quot;    \n&quot; +</span>
<span class="line-added">+                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ A /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ B /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ C /* = new E() */ /*enum*/ ;\n&quot; +</span>
<span class="line-added">+                              &quot;        \n&quot; +</span>
<span class="line-added">+                              &quot;        void t() {\n&quot; +</span>
<span class="line-added">+                              &quot;        }\n&quot; +</span>
<span class="line-added">+                              &quot;    }\n&quot; +</span>
<span class="line-added">+                              &quot;}&quot;;</span>
<span class="line-added">+         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">+                      actualAST,</span>
<span class="line-added">+                      expectedAST);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Test</span>
<span class="line-added">+     void testBrokenEnum5() throws IOException {</span>
<span class="line-added">+         assert tool != null;</span>
<span class="line-added">+ </span>
<span class="line-added">+         String code = &quot;package test; class Test { enum E { A; void t() {} B; } }&quot;;</span>
<span class="line-added">+         StringWriter output = new StringWriter();</span>
<span class="line-added">+         JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(output, fm, null, List.of(&quot;-XDrawDiagnostics&quot;),</span>
<span class="line-added">+                 null, Arrays.asList(new MyFileObject(code)));</span>
<span class="line-added">+         CompilationUnitTree cut = ct.parse().iterator().next();</span>
<span class="line-added">+         List&lt;String&gt; actual = List.of(output.toString().split(&quot;\r?\n&quot;));</span>
<span class="line-added">+         List&lt;String&gt; expected = List.of(&quot;Test.java:1:52: compiler.err.enum.constant.not.expected&quot;);</span>
<span class="line-added">+ </span>
<span class="line-added">+         assertEquals(&quot;The expected and actual errors do not match, actual errors: &quot; + actual,</span>
<span class="line-added">+                      actual,</span>
<span class="line-added">+                      expected);</span>
<span class="line-added">+ </span>
<span class="line-added">+         String actualAST = cut.toString().replaceAll(&quot;\r*\n&quot;, &quot;\n&quot;);</span>
<span class="line-added">+         String expectedAST = &quot;package test;\n&quot; +</span>
<span class="line-added">+                              &quot;\n&quot; +</span>
<span class="line-added">+                              &quot;class Test {\n&quot; +</span>
<span class="line-added">+                              &quot;    \n&quot; +</span>
<span class="line-added">+                              &quot;    enum E {\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ A /* = new E() */ /*enum*/ ,\n&quot; +</span>
<span class="line-added">+                              &quot;        /*public static final*/ B /* = new E() */ /*enum*/ ;\n&quot; +</span>
<span class="line-added">+                              &quot;        \n&quot; +</span>
<span class="line-added">+                              &quot;        void t() {\n&quot; +</span>
<span class="line-added">+                              &quot;        }\n&quot; +</span>
<span class="line-added">+                              &quot;    }\n&quot; +</span>
<span class="line-added">+                              &quot;}&quot;;</span>
<span class="line-added">+         assertEquals(&quot;The expected and actual AST do not match, actual AST: &quot; + actualAST,</span>
<span class="line-added">+                      actualAST,</span>
<span class="line-added">+                      expectedAST);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      void run(String[] args) throws Exception {
          int passed = 0, failed = 0;
          final Pattern p = (args != null &amp;&amp; args.length &gt; 0)
                  ? Pattern.compile(args[0])
                  : null;
</pre>
<center><a href="../nestmates/CheckNestmateAttrs.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="extend/TrialParser.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>