<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/expswitch/ExpSwitchNestingTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../enum/EnumMembersOrder.out.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../failover/CheckAttributedTree.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/expswitch/ExpSwitchNestingTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.io.IOException;
 25 import java.util.List;
 26 
 27 import org.testng.ITestResult;
 28 import org.testng.annotations.AfterMethod;
 29 import org.testng.annotations.Test;

 30 import tools.javac.combo.JavacTemplateTestBase;
 31 
 32 import static java.util.stream.Collectors.toList;
 33 
 34 @Test
<span class="line-modified"> 35 public class ExpSwitchNestingTest extends JavacTemplateTestBase {</span>
 36     private static final String RUNNABLE = &quot;Runnable r = () -&gt; { # };&quot;;
 37     private static final String INT_FN = &quot;java.util.function.IntSupplier r = () -&gt; { # };&quot;;
 38     private static final String LABEL = &quot;label: #&quot;;
 39     private static final String DEF_LABEL_VAR = &quot;int label = 0; { # }&quot;;
 40     private static final String FOR = &quot;for (int i=0; i&lt;10; i++) { # }&quot;;
 41     private static final String FOR_EACH = &quot;for (int i : new int[] {}) { # }&quot;;
 42     private static final String WHILE = &quot;while (cond) { # }&quot;;
 43     private static final String DO = &quot;do { # } while (cond);&quot;;
 44     private static final String SSWITCH = &quot;switch (x) { case 0: # };&quot;;
 45     private static final String ESWITCH_Z = &quot;int res = switch (x) { case 0 -&gt; { # } default -&gt; 0; };&quot;;
 46     private static final String ESWITCH_S = &quot;String res_string = switch (x) { case 0 -&gt; { # } default -&gt; \&quot;default\&quot;; };&quot;;
 47     private static final String INT_FN_ESWITCH = &quot;java.util.function.IntSupplier r = switch (x) { case 0 -&gt; { # } default -&gt; null; };&quot;;
 48     private static final String INT_ESWITCH_DEFAULT = &quot;int res = switch (x) { default -&gt; { # } };&quot;;
 49     private static final String IF = &quot;if (cond) { # } else throw new RuntimeException();&quot;;
 50     private static final String BLOCK = &quot;{ # }&quot;;
<span class="line-modified"> 51     private static final String BREAK_Z = &quot;break 0;&quot;;</span>
<span class="line-modified"> 52     private static final String BREAK_S = &quot;break \&quot;hello world\&quot;;&quot;;</span>
<span class="line-modified"> 53     private static final String BREAK_INT_FN = &quot;break () -&gt; 0 ;&quot;;</span>
 54     private static final String BREAK_N = &quot;break;&quot;;
 55     private static final String BREAK_L = &quot;break label;&quot;;

 56     private static final String RETURN_Z = &quot;return 0;&quot;;
 57     private static final String RETURN_N = &quot;return;&quot;;
 58     private static final String RETURN_S = &quot;return \&quot;Hello\&quot;;&quot;;
 59     private static final String CONTINUE_N = &quot;continue;&quot;;
 60     private static final String CONTINUE_L = &quot;continue label;&quot;;
 61     private static final String NOTHING = &quot;System.out.println();&quot;;
 62 
 63     // containers that do not require exhaustiveness
 64     private static final List&lt;String&gt; CONTAINERS
 65             = List.of(RUNNABLE, FOR, WHILE, DO, SSWITCH, IF, BLOCK);
 66     // containers that do not require exhaustiveness that are statements
 67     private static final List&lt;String&gt; CONTAINER_STATEMENTS
 68             = List.of(FOR, WHILE, DO, SSWITCH, IF, BLOCK);
 69 
<span class="line-modified"> 70     @AfterMethod</span>
<span class="line-modified"> 71     public void dumpTemplateIfError(ITestResult result) {</span>
<span class="line-removed"> 72         // Make sure offending template ends up in log file on failure</span>
<span class="line-removed"> 73         if (!result.isSuccess()) {</span>
<span class="line-removed"> 74             System.err.printf(&quot;Diagnostics: %s%nTemplate: %s%n&quot;, diags.errorKeys(), sourceFiles.stream().map(p -&gt; p.snd).collect(toList()));</span>
<span class="line-removed"> 75         }</span>
<span class="line-removed"> 76     }</span>
<span class="line-removed"> 77 </span>
<span class="line-removed"> 78     private static String[] PREVIEW_OPTIONS = {&quot;--enable-preview&quot;, &quot;-source&quot;,</span>
<span class="line-removed"> 79                                                Integer.toString(Runtime.version().feature())};</span>
<span class="line-removed"> 80 </span>
<span class="line-removed"> 81     private void program(String... constructs) {</span>
<span class="line-removed"> 82         String s = &quot;class C { static boolean cond = false; static int x = 0; void m() { # } }&quot;;</span>
<span class="line-removed"> 83         for (String c : constructs)</span>
<span class="line-removed"> 84             s = s.replace(&quot;#&quot;, c);</span>
<span class="line-removed"> 85         addSourceFile(&quot;C.java&quot;, new StringTemplate(s));</span>
<span class="line-removed"> 86     }</span>
<span class="line-removed"> 87 </span>
<span class="line-removed"> 88     private void assertOK(String... constructs) {</span>
<span class="line-removed"> 89         reset();</span>
<span class="line-removed"> 90         addCompileOptions(PREVIEW_OPTIONS);</span>
<span class="line-removed"> 91         program(constructs);</span>
<span class="line-removed"> 92         try {</span>
<span class="line-removed"> 93             compile();</span>
<span class="line-removed"> 94         }</span>
<span class="line-removed"> 95         catch (IOException e) {</span>
<span class="line-removed"> 96             throw new RuntimeException(e);</span>
<span class="line-removed"> 97         }</span>
<span class="line-removed"> 98         assertCompileSucceeded();</span>
<span class="line-removed"> 99     }</span>
<span class="line-removed">100 </span>
<span class="line-removed">101     private void assertOKWithWarning(String warning, String... constructs) {</span>
<span class="line-removed">102         reset();</span>
<span class="line-removed">103         addCompileOptions(PREVIEW_OPTIONS);</span>
<span class="line-removed">104         program(constructs);</span>
<span class="line-removed">105         try {</span>
<span class="line-removed">106             compile();</span>
<span class="line-removed">107         }</span>
<span class="line-removed">108         catch (IOException e) {</span>
<span class="line-removed">109             throw new RuntimeException(e);</span>
<span class="line-removed">110         }</span>
<span class="line-removed">111         assertCompileSucceededWithWarning(warning);</span>
<span class="line-removed">112     }</span>
113 
<span class="line-modified">114     private void assertFail(String expectedDiag, String... constructs) {</span>
<span class="line-modified">115         reset();</span>
<span class="line-modified">116         addCompileOptions(PREVIEW_OPTIONS);</span>
<span class="line-removed">117         program(constructs);</span>
<span class="line-removed">118         try {</span>
<span class="line-removed">119             compile();</span>
<span class="line-removed">120         }</span>
<span class="line-removed">121         catch (IOException e) {</span>
<span class="line-removed">122             throw new RuntimeException(e);</span>
<span class="line-removed">123         }</span>
<span class="line-removed">124         assertCompileFailed(expectedDiag);</span>
125     }
126 
127     public void testReallySimpleCases() {
128         for (String s : CONTAINERS)
129             assertOK(s, NOTHING);
130         for (String s : CONTAINER_STATEMENTS)
131             assertOK(LABEL, s, NOTHING);
132     }
133 
134     public void testLambda() {
135         assertOK(RUNNABLE, RETURN_N);
136         assertOK(RUNNABLE, NOTHING);
137         assertOK(INT_FN, RETURN_Z);
138         assertFail(&quot;compiler.err.break.outside.switch.loop&quot;, RUNNABLE, BREAK_N);
<span class="line-modified">139         assertFail(&quot;compiler.err.break.complex.value.no.switch.expression&quot;, RUNNABLE, BREAK_Z);</span>
<span class="line-modified">140         assertFail(&quot;compiler.err.break.complex.value.no.switch.expression&quot;, RUNNABLE, BREAK_S);</span>
141         assertFail(&quot;compiler.err.break.outside.switch.loop&quot;, INT_FN, BREAK_N);
<span class="line-modified">142         assertFail(&quot;compiler.err.break.complex.value.no.switch.expression&quot;, INT_FN, BREAK_Z);</span>
<span class="line-modified">143         assertFail(&quot;compiler.err.break.complex.value.no.switch.expression&quot;, INT_FN, BREAK_S);</span>
144         assertFail(&quot;compiler.err.cont.outside.loop&quot;, RUNNABLE, CONTINUE_N);
145         assertFail(&quot;compiler.err.undef.label&quot;, RUNNABLE, BREAK_L);
146         assertFail(&quot;compiler.err.undef.label&quot;, RUNNABLE, CONTINUE_L);
147         assertFail(&quot;compiler.err.cont.outside.loop&quot;, INT_FN, CONTINUE_N);
148         assertFail(&quot;compiler.err.undef.label&quot;, INT_FN, BREAK_L);
149         assertFail(&quot;compiler.err.undef.label&quot;, INT_FN, CONTINUE_L);
150         assertFail(&quot;compiler.err.undef.label&quot;, LABEL, BLOCK, RUNNABLE, BREAK_L);
151         assertFail(&quot;compiler.err.undef.label&quot;, LABEL, BLOCK, RUNNABLE, CONTINUE_L);
152         assertFail(&quot;compiler.err.undef.label&quot;, LABEL, BLOCK, INT_FN, BREAK_L);
153         assertFail(&quot;compiler.err.undef.label&quot;, LABEL, BLOCK, INT_FN, CONTINUE_L);
154     }
155 
156     public void testEswitch() {
157         //Int-valued switch expressions
<span class="line-modified">158         assertOK(ESWITCH_Z, BREAK_Z);</span>
<span class="line-modified">159         assertOK(LABEL, BLOCK, ESWITCH_Z, BREAK_Z);</span>
<span class="line-modified">160         assertFail(&quot;compiler.err.break.missing.value&quot;, ESWITCH_Z, BREAK_N);</span>
<span class="line-modified">161         assertFail(&quot;compiler.err.prob.found.req&quot;, ESWITCH_Z, BREAK_S);</span>
<span class="line-modified">162         assertFail(&quot;compiler.err.cant.resolve.location&quot;, ESWITCH_Z, BREAK_L);</span>
163         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, LABEL, BLOCK, ESWITCH_Z, BREAK_L);
164         assertFail(&quot;compiler.err.undef.label&quot;, ESWITCH_Z, CONTINUE_L);
<span class="line-modified">165         assertFail(&quot;compiler.err.cont.outside.loop&quot;, ESWITCH_Z, CONTINUE_N);</span>
166         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, ESWITCH_Z, RETURN_N);
167         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, ESWITCH_Z, RETURN_Z);
168 
<span class="line-modified">169         assertOK(INT_ESWITCH_DEFAULT, BREAK_Z);</span>
<span class="line-modified">170         assertFail(&quot;compiler.err.break.missing.value&quot;, INT_ESWITCH_DEFAULT, BREAK_N);</span>
<span class="line-modified">171         assertFail(&quot;compiler.err.prob.found.req&quot;, INT_ESWITCH_DEFAULT, BREAK_S);</span>
<span class="line-modified">172         assertFail(&quot;compiler.err.cant.resolve.location&quot;, INT_ESWITCH_DEFAULT, BREAK_L);</span>
173 
174 
175         // String-valued switch expressions
<span class="line-modified">176         assertOK(ESWITCH_S, BREAK_S);</span>
<span class="line-modified">177         assertOK(LABEL, BLOCK, ESWITCH_S, BREAK_S);</span>
<span class="line-modified">178         assertFail(&quot;compiler.err.break.missing.value&quot;, ESWITCH_S, BREAK_N);</span>
<span class="line-modified">179         assertFail(&quot;compiler.err.prob.found.req&quot;, ESWITCH_S, BREAK_Z);</span>
<span class="line-modified">180         assertFail(&quot;compiler.err.cant.resolve.location&quot;, ESWITCH_S, BREAK_L);</span>
181         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, LABEL, BLOCK, ESWITCH_S, BREAK_L);
182         assertFail(&quot;compiler.err.undef.label&quot;, ESWITCH_S, CONTINUE_L);
<span class="line-modified">183         assertFail(&quot;compiler.err.cont.outside.loop&quot;, ESWITCH_S, CONTINUE_N);</span>
184         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, ESWITCH_S, RETURN_N);
185         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, ESWITCH_S, RETURN_S);
186         // Function-valued switch expression
<span class="line-modified">187         assertOK(INT_FN_ESWITCH, BREAK_INT_FN);</span>
<span class="line-modified">188         assertFail(&quot;compiler.err.break.missing.value&quot;, INT_FN_ESWITCH, BREAK_N);</span>
<span class="line-modified">189         assertFail(&quot;compiler.err.prob.found.req&quot;, INT_FN_ESWITCH, BREAK_Z);</span>
<span class="line-modified">190         assertFail(&quot;compiler.err.prob.found.req&quot;, INT_FN_ESWITCH, BREAK_S);</span>
191 
<span class="line-modified">192         assertFail(&quot;compiler.err.cant.resolve.location&quot;, INT_FN_ESWITCH, BREAK_L);</span>
193         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, LABEL, BLOCK, INT_FN_ESWITCH, BREAK_L);
194         assertFail(&quot;compiler.err.undef.label&quot;, INT_FN_ESWITCH, CONTINUE_L);
<span class="line-modified">195         assertFail(&quot;compiler.err.cont.outside.loop&quot;, INT_FN_ESWITCH, CONTINUE_N);</span>
196         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, INT_FN_ESWITCH, RETURN_N);
197         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, INT_FN_ESWITCH, RETURN_S);
198 
199     }
200 
201     public void testNestedInExpSwitch() {
<span class="line-modified">202         assertOK(ESWITCH_Z, IF,     BREAK_Z);</span>
<span class="line-modified">203         assertOK(ESWITCH_Z, BLOCK,  BREAK_Z);</span>
204         //
<span class="line-modified">205         assertOK(ESWITCH_Z, IF,     IF,     BREAK_Z);</span>
<span class="line-modified">206         assertOK(ESWITCH_Z, IF,     BLOCK,  BREAK_Z);</span>
<span class="line-modified">207         assertOK(ESWITCH_Z, BLOCK,  IF,     BREAK_Z);</span>
<span class="line-modified">208         assertOK(ESWITCH_Z, BLOCK,  BLOCK,  BREAK_Z);</span>
209         //
<span class="line-modified">210         assertOK(ESWITCH_Z, IF,     IF,     IF,     BREAK_Z);</span>
<span class="line-modified">211         assertOK(ESWITCH_Z, IF,     IF,     BLOCK,  BREAK_Z);</span>
<span class="line-modified">212         assertOK(ESWITCH_Z, IF,     BLOCK,  IF,     BREAK_Z);</span>
<span class="line-modified">213         assertOK(ESWITCH_Z, IF,     BLOCK,  BLOCK,  BREAK_Z);</span>
<span class="line-modified">214         assertOK(ESWITCH_Z, BLOCK,  IF,     IF,     BREAK_Z);</span>
<span class="line-modified">215         assertOK(ESWITCH_Z, BLOCK,  IF,     BLOCK,  BREAK_Z);</span>
<span class="line-modified">216         assertOK(ESWITCH_Z, BLOCK,  BLOCK,  IF,     BREAK_Z);</span>
<span class="line-modified">217         assertOK(ESWITCH_Z, BLOCK,  BLOCK,  BLOCK,  BREAK_Z);</span>
218         //
<span class="line-modified">219         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, SSWITCH, BREAK_Z);</span>
<span class="line-modified">220         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, FOR, BREAK_Z);</span>
<span class="line-modified">221         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, WHILE, BREAK_Z);</span>
<span class="line-modified">222         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, DO, BREAK_Z);</span>
<span class="line-modified">223         assertFail(&quot;compiler.err.break.complex.value.no.switch.expression&quot;, ESWITCH_Z, INT_FN, BREAK_Z);</span>
<span class="line-modified">224         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, SSWITCH, IF, BREAK_Z);</span>
<span class="line-modified">225         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, FOR, IF, BREAK_Z);</span>
<span class="line-modified">226         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, WHILE, IF, BREAK_Z);</span>
<span class="line-modified">227         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, DO, IF, BREAK_Z);</span>
<span class="line-modified">228         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, BLOCK, SSWITCH, IF, BREAK_Z);</span>
<span class="line-modified">229         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, BLOCK, FOR, IF, BREAK_Z);</span>
<span class="line-modified">230         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, BLOCK, WHILE, IF, BREAK_Z);</span>
<span class="line-modified">231         assertFail(&quot;compiler.err.break.expr.not.immediate&quot;, ESWITCH_Z, BLOCK, DO, IF, BREAK_Z);</span>
232     }
233 
234     public void testBreakExpressionLabelDisambiguation() {
<span class="line-modified">235         assertOK(DEF_LABEL_VAR, ESWITCH_Z, BREAK_L);</span>
<span class="line-modified">236         assertFail(&quot;compiler.err.break.ambiguous.target&quot;, LABEL, FOR, BLOCK, DEF_LABEL_VAR, ESWITCH_Z, BREAK_L);</span>
<span class="line-modified">237         assertFail(&quot;compiler.err.break.ambiguous.target&quot;, DEF_LABEL_VAR, ESWITCH_Z, LABEL, FOR, BREAK_L); //label break</span>
<span class="line-modified">238         assertFail(&quot;compiler.err.break.ambiguous.target&quot;, DEF_LABEL_VAR, LABEL, BLOCK, ESWITCH_Z, BREAK_L); //expression break</span>


239         //
240     }
241 
242     public void testFunReturningSwitchExp() {
<span class="line-modified">243         assertOK(INT_FN_ESWITCH, BREAK_INT_FN);</span>
244     }
245 
246     public void testContinueLoops() {
247         assertOK(LABEL, FOR, CONTINUE_L);
248         assertOK(LABEL, FOR_EACH, CONTINUE_L);
249         assertOK(LABEL, WHILE, CONTINUE_L);
250         assertOK(LABEL, DO, CONTINUE_L);
251         assertFail(&quot;compiler.err.not.loop.label&quot;, LABEL, CONTINUE_L);
252     }
253 }
</pre>
</td>
<td>
<hr />
<pre>
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.io.IOException;
 25 import java.util.List;
 26 
 27 import org.testng.ITestResult;
 28 import org.testng.annotations.AfterMethod;
 29 import org.testng.annotations.Test;
<span class="line-added"> 30 import tools.javac.combo.CompilationTestCase;</span>
 31 import tools.javac.combo.JavacTemplateTestBase;
 32 
 33 import static java.util.stream.Collectors.toList;
 34 
 35 @Test
<span class="line-modified"> 36 public class ExpSwitchNestingTest extends CompilationTestCase {</span>
 37     private static final String RUNNABLE = &quot;Runnable r = () -&gt; { # };&quot;;
 38     private static final String INT_FN = &quot;java.util.function.IntSupplier r = () -&gt; { # };&quot;;
 39     private static final String LABEL = &quot;label: #&quot;;
 40     private static final String DEF_LABEL_VAR = &quot;int label = 0; { # }&quot;;
 41     private static final String FOR = &quot;for (int i=0; i&lt;10; i++) { # }&quot;;
 42     private static final String FOR_EACH = &quot;for (int i : new int[] {}) { # }&quot;;
 43     private static final String WHILE = &quot;while (cond) { # }&quot;;
 44     private static final String DO = &quot;do { # } while (cond);&quot;;
 45     private static final String SSWITCH = &quot;switch (x) { case 0: # };&quot;;
 46     private static final String ESWITCH_Z = &quot;int res = switch (x) { case 0 -&gt; { # } default -&gt; 0; };&quot;;
 47     private static final String ESWITCH_S = &quot;String res_string = switch (x) { case 0 -&gt; { # } default -&gt; \&quot;default\&quot;; };&quot;;
 48     private static final String INT_FN_ESWITCH = &quot;java.util.function.IntSupplier r = switch (x) { case 0 -&gt; { # } default -&gt; null; };&quot;;
 49     private static final String INT_ESWITCH_DEFAULT = &quot;int res = switch (x) { default -&gt; { # } };&quot;;
 50     private static final String IF = &quot;if (cond) { # } else throw new RuntimeException();&quot;;
 51     private static final String BLOCK = &quot;{ # }&quot;;
<span class="line-modified"> 52     private static final String YIELD_Z = &quot;yield 0;&quot;;</span>
<span class="line-modified"> 53     private static final String YIELD_S = &quot;yield \&quot;hello world\&quot;;&quot;;</span>
<span class="line-modified"> 54     private static final String YIELD_INT_FN = &quot;yield () -&gt; 0 ;&quot;;</span>
 55     private static final String BREAK_N = &quot;break;&quot;;
 56     private static final String BREAK_L = &quot;break label;&quot;;
<span class="line-added"> 57     private static final String YIELD_L = &quot;yield label;&quot;;</span>
 58     private static final String RETURN_Z = &quot;return 0;&quot;;
 59     private static final String RETURN_N = &quot;return;&quot;;
 60     private static final String RETURN_S = &quot;return \&quot;Hello\&quot;;&quot;;
 61     private static final String CONTINUE_N = &quot;continue;&quot;;
 62     private static final String CONTINUE_L = &quot;continue label;&quot;;
 63     private static final String NOTHING = &quot;System.out.println();&quot;;
 64 
 65     // containers that do not require exhaustiveness
 66     private static final List&lt;String&gt; CONTAINERS
 67             = List.of(RUNNABLE, FOR, WHILE, DO, SSWITCH, IF, BLOCK);
 68     // containers that do not require exhaustiveness that are statements
 69     private static final List&lt;String&gt; CONTAINER_STATEMENTS
 70             = List.of(FOR, WHILE, DO, SSWITCH, IF, BLOCK);
 71 
<span class="line-modified"> 72     // @@@ When expression switch becomes a permanent feature, we don&#39;t need these any more</span>
<span class="line-modified"> 73     private static final String SHELL = &quot;class C { static boolean cond = false; static int x = 0; void m() { # } }&quot;;</span>









































 74 
<span class="line-modified"> 75     {</span>
<span class="line-modified"> 76         setDefaultFilename(&quot;C.java&quot;);</span>
<span class="line-modified"> 77         setProgramShell(SHELL);</span>








 78     }
 79 
 80     public void testReallySimpleCases() {
 81         for (String s : CONTAINERS)
 82             assertOK(s, NOTHING);
 83         for (String s : CONTAINER_STATEMENTS)
 84             assertOK(LABEL, s, NOTHING);
 85     }
 86 
 87     public void testLambda() {
 88         assertOK(RUNNABLE, RETURN_N);
 89         assertOK(RUNNABLE, NOTHING);
 90         assertOK(INT_FN, RETURN_Z);
 91         assertFail(&quot;compiler.err.break.outside.switch.loop&quot;, RUNNABLE, BREAK_N);
<span class="line-modified"> 92         assertFail(&quot;compiler.err.no.switch.expression&quot;, RUNNABLE, YIELD_Z);</span>
<span class="line-modified"> 93         assertFail(&quot;compiler.err.no.switch.expression&quot;, RUNNABLE, YIELD_S);</span>
 94         assertFail(&quot;compiler.err.break.outside.switch.loop&quot;, INT_FN, BREAK_N);
<span class="line-modified"> 95         assertFail(&quot;compiler.err.no.switch.expression&quot;, INT_FN, YIELD_Z);</span>
<span class="line-modified"> 96         assertFail(&quot;compiler.err.no.switch.expression&quot;, INT_FN, YIELD_S);</span>
 97         assertFail(&quot;compiler.err.cont.outside.loop&quot;, RUNNABLE, CONTINUE_N);
 98         assertFail(&quot;compiler.err.undef.label&quot;, RUNNABLE, BREAK_L);
 99         assertFail(&quot;compiler.err.undef.label&quot;, RUNNABLE, CONTINUE_L);
100         assertFail(&quot;compiler.err.cont.outside.loop&quot;, INT_FN, CONTINUE_N);
101         assertFail(&quot;compiler.err.undef.label&quot;, INT_FN, BREAK_L);
102         assertFail(&quot;compiler.err.undef.label&quot;, INT_FN, CONTINUE_L);
103         assertFail(&quot;compiler.err.undef.label&quot;, LABEL, BLOCK, RUNNABLE, BREAK_L);
104         assertFail(&quot;compiler.err.undef.label&quot;, LABEL, BLOCK, RUNNABLE, CONTINUE_L);
105         assertFail(&quot;compiler.err.undef.label&quot;, LABEL, BLOCK, INT_FN, BREAK_L);
106         assertFail(&quot;compiler.err.undef.label&quot;, LABEL, BLOCK, INT_FN, CONTINUE_L);
107     }
108 
109     public void testEswitch() {
110         //Int-valued switch expressions
<span class="line-modified">111         assertOK(ESWITCH_Z, YIELD_Z);</span>
<span class="line-modified">112         assertOK(LABEL, BLOCK, ESWITCH_Z, YIELD_Z);</span>
<span class="line-modified">113         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, ESWITCH_Z, BREAK_N);</span>
<span class="line-modified">114         assertFail(&quot;compiler.err.prob.found.req&quot;, ESWITCH_Z, YIELD_S);</span>
<span class="line-modified">115         assertFail(&quot;compiler.err.undef.label&quot;, ESWITCH_Z, BREAK_L);</span>
116         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, LABEL, BLOCK, ESWITCH_Z, BREAK_L);
117         assertFail(&quot;compiler.err.undef.label&quot;, ESWITCH_Z, CONTINUE_L);
<span class="line-modified">118         assertFail(&quot;compiler.err.continue.outside.switch.expression&quot;, ESWITCH_Z, CONTINUE_N);</span>
119         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, ESWITCH_Z, RETURN_N);
120         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, ESWITCH_Z, RETURN_Z);
121 
<span class="line-modified">122         assertOK(INT_ESWITCH_DEFAULT, YIELD_Z);</span>
<span class="line-modified">123         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, INT_ESWITCH_DEFAULT, BREAK_N);</span>
<span class="line-modified">124         assertFail(&quot;compiler.err.prob.found.req&quot;, INT_ESWITCH_DEFAULT, YIELD_S);</span>
<span class="line-modified">125         assertFail(&quot;compiler.err.undef.label&quot;, INT_ESWITCH_DEFAULT, BREAK_L);</span>
126 
127 
128         // String-valued switch expressions
<span class="line-modified">129         assertOK(ESWITCH_S, YIELD_S);</span>
<span class="line-modified">130         assertOK(LABEL, BLOCK, ESWITCH_S, YIELD_S);</span>
<span class="line-modified">131         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, ESWITCH_S, BREAK_N);</span>
<span class="line-modified">132         assertFail(&quot;compiler.err.prob.found.req&quot;, ESWITCH_S, YIELD_Z);</span>
<span class="line-modified">133         assertFail(&quot;compiler.err.undef.label&quot;, ESWITCH_S, BREAK_L);</span>
134         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, LABEL, BLOCK, ESWITCH_S, BREAK_L);
135         assertFail(&quot;compiler.err.undef.label&quot;, ESWITCH_S, CONTINUE_L);
<span class="line-modified">136         assertFail(&quot;compiler.err.continue.outside.switch.expression&quot;, ESWITCH_S, CONTINUE_N);</span>
137         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, ESWITCH_S, RETURN_N);
138         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, ESWITCH_S, RETURN_S);
139         // Function-valued switch expression
<span class="line-modified">140         assertOK(INT_FN_ESWITCH, YIELD_INT_FN);</span>
<span class="line-modified">141         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, INT_FN_ESWITCH, BREAK_N);</span>
<span class="line-modified">142         assertFail(&quot;compiler.err.prob.found.req&quot;, INT_FN_ESWITCH, YIELD_Z);</span>
<span class="line-modified">143         assertFail(&quot;compiler.err.prob.found.req&quot;, INT_FN_ESWITCH, YIELD_S);</span>
144 
<span class="line-modified">145         assertFail(&quot;compiler.err.undef.label&quot;, INT_FN_ESWITCH, BREAK_L);</span>
146         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, LABEL, BLOCK, INT_FN_ESWITCH, BREAK_L);
147         assertFail(&quot;compiler.err.undef.label&quot;, INT_FN_ESWITCH, CONTINUE_L);
<span class="line-modified">148         assertFail(&quot;compiler.err.continue.outside.switch.expression&quot;, INT_FN_ESWITCH, CONTINUE_N);</span>
149         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, INT_FN_ESWITCH, RETURN_N);
150         assertFail(&quot;compiler.err.return.outside.switch.expression&quot;, INT_FN_ESWITCH, RETURN_S);
151 
152     }
153 
154     public void testNestedInExpSwitch() {
<span class="line-modified">155         assertOK(ESWITCH_Z, IF,     YIELD_Z);</span>
<span class="line-modified">156         assertOK(ESWITCH_Z, BLOCK,  YIELD_Z);</span>
157         //
<span class="line-modified">158         assertOK(ESWITCH_Z, IF,     IF,     YIELD_Z);</span>
<span class="line-modified">159         assertOK(ESWITCH_Z, IF,     BLOCK,  YIELD_Z);</span>
<span class="line-modified">160         assertOK(ESWITCH_Z, BLOCK,  IF,     YIELD_Z);</span>
<span class="line-modified">161         assertOK(ESWITCH_Z, BLOCK,  BLOCK,  YIELD_Z);</span>
162         //
<span class="line-modified">163         assertOK(ESWITCH_Z, IF,     IF,     IF,     YIELD_Z);</span>
<span class="line-modified">164         assertOK(ESWITCH_Z, IF,     IF,     BLOCK,  YIELD_Z);</span>
<span class="line-modified">165         assertOK(ESWITCH_Z, IF,     BLOCK,  IF,     YIELD_Z);</span>
<span class="line-modified">166         assertOK(ESWITCH_Z, IF,     BLOCK,  BLOCK,  YIELD_Z);</span>
<span class="line-modified">167         assertOK(ESWITCH_Z, BLOCK,  IF,     IF,     YIELD_Z);</span>
<span class="line-modified">168         assertOK(ESWITCH_Z, BLOCK,  IF,     BLOCK,  YIELD_Z);</span>
<span class="line-modified">169         assertOK(ESWITCH_Z, BLOCK,  BLOCK,  IF,     YIELD_Z);</span>
<span class="line-modified">170         assertOK(ESWITCH_Z, BLOCK,  BLOCK,  BLOCK,  YIELD_Z);</span>
171         //
<span class="line-modified">172         assertOK(ESWITCH_Z, YIELD_Z, SSWITCH, YIELD_Z);</span>
<span class="line-modified">173         assertOK(ESWITCH_Z, YIELD_Z, FOR, YIELD_Z);</span>
<span class="line-modified">174         assertOK(ESWITCH_Z, YIELD_Z, WHILE, YIELD_Z);</span>
<span class="line-modified">175         assertOK(ESWITCH_Z, YIELD_Z, DO, YIELD_Z);</span>
<span class="line-modified">176         assertFail(&quot;compiler.err.no.switch.expression&quot;, ESWITCH_Z, INT_FN, YIELD_Z);</span>
<span class="line-modified">177         assertOK(ESWITCH_Z, YIELD_Z, SSWITCH, IF, YIELD_Z);</span>
<span class="line-modified">178         assertOK(ESWITCH_Z, YIELD_Z, FOR, IF, YIELD_Z);</span>
<span class="line-modified">179         assertOK(ESWITCH_Z, YIELD_Z, WHILE, IF, YIELD_Z);</span>
<span class="line-modified">180         assertOK(ESWITCH_Z, YIELD_Z, DO, IF, YIELD_Z);</span>
<span class="line-modified">181         assertOK(ESWITCH_Z, YIELD_Z, BLOCK, SSWITCH, IF, YIELD_Z);</span>
<span class="line-modified">182         assertOK(ESWITCH_Z, YIELD_Z, BLOCK, FOR, IF, YIELD_Z);</span>
<span class="line-modified">183         assertOK(ESWITCH_Z, YIELD_Z, BLOCK, WHILE, IF, YIELD_Z);</span>
<span class="line-modified">184         assertOK(ESWITCH_Z, YIELD_Z, BLOCK, DO, IF, YIELD_Z);</span>
185     }
186 
187     public void testBreakExpressionLabelDisambiguation() {
<span class="line-modified">188         assertOK(DEF_LABEL_VAR, ESWITCH_Z, YIELD_L);</span>
<span class="line-modified">189         assertFail(&quot;compiler.err.undef.label&quot;, DEF_LABEL_VAR, ESWITCH_Z, BREAK_L);</span>
<span class="line-modified">190         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, LABEL, FOR, BLOCK, DEF_LABEL_VAR, ESWITCH_Z, BREAK_L);</span>
<span class="line-modified">191         assertOK(DEF_LABEL_VAR, ESWITCH_Z, YIELD_Z, LABEL, FOR, BREAK_L); //label break</span>
<span class="line-added">192         assertFail(&quot;compiler.err.break.outside.switch.expression&quot;, DEF_LABEL_VAR, LABEL, BLOCK, ESWITCH_Z, BREAK_L);</span>
<span class="line-added">193         assertOK(DEF_LABEL_VAR, LABEL, BLOCK, ESWITCH_Z, YIELD_L); //expression break</span>
194         //
195     }
196 
197     public void testFunReturningSwitchExp() {
<span class="line-modified">198         assertOK(INT_FN_ESWITCH, YIELD_INT_FN);</span>
199     }
200 
201     public void testContinueLoops() {
202         assertOK(LABEL, FOR, CONTINUE_L);
203         assertOK(LABEL, FOR_EACH, CONTINUE_L);
204         assertOK(LABEL, WHILE, CONTINUE_L);
205         assertOK(LABEL, DO, CONTINUE_L);
206         assertFail(&quot;compiler.err.not.loop.label&quot;, LABEL, CONTINUE_L);
207     }
208 }
</pre>
</td>
</tr>
</table>
<center><a href="../enum/EnumMembersOrder.out.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../failover/CheckAttributedTree.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>