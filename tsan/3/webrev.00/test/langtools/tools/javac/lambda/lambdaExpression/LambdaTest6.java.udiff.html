<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/langtools/tools/javac/lambda/lambdaExpression/LambdaTest6.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../deduplication/DeduplicationTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../methodReference/BridgeMethod.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/lambda/lambdaExpression/LambdaTest6.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -24,12 +24,15 @@</span>
  /**
   * @test
   * @bug 8003280
   * @summary Add lambda tests
   *   Test bridge methods for certain SAM conversions
<span class="udiff-line-added">+  *   Tests that jdk.internal.lambda.disableEagerInitialization=true creates a</span>
<span class="udiff-line-added">+  *   get$Lambda method for non-capturing lambdas</span>
   * @compile LambdaTest6.java
   * @run main LambdaTest6
<span class="udiff-line-added">+  * @run main/othervm -Djdk.internal.lambda.disableEagerInitialization=true LambdaTest6</span>
   */
  
  import java.lang.reflect.Method;
  import java.util.HashSet;
  import java.util.Set;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -58,38 +61,59 @@</span>
          s.add(&quot;java.lang.String&quot;);
          s.add(&quot;java.lang.Object&quot;);
          return s;
      }
  
<span class="udiff-line-added">+     private static Set&lt;String&gt; allowedMethods() {</span>
<span class="udiff-line-added">+         Set&lt;String&gt; s = new HashSet&lt;&gt;();</span>
<span class="udiff-line-added">+         s.add(&quot;m&quot;);</span>
<span class="udiff-line-added">+         if (Boolean.getBoolean(&quot;jdk.internal.lambda.disableEagerInitialization&quot;)) {</span>
<span class="udiff-line-added">+             s.add(&quot;get$Lambda&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return s;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean matchingMethodNames(Method[] methods) {</span>
<span class="udiff-line-added">+         Set&lt;String&gt; methodNames = new HashSet&lt;&gt;();</span>
<span class="udiff-line-added">+         for (Method m : methods) {</span>
<span class="udiff-line-added">+             methodNames.add(m.getName());</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return methodNames.equals(allowedMethods());</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      private void test1()
      {
          L la = s -&gt; { };
          la.m(&quot;hi&quot;);
          Class&lt;? extends L&gt; c1 = la.getClass();
          Method[] methods = c1.getDeclaredMethods();
<span class="udiff-line-added">+         assertTrue(matchingMethodNames(methods));</span>
          Set&lt;String&gt; types = setOfStringObject();
          for(Method m : methods) {
<span class="udiff-line-modified-removed">-             assertTrue(m.getName().equals(&quot;m&quot;));</span>
<span class="udiff-line-modified-removed">-             Class[] parameterTypes = m.getParameterTypes();</span>
<span class="udiff-line-modified-removed">-             assertTrue(parameterTypes.length == 1);</span>
<span class="udiff-line-modified-removed">-             assertTrue(types.remove(parameterTypes[0].getName()));</span>
<span class="udiff-line-modified-added">+             if (&quot;m&quot;.equals(m.getName())) {</span>
<span class="udiff-line-modified-added">+                 Class[] parameterTypes = m.getParameterTypes();</span>
<span class="udiff-line-modified-added">+                 assertTrue(parameterTypes.length == 1);</span>
<span class="udiff-line-modified-added">+                 assertTrue(types.remove(parameterTypes[0].getName()));</span>
<span class="udiff-line-added">+             }</span>
          }
          assertTrue(types.isEmpty() || (types.size() == 1 &amp;&amp; types.contains(&quot;java.lang.String&quot;)));
      }
  
      private void test2()
      {
          KM km = s -&gt; { };
          //km.m(&quot;hi&quot;);
          Class&lt;? extends KM&gt; c2 = km.getClass();
          Method[] methods = c2.getDeclaredMethods();
<span class="udiff-line-added">+         assertTrue(matchingMethodNames(methods));</span>
          Set&lt;String&gt; types = setOfStringObject();
          for(Method m : methods) {
<span class="udiff-line-modified-removed">-             assertTrue(m.getName().equals(&quot;m&quot;));</span>
<span class="udiff-line-modified-removed">-             Class[] parameterTypes = m.getParameterTypes();</span>
<span class="udiff-line-modified-removed">-             assertTrue(parameterTypes.length == 1);</span>
<span class="udiff-line-modified-removed">-             assertTrue(types.remove(parameterTypes[0].getName()));</span>
<span class="udiff-line-modified-added">+             if (&quot;m&quot;.equals(m.getName())) {</span>
<span class="udiff-line-modified-added">+                 Class[] parameterTypes = m.getParameterTypes();</span>
<span class="udiff-line-modified-added">+                 assertTrue(parameterTypes.length == 1);</span>
<span class="udiff-line-modified-added">+                 assertTrue(types.remove(parameterTypes[0].getName()));</span>
<span class="udiff-line-added">+             }</span>
          }
          assertTrue(types.isEmpty());
      }
  
      private void test3()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,15 +121,17 @@</span>
          N na = ()-&gt; &quot;hi&quot;;
          assertTrue( na.m().equals(&quot;hi&quot;) );
          assertTrue( ((H)na).m().equals(&quot;hi&quot;) );
          Class&lt;? extends N&gt; c3 = na.getClass();
          Method[] methods = c3.getDeclaredMethods();
<span class="udiff-line-added">+         assertTrue(matchingMethodNames(methods));</span>
          Set&lt;String&gt; types = setOfStringObject();
          for(Method m : methods) {
<span class="udiff-line-modified-removed">-             assertTrue(m.getName().equals(&quot;m&quot;));</span>
<span class="udiff-line-modified-removed">-             Class returnType = m.getReturnType();</span>
<span class="udiff-line-modified-removed">-             assertTrue(types.remove(returnType.getName()));</span>
<span class="udiff-line-modified-added">+             if (&quot;m&quot;.equals(m.getName())) {</span>
<span class="udiff-line-modified-added">+                 Class returnType = m.getReturnType();</span>
<span class="udiff-line-modified-added">+                 assertTrue(types.remove(returnType.getName()));</span>
<span class="udiff-line-added">+             }</span>
          }
          assertTrue(types.size() == 1); //there&#39;s a bridge
      }
  
  
</pre>
<center><a href="../deduplication/DeduplicationTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../methodReference/BridgeMethod.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>