<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/lambda/TestBootstrapMethodsCount.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="MethodReferenceParserTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestInvokeDynamic.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/lambda/TestBootstrapMethodsCount.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 44 import javax.tools.JavaCompiler;
 45 import javax.tools.JavaFileObject;
 46 import javax.tools.SimpleJavaFileObject;
 47 import javax.tools.ToolProvider;
 48 
 49 import com.sun.source.tree.MethodInvocationTree;
 50 import com.sun.source.tree.MethodTree;
 51 import com.sun.source.util.TaskEvent;
 52 import com.sun.source.util.TaskListener;
 53 import com.sun.source.util.TreeScanner;
 54 
 55 import com.sun.tools.classfile.Attribute;
 56 import com.sun.tools.classfile.BootstrapMethods_attribute;
 57 import com.sun.tools.classfile.ClassFile;
 58 
 59 import com.sun.tools.javac.api.JavacTaskImpl;
 60 import com.sun.tools.javac.code.Symbol;
 61 import com.sun.tools.javac.code.Symbol.MethodSymbol;
 62 import com.sun.tools.javac.code.Symtab;
 63 import com.sun.tools.javac.code.Types;

 64 import com.sun.tools.javac.tree.JCTree.JCMethodInvocation;
 65 import com.sun.tools.javac.tree.JCTree.JCMethodDecl;
 66 import com.sun.tools.javac.tree.JCTree.JCIdent;
 67 import com.sun.tools.javac.util.Context;
 68 import com.sun.tools.javac.util.Names;
 69 
 70 import static com.sun.tools.javac.jvm.ClassFile.*;
 71 
 72 public class TestBootstrapMethodsCount {
 73 
 74     public static void main(String... args) throws Exception {
 75         JavaCompiler comp = ToolProvider.getSystemJavaCompiler();
 76         new TestBootstrapMethodsCount().run(comp);
 77     }
 78 
 79     DiagChecker dc;
 80 
 81     TestBootstrapMethodsCount() {
 82         dc = new DiagChecker();
 83     }
</pre>
<hr />
<pre>
173         @Override
174         public void started(TaskEvent e) {
175             //do nothing
176         }
177 
178         @Override
179         public void finished(TaskEvent e) {
180             if (e.getKind() == TaskEvent.Kind.ANALYZE) {
181                 scan(e.getCompilationUnit(), null);
182             }
183         }
184 
185         @Override
186         public Void visitMethodInvocation(MethodInvocationTree node, Void p) {
187             super.visitMethodInvocation(node, p);
188             JCMethodInvocation apply = (JCMethodInvocation)node;
189             JCIdent ident = (JCIdent)apply.meth;
190             Symbol oldSym = ident.sym;
191             if (!oldSym.isConstructor()) {
192                 ident.sym = new Symbol.DynamicMethodSymbol(oldSym.name,
<span class="line-modified">193                         oldSym.owner, REF_invokeStatic, bsm, oldSym.type, new Object[0]);</span>
194             }
195             return null;
196         }
197 
198         @Override
199         public Void visitMethod(MethodTree node, Void p) {
200             super.visitMethod(node, p);
201             if (node.getName().toString().equals(&quot;bsm&quot;)) {
202                 bsm = ((JCMethodDecl)node).sym;
203             }
204             return null;
205         }
206     }
207 
208     static class DiagChecker
209             implements javax.tools.DiagnosticListener&lt;JavaFileObject&gt; {
210 
211         boolean diagFound;
212         ArrayList&lt;String&gt; diags = new ArrayList&lt;&gt;();
213 
</pre>
</td>
<td>
<hr />
<pre>
 44 import javax.tools.JavaCompiler;
 45 import javax.tools.JavaFileObject;
 46 import javax.tools.SimpleJavaFileObject;
 47 import javax.tools.ToolProvider;
 48 
 49 import com.sun.source.tree.MethodInvocationTree;
 50 import com.sun.source.tree.MethodTree;
 51 import com.sun.source.util.TaskEvent;
 52 import com.sun.source.util.TaskListener;
 53 import com.sun.source.util.TreeScanner;
 54 
 55 import com.sun.tools.classfile.Attribute;
 56 import com.sun.tools.classfile.BootstrapMethods_attribute;
 57 import com.sun.tools.classfile.ClassFile;
 58 
 59 import com.sun.tools.javac.api.JavacTaskImpl;
 60 import com.sun.tools.javac.code.Symbol;
 61 import com.sun.tools.javac.code.Symbol.MethodSymbol;
 62 import com.sun.tools.javac.code.Symtab;
 63 import com.sun.tools.javac.code.Types;
<span class="line-added"> 64 import com.sun.tools.javac.jvm.PoolConstant.LoadableConstant;</span>
 65 import com.sun.tools.javac.tree.JCTree.JCMethodInvocation;
 66 import com.sun.tools.javac.tree.JCTree.JCMethodDecl;
 67 import com.sun.tools.javac.tree.JCTree.JCIdent;
 68 import com.sun.tools.javac.util.Context;
 69 import com.sun.tools.javac.util.Names;
 70 
 71 import static com.sun.tools.javac.jvm.ClassFile.*;
 72 
 73 public class TestBootstrapMethodsCount {
 74 
 75     public static void main(String... args) throws Exception {
 76         JavaCompiler comp = ToolProvider.getSystemJavaCompiler();
 77         new TestBootstrapMethodsCount().run(comp);
 78     }
 79 
 80     DiagChecker dc;
 81 
 82     TestBootstrapMethodsCount() {
 83         dc = new DiagChecker();
 84     }
</pre>
<hr />
<pre>
174         @Override
175         public void started(TaskEvent e) {
176             //do nothing
177         }
178 
179         @Override
180         public void finished(TaskEvent e) {
181             if (e.getKind() == TaskEvent.Kind.ANALYZE) {
182                 scan(e.getCompilationUnit(), null);
183             }
184         }
185 
186         @Override
187         public Void visitMethodInvocation(MethodInvocationTree node, Void p) {
188             super.visitMethodInvocation(node, p);
189             JCMethodInvocation apply = (JCMethodInvocation)node;
190             JCIdent ident = (JCIdent)apply.meth;
191             Symbol oldSym = ident.sym;
192             if (!oldSym.isConstructor()) {
193                 ident.sym = new Symbol.DynamicMethodSymbol(oldSym.name,
<span class="line-modified">194                         oldSym.owner, bsm.asHandle(), oldSym.type, new LoadableConstant[0]);</span>
195             }
196             return null;
197         }
198 
199         @Override
200         public Void visitMethod(MethodTree node, Void p) {
201             super.visitMethod(node, p);
202             if (node.getName().toString().equals(&quot;bsm&quot;)) {
203                 bsm = ((JCMethodDecl)node).sym;
204             }
205             return null;
206         }
207     }
208 
209     static class DiagChecker
210             implements javax.tools.DiagnosticListener&lt;JavaFileObject&gt; {
211 
212         boolean diagFound;
213         ArrayList&lt;String&gt; diags = new ArrayList&lt;&gt;();
214 
</pre>
</td>
</tr>
</table>
<center><a href="MethodReferenceParserTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TestInvokeDynamic.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>