<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/classfiles/attributes/EnclosingMethod/EnclosingMethodTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../ClassVersionChecker.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../classreader/8171132/BadConstantValue.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/classfiles/attributes/EnclosingMethod/EnclosingMethodTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8042931</span>
 27  * @summary Checking EnclosingMethod attribute of anonymous/local class.
 28  * @library /tools/lib /tools/javac/lib ../lib
 29  * @modules jdk.compiler/com.sun.tools.javac.api
 30  *          jdk.compiler/com.sun.tools.javac.main
 31  *          jdk.jdeps/com.sun.tools.classfile
 32  * @build toolbox.ToolBox InMemoryFileManager TestResult TestBase
 33  * @run main EnclosingMethodTest
 34  */
 35 
 36 import com.sun.tools.classfile.Attribute;
 37 import com.sun.tools.classfile.ClassFile;
 38 import com.sun.tools.classfile.EnclosingMethod_attribute;
 39 
 40 import java.io.File;
 41 import java.io.FilenameFilter;
 42 import java.lang.annotation.Retention;
 43 import java.lang.annotation.RetentionPolicy;
 44 import java.util.HashMap;
 45 import java.util.HashSet;
 46 import java.util.Map;
</pre>
<hr />
<pre>
228         new EnclosingStaticInitialization() {
229         };
230     }
231 
232     {
233         // anonymous and local classes in instance initializer
234         @ExpectedEnclosingMethod(
235                 info = &quot;EnclosingInitialization in EnclosingMethodTest&quot;,
236                 enclosingClazz = EnclosingMethodTest.class
237         )
238         class EnclosingInitialization {
239         }
240         new EnclosingInitialization() {
241         };
242     }
243 
244     Runnable lambda = () -&gt; {
245         // anonymous and local classes in lambda
246         @ExpectedEnclosingMethod(
247                 info = &quot;EnclosingLambda in EnclosingMethodTest&quot;,
<span class="line-modified">248                 enclosingMethod = &quot;lambda&quot;,</span>
249                 enclosingClazz = EnclosingMethodTest.class
250         )
251         class EnclosingLambda {
252         }
253         new EnclosingLambda() {
254         };
255     };
256 
257     EnclosingMethodTest(int i) {
258         // anonymous and local classes in constructor
259         @ExpectedEnclosingMethod(
260                 info = &quot;EnclosingConstructor in EnclosingMethodTest&quot;,
261                 enclosingMethod = &quot;&lt;init&gt;&quot;,
262                 enclosingClazz = EnclosingMethodTest.class
263         )
264         class EnclosingConstructor {
265         }
266         new EnclosingConstructor() {
267         };
268     }
</pre>
<hr />
<pre>
308             new EnclosingStaticInitialization() {
309             };
310         }
311 
312         {
313             // anonymous and local classes in instance initializer
314             @ExpectedEnclosingMethod(
315                     info = &quot;EnclosingInitialization in notEnclosing01&quot;,
316                     enclosingClazz = notEnclosing01.class
317             )
318             class EnclosingInitialization {
319             }
320             new EnclosingInitialization() {
321             };
322         }
323 
324         Runnable lambda = () -&gt; {
325             // anonymous and local classes in lambda
326             @ExpectedEnclosingMethod(
327                     info = &quot;EnclosingLambda in notEnclosing01&quot;,
<span class="line-modified">328                     enclosingMethod = &quot;lambda&quot;,</span>
329                     enclosingClazz = notEnclosing01.class
330             )
331             class EnclosingLambda {
332             }
333             new EnclosingLambda() {
334             };
335         };
336 
337         notEnclosing01() {
338             // anonymous and local classes in constructor
339             @ExpectedEnclosingMethod(
340                     info = &quot;EnclosingConstructor in notEnclosing01&quot;,
341                     enclosingMethod = &quot;&lt;init&gt;&quot;,
342                     enclosingClazz = notEnclosing01.class
343             )
344             class EnclosingConstructor {
345             }
346             new EnclosingConstructor() {
347             };
348         }
</pre>
<hr />
<pre>
365                 enclosingClazz = notEnclosing01.class
366         )
367         static class VariableInitializer {
368         }
369 
370         // static variable initializer
371         private static final VariableInitializer cvi = new VariableInitializer() {
372         };
373 
374         // instance variable initializer
375         private final VariableInitializer ivi = new VariableInitializer() {
376         };
377     }
378 
379     // Test cases: enclosing class is an interface
380     public interface notEnclosing02 {
381         Runnable lambda = () -&gt; {
382             // anonymous and local classes in lambda
383             @ExpectedEnclosingMethod(
384                     info = &quot;EnclosingLambda in notEnclosing02&quot;,
<span class="line-modified">385                     enclosingMethod = &quot;lambda&quot;,</span>
386                     enclosingClazz = notEnclosing02.class
387             )
388             class EnclosingLambda {
389             }
390             new EnclosingLambda() {
391             };
392         };
393 
394         static void staticMethod() {
395             // anonymous and local classes in static method
396             @ExpectedEnclosingMethod(
397                     info = &quot;EnclosingMethod in notEnclosing02&quot;,
398                     enclosingMethod = &quot;staticMethod&quot;,
399                     enclosingClazz = notEnclosing02.class
400             )
401             class EnclosingMethod {
402             }
403             new EnclosingMethod() {
404             };
405         }
</pre>
<hr />
<pre>
443             new EnclosingStaticInitialization() {
444             };
445         }
446 
447         {
448             // anonymous and local classes in instance initializer
449             @ExpectedEnclosingMethod(
450                     info = &quot;EnclosingInitialization in notEnclosing03&quot;,
451                     enclosingClazz = notEnclosing03.class
452             )
453             class EnclosingInitialization {
454             }
455             new EnclosingInitialization() {
456             };
457         }
458 
459         Runnable lambda = () -&gt; {
460             // anonymous and local classes in lambda
461             @ExpectedEnclosingMethod(
462                     info = &quot;EnclosingLambda in notEnclosing03&quot;,
<span class="line-modified">463                     enclosingMethod = &quot;lambda&quot;,</span>
464                     enclosingClazz = notEnclosing03.class
465             )
466             class EnclosingLambda {
467             }
468             new EnclosingLambda() {
469             };
470         };
471 
472         notEnclosing03() {
473             // anonymous and local classes in constructor
474             @ExpectedEnclosingMethod(
475                     info = &quot;EnclosingConstructor in notEnclosing03&quot;,
476                     enclosingMethod = &quot;&lt;init&gt;&quot;,
477                     enclosingClazz = notEnclosing03.class
478             )
479             class EnclosingConstructor {
480             }
481             new EnclosingConstructor() {
482             };
483         }
</pre>
<hr />
<pre>
500                 enclosingClazz = notEnclosing03.class
501         )
502         static class VariableInitializer {
503         }
504 
505         // static variable initializer
506         private static final VariableInitializer cvi = new VariableInitializer() {
507         };
508 
509         // instance variable initializer
510         private final VariableInitializer ivi = new VariableInitializer() {
511         };
512     }
513 
514     // Test cases: enclosing class is an annotation
515     public @interface notEnclosing04 {
516         Runnable lambda = () -&gt; {
517             // anonymous and local classes in lambda
518             @ExpectedEnclosingMethod(
519                     info = &quot;EnclosingLambda in notEnclosing04&quot;,
<span class="line-modified">520                     enclosingMethod = &quot;lambda&quot;,</span>
521                     enclosingClazz = notEnclosing04.class
522             )
523             class EnclosingLambda {
524             }
525             new EnclosingLambda() {
526             };
527         };
528 
529         @ExpectedEnclosingMethod(
530                 info = &quot;VariableInitializer in notEnclosing04&quot;,
531                 enclosingClazz = notEnclosing04.class
532         )
533         static class VariableInitializer {
534         }
535 
536         // static variable initializer
537         VariableInitializer cvi = new VariableInitializer() {
538         };
539     }
540 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8042931 8215470</span>
 27  * @summary Checking EnclosingMethod attribute of anonymous/local class.
 28  * @library /tools/lib /tools/javac/lib ../lib
 29  * @modules jdk.compiler/com.sun.tools.javac.api
 30  *          jdk.compiler/com.sun.tools.javac.main
 31  *          jdk.jdeps/com.sun.tools.classfile
 32  * @build toolbox.ToolBox InMemoryFileManager TestResult TestBase
 33  * @run main EnclosingMethodTest
 34  */
 35 
 36 import com.sun.tools.classfile.Attribute;
 37 import com.sun.tools.classfile.ClassFile;
 38 import com.sun.tools.classfile.EnclosingMethod_attribute;
 39 
 40 import java.io.File;
 41 import java.io.FilenameFilter;
 42 import java.lang.annotation.Retention;
 43 import java.lang.annotation.RetentionPolicy;
 44 import java.util.HashMap;
 45 import java.util.HashSet;
 46 import java.util.Map;
</pre>
<hr />
<pre>
228         new EnclosingStaticInitialization() {
229         };
230     }
231 
232     {
233         // anonymous and local classes in instance initializer
234         @ExpectedEnclosingMethod(
235                 info = &quot;EnclosingInitialization in EnclosingMethodTest&quot;,
236                 enclosingClazz = EnclosingMethodTest.class
237         )
238         class EnclosingInitialization {
239         }
240         new EnclosingInitialization() {
241         };
242     }
243 
244     Runnable lambda = () -&gt; {
245         // anonymous and local classes in lambda
246         @ExpectedEnclosingMethod(
247                 info = &quot;EnclosingLambda in EnclosingMethodTest&quot;,
<span class="line-modified">248                 enclosingMethod = &quot;&lt;init&gt;&quot;,</span>
249                 enclosingClazz = EnclosingMethodTest.class
250         )
251         class EnclosingLambda {
252         }
253         new EnclosingLambda() {
254         };
255     };
256 
257     EnclosingMethodTest(int i) {
258         // anonymous and local classes in constructor
259         @ExpectedEnclosingMethod(
260                 info = &quot;EnclosingConstructor in EnclosingMethodTest&quot;,
261                 enclosingMethod = &quot;&lt;init&gt;&quot;,
262                 enclosingClazz = EnclosingMethodTest.class
263         )
264         class EnclosingConstructor {
265         }
266         new EnclosingConstructor() {
267         };
268     }
</pre>
<hr />
<pre>
308             new EnclosingStaticInitialization() {
309             };
310         }
311 
312         {
313             // anonymous and local classes in instance initializer
314             @ExpectedEnclosingMethod(
315                     info = &quot;EnclosingInitialization in notEnclosing01&quot;,
316                     enclosingClazz = notEnclosing01.class
317             )
318             class EnclosingInitialization {
319             }
320             new EnclosingInitialization() {
321             };
322         }
323 
324         Runnable lambda = () -&gt; {
325             // anonymous and local classes in lambda
326             @ExpectedEnclosingMethod(
327                     info = &quot;EnclosingLambda in notEnclosing01&quot;,
<span class="line-modified">328                     enclosingMethod = &quot;&lt;init&gt;&quot;,</span>
329                     enclosingClazz = notEnclosing01.class
330             )
331             class EnclosingLambda {
332             }
333             new EnclosingLambda() {
334             };
335         };
336 
337         notEnclosing01() {
338             // anonymous and local classes in constructor
339             @ExpectedEnclosingMethod(
340                     info = &quot;EnclosingConstructor in notEnclosing01&quot;,
341                     enclosingMethod = &quot;&lt;init&gt;&quot;,
342                     enclosingClazz = notEnclosing01.class
343             )
344             class EnclosingConstructor {
345             }
346             new EnclosingConstructor() {
347             };
348         }
</pre>
<hr />
<pre>
365                 enclosingClazz = notEnclosing01.class
366         )
367         static class VariableInitializer {
368         }
369 
370         // static variable initializer
371         private static final VariableInitializer cvi = new VariableInitializer() {
372         };
373 
374         // instance variable initializer
375         private final VariableInitializer ivi = new VariableInitializer() {
376         };
377     }
378 
379     // Test cases: enclosing class is an interface
380     public interface notEnclosing02 {
381         Runnable lambda = () -&gt; {
382             // anonymous and local classes in lambda
383             @ExpectedEnclosingMethod(
384                     info = &quot;EnclosingLambda in notEnclosing02&quot;,
<span class="line-modified">385                     enclosingMethod = &quot;&lt;clinit&gt;&quot;,</span>
386                     enclosingClazz = notEnclosing02.class
387             )
388             class EnclosingLambda {
389             }
390             new EnclosingLambda() {
391             };
392         };
393 
394         static void staticMethod() {
395             // anonymous and local classes in static method
396             @ExpectedEnclosingMethod(
397                     info = &quot;EnclosingMethod in notEnclosing02&quot;,
398                     enclosingMethod = &quot;staticMethod&quot;,
399                     enclosingClazz = notEnclosing02.class
400             )
401             class EnclosingMethod {
402             }
403             new EnclosingMethod() {
404             };
405         }
</pre>
<hr />
<pre>
443             new EnclosingStaticInitialization() {
444             };
445         }
446 
447         {
448             // anonymous and local classes in instance initializer
449             @ExpectedEnclosingMethod(
450                     info = &quot;EnclosingInitialization in notEnclosing03&quot;,
451                     enclosingClazz = notEnclosing03.class
452             )
453             class EnclosingInitialization {
454             }
455             new EnclosingInitialization() {
456             };
457         }
458 
459         Runnable lambda = () -&gt; {
460             // anonymous and local classes in lambda
461             @ExpectedEnclosingMethod(
462                     info = &quot;EnclosingLambda in notEnclosing03&quot;,
<span class="line-modified">463                     enclosingMethod = &quot;&lt;init&gt;&quot;,</span>
464                     enclosingClazz = notEnclosing03.class
465             )
466             class EnclosingLambda {
467             }
468             new EnclosingLambda() {
469             };
470         };
471 
472         notEnclosing03() {
473             // anonymous and local classes in constructor
474             @ExpectedEnclosingMethod(
475                     info = &quot;EnclosingConstructor in notEnclosing03&quot;,
476                     enclosingMethod = &quot;&lt;init&gt;&quot;,
477                     enclosingClazz = notEnclosing03.class
478             )
479             class EnclosingConstructor {
480             }
481             new EnclosingConstructor() {
482             };
483         }
</pre>
<hr />
<pre>
500                 enclosingClazz = notEnclosing03.class
501         )
502         static class VariableInitializer {
503         }
504 
505         // static variable initializer
506         private static final VariableInitializer cvi = new VariableInitializer() {
507         };
508 
509         // instance variable initializer
510         private final VariableInitializer ivi = new VariableInitializer() {
511         };
512     }
513 
514     // Test cases: enclosing class is an annotation
515     public @interface notEnclosing04 {
516         Runnable lambda = () -&gt; {
517             // anonymous and local classes in lambda
518             @ExpectedEnclosingMethod(
519                     info = &quot;EnclosingLambda in notEnclosing04&quot;,
<span class="line-modified">520                     enclosingMethod = &quot;&lt;clinit&gt;&quot;,</span>
521                     enclosingClazz = notEnclosing04.class
522             )
523             class EnclosingLambda {
524             }
525             new EnclosingLambda() {
526             };
527         };
528 
529         @ExpectedEnclosingMethod(
530                 info = &quot;VariableInitializer in notEnclosing04&quot;,
531                 enclosingClazz = notEnclosing04.class
532         )
533         static class VariableInitializer {
534         }
535 
536         // static variable initializer
537         VariableInitializer cvi = new VariableInitializer() {
538         };
539     }
540 }
</pre>
</td>
</tr>
</table>
<center><a href="../../ClassVersionChecker.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../classreader/8171132/BadConstantValue.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>