<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/langtools/tools/javac/tree/SourceTreeScannerTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="NoPrivateTypesExported.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TreeKindTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/langtools/tools/javac/tree/SourceTreeScannerTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2010, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 35 /*
 36  * @test
 37  * @bug 6923080
 38  * @summary TreeScanner.visitNewClass should scan tree.typeargs
 39  * @modules jdk.compiler/com.sun.tools.javac.api
 40  *          jdk.compiler/com.sun.tools.javac.file
 41  *          jdk.compiler/com.sun.tools.javac.tree
 42  *          jdk.compiler/com.sun.tools.javac.util
 43  * @build AbstractTreeScannerTest SourceTreeScannerTest
 44  * @run main SourceTreeScannerTest -q -r .
 45  */
 46 
 47 import java.io.*;
 48 import java.lang.reflect.*;
 49 import java.util.*;
 50 
 51 import javax.tools.*;
 52 
 53 import com.sun.source.tree.CaseTree.CaseKind;
 54 import com.sun.source.tree.Tree;

 55 import com.sun.source.util.TreeScanner;
 56 import com.sun.tools.javac.tree.JCTree;
 57 import com.sun.tools.javac.tree.JCTree.JCCase;
 58 import com.sun.tools.javac.tree.JCTree.JCCompilationUnit;
 59 import com.sun.tools.javac.tree.JCTree.JCModuleDecl;
 60 import com.sun.tools.javac.tree.JCTree.TypeBoundKind;
 61 import com.sun.tools.javac.util.List;

 62 
 63 public class SourceTreeScannerTest extends AbstractTreeScannerTest {
 64     /**
 65      * Main entry point.
 66      * If test.src is set, program runs in jtreg mode, and will throw an Error
 67      * if any errors arise, otherwise System.exit will be used. In jtreg mode,
 68      * the default base directory for file args is the value of ${test.src}.
 69      * In jtreg mode, the -r option can be given to change the default base
 70      * directory to the root test directory.
 71      */
 72     public static void main(String... args) {
 73         String testSrc = System.getProperty(&quot;test.src&quot;);
 74         File baseDir = (testSrc == null) ? null : new File(testSrc);
 75         boolean ok = new SourceTreeScannerTest().run(baseDir, args);
 76         if (!ok) {
 77             if (testSrc != null)  // jtreg mode
 78                 throw new Error(&quot;failed&quot;);
 79             else
 80                 System.exit(1);
 81         }
 82     }
 83 
<span class="line-modified"> 84     int test(JCCompilationUnit tree) {</span>
<span class="line-modified"> 85         return new ScanTester().test(tree);</span>
 86     }
 87 
 88     /**
 89      * Main class for testing operation of tree scanner.
 90      * The set of nodes found by the scanner are compared
 91      * against the set of nodes found by reflection.
 92      */
 93     private class ScanTester extends TreeScanner&lt;Void,Void&gt; {
 94         /** Main entry method for the class. */
 95         int test(JCCompilationUnit tree) {
 96             sourcefile = tree.sourcefile;
 97             found = new HashSet&lt;Tree&gt;();
 98             scan(tree, null);
 99             expect = new HashSet&lt;Tree&gt;();
100             reflectiveScan(tree);
101 
102             if (found.equals(expect)) {
103                 //System.err.println(sourcefile.getName() + &quot;: trees compared OK&quot;);
104                 return found.size();
105             }
</pre>
<hr />
<pre>
152                         if (tree instanceof JCModuleDecl &amp;&amp; f.getName().equals(&quot;mods&quot;)) {
153                             // The modifiers will not found by TreeScanner,
154                             // but the embedded annotations will be.
155                             reflectiveScan(((JCModuleDecl) tree).mods.annotations);
156                         } else if (tree instanceof JCCase &amp;&amp;
157                                    ((JCCase) tree).getCaseKind() == CaseKind.RULE &amp;&amp;
158                                    f.getName().equals(&quot;stats&quot;)) {
159                             //value case, visit value:
160                             reflectiveScan(((JCCase) tree).getBody());
161                         } else {
162                             reflectiveScan(f.get(tree));
163                         }
164                     } catch (IllegalAccessException e) {
165                         error(e.toString());
166                     }
167                 }
168             } else if (o instanceof List) {
169                 List&lt;?&gt; list = (List&lt;?&gt;) o;
170                 for (Object item: list)
171                     reflectiveScan(item);


172             } else
173                 error(&quot;unexpected item: &quot; + o);
174         }
175 
176         JavaFileObject sourcefile;
177         Set&lt;Tree&gt; found;
178         Set&lt;Tree&gt; expect;
179     }
180 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2010, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 35 /*
 36  * @test
 37  * @bug 6923080
 38  * @summary TreeScanner.visitNewClass should scan tree.typeargs
 39  * @modules jdk.compiler/com.sun.tools.javac.api
 40  *          jdk.compiler/com.sun.tools.javac.file
 41  *          jdk.compiler/com.sun.tools.javac.tree
 42  *          jdk.compiler/com.sun.tools.javac.util
 43  * @build AbstractTreeScannerTest SourceTreeScannerTest
 44  * @run main SourceTreeScannerTest -q -r .
 45  */
 46 
 47 import java.io.*;
 48 import java.lang.reflect.*;
 49 import java.util.*;
 50 
 51 import javax.tools.*;
 52 
 53 import com.sun.source.tree.CaseTree.CaseKind;
 54 import com.sun.source.tree.Tree;
<span class="line-added"> 55 import com.sun.source.util.JavacTask;</span>
 56 import com.sun.source.util.TreeScanner;
 57 import com.sun.tools.javac.tree.JCTree;
 58 import com.sun.tools.javac.tree.JCTree.JCCase;
 59 import com.sun.tools.javac.tree.JCTree.JCCompilationUnit;
 60 import com.sun.tools.javac.tree.JCTree.JCModuleDecl;
 61 import com.sun.tools.javac.tree.JCTree.TypeBoundKind;
 62 import com.sun.tools.javac.util.List;
<span class="line-added"> 63 import com.sun.tools.javac.util.Pair;</span>
 64 
 65 public class SourceTreeScannerTest extends AbstractTreeScannerTest {
 66     /**
 67      * Main entry point.
 68      * If test.src is set, program runs in jtreg mode, and will throw an Error
 69      * if any errors arise, otherwise System.exit will be used. In jtreg mode,
 70      * the default base directory for file args is the value of ${test.src}.
 71      * In jtreg mode, the -r option can be given to change the default base
 72      * directory to the root test directory.
 73      */
 74     public static void main(String... args) {
 75         String testSrc = System.getProperty(&quot;test.src&quot;);
 76         File baseDir = (testSrc == null) ? null : new File(testSrc);
 77         boolean ok = new SourceTreeScannerTest().run(baseDir, args);
 78         if (!ok) {
 79             if (testSrc != null)  // jtreg mode
 80                 throw new Error(&quot;failed&quot;);
 81             else
 82                 System.exit(1);
 83         }
 84     }
 85 
<span class="line-modified"> 86     int test(Pair&lt;JavacTask, JCCompilationUnit&gt; taskAndTree) {</span>
<span class="line-modified"> 87         return new ScanTester().test(taskAndTree.snd);</span>
 88     }
 89 
 90     /**
 91      * Main class for testing operation of tree scanner.
 92      * The set of nodes found by the scanner are compared
 93      * against the set of nodes found by reflection.
 94      */
 95     private class ScanTester extends TreeScanner&lt;Void,Void&gt; {
 96         /** Main entry method for the class. */
 97         int test(JCCompilationUnit tree) {
 98             sourcefile = tree.sourcefile;
 99             found = new HashSet&lt;Tree&gt;();
100             scan(tree, null);
101             expect = new HashSet&lt;Tree&gt;();
102             reflectiveScan(tree);
103 
104             if (found.equals(expect)) {
105                 //System.err.println(sourcefile.getName() + &quot;: trees compared OK&quot;);
106                 return found.size();
107             }
</pre>
<hr />
<pre>
154                         if (tree instanceof JCModuleDecl &amp;&amp; f.getName().equals(&quot;mods&quot;)) {
155                             // The modifiers will not found by TreeScanner,
156                             // but the embedded annotations will be.
157                             reflectiveScan(((JCModuleDecl) tree).mods.annotations);
158                         } else if (tree instanceof JCCase &amp;&amp;
159                                    ((JCCase) tree).getCaseKind() == CaseKind.RULE &amp;&amp;
160                                    f.getName().equals(&quot;stats&quot;)) {
161                             //value case, visit value:
162                             reflectiveScan(((JCCase) tree).getBody());
163                         } else {
164                             reflectiveScan(f.get(tree));
165                         }
166                     } catch (IllegalAccessException e) {
167                         error(e.toString());
168                     }
169                 }
170             } else if (o instanceof List) {
171                 List&lt;?&gt; list = (List&lt;?&gt;) o;
172                 for (Object item: list)
173                     reflectiveScan(item);
<span class="line-added">174             } else if (o instanceof Pair) {</span>
<span class="line-added">175                 return;</span>
176             } else
177                 error(&quot;unexpected item: &quot; + o);
178         }
179 
180         JavaFileObject sourcefile;
181         Set&lt;Tree&gt; found;
182         Set&lt;Tree&gt; expect;
183     }
184 }
</pre>
</td>
</tr>
</table>
<center><a href="NoPrivateTypesExported.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TreeKindTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>