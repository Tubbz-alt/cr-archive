<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/security/SignedObject/Chain.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../Signature/Offsets.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../cert/CertPathBuilder/selfIssued/KeyUsageMatters.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/security/SignedObject/Chain.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /**
<span class="line-modified">  2  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
<span class="line-modified"> 24 import java.security.Signature;</span>
<span class="line-removed"> 25 import java.security.SignedObject;</span>
<span class="line-removed"> 26 import java.security.KeyPairGenerator;</span>
<span class="line-removed"> 27 import java.security.KeyPair;</span>
<span class="line-removed"> 28 import java.security.NoSuchProviderException;</span>
<span class="line-removed"> 29 import java.security.PrivateKey;</span>
<span class="line-removed"> 30 import java.security.PublicKey;</span>
 31 import java.security.spec.*;
 32 import java.util.*;
 33 import jdk.test.lib.SigTestUtil;
 34 import static jdk.test.lib.SigTestUtil.SignatureType;
 35 
 36 /*
 37  * @test
 38  * @bug 8050374 8181048 8146293
 39  * @summary Verify a chain of signed objects
 40  * @library /test/lib
 41  * @build jdk.test.lib.SigTestUtil
 42  * @run main Chain
 43  */
 44 public class Chain {
 45 
 46     static enum KeyAlg {
 47         RSA(&quot;RSA&quot;),
 48         DSA(&quot;DSA&quot;),
 49         EC(&quot;EC&quot;);
 50 
</pre>
<hr />
<pre>
180         while (mdAlgs.hasNext()) {
181             result &amp;= runTest(new Test(pss, KeyAlg.RSA, Provider.SunRsaSign,
182                 keysize, SigTestUtil.generateDefaultParameter
183                     (SignatureType.RSASSA_PSS, mdAlgs.next())));
184         }
185         return result;
186     }
187 
188     static boolean runTest(Test test) {
189         System.out.println(test);
190         try {
191             // Generate all private/public key pairs
192             PrivateKey[] privKeys = new PrivateKey[N];
193             PublicKey[] pubKeys = new PublicKey[N];
194             PublicKey[] anotherPubKeys = new PublicKey[N];
195             Signature signature;
196             KeyPairGenerator kpg;
197             if (test.provider != Provider.Default) {
198                 signature = Signature.getInstance(test.sigAlg.name,
199                         test.provider.name);
<span class="line-modified">200                 kpg = KeyPairGenerator.getInstance(</span>
<span class="line-modified">201                     test.keyAlg.name, test.provider.name);</span>







202             } else {
203                 signature = Signature.getInstance(test.sigAlg.name);
204                 kpg = KeyPairGenerator.getInstance(test.keyAlg.name);
205             }
206             if (test.sigParams != null) {
207                 signature.setParameter(test.sigParams);
208             }
209 
210             for (int j=0; j &lt; N; j++) {
211                 if (test.keySize != -1) {
212                     kpg.initialize(test.keySize);
213                 }
214                 KeyPair kp = kpg.genKeyPair();
215                 KeyPair anotherKp = kpg.genKeyPair();
216                 privKeys[j] = kp.getPrivate();
217                 pubKeys[j] = kp.getPublic();
218                 anotherPubKeys[j] = anotherKp.getPublic();
219 
220                 if (Arrays.equals(pubKeys[j].getEncoded(),
221                         anotherPubKeys[j].getEncoded())) {
</pre>
</td>
<td>
<hr />
<pre>
  1 /**
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
<span class="line-modified"> 24 import java.security.*;</span>






 25 import java.security.spec.*;
 26 import java.util.*;
 27 import jdk.test.lib.SigTestUtil;
 28 import static jdk.test.lib.SigTestUtil.SignatureType;
 29 
 30 /*
 31  * @test
 32  * @bug 8050374 8181048 8146293
 33  * @summary Verify a chain of signed objects
 34  * @library /test/lib
 35  * @build jdk.test.lib.SigTestUtil
 36  * @run main Chain
 37  */
 38 public class Chain {
 39 
 40     static enum KeyAlg {
 41         RSA(&quot;RSA&quot;),
 42         DSA(&quot;DSA&quot;),
 43         EC(&quot;EC&quot;);
 44 
</pre>
<hr />
<pre>
174         while (mdAlgs.hasNext()) {
175             result &amp;= runTest(new Test(pss, KeyAlg.RSA, Provider.SunRsaSign,
176                 keysize, SigTestUtil.generateDefaultParameter
177                     (SignatureType.RSASSA_PSS, mdAlgs.next())));
178         }
179         return result;
180     }
181 
182     static boolean runTest(Test test) {
183         System.out.println(test);
184         try {
185             // Generate all private/public key pairs
186             PrivateKey[] privKeys = new PrivateKey[N];
187             PublicKey[] pubKeys = new PublicKey[N];
188             PublicKey[] anotherPubKeys = new PublicKey[N];
189             Signature signature;
190             KeyPairGenerator kpg;
191             if (test.provider != Provider.Default) {
192                 signature = Signature.getInstance(test.sigAlg.name,
193                         test.provider.name);
<span class="line-modified">194                 // try using the same provider first, if not, fallback</span>
<span class="line-modified">195                 // to the first available impl</span>
<span class="line-added">196                 try {</span>
<span class="line-added">197                     kpg = KeyPairGenerator.getInstance(</span>
<span class="line-added">198                         test.keyAlg.name, test.provider.name);</span>
<span class="line-added">199                 } catch (NoSuchAlgorithmException nsae) {</span>
<span class="line-added">200                     kpg = KeyPairGenerator.getInstance(</span>
<span class="line-added">201                         test.keyAlg.name);</span>
<span class="line-added">202                 }</span>
203             } else {
204                 signature = Signature.getInstance(test.sigAlg.name);
205                 kpg = KeyPairGenerator.getInstance(test.keyAlg.name);
206             }
207             if (test.sigParams != null) {
208                 signature.setParameter(test.sigParams);
209             }
210 
211             for (int j=0; j &lt; N; j++) {
212                 if (test.keySize != -1) {
213                     kpg.initialize(test.keySize);
214                 }
215                 KeyPair kp = kpg.genKeyPair();
216                 KeyPair anotherKp = kpg.genKeyPair();
217                 privKeys[j] = kp.getPrivate();
218                 pubKeys[j] = kp.getPublic();
219                 anotherPubKeys[j] = anotherKp.getPublic();
220 
221                 if (Arrays.equals(pubKeys[j].getEncoded(),
222                         anotherPubKeys[j].getEncoded())) {
</pre>
</td>
</tr>
</table>
<center><a href="../Signature/Offsets.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../cert/CertPathBuilder/selfIssued/KeyUsageMatters.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>