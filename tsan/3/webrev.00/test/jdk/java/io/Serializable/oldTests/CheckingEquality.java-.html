<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/jdk/java/io/Serializable/oldTests/CheckingEquality.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2005, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /* @test
 25  * @summary it is new version of old test which was
 26  *          /src/share/test/serialization/psiotest.java
 27  *          Test pickling and unpickling an object with derived classes
 28  *          and using a read special to serialize the &quot;middle&quot; class.
 29  *
 30  */
 31 
 32 import java.io.*;
 33 
 34 public class CheckingEquality {
 35     public static void main (String argv[]) {
 36         System.err.println(&quot;\nRegression test of &quot; +
 37                            &quot;serialization/deserialization of &quot; +
 38                            &quot;complex objects\n&quot;);
 39 
 40         FileInputStream istream = null;
 41         try {
 42 
 43             Thirdpsio objout = new Thirdpsio();
 44             objout.init();
 45 
 46             FileOutputStream ostream = new FileOutputStream(&quot;psiotest1.tmp&quot;);
 47             ObjectOutputStream p = new ObjectOutputStream(ostream);
 48 
 49             p.writeObject(objout);
 50 
 51             p.flush();
 52             ostream.close();
 53 
 54             istream = new FileInputStream(&quot;psiotest1.tmp&quot;);
 55             ObjectInputStream q = new ObjectInputStream(istream);
 56 
 57             Thirdpsio objin = (Thirdpsio)q.readObject();
 58 
 59             if (!objout.equals(objin)) {
 60                 System.err.println(
 61                     &quot;\nTEST FAILED: Original and read objects not equal.&quot;);
 62                 throw new Error();
 63             }
 64             istream.close();
 65             System.err.println(&quot;\nTEST PASSED&quot;);
 66         } catch (Exception e) {
 67             System.err.print(&quot;TEST FAILED: &quot;);
 68             e.printStackTrace();
 69 
 70             System.err.println(&quot;\nInput remaining&quot;);
 71             int ch;
 72             try {
 73                 while ((ch = istream.read()) != -1) {
 74                     System.out.print(Integer.toString(ch, 16) + &quot; &quot;);
 75                 }
 76                 System.err.println(&quot;\n&quot;);
 77             } catch (Exception f) {
 78                 throw new Error();
 79             }
 80             throw new Error();
 81         }
 82     }
 83 }
 84 
 85 class Firstpsio implements java.io.Serializable {
 86     String one;
 87     int two;
 88     float three[];
 89 
 90     void init() { /* called only before writing */
 91         one = &quot;one&quot;;
 92         two = 2;
 93         three = new float[5];
 94         float f = 3.0f;
 95         for (int i=0; i&lt;5 ; i++) {
 96             f += 0.11;
 97             three[i] = f;
 98         }
 99     }
100 
101     /* Compare two first objects */
102     boolean equals(Firstpsio other) {
103         boolean ret = true;
104 
105         if (!one.equals(other.one)) {
106             System.err.println(&quot;\nfirstpsio: expected &quot; + one +
107                 &quot; actual &quot; + other.one);
108             ret = false;
109         }
110         if (two != other.two) {
111             System.err.println(&quot;\nfirstpsio: expected &quot; + two +
112                 &quot; actual &quot; + other.two);
113             ret = false;
114         }
115 
116         for (int i = 0; i &lt; three.length; i++ ) {
117             if (three[i] != other.three[i]) {
118                 System.err.println(&quot;\nfirstpsio: three[&quot; + i + &quot;] expected &quot; +
119                     three[i] + &quot; actual &quot; + other.three[i]);
120                 ret = false;
121             }
122         }
123         return ret;
124     }
125 }
126 
127 class Secondpsio extends Firstpsio  {
128     String quatre;
129     int cinq;
130 
131     private void writeObject(ObjectOutputStream pw) throws IOException {
132         pw.writeObject(quatre);
133         pw.writeInt(cinq);
134     }
135 
136     private void readObject(ObjectInputStream pr)
137         throws StreamCorruptedException, IOException, ClassNotFoundException
138     {
139         if (one == null) {
140             System.err.println(
141                 &quot;\nTEST FAILED: Superclass not serialized when &quot; +
142                 &quot;it should have been&quot;);
143             throw new StreamCorruptedException(&quot;Superclass not serialized &quot; +
144                                                &quot;when it should have been&quot;);
145         }
146 
147         quatre = (String)pr.readObject();
148         cinq = pr.readInt();
149     }
150 
151     boolean equals(Secondpsio other) {
152         boolean ret = super.equals(other);
153 
154         if (!quatre.equals(other.quatre)) {
155             System.err.println(&quot;\nsecondpsio: quatre expected &quot; + quatre +
156                 &quot; actual &quot; + other.quatre);
157             ret = false;
158         }
159         if (cinq != other.cinq) {
160             System.err.println(&quot;\nsecondpsio: cinq expected &quot; + cinq +
161                 &quot; actual &quot; + other.cinq);
162             ret = false;
163         }
164         return ret;
165     }
166 
167     /* called only before writing */
168     void init() {
169         quatre = &quot;4444&quot;;
170         cinq = 5;
171         super.init();
172     }
173 }
174 
175 class Thirdpsio extends Secondpsio {
176 
177     static String ign = &quot;ignored&quot;;
178     transient Object oh;
179 
180     int six;
181 
182     private static int seven[];
183     protected byte eight = (byte)9;
184     static final byte dcare = (byte) 128;
185     private short nine = 8888;
186     long ten;
187     java.util.Enumeration zero;
188 
189 
190     boolean equals(Thirdpsio other) {
191         boolean ret = super.equals(other);
192 
193         if (six != other.six) {
194             System.err.println(&quot;\nthirdpsio six &quot; + six +
195                 &quot; actual &quot; + other.six);
196             ret = false;
197         }
198         if (eight != other.eight) {
199             System.err.println(&quot;\nthirdpsio eight - expected &quot; + eight +
200                 &quot; actual &quot; + other.eight);
201             ret = false;
202         }
203         if (nine != other.nine) {
204             System.err.println(&quot;\nthirdpsio nine - expected &quot; + nine +
205                &quot; actual &quot; + other.nine);
206             ret = false;
207         }
208         if (ten != other.ten) {
209             System.err.println(&quot;\nthirdpsio ten - expected &quot; + ten +
210                 &quot; actual &quot; + other.ten);
211             ret = false;
212         }
213         if (zero != other.zero) {
214             System.err.println(&quot;\nthirdpsio zero - expected &quot; + zero +
215                 &quot; actual &quot; + other.zero);
216             ret = false;
217         }
218         return ret;
219     }
220 
221     /* called only before writing */
222     void init() {
223         six = 666;
224 
225         int s7[] = { 7, 7, 7 };
226         seven = s7;
227         eight = (byte)8;
228         nine = (short)9;
229         ten = (long)100000;
230         java.util.Enumeration em = null; /* default */
231 
232         super.init();
233     }
234 }
    </pre>
  </body>
</html>