diff a/test/jdk/java/net/DatagramSocket/SendDatagramToBadAddress.java b/test/jdk/java/net/DatagramSocket/SendDatagramToBadAddress.java
--- a/test/jdk/java/net/DatagramSocket/SendDatagramToBadAddress.java
+++ b/test/jdk/java/net/DatagramSocket/SendDatagramToBadAddress.java
@@ -108,16 +108,21 @@
         SendDatagramToBadAddress ud = new SendDatagramToBadAddress ();
         ud.run ();
     }
 
     public void run() throws Exception {
-
         if (OSsupportsFeature()) {
             print ("running on OS that supports ICMP port unreachable");
         }
+        try (DatagramSocket sock = new DatagramSocket()) {
+            test(sock);
+        }
+    }
+
+    private void test(DatagramSocket sock) throws Exception {
+        print("Testing with " + sock.getClass());
         InetAddress addr = InetAddress.getLoopbackAddress();
-        DatagramSocket sock = new DatagramSocket();
         DatagramSocket serversock = new DatagramSocket(0);
         DatagramPacket p;
         byte[] buf;
         int port = serversock.getLocalPort ();
         final int loop = 5;
