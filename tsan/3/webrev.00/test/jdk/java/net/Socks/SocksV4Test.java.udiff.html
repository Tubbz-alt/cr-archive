<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/java/net/Socks/SocksV4Test.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="SocksServer.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../URI/Test.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/net/Socks/SocksV4Test.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -28,11 +28,18 @@</span>
   * @build SocksServer
   * @run main/othervm SocksV4Test
   */
  
  import java.io.IOException;
<span class="udiff-line-modified-removed">- import java.net.*;</span>
<span class="udiff-line-modified-added">+ import java.net.Authenticator;</span>
<span class="udiff-line-added">+ import java.net.InetAddress;</span>
<span class="udiff-line-added">+ import java.net.InetSocketAddress;</span>
<span class="udiff-line-added">+ import java.net.PasswordAuthentication;</span>
<span class="udiff-line-added">+ import java.net.Proxy;</span>
<span class="udiff-line-added">+ import java.net.ServerSocket;</span>
<span class="udiff-line-added">+ import java.net.Socket;</span>
<span class="udiff-line-added">+ import java.net.UnknownHostException;</span>
  
  public class SocksV4Test {
  
      // An unresolvable host
      static final String HOSTNAME = &quot;doesnot.exist.invalid&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -53,22 +60,23 @@</span>
  
      public static void getLocalPortTest() throws Exception {
          // We actually use V5 for this test because that is the default
          // protocol version used by the client and it doesn&#39;t really handle
          // down grading very well.
<span class="udiff-line-modified-removed">-         try (SocksServer srvr = new SocksServer(0, false);</span>
<span class="udiff-line-modified-removed">-              ServerSocket ss = new ServerSocket(0)) {</span>
<span class="udiff-line-modified-added">+         InetAddress lba = InetAddress.getLoopbackAddress();</span>
<span class="udiff-line-modified-added">+         try (SocksServer srvr = new SocksServer(lba, 0, false);</span>
<span class="udiff-line-added">+              ServerSocket ss = new ServerSocket(0, 0, lba)) {</span>
  
              srvr.addUser(USER, PASSWORD);
              int serverPort = ss.getLocalPort();
              srvr.start();
              int proxyPort = srvr.getPort();
              System.out.printf(&quot;Server port %d, Proxy port %d\n&quot;, serverPort, proxyPort);
              Proxy sp = new Proxy(Proxy.Type.SOCKS,
<span class="udiff-line-modified-removed">-                     new InetSocketAddress(&quot;localhost&quot;, proxyPort));</span>
<span class="udiff-line-modified-added">+                     new InetSocketAddress(lba, proxyPort));</span>
              // Let&#39;s create an unresolved address
<span class="udiff-line-modified-removed">-             InetSocketAddress ad = new InetSocketAddress(&quot;127.0.0.1&quot;, serverPort);</span>
<span class="udiff-line-modified-added">+             InetSocketAddress ad = new InetSocketAddress(lba.getHostAddress(), serverPort);</span>
              try (Socket s = new Socket(sp)) {
                  s.connect(ad, 10000);
                  int pp = s.getLocalPort();
                  System.out.println(&quot;Local port = &quot; + pp);
                  if (pp == serverPort || pp == proxyPort)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -83,15 +91,16 @@</span>
  
      public static void UHETest() throws Exception {
          // sanity before running the test
          assertUnresolvableHost(HOSTNAME);
  
<span class="udiff-line-added">+         InetAddress lba = InetAddress.getLoopbackAddress();</span>
          // Create a SOCKS V4 proxy
<span class="udiff-line-modified-removed">-         try (SocksServer srvr = new SocksServer(0, true)) {</span>
<span class="udiff-line-modified-added">+         try (SocksServer srvr = new SocksServer(lba, 0, true)) {</span>
              srvr.start();
              Proxy sp = new Proxy(Proxy.Type.SOCKS,
<span class="udiff-line-modified-removed">-                     new InetSocketAddress(&quot;localhost&quot;, srvr.getPort()));</span>
<span class="udiff-line-modified-added">+                     new InetSocketAddress(lba, srvr.getPort()));</span>
              // Let&#39;s create an unresolved address
              InetSocketAddress ad = new InetSocketAddress(HOSTNAME, 1234);
              try (Socket s = new Socket(sp)) {
                  s.connect(ad, 10000);
              } catch (UnknownHostException ex) {
</pre>
<center><a href="SocksServer.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../URI/Test.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>