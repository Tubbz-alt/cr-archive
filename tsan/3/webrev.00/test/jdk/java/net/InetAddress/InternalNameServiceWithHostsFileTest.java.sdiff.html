<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/net/InetAddress/InternalNameServiceWithHostsFileTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="GetLocalHostWithSM.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ptr/Lookup.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/net/InetAddress/InternalNameServiceWithHostsFileTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 39     public static void main(String args[]) throws Exception {
 40 
 41         // System.getProperty(&quot;test.src&quot;, &quot;.&quot;);
 42         String hostsFileName = System.getProperty(&quot;test.src&quot;, &quot;.&quot;)
 43                 + &quot;/TestHosts-III&quot;;
 44         System.setProperty(&quot;jdk.net.hosts.file&quot;, hostsFileName);
 45         System.setProperty(&quot;sun.net.inetaddr.ttl&quot;, &quot;0&quot;);
 46 
 47         // fe80::1
 48         byte[] expectedIpv6Address = { (byte) 0xfe, (byte) 0x80, 0, 0, 0, 0, 0,
 49                 0, 0, 0, 0, 0, 0, 0, 0, 1 };
 50         // fe00::0
 51         byte[] expectedIpv6LocalAddress = { (byte) 0xfe, (byte) 0x00, 0, 0, 0,
 52                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };
 53         // 10.2.3.4
 54         byte[] expectedIpv4Address = { 10, 2, 3, 4 };
 55         //
 56         byte[] expectedIpv6LocalhostAddress = { 0, 0, 0, 0, 0, 0, 0,
 57                 0, 0, 0, 0, 0, 0, 0, 0, 1 };
 58 
<span class="line-modified"> 59         try {</span>
<span class="line-modified"> 60             // 10.2.3.4  testHost.testDomain</span>
<span class="line-modified"> 61             testHostsMapping(expectedIpv4Address, &quot;testHost.testDomain&quot;);</span>
<span class="line-modified"> 62             // ::1     ip6-localhost ip6-loopback</span>
<span class="line-modified"> 63             testHostsMapping(expectedIpv6LocalhostAddress, &quot;ip6-localhost&quot;);</span>
<span class="line-modified"> 64             // fe00::0 ip6-localnet</span>
<span class="line-modified"> 65             testHostsMapping(expectedIpv6LocalAddress, &quot;ip6-localnet&quot;);</span>
<span class="line-modified"> 66             // fe80::1 link-local-host</span>
<span class="line-removed"> 67             testHostsMapping(expectedIpv6Address, &quot;link-local-host&quot;);</span>
 68 
<span class="line-modified"> 69         } catch (UnknownHostException uhEx) {</span>
<span class="line-modified"> 70             System.out.println(&quot;UHE unexpected caught == &quot; + uhEx.getMessage());</span>
<span class="line-modified"> 71         }</span>










 72     }
 73 
 74     private static void testHostsMapping(byte[] expectedIpAddress, String hostName)
 75             throws UnknownHostException {
 76         InetAddress testAddress;
 77         byte[] rawIpAddress;
 78         testAddress = InetAddress.getByName(hostName);
 79         System.out
 80                 .println(&quot;############################  InetAddress == &quot;
 81                         + testAddress);
 82 
 83         rawIpAddress = testAddress.getAddress();
 84         if (!Arrays.equals(rawIpAddress, expectedIpAddress)) {
 85             System.out.println(&quot;retrieved address == &quot;
 86                     + Arrays.toString(rawIpAddress)
 87                     + &quot; not equal to expected address == &quot;
 88                     + Arrays.toString(expectedIpAddress));
 89             throw new RuntimeException(
 90                     &quot;retrieved address not equal to expected address&quot;);
 91         }
 92         System.out.println(&quot;retrieved address == &quot;
 93                 + Arrays.toString(rawIpAddress)
 94                 + &quot; equal to expected address == &quot;
 95                 + Arrays.toString(expectedIpAddress));
 96     }











 97 }
</pre>
</td>
<td>
<hr />
<pre>
 39     public static void main(String args[]) throws Exception {
 40 
 41         // System.getProperty(&quot;test.src&quot;, &quot;.&quot;);
 42         String hostsFileName = System.getProperty(&quot;test.src&quot;, &quot;.&quot;)
 43                 + &quot;/TestHosts-III&quot;;
 44         System.setProperty(&quot;jdk.net.hosts.file&quot;, hostsFileName);
 45         System.setProperty(&quot;sun.net.inetaddr.ttl&quot;, &quot;0&quot;);
 46 
 47         // fe80::1
 48         byte[] expectedIpv6Address = { (byte) 0xfe, (byte) 0x80, 0, 0, 0, 0, 0,
 49                 0, 0, 0, 0, 0, 0, 0, 0, 1 };
 50         // fe00::0
 51         byte[] expectedIpv6LocalAddress = { (byte) 0xfe, (byte) 0x00, 0, 0, 0,
 52                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };
 53         // 10.2.3.4
 54         byte[] expectedIpv4Address = { 10, 2, 3, 4 };
 55         //
 56         byte[] expectedIpv6LocalhostAddress = { 0, 0, 0, 0, 0, 0, 0,
 57                 0, 0, 0, 0, 0, 0, 0, 0, 1 };
 58 
<span class="line-modified"> 59         // 10.2.3.4  testHost.testDomain</span>
<span class="line-modified"> 60         testHostsMapping(expectedIpv4Address, &quot;testHost.testDomain&quot;);</span>
<span class="line-modified"> 61         // ::1     ip6-localhost ip6-loopback</span>
<span class="line-modified"> 62         testHostsMapping(expectedIpv6LocalhostAddress, &quot;ip6-localhost&quot;);</span>
<span class="line-modified"> 63         // fe00::0 ip6-localnet</span>
<span class="line-modified"> 64         testHostsMapping(expectedIpv6LocalAddress, &quot;ip6-localnet&quot;);</span>
<span class="line-modified"> 65         // fe80::1 link-local-host</span>
<span class="line-modified"> 66         testHostsMapping(expectedIpv6Address, &quot;link-local-host&quot;);</span>

 67 
<span class="line-modified"> 68         testReverseLookup(&quot;10.2.3.4&quot;, &quot;testHost.testDomain&quot;);</span>
<span class="line-modified"> 69 </span>
<span class="line-modified"> 70         testReverseLookup(&quot;::1&quot;, &quot;ip6-localhost&quot;);</span>
<span class="line-added"> 71         testReverseLookup(&quot;0:0:0:0:0:0:0:1&quot;, &quot;ip6-localhost&quot;);</span>
<span class="line-added"> 72         testReverseLookup(&quot;0000:0000:0000:0000:0000:0000:0000:0001&quot;, &quot;ip6-localhost&quot;);</span>
<span class="line-added"> 73 </span>
<span class="line-added"> 74         testReverseLookup(&quot;fe00::0&quot;, &quot;ip6-localnet&quot;);</span>
<span class="line-added"> 75         testReverseLookup(&quot;fe00:0:0:0:0:0:0:0&quot;, &quot;ip6-localnet&quot;);</span>
<span class="line-added"> 76         testReverseLookup(&quot;fe00:0000:0000:0000:0000:0000:0000:0000&quot;, &quot;ip6-localnet&quot;);</span>
<span class="line-added"> 77 </span>
<span class="line-added"> 78         testReverseLookup(&quot;fe80::1&quot;, &quot;link-local-host&quot;);</span>
<span class="line-added"> 79         testReverseLookup(&quot;fe80:000:0:00:0:000:00:1&quot;, &quot;link-local-host&quot;);</span>
<span class="line-added"> 80         testReverseLookup(&quot;fe80:0000:0000:0000:0000:0000:0000:0001&quot;, &quot;link-local-host&quot;);</span>
 81     }
 82 
 83     private static void testHostsMapping(byte[] expectedIpAddress, String hostName)
 84             throws UnknownHostException {
 85         InetAddress testAddress;
 86         byte[] rawIpAddress;
 87         testAddress = InetAddress.getByName(hostName);
 88         System.out
 89                 .println(&quot;############################  InetAddress == &quot;
 90                         + testAddress);
 91 
 92         rawIpAddress = testAddress.getAddress();
 93         if (!Arrays.equals(rawIpAddress, expectedIpAddress)) {
 94             System.out.println(&quot;retrieved address == &quot;
 95                     + Arrays.toString(rawIpAddress)
 96                     + &quot; not equal to expected address == &quot;
 97                     + Arrays.toString(expectedIpAddress));
 98             throw new RuntimeException(
 99                     &quot;retrieved address not equal to expected address&quot;);
100         }
101         System.out.println(&quot;retrieved address == &quot;
102                 + Arrays.toString(rawIpAddress)
103                 + &quot; equal to expected address == &quot;
104                 + Arrays.toString(expectedIpAddress));
105     }
<span class="line-added">106 </span>
<span class="line-added">107     private static void testReverseLookup(String numericHost, String expectedName)</span>
<span class="line-added">108             throws UnknownHostException {</span>
<span class="line-added">109         String lookupResult = InetAddress.getByName(numericHost).getHostName();</span>
<span class="line-added">110         if (!expectedName.equals(lookupResult)) {</span>
<span class="line-added">111             throw new RuntimeException(</span>
<span class="line-added">112                 String.format(</span>
<span class="line-added">113                     &quot;reverse lookup of \&quot;%s\&quot; is \&quot;%s\&quot;, should be \&quot;%s\&quot;\n&quot;,</span>
<span class="line-added">114                     numericHost, lookupResult, expectedName));</span>
<span class="line-added">115         }</span>
<span class="line-added">116     }</span>
117 }
</pre>
</td>
</tr>
</table>
<center><a href="GetLocalHostWithSM.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="ptr/Lookup.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>