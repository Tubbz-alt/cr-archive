<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/java/net/Socket/UrgentDataTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="TrafficClass.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="asyncClose/AsyncClose.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/net/Socket/UrgentDataTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 22,17 ***</span>
<span class="line-new-header">--- 22,19 ---</span>
   */
  
  /*
   * @test
   * @bug 4092038
<span class="line-added">+  * @library /test/lib</span>
   * @summary TCP Urgent data support
   * @run main UrgentDataTest
   * @run main/othervm -Djava.net.preferIPv4Stack=true UrgentDataTest
   */
  
  import java.net.*;
  import java.io.*;
<span class="line-added">+ import jdk.test.lib.net.IPSupport;</span>
  
  public class UrgentDataTest {
  
      Object opref;
      boolean isClient, isServer;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 49,17 ***</span>
          System.out.println (&quot;   usage: java UrgentDataTest -client host port &lt;runs client and connects to&quot;+
              &quot; specified server&gt;&quot;);
      }
  
      public static void main (String args[]) {
          try {
              UrgentDataTest test = new UrgentDataTest ();
              if (args.length == 0) {
<span class="line-modified">!                 test.listener = new ServerSocket (0);</span>
                  test.isClient = true;
                  test.isServer = true;
<span class="line-modified">!                 test.clHost = InetAddress.getLoopbackAddress().getHostAddress();</span>
                  test.clPort = test.listener.getLocalPort();
                  test.run();
              } else if (args[0].equals (&quot;-server&quot;)) {
                  test.listener = new ServerSocket (0);
                  System.out.println (&quot;Server listening on port &quot; + test.listener.getLocalPort());
<span class="line-new-header">--- 51,21 ---</span>
          System.out.println (&quot;   usage: java UrgentDataTest -client host port &lt;runs client and connects to&quot;+
              &quot; specified server&gt;&quot;);
      }
  
      public static void main (String args[]) {
<span class="line-added">+         IPSupport.throwSkippedExceptionIfNonOperational();</span>
<span class="line-added">+ </span>
          try {
              UrgentDataTest test = new UrgentDataTest ();
              if (args.length == 0) {
<span class="line-modified">!                 InetAddress loopback = InetAddress.getLoopbackAddress();</span>
<span class="line-added">+                 test.listener = new ServerSocket ();</span>
<span class="line-added">+                 test.listener.bind(new InetSocketAddress(loopback, 0));</span>
                  test.isClient = true;
                  test.isServer = true;
<span class="line-modified">!                 test.clHost = loopback.getHostAddress();</span>
                  test.clPort = test.listener.getLocalPort();
                  test.run();
              } else if (args[0].equals (&quot;-server&quot;)) {
                  test.listener = new ServerSocket (0);
                  System.out.println (&quot;Server listening on port &quot; + test.listener.getLocalPort());
</pre>
<center><a href="TrafficClass.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="asyncClose/AsyncClose.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>