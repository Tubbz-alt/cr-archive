<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/net/InetSocketAddress/ToString.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../InetAddress/ptr/Lookup.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../MulticastSocket/JoinLeave.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/net/InetSocketAddress/ToString.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2001, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 4464064</span>
<span class="line-modified"> 27  * @summary InetSocketAddress.toString() throws NPE with unresolved address</span>




 28  */
 29 
 30 import java.net.*;
<span class="line-removed"> 31 import java.io.*;</span>
 32 




 33 
 34 public class ToString {
 35 
<span class="line-modified"> 36     public static void main (String args[]){</span>


 37 




































 38         System.out.println(new InetSocketAddress(&quot;unresolved&quot;, 12345));










































































 39 



 40     }
 41 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2001, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8225499 4464064</span>
<span class="line-modified"> 27  * @library /test/lib</span>
<span class="line-added"> 28  * @summary InetSocketAddress::toString not friendly to IPv6 literal addresses</span>
<span class="line-added"> 29  * @run testng/othervm ToString</span>
<span class="line-added"> 30  * @run testng/othervm -Djava.net.preferIPv4Stack=true ToString</span>
<span class="line-added"> 31  * @run testng/othervm -Djava.net.preferIPv6Addresses=true ToString</span>
 32  */
 33 
 34 import java.net.*;

 35 
<span class="line-added"> 36 import jdk.test.lib.net.IPSupport;</span>
<span class="line-added"> 37 import org.testng.annotations.BeforeTest;</span>
<span class="line-added"> 38 import org.testng.annotations.DataProvider;</span>
<span class="line-added"> 39 import org.testng.annotations.Test;</span>
 40 
 41 public class ToString {
 42 
<span class="line-modified"> 43     private static final String loopbackAddr;</span>
<span class="line-added"> 44     private static final String wildcardAddr;</span>
<span class="line-added"> 45     private static final String localAddr;</span>
 46 
<span class="line-added"> 47     static {</span>
<span class="line-added"> 48         try {</span>
<span class="line-added"> 49             InetAddress loopback = InetAddress.getLoopbackAddress();</span>
<span class="line-added"> 50             String addr = loopback.getHostAddress();</span>
<span class="line-added"> 51             if (loopback instanceof Inet6Address) {</span>
<span class="line-added"> 52                 addr = &quot;[&quot; + addr + &quot;]&quot;;</span>
<span class="line-added"> 53             }</span>
<span class="line-added"> 54             loopbackAddr = addr;</span>
<span class="line-added"> 55 </span>
<span class="line-added"> 56             InetSocketAddress isa = new InetSocketAddress((InetAddress) null, 80);</span>
<span class="line-added"> 57             addr = isa.getAddress().toString();</span>
<span class="line-added"> 58             if (isa.getAddress() instanceof Inet6Address) {</span>
<span class="line-added"> 59                 addr = &quot;::/[0:0:0:0:0:0:0:0]&quot;;</span>
<span class="line-added"> 60             }</span>
<span class="line-added"> 61             wildcardAddr = addr;</span>
<span class="line-added"> 62 </span>
<span class="line-added"> 63             InetAddress ia = InetAddress.getLocalHost();</span>
<span class="line-added"> 64             addr = ia.toString();</span>
<span class="line-added"> 65             if (ia instanceof Inet6Address) {</span>
<span class="line-added"> 66                 addr = ia.getHostName() + &quot;/[&quot; + ia.getHostAddress() + &quot;]&quot;;</span>
<span class="line-added"> 67             }</span>
<span class="line-added"> 68             localAddr = addr;</span>
<span class="line-added"> 69 </span>
<span class="line-added"> 70         } catch (UnknownHostException uhe) {</span>
<span class="line-added"> 71             throw new RuntimeException(uhe);</span>
<span class="line-added"> 72         }</span>
<span class="line-added"> 73     }</span>
<span class="line-added"> 74 </span>
<span class="line-added"> 75     @BeforeTest</span>
<span class="line-added"> 76     public void setup() {</span>
<span class="line-added"> 77         IPSupport.throwSkippedExceptionIfNonOperational();</span>
<span class="line-added"> 78     }</span>
<span class="line-added"> 79 </span>
<span class="line-added"> 80     @Test</span>
<span class="line-added"> 81     // InetSocketAddress.toString() throws NPE with unresolved address</span>
<span class="line-added"> 82     public static void NPETest() {</span>
 83         System.out.println(new InetSocketAddress(&quot;unresolved&quot;, 12345));
<span class="line-added"> 84     }</span>
<span class="line-added"> 85 </span>
<span class="line-added"> 86     @DataProvider(name = &quot;hostPortArgs&quot;)</span>
<span class="line-added"> 87     public Object[][] createArgs1() {</span>
<span class="line-added"> 88         return new Object[][]{</span>
<span class="line-added"> 89                 // hostname, port number, expected string in format</span>
<span class="line-added"> 90                 // &lt;hostname&gt;/&lt;IP literal&gt;:&lt;port&gt; or</span>
<span class="line-added"> 91                 // &lt;hostname&gt;/&lt;unresolved&gt;:&lt;port&gt; if address is unresolved</span>
<span class="line-added"> 92                 {&quot;::1&quot;, 80, &quot;/[0:0:0:0:0:0:0:1]:80&quot;},</span>
<span class="line-added"> 93                 {&quot;fedc:ba98:7654:3210:fedc:ba98:7654:3210&quot;, 80, &quot;/[fedc:ba98:7654:3210:fedc:ba98:7654:3210]:80&quot;},</span>
<span class="line-added"> 94                 {&quot;::192.9.5.5&quot;, 80, &quot;/[0:0:0:0:0:0:c009:505]:80&quot;},</span>
<span class="line-added"> 95                 {&quot;127.0.0.1&quot;, 80, &quot;/127.0.0.1:80&quot;},</span>
<span class="line-added"> 96                 {&quot;::ffff:192.0.2.128&quot;, 80, &quot;/192.0.2.128:80&quot;},</span>
<span class="line-added"> 97                 {&quot;0&quot;, 80, &quot;/0.0.0.0:80&quot;},</span>
<span class="line-added"> 98                 {&quot;:&quot;, 80, &quot;:/&lt;unresolved&gt;:80&quot;},</span>
<span class="line-added"> 99                 {&quot;:1&quot;, 80, &quot;:1/&lt;unresolved&gt;:80&quot;}</span>
<span class="line-added">100         };</span>
<span class="line-added">101     }</span>
<span class="line-added">102 </span>
<span class="line-added">103     @Test(dataProvider = &quot;hostPortArgs&quot;)</span>
<span class="line-added">104     public static void testConstructor(String host, int port, String string) {</span>
<span class="line-added">105         String received = new InetSocketAddress(host, port).toString();</span>
<span class="line-added">106 </span>
<span class="line-added">107         if (!string.equals(received)) {</span>
<span class="line-added">108             throw new RuntimeException(&quot;Expected: &quot; + string + &quot; Received: &quot; + received);</span>
<span class="line-added">109         }</span>
<span class="line-added">110     }</span>
<span class="line-added">111 </span>
<span class="line-added">112     @DataProvider(name = &quot;addrPortArgs&quot;)</span>
<span class="line-added">113     public Object[][] createArgs2() {</span>
<span class="line-added">114         InetAddress nullAddr = null;</span>
<span class="line-added">115         try {</span>
<span class="line-added">116             return new Object[][]{</span>
<span class="line-added">117                     // InetAddress, port number, expected string</span>
<span class="line-added">118                     {InetAddress.getLoopbackAddress(), 80, &quot;localhost/&quot; + loopbackAddr + &quot;:80&quot;},</span>
<span class="line-added">119                     {InetAddress.getLocalHost(), 80, localAddr + &quot;:80&quot;},</span>
<span class="line-added">120                     {InetAddress.getByAddress(new byte[]{1, 1, 1, 1}), 80, &quot;/1.1.1.1:80&quot;},</span>
<span class="line-added">121                     {InetAddress.getByAddress(new byte[]{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}), 80, &quot;/[101:101:101:101:101:101:101:101]:80&quot;},</span>
<span class="line-added">122                     {InetAddress.getByName(&quot;225.225.225.0&quot;), 80, &quot;/225.225.225.0:80&quot;},</span>
<span class="line-added">123                     {nullAddr, 80, wildcardAddr + &quot;:80&quot;}</span>
<span class="line-added">124             };</span>
<span class="line-added">125         } catch (UnknownHostException uhe) {</span>
<span class="line-added">126             throw new RuntimeException(&quot;Data provider creation failed: &quot; + uhe, uhe);</span>
<span class="line-added">127         }</span>
<span class="line-added">128     }</span>
<span class="line-added">129 </span>
<span class="line-added">130     @Test(dataProvider = &quot;addrPortArgs&quot;)</span>
<span class="line-added">131     public static void testConstructor(InetAddress addr, int port, String string) {</span>
<span class="line-added">132         String received = new InetSocketAddress(addr, port).toString();</span>
<span class="line-added">133 </span>
<span class="line-added">134         if (!string.equals(received)) {</span>
<span class="line-added">135             throw new RuntimeException(&quot;Expected: &quot; + string + &quot; Received: &quot; + received);</span>
<span class="line-added">136         }</span>
<span class="line-added">137     }</span>
<span class="line-added">138 </span>
<span class="line-added">139     @DataProvider(name = &quot;unresolved&quot;)</span>
<span class="line-added">140     public Object[][] createArgs3() {</span>
<span class="line-added">141         return new Object[][]{</span>
<span class="line-added">142                 // hostname, port number, expected string</span>
<span class="line-added">143                 {&quot;::1&quot;, 80, &quot;::1/&lt;unresolved&gt;:80&quot;},</span>
<span class="line-added">144                 {&quot;fedc:ba98:7654:3210:fedc:ba98:7654:3210&quot;, 80, &quot;fedc:ba98:7654:3210:fedc:ba98:7654:3210/&lt;unresolved&gt;:80&quot;},</span>
<span class="line-added">145                 {&quot;::192.9.5.5&quot;, 80, &quot;::192.9.5.5/&lt;unresolved&gt;:80&quot;},</span>
<span class="line-added">146                 {&quot;127.0.0.1&quot;, 80, &quot;127.0.0.1/&lt;unresolved&gt;:80&quot;},</span>
<span class="line-added">147                 {&quot;::ffff:192.0.2.128&quot;, 80, &quot;::ffff:192.0.2.128/&lt;unresolved&gt;:80&quot;},</span>
<span class="line-added">148                 {&quot;0&quot;, 80, &quot;0/&lt;unresolved&gt;:80&quot;},</span>
<span class="line-added">149                 {&quot;foo&quot;, 80, &quot;foo/&lt;unresolved&gt;:80&quot;},</span>
<span class="line-added">150                 {&quot;:&quot;, 80, &quot;:/&lt;unresolved&gt;:80&quot;},</span>
<span class="line-added">151                 {&quot;:1&quot;, 80, &quot;:1/&lt;unresolved&gt;:80&quot;}</span>
<span class="line-added">152         };</span>
<span class="line-added">153     }</span>
<span class="line-added">154 </span>
<span class="line-added">155     @Test(dataProvider = &quot;unresolved&quot;)</span>
<span class="line-added">156     public static void testCreateUnresolved(String host, int port, String string) {</span>
<span class="line-added">157         String received = InetSocketAddress.createUnresolved(host, port).toString();</span>
158 
<span class="line-added">159         if (!string.equals(received)) {</span>
<span class="line-added">160             throw new RuntimeException(&quot;Expected: &quot; + string + &quot; Received: &quot; + received);</span>
<span class="line-added">161         }</span>
162     }
163 }
</pre>
</td>
</tr>
</table>
<center><a href="../InetAddress/ptr/Lookup.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../MulticastSocket/JoinLeave.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>