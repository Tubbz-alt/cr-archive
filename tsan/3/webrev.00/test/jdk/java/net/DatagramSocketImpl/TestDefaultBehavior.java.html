<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/java/net/DatagramSocketImpl/TestDefaultBehavior.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8224477
 27  * @summary Basic test for java.net.DatagramSocketImpl default behavior
 28  * @run testng TestDefaultBehavior
 29  */
 30 
 31 import java.io.IOException;
 32 import java.net.DatagramPacket;
 33 import java.net.DatagramSocketImpl;
 34 import java.net.InetAddress;
 35 import java.net.NetworkInterface;
 36 import java.net.SocketAddress;
 37 import java.net.SocketOption;
 38 import java.util.Set;
 39 import org.testng.annotations.Test;
 40 import static java.lang.Boolean.*;
 41 import static java.net.StandardSocketOptions.*;
 42 import static org.testng.Assert.assertEquals;
 43 import static org.testng.Assert.expectThrows;
 44 
 45 public class TestDefaultBehavior {
 46 
 47     static final Class&lt;NullPointerException&gt; NPE = NullPointerException.class;
 48     static final Class&lt;UnsupportedOperationException&gt; UOE = UnsupportedOperationException.class;
 49 
 50     @Test
 51     public void datagramSocketImpl() {
 52         CustomDatagramSocketImpl dsi = new CustomDatagramSocketImpl();
 53 
 54         assertEquals(dsi.supportedOptions().size(), 0);
 55 
 56         expectThrows(NPE, () -&gt; dsi.setOption(null, null));
 57         expectThrows(NPE, () -&gt; dsi.setOption(null, 1));
 58         expectThrows(UOE, () -&gt; dsi.setOption(SO_RCVBUF, 100));
 59         expectThrows(UOE, () -&gt; dsi.setOption(SO_KEEPALIVE, TRUE));
 60         expectThrows(UOE, () -&gt; dsi.setOption(SO_KEEPALIVE, FALSE));
 61         expectThrows(UOE, () -&gt; dsi.setOption(FAKE_SOCK_OPT, TRUE));
 62         expectThrows(UOE, () -&gt; dsi.setOption(FAKE_SOCK_OPT, FALSE));
 63         expectThrows(UOE, () -&gt; dsi.setOption(SO_KEEPALIVE, TRUE));
 64 
 65         expectThrows(NPE, () -&gt; dsi.getOption(null));
 66         expectThrows(UOE, () -&gt; dsi.getOption(SO_RCVBUF));
 67         expectThrows(UOE, () -&gt; dsi.getOption(SO_KEEPALIVE));
 68         expectThrows(UOE, () -&gt; dsi.getOption(FAKE_SOCK_OPT));
 69     }
 70 
 71     static final SocketOption&lt;Boolean&gt; FAKE_SOCK_OPT = new SocketOption&lt;&gt;() {
 72         @Override public String name() { return &quot;FAKE_SOCK_OPT&quot;; }
 73         @Override public Class&lt;Boolean&gt; type() { return Boolean.class; }
 74     };
 75 
 76     // A DatagramSocketImpl that delegates the three new-style socket option
 77     // methods to the default java.net.DatagramSocketImpl implementation.
 78     static class CustomDatagramSocketImpl extends DatagramSocketImpl {
 79 
 80         @Override
 81         public &lt;T&gt; void setOption(SocketOption&lt;T&gt; name, T value) throws IOException {
 82             super.setOption(name, value);
 83         }
 84 
 85         @Override
 86         public Set&lt;SocketOption&lt;?&gt;&gt; supportedOptions() {
 87             return super.supportedOptions();
 88         }
 89 
 90         @Override
 91         public &lt;T&gt; T getOption(SocketOption&lt;T&gt; name) throws IOException {
 92             return super.getOption(name);
 93         }
 94 
 95         // --
 96         @Override protected void create() { }
 97         @Override protected void bind(int lport, InetAddress laddr) { }
 98         @Override protected void send(DatagramPacket p) { }
 99         @Override protected int peek(InetAddress i) { return 0; }
100         @Override protected int peekData(DatagramPacket p) { return 0; }
101         @Override protected void receive(DatagramPacket p) { }
102         @Override protected void setTTL(byte ttl) { }
103         @Override protected byte getTTL() { return 0; }
104         @Override protected void setTimeToLive(int ttl) { }
105         @Override protected int getTimeToLive() { return 0; }
106         @Override protected void join(InetAddress inetaddr) { }
107         @Override protected void leave(InetAddress inetaddr)  { }
108         @Override protected void joinGroup(SocketAddress mcastaddr, NetworkInterface netIf) { }
109         @Override protected void leaveGroup(SocketAddress mcastaddr, NetworkInterface netIf) { }
110         @Override protected void close() { }
111         @Override public void setOption(int optID, Object value) { }
112         @Override public Object getOption(int optID) { return null; }
113     }
114 }
    </pre>
  </body>
</html>