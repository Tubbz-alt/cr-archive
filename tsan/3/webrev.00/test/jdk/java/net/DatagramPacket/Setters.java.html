<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/java/net/DatagramPacket/Setters.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /* @test
 25  * @bug 7021373
 26  * @summary check that the DatagramPacket setter methods
 27  *          throw the correct exceptions
 28  * @run testng Setters
 29  */
 30 
 31 
 32 import java.net.DatagramPacket;
 33 
 34 import org.testng.annotations.DataProvider;
 35 import org.testng.annotations.Test;
 36 
 37 import static org.testng.Assert.assertTrue;
 38 import static org.testng.Assert.expectThrows;
 39 
 40 public class Setters {
 41 
 42     private static final byte[] buf = new byte[128];
 43 
 44     private static final Class&lt;IllegalArgumentException&gt; IAE = IllegalArgumentException.class;
 45     private static final Class&lt;NullPointerException&gt; NPE = NullPointerException.class;
 46 
 47     @Test
 48     public void testSetAddress() throws Exception {
 49         DatagramPacket pkt = new DatagramPacket(buf, 8);
 50 
 51         // No Exception expected for null addresses
 52         pkt.setAddress(null);
 53         assertTrue(pkt.getAddress() == null);
 54     }
 55 
 56     @DataProvider
 57     Object[][] data() { // add checks for setAddress with null - add getAddress to verify
 58         return new Object[][]{
 59                 { buf,          0,      -1,     IAE  },
 60                 { buf,          -1,     1,      IAE  },
 61                 { buf,          128,    128,    IAE  },
 62                 { null,         0,      0,      NPE  },
 63                 { new byte[8],  2,      2,      null },
 64                 { buf,          2,      2,      null },
 65                 { buf,          20,     20,     null },
 66         };
 67     }
 68 
 69     @Test(dataProvider = &quot;data&quot;)
 70     public void testSetData(byte[] buf,
 71                             int offset,
 72                             int length,
 73                             Class&lt;? extends Exception&gt; exception) {
 74         DatagramPacket pkt = new DatagramPacket(new byte[8], 8);
 75 
 76         if (exception != null) {
 77             expectThrows(exception, () -&gt; pkt.setData(buf, offset, length));
 78         } else if (buf == null) {
 79             expectThrows(exception, () -&gt; pkt.setData(buf));
 80         } else {
 81             pkt.setData(buf, offset, length);
 82         }
 83     }
 84 
 85     @DataProvider
 86     Object[][] lengths() {
 87         return new Object[][]{
 88                 { 0,     -1,     IAE  },
 89                 { 8,     1,      IAE  },
 90                 { 4,     -2,     IAE  },
 91                 { 0,     9,      IAE  },
 92                 { 2,     2,      null },
 93                 { 4,     4,      null }
 94         };
 95     }
 96 
 97     @Test(dataProvider = &quot;lengths&quot;)
 98     public void testSetLength(int offset, int length,
 99                               Class&lt;? extends Exception&gt; exception) {
100         DatagramPacket pkt = new DatagramPacket(new byte[8], offset, 0);
101 
102         if (exception != null) {
103             expectThrows(exception, () -&gt; pkt.setLength(length));
104         } else {
105             pkt.setLength(length);
106         }
107     }
108 
109     @DataProvider
110     Object[][] ports() {
111         return new Object[][]{
112                 { -1,                IAE  },
113                 { -666,              IAE  },
114                 { Integer.MAX_VALUE, IAE  },
115                 { 0xFFFF + 1,        IAE  },
116                 { 0xFFFFFF,          IAE  },
117                 { 0,                 null },
118                 { 1,                 null },
119                 { 666,               null },
120                 { 0xFFFE,            null },
121                 { 0xFFFF,            null },
122         };
123     }
124 
125     @Test(dataProvider = &quot;ports&quot;)
126     public void testSetPort(int port, Class&lt;? extends Exception&gt; exception) {
127         DatagramPacket pkt = new DatagramPacket(new byte[8], 0);
128 
129         if (exception != null) {
130             expectThrows(exception, () -&gt; pkt.setPort(port));
131         } else {
132             pkt.setPort(port);
133         }
134     }
135 }
    </pre>
  </body>
</html>