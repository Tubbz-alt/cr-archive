<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/java/net/httpclient/reactivestreams-tck-tests/STest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import org.testng.annotations.DataProvider;
 25 import org.testng.annotations.Test;
 26 
 27 import java.io.IOException;
 28 import java.io.InputStream;
 29 import java.nio.ByteBuffer;
 30 import java.util.Arrays;
 31 import java.util.List;
 32 
 33 import static org.testng.Assert.assertEquals;
 34 import static org.testng.Assert.assertTrue;
 35 
 36 public class STest {
 37 
 38     @DataProvider(name = &quot;bufferSizes&quot;)
 39     public static Object[][] bufferSizes() {
 40         return new Object[][]{
 41                 { 1},
 42                 { 2},
 43                 { 3},
 44                 { 4},
 45                 {16},
 46                 {17},
 47         };
 48     }
 49 
 50     @DataProvider
 51     public static Object[][] inputStream() {
 52         return new Object[][] {
 53                 {  0,   1},
 54                 {  1,   2},
 55                 {  1,   3},
 56                 {  1,   4},
 57                 {  2,   1},
 58                 {  2,   2},
 59                 {  2,   3},
 60                 {  2,   4},
 61                 {  2,  13},
 62                 {  3,   1},
 63                 {  3,   2},
 64                 {  3,   3},
 65                 {  3,   4},
 66                 {  3,  17},
 67                 {  4,   1},
 68                 {  4,   2},
 69                 {  4,   3},
 70                 {  4,   4},
 71                 {  4,   5},
 72                 { 13,   1},
 73                 { 13,   2},
 74                 { 13,  13},
 75                 { 16,  18},
 76                 { 17,   2},
 77                 {255,   1},
 78                 {256, 255},
 79                 {257, 267},
 80         };
 81     }
 82 
 83     @Test
 84     public void testScatter0() {
 85         List&lt;ByteBuffer&gt; buffers = S.scatterBuffer(
 86                 ByteBuffer.allocate(0));
 87         assertEquals(buffers.size(), 0);
 88     }
 89 
 90     @Test(dataProvider = &quot;bufferSizes&quot;)
 91     public void testScatterN(int n) {
 92         final ByteBuffer src = S.bufferOfNRandomBytes(n);
 93         final int srcLength = src.remaining();
 94         ByteBuffer copy = ByteBuffer.wrap(Arrays.copyOf(src.array(),
 95                                                         src.array().length));
 96         List&lt;ByteBuffer&gt; buffers = S.scatterBuffer(src);
 97         int m = 0;
 98         for (ByteBuffer b : buffers) {
 99             m += b.remaining();
100             while (b.hasRemaining() &amp; copy.hasRemaining()) {
101                 assertEquals(b.get(), copy.get());
102             }
103         }
104         assertEquals(m, srcLength);
105     }
106 
107     @Test(dataProvider = &quot;inputStream&quot;)
108     public void testInputStreamOfNReads(int n, int capacity) throws IOException {
109         InputStream s = S.inputStreamOfNReads(n);
110         int count = 0;
111         byte[] b = new byte[capacity];
112         while (s.read(b) != -1) {
113             count++;
114         }
115         assertEquals(count, n);
116         assertTrue(s.read() == -1);
117         assertTrue(s.read(b) == -1);
118     }
119 }
    </pre>
  </body>
</html>