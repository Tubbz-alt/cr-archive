<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/net/httpclient/websocket/Abort.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @build DummyWebSocketServer
 27  * @run testng/othervm
 28  *      -Djdk.internal.httpclient.websocket.debug=true
 29  *       Abort
 30  */
 31 
<a name="2" id="anc2"></a>
 32 import org.testng.annotations.Test;
 33 
 34 import java.io.IOException;
 35 import java.net.ProtocolException;
 36 import java.net.http.WebSocket;
 37 import java.nio.ByteBuffer;
 38 import java.util.Arrays;
 39 import java.util.List;
 40 import java.util.concurrent.CompletableFuture;
 41 import java.util.concurrent.CompletionStage;
 42 import java.util.concurrent.TimeUnit;
 43 import java.util.concurrent.TimeoutException;
 44 
 45 import static java.net.http.HttpClient.newHttpClient;
 46 import static java.net.http.WebSocket.NORMAL_CLOSURE;
 47 import static org.testng.Assert.assertEquals;
 48 import static org.testng.Assert.assertThrows;
 49 import static org.testng.Assert.assertTrue;
 50 import static org.testng.Assert.fail;
 51 
 52 public class Abort {
 53 
 54     private static final Class&lt;NullPointerException&gt; NPE = NullPointerException.class;
 55     private static final Class&lt;IllegalArgumentException&gt; IAE = IllegalArgumentException.class;
 56     private static final Class&lt;IOException&gt; IOE = IOException.class;
 57 
<a name="3" id="anc3"></a>







 58 
 59     @Test
 60     public void onOpenThenAbort() throws Exception {
 61         int[] bytes = new int[]{
 62                 0x88, 0x00, // opcode=close
 63         };
<a name="4" id="anc4"></a><span class="line-modified"> 64         try (var server = Support.serverWithCannedData(bytes)) {</span>
<span class="line-modified"> 65             server.open();</span>
<span class="line-modified"> 66             // messages are available</span>
<span class="line-modified"> 67             MockListener listener = new MockListener() {</span>
<span class="line-modified"> 68                 @Override</span>
<span class="line-modified"> 69                 protected void onOpen0(WebSocket webSocket) {</span>
<span class="line-modified"> 70                     // unbounded request</span>
<span class="line-modified"> 71                     webSocket.request(Long.MAX_VALUE);</span>
<span class="line-added"> 72                     webSocket.abort();</span>
<span class="line-added"> 73                 }</span>
<span class="line-added"> 74             };</span>
<span class="line-added"> 75             var webSocket = newHttpClient().newWebSocketBuilder()</span>
<span class="line-added"> 76                     .buildAsync(server.getURI(), listener)</span>
<span class="line-added"> 77                     .join();</span>
<span class="line-added"> 78             try {</span>
<span class="line-added"> 79                 TimeUnit.SECONDS.sleep(5);</span>
<span class="line-added"> 80                 List&lt;MockListener.Invocation&gt; inv = listener.invocationsSoFar();</span>
<span class="line-added"> 81                 // no more invocations after onOpen as WebSocket was aborted</span>
<span class="line-added"> 82                 assertEquals(inv, List.of(MockListener.Invocation.onOpen(webSocket)));</span>
<span class="line-added"> 83             } finally {</span>
 84                 webSocket.abort();
 85             }
<a name="5" id="anc5"></a><span class="line-modified"> 86         }</span>







 87     }
 88 
 89     @Test
 90     public void onOpenThenOnTextThenAbort() throws Exception {
 91         int[] bytes = new int[]{
 92                 0x81, 0x00, // opcode=text, fin=true
 93                 0x88, 0x00, // opcode=close
 94         };
<a name="6" id="anc6"></a><span class="line-modified"> 95         try (var server = Support.serverWithCannedData(bytes)) {</span>
<span class="line-modified"> 96             server.open();</span>
<span class="line-modified"> 97             MockListener listener = new MockListener() {</span>
<span class="line-modified"> 98                 @Override</span>
<span class="line-modified"> 99                 protected void onOpen0(WebSocket webSocket) {</span>
<span class="line-modified">100                     // unbounded request</span>
<span class="line-modified">101                     webSocket.request(Long.MAX_VALUE);</span>
<span class="line-modified">102                 }</span>
103 
<a name="7" id="anc7"></a><span class="line-modified">104                 @Override</span>
<span class="line-modified">105                 protected CompletionStage&lt;?&gt; onText0(WebSocket webSocket,</span>
<span class="line-modified">106                                                      CharSequence message,</span>
<span class="line-modified">107                                                      boolean last) {</span>
<span class="line-added">108                     webSocket.abort();</span>
<span class="line-added">109                     return super.onText0(webSocket, message, last);</span>
<span class="line-added">110                 }</span>
<span class="line-added">111             };</span>
<span class="line-added">112             var webSocket = newHttpClient().newWebSocketBuilder()</span>
<span class="line-added">113                     .buildAsync(server.getURI(), listener)</span>
<span class="line-added">114                     .join();</span>
<span class="line-added">115             try {</span>
<span class="line-added">116                 TimeUnit.SECONDS.sleep(5);</span>
<span class="line-added">117                 List&lt;MockListener.Invocation&gt; inv = listener.invocationsSoFar();</span>
<span class="line-added">118                 // no more invocations after onOpen, onBinary as WebSocket was aborted</span>
<span class="line-added">119                 List&lt;MockListener.Invocation&gt; expected = List.of(</span>
<span class="line-added">120                         MockListener.Invocation.onOpen(webSocket),</span>
<span class="line-added">121                         MockListener.Invocation.onText(webSocket, &quot;&quot;, true));</span>
<span class="line-added">122                 assertEquals(inv, expected);</span>
<span class="line-added">123             } finally {</span>
124                 webSocket.abort();
<a name="8" id="anc8"></a>
125             }
<a name="9" id="anc9"></a><span class="line-modified">126         }</span>










127     }
128 
129     @Test
130     public void onOpenThenOnBinaryThenAbort() throws Exception {
131         int[] bytes = new int[]{
132                 0x82, 0x00, // opcode=binary, fin=true
133                 0x88, 0x00, // opcode=close
134         };
<a name="10" id="anc10"></a><span class="line-modified">135         try (var server = Support.serverWithCannedData(bytes)) {</span>
<span class="line-modified">136             server.open();</span>
<span class="line-modified">137             MockListener listener = new MockListener() {</span>
<span class="line-modified">138                 @Override</span>
<span class="line-modified">139                 protected void onOpen0(WebSocket webSocket) {</span>
<span class="line-modified">140                     // unbounded request</span>
<span class="line-modified">141                     webSocket.request(Long.MAX_VALUE);</span>
<span class="line-modified">142                 }</span>
143 
<a name="11" id="anc11"></a><span class="line-modified">144                 @Override</span>
<span class="line-modified">145                 protected CompletionStage&lt;?&gt; onBinary0(WebSocket webSocket,</span>
<span class="line-modified">146                                                        ByteBuffer message,</span>
<span class="line-modified">147                                                        boolean last) {</span>
<span class="line-added">148                     webSocket.abort();</span>
<span class="line-added">149                     return super.onBinary0(webSocket, message, last);</span>
<span class="line-added">150                 }</span>
<span class="line-added">151             };</span>
<span class="line-added">152             var webSocket = newHttpClient().newWebSocketBuilder()</span>
<span class="line-added">153                     .buildAsync(server.getURI(), listener)</span>
<span class="line-added">154                     .join();</span>
<span class="line-added">155             try {</span>
<span class="line-added">156                 TimeUnit.SECONDS.sleep(5);</span>
<span class="line-added">157                 List&lt;MockListener.Invocation&gt; inv = listener.invocationsSoFar();</span>
<span class="line-added">158                 // no more invocations after onOpen, onBinary as WebSocket was aborted</span>
<span class="line-added">159                 List&lt;MockListener.Invocation&gt; expected = List.of(</span>
<span class="line-added">160                         MockListener.Invocation.onOpen(webSocket),</span>
<span class="line-added">161                         MockListener.Invocation.onBinary(webSocket, ByteBuffer.allocate(0), true));</span>
<span class="line-added">162                 assertEquals(inv, expected);</span>
<span class="line-added">163             } finally {</span>
164                 webSocket.abort();
<a name="12" id="anc12"></a>
165             }
<a name="13" id="anc13"></a><span class="line-modified">166         }</span>










167     }
168 
169     @Test
170     public void onOpenThenOnPingThenAbort() throws Exception {
171         int[] bytes = {
172                 0x89, 0x00, // opcode=ping
173                 0x88, 0x00, // opcode=close
174         };
<a name="14" id="anc14"></a><span class="line-modified">175         try (var server = Support.serverWithCannedData(bytes)) {</span>
<span class="line-modified">176             server.open();</span>
<span class="line-modified">177             MockListener listener = new MockListener() {</span>
<span class="line-modified">178                 @Override</span>
<span class="line-modified">179                 protected void onOpen0(WebSocket webSocket) {</span>
<span class="line-modified">180                     // unbounded request</span>
<span class="line-modified">181                     webSocket.request(Long.MAX_VALUE);</span>
<span class="line-modified">182                 }</span>
183 
<a name="15" id="anc15"></a><span class="line-modified">184                 @Override</span>
<span class="line-modified">185                 protected CompletionStage&lt;?&gt; onPing0(WebSocket webSocket,</span>
<span class="line-modified">186                                                      ByteBuffer message) {</span>
<span class="line-added">187                     webSocket.abort();</span>
<span class="line-added">188                     return super.onPing0(webSocket, message);</span>
<span class="line-added">189                 }</span>
<span class="line-added">190             };</span>
<span class="line-added">191             var webSocket = newHttpClient().newWebSocketBuilder()</span>
<span class="line-added">192                     .buildAsync(server.getURI(), listener)</span>
<span class="line-added">193                     .join();</span>
<span class="line-added">194             try {</span>
<span class="line-added">195                 TimeUnit.SECONDS.sleep(5);</span>
<span class="line-added">196                 List&lt;MockListener.Invocation&gt; inv = listener.invocationsSoFar();</span>
<span class="line-added">197                 // no more invocations after onOpen, onPing as WebSocket was aborted</span>
<span class="line-added">198                 List&lt;MockListener.Invocation&gt; expected = List.of(</span>
<span class="line-added">199                         MockListener.Invocation.onOpen(webSocket),</span>
<span class="line-added">200                         MockListener.Invocation.onPing(webSocket, ByteBuffer.allocate(0)));</span>
<span class="line-added">201                 assertEquals(inv, expected);</span>
<span class="line-added">202             } finally {</span>
203                 webSocket.abort();
<a name="16" id="anc16"></a>
204             }
<a name="17" id="anc17"></a><span class="line-modified">205         }</span>










206     }
207 
208     @Test
209     public void onOpenThenOnPongThenAbort() throws Exception {
210         int[] bytes = {
211                 0x8a, 0x00, // opcode=pong
212                 0x88, 0x00, // opcode=close
213         };
<a name="18" id="anc18"></a><span class="line-modified">214         try (var server = Support.serverWithCannedData(bytes)) {</span>
<span class="line-modified">215             server.open();</span>
<span class="line-modified">216             MockListener listener = new MockListener() {</span>
<span class="line-modified">217                 @Override</span>
<span class="line-modified">218                 protected void onOpen0(WebSocket webSocket) {</span>
<span class="line-modified">219                     // unbounded request</span>
<span class="line-modified">220                     webSocket.request(Long.MAX_VALUE);</span>
<span class="line-modified">221                 }</span>
222 
<a name="19" id="anc19"></a><span class="line-modified">223                 @Override</span>
<span class="line-modified">224                 protected CompletionStage&lt;?&gt; onPong0(WebSocket webSocket,</span>
<span class="line-modified">225                                                      ByteBuffer message) {</span>
<span class="line-added">226                     webSocket.abort();</span>
<span class="line-added">227                     return super.onPong0(webSocket, message);</span>
<span class="line-added">228                 }</span>
<span class="line-added">229             };</span>
<span class="line-added">230             var webSocket = newHttpClient().newWebSocketBuilder()</span>
<span class="line-added">231                     .buildAsync(server.getURI(), listener)</span>
<span class="line-added">232                     .join();</span>
<span class="line-added">233             try {</span>
<span class="line-added">234                 TimeUnit.SECONDS.sleep(5);</span>
<span class="line-added">235                 List&lt;MockListener.Invocation&gt; inv = listener.invocationsSoFar();</span>
<span class="line-added">236                 // no more invocations after onOpen, onPong as WebSocket was aborted</span>
<span class="line-added">237                 List&lt;MockListener.Invocation&gt; expected = List.of(</span>
<span class="line-added">238                         MockListener.Invocation.onOpen(webSocket),</span>
<span class="line-added">239                         MockListener.Invocation.onPong(webSocket, ByteBuffer.allocate(0)));</span>
<span class="line-added">240                 assertEquals(inv, expected);</span>
<span class="line-added">241             } finally {</span>
242                 webSocket.abort();
<a name="20" id="anc20"></a>
243             }
<a name="21" id="anc21"></a><span class="line-modified">244         }</span>










245     }
246 
247     @Test
248     public void onOpenThenOnCloseThenAbort() throws Exception {
249         int[] bytes = {
250                 0x88, 0x00, // opcode=close
251                 0x8a, 0x00, // opcode=pong
252         };
<a name="22" id="anc22"></a><span class="line-modified">253         try (var server = Support.serverWithCannedData(bytes)) {</span>
<span class="line-modified">254             server.open();</span>
<span class="line-modified">255             MockListener listener = new MockListener() {</span>
<span class="line-modified">256                 @Override</span>
<span class="line-modified">257                 protected void onOpen0(WebSocket webSocket) {</span>
<span class="line-modified">258                     // unbounded request</span>
<span class="line-modified">259                     webSocket.request(Long.MAX_VALUE);</span>
<span class="line-modified">260                 }</span>
261 
<a name="23" id="anc23"></a><span class="line-modified">262                 @Override</span>
<span class="line-modified">263                 protected CompletionStage&lt;?&gt; onClose0(WebSocket webSocket,</span>
<span class="line-modified">264                                                       int statusCode,</span>
<span class="line-modified">265                                                       String reason) {</span>
<span class="line-added">266                     webSocket.abort();</span>
<span class="line-added">267                     return super.onClose0(webSocket, statusCode, reason);</span>
<span class="line-added">268                 }</span>
<span class="line-added">269             };</span>
<span class="line-added">270             var webSocket = newHttpClient().newWebSocketBuilder()</span>
<span class="line-added">271                     .buildAsync(server.getURI(), listener)</span>
<span class="line-added">272                     .join();</span>
<span class="line-added">273             try {</span>
<span class="line-added">274                 TimeUnit.SECONDS.sleep(5);</span>
<span class="line-added">275                 List&lt;MockListener.Invocation&gt; inv = listener.invocationsSoFar();</span>
<span class="line-added">276                 // no more invocations after onOpen, onClose</span>
<span class="line-added">277                 List&lt;MockListener.Invocation&gt; expected = List.of(</span>
<span class="line-added">278                         MockListener.Invocation.onOpen(webSocket),</span>
<span class="line-added">279                         MockListener.Invocation.onClose(webSocket, 1005, &quot;&quot;));</span>
<span class="line-added">280                 assertEquals(inv, expected);</span>
<span class="line-added">281             } finally {</span>
282                 webSocket.abort();
<a name="24" id="anc24"></a>
283             }
<a name="25" id="anc25"></a><span class="line-modified">284         }</span>










285     }
286 
287     @Test
288     public void onOpenThenOnErrorThenAbort() throws Exception {
289         // A header of 128 bytes long Ping (which is a protocol error)
290         int[] badPingHeader = new int[]{0x89, 0x7e, 0x00, 0x80};
291         int[] closeMessage = new int[]{0x88, 0x00};
292         int[] bytes = new int[badPingHeader.length + 128 + closeMessage.length];
293         System.arraycopy(badPingHeader, 0, bytes, 0, badPingHeader.length);
294         System.arraycopy(closeMessage, 0, bytes, badPingHeader.length + 128, closeMessage.length);
<a name="26" id="anc26"></a><span class="line-modified">295         try (var server = Support.serverWithCannedData(bytes)) {</span>
<span class="line-modified">296             server.open();</span>
<span class="line-modified">297             MockListener listener = new MockListener() {</span>
<span class="line-modified">298                 @Override</span>
<span class="line-modified">299                 protected void onOpen0(WebSocket webSocket) {</span>
<span class="line-modified">300                     // unbounded request</span>
<span class="line-modified">301                     webSocket.request(Long.MAX_VALUE);</span>
<span class="line-modified">302                 }</span>
303 
<a name="27" id="anc27"></a><span class="line-modified">304                 @Override</span>
<span class="line-modified">305                 protected void onError0(WebSocket webSocket, Throwable error) {</span>
<span class="line-added">306                     webSocket.abort();</span>
<span class="line-added">307                     super.onError0(webSocket, error);</span>
<span class="line-added">308                 }</span>
<span class="line-added">309             };</span>
<span class="line-added">310             var webSocket = newHttpClient().newWebSocketBuilder()</span>
<span class="line-added">311                     .buildAsync(server.getURI(), listener)</span>
<span class="line-added">312                     .join();</span>
<span class="line-added">313             try {</span>
<span class="line-added">314                 TimeUnit.SECONDS.sleep(5);</span>
<span class="line-added">315                 List&lt;MockListener.Invocation&gt; inv = listener.invocationsSoFar();</span>
<span class="line-added">316                 // no more invocations after onOpen, onError</span>
<span class="line-added">317                 List&lt;MockListener.Invocation&gt; expected = List.of(</span>
<span class="line-added">318                         MockListener.Invocation.onOpen(webSocket),</span>
<span class="line-added">319                         MockListener.Invocation.onError(webSocket, ProtocolException.class));</span>
<span class="line-added">320                 System.out.println(&quot;actual invocations:&quot; + Arrays.toString(inv.toArray()));</span>
<span class="line-added">321                 assertEquals(inv, expected);</span>
<span class="line-added">322             } finally {</span>
323                 webSocket.abort();
<a name="28" id="anc28"></a>
324             }
<a name="29" id="anc29"></a><span class="line-modified">325         }</span>











326     }
327 
328     @Test
329     public void immediateAbort() throws Exception {
330         CompletableFuture&lt;Void&gt; messageReceived = new CompletableFuture&lt;&gt;();
331         WebSocket.Listener listener = new WebSocket.Listener() {
332 
333             @Override
334             public void onOpen(WebSocket webSocket) {
335                 /* no initial request */
336             }
337 
338             @Override
339             public CompletionStage&lt;?&gt; onText(WebSocket webSocket,
340                                              CharSequence message,
341                                              boolean last) {
342                 messageReceived.complete(null);
343                 return null;
344             }
345 
346             @Override
347             public CompletionStage&lt;?&gt; onBinary(WebSocket webSocket,
348                                                ByteBuffer message,
349                                                boolean last) {
350                 messageReceived.complete(null);
351                 return null;
352             }
353 
354             @Override
355             public CompletionStage&lt;?&gt; onPing(WebSocket webSocket,
356                                              ByteBuffer message) {
357                 messageReceived.complete(null);
358                 return null;
359             }
360 
361             @Override
362             public CompletionStage&lt;?&gt; onPong(WebSocket webSocket,
363                                              ByteBuffer message) {
364                 messageReceived.complete(null);
365                 return null;
366             }
367 
368             @Override
369             public CompletionStage&lt;?&gt; onClose(WebSocket webSocket,
370                                               int statusCode,
371                                               String reason) {
372                 messageReceived.complete(null);
373                 return null;
374             }
375         };
376 
377         int[] bytes = new int[]{
378                 0x82, 0x00, // opcode=binary, fin=true
379                 0x88, 0x00, // opcode=close
380         };
<a name="30" id="anc30"></a><span class="line-modified">381         try (var server = Support.serverWithCannedData(bytes)) {</span>
<span class="line-modified">382             server.open();</span>
383 
<a name="31" id="anc31"></a><span class="line-modified">384             WebSocket ws = newHttpClient()</span>
<span class="line-modified">385                     .newWebSocketBuilder()</span>
<span class="line-modified">386                     .buildAsync(server.getURI(), listener)</span>
<span class="line-modified">387                     .join();</span>
<span class="line-modified">388             try {</span>
<span class="line-modified">389                 for (int i = 0; i &lt; 3; i++) {</span>
<span class="line-modified">390                     System.out.printf(&quot;iteration #%s%n&quot;, i);</span>
<span class="line-modified">391                     // after the first abort() each consecutive one must be a no-op,</span>
<span class="line-modified">392                     // moreover, query methods should continue to return consistent</span>
<span class="line-modified">393                     // values</span>
<span class="line-modified">394                     for (int j = 0; j &lt; 3; j++) {</span>
<span class="line-added">395                         System.out.printf(&quot;abort #%s%n&quot;, j);</span>
<span class="line-added">396                         ws.abort();</span>
<span class="line-added">397                         assertTrue(ws.isInputClosed());</span>
<span class="line-added">398                         assertTrue(ws.isOutputClosed());</span>
<span class="line-added">399                         assertEquals(ws.getSubprotocol(), &quot;&quot;);</span>
<span class="line-added">400                     }</span>
<span class="line-added">401                     // at this point valid requests MUST be a no-op:</span>
<span class="line-added">402                     for (int j = 0; j &lt; 3; j++) {</span>
<span class="line-added">403                         System.out.printf(&quot;request #%s%n&quot;, j);</span>
<span class="line-added">404                         ws.request(1);</span>
<span class="line-added">405                         ws.request(2);</span>
<span class="line-added">406                         ws.request(8);</span>
<span class="line-added">407                         ws.request(Integer.MAX_VALUE);</span>
<span class="line-added">408                         ws.request(Long.MAX_VALUE);</span>
<span class="line-added">409                         // invalid requests MUST throw IAE:</span>
<span class="line-added">410                         assertThrows(IAE, () -&gt; ws.request(Integer.MIN_VALUE));</span>
<span class="line-added">411                         assertThrows(IAE, () -&gt; ws.request(Long.MIN_VALUE));</span>
<span class="line-added">412                         assertThrows(IAE, () -&gt; ws.request(-1));</span>
<span class="line-added">413                         assertThrows(IAE, () -&gt; ws.request(0));</span>
<span class="line-added">414                     }</span>
<span class="line-added">415                 }</span>
<span class="line-added">416                 // even though there is a bunch of messages readily available on the</span>
<span class="line-added">417                 // wire we shouldn&#39;t have received any of them as we aborted before</span>
<span class="line-added">418                 // the first request</span>
<span class="line-added">419                 try {</span>
<span class="line-added">420                     messageReceived.get(5, TimeUnit.SECONDS);</span>
<span class="line-added">421                     fail();</span>
<span class="line-added">422                 } catch (TimeoutException expected) {</span>
<span class="line-added">423                     System.out.println(&quot;Finished waiting&quot;);</span>
<span class="line-added">424                 }</span>
<span class="line-added">425                 for (int i = 0; i &lt; 3; i++) {</span>
<span class="line-added">426                     System.out.printf(&quot;send #%s%n&quot;, i);</span>
<span class="line-added">427                     Support.assertFails(IOE, ws.sendText(&quot;text!&quot;, false));</span>
<span class="line-added">428                     Support.assertFails(IOE, ws.sendText(&quot;text!&quot;, true));</span>
<span class="line-added">429                     Support.assertFails(IOE, ws.sendBinary(ByteBuffer.allocate(16), false));</span>
<span class="line-added">430                     Support.assertFails(IOE, ws.sendBinary(ByteBuffer.allocate(16), true));</span>
<span class="line-added">431                     Support.assertFails(IOE, ws.sendPing(ByteBuffer.allocate(16)));</span>
<span class="line-added">432                     Support.assertFails(IOE, ws.sendPong(ByteBuffer.allocate(16)));</span>
<span class="line-added">433                     Support.assertFails(IOE, ws.sendClose(NORMAL_CLOSURE, &quot;a reason&quot;));</span>
<span class="line-added">434                     assertThrows(NPE, () -&gt; ws.sendText(null, false));</span>
<span class="line-added">435                     assertThrows(NPE, () -&gt; ws.sendText(null, true));</span>
<span class="line-added">436                     assertThrows(NPE, () -&gt; ws.sendBinary(null, false));</span>
<span class="line-added">437                     assertThrows(NPE, () -&gt; ws.sendBinary(null, true));</span>
<span class="line-added">438                     assertThrows(NPE, () -&gt; ws.sendPing(null));</span>
<span class="line-added">439                     assertThrows(NPE, () -&gt; ws.sendPong(null));</span>
<span class="line-added">440                     assertThrows(NPE, () -&gt; ws.sendClose(NORMAL_CLOSURE, null));</span>
<span class="line-added">441                 }</span>
<span class="line-added">442             } finally {</span>
443                 ws.abort();
<a name="32" id="anc32"></a>
















444             }
445         }
<a name="33" id="anc33"></a>

























446     }
447 }
<a name="34" id="anc34"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="34" type="hidden" />
</body>
</html>