<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/java/net/Authenticator/B4962064.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="B4933582.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="B6870935.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/net/Authenticator/B4962064.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,10 +26,11 @@</span>
   * @bug 4962064
   * @modules java.base/sun.net.www
   * @library ../../../sun/net/www/httptest/
   * @build HttpCallback TestHttpServer ClosedChannelList HttpTransaction
   * @run main/othervm B4962064
<span class="udiff-line-added">+  * @run main/othervm -Djava.net.preferIPv6Addresses=true B4962064</span>
   * @summary Extend Authenticator to provide access to request URI and server/proxy
   */
  
  import java.io.*;
  import java.net.*;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -89,22 +90,28 @@</span>
      static TestHttpServer server;
      static URL urlsave;
  
      public static void main (String[] args) throws Exception {
          try {
<span class="udiff-line-modified-removed">-             server = new TestHttpServer (new B4962064(), 1, 10, 0);</span>
<span class="udiff-line-modified-added">+             InetAddress address = InetAddress.getLoopbackAddress();</span>
<span class="udiff-line-added">+             InetAddress resolved = InetAddress.getByName(address.getHostName());</span>
<span class="udiff-line-added">+             System.out.println(&quot;Lookup: &quot; + address + &quot; -&gt; \&quot;&quot;</span>
<span class="udiff-line-added">+                                + address.getHostName() + &quot;\&quot; -&gt; &quot;</span>
<span class="udiff-line-added">+                                + resolved);</span>
<span class="udiff-line-added">+             server = new TestHttpServer (new B4962064(), 1, 10, address, 0);</span>
              int port = server.getLocalPort();
<span class="udiff-line-modified-removed">-             System.setProperty (&quot;http.proxyHost&quot;, &quot;localhost&quot;);</span>
<span class="udiff-line-modified-added">+             String proxyHost = address.equals(resolved)</span>
<span class="udiff-line-added">+                 ? address.getHostName()</span>
<span class="udiff-line-added">+                 : address.getHostAddress();</span>
<span class="udiff-line-added">+             System.setProperty (&quot;http.proxyHost&quot;, proxyHost);</span>
              System.setProperty (&quot;http.proxyPort&quot;, Integer.toString (port));
              MyAuthenticator auth = new MyAuthenticator ();
              Authenticator.setDefault (auth);
              System.out.println (&quot;Server started: listening on port: &quot; + port);
<span class="udiff-line-removed">-             //String s = new String (&quot;http://localhost:&quot;+port+&quot;/d1/d2/d3/foo.html&quot;);</span>
              String s = new String (&quot;http://foo.com/d1/d2/d3/foo.html&quot;);
              urlsave = new URL (s);
              client (s);
<span class="udiff-line-removed">-             //s = new String (&quot;http://localhost:&quot;+port+&quot;/dr/d3/foo.html&quot;);</span>
              s = new String (&quot;http://bar.com/dr/d3/foo.html&quot;);
              urlsave = new URL (s);
              client (s);
          } catch (Exception e) {
              if (server != null) {
</pre>
<center><a href="B4933582.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="B6870935.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>