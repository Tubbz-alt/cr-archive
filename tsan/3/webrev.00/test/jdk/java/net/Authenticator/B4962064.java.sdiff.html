<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/net/Authenticator/B4962064.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="B4933582.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="B6870935.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/net/Authenticator/B4962064.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  * @test
 26  * @bug 4962064
 27  * @modules java.base/sun.net.www
 28  * @library ../../../sun/net/www/httptest/
 29  * @build HttpCallback TestHttpServer ClosedChannelList HttpTransaction
 30  * @run main/othervm B4962064

 31  * @summary Extend Authenticator to provide access to request URI and server/proxy
 32  */
 33 
 34 import java.io.*;
 35 import java.net.*;
 36 
 37 public class B4962064 implements HttpCallback {
 38 
 39     static int count = 0;
 40 
 41     public void request (HttpTransaction req) {
 42         try {
 43             switch (count) {
 44               case 0:
 45                 req.addResponseHeader (&quot;Connection&quot;, &quot;close&quot;);
 46                 req.addResponseHeader (&quot;WWW-Authenticate&quot;, &quot;Basic realm=\&quot;foo\&quot;&quot;);
 47                 req.sendResponse (401, &quot;Unauthorized&quot;);
 48                 req.orderlyClose();
 49                 break;
 50               case 1:
</pre>
<hr />
<pre>
 74         }
 75         System.out.println (&quot;&quot;);
 76         System.out.println (&quot;finished reading&quot;);
 77     }
 78 
 79 
 80     static void client (String u) throws Exception {
 81         URL url = new URL (u);
 82         System.out.println (&quot;client opening connection to: &quot; + u);
 83         URLConnection urlc = url.openConnection ();
 84         InputStream is = urlc.getInputStream ();
 85         read (is);
 86         is.close();
 87     }
 88 
 89     static TestHttpServer server;
 90     static URL urlsave;
 91 
 92     public static void main (String[] args) throws Exception {
 93         try {
<span class="line-modified"> 94             server = new TestHttpServer (new B4962064(), 1, 10, 0);</span>





 95             int port = server.getLocalPort();
<span class="line-modified"> 96             System.setProperty (&quot;http.proxyHost&quot;, &quot;localhost&quot;);</span>



 97             System.setProperty (&quot;http.proxyPort&quot;, Integer.toString (port));
 98             MyAuthenticator auth = new MyAuthenticator ();
 99             Authenticator.setDefault (auth);
100             System.out.println (&quot;Server started: listening on port: &quot; + port);
<span class="line-removed">101             //String s = new String (&quot;http://localhost:&quot;+port+&quot;/d1/d2/d3/foo.html&quot;);</span>
102             String s = new String (&quot;http://foo.com/d1/d2/d3/foo.html&quot;);
103             urlsave = new URL (s);
104             client (s);
<span class="line-removed">105             //s = new String (&quot;http://localhost:&quot;+port+&quot;/dr/d3/foo.html&quot;);</span>
106             s = new String (&quot;http://bar.com/dr/d3/foo.html&quot;);
107             urlsave = new URL (s);
108             client (s);
109         } catch (Exception e) {
110             if (server != null) {
111                 server.terminate();
112             }
113             throw e;
114         }
115         server.terminate();
116     }
117 
118     public static void except (String s) {
119         server.terminate();
120         throw new RuntimeException (s);
121     }
122 
123     static class MyAuthenticator extends Authenticator {
124         int count = 0;
125         MyAuthenticator () {
</pre>
</td>
<td>
<hr />
<pre>
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /**
 25  * @test
 26  * @bug 4962064
 27  * @modules java.base/sun.net.www
 28  * @library ../../../sun/net/www/httptest/
 29  * @build HttpCallback TestHttpServer ClosedChannelList HttpTransaction
 30  * @run main/othervm B4962064
<span class="line-added"> 31  * @run main/othervm -Djava.net.preferIPv6Addresses=true B4962064</span>
 32  * @summary Extend Authenticator to provide access to request URI and server/proxy
 33  */
 34 
 35 import java.io.*;
 36 import java.net.*;
 37 
 38 public class B4962064 implements HttpCallback {
 39 
 40     static int count = 0;
 41 
 42     public void request (HttpTransaction req) {
 43         try {
 44             switch (count) {
 45               case 0:
 46                 req.addResponseHeader (&quot;Connection&quot;, &quot;close&quot;);
 47                 req.addResponseHeader (&quot;WWW-Authenticate&quot;, &quot;Basic realm=\&quot;foo\&quot;&quot;);
 48                 req.sendResponse (401, &quot;Unauthorized&quot;);
 49                 req.orderlyClose();
 50                 break;
 51               case 1:
</pre>
<hr />
<pre>
 75         }
 76         System.out.println (&quot;&quot;);
 77         System.out.println (&quot;finished reading&quot;);
 78     }
 79 
 80 
 81     static void client (String u) throws Exception {
 82         URL url = new URL (u);
 83         System.out.println (&quot;client opening connection to: &quot; + u);
 84         URLConnection urlc = url.openConnection ();
 85         InputStream is = urlc.getInputStream ();
 86         read (is);
 87         is.close();
 88     }
 89 
 90     static TestHttpServer server;
 91     static URL urlsave;
 92 
 93     public static void main (String[] args) throws Exception {
 94         try {
<span class="line-modified"> 95             InetAddress address = InetAddress.getLoopbackAddress();</span>
<span class="line-added"> 96             InetAddress resolved = InetAddress.getByName(address.getHostName());</span>
<span class="line-added"> 97             System.out.println(&quot;Lookup: &quot; + address + &quot; -&gt; \&quot;&quot;</span>
<span class="line-added"> 98                                + address.getHostName() + &quot;\&quot; -&gt; &quot;</span>
<span class="line-added"> 99                                + resolved);</span>
<span class="line-added">100             server = new TestHttpServer (new B4962064(), 1, 10, address, 0);</span>
101             int port = server.getLocalPort();
<span class="line-modified">102             String proxyHost = address.equals(resolved)</span>
<span class="line-added">103                 ? address.getHostName()</span>
<span class="line-added">104                 : address.getHostAddress();</span>
<span class="line-added">105             System.setProperty (&quot;http.proxyHost&quot;, proxyHost);</span>
106             System.setProperty (&quot;http.proxyPort&quot;, Integer.toString (port));
107             MyAuthenticator auth = new MyAuthenticator ();
108             Authenticator.setDefault (auth);
109             System.out.println (&quot;Server started: listening on port: &quot; + port);

110             String s = new String (&quot;http://foo.com/d1/d2/d3/foo.html&quot;);
111             urlsave = new URL (s);
112             client (s);

113             s = new String (&quot;http://bar.com/dr/d3/foo.html&quot;);
114             urlsave = new URL (s);
115             client (s);
116         } catch (Exception e) {
117             if (server != null) {
118                 server.terminate();
119             }
120             throw e;
121         }
122         server.terminate();
123     }
124 
125     public static void except (String s) {
126         server.terminate();
127         throw new RuntimeException (s);
128     }
129 
130     static class MyAuthenticator extends Authenticator {
131         int count = 0;
132         MyAuthenticator () {
</pre>
</td>
</tr>
</table>
<center><a href="B4933582.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="B6870935.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>