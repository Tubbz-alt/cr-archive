diff a/test/jdk/java/net/URLConnection/URLConnectionHeaders.java b/test/jdk/java/net/URLConnection/URLConnectionHeaders.java
--- a/test/jdk/java/net/URLConnection/URLConnectionHeaders.java
+++ b/test/jdk/java/net/URLConnection/URLConnectionHeaders.java
@@ -1,7 +1,7 @@
 /*
- * Copyright (c) 2001, 2010, Oracle and/or its affiliates. All rights reserved.
+ * Copyright (c) 2001, 2019, Oracle and/or its affiliates. All rights reserved.
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
  * This code is free software; you can redistribute it and/or modify it
  * under the terms of the GNU General Public License version 2 only, as
  * published by the Free Software Foundation.
@@ -25,16 +25,19 @@
  * @test
  * @bug 4143541 4147035 4244362
  * @summary URLConnection cannot enumerate request properties,
  *          and URLConnection can neither get nor set multiple
  *          request properties w/ same key
+ * @library /test/lib
  *
  */
 
 import java.net.*;
 import java.util.*;
 import java.io.*;
+import jdk.test.lib.net.URIBuilder;
+import static java.net.Proxy.NO_PROXY;
 
 public class URLConnectionHeaders {
 
     static class XServer extends Thread {
         ServerSocket srv;
@@ -75,19 +78,26 @@
                 try { srv.close(); } catch (IOException unused) {}
             }
         }
     }
 
-    public static void main(String[] args) {
+    public static void main(String[] args) throws Exception {
         try {
-            ServerSocket serversocket = new ServerSocket (0);
-            int port = serversocket.getLocalPort ();
-            XServer server = new XServer (serversocket);
-            server.start ();
-            Thread.sleep (200);
-            URL url = new URL ("http://localhost:"+port+"/index.html");
-            URLConnection uc = url.openConnection ();
+            InetAddress loopback = InetAddress.getLoopbackAddress();
+            ServerSocket serversocket = new ServerSocket();
+            serversocket.bind(new InetSocketAddress(loopback, 0));
+            int port = serversocket.getLocalPort();
+            XServer server = new XServer(serversocket);
+            server.start();
+            Thread.sleep(200);
+            URL url = URIBuilder.newBuilder()
+                      .scheme("http")
+                      .loopback()
+                      .port(port)
+                      .path("/index.html")
+                      .toURL();
+            URLConnection uc = url.openConnection(NO_PROXY);
 
             // add request properties
             uc.addRequestProperty("Cookie", "cookie1");
             uc.addRequestProperty("Cookie", "cookie2");
             uc.addRequestProperty("Cookie", "cookie3");
@@ -104,8 +114,9 @@
                 throw new RuntimeException("getHeaderFields fails");
             }
 
         } catch (Exception e) {
             e.printStackTrace();
+            throw e;
         }
     }
 }
