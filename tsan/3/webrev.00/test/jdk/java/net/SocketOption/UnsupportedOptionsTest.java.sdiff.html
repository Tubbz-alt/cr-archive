<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/net/SocketOption/UnsupportedOptionsTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="TcpKeepAliveTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../SocketPermission/Ctor.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/net/SocketOption/UnsupportedOptionsTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.io.IOException;
 25 import java.lang.reflect.Field;
 26 import java.net.*;
 27 import java.util.ArrayList;
 28 import java.util.List;
 29 


 30 /*
 31  * @test
 32  * @bug 8143554 8044773

 33  * @summary Test checks that UnsupportedOperationException for unsupported
 34  *          SOCKET_OPTIONS is thrown by both getOption() and setOption() methods.
 35  * @requires !vm.graal.enabled
 36  * @run main UnsupportedOptionsTest
 37  * @run main/othervm -Djava.net.preferIPv4Stack=true UnsupportedOptionsTest
 38  * @run main/othervm --limit-modules=java.base UnsupportedOptionsTest
 39  */
 40 
 41 public class UnsupportedOptionsTest {
 42 
 43     private static final List&lt;SocketOption&lt;?&gt;&gt; socketOptions = new ArrayList&lt;&gt;();
 44 
 45     static {
 46         socketOptions.add(StandardSocketOptions.IP_MULTICAST_IF);
 47         socketOptions.add(StandardSocketOptions.IP_MULTICAST_LOOP);
 48         socketOptions.add(StandardSocketOptions.IP_MULTICAST_TTL);
 49         socketOptions.add(StandardSocketOptions.IP_TOS);
 50         socketOptions.add(StandardSocketOptions.SO_BROADCAST);
 51         socketOptions.add(StandardSocketOptions.SO_KEEPALIVE);
 52         socketOptions.add(StandardSocketOptions.SO_LINGER);
 53         socketOptions.add(StandardSocketOptions.SO_RCVBUF);
 54         socketOptions.add(StandardSocketOptions.SO_REUSEADDR);
 55         socketOptions.add(StandardSocketOptions.SO_SNDBUF);
 56         socketOptions.add(StandardSocketOptions.TCP_NODELAY);
 57 
 58         try {
 59             Class&lt;?&gt; c = Class.forName(&quot;jdk.net.ExtendedSocketOptions&quot;);
 60             Field field = c.getField(&quot;SO_FLOW_SLA&quot;);
 61             socketOptions.add((SocketOption&lt;?&gt;)field.get(null));
 62             field = c.getField(&quot;TCP_QUICKACK&quot;);
 63             socketOptions.add((SocketOption&lt;?&gt;)field.get(null));







 64         } catch (ClassNotFoundException e) {
 65             // ignore, jdk.net module not present
 66         } catch (ReflectiveOperationException e) {
 67             throw new AssertionError(e);
 68         }
 69     }
 70 
 71     public static void main(String[] args) throws IOException {


 72         Socket s = new Socket();
 73         ServerSocket ss = new ServerSocket();
 74         DatagramSocket ds = new DatagramSocket();
 75         MulticastSocket ms = new MulticastSocket();
 76 
 77         for (SocketOption option : socketOptions) {
 78             if (!s.supportedOptions().contains(option)) {
 79                 testUnsupportedSocketOption(s, option);
 80             }
 81 
 82             if (!ss.supportedOptions().contains(option)) {
 83                 testUnsupportedSocketOption(ss, option);
 84             }
 85 
 86             if (!ms.supportedOptions().contains(option)) {
 87                 testUnsupportedSocketOption(ms, option);
 88             }
 89 
 90             if (!ds.supportedOptions().contains(option)) {
 91                 testUnsupportedSocketOption(ds, option);
</pre>
</td>
<td>
<hr />
<pre>
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.io.IOException;
 25 import java.lang.reflect.Field;
 26 import java.net.*;
 27 import java.util.ArrayList;
 28 import java.util.List;
 29 
<span class="line-added"> 30 import jdk.test.lib.net.IPSupport;</span>
<span class="line-added"> 31 </span>
 32 /*
 33  * @test
 34  * @bug 8143554 8044773
<span class="line-added"> 35  * @library /test/lib</span>
 36  * @summary Test checks that UnsupportedOperationException for unsupported
 37  *          SOCKET_OPTIONS is thrown by both getOption() and setOption() methods.
 38  * @requires !vm.graal.enabled
 39  * @run main UnsupportedOptionsTest
 40  * @run main/othervm -Djava.net.preferIPv4Stack=true UnsupportedOptionsTest
 41  * @run main/othervm --limit-modules=java.base UnsupportedOptionsTest
 42  */
 43 
 44 public class UnsupportedOptionsTest {
 45 
 46     private static final List&lt;SocketOption&lt;?&gt;&gt; socketOptions = new ArrayList&lt;&gt;();
 47 
 48     static {
 49         socketOptions.add(StandardSocketOptions.IP_MULTICAST_IF);
 50         socketOptions.add(StandardSocketOptions.IP_MULTICAST_LOOP);
 51         socketOptions.add(StandardSocketOptions.IP_MULTICAST_TTL);
 52         socketOptions.add(StandardSocketOptions.IP_TOS);
 53         socketOptions.add(StandardSocketOptions.SO_BROADCAST);
 54         socketOptions.add(StandardSocketOptions.SO_KEEPALIVE);
 55         socketOptions.add(StandardSocketOptions.SO_LINGER);
 56         socketOptions.add(StandardSocketOptions.SO_RCVBUF);
 57         socketOptions.add(StandardSocketOptions.SO_REUSEADDR);
 58         socketOptions.add(StandardSocketOptions.SO_SNDBUF);
 59         socketOptions.add(StandardSocketOptions.TCP_NODELAY);
 60 
 61         try {
 62             Class&lt;?&gt; c = Class.forName(&quot;jdk.net.ExtendedSocketOptions&quot;);
 63             Field field = c.getField(&quot;SO_FLOW_SLA&quot;);
 64             socketOptions.add((SocketOption&lt;?&gt;)field.get(null));
 65             field = c.getField(&quot;TCP_QUICKACK&quot;);
 66             socketOptions.add((SocketOption&lt;?&gt;)field.get(null));
<span class="line-added"> 67             field = c.getField(&quot;TCP_KEEPIDLE&quot;);</span>
<span class="line-added"> 68             socketOptions.add((SocketOption&lt;?&gt;)field.get(null));</span>
<span class="line-added"> 69             field = c.getField(&quot;TCP_KEEPINTERVAL&quot;);</span>
<span class="line-added"> 70             socketOptions.add((SocketOption&lt;?&gt;)field.get(null));</span>
<span class="line-added"> 71             field = c.getField(&quot;TCP_KEEPCOUNT&quot;);</span>
<span class="line-added"> 72             socketOptions.add((SocketOption&lt;?&gt;)field.get(null));</span>
<span class="line-added"> 73 </span>
 74         } catch (ClassNotFoundException e) {
 75             // ignore, jdk.net module not present
 76         } catch (ReflectiveOperationException e) {
 77             throw new AssertionError(e);
 78         }
 79     }
 80 
 81     public static void main(String[] args) throws IOException {
<span class="line-added"> 82         IPSupport.throwSkippedExceptionIfNonOperational();</span>
<span class="line-added"> 83 </span>
 84         Socket s = new Socket();
 85         ServerSocket ss = new ServerSocket();
 86         DatagramSocket ds = new DatagramSocket();
 87         MulticastSocket ms = new MulticastSocket();
 88 
 89         for (SocketOption option : socketOptions) {
 90             if (!s.supportedOptions().contains(option)) {
 91                 testUnsupportedSocketOption(s, option);
 92             }
 93 
 94             if (!ss.supportedOptions().contains(option)) {
 95                 testUnsupportedSocketOption(ss, option);
 96             }
 97 
 98             if (!ms.supportedOptions().contains(option)) {
 99                 testUnsupportedSocketOption(ms, option);
100             }
101 
102             if (!ds.supportedOptions().contains(option)) {
103                 testUnsupportedSocketOption(ds, option);
</pre>
</td>
</tr>
</table>
<center><a href="TcpKeepAliveTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../SocketPermission/Ctor.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>