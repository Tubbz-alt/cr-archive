<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/java/math/BigDecimal/LongValueExactTests.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../lang/reflect/PublicMethods/PublicMethodsTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="SquareRootTests.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/math/BigDecimal/LongValueExactTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2005, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,67 +21,100 @@</span>
   * questions.
   */
  
  /**
   * @test
<span class="udiff-line-modified-removed">-  * @bug 6806261</span>
<span class="udiff-line-modified-added">+  * @bug 6806261 8211936</span>
   * @summary Tests of BigDecimal.longValueExact
   */
  import java.math.*;
<span class="udiff-line-added">+ import java.util.List;</span>
<span class="udiff-line-added">+ import java.util.Map;</span>
<span class="udiff-line-added">+ import static java.util.Map.entry;</span>
  
  public class LongValueExactTests {
<span class="udiff-line-added">+     public static void main(String... args) {</span>
<span class="udiff-line-added">+         int failures = 0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         failures += longValueExactSuccessful();</span>
<span class="udiff-line-added">+         failures += longValueExactExceptional();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (failures &gt; 0) {</span>
<span class="udiff-line-added">+             throw new RuntimeException(&quot;Incurred &quot; + failures +</span>
<span class="udiff-line-added">+                                        &quot; failures while testing longValueExact.&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     private static int longValueExactTests() {</span>
<span class="udiff-line-modified-added">+     private static long simpleLongValueExact(BigDecimal bd) {</span>
<span class="udiff-line-added">+         return bd.toBigIntegerExact().longValue();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static int longValueExactSuccessful() {</span>
          int failures = 0;
  
<span class="udiff-line-modified-removed">-         String[] testStrings = {</span>
<span class="udiff-line-modified-removed">-             &quot;9223372036854775807&quot;,</span>
<span class="udiff-line-modified-removed">-             &quot;9223372036854775807.0&quot;,</span>
<span class="udiff-line-modified-removed">-             &quot;9223372036854775807.00&quot;,</span>
<span class="udiff-line-modified-removed">-             &quot;-9223372036854775808&quot;,</span>
<span class="udiff-line-modified-removed">-             &quot;-9223372036854775808.0&quot;,</span>
<span class="udiff-line-modified-removed">-             &quot;-9223372036854775808.00&quot;,</span>
<span class="udiff-line-modified-removed">-         };</span>
<span class="udiff-line-modified-added">+         // Strings used to create BigDecimal instances on which invoking</span>
<span class="udiff-line-modified-added">+         // longValueExact() will succeed.</span>
<span class="udiff-line-modified-added">+         Map&lt;BigDecimal, Long&gt; successCases =</span>
<span class="udiff-line-modified-added">+             Map.ofEntries(entry(new BigDecimal(&quot;9223372036854775807&quot;),    Long.MAX_VALUE), // 2^63 -1</span>
<span class="udiff-line-modified-added">+                           entry(new BigDecimal(&quot;9223372036854775807.0&quot;),  Long.MAX_VALUE),</span>
<span class="udiff-line-modified-added">+                           entry(new BigDecimal(&quot;9223372036854775807.00&quot;), Long.MAX_VALUE),</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                           entry(new BigDecimal(&quot;-9223372036854775808&quot;),   Long.MIN_VALUE), // -2^63</span>
<span class="udiff-line-added">+                           entry(new BigDecimal(&quot;-9223372036854775808.0&quot;), Long.MIN_VALUE),</span>
<span class="udiff-line-added">+                           entry(new BigDecimal(&quot;-9223372036854775808.00&quot;),Long.MIN_VALUE),</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                           entry(new BigDecimal(&quot;1e0&quot;),    1L),</span>
<span class="udiff-line-added">+                           entry(new BigDecimal(BigInteger.ONE, -18),   1_000_000_000_000_000_000L),</span>
  
<span class="udiff-line-modified-removed">-         for (String longValue : testStrings) {</span>
<span class="udiff-line-modified-added">+                           entry(new BigDecimal(&quot;0e13&quot;),   0L), // Fast path zero</span>
<span class="udiff-line-added">+                           entry(new BigDecimal(&quot;0e64&quot;),   0L),</span>
<span class="udiff-line-added">+                           entry(new BigDecimal(&quot;0e1024&quot;), 0L),</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                           entry(new BigDecimal(&quot;10.000000000000000000000000000000000&quot;), 10L));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         for (var testCase : successCases.entrySet()) {</span>
<span class="udiff-line-added">+             BigDecimal bd = testCase.getKey();</span>
<span class="udiff-line-added">+             long expected = testCase.getValue();</span>
              try {
<span class="udiff-line-removed">-                 BigDecimal bd = new BigDecimal(longValue);</span>
                  long longValueExact = bd.longValueExact();
<span class="udiff-line-added">+                 if (expected != longValueExact ||</span>
<span class="udiff-line-added">+                     longValueExact != simpleLongValueExact(bd)) {</span>
<span class="udiff-line-added">+                     failures++;</span>
<span class="udiff-line-added">+                     System.err.println(&quot;Unexpected longValueExact result &quot; + longValueExact +</span>
<span class="udiff-line-added">+                                        &quot; on &quot; + bd);</span>
<span class="udiff-line-added">+                 }</span>
              } catch (Exception e) {
                  failures++;
<span class="udiff-line-added">+                 System.err.println(&quot;Error on &quot; + bd + &quot;\tException message:&quot; + e.getMessage());</span>
              }
          }
<span class="udiff-line-added">+         return failures;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static int longValueExactExceptional() {</span>
<span class="udiff-line-added">+         int failures = 0;</span>
<span class="udiff-line-added">+         List&lt;BigDecimal&gt; exceptionalCases =</span>
<span class="udiff-line-added">+             List.of(new BigDecimal(&quot;9223372036854775808&quot;), // Long.MAX_VALUE + 1</span>
<span class="udiff-line-added">+                     new BigDecimal(&quot;9223372036854775808.0&quot;),</span>
<span class="udiff-line-added">+                     new BigDecimal(&quot;9223372036854775808.00&quot;),</span>
<span class="udiff-line-added">+                     new BigDecimal(&quot;-9223372036854775809&quot;), // Long.MIN_VALUE - 1</span>
<span class="udiff-line-added">+                     new BigDecimal(&quot;-9223372036854775808.1&quot;),</span>
<span class="udiff-line-added">+                     new BigDecimal(&quot;-9223372036854775808.01&quot;),</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                     new BigDecimal(&quot;9999999999999999999&quot;),</span>
<span class="udiff-line-added">+                     new BigDecimal(&quot;10000000000000000000&quot;),</span>
  
<span class="udiff-line-modified-removed">-         // The following Strings are supposed to make longValueExact throw</span>
<span class="udiff-line-modified-removed">-         // ArithmeticException.</span>
<span class="udiff-line-modified-removed">-         String[] testStrings2 = {</span>
<span class="udiff-line-modified-removed">-             &quot;9223372036854775808&quot;,</span>
<span class="udiff-line-removed">-             &quot;9223372036854775808.0&quot;,</span>
<span class="udiff-line-removed">-             &quot;9223372036854775808.00&quot;,</span>
<span class="udiff-line-removed">-             &quot;-9223372036854775809&quot;,</span>
<span class="udiff-line-removed">-             &quot;-9223372036854775808.1&quot;,</span>
<span class="udiff-line-removed">-             &quot;-9223372036854775808.01&quot;,</span>
<span class="udiff-line-removed">-         };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         for (String bigValue : testStrings2) {</span>
<span class="udiff-line-modified-added">+                     new BigDecimal(&quot;0.99&quot;),</span>
<span class="udiff-line-modified-added">+                     new BigDecimal(&quot;0.999999999999999999999&quot;));</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         for (BigDecimal bd : exceptionalCases) {</span>
              try {
<span class="udiff-line-removed">-                 BigDecimal bd = new BigDecimal(bigValue);</span>
                  long longValueExact = bd.longValueExact();
                  failures++;
<span class="udiff-line-added">+                 System.err.println(&quot;Unexpected non-exceptional longValueExact on &quot; + bd);</span>
              } catch (ArithmeticException e) {
                  // Success;
              }
          }
          return failures;
      }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     public static void main(String argv[]) {</span>
<span class="udiff-line-removed">-         int failures = 0;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         failures += longValueExactTests();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (failures &gt; 0) {</span>
<span class="udiff-line-removed">-             throw new RuntimeException(&quot;Incurred &quot; + failures +</span>
<span class="udiff-line-removed">-                                        &quot; failures while testing longValueExact.&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
  }
</pre>
<center><a href="../../lang/reflect/PublicMethods/PublicMethodsTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="SquareRootTests.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>