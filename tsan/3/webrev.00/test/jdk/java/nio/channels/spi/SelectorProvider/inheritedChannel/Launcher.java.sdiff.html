<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/nio/channels/spi/SelectorProvider/inheritedChannel/Launcher.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InheritedChannelTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StateTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/nio/channels/spi/SelectorProvider/inheritedChannel/Launcher.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>

  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 58             for (String arg: args) {
 59                 cmdarray[pos++] = arg;
 60             }
 61         }
 62         launch0(cmdarray, fd);
 63     }
 64 
 65 
 66     /**
 67      * Launch &#39;java&#39; with specified class using a UnixDomainSocket pair linking calling
 68      * process to the child VM. UnixDomainSocket is a simplified interface to PF_UNIX sockets
 69      * which supports byte a time reads and writes.
 70      */
 71     public static UnixDomainSocket launchWithUnixDomainSocket(String className) throws IOException {
 72         UnixDomainSocket[] socks = UnixDomainSocket.socketpair();
 73         launch(className, null, null, socks[0].fd());
 74         socks[0].close();
 75         return socks[1];
 76     }
 77 









 78     /*
 79      * Launch &#39;java&#39; with specified class with the specified arguments (may be null).
 80      * The launched process will inherit a connected TCP socket. The remote endpoint
 81      * will be the SocketChannel returned by this method.
 82      */
 83     public static SocketChannel launchWithSocketChannel(String className, String options[], String args[]) throws IOException {
 84         ServerSocketChannel ssc = ServerSocketChannel.open();
<span class="line-modified"> 85         ssc.socket().bind(new InetSocketAddress(0));</span>
 86         InetSocketAddress isa = new InetSocketAddress(InetAddress.getLocalHost(),
 87                                                       ssc.socket().getLocalPort());
 88         SocketChannel sc1 = SocketChannel.open(isa);
 89         SocketChannel sc2 = ssc.accept();
 90         launch(className, options, args, Util.getFD(sc2));
 91         sc2.close();
 92         ssc.close();
 93         return sc1;
 94     }
 95 
 96     public static SocketChannel launchWithSocketChannel(String className, String args[]) throws IOException {
 97         return launchWithSocketChannel(className, null, args);
 98     }
 99 
100     public static SocketChannel launchWithSocketChannel(String className) throws IOException {
101         return launchWithSocketChannel(className, null);
102     }
103 
104     /*
105      * Launch &#39;java&#39; with specified class with the specified arguments (may be null).
106      * The launched process will inherited a TCP listener socket.
107      * Once launched this method tries to connect to service. If a connection
108      * can be established a SocketChannel, connected to the service, is returned.
109      */
110     public static SocketChannel launchWithServerSocketChannel(String className, String options[], String args[])
111         throws IOException
112     {
113         ServerSocketChannel ssc = ServerSocketChannel.open();
<span class="line-modified">114         ssc.socket().bind(new InetSocketAddress(0));</span>
115         int port = ssc.socket().getLocalPort();
116         launch(className, options, args, Util.getFD(ssc));
117         ssc.close();
118         InetSocketAddress isa = new InetSocketAddress(InetAddress.getLocalHost(), port);
119         return SocketChannel.open(isa);
120     }
121 
122     public static SocketChannel launchWithServerSocketChannel(String className, String args[]) throws IOException {
123         return launchWithServerSocketChannel(className, null, args);
124     }
125 
126     public static SocketChannel launchWithServerSocketChannel(String className) throws IOException {
127         return launchWithServerSocketChannel(className, null);
128     }
129 
130     /*
131      * Launch &#39;java&#39; with specified class with the specified arguments (may be null).
132      * The launch process will inherited a bound UDP socket.
133      * Once launched this method creates a DatagramChannel and &quot;connects
134      * it to the service. The created DatagramChannel is then returned.
135      * As it is connected any packets sent from the socket will be
136      * sent to the service.
137      */
138     public static DatagramChannel launchWithDatagramChannel(String className, String options[], String args[])
139         throws IOException
140     {




141         DatagramChannel dc = DatagramChannel.open();
<span class="line-modified">142         dc.socket().bind(new InetSocketAddress(0));</span>
143 
144         int port = dc.socket().getLocalPort();
145         launch(className, options, args, Util.getFD(dc));
146         dc.close();
147 
148         dc = DatagramChannel.open();
<span class="line-removed">149         InetAddress address = InetAddress.getLocalHost();</span>
<span class="line-removed">150         if (address.isLoopbackAddress()) {</span>
<span class="line-removed">151             address = InetAddress.getLoopbackAddress();</span>
<span class="line-removed">152         }</span>
153         InetSocketAddress isa = new InetSocketAddress(address, port);
154 
155         dc.connect(isa);
156         return dc;
157     }
158 
159     public static DatagramChannel launchWithDatagramChannel(String className, String args[]) throws IOException {
160         return launchWithDatagramChannel(className, null, args);
161     }
162 
163     public static DatagramChannel launchWithDatagramChannel(String className) throws IOException {
164         return launchWithDatagramChannel(className, null);
165     }
166 }
</pre>
</td>
<td>
<hr />
<pre>
<span class="line-added">  1 </span>
  2 /*
<span class="line-modified">  3  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * This code is free software; you can redistribute it and/or modify it
  7  * under the terms of the GNU General Public License version 2 only, as
  8  * published by the Free Software Foundation.
  9  *
 10  * This code is distributed in the hope that it will be useful, but WITHOUT
 11  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 12  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 13  * version 2 for more details (a copy is included in the LICENSE file that
 14  * accompanied this code).
 15  *
 16  * You should have received a copy of the GNU General Public License version
 17  * 2 along with this work; if not, write to the Free Software Foundation,
 18  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19  *
 20  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21  * or visit www.oracle.com if you need additional information or have any
 22  * questions.
 23  */
</pre>
<hr />
<pre>
 59             for (String arg: args) {
 60                 cmdarray[pos++] = arg;
 61             }
 62         }
 63         launch0(cmdarray, fd);
 64     }
 65 
 66 
 67     /**
 68      * Launch &#39;java&#39; with specified class using a UnixDomainSocket pair linking calling
 69      * process to the child VM. UnixDomainSocket is a simplified interface to PF_UNIX sockets
 70      * which supports byte a time reads and writes.
 71      */
 72     public static UnixDomainSocket launchWithUnixDomainSocket(String className) throws IOException {
 73         UnixDomainSocket[] socks = UnixDomainSocket.socketpair();
 74         launch(className, null, null, socks[0].fd());
 75         socks[0].close();
 76         return socks[1];
 77     }
 78 
<span class="line-added"> 79     /**</span>
<span class="line-added"> 80      * Launch specified class with an AF_UNIX socket created externally, and one String arg to child VM</span>
<span class="line-added"> 81      */</span>
<span class="line-added"> 82     public static void launchWithUnixDomainSocket(String className, UnixDomainSocket socket, String arg) throws IOException {</span>
<span class="line-added"> 83         String[] args = new String[1];</span>
<span class="line-added"> 84         args[0] = arg;</span>
<span class="line-added"> 85         launch(className, null, args, socket.fd());</span>
<span class="line-added"> 86     }</span>
<span class="line-added"> 87 </span>
 88     /*
 89      * Launch &#39;java&#39; with specified class with the specified arguments (may be null).
 90      * The launched process will inherit a connected TCP socket. The remote endpoint
 91      * will be the SocketChannel returned by this method.
 92      */
 93     public static SocketChannel launchWithSocketChannel(String className, String options[], String args[]) throws IOException {
 94         ServerSocketChannel ssc = ServerSocketChannel.open();
<span class="line-modified"> 95         ssc.socket().bind(new InetSocketAddress(InetAddress.getLocalHost(), 0));</span>
 96         InetSocketAddress isa = new InetSocketAddress(InetAddress.getLocalHost(),
 97                                                       ssc.socket().getLocalPort());
 98         SocketChannel sc1 = SocketChannel.open(isa);
 99         SocketChannel sc2 = ssc.accept();
100         launch(className, options, args, Util.getFD(sc2));
101         sc2.close();
102         ssc.close();
103         return sc1;
104     }
105 
106     public static SocketChannel launchWithSocketChannel(String className, String args[]) throws IOException {
107         return launchWithSocketChannel(className, null, args);
108     }
109 
110     public static SocketChannel launchWithSocketChannel(String className) throws IOException {
111         return launchWithSocketChannel(className, null);
112     }
113 
114     /*
115      * Launch &#39;java&#39; with specified class with the specified arguments (may be null).
116      * The launched process will inherited a TCP listener socket.
117      * Once launched this method tries to connect to service. If a connection
118      * can be established a SocketChannel, connected to the service, is returned.
119      */
120     public static SocketChannel launchWithServerSocketChannel(String className, String options[], String args[])
121         throws IOException
122     {
123         ServerSocketChannel ssc = ServerSocketChannel.open();
<span class="line-modified">124         ssc.socket().bind(new InetSocketAddress(InetAddress.getLocalHost(), 0));</span>
125         int port = ssc.socket().getLocalPort();
126         launch(className, options, args, Util.getFD(ssc));
127         ssc.close();
128         InetSocketAddress isa = new InetSocketAddress(InetAddress.getLocalHost(), port);
129         return SocketChannel.open(isa);
130     }
131 
132     public static SocketChannel launchWithServerSocketChannel(String className, String args[]) throws IOException {
133         return launchWithServerSocketChannel(className, null, args);
134     }
135 
136     public static SocketChannel launchWithServerSocketChannel(String className) throws IOException {
137         return launchWithServerSocketChannel(className, null);
138     }
139 
140     /*
141      * Launch &#39;java&#39; with specified class with the specified arguments (may be null).
142      * The launch process will inherited a bound UDP socket.
143      * Once launched this method creates a DatagramChannel and &quot;connects
144      * it to the service. The created DatagramChannel is then returned.
145      * As it is connected any packets sent from the socket will be
146      * sent to the service.
147      */
148     public static DatagramChannel launchWithDatagramChannel(String className, String options[], String args[])
149         throws IOException
150     {
<span class="line-added">151         InetAddress address = InetAddress.getLocalHost();</span>
<span class="line-added">152         if (address.isLoopbackAddress()) {</span>
<span class="line-added">153             address = InetAddress.getLoopbackAddress();</span>
<span class="line-added">154         }</span>
155         DatagramChannel dc = DatagramChannel.open();
<span class="line-modified">156         dc.socket().bind(new InetSocketAddress(address, 0));</span>
157 
158         int port = dc.socket().getLocalPort();
159         launch(className, options, args, Util.getFD(dc));
160         dc.close();
161 
162         dc = DatagramChannel.open();




163         InetSocketAddress isa = new InetSocketAddress(address, port);
164 
165         dc.connect(isa);
166         return dc;
167     }
168 
169     public static DatagramChannel launchWithDatagramChannel(String className, String args[]) throws IOException {
170         return launchWithDatagramChannel(className, null, args);
171     }
172 
173     public static DatagramChannel launchWithDatagramChannel(String className) throws IOException {
174         return launchWithDatagramChannel(className, null);
175     }
176 }
</pre>
</td>
</tr>
</table>
<center><a href="InheritedChannelTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="StateTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>