<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/jdk/java/text/Format/DateFormat/WeekDateTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2010, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 4267450
 27  * @summary Unit test for week date support
 28  */
 29 
 30 import java.text.*;
 31 import java.util.*;
 32 import static java.util.GregorianCalendar.*;
 33 
 34 public class WeekDateTest {
 35     static SimpleDateFormat ymdFormat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;, Locale.US);
 36     static SimpleDateFormat ywdFormat = new SimpleDateFormat(&quot;YYYY-&#39;W&#39;ww-u&quot;, Locale.US);
 37     static {
 38         ymdFormat.setCalendar(newCalendar());
 39         ywdFormat.setCalendar(newCalendar());
 40     }
 41 
 42     // Round-trip Data
 43     static final String[][] roundTripData = {
 44         { &quot;2005-01-01&quot;, &quot;2004-W53-6&quot; },
 45         { &quot;2005-01-02&quot;, &quot;2004-W53-7&quot; },
 46         { &quot;2005-12-31&quot;, &quot;2005-W52-6&quot; },
 47         { &quot;2007-01-01&quot;, &quot;2007-W01-1&quot; },
 48         { &quot;2007-12-30&quot;, &quot;2007-W52-7&quot; },
 49         { &quot;2007-12-31&quot;, &quot;2008-W01-1&quot; },
 50         { &quot;2008-01-01&quot;, &quot;2008-W01-2&quot; },
 51         { &quot;2008-12-29&quot;, &quot;2009-W01-1&quot; },
 52         { &quot;2008-12-31&quot;, &quot;2009-W01-3&quot; },
 53         { &quot;2009-01-01&quot;, &quot;2009-W01-4&quot; },
 54         { &quot;2009-12-31&quot;, &quot;2009-W53-4&quot; },
 55         { &quot;2010-01-03&quot;, &quot;2009-W53-7&quot; },
 56         { &quot;2009-12-31&quot;, &quot;2009-W53-4&quot; },
 57         { &quot;2010-01-01&quot;, &quot;2009-W53-5&quot; },
 58         { &quot;2010-01-02&quot;, &quot;2009-W53-6&quot; },
 59         { &quot;2010-01-03&quot;, &quot;2009-W53-7&quot; },
 60         { &quot;2008-12-28&quot;, &quot;2008-W52-7&quot; },
 61         { &quot;2008-12-29&quot;, &quot;2009-W01-1&quot; },
 62         { &quot;2008-12-30&quot;, &quot;2009-W01-2&quot; },
 63         { &quot;2008-12-31&quot;, &quot;2009-W01-3&quot; },
 64         { &quot;2009-01-01&quot;, &quot;2009-W01-4&quot; },
 65         { &quot;2009-01-01&quot;, &quot;2009-W01-4&quot; },
 66     };
 67 
 68     // Data for leniency test
 69     static final String[][] leniencyData = {
 70         { &quot;2008-12-28&quot;, &quot;2009-W01-0&quot; },
 71         { &quot;2010-01-04&quot;, &quot;2009-W53-8&quot; },
 72         { &quot;2008-12-29&quot;, &quot;2008-W53-1&quot; },
 73     };
 74 
 75     static final String[] invalidData = {
 76         &quot;2010-W00-1&quot;,
 77         &quot;2010-W55-1&quot;,
 78         &quot;2010-W03-0&quot;,
 79         &quot;2010-W04-8&quot;,
 80         &quot;2010-W04-19&quot;
 81     };
 82 
 83     public static void main(String[] args) throws Exception {
 84         formatTest(roundTripData);
 85         parseTest(roundTripData);
 86         parseTest(leniencyData);
 87         nonLenientTest(invalidData);
 88         noWeekDateSupport();
 89     }
 90 
 91     private static void formatTest(String[][] data) throws Exception {
 92         for (String[] dates : data) {
 93             String regularDate = dates[0];
 94             String weekDate = dates[1];
 95             Date date = null;
 96             date = ymdFormat.parse(regularDate);
 97             String s = ywdFormat.format(date);
 98             if (!s.equals(weekDate)) {
 99                 throw new RuntimeException(&quot;format: got=&quot;+s+&quot;, expecetd=&quot;+weekDate);
100             }
101         }
102     }
103 
104     private static void parseTest(String[][] data) throws Exception {
105         for (String[] dates : data) {
106             String regularDate = dates[0];
107             String weekDate = dates[1];
108             Date date1 = null, date2 = null;
109             date1 = ymdFormat.parse(regularDate);
110             date2 = ywdFormat.parse(weekDate);
111             if (!date1.equals(date2)) {
112                 System.err.println(regularDate + &quot;: date1 = &quot; + date1);
113                 System.err.println(weekDate + &quot;: date2 = &quot; + date2);
114                 throw new RuntimeException(&quot;parse: date1 != date2&quot;);
115             }
116         }
117     }
118 
119 
120     // Non-lenient mode test
121     private static void nonLenientTest(String[] data) {
122         ywdFormat.setLenient(false);
123         for (String date : data) {
124             try {
125                 Date d = ywdFormat.parse(date);
126                 throw new RuntimeException(&quot;No ParseException thrown with &quot; + date);
127             } catch (ParseException e) {
128                 // OK
129             }
130         }
131         ywdFormat.setLenient(true);
132     }
133 
134 
135     private static void noWeekDateSupport() throws Exception {
136         // Tests with Japanese Imperial Calendar that doesn&#39;t support week dates.
137         Calendar jcal = Calendar.getInstance(TimeZone.getTimeZone(&quot;GMT&quot;),
138                                              new Locale(&quot;ja&quot;, &quot;JP&quot;, &quot;JP&quot;));
139 
140         String format = &quot;2-W01-2&quot;; // 2019-12-31 == N1-12-31
141         int expectedYear = 2019;
142         // Check the current era, Heisei or NewEra
143         if (System.currentTimeMillis() &lt; 1556668800000L) {
144             format = &quot;21-W01-3&quot;; // 2008-12-31 == H20-12-31
145             expectedYear = 2008;
146         }
147         jcal.setFirstDayOfWeek(MONDAY);
148         jcal.setMinimalDaysInFirstWeek(4);
149         SimpleDateFormat sdf = new SimpleDateFormat(&quot;Y-&#39;W&#39;ww-u&quot;);
150         sdf.setCalendar(jcal);
151         Date d = sdf.parse(format);
152         GregorianCalendar gcal = newCalendar();
153         gcal.setTime(d);
154         if (gcal.get(YEAR) != expectedYear
155             || gcal.get(MONTH) != DECEMBER
156             || gcal.get(DAY_OF_MONTH) != 31) {
157             String s = String.format(&quot;noWeekDateSupport: got %04d-%02d-%02d, expected %4d-12-31%n&quot;,
158                                      gcal.get(YEAR),
159                                      gcal.get(MONTH)+1,
160                                      gcal.get(DAY_OF_MONTH),
161                                      expectedYear);
162             throw new RuntimeException(s);
163         }
164     }
165 
166     private static GregorianCalendar newCalendar() {
167         // Use GMT to avoid any surprises related DST transitions.
168         GregorianCalendar cal = new GregorianCalendar(TimeZone.getTimeZone(&quot;GMT&quot;));
169         // Setup the ISO 8601 compatible parameters
170         cal.setFirstDayOfWeek(MONDAY);
171         cal.setMinimalDaysInFirstWeek(4);
172         return cal;
173     }
174 }
    </pre>
  </body>
</html>