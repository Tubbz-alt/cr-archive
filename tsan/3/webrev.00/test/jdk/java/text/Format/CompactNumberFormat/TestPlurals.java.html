<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/java/text/Format/CompactNumberFormat/TestPlurals.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 /*
 24  * @test
 25  * @bug 8222756
 26  * @summary Tests plurals support in CompactNumberFormat
 27  * @run testng/othervm TestPlurals
 28  */
 29 
 30 import java.text.CompactNumberFormat;
 31 import java.text.DecimalFormatSymbols;
 32 import java.util.Locale;
 33 
 34 import static org.testng.Assert.*;
 35 import org.testng.annotations.DataProvider;
 36 import org.testng.annotations.Test;
 37 
 38 public class TestPlurals {
 39 
 40     private final static DecimalFormatSymbols DFS = DecimalFormatSymbols.getInstance(Locale.ROOT);
 41     private final static String[] PATTERN = {
 42             &quot;{zero:0-&gt;zero one:0-&gt;one two:0-&gt;two few:0-&gt;few many:0-&gt;many other:0-&gt;other}&quot;};
 43     private final static String RULE_1 = &quot;zero:n = 0; one:n = 1; two:n = 2; few:n = 3..4; many:n = 5..6,8&quot;;
 44     private final static String RULE_2 = &quot;one:n   %   2   =    1   or   n   /   3   =   2;&quot;;
 45     private final static String RULE_3 = &quot;one:n%2=0andn/3=2;&quot;;
 46 
 47 
 48     @DataProvider
 49     Object[][] pluralRules() {
 50         return new Object[][]{
 51             // rules, number, expected
 52             {RULE_1, 0, &quot;0-&gt;zero&quot;},
 53             {RULE_1, 1, &quot;1-&gt;one&quot;},
 54             {RULE_1, 2, &quot;2-&gt;two&quot;},
 55             {RULE_1, 3, &quot;3-&gt;few&quot;},
 56             {RULE_1, 4, &quot;4-&gt;few&quot;},
 57             {RULE_1, 5, &quot;5-&gt;many&quot;},
 58             {RULE_1, 6, &quot;6-&gt;many&quot;},
 59             {RULE_1, 7, &quot;7-&gt;other&quot;},
 60             {RULE_1, 8, &quot;8-&gt;many&quot;},
 61             {RULE_1, 9, &quot;9-&gt;other&quot;},
 62 
 63             {RULE_2, 0, &quot;0-&gt;other&quot;},
 64             {RULE_2, 1, &quot;1-&gt;one&quot;},
 65             {RULE_2, 2, &quot;2-&gt;other&quot;},
 66             {RULE_2, 3, &quot;3-&gt;one&quot;},
 67             {RULE_2, 4, &quot;4-&gt;other&quot;},
 68             {RULE_2, 5, &quot;5-&gt;one&quot;},
 69             {RULE_2, 6, &quot;6-&gt;one&quot;},
 70 
 71             {RULE_3, 0, &quot;0-&gt;other&quot;},
 72             {RULE_3, 1, &quot;1-&gt;other&quot;},
 73             {RULE_3, 2, &quot;2-&gt;other&quot;},
 74             {RULE_3, 3, &quot;3-&gt;other&quot;},
 75             {RULE_3, 4, &quot;4-&gt;other&quot;},
 76             {RULE_3, 5, &quot;5-&gt;other&quot;},
 77             {RULE_3, 6, &quot;6-&gt;one&quot;},
 78         };
 79     }
 80 
 81     @DataProvider
 82     Object[][] invalidRules() {
 83         return new Object [][] {
 84             {&quot;one:a = 1&quot;},
 85             {&quot;on:n = 1&quot;},
 86             {&quot;one:n = 1...2&quot;},
 87             {&quot;one:n = 1.2&quot;},
 88             {&quot;one:n = 1..2,&quot;},
 89             {&quot;one:n = 1;one:n = 2&quot;},
 90             {&quot;foo:n = 1&quot;},
 91             {&quot;one:n = 1..2 andor v % 10 != 0&quot;},
 92         };
 93     }
 94 
 95     @Test(expectedExceptions = NullPointerException.class)
 96     public void testNullPluralRules() {
 97         String[] pattern = {&quot;&quot;};
 98         new CompactNumberFormat(&quot;#&quot;, DFS, PATTERN, null);
 99     }
100 
101     @Test(dataProvider = &quot;pluralRules&quot;)
102     public void testPluralRules(String rules, Number n, String expected) {
103         var cnp = new CompactNumberFormat(&quot;#&quot;, DFS, PATTERN, rules);
104         assertEquals(cnp.format(n), expected);
105     }
106 
107     @Test(dataProvider = &quot;invalidRules&quot;, expectedExceptions = IllegalArgumentException.class)
108     public void testInvalidRules(String rules) {
109         new CompactNumberFormat(&quot;#&quot;, DFS, PATTERN, rules);
110     }
111 
112     @Test(expectedExceptions = IllegalArgumentException.class)
113     public void testLimitExceedingRules() {
114         String andCond = &quot; and n = 1&quot;;
115         String invalid = &quot;one: n = 1&quot; + andCond.repeat(2_048 / andCond.length());
116         new CompactNumberFormat(&quot;#&quot;, DFS, PATTERN, invalid);
117     }
118 }
    </pre>
  </body>
</html>