<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/logging/LogManagerAppContextDeadlock.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="LogManager/TestLoggerNames.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="RootLogger/RootLevelInConfigFile.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/logging/LogManagerAppContextDeadlock.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
323             return this;
324         }
325         public PermissionsBuilder addAll(PermissionCollection col) {
326             if (col != null) {
327                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
328                     perms.add(e.nextElement());
329                 }
330             }
331             return this;
332         }
333         public Permissions toPermissions() {
334             final PermissionsBuilder builder = new PermissionsBuilder();
335             builder.addAll(perms);
336             return builder.perms;
337         }
338     }
339 
340     // Policy for the test...
341     public static class SimplePolicy extends Policy {
342 


343         final Permissions permissions;
344         final Permissions allPermissions;
345         final ThreadLocal&lt;AtomicBoolean&gt; allowAll; // actually: this should be in a thread locale
346         public SimplePolicy(TestCase test, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
347             this.allowAll = allowAll;
348             // we don&#39;t actually need any permission to create our
349             // FileHandlers because we&#39;re passing invalid parameters
350             // which will make the creation fail...
351             permissions = new Permissions();
352             permissions.add(new RuntimePermission(&quot;accessClassInPackage.jdk.internal.access&quot;));
353 
354             // these are used for configuring the test itself...
355             allPermissions = new Permissions();
356             allPermissions.add(new java.security.AllPermission());
357 
358         }
359 
360         @Override
361         public boolean implies(ProtectionDomain domain, Permission permission) {
362             if (allowAll.get().get()) return allPermissions.implies(permission);
<span class="line-modified">363             return permissions.implies(permission);</span>
364         }
365 
366         @Override
367         public PermissionCollection getPermissions(CodeSource codesource) {
368             return new PermissionsBuilder().addAll(allowAll.get().get()
369                     ? allPermissions : permissions).toPermissions();
370         }
371 
372         @Override
373         public PermissionCollection getPermissions(ProtectionDomain domain) {
374             return new PermissionsBuilder().addAll(allowAll.get().get()
375                     ? allPermissions : permissions).toPermissions();
376         }
377     }
378 
379 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
323             return this;
324         }
325         public PermissionsBuilder addAll(PermissionCollection col) {
326             if (col != null) {
327                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
328                     perms.add(e.nextElement());
329                 }
330             }
331             return this;
332         }
333         public Permissions toPermissions() {
334             final PermissionsBuilder builder = new PermissionsBuilder();
335             builder.addAll(perms);
336             return builder.perms;
337         }
338     }
339 
340     // Policy for the test...
341     public static class SimplePolicy extends Policy {
342 
<span class="line-added">343         static final Policy DEFAULT_POLICY = Policy.getPolicy();</span>
<span class="line-added">344 </span>
345         final Permissions permissions;
346         final Permissions allPermissions;
347         final ThreadLocal&lt;AtomicBoolean&gt; allowAll; // actually: this should be in a thread locale
348         public SimplePolicy(TestCase test, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
349             this.allowAll = allowAll;
350             // we don&#39;t actually need any permission to create our
351             // FileHandlers because we&#39;re passing invalid parameters
352             // which will make the creation fail...
353             permissions = new Permissions();
354             permissions.add(new RuntimePermission(&quot;accessClassInPackage.jdk.internal.access&quot;));
355 
356             // these are used for configuring the test itself...
357             allPermissions = new Permissions();
358             allPermissions.add(new java.security.AllPermission());
359 
360         }
361 
362         @Override
363         public boolean implies(ProtectionDomain domain, Permission permission) {
364             if (allowAll.get().get()) return allPermissions.implies(permission);
<span class="line-modified">365             return permissions.implies(permission) || DEFAULT_POLICY.implies(domain, permission);</span>
366         }
367 
368         @Override
369         public PermissionCollection getPermissions(CodeSource codesource) {
370             return new PermissionsBuilder().addAll(allowAll.get().get()
371                     ? allPermissions : permissions).toPermissions();
372         }
373 
374         @Override
375         public PermissionCollection getPermissions(ProtectionDomain domain) {
376             return new PermissionsBuilder().addAll(allowAll.get().get()
377                     ? allPermissions : permissions).toPermissions();
378         }
379     }
380 
381 }
</pre>
</td>
</tr>
</table>
<center><a href="LogManager/TestLoggerNames.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="RootLogger/RootLevelInConfigFile.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>