<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/logging/LogManager/Configuration/updateConfiguration/HandlersOnComplexResetUpdate.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../ParentLoggerWithHandlerGC.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HandlersOnComplexUpdate.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/logging/LogManager/Configuration/updateConfiguration/HandlersOnComplexResetUpdate.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
505             perms.add(p);
506             return this;
507         }
508         public PermissionsBuilder addAll(PermissionCollection col) {
509             if (col != null) {
510                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
511                     perms.add(e.nextElement());
512                 }
513             }
514             return this;
515         }
516         public Permissions toPermissions() {
517             final PermissionsBuilder builder = new PermissionsBuilder();
518             builder.addAll(perms);
519             return builder.perms;
520         }
521     }
522 
523     public static class SimplePolicy extends Policy {
524 


525         final Permissions permissions;
526         final Permissions allPermissions;
527         final ThreadLocal&lt;AtomicBoolean&gt; allowAll; // actually: this should be in a thread locale
528         public SimplePolicy(TestCase test, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
529             this.allowAll = allowAll;
530             permissions = new Permissions();
531             permissions.add(new LoggingPermission(&quot;control&quot;, null));
532             permissions.add(new FilePermission(PREFIX+&quot;.lck&quot;, &quot;read,write,delete&quot;));
533             permissions.add(new FilePermission(PREFIX, &quot;read,write&quot;));
534 
535             // these are used for configuring the test itself...
536             allPermissions = new Permissions();
537             allPermissions.add(new java.security.AllPermission());
538 
539         }
540 
541         @Override
542         public boolean implies(ProtectionDomain domain, Permission permission) {
543             if (allowAll.get().get()) return allPermissions.implies(permission);
<span class="line-modified">544             return permissions.implies(permission);</span>
545         }
546 
547         @Override
548         public PermissionCollection getPermissions(CodeSource codesource) {
549             return new PermissionsBuilder().addAll(allowAll.get().get()
550                     ? allPermissions : permissions).toPermissions();
551         }
552 
553         @Override
554         public PermissionCollection getPermissions(ProtectionDomain domain) {
555             return new PermissionsBuilder().addAll(allowAll.get().get()
556                     ? allPermissions : permissions).toPermissions();
557         }
558     }
559 
560 }
</pre>
</td>
<td>
<hr />
<pre>
505             perms.add(p);
506             return this;
507         }
508         public PermissionsBuilder addAll(PermissionCollection col) {
509             if (col != null) {
510                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
511                     perms.add(e.nextElement());
512                 }
513             }
514             return this;
515         }
516         public Permissions toPermissions() {
517             final PermissionsBuilder builder = new PermissionsBuilder();
518             builder.addAll(perms);
519             return builder.perms;
520         }
521     }
522 
523     public static class SimplePolicy extends Policy {
524 
<span class="line-added">525         static final Policy DEFAULT_POLICY = Policy.getPolicy();</span>
<span class="line-added">526 </span>
527         final Permissions permissions;
528         final Permissions allPermissions;
529         final ThreadLocal&lt;AtomicBoolean&gt; allowAll; // actually: this should be in a thread locale
530         public SimplePolicy(TestCase test, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
531             this.allowAll = allowAll;
532             permissions = new Permissions();
533             permissions.add(new LoggingPermission(&quot;control&quot;, null));
534             permissions.add(new FilePermission(PREFIX+&quot;.lck&quot;, &quot;read,write,delete&quot;));
535             permissions.add(new FilePermission(PREFIX, &quot;read,write&quot;));
536 
537             // these are used for configuring the test itself...
538             allPermissions = new Permissions();
539             allPermissions.add(new java.security.AllPermission());
540 
541         }
542 
543         @Override
544         public boolean implies(ProtectionDomain domain, Permission permission) {
545             if (allowAll.get().get()) return allPermissions.implies(permission);
<span class="line-modified">546             return permissions.implies(permission) || DEFAULT_POLICY.implies(domain, permission);</span>
547         }
548 
549         @Override
550         public PermissionCollection getPermissions(CodeSource codesource) {
551             return new PermissionsBuilder().addAll(allowAll.get().get()
552                     ? allPermissions : permissions).toPermissions();
553         }
554 
555         @Override
556         public PermissionCollection getPermissions(ProtectionDomain domain) {
557             return new PermissionsBuilder().addAll(allowAll.get().get()
558                     ? allPermissions : permissions).toPermissions();
559         }
560     }
561 
562 }
</pre>
</td>
</tr>
</table>
<center><a href="../ParentLoggerWithHandlerGC.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HandlersOnComplexUpdate.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>