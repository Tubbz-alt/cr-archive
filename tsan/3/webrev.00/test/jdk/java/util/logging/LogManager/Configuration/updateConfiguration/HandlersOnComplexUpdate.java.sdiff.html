<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/logging/LogManager/Configuration/updateConfiguration/HandlersOnComplexUpdate.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HandlersOnComplexResetUpdate.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SimpleUpdateConfigurationTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/logging/LogManager/Configuration/updateConfiguration/HandlersOnComplexUpdate.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
504             perms.add(p);
505             return this;
506         }
507         public PermissionsBuilder addAll(PermissionCollection col) {
508             if (col != null) {
509                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
510                     perms.add(e.nextElement());
511                 }
512             }
513             return this;
514         }
515         public Permissions toPermissions() {
516             final PermissionsBuilder builder = new PermissionsBuilder();
517             builder.addAll(perms);
518             return builder.perms;
519         }
520     }
521 
522     public static class SimplePolicy extends Policy {
523 


524         final Permissions permissions;
525         final Permissions allPermissions;
526         final ThreadLocal&lt;AtomicBoolean&gt; allowAll; // actually: this should be in a thread locale
527         public SimplePolicy(TestCase test, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
528             this.allowAll = allowAll;
529             permissions = new Permissions();
530             permissions.add(new LoggingPermission(&quot;control&quot;, null));
531             permissions.add(new FilePermission(PREFIX+&quot;.lck&quot;, &quot;read,write,delete&quot;));
532             permissions.add(new FilePermission(PREFIX, &quot;read,write&quot;));
533 
534             // these are used for configuring the test itself...
535             allPermissions = new Permissions();
536             allPermissions.add(new java.security.AllPermission());
537 
538         }
539 
540         @Override
541         public boolean implies(ProtectionDomain domain, Permission permission) {
542             if (allowAll.get().get()) return allPermissions.implies(permission);
<span class="line-modified">543             return permissions.implies(permission);</span>
544         }
545 
546         @Override
547         public PermissionCollection getPermissions(CodeSource codesource) {
548             return new PermissionsBuilder().addAll(allowAll.get().get()
549                     ? allPermissions : permissions).toPermissions();
550         }
551 
552         @Override
553         public PermissionCollection getPermissions(ProtectionDomain domain) {
554             return new PermissionsBuilder().addAll(allowAll.get().get()
555                     ? allPermissions : permissions).toPermissions();
556         }
557     }
558 
559 }
</pre>
</td>
<td>
<hr />
<pre>
504             perms.add(p);
505             return this;
506         }
507         public PermissionsBuilder addAll(PermissionCollection col) {
508             if (col != null) {
509                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
510                     perms.add(e.nextElement());
511                 }
512             }
513             return this;
514         }
515         public Permissions toPermissions() {
516             final PermissionsBuilder builder = new PermissionsBuilder();
517             builder.addAll(perms);
518             return builder.perms;
519         }
520     }
521 
522     public static class SimplePolicy extends Policy {
523 
<span class="line-added">524         static final Policy DEFAULT_POLICY = Policy.getPolicy();</span>
<span class="line-added">525 </span>
526         final Permissions permissions;
527         final Permissions allPermissions;
528         final ThreadLocal&lt;AtomicBoolean&gt; allowAll; // actually: this should be in a thread locale
529         public SimplePolicy(TestCase test, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
530             this.allowAll = allowAll;
531             permissions = new Permissions();
532             permissions.add(new LoggingPermission(&quot;control&quot;, null));
533             permissions.add(new FilePermission(PREFIX+&quot;.lck&quot;, &quot;read,write,delete&quot;));
534             permissions.add(new FilePermission(PREFIX, &quot;read,write&quot;));
535 
536             // these are used for configuring the test itself...
537             allPermissions = new Permissions();
538             allPermissions.add(new java.security.AllPermission());
539 
540         }
541 
542         @Override
543         public boolean implies(ProtectionDomain domain, Permission permission) {
544             if (allowAll.get().get()) return allPermissions.implies(permission);
<span class="line-modified">545             return permissions.implies(permission) || DEFAULT_POLICY.implies(domain, permission);</span>
546         }
547 
548         @Override
549         public PermissionCollection getPermissions(CodeSource codesource) {
550             return new PermissionsBuilder().addAll(allowAll.get().get()
551                     ? allPermissions : permissions).toPermissions();
552         }
553 
554         @Override
555         public PermissionCollection getPermissions(ProtectionDomain domain) {
556             return new PermissionsBuilder().addAll(allowAll.get().get()
557                     ? allPermissions : permissions).toPermissions();
558         }
559     }
560 
561 }
</pre>
</td>
</tr>
</table>
<center><a href="HandlersOnComplexResetUpdate.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="SimpleUpdateConfigurationTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>