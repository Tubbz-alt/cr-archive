<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/logging/LogManager/Configuration/updateConfiguration/SimpleUpdateConfigurationTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HandlersOnComplexUpdate.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../RootLogger/setLevel/TestRootLoggerLevel.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/logging/LogManager/Configuration/updateConfiguration/SimpleUpdateConfigurationTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
635             perms.add(p);
636             return this;
637         }
638         public PermissionsBuilder addAll(PermissionCollection col) {
639             if (col != null) {
640                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
641                     perms.add(e.nextElement());
642                 }
643             }
644             return this;
645         }
646         public Permissions toPermissions() {
647             final PermissionsBuilder builder = new PermissionsBuilder();
648             builder.addAll(perms);
649             return builder.perms;
650         }
651     }
652 
653     public static class SimplePolicy extends Policy {
654 


655         final Permissions basic;
656         final Permissions control;
657         final Permissions all;
658         public final static ThreadLocal&lt;AtomicBoolean&gt; allowAll =
659                 new ThreadLocal&lt;AtomicBoolean&gt;() {
660             @Override
661             protected AtomicBoolean initialValue() {
662                 return new AtomicBoolean();
663             }
664         };
665         public final static ThreadLocal&lt;AtomicBoolean&gt; allowControl =
666                 new ThreadLocal&lt;AtomicBoolean&gt;() {
667             @Override
668             protected AtomicBoolean initialValue() {
669                 return new AtomicBoolean();
670             }
671         };
672         public SimplePolicy(TestCase test) {
673             basic = new Permissions();
674             control = new Permissions();
675             control.add(new LoggingPermission(&quot;control&quot;, null));
676 
677             // These permissions are required to call updateConfiguration(Function)
678             control.add(new PropertyPermission(&quot;java.util.logging.config.file&quot;, &quot;read&quot;));
679             control.add(new PropertyPermission(&quot;java.home&quot;, &quot;read&quot;));
680             control.add(new FilePermission(
681                     Paths.get(System.getProperty(&quot;user.dir&quot;, &quot;.&quot;),&quot;-&quot;).toString(), &quot;read&quot;));
682             control.add(new FilePermission(
683                     Paths.get(System.getProperty(&quot;java.home&quot;),&quot;conf&quot;,&quot;-&quot;).toString(), &quot;read&quot;));
684 
685             // these are used for configuring the test itself...
686             all = new Permissions();
687             all.add(new java.security.AllPermission());
688 
689         }
690 
691         @Override
692         public boolean implies(ProtectionDomain domain, Permission permission) {
<span class="line-modified">693             return getPermissions(domain).implies(permission);</span>
694         }
695 
696         public PermissionCollection permissions() {
697             PermissionsBuilder builder = new PermissionsBuilder();
698             if (allowAll.get().get()) {
699                 builder.addAll(all);
700             } else {
701                 builder.addAll(basic);
702                 if (allowControl.get().get()) {
703                     builder.addAll(control);
704                 }
705             }
706             return builder.toPermissions();
707         }
708 
709         @Override
710         public PermissionCollection getPermissions(CodeSource codesource) {
711             return permissions();
712         }
713 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
635             perms.add(p);
636             return this;
637         }
638         public PermissionsBuilder addAll(PermissionCollection col) {
639             if (col != null) {
640                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
641                     perms.add(e.nextElement());
642                 }
643             }
644             return this;
645         }
646         public Permissions toPermissions() {
647             final PermissionsBuilder builder = new PermissionsBuilder();
648             builder.addAll(perms);
649             return builder.perms;
650         }
651     }
652 
653     public static class SimplePolicy extends Policy {
654 
<span class="line-added">655         static final Policy DEFAULT_POLICY = Policy.getPolicy();</span>
<span class="line-added">656 </span>
657         final Permissions basic;
658         final Permissions control;
659         final Permissions all;
660         public final static ThreadLocal&lt;AtomicBoolean&gt; allowAll =
661                 new ThreadLocal&lt;AtomicBoolean&gt;() {
662             @Override
663             protected AtomicBoolean initialValue() {
664                 return new AtomicBoolean();
665             }
666         };
667         public final static ThreadLocal&lt;AtomicBoolean&gt; allowControl =
668                 new ThreadLocal&lt;AtomicBoolean&gt;() {
669             @Override
670             protected AtomicBoolean initialValue() {
671                 return new AtomicBoolean();
672             }
673         };
674         public SimplePolicy(TestCase test) {
675             basic = new Permissions();
676             control = new Permissions();
677             control.add(new LoggingPermission(&quot;control&quot;, null));
678 
679             // These permissions are required to call updateConfiguration(Function)
680             control.add(new PropertyPermission(&quot;java.util.logging.config.file&quot;, &quot;read&quot;));
681             control.add(new PropertyPermission(&quot;java.home&quot;, &quot;read&quot;));
682             control.add(new FilePermission(
683                     Paths.get(System.getProperty(&quot;user.dir&quot;, &quot;.&quot;),&quot;-&quot;).toString(), &quot;read&quot;));
684             control.add(new FilePermission(
685                     Paths.get(System.getProperty(&quot;java.home&quot;),&quot;conf&quot;,&quot;-&quot;).toString(), &quot;read&quot;));
686 
687             // these are used for configuring the test itself...
688             all = new Permissions();
689             all.add(new java.security.AllPermission());
690 
691         }
692 
693         @Override
694         public boolean implies(ProtectionDomain domain, Permission permission) {
<span class="line-modified">695             return getPermissions(domain).implies(permission) || DEFAULT_POLICY.implies(domain, permission);</span>
696         }
697 
698         public PermissionCollection permissions() {
699             PermissionsBuilder builder = new PermissionsBuilder();
700             if (allowAll.get().get()) {
701                 builder.addAll(all);
702             } else {
703                 builder.addAll(basic);
704                 if (allowControl.get().get()) {
705                     builder.addAll(control);
706                 }
707             }
708             return builder.toPermissions();
709         }
710 
711         @Override
712         public PermissionCollection getPermissions(CodeSource codesource) {
713             return permissions();
714         }
715 
</pre>
</td>
</tr>
</table>
<center><a href="HandlersOnComplexUpdate.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../RootLogger/setLevel/TestRootLoggerLevel.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>