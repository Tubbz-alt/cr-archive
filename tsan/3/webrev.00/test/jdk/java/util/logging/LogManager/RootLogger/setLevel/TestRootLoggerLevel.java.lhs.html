<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/util/logging/LogManager/RootLogger/setLevel/TestRootLoggerLevel.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2013, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.security.Permission;
 25 import java.security.Permissions;
 26 import java.security.Policy;
 27 import java.security.ProtectionDomain;
 28 import java.util.logging.Level;
 29 import java.util.logging.Logger;
 30 import java.util.logging.LoggingPermission;
 31 
 32 
 33 
 34 /**
 35  * @test
 36  * @bug 8026499
 37  * @summary checks that Logger.getLogger(&quot;&quot;).setLevel() is working correctly.
 38  * @modules java.base/sun.util.logging
 39  *          java.logging
 40  * @build TestRootLoggerLevel
 41  * @run main/othervm -Dtest.security=on TestRootLoggerLevel
 42  * @run main/othervm -Dtest.security=off TestRootLoggerLevel
 43  * @author danielfuchs
 44  */
 45 public class TestRootLoggerLevel {
 46 
 47     public static enum Loggers {
 48         ROOT(&quot;&quot;, &quot;root&quot;),
 49         GLOBAL(Logger.GLOBAL_LOGGER_NAME);
 50 
 51         private final String name;
 52         private final String displayName;
 53         Loggers(String name) {
 54             this(name, name);
 55         }
 56         Loggers(String name, String displayName) {
 57             this.name = name;
 58             this.displayName = displayName;
 59         }
 60     }
 61 
 62     public static void main(String[] args) throws Exception {
 63 
 64         for (Loggers log : Loggers.values()) {
 65             System.out.println(log.displayName + &quot;: &quot;
 66                     + Logger.getLogger(log.name)
 67                     + &quot;: &quot; + Logger.getLogger(log.name).getLevel());
 68         }
 69 
 70         if (&quot;on&quot;.equals(System.getProperty(&quot;test.security&quot;,&quot;on&quot;))) {
 71             System.out.println(&quot;*** SecurityManager is ON&quot;);
 72             Policy.setPolicy(new SimplePolicy());
 73 
 74             System.setSecurityManager(new SecurityManager());
 75         } else {
 76             System.out.println(&quot;*** SecurityManager is OFF&quot;);
 77         }
 78 
 79         // Before the fix, setting the root logger level here had only
 80         // a transient effect...
 81         for (Loggers log : Loggers.values()) {
 82             System.out.println(&quot;Logger.getLogger(\&quot;&quot;
 83                     + log.name
 84                     + &quot;\&quot;).setLevel(Level.FINEST);&quot;);
 85             Logger.getLogger(log.name).setLevel(Level.FINEST);
 86             System.out.println(log.displayName + &quot;: &quot;
 87                     + Logger.getLogger(log.name)
 88                     + &quot;: &quot; + Logger.getLogger(log.name).getLevel());
 89 
 90             // At this point - the root logger should have a level which is
 91             // FINEST - just check it here for sanity.
 92             if (Logger.getLogger(log.name).getLevel() != Level.FINEST) {
 93                 throw new RuntimeException(&quot;Logger &quot; + log.displayName
 94                         + &quot; level should be FINEST: &quot;
 95                         + Logger.getLogger(log.name).getLevel());
 96             }
 97         }
 98         // Initializing some PlatformLogger caused the root logger
 99         // level to be reset to INFO.
100         //
101         final Object platformLogger =
102                 sun.util.logging.PlatformLogger.getLogger(&quot;java.foo&quot;);
103         System.out.println(&quot;Got platform logger: &quot; + platformLogger);
104 
105         for (Loggers log : Loggers.values()) {
106             // Check that the root logger still has the FINEST value assigned
107             // to it earlier.
108             System.out.println(log.displayName + &quot;: &quot;
109                     + Logger.getLogger(log.name)
110                     + &quot;: &quot; + Logger.getLogger(log.name).getLevel());
111 
112             if (Logger.getLogger(log.name).getLevel() != Level.FINEST) {
113                 throw new RuntimeException(&quot;Logger &quot; + log.displayName
114                         + &quot; level should be FINEST: &quot;
115                         + Logger.getLogger(log.name).getLevel());
116             }
117         }
118 
119      }
120 
121     private static final class SimplePolicy extends Policy {
<a name="2" id="anc2"></a>


122         private final Permissions perms;
123 
124         private static final Permissions permissions(Permission... perms) {
125             Permissions permissions = new Permissions();
126             for (Permission perm : perms) {
127                 permissions.add(perm);
128             }
129             return permissions;
130         }
131 
132         SimplePolicy() {
133             this(permissions(new LoggingPermission(&quot;control&quot;, null),
134                     new RuntimePermission(&quot;accessClassInPackage.sun.util.logging&quot;)
135             ));
136         }
137 
138         SimplePolicy(Permissions perms) {
139             this.perms = perms;
140         }
141 
142         @Override
143         public boolean implies(ProtectionDomain domain, Permission permission) {
<a name="3" id="anc3"></a><span class="line-modified">144             return perms.implies(permission);</span>
145         }
146 
147     }
148 
149 }
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>