<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/java/util/Map/MapFactories.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.io.ByteArrayInputStream;
 25 import java.io.ByteArrayOutputStream;
 26 import java.io.IOException;
 27 import java.io.ObjectInputStream;
 28 import java.io.ObjectOutputStream;
 29 import java.util.AbstractMap;
 30 import java.util.ArrayList;
 31 import java.util.Arrays;
 32 import java.util.Collections;
 33 import java.util.Iterator;
 34 import java.util.HashMap;
 35 import java.util.List;
 36 import java.util.Map;
 37 import java.util.stream.Collectors;
 38 import java.util.stream.IntStream;
 39 
 40 import org.testng.annotations.DataProvider;
 41 import org.testng.annotations.Test;
 42 
 43 import static org.testng.Assert.assertEquals;
 44 import static org.testng.Assert.assertFalse;
 45 import static org.testng.Assert.assertNotEquals;
 46 import static org.testng.Assert.assertNotSame;
 47 import static org.testng.Assert.assertSame;
 48 import static org.testng.Assert.assertTrue;
 49 import static org.testng.Assert.fail;
 50 
 51 /*
 52  * @test
 53  * @bug 8048330 8221924
 54  * @summary Test convenience static factory methods on Map.
 55  * @run testng MapFactories
 56  */
 57 
 58 public class MapFactories {
 59 
 60     static final int MAX_ENTRIES = 20; // should be larger than the largest fixed-arg overload
 61     static String valueFor(int i) {
 62         // the String literal below should be of length MAX_ENTRIES
 63         return &quot;abcdefghijklmnopqrst&quot;.substring(i, i+1);
 64     }
 65 
 66     // for &quot;expected&quot; values
 67     Map&lt;Integer,String&gt; genMap(int n) {
 68         Map&lt;Integer,String&gt; result = new HashMap&lt;&gt;();
 69         for (int i = 0; i &lt; n; i++) {
 70             result.put(i, valueFor(i));
 71         }
 72         return result;
 73     }
 74 
 75     // for varargs Map.Entry methods
 76 
 77     @SuppressWarnings(&quot;unchecked&quot;)
 78     Map.Entry&lt;Integer,String&gt;[] genEmptyEntryArray1() {
 79         return (Map.Entry&lt;Integer,String&gt;[])new Map.Entry&lt;?,?&gt;[1];
 80     }
 81 
 82     @SuppressWarnings(&quot;unchecked&quot;)
 83     Map.Entry&lt;Integer,String&gt;[] genEntries(int n) {
 84         return IntStream.range(0, n)
 85             .mapToObj(i -&gt; Map.entry(i, valueFor(i)))
 86             .toArray(Map.Entry[]::new);
 87     }
 88 
 89     // returns array of [actual, expected]
 90     static Object[] a(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
 91         return new Object[] { act, exp };
 92     }
 93 
 94     @DataProvider(name=&quot;empty&quot;)
 95     public Iterator&lt;Object[]&gt; empty() {
 96         return Collections.singletonList(
 97             a(Map.of(), genMap(0))
 98         ).iterator();
 99     }
100 
101     @DataProvider(name=&quot;nonempty&quot;)
102     @SuppressWarnings(&quot;unchecked&quot;)
103     public Iterator&lt;Object[]&gt; nonempty() {
104         return Arrays.asList(
105             a(Map.of(0, &quot;a&quot;), genMap(1)),
106             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;), genMap(2)),
107             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;), genMap(3)),
108             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;), genMap(4)),
109             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;), genMap(5)),
110             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;, 5, &quot;f&quot;), genMap(6)),
111             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;, 5, &quot;f&quot;, 6, &quot;g&quot;), genMap(7)),
112             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;, 5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;), genMap(8)),
113             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;, 5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, 8, &quot;i&quot;), genMap(9)),
114             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;, 5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, 8, &quot;i&quot;, 9, &quot;j&quot;), genMap(10)),
115             a(Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;, 5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, 8, &quot;i&quot;, 9, &quot;j&quot;),
116               Map.of(4, &quot;e&quot;, 5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, 8, &quot;i&quot;, 9, &quot;j&quot;, 0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;)),
117             a(Map.ofEntries(genEntries(MAX_ENTRIES)), genMap(MAX_ENTRIES))
118         ).iterator();
119     }
120 
121     @DataProvider(name=&quot;all&quot;)
122     public Iterator&lt;Object[]&gt; all() {
123         List&lt;Object[]&gt; all = new ArrayList&lt;&gt;();
124         empty().forEachRemaining(all::add);
125         nonempty().forEachRemaining(all::add);
126         return all.iterator();
127     }
128 
129     @Test(dataProvider=&quot;all&quot;, expectedExceptions=UnsupportedOperationException.class)
130     public void cannotPutNew(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
131         act.put(-1, &quot;xyzzy&quot;);
132     }
133 
134     @Test(dataProvider=&quot;nonempty&quot;, expectedExceptions=UnsupportedOperationException.class)
135     public void cannotPutOld(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
136         act.put(0, &quot;a&quot;);
137     }
138 
139     @Test(dataProvider=&quot;nonempty&quot;, expectedExceptions=UnsupportedOperationException.class)
140     public void cannotRemove(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
141         act.remove(act.keySet().iterator().next());
142     }
143 
144     @Test(dataProvider=&quot;all&quot;)
145     public void contentsMatch(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
146         assertEquals(act, exp);
147     }
148 
149     @Test(dataProvider=&quot;all&quot;)
150     public void containsAllKeys(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
151         assertTrue(act.keySet().containsAll(exp.keySet()));
152         assertTrue(exp.keySet().containsAll(act.keySet()));
153     }
154 
155     @Test(dataProvider=&quot;all&quot;)
156     public void containsAllValues(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
157         assertTrue(act.values().containsAll(exp.values()));
158         assertTrue(exp.values().containsAll(act.values()));
159     }
160 
161     @Test(expectedExceptions=IllegalArgumentException.class)
162     public void dupKeysDisallowed2() {
163         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 0, &quot;b&quot;);
164     }
165 
166     @Test(expectedExceptions=IllegalArgumentException.class)
167     public void dupKeysDisallowed3() {
168         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 0, &quot;c&quot;);
169     }
170 
171     @Test(expectedExceptions=IllegalArgumentException.class)
172     public void dupKeysDisallowed4() {
173         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 0, &quot;d&quot;);
174     }
175 
176     @Test(expectedExceptions=IllegalArgumentException.class)
177     public void dupKeysDisallowed5() {
178         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 0, &quot;e&quot;);
179     }
180 
181     @Test(expectedExceptions=IllegalArgumentException.class)
182     public void dupKeysDisallowed6() {
183         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
184                                           0, &quot;f&quot;);
185     }
186 
187     @Test(expectedExceptions=IllegalArgumentException.class)
188     public void dupKeysDisallowed7() {
189         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
190                                           5, &quot;f&quot;, 0, &quot;g&quot;);
191     }
192 
193     @Test(expectedExceptions=IllegalArgumentException.class)
194     public void dupKeysDisallowed8() {
195         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
196                                           5, &quot;f&quot;, 6, &quot;g&quot;, 0, &quot;h&quot;);
197     }
198 
199     @Test(expectedExceptions=IllegalArgumentException.class)
200     public void dupKeysDisallowed9() {
201         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
202                                           5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, 0, &quot;i&quot;);
203     }
204 
205     @Test(expectedExceptions=IllegalArgumentException.class)
206     public void dupKeysDisallowed10() {
207         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
208                                           5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, 8, &quot;i&quot;, 0, &quot;j&quot;);
209     }
210 
211     @Test(expectedExceptions=IllegalArgumentException.class)
212     public void dupKeysDisallowedN() {
213         Map.Entry&lt;Integer,String&gt;[] entries = genEntries(MAX_ENTRIES);
214         entries[MAX_ENTRIES-1] = Map.entry(0, &quot;xxx&quot;);
215         Map&lt;Integer, String&gt; map = Map.ofEntries(entries);
216     }
217 
218     @Test(dataProvider=&quot;all&quot;)
219     public void hashCodeEquals(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
220         assertEquals(act.hashCode(), exp.hashCode());
221     }
222 
223     @Test(expectedExceptions=NullPointerException.class)
224     public void nullKeyDisallowed1() {
225         Map&lt;Integer, String&gt; map = Map.of(null, &quot;a&quot;);
226     }
227 
228     @Test(expectedExceptions=NullPointerException.class)
229     public void nullValueDisallowed1() {
230         Map&lt;Integer, String&gt; map = Map.of(0, null);
231     }
232 
233     @Test(expectedExceptions=NullPointerException.class)
234     public void nullKeyDisallowed2() {
235         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, null, &quot;b&quot;);
236     }
237 
238     @Test(expectedExceptions=NullPointerException.class)
239     public void nullValueDisallowed2() {
240         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, null);
241     }
242 
243     @Test(expectedExceptions=NullPointerException.class)
244     public void nullKeyDisallowed3() {
245         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, null, &quot;c&quot;);
246     }
247 
248     @Test(expectedExceptions=NullPointerException.class)
249     public void nullValueDisallowed3() {
250         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, null);
251     }
252 
253     @Test(expectedExceptions=NullPointerException.class)
254     public void nullKeyDisallowed4() {
255         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, null, &quot;d&quot;);
256     }
257 
258     @Test(expectedExceptions=NullPointerException.class)
259     public void nullValueDisallowed4() {
260         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, null);
261     }
262 
263     @Test(expectedExceptions=NullPointerException.class)
264     public void nullKeyDisallowed5() {
265         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, null, &quot;e&quot;);
266     }
267 
268     @Test(expectedExceptions=NullPointerException.class)
269     public void nullValueDisallowed5() {
270         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, null);
271     }
272 
273     @Test(expectedExceptions=NullPointerException.class)
274     public void nullKeyDisallowed6() {
275         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
276                                           null, &quot;f&quot;);
277     }
278 
279     @Test(expectedExceptions=NullPointerException.class)
280     public void nullValueDisallowed6() {
281         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
282                                           5, null);
283     }
284 
285     @Test(expectedExceptions=NullPointerException.class)
286     public void nullKeyDisallowed7() {
287         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
288                                           5, &quot;f&quot;, null, &quot;g&quot;);
289     }
290 
291     @Test(expectedExceptions=NullPointerException.class)
292     public void nullValueDisallowed7() {
293         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
294                                           5, &quot;f&quot;, 6, null);
295     }
296 
297     @Test(expectedExceptions=NullPointerException.class)
298     public void nullKeyDisallowed8() {
299         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
300                                           5, &quot;f&quot;, 6, &quot;g&quot;, null, &quot;h&quot;);
301     }
302 
303     @Test(expectedExceptions=NullPointerException.class)
304     public void nullValueDisallowed8() {
305         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
306                                           5, &quot;f&quot;, 6, &quot;g&quot;, 7, null);
307     }
308 
309     @Test(expectedExceptions=NullPointerException.class)
310     public void nullKeyDisallowed9() {
311         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
312                                           5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, null, &quot;i&quot;);
313     }
314 
315     @Test(expectedExceptions=NullPointerException.class)
316     public void nullValueDisallowed9() {
317         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
318                                           5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, 8, null);
319     }
320 
321     @Test(expectedExceptions=NullPointerException.class)
322     public void nullKeyDisallowed10() {
323         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
324                                           5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, 8, &quot;i&quot;, null, &quot;j&quot;);
325     }
326 
327     @Test(expectedExceptions=NullPointerException.class)
328     public void nullValueDisallowed10() {
329         Map&lt;Integer, String&gt; map = Map.of(0, &quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3, &quot;d&quot;, 4, &quot;e&quot;,
330                                           5, &quot;f&quot;, 6, &quot;g&quot;, 7, &quot;h&quot;, 8, &quot;i&quot;, 9, null);
331     }
332 
333     @Test(expectedExceptions=NullPointerException.class)
334     public void nullKeyDisallowedVar1() {
335         Map.Entry&lt;Integer,String&gt;[] entries = genEmptyEntryArray1();
336         entries[0] = new AbstractMap.SimpleImmutableEntry&lt;&gt;(null, &quot;a&quot;);
337         Map&lt;Integer, String&gt; map = Map.ofEntries(entries);
338     }
339 
340     @Test(expectedExceptions=NullPointerException.class)
341     public void nullValueDisallowedVar1() {
342         Map.Entry&lt;Integer,String&gt;[] entries = genEmptyEntryArray1();
343         entries[0] = new AbstractMap.SimpleImmutableEntry&lt;&gt;(0, null);
344         Map&lt;Integer, String&gt; map = Map.ofEntries(entries);
345     }
346 
347     @Test(expectedExceptions=NullPointerException.class)
348     public void nullEntryDisallowedVar1() {
349         Map.Entry&lt;Integer,String&gt;[] entries = genEmptyEntryArray1();
350         Map&lt;Integer, String&gt; map = Map.ofEntries(entries);
351     }
352 
353     @Test(expectedExceptions=NullPointerException.class)
354     public void nullKeyDisallowedVarN() {
355         Map.Entry&lt;Integer,String&gt;[] entries = genEntries(MAX_ENTRIES);
356         entries[0] = new AbstractMap.SimpleImmutableEntry&lt;&gt;(null, &quot;a&quot;);
357         Map&lt;Integer, String&gt; map = Map.ofEntries(entries);
358     }
359 
360     @Test(expectedExceptions=NullPointerException.class)
361     public void nullValueDisallowedVarN() {
362         Map.Entry&lt;Integer,String&gt;[] entries = genEntries(MAX_ENTRIES);
363         entries[0] = new AbstractMap.SimpleImmutableEntry&lt;&gt;(0, null);
364         Map&lt;Integer, String&gt; map = Map.ofEntries(entries);
365     }
366 
367     @Test(expectedExceptions=NullPointerException.class)
368     public void nullEntryDisallowedVarN() {
369         Map.Entry&lt;Integer,String&gt;[] entries = genEntries(MAX_ENTRIES);
370         entries[5] = null;
371         Map&lt;Integer, String&gt; map = Map.ofEntries(entries);
372     }
373 
374     @Test(expectedExceptions=NullPointerException.class)
375     public void nullArrayDisallowed() {
376         Map.ofEntries((Map.Entry&lt;?,?&gt;[])null);
377     }
378 
379     @Test(dataProvider=&quot;all&quot;, expectedExceptions=NullPointerException.class)
380     public void containsValueNullShouldThrowNPE(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
381         act.containsValue(null);
382     }
383 
384     @Test(dataProvider=&quot;all&quot;, expectedExceptions=NullPointerException.class)
385     public void containsKeyNullShouldThrowNPE(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
386         act.containsKey(null);
387     }
388 
389     @Test(dataProvider=&quot;all&quot;, expectedExceptions=NullPointerException.class)
390     public void getNullShouldThrowNPE(Map&lt;Integer,String&gt; act, Map&lt;Integer,String&gt; exp) {
391         act.get(null);
392     }
393 
394     @Test(dataProvider=&quot;all&quot;)
395     public void serialEquality(Map&lt;Integer, String&gt; act, Map&lt;Integer, String&gt; exp) {
396         // assume that act.equals(exp) tested elsewhere
397         Map&lt;Integer, String&gt; copy = serialClone(act);
398         assertEquals(act, copy);
399         assertEquals(copy, exp);
400     }
401 
402     @SuppressWarnings(&quot;unchecked&quot;)
403     static &lt;T&gt; T serialClone(T obj) {
404         try {
405             ByteArrayOutputStream baos = new ByteArrayOutputStream();
406             try (ObjectOutputStream oos = new ObjectOutputStream(baos)) {
407                 oos.writeObject(obj);
408             }
409             ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());
410             ObjectInputStream ois = new ObjectInputStream(bais);
411             return (T) ois.readObject();
412         } catch (IOException | ClassNotFoundException e) {
413             throw new AssertionError(e);
414         }
415     }
416 
417     Map&lt;Integer, String&gt; genMap() {
418         Map&lt;Integer, String&gt; map = new HashMap&lt;&gt;();
419         map.put(1, &quot;a&quot;);
420         map.put(2, &quot;b&quot;);
421         map.put(3, &quot;c&quot;);
422         return map;
423     }
424 
425     @Test
426     public void copyOfResultsEqual() {
427         Map&lt;Integer, String&gt; orig = genMap();
428         Map&lt;Integer, String&gt; copy = Map.copyOf(orig);
429 
430         assertEquals(orig, copy);
431         assertEquals(copy, orig);
432     }
433 
434     @Test
435     public void copyOfModifiedUnequal() {
436         Map&lt;Integer, String&gt; orig = genMap();
437         Map&lt;Integer, String&gt; copy = Map.copyOf(orig);
438         orig.put(4, &quot;d&quot;);
439 
440         assertNotEquals(orig, copy);
441         assertNotEquals(copy, orig);
442     }
443 
444     @Test
445     public void copyOfIdentity() {
446         Map&lt;Integer, String&gt; orig = genMap();
447         Map&lt;Integer, String&gt; copy1 = Map.copyOf(orig);
448         Map&lt;Integer, String&gt; copy2 = Map.copyOf(copy1);
449 
450         assertNotSame(orig, copy1);
451         assertSame(copy1, copy2);
452     }
453 
454     @Test(expectedExceptions=NullPointerException.class)
455     public void copyOfRejectsNullMap() {
456         Map&lt;Integer, String&gt; map = Map.copyOf(null);
457     }
458 
459     @Test(expectedExceptions=NullPointerException.class)
460     public void copyOfRejectsNullKey() {
461         Map&lt;Integer, String&gt; map = genMap();
462         map.put(null, &quot;x&quot;);
463         Map&lt;Integer, String&gt; copy = Map.copyOf(map);
464     }
465 
466     @Test(expectedExceptions=NullPointerException.class)
467     public void copyOfRejectsNullValue() {
468         Map&lt;Integer, String&gt; map = genMap();
469         map.put(-1, null);
470         Map&lt;Integer, String&gt; copy = Map.copyOf(map);
471     }
472 
473     // Map.entry() tests
474 
475     @Test(expectedExceptions=NullPointerException.class)
476     public void entryWithNullKeyDisallowed() {
477         Map.Entry&lt;Integer,String&gt; e = Map.entry(null, &quot;x&quot;);
478     }
479 
480     @Test(expectedExceptions=NullPointerException.class)
481     public void entryWithNullValueDisallowed() {
482         Map.Entry&lt;Integer,String&gt; e = Map.entry(0, null);
483     }
484 
485     @Test
486     public void entryBasicTests() {
487         Map.Entry&lt;String,String&gt; kvh1 = Map.entry(&quot;xyzzy&quot;, &quot;plugh&quot;);
488         Map.Entry&lt;String,String&gt; kvh2 = Map.entry(&quot;foobar&quot;, &quot;blurfl&quot;);
489         Map.Entry&lt;String,String&gt; sie = new AbstractMap.SimpleImmutableEntry&lt;&gt;(&quot;xyzzy&quot;, &quot;plugh&quot;);
490 
491         assertTrue(kvh1.equals(sie));
492         assertTrue(sie.equals(kvh1));
493         assertFalse(kvh2.equals(sie));
494         assertFalse(sie.equals(kvh2));
495         assertEquals(sie.hashCode(), kvh1.hashCode());
496         assertEquals(sie.toString(), kvh1.toString());
497     }
498 
499     // compile-time test of wildcards
500     @Test
501     public void entryWildcardTests() {
502         Map.Entry&lt;Integer,Double&gt; e1 = Map.entry(1, 2.0);
503         Map.Entry&lt;Float,Long&gt; e2 = Map.entry(3.0f, 4L);
504         Map&lt;Number,Number&gt; map = Map.ofEntries(e1, e2);
505         assertEquals(map.size(), 2);
506     }
507 }
    </pre>
  </body>
</html>