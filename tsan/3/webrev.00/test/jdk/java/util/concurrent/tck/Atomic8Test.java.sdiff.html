<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/concurrent/tck/Atomic8Test.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="ArrayBlockingQueueTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="AtomicIntegerArray9Test.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/concurrent/tck/Atomic8Test.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
501     }
502 
503     /**
504      * AtomicReferenceFieldUpdater accumulateAndGet updates with
505      * supplied function and returns result.
506      */
507     public void testReferenceFieldUpdaterAccumulateAndGet() {
508         AtomicReferenceFieldUpdater&lt;Atomic8Test,Integer&gt; a = anIntegerFieldUpdater();
509         a.set(this, one);
510         assertEquals((Integer) 7, a.accumulateAndGet(this, 6, Atomic8Test::sumInteger));
511         assertEquals((Integer) 10, a.accumulateAndGet(this, 3, Atomic8Test::sumInteger));
512         assertEquals((Integer) 10, a.get(this));
513         assertEquals((Integer) 10, anIntegerField);
514     }
515 
516     /**
517      * All Atomic getAndUpdate methods throw NullPointerException on
518      * null function argument
519      */
520     public void testGetAndUpdateNPE() {
<span class="line-modified">521         Runnable[] throwingActions = {</span>

522             () -&gt; new AtomicLong().getAndUpdate(null),
523             () -&gt; new AtomicInteger().getAndUpdate(null),
524             () -&gt; new AtomicReference().getAndUpdate(null),
525             () -&gt; new AtomicLongArray(1).getAndUpdate(0, null),
526             () -&gt; new AtomicIntegerArray(1).getAndUpdate(0, null),
527             () -&gt; new AtomicReferenceArray(1).getAndUpdate(0, null),
528             () -&gt; aLongFieldUpdater().getAndUpdate(this, null),
529             () -&gt; anIntFieldUpdater().getAndUpdate(this, null),
<span class="line-modified">530             () -&gt; anIntegerFieldUpdater().getAndUpdate(this, null),</span>
<span class="line-removed">531         };</span>
<span class="line-removed">532         assertThrows(NullPointerException.class, throwingActions);</span>
533     }
534 
535     /**
536      * All Atomic updateAndGet methods throw NullPointerException on null function argument
537      */
538     public void testUpdateAndGetNPE() {
<span class="line-modified">539         Runnable[] throwingActions = {</span>

540             () -&gt; new AtomicLong().updateAndGet(null),
541             () -&gt; new AtomicInteger().updateAndGet(null),
542             () -&gt; new AtomicReference().updateAndGet(null),
543             () -&gt; new AtomicLongArray(1).updateAndGet(0, null),
544             () -&gt; new AtomicIntegerArray(1).updateAndGet(0, null),
545             () -&gt; new AtomicReferenceArray(1).updateAndGet(0, null),
546             () -&gt; aLongFieldUpdater().updateAndGet(this, null),
547             () -&gt; anIntFieldUpdater().updateAndGet(this, null),
<span class="line-modified">548             () -&gt; anIntegerFieldUpdater().updateAndGet(this, null),</span>
<span class="line-removed">549         };</span>
<span class="line-removed">550         assertThrows(NullPointerException.class, throwingActions);</span>
551     }
552 
553     /**
554      * All Atomic getAndAccumulate methods throw NullPointerException
555      * on null function argument
556      */
557     public void testGetAndAccumulateNPE() {
<span class="line-modified">558         Runnable[] throwingActions = {</span>

559             () -&gt; new AtomicLong().getAndAccumulate(1L, null),
560             () -&gt; new AtomicInteger().getAndAccumulate(1, null),
561             () -&gt; new AtomicReference().getAndAccumulate(one, null),
562             () -&gt; new AtomicLongArray(1).getAndAccumulate(0, 1L, null),
563             () -&gt; new AtomicIntegerArray(1).getAndAccumulate(0, 1, null),
564             () -&gt; new AtomicReferenceArray(1).getAndAccumulate(0, one, null),
565             () -&gt; aLongFieldUpdater().getAndAccumulate(this, 1L, null),
566             () -&gt; anIntFieldUpdater().getAndAccumulate(this, 1, null),
<span class="line-modified">567             () -&gt; anIntegerFieldUpdater().getAndAccumulate(this, one, null),</span>
<span class="line-removed">568         };</span>
<span class="line-removed">569         assertThrows(NullPointerException.class, throwingActions);</span>
570     }
571 
572     /**
573      * All Atomic accumulateAndGet methods throw NullPointerException
574      * on null function argument
575      */
576     public void testAccumulateAndGetNPE() {
<span class="line-modified">577         Runnable[] throwingActions = {</span>

578             () -&gt; new AtomicLong().accumulateAndGet(1L, null),
579             () -&gt; new AtomicInteger().accumulateAndGet(1, null),
580             () -&gt; new AtomicReference().accumulateAndGet(one, null),
581             () -&gt; new AtomicLongArray(1).accumulateAndGet(0, 1L, null),
582             () -&gt; new AtomicIntegerArray(1).accumulateAndGet(0, 1, null),
583             () -&gt; new AtomicReferenceArray(1).accumulateAndGet(0, one, null),
584             () -&gt; aLongFieldUpdater().accumulateAndGet(this, 1L, null),
585             () -&gt; anIntFieldUpdater().accumulateAndGet(this, 1, null),
<span class="line-modified">586             () -&gt; anIntegerFieldUpdater().accumulateAndGet(this, one, null),</span>
<span class="line-removed">587         };</span>
<span class="line-removed">588         assertThrows(NullPointerException.class, throwingActions);</span>
589     }
590 
591     /**
592      * Object arguments for parameters of type T that are not
593      * instances of the class passed to the newUpdater call will
594      * result in a ClassCastException being thrown.
595      */
596     public void testFieldUpdaters_ClassCastException() {
597         // Use raw types to allow passing wrong object type, provoking CCE
598         final AtomicLongFieldUpdater longUpdater = aLongFieldUpdater();
599         final AtomicIntegerFieldUpdater intUpdater = anIntFieldUpdater();
600         final AtomicReferenceFieldUpdater refUpdater = anIntegerFieldUpdater();
<span class="line-removed">601         final Object obj = new Object();</span>
602         for (Object x : new Object[]{ new Object(), null }) {
<span class="line-modified">603             Runnable[] throwingActions = {</span>

604                 () -&gt; longUpdater.get(x),
605                 () -&gt; intUpdater.get(x),
606                 () -&gt; refUpdater.get(x),
607 
608                 () -&gt; longUpdater.set(x, 17L),
609                 () -&gt; intUpdater.set(x, 17),
610                 () -&gt; refUpdater.set(x, (Integer) 17),
611 
612                 () -&gt; longUpdater.addAndGet(x, 17L),
613                 () -&gt; intUpdater.addAndGet(x, 17),
614 
615                 () -&gt; longUpdater.getAndUpdate(x, y -&gt; y),
616                 () -&gt; intUpdater.getAndUpdate(x, y -&gt; y),
617                 () -&gt; refUpdater.getAndUpdate(x, y -&gt; y),
618 
619                 () -&gt; longUpdater.compareAndSet(x, 17L, 42L),
620                 () -&gt; intUpdater.compareAndSet(x, 17, 42),
<span class="line-modified">621                 () -&gt; refUpdater.compareAndSet(x, (Integer) 17, (Integer) 42),</span>
<span class="line-removed">622             };</span>
<span class="line-removed">623             assertThrows(ClassCastException.class, throwingActions);</span>
624         }
625     }
626 
627 }
</pre>
</td>
<td>
<hr />
<pre>
501     }
502 
503     /**
504      * AtomicReferenceFieldUpdater accumulateAndGet updates with
505      * supplied function and returns result.
506      */
507     public void testReferenceFieldUpdaterAccumulateAndGet() {
508         AtomicReferenceFieldUpdater&lt;Atomic8Test,Integer&gt; a = anIntegerFieldUpdater();
509         a.set(this, one);
510         assertEquals((Integer) 7, a.accumulateAndGet(this, 6, Atomic8Test::sumInteger));
511         assertEquals((Integer) 10, a.accumulateAndGet(this, 3, Atomic8Test::sumInteger));
512         assertEquals((Integer) 10, a.get(this));
513         assertEquals((Integer) 10, anIntegerField);
514     }
515 
516     /**
517      * All Atomic getAndUpdate methods throw NullPointerException on
518      * null function argument
519      */
520     public void testGetAndUpdateNPE() {
<span class="line-modified">521         assertThrows(</span>
<span class="line-added">522             NullPointerException.class,</span>
523             () -&gt; new AtomicLong().getAndUpdate(null),
524             () -&gt; new AtomicInteger().getAndUpdate(null),
525             () -&gt; new AtomicReference().getAndUpdate(null),
526             () -&gt; new AtomicLongArray(1).getAndUpdate(0, null),
527             () -&gt; new AtomicIntegerArray(1).getAndUpdate(0, null),
528             () -&gt; new AtomicReferenceArray(1).getAndUpdate(0, null),
529             () -&gt; aLongFieldUpdater().getAndUpdate(this, null),
530             () -&gt; anIntFieldUpdater().getAndUpdate(this, null),
<span class="line-modified">531             () -&gt; anIntegerFieldUpdater().getAndUpdate(this, null));</span>


532     }
533 
534     /**
535      * All Atomic updateAndGet methods throw NullPointerException on null function argument
536      */
537     public void testUpdateAndGetNPE() {
<span class="line-modified">538         assertThrows(</span>
<span class="line-added">539             NullPointerException.class,</span>
540             () -&gt; new AtomicLong().updateAndGet(null),
541             () -&gt; new AtomicInteger().updateAndGet(null),
542             () -&gt; new AtomicReference().updateAndGet(null),
543             () -&gt; new AtomicLongArray(1).updateAndGet(0, null),
544             () -&gt; new AtomicIntegerArray(1).updateAndGet(0, null),
545             () -&gt; new AtomicReferenceArray(1).updateAndGet(0, null),
546             () -&gt; aLongFieldUpdater().updateAndGet(this, null),
547             () -&gt; anIntFieldUpdater().updateAndGet(this, null),
<span class="line-modified">548             () -&gt; anIntegerFieldUpdater().updateAndGet(this, null));</span>


549     }
550 
551     /**
552      * All Atomic getAndAccumulate methods throw NullPointerException
553      * on null function argument
554      */
555     public void testGetAndAccumulateNPE() {
<span class="line-modified">556         assertThrows(</span>
<span class="line-added">557             NullPointerException.class,</span>
558             () -&gt; new AtomicLong().getAndAccumulate(1L, null),
559             () -&gt; new AtomicInteger().getAndAccumulate(1, null),
560             () -&gt; new AtomicReference().getAndAccumulate(one, null),
561             () -&gt; new AtomicLongArray(1).getAndAccumulate(0, 1L, null),
562             () -&gt; new AtomicIntegerArray(1).getAndAccumulate(0, 1, null),
563             () -&gt; new AtomicReferenceArray(1).getAndAccumulate(0, one, null),
564             () -&gt; aLongFieldUpdater().getAndAccumulate(this, 1L, null),
565             () -&gt; anIntFieldUpdater().getAndAccumulate(this, 1, null),
<span class="line-modified">566             () -&gt; anIntegerFieldUpdater().getAndAccumulate(this, one, null));</span>


567     }
568 
569     /**
570      * All Atomic accumulateAndGet methods throw NullPointerException
571      * on null function argument
572      */
573     public void testAccumulateAndGetNPE() {
<span class="line-modified">574         assertThrows(</span>
<span class="line-added">575             NullPointerException.class,</span>
576             () -&gt; new AtomicLong().accumulateAndGet(1L, null),
577             () -&gt; new AtomicInteger().accumulateAndGet(1, null),
578             () -&gt; new AtomicReference().accumulateAndGet(one, null),
579             () -&gt; new AtomicLongArray(1).accumulateAndGet(0, 1L, null),
580             () -&gt; new AtomicIntegerArray(1).accumulateAndGet(0, 1, null),
581             () -&gt; new AtomicReferenceArray(1).accumulateAndGet(0, one, null),
582             () -&gt; aLongFieldUpdater().accumulateAndGet(this, 1L, null),
583             () -&gt; anIntFieldUpdater().accumulateAndGet(this, 1, null),
<span class="line-modified">584             () -&gt; anIntegerFieldUpdater().accumulateAndGet(this, one, null));</span>


585     }
586 
587     /**
588      * Object arguments for parameters of type T that are not
589      * instances of the class passed to the newUpdater call will
590      * result in a ClassCastException being thrown.
591      */
592     public void testFieldUpdaters_ClassCastException() {
593         // Use raw types to allow passing wrong object type, provoking CCE
594         final AtomicLongFieldUpdater longUpdater = aLongFieldUpdater();
595         final AtomicIntegerFieldUpdater intUpdater = anIntFieldUpdater();
596         final AtomicReferenceFieldUpdater refUpdater = anIntegerFieldUpdater();

597         for (Object x : new Object[]{ new Object(), null }) {
<span class="line-modified">598             assertThrows(</span>
<span class="line-added">599                 ClassCastException.class,</span>
600                 () -&gt; longUpdater.get(x),
601                 () -&gt; intUpdater.get(x),
602                 () -&gt; refUpdater.get(x),
603 
604                 () -&gt; longUpdater.set(x, 17L),
605                 () -&gt; intUpdater.set(x, 17),
606                 () -&gt; refUpdater.set(x, (Integer) 17),
607 
608                 () -&gt; longUpdater.addAndGet(x, 17L),
609                 () -&gt; intUpdater.addAndGet(x, 17),
610 
611                 () -&gt; longUpdater.getAndUpdate(x, y -&gt; y),
612                 () -&gt; intUpdater.getAndUpdate(x, y -&gt; y),
613                 () -&gt; refUpdater.getAndUpdate(x, y -&gt; y),
614 
615                 () -&gt; longUpdater.compareAndSet(x, 17L, 42L),
616                 () -&gt; intUpdater.compareAndSet(x, 17, 42),
<span class="line-modified">617                 () -&gt; refUpdater.compareAndSet(x, (Integer) 17, (Integer) 42));</span>


618         }
619     }
620 
621 }
</pre>
</td>
</tr>
</table>
<center><a href="ArrayBlockingQueueTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="AtomicIntegerArray9Test.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>