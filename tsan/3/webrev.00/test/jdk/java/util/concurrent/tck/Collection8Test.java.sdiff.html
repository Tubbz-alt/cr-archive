<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/concurrent/tck/Collection8Test.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="BlockingQueueTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="CompletableFutureTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/concurrent/tck/Collection8Test.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 220             Queue q = (Queue) c;
 221             assertThrows(
 222                 NullPointerException.class,
 223                 () -&gt; q.offer(null));
 224         }
 225         if (!impl.permitsNulls() &amp;&amp; c instanceof Deque) {
 226             Deque d = (Deque) c;
 227             assertThrows(
 228                 NullPointerException.class,
 229                 () -&gt; d.addFirst(null),
 230                 () -&gt; d.addLast(null),
 231                 () -&gt; d.offerFirst(null),
 232                 () -&gt; d.offerLast(null),
 233                 () -&gt; d.push(null),
 234                 () -&gt; d.descendingIterator().forEachRemaining(null));
 235         }
 236         if (c instanceof BlockingQueue) {
 237             BlockingQueue q = (BlockingQueue) c;
 238             assertThrows(
 239                 NullPointerException.class,
<span class="line-modified"> 240                 () -&gt; {</span>
<span class="line-modified"> 241                     try { q.offer(null, 1L, HOURS); }</span>
<span class="line-removed"> 242                     catch (InterruptedException ex) {</span>
<span class="line-removed"> 243                         throw new AssertionError(ex);</span>
<span class="line-removed"> 244                     }},</span>
<span class="line-removed"> 245                 () -&gt; {</span>
<span class="line-removed"> 246                     try { q.put(null); }</span>
<span class="line-removed"> 247                     catch (InterruptedException ex) {</span>
<span class="line-removed"> 248                         throw new AssertionError(ex);</span>
<span class="line-removed"> 249                     }});</span>
 250         }
 251         if (c instanceof BlockingDeque) {
 252             BlockingDeque q = (BlockingDeque) c;
 253             assertThrows(
 254                 NullPointerException.class,
<span class="line-modified"> 255                 () -&gt; {</span>
<span class="line-modified"> 256                     try { q.offerFirst(null, 1L, HOURS); }</span>
<span class="line-modified"> 257                     catch (InterruptedException ex) {</span>
<span class="line-modified"> 258                         throw new AssertionError(ex);</span>
<span class="line-removed"> 259                     }},</span>
<span class="line-removed"> 260                 () -&gt; {</span>
<span class="line-removed"> 261                     try { q.offerLast(null, 1L, HOURS); }</span>
<span class="line-removed"> 262                     catch (InterruptedException ex) {</span>
<span class="line-removed"> 263                         throw new AssertionError(ex);</span>
<span class="line-removed"> 264                     }},</span>
<span class="line-removed"> 265                 () -&gt; {</span>
<span class="line-removed"> 266                     try { q.putFirst(null); }</span>
<span class="line-removed"> 267                     catch (InterruptedException ex) {</span>
<span class="line-removed"> 268                         throw new AssertionError(ex);</span>
<span class="line-removed"> 269                     }},</span>
<span class="line-removed"> 270                 () -&gt; {</span>
<span class="line-removed"> 271                     try { q.putLast(null); }</span>
<span class="line-removed"> 272                     catch (InterruptedException ex) {</span>
<span class="line-removed"> 273                         throw new AssertionError(ex);</span>
<span class="line-removed"> 274                     }});</span>
 275         }
 276     }
 277 
 278     public void testNoSuchElementExceptions() {
 279         Collection c = impl.emptyCollection();
 280         assertThrows(
 281             NoSuchElementException.class,
 282             () -&gt; c.iterator().next());
 283 
 284         if (c instanceof Queue) {
 285             Queue q = (Queue) c;
 286             assertThrows(
 287                 NoSuchElementException.class,
 288                 () -&gt; q.element(),
 289                 () -&gt; q.remove());
 290         }
 291         if (c instanceof Deque) {
 292             Deque d = (Deque) c;
 293             assertThrows(
 294                 NoSuchElementException.class,
</pre>
<hr />
<pre>
 962         assertEquals(c, c);
 963         if (c instanceof List)
 964             assertCollectionsEquals(c, new ArrayList(c));
 965         else if (c instanceof Set)
 966             assertCollectionsEquals(c, new HashSet(c));
 967         else if (c instanceof Deque)
 968             assertCollectionsEquivalent(c, new ArrayDeque(c));
 969 
 970         Collection clone = cloneableClone(c);
 971         if (clone != null) {
 972             assertSame(c.getClass(), clone.getClass());
 973             assertCollectionsEquivalent(c, clone);
 974         }
 975         try {
 976             Collection serialClone = serialClonePossiblyFailing(c);
 977             assertSame(c.getClass(), serialClone.getClass());
 978             assertCollectionsEquivalent(c, serialClone);
 979         } catch (java.io.NotSerializableException acceptable) {}
 980     }
 981 




 982     public void DISABLED_testReplaceAllIsNotStructuralModification() {
 983         Collection c = impl.emptyCollection();
 984         if (!(c instanceof List))
 985             return;
 986         List list = (List) c;
 987         ThreadLocalRandom rnd = ThreadLocalRandom.current();
 988         for (int n = rnd.nextInt(2, 10); n--&gt; 0; )
 989             list.add(impl.makeElement(rnd.nextInt()));
 990         ArrayList copy = new ArrayList(list);
 991         int size = list.size(), half = size / 2;
 992         Iterator it = list.iterator();
 993         for (int i = 0; i &lt; half; i++)
 994             assertEquals(it.next(), copy.get(i));
 995         list.replaceAll(n -&gt; n);
 996         // ConcurrentModificationException must not be thrown here.
 997         for (int i = half; i &lt; size; i++)
 998             assertEquals(it.next(), copy.get(i));
 999     }
1000 
1001 //     public void testCollection8DebugFail() {
</pre>
</td>
<td>
<hr />
<pre>
 220             Queue q = (Queue) c;
 221             assertThrows(
 222                 NullPointerException.class,
 223                 () -&gt; q.offer(null));
 224         }
 225         if (!impl.permitsNulls() &amp;&amp; c instanceof Deque) {
 226             Deque d = (Deque) c;
 227             assertThrows(
 228                 NullPointerException.class,
 229                 () -&gt; d.addFirst(null),
 230                 () -&gt; d.addLast(null),
 231                 () -&gt; d.offerFirst(null),
 232                 () -&gt; d.offerLast(null),
 233                 () -&gt; d.push(null),
 234                 () -&gt; d.descendingIterator().forEachRemaining(null));
 235         }
 236         if (c instanceof BlockingQueue) {
 237             BlockingQueue q = (BlockingQueue) c;
 238             assertThrows(
 239                 NullPointerException.class,
<span class="line-modified"> 240                 () -&gt; q.offer(null, 1L, HOURS),</span>
<span class="line-modified"> 241                 () -&gt; q.put(null));</span>








 242         }
 243         if (c instanceof BlockingDeque) {
 244             BlockingDeque q = (BlockingDeque) c;
 245             assertThrows(
 246                 NullPointerException.class,
<span class="line-modified"> 247                 () -&gt; q.offerFirst(null, 1L, HOURS),</span>
<span class="line-modified"> 248                 () -&gt; q.offerLast(null, 1L, HOURS),</span>
<span class="line-modified"> 249                 () -&gt; q.putFirst(null),</span>
<span class="line-modified"> 250                 () -&gt; q.putLast(null));</span>
















 251         }
 252     }
 253 
 254     public void testNoSuchElementExceptions() {
 255         Collection c = impl.emptyCollection();
 256         assertThrows(
 257             NoSuchElementException.class,
 258             () -&gt; c.iterator().next());
 259 
 260         if (c instanceof Queue) {
 261             Queue q = (Queue) c;
 262             assertThrows(
 263                 NoSuchElementException.class,
 264                 () -&gt; q.element(),
 265                 () -&gt; q.remove());
 266         }
 267         if (c instanceof Deque) {
 268             Deque d = (Deque) c;
 269             assertThrows(
 270                 NoSuchElementException.class,
</pre>
<hr />
<pre>
 938         assertEquals(c, c);
 939         if (c instanceof List)
 940             assertCollectionsEquals(c, new ArrayList(c));
 941         else if (c instanceof Set)
 942             assertCollectionsEquals(c, new HashSet(c));
 943         else if (c instanceof Deque)
 944             assertCollectionsEquivalent(c, new ArrayDeque(c));
 945 
 946         Collection clone = cloneableClone(c);
 947         if (clone != null) {
 948             assertSame(c.getClass(), clone.getClass());
 949             assertCollectionsEquivalent(c, clone);
 950         }
 951         try {
 952             Collection serialClone = serialClonePossiblyFailing(c);
 953             assertSame(c.getClass(), serialClone.getClass());
 954             assertCollectionsEquivalent(c, serialClone);
 955         } catch (java.io.NotSerializableException acceptable) {}
 956     }
 957 
<span class="line-added"> 958     /**</span>
<span class="line-added"> 959      * TODO: move out of limbo</span>
<span class="line-added"> 960      * 8203662: remove increment of modCount from ArrayList and Vector replaceAll()</span>
<span class="line-added"> 961      */</span>
 962     public void DISABLED_testReplaceAllIsNotStructuralModification() {
 963         Collection c = impl.emptyCollection();
 964         if (!(c instanceof List))
 965             return;
 966         List list = (List) c;
 967         ThreadLocalRandom rnd = ThreadLocalRandom.current();
 968         for (int n = rnd.nextInt(2, 10); n--&gt; 0; )
 969             list.add(impl.makeElement(rnd.nextInt()));
 970         ArrayList copy = new ArrayList(list);
 971         int size = list.size(), half = size / 2;
 972         Iterator it = list.iterator();
 973         for (int i = 0; i &lt; half; i++)
 974             assertEquals(it.next(), copy.get(i));
 975         list.replaceAll(n -&gt; n);
 976         // ConcurrentModificationException must not be thrown here.
 977         for (int i = half; i &lt; size; i++)
 978             assertEquals(it.next(), copy.get(i));
 979     }
 980 
 981 //     public void testCollection8DebugFail() {
</pre>
</td>
</tr>
</table>
<center><a href="BlockingQueueTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="CompletableFutureTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>