<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/java/util/concurrent/tck/TimeUnitTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="ThreadPoolExecutorTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TreeMapTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/concurrent/tck/TimeUnitTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 54,247 ***</span>
  
      public static Test suite() {
          return new TestSuite(TimeUnitTest.class);
      }
  
<span class="line-modified">!     // (loops to 88888 check increments at all time divisions.)</span>
<span class="line-modified">! </span>
<span class="line-modified">!     /**</span>
<span class="line-modified">!      * convert correctly converts sample values across the units</span>
<span class="line-modified">!      */</span>
<span class="line-modified">!     public void testConvert() {</span>
<span class="line-modified">!         for (long t = 0; t &lt; 88888; ++t) {</span>
<span class="line-modified">!             assertEquals(t*60*60*24,</span>
<span class="line-modified">!                          SECONDS.convert(t, DAYS));</span>
<span class="line-modified">!             assertEquals(t*60*60,</span>
<span class="line-modified">!                          SECONDS.convert(t, HOURS));</span>
<span class="line-removed">-             assertEquals(t*60,</span>
<span class="line-removed">-                          SECONDS.convert(t, MINUTES));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          SECONDS.convert(t, SECONDS));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          SECONDS.convert(1000L*t, MILLISECONDS));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          SECONDS.convert(1000000L*t, MICROSECONDS));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          SECONDS.convert(1000000000L*t, NANOSECONDS));</span>
<span class="line-removed">- </span>
<span class="line-removed">-             assertEquals(1000L*t*60*60*24,</span>
<span class="line-removed">-                          MILLISECONDS.convert(t, DAYS));</span>
<span class="line-removed">-             assertEquals(1000L*t*60*60,</span>
<span class="line-removed">-                          MILLISECONDS.convert(t, HOURS));</span>
<span class="line-removed">-             assertEquals(1000L*t*60,</span>
<span class="line-removed">-                          MILLISECONDS.convert(t, MINUTES));</span>
<span class="line-removed">-             assertEquals(1000L*t,</span>
<span class="line-removed">-                          MILLISECONDS.convert(t, SECONDS));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MILLISECONDS.convert(t, MILLISECONDS));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MILLISECONDS.convert(1000L*t, MICROSECONDS));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MILLISECONDS.convert(1000000L*t, NANOSECONDS));</span>
<span class="line-removed">- </span>
<span class="line-removed">-             assertEquals(1000000L*t*60*60*24,</span>
<span class="line-removed">-                          MICROSECONDS.convert(t, DAYS));</span>
<span class="line-removed">-             assertEquals(1000000L*t*60*60,</span>
<span class="line-removed">-                          MICROSECONDS.convert(t, HOURS));</span>
<span class="line-removed">-             assertEquals(1000000L*t*60,</span>
<span class="line-removed">-                          MICROSECONDS.convert(t, MINUTES));</span>
<span class="line-removed">-             assertEquals(1000000L*t,</span>
<span class="line-removed">-                          MICROSECONDS.convert(t, SECONDS));</span>
<span class="line-removed">-             assertEquals(1000L*t,</span>
<span class="line-removed">-                          MICROSECONDS.convert(t, MILLISECONDS));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MICROSECONDS.convert(t, MICROSECONDS));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MICROSECONDS.convert(1000L*t, NANOSECONDS));</span>
<span class="line-removed">- </span>
<span class="line-removed">-             assertEquals(1000000000L*t*60*60*24,</span>
<span class="line-removed">-                          NANOSECONDS.convert(t, DAYS));</span>
<span class="line-removed">-             assertEquals(1000000000L*t*60*60,</span>
<span class="line-removed">-                          NANOSECONDS.convert(t, HOURS));</span>
<span class="line-removed">-             assertEquals(1000000000L*t*60,</span>
<span class="line-removed">-                          NANOSECONDS.convert(t, MINUTES));</span>
<span class="line-removed">-             assertEquals(1000000000L*t,</span>
<span class="line-removed">-                          NANOSECONDS.convert(t, SECONDS));</span>
<span class="line-removed">-             assertEquals(1000000L*t,</span>
<span class="line-removed">-                          NANOSECONDS.convert(t, MILLISECONDS));</span>
<span class="line-removed">-             assertEquals(1000L*t,</span>
<span class="line-removed">-                          NANOSECONDS.convert(t, MICROSECONDS));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          NANOSECONDS.convert(t, NANOSECONDS));</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         for (TimeUnit x : TimeUnit.values()) {</span>
<span class="line-removed">-             long[] zs = {</span>
<span class="line-removed">-                 0, 1, -1,</span>
<span class="line-removed">-                 Integer.MAX_VALUE, Integer.MIN_VALUE,</span>
<span class="line-removed">-                 Long.MAX_VALUE, Long.MIN_VALUE,</span>
<span class="line-removed">-             };</span>
<span class="line-removed">-             for (long z : zs) assertEquals(z, x.convert(z, x));</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * toNanos correctly converts sample values in different units to</span>
<span class="line-removed">-      * nanoseconds</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public void testToNanos() {</span>
<span class="line-removed">-         for (long t = 0; t &lt; 88888; ++t) {</span>
<span class="line-removed">-             assertEquals(t*1000000000L*60*60*24,</span>
<span class="line-removed">-                          DAYS.toNanos(t));</span>
<span class="line-removed">-             assertEquals(t*1000000000L*60*60,</span>
<span class="line-removed">-                          HOURS.toNanos(t));</span>
<span class="line-removed">-             assertEquals(t*1000000000L*60,</span>
<span class="line-removed">-                          MINUTES.toNanos(t));</span>
<span class="line-removed">-             assertEquals(1000000000L*t,</span>
<span class="line-removed">-                          SECONDS.toNanos(t));</span>
<span class="line-removed">-             assertEquals(1000000L*t,</span>
<span class="line-removed">-                          MILLISECONDS.toNanos(t));</span>
<span class="line-removed">-             assertEquals(1000L*t,</span>
<span class="line-removed">-                          MICROSECONDS.toNanos(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          NANOSECONDS.toNanos(t));</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * toMicros correctly converts sample values in different units to</span>
<span class="line-removed">-      * microseconds</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public void testToMicros() {</span>
<span class="line-removed">-         for (long t = 0; t &lt; 88888; ++t) {</span>
<span class="line-removed">-             assertEquals(t*1000000L*60*60*24,</span>
<span class="line-removed">-                          DAYS.toMicros(t));</span>
<span class="line-removed">-             assertEquals(t*1000000L*60*60,</span>
<span class="line-removed">-                          HOURS.toMicros(t));</span>
<span class="line-removed">-             assertEquals(t*1000000L*60,</span>
<span class="line-removed">-                          MINUTES.toMicros(t));</span>
<span class="line-removed">-             assertEquals(1000000L*t,</span>
<span class="line-removed">-                          SECONDS.toMicros(t));</span>
<span class="line-removed">-             assertEquals(1000L*t,</span>
<span class="line-removed">-                          MILLISECONDS.toMicros(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MICROSECONDS.toMicros(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          NANOSECONDS.toMicros(t*1000L));</span>
          }
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * toMillis correctly converts sample values in different units to</span>
<span class="line-removed">-      * milliseconds</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public void testToMillis() {</span>
<span class="line-removed">-         for (long t = 0; t &lt; 88888; ++t) {</span>
<span class="line-removed">-             assertEquals(t*1000L*60*60*24,</span>
<span class="line-removed">-                          DAYS.toMillis(t));</span>
<span class="line-removed">-             assertEquals(t*1000L*60*60,</span>
<span class="line-removed">-                          HOURS.toMillis(t));</span>
<span class="line-removed">-             assertEquals(t*1000L*60,</span>
<span class="line-removed">-                          MINUTES.toMillis(t));</span>
<span class="line-removed">-             assertEquals(1000L*t,</span>
<span class="line-removed">-                          SECONDS.toMillis(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MILLISECONDS.toMillis(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MICROSECONDS.toMillis(t*1000L));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          NANOSECONDS.toMillis(t*1000000L));</span>
<span class="line-removed">-         }</span>
      }
  
<span class="line-modified">!     /**</span>
<span class="line-modified">!      * toSeconds correctly converts sample values in different units to</span>
<span class="line-modified">!      * seconds</span>
<span class="line-modified">!      */</span>
<span class="line-modified">!     public void testToSeconds() {</span>
<span class="line-modified">!         for (long t = 0; t &lt; 88888; ++t) {</span>
<span class="line-modified">!             assertEquals(t*60*60*24,</span>
<span class="line-modified">!                          DAYS.toSeconds(t));</span>
<span class="line-modified">!             assertEquals(t*60*60,</span>
<span class="line-modified">!                          HOURS.toSeconds(t));</span>
<span class="line-removed">-             assertEquals(t*60,</span>
<span class="line-removed">-                          MINUTES.toSeconds(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          SECONDS.toSeconds(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MILLISECONDS.toSeconds(t*1000L));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MICROSECONDS.toSeconds(t*1000000L));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          NANOSECONDS.toSeconds(t*1000000000L));</span>
          }
      }
  
      /**
<span class="line-modified">!      * toMinutes correctly converts sample values in different units to</span>
<span class="line-removed">-      * minutes</span>
       */
<span class="line-modified">!     public void testToMinutes() {</span>
<span class="line-modified">!         for (long t = 0; t &lt; 88888; ++t) {</span>
<span class="line-modified">!             assertEquals(t*60*24,</span>
<span class="line-modified">!                          DAYS.toMinutes(t));</span>
<span class="line-modified">!             assertEquals(t*60,</span>
<span class="line-modified">!                          HOURS.toMinutes(t));</span>
<span class="line-modified">!             assertEquals(t,</span>
<span class="line-modified">!                          MINUTES.toMinutes(t));</span>
<span class="line-modified">!             assertEquals(t,</span>
<span class="line-removed">-                          SECONDS.toMinutes(t*60));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MILLISECONDS.toMinutes(t*1000L*60));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MICROSECONDS.toMinutes(t*1000000L*60));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          NANOSECONDS.toMinutes(t*1000000000L*60));</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     /**</span>
<span class="line-modified">!      * toHours correctly converts sample values in different units to</span>
<span class="line-removed">-      * hours</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public void testToHours() {</span>
<span class="line-removed">-         for (long t = 0; t &lt; 88888; ++t) {</span>
<span class="line-removed">-             assertEquals(t*24,</span>
<span class="line-removed">-                          DAYS.toHours(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          HOURS.toHours(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MINUTES.toHours(t*60));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          SECONDS.toHours(t*60*60));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MILLISECONDS.toHours(t*1000L*60*60));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MICROSECONDS.toHours(t*1000000L*60*60));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          NANOSECONDS.toHours(t*1000000000L*60*60));</span>
          }
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     /**</span>
<span class="line-modified">!      * toDays correctly converts sample values in different units to</span>
<span class="line-modified">!      * days</span>
<span class="line-modified">!      */</span>
<span class="line-removed">-     public void testToDays() {</span>
<span class="line-removed">-         for (long t = 0; t &lt; 88888; ++t) {</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          DAYS.toDays(t));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          HOURS.toDays(t*24));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MINUTES.toDays(t*60*24));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          SECONDS.toDays(t*60*60*24));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MILLISECONDS.toDays(t*1000L*60*60*24));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          MICROSECONDS.toDays(t*1000000L*60*60*24));</span>
<span class="line-removed">-             assertEquals(t,</span>
<span class="line-removed">-                          NANOSECONDS.toDays(t*1000000000L*60*60*24));</span>
<span class="line-removed">-         }</span>
      }
  
      /**
       * convert saturates positive too-large values to Long.MAX_VALUE
       * and negative to LONG.MIN_VALUE
<span class="line-new-header">--- 54,60 ---</span>
  
      public static Test suite() {
          return new TestSuite(TimeUnitTest.class);
      }
  
<span class="line-modified">!     void testConversion(TimeUnit x, TimeUnit y, long n, long expected) {</span>
<span class="line-modified">!         assertEquals(expected, x.convert(n, y));</span>
<span class="line-modified">!         switch (x) {</span>
<span class="line-modified">!         case NANOSECONDS:  assertEquals(expected, y.toNanos(n));   break;</span>
<span class="line-modified">!         case MICROSECONDS: assertEquals(expected, y.toMicros(n));  break;</span>
<span class="line-modified">!         case MILLISECONDS: assertEquals(expected, y.toMillis(n));  break;</span>
<span class="line-modified">!         case SECONDS:      assertEquals(expected, y.toSeconds(n)); break;</span>
<span class="line-modified">!         case MINUTES:      assertEquals(expected, y.toMinutes(n)); break;</span>
<span class="line-modified">!         case HOURS:        assertEquals(expected, y.toHours(n));   break;</span>
<span class="line-modified">!         case DAYS:         assertEquals(expected, y.toDays(n));    break;</span>
<span class="line-modified">!         default: throw new AssertionError();</span>
          }
  
<span class="line-modified">!         if (n &gt; 0) testConversion(x, y, -n, -expected);</span>
      }
  
<span class="line-modified">!     void testConversion(TimeUnit x, TimeUnit y) {</span>
<span class="line-modified">!         long ratio = x.toNanos(1)/y.toNanos(1);</span>
<span class="line-modified">!         assertTrue(ratio &gt; 0);</span>
<span class="line-modified">!         long[] ns = { 0, 1, 2, Long.MAX_VALUE/ratio, Long.MIN_VALUE/ratio };</span>
<span class="line-modified">!         for (long n : ns) {</span>
<span class="line-modified">!             testConversion(y, x, n, n * ratio);</span>
<span class="line-modified">!             long[] ks = { n * ratio, n * ratio + 1, n * ratio - 1 };</span>
<span class="line-modified">!             for (long k : ks) {</span>
<span class="line-modified">!                 testConversion(x, y, k, k / ratio);</span>
<span class="line-modified">!             }</span>
          }
      }
  
      /**
<span class="line-modified">!      * Conversion methods correctly convert sample values</span>
       */
<span class="line-modified">!     public void testConversions() {</span>
<span class="line-modified">!         // Sanity check</span>
<span class="line-modified">!         assertEquals(1, NANOSECONDS.toNanos(1));</span>
<span class="line-modified">!         assertEquals(1000L * NANOSECONDS.toNanos(1), MICROSECONDS.toNanos(1));</span>
<span class="line-modified">!         assertEquals(1000L * MICROSECONDS.toNanos(1), MILLISECONDS.toNanos(1));</span>
<span class="line-modified">!         assertEquals(1000L * MILLISECONDS.toNanos(1), SECONDS.toNanos(1));</span>
<span class="line-modified">!         assertEquals(60L * SECONDS.toNanos(1), MINUTES.toNanos(1));</span>
<span class="line-modified">!         assertEquals(60L * MINUTES.toNanos(1), HOURS.toNanos(1));</span>
<span class="line-modified">!         assertEquals(24L * HOURS.toNanos(1), DAYS.toNanos(1));</span>
  
<span class="line-modified">!         for (TimeUnit x : TimeUnit.values()) {</span>
<span class="line-modified">!             assertEquals(x.toNanos(1), NANOSECONDS.convert(1, x));</span>
          }
  
<span class="line-modified">!         for (TimeUnit x : TimeUnit.values())</span>
<span class="line-modified">!             for (TimeUnit y : TimeUnit.values())</span>
<span class="line-modified">!                 if (x.toNanos(1) &gt;= y.toNanos(1))</span>
<span class="line-modified">!                     testConversion(x, y);</span>
      }
  
      /**
       * convert saturates positive too-large values to Long.MAX_VALUE
       * and negative to LONG.MIN_VALUE
</pre>
<hr />
<pre>
<span class="line-old-header">*** 492,32 ***</span>
  
      /**
       * toString returns name of unit
       */
      public void testToString() {
          assertEquals(&quot;SECONDS&quot;, SECONDS.toString());
      }
  
      /**
       * name returns name of unit
       */
      public void testName() {
<span class="line-modified">!         assertEquals(&quot;SECONDS&quot;, SECONDS.name());</span>
      }
  
      /**
       * Timed wait without holding lock throws
       * IllegalMonitorStateException
       */
      public void testTimedWait_IllegalMonitorException() {
          Thread t = newStartedThread(new CheckedRunnable() {
              public void realRun() throws InterruptedException {
                  Object o = new Object();
<span class="line-removed">-                 TimeUnit tu = MILLISECONDS;</span>
<span class="line-removed">- </span>
                  try {
<span class="line-modified">!                     tu.timedWait(o, LONG_DELAY_MS);</span>
                      threadShouldThrow();
                  } catch (IllegalMonitorStateException success) {}
              }});
  
          awaitTermination(t);
<span class="line-new-header">--- 305,37 ---</span>
  
      /**
       * toString returns name of unit
       */
      public void testToString() {
<span class="line-added">+         assertEquals(&quot;NANOSECONDS&quot;, NANOSECONDS.toString());</span>
<span class="line-added">+         assertEquals(&quot;MICROSECONDS&quot;, MICROSECONDS.toString());</span>
<span class="line-added">+         assertEquals(&quot;MILLISECONDS&quot;, MILLISECONDS.toString());</span>
          assertEquals(&quot;SECONDS&quot;, SECONDS.toString());
<span class="line-added">+         assertEquals(&quot;MINUTES&quot;, MINUTES.toString());</span>
<span class="line-added">+         assertEquals(&quot;HOURS&quot;, HOURS.toString());</span>
<span class="line-added">+         assertEquals(&quot;DAYS&quot;, DAYS.toString());</span>
      }
  
      /**
       * name returns name of unit
       */
      public void testName() {
<span class="line-modified">!         for (TimeUnit x : TimeUnit.values())</span>
<span class="line-added">+             assertEquals(x.toString(), x.name());</span>
      }
  
      /**
       * Timed wait without holding lock throws
       * IllegalMonitorStateException
       */
      public void testTimedWait_IllegalMonitorException() {
          Thread t = newStartedThread(new CheckedRunnable() {
              public void realRun() throws InterruptedException {
                  Object o = new Object();
                  try {
<span class="line-modified">!                     MILLISECONDS.timedWait(o, LONGER_DELAY_MS);</span>
                      threadShouldThrow();
                  } catch (IllegalMonitorStateException success) {}
              }});
  
          awaitTermination(t);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 529,33 ***</span>
      public void testTimedWait_Interruptible() {
          final CountDownLatch pleaseInterrupt = new CountDownLatch(1);
          Thread t = newStartedThread(new CheckedRunnable() {
              public void realRun() throws InterruptedException {
                  Object o = new Object();
<span class="line-removed">-                 TimeUnit tu = MILLISECONDS;</span>
  
                  Thread.currentThread().interrupt();
                  try {
                      synchronized (o) {
<span class="line-modified">!                         tu.timedWait(o, LONG_DELAY_MS);</span>
                      }
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
  
                  pleaseInterrupt.countDown();
                  try {
                      synchronized (o) {
<span class="line-modified">!                         tu.timedWait(o, LONG_DELAY_MS);</span>
                      }
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
              }});
  
          await(pleaseInterrupt);
<span class="line-modified">!         assertThreadBlocks(t, Thread.State.TIMED_WAITING);</span>
          t.interrupt();
          awaitTermination(t);
      }
  
      /**
<span class="line-new-header">--- 347,32 ---</span>
      public void testTimedWait_Interruptible() {
          final CountDownLatch pleaseInterrupt = new CountDownLatch(1);
          Thread t = newStartedThread(new CheckedRunnable() {
              public void realRun() throws InterruptedException {
                  Object o = new Object();
  
                  Thread.currentThread().interrupt();
                  try {
                      synchronized (o) {
<span class="line-modified">!                         MILLISECONDS.timedWait(o, LONGER_DELAY_MS);</span>
                      }
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
  
                  pleaseInterrupt.countDown();
                  try {
                      synchronized (o) {
<span class="line-modified">!                         MILLISECONDS.timedWait(o, LONGER_DELAY_MS);</span>
                      }
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
              }});
  
          await(pleaseInterrupt);
<span class="line-modified">!         if (randomBoolean()) assertThreadBlocks(t, Thread.State.TIMED_WAITING);</span>
          t.interrupt();
          awaitTermination(t);
      }
  
      /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 563,67 ***</span>
       */
      public void testTimedJoin_Interruptible() {
          final CountDownLatch pleaseInterrupt = new CountDownLatch(1);
          final Thread s = newStartedThread(new CheckedInterruptedRunnable() {
              public void realRun() throws InterruptedException {
<span class="line-modified">!                 Thread.sleep(LONG_DELAY_MS);</span>
              }});
          final Thread t = newStartedThread(new CheckedRunnable() {
              public void realRun() throws InterruptedException {
<span class="line-removed">-                 TimeUnit tu = MILLISECONDS;</span>
                  Thread.currentThread().interrupt();
                  try {
<span class="line-modified">!                     tu.timedJoin(s, LONG_DELAY_MS);</span>
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
  
                  pleaseInterrupt.countDown();
                  try {
<span class="line-modified">!                     tu.timedJoin(s, LONG_DELAY_MS);</span>
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
              }});
  
          await(pleaseInterrupt);
<span class="line-modified">!         assertThreadBlocks(t, Thread.State.TIMED_WAITING);</span>
          t.interrupt();
          awaitTermination(t);
          s.interrupt();
          awaitTermination(s);
      }
  
      /**
<span class="line-modified">!      * timedSleep throws InterruptedException when interrupted</span>
       */
      public void testTimedSleep_Interruptible() {
          final CountDownLatch pleaseInterrupt = new CountDownLatch(1);
          Thread t = newStartedThread(new CheckedRunnable() {
              public void realRun() throws InterruptedException {
<span class="line-removed">-                 TimeUnit tu = MILLISECONDS;</span>
                  Thread.currentThread().interrupt();
                  try {
<span class="line-modified">!                     tu.sleep(LONG_DELAY_MS);</span>
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
  
                  pleaseInterrupt.countDown();
                  try {
<span class="line-modified">!                     tu.sleep(LONG_DELAY_MS);</span>
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
              }});
  
          await(pleaseInterrupt);
<span class="line-modified">!         assertThreadBlocks(t, Thread.State.TIMED_WAITING);</span>
          t.interrupt();
          awaitTermination(t);
      }
  
      /**
       * a deserialized/reserialized unit is the same instance
       */
      public void testSerialization() throws Exception {
          for (TimeUnit x : TimeUnit.values())
<span class="line-new-header">--- 380,77 ---</span>
       */
      public void testTimedJoin_Interruptible() {
          final CountDownLatch pleaseInterrupt = new CountDownLatch(1);
          final Thread s = newStartedThread(new CheckedInterruptedRunnable() {
              public void realRun() throws InterruptedException {
<span class="line-modified">!                 Thread.sleep(LONGER_DELAY_MS);</span>
              }});
          final Thread t = newStartedThread(new CheckedRunnable() {
              public void realRun() throws InterruptedException {
                  Thread.currentThread().interrupt();
                  try {
<span class="line-modified">!                     MILLISECONDS.timedJoin(s, LONGER_DELAY_MS);</span>
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
  
                  pleaseInterrupt.countDown();
                  try {
<span class="line-modified">!                     MILLISECONDS.timedJoin(s, LONGER_DELAY_MS);</span>
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
              }});
  
          await(pleaseInterrupt);
<span class="line-modified">!         if (randomBoolean()) assertThreadBlocks(t, Thread.State.TIMED_WAITING);</span>
          t.interrupt();
          awaitTermination(t);
          s.interrupt();
          awaitTermination(s);
      }
  
      /**
<span class="line-modified">!      * timeUnit.sleep throws InterruptedException when interrupted</span>
       */
      public void testTimedSleep_Interruptible() {
          final CountDownLatch pleaseInterrupt = new CountDownLatch(1);
          Thread t = newStartedThread(new CheckedRunnable() {
              public void realRun() throws InterruptedException {
                  Thread.currentThread().interrupt();
                  try {
<span class="line-modified">!                     MILLISECONDS.sleep(LONGER_DELAY_MS);</span>
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
  
                  pleaseInterrupt.countDown();
                  try {
<span class="line-modified">!                     MILLISECONDS.sleep(LONGER_DELAY_MS);</span>
                      shouldThrow();
                  } catch (InterruptedException success) {}
                  assertFalse(Thread.interrupted());
              }});
  
          await(pleaseInterrupt);
<span class="line-modified">!         if (randomBoolean()) assertThreadBlocks(t, Thread.State.TIMED_WAITING);</span>
          t.interrupt();
          awaitTermination(t);
      }
  
<span class="line-added">+     /**</span>
<span class="line-added">+      * timeUnit.sleep(x) for x &lt;= 0 does not sleep at all.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public void testTimedSleep_nonPositive() throws InterruptedException {</span>
<span class="line-added">+         boolean interrupt = randomBoolean();</span>
<span class="line-added">+         if (interrupt) Thread.currentThread().interrupt();</span>
<span class="line-added">+         randomTimeUnit().sleep(0L);</span>
<span class="line-added">+         randomTimeUnit().sleep(-1L);</span>
<span class="line-added">+         randomTimeUnit().sleep(Long.MIN_VALUE);</span>
<span class="line-added">+         if (interrupt) assertTrue(Thread.interrupted());</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      /**
       * a deserialized/reserialized unit is the same instance
       */
      public void testSerialization() throws Exception {
          for (TimeUnit x : TimeUnit.values())
</pre>
<center><a href="ThreadPoolExecutorTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TreeMapTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>