<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/concurrent/tck/ForkJoinTask8Test.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="ForkJoinPool9Test.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="ForkJoinTaskTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/concurrent/tck/ForkJoinTask8Test.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 542             }};
 543         testInvokeOnPool(pool, a);
 544     }
 545 
 546     /**
 547      * helpQuiesce returns when tasks are complete.
 548      * getQueuedTaskCount returns 0 when quiescent
 549      */
 550     public void testForkHelpQuiesce() {
 551         testForkHelpQuiesce(mainPool());
 552     }
 553     public void testForkHelpQuiesce_Singleton() {
 554         testForkHelpQuiesce(singletonPool());
 555     }
 556     public void testForkHelpQuiesce(ForkJoinPool pool) {
 557         RecursiveAction a = new CheckedRecursiveAction() {
 558             protected void realCompute() {
 559                 AsyncFib f = new AsyncFib(8);
 560                 assertSame(f, f.fork());
 561                 helpQuiesce();


 562                 assertEquals(0, getQueuedTaskCount());
 563                 f.checkCompletedNormally();
 564             }};
 565         testInvokeOnPool(pool, a);
 566     }
 567 
 568     /**
 569      * invoke task throws exception when task completes abnormally
 570      */
 571     public void testAbnormalInvoke() {
 572         testAbnormalInvoke(mainPool());
 573     }
 574     public void testAbnormalInvoke_Singleton() {
 575         testAbnormalInvoke(singletonPool());
 576     }
 577     public void testAbnormalInvoke(ForkJoinPool pool) {
 578         RecursiveAction a = new CheckedRecursiveAction() {
 579             protected void realCompute() {
 580                 FailingAsyncFib f = new FailingAsyncFib(8);
 581                 try {
</pre>
<hr />
<pre>
 883                 invokeAll(Arrays.asList(tasks));
 884                 for (AsyncFib task : tasks) assertTrue(task.isDone());
 885                 for (AsyncFib task : tasks) task.checkCompletedNormally();
 886             }};
 887         testInvokeOnPool(pool, a);
 888     }
 889 
 890     /**
 891      * invokeAll(tasks) with any null task throws NullPointerException
 892      */
 893     public void testInvokeAllNullTask() {
 894         testInvokeAllNullTask(mainPool());
 895     }
 896     public void testInvokeAllNullTask_Singleton() {
 897         testInvokeAllNullTask(singletonPool());
 898     }
 899     public void testInvokeAllNullTask(ForkJoinPool pool) {
 900         RecursiveAction a = new CheckedRecursiveAction() {
 901             protected void realCompute() {
 902                 AsyncFib nul = null;
<span class="line-modified"> 903                 Runnable[] throwingActions = {</span>

 904                     () -&gt; invokeAll(nul),
 905                     () -&gt; invokeAll(nul, nul),
 906                     () -&gt; invokeAll(new AsyncFib(8), new AsyncFib(9), nul),
 907                     () -&gt; invokeAll(new AsyncFib(8), nul, new AsyncFib(9)),
<span class="line-modified"> 908                     () -&gt; invokeAll(nul, new AsyncFib(8), new AsyncFib(9)),</span>
<span class="line-removed"> 909                 };</span>
<span class="line-removed"> 910                 assertThrows(NullPointerException.class, throwingActions);</span>
 911             }};
 912         testInvokeOnPool(pool, a);
 913     }
 914 
 915     /**
 916      * invokeAll(tasks) with 1 argument throws exception if task does
 917      */
 918     public void testAbnormalInvokeAll1() {
 919         testAbnormalInvokeAll1(mainPool());
 920     }
 921     public void testAbnormalInvokeAll1_Singleton() {
 922         testAbnormalInvokeAll1(singletonPool());
 923     }
 924     public void testAbnormalInvokeAll1(ForkJoinPool pool) {
 925         RecursiveAction a = new CheckedRecursiveAction() {
 926             protected void realCompute() {
 927                 FailingAsyncFib g = new FailingAsyncFib(9);
 928                 try {
 929                     invokeAll(g);
 930                     shouldThrow();
</pre>
</td>
<td>
<hr />
<pre>
 542             }};
 543         testInvokeOnPool(pool, a);
 544     }
 545 
 546     /**
 547      * helpQuiesce returns when tasks are complete.
 548      * getQueuedTaskCount returns 0 when quiescent
 549      */
 550     public void testForkHelpQuiesce() {
 551         testForkHelpQuiesce(mainPool());
 552     }
 553     public void testForkHelpQuiesce_Singleton() {
 554         testForkHelpQuiesce(singletonPool());
 555     }
 556     public void testForkHelpQuiesce(ForkJoinPool pool) {
 557         RecursiveAction a = new CheckedRecursiveAction() {
 558             protected void realCompute() {
 559                 AsyncFib f = new AsyncFib(8);
 560                 assertSame(f, f.fork());
 561                 helpQuiesce();
<span class="line-added"> 562                 while (!f.isDone()) // wait out race</span>
<span class="line-added"> 563                     ;</span>
 564                 assertEquals(0, getQueuedTaskCount());
 565                 f.checkCompletedNormally();
 566             }};
 567         testInvokeOnPool(pool, a);
 568     }
 569 
 570     /**
 571      * invoke task throws exception when task completes abnormally
 572      */
 573     public void testAbnormalInvoke() {
 574         testAbnormalInvoke(mainPool());
 575     }
 576     public void testAbnormalInvoke_Singleton() {
 577         testAbnormalInvoke(singletonPool());
 578     }
 579     public void testAbnormalInvoke(ForkJoinPool pool) {
 580         RecursiveAction a = new CheckedRecursiveAction() {
 581             protected void realCompute() {
 582                 FailingAsyncFib f = new FailingAsyncFib(8);
 583                 try {
</pre>
<hr />
<pre>
 885                 invokeAll(Arrays.asList(tasks));
 886                 for (AsyncFib task : tasks) assertTrue(task.isDone());
 887                 for (AsyncFib task : tasks) task.checkCompletedNormally();
 888             }};
 889         testInvokeOnPool(pool, a);
 890     }
 891 
 892     /**
 893      * invokeAll(tasks) with any null task throws NullPointerException
 894      */
 895     public void testInvokeAllNullTask() {
 896         testInvokeAllNullTask(mainPool());
 897     }
 898     public void testInvokeAllNullTask_Singleton() {
 899         testInvokeAllNullTask(singletonPool());
 900     }
 901     public void testInvokeAllNullTask(ForkJoinPool pool) {
 902         RecursiveAction a = new CheckedRecursiveAction() {
 903             protected void realCompute() {
 904                 AsyncFib nul = null;
<span class="line-modified"> 905                 assertThrows(</span>
<span class="line-added"> 906                     NullPointerException.class,</span>
 907                     () -&gt; invokeAll(nul),
 908                     () -&gt; invokeAll(nul, nul),
 909                     () -&gt; invokeAll(new AsyncFib(8), new AsyncFib(9), nul),
 910                     () -&gt; invokeAll(new AsyncFib(8), nul, new AsyncFib(9)),
<span class="line-modified"> 911                     () -&gt; invokeAll(nul, new AsyncFib(8), new AsyncFib(9)));</span>


 912             }};
 913         testInvokeOnPool(pool, a);
 914     }
 915 
 916     /**
 917      * invokeAll(tasks) with 1 argument throws exception if task does
 918      */
 919     public void testAbnormalInvokeAll1() {
 920         testAbnormalInvokeAll1(mainPool());
 921     }
 922     public void testAbnormalInvokeAll1_Singleton() {
 923         testAbnormalInvokeAll1(singletonPool());
 924     }
 925     public void testAbnormalInvokeAll1(ForkJoinPool pool) {
 926         RecursiveAction a = new CheckedRecursiveAction() {
 927             protected void realCompute() {
 928                 FailingAsyncFib g = new FailingAsyncFib(9);
 929                 try {
 930                     invokeAll(g);
 931                     shouldThrow();
</pre>
</td>
</tr>
</table>
<center><a href="ForkJoinPool9Test.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="ForkJoinTaskTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>