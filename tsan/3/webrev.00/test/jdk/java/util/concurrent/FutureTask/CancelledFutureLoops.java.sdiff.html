<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/concurrent/FutureTask/CancelledFutureLoops.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="BlockingTaskExecutor.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="DoneTimedGetLoops.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/concurrent/FutureTask/CancelledFutureLoops.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
113                 if (!futures[i].cancel(true))
114                     tooLate = true;
115                 // Unbunch some of the cancels
116                 if ( (i &amp; 3) == 0)
117                     Thread.sleep(1 + rnd.nextInt(5));
118             }
119 
120             Object f0 = futures[0].get();
121             if (!tooLate) {
122                 for (int i = 1; i &lt; nthreads; ++i) {
123                     if (!futures[i].isDone() || !futures[i].isCancelled())
124                         throw new Error(&quot;Only one thread should complete&quot;);
125                 }
126             }
127             else
128                 System.out.print(&quot;(cancelled too late) &quot;);
129 
130             long endTime = System.nanoTime();
131             long time = endTime - timer.startTime;
132             if (print) {
<span class="line-modified">133                 double secs = (double)(time) / 1000000000.0;</span>
134                 System.out.println(&quot;\t &quot; + secs + &quot;s run time&quot;);
135             }
136 
137         }
138 
139         public final Object call() throws Exception {
140             barrier.await();
141             int sum = v;
142             int x = 0;
143             int n = ITERS;
144             while (n-- &gt; 0) {
145                 lock.lockInterruptibly();
146                 try {
147                     v = x = LoopHelpers.compute1(v);
148                 }
149                 finally {
150                     lock.unlock();
151                 }
152                 sum += LoopHelpers.compute2(LoopHelpers.compute2(x));
153             }
</pre>
</td>
<td>
<hr />
<pre>
113                 if (!futures[i].cancel(true))
114                     tooLate = true;
115                 // Unbunch some of the cancels
116                 if ( (i &amp; 3) == 0)
117                     Thread.sleep(1 + rnd.nextInt(5));
118             }
119 
120             Object f0 = futures[0].get();
121             if (!tooLate) {
122                 for (int i = 1; i &lt; nthreads; ++i) {
123                     if (!futures[i].isDone() || !futures[i].isCancelled())
124                         throw new Error(&quot;Only one thread should complete&quot;);
125                 }
126             }
127             else
128                 System.out.print(&quot;(cancelled too late) &quot;);
129 
130             long endTime = System.nanoTime();
131             long time = endTime - timer.startTime;
132             if (print) {
<span class="line-modified">133                 double secs = (double)time / 1000000000.0;</span>
134                 System.out.println(&quot;\t &quot; + secs + &quot;s run time&quot;);
135             }
136 
137         }
138 
139         public final Object call() throws Exception {
140             barrier.await();
141             int sum = v;
142             int x = 0;
143             int n = ITERS;
144             while (n-- &gt; 0) {
145                 lock.lockInterruptibly();
146                 try {
147                     v = x = LoopHelpers.compute1(v);
148                 }
149                 finally {
150                     lock.unlock();
151                 }
152                 sum += LoopHelpers.compute2(LoopHelpers.compute2(x));
153             }
</pre>
</td>
</tr>
</table>
<center><a href="BlockingTaskExecutor.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="DoneTimedGetLoops.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>