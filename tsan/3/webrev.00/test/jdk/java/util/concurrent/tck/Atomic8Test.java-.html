<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/jdk/java/util/concurrent/tck/Atomic8Test.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  3  *
  4  * This code is free software; you can redistribute it and/or modify it
  5  * under the terms of the GNU General Public License version 2 only, as
  6  * published by the Free Software Foundation.
  7  *
  8  * This code is distributed in the hope that it will be useful, but WITHOUT
  9  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 10  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 11  * version 2 for more details (a copy is included in the LICENSE file that
 12  * accompanied this code).
 13  *
 14  * You should have received a copy of the GNU General Public License version
 15  * 2 along with this work; if not, write to the Free Software Foundation,
 16  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 17  *
 18  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 19  * or visit www.oracle.com if you need additional information or have any
 20  * questions.
 21  */
 22 
 23 /*
 24  * This file is available under and governed by the GNU General Public
 25  * License version 2 only, as published by the Free Software Foundation.
 26  * However, the following notice accompanied the original version of this
 27  * file:
 28  *
 29  * Written by Doug Lea and Martin Buchholz with assistance from
 30  * members of JCP JSR-166 Expert Group and released to the public
 31  * domain, as explained at
 32  * http://creativecommons.org/publicdomain/zero/1.0/
 33  */
 34 
 35 import java.util.concurrent.atomic.AtomicInteger;
 36 import java.util.concurrent.atomic.AtomicIntegerArray;
 37 import java.util.concurrent.atomic.AtomicIntegerFieldUpdater;
 38 import java.util.concurrent.atomic.AtomicLong;
 39 import java.util.concurrent.atomic.AtomicLongArray;
 40 import java.util.concurrent.atomic.AtomicLongFieldUpdater;
 41 import java.util.concurrent.atomic.AtomicReference;
 42 import java.util.concurrent.atomic.AtomicReferenceArray;
 43 import java.util.concurrent.atomic.AtomicReferenceFieldUpdater;
 44 
 45 import junit.framework.Test;
 46 import junit.framework.TestSuite;
 47 
 48 /**
 49  * Tests of atomic class methods accepting lambdas introduced in JDK8.
 50  */
 51 public class Atomic8Test extends JSR166TestCase {
 52 
 53     public static void main(String[] args) {
 54         main(suite(), args);
 55     }
 56     public static Test suite() {
 57         return new TestSuite(Atomic8Test.class);
 58     }
 59 
 60     static long addLong17(long x) { return x + 17; }
 61     static int addInt17(int x) { return x + 17; }
 62     static Integer addInteger17(Integer x) {
 63         return x.intValue() + 17;
 64     }
 65     static Integer sumInteger(Integer x, Integer y) {
 66         return x.intValue() + y.intValue();
 67     }
 68 
 69     volatile long aLongField;
 70     volatile int anIntField;
 71     volatile Integer anIntegerField;
 72 
 73     AtomicLongFieldUpdater&lt;Atomic8Test&gt; aLongFieldUpdater() {
 74         return AtomicLongFieldUpdater.newUpdater
 75             (Atomic8Test.class, &quot;aLongField&quot;);
 76     }
 77 
 78     AtomicIntegerFieldUpdater&lt;Atomic8Test&gt; anIntFieldUpdater() {
 79         return AtomicIntegerFieldUpdater.newUpdater
 80             (Atomic8Test.class, &quot;anIntField&quot;);
 81     }
 82 
 83     AtomicReferenceFieldUpdater&lt;Atomic8Test,Integer&gt; anIntegerFieldUpdater() {
 84         return AtomicReferenceFieldUpdater.newUpdater
 85             (Atomic8Test.class, Integer.class, &quot;anIntegerField&quot;);
 86     }
 87 
 88     /**
 89      * AtomicLong getAndUpdate returns previous value and updates
 90      * result of supplied function
 91      */
 92     public void testLongGetAndUpdate() {
 93         AtomicLong a = new AtomicLong(1L);
 94         assertEquals(1L, a.getAndUpdate(Atomic8Test::addLong17));
 95         assertEquals(18L, a.getAndUpdate(Atomic8Test::addLong17));
 96         assertEquals(35L, a.get());
 97     }
 98 
 99     /**
100      * AtomicLong updateAndGet updates with supplied function and
101      * returns result.
102      */
103     public void testLongUpdateAndGet() {
104         AtomicLong a = new AtomicLong(1L);
105         assertEquals(18L, a.updateAndGet(Atomic8Test::addLong17));
106         assertEquals(35L, a.updateAndGet(Atomic8Test::addLong17));
107     }
108 
109     /**
110      * AtomicLong getAndAccumulate returns previous value and updates
111      * with supplied function.
112      */
113     public void testLongGetAndAccumulate() {
114         AtomicLong a = new AtomicLong(1L);
115         assertEquals(1L, a.getAndAccumulate(2L, Long::sum));
116         assertEquals(3L, a.getAndAccumulate(3L, Long::sum));
117         assertEquals(6L, a.get());
118     }
119 
120     /**
121      * AtomicLong accumulateAndGet updates with supplied function and
122      * returns result.
123      */
124     public void testLongAccumulateAndGet() {
125         AtomicLong a = new AtomicLong(1L);
126         assertEquals(7L, a.accumulateAndGet(6L, Long::sum));
127         assertEquals(10L, a.accumulateAndGet(3L, Long::sum));
128         assertEquals(10L, a.get());
129     }
130 
131     /**
132      * AtomicInteger getAndUpdate returns previous value and updates
133      * result of supplied function
134      */
135     public void testIntGetAndUpdate() {
136         AtomicInteger a = new AtomicInteger(1);
137         assertEquals(1, a.getAndUpdate(Atomic8Test::addInt17));
138         assertEquals(18, a.getAndUpdate(Atomic8Test::addInt17));
139         assertEquals(35, a.get());
140     }
141 
142     /**
143      * AtomicInteger updateAndGet updates with supplied function and
144      * returns result.
145      */
146     public void testIntUpdateAndGet() {
147         AtomicInteger a = new AtomicInteger(1);
148         assertEquals(18, a.updateAndGet(Atomic8Test::addInt17));
149         assertEquals(35, a.updateAndGet(Atomic8Test::addInt17));
150         assertEquals(35, a.get());
151     }
152 
153     /**
154      * AtomicInteger getAndAccumulate returns previous value and updates
155      * with supplied function.
156      */
157     public void testIntGetAndAccumulate() {
158         AtomicInteger a = new AtomicInteger(1);
159         assertEquals(1, a.getAndAccumulate(2, Integer::sum));
160         assertEquals(3, a.getAndAccumulate(3, Integer::sum));
161         assertEquals(6, a.get());
162     }
163 
164     /**
165      * AtomicInteger accumulateAndGet updates with supplied function and
166      * returns result.
167      */
168     public void testIntAccumulateAndGet() {
169         AtomicInteger a = new AtomicInteger(1);
170         assertEquals(7, a.accumulateAndGet(6, Integer::sum));
171         assertEquals(10, a.accumulateAndGet(3, Integer::sum));
172         assertEquals(10, a.get());
173     }
174 
175     /**
176      * AtomicReference getAndUpdate returns previous value and updates
177      * result of supplied function
178      */
179     public void testReferenceGetAndUpdate() {
180         AtomicReference&lt;Integer&gt; a = new AtomicReference&lt;&gt;(one);
181         assertEquals((Integer) 1, a.getAndUpdate(Atomic8Test::addInteger17));
182         assertEquals((Integer) 18, a.getAndUpdate(Atomic8Test::addInteger17));
183         assertEquals((Integer) 35, a.get());
184     }
185 
186     /**
187      * AtomicReference updateAndGet updates with supplied function and
188      * returns result.
189      */
190     public void testReferenceUpdateAndGet() {
191         AtomicReference&lt;Integer&gt; a = new AtomicReference&lt;&gt;(one);
192         assertEquals((Integer) 18, a.updateAndGet(Atomic8Test::addInteger17));
193         assertEquals((Integer) 35, a.updateAndGet(Atomic8Test::addInteger17));
194         assertEquals((Integer) 35, a.get());
195     }
196 
197     /**
198      * AtomicReference getAndAccumulate returns previous value and updates
199      * with supplied function.
200      */
201     public void testReferenceGetAndAccumulate() {
202         AtomicReference&lt;Integer&gt; a = new AtomicReference&lt;&gt;(one);
203         assertEquals((Integer) 1, a.getAndAccumulate(2, Atomic8Test::sumInteger));
204         assertEquals((Integer) 3, a.getAndAccumulate(3, Atomic8Test::sumInteger));
205         assertEquals((Integer) 6, a.get());
206     }
207 
208     /**
209      * AtomicReference accumulateAndGet updates with supplied function and
210      * returns result.
211      */
212     public void testReferenceAccumulateAndGet() {
213         AtomicReference&lt;Integer&gt; a = new AtomicReference&lt;&gt;(one);
214         assertEquals((Integer) 7, a.accumulateAndGet(6, Atomic8Test::sumInteger));
215         assertEquals((Integer) 10, a.accumulateAndGet(3, Atomic8Test::sumInteger));
216         assertEquals((Integer) 10, a.get());
217     }
218 
219     /**
220      * AtomicLongArray getAndUpdate returns previous value and updates
221      * result of supplied function
222      */
223     public void testLongArrayGetAndUpdate() {
224         AtomicLongArray a = new AtomicLongArray(1);
225         a.set(0, 1);
226         assertEquals(1L, a.getAndUpdate(0, Atomic8Test::addLong17));
227         assertEquals(18L, a.getAndUpdate(0, Atomic8Test::addLong17));
228         assertEquals(35L, a.get(0));
229     }
230 
231     /**
232      * AtomicLongArray updateAndGet updates with supplied function and
233      * returns result.
234      */
235     public void testLongArrayUpdateAndGet() {
236         AtomicLongArray a = new AtomicLongArray(1);
237         a.set(0, 1);
238         assertEquals(18L, a.updateAndGet(0, Atomic8Test::addLong17));
239         assertEquals(35L, a.updateAndGet(0, Atomic8Test::addLong17));
240         assertEquals(35L, a.get(0));
241     }
242 
243     /**
244      * AtomicLongArray getAndAccumulate returns previous value and updates
245      * with supplied function.
246      */
247     public void testLongArrayGetAndAccumulate() {
248         AtomicLongArray a = new AtomicLongArray(1);
249         a.set(0, 1);
250         assertEquals(1L, a.getAndAccumulate(0, 2L, Long::sum));
251         assertEquals(3L, a.getAndAccumulate(0, 3L, Long::sum));
252         assertEquals(6L, a.get(0));
253     }
254 
255     /**
256      * AtomicLongArray accumulateAndGet updates with supplied function and
257      * returns result.
258      */
259     public void testLongArrayAccumulateAndGet() {
260         AtomicLongArray a = new AtomicLongArray(1);
261         a.set(0, 1);
262         assertEquals(7L, a.accumulateAndGet(0, 6L, Long::sum));
263         assertEquals(10L, a.accumulateAndGet(0, 3L, Long::sum));
264         assertEquals(10L, a.get(0));
265     }
266 
267     /**
268      * AtomicIntegerArray getAndUpdate returns previous value and updates
269      * result of supplied function
270      */
271     public void testIntArrayGetAndUpdate() {
272         AtomicIntegerArray a = new AtomicIntegerArray(1);
273         a.set(0, 1);
274         assertEquals(1, a.getAndUpdate(0, Atomic8Test::addInt17));
275         assertEquals(18, a.getAndUpdate(0, Atomic8Test::addInt17));
276         assertEquals(35, a.get(0));
277     }
278 
279     /**
280      * AtomicIntegerArray updateAndGet updates with supplied function and
281      * returns result.
282      */
283     public void testIntArrayUpdateAndGet() {
284         AtomicIntegerArray a = new AtomicIntegerArray(1);
285         a.set(0, 1);
286         assertEquals(18, a.updateAndGet(0, Atomic8Test::addInt17));
287         assertEquals(35, a.updateAndGet(0, Atomic8Test::addInt17));
288         assertEquals(35, a.get(0));
289     }
290 
291     /**
292      * AtomicIntegerArray getAndAccumulate returns previous value and updates
293      * with supplied function.
294      */
295     public void testIntArrayGetAndAccumulate() {
296         AtomicIntegerArray a = new AtomicIntegerArray(1);
297         a.set(0, 1);
298         assertEquals(1, a.getAndAccumulate(0, 2, Integer::sum));
299         assertEquals(3, a.getAndAccumulate(0, 3, Integer::sum));
300         assertEquals(6, a.get(0));
301     }
302 
303     /**
304      * AtomicIntegerArray accumulateAndGet updates with supplied function and
305      * returns result.
306      */
307     public void testIntArrayAccumulateAndGet() {
308         AtomicIntegerArray a = new AtomicIntegerArray(1);
309         a.set(0, 1);
310         assertEquals(7, a.accumulateAndGet(0, 6, Integer::sum));
311         assertEquals(10, a.accumulateAndGet(0, 3, Integer::sum));
312     }
313 
314     /**
315      * AtomicReferenceArray getAndUpdate returns previous value and updates
316      * result of supplied function
317      */
318     public void testReferenceArrayGetAndUpdate() {
319         AtomicReferenceArray&lt;Integer&gt; a = new AtomicReferenceArray&lt;&gt;(1);
320         a.set(0, one);
321         assertEquals((Integer) 1, a.getAndUpdate(0, Atomic8Test::addInteger17));
322         assertEquals((Integer) 18, a.getAndUpdate(0, Atomic8Test::addInteger17));
323         assertEquals((Integer) 35, a.get(0));
324     }
325 
326     /**
327      * AtomicReferenceArray updateAndGet updates with supplied function and
328      * returns result.
329      */
330     public void testReferenceArrayUpdateAndGet() {
331         AtomicReferenceArray&lt;Integer&gt; a = new AtomicReferenceArray&lt;&gt;(1);
332         a.set(0, one);
333         assertEquals((Integer) 18, a.updateAndGet(0, Atomic8Test::addInteger17));
334         assertEquals((Integer) 35, a.updateAndGet(0, Atomic8Test::addInteger17));
335     }
336 
337     /**
338      * AtomicReferenceArray getAndAccumulate returns previous value and updates
339      * with supplied function.
340      */
341     public void testReferenceArrayGetAndAccumulate() {
342         AtomicReferenceArray&lt;Integer&gt; a = new AtomicReferenceArray&lt;&gt;(1);
343         a.set(0, one);
344         assertEquals((Integer) 1, a.getAndAccumulate(0, 2, Atomic8Test::sumInteger));
345         assertEquals((Integer) 3, a.getAndAccumulate(0, 3, Atomic8Test::sumInteger));
346         assertEquals((Integer) 6, a.get(0));
347     }
348 
349     /**
350      * AtomicReferenceArray accumulateAndGet updates with supplied function and
351      * returns result.
352      */
353     public void testReferenceArrayAccumulateAndGet() {
354         AtomicReferenceArray&lt;Integer&gt; a = new AtomicReferenceArray&lt;&gt;(1);
355         a.set(0, one);
356         assertEquals((Integer) 7, a.accumulateAndGet(0, 6, Atomic8Test::sumInteger));
357         assertEquals((Integer) 10, a.accumulateAndGet(0, 3, Atomic8Test::sumInteger));
358     }
359 
360     /**
361      * AtomicLongFieldUpdater getAndUpdate returns previous value and updates
362      * result of supplied function
363      */
364     public void testLongFieldUpdaterGetAndUpdate() {
365         AtomicLongFieldUpdater a = aLongFieldUpdater();
366         a.set(this, 1);
367         assertEquals(1L, a.getAndUpdate(this, Atomic8Test::addLong17));
368         assertEquals(18L, a.getAndUpdate(this, Atomic8Test::addLong17));
369         assertEquals(35L, a.get(this));
370         assertEquals(35L, aLongField);
371     }
372 
373     /**
374      * AtomicLongFieldUpdater updateAndGet updates with supplied function and
375      * returns result.
376      */
377     public void testLongFieldUpdaterUpdateAndGet() {
378         AtomicLongFieldUpdater a = aLongFieldUpdater();
379         a.set(this, 1);
380         assertEquals(18L, a.updateAndGet(this, Atomic8Test::addLong17));
381         assertEquals(35L, a.updateAndGet(this, Atomic8Test::addLong17));
382         assertEquals(35L, a.get(this));
383         assertEquals(35L, aLongField);
384     }
385 
386     /**
387      * AtomicLongFieldUpdater getAndAccumulate returns previous value
388      * and updates with supplied function.
389      */
390     public void testLongFieldUpdaterGetAndAccumulate() {
391         AtomicLongFieldUpdater a = aLongFieldUpdater();
392         a.set(this, 1);
393         assertEquals(1L, a.getAndAccumulate(this, 2L, Long::sum));
394         assertEquals(3L, a.getAndAccumulate(this, 3L, Long::sum));
395         assertEquals(6L, a.get(this));
396         assertEquals(6L, aLongField);
397     }
398 
399     /**
400      * AtomicLongFieldUpdater accumulateAndGet updates with supplied
401      * function and returns result.
402      */
403     public void testLongFieldUpdaterAccumulateAndGet() {
404         AtomicLongFieldUpdater a = aLongFieldUpdater();
405         a.set(this, 1);
406         assertEquals(7L, a.accumulateAndGet(this, 6L, Long::sum));
407         assertEquals(10L, a.accumulateAndGet(this, 3L, Long::sum));
408         assertEquals(10L, a.get(this));
409         assertEquals(10L, aLongField);
410     }
411 
412     /**
413      * AtomicIntegerFieldUpdater getAndUpdate returns previous value and updates
414      * result of supplied function
415      */
416     public void testIntegerFieldUpdaterGetAndUpdate() {
417         AtomicIntegerFieldUpdater a = anIntFieldUpdater();
418         a.set(this, 1);
419         assertEquals(1, a.getAndUpdate(this, Atomic8Test::addInt17));
420         assertEquals(18, a.getAndUpdate(this, Atomic8Test::addInt17));
421         assertEquals(35, a.get(this));
422         assertEquals(35, anIntField);
423     }
424 
425     /**
426      * AtomicIntegerFieldUpdater updateAndGet updates with supplied function and
427      * returns result.
428      */
429     public void testIntegerFieldUpdaterUpdateAndGet() {
430         AtomicIntegerFieldUpdater a = anIntFieldUpdater();
431         a.set(this, 1);
432         assertEquals(18, a.updateAndGet(this, Atomic8Test::addInt17));
433         assertEquals(35, a.updateAndGet(this, Atomic8Test::addInt17));
434         assertEquals(35, a.get(this));
435         assertEquals(35, anIntField);
436     }
437 
438     /**
439      * AtomicIntegerFieldUpdater getAndAccumulate returns previous value
440      * and updates with supplied function.
441      */
442     public void testIntegerFieldUpdaterGetAndAccumulate() {
443         AtomicIntegerFieldUpdater a = anIntFieldUpdater();
444         a.set(this, 1);
445         assertEquals(1, a.getAndAccumulate(this, 2, Integer::sum));
446         assertEquals(3, a.getAndAccumulate(this, 3, Integer::sum));
447         assertEquals(6, a.get(this));
448         assertEquals(6, anIntField);
449     }
450 
451     /**
452      * AtomicIntegerFieldUpdater accumulateAndGet updates with supplied
453      * function and returns result.
454      */
455     public void testIntegerFieldUpdaterAccumulateAndGet() {
456         AtomicIntegerFieldUpdater a = anIntFieldUpdater();
457         a.set(this, 1);
458         assertEquals(7, a.accumulateAndGet(this, 6, Integer::sum));
459         assertEquals(10, a.accumulateAndGet(this, 3, Integer::sum));
460         assertEquals(10, a.get(this));
461         assertEquals(10, anIntField);
462     }
463 
464     /**
465      * AtomicReferenceFieldUpdater getAndUpdate returns previous value
466      * and updates result of supplied function
467      */
468     public void testReferenceFieldUpdaterGetAndUpdate() {
469         AtomicReferenceFieldUpdater&lt;Atomic8Test,Integer&gt; a = anIntegerFieldUpdater();
470         a.set(this, one);
471         assertEquals((Integer) 1, a.getAndUpdate(this, Atomic8Test::addInteger17));
472         assertEquals((Integer) 18, a.getAndUpdate(this, Atomic8Test::addInteger17));
473         assertEquals((Integer) 35, a.get(this));
474         assertEquals((Integer) 35, anIntegerField);
475     }
476 
477     /**
478      * AtomicReferenceFieldUpdater updateAndGet updates with supplied
479      * function and returns result.
480      */
481     public void testReferenceFieldUpdaterUpdateAndGet() {
482         AtomicReferenceFieldUpdater&lt;Atomic8Test,Integer&gt; a = anIntegerFieldUpdater();
483         a.set(this, one);
484         assertEquals((Integer) 18, a.updateAndGet(this, Atomic8Test::addInteger17));
485         assertEquals((Integer) 35, a.updateAndGet(this, Atomic8Test::addInteger17));
486         assertEquals((Integer) 35, a.get(this));
487         assertEquals((Integer) 35, anIntegerField);
488     }
489 
490     /**
491      * AtomicReferenceFieldUpdater returns previous value and updates
492      * with supplied function.
493      */
494     public void testReferenceFieldUpdaterGetAndAccumulate() {
495         AtomicReferenceFieldUpdater&lt;Atomic8Test,Integer&gt; a = anIntegerFieldUpdater();
496         a.set(this, one);
497         assertEquals((Integer) 1, a.getAndAccumulate(this, 2, Atomic8Test::sumInteger));
498         assertEquals((Integer) 3, a.getAndAccumulate(this, 3, Atomic8Test::sumInteger));
499         assertEquals((Integer) 6, a.get(this));
500         assertEquals((Integer) 6, anIntegerField);
501     }
502 
503     /**
504      * AtomicReferenceFieldUpdater accumulateAndGet updates with
505      * supplied function and returns result.
506      */
507     public void testReferenceFieldUpdaterAccumulateAndGet() {
508         AtomicReferenceFieldUpdater&lt;Atomic8Test,Integer&gt; a = anIntegerFieldUpdater();
509         a.set(this, one);
510         assertEquals((Integer) 7, a.accumulateAndGet(this, 6, Atomic8Test::sumInteger));
511         assertEquals((Integer) 10, a.accumulateAndGet(this, 3, Atomic8Test::sumInteger));
512         assertEquals((Integer) 10, a.get(this));
513         assertEquals((Integer) 10, anIntegerField);
514     }
515 
516     /**
517      * All Atomic getAndUpdate methods throw NullPointerException on
518      * null function argument
519      */
520     public void testGetAndUpdateNPE() {
521         Runnable[] throwingActions = {
522             () -&gt; new AtomicLong().getAndUpdate(null),
523             () -&gt; new AtomicInteger().getAndUpdate(null),
524             () -&gt; new AtomicReference().getAndUpdate(null),
525             () -&gt; new AtomicLongArray(1).getAndUpdate(0, null),
526             () -&gt; new AtomicIntegerArray(1).getAndUpdate(0, null),
527             () -&gt; new AtomicReferenceArray(1).getAndUpdate(0, null),
528             () -&gt; aLongFieldUpdater().getAndUpdate(this, null),
529             () -&gt; anIntFieldUpdater().getAndUpdate(this, null),
530             () -&gt; anIntegerFieldUpdater().getAndUpdate(this, null),
531         };
532         assertThrows(NullPointerException.class, throwingActions);
533     }
534 
535     /**
536      * All Atomic updateAndGet methods throw NullPointerException on null function argument
537      */
538     public void testUpdateAndGetNPE() {
539         Runnable[] throwingActions = {
540             () -&gt; new AtomicLong().updateAndGet(null),
541             () -&gt; new AtomicInteger().updateAndGet(null),
542             () -&gt; new AtomicReference().updateAndGet(null),
543             () -&gt; new AtomicLongArray(1).updateAndGet(0, null),
544             () -&gt; new AtomicIntegerArray(1).updateAndGet(0, null),
545             () -&gt; new AtomicReferenceArray(1).updateAndGet(0, null),
546             () -&gt; aLongFieldUpdater().updateAndGet(this, null),
547             () -&gt; anIntFieldUpdater().updateAndGet(this, null),
548             () -&gt; anIntegerFieldUpdater().updateAndGet(this, null),
549         };
550         assertThrows(NullPointerException.class, throwingActions);
551     }
552 
553     /**
554      * All Atomic getAndAccumulate methods throw NullPointerException
555      * on null function argument
556      */
557     public void testGetAndAccumulateNPE() {
558         Runnable[] throwingActions = {
559             () -&gt; new AtomicLong().getAndAccumulate(1L, null),
560             () -&gt; new AtomicInteger().getAndAccumulate(1, null),
561             () -&gt; new AtomicReference().getAndAccumulate(one, null),
562             () -&gt; new AtomicLongArray(1).getAndAccumulate(0, 1L, null),
563             () -&gt; new AtomicIntegerArray(1).getAndAccumulate(0, 1, null),
564             () -&gt; new AtomicReferenceArray(1).getAndAccumulate(0, one, null),
565             () -&gt; aLongFieldUpdater().getAndAccumulate(this, 1L, null),
566             () -&gt; anIntFieldUpdater().getAndAccumulate(this, 1, null),
567             () -&gt; anIntegerFieldUpdater().getAndAccumulate(this, one, null),
568         };
569         assertThrows(NullPointerException.class, throwingActions);
570     }
571 
572     /**
573      * All Atomic accumulateAndGet methods throw NullPointerException
574      * on null function argument
575      */
576     public void testAccumulateAndGetNPE() {
577         Runnable[] throwingActions = {
578             () -&gt; new AtomicLong().accumulateAndGet(1L, null),
579             () -&gt; new AtomicInteger().accumulateAndGet(1, null),
580             () -&gt; new AtomicReference().accumulateAndGet(one, null),
581             () -&gt; new AtomicLongArray(1).accumulateAndGet(0, 1L, null),
582             () -&gt; new AtomicIntegerArray(1).accumulateAndGet(0, 1, null),
583             () -&gt; new AtomicReferenceArray(1).accumulateAndGet(0, one, null),
584             () -&gt; aLongFieldUpdater().accumulateAndGet(this, 1L, null),
585             () -&gt; anIntFieldUpdater().accumulateAndGet(this, 1, null),
586             () -&gt; anIntegerFieldUpdater().accumulateAndGet(this, one, null),
587         };
588         assertThrows(NullPointerException.class, throwingActions);
589     }
590 
591     /**
592      * Object arguments for parameters of type T that are not
593      * instances of the class passed to the newUpdater call will
594      * result in a ClassCastException being thrown.
595      */
596     public void testFieldUpdaters_ClassCastException() {
597         // Use raw types to allow passing wrong object type, provoking CCE
598         final AtomicLongFieldUpdater longUpdater = aLongFieldUpdater();
599         final AtomicIntegerFieldUpdater intUpdater = anIntFieldUpdater();
600         final AtomicReferenceFieldUpdater refUpdater = anIntegerFieldUpdater();
601         final Object obj = new Object();
602         for (Object x : new Object[]{ new Object(), null }) {
603             Runnable[] throwingActions = {
604                 () -&gt; longUpdater.get(x),
605                 () -&gt; intUpdater.get(x),
606                 () -&gt; refUpdater.get(x),
607 
608                 () -&gt; longUpdater.set(x, 17L),
609                 () -&gt; intUpdater.set(x, 17),
610                 () -&gt; refUpdater.set(x, (Integer) 17),
611 
612                 () -&gt; longUpdater.addAndGet(x, 17L),
613                 () -&gt; intUpdater.addAndGet(x, 17),
614 
615                 () -&gt; longUpdater.getAndUpdate(x, y -&gt; y),
616                 () -&gt; intUpdater.getAndUpdate(x, y -&gt; y),
617                 () -&gt; refUpdater.getAndUpdate(x, y -&gt; y),
618 
619                 () -&gt; longUpdater.compareAndSet(x, 17L, 42L),
620                 () -&gt; intUpdater.compareAndSet(x, 17, 42),
621                 () -&gt; refUpdater.compareAndSet(x, (Integer) 17, (Integer) 42),
622             };
623             assertThrows(ClassCastException.class, throwingActions);
624         }
625     }
626 
627 }
    </pre>
  </body>
</html>