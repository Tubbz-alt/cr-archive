<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/concurrent/Phaser/FickleRegister.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../FutureTask/DoneTimedGetLoops.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TieredArriveLoops.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/concurrent/Phaser/FickleRegister.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 26  * However, the following notice accompanied the original version of this
 27  * file:
 28  *
 29  * Written by Doug Lea with assistance from members of JCP JSR-166
 30  * Expert Group and released to the public domain, as explained at
 31  * http://creativecommons.org/publicdomain/zero/1.0/
 32  */
 33 
 34 /*
 35  * @test
 36  * @summary stress test for register/arriveAndDeregister
 37  * @run main FickleRegister 300
 38  */
 39 
 40 import java.util.ArrayList;
 41 import java.util.concurrent.Phaser;
 42 import java.util.concurrent.atomic.AtomicLong;
 43 
 44 public class FickleRegister {
 45     final AtomicLong count = new AtomicLong(0);
<span class="line-modified"> 46     final long testDurationMillisDefault = 10L * 1000L;</span>
 47     final long testDurationMillis;
 48     final long quittingTimeNanos;
 49     final int chunkSize = 1000;
 50 
 51     FickleRegister(String[] args) {
 52         testDurationMillis = (args.length &gt; 0) ?
 53             Long.valueOf(args[0]) : testDurationMillisDefault;
 54         quittingTimeNanos = System.nanoTime() +
 55             testDurationMillis * 1000L * 1000L;
 56     }
 57 
 58     class Runner extends CheckedRunnable {
 59         final Phaser p;
 60         Runner(Phaser phaser) { p = phaser; }
 61         public void realRun() {
 62             int prevPhase = -1;
 63             for (int k = 1;; k++) {
 64                 for (int i = 0; i &lt; chunkSize; i++) {
 65                     int phase = p.register();
 66                     if (phase &lt; 0) break;
</pre>
</td>
<td>
<hr />
<pre>
 26  * However, the following notice accompanied the original version of this
 27  * file:
 28  *
 29  * Written by Doug Lea with assistance from members of JCP JSR-166
 30  * Expert Group and released to the public domain, as explained at
 31  * http://creativecommons.org/publicdomain/zero/1.0/
 32  */
 33 
 34 /*
 35  * @test
 36  * @summary stress test for register/arriveAndDeregister
 37  * @run main FickleRegister 300
 38  */
 39 
 40 import java.util.ArrayList;
 41 import java.util.concurrent.Phaser;
 42 import java.util.concurrent.atomic.AtomicLong;
 43 
 44 public class FickleRegister {
 45     final AtomicLong count = new AtomicLong(0);
<span class="line-modified"> 46     final long testDurationMillisDefault = 10_000L;</span>
 47     final long testDurationMillis;
 48     final long quittingTimeNanos;
 49     final int chunkSize = 1000;
 50 
 51     FickleRegister(String[] args) {
 52         testDurationMillis = (args.length &gt; 0) ?
 53             Long.valueOf(args[0]) : testDurationMillisDefault;
 54         quittingTimeNanos = System.nanoTime() +
 55             testDurationMillis * 1000L * 1000L;
 56     }
 57 
 58     class Runner extends CheckedRunnable {
 59         final Phaser p;
 60         Runner(Phaser phaser) { p = phaser; }
 61         public void realRun() {
 62             int prevPhase = -1;
 63             for (int k = 1;; k++) {
 64                 for (int i = 0; i &lt; chunkSize; i++) {
 65                     int phase = p.register();
 66                     if (phase &lt; 0) break;
</pre>
</td>
</tr>
</table>
<center><a href="../FutureTask/DoneTimedGetLoops.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TieredArriveLoops.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>