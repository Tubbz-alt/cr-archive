<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/java/util/Arrays/Sorting.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../time/test/java/time/format/TestUnicodeExtension.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TimSortStackSize2.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/Arrays/Sorting.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2009, 2011, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2009, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 21,281 ***</span>
   * questions.
   */
  
  /*
   * @test
<span class="line-modified">!  * @bug 6880672 6896573 6899694 6976036 7013585 7018258</span>
<span class="line-modified">!  * @summary Exercise Arrays.sort</span>
   * @build Sorting
   * @run main Sorting -shortrun
   *
   * @author Vladimir Yaroslavskiy
   * @author Jon Bentley
   * @author Josh Bloch
   */
  
<span class="line-removed">- import java.util.Arrays;</span>
<span class="line-removed">- import java.util.Random;</span>
  import java.io.PrintStream;
  
  public class Sorting {
      private static final PrintStream out = System.out;
      private static final PrintStream err = System.err;
  
      // Array lengths used in a long run (default)
      private static final int[] LONG_RUN_LENGTHS = {
<span class="line-modified">!         1, 2, 3, 5, 8, 13, 21, 34, 55, 100, 1000, 10000, 100000, 1000000 };</span>
  
      // Array lengths used in a short run
      private static final int[] SHORT_RUN_LENGTHS = {
<span class="line-modified">!         1, 2, 3, 21, 55, 1000, 10000 };</span>
  
      // Random initial values used in a long run (default)
<span class="line-modified">!     private static final long[] LONG_RUN_RANDOMS = { 666, 0xC0FFEE, 999 };</span>
  
      // Random initial values used in a short run
<span class="line-modified">!     private static final long[] SHORT_RUN_RANDOMS = { 666 };</span>
  
      public static void main(String[] args) {
<span class="line-removed">-         boolean shortRun = args.length &gt; 0 &amp;&amp; args[0].equals(&quot;-shortrun&quot;);</span>
          long start = System.currentTimeMillis();
  
<span class="line-removed">-         if (shortRun) {</span>
<span class="line-removed">-             testAndCheck(SHORT_RUN_LENGTHS, SHORT_RUN_RANDOMS);</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             testAndCheck(LONG_RUN_LENGTHS, LONG_RUN_RANDOMS);</span>
<span class="line-removed">-         }</span>
          long end = System.currentTimeMillis();
  
<span class="line-modified">!         out.format(&quot;PASSED in %d sec.\n&quot;, Math.round((end - start) / 1E3));</span>
      }
  
<span class="line-modified">!     private static void testAndCheck(int[] lengths, long[] randoms) {</span>
          testEmptyAndNullIntArray();
          testEmptyAndNullLongArray();
<span class="line-removed">-         testEmptyAndNullShortArray();</span>
<span class="line-removed">-         testEmptyAndNullCharArray();</span>
          testEmptyAndNullByteArray();
          testEmptyAndNullFloatArray();
          testEmptyAndNullDoubleArray();
  
<span class="line-modified">!         for (int length : lengths) {</span>
<span class="line-modified">!             testMergeSort(length);</span>
<span class="line-modified">!             testAndCheckRange(length);</span>
<span class="line-modified">!             testAndCheckSubArray(length);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         for (long seed : randoms) {</span>
<span class="line-modified">!             for (int length : lengths) {</span>
<span class="line-modified">!                 testAndCheckWithInsertionSort(length, new MyRandom(seed));</span>
<span class="line-modified">!                 testAndCheckWithCheckSum(length, new MyRandom(seed));</span>
<span class="line-modified">!                 testAndCheckWithScrambling(length, new MyRandom(seed));</span>
<span class="line-modified">!                 testAndCheckFloat(length, new MyRandom(seed));</span>
<span class="line-modified">!                 testAndCheckDouble(length, new MyRandom(seed));</span>
<span class="line-modified">!                 testStable(length, new MyRandom(seed));</span>
<span class="line-modified">!             }</span>
<span class="line-removed">-         }</span>
      }
  
<span class="line-modified">!     private static void testEmptyAndNullIntArray() {</span>
<span class="line-modified">!         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified">!         Arrays.sort(new int[] {});</span>
<span class="line-removed">-         Arrays.sort(new int[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             Arrays.sort((int[]) null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 Arrays.sort((int[]) null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             failed(&quot;Arrays.sort(int[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         failed(&quot;Arrays.sort(int[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private static void testEmptyAndNullLongArray() {</span>
<span class="line-modified">!         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified">!         Arrays.sort(new long[] {});</span>
<span class="line-removed">-         Arrays.sort(new long[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             Arrays.sort((long[]) null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 Arrays.sort((long[]) null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             failed(&quot;Arrays.sort(long[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         failed(&quot;Arrays.sort(long[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private static void testEmptyAndNullShortArray() {</span>
<span class="line-modified">!         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified">!         Arrays.sort(new short[] {});</span>
<span class="line-removed">-         Arrays.sort(new short[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             Arrays.sort((short[]) null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 Arrays.sort((short[]) null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             failed(&quot;Arrays.sort(short[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         failed(&quot;Arrays.sort(short[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private static void testEmptyAndNullCharArray() {</span>
<span class="line-modified">!         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified">!         Arrays.sort(new char[] {});</span>
<span class="line-removed">-         Arrays.sort(new char[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             Arrays.sort((char[]) null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 Arrays.sort((char[]) null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             failed(&quot;Arrays.sort(char[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         failed(&quot;Arrays.sort(char[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private static void testEmptyAndNullByteArray() {</span>
<span class="line-modified">!         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified">!         Arrays.sort(new byte[] {});</span>
<span class="line-removed">-         Arrays.sort(new byte[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             Arrays.sort((byte[]) null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 Arrays.sort((byte[]) null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             failed(&quot;Arrays.sort(byte[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         failed(&quot;Arrays.sort(byte[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private static void testEmptyAndNullFloatArray() {</span>
<span class="line-modified">!         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified">!         Arrays.sort(new float[] {});</span>
<span class="line-removed">-         Arrays.sort(new float[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             Arrays.sort((float[]) null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 Arrays.sort((float[]) null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             failed(&quot;Arrays.sort(float[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         failed(&quot;Arrays.sort(float[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private static void testEmptyAndNullDoubleArray() {</span>
<span class="line-modified">!         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified">!         Arrays.sort(new double[] {});</span>
<span class="line-removed">-         Arrays.sort(new double[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             Arrays.sort((double[]) null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 Arrays.sort((double[]) null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             failed(&quot;Arrays.sort(double[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         failed(&quot;Arrays.sort(double[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private static void testAndCheckSubArray(int length) {</span>
<span class="line-modified">!         ourDescription = &quot;Check sorting of subarray&quot;;</span>
<span class="line-modified">!         int[] golden = new int[length];</span>
<span class="line-modified">!         boolean newLine = false;</span>
<span class="line-modified">! </span>
<span class="line-removed">-         for (int m = 1; m &lt; length / 2; m *= 2) {</span>
<span class="line-removed">-             newLine = true;</span>
              int fromIndex = m;
              int toIndex = length - m;
  
<span class="line-modified">!             prepareSubArray(golden, fromIndex, toIndex, m);</span>
<span class="line-modified">!             int[] test = golden.clone();</span>
  
<span class="line-modified">!             for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified">!                 out.println(&quot;Test &#39;subarray&#39;: &quot; + converter +</span>
<span class="line-modified">!                    &quot; length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified">!                 Object convertedGolden = converter.convert(golden);</span>
<span class="line-modified">!                 Object convertedTest = converter.convert(test);</span>
<span class="line-removed">-                 sortSubArray(convertedTest, fromIndex, toIndex);</span>
<span class="line-removed">-                 checkSubArray(convertedTest, fromIndex, toIndex, m);</span>
              }
          }
<span class="line-modified">!         if (newLine) {</span>
<span class="line-removed">-             out.println();</span>
<span class="line-removed">-         }</span>
      }
  
<span class="line-modified">!     private static void testAndCheckRange(int length) {</span>
<span class="line-modified">!         ourDescription = &quot;Check range check&quot;;</span>
<span class="line-modified">!         int[] golden = new int[length];</span>
<span class="line-modified">! </span>
<span class="line-modified">!         for (int m = 1; m &lt; 2 * length; m *= 2) {</span>
              for (int i = 1; i &lt;= length; i++) {
<span class="line-modified">!                 golden[i - 1] = i % m + m % i;</span>
              }
<span class="line-modified">!             for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified">!                 out.println(&quot;Test &#39;range&#39;: &quot; + converter +</span>
<span class="line-modified">!                    &quot;, length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified">!                 Object convertedGolden = converter.convert(golden);</span>
<span class="line-modified">!                 checkRange(convertedGolden, m);</span>
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private static void testStable(int length, MyRandom random) {</span>
<span class="line-removed">-         ourDescription = &quot;Check if sorting is stable&quot;;</span>
<span class="line-removed">-         Pair[] a = build(length, random);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         out.println(&quot;Test &#39;stable&#39;: &quot; + &quot;random = &quot; + random.getSeed() +</span>
<span class="line-removed">-             &quot;, length = &quot; + length);</span>
<span class="line-removed">-         Arrays.sort(a);</span>
<span class="line-removed">-         checkSorted(a);</span>
<span class="line-removed">-         checkStable(a);</span>
<span class="line-removed">-         out.println();</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void checkSorted(Pair[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i].getKey() &gt; a[i + 1].getKey()) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i].getKey(), &quot;&quot; + a[i + 1].getKey());</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkStable(Pair[] a) {</span>
          for (int i = 0; i &lt; a.length / 4; ) {
              int key1 = a[i].getKey();
              int value1 = a[i++].getValue();
              int key2 = a[i].getKey();
              int value2 = a[i++].getValue();
<span class="line-new-header">--- 21,333 ---</span>
   * questions.
   */
  
  /*
   * @test
<span class="line-modified">!  * @compile/module=java.base java/util/SortingHelper.java</span>
<span class="line-modified">!  * @bug 6880672 6896573 6899694 6976036 7013585 7018258 8003981 8226297</span>
   * @build Sorting
   * @run main Sorting -shortrun
<span class="line-added">+  * @summary Exercise Arrays.sort, Arrays.parallelSort</span>
   *
   * @author Vladimir Yaroslavskiy
   * @author Jon Bentley
   * @author Josh Bloch
   */
  
  import java.io.PrintStream;
<span class="line-added">+ import java.util.Comparator;</span>
<span class="line-added">+ import java.util.Random;</span>
<span class="line-added">+ import java.util.SortingHelper;</span>
  
  public class Sorting {
<span class="line-added">+ </span>
      private static final PrintStream out = System.out;
      private static final PrintStream err = System.err;
  
      // Array lengths used in a long run (default)
      private static final int[] LONG_RUN_LENGTHS = {
<span class="line-modified">!         1, 3, 8, 21, 55, 100, 1_000, 10_000, 100_000 };</span>
  
      // Array lengths used in a short run
      private static final int[] SHORT_RUN_LENGTHS = {
<span class="line-modified">!         1, 8, 55, 100, 10_000 };</span>
  
      // Random initial values used in a long run (default)
<span class="line-modified">!     private static final TestRandom[] LONG_RUN_RANDOMS = {</span>
<span class="line-added">+         TestRandom.BABA, TestRandom.DEDA, TestRandom.C0FFEE };</span>
  
      // Random initial values used in a short run
<span class="line-modified">!     private static final TestRandom[] SHORT_RUN_RANDOMS = {</span>
<span class="line-added">+         TestRandom.C0FFEE };</span>
<span class="line-added">+ </span>
<span class="line-added">+     // Constants used in subarray sorting</span>
<span class="line-added">+     private static final int A380 = 0xA380;</span>
<span class="line-added">+     private static final int B747 = 0xB747;</span>
<span class="line-added">+ </span>
<span class="line-added">+     private final SortingHelper sortingHelper;</span>
<span class="line-added">+     private final TestRandom[] randoms;</span>
<span class="line-added">+     private final int[] lengths;</span>
<span class="line-added">+     private Object[] gold;</span>
<span class="line-added">+     private Object[] test;</span>
  
      public static void main(String[] args) {
          long start = System.currentTimeMillis();
<span class="line-added">+         boolean shortRun = args.length &gt; 0 &amp;&amp; args[0].equals(&quot;-shortrun&quot;);</span>
<span class="line-added">+ </span>
<span class="line-added">+         int[] lengths = shortRun ? SHORT_RUN_LENGTHS : LONG_RUN_LENGTHS;</span>
<span class="line-added">+         TestRandom[] randoms = shortRun ? SHORT_RUN_RANDOMS : LONG_RUN_RANDOMS;</span>
<span class="line-added">+ </span>
<span class="line-added">+         new Sorting(SortingHelper.DUAL_PIVOT_QUICKSORT, randoms, lengths).testCore();</span>
<span class="line-added">+         new Sorting(SortingHelper.PARALLEL_SORT, randoms, lengths).testCore();</span>
<span class="line-added">+         new Sorting(SortingHelper.HEAP_SORT, randoms, lengths).testBasic();</span>
<span class="line-added">+         new Sorting(SortingHelper.ARRAYS_SORT, randoms, lengths).testAll();</span>
<span class="line-added">+         new Sorting(SortingHelper.ARRAYS_PARALLEL_SORT, randoms, lengths).testAll();</span>
  
          long end = System.currentTimeMillis();
<span class="line-added">+         out.format(&quot;PASSED in %d sec.\n&quot;, (end - start) / 1000);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private Sorting(SortingHelper sortingHelper, TestRandom[] randoms, int[] lengths) {</span>
<span class="line-added">+         this.sortingHelper = sortingHelper;</span>
<span class="line-added">+         this.randoms = randoms;</span>
<span class="line-added">+         this.lengths = lengths;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void testBasic() {</span>
<span class="line-added">+         testEmptyArray();</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (int length : lengths) {</span>
<span class="line-added">+             createData(length);</span>
<span class="line-added">+             testBasic(length);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void testBasic(int length) {</span>
<span class="line-added">+         for (TestRandom random : randoms) {</span>
<span class="line-added">+             testWithInsertionSort(length, random);</span>
<span class="line-added">+             testWithCheckSum(length, random);</span>
<span class="line-added">+             testWithScrambling(length, random);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void testCore() {</span>
<span class="line-added">+         for (int length : lengths) {</span>
<span class="line-added">+             createData(length);</span>
<span class="line-added">+             testCore(length);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void testCore(int length) {</span>
<span class="line-added">+         testBasic(length);</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (TestRandom random : randoms) {</span>
<span class="line-added">+             testMergingSort(length, random);</span>
<span class="line-added">+             testSubArray(length, random);</span>
<span class="line-added">+             testNegativeZero(length, random);</span>
<span class="line-added">+             testFloatingPointSorting(length, random);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void testAll() {</span>
<span class="line-added">+         for (int length : lengths) {</span>
<span class="line-added">+             createData(length);</span>
<span class="line-added">+             testAll(length);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void testAll(int length) {</span>
<span class="line-added">+         testCore(length);</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (TestRandom random : randoms) {</span>
<span class="line-added">+             testRange(length, random);</span>
<span class="line-added">+             testStability(length, random);</span>
<span class="line-added">+         }</span>
      }
  
<span class="line-modified">!     private void testEmptyArray() {</span>
          testEmptyAndNullIntArray();
          testEmptyAndNullLongArray();
          testEmptyAndNullByteArray();
<span class="line-added">+         testEmptyAndNullCharArray();</span>
<span class="line-added">+         testEmptyAndNullShortArray();</span>
          testEmptyAndNullFloatArray();
          testEmptyAndNullDoubleArray();
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void testStability(int length, TestRandom random) {</span>
<span class="line-modified">!         printTestName(&quot;Test stability&quot;, random, length);</span>
<span class="line-modified">! </span>
<span class="line-modified">!         Pair[] a = build(length, random);</span>
<span class="line-modified">!         sortingHelper.sort(a);</span>
<span class="line-modified">!         checkSorted(a);</span>
<span class="line-modified">!         checkStable(a);</span>
<span class="line-modified">! </span>
<span class="line-modified">!         a = build(length, random);</span>
<span class="line-modified">!         sortingHelper.sort(a, pairComparator);</span>
<span class="line-modified">!         checkSorted(a);</span>
<span class="line-modified">!         checkStable(a);</span>
<span class="line-modified">! </span>
<span class="line-modified">!         out.println();</span>
      }
  
<span class="line-modified">!     private void testEmptyAndNullIntArray() {</span>
<span class="line-modified">!         sortingHelper.sort(new int[] {});</span>
<span class="line-modified">!         sortingHelper.sort(new int[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             sortingHelper.sort(null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 sortingHelper.sort(null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             fail(sortingHelper + &quot;(int[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         fail(sortingHelper + &quot;(int[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private void testEmptyAndNullLongArray() {</span>
<span class="line-modified">!         sortingHelper.sort(new long[] {});</span>
<span class="line-modified">!         sortingHelper.sort(new long[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             sortingHelper.sort(null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 sortingHelper.sort(null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             fail(sortingHelper + &quot;(long[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         fail(sortingHelper + &quot;(long[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private void testEmptyAndNullByteArray() {</span>
<span class="line-modified">!         sortingHelper.sort(new byte[] {});</span>
<span class="line-modified">!         sortingHelper.sort(new byte[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             sortingHelper.sort(null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 sortingHelper.sort(null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             fail(sortingHelper + &quot;(byte[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         fail(sortingHelper + &quot;(byte[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private void testEmptyAndNullCharArray() {</span>
<span class="line-modified">!         sortingHelper.sort(new char[] {});</span>
<span class="line-modified">!         sortingHelper.sort(new char[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             sortingHelper.sort(null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 sortingHelper.sort(null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             fail(sortingHelper + &quot;(char[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         fail(sortingHelper + &quot;(char[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private void testEmptyAndNullShortArray() {</span>
<span class="line-modified">!         sortingHelper.sort(new short[] {});</span>
<span class="line-modified">!         sortingHelper.sort(new short[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             sortingHelper.sort(null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 sortingHelper.sort(null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             fail(sortingHelper + &quot;(short[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         fail(sortingHelper + &quot;(short[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private void testEmptyAndNullFloatArray() {</span>
<span class="line-modified">!         sortingHelper.sort(new float[] {});</span>
<span class="line-modified">!         sortingHelper.sort(new float[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             sortingHelper.sort(null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 sortingHelper.sort(null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             fail(sortingHelper + &quot;(float[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         fail(sortingHelper + &quot;(float[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private void testEmptyAndNullDoubleArray() {</span>
<span class="line-modified">!         sortingHelper.sort(new double[] {});</span>
<span class="line-modified">!         sortingHelper.sort(new double[] {}, 0, 0);</span>
  
          try {
<span class="line-modified">!             sortingHelper.sort(null);</span>
          } catch (NullPointerException expected) {
              try {
<span class="line-modified">!                 sortingHelper.sort(null, 0, 0);</span>
              } catch (NullPointerException expected2) {
                  return;
              }
<span class="line-modified">!             fail(sortingHelper + &quot;(double[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
                  &quot;catch null array&quot;);
          }
<span class="line-modified">!         fail(sortingHelper + &quot;(double[]) shouldn&#39;t catch null array&quot;);</span>
      }
  
<span class="line-modified">!     private void testSubArray(int length, TestRandom random) {</span>
<span class="line-modified">!         if (length &lt; 4) {</span>
<span class="line-modified">!             return;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         for (int m = 1; m &lt; length / 2; m &lt;&lt;= 1) {</span>
              int fromIndex = m;
              int toIndex = length - m;
  
<span class="line-modified">!             prepareSubArray((int[]) gold[0], fromIndex, toIndex);</span>
<span class="line-modified">!             convertData(length);</span>
  
<span class="line-modified">!             for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified">!                 printTestName(&quot;Test subarray&quot;, random, length,</span>
<span class="line-modified">!                     &quot;, m = &quot; + m + &quot;, &quot; + getType(i));</span>
<span class="line-modified">!                 sortingHelper.sort(test[i], fromIndex, toIndex);</span>
<span class="line-modified">!                 checkSubArray(test[i], fromIndex, toIndex);</span>
              }
          }
<span class="line-modified">!         out.println();</span>
      }
  
<span class="line-modified">!     private void testRange(int length, TestRandom random) {</span>
<span class="line-modified">!         if (length &lt; 2) {</span>
<span class="line-modified">!             return;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         for (int m = 1; m &lt; length; m &lt;&lt;= 1) {</span>
              for (int i = 1; i &lt;= length; i++) {
<span class="line-modified">!                 ((int[]) gold[0]) [i - 1] = i % m + m % i;</span>
              }
<span class="line-modified">!             convertData(length);</span>
<span class="line-modified">! </span>
<span class="line-modified">!             for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified">!                 printTestName(&quot;Test range check&quot;, random, length,</span>
<span class="line-modified">!                     &quot;, m = &quot; + m + &quot;, &quot; + getType(i));</span>
<span class="line-added">+                 checkRange(test[i], m);</span>
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private void checkSorted(Pair[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i].getKey() &gt; a[i + 1].getKey()) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; +</span>
<span class="line-added">+                     a[i].getKey() + &quot; and &quot; + a[i + 1].getKey());</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkStable(Pair[] a) {</span>
          for (int i = 0; i &lt; a.length / 4; ) {
              int key1 = a[i].getKey();
              int value1 = a[i++].getValue();
              int key2 = a[i].getKey();
              int value2 = a[i++].getValue();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 303,22 ***</span>
              int value3 = a[i++].getValue();
              int key4 = a[i].getKey();
              int value4 = a[i++].getValue();
  
              if (!(key1 == key2 &amp;&amp; key2 == key3 &amp;&amp; key3 == key4)) {
<span class="line-modified">!                 failed(&quot;On position &quot; + i + &quot; keys are different &quot; +</span>
<span class="line-modified">!                     key1 + &quot;, &quot; + key2 + &quot;, &quot; + key3 + &quot;, &quot; + key4);</span>
              }
              if (!(value1 &lt; value2 &amp;&amp; value2 &lt; value3 &amp;&amp; value3 &lt; value4)) {
<span class="line-modified">!                 failed(&quot;Sorting is not stable at position &quot; + i +</span>
<span class="line-modified">!                     &quot;. Second values have been changed: &quot; +  value1 + &quot;, &quot; +</span>
                      value2 + &quot;, &quot; + value3 + &quot;, &quot; + value4);
              }
          }
      }
  
<span class="line-modified">!     private static Pair[] build(int length, Random random) {</span>
          Pair[] a = new Pair[length * 4];
  
          for (int i = 0; i &lt; a.length; ) {
              int key = random.nextInt();
              a[i++] = new Pair(key, 1);
<span class="line-new-header">--- 355,22 ---</span>
              int value3 = a[i++].getValue();
              int key4 = a[i].getKey();
              int value4 = a[i++].getValue();
  
              if (!(key1 == key2 &amp;&amp; key2 == key3 &amp;&amp; key3 == key4)) {
<span class="line-modified">!                 fail(&quot;Keys are different &quot; + key1 + &quot;, &quot; + key2 + &quot;, &quot; +</span>
<span class="line-modified">!                     key3 + &quot;, &quot; + key4 + &quot; at position &quot; + i);</span>
              }
              if (!(value1 &lt; value2 &amp;&amp; value2 &lt; value3 &amp;&amp; value3 &lt; value4)) {
<span class="line-modified">!                 fail(&quot;Sorting is not stable at position &quot; + i +</span>
<span class="line-modified">!                     &quot;. Second values have been changed: &quot; + value1 + &quot;, &quot; +</span>
                      value2 + &quot;, &quot; + value3 + &quot;, &quot; + value4);
              }
          }
      }
  
<span class="line-modified">!     private Pair[] build(int length, Random random) {</span>
          Pair[] a = new Pair[length * 4];
  
          for (int i = 0; i &lt; a.length; ) {
              int key = random.nextInt();
              a[i++] = new Pair(key, 1);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 327,1718 ***</span>
              a[i++] = new Pair(key, 4);
          }
          return a;
      }
  
<span class="line-modified">!     private static final class Pair implements Comparable&lt;Pair&gt; {</span>
<span class="line-removed">-         Pair(int key, int value) {</span>
<span class="line-removed">-             myKey = key;</span>
<span class="line-removed">-             myValue = value;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         int getKey() {</span>
<span class="line-removed">-             return myKey;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         int getValue() {</span>
<span class="line-removed">-             return myValue;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         public int compareTo(Pair pair) {</span>
<span class="line-removed">-             if (myKey &lt; pair.myKey) {</span>
<span class="line-removed">-                 return -1;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             if (myKey &gt; pair.myKey) {</span>
<span class="line-removed">-                 return 1;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             return 0;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         @Override</span>
<span class="line-removed">-         public String toString() {</span>
<span class="line-removed">-             return &quot;(&quot; + myKey + &quot;, &quot; + myValue + &quot;)&quot;;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         private int myKey;</span>
<span class="line-removed">-         private int myValue;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void testAndCheckWithInsertionSort(int length, MyRandom random) {</span>
          if (length &gt; 1000) {
              return;
          }
<span class="line-modified">!         ourDescription = &quot;Check sorting with insertion sort&quot;;</span>
<span class="line-removed">-         int[] golden = new int[length];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         for (int m = 1; m &lt; 2 * length; m *= 2) {</span>
              for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<span class="line-modified">!                 builder.build(golden, m, random);</span>
<span class="line-modified">!                 int[] test = golden.clone();</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified">!                     out.println(&quot;Test &#39;insertion sort&#39;: &quot; + converter +</span>
<span class="line-modified">!                         &quot; &quot; + builder + &quot;random = &quot; + random.getSeed() +</span>
<span class="line-modified">!                         &quot;, length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified">!                     Object convertedGolden = converter.convert(golden);</span>
<span class="line-modified">!                     Object convertedTest1 = converter.convert(test);</span>
<span class="line-removed">-                     Object convertedTest2 = converter.convert(test);</span>
<span class="line-removed">-                     sort(convertedTest1);</span>
<span class="line-removed">-                     sortByInsertionSort(convertedTest2);</span>
<span class="line-removed">-                     compare(convertedTest1, convertedTest2);</span>
                  }
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private static void testMergeSort(int length) {</span>
<span class="line-modified">!         if (length &lt; 1000) {</span>
              return;
          }
<span class="line-modified">!         ourDescription = &quot;Check merge sorting&quot;;</span>
<span class="line-modified">!         int[] golden = new int[length];</span>
<span class="line-modified">!         int period = 67; // java.util.DualPivotQuicksort.MAX_RUN_COUNT</span>
<span class="line-modified">! </span>
<span class="line-modified">!         for (int m = period - 2; m &lt;= period + 2; m++) {</span>
<span class="line-modified">!             for (MergeBuilder builder : MergeBuilder.values()) {</span>
<span class="line-modified">!                 builder.build(golden, m);</span>
<span class="line-modified">!                 int[] test = golden.clone();</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified">!                     out.println(&quot;Test &#39;merge sort&#39;: &quot; + converter + &quot; &quot; +</span>
<span class="line-modified">!                         builder + &quot;length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-removed">-                     Object convertedGolden = converter.convert(golden);</span>
<span class="line-removed">-                     sort(convertedGolden);</span>
<span class="line-removed">-                     checkSorted(convertedGolden);</span>
                  }
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private static void testAndCheckWithCheckSum(int length, MyRandom random) {</span>
<span class="line-modified">!         ourDescription = &quot;Check sorting with check sum&quot;;</span>
<span class="line-removed">-         int[] golden = new int[length];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         for (int m = 1; m &lt; 2 * length; m *= 2) {</span>
              for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<span class="line-modified">!                 builder.build(golden, m, random);</span>
<span class="line-modified">!                 int[] test = golden.clone();</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified">!                     out.println(&quot;Test &#39;check sum&#39;: &quot; + converter +</span>
<span class="line-modified">!                         &quot; &quot; + builder + &quot;random = &quot; + random.getSeed() +</span>
<span class="line-modified">!                         &quot;, length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified">!                     Object convertedGolden = converter.convert(golden);</span>
<span class="line-removed">-                     Object convertedTest = converter.convert(test);</span>
<span class="line-removed">-                     sort(convertedTest);</span>
<span class="line-removed">-                     checkWithCheckSum(convertedTest, convertedGolden);</span>
                  }
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private static void testAndCheckWithScrambling(int length, MyRandom random) {</span>
<span class="line-modified">!         ourDescription = &quot;Check sorting with scrambling&quot;;</span>
<span class="line-removed">-         int[] golden = new int[length];</span>
<span class="line-removed">- </span>
<span class="line-removed">-         for (int m = 1; m &lt;= 7; m++) {</span>
<span class="line-removed">-             if (m &gt; length) {</span>
<span class="line-removed">-                 break;</span>
<span class="line-removed">-             }</span>
              for (SortedBuilder builder : SortedBuilder.values()) {
<span class="line-modified">!                 builder.build(golden, m);</span>
<span class="line-modified">!                 int[] test = golden.clone();</span>
<span class="line-modified">!                 scramble(test, random);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified">!                     out.println(&quot;Test &#39;scrambling&#39;: &quot; + converter +</span>
<span class="line-modified">!                        &quot; &quot; + builder + &quot;random = &quot; + random.getSeed() +</span>
<span class="line-modified">!                        &quot;, length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified">!                     Object convertedGolden = converter.convert(golden);</span>
<span class="line-removed">-                     Object convertedTest = converter.convert(test);</span>
<span class="line-removed">-                     sort(convertedTest);</span>
<span class="line-removed">-                     compare(convertedTest, convertedGolden);</span>
                  }
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private static void testAndCheckFloat(int length, MyRandom random) {</span>
<span class="line-modified">!         ourDescription = &quot;Check float sorting&quot;;</span>
<span class="line-modified">!         float[] golden = new float[length];</span>
<span class="line-removed">-         final int MAX = 10;</span>
<span class="line-removed">-         boolean newLine = false;</span>
  
<span class="line-modified">!         for (int a = 0; a &lt;= MAX; a++) {</span>
<span class="line-modified">!             for (int g = 0; g &lt;= MAX; g++) {</span>
<span class="line-modified">!                 for (int z = 0; z &lt;= MAX; z++) {</span>
<span class="line-modified">!                     for (int n = 0; n &lt;= MAX; n++) {</span>
<span class="line-modified">!                         for (int p = 0; p &lt;= MAX; p++) {</span>
<span class="line-removed">-                             if (a + g + z + n + p &gt; length) {</span>
<span class="line-removed">-                                 continue;</span>
<span class="line-removed">-                             }</span>
<span class="line-removed">-                             if (a + g + z + n + p &lt; length) {</span>
<span class="line-removed">-                                 continue;</span>
<span class="line-removed">-                             }</span>
<span class="line-removed">-                             for (FloatBuilder builder : FloatBuilder.values()) {</span>
<span class="line-removed">-                                 out.println(&quot;Test &#39;float&#39;: random = &quot; + random.getSeed() +</span>
<span class="line-removed">-                                    &quot;, length = &quot; + length + &quot;, a = &quot; + a + &quot;, g = &quot; +</span>
<span class="line-removed">-                                    g + &quot;, z = &quot; + z + &quot;, n = &quot; + n + &quot;, p = &quot; + p);</span>
<span class="line-removed">-                                 builder.build(golden, a, g, z, n, p, random);</span>
<span class="line-removed">-                                 float[] test = golden.clone();</span>
<span class="line-removed">-                                 scramble(test, random);</span>
<span class="line-removed">-                                 sort(test);</span>
<span class="line-removed">-                                 compare(test, golden, a, n, g);</span>
<span class="line-removed">-                             }</span>
<span class="line-removed">-                             newLine = true;</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         if (newLine) {</span>
<span class="line-removed">-             out.println();</span>
          }
      }
  
<span class="line-modified">!     private static void testAndCheckDouble(int length, MyRandom random) {</span>
<span class="line-modified">!         ourDescription = &quot;Check double sorting&quot;;</span>
<span class="line-modified">!         double[] golden = new double[length];</span>
<span class="line-modified">!         final int MAX = 10;</span>
<span class="line-modified">!         boolean newLine = false;</span>
  
<span class="line-modified">!         for (int a = 0; a &lt;= MAX; a++) {</span>
<span class="line-modified">!             for (int g = 0; g &lt;= MAX; g++) {</span>
<span class="line-modified">!                 for (int z = 0; z &lt;= MAX; z++) {</span>
<span class="line-modified">!                     for (int n = 0; n &lt;= MAX; n++) {</span>
<span class="line-modified">!                         for (int p = 0; p &lt;= MAX; p++) {</span>
<span class="line-modified">!                             if (a + g + z + n + p &gt; length) {</span>
<span class="line-removed">-                                 continue;</span>
<span class="line-removed">-                             }</span>
<span class="line-removed">-                             if (a + g + z + n + p &lt; length) {</span>
                                  continue;
                              }
<span class="line-modified">!                             for (DoubleBuilder builder : DoubleBuilder.values()) {</span>
<span class="line-modified">!                                 out.println(&quot;Test &#39;double&#39;: random = &quot; + random.getSeed() +</span>
<span class="line-modified">!                                    &quot;, length = &quot; + length + &quot;, a = &quot; + a + &quot;, g = &quot; +</span>
<span class="line-modified">!                                    g + &quot;, z = &quot; + z + &quot;, n = &quot; + n + &quot;, p = &quot; + p);</span>
<span class="line-modified">!                                 builder.build(golden, a, g, z, n, p, random);</span>
<span class="line-modified">!                                 double[] test = golden.clone();</span>
<span class="line-modified">!                                 scramble(test, random);</span>
<span class="line-modified">!                                 sort(test);</span>
<span class="line-modified">!                                 compare(test, golden, a, n, g);</span>
                              }
<span class="line-removed">-                             newLine = true;</span>
                          }
                      }
                  }
              }
          }
<span class="line-modified">!         if (newLine) {</span>
<span class="line-modified">!             out.println();</span>
          }
      }
  
<span class="line-modified">!     private static void prepareSubArray(int[] a, int fromIndex, int toIndex, int m) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             a[i] = 0xDEDA;</span>
          }
          int middle = (fromIndex + toIndex) &gt;&gt;&gt; 1;
          int k = 0;
  
          for (int i = fromIndex; i &lt; middle; i++) {
              a[i] = k++;
          }
          for (int i = middle; i &lt; toIndex; i++) {
              a[i] = k--;
          }
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             a[i] = 0xBABA;</span>
          }
      }
  
<span class="line-modified">!     private static void scramble(int[] a, Random random) {</span>
          for (int i = 0; i &lt; a.length * 7; i++) {
              swap(a, random.nextInt(a.length), random.nextInt(a.length));
          }
      }
  
<span class="line-modified">!     private static void scramble(float[] a, Random random) {</span>
          for (int i = 0; i &lt; a.length * 7; i++) {
              swap(a, random.nextInt(a.length), random.nextInt(a.length));
          }
      }
  
<span class="line-modified">!     private static void scramble(double[] a, Random random) {</span>
          for (int i = 0; i &lt; a.length * 7; i++) {
              swap(a, random.nextInt(a.length), random.nextInt(a.length));
          }
      }
  
<span class="line-modified">!     private static void swap(int[] a, int i, int j) {</span>
<span class="line-modified">!         int t = a[i];</span>
<span class="line-modified">!         a[i] = a[j];</span>
<span class="line-modified">!         a[j] = t;</span>
      }
  
<span class="line-modified">!     private static void swap(float[] a, int i, int j) {</span>
<span class="line-modified">!         float t = a[i];</span>
<span class="line-modified">!         a[i] = a[j];</span>
<span class="line-modified">!         a[j] = t;</span>
      }
  
<span class="line-modified">!     private static void swap(double[] a, int i, int j) {</span>
<span class="line-modified">!         double t = a[i];</span>
<span class="line-modified">!         a[i] = a[j];</span>
<span class="line-modified">!         a[j] = t;</span>
      }
  
<span class="line-modified">!     private static enum TypeConverter {</span>
<span class="line-modified">!         INT {</span>
<span class="line-modified">!             Object convert(int[] a) {</span>
<span class="line-modified">!                 return a.clone();</span>
<span class="line-modified">!             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         LONG {</span>
<span class="line-removed">-             Object convert(int[] a) {</span>
<span class="line-removed">-                 long[] b = new long[a.length];</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     b[i] = (long) a[i];</span>
<span class="line-modified">!                 }</span>
<span class="line-removed">-                 return b;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         BYTE {</span>
<span class="line-removed">-             Object convert(int[] a) {</span>
<span class="line-removed">-                 byte[] b = new byte[a.length];</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     b[i] = (byte) a[i];</span>
<span class="line-modified">!                 }</span>
<span class="line-removed">-                 return b;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         SHORT {</span>
<span class="line-removed">-             Object convert(int[] a) {</span>
<span class="line-removed">-                 short[] b = new short[a.length];</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     b[i] = (short) a[i];</span>
<span class="line-modified">!                 }</span>
<span class="line-removed">-                 return b;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         CHAR {</span>
<span class="line-removed">-             Object convert(int[] a) {</span>
<span class="line-removed">-                 char[] b = new char[a.length];</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     b[i] = (char) a[i];</span>
<span class="line-modified">!                 }</span>
<span class="line-removed">-                 return b;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         FLOAT {</span>
<span class="line-removed">-             Object convert(int[] a) {</span>
<span class="line-removed">-                 float[] b = new float[a.length];</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     b[i] = (float) a[i];</span>
<span class="line-modified">!                 }</span>
<span class="line-removed">-                 return b;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         DOUBLE {</span>
<span class="line-removed">-             Object convert(int[] a) {</span>
<span class="line-removed">-                 double[] b = new double[a.length];</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     b[i] = (double) a[i];</span>
<span class="line-modified">!                 }</span>
<span class="line-removed">-                 return b;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         INTEGER {</span>
<span class="line-removed">-             Object convert(int[] a) {</span>
<span class="line-removed">-                 Integer[] b = new Integer[a.length];</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     b[i] = new Integer(a[i]);</span>
<span class="line-modified">!                 }</span>
<span class="line-removed">-                 return b;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         };</span>
  
<span class="line-modified">!         abstract Object convert(int[] a);</span>
  
<span class="line-modified">!         @Override public String toString() {</span>
<span class="line-modified">!             String name = name();</span>
  
<span class="line-modified">!             for (int i = name.length(); i &lt; 9; i++) {</span>
<span class="line-modified">!                 name += &quot; &quot;;</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             return name;</span>
          }
      }
  
<span class="line-modified">!     private static enum FloatBuilder {</span>
<span class="line-modified">!         SIMPLE {</span>
<span class="line-modified">!             void build(float[] x, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-modified">!                 int fromIndex = 0;</span>
<span class="line-removed">-                 float negativeValue = -random.nextFloat();</span>
<span class="line-removed">-                 float positiveValue =  random.nextFloat();</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-removed">-                 fromIndex += n;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, -0.0f, fromIndex, g);</span>
<span class="line-removed">-                 fromIndex += g;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, 0.0f, fromIndex, z);</span>
<span class="line-removed">-                 fromIndex += z;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-removed">-                 fromIndex += p;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, Float.NaN, fromIndex, a);</span>
              }
<span class="line-modified">!         };</span>
<span class="line-removed">- </span>
<span class="line-removed">-         abstract void build(float[] x, int a, int g, int z, int n, int p, Random random);</span>
      }
  
<span class="line-modified">!     private static enum DoubleBuilder {</span>
<span class="line-modified">!         SIMPLE {</span>
<span class="line-modified">!             void build(double[] x, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-modified">!                 int fromIndex = 0;</span>
<span class="line-removed">-                 double negativeValue = -random.nextFloat();</span>
<span class="line-removed">-                 double positiveValue =  random.nextFloat();</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-removed">-                 fromIndex += n;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, -0.0d, fromIndex, g);</span>
<span class="line-removed">-                 fromIndex += g;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, 0.0d, fromIndex, z);</span>
<span class="line-removed">-                 fromIndex += z;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-removed">-                 fromIndex += p;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 writeValue(x, Double.NaN, fromIndex, a);</span>
              }
<span class="line-modified">!         };</span>
<span class="line-removed">- </span>
<span class="line-removed">-         abstract void build(double[] x, int a, int g, int z, int n, int p, Random random);</span>
      }
  
<span class="line-modified">!     private static void writeValue(float[] a, float value, int fromIndex, int count) {</span>
<span class="line-modified">!         for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-modified">!             a[i] = value;</span>
          }
      }
  
<span class="line-modified">!     private static void compare(float[] a, float[] b, int numNaN, int numNeg, int numNegZero) {</span>
          for (int i = a.length - numNaN; i &lt; a.length; i++) {
              if (a[i] == a[i]) {
<span class="line-modified">!                 failed(&quot;On position &quot; + i + &quot; must be NaN instead of &quot; + a[i]);</span>
              }
          }
          final int NEGATIVE_ZERO = Float.floatToIntBits(-0.0f);
  
          for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
              if (NEGATIVE_ZERO != Float.floatToIntBits(a[i])) {
<span class="line-modified">!                 failed(&quot;On position &quot; + i + &quot; must be -0.0 instead of &quot; + a[i]);</span>
              }
          }
          for (int i = 0; i &lt; a.length - numNaN; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void writeValue(double[] a, double value, int fromIndex, int count) {</span>
<span class="line-removed">-         for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-removed">-             a[i] = value;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void compare(double[] a, double[] b, int numNaN, int numNeg, int numNegZero) {</span>
          for (int i = a.length - numNaN; i &lt; a.length; i++) {
              if (a[i] == a[i]) {
<span class="line-modified">!                 failed(&quot;On position &quot; + i + &quot; must be NaN instead of &quot; + a[i]);</span>
              }
          }
          final long NEGATIVE_ZERO = Double.doubleToLongBits(-0.0d);
  
          for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
              if (NEGATIVE_ZERO != Double.doubleToLongBits(a[i])) {
<span class="line-modified">!                 failed(&quot;On position &quot; + i + &quot; must be -0.0 instead of &quot; + a[i]);</span>
              }
          }
          for (int i = 0; i &lt; a.length - numNaN; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
<span class="line-modified">!             }</span>
          }
      }
  
<span class="line-modified">!     private static enum SortedBuilder {</span>
<span class="line-modified">!         REPEATED {</span>
<span class="line-modified">!             void build(int[] a, int m) {</span>
<span class="line-modified">!                 int period = a.length / m;</span>
<span class="line-modified">!                 int i = 0;</span>
<span class="line-modified">!                 int k = 0;</span>
  
<span class="line-modified">!                 while (true) {</span>
<span class="line-modified">!                     for (int t = 1; t &lt;= period; t++) {</span>
<span class="line-modified">!                         if (i &gt;= a.length) {</span>
<span class="line-modified">!                             return;</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                         a[i++] = k;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     if (i &gt;= a.length) {</span>
<span class="line-removed">-                         return;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     k++;</span>
<span class="line-removed">-                 }</span>
              }
<span class="line-modified">!         },</span>
<span class="line-modified">!         ORGAN_PIPES {</span>
<span class="line-removed">-             void build(int[] a, int m) {</span>
<span class="line-removed">-                 int i = 0;</span>
<span class="line-removed">-                 int k = m;</span>
  
<span class="line-modified">!                 while (true) {</span>
<span class="line-removed">-                     for (int t = 1; t &lt;= m; t++) {</span>
<span class="line-removed">-                         if (i &gt;= a.length) {</span>
<span class="line-removed">-                             return;</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                         a[i++] = k;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         };</span>
<span class="line-removed">- </span>
<span class="line-removed">-         abstract void build(int[] a, int m);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         @Override public String toString() {</span>
<span class="line-removed">-             String name = name();</span>
<span class="line-removed">- </span>
<span class="line-removed">-             for (int i = name.length(); i &lt; 12; i++) {</span>
<span class="line-removed">-                 name += &quot; &quot;;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             return name;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static enum MergeBuilder {</span>
<span class="line-removed">-         ASCENDING {</span>
<span class="line-removed">-             void build(int[] a, int m) {</span>
<span class="line-removed">-                 int period = a.length / m;</span>
<span class="line-removed">-                 int v = 1, i = 0;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-removed">-                     v = 1;</span>
<span class="line-removed">-                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-removed">-                         a[i++] = v++;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-removed">-                     a[j] = v++;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 a[a.length - 1] = 0;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         DESCENDING {</span>
<span class="line-removed">-             void build(int[] a, int m) {</span>
<span class="line-removed">-                 int period = a.length / m;</span>
<span class="line-removed">-                 int v = -1, i = 0;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-removed">-                     v = -1;</span>
<span class="line-removed">-                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-removed">-                         a[i++] = v--;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-removed">-                     a[j] = v--;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 a[a.length - 1] = 0;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         };</span>
<span class="line-removed">- </span>
<span class="line-removed">-         abstract void build(int[] a, int m);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         @Override public String toString() {</span>
<span class="line-removed">-             String name = name();</span>
<span class="line-removed">- </span>
<span class="line-removed">-             for (int i = name.length(); i &lt; 12; i++) {</span>
<span class="line-removed">-                 name += &quot; &quot;;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             return name;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static enum UnsortedBuilder {</span>
<span class="line-removed">-         RANDOM {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = random.nextInt();</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         ASCENDING {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = m + i;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         DESCENDING {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = a.length - m - i;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         ALL_EQUAL {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = m;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         SAW {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 int incCount = 1;</span>
<span class="line-removed">-                 int decCount = a.length;</span>
<span class="line-removed">-                 int i = 0;</span>
<span class="line-removed">-                 int period = m--;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 while (true) {</span>
<span class="line-removed">-                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-removed">-                         if (i &gt;= a.length) {</span>
<span class="line-removed">-                             return;</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                         a[i++] = incCount++;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     period += m;</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-removed">-                         if (i &gt;= a.length) {</span>
<span class="line-removed">-                             return;</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                         a[i++] = decCount--;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     period += m;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         REPEATED {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = i % m;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         DUPLICATED {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = random.nextInt(m);</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         ORGAN_PIPES {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 int middle = a.length / (m + 1);</span>
<span class="line-removed">- </span>
<span class="line-removed">-                 for (int i = 0; i &lt; middle; i++) {</span>
<span class="line-removed">-                     a[i] = i;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 for (int i = middle; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = a.length - i - 1;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         STAGGER {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = (i * m + i) % a.length;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         PLATEAU {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = Math.min(i, m);</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         },</span>
<span class="line-removed">-         SHUFFLE {</span>
<span class="line-removed">-             void build(int[] a, int m, Random random) {</span>
<span class="line-removed">-                 int x = 0, y = 0;</span>
<span class="line-removed">-                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-                     a[i] = random.nextBoolean() ? (x += 2) : (y += 2);</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         };</span>
<span class="line-removed">- </span>
<span class="line-removed">-         abstract void build(int[] a, int m, Random random);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         @Override public String toString() {</span>
<span class="line-removed">-             String name = name();</span>
<span class="line-removed">- </span>
<span class="line-removed">-             for (int i = name.length(); i &lt; 12; i++) {</span>
<span class="line-removed">-                 name += &quot; &quot;;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             return name;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void checkWithCheckSum(Object test, Object golden) {</span>
<span class="line-removed">-         checkSorted(test);</span>
<span class="line-removed">-         checkCheckSum(test, golden);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void failed(String message) {</span>
<span class="line-removed">-         err.format(&quot;\n*** TEST FAILED - %s.\n\n%s.\n\n&quot;, ourDescription, message);</span>
<span class="line-removed">-         throw new RuntimeException(&quot;Test failed - see log file for details&quot;);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void failedSort(int index, String value1, String value2) {</span>
<span class="line-removed">-         failed(&quot;Array is not sorted at &quot; + index + &quot;-th position: &quot; +</span>
<span class="line-removed">-             value1 + &quot; and &quot; + value2);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void failedCompare(int index, String value1, String value2) {</span>
<span class="line-removed">-         failed(&quot;On position &quot; + index + &quot; must be &quot; + value2 + &quot; instead of &quot; + value1);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void compare(Object test, Object golden) {</span>
<span class="line-removed">-         if (test instanceof int[]) {</span>
<span class="line-removed">-             compare((int[]) test, (int[]) golden);</span>
<span class="line-removed">-         } else if (test instanceof long[]) {</span>
<span class="line-removed">-             compare((long[]) test, (long[]) golden);</span>
<span class="line-removed">-         } else if (test instanceof short[]) {</span>
<span class="line-removed">-             compare((short[]) test, (short[]) golden);</span>
<span class="line-removed">-         } else if (test instanceof byte[]) {</span>
<span class="line-removed">-             compare((byte[]) test, (byte[]) golden);</span>
<span class="line-removed">-         } else if (test instanceof char[]) {</span>
<span class="line-removed">-             compare((char[]) test, (char[]) golden);</span>
<span class="line-removed">-         } else if (test instanceof float[]) {</span>
<span class="line-removed">-             compare((float[]) test, (float[]) golden);</span>
<span class="line-removed">-         } else if (test instanceof double[]) {</span>
<span class="line-removed">-             compare((double[]) test, (double[]) golden);</span>
<span class="line-removed">-         } else if (test instanceof Integer[]) {</span>
<span class="line-removed">-             compare((Integer[]) test, (Integer[]) golden);</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             failed(&quot;Unknow type of array: &quot; + test + &quot; of class &quot; +</span>
<span class="line-removed">-                 test.getClass().getName());</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void compare(int[] a, int[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void compare(long[] a, long[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void compare(short[] a, short[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void compare(byte[] a, byte[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void compare(char[] a, char[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void compare(float[] a, float[] b) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">-             if (a[i] != b[i]) {</span>
<span class="line-removed">-                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     private static void compare(double[] a, double[] b) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!             if (a[i] != b[i]) {</span>
<span class="line-modified">!                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
<span class="line-modified">!             }</span>
          }
      }
  
<span class="line-modified">!     private static void compare(Integer[] a, Integer[] b) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!             if (a[i].compareTo(b[i]) != 0) {</span>
<span class="line-modified">!                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private static void checkSorted(Object object) {</span>
<span class="line-modified">!         if (object instanceof int[]) {</span>
<span class="line-modified">!             checkSorted((int[]) object);</span>
<span class="line-modified">!         } else if (object instanceof long[]) {</span>
<span class="line-modified">!             checkSorted((long[]) object);</span>
<span class="line-modified">!         } else if (object instanceof short[]) {</span>
<span class="line-modified">!             checkSorted((short[]) object);</span>
<span class="line-removed">-         } else if (object instanceof byte[]) {</span>
<span class="line-removed">-             checkSorted((byte[]) object);</span>
<span class="line-removed">-         } else if (object instanceof char[]) {</span>
<span class="line-removed">-             checkSorted((char[]) object);</span>
<span class="line-removed">-         } else if (object instanceof float[]) {</span>
<span class="line-removed">-             checkSorted((float[]) object);</span>
<span class="line-removed">-         } else if (object instanceof double[]) {</span>
<span class="line-removed">-             checkSorted((double[]) object);</span>
<span class="line-removed">-         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">-             checkSorted((Integer[]) object);</span>
          } else {
<span class="line-modified">!             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">-                 object.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private static void checkSorted(int[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSorted(long[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSorted(short[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSorted(byte[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSorted(char[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSorted(float[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSorted(double[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSorted(Integer[] a) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length - 1; i++) {</span>
<span class="line-modified">!             if (a[i].intValue() &gt; a[i + 1].intValue()) {</span>
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
<span class="line-modified">!             }</span>
          }
      }
  
<span class="line-modified">!     private static void checkCheckSum(Object test, Object golden) {</span>
<span class="line-modified">!         if (checkSumXor(test) != checkSumXor(golden)) {</span>
<span class="line-modified">!             failed(&quot;Original and sorted arrays are not identical [xor]&quot;);</span>
          }
<span class="line-modified">!         if (checkSumPlus(test) != checkSumPlus(golden)) {</span>
<span class="line-modified">!             failed(&quot;Original and sorted arrays are not identical [plus]&quot;);</span>
          }
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-removed">-     private static int checkSumXor(Object object) {</span>
<span class="line-removed">-         if (object instanceof int[]) {</span>
<span class="line-removed">-             return checkSumXor((int[]) object);</span>
<span class="line-removed">-         } else if (object instanceof long[]) {</span>
<span class="line-removed">-             return checkSumXor((long[]) object);</span>
<span class="line-removed">-         } else if (object instanceof short[]) {</span>
<span class="line-removed">-             return checkSumXor((short[]) object);</span>
<span class="line-removed">-         } else if (object instanceof byte[]) {</span>
<span class="line-removed">-             return checkSumXor((byte[]) object);</span>
<span class="line-removed">-         } else if (object instanceof char[]) {</span>
<span class="line-removed">-             return checkSumXor((char[]) object);</span>
<span class="line-removed">-         } else if (object instanceof float[]) {</span>
<span class="line-removed">-             return checkSumXor((float[]) object);</span>
<span class="line-removed">-         } else if (object instanceof double[]) {</span>
<span class="line-removed">-             return checkSumXor((double[]) object);</span>
<span class="line-removed">-         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">-             return checkSumXor((Integer[]) object);</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">-                 object.getClass().getName());</span>
<span class="line-removed">-             return -1;</span>
          }
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-removed">-     private static int checkSumXor(Integer[] a) {</span>
<span class="line-removed">-         int checkSum = 0;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         for (Integer e : a) {</span>
<span class="line-removed">-             checkSum ^= e.intValue();</span>
          }
<span class="line-modified">!         return checkSum;</span>
      }
  
<span class="line-modified">!     private static int checkSumXor(int[] a) {</span>
          int checkSum = 0;
  
          for (int e : a) {
              checkSum ^= e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private static int checkSumXor(long[] a) {</span>
          long checkSum = 0;
  
          for (long e : a) {
              checkSum ^= e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private static int checkSumXor(short[] a) {</span>
<span class="line-modified">!         short checkSum = 0;</span>
  
<span class="line-modified">!         for (short e : a) {</span>
              checkSum ^= e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private static int checkSumXor(byte[] a) {</span>
<span class="line-modified">!         byte checkSum = 0;</span>
  
<span class="line-modified">!         for (byte e : a) {</span>
              checkSum ^= e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private static int checkSumXor(char[] a) {</span>
<span class="line-modified">!         char checkSum = 0;</span>
  
<span class="line-modified">!         for (char e : a) {</span>
              checkSum ^= e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private static int checkSumXor(float[] a) {</span>
          int checkSum = 0;
  
          for (float e : a) {
              checkSum ^= (int) e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private static int checkSumXor(double[] a) {</span>
          int checkSum = 0;
  
          for (double e : a) {
              checkSum ^= (int) e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private static int checkSumPlus(Object object) {</span>
<span class="line-modified">!         if (object instanceof int[]) {</span>
<span class="line-modified">!             return checkSumPlus((int[]) object);</span>
<span class="line-modified">!         } else if (object instanceof long[]) {</span>
<span class="line-modified">!             return checkSumPlus((long[]) object);</span>
<span class="line-modified">!         } else if (object instanceof short[]) {</span>
<span class="line-removed">-             return checkSumPlus((short[]) object);</span>
<span class="line-removed">-         } else if (object instanceof byte[]) {</span>
<span class="line-removed">-             return checkSumPlus((byte[]) object);</span>
<span class="line-removed">-         } else if (object instanceof char[]) {</span>
<span class="line-removed">-             return checkSumPlus((char[]) object);</span>
<span class="line-removed">-         } else if (object instanceof float[]) {</span>
<span class="line-removed">-             return checkSumPlus((float[]) object);</span>
<span class="line-removed">-         } else if (object instanceof double[]) {</span>
<span class="line-removed">-             return checkSumPlus((double[]) object);</span>
<span class="line-removed">-         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">-             return checkSumPlus((Integer[]) object);</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">-                 object.getClass().getName());</span>
<span class="line-removed">-             return -1;</span>
          }
      }
  
<span class="line-modified">!     private static int checkSumPlus(int[] a) {</span>
          int checkSum = 0;
  
          for (int e : a) {
              checkSum += e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private static int checkSumPlus(long[] a) {</span>
          long checkSum = 0;
  
          for (long e : a) {
              checkSum += e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private static int checkSumPlus(short[] a) {</span>
<span class="line-modified">!         short checkSum = 0;</span>
  
<span class="line-modified">!         for (short e : a) {</span>
              checkSum += e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private static int checkSumPlus(byte[] a) {</span>
<span class="line-modified">!         byte checkSum = 0;</span>
  
<span class="line-modified">!         for (byte e : a) {</span>
              checkSum += e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private static int checkSumPlus(char[] a) {</span>
<span class="line-modified">!         char checkSum = 0;</span>
  
<span class="line-modified">!         for (char e : a) {</span>
              checkSum += e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private static int checkSumPlus(float[] a) {</span>
          int checkSum = 0;
  
          for (float e : a) {
              checkSum += (int) e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private static int checkSumPlus(double[] a) {</span>
          int checkSum = 0;
  
          for (double e : a) {
              checkSum += (int) e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private static int checkSumPlus(Integer[] a) {</span>
<span class="line-modified">!         int checkSum = 0;</span>
<span class="line-modified">! </span>
<span class="line-modified">!         for (Integer e : a) {</span>
<span class="line-modified">!             checkSum += e.intValue();</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         return checkSum;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private static void sortByInsertionSort(Object object) {</span>
<span class="line-modified">!         if (object instanceof int[]) {</span>
<span class="line-modified">!             sortByInsertionSort((int[]) object);</span>
<span class="line-modified">!         } else if (object instanceof long[]) {</span>
<span class="line-modified">!             sortByInsertionSort((long[]) object);</span>
<span class="line-modified">!         } else if (object instanceof short[]) {</span>
<span class="line-removed">-             sortByInsertionSort((short[]) object);</span>
<span class="line-removed">-         } else if (object instanceof byte[]) {</span>
<span class="line-removed">-             sortByInsertionSort((byte[]) object);</span>
<span class="line-removed">-         } else if (object instanceof char[]) {</span>
<span class="line-removed">-             sortByInsertionSort((char[]) object);</span>
<span class="line-removed">-         } else if (object instanceof float[]) {</span>
<span class="line-removed">-             sortByInsertionSort((float[]) object);</span>
<span class="line-removed">-         } else if (object instanceof double[]) {</span>
<span class="line-removed">-             sortByInsertionSort((double[]) object);</span>
<span class="line-removed">-         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">-             sortByInsertionSort((Integer[]) object);</span>
          } else {
<span class="line-modified">!             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">-                 object.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private static void sortByInsertionSort(int[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
              int ai = a[i];
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private static void sortByInsertionSort(long[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
              long ai = a[i];
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private static void sortByInsertionSort(short[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">!             short ai = a[i];</span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private static void sortByInsertionSort(byte[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">!             byte ai = a[i];</span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private static void sortByInsertionSort(char[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">!             char ai = a[i];</span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private static void sortByInsertionSort(float[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
              float ai = a[i];
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private static void sortByInsertionSort(double[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
              double ai = a[i];
<span class="line-removed">-             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {</span>
<span class="line-removed">-                 a[j + 1] = a[j];</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             a[j + 1] = ai;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
  
<span class="line-removed">-     private static void sortByInsertionSort(Integer[] a) {</span>
<span class="line-removed">-         for (int j, i = 1; i &lt; a.length; i++) {</span>
<span class="line-removed">-             Integer ai = a[i];</span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private static void sort(Object object) {</span>
<span class="line-modified">!         if (object instanceof int[]) {</span>
<span class="line-modified">!             Arrays.sort((int[]) object);</span>
<span class="line-modified">!         } else if (object instanceof long[]) {</span>
<span class="line-modified">!             Arrays.sort((long[]) object);</span>
<span class="line-modified">!         } else if (object instanceof short[]) {</span>
<span class="line-modified">!             Arrays.sort((short[]) object);</span>
<span class="line-modified">!         } else if (object instanceof byte[]) {</span>
<span class="line-modified">!             Arrays.sort((byte[]) object);</span>
<span class="line-modified">!         } else if (object instanceof char[]) {</span>
<span class="line-modified">!             Arrays.sort((char[]) object);</span>
<span class="line-modified">!         } else if (object instanceof float[]) {</span>
<span class="line-modified">!             Arrays.sort((float[]) object);</span>
<span class="line-modified">!         } else if (object instanceof double[]) {</span>
<span class="line-modified">!             Arrays.sort((double[]) object);</span>
<span class="line-removed">-         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">-             Arrays.sort((Integer[]) object);</span>
          } else {
<span class="line-modified">!             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">-                 object.getClass().getName());</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void sortSubArray(Object object, int fromIndex, int toIndex) {</span>
<span class="line-removed">-         if (object instanceof int[]) {</span>
<span class="line-removed">-             Arrays.sort((int[]) object, fromIndex, toIndex);</span>
<span class="line-removed">-         } else if (object instanceof long[]) {</span>
<span class="line-removed">-             Arrays.sort((long[]) object, fromIndex, toIndex);</span>
<span class="line-removed">-         } else if (object instanceof short[]) {</span>
<span class="line-removed">-             Arrays.sort((short[]) object, fromIndex, toIndex);</span>
<span class="line-removed">-         } else if (object instanceof byte[]) {</span>
<span class="line-removed">-             Arrays.sort((byte[]) object, fromIndex, toIndex);</span>
<span class="line-removed">-         } else if (object instanceof char[]) {</span>
<span class="line-removed">-             Arrays.sort((char[]) object, fromIndex, toIndex);</span>
<span class="line-removed">-         } else if (object instanceof float[]) {</span>
<span class="line-removed">-             Arrays.sort((float[]) object, fromIndex, toIndex);</span>
<span class="line-removed">-         } else if (object instanceof double[]) {</span>
<span class="line-removed">-             Arrays.sort((double[]) object, fromIndex, toIndex);</span>
<span class="line-removed">-         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">-             Arrays.sort((Integer[]) object, fromIndex, toIndex);</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">-                 object.getClass().getName());</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static void checkSubArray(Object object, int fromIndex, int toIndex, int m) {</span>
<span class="line-removed">-         if (object instanceof int[]) {</span>
<span class="line-removed">-             checkSubArray((int[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">-         } else if (object instanceof long[]) {</span>
<span class="line-removed">-             checkSubArray((long[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">-         } else if (object instanceof short[]) {</span>
<span class="line-removed">-             checkSubArray((short[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">-         } else if (object instanceof byte[]) {</span>
<span class="line-removed">-             checkSubArray((byte[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">-         } else if (object instanceof char[]) {</span>
<span class="line-removed">-             checkSubArray((char[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">-         } else if (object instanceof float[]) {</span>
<span class="line-removed">-             checkSubArray((float[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">-         } else if (object instanceof double[]) {</span>
<span class="line-removed">-             checkSubArray((double[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">-         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">-             checkSubArray((Integer[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">-                 object.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private static void checkSubArray(Integer[] a, int fromIndex, int toIndex, int m) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i].intValue() != 0xDEDA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
<span class="line-modified">!             if (a[i].intValue() &gt; a[i + 1].intValue()) {</span>
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i].intValue() != 0xBABA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSubArray(int[] a, int fromIndex, int toIndex, int m) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != 0xDEDA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != 0xBABA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSubArray(byte[] a, int fromIndex, int toIndex, int m) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (byte) 0xDEDA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (byte) 0xBABA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSubArray(long[] a, int fromIndex, int toIndex, int m) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (long) 0xDEDA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (long) 0xBABA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSubArray(char[] a, int fromIndex, int toIndex, int m) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (char) 0xDEDA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (char) 0xBABA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSubArray(short[] a, int fromIndex, int toIndex, int m) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (short) 0xDEDA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (short) 0xBABA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkSubArray(float[] a, int fromIndex, int toIndex, int m) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (float) 0xDEDA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">-                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (float) 0xBABA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-modified">!                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
<span class="line-modified">!             }</span>
          }
      }
  
<span class="line-modified">!     private static void checkSubArray(double[] a, int fromIndex, int toIndex, int m) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; fromIndex; i++) {</span>
<span class="line-modified">!             if (a[i] != (double) 0xDEDA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-modified">!                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
              }
          }
  
<span class="line-modified">!         for (int i = fromIndex; i &lt; toIndex - 1; i++) {</span>
<span class="line-modified">!             if (a[i] &gt; a[i + 1]) {</span>
<span class="line-modified">!                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
              }
          }
  
<span class="line-modified">!         for (int i = toIndex; i &lt; a.length; i++) {</span>
<span class="line-modified">!             if (a[i] != (double) 0xBABA) {</span>
<span class="line-modified">!                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-modified">!                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private static void checkRange(Object object, int m) {</span>
<span class="line-modified">!         if (object instanceof int[]) {</span>
<span class="line-modified">!             checkRange((int[]) object, m);</span>
<span class="line-modified">!         } else if (object instanceof long[]) {</span>
<span class="line-modified">!             checkRange((long[]) object, m);</span>
<span class="line-modified">!         } else if (object instanceof short[]) {</span>
<span class="line-modified">!             checkRange((short[]) object, m);</span>
<span class="line-modified">!         } else if (object instanceof byte[]) {</span>
<span class="line-modified">!             checkRange((byte[]) object, m);</span>
<span class="line-removed">-         } else if (object instanceof char[]) {</span>
<span class="line-removed">-             checkRange((char[]) object, m);</span>
<span class="line-removed">-         } else if (object instanceof float[]) {</span>
<span class="line-removed">-             checkRange((float[]) object, m);</span>
<span class="line-removed">-         } else if (object instanceof double[]) {</span>
<span class="line-removed">-             checkRange((double[]) object, m);</span>
<span class="line-removed">-         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">-             checkRange((Integer[]) object, m);</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">-                 object.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private static void checkRange(Integer[] a, int m) {</span>
          try {
<span class="line-modified">!             Arrays.sort(a, m + 1, m);</span>
<span class="line-modified">! </span>
<span class="line-modified">!             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-removed">-                 &quot; toIndex = &quot; + m);</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         catch (IllegalArgumentException iae) {</span>
              try {
<span class="line-modified">!                 Arrays.sort(a, -m, a.length);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot; as expected: fromIndex = &quot; + (-m));</span>
              }
<span class="line-modified">!             catch (ArrayIndexOutOfBoundsException aoe) {</span>
                  try {
<span class="line-modified">!                     Arrays.sort(a, 0, a.length + m);</span>
  
<span class="line-modified">!                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">!                     return;</span>
<span class="line-modified">!                 }</span>
              }
          }
      }
  
<span class="line-modified">!     private static void checkRange(int[] a, int m) {</span>
          try {
<span class="line-modified">!             Arrays.sort(a, m + 1, m);</span>
  
<span class="line-modified">!             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">!                 &quot; toIndex = &quot; + m);</span>
          }
<span class="line-modified">!         catch (IllegalArgumentException iae) {</span>
<span class="line-removed">-             try {</span>
<span class="line-removed">-                 Arrays.sort(a, -m, a.length);</span>
  
<span class="line-modified">!                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot; as expected: fromIndex = &quot; + (-m));</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-modified">!                 try {</span>
<span class="line-modified">!                     Arrays.sort(a, 0, a.length + m);</span>
  
<span class="line-modified">!                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
                  }
<span class="line-modified">!                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">!                     return;</span>
                  }
              }
<span class="line-modified">!         }</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     private static void checkRange(long[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             Arrays.sort(a, m + 1, m);</span>
  
<span class="line-modified">!             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">!                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         catch (IllegalArgumentException iae) {</span>
<span class="line-modified">!             try {</span>
<span class="line-modified">!                 Arrays.sort(a, -m, a.length);</span>
  
<span class="line-modified">!                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot; as expected: fromIndex = &quot; + (-m));</span>
              }
<span class="line-modified">!             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">-                 try {</span>
<span class="line-removed">-                     Arrays.sort(a, 0, a.length + m);</span>
  
<span class="line-modified">!                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
                  }
<span class="line-modified">!                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">!                     return;</span>
                  }
              }
<span class="line-modified">!         }</span>
      }
  
<span class="line-modified">!     private static void checkRange(byte[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             Arrays.sort(a, m + 1, m);</span>
  
<span class="line-modified">!             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">!                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         catch (IllegalArgumentException iae) {</span>
<span class="line-removed">-             try {</span>
<span class="line-removed">-                 Arrays.sort(a, -m, a.length);</span>
  
<span class="line-modified">!                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot; as expected: fromIndex = &quot; + (-m));</span>
              }
<span class="line-modified">!             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">-                 try {</span>
<span class="line-removed">-                     Arrays.sort(a, 0, a.length + m);</span>
  
<span class="line-modified">!                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
                  }
<span class="line-modified">!                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">!                     return;</span>
                  }
              }
<span class="line-modified">!         }</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     private static void checkRange(short[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             Arrays.sort(a, m + 1, m);</span>
  
<span class="line-modified">!             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">!                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         catch (IllegalArgumentException iae) {</span>
<span class="line-modified">!             try {</span>
<span class="line-removed">-                 Arrays.sort(a, -m, a.length);</span>
  
<span class="line-modified">!                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot; as expected: fromIndex = &quot; + (-m));</span>
              }
<span class="line-modified">!             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">-                 try {</span>
<span class="line-removed">-                     Arrays.sort(a, 0, a.length + m);</span>
  
<span class="line-modified">!                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
                  }
<span class="line-modified">!                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">!                     return;</span>
                  }
              }
<span class="line-modified">!         }</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     private static void checkRange(char[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             Arrays.sort(a, m + 1, m);</span>
  
<span class="line-modified">!             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">!                 &quot; toIndex = &quot; + m);</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         catch (IllegalArgumentException iae) {</span>
<span class="line-removed">-             try {</span>
<span class="line-removed">-                 Arrays.sort(a, -m, a.length);</span>
  
<span class="line-modified">!                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot; as expected: fromIndex = &quot; + (-m));</span>
              }
<span class="line-modified">!             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">-                 try {</span>
<span class="line-removed">-                     Arrays.sort(a, 0, a.length + m);</span>
  
<span class="line-modified">!                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
                  }
<span class="line-modified">!                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">!                     return;</span>
                  }
              }
<span class="line-modified">!         }</span>
      }
  
<span class="line-modified">!     private static void checkRange(float[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             Arrays.sort(a, m + 1, m);</span>
  
<span class="line-modified">!             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">!                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         catch (IllegalArgumentException iae) {</span>
<span class="line-modified">!             try {</span>
<span class="line-modified">!                 Arrays.sort(a, -m, a.length);</span>
  
<span class="line-modified">!                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot; as expected: fromIndex = &quot; + (-m));</span>
              }
<span class="line-modified">!             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">-                 try {</span>
<span class="line-removed">-                     Arrays.sort(a, 0, a.length + m);</span>
  
<span class="line-modified">!                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
                  }
<span class="line-modified">!                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">!                     return;</span>
                  }
              }
<span class="line-modified">!         }</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     private static void checkRange(double[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             Arrays.sort(a, m + 1, m);</span>
  
<span class="line-modified">!             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">!                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         catch (IllegalArgumentException iae) {</span>
<span class="line-modified">!             try {</span>
<span class="line-modified">!                 Arrays.sort(a, -m, a.length);</span>
  
<span class="line-modified">!                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot; as expected: fromIndex = &quot; + (-m));</span>
              }
<span class="line-modified">!             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-modified">!                 try {</span>
<span class="line-modified">!                     Arrays.sort(a, 0, a.length + m);</span>
  
<span class="line-modified">!                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
                  }
<span class="line-modified">!                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">!                     return;</span>
                  }
              }
          }
      }
  
<span class="line-modified">!     private static void outArray(Object[] a) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!             out.print(a[i] + &quot; &quot;);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         out.println();</span>
      }
  
<span class="line-modified">!     private static void outArray(int[] a) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!             out.print(a[i] + &quot; &quot;);</span>
          }
<span class="line-removed">-         out.println();</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     private static void outArray(float[] a) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!             out.print(a[i] + &quot; &quot;);</span>
          }
<span class="line-removed">-         out.println();</span>
      }
  
<span class="line-modified">!     private static void outArray(double[] a) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!             out.print(a[i] + &quot; &quot;);</span>
          }
<span class="line-modified">!         out.println();</span>
      }
  
<span class="line-modified">!     private static class MyRandom extends Random {</span>
<span class="line-modified">!         MyRandom(long seed) {</span>
              super(seed);
<span class="line-modified">!             mySeed = seed;</span>
          }
  
<span class="line-modified">!         long getSeed() {</span>
<span class="line-modified">!             return mySeed;</span>
          }
  
<span class="line-modified">!         private long mySeed;</span>
      }
<span class="line-removed">- </span>
<span class="line-removed">-     private static String ourDescription;</span>
  }
<span class="line-new-header">--- 379,1638 ---</span>
              a[i++] = new Pair(key, 4);
          }
          return a;
      }
  
<span class="line-modified">!     private void testWithInsertionSort(int length, TestRandom random) {</span>
          if (length &gt; 1000) {
              return;
          }
<span class="line-modified">!         for (int m = 1; m &lt;= length; m &lt;&lt;= 1) {</span>
              for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<span class="line-modified">!                 builder.build((int[]) gold[0], m, random);</span>
<span class="line-modified">!                 convertData(length);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified">!                     printTestName(&quot;Test with insertion sort&quot;, random, length,</span>
<span class="line-modified">!                         &quot;, m = &quot; + m + &quot;, &quot; + getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified">!                     sortingHelper.sort(test[i]);</span>
<span class="line-modified">!                     sortByInsertionSort(gold[i]);</span>
<span class="line-modified">!                     compare(test[i], gold[i]);</span>
                  }
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private void testMergingSort(int length, TestRandom random) {</span>
<span class="line-modified">!         if (length &lt; (4 &lt;&lt; 10)) { // DualPivotQuicksort.MIN_TRY_MERGE_SIZE</span>
              return;
          }
<span class="line-modified">!         final int PERIOD = 50;</span>
<span class="line-modified">! </span>
<span class="line-modified">!         for (int m = PERIOD - 2; m &lt;= PERIOD + 2; m++) {</span>
<span class="line-modified">!             for (MergingBuilder builder : MergingBuilder.values()) {</span>
<span class="line-modified">!                 builder.build((int[]) gold[0], m);</span>
<span class="line-modified">!                 convertData(length);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified">!                     printTestName(&quot;Test merging sort&quot;, random, length,</span>
<span class="line-modified">!                         &quot;, m = &quot; + m + &quot;, &quot; +  getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified">!                     sortingHelper.sort(test[i]);</span>
<span class="line-modified">!                     checkSorted(test[i]);</span>
                  }
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private void testWithCheckSum(int length, TestRandom random) {</span>
<span class="line-modified">!         for (int m = 1; m &lt;= length; m &lt;&lt;= 1) {</span>
              for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<span class="line-modified">!                 builder.build((int[]) gold[0], m, random);</span>
<span class="line-modified">!                 convertData(length);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified">!                     printTestName(&quot;Test with check sum&quot;, random, length,</span>
<span class="line-modified">!                         &quot;, m = &quot; + m + &quot;, &quot; + getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified">!                     sortingHelper.sort(test[i]);</span>
<span class="line-modified">!                     checkWithCheckSum(test[i], gold[i]);</span>
                  }
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private void testWithScrambling(int length, TestRandom random) {</span>
<span class="line-modified">!         for (int m = 1; m &lt;= length; m &lt;&lt;= 1) {</span>
              for (SortedBuilder builder : SortedBuilder.values()) {
<span class="line-modified">!                 builder.build((int[]) gold[0], m);</span>
<span class="line-modified">!                 convertData(length);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified">!                     printTestName(&quot;Test with scrambling&quot;, random, length,</span>
<span class="line-modified">!                         &quot;, m = &quot; + m + &quot;, &quot; + getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified">!                     scramble(test[i], random);</span>
<span class="line-modified">!                     sortingHelper.sort(test[i]);</span>
<span class="line-modified">!                     compare(test[i], gold[i]);</span>
                  }
              }
          }
          out.println();
      }
  
<span class="line-modified">!     private void testNegativeZero(int length, TestRandom random) {</span>
<span class="line-modified">!         for (int i = 5; i &lt; test.length; i++) {</span>
<span class="line-modified">!             printTestName(&quot;Test negative zero -0.0&quot;, random, length, &quot; &quot; + getType(i));</span>
  
<span class="line-modified">!             NegativeZeroBuilder builder = NegativeZeroBuilder.values() [i - 5];</span>
<span class="line-modified">!             builder.build(test[i], random);</span>
<span class="line-modified">! </span>
<span class="line-modified">!             sortingHelper.sort(test[i]);</span>
<span class="line-modified">!             checkNegativeZero(test[i]);</span>
          }
<span class="line-added">+         out.println();</span>
      }
  
<span class="line-modified">!     private void testFloatingPointSorting(int length, TestRandom random) {</span>
<span class="line-modified">!         if (length &lt; 2) {</span>
<span class="line-modified">!             return;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         final int MAX = 13;</span>
  
<span class="line-modified">!         for (int a = 0; a &lt; MAX; a++) {</span>
<span class="line-modified">!             for (int g = 0; g &lt; MAX; g++) {</span>
<span class="line-modified">!                 for (int z = 0; z &lt; MAX; z++) {</span>
<span class="line-modified">!                     for (int n = 0; n &lt; MAX; n++) {</span>
<span class="line-modified">!                         for (int p = 0; p &lt; MAX; p++) {</span>
<span class="line-modified">!                             if (a + g + z + n + p != length) {</span>
                                  continue;
                              }
<span class="line-modified">!                             for (int i = 5; i &lt; test.length; i++) {</span>
<span class="line-modified">!                                 printTestName(&quot;Test float-pointing sorting&quot;, random, length,</span>
<span class="line-modified">!                                     &quot;, a = &quot; + a + &quot;, g = &quot; + g + &quot;, z = &quot; + z +</span>
<span class="line-modified">!                                     &quot;, n = &quot; + n + &quot;, p = &quot; + p + &quot;, &quot; + getType(i));</span>
<span class="line-modified">!                                 FloatingPointBuilder builder = FloatingPointBuilder.values()[i - 5];</span>
<span class="line-modified">!                                 builder.build(gold[i], a, g, z, n, p, random);</span>
<span class="line-modified">!                                 copy(test[i], gold[i]);</span>
<span class="line-modified">!                                 scramble(test[i], random);</span>
<span class="line-modified">!                                 sortingHelper.sort(test[i]);</span>
<span class="line-added">+                                 compare(test[i], gold[i], a, n, g);</span>
                              }
                          }
                      }
                  }
              }
          }
<span class="line-modified">! </span>
<span class="line-modified">!         for (int m = 13; m &gt; 4; m--) {</span>
<span class="line-added">+             int t = length / m;</span>
<span class="line-added">+             int g = t, z = t, n = t, p = t;</span>
<span class="line-added">+             int a = length - g - z - n - p;</span>
<span class="line-added">+ </span>
<span class="line-added">+             for (int i = 5; i &lt; test.length; i++) {</span>
<span class="line-added">+                 printTestName(&quot;Test float-pointing sorting&quot;, random, length,</span>
<span class="line-added">+                     &quot;, a = &quot; + a + &quot;, g = &quot; + g + &quot;, z = &quot; + z +</span>
<span class="line-added">+                     &quot;, n = &quot; + n + &quot;, p = &quot; + p + &quot;, &quot; + getType(i));</span>
<span class="line-added">+                 FloatingPointBuilder builder = FloatingPointBuilder.values() [i - 5];</span>
<span class="line-added">+                 builder.build(gold[i], a, g, z, n, p, random);</span>
<span class="line-added">+                 copy(test[i], gold[i]);</span>
<span class="line-added">+                 scramble(test[i], random);</span>
<span class="line-added">+                 sortingHelper.sort(test[i]);</span>
<span class="line-added">+                 compare(test[i], gold[i], a, n, g);</span>
<span class="line-added">+             }</span>
          }
<span class="line-added">+         out.println();</span>
      }
  
<span class="line-modified">!     private void prepareSubArray(int[] a, int fromIndex, int toIndex) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             a[i] = A380;</span>
          }
          int middle = (fromIndex + toIndex) &gt;&gt;&gt; 1;
          int k = 0;
  
          for (int i = fromIndex; i &lt; middle; i++) {
              a[i] = k++;
          }
<span class="line-added">+ </span>
          for (int i = middle; i &lt; toIndex; i++) {
              a[i] = k--;
          }
<span class="line-added">+ </span>
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             a[i] = B747;</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void scramble(Object a, Random random) {</span>
<span class="line-added">+         if (a instanceof int[]) {</span>
<span class="line-added">+             scramble((int[]) a, random);</span>
<span class="line-added">+         } else if (a instanceof long[]) {</span>
<span class="line-added">+             scramble((long[]) a, random);</span>
<span class="line-added">+         } else if (a instanceof byte[]) {</span>
<span class="line-added">+             scramble((byte[]) a, random);</span>
<span class="line-added">+         } else if (a instanceof char[]) {</span>
<span class="line-added">+             scramble((char[]) a, random);</span>
<span class="line-added">+         } else if (a instanceof short[]) {</span>
<span class="line-added">+             scramble((short[]) a, random);</span>
<span class="line-added">+         } else if (a instanceof float[]) {</span>
<span class="line-added">+             scramble((float[]) a, random);</span>
<span class="line-added">+         } else if (a instanceof double[]) {</span>
<span class="line-added">+             scramble((double[]) a, random);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private void scramble(int[] a, Random random) {</span>
          for (int i = 0; i &lt; a.length * 7; i++) {
              swap(a, random.nextInt(a.length), random.nextInt(a.length));
          }
      }
  
<span class="line-modified">!     private void scramble(long[] a, Random random) {</span>
          for (int i = 0; i &lt; a.length * 7; i++) {
              swap(a, random.nextInt(a.length), random.nextInt(a.length));
          }
      }
  
<span class="line-modified">!     private void scramble(byte[] a, Random random) {</span>
          for (int i = 0; i &lt; a.length * 7; i++) {
              swap(a, random.nextInt(a.length), random.nextInt(a.length));
          }
      }
  
<span class="line-modified">!     private void scramble(char[] a, Random random) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified">!             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified">!         }</span>
      }
  
<span class="line-modified">!     private void scramble(short[] a, Random random) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified">!             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified">!         }</span>
      }
  
<span class="line-modified">!     private void scramble(float[] a, Random random) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified">!             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified">!         }</span>
      }
  
<span class="line-modified">!     private void scramble(double[] a, Random random) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified">!             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void swap(int[] a, int i, int j) {</span>
<span class="line-modified">!         int t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void swap(long[] a, int i, int j) {</span>
<span class="line-modified">!         long t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void swap(byte[] a, int i, int j) {</span>
<span class="line-modified">!         byte t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void swap(char[] a, int i, int j) {</span>
<span class="line-modified">!         char t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void swap(short[] a, int i, int j) {</span>
<span class="line-modified">!         short t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void swap(float[] a, int i, int j) {</span>
<span class="line-modified">!         float t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void swap(double[] a, int i, int j) {</span>
<span class="line-modified">!         double t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void checkWithCheckSum(Object test, Object gold) {</span>
<span class="line-added">+         checkSorted(test);</span>
<span class="line-added">+         checkCheckSum(test, gold);</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void fail(String message) {</span>
<span class="line-modified">!         err.format(&quot;\n*** TEST FAILED ***\n\n%s\n\n&quot;, message);</span>
<span class="line-added">+         throw new RuntimeException(&quot;Test failed&quot;);</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void checkNegativeZero(Object a) {</span>
<span class="line-modified">!         if (a instanceof float[]) {</span>
<span class="line-modified">!             checkNegativeZero((float[]) a);</span>
<span class="line-modified">!         } else if (a instanceof double[]) {</span>
<span class="line-added">+             checkNegativeZero((double[]) a);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private void checkNegativeZero(float[] a) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length - 1; i++) {</span>
<span class="line-modified">!             if (Float.floatToRawIntBits(a[i]) == 0 &amp;&amp; Float.floatToRawIntBits(a[i + 1]) &lt; 0) {</span>
<span class="line-modified">!                 fail(a[i] + &quot; before &quot; + a[i + 1] + &quot; at position &quot; + i);</span>
              }
<span class="line-modified">!         }</span>
      }
  
<span class="line-modified">!     private void checkNegativeZero(double[] a) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length - 1; i++) {</span>
<span class="line-modified">!             if (Double.doubleToRawLongBits(a[i]) == 0 &amp;&amp; Double.doubleToRawLongBits(a[i + 1]) &lt; 0) {</span>
<span class="line-modified">!                 fail(a[i] + &quot; before &quot; + a[i + 1] + &quot; at position &quot; + i);</span>
              }
<span class="line-modified">!         }</span>
      }
  
<span class="line-modified">!     private void compare(Object a, Object b, int numNaN, int numNeg, int numNegZero) {</span>
<span class="line-modified">!         if (a instanceof float[]) {</span>
<span class="line-modified">!             compare((float[]) a, (float[]) b, numNaN, numNeg, numNegZero);</span>
<span class="line-added">+         } else if (a instanceof double[]) {</span>
<span class="line-added">+             compare((double[]) a, (double[]) b, numNaN, numNeg, numNegZero);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private void compare(float[] a, float[] b, int numNaN, int numNeg, int numNegZero) {</span>
          for (int i = a.length - numNaN; i &lt; a.length; i++) {
              if (a[i] == a[i]) {
<span class="line-modified">!                 fail(&quot;There must be NaN instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
          final int NEGATIVE_ZERO = Float.floatToIntBits(-0.0f);
  
          for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
              if (NEGATIVE_ZERO != Float.floatToIntBits(a[i])) {
<span class="line-modified">!                 fail(&quot;There must be -0.0 instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
<span class="line-added">+ </span>
          for (int i = 0; i &lt; a.length - numNaN; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
      }
  
<span class="line-modified">!     private void compare(double[] a, double[] b, int numNaN, int numNeg, int numNegZero) {</span>
          for (int i = a.length - numNaN; i &lt; a.length; i++) {
              if (a[i] == a[i]) {
<span class="line-modified">!                 fail(&quot;There must be NaN instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
          final long NEGATIVE_ZERO = Double.doubleToLongBits(-0.0d);
  
          for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
              if (NEGATIVE_ZERO != Double.doubleToLongBits(a[i])) {
<span class="line-modified">!                 fail(&quot;There must be -0.0 instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
<span class="line-added">+ </span>
          for (int i = 0; i &lt; a.length - numNaN; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
<span class="line-modified">!             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void compare(Object a, Object b) {</span>
<span class="line-added">+         if (a instanceof int[]) {</span>
<span class="line-added">+             compare((int[]) a, (int[]) b);</span>
<span class="line-added">+         } else if (a instanceof long[]) {</span>
<span class="line-added">+             compare((long[]) a, (long[]) b);</span>
<span class="line-added">+         } else if (a instanceof byte[]) {</span>
<span class="line-added">+             compare((byte[]) a, (byte[]) b);</span>
<span class="line-added">+         } else if (a instanceof char[]) {</span>
<span class="line-added">+             compare((char[]) a, (char[]) b);</span>
<span class="line-added">+         } else if (a instanceof short[]) {</span>
<span class="line-added">+             compare((short[]) a, (short[]) b);</span>
<span class="line-added">+         } else if (a instanceof float[]) {</span>
<span class="line-added">+             compare((float[]) a, (float[]) b);</span>
<span class="line-added">+         } else if (a instanceof double[]) {</span>
<span class="line-added">+             compare((double[]) a, (double[]) b);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private void compare(int[] a, int[] b) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!             if (a[i] != b[i]) {</span>
<span class="line-modified">!                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         }</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void compare(long[] a, long[] b) {</span>
<span class="line-modified">!         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!             if (a[i] != b[i]) {</span>
<span class="line-modified">!                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void compare(byte[] a, byte[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
      }
  
<span class="line-modified">!     private void compare(char[] a, char[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
      }
  
<span class="line-modified">!     private void compare(short[] a, short[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
      }
  
<span class="line-modified">!     private void compare(float[] a, float[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
      }
  
<span class="line-modified">!     private void compare(double[] a, double[] b) {</span>
          for (int i = 0; i &lt; a.length; i++) {
              if (a[i] != b[i]) {
<span class="line-modified">!                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
              }
          }
      }
  
<span class="line-modified">!     private String getType(int i) {</span>
<span class="line-modified">!         Object a = test[i];</span>
  
<span class="line-modified">!         if (a instanceof int[]) {</span>
<span class="line-modified">!             return &quot;INT   &quot;;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         if (a instanceof long[]) {</span>
<span class="line-modified">!             return &quot;LONG  &quot;;</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof byte[]) {</span>
<span class="line-added">+             return &quot;BYTE  &quot;;</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof char[]) {</span>
<span class="line-added">+             return &quot;CHAR  &quot;;</span>
          }
<span class="line-added">+         if (a instanceof short[]) {</span>
<span class="line-added">+             return &quot;SHORT &quot;;</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof float[]) {</span>
<span class="line-added">+             return &quot;FLOAT &quot;;</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof double[]) {</span>
<span class="line-added">+             return &quot;DOUBLE&quot;;</span>
<span class="line-added">+         }</span>
<span class="line-added">+         fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
<span class="line-added">+         return null;</span>
      }
  
<span class="line-modified">!     private void checkSorted(Object a) {</span>
<span class="line-modified">!         if (a instanceof int[]) {</span>
<span class="line-modified">!             checkSorted((int[]) a);</span>
<span class="line-modified">!         } else if (a instanceof long[]) {</span>
<span class="line-modified">!             checkSorted((long[]) a);</span>
<span class="line-modified">!         } else if (a instanceof byte[]) {</span>
<span class="line-modified">!             checkSorted((byte[]) a);</span>
<span class="line-modified">!         } else if (a instanceof char[]) {</span>
<span class="line-modified">!             checkSorted((char[]) a);</span>
<span class="line-modified">!         } else if (a instanceof short[]) {</span>
<span class="line-modified">!             checkSorted((short[]) a);</span>
<span class="line-modified">!         } else if (a instanceof float[]) {</span>
<span class="line-modified">!             checkSorted((float[]) a);</span>
<span class="line-modified">!         } else if (a instanceof double[]) {</span>
<span class="line-modified">!             checkSorted((double[]) a);</span>
          } else {
<span class="line-modified">!             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private void checkSorted(int[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSorted(long[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSorted(byte[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSorted(char[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSorted(short[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSorted(float[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSorted(double[] a) {</span>
          for (int i = 0; i &lt; a.length - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkCheckSum(Object test, Object gold) {</span>
<span class="line-modified">!         if (checkSumXor(test) != checkSumXor(gold)) {</span>
<span class="line-modified">!             fail(&quot;Original and sorted arrays are not identical [^]&quot;);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         if (checkSumPlus(test) != checkSumPlus(gold)) {</span>
<span class="line-added">+             fail(&quot;Original and sorted arrays are not identical [+]&quot;);</span>
          }
      }
  
<span class="line-modified">!     private int checkSumXor(Object a) {</span>
<span class="line-modified">!         if (a instanceof int[]) {</span>
<span class="line-modified">!             return checkSumXor((int[]) a);</span>
          }
<span class="line-modified">!         if (a instanceof long[]) {</span>
<span class="line-modified">!             return checkSumXor((long[]) a);</span>
          }
<span class="line-modified">!         if (a instanceof byte[]) {</span>
<span class="line-modified">!             return checkSumXor((byte[]) a);</span>
          }
<span class="line-modified">!         if (a instanceof char[]) {</span>
<span class="line-modified">!             return checkSumXor((char[]) a);</span>
          }
<span class="line-modified">!         if (a instanceof short[]) {</span>
<span class="line-added">+             return checkSumXor((short[]) a);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof float[]) {</span>
<span class="line-added">+             return checkSumXor((float[]) a);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof double[]) {</span>
<span class="line-added">+             return checkSumXor((double[]) a);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
<span class="line-added">+         return -1;</span>
      }
  
<span class="line-modified">!     private int checkSumXor(int[] a) {</span>
          int checkSum = 0;
  
          for (int e : a) {
              checkSum ^= e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private int checkSumXor(long[] a) {</span>
          long checkSum = 0;
  
          for (long e : a) {
              checkSum ^= e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private int checkSumXor(byte[] a) {</span>
<span class="line-modified">!         byte checkSum = 0;</span>
  
<span class="line-modified">!         for (byte e : a) {</span>
              checkSum ^= e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private int checkSumXor(char[] a) {</span>
<span class="line-modified">!         char checkSum = 0;</span>
  
<span class="line-modified">!         for (char e : a) {</span>
              checkSum ^= e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private int checkSumXor(short[] a) {</span>
<span class="line-modified">!         short checkSum = 0;</span>
  
<span class="line-modified">!         for (short e : a) {</span>
              checkSum ^= e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private int checkSumXor(float[] a) {</span>
          int checkSum = 0;
  
          for (float e : a) {
              checkSum ^= (int) e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private int checkSumXor(double[] a) {</span>
          int checkSum = 0;
  
          for (double e : a) {
              checkSum ^= (int) e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private int checkSumPlus(Object a) {</span>
<span class="line-modified">!         if (a instanceof int[]) {</span>
<span class="line-modified">!             return checkSumPlus((int[]) a);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         if (a instanceof long[]) {</span>
<span class="line-modified">!             return checkSumPlus((long[]) a);</span>
          }
<span class="line-added">+         if (a instanceof byte[]) {</span>
<span class="line-added">+             return checkSumPlus((byte[]) a);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof char[]) {</span>
<span class="line-added">+             return checkSumPlus((char[]) a);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof short[]) {</span>
<span class="line-added">+             return checkSumPlus((short[]) a);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof float[]) {</span>
<span class="line-added">+             return checkSumPlus((float[]) a);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (a instanceof double[]) {</span>
<span class="line-added">+             return checkSumPlus((double[]) a);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
<span class="line-added">+         return -1;</span>
      }
  
<span class="line-modified">!     private int checkSumPlus(int[] a) {</span>
          int checkSum = 0;
  
          for (int e : a) {
              checkSum += e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private int checkSumPlus(long[] a) {</span>
          long checkSum = 0;
  
          for (long e : a) {
              checkSum += e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private int checkSumPlus(byte[] a) {</span>
<span class="line-modified">!         byte checkSum = 0;</span>
  
<span class="line-modified">!         for (byte e : a) {</span>
              checkSum += e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private int checkSumPlus(char[] a) {</span>
<span class="line-modified">!         char checkSum = 0;</span>
  
<span class="line-modified">!         for (char e : a) {</span>
              checkSum += e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private int checkSumPlus(short[] a) {</span>
<span class="line-modified">!         short checkSum = 0;</span>
  
<span class="line-modified">!         for (short e : a) {</span>
              checkSum += e;
          }
          return (int) checkSum;
      }
  
<span class="line-modified">!     private int checkSumPlus(float[] a) {</span>
          int checkSum = 0;
  
          for (float e : a) {
              checkSum += (int) e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private int checkSumPlus(double[] a) {</span>
          int checkSum = 0;
  
          for (double e : a) {
              checkSum += (int) e;
          }
          return checkSum;
      }
  
<span class="line-modified">!     private void sortByInsertionSort(Object a) {</span>
<span class="line-modified">!         if (a instanceof int[]) {</span>
<span class="line-modified">!             sortByInsertionSort((int[]) a);</span>
<span class="line-modified">!         } else if (a instanceof long[]) {</span>
<span class="line-modified">!             sortByInsertionSort((long[]) a);</span>
<span class="line-modified">!         } else if (a instanceof byte[]) {</span>
<span class="line-modified">!             sortByInsertionSort((byte[]) a);</span>
<span class="line-modified">!         } else if (a instanceof char[]) {</span>
<span class="line-modified">!             sortByInsertionSort((char[]) a);</span>
<span class="line-modified">!         } else if (a instanceof short[]) {</span>
<span class="line-modified">!             sortByInsertionSort((short[]) a);</span>
<span class="line-modified">!         } else if (a instanceof float[]) {</span>
<span class="line-modified">!             sortByInsertionSort((float[]) a);</span>
<span class="line-modified">!         } else if (a instanceof double[]) {</span>
<span class="line-modified">!             sortByInsertionSort((double[]) a);</span>
          } else {
<span class="line-modified">!             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private void sortByInsertionSort(int[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
              int ai = a[i];
<span class="line-added">+ </span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private void sortByInsertionSort(long[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
              long ai = a[i];
<span class="line-added">+ </span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private void sortByInsertionSort(byte[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">!             byte ai = a[i];</span>
<span class="line-added">+ </span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private void sortByInsertionSort(char[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">!             char ai = a[i];</span>
<span class="line-added">+ </span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private void sortByInsertionSort(short[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">!             short ai = a[i];</span>
<span class="line-added">+ </span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private void sortByInsertionSort(float[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
              float ai = a[i];
<span class="line-added">+ </span>
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private void sortByInsertionSort(double[] a) {</span>
          for (int j, i = 1; i &lt; a.length; i++) {
              double ai = a[i];
  
              for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
                  a[j + 1] = a[j];
              }
              a[j + 1] = ai;
          }
      }
  
<span class="line-modified">!     private void checkSubArray(Object a, int fromIndex, int toIndex) {</span>
<span class="line-modified">!         if (a instanceof int[]) {</span>
<span class="line-modified">!             checkSubArray((int[]) a, fromIndex, toIndex);</span>
<span class="line-modified">!         } else if (a instanceof long[]) {</span>
<span class="line-modified">!             checkSubArray((long[]) a, fromIndex, toIndex);</span>
<span class="line-modified">!         } else if (a instanceof byte[]) {</span>
<span class="line-modified">!             checkSubArray((byte[]) a, fromIndex, toIndex);</span>
<span class="line-modified">!         } else if (a instanceof char[]) {</span>
<span class="line-modified">!             checkSubArray((char[]) a, fromIndex, toIndex);</span>
<span class="line-modified">!         } else if (a instanceof short[]) {</span>
<span class="line-modified">!             checkSubArray((short[]) a, fromIndex, toIndex);</span>
<span class="line-modified">!         } else if (a instanceof float[]) {</span>
<span class="line-modified">!             checkSubArray((float[]) a, fromIndex, toIndex);</span>
<span class="line-modified">!         } else if (a instanceof double[]) {</span>
<span class="line-modified">!             checkSubArray((double[]) a, fromIndex, toIndex);</span>
          } else {
<span class="line-modified">!             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private void checkSubArray(int[] a, int fromIndex, int toIndex) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != A380) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
<span class="line-modified">!             if (a[i] &gt; a[i + 1]) {</span>
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != B747) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSubArray(long[] a, int fromIndex, int toIndex) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (long) A380) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (long) B747) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSubArray(byte[] a, int fromIndex, int toIndex) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (byte) A380) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (byte) B747) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSubArray(char[] a, int fromIndex, int toIndex) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (char) A380) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (char) B747) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSubArray(short[] a, int fromIndex, int toIndex) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (short) A380) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (short) B747) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSubArray(float[] a, int fromIndex, int toIndex) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (float) A380) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes left element at position &quot; + i + hex((long) a[i], A380));</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (float) B747) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes right element at position &quot; + i + hex((long) a[i], B747));</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkSubArray(double[] a, int fromIndex, int toIndex) {</span>
          for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">!             if (a[i] != (double) A380) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes left element at position &quot; + i + hex((long) a[i], A380));</span>
              }
          }
  
          for (int i = fromIndex; i &lt; toIndex - 1; i++) {
              if (a[i] &gt; a[i + 1]) {
<span class="line-modified">!                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
              }
          }
  
          for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">!             if (a[i] != (double) B747) {</span>
<span class="line-modified">!                 fail(&quot;Range sort changes right element at position &quot; + i + hex((long) a[i], B747));</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void checkRange(Object a, int m) {</span>
<span class="line-added">+         if (a instanceof int[]) {</span>
<span class="line-added">+             checkRange((int[]) a, m);</span>
<span class="line-added">+         } else if (a instanceof long[]) {</span>
<span class="line-added">+             checkRange((long[]) a, m);</span>
<span class="line-added">+         } else if (a instanceof byte[]) {</span>
<span class="line-added">+             checkRange((byte[]) a, m);</span>
<span class="line-added">+         } else if (a instanceof char[]) {</span>
<span class="line-added">+             checkRange((char[]) a, m);</span>
<span class="line-added">+         } else if (a instanceof short[]) {</span>
<span class="line-added">+             checkRange((short[]) a, m);</span>
<span class="line-added">+         } else if (a instanceof float[]) {</span>
<span class="line-added">+             checkRange((float[]) a, m);</span>
<span class="line-added">+         } else if (a instanceof double[]) {</span>
<span class="line-added">+             checkRange((double[]) a, m);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
          }
      }
  
<span class="line-modified">!     private void checkRange(int[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">!             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">+         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">+             try {</span>
<span class="line-added">+                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">+                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">+             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">+                 try {</span>
<span class="line-added">+                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">+                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">+                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
              }
          }
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void checkRange(long[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-added">+             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-added">+                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">+         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">+             try {</span>
<span class="line-added">+                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">+                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">+             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">+                 try {</span>
<span class="line-added">+                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">+                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">+                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
              }
          }
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void checkRange(byte[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">!             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-modified">!         } catch (IllegalArgumentException iae) {</span>
<span class="line-modified">!             try {</span>
<span class="line-modified">!                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-modified">!                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-modified">!             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-modified">!                 try {</span>
<span class="line-modified">!                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-modified">!                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-modified">!                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
<span class="line-modified">!             }</span>
          }
      }
  
<span class="line-modified">!     private void checkRange(char[] a, int m) {</span>
          try {
<span class="line-modified">!             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">!             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-modified">!         } catch (IllegalArgumentException iae) {</span>
              try {
<span class="line-modified">!                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-modified">!                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">!                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-modified">!             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">+                 try {</span>
<span class="line-added">+                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">+                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">+                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
              }
<span class="line-modified">!         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void checkRange(short[] a, int m) {</span>
<span class="line-added">+         try {</span>
<span class="line-added">+             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-added">+             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-added">+                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">+         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">+             try {</span>
<span class="line-added">+                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">+                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">+             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
                  try {
<span class="line-modified">!                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">+                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">+                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void checkRange(float[] a, int m) {</span>
<span class="line-modified">!         try {</span>
<span class="line-modified">!             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">!             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">!                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-modified">!         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">+             try {</span>
<span class="line-added">+                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">+                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">+             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">+                 try {</span>
<span class="line-added">+                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">+                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">+                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
              }
          }
      }
  
<span class="line-modified">!     private void checkRange(double[] a, int m) {</span>
          try {
<span class="line-modified">!             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-added">+             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-added">+                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">+         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">+             try {</span>
<span class="line-added">+                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">+                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">+             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">+                 try {</span>
<span class="line-added">+                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">+                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">+                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">+                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void copy(Object dst, Object src) {</span>
<span class="line-modified">!         if (src instanceof float[]) {</span>
<span class="line-modified">!             copy((float[]) dst, (float[]) src);</span>
<span class="line-added">+         } else if (src instanceof double[]) {</span>
<span class="line-added">+             copy((double[]) dst, (double[]) src);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             fail(&quot;Unknown type of array: &quot; + src.getClass().getName());</span>
          }
<span class="line-modified">!     }</span>
  
<span class="line-modified">!     private void copy(float[] dst, float[] src) {</span>
<span class="line-modified">!         System.arraycopy(src, 0, dst, 0, src.length);</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private void copy(double[] dst, double[] src) {</span>
<span class="line-modified">!         System.arraycopy(src, 0, dst, 0, src.length);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void printTestName(String test, TestRandom random, int length) {</span>
<span class="line-added">+         printTestName(test, random, length, &quot;&quot;);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void createData(int length) {</span>
<span class="line-added">+         gold = new Object[] {</span>
<span class="line-added">+             new int[length], new long[length],</span>
<span class="line-added">+             new byte[length], new char[length], new short[length],</span>
<span class="line-added">+             new float[length], new double[length]</span>
<span class="line-added">+         };</span>
<span class="line-added">+ </span>
<span class="line-added">+         test = new Object[] {</span>
<span class="line-added">+             new int[length], new long[length],</span>
<span class="line-added">+             new byte[length], new char[length], new short[length],</span>
<span class="line-added">+             new float[length], new double[length]</span>
<span class="line-added">+         };</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void convertData(int length) {</span>
<span class="line-added">+         for (int i = 1; i &lt; gold.length; i++) {</span>
<span class="line-added">+             TypeConverter converter = TypeConverter.values()[i - 1];</span>
<span class="line-added">+             converter.convert((int[])gold[0], gold[i]);</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (int i = 0; i &lt; gold.length; i++) {</span>
<span class="line-added">+             System.arraycopy(gold[i], 0, test[i], 0, length);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private String hex(long a, int b) {</span>
<span class="line-added">+         return &quot;: &quot; + Long.toHexString(a) + &quot;, must be &quot; + Integer.toHexString(b);</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!     private void printTestName(String test, TestRandom random, int length, String message) {</span>
<span class="line-modified">!         out.println( &quot;[&quot; + sortingHelper + &quot;] &#39;&quot; + test +</span>
<span class="line-added">+             &quot;&#39; length = &quot; + length + &quot;, random = &quot; + random + message);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private static enum TypeConverter {</span>
<span class="line-added">+         LONG {</span>
<span class="line-added">+             void convert(int[] src, Object dst) {</span>
<span class="line-added">+                 long[] b = (long[]) dst;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">+                     b[i] = (long) src[i];</span>
                  }
<span class="line-modified">!             }</span>
<span class="line-modified">!         },</span>
<span class="line-added">+ </span>
<span class="line-added">+         BYTE {</span>
<span class="line-added">+             void convert(int[] src, Object dst) {</span>
<span class="line-added">+                 byte[] b = (byte[]) dst;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">+                     b[i] = (byte) src[i];</span>
                  }
              }
<span class="line-modified">!         },</span>
  
<span class="line-modified">!         CHAR {</span>
<span class="line-modified">!             void convert(int[] src, Object dst) {</span>
<span class="line-modified">!                 char[] b = (char[]) dst;</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-modified">!                     b[i] = (char) src[i];</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         },</span>
<span class="line-modified">! </span>
<span class="line-modified">!         SHORT {</span>
<span class="line-added">+             void convert(int[] src, Object dst) {</span>
<span class="line-added">+                 short[] b = (short[]) dst;</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-modified">!                     b[i] = (short) src[i];</span>
<span class="line-added">+                 }</span>
              }
<span class="line-modified">!         },</span>
  
<span class="line-modified">!         FLOAT {</span>
<span class="line-modified">!             void convert(int[] src, Object dst) {</span>
<span class="line-added">+                 float[] b = (float[]) dst;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">+                     b[i] = (float) src[i];</span>
                  }
<span class="line-modified">!             }</span>
<span class="line-modified">!         },</span>
<span class="line-added">+ </span>
<span class="line-added">+         DOUBLE {</span>
<span class="line-added">+             void convert(int[] src, Object dst) {</span>
<span class="line-added">+                 double[] b = (double[]) dst;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">+                     b[i] = (double) src[i];</span>
                  }
              }
<span class="line-modified">!         };</span>
<span class="line-added">+ </span>
<span class="line-added">+         abstract void convert(int[] src, Object dst);</span>
      }
  
<span class="line-modified">!     private static enum SortedBuilder {</span>
<span class="line-modified">!         STEPS {</span>
<span class="line-modified">!             void build(int[] a, int m) {</span>
<span class="line-added">+                 for (int i = 0; i &lt; m; i++) {</span>
<span class="line-added">+                     a[i] = 0;</span>
<span class="line-added">+                 }</span>
  
<span class="line-modified">!                 for (int i = m; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     a[i] = 1;</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         };</span>
  
<span class="line-modified">!         abstract void build(int[] a, int m);</span>
<span class="line-modified">!     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private static enum UnsortedBuilder {</span>
<span class="line-added">+         RANDOM {</span>
<span class="line-added">+             void build(int[] a, int m, Random random) {</span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = random.nextInt();</span>
<span class="line-added">+                 }</span>
              }
<span class="line-modified">!         },</span>
  
<span class="line-modified">!         ASCENDING {</span>
<span class="line-modified">!             void build(int[] a, int m, Random random) {</span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = m + i;</span>
                  }
<span class="line-modified">!             }</span>
<span class="line-modified">!         },</span>
<span class="line-added">+ </span>
<span class="line-added">+         DESCENDING {</span>
<span class="line-added">+             void build(int[] a, int m, Random random) {</span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = a.length - m - i;</span>
                  }
              }
<span class="line-modified">!         },</span>
  
<span class="line-modified">!         EQUAL {</span>
<span class="line-modified">!             void build(int[] a, int m, Random random) {</span>
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = m;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+         },</span>
  
<span class="line-modified">!         SAW {</span>
<span class="line-modified">!             void build(int[] a, int m, Random random) {</span>
<span class="line-modified">!                 int incCount = 1;</span>
<span class="line-modified">!                 int decCount = a.length;</span>
<span class="line-modified">!                 int i = 0;</span>
<span class="line-modified">!                 int period = m--;</span>
  
<span class="line-modified">!                 while (true) {</span>
<span class="line-modified">!                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-added">+                         if (i &gt;= a.length) {</span>
<span class="line-added">+                             return;</span>
<span class="line-added">+                         }</span>
<span class="line-added">+                         a[i++] = incCount++;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                     period += m;</span>
<span class="line-added">+ </span>
<span class="line-added">+                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-added">+                         if (i &gt;= a.length) {</span>
<span class="line-added">+                             return;</span>
<span class="line-added">+                         }</span>
<span class="line-added">+                         a[i++] = decCount--;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                     period += m;</span>
<span class="line-added">+                 }</span>
              }
<span class="line-modified">!         },</span>
  
<span class="line-modified">!         REPEATED {</span>
<span class="line-modified">!             void build(int[] a, int m, Random random) {</span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = i % m;</span>
                  }
<span class="line-modified">!             }</span>
<span class="line-modified">!         },</span>
<span class="line-added">+ </span>
<span class="line-added">+         DUPLICATED {</span>
<span class="line-added">+             void build(int[] a, int m, Random random) {</span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = random.nextInt(m);</span>
                  }
              }
<span class="line-modified">!         },</span>
  
<span class="line-modified">!         ORGAN_PIPES {</span>
<span class="line-modified">!             void build(int[] a, int m, Random random) {</span>
<span class="line-modified">!                 int middle = a.length / (m + 1);</span>
  
<span class="line-modified">!                 for (int i = 0; i &lt; middle; i++) {</span>
<span class="line-modified">!                     a[i] = i;</span>
<span class="line-modified">!                 }</span>
  
<span class="line-modified">!                 for (int i = middle; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     a[i] = a.length - i - 1;</span>
<span class="line-added">+                 }</span>
              }
<span class="line-modified">!         },</span>
  
<span class="line-modified">!         STAGGER {</span>
<span class="line-modified">!             void build(int[] a, int m, Random random) {</span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = (i * m + i) % a.length;</span>
                  }
<span class="line-modified">!             }</span>
<span class="line-modified">!         },</span>
<span class="line-added">+ </span>
<span class="line-added">+         PLATEAU {</span>
<span class="line-added">+             void build(int[] a, int m, Random random) {</span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = Math.min(i, m);</span>
                  }
              }
<span class="line-modified">!         },</span>
<span class="line-added">+ </span>
<span class="line-added">+         SHUFFLE {</span>
<span class="line-added">+             void build(int[] a, int m, Random random) {</span>
<span class="line-added">+                 int x = 0, y = 0;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = random.nextBoolean() ? (x += 2) : (y += 2);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+         },</span>
<span class="line-added">+ </span>
<span class="line-added">+         LATCH {</span>
<span class="line-added">+             void build(int[] a, int m, Random random) {</span>
<span class="line-added">+                 int max = a.length / m;</span>
<span class="line-added">+                 max = max &lt; 2 ? 2 : max;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = i % max;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+         };</span>
<span class="line-added">+ </span>
<span class="line-added">+         abstract void build(int[] a, int m, Random random);</span>
      }
  
<span class="line-modified">!     private static enum MergingBuilder {</span>
<span class="line-modified">!         ASCENDING {</span>
<span class="line-modified">!             void build(int[] a, int m) {</span>
<span class="line-added">+                 int period = a.length / m;</span>
<span class="line-added">+                 int v = 1, i = 0;</span>
  
<span class="line-modified">!                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-modified">!                     v = 1;</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-modified">!                         a[i++] = v++;</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                 }</span>
  
<span class="line-modified">!                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-modified">!                     a[j] = v++;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+                 a[a.length - 1] = 0;</span>
              }
<span class="line-modified">!         },</span>
  
<span class="line-modified">!         DESCENDING {</span>
<span class="line-modified">!             void build(int[] a, int m) {</span>
<span class="line-added">+                 int period = a.length / m;</span>
<span class="line-added">+                 int v = -1, i = 0;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-added">+                     v = -1;</span>
<span class="line-added">+ </span>
<span class="line-added">+                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-added">+                         a[i++] = v--;</span>
<span class="line-added">+                     }</span>
                  }
<span class="line-modified">! </span>
<span class="line-modified">!                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-added">+                     a[j] = v--;</span>
                  }
<span class="line-added">+ </span>
<span class="line-added">+                 a[a.length - 1] = 0;</span>
              }
<span class="line-modified">!         },</span>
  
<span class="line-modified">!         POINT {</span>
<span class="line-modified">!             void build(int[] a, int m) {</span>
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = 0;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 a[a.length / 2] = m;</span>
<span class="line-added">+             }</span>
<span class="line-added">+         },</span>
  
<span class="line-modified">!         LINE {</span>
<span class="line-modified">!             void build(int[] a, int m) {</span>
<span class="line-modified">!                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">!                     a[i] = i;</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 reverse(a, 0, a.length - 1);</span>
<span class="line-modified">!             }</span>
<span class="line-added">+         },</span>
  
<span class="line-modified">!         PEARL {</span>
<span class="line-modified">!             void build(int[] a, int m) {</span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = i;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 reverse(a, 0, 2);</span>
              }
<span class="line-modified">!         },</span>
<span class="line-modified">! </span>
<span class="line-modified">!         RING {</span>
<span class="line-added">+             void build(int[] a, int m) {</span>
<span class="line-added">+                 int k1 = a.length / 3;</span>
<span class="line-added">+                 int k2 = a.length / 3 * 2;</span>
<span class="line-added">+                 int level = a.length / 3;</span>
  
<span class="line-modified">!                 for (int i = 0, k = level; i &lt; k1; i++) {</span>
<span class="line-modified">!                     a[i] = k--;</span>
                  }
<span class="line-modified">! </span>
<span class="line-modified">!                 for (int i = k1; i &lt; k2; i++) {</span>
<span class="line-added">+                     a[i] = 0;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+                 for (int i = k2, k = level; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = k--;</span>
                  }
              }
<span class="line-added">+         };</span>
<span class="line-added">+ </span>
<span class="line-added">+         abstract void build(int[] a, int m);</span>
<span class="line-added">+ </span>
<span class="line-added">+         private static void reverse(int[] a, int lo, int hi) {</span>
<span class="line-added">+             for (--hi; lo &lt; hi; ) {</span>
<span class="line-added">+                 int tmp = a[lo];</span>
<span class="line-added">+                 a[lo++] = a[hi];</span>
<span class="line-added">+                 a[hi--] = tmp;</span>
<span class="line-added">+             }</span>
          }
      }
  
<span class="line-modified">!     private static enum NegativeZeroBuilder {</span>
<span class="line-modified">!         FLOAT {</span>
<span class="line-modified">!             void build(Object o, Random random) {</span>
<span class="line-modified">!                 float[] a = (float[]) o;</span>
<span class="line-modified">! </span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = random.nextBoolean() ? -0.0f : 0.0f;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+         },</span>
<span class="line-added">+ </span>
<span class="line-added">+         DOUBLE {</span>
<span class="line-added">+             void build(Object o, Random random) {</span>
<span class="line-added">+                 double[] a = (double[]) o;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">+                     a[i] = random.nextBoolean() ? -0.0d : 0.0d;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+         };</span>
<span class="line-added">+ </span>
<span class="line-added">+         abstract void build(Object o, Random random);</span>
      }
  
<span class="line-modified">!     private static enum FloatingPointBuilder {</span>
<span class="line-modified">!         FLOAT {</span>
<span class="line-modified">!             void build(Object o, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-added">+                 float negativeValue = -random.nextFloat();</span>
<span class="line-added">+                 float positiveValue =  random.nextFloat();</span>
<span class="line-added">+                 float[] x = (float[]) o;</span>
<span class="line-added">+                 int fromIndex = 0;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-added">+                 fromIndex += n;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, -0.0f, fromIndex, g);</span>
<span class="line-added">+                 fromIndex += g;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, 0.0f, fromIndex, z);</span>
<span class="line-added">+                 fromIndex += z;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-added">+                 fromIndex += p;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, Float.NaN, fromIndex, a);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         },</span>
<span class="line-added">+ </span>
<span class="line-added">+         DOUBLE {</span>
<span class="line-added">+             void build(Object o, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-added">+                 double negativeValue = -random.nextFloat();</span>
<span class="line-added">+                 double positiveValue =  random.nextFloat();</span>
<span class="line-added">+                 double[] x = (double[]) o;</span>
<span class="line-added">+                 int fromIndex = 0;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-added">+                 fromIndex += n;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, -0.0d, fromIndex, g);</span>
<span class="line-added">+                 fromIndex += g;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, 0.0d, fromIndex, z);</span>
<span class="line-added">+                 fromIndex += z;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-added">+                 fromIndex += p;</span>
<span class="line-added">+ </span>
<span class="line-added">+                 writeValue(x, Double.NaN, fromIndex, a);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         };</span>
<span class="line-added">+ </span>
<span class="line-added">+         abstract void build(Object o, int a, int g, int z, int n, int p, Random random);</span>
<span class="line-added">+ </span>
<span class="line-added">+         private static void writeValue(float[] a, float value, int fromIndex, int count) {</span>
<span class="line-added">+             for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-added">+                 a[i] = value;</span>
<span class="line-added">+             }</span>
          }
  
<span class="line-modified">!         private static void writeValue(double[] a, double value, int fromIndex, int count) {</span>
<span class="line-modified">!             for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-modified">!                 a[i] = value;</span>
<span class="line-added">+             }</span>
          }
      }
  
<span class="line-modified">!     private static Comparator&lt;Pair&gt; pairComparator = new Comparator&lt;Pair&gt;() {</span>
<span class="line-modified">! </span>
<span class="line-modified">!         @Override</span>
<span class="line-added">+         public int compare(Pair p1, Pair p2) {</span>
<span class="line-added">+             return p1.compareTo(p2);</span>
          }
<span class="line-modified">!     };</span>
<span class="line-added">+ </span>
<span class="line-added">+     private static class Pair implements Comparable&lt;Pair&gt; {</span>
<span class="line-added">+ </span>
<span class="line-added">+         private Pair(int key, int value) {</span>
<span class="line-added">+             this.key = key;</span>
<span class="line-added">+             this.value = value;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         int getKey() {</span>
<span class="line-added">+             return key;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         int getValue() {</span>
<span class="line-added">+             return value;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         @Override</span>
<span class="line-added">+         public int compareTo(Pair pair) {</span>
<span class="line-added">+             return Integer.compare(key, pair.key);</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         @Override</span>
<span class="line-added">+         public String toString() {</span>
<span class="line-added">+             return &quot;(&quot; + key + &quot;, &quot; + value + &quot;)&quot;;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         private int key;</span>
<span class="line-added">+         private int value;</span>
      }
  
<span class="line-modified">!     private static class TestRandom extends Random {</span>
<span class="line-modified">! </span>
<span class="line-added">+         private static final TestRandom BABA = new TestRandom(0xBABA);</span>
<span class="line-added">+         private static final TestRandom DEDA = new TestRandom(0xDEDA);</span>
<span class="line-added">+         private static final TestRandom C0FFEE = new TestRandom(0xC0FFEE);</span>
<span class="line-added">+ </span>
<span class="line-added">+         private TestRandom(long seed) {</span>
              super(seed);
<span class="line-modified">!             this.seed = Long.toHexString(seed).toUpperCase();</span>
          }
  
<span class="line-modified">!         @Override</span>
<span class="line-modified">!         public String toString() {</span>
<span class="line-added">+             return seed;</span>
          }
  
<span class="line-modified">!         private String seed;</span>
      }
  }
</pre>
<center><a href="../../time/test/java/time/format/TestUnicodeExtension.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TimSortStackSize2.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>