<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/Arrays/Sorting.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../time/test/java/time/format/TestUnicodeExtension.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TimSortStackSize2.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/Arrays/Sorting.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2009, 2011, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 /*
  25  * @test
<span class="line-modified">  26  * @bug 6880672 6896573 6899694 6976036 7013585 7018258</span>
<span class="line-modified">  27  * @summary Exercise Arrays.sort</span>
  28  * @build Sorting
  29  * @run main Sorting -shortrun

  30  *
  31  * @author Vladimir Yaroslavskiy
  32  * @author Jon Bentley
  33  * @author Josh Bloch
  34  */
  35 
<span class="line-removed">  36 import java.util.Arrays;</span>
<span class="line-removed">  37 import java.util.Random;</span>
  38 import java.io.PrintStream;



  39 
  40 public class Sorting {

  41     private static final PrintStream out = System.out;
  42     private static final PrintStream err = System.err;
  43 
  44     // Array lengths used in a long run (default)
  45     private static final int[] LONG_RUN_LENGTHS = {
<span class="line-modified">  46         1, 2, 3, 5, 8, 13, 21, 34, 55, 100, 1000, 10000, 100000, 1000000 };</span>
  47 
  48     // Array lengths used in a short run
  49     private static final int[] SHORT_RUN_LENGTHS = {
<span class="line-modified">  50         1, 2, 3, 21, 55, 1000, 10000 };</span>
  51 
  52     // Random initial values used in a long run (default)
<span class="line-modified">  53     private static final long[] LONG_RUN_RANDOMS = { 666, 0xC0FFEE, 999 };</span>

  54 
  55     // Random initial values used in a short run
<span class="line-modified">  56     private static final long[] SHORT_RUN_RANDOMS = { 666 };</span>











  57 
  58     public static void main(String[] args) {
<span class="line-removed">  59         boolean shortRun = args.length &gt; 0 &amp;&amp; args[0].equals(&quot;-shortrun&quot;);</span>
  60         long start = System.currentTimeMillis();










  61 
<span class="line-removed">  62         if (shortRun) {</span>
<span class="line-removed">  63             testAndCheck(SHORT_RUN_LENGTHS, SHORT_RUN_RANDOMS);</span>
<span class="line-removed">  64         } else {</span>
<span class="line-removed">  65             testAndCheck(LONG_RUN_LENGTHS, LONG_RUN_RANDOMS);</span>
<span class="line-removed">  66         }</span>
  67         long end = System.currentTimeMillis();


















































  68 
<span class="line-modified">  69         out.format(&quot;PASSED in %d sec.\n&quot;, Math.round((end - start) / 1E3));</span>






  70     }
  71 
<span class="line-modified">  72     private static void testAndCheck(int[] lengths, long[] randoms) {</span>
  73         testEmptyAndNullIntArray();
  74         testEmptyAndNullLongArray();
<span class="line-removed">  75         testEmptyAndNullShortArray();</span>
<span class="line-removed">  76         testEmptyAndNullCharArray();</span>
  77         testEmptyAndNullByteArray();


  78         testEmptyAndNullFloatArray();
  79         testEmptyAndNullDoubleArray();

  80 
<span class="line-modified">  81         for (int length : lengths) {</span>
<span class="line-modified">  82             testMergeSort(length);</span>
<span class="line-modified">  83             testAndCheckRange(length);</span>
<span class="line-modified">  84             testAndCheckSubArray(length);</span>
<span class="line-modified">  85         }</span>
<span class="line-modified">  86         for (long seed : randoms) {</span>
<span class="line-modified">  87             for (int length : lengths) {</span>
<span class="line-modified">  88                 testAndCheckWithInsertionSort(length, new MyRandom(seed));</span>
<span class="line-modified">  89                 testAndCheckWithCheckSum(length, new MyRandom(seed));</span>
<span class="line-modified">  90                 testAndCheckWithScrambling(length, new MyRandom(seed));</span>
<span class="line-modified">  91                 testAndCheckFloat(length, new MyRandom(seed));</span>
<span class="line-modified">  92                 testAndCheckDouble(length, new MyRandom(seed));</span>
<span class="line-modified">  93                 testStable(length, new MyRandom(seed));</span>
<span class="line-modified">  94             }</span>
<span class="line-removed">  95         }</span>
  96     }
  97 
<span class="line-modified">  98     private static void testEmptyAndNullIntArray() {</span>
<span class="line-modified">  99         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified"> 100         Arrays.sort(new int[] {});</span>
<span class="line-removed"> 101         Arrays.sort(new int[] {}, 0, 0);</span>
 102 
 103         try {
<span class="line-modified"> 104             Arrays.sort((int[]) null);</span>
 105         } catch (NullPointerException expected) {
 106             try {
<span class="line-modified"> 107                 Arrays.sort((int[]) null, 0, 0);</span>
 108             } catch (NullPointerException expected2) {
 109                 return;
 110             }
<span class="line-modified"> 111             failed(&quot;Arrays.sort(int[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 112                 &quot;catch null array&quot;);
 113         }
<span class="line-modified"> 114         failed(&quot;Arrays.sort(int[]) shouldn&#39;t catch null array&quot;);</span>
 115     }
 116 
<span class="line-modified"> 117     private static void testEmptyAndNullLongArray() {</span>
<span class="line-modified"> 118         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified"> 119         Arrays.sort(new long[] {});</span>
<span class="line-removed"> 120         Arrays.sort(new long[] {}, 0, 0);</span>
 121 
 122         try {
<span class="line-modified"> 123             Arrays.sort((long[]) null);</span>
 124         } catch (NullPointerException expected) {
 125             try {
<span class="line-modified"> 126                 Arrays.sort((long[]) null, 0, 0);</span>
 127             } catch (NullPointerException expected2) {
 128                 return;
 129             }
<span class="line-modified"> 130             failed(&quot;Arrays.sort(long[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 131                 &quot;catch null array&quot;);
 132         }
<span class="line-modified"> 133         failed(&quot;Arrays.sort(long[]) shouldn&#39;t catch null array&quot;);</span>
 134     }
 135 
<span class="line-modified"> 136     private static void testEmptyAndNullShortArray() {</span>
<span class="line-modified"> 137         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified"> 138         Arrays.sort(new short[] {});</span>
<span class="line-removed"> 139         Arrays.sort(new short[] {}, 0, 0);</span>
 140 
 141         try {
<span class="line-modified"> 142             Arrays.sort((short[]) null);</span>
 143         } catch (NullPointerException expected) {
 144             try {
<span class="line-modified"> 145                 Arrays.sort((short[]) null, 0, 0);</span>
 146             } catch (NullPointerException expected2) {
 147                 return;
 148             }
<span class="line-modified"> 149             failed(&quot;Arrays.sort(short[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 150                 &quot;catch null array&quot;);
 151         }
<span class="line-modified"> 152         failed(&quot;Arrays.sort(short[]) shouldn&#39;t catch null array&quot;);</span>
 153     }
 154 
<span class="line-modified"> 155     private static void testEmptyAndNullCharArray() {</span>
<span class="line-modified"> 156         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified"> 157         Arrays.sort(new char[] {});</span>
<span class="line-removed"> 158         Arrays.sort(new char[] {}, 0, 0);</span>
 159 
 160         try {
<span class="line-modified"> 161             Arrays.sort((char[]) null);</span>
 162         } catch (NullPointerException expected) {
 163             try {
<span class="line-modified"> 164                 Arrays.sort((char[]) null, 0, 0);</span>
 165             } catch (NullPointerException expected2) {
 166                 return;
 167             }
<span class="line-modified"> 168             failed(&quot;Arrays.sort(char[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 169                 &quot;catch null array&quot;);
 170         }
<span class="line-modified"> 171         failed(&quot;Arrays.sort(char[]) shouldn&#39;t catch null array&quot;);</span>
 172     }
 173 
<span class="line-modified"> 174     private static void testEmptyAndNullByteArray() {</span>
<span class="line-modified"> 175         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified"> 176         Arrays.sort(new byte[] {});</span>
<span class="line-removed"> 177         Arrays.sort(new byte[] {}, 0, 0);</span>
 178 
 179         try {
<span class="line-modified"> 180             Arrays.sort((byte[]) null);</span>
 181         } catch (NullPointerException expected) {
 182             try {
<span class="line-modified"> 183                 Arrays.sort((byte[]) null, 0, 0);</span>
 184             } catch (NullPointerException expected2) {
 185                 return;
 186             }
<span class="line-modified"> 187             failed(&quot;Arrays.sort(byte[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 188                 &quot;catch null array&quot;);
 189         }
<span class="line-modified"> 190         failed(&quot;Arrays.sort(byte[]) shouldn&#39;t catch null array&quot;);</span>
 191     }
 192 
<span class="line-modified"> 193     private static void testEmptyAndNullFloatArray() {</span>
<span class="line-modified"> 194         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified"> 195         Arrays.sort(new float[] {});</span>
<span class="line-removed"> 196         Arrays.sort(new float[] {}, 0, 0);</span>
 197 
 198         try {
<span class="line-modified"> 199             Arrays.sort((float[]) null);</span>
 200         } catch (NullPointerException expected) {
 201             try {
<span class="line-modified"> 202                 Arrays.sort((float[]) null, 0, 0);</span>
 203             } catch (NullPointerException expected2) {
 204                 return;
 205             }
<span class="line-modified"> 206             failed(&quot;Arrays.sort(float[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 207                 &quot;catch null array&quot;);
 208         }
<span class="line-modified"> 209         failed(&quot;Arrays.sort(float[]) shouldn&#39;t catch null array&quot;);</span>
 210     }
 211 
<span class="line-modified"> 212     private static void testEmptyAndNullDoubleArray() {</span>
<span class="line-modified"> 213         ourDescription = &quot;Check empty and null array&quot;;</span>
<span class="line-modified"> 214         Arrays.sort(new double[] {});</span>
<span class="line-removed"> 215         Arrays.sort(new double[] {}, 0, 0);</span>
 216 
 217         try {
<span class="line-modified"> 218             Arrays.sort((double[]) null);</span>
 219         } catch (NullPointerException expected) {
 220             try {
<span class="line-modified"> 221                 Arrays.sort((double[]) null, 0, 0);</span>
 222             } catch (NullPointerException expected2) {
 223                 return;
 224             }
<span class="line-modified"> 225             failed(&quot;Arrays.sort(double[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 226                 &quot;catch null array&quot;);
 227         }
<span class="line-modified"> 228         failed(&quot;Arrays.sort(double[]) shouldn&#39;t catch null array&quot;);</span>
 229     }
 230 
<span class="line-modified"> 231     private static void testAndCheckSubArray(int length) {</span>
<span class="line-modified"> 232         ourDescription = &quot;Check sorting of subarray&quot;;</span>
<span class="line-modified"> 233         int[] golden = new int[length];</span>
<span class="line-modified"> 234         boolean newLine = false;</span>
<span class="line-modified"> 235 </span>
<span class="line-removed"> 236         for (int m = 1; m &lt; length / 2; m *= 2) {</span>
<span class="line-removed"> 237             newLine = true;</span>
 238             int fromIndex = m;
 239             int toIndex = length - m;
 240 
<span class="line-modified"> 241             prepareSubArray(golden, fromIndex, toIndex, m);</span>
<span class="line-modified"> 242             int[] test = golden.clone();</span>
 243 
<span class="line-modified"> 244             for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified"> 245                 out.println(&quot;Test &#39;subarray&#39;: &quot; + converter +</span>
<span class="line-modified"> 246                    &quot; length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified"> 247                 Object convertedGolden = converter.convert(golden);</span>
<span class="line-modified"> 248                 Object convertedTest = converter.convert(test);</span>
<span class="line-removed"> 249                 sortSubArray(convertedTest, fromIndex, toIndex);</span>
<span class="line-removed"> 250                 checkSubArray(convertedTest, fromIndex, toIndex, m);</span>
 251             }
 252         }
<span class="line-modified"> 253         if (newLine) {</span>
<span class="line-removed"> 254             out.println();</span>
<span class="line-removed"> 255         }</span>
 256     }
 257 
<span class="line-modified"> 258     private static void testAndCheckRange(int length) {</span>
<span class="line-modified"> 259         ourDescription = &quot;Check range check&quot;;</span>
<span class="line-modified"> 260         int[] golden = new int[length];</span>
<span class="line-modified"> 261 </span>
<span class="line-modified"> 262         for (int m = 1; m &lt; 2 * length; m *= 2) {</span>
 263             for (int i = 1; i &lt;= length; i++) {
<span class="line-modified"> 264                 golden[i - 1] = i % m + m % i;</span>
 265             }
<span class="line-modified"> 266             for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified"> 267                 out.println(&quot;Test &#39;range&#39;: &quot; + converter +</span>
<span class="line-modified"> 268                    &quot;, length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified"> 269                 Object convertedGolden = converter.convert(golden);</span>
<span class="line-modified"> 270                 checkRange(convertedGolden, m);</span>

 271             }
 272         }
 273         out.println();
 274     }
 275 
<span class="line-modified"> 276     private static void testStable(int length, MyRandom random) {</span>
<span class="line-removed"> 277         ourDescription = &quot;Check if sorting is stable&quot;;</span>
<span class="line-removed"> 278         Pair[] a = build(length, random);</span>
<span class="line-removed"> 279 </span>
<span class="line-removed"> 280         out.println(&quot;Test &#39;stable&#39;: &quot; + &quot;random = &quot; + random.getSeed() +</span>
<span class="line-removed"> 281             &quot;, length = &quot; + length);</span>
<span class="line-removed"> 282         Arrays.sort(a);</span>
<span class="line-removed"> 283         checkSorted(a);</span>
<span class="line-removed"> 284         checkStable(a);</span>
<span class="line-removed"> 285         out.println();</span>
<span class="line-removed"> 286     }</span>
<span class="line-removed"> 287 </span>
<span class="line-removed"> 288     private static void checkSorted(Pair[] a) {</span>
 289         for (int i = 0; i &lt; a.length - 1; i++) {
 290             if (a[i].getKey() &gt; a[i + 1].getKey()) {
<span class="line-modified"> 291                 failedSort(i, &quot;&quot; + a[i].getKey(), &quot;&quot; + a[i + 1].getKey());</span>

 292             }
 293         }
 294     }
 295 
<span class="line-modified"> 296     private static void checkStable(Pair[] a) {</span>
 297         for (int i = 0; i &lt; a.length / 4; ) {
 298             int key1 = a[i].getKey();
 299             int value1 = a[i++].getValue();
 300             int key2 = a[i].getKey();
 301             int value2 = a[i++].getValue();
 302             int key3 = a[i].getKey();
 303             int value3 = a[i++].getValue();
 304             int key4 = a[i].getKey();
 305             int value4 = a[i++].getValue();
 306 
 307             if (!(key1 == key2 &amp;&amp; key2 == key3 &amp;&amp; key3 == key4)) {
<span class="line-modified"> 308                 failed(&quot;On position &quot; + i + &quot; keys are different &quot; +</span>
<span class="line-modified"> 309                     key1 + &quot;, &quot; + key2 + &quot;, &quot; + key3 + &quot;, &quot; + key4);</span>
 310             }
 311             if (!(value1 &lt; value2 &amp;&amp; value2 &lt; value3 &amp;&amp; value3 &lt; value4)) {
<span class="line-modified"> 312                 failed(&quot;Sorting is not stable at position &quot; + i +</span>
<span class="line-modified"> 313                     &quot;. Second values have been changed: &quot; +  value1 + &quot;, &quot; +</span>
 314                     value2 + &quot;, &quot; + value3 + &quot;, &quot; + value4);
 315             }
 316         }
 317     }
 318 
<span class="line-modified"> 319     private static Pair[] build(int length, Random random) {</span>
 320         Pair[] a = new Pair[length * 4];
 321 
 322         for (int i = 0; i &lt; a.length; ) {
 323             int key = random.nextInt();
 324             a[i++] = new Pair(key, 1);
 325             a[i++] = new Pair(key, 2);
 326             a[i++] = new Pair(key, 3);
 327             a[i++] = new Pair(key, 4);
 328         }
 329         return a;
 330     }
 331 
<span class="line-modified"> 332     private static final class Pair implements Comparable&lt;Pair&gt; {</span>
<span class="line-removed"> 333         Pair(int key, int value) {</span>
<span class="line-removed"> 334             myKey = key;</span>
<span class="line-removed"> 335             myValue = value;</span>
<span class="line-removed"> 336         }</span>
<span class="line-removed"> 337 </span>
<span class="line-removed"> 338         int getKey() {</span>
<span class="line-removed"> 339             return myKey;</span>
<span class="line-removed"> 340         }</span>
<span class="line-removed"> 341 </span>
<span class="line-removed"> 342         int getValue() {</span>
<span class="line-removed"> 343             return myValue;</span>
<span class="line-removed"> 344         }</span>
<span class="line-removed"> 345 </span>
<span class="line-removed"> 346         public int compareTo(Pair pair) {</span>
<span class="line-removed"> 347             if (myKey &lt; pair.myKey) {</span>
<span class="line-removed"> 348                 return -1;</span>
<span class="line-removed"> 349             }</span>
<span class="line-removed"> 350             if (myKey &gt; pair.myKey) {</span>
<span class="line-removed"> 351                 return 1;</span>
<span class="line-removed"> 352             }</span>
<span class="line-removed"> 353             return 0;</span>
<span class="line-removed"> 354         }</span>
<span class="line-removed"> 355 </span>
<span class="line-removed"> 356         @Override</span>
<span class="line-removed"> 357         public String toString() {</span>
<span class="line-removed"> 358             return &quot;(&quot; + myKey + &quot;, &quot; + myValue + &quot;)&quot;;</span>
<span class="line-removed"> 359         }</span>
<span class="line-removed"> 360 </span>
<span class="line-removed"> 361         private int myKey;</span>
<span class="line-removed"> 362         private int myValue;</span>
<span class="line-removed"> 363     }</span>
<span class="line-removed"> 364 </span>
<span class="line-removed"> 365 </span>
<span class="line-removed"> 366     private static void testAndCheckWithInsertionSort(int length, MyRandom random) {</span>
 367         if (length &gt; 1000) {
 368             return;
 369         }
<span class="line-modified"> 370         ourDescription = &quot;Check sorting with insertion sort&quot;;</span>
<span class="line-removed"> 371         int[] golden = new int[length];</span>
<span class="line-removed"> 372 </span>
<span class="line-removed"> 373         for (int m = 1; m &lt; 2 * length; m *= 2) {</span>
 374             for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<span class="line-modified"> 375                 builder.build(golden, m, random);</span>
<span class="line-modified"> 376                 int[] test = golden.clone();</span>
<span class="line-modified"> 377 </span>
<span class="line-modified"> 378                 for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified"> 379                     out.println(&quot;Test &#39;insertion sort&#39;: &quot; + converter +</span>
<span class="line-modified"> 380                         &quot; &quot; + builder + &quot;random = &quot; + random.getSeed() +</span>
<span class="line-modified"> 381                         &quot;, length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified"> 382                     Object convertedGolden = converter.convert(golden);</span>
<span class="line-modified"> 383                     Object convertedTest1 = converter.convert(test);</span>
<span class="line-removed"> 384                     Object convertedTest2 = converter.convert(test);</span>
<span class="line-removed"> 385                     sort(convertedTest1);</span>
<span class="line-removed"> 386                     sortByInsertionSort(convertedTest2);</span>
<span class="line-removed"> 387                     compare(convertedTest1, convertedTest2);</span>
 388                 }
 389             }
 390         }
 391         out.println();
 392     }
 393 
<span class="line-modified"> 394     private static void testMergeSort(int length) {</span>
<span class="line-modified"> 395         if (length &lt; 1000) {</span>
 396             return;
 397         }
<span class="line-modified"> 398         ourDescription = &quot;Check merge sorting&quot;;</span>
<span class="line-modified"> 399         int[] golden = new int[length];</span>
<span class="line-modified"> 400         int period = 67; // java.util.DualPivotQuicksort.MAX_RUN_COUNT</span>
<span class="line-modified"> 401 </span>
<span class="line-modified"> 402         for (int m = period - 2; m &lt;= period + 2; m++) {</span>
<span class="line-modified"> 403             for (MergeBuilder builder : MergeBuilder.values()) {</span>
<span class="line-modified"> 404                 builder.build(golden, m);</span>
<span class="line-modified"> 405                 int[] test = golden.clone();</span>
<span class="line-modified"> 406 </span>
<span class="line-modified"> 407                 for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified"> 408                     out.println(&quot;Test &#39;merge sort&#39;: &quot; + converter + &quot; &quot; +</span>
<span class="line-modified"> 409                         builder + &quot;length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-removed"> 410                     Object convertedGolden = converter.convert(golden);</span>
<span class="line-removed"> 411                     sort(convertedGolden);</span>
<span class="line-removed"> 412                     checkSorted(convertedGolden);</span>
 413                 }
 414             }
 415         }
 416         out.println();
 417     }
 418 
<span class="line-modified"> 419     private static void testAndCheckWithCheckSum(int length, MyRandom random) {</span>
<span class="line-modified"> 420         ourDescription = &quot;Check sorting with check sum&quot;;</span>
<span class="line-removed"> 421         int[] golden = new int[length];</span>
<span class="line-removed"> 422 </span>
<span class="line-removed"> 423         for (int m = 1; m &lt; 2 * length; m *= 2) {</span>
 424             for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<span class="line-modified"> 425                 builder.build(golden, m, random);</span>
<span class="line-modified"> 426                 int[] test = golden.clone();</span>
<span class="line-modified"> 427 </span>
<span class="line-modified"> 428                 for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified"> 429                     out.println(&quot;Test &#39;check sum&#39;: &quot; + converter +</span>
<span class="line-modified"> 430                         &quot; &quot; + builder + &quot;random = &quot; + random.getSeed() +</span>
<span class="line-modified"> 431                         &quot;, length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified"> 432                     Object convertedGolden = converter.convert(golden);</span>
<span class="line-removed"> 433                     Object convertedTest = converter.convert(test);</span>
<span class="line-removed"> 434                     sort(convertedTest);</span>
<span class="line-removed"> 435                     checkWithCheckSum(convertedTest, convertedGolden);</span>
 436                 }
 437             }
 438         }
 439         out.println();
 440     }
 441 
<span class="line-modified"> 442     private static void testAndCheckWithScrambling(int length, MyRandom random) {</span>
<span class="line-modified"> 443         ourDescription = &quot;Check sorting with scrambling&quot;;</span>
<span class="line-removed"> 444         int[] golden = new int[length];</span>
<span class="line-removed"> 445 </span>
<span class="line-removed"> 446         for (int m = 1; m &lt;= 7; m++) {</span>
<span class="line-removed"> 447             if (m &gt; length) {</span>
<span class="line-removed"> 448                 break;</span>
<span class="line-removed"> 449             }</span>
 450             for (SortedBuilder builder : SortedBuilder.values()) {
<span class="line-modified"> 451                 builder.build(golden, m);</span>
<span class="line-modified"> 452                 int[] test = golden.clone();</span>
<span class="line-modified"> 453                 scramble(test, random);</span>
<span class="line-modified"> 454 </span>
<span class="line-modified"> 455                 for (TypeConverter converter : TypeConverter.values()) {</span>
<span class="line-modified"> 456                     out.println(&quot;Test &#39;scrambling&#39;: &quot; + converter +</span>
<span class="line-modified"> 457                        &quot; &quot; + builder + &quot;random = &quot; + random.getSeed() +</span>
<span class="line-modified"> 458                        &quot;, length = &quot; + length + &quot;, m = &quot; + m);</span>
<span class="line-modified"> 459                     Object convertedGolden = converter.convert(golden);</span>
<span class="line-removed"> 460                     Object convertedTest = converter.convert(test);</span>
<span class="line-removed"> 461                     sort(convertedTest);</span>
<span class="line-removed"> 462                     compare(convertedTest, convertedGolden);</span>
 463                 }
 464             }
 465         }
 466         out.println();
 467     }
 468 
<span class="line-modified"> 469     private static void testAndCheckFloat(int length, MyRandom random) {</span>
<span class="line-modified"> 470         ourDescription = &quot;Check float sorting&quot;;</span>
<span class="line-modified"> 471         float[] golden = new float[length];</span>
<span class="line-removed"> 472         final int MAX = 10;</span>
<span class="line-removed"> 473         boolean newLine = false;</span>
 474 
<span class="line-modified"> 475         for (int a = 0; a &lt;= MAX; a++) {</span>
<span class="line-modified"> 476             for (int g = 0; g &lt;= MAX; g++) {</span>
<span class="line-modified"> 477                 for (int z = 0; z &lt;= MAX; z++) {</span>
<span class="line-modified"> 478                     for (int n = 0; n &lt;= MAX; n++) {</span>
<span class="line-modified"> 479                         for (int p = 0; p &lt;= MAX; p++) {</span>
<span class="line-removed"> 480                             if (a + g + z + n + p &gt; length) {</span>
<span class="line-removed"> 481                                 continue;</span>
<span class="line-removed"> 482                             }</span>
<span class="line-removed"> 483                             if (a + g + z + n + p &lt; length) {</span>
<span class="line-removed"> 484                                 continue;</span>
<span class="line-removed"> 485                             }</span>
<span class="line-removed"> 486                             for (FloatBuilder builder : FloatBuilder.values()) {</span>
<span class="line-removed"> 487                                 out.println(&quot;Test &#39;float&#39;: random = &quot; + random.getSeed() +</span>
<span class="line-removed"> 488                                    &quot;, length = &quot; + length + &quot;, a = &quot; + a + &quot;, g = &quot; +</span>
<span class="line-removed"> 489                                    g + &quot;, z = &quot; + z + &quot;, n = &quot; + n + &quot;, p = &quot; + p);</span>
<span class="line-removed"> 490                                 builder.build(golden, a, g, z, n, p, random);</span>
<span class="line-removed"> 491                                 float[] test = golden.clone();</span>
<span class="line-removed"> 492                                 scramble(test, random);</span>
<span class="line-removed"> 493                                 sort(test);</span>
<span class="line-removed"> 494                                 compare(test, golden, a, n, g);</span>
<span class="line-removed"> 495                             }</span>
<span class="line-removed"> 496                             newLine = true;</span>
<span class="line-removed"> 497                         }</span>
<span class="line-removed"> 498                     }</span>
<span class="line-removed"> 499                 }</span>
<span class="line-removed"> 500             }</span>
<span class="line-removed"> 501         }</span>
<span class="line-removed"> 502         if (newLine) {</span>
<span class="line-removed"> 503             out.println();</span>
 504         }

 505     }
 506 
<span class="line-modified"> 507     private static void testAndCheckDouble(int length, MyRandom random) {</span>
<span class="line-modified"> 508         ourDescription = &quot;Check double sorting&quot;;</span>
<span class="line-modified"> 509         double[] golden = new double[length];</span>
<span class="line-modified"> 510         final int MAX = 10;</span>
<span class="line-modified"> 511         boolean newLine = false;</span>
 512 
<span class="line-modified"> 513         for (int a = 0; a &lt;= MAX; a++) {</span>
<span class="line-modified"> 514             for (int g = 0; g &lt;= MAX; g++) {</span>
<span class="line-modified"> 515                 for (int z = 0; z &lt;= MAX; z++) {</span>
<span class="line-modified"> 516                     for (int n = 0; n &lt;= MAX; n++) {</span>
<span class="line-modified"> 517                         for (int p = 0; p &lt;= MAX; p++) {</span>
<span class="line-modified"> 518                             if (a + g + z + n + p &gt; length) {</span>
<span class="line-removed"> 519                                 continue;</span>
<span class="line-removed"> 520                             }</span>
<span class="line-removed"> 521                             if (a + g + z + n + p &lt; length) {</span>
 522                                 continue;
 523                             }
<span class="line-modified"> 524                             for (DoubleBuilder builder : DoubleBuilder.values()) {</span>
<span class="line-modified"> 525                                 out.println(&quot;Test &#39;double&#39;: random = &quot; + random.getSeed() +</span>
<span class="line-modified"> 526                                    &quot;, length = &quot; + length + &quot;, a = &quot; + a + &quot;, g = &quot; +</span>
<span class="line-modified"> 527                                    g + &quot;, z = &quot; + z + &quot;, n = &quot; + n + &quot;, p = &quot; + p);</span>
<span class="line-modified"> 528                                 builder.build(golden, a, g, z, n, p, random);</span>
<span class="line-modified"> 529                                 double[] test = golden.clone();</span>
<span class="line-modified"> 530                                 scramble(test, random);</span>
<span class="line-modified"> 531                                 sort(test);</span>
<span class="line-modified"> 532                                 compare(test, golden, a, n, g);</span>

 533                             }
<span class="line-removed"> 534                             newLine = true;</span>
 535                         }
 536                     }
 537                 }
 538             }
 539         }
<span class="line-modified"> 540         if (newLine) {</span>
<span class="line-modified"> 541             out.println();</span>















 542         }

 543     }
 544 
<span class="line-modified"> 545     private static void prepareSubArray(int[] a, int fromIndex, int toIndex, int m) {</span>
 546         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified"> 547             a[i] = 0xDEDA;</span>
 548         }
 549         int middle = (fromIndex + toIndex) &gt;&gt;&gt; 1;
 550         int k = 0;
 551 
 552         for (int i = fromIndex; i &lt; middle; i++) {
 553             a[i] = k++;
 554         }

 555         for (int i = middle; i &lt; toIndex; i++) {
 556             a[i] = k--;
 557         }

 558         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified"> 559             a[i] = 0xBABA;</span>




















 560         }
 561     }
 562 
<span class="line-modified"> 563     private static void scramble(int[] a, Random random) {</span>
 564         for (int i = 0; i &lt; a.length * 7; i++) {
 565             swap(a, random.nextInt(a.length), random.nextInt(a.length));
 566         }
 567     }
 568 
<span class="line-modified"> 569     private static void scramble(float[] a, Random random) {</span>
 570         for (int i = 0; i &lt; a.length * 7; i++) {
 571             swap(a, random.nextInt(a.length), random.nextInt(a.length));
 572         }
 573     }
 574 
<span class="line-modified"> 575     private static void scramble(double[] a, Random random) {</span>
 576         for (int i = 0; i &lt; a.length * 7; i++) {
 577             swap(a, random.nextInt(a.length), random.nextInt(a.length));
 578         }
 579     }
 580 
<span class="line-modified"> 581     private static void swap(int[] a, int i, int j) {</span>
<span class="line-modified"> 582         int t = a[i];</span>
<span class="line-modified"> 583         a[i] = a[j];</span>
<span class="line-modified"> 584         a[j] = t;</span>
 585     }
 586 
<span class="line-modified"> 587     private static void swap(float[] a, int i, int j) {</span>
<span class="line-modified"> 588         float t = a[i];</span>
<span class="line-modified"> 589         a[i] = a[j];</span>
<span class="line-modified"> 590         a[j] = t;</span>
 591     }
 592 
<span class="line-modified"> 593     private static void swap(double[] a, int i, int j) {</span>
<span class="line-modified"> 594         double t = a[i];</span>
<span class="line-modified"> 595         a[i] = a[j];</span>
<span class="line-modified"> 596         a[j] = t;</span>
 597     }
 598 
<span class="line-modified"> 599     private static enum TypeConverter {</span>
<span class="line-modified"> 600         INT {</span>
<span class="line-modified"> 601             Object convert(int[] a) {</span>
<span class="line-modified"> 602                 return a.clone();</span>
<span class="line-modified"> 603             }</span>
<span class="line-removed"> 604         },</span>
<span class="line-removed"> 605         LONG {</span>
<span class="line-removed"> 606             Object convert(int[] a) {</span>
<span class="line-removed"> 607                 long[] b = new long[a.length];</span>
 608 
<span class="line-modified"> 609                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 610                     b[i] = (long) a[i];</span>
<span class="line-modified"> 611                 }</span>
<span class="line-removed"> 612                 return b;</span>
<span class="line-removed"> 613             }</span>
<span class="line-removed"> 614         },</span>
<span class="line-removed"> 615         BYTE {</span>
<span class="line-removed"> 616             Object convert(int[] a) {</span>
<span class="line-removed"> 617                 byte[] b = new byte[a.length];</span>
 618 
<span class="line-modified"> 619                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 620                     b[i] = (byte) a[i];</span>
<span class="line-modified"> 621                 }</span>
<span class="line-removed"> 622                 return b;</span>
<span class="line-removed"> 623             }</span>
<span class="line-removed"> 624         },</span>
<span class="line-removed"> 625         SHORT {</span>
<span class="line-removed"> 626             Object convert(int[] a) {</span>
<span class="line-removed"> 627                 short[] b = new short[a.length];</span>
 628 
<span class="line-modified"> 629                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 630                     b[i] = (short) a[i];</span>
<span class="line-modified"> 631                 }</span>
<span class="line-removed"> 632                 return b;</span>
<span class="line-removed"> 633             }</span>
<span class="line-removed"> 634         },</span>
<span class="line-removed"> 635         CHAR {</span>
<span class="line-removed"> 636             Object convert(int[] a) {</span>
<span class="line-removed"> 637                 char[] b = new char[a.length];</span>
 638 
<span class="line-modified"> 639                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 640                     b[i] = (char) a[i];</span>
<span class="line-modified"> 641                 }</span>
<span class="line-removed"> 642                 return b;</span>
<span class="line-removed"> 643             }</span>
<span class="line-removed"> 644         },</span>
<span class="line-removed"> 645         FLOAT {</span>
<span class="line-removed"> 646             Object convert(int[] a) {</span>
<span class="line-removed"> 647                 float[] b = new float[a.length];</span>
 648 
<span class="line-modified"> 649                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 650                     b[i] = (float) a[i];</span>
<span class="line-modified"> 651                 }</span>
<span class="line-removed"> 652                 return b;</span>
<span class="line-removed"> 653             }</span>
<span class="line-removed"> 654         },</span>
<span class="line-removed"> 655         DOUBLE {</span>
<span class="line-removed"> 656             Object convert(int[] a) {</span>
<span class="line-removed"> 657                 double[] b = new double[a.length];</span>
 658 
<span class="line-modified"> 659                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 660                     b[i] = (double) a[i];</span>
<span class="line-modified"> 661                 }</span>
<span class="line-removed"> 662                 return b;</span>
<span class="line-removed"> 663             }</span>
<span class="line-removed"> 664         },</span>
<span class="line-removed"> 665         INTEGER {</span>
<span class="line-removed"> 666             Object convert(int[] a) {</span>
<span class="line-removed"> 667                 Integer[] b = new Integer[a.length];</span>
 668 
<span class="line-modified"> 669                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 670                     b[i] = new Integer(a[i]);</span>
<span class="line-modified"> 671                 }</span>
<span class="line-removed"> 672                 return b;</span>
<span class="line-removed"> 673             }</span>
<span class="line-removed"> 674         };</span>
 675 
<span class="line-modified"> 676         abstract Object convert(int[] a);</span>



 677 
<span class="line-modified"> 678         @Override public String toString() {</span>
<span class="line-modified"> 679             String name = name();</span>


 680 
<span class="line-modified"> 681             for (int i = name.length(); i &lt; 9; i++) {</span>
<span class="line-modified"> 682                 name += &quot; &quot;;</span>
<span class="line-modified"> 683             }</span>
<span class="line-modified"> 684             return name;</span>



 685         }
 686     }
 687 
<span class="line-modified"> 688     private static enum FloatBuilder {</span>
<span class="line-modified"> 689         SIMPLE {</span>
<span class="line-modified"> 690             void build(float[] x, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-modified"> 691                 int fromIndex = 0;</span>
<span class="line-removed"> 692                 float negativeValue = -random.nextFloat();</span>
<span class="line-removed"> 693                 float positiveValue =  random.nextFloat();</span>
<span class="line-removed"> 694 </span>
<span class="line-removed"> 695                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-removed"> 696                 fromIndex += n;</span>
<span class="line-removed"> 697 </span>
<span class="line-removed"> 698                 writeValue(x, -0.0f, fromIndex, g);</span>
<span class="line-removed"> 699                 fromIndex += g;</span>
<span class="line-removed"> 700 </span>
<span class="line-removed"> 701                 writeValue(x, 0.0f, fromIndex, z);</span>
<span class="line-removed"> 702                 fromIndex += z;</span>
<span class="line-removed"> 703 </span>
<span class="line-removed"> 704                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-removed"> 705                 fromIndex += p;</span>
<span class="line-removed"> 706 </span>
<span class="line-removed"> 707                 writeValue(x, Float.NaN, fromIndex, a);</span>
 708             }
<span class="line-modified"> 709         };</span>
<span class="line-removed"> 710 </span>
<span class="line-removed"> 711         abstract void build(float[] x, int a, int g, int z, int n, int p, Random random);</span>
 712     }
 713 
<span class="line-modified"> 714     private static enum DoubleBuilder {</span>
<span class="line-modified"> 715         SIMPLE {</span>
<span class="line-modified"> 716             void build(double[] x, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-modified"> 717                 int fromIndex = 0;</span>
<span class="line-removed"> 718                 double negativeValue = -random.nextFloat();</span>
<span class="line-removed"> 719                 double positiveValue =  random.nextFloat();</span>
<span class="line-removed"> 720 </span>
<span class="line-removed"> 721                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-removed"> 722                 fromIndex += n;</span>
<span class="line-removed"> 723 </span>
<span class="line-removed"> 724                 writeValue(x, -0.0d, fromIndex, g);</span>
<span class="line-removed"> 725                 fromIndex += g;</span>
<span class="line-removed"> 726 </span>
<span class="line-removed"> 727                 writeValue(x, 0.0d, fromIndex, z);</span>
<span class="line-removed"> 728                 fromIndex += z;</span>
<span class="line-removed"> 729 </span>
<span class="line-removed"> 730                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-removed"> 731                 fromIndex += p;</span>
<span class="line-removed"> 732 </span>
<span class="line-removed"> 733                 writeValue(x, Double.NaN, fromIndex, a);</span>
 734             }
<span class="line-modified"> 735         };</span>
<span class="line-removed"> 736 </span>
<span class="line-removed"> 737         abstract void build(double[] x, int a, int g, int z, int n, int p, Random random);</span>
 738     }
 739 
<span class="line-modified"> 740     private static void writeValue(float[] a, float value, int fromIndex, int count) {</span>
<span class="line-modified"> 741         for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-modified"> 742             a[i] = value;</span>




 743         }
 744     }
 745 
<span class="line-modified"> 746     private static void compare(float[] a, float[] b, int numNaN, int numNeg, int numNegZero) {</span>
 747         for (int i = a.length - numNaN; i &lt; a.length; i++) {
 748             if (a[i] == a[i]) {
<span class="line-modified"> 749                 failed(&quot;On position &quot; + i + &quot; must be NaN instead of &quot; + a[i]);</span>
 750             }
 751         }
 752         final int NEGATIVE_ZERO = Float.floatToIntBits(-0.0f);
 753 
 754         for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
 755             if (NEGATIVE_ZERO != Float.floatToIntBits(a[i])) {
<span class="line-modified"> 756                 failed(&quot;On position &quot; + i + &quot; must be -0.0 instead of &quot; + a[i]);</span>
 757             }
 758         }

 759         for (int i = 0; i &lt; a.length - numNaN; i++) {
 760             if (a[i] != b[i]) {
<span class="line-modified"> 761                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
 762             }
 763         }
 764     }
 765 
<span class="line-modified"> 766     private static void writeValue(double[] a, double value, int fromIndex, int count) {</span>
<span class="line-removed"> 767         for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-removed"> 768             a[i] = value;</span>
<span class="line-removed"> 769         }</span>
<span class="line-removed"> 770     }</span>
<span class="line-removed"> 771 </span>
<span class="line-removed"> 772     private static void compare(double[] a, double[] b, int numNaN, int numNeg, int numNegZero) {</span>
 773         for (int i = a.length - numNaN; i &lt; a.length; i++) {
 774             if (a[i] == a[i]) {
<span class="line-modified"> 775                 failed(&quot;On position &quot; + i + &quot; must be NaN instead of &quot; + a[i]);</span>
 776             }
 777         }
 778         final long NEGATIVE_ZERO = Double.doubleToLongBits(-0.0d);
 779 
 780         for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
 781             if (NEGATIVE_ZERO != Double.doubleToLongBits(a[i])) {
<span class="line-modified"> 782                 failed(&quot;On position &quot; + i + &quot; must be -0.0 instead of &quot; + a[i]);</span>
 783             }
 784         }

 785         for (int i = 0; i &lt; a.length - numNaN; i++) {
 786             if (a[i] != b[i]) {
<span class="line-modified"> 787                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
<span class="line-modified"> 788             }</span>




















 789         }
 790     }
 791 
<span class="line-modified"> 792     private static enum SortedBuilder {</span>
<span class="line-modified"> 793         REPEATED {</span>
<span class="line-modified"> 794             void build(int[] a, int m) {</span>
<span class="line-modified"> 795                 int period = a.length / m;</span>
<span class="line-modified"> 796                 int i = 0;</span>
<span class="line-modified"> 797                 int k = 0;</span>

 798 
<span class="line-modified"> 799                 while (true) {</span>
<span class="line-modified"> 800                     for (int t = 1; t &lt;= period; t++) {</span>
<span class="line-modified"> 801                         if (i &gt;= a.length) {</span>
<span class="line-modified"> 802                             return;</span>
<span class="line-removed"> 803                         }</span>
<span class="line-removed"> 804                         a[i++] = k;</span>
<span class="line-removed"> 805                     }</span>
<span class="line-removed"> 806                     if (i &gt;= a.length) {</span>
<span class="line-removed"> 807                         return;</span>
<span class="line-removed"> 808                     }</span>
<span class="line-removed"> 809                     k++;</span>
<span class="line-removed"> 810                 }</span>
 811             }
<span class="line-modified"> 812         },</span>
<span class="line-modified"> 813         ORGAN_PIPES {</span>
<span class="line-removed"> 814             void build(int[] a, int m) {</span>
<span class="line-removed"> 815                 int i = 0;</span>
<span class="line-removed"> 816                 int k = m;</span>
 817 
<span class="line-modified"> 818                 while (true) {</span>
<span class="line-removed"> 819                     for (int t = 1; t &lt;= m; t++) {</span>
<span class="line-removed"> 820                         if (i &gt;= a.length) {</span>
<span class="line-removed"> 821                             return;</span>
<span class="line-removed"> 822                         }</span>
<span class="line-removed"> 823                         a[i++] = k;</span>
<span class="line-removed"> 824                     }</span>
<span class="line-removed"> 825                 }</span>
<span class="line-removed"> 826             }</span>
<span class="line-removed"> 827         };</span>
<span class="line-removed"> 828 </span>
<span class="line-removed"> 829         abstract void build(int[] a, int m);</span>
<span class="line-removed"> 830 </span>
<span class="line-removed"> 831         @Override public String toString() {</span>
<span class="line-removed"> 832             String name = name();</span>
<span class="line-removed"> 833 </span>
<span class="line-removed"> 834             for (int i = name.length(); i &lt; 12; i++) {</span>
<span class="line-removed"> 835                 name += &quot; &quot;;</span>
<span class="line-removed"> 836             }</span>
<span class="line-removed"> 837             return name;</span>
<span class="line-removed"> 838         }</span>
<span class="line-removed"> 839     }</span>
<span class="line-removed"> 840 </span>
<span class="line-removed"> 841     private static enum MergeBuilder {</span>
<span class="line-removed"> 842         ASCENDING {</span>
<span class="line-removed"> 843             void build(int[] a, int m) {</span>
<span class="line-removed"> 844                 int period = a.length / m;</span>
<span class="line-removed"> 845                 int v = 1, i = 0;</span>
<span class="line-removed"> 846 </span>
<span class="line-removed"> 847                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-removed"> 848                     v = 1;</span>
<span class="line-removed"> 849                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-removed"> 850                         a[i++] = v++;</span>
<span class="line-removed"> 851                     }</span>
<span class="line-removed"> 852                 }</span>
<span class="line-removed"> 853                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-removed"> 854                     a[j] = v++;</span>
<span class="line-removed"> 855                 }</span>
<span class="line-removed"> 856                 a[a.length - 1] = 0;</span>
<span class="line-removed"> 857             }</span>
<span class="line-removed"> 858         },</span>
<span class="line-removed"> 859         DESCENDING {</span>
<span class="line-removed"> 860             void build(int[] a, int m) {</span>
<span class="line-removed"> 861                 int period = a.length / m;</span>
<span class="line-removed"> 862                 int v = -1, i = 0;</span>
<span class="line-removed"> 863 </span>
<span class="line-removed"> 864                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-removed"> 865                     v = -1;</span>
<span class="line-removed"> 866                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-removed"> 867                         a[i++] = v--;</span>
<span class="line-removed"> 868                     }</span>
<span class="line-removed"> 869                 }</span>
<span class="line-removed"> 870                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-removed"> 871                     a[j] = v--;</span>
<span class="line-removed"> 872                 }</span>
<span class="line-removed"> 873                 a[a.length - 1] = 0;</span>
<span class="line-removed"> 874             }</span>
<span class="line-removed"> 875         };</span>
<span class="line-removed"> 876 </span>
<span class="line-removed"> 877         abstract void build(int[] a, int m);</span>
<span class="line-removed"> 878 </span>
<span class="line-removed"> 879         @Override public String toString() {</span>
<span class="line-removed"> 880             String name = name();</span>
<span class="line-removed"> 881 </span>
<span class="line-removed"> 882             for (int i = name.length(); i &lt; 12; i++) {</span>
<span class="line-removed"> 883                 name += &quot; &quot;;</span>
<span class="line-removed"> 884             }</span>
<span class="line-removed"> 885             return name;</span>
<span class="line-removed"> 886         }</span>
<span class="line-removed"> 887     }</span>
<span class="line-removed"> 888 </span>
<span class="line-removed"> 889     private static enum UnsortedBuilder {</span>
<span class="line-removed"> 890         RANDOM {</span>
<span class="line-removed"> 891             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 892                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed"> 893                     a[i] = random.nextInt();</span>
<span class="line-removed"> 894                 }</span>
<span class="line-removed"> 895             }</span>
<span class="line-removed"> 896         },</span>
<span class="line-removed"> 897         ASCENDING {</span>
<span class="line-removed"> 898             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 899                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed"> 900                     a[i] = m + i;</span>
<span class="line-removed"> 901                 }</span>
<span class="line-removed"> 902             }</span>
<span class="line-removed"> 903         },</span>
<span class="line-removed"> 904         DESCENDING {</span>
<span class="line-removed"> 905             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 906                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed"> 907                     a[i] = a.length - m - i;</span>
<span class="line-removed"> 908                 }</span>
<span class="line-removed"> 909             }</span>
<span class="line-removed"> 910         },</span>
<span class="line-removed"> 911         ALL_EQUAL {</span>
<span class="line-removed"> 912             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 913                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed"> 914                     a[i] = m;</span>
<span class="line-removed"> 915                 }</span>
<span class="line-removed"> 916             }</span>
<span class="line-removed"> 917         },</span>
<span class="line-removed"> 918         SAW {</span>
<span class="line-removed"> 919             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 920                 int incCount = 1;</span>
<span class="line-removed"> 921                 int decCount = a.length;</span>
<span class="line-removed"> 922                 int i = 0;</span>
<span class="line-removed"> 923                 int period = m--;</span>
<span class="line-removed"> 924 </span>
<span class="line-removed"> 925                 while (true) {</span>
<span class="line-removed"> 926                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-removed"> 927                         if (i &gt;= a.length) {</span>
<span class="line-removed"> 928                             return;</span>
<span class="line-removed"> 929                         }</span>
<span class="line-removed"> 930                         a[i++] = incCount++;</span>
<span class="line-removed"> 931                     }</span>
<span class="line-removed"> 932                     period += m;</span>
<span class="line-removed"> 933 </span>
<span class="line-removed"> 934                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-removed"> 935                         if (i &gt;= a.length) {</span>
<span class="line-removed"> 936                             return;</span>
<span class="line-removed"> 937                         }</span>
<span class="line-removed"> 938                         a[i++] = decCount--;</span>
<span class="line-removed"> 939                     }</span>
<span class="line-removed"> 940                     period += m;</span>
<span class="line-removed"> 941                 }</span>
<span class="line-removed"> 942             }</span>
<span class="line-removed"> 943         },</span>
<span class="line-removed"> 944         REPEATED {</span>
<span class="line-removed"> 945             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 946                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed"> 947                     a[i] = i % m;</span>
<span class="line-removed"> 948                 }</span>
<span class="line-removed"> 949             }</span>
<span class="line-removed"> 950         },</span>
<span class="line-removed"> 951         DUPLICATED {</span>
<span class="line-removed"> 952             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 953                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed"> 954                     a[i] = random.nextInt(m);</span>
<span class="line-removed"> 955                 }</span>
<span class="line-removed"> 956             }</span>
<span class="line-removed"> 957         },</span>
<span class="line-removed"> 958         ORGAN_PIPES {</span>
<span class="line-removed"> 959             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 960                 int middle = a.length / (m + 1);</span>
<span class="line-removed"> 961 </span>
<span class="line-removed"> 962                 for (int i = 0; i &lt; middle; i++) {</span>
<span class="line-removed"> 963                     a[i] = i;</span>
<span class="line-removed"> 964                 }</span>
<span class="line-removed"> 965                 for (int i = middle; i &lt; a.length; i++) {</span>
<span class="line-removed"> 966                     a[i] = a.length - i - 1;</span>
<span class="line-removed"> 967                 }</span>
<span class="line-removed"> 968             }</span>
<span class="line-removed"> 969         },</span>
<span class="line-removed"> 970         STAGGER {</span>
<span class="line-removed"> 971             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 972                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed"> 973                     a[i] = (i * m + i) % a.length;</span>
<span class="line-removed"> 974                 }</span>
<span class="line-removed"> 975             }</span>
<span class="line-removed"> 976         },</span>
<span class="line-removed"> 977         PLATEAU {</span>
<span class="line-removed"> 978             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 979                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed"> 980                     a[i] = Math.min(i, m);</span>
<span class="line-removed"> 981                 }</span>
<span class="line-removed"> 982             }</span>
<span class="line-removed"> 983         },</span>
<span class="line-removed"> 984         SHUFFLE {</span>
<span class="line-removed"> 985             void build(int[] a, int m, Random random) {</span>
<span class="line-removed"> 986                 int x = 0, y = 0;</span>
<span class="line-removed"> 987                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed"> 988                     a[i] = random.nextBoolean() ? (x += 2) : (y += 2);</span>
<span class="line-removed"> 989                 }</span>
<span class="line-removed"> 990             }</span>
<span class="line-removed"> 991         };</span>
<span class="line-removed"> 992 </span>
<span class="line-removed"> 993         abstract void build(int[] a, int m, Random random);</span>
<span class="line-removed"> 994 </span>
<span class="line-removed"> 995         @Override public String toString() {</span>
<span class="line-removed"> 996             String name = name();</span>
<span class="line-removed"> 997 </span>
<span class="line-removed"> 998             for (int i = name.length(); i &lt; 12; i++) {</span>
<span class="line-removed"> 999                 name += &quot; &quot;;</span>
<span class="line-removed">1000             }</span>
<span class="line-removed">1001             return name;</span>
<span class="line-removed">1002         }</span>
<span class="line-removed">1003     }</span>
<span class="line-removed">1004 </span>
<span class="line-removed">1005     private static void checkWithCheckSum(Object test, Object golden) {</span>
<span class="line-removed">1006         checkSorted(test);</span>
<span class="line-removed">1007         checkCheckSum(test, golden);</span>
<span class="line-removed">1008     }</span>
<span class="line-removed">1009 </span>
<span class="line-removed">1010     private static void failed(String message) {</span>
<span class="line-removed">1011         err.format(&quot;\n*** TEST FAILED - %s.\n\n%s.\n\n&quot;, ourDescription, message);</span>
<span class="line-removed">1012         throw new RuntimeException(&quot;Test failed - see log file for details&quot;);</span>
<span class="line-removed">1013     }</span>
<span class="line-removed">1014 </span>
<span class="line-removed">1015     private static void failedSort(int index, String value1, String value2) {</span>
<span class="line-removed">1016         failed(&quot;Array is not sorted at &quot; + index + &quot;-th position: &quot; +</span>
<span class="line-removed">1017             value1 + &quot; and &quot; + value2);</span>
<span class="line-removed">1018     }</span>
<span class="line-removed">1019 </span>
<span class="line-removed">1020     private static void failedCompare(int index, String value1, String value2) {</span>
<span class="line-removed">1021         failed(&quot;On position &quot; + index + &quot; must be &quot; + value2 + &quot; instead of &quot; + value1);</span>
<span class="line-removed">1022     }</span>
<span class="line-removed">1023 </span>
<span class="line-removed">1024     private static void compare(Object test, Object golden) {</span>
<span class="line-removed">1025         if (test instanceof int[]) {</span>
<span class="line-removed">1026             compare((int[]) test, (int[]) golden);</span>
<span class="line-removed">1027         } else if (test instanceof long[]) {</span>
<span class="line-removed">1028             compare((long[]) test, (long[]) golden);</span>
<span class="line-removed">1029         } else if (test instanceof short[]) {</span>
<span class="line-removed">1030             compare((short[]) test, (short[]) golden);</span>
<span class="line-removed">1031         } else if (test instanceof byte[]) {</span>
<span class="line-removed">1032             compare((byte[]) test, (byte[]) golden);</span>
<span class="line-removed">1033         } else if (test instanceof char[]) {</span>
<span class="line-removed">1034             compare((char[]) test, (char[]) golden);</span>
<span class="line-removed">1035         } else if (test instanceof float[]) {</span>
<span class="line-removed">1036             compare((float[]) test, (float[]) golden);</span>
<span class="line-removed">1037         } else if (test instanceof double[]) {</span>
<span class="line-removed">1038             compare((double[]) test, (double[]) golden);</span>
<span class="line-removed">1039         } else if (test instanceof Integer[]) {</span>
<span class="line-removed">1040             compare((Integer[]) test, (Integer[]) golden);</span>
<span class="line-removed">1041         } else {</span>
<span class="line-removed">1042             failed(&quot;Unknow type of array: &quot; + test + &quot; of class &quot; +</span>
<span class="line-removed">1043                 test.getClass().getName());</span>
<span class="line-removed">1044         }</span>
<span class="line-removed">1045     }</span>
<span class="line-removed">1046 </span>
<span class="line-removed">1047     private static void compare(int[] a, int[] b) {</span>
1048         for (int i = 0; i &lt; a.length; i++) {
1049             if (a[i] != b[i]) {
<span class="line-modified">1050                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
1051             }
1052         }
1053     }
1054 
<span class="line-modified">1055     private static void compare(long[] a, long[] b) {</span>
1056         for (int i = 0; i &lt; a.length; i++) {
1057             if (a[i] != b[i]) {
<span class="line-modified">1058                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
1059             }
1060         }
1061     }
1062 
<span class="line-modified">1063     private static void compare(short[] a, short[] b) {</span>
1064         for (int i = 0; i &lt; a.length; i++) {
1065             if (a[i] != b[i]) {
<span class="line-modified">1066                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
1067             }
1068         }
1069     }
1070 
<span class="line-modified">1071     private static void compare(byte[] a, byte[] b) {</span>
1072         for (int i = 0; i &lt; a.length; i++) {
1073             if (a[i] != b[i]) {
<span class="line-modified">1074                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
1075             }
1076         }
1077     }
1078 
<span class="line-modified">1079     private static void compare(char[] a, char[] b) {</span>
1080         for (int i = 0; i &lt; a.length; i++) {
1081             if (a[i] != b[i]) {
<span class="line-modified">1082                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
1083             }
1084         }
1085     }
1086 
<span class="line-modified">1087     private static void compare(float[] a, float[] b) {</span>
<span class="line-modified">1088         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-removed">1089             if (a[i] != b[i]) {</span>
<span class="line-removed">1090                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
<span class="line-removed">1091             }</span>
<span class="line-removed">1092         }</span>
<span class="line-removed">1093     }</span>
1094 
<span class="line-modified">1095     private static void compare(double[] a, double[] b) {</span>
<span class="line-modified">1096         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">1097             if (a[i] != b[i]) {</span>
<span class="line-modified">1098                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
<span class="line-modified">1099             }</span>






1100         }











1101     }
1102 
<span class="line-modified">1103     private static void compare(Integer[] a, Integer[] b) {</span>
<span class="line-modified">1104         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">1105             if (a[i].compareTo(b[i]) != 0) {</span>
<span class="line-modified">1106                 failedCompare(i, &quot;&quot; + a[i], &quot;&quot; + b[i]);</span>
<span class="line-modified">1107             }</span>
<span class="line-modified">1108         }</span>
<span class="line-modified">1109     }</span>
<span class="line-modified">1110 </span>
<span class="line-modified">1111     private static void checkSorted(Object object) {</span>
<span class="line-modified">1112         if (object instanceof int[]) {</span>
<span class="line-modified">1113             checkSorted((int[]) object);</span>
<span class="line-modified">1114         } else if (object instanceof long[]) {</span>
<span class="line-modified">1115             checkSorted((long[]) object);</span>
<span class="line-modified">1116         } else if (object instanceof short[]) {</span>
<span class="line-modified">1117             checkSorted((short[]) object);</span>
<span class="line-removed">1118         } else if (object instanceof byte[]) {</span>
<span class="line-removed">1119             checkSorted((byte[]) object);</span>
<span class="line-removed">1120         } else if (object instanceof char[]) {</span>
<span class="line-removed">1121             checkSorted((char[]) object);</span>
<span class="line-removed">1122         } else if (object instanceof float[]) {</span>
<span class="line-removed">1123             checkSorted((float[]) object);</span>
<span class="line-removed">1124         } else if (object instanceof double[]) {</span>
<span class="line-removed">1125             checkSorted((double[]) object);</span>
<span class="line-removed">1126         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">1127             checkSorted((Integer[]) object);</span>
1128         } else {
<span class="line-modified">1129             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">1130                 object.getClass().getName());</span>
1131         }
1132     }
1133 
<span class="line-modified">1134     private static void checkSorted(int[] a) {</span>
1135         for (int i = 0; i &lt; a.length - 1; i++) {
1136             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1137                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1138             }
1139         }
1140     }
1141 
<span class="line-modified">1142     private static void checkSorted(long[] a) {</span>
1143         for (int i = 0; i &lt; a.length - 1; i++) {
1144             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1145                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1146             }
1147         }
1148     }
1149 
<span class="line-modified">1150     private static void checkSorted(short[] a) {</span>
1151         for (int i = 0; i &lt; a.length - 1; i++) {
1152             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1153                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1154             }
1155         }
1156     }
1157 
<span class="line-modified">1158     private static void checkSorted(byte[] a) {</span>
1159         for (int i = 0; i &lt; a.length - 1; i++) {
1160             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1161                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1162             }
1163         }
1164     }
1165 
<span class="line-modified">1166     private static void checkSorted(char[] a) {</span>
1167         for (int i = 0; i &lt; a.length - 1; i++) {
1168             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1169                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1170             }
1171         }
1172     }
1173 
<span class="line-modified">1174     private static void checkSorted(float[] a) {</span>
1175         for (int i = 0; i &lt; a.length - 1; i++) {
1176             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1177                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1178             }
1179         }
1180     }
1181 
<span class="line-modified">1182     private static void checkSorted(double[] a) {</span>
1183         for (int i = 0; i &lt; a.length - 1; i++) {
1184             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1185                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1186             }
1187         }
1188     }
1189 
<span class="line-modified">1190     private static void checkSorted(Integer[] a) {</span>
<span class="line-modified">1191         for (int i = 0; i &lt; a.length - 1; i++) {</span>
<span class="line-modified">1192             if (a[i].intValue() &gt; a[i + 1].intValue()) {</span>
<span class="line-modified">1193                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
<span class="line-modified">1194             }</span>

1195         }
1196     }
1197 
<span class="line-modified">1198     private static void checkCheckSum(Object test, Object golden) {</span>
<span class="line-modified">1199         if (checkSumXor(test) != checkSumXor(golden)) {</span>
<span class="line-modified">1200             failed(&quot;Original and sorted arrays are not identical [xor]&quot;);</span>
1201         }
<span class="line-modified">1202         if (checkSumPlus(test) != checkSumPlus(golden)) {</span>
<span class="line-modified">1203             failed(&quot;Original and sorted arrays are not identical [plus]&quot;);</span>
1204         }
<span class="line-modified">1205     }</span>
<span class="line-modified">1206 </span>
<span class="line-removed">1207     private static int checkSumXor(Object object) {</span>
<span class="line-removed">1208         if (object instanceof int[]) {</span>
<span class="line-removed">1209             return checkSumXor((int[]) object);</span>
<span class="line-removed">1210         } else if (object instanceof long[]) {</span>
<span class="line-removed">1211             return checkSumXor((long[]) object);</span>
<span class="line-removed">1212         } else if (object instanceof short[]) {</span>
<span class="line-removed">1213             return checkSumXor((short[]) object);</span>
<span class="line-removed">1214         } else if (object instanceof byte[]) {</span>
<span class="line-removed">1215             return checkSumXor((byte[]) object);</span>
<span class="line-removed">1216         } else if (object instanceof char[]) {</span>
<span class="line-removed">1217             return checkSumXor((char[]) object);</span>
<span class="line-removed">1218         } else if (object instanceof float[]) {</span>
<span class="line-removed">1219             return checkSumXor((float[]) object);</span>
<span class="line-removed">1220         } else if (object instanceof double[]) {</span>
<span class="line-removed">1221             return checkSumXor((double[]) object);</span>
<span class="line-removed">1222         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">1223             return checkSumXor((Integer[]) object);</span>
<span class="line-removed">1224         } else {</span>
<span class="line-removed">1225             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">1226                 object.getClass().getName());</span>
<span class="line-removed">1227             return -1;</span>
1228         }
<span class="line-modified">1229     }</span>
<span class="line-modified">1230 </span>
<span class="line-removed">1231     private static int checkSumXor(Integer[] a) {</span>
<span class="line-removed">1232         int checkSum = 0;</span>
<span class="line-removed">1233 </span>
<span class="line-removed">1234         for (Integer e : a) {</span>
<span class="line-removed">1235             checkSum ^= e.intValue();</span>
1236         }
<span class="line-modified">1237         return checkSum;</span>










1238     }
1239 
<span class="line-modified">1240     private static int checkSumXor(int[] a) {</span>
1241         int checkSum = 0;
1242 
1243         for (int e : a) {
1244             checkSum ^= e;
1245         }
1246         return checkSum;
1247     }
1248 
<span class="line-modified">1249     private static int checkSumXor(long[] a) {</span>
1250         long checkSum = 0;
1251 
1252         for (long e : a) {
1253             checkSum ^= e;
1254         }
1255         return (int) checkSum;
1256     }
1257 
<span class="line-modified">1258     private static int checkSumXor(short[] a) {</span>
<span class="line-modified">1259         short checkSum = 0;</span>
1260 
<span class="line-modified">1261         for (short e : a) {</span>
1262             checkSum ^= e;
1263         }
1264         return (int) checkSum;
1265     }
1266 
<span class="line-modified">1267     private static int checkSumXor(byte[] a) {</span>
<span class="line-modified">1268         byte checkSum = 0;</span>
1269 
<span class="line-modified">1270         for (byte e : a) {</span>
1271             checkSum ^= e;
1272         }
1273         return (int) checkSum;
1274     }
1275 
<span class="line-modified">1276     private static int checkSumXor(char[] a) {</span>
<span class="line-modified">1277         char checkSum = 0;</span>
1278 
<span class="line-modified">1279         for (char e : a) {</span>
1280             checkSum ^= e;
1281         }
1282         return (int) checkSum;
1283     }
1284 
<span class="line-modified">1285     private static int checkSumXor(float[] a) {</span>
1286         int checkSum = 0;
1287 
1288         for (float e : a) {
1289             checkSum ^= (int) e;
1290         }
1291         return checkSum;
1292     }
1293 
<span class="line-modified">1294     private static int checkSumXor(double[] a) {</span>
1295         int checkSum = 0;
1296 
1297         for (double e : a) {
1298             checkSum ^= (int) e;
1299         }
1300         return checkSum;
1301     }
1302 
<span class="line-modified">1303     private static int checkSumPlus(Object object) {</span>
<span class="line-modified">1304         if (object instanceof int[]) {</span>
<span class="line-modified">1305             return checkSumPlus((int[]) object);</span>
<span class="line-modified">1306         } else if (object instanceof long[]) {</span>
<span class="line-modified">1307             return checkSumPlus((long[]) object);</span>
<span class="line-modified">1308         } else if (object instanceof short[]) {</span>
<span class="line-removed">1309             return checkSumPlus((short[]) object);</span>
<span class="line-removed">1310         } else if (object instanceof byte[]) {</span>
<span class="line-removed">1311             return checkSumPlus((byte[]) object);</span>
<span class="line-removed">1312         } else if (object instanceof char[]) {</span>
<span class="line-removed">1313             return checkSumPlus((char[]) object);</span>
<span class="line-removed">1314         } else if (object instanceof float[]) {</span>
<span class="line-removed">1315             return checkSumPlus((float[]) object);</span>
<span class="line-removed">1316         } else if (object instanceof double[]) {</span>
<span class="line-removed">1317             return checkSumPlus((double[]) object);</span>
<span class="line-removed">1318         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">1319             return checkSumPlus((Integer[]) object);</span>
<span class="line-removed">1320         } else {</span>
<span class="line-removed">1321             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">1322                 object.getClass().getName());</span>
<span class="line-removed">1323             return -1;</span>
1324         }

















1325     }
1326 
<span class="line-modified">1327     private static int checkSumPlus(int[] a) {</span>
1328         int checkSum = 0;
1329 
1330         for (int e : a) {
1331             checkSum += e;
1332         }
1333         return checkSum;
1334     }
1335 
<span class="line-modified">1336     private static int checkSumPlus(long[] a) {</span>
1337         long checkSum = 0;
1338 
1339         for (long e : a) {
1340             checkSum += e;
1341         }
1342         return (int) checkSum;
1343     }
1344 
<span class="line-modified">1345     private static int checkSumPlus(short[] a) {</span>
<span class="line-modified">1346         short checkSum = 0;</span>
1347 
<span class="line-modified">1348         for (short e : a) {</span>
1349             checkSum += e;
1350         }
1351         return (int) checkSum;
1352     }
1353 
<span class="line-modified">1354     private static int checkSumPlus(byte[] a) {</span>
<span class="line-modified">1355         byte checkSum = 0;</span>
1356 
<span class="line-modified">1357         for (byte e : a) {</span>
1358             checkSum += e;
1359         }
1360         return (int) checkSum;
1361     }
1362 
<span class="line-modified">1363     private static int checkSumPlus(char[] a) {</span>
<span class="line-modified">1364         char checkSum = 0;</span>
1365 
<span class="line-modified">1366         for (char e : a) {</span>
1367             checkSum += e;
1368         }
1369         return (int) checkSum;
1370     }
1371 
<span class="line-modified">1372     private static int checkSumPlus(float[] a) {</span>
1373         int checkSum = 0;
1374 
1375         for (float e : a) {
1376             checkSum += (int) e;
1377         }
1378         return checkSum;
1379     }
1380 
<span class="line-modified">1381     private static int checkSumPlus(double[] a) {</span>
1382         int checkSum = 0;
1383 
1384         for (double e : a) {
1385             checkSum += (int) e;
1386         }
1387         return checkSum;
1388     }
1389 
<span class="line-modified">1390     private static int checkSumPlus(Integer[] a) {</span>
<span class="line-modified">1391         int checkSum = 0;</span>
<span class="line-modified">1392 </span>
<span class="line-modified">1393         for (Integer e : a) {</span>
<span class="line-modified">1394             checkSum += e.intValue();</span>
<span class="line-modified">1395         }</span>
<span class="line-modified">1396         return checkSum;</span>
<span class="line-modified">1397     }</span>
<span class="line-modified">1398 </span>
<span class="line-modified">1399     private static void sortByInsertionSort(Object object) {</span>
<span class="line-modified">1400         if (object instanceof int[]) {</span>
<span class="line-modified">1401             sortByInsertionSort((int[]) object);</span>
<span class="line-modified">1402         } else if (object instanceof long[]) {</span>
<span class="line-modified">1403             sortByInsertionSort((long[]) object);</span>
<span class="line-modified">1404         } else if (object instanceof short[]) {</span>
<span class="line-removed">1405             sortByInsertionSort((short[]) object);</span>
<span class="line-removed">1406         } else if (object instanceof byte[]) {</span>
<span class="line-removed">1407             sortByInsertionSort((byte[]) object);</span>
<span class="line-removed">1408         } else if (object instanceof char[]) {</span>
<span class="line-removed">1409             sortByInsertionSort((char[]) object);</span>
<span class="line-removed">1410         } else if (object instanceof float[]) {</span>
<span class="line-removed">1411             sortByInsertionSort((float[]) object);</span>
<span class="line-removed">1412         } else if (object instanceof double[]) {</span>
<span class="line-removed">1413             sortByInsertionSort((double[]) object);</span>
<span class="line-removed">1414         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">1415             sortByInsertionSort((Integer[]) object);</span>
1416         } else {
<span class="line-modified">1417             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">1418                 object.getClass().getName());</span>
1419         }
1420     }
1421 
<span class="line-modified">1422     private static void sortByInsertionSort(int[] a) {</span>
1423         for (int j, i = 1; i &lt; a.length; i++) {
1424             int ai = a[i];

1425             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1426                 a[j + 1] = a[j];
1427             }
1428             a[j + 1] = ai;
1429         }
1430     }
1431 
<span class="line-modified">1432     private static void sortByInsertionSort(long[] a) {</span>
1433         for (int j, i = 1; i &lt; a.length; i++) {
1434             long ai = a[i];

1435             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1436                 a[j + 1] = a[j];
1437             }
1438             a[j + 1] = ai;
1439         }
1440     }
1441 
<span class="line-modified">1442     private static void sortByInsertionSort(short[] a) {</span>
1443         for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">1444             short ai = a[i];</span>

1445             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1446                 a[j + 1] = a[j];
1447             }
1448             a[j + 1] = ai;
1449         }
1450     }
1451 
<span class="line-modified">1452     private static void sortByInsertionSort(byte[] a) {</span>
1453         for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">1454             byte ai = a[i];</span>

1455             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1456                 a[j + 1] = a[j];
1457             }
1458             a[j + 1] = ai;
1459         }
1460     }
1461 
<span class="line-modified">1462     private static void sortByInsertionSort(char[] a) {</span>
1463         for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">1464             char ai = a[i];</span>

1465             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1466                 a[j + 1] = a[j];
1467             }
1468             a[j + 1] = ai;
1469         }
1470     }
1471 
<span class="line-modified">1472     private static void sortByInsertionSort(float[] a) {</span>
1473         for (int j, i = 1; i &lt; a.length; i++) {
1474             float ai = a[i];

1475             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1476                 a[j + 1] = a[j];
1477             }
1478             a[j + 1] = ai;
1479         }
1480     }
1481 
<span class="line-modified">1482     private static void sortByInsertionSort(double[] a) {</span>
1483         for (int j, i = 1; i &lt; a.length; i++) {
1484             double ai = a[i];
<span class="line-removed">1485             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {</span>
<span class="line-removed">1486                 a[j + 1] = a[j];</span>
<span class="line-removed">1487             }</span>
<span class="line-removed">1488             a[j + 1] = ai;</span>
<span class="line-removed">1489         }</span>
<span class="line-removed">1490     }</span>
1491 
<span class="line-removed">1492     private static void sortByInsertionSort(Integer[] a) {</span>
<span class="line-removed">1493         for (int j, i = 1; i &lt; a.length; i++) {</span>
<span class="line-removed">1494             Integer ai = a[i];</span>
1495             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1496                 a[j + 1] = a[j];
1497             }
1498             a[j + 1] = ai;
1499         }
1500     }
1501 
<span class="line-modified">1502     private static void sort(Object object) {</span>
<span class="line-modified">1503         if (object instanceof int[]) {</span>
<span class="line-modified">1504             Arrays.sort((int[]) object);</span>
<span class="line-modified">1505         } else if (object instanceof long[]) {</span>
<span class="line-modified">1506             Arrays.sort((long[]) object);</span>
<span class="line-modified">1507         } else if (object instanceof short[]) {</span>
<span class="line-modified">1508             Arrays.sort((short[]) object);</span>
<span class="line-modified">1509         } else if (object instanceof byte[]) {</span>
<span class="line-modified">1510             Arrays.sort((byte[]) object);</span>
<span class="line-modified">1511         } else if (object instanceof char[]) {</span>
<span class="line-modified">1512             Arrays.sort((char[]) object);</span>
<span class="line-modified">1513         } else if (object instanceof float[]) {</span>
<span class="line-modified">1514             Arrays.sort((float[]) object);</span>
<span class="line-modified">1515         } else if (object instanceof double[]) {</span>
<span class="line-modified">1516             Arrays.sort((double[]) object);</span>
<span class="line-removed">1517         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">1518             Arrays.sort((Integer[]) object);</span>
1519         } else {
<span class="line-modified">1520             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">1521                 object.getClass().getName());</span>
<span class="line-removed">1522         }</span>
<span class="line-removed">1523     }</span>
<span class="line-removed">1524 </span>
<span class="line-removed">1525     private static void sortSubArray(Object object, int fromIndex, int toIndex) {</span>
<span class="line-removed">1526         if (object instanceof int[]) {</span>
<span class="line-removed">1527             Arrays.sort((int[]) object, fromIndex, toIndex);</span>
<span class="line-removed">1528         } else if (object instanceof long[]) {</span>
<span class="line-removed">1529             Arrays.sort((long[]) object, fromIndex, toIndex);</span>
<span class="line-removed">1530         } else if (object instanceof short[]) {</span>
<span class="line-removed">1531             Arrays.sort((short[]) object, fromIndex, toIndex);</span>
<span class="line-removed">1532         } else if (object instanceof byte[]) {</span>
<span class="line-removed">1533             Arrays.sort((byte[]) object, fromIndex, toIndex);</span>
<span class="line-removed">1534         } else if (object instanceof char[]) {</span>
<span class="line-removed">1535             Arrays.sort((char[]) object, fromIndex, toIndex);</span>
<span class="line-removed">1536         } else if (object instanceof float[]) {</span>
<span class="line-removed">1537             Arrays.sort((float[]) object, fromIndex, toIndex);</span>
<span class="line-removed">1538         } else if (object instanceof double[]) {</span>
<span class="line-removed">1539             Arrays.sort((double[]) object, fromIndex, toIndex);</span>
<span class="line-removed">1540         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">1541             Arrays.sort((Integer[]) object, fromIndex, toIndex);</span>
<span class="line-removed">1542         } else {</span>
<span class="line-removed">1543             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">1544                 object.getClass().getName());</span>
<span class="line-removed">1545         }</span>
<span class="line-removed">1546     }</span>
<span class="line-removed">1547 </span>
<span class="line-removed">1548     private static void checkSubArray(Object object, int fromIndex, int toIndex, int m) {</span>
<span class="line-removed">1549         if (object instanceof int[]) {</span>
<span class="line-removed">1550             checkSubArray((int[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">1551         } else if (object instanceof long[]) {</span>
<span class="line-removed">1552             checkSubArray((long[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">1553         } else if (object instanceof short[]) {</span>
<span class="line-removed">1554             checkSubArray((short[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">1555         } else if (object instanceof byte[]) {</span>
<span class="line-removed">1556             checkSubArray((byte[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">1557         } else if (object instanceof char[]) {</span>
<span class="line-removed">1558             checkSubArray((char[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">1559         } else if (object instanceof float[]) {</span>
<span class="line-removed">1560             checkSubArray((float[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">1561         } else if (object instanceof double[]) {</span>
<span class="line-removed">1562             checkSubArray((double[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">1563         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">1564             checkSubArray((Integer[]) object, fromIndex, toIndex, m);</span>
<span class="line-removed">1565         } else {</span>
<span class="line-removed">1566             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">1567                 object.getClass().getName());</span>
1568         }
1569     }
1570 
<span class="line-modified">1571     private static void checkSubArray(Integer[] a, int fromIndex, int toIndex, int m) {</span>
1572         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1573             if (a[i].intValue() != 0xDEDA) {</span>
<span class="line-modified">1574                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">1575                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
1576             }
1577         }
1578 
1579         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
<span class="line-modified">1580             if (a[i].intValue() &gt; a[i + 1].intValue()) {</span>
<span class="line-modified">1581                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1582             }
1583         }
1584 
1585         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1586             if (a[i].intValue() != 0xBABA) {</span>
<span class="line-modified">1587                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">1588                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
1589             }
1590         }
1591     }
1592 
<span class="line-modified">1593     private static void checkSubArray(int[] a, int fromIndex, int toIndex, int m) {</span>
1594         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1595             if (a[i] != 0xDEDA) {</span>
<span class="line-modified">1596                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">1597                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
1598             }
1599         }
1600 
1601         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1602             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1603                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1604             }
1605         }
1606 
1607         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1608             if (a[i] != 0xBABA) {</span>
<span class="line-modified">1609                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">1610                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
1611             }
1612         }
1613     }
1614 
<span class="line-modified">1615     private static void checkSubArray(byte[] a, int fromIndex, int toIndex, int m) {</span>
1616         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1617             if (a[i] != (byte) 0xDEDA) {</span>
<span class="line-modified">1618                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">1619                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
1620             }
1621         }
1622 
1623         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1624             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1625                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1626             }
1627         }
1628 
1629         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1630             if (a[i] != (byte) 0xBABA) {</span>
<span class="line-modified">1631                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">1632                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
1633             }
1634         }
1635     }
1636 
<span class="line-modified">1637     private static void checkSubArray(long[] a, int fromIndex, int toIndex, int m) {</span>
1638         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1639             if (a[i] != (long) 0xDEDA) {</span>
<span class="line-modified">1640                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">1641                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
1642             }
1643         }
1644 
1645         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1646             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1647                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1648             }
1649         }
1650 
1651         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1652             if (a[i] != (long) 0xBABA) {</span>
<span class="line-modified">1653                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">1654                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
1655             }
1656         }
1657     }
1658 
<span class="line-modified">1659     private static void checkSubArray(char[] a, int fromIndex, int toIndex, int m) {</span>
1660         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1661             if (a[i] != (char) 0xDEDA) {</span>
<span class="line-modified">1662                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">1663                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
1664             }
1665         }
1666 
1667         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1668             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1669                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1670             }
1671         }
1672 
1673         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1674             if (a[i] != (char) 0xBABA) {</span>
<span class="line-modified">1675                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">1676                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
1677             }
1678         }
1679     }
1680 
<span class="line-modified">1681     private static void checkSubArray(short[] a, int fromIndex, int toIndex, int m) {</span>
1682         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1683             if (a[i] != (short) 0xDEDA) {</span>
<span class="line-modified">1684                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">1685                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
1686             }
1687         }
1688 
1689         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1690             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1691                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1692             }
1693         }
1694 
1695         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1696             if (a[i] != (short) 0xBABA) {</span>
<span class="line-modified">1697                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-removed">1698                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
1699             }
1700         }
1701     }
1702 
<span class="line-modified">1703     private static void checkSubArray(float[] a, int fromIndex, int toIndex, int m) {</span>
1704         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1705             if (a[i] != (float) 0xDEDA) {</span>
<span class="line-modified">1706                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-removed">1707                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>
1708             }
1709         }
1710 
1711         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1712             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1713                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>
1714             }
1715         }
1716 
1717         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1718             if (a[i] != (float) 0xBABA) {</span>
<span class="line-modified">1719                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-modified">1720                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
<span class="line-modified">1721             }</span>



















1722         }
1723     }
1724 
<span class="line-modified">1725     private static void checkSubArray(double[] a, int fromIndex, int toIndex, int m) {</span>
<span class="line-modified">1726         for (int i = 0; i &lt; fromIndex; i++) {</span>
<span class="line-modified">1727             if (a[i] != (double) 0xDEDA) {</span>
<span class="line-modified">1728                 failed(&quot;Range sort changes left element on position &quot; + i +</span>
<span class="line-modified">1729                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xDEDA);</span>











1730             }
1731         }

1732 
<span class="line-modified">1733         for (int i = fromIndex; i &lt; toIndex - 1; i++) {</span>
<span class="line-modified">1734             if (a[i] &gt; a[i + 1]) {</span>
<span class="line-modified">1735                 failedSort(i, &quot;&quot; + a[i], &quot;&quot; + a[i + 1]);</span>













1736             }
1737         }

1738 
<span class="line-modified">1739         for (int i = toIndex; i &lt; a.length; i++) {</span>
<span class="line-modified">1740             if (a[i] != (double) 0xBABA) {</span>
<span class="line-modified">1741                 failed(&quot;Range sort changes right element on position &quot; + i +</span>
<span class="line-modified">1742                     &quot;: &quot; + a[i] + &quot;, must be &quot; + 0xBABA);</span>
<span class="line-modified">1743             }</span>
<span class="line-modified">1744         }</span>
<span class="line-modified">1745     }</span>
<span class="line-modified">1746 </span>
<span class="line-modified">1747     private static void checkRange(Object object, int m) {</span>
<span class="line-modified">1748         if (object instanceof int[]) {</span>
<span class="line-modified">1749             checkRange((int[]) object, m);</span>
<span class="line-modified">1750         } else if (object instanceof long[]) {</span>
<span class="line-modified">1751             checkRange((long[]) object, m);</span>
<span class="line-modified">1752         } else if (object instanceof short[]) {</span>
<span class="line-modified">1753             checkRange((short[]) object, m);</span>
<span class="line-modified">1754         } else if (object instanceof byte[]) {</span>
<span class="line-modified">1755             checkRange((byte[]) object, m);</span>
<span class="line-removed">1756         } else if (object instanceof char[]) {</span>
<span class="line-removed">1757             checkRange((char[]) object, m);</span>
<span class="line-removed">1758         } else if (object instanceof float[]) {</span>
<span class="line-removed">1759             checkRange((float[]) object, m);</span>
<span class="line-removed">1760         } else if (object instanceof double[]) {</span>
<span class="line-removed">1761             checkRange((double[]) object, m);</span>
<span class="line-removed">1762         } else if (object instanceof Integer[]) {</span>
<span class="line-removed">1763             checkRange((Integer[]) object, m);</span>
<span class="line-removed">1764         } else {</span>
<span class="line-removed">1765             failed(&quot;Unknow type of array: &quot; + object + &quot; of class &quot; +</span>
<span class="line-removed">1766                 object.getClass().getName());</span>
1767         }
1768     }
1769 
<span class="line-modified">1770     private static void checkRange(Integer[] a, int m) {</span>
1771         try {
<span class="line-modified">1772             Arrays.sort(a, m + 1, m);</span>
<span class="line-modified">1773 </span>
<span class="line-modified">1774             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1775                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-removed">1776                 &quot; toIndex = &quot; + m);</span>
<span class="line-removed">1777         }</span>
<span class="line-removed">1778         catch (IllegalArgumentException iae) {</span>
1779             try {
<span class="line-modified">1780                 Arrays.sort(a, -m, a.length);</span>
<span class="line-modified">1781 </span>
<span class="line-modified">1782                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1783                     &quot; as expected: fromIndex = &quot; + (-m));</span>





1784             }
<span class="line-modified">1785             catch (ArrayIndexOutOfBoundsException aoe) {</span>













1786                 try {
<span class="line-modified">1787                     Arrays.sort(a, 0, a.length + m);</span>






1788 
<span class="line-modified">1789                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1790                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-modified">1791                 }</span>
<span class="line-modified">1792                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">1793                     return;</span>
<span class="line-modified">1794                 }</span>










1795             }
1796         }
1797     }
1798 
<span class="line-modified">1799     private static void checkRange(int[] a, int m) {</span>
1800         try {
<span class="line-modified">1801             Arrays.sort(a, m + 1, m);</span>
















1802 
<span class="line-modified">1803             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1804                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">1805                 &quot; toIndex = &quot; + m);</span>




1806         }
<span class="line-modified">1807         catch (IllegalArgumentException iae) {</span>
<span class="line-removed">1808             try {</span>
<span class="line-removed">1809                 Arrays.sort(a, -m, a.length);</span>
1810 
<span class="line-modified">1811                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1812                     &quot; as expected: fromIndex = &quot; + (-m));</span>
<span class="line-modified">1813             }</span>
<span class="line-modified">1814             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-modified">1815                 try {</span>
<span class="line-modified">1816                     Arrays.sort(a, 0, a.length + m);</span>


































1817 
<span class="line-modified">1818                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1819                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>










1820                 }
<span class="line-modified">1821                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">1822                     return;</span>







1823                 }
1824             }
<span class="line-modified">1825         }</span>
<span class="line-removed">1826     }</span>
1827 
<span class="line-modified">1828     private static void checkRange(long[] a, int m) {</span>
<span class="line-modified">1829         try {</span>
<span class="line-modified">1830             Arrays.sort(a, m + 1, m);</span>
1831 
<span class="line-modified">1832             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1833                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">1834                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1835         }</span>
<span class="line-modified">1836         catch (IllegalArgumentException iae) {</span>
<span class="line-modified">1837             try {</span>
<span class="line-modified">1838                 Arrays.sort(a, -m, a.length);</span>


1839 
<span class="line-modified">1840                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1841                     &quot; as expected: fromIndex = &quot; + (-m));</span>

1842             }
<span class="line-modified">1843             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">1844                 try {</span>
<span class="line-removed">1845                     Arrays.sort(a, 0, a.length + m);</span>
1846 
<span class="line-modified">1847                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1848                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>




1849                 }
<span class="line-modified">1850                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">1851                     return;</span>







1852                 }
1853             }
<span class="line-modified">1854         }</span>


1855     }
1856 
<span class="line-modified">1857     private static void checkRange(byte[] a, int m) {</span>
<span class="line-modified">1858         try {</span>
<span class="line-modified">1859             Arrays.sort(a, m + 1, m);</span>



1860 
<span class="line-modified">1861             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1862                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">1863                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1864         }</span>
<span class="line-modified">1865         catch (IllegalArgumentException iae) {</span>
<span class="line-removed">1866             try {</span>
<span class="line-removed">1867                 Arrays.sort(a, -m, a.length);</span>
1868 
<span class="line-modified">1869                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1870                     &quot; as expected: fromIndex = &quot; + (-m));</span>







1871             }
<span class="line-modified">1872             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">1873                 try {</span>
<span class="line-removed">1874                     Arrays.sort(a, 0, a.length + m);</span>
1875 
<span class="line-modified">1876                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1877                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>


1878                 }
<span class="line-modified">1879                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">1880                     return;</span>





1881                 }
1882             }
<span class="line-modified">1883         }</span>
<span class="line-removed">1884     }</span>
1885 
<span class="line-modified">1886     private static void checkRange(short[] a, int m) {</span>
<span class="line-modified">1887         try {</span>
<span class="line-modified">1888             Arrays.sort(a, m + 1, m);</span>




1889 
<span class="line-modified">1890             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1891                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">1892                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1893         }</span>
<span class="line-modified">1894         catch (IllegalArgumentException iae) {</span>
<span class="line-modified">1895             try {</span>
<span class="line-removed">1896                 Arrays.sort(a, -m, a.length);</span>
1897 
<span class="line-modified">1898                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1899                     &quot; as expected: fromIndex = &quot; + (-m));</span>















1900             }
<span class="line-modified">1901             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">1902                 try {</span>
<span class="line-removed">1903                     Arrays.sort(a, 0, a.length + m);</span>
1904 
<span class="line-modified">1905                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1906                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>


1907                 }
<span class="line-modified">1908                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">1909                     return;</span>





1910                 }
1911             }
<span class="line-modified">1912         }</span>
<span class="line-removed">1913     }</span>
1914 
<span class="line-modified">1915     private static void checkRange(char[] a, int m) {</span>
<span class="line-modified">1916         try {</span>
<span class="line-modified">1917             Arrays.sort(a, m + 1, m);</span>
1918 
<span class="line-modified">1919             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1920                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">1921                 &quot; toIndex = &quot; + m);</span>
<span class="line-removed">1922         }</span>
<span class="line-removed">1923         catch (IllegalArgumentException iae) {</span>
<span class="line-removed">1924             try {</span>
<span class="line-removed">1925                 Arrays.sort(a, -m, a.length);</span>
1926 
<span class="line-modified">1927                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1928                     &quot; as expected: fromIndex = &quot; + (-m));</span>

1929             }
<span class="line-modified">1930             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">1931                 try {</span>
<span class="line-removed">1932                     Arrays.sort(a, 0, a.length + m);</span>
1933 
<span class="line-modified">1934                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1935                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>


1936                 }
<span class="line-modified">1937                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">1938                     return;</span>





1939                 }
1940             }
<span class="line-modified">1941         }</span>























1942     }
1943 
<span class="line-modified">1944     private static void checkRange(float[] a, int m) {</span>
<span class="line-modified">1945         try {</span>
<span class="line-modified">1946             Arrays.sort(a, m + 1, m);</span>


1947 
<span class="line-modified">1948             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1949                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">1950                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1951         }</span>
<span class="line-modified">1952         catch (IllegalArgumentException iae) {</span>
<span class="line-modified">1953             try {</span>
<span class="line-modified">1954                 Arrays.sort(a, -m, a.length);</span>
1955 
<span class="line-modified">1956                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1957                     &quot; as expected: fromIndex = &quot; + (-m));</span>



1958             }
<span class="line-modified">1959             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-removed">1960                 try {</span>
<span class="line-removed">1961                     Arrays.sort(a, 0, a.length + m);</span>
1962 
<span class="line-modified">1963                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1964                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>









1965                 }
<span class="line-modified">1966                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">1967                     return;</span>

1968                 }


1969             }
<span class="line-modified">1970         }</span>
<span class="line-removed">1971     }</span>
1972 
<span class="line-modified">1973     private static void checkRange(double[] a, int m) {</span>
<span class="line-modified">1974         try {</span>
<span class="line-modified">1975             Arrays.sort(a, m + 1, m);</span>





1976 
<span class="line-modified">1977             failed(&quot;Sort does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1978                 &quot; as expected: fromIndex = &quot; + (m + 1) +</span>
<span class="line-modified">1979                 &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1980         }</span>
<span class="line-modified">1981         catch (IllegalArgumentException iae) {</span>
<span class="line-modified">1982             try {</span>
<span class="line-modified">1983                 Arrays.sort(a, -m, a.length);</span>

1984 
<span class="line-modified">1985                 failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1986                     &quot; as expected: fromIndex = &quot; + (-m));</span>




1987             }
<span class="line-modified">1988             catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-modified">1989                 try {</span>
<span class="line-modified">1990                     Arrays.sort(a, 0, a.length + m);</span>




1991 
<span class="line-modified">1992                     failed(&quot;Sort does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1993                         &quot; as expected: toIndex = &quot; + (a.length + m));</span>
1994                 }
<span class="line-modified">1995                 catch (ArrayIndexOutOfBoundsException aie) {</span>
<span class="line-modified">1996                     return;</span>





1997                 }
1998             }










1999         }
2000     }
2001 
<span class="line-modified">2002     private static void outArray(Object[] a) {</span>
<span class="line-modified">2003         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">2004             out.print(a[i] + &quot; &quot;);</span>
<span class="line-modified">2005         }</span>
<span class="line-modified">2006         out.println();</span>

















2007     }
2008 
<span class="line-modified">2009     private static void outArray(int[] a) {</span>
<span class="line-modified">2010         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">2011             out.print(a[i] + &quot; &quot;);</span>


















































2012         }
<span class="line-removed">2013         out.println();</span>
<span class="line-removed">2014     }</span>
2015 
<span class="line-modified">2016     private static void outArray(float[] a) {</span>
<span class="line-modified">2017         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">2018             out.print(a[i] + &quot; &quot;);</span>

2019         }
<span class="line-removed">2020         out.println();</span>
2021     }
2022 
<span class="line-modified">2023     private static void outArray(double[] a) {</span>
<span class="line-modified">2024         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">2025             out.print(a[i] + &quot; &quot;);</span>


2026         }
<span class="line-modified">2027         out.println();</span>




























2028     }
2029 
<span class="line-modified">2030     private static class MyRandom extends Random {</span>
<span class="line-modified">2031         MyRandom(long seed) {</span>





2032             super(seed);
<span class="line-modified">2033             mySeed = seed;</span>
2034         }
2035 
<span class="line-modified">2036         long getSeed() {</span>
<span class="line-modified">2037             return mySeed;</span>

2038         }
2039 
<span class="line-modified">2040         private long mySeed;</span>
2041     }
<span class="line-removed">2042 </span>
<span class="line-removed">2043     private static String ourDescription;</span>
2044 }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2009, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 /*
  25  * @test
<span class="line-modified">  26  * @compile/module=java.base java/util/SortingHelper.java</span>
<span class="line-modified">  27  * @bug 6880672 6896573 6899694 6976036 7013585 7018258 8003981 8226297</span>
  28  * @build Sorting
  29  * @run main Sorting -shortrun
<span class="line-added">  30  * @summary Exercise Arrays.sort, Arrays.parallelSort</span>
  31  *
  32  * @author Vladimir Yaroslavskiy
  33  * @author Jon Bentley
  34  * @author Josh Bloch
  35  */
  36 


  37 import java.io.PrintStream;
<span class="line-added">  38 import java.util.Comparator;</span>
<span class="line-added">  39 import java.util.Random;</span>
<span class="line-added">  40 import java.util.SortingHelper;</span>
  41 
  42 public class Sorting {
<span class="line-added">  43 </span>
  44     private static final PrintStream out = System.out;
  45     private static final PrintStream err = System.err;
  46 
  47     // Array lengths used in a long run (default)
  48     private static final int[] LONG_RUN_LENGTHS = {
<span class="line-modified">  49         1, 3, 8, 21, 55, 100, 1_000, 10_000, 100_000 };</span>
  50 
  51     // Array lengths used in a short run
  52     private static final int[] SHORT_RUN_LENGTHS = {
<span class="line-modified">  53         1, 8, 55, 100, 10_000 };</span>
  54 
  55     // Random initial values used in a long run (default)
<span class="line-modified">  56     private static final TestRandom[] LONG_RUN_RANDOMS = {</span>
<span class="line-added">  57         TestRandom.BABA, TestRandom.DEDA, TestRandom.C0FFEE };</span>
  58 
  59     // Random initial values used in a short run
<span class="line-modified">  60     private static final TestRandom[] SHORT_RUN_RANDOMS = {</span>
<span class="line-added">  61         TestRandom.C0FFEE };</span>
<span class="line-added">  62 </span>
<span class="line-added">  63     // Constants used in subarray sorting</span>
<span class="line-added">  64     private static final int A380 = 0xA380;</span>
<span class="line-added">  65     private static final int B747 = 0xB747;</span>
<span class="line-added">  66 </span>
<span class="line-added">  67     private final SortingHelper sortingHelper;</span>
<span class="line-added">  68     private final TestRandom[] randoms;</span>
<span class="line-added">  69     private final int[] lengths;</span>
<span class="line-added">  70     private Object[] gold;</span>
<span class="line-added">  71     private Object[] test;</span>
  72 
  73     public static void main(String[] args) {

  74         long start = System.currentTimeMillis();
<span class="line-added">  75         boolean shortRun = args.length &gt; 0 &amp;&amp; args[0].equals(&quot;-shortrun&quot;);</span>
<span class="line-added">  76 </span>
<span class="line-added">  77         int[] lengths = shortRun ? SHORT_RUN_LENGTHS : LONG_RUN_LENGTHS;</span>
<span class="line-added">  78         TestRandom[] randoms = shortRun ? SHORT_RUN_RANDOMS : LONG_RUN_RANDOMS;</span>
<span class="line-added">  79 </span>
<span class="line-added">  80         new Sorting(SortingHelper.DUAL_PIVOT_QUICKSORT, randoms, lengths).testCore();</span>
<span class="line-added">  81         new Sorting(SortingHelper.PARALLEL_SORT, randoms, lengths).testCore();</span>
<span class="line-added">  82         new Sorting(SortingHelper.HEAP_SORT, randoms, lengths).testBasic();</span>
<span class="line-added">  83         new Sorting(SortingHelper.ARRAYS_SORT, randoms, lengths).testAll();</span>
<span class="line-added">  84         new Sorting(SortingHelper.ARRAYS_PARALLEL_SORT, randoms, lengths).testAll();</span>
  85 





  86         long end = System.currentTimeMillis();
<span class="line-added">  87         out.format(&quot;PASSED in %d sec.\n&quot;, (end - start) / 1000);</span>
<span class="line-added">  88     }</span>
<span class="line-added">  89 </span>
<span class="line-added">  90     private Sorting(SortingHelper sortingHelper, TestRandom[] randoms, int[] lengths) {</span>
<span class="line-added">  91         this.sortingHelper = sortingHelper;</span>
<span class="line-added">  92         this.randoms = randoms;</span>
<span class="line-added">  93         this.lengths = lengths;</span>
<span class="line-added">  94     }</span>
<span class="line-added">  95 </span>
<span class="line-added">  96     private void testBasic() {</span>
<span class="line-added">  97         testEmptyArray();</span>
<span class="line-added">  98 </span>
<span class="line-added">  99         for (int length : lengths) {</span>
<span class="line-added"> 100             createData(length);</span>
<span class="line-added"> 101             testBasic(length);</span>
<span class="line-added"> 102         }</span>
<span class="line-added"> 103     }</span>
<span class="line-added"> 104 </span>
<span class="line-added"> 105     private void testBasic(int length) {</span>
<span class="line-added"> 106         for (TestRandom random : randoms) {</span>
<span class="line-added"> 107             testWithInsertionSort(length, random);</span>
<span class="line-added"> 108             testWithCheckSum(length, random);</span>
<span class="line-added"> 109             testWithScrambling(length, random);</span>
<span class="line-added"> 110         }</span>
<span class="line-added"> 111     }</span>
<span class="line-added"> 112 </span>
<span class="line-added"> 113     private void testCore() {</span>
<span class="line-added"> 114         for (int length : lengths) {</span>
<span class="line-added"> 115             createData(length);</span>
<span class="line-added"> 116             testCore(length);</span>
<span class="line-added"> 117         }</span>
<span class="line-added"> 118     }</span>
<span class="line-added"> 119 </span>
<span class="line-added"> 120     private void testCore(int length) {</span>
<span class="line-added"> 121         testBasic(length);</span>
<span class="line-added"> 122 </span>
<span class="line-added"> 123         for (TestRandom random : randoms) {</span>
<span class="line-added"> 124             testMergingSort(length, random);</span>
<span class="line-added"> 125             testSubArray(length, random);</span>
<span class="line-added"> 126             testNegativeZero(length, random);</span>
<span class="line-added"> 127             testFloatingPointSorting(length, random);</span>
<span class="line-added"> 128         }</span>
<span class="line-added"> 129     }</span>
<span class="line-added"> 130 </span>
<span class="line-added"> 131     private void testAll() {</span>
<span class="line-added"> 132         for (int length : lengths) {</span>
<span class="line-added"> 133             createData(length);</span>
<span class="line-added"> 134             testAll(length);</span>
<span class="line-added"> 135         }</span>
<span class="line-added"> 136     }</span>
 137 
<span class="line-modified"> 138     private void testAll(int length) {</span>
<span class="line-added"> 139         testCore(length);</span>
<span class="line-added"> 140 </span>
<span class="line-added"> 141         for (TestRandom random : randoms) {</span>
<span class="line-added"> 142             testRange(length, random);</span>
<span class="line-added"> 143             testStability(length, random);</span>
<span class="line-added"> 144         }</span>
 145     }
 146 
<span class="line-modified"> 147     private void testEmptyArray() {</span>
 148         testEmptyAndNullIntArray();
 149         testEmptyAndNullLongArray();


 150         testEmptyAndNullByteArray();
<span class="line-added"> 151         testEmptyAndNullCharArray();</span>
<span class="line-added"> 152         testEmptyAndNullShortArray();</span>
 153         testEmptyAndNullFloatArray();
 154         testEmptyAndNullDoubleArray();
<span class="line-added"> 155     }</span>
 156 
<span class="line-modified"> 157     private void testStability(int length, TestRandom random) {</span>
<span class="line-modified"> 158         printTestName(&quot;Test stability&quot;, random, length);</span>
<span class="line-modified"> 159 </span>
<span class="line-modified"> 160         Pair[] a = build(length, random);</span>
<span class="line-modified"> 161         sortingHelper.sort(a);</span>
<span class="line-modified"> 162         checkSorted(a);</span>
<span class="line-modified"> 163         checkStable(a);</span>
<span class="line-modified"> 164 </span>
<span class="line-modified"> 165         a = build(length, random);</span>
<span class="line-modified"> 166         sortingHelper.sort(a, pairComparator);</span>
<span class="line-modified"> 167         checkSorted(a);</span>
<span class="line-modified"> 168         checkStable(a);</span>
<span class="line-modified"> 169 </span>
<span class="line-modified"> 170         out.println();</span>

 171     }
 172 
<span class="line-modified"> 173     private void testEmptyAndNullIntArray() {</span>
<span class="line-modified"> 174         sortingHelper.sort(new int[] {});</span>
<span class="line-modified"> 175         sortingHelper.sort(new int[] {}, 0, 0);</span>

 176 
 177         try {
<span class="line-modified"> 178             sortingHelper.sort(null);</span>
 179         } catch (NullPointerException expected) {
 180             try {
<span class="line-modified"> 181                 sortingHelper.sort(null, 0, 0);</span>
 182             } catch (NullPointerException expected2) {
 183                 return;
 184             }
<span class="line-modified"> 185             fail(sortingHelper + &quot;(int[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 186                 &quot;catch null array&quot;);
 187         }
<span class="line-modified"> 188         fail(sortingHelper + &quot;(int[]) shouldn&#39;t catch null array&quot;);</span>
 189     }
 190 
<span class="line-modified"> 191     private void testEmptyAndNullLongArray() {</span>
<span class="line-modified"> 192         sortingHelper.sort(new long[] {});</span>
<span class="line-modified"> 193         sortingHelper.sort(new long[] {}, 0, 0);</span>

 194 
 195         try {
<span class="line-modified"> 196             sortingHelper.sort(null);</span>
 197         } catch (NullPointerException expected) {
 198             try {
<span class="line-modified"> 199                 sortingHelper.sort(null, 0, 0);</span>
 200             } catch (NullPointerException expected2) {
 201                 return;
 202             }
<span class="line-modified"> 203             fail(sortingHelper + &quot;(long[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 204                 &quot;catch null array&quot;);
 205         }
<span class="line-modified"> 206         fail(sortingHelper + &quot;(long[]) shouldn&#39;t catch null array&quot;);</span>
 207     }
 208 
<span class="line-modified"> 209     private void testEmptyAndNullByteArray() {</span>
<span class="line-modified"> 210         sortingHelper.sort(new byte[] {});</span>
<span class="line-modified"> 211         sortingHelper.sort(new byte[] {}, 0, 0);</span>

 212 
 213         try {
<span class="line-modified"> 214             sortingHelper.sort(null);</span>
 215         } catch (NullPointerException expected) {
 216             try {
<span class="line-modified"> 217                 sortingHelper.sort(null, 0, 0);</span>
 218             } catch (NullPointerException expected2) {
 219                 return;
 220             }
<span class="line-modified"> 221             fail(sortingHelper + &quot;(byte[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 222                 &quot;catch null array&quot;);
 223         }
<span class="line-modified"> 224         fail(sortingHelper + &quot;(byte[]) shouldn&#39;t catch null array&quot;);</span>
 225     }
 226 
<span class="line-modified"> 227     private void testEmptyAndNullCharArray() {</span>
<span class="line-modified"> 228         sortingHelper.sort(new char[] {});</span>
<span class="line-modified"> 229         sortingHelper.sort(new char[] {}, 0, 0);</span>

 230 
 231         try {
<span class="line-modified"> 232             sortingHelper.sort(null);</span>
 233         } catch (NullPointerException expected) {
 234             try {
<span class="line-modified"> 235                 sortingHelper.sort(null, 0, 0);</span>
 236             } catch (NullPointerException expected2) {
 237                 return;
 238             }
<span class="line-modified"> 239             fail(sortingHelper + &quot;(char[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 240                 &quot;catch null array&quot;);
 241         }
<span class="line-modified"> 242         fail(sortingHelper + &quot;(char[]) shouldn&#39;t catch null array&quot;);</span>
 243     }
 244 
<span class="line-modified"> 245     private void testEmptyAndNullShortArray() {</span>
<span class="line-modified"> 246         sortingHelper.sort(new short[] {});</span>
<span class="line-modified"> 247         sortingHelper.sort(new short[] {}, 0, 0);</span>

 248 
 249         try {
<span class="line-modified"> 250             sortingHelper.sort(null);</span>
 251         } catch (NullPointerException expected) {
 252             try {
<span class="line-modified"> 253                 sortingHelper.sort(null, 0, 0);</span>
 254             } catch (NullPointerException expected2) {
 255                 return;
 256             }
<span class="line-modified"> 257             fail(sortingHelper + &quot;(short[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 258                 &quot;catch null array&quot;);
 259         }
<span class="line-modified"> 260         fail(sortingHelper + &quot;(short[]) shouldn&#39;t catch null array&quot;);</span>
 261     }
 262 
<span class="line-modified"> 263     private void testEmptyAndNullFloatArray() {</span>
<span class="line-modified"> 264         sortingHelper.sort(new float[] {});</span>
<span class="line-modified"> 265         sortingHelper.sort(new float[] {}, 0, 0);</span>

 266 
 267         try {
<span class="line-modified"> 268             sortingHelper.sort(null);</span>
 269         } catch (NullPointerException expected) {
 270             try {
<span class="line-modified"> 271                 sortingHelper.sort(null, 0, 0);</span>
 272             } catch (NullPointerException expected2) {
 273                 return;
 274             }
<span class="line-modified"> 275             fail(sortingHelper + &quot;(float[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 276                 &quot;catch null array&quot;);
 277         }
<span class="line-modified"> 278         fail(sortingHelper + &quot;(float[]) shouldn&#39;t catch null array&quot;);</span>
 279     }
 280 
<span class="line-modified"> 281     private void testEmptyAndNullDoubleArray() {</span>
<span class="line-modified"> 282         sortingHelper.sort(new double[] {});</span>
<span class="line-modified"> 283         sortingHelper.sort(new double[] {}, 0, 0);</span>

 284 
 285         try {
<span class="line-modified"> 286             sortingHelper.sort(null);</span>
 287         } catch (NullPointerException expected) {
 288             try {
<span class="line-modified"> 289                 sortingHelper.sort(null, 0, 0);</span>
 290             } catch (NullPointerException expected2) {
 291                 return;
 292             }
<span class="line-modified"> 293             fail(sortingHelper + &quot;(double[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 294                 &quot;catch null array&quot;);
 295         }
<span class="line-modified"> 296         fail(sortingHelper + &quot;(double[]) shouldn&#39;t catch null array&quot;);</span>
 297     }
 298 
<span class="line-modified"> 299     private void testSubArray(int length, TestRandom random) {</span>
<span class="line-modified"> 300         if (length &lt; 4) {</span>
<span class="line-modified"> 301             return;</span>
<span class="line-modified"> 302         }</span>
<span class="line-modified"> 303         for (int m = 1; m &lt; length / 2; m &lt;&lt;= 1) {</span>


 304             int fromIndex = m;
 305             int toIndex = length - m;
 306 
<span class="line-modified"> 307             prepareSubArray((int[]) gold[0], fromIndex, toIndex);</span>
<span class="line-modified"> 308             convertData(length);</span>
 309 
<span class="line-modified"> 310             for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 311                 printTestName(&quot;Test subarray&quot;, random, length,</span>
<span class="line-modified"> 312                     &quot;, m = &quot; + m + &quot;, &quot; + getType(i));</span>
<span class="line-modified"> 313                 sortingHelper.sort(test[i], fromIndex, toIndex);</span>
<span class="line-modified"> 314                 checkSubArray(test[i], fromIndex, toIndex);</span>


 315             }
 316         }
<span class="line-modified"> 317         out.println();</span>


 318     }
 319 
<span class="line-modified"> 320     private void testRange(int length, TestRandom random) {</span>
<span class="line-modified"> 321         if (length &lt; 2) {</span>
<span class="line-modified"> 322             return;</span>
<span class="line-modified"> 323         }</span>
<span class="line-modified"> 324         for (int m = 1; m &lt; length; m &lt;&lt;= 1) {</span>
 325             for (int i = 1; i &lt;= length; i++) {
<span class="line-modified"> 326                 ((int[]) gold[0]) [i - 1] = i % m + m % i;</span>
 327             }
<span class="line-modified"> 328             convertData(length);</span>
<span class="line-modified"> 329 </span>
<span class="line-modified"> 330             for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 331                 printTestName(&quot;Test range check&quot;, random, length,</span>
<span class="line-modified"> 332                     &quot;, m = &quot; + m + &quot;, &quot; + getType(i));</span>
<span class="line-added"> 333                 checkRange(test[i], m);</span>
 334             }
 335         }
 336         out.println();
 337     }
 338 
<span class="line-modified"> 339     private void checkSorted(Pair[] a) {</span>












 340         for (int i = 0; i &lt; a.length - 1; i++) {
 341             if (a[i].getKey() &gt; a[i + 1].getKey()) {
<span class="line-modified"> 342                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; +</span>
<span class="line-added"> 343                     a[i].getKey() + &quot; and &quot; + a[i + 1].getKey());</span>
 344             }
 345         }
 346     }
 347 
<span class="line-modified"> 348     private void checkStable(Pair[] a) {</span>
 349         for (int i = 0; i &lt; a.length / 4; ) {
 350             int key1 = a[i].getKey();
 351             int value1 = a[i++].getValue();
 352             int key2 = a[i].getKey();
 353             int value2 = a[i++].getValue();
 354             int key3 = a[i].getKey();
 355             int value3 = a[i++].getValue();
 356             int key4 = a[i].getKey();
 357             int value4 = a[i++].getValue();
 358 
 359             if (!(key1 == key2 &amp;&amp; key2 == key3 &amp;&amp; key3 == key4)) {
<span class="line-modified"> 360                 fail(&quot;Keys are different &quot; + key1 + &quot;, &quot; + key2 + &quot;, &quot; +</span>
<span class="line-modified"> 361                     key3 + &quot;, &quot; + key4 + &quot; at position &quot; + i);</span>
 362             }
 363             if (!(value1 &lt; value2 &amp;&amp; value2 &lt; value3 &amp;&amp; value3 &lt; value4)) {
<span class="line-modified"> 364                 fail(&quot;Sorting is not stable at position &quot; + i +</span>
<span class="line-modified"> 365                     &quot;. Second values have been changed: &quot; + value1 + &quot;, &quot; +</span>
 366                     value2 + &quot;, &quot; + value3 + &quot;, &quot; + value4);
 367             }
 368         }
 369     }
 370 
<span class="line-modified"> 371     private Pair[] build(int length, Random random) {</span>
 372         Pair[] a = new Pair[length * 4];
 373 
 374         for (int i = 0; i &lt; a.length; ) {
 375             int key = random.nextInt();
 376             a[i++] = new Pair(key, 1);
 377             a[i++] = new Pair(key, 2);
 378             a[i++] = new Pair(key, 3);
 379             a[i++] = new Pair(key, 4);
 380         }
 381         return a;
 382     }
 383 
<span class="line-modified"> 384     private void testWithInsertionSort(int length, TestRandom random) {</span>


































 385         if (length &gt; 1000) {
 386             return;
 387         }
<span class="line-modified"> 388         for (int m = 1; m &lt;= length; m &lt;&lt;= 1) {</span>



 389             for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<span class="line-modified"> 390                 builder.build((int[]) gold[0], m, random);</span>
<span class="line-modified"> 391                 convertData(length);</span>
<span class="line-modified"> 392 </span>
<span class="line-modified"> 393                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 394                     printTestName(&quot;Test with insertion sort&quot;, random, length,</span>
<span class="line-modified"> 395                         &quot;, m = &quot; + m + &quot;, &quot; + getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified"> 396                     sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 397                     sortByInsertionSort(gold[i]);</span>
<span class="line-modified"> 398                     compare(test[i], gold[i]);</span>




 399                 }
 400             }
 401         }
 402         out.println();
 403     }
 404 
<span class="line-modified"> 405     private void testMergingSort(int length, TestRandom random) {</span>
<span class="line-modified"> 406         if (length &lt; (4 &lt;&lt; 10)) { // DualPivotQuicksort.MIN_TRY_MERGE_SIZE</span>
 407             return;
 408         }
<span class="line-modified"> 409         final int PERIOD = 50;</span>
<span class="line-modified"> 410 </span>
<span class="line-modified"> 411         for (int m = PERIOD - 2; m &lt;= PERIOD + 2; m++) {</span>
<span class="line-modified"> 412             for (MergingBuilder builder : MergingBuilder.values()) {</span>
<span class="line-modified"> 413                 builder.build((int[]) gold[0], m);</span>
<span class="line-modified"> 414                 convertData(length);</span>
<span class="line-modified"> 415 </span>
<span class="line-modified"> 416                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 417                     printTestName(&quot;Test merging sort&quot;, random, length,</span>
<span class="line-modified"> 418                         &quot;, m = &quot; + m + &quot;, &quot; +  getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified"> 419                     sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 420                     checkSorted(test[i]);</span>



 421                 }
 422             }
 423         }
 424         out.println();
 425     }
 426 
<span class="line-modified"> 427     private void testWithCheckSum(int length, TestRandom random) {</span>
<span class="line-modified"> 428         for (int m = 1; m &lt;= length; m &lt;&lt;= 1) {</span>



 429             for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<span class="line-modified"> 430                 builder.build((int[]) gold[0], m, random);</span>
<span class="line-modified"> 431                 convertData(length);</span>
<span class="line-modified"> 432 </span>
<span class="line-modified"> 433                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 434                     printTestName(&quot;Test with check sum&quot;, random, length,</span>
<span class="line-modified"> 435                         &quot;, m = &quot; + m + &quot;, &quot; + getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified"> 436                     sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 437                     checkWithCheckSum(test[i], gold[i]);</span>



 438                 }
 439             }
 440         }
 441         out.println();
 442     }
 443 
<span class="line-modified"> 444     private void testWithScrambling(int length, TestRandom random) {</span>
<span class="line-modified"> 445         for (int m = 1; m &lt;= length; m &lt;&lt;= 1) {</span>






 446             for (SortedBuilder builder : SortedBuilder.values()) {
<span class="line-modified"> 447                 builder.build((int[]) gold[0], m);</span>
<span class="line-modified"> 448                 convertData(length);</span>
<span class="line-modified"> 449 </span>
<span class="line-modified"> 450                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 451                     printTestName(&quot;Test with scrambling&quot;, random, length,</span>
<span class="line-modified"> 452                         &quot;, m = &quot; + m + &quot;, &quot; + getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified"> 453                     scramble(test[i], random);</span>
<span class="line-modified"> 454                     sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 455                     compare(test[i], gold[i]);</span>



 456                 }
 457             }
 458         }
 459         out.println();
 460     }
 461 
<span class="line-modified"> 462     private void testNegativeZero(int length, TestRandom random) {</span>
<span class="line-modified"> 463         for (int i = 5; i &lt; test.length; i++) {</span>
<span class="line-modified"> 464             printTestName(&quot;Test negative zero -0.0&quot;, random, length, &quot; &quot; + getType(i));</span>


 465 
<span class="line-modified"> 466             NegativeZeroBuilder builder = NegativeZeroBuilder.values() [i - 5];</span>
<span class="line-modified"> 467             builder.build(test[i], random);</span>
<span class="line-modified"> 468 </span>
<span class="line-modified"> 469             sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 470             checkNegativeZero(test[i]);</span>
























 471         }
<span class="line-added"> 472         out.println();</span>
 473     }
 474 
<span class="line-modified"> 475     private void testFloatingPointSorting(int length, TestRandom random) {</span>
<span class="line-modified"> 476         if (length &lt; 2) {</span>
<span class="line-modified"> 477             return;</span>
<span class="line-modified"> 478         }</span>
<span class="line-modified"> 479         final int MAX = 13;</span>
 480 
<span class="line-modified"> 481         for (int a = 0; a &lt; MAX; a++) {</span>
<span class="line-modified"> 482             for (int g = 0; g &lt; MAX; g++) {</span>
<span class="line-modified"> 483                 for (int z = 0; z &lt; MAX; z++) {</span>
<span class="line-modified"> 484                     for (int n = 0; n &lt; MAX; n++) {</span>
<span class="line-modified"> 485                         for (int p = 0; p &lt; MAX; p++) {</span>
<span class="line-modified"> 486                             if (a + g + z + n + p != length) {</span>



 487                                 continue;
 488                             }
<span class="line-modified"> 489                             for (int i = 5; i &lt; test.length; i++) {</span>
<span class="line-modified"> 490                                 printTestName(&quot;Test float-pointing sorting&quot;, random, length,</span>
<span class="line-modified"> 491                                     &quot;, a = &quot; + a + &quot;, g = &quot; + g + &quot;, z = &quot; + z +</span>
<span class="line-modified"> 492                                     &quot;, n = &quot; + n + &quot;, p = &quot; + p + &quot;, &quot; + getType(i));</span>
<span class="line-modified"> 493                                 FloatingPointBuilder builder = FloatingPointBuilder.values()[i - 5];</span>
<span class="line-modified"> 494                                 builder.build(gold[i], a, g, z, n, p, random);</span>
<span class="line-modified"> 495                                 copy(test[i], gold[i]);</span>
<span class="line-modified"> 496                                 scramble(test[i], random);</span>
<span class="line-modified"> 497                                 sortingHelper.sort(test[i]);</span>
<span class="line-added"> 498                                 compare(test[i], gold[i], a, n, g);</span>
 499                             }

 500                         }
 501                     }
 502                 }
 503             }
 504         }
<span class="line-modified"> 505 </span>
<span class="line-modified"> 506         for (int m = 13; m &gt; 4; m--) {</span>
<span class="line-added"> 507             int t = length / m;</span>
<span class="line-added"> 508             int g = t, z = t, n = t, p = t;</span>
<span class="line-added"> 509             int a = length - g - z - n - p;</span>
<span class="line-added"> 510 </span>
<span class="line-added"> 511             for (int i = 5; i &lt; test.length; i++) {</span>
<span class="line-added"> 512                 printTestName(&quot;Test float-pointing sorting&quot;, random, length,</span>
<span class="line-added"> 513                     &quot;, a = &quot; + a + &quot;, g = &quot; + g + &quot;, z = &quot; + z +</span>
<span class="line-added"> 514                     &quot;, n = &quot; + n + &quot;, p = &quot; + p + &quot;, &quot; + getType(i));</span>
<span class="line-added"> 515                 FloatingPointBuilder builder = FloatingPointBuilder.values() [i - 5];</span>
<span class="line-added"> 516                 builder.build(gold[i], a, g, z, n, p, random);</span>
<span class="line-added"> 517                 copy(test[i], gold[i]);</span>
<span class="line-added"> 518                 scramble(test[i], random);</span>
<span class="line-added"> 519                 sortingHelper.sort(test[i]);</span>
<span class="line-added"> 520                 compare(test[i], gold[i], a, n, g);</span>
<span class="line-added"> 521             }</span>
 522         }
<span class="line-added"> 523         out.println();</span>
 524     }
 525 
<span class="line-modified"> 526     private void prepareSubArray(int[] a, int fromIndex, int toIndex) {</span>
 527         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified"> 528             a[i] = A380;</span>
 529         }
 530         int middle = (fromIndex + toIndex) &gt;&gt;&gt; 1;
 531         int k = 0;
 532 
 533         for (int i = fromIndex; i &lt; middle; i++) {
 534             a[i] = k++;
 535         }
<span class="line-added"> 536 </span>
 537         for (int i = middle; i &lt; toIndex; i++) {
 538             a[i] = k--;
 539         }
<span class="line-added"> 540 </span>
 541         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified"> 542             a[i] = B747;</span>
<span class="line-added"> 543         }</span>
<span class="line-added"> 544     }</span>
<span class="line-added"> 545 </span>
<span class="line-added"> 546     private void scramble(Object a, Random random) {</span>
<span class="line-added"> 547         if (a instanceof int[]) {</span>
<span class="line-added"> 548             scramble((int[]) a, random);</span>
<span class="line-added"> 549         } else if (a instanceof long[]) {</span>
<span class="line-added"> 550             scramble((long[]) a, random);</span>
<span class="line-added"> 551         } else if (a instanceof byte[]) {</span>
<span class="line-added"> 552             scramble((byte[]) a, random);</span>
<span class="line-added"> 553         } else if (a instanceof char[]) {</span>
<span class="line-added"> 554             scramble((char[]) a, random);</span>
<span class="line-added"> 555         } else if (a instanceof short[]) {</span>
<span class="line-added"> 556             scramble((short[]) a, random);</span>
<span class="line-added"> 557         } else if (a instanceof float[]) {</span>
<span class="line-added"> 558             scramble((float[]) a, random);</span>
<span class="line-added"> 559         } else if (a instanceof double[]) {</span>
<span class="line-added"> 560             scramble((double[]) a, random);</span>
<span class="line-added"> 561         } else {</span>
<span class="line-added"> 562             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
 563         }
 564     }
 565 
<span class="line-modified"> 566     private void scramble(int[] a, Random random) {</span>
 567         for (int i = 0; i &lt; a.length * 7; i++) {
 568             swap(a, random.nextInt(a.length), random.nextInt(a.length));
 569         }
 570     }
 571 
<span class="line-modified"> 572     private void scramble(long[] a, Random random) {</span>
 573         for (int i = 0; i &lt; a.length * 7; i++) {
 574             swap(a, random.nextInt(a.length), random.nextInt(a.length));
 575         }
 576     }
 577 
<span class="line-modified"> 578     private void scramble(byte[] a, Random random) {</span>
 579         for (int i = 0; i &lt; a.length * 7; i++) {
 580             swap(a, random.nextInt(a.length), random.nextInt(a.length));
 581         }
 582     }
 583 
<span class="line-modified"> 584     private void scramble(char[] a, Random random) {</span>
<span class="line-modified"> 585         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified"> 586             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified"> 587         }</span>
 588     }
 589 
<span class="line-modified"> 590     private void scramble(short[] a, Random random) {</span>
<span class="line-modified"> 591         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified"> 592             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified"> 593         }</span>
 594     }
 595 
<span class="line-modified"> 596     private void scramble(float[] a, Random random) {</span>
<span class="line-modified"> 597         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified"> 598             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified"> 599         }</span>
 600     }
 601 
<span class="line-modified"> 602     private void scramble(double[] a, Random random) {</span>
<span class="line-modified"> 603         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified"> 604             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified"> 605         }</span>
<span class="line-modified"> 606     }</span>




 607 
<span class="line-modified"> 608     private void swap(int[] a, int i, int j) {</span>
<span class="line-modified"> 609         int t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 610     }</span>






 611 
<span class="line-modified"> 612     private void swap(long[] a, int i, int j) {</span>
<span class="line-modified"> 613         long t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 614     }</span>






 615 
<span class="line-modified"> 616     private void swap(byte[] a, int i, int j) {</span>
<span class="line-modified"> 617         byte t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 618     }</span>






 619 
<span class="line-modified"> 620     private void swap(char[] a, int i, int j) {</span>
<span class="line-modified"> 621         char t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 622     }</span>






 623 
<span class="line-modified"> 624     private void swap(short[] a, int i, int j) {</span>
<span class="line-modified"> 625         short t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 626     }</span>






 627 
<span class="line-modified"> 628     private void swap(float[] a, int i, int j) {</span>
<span class="line-modified"> 629         float t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 630     }</span>






 631 
<span class="line-modified"> 632     private void swap(double[] a, int i, int j) {</span>
<span class="line-modified"> 633         double t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 634     }</span>



 635 
<span class="line-modified"> 636     private void checkWithCheckSum(Object test, Object gold) {</span>
<span class="line-added"> 637         checkSorted(test);</span>
<span class="line-added"> 638         checkCheckSum(test, gold);</span>
<span class="line-added"> 639     }</span>
 640 
<span class="line-modified"> 641     private void fail(String message) {</span>
<span class="line-modified"> 642         err.format(&quot;\n*** TEST FAILED ***\n\n%s\n\n&quot;, message);</span>
<span class="line-added"> 643         throw new RuntimeException(&quot;Test failed&quot;);</span>
<span class="line-added"> 644     }</span>
 645 
<span class="line-modified"> 646     private void checkNegativeZero(Object a) {</span>
<span class="line-modified"> 647         if (a instanceof float[]) {</span>
<span class="line-modified"> 648             checkNegativeZero((float[]) a);</span>
<span class="line-modified"> 649         } else if (a instanceof double[]) {</span>
<span class="line-added"> 650             checkNegativeZero((double[]) a);</span>
<span class="line-added"> 651         } else {</span>
<span class="line-added"> 652             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
 653         }
 654     }
 655 
<span class="line-modified"> 656     private void checkNegativeZero(float[] a) {</span>
<span class="line-modified"> 657         for (int i = 0; i &lt; a.length - 1; i++) {</span>
<span class="line-modified"> 658             if (Float.floatToRawIntBits(a[i]) == 0 &amp;&amp; Float.floatToRawIntBits(a[i + 1]) &lt; 0) {</span>
<span class="line-modified"> 659                 fail(a[i] + &quot; before &quot; + a[i + 1] + &quot; at position &quot; + i);</span>
















 660             }
<span class="line-modified"> 661         }</span>


 662     }
 663 
<span class="line-modified"> 664     private void checkNegativeZero(double[] a) {</span>
<span class="line-modified"> 665         for (int i = 0; i &lt; a.length - 1; i++) {</span>
<span class="line-modified"> 666             if (Double.doubleToRawLongBits(a[i]) == 0 &amp;&amp; Double.doubleToRawLongBits(a[i + 1]) &lt; 0) {</span>
<span class="line-modified"> 667                 fail(a[i] + &quot; before &quot; + a[i + 1] + &quot; at position &quot; + i);</span>
















 668             }
<span class="line-modified"> 669         }</span>


 670     }
 671 
<span class="line-modified"> 672     private void compare(Object a, Object b, int numNaN, int numNeg, int numNegZero) {</span>
<span class="line-modified"> 673         if (a instanceof float[]) {</span>
<span class="line-modified"> 674             compare((float[]) a, (float[]) b, numNaN, numNeg, numNegZero);</span>
<span class="line-added"> 675         } else if (a instanceof double[]) {</span>
<span class="line-added"> 676             compare((double[]) a, (double[]) b, numNaN, numNeg, numNegZero);</span>
<span class="line-added"> 677         } else {</span>
<span class="line-added"> 678             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
 679         }
 680     }
 681 
<span class="line-modified"> 682     private void compare(float[] a, float[] b, int numNaN, int numNeg, int numNegZero) {</span>
 683         for (int i = a.length - numNaN; i &lt; a.length; i++) {
 684             if (a[i] == a[i]) {
<span class="line-modified"> 685                 fail(&quot;There must be NaN instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 686             }
 687         }
 688         final int NEGATIVE_ZERO = Float.floatToIntBits(-0.0f);
 689 
 690         for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
 691             if (NEGATIVE_ZERO != Float.floatToIntBits(a[i])) {
<span class="line-modified"> 692                 fail(&quot;There must be -0.0 instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 693             }
 694         }
<span class="line-added"> 695 </span>
 696         for (int i = 0; i &lt; a.length - numNaN; i++) {
 697             if (a[i] != b[i]) {
<span class="line-modified"> 698                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 699             }
 700         }
 701     }
 702 
<span class="line-modified"> 703     private void compare(double[] a, double[] b, int numNaN, int numNeg, int numNegZero) {</span>






 704         for (int i = a.length - numNaN; i &lt; a.length; i++) {
 705             if (a[i] == a[i]) {
<span class="line-modified"> 706                 fail(&quot;There must be NaN instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 707             }
 708         }
 709         final long NEGATIVE_ZERO = Double.doubleToLongBits(-0.0d);
 710 
 711         for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
 712             if (NEGATIVE_ZERO != Double.doubleToLongBits(a[i])) {
<span class="line-modified"> 713                 fail(&quot;There must be -0.0 instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 714             }
 715         }
<span class="line-added"> 716 </span>
 717         for (int i = 0; i &lt; a.length - numNaN; i++) {
 718             if (a[i] != b[i]) {
<span class="line-modified"> 719                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
<span class="line-modified"> 720             }</span>
<span class="line-added"> 721         }</span>
<span class="line-added"> 722     }</span>
<span class="line-added"> 723 </span>
<span class="line-added"> 724     private void compare(Object a, Object b) {</span>
<span class="line-added"> 725         if (a instanceof int[]) {</span>
<span class="line-added"> 726             compare((int[]) a, (int[]) b);</span>
<span class="line-added"> 727         } else if (a instanceof long[]) {</span>
<span class="line-added"> 728             compare((long[]) a, (long[]) b);</span>
<span class="line-added"> 729         } else if (a instanceof byte[]) {</span>
<span class="line-added"> 730             compare((byte[]) a, (byte[]) b);</span>
<span class="line-added"> 731         } else if (a instanceof char[]) {</span>
<span class="line-added"> 732             compare((char[]) a, (char[]) b);</span>
<span class="line-added"> 733         } else if (a instanceof short[]) {</span>
<span class="line-added"> 734             compare((short[]) a, (short[]) b);</span>
<span class="line-added"> 735         } else if (a instanceof float[]) {</span>
<span class="line-added"> 736             compare((float[]) a, (float[]) b);</span>
<span class="line-added"> 737         } else if (a instanceof double[]) {</span>
<span class="line-added"> 738             compare((double[]) a, (double[]) b);</span>
<span class="line-added"> 739         } else {</span>
<span class="line-added"> 740             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
 741         }
 742     }
 743 
<span class="line-modified"> 744     private void compare(int[] a, int[] b) {</span>
<span class="line-modified"> 745         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 746             if (a[i] != b[i]) {</span>
<span class="line-modified"> 747                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
<span class="line-modified"> 748             }</span>
<span class="line-modified"> 749         }</span>
<span class="line-added"> 750     }</span>
 751 
<span class="line-modified"> 752     private void compare(long[] a, long[] b) {</span>
<span class="line-modified"> 753         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 754             if (a[i] != b[i]) {</span>
<span class="line-modified"> 755                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>








 756             }
<span class="line-modified"> 757         }</span>
<span class="line-modified"> 758     }</span>



 759 
<span class="line-modified"> 760     private void compare(byte[] a, byte[] b) {</span>





































































































































































































































 761         for (int i = 0; i &lt; a.length; i++) {
 762             if (a[i] != b[i]) {
<span class="line-modified"> 763                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 764             }
 765         }
 766     }
 767 
<span class="line-modified"> 768     private void compare(char[] a, char[] b) {</span>
 769         for (int i = 0; i &lt; a.length; i++) {
 770             if (a[i] != b[i]) {
<span class="line-modified"> 771                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 772             }
 773         }
 774     }
 775 
<span class="line-modified"> 776     private void compare(short[] a, short[] b) {</span>
 777         for (int i = 0; i &lt; a.length; i++) {
 778             if (a[i] != b[i]) {
<span class="line-modified"> 779                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 780             }
 781         }
 782     }
 783 
<span class="line-modified"> 784     private void compare(float[] a, float[] b) {</span>
 785         for (int i = 0; i &lt; a.length; i++) {
 786             if (a[i] != b[i]) {
<span class="line-modified"> 787                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 788             }
 789         }
 790     }
 791 
<span class="line-modified"> 792     private void compare(double[] a, double[] b) {</span>
 793         for (int i = 0; i &lt; a.length; i++) {
 794             if (a[i] != b[i]) {
<span class="line-modified"> 795                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 796             }
 797         }
 798     }
 799 
<span class="line-modified"> 800     private String getType(int i) {</span>
<span class="line-modified"> 801         Object a = test[i];</span>





 802 
<span class="line-modified"> 803         if (a instanceof int[]) {</span>
<span class="line-modified"> 804             return &quot;INT   &quot;;</span>
<span class="line-modified"> 805         }</span>
<span class="line-modified"> 806         if (a instanceof long[]) {</span>
<span class="line-modified"> 807             return &quot;LONG  &quot;;</span>
<span class="line-added"> 808         }</span>
<span class="line-added"> 809         if (a instanceof byte[]) {</span>
<span class="line-added"> 810             return &quot;BYTE  &quot;;</span>
<span class="line-added"> 811         }</span>
<span class="line-added"> 812         if (a instanceof char[]) {</span>
<span class="line-added"> 813             return &quot;CHAR  &quot;;</span>
 814         }
<span class="line-added"> 815         if (a instanceof short[]) {</span>
<span class="line-added"> 816             return &quot;SHORT &quot;;</span>
<span class="line-added"> 817         }</span>
<span class="line-added"> 818         if (a instanceof float[]) {</span>
<span class="line-added"> 819             return &quot;FLOAT &quot;;</span>
<span class="line-added"> 820         }</span>
<span class="line-added"> 821         if (a instanceof double[]) {</span>
<span class="line-added"> 822             return &quot;DOUBLE&quot;;</span>
<span class="line-added"> 823         }</span>
<span class="line-added"> 824         fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
<span class="line-added"> 825         return null;</span>
 826     }
 827 
<span class="line-modified"> 828     private void checkSorted(Object a) {</span>
<span class="line-modified"> 829         if (a instanceof int[]) {</span>
<span class="line-modified"> 830             checkSorted((int[]) a);</span>
<span class="line-modified"> 831         } else if (a instanceof long[]) {</span>
<span class="line-modified"> 832             checkSorted((long[]) a);</span>
<span class="line-modified"> 833         } else if (a instanceof byte[]) {</span>
<span class="line-modified"> 834             checkSorted((byte[]) a);</span>
<span class="line-modified"> 835         } else if (a instanceof char[]) {</span>
<span class="line-modified"> 836             checkSorted((char[]) a);</span>
<span class="line-modified"> 837         } else if (a instanceof short[]) {</span>
<span class="line-modified"> 838             checkSorted((short[]) a);</span>
<span class="line-modified"> 839         } else if (a instanceof float[]) {</span>
<span class="line-modified"> 840             checkSorted((float[]) a);</span>
<span class="line-modified"> 841         } else if (a instanceof double[]) {</span>
<span class="line-modified"> 842             checkSorted((double[]) a);</span>










 843         } else {
<span class="line-modified"> 844             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>

 845         }
 846     }
 847 
<span class="line-modified"> 848     private void checkSorted(int[] a) {</span>
 849         for (int i = 0; i &lt; a.length - 1; i++) {
 850             if (a[i] &gt; a[i + 1]) {
<span class="line-modified"> 851                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 852             }
 853         }
 854     }
 855 
<span class="line-modified"> 856     private void checkSorted(long[] a) {</span>
 857         for (int i = 0; i &lt; a.length - 1; i++) {
 858             if (a[i] &gt; a[i + 1]) {
<span class="line-modified"> 859                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 860             }
 861         }
 862     }
 863 
<span class="line-modified"> 864     private void checkSorted(byte[] a) {</span>
 865         for (int i = 0; i &lt; a.length - 1; i++) {
 866             if (a[i] &gt; a[i + 1]) {
<span class="line-modified"> 867                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 868             }
 869         }
 870     }
 871 
<span class="line-modified"> 872     private void checkSorted(char[] a) {</span>
 873         for (int i = 0; i &lt; a.length - 1; i++) {
 874             if (a[i] &gt; a[i + 1]) {
<span class="line-modified"> 875                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 876             }
 877         }
 878     }
 879 
<span class="line-modified"> 880     private void checkSorted(short[] a) {</span>
 881         for (int i = 0; i &lt; a.length - 1; i++) {
 882             if (a[i] &gt; a[i + 1]) {
<span class="line-modified"> 883                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 884             }
 885         }
 886     }
 887 
<span class="line-modified"> 888     private void checkSorted(float[] a) {</span>
 889         for (int i = 0; i &lt; a.length - 1; i++) {
 890             if (a[i] &gt; a[i + 1]) {
<span class="line-modified"> 891                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 892             }
 893         }
 894     }
 895 
<span class="line-modified"> 896     private void checkSorted(double[] a) {</span>
 897         for (int i = 0; i &lt; a.length - 1; i++) {
 898             if (a[i] &gt; a[i + 1]) {
<span class="line-modified"> 899                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 900             }
 901         }
 902     }
 903 
<span class="line-modified"> 904     private void checkCheckSum(Object test, Object gold) {</span>
<span class="line-modified"> 905         if (checkSumXor(test) != checkSumXor(gold)) {</span>
<span class="line-modified"> 906             fail(&quot;Original and sorted arrays are not identical [^]&quot;);</span>
<span class="line-modified"> 907         }</span>
<span class="line-modified"> 908         if (checkSumPlus(test) != checkSumPlus(gold)) {</span>
<span class="line-added"> 909             fail(&quot;Original and sorted arrays are not identical [+]&quot;);</span>
 910         }
 911     }
 912 
<span class="line-modified"> 913     private int checkSumXor(Object a) {</span>
<span class="line-modified"> 914         if (a instanceof int[]) {</span>
<span class="line-modified"> 915             return checkSumXor((int[]) a);</span>
 916         }
<span class="line-modified"> 917         if (a instanceof long[]) {</span>
<span class="line-modified"> 918             return checkSumXor((long[]) a);</span>
 919         }
<span class="line-modified"> 920         if (a instanceof byte[]) {</span>
<span class="line-modified"> 921             return checkSumXor((byte[]) a);</span>





















 922         }
<span class="line-modified"> 923         if (a instanceof char[]) {</span>
<span class="line-modified"> 924             return checkSumXor((char[]) a);</span>





 925         }
<span class="line-modified"> 926         if (a instanceof short[]) {</span>
<span class="line-added"> 927             return checkSumXor((short[]) a);</span>
<span class="line-added"> 928         }</span>
<span class="line-added"> 929         if (a instanceof float[]) {</span>
<span class="line-added"> 930             return checkSumXor((float[]) a);</span>
<span class="line-added"> 931         }</span>
<span class="line-added"> 932         if (a instanceof double[]) {</span>
<span class="line-added"> 933             return checkSumXor((double[]) a);</span>
<span class="line-added"> 934         }</span>
<span class="line-added"> 935         fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
<span class="line-added"> 936         return -1;</span>
 937     }
 938 
<span class="line-modified"> 939     private int checkSumXor(int[] a) {</span>
 940         int checkSum = 0;
 941 
 942         for (int e : a) {
 943             checkSum ^= e;
 944         }
 945         return checkSum;
 946     }
 947 
<span class="line-modified"> 948     private int checkSumXor(long[] a) {</span>
 949         long checkSum = 0;
 950 
 951         for (long e : a) {
 952             checkSum ^= e;
 953         }
 954         return (int) checkSum;
 955     }
 956 
<span class="line-modified"> 957     private int checkSumXor(byte[] a) {</span>
<span class="line-modified"> 958         byte checkSum = 0;</span>
 959 
<span class="line-modified"> 960         for (byte e : a) {</span>
 961             checkSum ^= e;
 962         }
 963         return (int) checkSum;
 964     }
 965 
<span class="line-modified"> 966     private int checkSumXor(char[] a) {</span>
<span class="line-modified"> 967         char checkSum = 0;</span>
 968 
<span class="line-modified"> 969         for (char e : a) {</span>
 970             checkSum ^= e;
 971         }
 972         return (int) checkSum;
 973     }
 974 
<span class="line-modified"> 975     private int checkSumXor(short[] a) {</span>
<span class="line-modified"> 976         short checkSum = 0;</span>
 977 
<span class="line-modified"> 978         for (short e : a) {</span>
 979             checkSum ^= e;
 980         }
 981         return (int) checkSum;
 982     }
 983 
<span class="line-modified"> 984     private int checkSumXor(float[] a) {</span>
 985         int checkSum = 0;
 986 
 987         for (float e : a) {
 988             checkSum ^= (int) e;
 989         }
 990         return checkSum;
 991     }
 992 
<span class="line-modified"> 993     private int checkSumXor(double[] a) {</span>
 994         int checkSum = 0;
 995 
 996         for (double e : a) {
 997             checkSum ^= (int) e;
 998         }
 999         return checkSum;
1000     }
1001 
<span class="line-modified">1002     private int checkSumPlus(Object a) {</span>
<span class="line-modified">1003         if (a instanceof int[]) {</span>
<span class="line-modified">1004             return checkSumPlus((int[]) a);</span>
<span class="line-modified">1005         }</span>
<span class="line-modified">1006         if (a instanceof long[]) {</span>
<span class="line-modified">1007             return checkSumPlus((long[]) a);</span>















1008         }
<span class="line-added">1009         if (a instanceof byte[]) {</span>
<span class="line-added">1010             return checkSumPlus((byte[]) a);</span>
<span class="line-added">1011         }</span>
<span class="line-added">1012         if (a instanceof char[]) {</span>
<span class="line-added">1013             return checkSumPlus((char[]) a);</span>
<span class="line-added">1014         }</span>
<span class="line-added">1015         if (a instanceof short[]) {</span>
<span class="line-added">1016             return checkSumPlus((short[]) a);</span>
<span class="line-added">1017         }</span>
<span class="line-added">1018         if (a instanceof float[]) {</span>
<span class="line-added">1019             return checkSumPlus((float[]) a);</span>
<span class="line-added">1020         }</span>
<span class="line-added">1021         if (a instanceof double[]) {</span>
<span class="line-added">1022             return checkSumPlus((double[]) a);</span>
<span class="line-added">1023         }</span>
<span class="line-added">1024         fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
<span class="line-added">1025         return -1;</span>
1026     }
1027 
<span class="line-modified">1028     private int checkSumPlus(int[] a) {</span>
1029         int checkSum = 0;
1030 
1031         for (int e : a) {
1032             checkSum += e;
1033         }
1034         return checkSum;
1035     }
1036 
<span class="line-modified">1037     private int checkSumPlus(long[] a) {</span>
1038         long checkSum = 0;
1039 
1040         for (long e : a) {
1041             checkSum += e;
1042         }
1043         return (int) checkSum;
1044     }
1045 
<span class="line-modified">1046     private int checkSumPlus(byte[] a) {</span>
<span class="line-modified">1047         byte checkSum = 0;</span>
1048 
<span class="line-modified">1049         for (byte e : a) {</span>
1050             checkSum += e;
1051         }
1052         return (int) checkSum;
1053     }
1054 
<span class="line-modified">1055     private int checkSumPlus(char[] a) {</span>
<span class="line-modified">1056         char checkSum = 0;</span>
1057 
<span class="line-modified">1058         for (char e : a) {</span>
1059             checkSum += e;
1060         }
1061         return (int) checkSum;
1062     }
1063 
<span class="line-modified">1064     private int checkSumPlus(short[] a) {</span>
<span class="line-modified">1065         short checkSum = 0;</span>
1066 
<span class="line-modified">1067         for (short e : a) {</span>
1068             checkSum += e;
1069         }
1070         return (int) checkSum;
1071     }
1072 
<span class="line-modified">1073     private int checkSumPlus(float[] a) {</span>
1074         int checkSum = 0;
1075 
1076         for (float e : a) {
1077             checkSum += (int) e;
1078         }
1079         return checkSum;
1080     }
1081 
<span class="line-modified">1082     private int checkSumPlus(double[] a) {</span>
1083         int checkSum = 0;
1084 
1085         for (double e : a) {
1086             checkSum += (int) e;
1087         }
1088         return checkSum;
1089     }
1090 
<span class="line-modified">1091     private void sortByInsertionSort(Object a) {</span>
<span class="line-modified">1092         if (a instanceof int[]) {</span>
<span class="line-modified">1093             sortByInsertionSort((int[]) a);</span>
<span class="line-modified">1094         } else if (a instanceof long[]) {</span>
<span class="line-modified">1095             sortByInsertionSort((long[]) a);</span>
<span class="line-modified">1096         } else if (a instanceof byte[]) {</span>
<span class="line-modified">1097             sortByInsertionSort((byte[]) a);</span>
<span class="line-modified">1098         } else if (a instanceof char[]) {</span>
<span class="line-modified">1099             sortByInsertionSort((char[]) a);</span>
<span class="line-modified">1100         } else if (a instanceof short[]) {</span>
<span class="line-modified">1101             sortByInsertionSort((short[]) a);</span>
<span class="line-modified">1102         } else if (a instanceof float[]) {</span>
<span class="line-modified">1103             sortByInsertionSort((float[]) a);</span>
<span class="line-modified">1104         } else if (a instanceof double[]) {</span>
<span class="line-modified">1105             sortByInsertionSort((double[]) a);</span>











1106         } else {
<span class="line-modified">1107             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>

1108         }
1109     }
1110 
<span class="line-modified">1111     private void sortByInsertionSort(int[] a) {</span>
1112         for (int j, i = 1; i &lt; a.length; i++) {
1113             int ai = a[i];
<span class="line-added">1114 </span>
1115             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1116                 a[j + 1] = a[j];
1117             }
1118             a[j + 1] = ai;
1119         }
1120     }
1121 
<span class="line-modified">1122     private void sortByInsertionSort(long[] a) {</span>
1123         for (int j, i = 1; i &lt; a.length; i++) {
1124             long ai = a[i];
<span class="line-added">1125 </span>
1126             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1127                 a[j + 1] = a[j];
1128             }
1129             a[j + 1] = ai;
1130         }
1131     }
1132 
<span class="line-modified">1133     private void sortByInsertionSort(byte[] a) {</span>
1134         for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">1135             byte ai = a[i];</span>
<span class="line-added">1136 </span>
1137             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1138                 a[j + 1] = a[j];
1139             }
1140             a[j + 1] = ai;
1141         }
1142     }
1143 
<span class="line-modified">1144     private void sortByInsertionSort(char[] a) {</span>
1145         for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">1146             char ai = a[i];</span>
<span class="line-added">1147 </span>
1148             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1149                 a[j + 1] = a[j];
1150             }
1151             a[j + 1] = ai;
1152         }
1153     }
1154 
<span class="line-modified">1155     private void sortByInsertionSort(short[] a) {</span>
1156         for (int j, i = 1; i &lt; a.length; i++) {
<span class="line-modified">1157             short ai = a[i];</span>
<span class="line-added">1158 </span>
1159             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1160                 a[j + 1] = a[j];
1161             }
1162             a[j + 1] = ai;
1163         }
1164     }
1165 
<span class="line-modified">1166     private void sortByInsertionSort(float[] a) {</span>
1167         for (int j, i = 1; i &lt; a.length; i++) {
1168             float ai = a[i];
<span class="line-added">1169 </span>
1170             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1171                 a[j + 1] = a[j];
1172             }
1173             a[j + 1] = ai;
1174         }
1175     }
1176 
<span class="line-modified">1177     private void sortByInsertionSort(double[] a) {</span>
1178         for (int j, i = 1; i &lt; a.length; i++) {
1179             double ai = a[i];






1180 



1181             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1182                 a[j + 1] = a[j];
1183             }
1184             a[j + 1] = ai;
1185         }
1186     }
1187 
<span class="line-modified">1188     private void checkSubArray(Object a, int fromIndex, int toIndex) {</span>
<span class="line-modified">1189         if (a instanceof int[]) {</span>
<span class="line-modified">1190             checkSubArray((int[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1191         } else if (a instanceof long[]) {</span>
<span class="line-modified">1192             checkSubArray((long[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1193         } else if (a instanceof byte[]) {</span>
<span class="line-modified">1194             checkSubArray((byte[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1195         } else if (a instanceof char[]) {</span>
<span class="line-modified">1196             checkSubArray((char[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1197         } else if (a instanceof short[]) {</span>
<span class="line-modified">1198             checkSubArray((short[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1199         } else if (a instanceof float[]) {</span>
<span class="line-modified">1200             checkSubArray((float[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1201         } else if (a instanceof double[]) {</span>
<span class="line-modified">1202             checkSubArray((double[]) a, fromIndex, toIndex);</span>


1203         } else {
<span class="line-modified">1204             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>















































1205         }
1206     }
1207 
<span class="line-modified">1208     private void checkSubArray(int[] a, int fromIndex, int toIndex) {</span>
1209         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1210             if (a[i] != A380) {</span>
<span class="line-modified">1211                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1212             }
1213         }
1214 
1215         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
<span class="line-modified">1216             if (a[i] &gt; a[i + 1]) {</span>
<span class="line-modified">1217                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1218             }
1219         }
1220 
1221         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1222             if (a[i] != B747) {</span>
<span class="line-modified">1223                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1224             }
1225         }
1226     }
1227 
<span class="line-modified">1228     private void checkSubArray(long[] a, int fromIndex, int toIndex) {</span>
1229         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1230             if (a[i] != (long) A380) {</span>
<span class="line-modified">1231                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1232             }
1233         }
1234 
1235         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1236             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1237                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1238             }
1239         }
1240 
1241         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1242             if (a[i] != (long) B747) {</span>
<span class="line-modified">1243                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1244             }
1245         }
1246     }
1247 
<span class="line-modified">1248     private void checkSubArray(byte[] a, int fromIndex, int toIndex) {</span>
1249         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1250             if (a[i] != (byte) A380) {</span>
<span class="line-modified">1251                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1252             }
1253         }
1254 
1255         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1256             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1257                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1258             }
1259         }
1260 
1261         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1262             if (a[i] != (byte) B747) {</span>
<span class="line-modified">1263                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1264             }
1265         }
1266     }
1267 
<span class="line-modified">1268     private void checkSubArray(char[] a, int fromIndex, int toIndex) {</span>
1269         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1270             if (a[i] != (char) A380) {</span>
<span class="line-modified">1271                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1272             }
1273         }
1274 
1275         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1276             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1277                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1278             }
1279         }
1280 
1281         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1282             if (a[i] != (char) B747) {</span>
<span class="line-modified">1283                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1284             }
1285         }
1286     }
1287 
<span class="line-modified">1288     private void checkSubArray(short[] a, int fromIndex, int toIndex) {</span>
1289         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1290             if (a[i] != (short) A380) {</span>
<span class="line-modified">1291                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1292             }
1293         }
1294 
1295         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1296             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1297                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1298             }
1299         }
1300 
1301         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1302             if (a[i] != (short) B747) {</span>
<span class="line-modified">1303                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1304             }
1305         }
1306     }
1307 
<span class="line-modified">1308     private void checkSubArray(float[] a, int fromIndex, int toIndex) {</span>
1309         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1310             if (a[i] != (float) A380) {</span>
<span class="line-modified">1311                 fail(&quot;Range sort changes left element at position &quot; + i + hex((long) a[i], A380));</span>

1312             }
1313         }
1314 
1315         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1316             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1317                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1318             }
1319         }
1320 
1321         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1322             if (a[i] != (float) B747) {</span>
<span class="line-modified">1323                 fail(&quot;Range sort changes right element at position &quot; + i + hex((long) a[i], B747));</span>

1324             }
1325         }
1326     }
1327 
<span class="line-modified">1328     private void checkSubArray(double[] a, int fromIndex, int toIndex) {</span>
1329         for (int i = 0; i &lt; fromIndex; i++) {
<span class="line-modified">1330             if (a[i] != (double) A380) {</span>
<span class="line-modified">1331                 fail(&quot;Range sort changes left element at position &quot; + i + hex((long) a[i], A380));</span>

1332             }
1333         }
1334 
1335         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1336             if (a[i] &gt; a[i + 1]) {
<span class="line-modified">1337                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1338             }
1339         }
1340 
1341         for (int i = toIndex; i &lt; a.length; i++) {
<span class="line-modified">1342             if (a[i] != (double) B747) {</span>
<span class="line-modified">1343                 fail(&quot;Range sort changes right element at position &quot; + i + hex((long) a[i], B747));</span>
<span class="line-modified">1344             }</span>
<span class="line-modified">1345         }</span>
<span class="line-added">1346     }</span>
<span class="line-added">1347 </span>
<span class="line-added">1348     private void checkRange(Object a, int m) {</span>
<span class="line-added">1349         if (a instanceof int[]) {</span>
<span class="line-added">1350             checkRange((int[]) a, m);</span>
<span class="line-added">1351         } else if (a instanceof long[]) {</span>
<span class="line-added">1352             checkRange((long[]) a, m);</span>
<span class="line-added">1353         } else if (a instanceof byte[]) {</span>
<span class="line-added">1354             checkRange((byte[]) a, m);</span>
<span class="line-added">1355         } else if (a instanceof char[]) {</span>
<span class="line-added">1356             checkRange((char[]) a, m);</span>
<span class="line-added">1357         } else if (a instanceof short[]) {</span>
<span class="line-added">1358             checkRange((short[]) a, m);</span>
<span class="line-added">1359         } else if (a instanceof float[]) {</span>
<span class="line-added">1360             checkRange((float[]) a, m);</span>
<span class="line-added">1361         } else if (a instanceof double[]) {</span>
<span class="line-added">1362             checkRange((double[]) a, m);</span>
<span class="line-added">1363         } else {</span>
<span class="line-added">1364             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
1365         }
1366     }
1367 
<span class="line-modified">1368     private void checkRange(int[] a, int m) {</span>
<span class="line-modified">1369         try {</span>
<span class="line-modified">1370             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">1371             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1372                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">1373         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1374             try {</span>
<span class="line-added">1375                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1376                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1377                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1378             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1379                 try {</span>
<span class="line-added">1380                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1381                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1382                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1383                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
1384             }
1385         }
<span class="line-added">1386     }</span>
1387 
<span class="line-modified">1388     private void checkRange(long[] a, int m) {</span>
<span class="line-modified">1389         try {</span>
<span class="line-modified">1390             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-added">1391             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-added">1392                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">1393         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1394             try {</span>
<span class="line-added">1395                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1396                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1397                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1398             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1399                 try {</span>
<span class="line-added">1400                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1401                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1402                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1403                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
1404             }
1405         }
<span class="line-added">1406     }</span>
1407 
<span class="line-modified">1408     private void checkRange(byte[] a, int m) {</span>
<span class="line-modified">1409         try {</span>
<span class="line-modified">1410             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">1411             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1412                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1413         } catch (IllegalArgumentException iae) {</span>
<span class="line-modified">1414             try {</span>
<span class="line-modified">1415                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-modified">1416                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1417                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-modified">1418             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-modified">1419                 try {</span>
<span class="line-modified">1420                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-modified">1421                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1422                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-modified">1423                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
<span class="line-modified">1424             }</span>











1425         }
1426     }
1427 
<span class="line-modified">1428     private void checkRange(char[] a, int m) {</span>
1429         try {
<span class="line-modified">1430             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">1431             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1432                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1433         } catch (IllegalArgumentException iae) {</span>



1434             try {
<span class="line-modified">1435                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-modified">1436                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1437                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-modified">1438             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1439                 try {</span>
<span class="line-added">1440                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1441                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1442                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1443                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
1444             }
<span class="line-modified">1445         }</span>
<span class="line-added">1446     }</span>
<span class="line-added">1447 </span>
<span class="line-added">1448     private void checkRange(short[] a, int m) {</span>
<span class="line-added">1449         try {</span>
<span class="line-added">1450             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-added">1451             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-added">1452                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">1453         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1454             try {</span>
<span class="line-added">1455                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1456                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1457                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1458             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
1459                 try {
<span class="line-modified">1460                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1461                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1462                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1463                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
<span class="line-added">1464             }</span>
<span class="line-added">1465         }</span>
<span class="line-added">1466     }</span>
1467 
<span class="line-modified">1468     private void checkRange(float[] a, int m) {</span>
<span class="line-modified">1469         try {</span>
<span class="line-modified">1470             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">1471             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1472                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1473         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1474             try {</span>
<span class="line-added">1475                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1476                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1477                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1478             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1479                 try {</span>
<span class="line-added">1480                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1481                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1482                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1483                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
1484             }
1485         }
1486     }
1487 
<span class="line-modified">1488     private void checkRange(double[] a, int m) {</span>
1489         try {
<span class="line-modified">1490             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-added">1491             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-added">1492                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">1493         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1494             try {</span>
<span class="line-added">1495                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1496                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1497                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1498             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1499                 try {</span>
<span class="line-added">1500                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1501                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1502                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1503                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
<span class="line-added">1504             }</span>
<span class="line-added">1505         }</span>
<span class="line-added">1506     }</span>
1507 
<span class="line-modified">1508     private void copy(Object dst, Object src) {</span>
<span class="line-modified">1509         if (src instanceof float[]) {</span>
<span class="line-modified">1510             copy((float[]) dst, (float[]) src);</span>
<span class="line-added">1511         } else if (src instanceof double[]) {</span>
<span class="line-added">1512             copy((double[]) dst, (double[]) src);</span>
<span class="line-added">1513         } else {</span>
<span class="line-added">1514             fail(&quot;Unknown type of array: &quot; + src.getClass().getName());</span>
1515         }
<span class="line-modified">1516     }</span>


1517 
<span class="line-modified">1518     private void copy(float[] dst, float[] src) {</span>
<span class="line-modified">1519         System.arraycopy(src, 0, dst, 0, src.length);</span>
<span class="line-modified">1520     }</span>
<span class="line-modified">1521 </span>
<span class="line-modified">1522     private void copy(double[] dst, double[] src) {</span>
<span class="line-modified">1523         System.arraycopy(src, 0, dst, 0, src.length);</span>
<span class="line-added">1524     }</span>
<span class="line-added">1525 </span>
<span class="line-added">1526     private void printTestName(String test, TestRandom random, int length) {</span>
<span class="line-added">1527         printTestName(test, random, length, &quot;&quot;);</span>
<span class="line-added">1528     }</span>
<span class="line-added">1529 </span>
<span class="line-added">1530     private void createData(int length) {</span>
<span class="line-added">1531         gold = new Object[] {</span>
<span class="line-added">1532             new int[length], new long[length],</span>
<span class="line-added">1533             new byte[length], new char[length], new short[length],</span>
<span class="line-added">1534             new float[length], new double[length]</span>
<span class="line-added">1535         };</span>
<span class="line-added">1536 </span>
<span class="line-added">1537         test = new Object[] {</span>
<span class="line-added">1538             new int[length], new long[length],</span>
<span class="line-added">1539             new byte[length], new char[length], new short[length],</span>
<span class="line-added">1540             new float[length], new double[length]</span>
<span class="line-added">1541         };</span>
<span class="line-added">1542     }</span>
<span class="line-added">1543 </span>
<span class="line-added">1544     private void convertData(int length) {</span>
<span class="line-added">1545         for (int i = 1; i &lt; gold.length; i++) {</span>
<span class="line-added">1546             TypeConverter converter = TypeConverter.values()[i - 1];</span>
<span class="line-added">1547             converter.convert((int[])gold[0], gold[i]);</span>
<span class="line-added">1548         }</span>
<span class="line-added">1549 </span>
<span class="line-added">1550         for (int i = 0; i &lt; gold.length; i++) {</span>
<span class="line-added">1551             System.arraycopy(gold[i], 0, test[i], 0, length);</span>
<span class="line-added">1552         }</span>
<span class="line-added">1553     }</span>
<span class="line-added">1554 </span>
<span class="line-added">1555     private String hex(long a, int b) {</span>
<span class="line-added">1556         return &quot;: &quot; + Long.toHexString(a) + &quot;, must be &quot; + Integer.toHexString(b);</span>
<span class="line-added">1557     }</span>
1558 
<span class="line-modified">1559     private void printTestName(String test, TestRandom random, int length, String message) {</span>
<span class="line-modified">1560         out.println( &quot;[&quot; + sortingHelper + &quot;] &#39;&quot; + test +</span>
<span class="line-added">1561             &quot;&#39; length = &quot; + length + &quot;, random = &quot; + random + message);</span>
<span class="line-added">1562     }</span>
<span class="line-added">1563 </span>
<span class="line-added">1564     private static enum TypeConverter {</span>
<span class="line-added">1565         LONG {</span>
<span class="line-added">1566             void convert(int[] src, Object dst) {</span>
<span class="line-added">1567                 long[] b = (long[]) dst;</span>
<span class="line-added">1568 </span>
<span class="line-added">1569                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">1570                     b[i] = (long) src[i];</span>
1571                 }
<span class="line-modified">1572             }</span>
<span class="line-modified">1573         },</span>
<span class="line-added">1574 </span>
<span class="line-added">1575         BYTE {</span>
<span class="line-added">1576             void convert(int[] src, Object dst) {</span>
<span class="line-added">1577                 byte[] b = (byte[]) dst;</span>
<span class="line-added">1578 </span>
<span class="line-added">1579                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">1580                     b[i] = (byte) src[i];</span>
1581                 }
1582             }
<span class="line-modified">1583         },</span>

1584 
<span class="line-modified">1585         CHAR {</span>
<span class="line-modified">1586             void convert(int[] src, Object dst) {</span>
<span class="line-modified">1587                 char[] b = (char[]) dst;</span>
1588 
<span class="line-modified">1589                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-modified">1590                     b[i] = (char) src[i];</span>
<span class="line-modified">1591                 }</span>
<span class="line-modified">1592             }</span>
<span class="line-modified">1593         },</span>
<span class="line-modified">1594 </span>
<span class="line-modified">1595         SHORT {</span>
<span class="line-added">1596             void convert(int[] src, Object dst) {</span>
<span class="line-added">1597                 short[] b = (short[]) dst;</span>
1598 
<span class="line-modified">1599                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-modified">1600                     b[i] = (short) src[i];</span>
<span class="line-added">1601                 }</span>
1602             }
<span class="line-modified">1603         },</span>


1604 
<span class="line-modified">1605         FLOAT {</span>
<span class="line-modified">1606             void convert(int[] src, Object dst) {</span>
<span class="line-added">1607                 float[] b = (float[]) dst;</span>
<span class="line-added">1608 </span>
<span class="line-added">1609                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">1610                     b[i] = (float) src[i];</span>
1611                 }
<span class="line-modified">1612             }</span>
<span class="line-modified">1613         },</span>
<span class="line-added">1614 </span>
<span class="line-added">1615         DOUBLE {</span>
<span class="line-added">1616             void convert(int[] src, Object dst) {</span>
<span class="line-added">1617                 double[] b = (double[]) dst;</span>
<span class="line-added">1618 </span>
<span class="line-added">1619                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">1620                     b[i] = (double) src[i];</span>
1621                 }
1622             }
<span class="line-modified">1623         };</span>
<span class="line-added">1624 </span>
<span class="line-added">1625         abstract void convert(int[] src, Object dst);</span>
1626     }
1627 
<span class="line-modified">1628     private static enum SortedBuilder {</span>
<span class="line-modified">1629         STEPS {</span>
<span class="line-modified">1630             void build(int[] a, int m) {</span>
<span class="line-added">1631                 for (int i = 0; i &lt; m; i++) {</span>
<span class="line-added">1632                     a[i] = 0;</span>
<span class="line-added">1633                 }</span>
1634 
<span class="line-modified">1635                 for (int i = m; i &lt; a.length; i++) {</span>
<span class="line-modified">1636                     a[i] = 1;</span>
<span class="line-modified">1637                 }</span>
<span class="line-modified">1638             }</span>
<span class="line-modified">1639         };</span>


1640 
<span class="line-modified">1641         abstract void build(int[] a, int m);</span>
<span class="line-modified">1642     }</span>
<span class="line-added">1643 </span>
<span class="line-added">1644     private static enum UnsortedBuilder {</span>
<span class="line-added">1645         RANDOM {</span>
<span class="line-added">1646             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1647                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1648                     a[i] = random.nextInt();</span>
<span class="line-added">1649                 }</span>
1650             }
<span class="line-modified">1651         },</span>


1652 
<span class="line-modified">1653         ASCENDING {</span>
<span class="line-modified">1654             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1655                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1656                     a[i] = m + i;</span>
1657                 }
<span class="line-modified">1658             }</span>
<span class="line-modified">1659         },</span>
<span class="line-added">1660 </span>
<span class="line-added">1661         DESCENDING {</span>
<span class="line-added">1662             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1663                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1664                     a[i] = a.length - m - i;</span>
1665                 }
1666             }
<span class="line-modified">1667         },</span>

1668 
<span class="line-modified">1669         EQUAL {</span>
<span class="line-modified">1670             void build(int[] a, int m, Random random) {</span>
<span class="line-modified">1671                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1672                     a[i] = m;</span>
<span class="line-added">1673                 }</span>
<span class="line-added">1674             }</span>
<span class="line-added">1675         },</span>
1676 
<span class="line-modified">1677         SAW {</span>
<span class="line-modified">1678             void build(int[] a, int m, Random random) {</span>
<span class="line-modified">1679                 int incCount = 1;</span>
<span class="line-modified">1680                 int decCount = a.length;</span>
<span class="line-modified">1681                 int i = 0;</span>
<span class="line-modified">1682                 int period = m--;</span>

1683 
<span class="line-modified">1684                 while (true) {</span>
<span class="line-modified">1685                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-added">1686                         if (i &gt;= a.length) {</span>
<span class="line-added">1687                             return;</span>
<span class="line-added">1688                         }</span>
<span class="line-added">1689                         a[i++] = incCount++;</span>
<span class="line-added">1690                     }</span>
<span class="line-added">1691                     period += m;</span>
<span class="line-added">1692 </span>
<span class="line-added">1693                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-added">1694                         if (i &gt;= a.length) {</span>
<span class="line-added">1695                             return;</span>
<span class="line-added">1696                         }</span>
<span class="line-added">1697                         a[i++] = decCount--;</span>
<span class="line-added">1698                     }</span>
<span class="line-added">1699                     period += m;</span>
<span class="line-added">1700                 }</span>
1701             }
<span class="line-modified">1702         },</span>


1703 
<span class="line-modified">1704         REPEATED {</span>
<span class="line-modified">1705             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1706                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1707                     a[i] = i % m;</span>
1708                 }
<span class="line-modified">1709             }</span>
<span class="line-modified">1710         },</span>
<span class="line-added">1711 </span>
<span class="line-added">1712         DUPLICATED {</span>
<span class="line-added">1713             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1714                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1715                     a[i] = random.nextInt(m);</span>
1716                 }
1717             }
<span class="line-modified">1718         },</span>

1719 
<span class="line-modified">1720         ORGAN_PIPES {</span>
<span class="line-modified">1721             void build(int[] a, int m, Random random) {</span>
<span class="line-modified">1722                 int middle = a.length / (m + 1);</span>
1723 
<span class="line-modified">1724                 for (int i = 0; i &lt; middle; i++) {</span>
<span class="line-modified">1725                     a[i] = i;</span>
<span class="line-modified">1726                 }</span>




1727 
<span class="line-modified">1728                 for (int i = middle; i &lt; a.length; i++) {</span>
<span class="line-modified">1729                     a[i] = a.length - i - 1;</span>
<span class="line-added">1730                 }</span>
1731             }
<span class="line-modified">1732         },</span>


1733 
<span class="line-modified">1734         STAGGER {</span>
<span class="line-modified">1735             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1736                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1737                     a[i] = (i * m + i) % a.length;</span>
1738                 }
<span class="line-modified">1739             }</span>
<span class="line-modified">1740         },</span>
<span class="line-added">1741 </span>
<span class="line-added">1742         PLATEAU {</span>
<span class="line-added">1743             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1744                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1745                     a[i] = Math.min(i, m);</span>
1746                 }
1747             }
<span class="line-modified">1748         },</span>
<span class="line-added">1749 </span>
<span class="line-added">1750         SHUFFLE {</span>
<span class="line-added">1751             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1752                 int x = 0, y = 0;</span>
<span class="line-added">1753 </span>
<span class="line-added">1754                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1755                     a[i] = random.nextBoolean() ? (x += 2) : (y += 2);</span>
<span class="line-added">1756                 }</span>
<span class="line-added">1757             }</span>
<span class="line-added">1758         },</span>
<span class="line-added">1759 </span>
<span class="line-added">1760         LATCH {</span>
<span class="line-added">1761             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1762                 int max = a.length / m;</span>
<span class="line-added">1763                 max = max &lt; 2 ? 2 : max;</span>
<span class="line-added">1764 </span>
<span class="line-added">1765                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1766                     a[i] = i % max;</span>
<span class="line-added">1767                 }</span>
<span class="line-added">1768             }</span>
<span class="line-added">1769         };</span>
<span class="line-added">1770 </span>
<span class="line-added">1771         abstract void build(int[] a, int m, Random random);</span>
1772     }
1773 
<span class="line-modified">1774     private static enum MergingBuilder {</span>
<span class="line-modified">1775         ASCENDING {</span>
<span class="line-modified">1776             void build(int[] a, int m) {</span>
<span class="line-added">1777                 int period = a.length / m;</span>
<span class="line-added">1778                 int v = 1, i = 0;</span>
1779 
<span class="line-modified">1780                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-modified">1781                     v = 1;</span>
<span class="line-modified">1782 </span>
<span class="line-modified">1783                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-modified">1784                         a[i++] = v++;</span>
<span class="line-modified">1785                     }</span>
<span class="line-modified">1786                 }</span>
1787 
<span class="line-modified">1788                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-modified">1789                     a[j] = v++;</span>
<span class="line-added">1790                 }</span>
<span class="line-added">1791 </span>
<span class="line-added">1792                 a[a.length - 1] = 0;</span>
1793             }
<span class="line-modified">1794         },</span>


1795 
<span class="line-modified">1796         DESCENDING {</span>
<span class="line-modified">1797             void build(int[] a, int m) {</span>
<span class="line-added">1798                 int period = a.length / m;</span>
<span class="line-added">1799                 int v = -1, i = 0;</span>
<span class="line-added">1800 </span>
<span class="line-added">1801                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-added">1802                     v = -1;</span>
<span class="line-added">1803 </span>
<span class="line-added">1804                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-added">1805                         a[i++] = v--;</span>
<span class="line-added">1806                     }</span>
1807                 }
<span class="line-modified">1808 </span>
<span class="line-modified">1809                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-added">1810                     a[j] = v--;</span>
1811                 }
<span class="line-added">1812 </span>
<span class="line-added">1813                 a[a.length - 1] = 0;</span>
1814             }
<span class="line-modified">1815         },</span>

1816 
<span class="line-modified">1817         POINT {</span>
<span class="line-modified">1818             void build(int[] a, int m) {</span>
<span class="line-modified">1819                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1820                     a[i] = 0;</span>
<span class="line-added">1821                 }</span>
<span class="line-added">1822                 a[a.length / 2] = m;</span>
<span class="line-added">1823             }</span>
<span class="line-added">1824         },</span>
1825 
<span class="line-modified">1826         LINE {</span>
<span class="line-modified">1827             void build(int[] a, int m) {</span>
<span class="line-modified">1828                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">1829                     a[i] = i;</span>
<span class="line-modified">1830                 }</span>
<span class="line-modified">1831                 reverse(a, 0, a.length - 1);</span>
<span class="line-modified">1832             }</span>
<span class="line-added">1833         },</span>
1834 
<span class="line-modified">1835         PEARL {</span>
<span class="line-modified">1836             void build(int[] a, int m) {</span>
<span class="line-added">1837                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1838                     a[i] = i;</span>
<span class="line-added">1839                 }</span>
<span class="line-added">1840                 reverse(a, 0, 2);</span>
1841             }
<span class="line-modified">1842         },</span>
<span class="line-modified">1843 </span>
<span class="line-modified">1844         RING {</span>
<span class="line-added">1845             void build(int[] a, int m) {</span>
<span class="line-added">1846                 int k1 = a.length / 3;</span>
<span class="line-added">1847                 int k2 = a.length / 3 * 2;</span>
<span class="line-added">1848                 int level = a.length / 3;</span>
1849 
<span class="line-modified">1850                 for (int i = 0, k = level; i &lt; k1; i++) {</span>
<span class="line-modified">1851                     a[i] = k--;</span>
1852                 }
<span class="line-modified">1853 </span>
<span class="line-modified">1854                 for (int i = k1; i &lt; k2; i++) {</span>
<span class="line-added">1855                     a[i] = 0;</span>
<span class="line-added">1856                 }</span>
<span class="line-added">1857 </span>
<span class="line-added">1858                 for (int i = k2, k = level; i &lt; a.length; i++) {</span>
<span class="line-added">1859                     a[i] = k--;</span>
1860                 }
1861             }
<span class="line-added">1862         };</span>
<span class="line-added">1863 </span>
<span class="line-added">1864         abstract void build(int[] a, int m);</span>
<span class="line-added">1865 </span>
<span class="line-added">1866         private static void reverse(int[] a, int lo, int hi) {</span>
<span class="line-added">1867             for (--hi; lo &lt; hi; ) {</span>
<span class="line-added">1868                 int tmp = a[lo];</span>
<span class="line-added">1869                 a[lo++] = a[hi];</span>
<span class="line-added">1870                 a[hi--] = tmp;</span>
<span class="line-added">1871             }</span>
1872         }
1873     }
1874 
<span class="line-modified">1875     private static enum NegativeZeroBuilder {</span>
<span class="line-modified">1876         FLOAT {</span>
<span class="line-modified">1877             void build(Object o, Random random) {</span>
<span class="line-modified">1878                 float[] a = (float[]) o;</span>
<span class="line-modified">1879 </span>
<span class="line-added">1880                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1881                     a[i] = random.nextBoolean() ? -0.0f : 0.0f;</span>
<span class="line-added">1882                 }</span>
<span class="line-added">1883             }</span>
<span class="line-added">1884         },</span>
<span class="line-added">1885 </span>
<span class="line-added">1886         DOUBLE {</span>
<span class="line-added">1887             void build(Object o, Random random) {</span>
<span class="line-added">1888                 double[] a = (double[]) o;</span>
<span class="line-added">1889 </span>
<span class="line-added">1890                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1891                     a[i] = random.nextBoolean() ? -0.0d : 0.0d;</span>
<span class="line-added">1892                 }</span>
<span class="line-added">1893             }</span>
<span class="line-added">1894         };</span>
<span class="line-added">1895 </span>
<span class="line-added">1896         abstract void build(Object o, Random random);</span>
1897     }
1898 
<span class="line-modified">1899     private static enum FloatingPointBuilder {</span>
<span class="line-modified">1900         FLOAT {</span>
<span class="line-modified">1901             void build(Object o, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-added">1902                 float negativeValue = -random.nextFloat();</span>
<span class="line-added">1903                 float positiveValue =  random.nextFloat();</span>
<span class="line-added">1904                 float[] x = (float[]) o;</span>
<span class="line-added">1905                 int fromIndex = 0;</span>
<span class="line-added">1906 </span>
<span class="line-added">1907                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-added">1908                 fromIndex += n;</span>
<span class="line-added">1909 </span>
<span class="line-added">1910                 writeValue(x, -0.0f, fromIndex, g);</span>
<span class="line-added">1911                 fromIndex += g;</span>
<span class="line-added">1912 </span>
<span class="line-added">1913                 writeValue(x, 0.0f, fromIndex, z);</span>
<span class="line-added">1914                 fromIndex += z;</span>
<span class="line-added">1915 </span>
<span class="line-added">1916                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-added">1917                 fromIndex += p;</span>
<span class="line-added">1918 </span>
<span class="line-added">1919                 writeValue(x, Float.NaN, fromIndex, a);</span>
<span class="line-added">1920             }</span>
<span class="line-added">1921         },</span>
<span class="line-added">1922 </span>
<span class="line-added">1923         DOUBLE {</span>
<span class="line-added">1924             void build(Object o, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-added">1925                 double negativeValue = -random.nextFloat();</span>
<span class="line-added">1926                 double positiveValue =  random.nextFloat();</span>
<span class="line-added">1927                 double[] x = (double[]) o;</span>
<span class="line-added">1928                 int fromIndex = 0;</span>
<span class="line-added">1929 </span>
<span class="line-added">1930                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-added">1931                 fromIndex += n;</span>
<span class="line-added">1932 </span>
<span class="line-added">1933                 writeValue(x, -0.0d, fromIndex, g);</span>
<span class="line-added">1934                 fromIndex += g;</span>
<span class="line-added">1935 </span>
<span class="line-added">1936                 writeValue(x, 0.0d, fromIndex, z);</span>
<span class="line-added">1937                 fromIndex += z;</span>
<span class="line-added">1938 </span>
<span class="line-added">1939                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-added">1940                 fromIndex += p;</span>
<span class="line-added">1941 </span>
<span class="line-added">1942                 writeValue(x, Double.NaN, fromIndex, a);</span>
<span class="line-added">1943             }</span>
<span class="line-added">1944         };</span>
<span class="line-added">1945 </span>
<span class="line-added">1946         abstract void build(Object o, int a, int g, int z, int n, int p, Random random);</span>
<span class="line-added">1947 </span>
<span class="line-added">1948         private static void writeValue(float[] a, float value, int fromIndex, int count) {</span>
<span class="line-added">1949             for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-added">1950                 a[i] = value;</span>
<span class="line-added">1951             }</span>
1952         }


1953 
<span class="line-modified">1954         private static void writeValue(double[] a, double value, int fromIndex, int count) {</span>
<span class="line-modified">1955             for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-modified">1956                 a[i] = value;</span>
<span class="line-added">1957             }</span>
1958         }

1959     }
1960 
<span class="line-modified">1961     private static Comparator&lt;Pair&gt; pairComparator = new Comparator&lt;Pair&gt;() {</span>
<span class="line-modified">1962 </span>
<span class="line-modified">1963         @Override</span>
<span class="line-added">1964         public int compare(Pair p1, Pair p2) {</span>
<span class="line-added">1965             return p1.compareTo(p2);</span>
1966         }
<span class="line-modified">1967     };</span>
<span class="line-added">1968 </span>
<span class="line-added">1969     private static class Pair implements Comparable&lt;Pair&gt; {</span>
<span class="line-added">1970 </span>
<span class="line-added">1971         private Pair(int key, int value) {</span>
<span class="line-added">1972             this.key = key;</span>
<span class="line-added">1973             this.value = value;</span>
<span class="line-added">1974         }</span>
<span class="line-added">1975 </span>
<span class="line-added">1976         int getKey() {</span>
<span class="line-added">1977             return key;</span>
<span class="line-added">1978         }</span>
<span class="line-added">1979 </span>
<span class="line-added">1980         int getValue() {</span>
<span class="line-added">1981             return value;</span>
<span class="line-added">1982         }</span>
<span class="line-added">1983 </span>
<span class="line-added">1984         @Override</span>
<span class="line-added">1985         public int compareTo(Pair pair) {</span>
<span class="line-added">1986             return Integer.compare(key, pair.key);</span>
<span class="line-added">1987         }</span>
<span class="line-added">1988 </span>
<span class="line-added">1989         @Override</span>
<span class="line-added">1990         public String toString() {</span>
<span class="line-added">1991             return &quot;(&quot; + key + &quot;, &quot; + value + &quot;)&quot;;</span>
<span class="line-added">1992         }</span>
<span class="line-added">1993 </span>
<span class="line-added">1994         private int key;</span>
<span class="line-added">1995         private int value;</span>
1996     }
1997 
<span class="line-modified">1998     private static class TestRandom extends Random {</span>
<span class="line-modified">1999 </span>
<span class="line-added">2000         private static final TestRandom BABA = new TestRandom(0xBABA);</span>
<span class="line-added">2001         private static final TestRandom DEDA = new TestRandom(0xDEDA);</span>
<span class="line-added">2002         private static final TestRandom C0FFEE = new TestRandom(0xC0FFEE);</span>
<span class="line-added">2003 </span>
<span class="line-added">2004         private TestRandom(long seed) {</span>
2005             super(seed);
<span class="line-modified">2006             this.seed = Long.toHexString(seed).toUpperCase();</span>
2007         }
2008 
<span class="line-modified">2009         @Override</span>
<span class="line-modified">2010         public String toString() {</span>
<span class="line-added">2011             return seed;</span>
2012         }
2013 
<span class="line-modified">2014         private String seed;</span>
2015     }


2016 }
</pre>
</td>
</tr>
</table>
<center><a href="../../time/test/java/time/format/TestUnicodeExtension.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TimSortStackSize2.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>