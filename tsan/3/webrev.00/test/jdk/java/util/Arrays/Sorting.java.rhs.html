<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/util/Arrays/Sorting.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
<a name="1" id="anc1"></a><span class="line-modified">   2  * Copyright (c) 2009, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 /*
  25  * @test
<a name="2" id="anc2"></a><span class="line-modified">  26  * @compile/module=java.base java/util/SortingHelper.java</span>
<span class="line-modified">  27  * @bug 6880672 6896573 6899694 6976036 7013585 7018258 8003981 8226297</span>
  28  * @build Sorting
  29  * @run main Sorting -shortrun
<a name="3" id="anc3"></a><span class="line-added">  30  * @summary Exercise Arrays.sort, Arrays.parallelSort</span>
  31  *
  32  * @author Vladimir Yaroslavskiy
  33  * @author Jon Bentley
  34  * @author Josh Bloch
  35  */
  36 
<a name="4" id="anc4"></a>

  37 import java.io.PrintStream;
<a name="5" id="anc5"></a><span class="line-added">  38 import java.util.Comparator;</span>
<span class="line-added">  39 import java.util.Random;</span>
<span class="line-added">  40 import java.util.SortingHelper;</span>
  41 
  42 public class Sorting {
<a name="6" id="anc6"></a><span class="line-added">  43 </span>
  44     private static final PrintStream out = System.out;
  45     private static final PrintStream err = System.err;
  46 
  47     // Array lengths used in a long run (default)
  48     private static final int[] LONG_RUN_LENGTHS = {
<a name="7" id="anc7"></a><span class="line-modified">  49         1, 3, 8, 21, 55, 100, 1_000, 10_000, 100_000 };</span>
  50 
  51     // Array lengths used in a short run
  52     private static final int[] SHORT_RUN_LENGTHS = {
<a name="8" id="anc8"></a><span class="line-modified">  53         1, 8, 55, 100, 10_000 };</span>
  54 
  55     // Random initial values used in a long run (default)
<a name="9" id="anc9"></a><span class="line-modified">  56     private static final TestRandom[] LONG_RUN_RANDOMS = {</span>
<span class="line-added">  57         TestRandom.BABA, TestRandom.DEDA, TestRandom.C0FFEE };</span>
  58 
  59     // Random initial values used in a short run
<a name="10" id="anc10"></a><span class="line-modified">  60     private static final TestRandom[] SHORT_RUN_RANDOMS = {</span>
<span class="line-added">  61         TestRandom.C0FFEE };</span>
<span class="line-added">  62 </span>
<span class="line-added">  63     // Constants used in subarray sorting</span>
<span class="line-added">  64     private static final int A380 = 0xA380;</span>
<span class="line-added">  65     private static final int B747 = 0xB747;</span>
<span class="line-added">  66 </span>
<span class="line-added">  67     private final SortingHelper sortingHelper;</span>
<span class="line-added">  68     private final TestRandom[] randoms;</span>
<span class="line-added">  69     private final int[] lengths;</span>
<span class="line-added">  70     private Object[] gold;</span>
<span class="line-added">  71     private Object[] test;</span>
  72 
  73     public static void main(String[] args) {
<a name="11" id="anc11"></a>
  74         long start = System.currentTimeMillis();
<a name="12" id="anc12"></a><span class="line-added">  75         boolean shortRun = args.length &gt; 0 &amp;&amp; args[0].equals(&quot;-shortrun&quot;);</span>
<span class="line-added">  76 </span>
<span class="line-added">  77         int[] lengths = shortRun ? SHORT_RUN_LENGTHS : LONG_RUN_LENGTHS;</span>
<span class="line-added">  78         TestRandom[] randoms = shortRun ? SHORT_RUN_RANDOMS : LONG_RUN_RANDOMS;</span>
<span class="line-added">  79 </span>
<span class="line-added">  80         new Sorting(SortingHelper.DUAL_PIVOT_QUICKSORT, randoms, lengths).testCore();</span>
<span class="line-added">  81         new Sorting(SortingHelper.PARALLEL_SORT, randoms, lengths).testCore();</span>
<span class="line-added">  82         new Sorting(SortingHelper.HEAP_SORT, randoms, lengths).testBasic();</span>
<span class="line-added">  83         new Sorting(SortingHelper.ARRAYS_SORT, randoms, lengths).testAll();</span>
<span class="line-added">  84         new Sorting(SortingHelper.ARRAYS_PARALLEL_SORT, randoms, lengths).testAll();</span>
  85 
<a name="13" id="anc13"></a>




  86         long end = System.currentTimeMillis();
<a name="14" id="anc14"></a><span class="line-added">  87         out.format(&quot;PASSED in %d sec.\n&quot;, (end - start) / 1000);</span>
<span class="line-added">  88     }</span>
<span class="line-added">  89 </span>
<span class="line-added">  90     private Sorting(SortingHelper sortingHelper, TestRandom[] randoms, int[] lengths) {</span>
<span class="line-added">  91         this.sortingHelper = sortingHelper;</span>
<span class="line-added">  92         this.randoms = randoms;</span>
<span class="line-added">  93         this.lengths = lengths;</span>
<span class="line-added">  94     }</span>
<span class="line-added">  95 </span>
<span class="line-added">  96     private void testBasic() {</span>
<span class="line-added">  97         testEmptyArray();</span>
<span class="line-added">  98 </span>
<span class="line-added">  99         for (int length : lengths) {</span>
<span class="line-added"> 100             createData(length);</span>
<span class="line-added"> 101             testBasic(length);</span>
<span class="line-added"> 102         }</span>
<span class="line-added"> 103     }</span>
<span class="line-added"> 104 </span>
<span class="line-added"> 105     private void testBasic(int length) {</span>
<span class="line-added"> 106         for (TestRandom random : randoms) {</span>
<span class="line-added"> 107             testWithInsertionSort(length, random);</span>
<span class="line-added"> 108             testWithCheckSum(length, random);</span>
<span class="line-added"> 109             testWithScrambling(length, random);</span>
<span class="line-added"> 110         }</span>
<span class="line-added"> 111     }</span>
<span class="line-added"> 112 </span>
<span class="line-added"> 113     private void testCore() {</span>
<span class="line-added"> 114         for (int length : lengths) {</span>
<span class="line-added"> 115             createData(length);</span>
<span class="line-added"> 116             testCore(length);</span>
<span class="line-added"> 117         }</span>
<span class="line-added"> 118     }</span>
<span class="line-added"> 119 </span>
<span class="line-added"> 120     private void testCore(int length) {</span>
<span class="line-added"> 121         testBasic(length);</span>
<span class="line-added"> 122 </span>
<span class="line-added"> 123         for (TestRandom random : randoms) {</span>
<span class="line-added"> 124             testMergingSort(length, random);</span>
<span class="line-added"> 125             testSubArray(length, random);</span>
<span class="line-added"> 126             testNegativeZero(length, random);</span>
<span class="line-added"> 127             testFloatingPointSorting(length, random);</span>
<span class="line-added"> 128         }</span>
<span class="line-added"> 129     }</span>
<span class="line-added"> 130 </span>
<span class="line-added"> 131     private void testAll() {</span>
<span class="line-added"> 132         for (int length : lengths) {</span>
<span class="line-added"> 133             createData(length);</span>
<span class="line-added"> 134             testAll(length);</span>
<span class="line-added"> 135         }</span>
<span class="line-added"> 136     }</span>
 137 
<a name="15" id="anc15"></a><span class="line-modified"> 138     private void testAll(int length) {</span>
<span class="line-added"> 139         testCore(length);</span>
<span class="line-added"> 140 </span>
<span class="line-added"> 141         for (TestRandom random : randoms) {</span>
<span class="line-added"> 142             testRange(length, random);</span>
<span class="line-added"> 143             testStability(length, random);</span>
<span class="line-added"> 144         }</span>
 145     }
 146 
<a name="16" id="anc16"></a><span class="line-modified"> 147     private void testEmptyArray() {</span>
 148         testEmptyAndNullIntArray();
 149         testEmptyAndNullLongArray();
<a name="17" id="anc17"></a>

 150         testEmptyAndNullByteArray();
<a name="18" id="anc18"></a><span class="line-added"> 151         testEmptyAndNullCharArray();</span>
<span class="line-added"> 152         testEmptyAndNullShortArray();</span>
 153         testEmptyAndNullFloatArray();
 154         testEmptyAndNullDoubleArray();
<a name="19" id="anc19"></a><span class="line-added"> 155     }</span>
 156 
<a name="20" id="anc20"></a><span class="line-modified"> 157     private void testStability(int length, TestRandom random) {</span>
<span class="line-modified"> 158         printTestName(&quot;Test stability&quot;, random, length);</span>
<span class="line-modified"> 159 </span>
<span class="line-modified"> 160         Pair[] a = build(length, random);</span>
<span class="line-modified"> 161         sortingHelper.sort(a);</span>
<span class="line-modified"> 162         checkSorted(a);</span>
<span class="line-modified"> 163         checkStable(a);</span>
<span class="line-modified"> 164 </span>
<span class="line-modified"> 165         a = build(length, random);</span>
<span class="line-modified"> 166         sortingHelper.sort(a, pairComparator);</span>
<span class="line-modified"> 167         checkSorted(a);</span>
<span class="line-modified"> 168         checkStable(a);</span>
<span class="line-modified"> 169 </span>
<span class="line-modified"> 170         out.println();</span>

 171     }
 172 
<a name="21" id="anc21"></a><span class="line-modified"> 173     private void testEmptyAndNullIntArray() {</span>
<span class="line-modified"> 174         sortingHelper.sort(new int[] {});</span>
<span class="line-modified"> 175         sortingHelper.sort(new int[] {}, 0, 0);</span>

 176 
 177         try {
<a name="22" id="anc22"></a><span class="line-modified"> 178             sortingHelper.sort(null);</span>
 179         } catch (NullPointerException expected) {
 180             try {
<a name="23" id="anc23"></a><span class="line-modified"> 181                 sortingHelper.sort(null, 0, 0);</span>
 182             } catch (NullPointerException expected2) {
 183                 return;
 184             }
<a name="24" id="anc24"></a><span class="line-modified"> 185             fail(sortingHelper + &quot;(int[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 186                 &quot;catch null array&quot;);
 187         }
<a name="25" id="anc25"></a><span class="line-modified"> 188         fail(sortingHelper + &quot;(int[]) shouldn&#39;t catch null array&quot;);</span>
 189     }
 190 
<a name="26" id="anc26"></a><span class="line-modified"> 191     private void testEmptyAndNullLongArray() {</span>
<span class="line-modified"> 192         sortingHelper.sort(new long[] {});</span>
<span class="line-modified"> 193         sortingHelper.sort(new long[] {}, 0, 0);</span>

 194 
 195         try {
<a name="27" id="anc27"></a><span class="line-modified"> 196             sortingHelper.sort(null);</span>
 197         } catch (NullPointerException expected) {
 198             try {
<a name="28" id="anc28"></a><span class="line-modified"> 199                 sortingHelper.sort(null, 0, 0);</span>
 200             } catch (NullPointerException expected2) {
 201                 return;
 202             }
<a name="29" id="anc29"></a><span class="line-modified"> 203             fail(sortingHelper + &quot;(long[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 204                 &quot;catch null array&quot;);
 205         }
<a name="30" id="anc30"></a><span class="line-modified"> 206         fail(sortingHelper + &quot;(long[]) shouldn&#39;t catch null array&quot;);</span>
 207     }
 208 
<a name="31" id="anc31"></a><span class="line-modified"> 209     private void testEmptyAndNullByteArray() {</span>
<span class="line-modified"> 210         sortingHelper.sort(new byte[] {});</span>
<span class="line-modified"> 211         sortingHelper.sort(new byte[] {}, 0, 0);</span>

 212 
 213         try {
<a name="32" id="anc32"></a><span class="line-modified"> 214             sortingHelper.sort(null);</span>
 215         } catch (NullPointerException expected) {
 216             try {
<a name="33" id="anc33"></a><span class="line-modified"> 217                 sortingHelper.sort(null, 0, 0);</span>
 218             } catch (NullPointerException expected2) {
 219                 return;
 220             }
<a name="34" id="anc34"></a><span class="line-modified"> 221             fail(sortingHelper + &quot;(byte[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 222                 &quot;catch null array&quot;);
 223         }
<a name="35" id="anc35"></a><span class="line-modified"> 224         fail(sortingHelper + &quot;(byte[]) shouldn&#39;t catch null array&quot;);</span>
 225     }
 226 
<a name="36" id="anc36"></a><span class="line-modified"> 227     private void testEmptyAndNullCharArray() {</span>
<span class="line-modified"> 228         sortingHelper.sort(new char[] {});</span>
<span class="line-modified"> 229         sortingHelper.sort(new char[] {}, 0, 0);</span>

 230 
 231         try {
<a name="37" id="anc37"></a><span class="line-modified"> 232             sortingHelper.sort(null);</span>
 233         } catch (NullPointerException expected) {
 234             try {
<a name="38" id="anc38"></a><span class="line-modified"> 235                 sortingHelper.sort(null, 0, 0);</span>
 236             } catch (NullPointerException expected2) {
 237                 return;
 238             }
<a name="39" id="anc39"></a><span class="line-modified"> 239             fail(sortingHelper + &quot;(char[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 240                 &quot;catch null array&quot;);
 241         }
<a name="40" id="anc40"></a><span class="line-modified"> 242         fail(sortingHelper + &quot;(char[]) shouldn&#39;t catch null array&quot;);</span>
 243     }
 244 
<a name="41" id="anc41"></a><span class="line-modified"> 245     private void testEmptyAndNullShortArray() {</span>
<span class="line-modified"> 246         sortingHelper.sort(new short[] {});</span>
<span class="line-modified"> 247         sortingHelper.sort(new short[] {}, 0, 0);</span>

 248 
 249         try {
<a name="42" id="anc42"></a><span class="line-modified"> 250             sortingHelper.sort(null);</span>
 251         } catch (NullPointerException expected) {
 252             try {
<a name="43" id="anc43"></a><span class="line-modified"> 253                 sortingHelper.sort(null, 0, 0);</span>
 254             } catch (NullPointerException expected2) {
 255                 return;
 256             }
<a name="44" id="anc44"></a><span class="line-modified"> 257             fail(sortingHelper + &quot;(short[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 258                 &quot;catch null array&quot;);
 259         }
<a name="45" id="anc45"></a><span class="line-modified"> 260         fail(sortingHelper + &quot;(short[]) shouldn&#39;t catch null array&quot;);</span>
 261     }
 262 
<a name="46" id="anc46"></a><span class="line-modified"> 263     private void testEmptyAndNullFloatArray() {</span>
<span class="line-modified"> 264         sortingHelper.sort(new float[] {});</span>
<span class="line-modified"> 265         sortingHelper.sort(new float[] {}, 0, 0);</span>

 266 
 267         try {
<a name="47" id="anc47"></a><span class="line-modified"> 268             sortingHelper.sort(null);</span>
 269         } catch (NullPointerException expected) {
 270             try {
<a name="48" id="anc48"></a><span class="line-modified"> 271                 sortingHelper.sort(null, 0, 0);</span>
 272             } catch (NullPointerException expected2) {
 273                 return;
 274             }
<a name="49" id="anc49"></a><span class="line-modified"> 275             fail(sortingHelper + &quot;(float[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 276                 &quot;catch null array&quot;);
 277         }
<a name="50" id="anc50"></a><span class="line-modified"> 278         fail(sortingHelper + &quot;(float[]) shouldn&#39;t catch null array&quot;);</span>
 279     }
 280 
<a name="51" id="anc51"></a><span class="line-modified"> 281     private void testEmptyAndNullDoubleArray() {</span>
<span class="line-modified"> 282         sortingHelper.sort(new double[] {});</span>
<span class="line-modified"> 283         sortingHelper.sort(new double[] {}, 0, 0);</span>

 284 
 285         try {
<a name="52" id="anc52"></a><span class="line-modified"> 286             sortingHelper.sort(null);</span>
 287         } catch (NullPointerException expected) {
 288             try {
<a name="53" id="anc53"></a><span class="line-modified"> 289                 sortingHelper.sort(null, 0, 0);</span>
 290             } catch (NullPointerException expected2) {
 291                 return;
 292             }
<a name="54" id="anc54"></a><span class="line-modified"> 293             fail(sortingHelper + &quot;(double[],fromIndex,toIndex) shouldn&#39;t &quot; +</span>
 294                 &quot;catch null array&quot;);
 295         }
<a name="55" id="anc55"></a><span class="line-modified"> 296         fail(sortingHelper + &quot;(double[]) shouldn&#39;t catch null array&quot;);</span>
 297     }
 298 
<a name="56" id="anc56"></a><span class="line-modified"> 299     private void testSubArray(int length, TestRandom random) {</span>
<span class="line-modified"> 300         if (length &lt; 4) {</span>
<span class="line-modified"> 301             return;</span>
<span class="line-modified"> 302         }</span>
<span class="line-modified"> 303         for (int m = 1; m &lt; length / 2; m &lt;&lt;= 1) {</span>


 304             int fromIndex = m;
 305             int toIndex = length - m;
 306 
<a name="57" id="anc57"></a><span class="line-modified"> 307             prepareSubArray((int[]) gold[0], fromIndex, toIndex);</span>
<span class="line-modified"> 308             convertData(length);</span>
 309 
<a name="58" id="anc58"></a><span class="line-modified"> 310             for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 311                 printTestName(&quot;Test subarray&quot;, random, length,</span>
<span class="line-modified"> 312                     &quot;, m = &quot; + m + &quot;, &quot; + getType(i));</span>
<span class="line-modified"> 313                 sortingHelper.sort(test[i], fromIndex, toIndex);</span>
<span class="line-modified"> 314                 checkSubArray(test[i], fromIndex, toIndex);</span>


 315             }
 316         }
<a name="59" id="anc59"></a><span class="line-modified"> 317         out.println();</span>


 318     }
 319 
<a name="60" id="anc60"></a><span class="line-modified"> 320     private void testRange(int length, TestRandom random) {</span>
<span class="line-modified"> 321         if (length &lt; 2) {</span>
<span class="line-modified"> 322             return;</span>
<span class="line-modified"> 323         }</span>
<span class="line-modified"> 324         for (int m = 1; m &lt; length; m &lt;&lt;= 1) {</span>
 325             for (int i = 1; i &lt;= length; i++) {
<a name="61" id="anc61"></a><span class="line-modified"> 326                 ((int[]) gold[0]) [i - 1] = i % m + m % i;</span>
 327             }
<a name="62" id="anc62"></a><span class="line-modified"> 328             convertData(length);</span>
<span class="line-modified"> 329 </span>
<span class="line-modified"> 330             for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 331                 printTestName(&quot;Test range check&quot;, random, length,</span>
<span class="line-modified"> 332                     &quot;, m = &quot; + m + &quot;, &quot; + getType(i));</span>
<span class="line-added"> 333                 checkRange(test[i], m);</span>
 334             }
 335         }
 336         out.println();
 337     }
 338 
<a name="63" id="anc63"></a><span class="line-modified"> 339     private void checkSorted(Pair[] a) {</span>












 340         for (int i = 0; i &lt; a.length - 1; i++) {
 341             if (a[i].getKey() &gt; a[i + 1].getKey()) {
<a name="64" id="anc64"></a><span class="line-modified"> 342                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; +</span>
<span class="line-added"> 343                     a[i].getKey() + &quot; and &quot; + a[i + 1].getKey());</span>
 344             }
 345         }
 346     }
 347 
<a name="65" id="anc65"></a><span class="line-modified"> 348     private void checkStable(Pair[] a) {</span>
 349         for (int i = 0; i &lt; a.length / 4; ) {
 350             int key1 = a[i].getKey();
 351             int value1 = a[i++].getValue();
 352             int key2 = a[i].getKey();
 353             int value2 = a[i++].getValue();
 354             int key3 = a[i].getKey();
 355             int value3 = a[i++].getValue();
 356             int key4 = a[i].getKey();
 357             int value4 = a[i++].getValue();
 358 
 359             if (!(key1 == key2 &amp;&amp; key2 == key3 &amp;&amp; key3 == key4)) {
<a name="66" id="anc66"></a><span class="line-modified"> 360                 fail(&quot;Keys are different &quot; + key1 + &quot;, &quot; + key2 + &quot;, &quot; +</span>
<span class="line-modified"> 361                     key3 + &quot;, &quot; + key4 + &quot; at position &quot; + i);</span>
 362             }
 363             if (!(value1 &lt; value2 &amp;&amp; value2 &lt; value3 &amp;&amp; value3 &lt; value4)) {
<a name="67" id="anc67"></a><span class="line-modified"> 364                 fail(&quot;Sorting is not stable at position &quot; + i +</span>
<span class="line-modified"> 365                     &quot;. Second values have been changed: &quot; + value1 + &quot;, &quot; +</span>
 366                     value2 + &quot;, &quot; + value3 + &quot;, &quot; + value4);
 367             }
 368         }
 369     }
 370 
<a name="68" id="anc68"></a><span class="line-modified"> 371     private Pair[] build(int length, Random random) {</span>
 372         Pair[] a = new Pair[length * 4];
 373 
 374         for (int i = 0; i &lt; a.length; ) {
 375             int key = random.nextInt();
 376             a[i++] = new Pair(key, 1);
 377             a[i++] = new Pair(key, 2);
 378             a[i++] = new Pair(key, 3);
 379             a[i++] = new Pair(key, 4);
 380         }
 381         return a;
 382     }
 383 
<a name="69" id="anc69"></a><span class="line-modified"> 384     private void testWithInsertionSort(int length, TestRandom random) {</span>


































 385         if (length &gt; 1000) {
 386             return;
 387         }
<a name="70" id="anc70"></a><span class="line-modified"> 388         for (int m = 1; m &lt;= length; m &lt;&lt;= 1) {</span>



 389             for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<a name="71" id="anc71"></a><span class="line-modified"> 390                 builder.build((int[]) gold[0], m, random);</span>
<span class="line-modified"> 391                 convertData(length);</span>
<span class="line-modified"> 392 </span>
<span class="line-modified"> 393                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 394                     printTestName(&quot;Test with insertion sort&quot;, random, length,</span>
<span class="line-modified"> 395                         &quot;, m = &quot; + m + &quot;, &quot; + getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified"> 396                     sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 397                     sortByInsertionSort(gold[i]);</span>
<span class="line-modified"> 398                     compare(test[i], gold[i]);</span>




 399                 }
 400             }
 401         }
 402         out.println();
 403     }
 404 
<a name="72" id="anc72"></a><span class="line-modified"> 405     private void testMergingSort(int length, TestRandom random) {</span>
<span class="line-modified"> 406         if (length &lt; (4 &lt;&lt; 10)) { // DualPivotQuicksort.MIN_TRY_MERGE_SIZE</span>
 407             return;
 408         }
<a name="73" id="anc73"></a><span class="line-modified"> 409         final int PERIOD = 50;</span>
<span class="line-modified"> 410 </span>
<span class="line-modified"> 411         for (int m = PERIOD - 2; m &lt;= PERIOD + 2; m++) {</span>
<span class="line-modified"> 412             for (MergingBuilder builder : MergingBuilder.values()) {</span>
<span class="line-modified"> 413                 builder.build((int[]) gold[0], m);</span>
<span class="line-modified"> 414                 convertData(length);</span>
<span class="line-modified"> 415 </span>
<span class="line-modified"> 416                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 417                     printTestName(&quot;Test merging sort&quot;, random, length,</span>
<span class="line-modified"> 418                         &quot;, m = &quot; + m + &quot;, &quot; +  getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified"> 419                     sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 420                     checkSorted(test[i]);</span>



 421                 }
 422             }
 423         }
 424         out.println();
 425     }
 426 
<a name="74" id="anc74"></a><span class="line-modified"> 427     private void testWithCheckSum(int length, TestRandom random) {</span>
<span class="line-modified"> 428         for (int m = 1; m &lt;= length; m &lt;&lt;= 1) {</span>



 429             for (UnsortedBuilder builder : UnsortedBuilder.values()) {
<a name="75" id="anc75"></a><span class="line-modified"> 430                 builder.build((int[]) gold[0], m, random);</span>
<span class="line-modified"> 431                 convertData(length);</span>
<span class="line-modified"> 432 </span>
<span class="line-modified"> 433                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 434                     printTestName(&quot;Test with check sum&quot;, random, length,</span>
<span class="line-modified"> 435                         &quot;, m = &quot; + m + &quot;, &quot; + getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified"> 436                     sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 437                     checkWithCheckSum(test[i], gold[i]);</span>



 438                 }
 439             }
 440         }
 441         out.println();
 442     }
 443 
<a name="76" id="anc76"></a><span class="line-modified"> 444     private void testWithScrambling(int length, TestRandom random) {</span>
<span class="line-modified"> 445         for (int m = 1; m &lt;= length; m &lt;&lt;= 1) {</span>






 446             for (SortedBuilder builder : SortedBuilder.values()) {
<a name="77" id="anc77"></a><span class="line-modified"> 447                 builder.build((int[]) gold[0], m);</span>
<span class="line-modified"> 448                 convertData(length);</span>
<span class="line-modified"> 449 </span>
<span class="line-modified"> 450                 for (int i = 0; i &lt; test.length; i++) {</span>
<span class="line-modified"> 451                     printTestName(&quot;Test with scrambling&quot;, random, length,</span>
<span class="line-modified"> 452                         &quot;, m = &quot; + m + &quot;, &quot; + getType(i) + &quot; &quot; + builder);</span>
<span class="line-modified"> 453                     scramble(test[i], random);</span>
<span class="line-modified"> 454                     sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 455                     compare(test[i], gold[i]);</span>



 456                 }
 457             }
 458         }
 459         out.println();
 460     }
 461 
<a name="78" id="anc78"></a><span class="line-modified"> 462     private void testNegativeZero(int length, TestRandom random) {</span>
<span class="line-modified"> 463         for (int i = 5; i &lt; test.length; i++) {</span>
<span class="line-modified"> 464             printTestName(&quot;Test negative zero -0.0&quot;, random, length, &quot; &quot; + getType(i));</span>


 465 
<a name="79" id="anc79"></a><span class="line-modified"> 466             NegativeZeroBuilder builder = NegativeZeroBuilder.values() [i - 5];</span>
<span class="line-modified"> 467             builder.build(test[i], random);</span>
<span class="line-modified"> 468 </span>
<span class="line-modified"> 469             sortingHelper.sort(test[i]);</span>
<span class="line-modified"> 470             checkNegativeZero(test[i]);</span>
























 471         }
<a name="80" id="anc80"></a><span class="line-added"> 472         out.println();</span>
 473     }
 474 
<a name="81" id="anc81"></a><span class="line-modified"> 475     private void testFloatingPointSorting(int length, TestRandom random) {</span>
<span class="line-modified"> 476         if (length &lt; 2) {</span>
<span class="line-modified"> 477             return;</span>
<span class="line-modified"> 478         }</span>
<span class="line-modified"> 479         final int MAX = 13;</span>
 480 
<a name="82" id="anc82"></a><span class="line-modified"> 481         for (int a = 0; a &lt; MAX; a++) {</span>
<span class="line-modified"> 482             for (int g = 0; g &lt; MAX; g++) {</span>
<span class="line-modified"> 483                 for (int z = 0; z &lt; MAX; z++) {</span>
<span class="line-modified"> 484                     for (int n = 0; n &lt; MAX; n++) {</span>
<span class="line-modified"> 485                         for (int p = 0; p &lt; MAX; p++) {</span>
<span class="line-modified"> 486                             if (a + g + z + n + p != length) {</span>



 487                                 continue;
 488                             }
<a name="83" id="anc83"></a><span class="line-modified"> 489                             for (int i = 5; i &lt; test.length; i++) {</span>
<span class="line-modified"> 490                                 printTestName(&quot;Test float-pointing sorting&quot;, random, length,</span>
<span class="line-modified"> 491                                     &quot;, a = &quot; + a + &quot;, g = &quot; + g + &quot;, z = &quot; + z +</span>
<span class="line-modified"> 492                                     &quot;, n = &quot; + n + &quot;, p = &quot; + p + &quot;, &quot; + getType(i));</span>
<span class="line-modified"> 493                                 FloatingPointBuilder builder = FloatingPointBuilder.values()[i - 5];</span>
<span class="line-modified"> 494                                 builder.build(gold[i], a, g, z, n, p, random);</span>
<span class="line-modified"> 495                                 copy(test[i], gold[i]);</span>
<span class="line-modified"> 496                                 scramble(test[i], random);</span>
<span class="line-modified"> 497                                 sortingHelper.sort(test[i]);</span>
<span class="line-added"> 498                                 compare(test[i], gold[i], a, n, g);</span>
 499                             }
<a name="84" id="anc84"></a>
 500                         }
 501                     }
 502                 }
 503             }
 504         }
<a name="85" id="anc85"></a><span class="line-modified"> 505 </span>
<span class="line-modified"> 506         for (int m = 13; m &gt; 4; m--) {</span>
<span class="line-added"> 507             int t = length / m;</span>
<span class="line-added"> 508             int g = t, z = t, n = t, p = t;</span>
<span class="line-added"> 509             int a = length - g - z - n - p;</span>
<span class="line-added"> 510 </span>
<span class="line-added"> 511             for (int i = 5; i &lt; test.length; i++) {</span>
<span class="line-added"> 512                 printTestName(&quot;Test float-pointing sorting&quot;, random, length,</span>
<span class="line-added"> 513                     &quot;, a = &quot; + a + &quot;, g = &quot; + g + &quot;, z = &quot; + z +</span>
<span class="line-added"> 514                     &quot;, n = &quot; + n + &quot;, p = &quot; + p + &quot;, &quot; + getType(i));</span>
<span class="line-added"> 515                 FloatingPointBuilder builder = FloatingPointBuilder.values() [i - 5];</span>
<span class="line-added"> 516                 builder.build(gold[i], a, g, z, n, p, random);</span>
<span class="line-added"> 517                 copy(test[i], gold[i]);</span>
<span class="line-added"> 518                 scramble(test[i], random);</span>
<span class="line-added"> 519                 sortingHelper.sort(test[i]);</span>
<span class="line-added"> 520                 compare(test[i], gold[i], a, n, g);</span>
<span class="line-added"> 521             }</span>
 522         }
<a name="86" id="anc86"></a><span class="line-added"> 523         out.println();</span>
 524     }
 525 
<a name="87" id="anc87"></a><span class="line-modified"> 526     private void prepareSubArray(int[] a, int fromIndex, int toIndex) {</span>
 527         for (int i = 0; i &lt; fromIndex; i++) {
<a name="88" id="anc88"></a><span class="line-modified"> 528             a[i] = A380;</span>
 529         }
 530         int middle = (fromIndex + toIndex) &gt;&gt;&gt; 1;
 531         int k = 0;
 532 
 533         for (int i = fromIndex; i &lt; middle; i++) {
 534             a[i] = k++;
 535         }
<a name="89" id="anc89"></a><span class="line-added"> 536 </span>
 537         for (int i = middle; i &lt; toIndex; i++) {
 538             a[i] = k--;
 539         }
<a name="90" id="anc90"></a><span class="line-added"> 540 </span>
 541         for (int i = toIndex; i &lt; a.length; i++) {
<a name="91" id="anc91"></a><span class="line-modified"> 542             a[i] = B747;</span>
<span class="line-added"> 543         }</span>
<span class="line-added"> 544     }</span>
<span class="line-added"> 545 </span>
<span class="line-added"> 546     private void scramble(Object a, Random random) {</span>
<span class="line-added"> 547         if (a instanceof int[]) {</span>
<span class="line-added"> 548             scramble((int[]) a, random);</span>
<span class="line-added"> 549         } else if (a instanceof long[]) {</span>
<span class="line-added"> 550             scramble((long[]) a, random);</span>
<span class="line-added"> 551         } else if (a instanceof byte[]) {</span>
<span class="line-added"> 552             scramble((byte[]) a, random);</span>
<span class="line-added"> 553         } else if (a instanceof char[]) {</span>
<span class="line-added"> 554             scramble((char[]) a, random);</span>
<span class="line-added"> 555         } else if (a instanceof short[]) {</span>
<span class="line-added"> 556             scramble((short[]) a, random);</span>
<span class="line-added"> 557         } else if (a instanceof float[]) {</span>
<span class="line-added"> 558             scramble((float[]) a, random);</span>
<span class="line-added"> 559         } else if (a instanceof double[]) {</span>
<span class="line-added"> 560             scramble((double[]) a, random);</span>
<span class="line-added"> 561         } else {</span>
<span class="line-added"> 562             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
 563         }
 564     }
 565 
<a name="92" id="anc92"></a><span class="line-modified"> 566     private void scramble(int[] a, Random random) {</span>
 567         for (int i = 0; i &lt; a.length * 7; i++) {
 568             swap(a, random.nextInt(a.length), random.nextInt(a.length));
 569         }
 570     }
 571 
<a name="93" id="anc93"></a><span class="line-modified"> 572     private void scramble(long[] a, Random random) {</span>
 573         for (int i = 0; i &lt; a.length * 7; i++) {
 574             swap(a, random.nextInt(a.length), random.nextInt(a.length));
 575         }
 576     }
 577 
<a name="94" id="anc94"></a><span class="line-modified"> 578     private void scramble(byte[] a, Random random) {</span>
 579         for (int i = 0; i &lt; a.length * 7; i++) {
 580             swap(a, random.nextInt(a.length), random.nextInt(a.length));
 581         }
 582     }
 583 
<a name="95" id="anc95"></a><span class="line-modified"> 584     private void scramble(char[] a, Random random) {</span>
<span class="line-modified"> 585         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified"> 586             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified"> 587         }</span>
 588     }
 589 
<a name="96" id="anc96"></a><span class="line-modified"> 590     private void scramble(short[] a, Random random) {</span>
<span class="line-modified"> 591         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified"> 592             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified"> 593         }</span>
 594     }
 595 
<a name="97" id="anc97"></a><span class="line-modified"> 596     private void scramble(float[] a, Random random) {</span>
<span class="line-modified"> 597         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified"> 598             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified"> 599         }</span>
 600     }
 601 
<a name="98" id="anc98"></a><span class="line-modified"> 602     private void scramble(double[] a, Random random) {</span>
<span class="line-modified"> 603         for (int i = 0; i &lt; a.length * 7; i++) {</span>
<span class="line-modified"> 604             swap(a, random.nextInt(a.length), random.nextInt(a.length));</span>
<span class="line-modified"> 605         }</span>
<span class="line-modified"> 606     }</span>




 607 
<a name="99" id="anc99"></a><span class="line-modified"> 608     private void swap(int[] a, int i, int j) {</span>
<span class="line-modified"> 609         int t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 610     }</span>






 611 
<a name="100" id="anc100"></a><span class="line-modified"> 612     private void swap(long[] a, int i, int j) {</span>
<span class="line-modified"> 613         long t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 614     }</span>






 615 
<a name="101" id="anc101"></a><span class="line-modified"> 616     private void swap(byte[] a, int i, int j) {</span>
<span class="line-modified"> 617         byte t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 618     }</span>






 619 
<a name="102" id="anc102"></a><span class="line-modified"> 620     private void swap(char[] a, int i, int j) {</span>
<span class="line-modified"> 621         char t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 622     }</span>






 623 
<a name="103" id="anc103"></a><span class="line-modified"> 624     private void swap(short[] a, int i, int j) {</span>
<span class="line-modified"> 625         short t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 626     }</span>






 627 
<a name="104" id="anc104"></a><span class="line-modified"> 628     private void swap(float[] a, int i, int j) {</span>
<span class="line-modified"> 629         float t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 630     }</span>






 631 
<a name="105" id="anc105"></a><span class="line-modified"> 632     private void swap(double[] a, int i, int j) {</span>
<span class="line-modified"> 633         double t = a[i]; a[i] = a[j]; a[j] = t;</span>
<span class="line-modified"> 634     }</span>



 635 
<a name="106" id="anc106"></a><span class="line-modified"> 636     private void checkWithCheckSum(Object test, Object gold) {</span>
<span class="line-added"> 637         checkSorted(test);</span>
<span class="line-added"> 638         checkCheckSum(test, gold);</span>
<span class="line-added"> 639     }</span>
 640 
<a name="107" id="anc107"></a><span class="line-modified"> 641     private void fail(String message) {</span>
<span class="line-modified"> 642         err.format(&quot;\n*** TEST FAILED ***\n\n%s\n\n&quot;, message);</span>
<span class="line-added"> 643         throw new RuntimeException(&quot;Test failed&quot;);</span>
<span class="line-added"> 644     }</span>
 645 
<a name="108" id="anc108"></a><span class="line-modified"> 646     private void checkNegativeZero(Object a) {</span>
<span class="line-modified"> 647         if (a instanceof float[]) {</span>
<span class="line-modified"> 648             checkNegativeZero((float[]) a);</span>
<span class="line-modified"> 649         } else if (a instanceof double[]) {</span>
<span class="line-added"> 650             checkNegativeZero((double[]) a);</span>
<span class="line-added"> 651         } else {</span>
<span class="line-added"> 652             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
 653         }
 654     }
 655 
<a name="109" id="anc109"></a><span class="line-modified"> 656     private void checkNegativeZero(float[] a) {</span>
<span class="line-modified"> 657         for (int i = 0; i &lt; a.length - 1; i++) {</span>
<span class="line-modified"> 658             if (Float.floatToRawIntBits(a[i]) == 0 &amp;&amp; Float.floatToRawIntBits(a[i + 1]) &lt; 0) {</span>
<span class="line-modified"> 659                 fail(a[i] + &quot; before &quot; + a[i + 1] + &quot; at position &quot; + i);</span>
















 660             }
<a name="110" id="anc110"></a><span class="line-modified"> 661         }</span>


 662     }
 663 
<a name="111" id="anc111"></a><span class="line-modified"> 664     private void checkNegativeZero(double[] a) {</span>
<span class="line-modified"> 665         for (int i = 0; i &lt; a.length - 1; i++) {</span>
<span class="line-modified"> 666             if (Double.doubleToRawLongBits(a[i]) == 0 &amp;&amp; Double.doubleToRawLongBits(a[i + 1]) &lt; 0) {</span>
<span class="line-modified"> 667                 fail(a[i] + &quot; before &quot; + a[i + 1] + &quot; at position &quot; + i);</span>
















 668             }
<a name="112" id="anc112"></a><span class="line-modified"> 669         }</span>


 670     }
 671 
<a name="113" id="anc113"></a><span class="line-modified"> 672     private void compare(Object a, Object b, int numNaN, int numNeg, int numNegZero) {</span>
<span class="line-modified"> 673         if (a instanceof float[]) {</span>
<span class="line-modified"> 674             compare((float[]) a, (float[]) b, numNaN, numNeg, numNegZero);</span>
<span class="line-added"> 675         } else if (a instanceof double[]) {</span>
<span class="line-added"> 676             compare((double[]) a, (double[]) b, numNaN, numNeg, numNegZero);</span>
<span class="line-added"> 677         } else {</span>
<span class="line-added"> 678             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
 679         }
 680     }
 681 
<a name="114" id="anc114"></a><span class="line-modified"> 682     private void compare(float[] a, float[] b, int numNaN, int numNeg, int numNegZero) {</span>
 683         for (int i = a.length - numNaN; i &lt; a.length; i++) {
 684             if (a[i] == a[i]) {
<a name="115" id="anc115"></a><span class="line-modified"> 685                 fail(&quot;There must be NaN instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 686             }
 687         }
 688         final int NEGATIVE_ZERO = Float.floatToIntBits(-0.0f);
 689 
 690         for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
 691             if (NEGATIVE_ZERO != Float.floatToIntBits(a[i])) {
<a name="116" id="anc116"></a><span class="line-modified"> 692                 fail(&quot;There must be -0.0 instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 693             }
 694         }
<a name="117" id="anc117"></a><span class="line-added"> 695 </span>
 696         for (int i = 0; i &lt; a.length - numNaN; i++) {
 697             if (a[i] != b[i]) {
<a name="118" id="anc118"></a><span class="line-modified"> 698                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 699             }
 700         }
 701     }
 702 
<a name="119" id="anc119"></a><span class="line-modified"> 703     private void compare(double[] a, double[] b, int numNaN, int numNeg, int numNegZero) {</span>






 704         for (int i = a.length - numNaN; i &lt; a.length; i++) {
 705             if (a[i] == a[i]) {
<a name="120" id="anc120"></a><span class="line-modified"> 706                 fail(&quot;There must be NaN instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 707             }
 708         }
 709         final long NEGATIVE_ZERO = Double.doubleToLongBits(-0.0d);
 710 
 711         for (int i = numNeg; i &lt; numNeg + numNegZero; i++) {
 712             if (NEGATIVE_ZERO != Double.doubleToLongBits(a[i])) {
<a name="121" id="anc121"></a><span class="line-modified"> 713                 fail(&quot;There must be -0.0 instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 714             }
 715         }
<a name="122" id="anc122"></a><span class="line-added"> 716 </span>
 717         for (int i = 0; i &lt; a.length - numNaN; i++) {
 718             if (a[i] != b[i]) {
<a name="123" id="anc123"></a><span class="line-modified"> 719                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
<span class="line-modified"> 720             }</span>
<span class="line-added"> 721         }</span>
<span class="line-added"> 722     }</span>
<span class="line-added"> 723 </span>
<span class="line-added"> 724     private void compare(Object a, Object b) {</span>
<span class="line-added"> 725         if (a instanceof int[]) {</span>
<span class="line-added"> 726             compare((int[]) a, (int[]) b);</span>
<span class="line-added"> 727         } else if (a instanceof long[]) {</span>
<span class="line-added"> 728             compare((long[]) a, (long[]) b);</span>
<span class="line-added"> 729         } else if (a instanceof byte[]) {</span>
<span class="line-added"> 730             compare((byte[]) a, (byte[]) b);</span>
<span class="line-added"> 731         } else if (a instanceof char[]) {</span>
<span class="line-added"> 732             compare((char[]) a, (char[]) b);</span>
<span class="line-added"> 733         } else if (a instanceof short[]) {</span>
<span class="line-added"> 734             compare((short[]) a, (short[]) b);</span>
<span class="line-added"> 735         } else if (a instanceof float[]) {</span>
<span class="line-added"> 736             compare((float[]) a, (float[]) b);</span>
<span class="line-added"> 737         } else if (a instanceof double[]) {</span>
<span class="line-added"> 738             compare((double[]) a, (double[]) b);</span>
<span class="line-added"> 739         } else {</span>
<span class="line-added"> 740             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
 741         }
 742     }
 743 
<a name="124" id="anc124"></a><span class="line-modified"> 744     private void compare(int[] a, int[] b) {</span>
<span class="line-modified"> 745         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 746             if (a[i] != b[i]) {</span>
<span class="line-modified"> 747                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
<span class="line-modified"> 748             }</span>
<span class="line-modified"> 749         }</span>
<span class="line-added"> 750     }</span>
 751 
<a name="125" id="anc125"></a><span class="line-modified"> 752     private void compare(long[] a, long[] b) {</span>
<span class="line-modified"> 753         for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified"> 754             if (a[i] != b[i]) {</span>
<span class="line-modified"> 755                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>








 756             }
<a name="126" id="anc126"></a><span class="line-modified"> 757         }</span>
<span class="line-modified"> 758     }</span>



 759 
<a name="127" id="anc127"></a><span class="line-modified"> 760     private void compare(byte[] a, byte[] b) {</span>





































































































































































































































 761         for (int i = 0; i &lt; a.length; i++) {
 762             if (a[i] != b[i]) {
<a name="128" id="anc128"></a><span class="line-modified"> 763                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 764             }
 765         }
 766     }
 767 
<a name="129" id="anc129"></a><span class="line-modified"> 768     private void compare(char[] a, char[] b) {</span>
 769         for (int i = 0; i &lt; a.length; i++) {
 770             if (a[i] != b[i]) {
<a name="130" id="anc130"></a><span class="line-modified"> 771                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 772             }
 773         }
 774     }
 775 
<a name="131" id="anc131"></a><span class="line-modified"> 776     private void compare(short[] a, short[] b) {</span>
 777         for (int i = 0; i &lt; a.length; i++) {
 778             if (a[i] != b[i]) {
<a name="132" id="anc132"></a><span class="line-modified"> 779                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 780             }
 781         }
 782     }
 783 
<a name="133" id="anc133"></a><span class="line-modified"> 784     private void compare(float[] a, float[] b) {</span>
 785         for (int i = 0; i &lt; a.length; i++) {
 786             if (a[i] != b[i]) {
<a name="134" id="anc134"></a><span class="line-modified"> 787                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 788             }
 789         }
 790     }
 791 
<a name="135" id="anc135"></a><span class="line-modified"> 792     private void compare(double[] a, double[] b) {</span>
 793         for (int i = 0; i &lt; a.length; i++) {
 794             if (a[i] != b[i]) {
<a name="136" id="anc136"></a><span class="line-modified"> 795                 fail(&quot;There must be &quot; + b[i] + &quot; instead of &quot; + a[i] + &quot; at position &quot; + i);</span>
 796             }
 797         }
 798     }
 799 
<a name="137" id="anc137"></a><span class="line-modified"> 800     private String getType(int i) {</span>
<span class="line-modified"> 801         Object a = test[i];</span>





 802 
<a name="138" id="anc138"></a><span class="line-modified"> 803         if (a instanceof int[]) {</span>
<span class="line-modified"> 804             return &quot;INT   &quot;;</span>
<span class="line-modified"> 805         }</span>
<span class="line-modified"> 806         if (a instanceof long[]) {</span>
<span class="line-modified"> 807             return &quot;LONG  &quot;;</span>
<span class="line-added"> 808         }</span>
<span class="line-added"> 809         if (a instanceof byte[]) {</span>
<span class="line-added"> 810             return &quot;BYTE  &quot;;</span>
<span class="line-added"> 811         }</span>
<span class="line-added"> 812         if (a instanceof char[]) {</span>
<span class="line-added"> 813             return &quot;CHAR  &quot;;</span>
 814         }
<a name="139" id="anc139"></a><span class="line-added"> 815         if (a instanceof short[]) {</span>
<span class="line-added"> 816             return &quot;SHORT &quot;;</span>
<span class="line-added"> 817         }</span>
<span class="line-added"> 818         if (a instanceof float[]) {</span>
<span class="line-added"> 819             return &quot;FLOAT &quot;;</span>
<span class="line-added"> 820         }</span>
<span class="line-added"> 821         if (a instanceof double[]) {</span>
<span class="line-added"> 822             return &quot;DOUBLE&quot;;</span>
<span class="line-added"> 823         }</span>
<span class="line-added"> 824         fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
<span class="line-added"> 825         return null;</span>
 826     }
 827 
<a name="140" id="anc140"></a><span class="line-modified"> 828     private void checkSorted(Object a) {</span>
<span class="line-modified"> 829         if (a instanceof int[]) {</span>
<span class="line-modified"> 830             checkSorted((int[]) a);</span>
<span class="line-modified"> 831         } else if (a instanceof long[]) {</span>
<span class="line-modified"> 832             checkSorted((long[]) a);</span>
<span class="line-modified"> 833         } else if (a instanceof byte[]) {</span>
<span class="line-modified"> 834             checkSorted((byte[]) a);</span>
<span class="line-modified"> 835         } else if (a instanceof char[]) {</span>
<span class="line-modified"> 836             checkSorted((char[]) a);</span>
<span class="line-modified"> 837         } else if (a instanceof short[]) {</span>
<span class="line-modified"> 838             checkSorted((short[]) a);</span>
<span class="line-modified"> 839         } else if (a instanceof float[]) {</span>
<span class="line-modified"> 840             checkSorted((float[]) a);</span>
<span class="line-modified"> 841         } else if (a instanceof double[]) {</span>
<span class="line-modified"> 842             checkSorted((double[]) a);</span>










 843         } else {
<a name="141" id="anc141"></a><span class="line-modified"> 844             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>

 845         }
 846     }
 847 
<a name="142" id="anc142"></a><span class="line-modified"> 848     private void checkSorted(int[] a) {</span>
 849         for (int i = 0; i &lt; a.length - 1; i++) {
 850             if (a[i] &gt; a[i + 1]) {
<a name="143" id="anc143"></a><span class="line-modified"> 851                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 852             }
 853         }
 854     }
 855 
<a name="144" id="anc144"></a><span class="line-modified"> 856     private void checkSorted(long[] a) {</span>
 857         for (int i = 0; i &lt; a.length - 1; i++) {
 858             if (a[i] &gt; a[i + 1]) {
<a name="145" id="anc145"></a><span class="line-modified"> 859                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 860             }
 861         }
 862     }
 863 
<a name="146" id="anc146"></a><span class="line-modified"> 864     private void checkSorted(byte[] a) {</span>
 865         for (int i = 0; i &lt; a.length - 1; i++) {
 866             if (a[i] &gt; a[i + 1]) {
<a name="147" id="anc147"></a><span class="line-modified"> 867                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 868             }
 869         }
 870     }
 871 
<a name="148" id="anc148"></a><span class="line-modified"> 872     private void checkSorted(char[] a) {</span>
 873         for (int i = 0; i &lt; a.length - 1; i++) {
 874             if (a[i] &gt; a[i + 1]) {
<a name="149" id="anc149"></a><span class="line-modified"> 875                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 876             }
 877         }
 878     }
 879 
<a name="150" id="anc150"></a><span class="line-modified"> 880     private void checkSorted(short[] a) {</span>
 881         for (int i = 0; i &lt; a.length - 1; i++) {
 882             if (a[i] &gt; a[i + 1]) {
<a name="151" id="anc151"></a><span class="line-modified"> 883                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 884             }
 885         }
 886     }
 887 
<a name="152" id="anc152"></a><span class="line-modified"> 888     private void checkSorted(float[] a) {</span>
 889         for (int i = 0; i &lt; a.length - 1; i++) {
 890             if (a[i] &gt; a[i + 1]) {
<a name="153" id="anc153"></a><span class="line-modified"> 891                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 892             }
 893         }
 894     }
 895 
<a name="154" id="anc154"></a><span class="line-modified"> 896     private void checkSorted(double[] a) {</span>
 897         for (int i = 0; i &lt; a.length - 1; i++) {
 898             if (a[i] &gt; a[i + 1]) {
<a name="155" id="anc155"></a><span class="line-modified"> 899                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
 900             }
 901         }
 902     }
 903 
<a name="156" id="anc156"></a><span class="line-modified"> 904     private void checkCheckSum(Object test, Object gold) {</span>
<span class="line-modified"> 905         if (checkSumXor(test) != checkSumXor(gold)) {</span>
<span class="line-modified"> 906             fail(&quot;Original and sorted arrays are not identical [^]&quot;);</span>
<span class="line-modified"> 907         }</span>
<span class="line-modified"> 908         if (checkSumPlus(test) != checkSumPlus(gold)) {</span>
<span class="line-added"> 909             fail(&quot;Original and sorted arrays are not identical [+]&quot;);</span>
 910         }
 911     }
 912 
<a name="157" id="anc157"></a><span class="line-modified"> 913     private int checkSumXor(Object a) {</span>
<span class="line-modified"> 914         if (a instanceof int[]) {</span>
<span class="line-modified"> 915             return checkSumXor((int[]) a);</span>
 916         }
<a name="158" id="anc158"></a><span class="line-modified"> 917         if (a instanceof long[]) {</span>
<span class="line-modified"> 918             return checkSumXor((long[]) a);</span>
 919         }
<a name="159" id="anc159"></a><span class="line-modified"> 920         if (a instanceof byte[]) {</span>
<span class="line-modified"> 921             return checkSumXor((byte[]) a);</span>





















 922         }
<a name="160" id="anc160"></a><span class="line-modified"> 923         if (a instanceof char[]) {</span>
<span class="line-modified"> 924             return checkSumXor((char[]) a);</span>





 925         }
<a name="161" id="anc161"></a><span class="line-modified"> 926         if (a instanceof short[]) {</span>
<span class="line-added"> 927             return checkSumXor((short[]) a);</span>
<span class="line-added"> 928         }</span>
<span class="line-added"> 929         if (a instanceof float[]) {</span>
<span class="line-added"> 930             return checkSumXor((float[]) a);</span>
<span class="line-added"> 931         }</span>
<span class="line-added"> 932         if (a instanceof double[]) {</span>
<span class="line-added"> 933             return checkSumXor((double[]) a);</span>
<span class="line-added"> 934         }</span>
<span class="line-added"> 935         fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
<span class="line-added"> 936         return -1;</span>
 937     }
 938 
<a name="162" id="anc162"></a><span class="line-modified"> 939     private int checkSumXor(int[] a) {</span>
 940         int checkSum = 0;
 941 
 942         for (int e : a) {
 943             checkSum ^= e;
 944         }
 945         return checkSum;
 946     }
 947 
<a name="163" id="anc163"></a><span class="line-modified"> 948     private int checkSumXor(long[] a) {</span>
 949         long checkSum = 0;
 950 
 951         for (long e : a) {
 952             checkSum ^= e;
 953         }
 954         return (int) checkSum;
 955     }
 956 
<a name="164" id="anc164"></a><span class="line-modified"> 957     private int checkSumXor(byte[] a) {</span>
<span class="line-modified"> 958         byte checkSum = 0;</span>
 959 
<a name="165" id="anc165"></a><span class="line-modified"> 960         for (byte e : a) {</span>
 961             checkSum ^= e;
 962         }
 963         return (int) checkSum;
 964     }
 965 
<a name="166" id="anc166"></a><span class="line-modified"> 966     private int checkSumXor(char[] a) {</span>
<span class="line-modified"> 967         char checkSum = 0;</span>
 968 
<a name="167" id="anc167"></a><span class="line-modified"> 969         for (char e : a) {</span>
 970             checkSum ^= e;
 971         }
 972         return (int) checkSum;
 973     }
 974 
<a name="168" id="anc168"></a><span class="line-modified"> 975     private int checkSumXor(short[] a) {</span>
<span class="line-modified"> 976         short checkSum = 0;</span>
 977 
<a name="169" id="anc169"></a><span class="line-modified"> 978         for (short e : a) {</span>
 979             checkSum ^= e;
 980         }
 981         return (int) checkSum;
 982     }
 983 
<a name="170" id="anc170"></a><span class="line-modified"> 984     private int checkSumXor(float[] a) {</span>
 985         int checkSum = 0;
 986 
 987         for (float e : a) {
 988             checkSum ^= (int) e;
 989         }
 990         return checkSum;
 991     }
 992 
<a name="171" id="anc171"></a><span class="line-modified"> 993     private int checkSumXor(double[] a) {</span>
 994         int checkSum = 0;
 995 
 996         for (double e : a) {
 997             checkSum ^= (int) e;
 998         }
 999         return checkSum;
1000     }
1001 
<a name="172" id="anc172"></a><span class="line-modified">1002     private int checkSumPlus(Object a) {</span>
<span class="line-modified">1003         if (a instanceof int[]) {</span>
<span class="line-modified">1004             return checkSumPlus((int[]) a);</span>
<span class="line-modified">1005         }</span>
<span class="line-modified">1006         if (a instanceof long[]) {</span>
<span class="line-modified">1007             return checkSumPlus((long[]) a);</span>















1008         }
<a name="173" id="anc173"></a><span class="line-added">1009         if (a instanceof byte[]) {</span>
<span class="line-added">1010             return checkSumPlus((byte[]) a);</span>
<span class="line-added">1011         }</span>
<span class="line-added">1012         if (a instanceof char[]) {</span>
<span class="line-added">1013             return checkSumPlus((char[]) a);</span>
<span class="line-added">1014         }</span>
<span class="line-added">1015         if (a instanceof short[]) {</span>
<span class="line-added">1016             return checkSumPlus((short[]) a);</span>
<span class="line-added">1017         }</span>
<span class="line-added">1018         if (a instanceof float[]) {</span>
<span class="line-added">1019             return checkSumPlus((float[]) a);</span>
<span class="line-added">1020         }</span>
<span class="line-added">1021         if (a instanceof double[]) {</span>
<span class="line-added">1022             return checkSumPlus((double[]) a);</span>
<span class="line-added">1023         }</span>
<span class="line-added">1024         fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
<span class="line-added">1025         return -1;</span>
1026     }
1027 
<a name="174" id="anc174"></a><span class="line-modified">1028     private int checkSumPlus(int[] a) {</span>
1029         int checkSum = 0;
1030 
1031         for (int e : a) {
1032             checkSum += e;
1033         }
1034         return checkSum;
1035     }
1036 
<a name="175" id="anc175"></a><span class="line-modified">1037     private int checkSumPlus(long[] a) {</span>
1038         long checkSum = 0;
1039 
1040         for (long e : a) {
1041             checkSum += e;
1042         }
1043         return (int) checkSum;
1044     }
1045 
<a name="176" id="anc176"></a><span class="line-modified">1046     private int checkSumPlus(byte[] a) {</span>
<span class="line-modified">1047         byte checkSum = 0;</span>
1048 
<a name="177" id="anc177"></a><span class="line-modified">1049         for (byte e : a) {</span>
1050             checkSum += e;
1051         }
1052         return (int) checkSum;
1053     }
1054 
<a name="178" id="anc178"></a><span class="line-modified">1055     private int checkSumPlus(char[] a) {</span>
<span class="line-modified">1056         char checkSum = 0;</span>
1057 
<a name="179" id="anc179"></a><span class="line-modified">1058         for (char e : a) {</span>
1059             checkSum += e;
1060         }
1061         return (int) checkSum;
1062     }
1063 
<a name="180" id="anc180"></a><span class="line-modified">1064     private int checkSumPlus(short[] a) {</span>
<span class="line-modified">1065         short checkSum = 0;</span>
1066 
<a name="181" id="anc181"></a><span class="line-modified">1067         for (short e : a) {</span>
1068             checkSum += e;
1069         }
1070         return (int) checkSum;
1071     }
1072 
<a name="182" id="anc182"></a><span class="line-modified">1073     private int checkSumPlus(float[] a) {</span>
1074         int checkSum = 0;
1075 
1076         for (float e : a) {
1077             checkSum += (int) e;
1078         }
1079         return checkSum;
1080     }
1081 
<a name="183" id="anc183"></a><span class="line-modified">1082     private int checkSumPlus(double[] a) {</span>
1083         int checkSum = 0;
1084 
1085         for (double e : a) {
1086             checkSum += (int) e;
1087         }
1088         return checkSum;
1089     }
1090 
<a name="184" id="anc184"></a><span class="line-modified">1091     private void sortByInsertionSort(Object a) {</span>
<span class="line-modified">1092         if (a instanceof int[]) {</span>
<span class="line-modified">1093             sortByInsertionSort((int[]) a);</span>
<span class="line-modified">1094         } else if (a instanceof long[]) {</span>
<span class="line-modified">1095             sortByInsertionSort((long[]) a);</span>
<span class="line-modified">1096         } else if (a instanceof byte[]) {</span>
<span class="line-modified">1097             sortByInsertionSort((byte[]) a);</span>
<span class="line-modified">1098         } else if (a instanceof char[]) {</span>
<span class="line-modified">1099             sortByInsertionSort((char[]) a);</span>
<span class="line-modified">1100         } else if (a instanceof short[]) {</span>
<span class="line-modified">1101             sortByInsertionSort((short[]) a);</span>
<span class="line-modified">1102         } else if (a instanceof float[]) {</span>
<span class="line-modified">1103             sortByInsertionSort((float[]) a);</span>
<span class="line-modified">1104         } else if (a instanceof double[]) {</span>
<span class="line-modified">1105             sortByInsertionSort((double[]) a);</span>











1106         } else {
<a name="185" id="anc185"></a><span class="line-modified">1107             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>

1108         }
1109     }
1110 
<a name="186" id="anc186"></a><span class="line-modified">1111     private void sortByInsertionSort(int[] a) {</span>
1112         for (int j, i = 1; i &lt; a.length; i++) {
1113             int ai = a[i];
<a name="187" id="anc187"></a><span class="line-added">1114 </span>
1115             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1116                 a[j + 1] = a[j];
1117             }
1118             a[j + 1] = ai;
1119         }
1120     }
1121 
<a name="188" id="anc188"></a><span class="line-modified">1122     private void sortByInsertionSort(long[] a) {</span>
1123         for (int j, i = 1; i &lt; a.length; i++) {
1124             long ai = a[i];
<a name="189" id="anc189"></a><span class="line-added">1125 </span>
1126             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1127                 a[j + 1] = a[j];
1128             }
1129             a[j + 1] = ai;
1130         }
1131     }
1132 
<a name="190" id="anc190"></a><span class="line-modified">1133     private void sortByInsertionSort(byte[] a) {</span>
1134         for (int j, i = 1; i &lt; a.length; i++) {
<a name="191" id="anc191"></a><span class="line-modified">1135             byte ai = a[i];</span>
<span class="line-added">1136 </span>
1137             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1138                 a[j + 1] = a[j];
1139             }
1140             a[j + 1] = ai;
1141         }
1142     }
1143 
<a name="192" id="anc192"></a><span class="line-modified">1144     private void sortByInsertionSort(char[] a) {</span>
1145         for (int j, i = 1; i &lt; a.length; i++) {
<a name="193" id="anc193"></a><span class="line-modified">1146             char ai = a[i];</span>
<span class="line-added">1147 </span>
1148             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1149                 a[j + 1] = a[j];
1150             }
1151             a[j + 1] = ai;
1152         }
1153     }
1154 
<a name="194" id="anc194"></a><span class="line-modified">1155     private void sortByInsertionSort(short[] a) {</span>
1156         for (int j, i = 1; i &lt; a.length; i++) {
<a name="195" id="anc195"></a><span class="line-modified">1157             short ai = a[i];</span>
<span class="line-added">1158 </span>
1159             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1160                 a[j + 1] = a[j];
1161             }
1162             a[j + 1] = ai;
1163         }
1164     }
1165 
<a name="196" id="anc196"></a><span class="line-modified">1166     private void sortByInsertionSort(float[] a) {</span>
1167         for (int j, i = 1; i &lt; a.length; i++) {
1168             float ai = a[i];
<a name="197" id="anc197"></a><span class="line-added">1169 </span>
1170             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1171                 a[j + 1] = a[j];
1172             }
1173             a[j + 1] = ai;
1174         }
1175     }
1176 
<a name="198" id="anc198"></a><span class="line-modified">1177     private void sortByInsertionSort(double[] a) {</span>
1178         for (int j, i = 1; i &lt; a.length; i++) {
1179             double ai = a[i];
<a name="199" id="anc199"></a>





1180 
<a name="200" id="anc200"></a>


1181             for (j = i - 1; j &gt;= 0 &amp;&amp; ai &lt; a[j]; j--) {
1182                 a[j + 1] = a[j];
1183             }
1184             a[j + 1] = ai;
1185         }
1186     }
1187 
<a name="201" id="anc201"></a><span class="line-modified">1188     private void checkSubArray(Object a, int fromIndex, int toIndex) {</span>
<span class="line-modified">1189         if (a instanceof int[]) {</span>
<span class="line-modified">1190             checkSubArray((int[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1191         } else if (a instanceof long[]) {</span>
<span class="line-modified">1192             checkSubArray((long[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1193         } else if (a instanceof byte[]) {</span>
<span class="line-modified">1194             checkSubArray((byte[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1195         } else if (a instanceof char[]) {</span>
<span class="line-modified">1196             checkSubArray((char[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1197         } else if (a instanceof short[]) {</span>
<span class="line-modified">1198             checkSubArray((short[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1199         } else if (a instanceof float[]) {</span>
<span class="line-modified">1200             checkSubArray((float[]) a, fromIndex, toIndex);</span>
<span class="line-modified">1201         } else if (a instanceof double[]) {</span>
<span class="line-modified">1202             checkSubArray((double[]) a, fromIndex, toIndex);</span>


1203         } else {
<a name="202" id="anc202"></a><span class="line-modified">1204             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>















































1205         }
1206     }
1207 
<a name="203" id="anc203"></a><span class="line-modified">1208     private void checkSubArray(int[] a, int fromIndex, int toIndex) {</span>
1209         for (int i = 0; i &lt; fromIndex; i++) {
<a name="204" id="anc204"></a><span class="line-modified">1210             if (a[i] != A380) {</span>
<span class="line-modified">1211                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1212             }
1213         }
1214 
1215         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
<a name="205" id="anc205"></a><span class="line-modified">1216             if (a[i] &gt; a[i + 1]) {</span>
<span class="line-modified">1217                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1218             }
1219         }
1220 
1221         for (int i = toIndex; i &lt; a.length; i++) {
<a name="206" id="anc206"></a><span class="line-modified">1222             if (a[i] != B747) {</span>
<span class="line-modified">1223                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1224             }
1225         }
1226     }
1227 
<a name="207" id="anc207"></a><span class="line-modified">1228     private void checkSubArray(long[] a, int fromIndex, int toIndex) {</span>
1229         for (int i = 0; i &lt; fromIndex; i++) {
<a name="208" id="anc208"></a><span class="line-modified">1230             if (a[i] != (long) A380) {</span>
<span class="line-modified">1231                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1232             }
1233         }
1234 
1235         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1236             if (a[i] &gt; a[i + 1]) {
<a name="209" id="anc209"></a><span class="line-modified">1237                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1238             }
1239         }
1240 
1241         for (int i = toIndex; i &lt; a.length; i++) {
<a name="210" id="anc210"></a><span class="line-modified">1242             if (a[i] != (long) B747) {</span>
<span class="line-modified">1243                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1244             }
1245         }
1246     }
1247 
<a name="211" id="anc211"></a><span class="line-modified">1248     private void checkSubArray(byte[] a, int fromIndex, int toIndex) {</span>
1249         for (int i = 0; i &lt; fromIndex; i++) {
<a name="212" id="anc212"></a><span class="line-modified">1250             if (a[i] != (byte) A380) {</span>
<span class="line-modified">1251                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1252             }
1253         }
1254 
1255         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1256             if (a[i] &gt; a[i + 1]) {
<a name="213" id="anc213"></a><span class="line-modified">1257                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1258             }
1259         }
1260 
1261         for (int i = toIndex; i &lt; a.length; i++) {
<a name="214" id="anc214"></a><span class="line-modified">1262             if (a[i] != (byte) B747) {</span>
<span class="line-modified">1263                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1264             }
1265         }
1266     }
1267 
<a name="215" id="anc215"></a><span class="line-modified">1268     private void checkSubArray(char[] a, int fromIndex, int toIndex) {</span>
1269         for (int i = 0; i &lt; fromIndex; i++) {
<a name="216" id="anc216"></a><span class="line-modified">1270             if (a[i] != (char) A380) {</span>
<span class="line-modified">1271                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1272             }
1273         }
1274 
1275         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1276             if (a[i] &gt; a[i + 1]) {
<a name="217" id="anc217"></a><span class="line-modified">1277                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1278             }
1279         }
1280 
1281         for (int i = toIndex; i &lt; a.length; i++) {
<a name="218" id="anc218"></a><span class="line-modified">1282             if (a[i] != (char) B747) {</span>
<span class="line-modified">1283                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1284             }
1285         }
1286     }
1287 
<a name="219" id="anc219"></a><span class="line-modified">1288     private void checkSubArray(short[] a, int fromIndex, int toIndex) {</span>
1289         for (int i = 0; i &lt; fromIndex; i++) {
<a name="220" id="anc220"></a><span class="line-modified">1290             if (a[i] != (short) A380) {</span>
<span class="line-modified">1291                 fail(&quot;Range sort changes left element at position &quot; + i + hex(a[i], A380));</span>

1292             }
1293         }
1294 
1295         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1296             if (a[i] &gt; a[i + 1]) {
<a name="221" id="anc221"></a><span class="line-modified">1297                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1298             }
1299         }
1300 
1301         for (int i = toIndex; i &lt; a.length; i++) {
<a name="222" id="anc222"></a><span class="line-modified">1302             if (a[i] != (short) B747) {</span>
<span class="line-modified">1303                 fail(&quot;Range sort changes right element at position &quot; + i + hex(a[i], B747));</span>

1304             }
1305         }
1306     }
1307 
<a name="223" id="anc223"></a><span class="line-modified">1308     private void checkSubArray(float[] a, int fromIndex, int toIndex) {</span>
1309         for (int i = 0; i &lt; fromIndex; i++) {
<a name="224" id="anc224"></a><span class="line-modified">1310             if (a[i] != (float) A380) {</span>
<span class="line-modified">1311                 fail(&quot;Range sort changes left element at position &quot; + i + hex((long) a[i], A380));</span>

1312             }
1313         }
1314 
1315         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1316             if (a[i] &gt; a[i + 1]) {
<a name="225" id="anc225"></a><span class="line-modified">1317                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1318             }
1319         }
1320 
1321         for (int i = toIndex; i &lt; a.length; i++) {
<a name="226" id="anc226"></a><span class="line-modified">1322             if (a[i] != (float) B747) {</span>
<span class="line-modified">1323                 fail(&quot;Range sort changes right element at position &quot; + i + hex((long) a[i], B747));</span>

1324             }
1325         }
1326     }
1327 
<a name="227" id="anc227"></a><span class="line-modified">1328     private void checkSubArray(double[] a, int fromIndex, int toIndex) {</span>
1329         for (int i = 0; i &lt; fromIndex; i++) {
<a name="228" id="anc228"></a><span class="line-modified">1330             if (a[i] != (double) A380) {</span>
<span class="line-modified">1331                 fail(&quot;Range sort changes left element at position &quot; + i + hex((long) a[i], A380));</span>

1332             }
1333         }
1334 
1335         for (int i = fromIndex; i &lt; toIndex - 1; i++) {
1336             if (a[i] &gt; a[i + 1]) {
<a name="229" id="anc229"></a><span class="line-modified">1337                 fail(&quot;Array is not sorted at &quot; + i + &quot;-th position: &quot; + a[i] + &quot; and &quot; + a[i + 1]);</span>
1338             }
1339         }
1340 
1341         for (int i = toIndex; i &lt; a.length; i++) {
<a name="230" id="anc230"></a><span class="line-modified">1342             if (a[i] != (double) B747) {</span>
<span class="line-modified">1343                 fail(&quot;Range sort changes right element at position &quot; + i + hex((long) a[i], B747));</span>
<span class="line-modified">1344             }</span>
<span class="line-modified">1345         }</span>
<span class="line-added">1346     }</span>
<span class="line-added">1347 </span>
<span class="line-added">1348     private void checkRange(Object a, int m) {</span>
<span class="line-added">1349         if (a instanceof int[]) {</span>
<span class="line-added">1350             checkRange((int[]) a, m);</span>
<span class="line-added">1351         } else if (a instanceof long[]) {</span>
<span class="line-added">1352             checkRange((long[]) a, m);</span>
<span class="line-added">1353         } else if (a instanceof byte[]) {</span>
<span class="line-added">1354             checkRange((byte[]) a, m);</span>
<span class="line-added">1355         } else if (a instanceof char[]) {</span>
<span class="line-added">1356             checkRange((char[]) a, m);</span>
<span class="line-added">1357         } else if (a instanceof short[]) {</span>
<span class="line-added">1358             checkRange((short[]) a, m);</span>
<span class="line-added">1359         } else if (a instanceof float[]) {</span>
<span class="line-added">1360             checkRange((float[]) a, m);</span>
<span class="line-added">1361         } else if (a instanceof double[]) {</span>
<span class="line-added">1362             checkRange((double[]) a, m);</span>
<span class="line-added">1363         } else {</span>
<span class="line-added">1364             fail(&quot;Unknown type of array: &quot; + a.getClass().getName());</span>
1365         }
1366     }
1367 
<a name="231" id="anc231"></a><span class="line-modified">1368     private void checkRange(int[] a, int m) {</span>
<span class="line-modified">1369         try {</span>
<span class="line-modified">1370             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">1371             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1372                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">1373         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1374             try {</span>
<span class="line-added">1375                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1376                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1377                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1378             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1379                 try {</span>
<span class="line-added">1380                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1381                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1382                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1383                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
1384             }
1385         }
<a name="232" id="anc232"></a><span class="line-added">1386     }</span>
1387 
<a name="233" id="anc233"></a><span class="line-modified">1388     private void checkRange(long[] a, int m) {</span>
<span class="line-modified">1389         try {</span>
<span class="line-modified">1390             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-added">1391             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-added">1392                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">1393         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1394             try {</span>
<span class="line-added">1395                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1396                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1397                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1398             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1399                 try {</span>
<span class="line-added">1400                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1401                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1402                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1403                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
1404             }
1405         }
<a name="234" id="anc234"></a><span class="line-added">1406     }</span>
1407 
<a name="235" id="anc235"></a><span class="line-modified">1408     private void checkRange(byte[] a, int m) {</span>
<span class="line-modified">1409         try {</span>
<span class="line-modified">1410             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">1411             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1412                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1413         } catch (IllegalArgumentException iae) {</span>
<span class="line-modified">1414             try {</span>
<span class="line-modified">1415                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-modified">1416                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1417                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-modified">1418             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-modified">1419                 try {</span>
<span class="line-modified">1420                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-modified">1421                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1422                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-modified">1423                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
<span class="line-modified">1424             }</span>











1425         }
1426     }
1427 
<a name="236" id="anc236"></a><span class="line-modified">1428     private void checkRange(char[] a, int m) {</span>
1429         try {
<a name="237" id="anc237"></a><span class="line-modified">1430             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">1431             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1432                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1433         } catch (IllegalArgumentException iae) {</span>



1434             try {
<a name="238" id="anc238"></a><span class="line-modified">1435                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-modified">1436                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-modified">1437                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-modified">1438             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1439                 try {</span>
<span class="line-added">1440                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1441                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1442                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1443                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
1444             }
<a name="239" id="anc239"></a><span class="line-modified">1445         }</span>
<span class="line-added">1446     }</span>
<span class="line-added">1447 </span>
<span class="line-added">1448     private void checkRange(short[] a, int m) {</span>
<span class="line-added">1449         try {</span>
<span class="line-added">1450             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-added">1451             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-added">1452                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">1453         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1454             try {</span>
<span class="line-added">1455                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1456                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1457                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1458             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
1459                 try {
<a name="240" id="anc240"></a><span class="line-modified">1460                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1461                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1462                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1463                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
<span class="line-added">1464             }</span>
<span class="line-added">1465         }</span>
<span class="line-added">1466     }</span>
1467 
<a name="241" id="anc241"></a><span class="line-modified">1468     private void checkRange(float[] a, int m) {</span>
<span class="line-modified">1469         try {</span>
<span class="line-modified">1470             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-modified">1471             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-modified">1472                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-modified">1473         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1474             try {</span>
<span class="line-added">1475                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1476                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1477                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1478             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1479                 try {</span>
<span class="line-added">1480                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1481                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1482                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1483                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
1484             }
1485         }
1486     }
1487 
<a name="242" id="anc242"></a><span class="line-modified">1488     private void checkRange(double[] a, int m) {</span>
1489         try {
<a name="243" id="anc243"></a><span class="line-modified">1490             sortingHelper.sort(a, m + 1, m);</span>
<span class="line-added">1491             fail(sortingHelper + &quot; does not throw IllegalArgumentException &quot; +</span>
<span class="line-added">1492                 &quot;as expected: fromIndex = &quot; + (m + 1) + &quot; toIndex = &quot; + m);</span>
<span class="line-added">1493         } catch (IllegalArgumentException iae) {</span>
<span class="line-added">1494             try {</span>
<span class="line-added">1495                 sortingHelper.sort(a, -m, a.length);</span>
<span class="line-added">1496                 fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1497                     &quot;as expected: fromIndex = &quot; + (-m));</span>
<span class="line-added">1498             } catch (ArrayIndexOutOfBoundsException aoe) {</span>
<span class="line-added">1499                 try {</span>
<span class="line-added">1500                     sortingHelper.sort(a, 0, a.length + m);</span>
<span class="line-added">1501                     fail(sortingHelper + &quot; does not throw ArrayIndexOutOfBoundsException &quot; +</span>
<span class="line-added">1502                         &quot;as expected: toIndex = &quot; + (a.length + m));</span>
<span class="line-added">1503                 } catch (ArrayIndexOutOfBoundsException expected) {}</span>
<span class="line-added">1504             }</span>
<span class="line-added">1505         }</span>
<span class="line-added">1506     }</span>
1507 
<a name="244" id="anc244"></a><span class="line-modified">1508     private void copy(Object dst, Object src) {</span>
<span class="line-modified">1509         if (src instanceof float[]) {</span>
<span class="line-modified">1510             copy((float[]) dst, (float[]) src);</span>
<span class="line-added">1511         } else if (src instanceof double[]) {</span>
<span class="line-added">1512             copy((double[]) dst, (double[]) src);</span>
<span class="line-added">1513         } else {</span>
<span class="line-added">1514             fail(&quot;Unknown type of array: &quot; + src.getClass().getName());</span>
1515         }
<a name="245" id="anc245"></a><span class="line-modified">1516     }</span>


1517 
<a name="246" id="anc246"></a><span class="line-modified">1518     private void copy(float[] dst, float[] src) {</span>
<span class="line-modified">1519         System.arraycopy(src, 0, dst, 0, src.length);</span>
<span class="line-modified">1520     }</span>
<span class="line-modified">1521 </span>
<span class="line-modified">1522     private void copy(double[] dst, double[] src) {</span>
<span class="line-modified">1523         System.arraycopy(src, 0, dst, 0, src.length);</span>
<span class="line-added">1524     }</span>
<span class="line-added">1525 </span>
<span class="line-added">1526     private void printTestName(String test, TestRandom random, int length) {</span>
<span class="line-added">1527         printTestName(test, random, length, &quot;&quot;);</span>
<span class="line-added">1528     }</span>
<span class="line-added">1529 </span>
<span class="line-added">1530     private void createData(int length) {</span>
<span class="line-added">1531         gold = new Object[] {</span>
<span class="line-added">1532             new int[length], new long[length],</span>
<span class="line-added">1533             new byte[length], new char[length], new short[length],</span>
<span class="line-added">1534             new float[length], new double[length]</span>
<span class="line-added">1535         };</span>
<span class="line-added">1536 </span>
<span class="line-added">1537         test = new Object[] {</span>
<span class="line-added">1538             new int[length], new long[length],</span>
<span class="line-added">1539             new byte[length], new char[length], new short[length],</span>
<span class="line-added">1540             new float[length], new double[length]</span>
<span class="line-added">1541         };</span>
<span class="line-added">1542     }</span>
<span class="line-added">1543 </span>
<span class="line-added">1544     private void convertData(int length) {</span>
<span class="line-added">1545         for (int i = 1; i &lt; gold.length; i++) {</span>
<span class="line-added">1546             TypeConverter converter = TypeConverter.values()[i - 1];</span>
<span class="line-added">1547             converter.convert((int[])gold[0], gold[i]);</span>
<span class="line-added">1548         }</span>
<span class="line-added">1549 </span>
<span class="line-added">1550         for (int i = 0; i &lt; gold.length; i++) {</span>
<span class="line-added">1551             System.arraycopy(gold[i], 0, test[i], 0, length);</span>
<span class="line-added">1552         }</span>
<span class="line-added">1553     }</span>
<span class="line-added">1554 </span>
<span class="line-added">1555     private String hex(long a, int b) {</span>
<span class="line-added">1556         return &quot;: &quot; + Long.toHexString(a) + &quot;, must be &quot; + Integer.toHexString(b);</span>
<span class="line-added">1557     }</span>
1558 
<a name="247" id="anc247"></a><span class="line-modified">1559     private void printTestName(String test, TestRandom random, int length, String message) {</span>
<span class="line-modified">1560         out.println( &quot;[&quot; + sortingHelper + &quot;] &#39;&quot; + test +</span>
<span class="line-added">1561             &quot;&#39; length = &quot; + length + &quot;, random = &quot; + random + message);</span>
<span class="line-added">1562     }</span>
<span class="line-added">1563 </span>
<span class="line-added">1564     private static enum TypeConverter {</span>
<span class="line-added">1565         LONG {</span>
<span class="line-added">1566             void convert(int[] src, Object dst) {</span>
<span class="line-added">1567                 long[] b = (long[]) dst;</span>
<span class="line-added">1568 </span>
<span class="line-added">1569                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">1570                     b[i] = (long) src[i];</span>
1571                 }
<a name="248" id="anc248"></a><span class="line-modified">1572             }</span>
<span class="line-modified">1573         },</span>
<span class="line-added">1574 </span>
<span class="line-added">1575         BYTE {</span>
<span class="line-added">1576             void convert(int[] src, Object dst) {</span>
<span class="line-added">1577                 byte[] b = (byte[]) dst;</span>
<span class="line-added">1578 </span>
<span class="line-added">1579                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">1580                     b[i] = (byte) src[i];</span>
1581                 }
1582             }
<a name="249" id="anc249"></a><span class="line-modified">1583         },</span>

1584 
<a name="250" id="anc250"></a><span class="line-modified">1585         CHAR {</span>
<span class="line-modified">1586             void convert(int[] src, Object dst) {</span>
<span class="line-modified">1587                 char[] b = (char[]) dst;</span>
1588 
<a name="251" id="anc251"></a><span class="line-modified">1589                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-modified">1590                     b[i] = (char) src[i];</span>
<span class="line-modified">1591                 }</span>
<span class="line-modified">1592             }</span>
<span class="line-modified">1593         },</span>
<span class="line-modified">1594 </span>
<span class="line-modified">1595         SHORT {</span>
<span class="line-added">1596             void convert(int[] src, Object dst) {</span>
<span class="line-added">1597                 short[] b = (short[]) dst;</span>
1598 
<a name="252" id="anc252"></a><span class="line-modified">1599                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-modified">1600                     b[i] = (short) src[i];</span>
<span class="line-added">1601                 }</span>
1602             }
<a name="253" id="anc253"></a><span class="line-modified">1603         },</span>


1604 
<a name="254" id="anc254"></a><span class="line-modified">1605         FLOAT {</span>
<span class="line-modified">1606             void convert(int[] src, Object dst) {</span>
<span class="line-added">1607                 float[] b = (float[]) dst;</span>
<span class="line-added">1608 </span>
<span class="line-added">1609                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">1610                     b[i] = (float) src[i];</span>
1611                 }
<a name="255" id="anc255"></a><span class="line-modified">1612             }</span>
<span class="line-modified">1613         },</span>
<span class="line-added">1614 </span>
<span class="line-added">1615         DOUBLE {</span>
<span class="line-added">1616             void convert(int[] src, Object dst) {</span>
<span class="line-added">1617                 double[] b = (double[]) dst;</span>
<span class="line-added">1618 </span>
<span class="line-added">1619                 for (int i = 0; i &lt; src.length; i++) {</span>
<span class="line-added">1620                     b[i] = (double) src[i];</span>
1621                 }
1622             }
<a name="256" id="anc256"></a><span class="line-modified">1623         };</span>
<span class="line-added">1624 </span>
<span class="line-added">1625         abstract void convert(int[] src, Object dst);</span>
1626     }
1627 
<a name="257" id="anc257"></a><span class="line-modified">1628     private static enum SortedBuilder {</span>
<span class="line-modified">1629         STEPS {</span>
<span class="line-modified">1630             void build(int[] a, int m) {</span>
<span class="line-added">1631                 for (int i = 0; i &lt; m; i++) {</span>
<span class="line-added">1632                     a[i] = 0;</span>
<span class="line-added">1633                 }</span>
1634 
<a name="258" id="anc258"></a><span class="line-modified">1635                 for (int i = m; i &lt; a.length; i++) {</span>
<span class="line-modified">1636                     a[i] = 1;</span>
<span class="line-modified">1637                 }</span>
<span class="line-modified">1638             }</span>
<span class="line-modified">1639         };</span>


1640 
<a name="259" id="anc259"></a><span class="line-modified">1641         abstract void build(int[] a, int m);</span>
<span class="line-modified">1642     }</span>
<span class="line-added">1643 </span>
<span class="line-added">1644     private static enum UnsortedBuilder {</span>
<span class="line-added">1645         RANDOM {</span>
<span class="line-added">1646             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1647                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1648                     a[i] = random.nextInt();</span>
<span class="line-added">1649                 }</span>
1650             }
<a name="260" id="anc260"></a><span class="line-modified">1651         },</span>


1652 
<a name="261" id="anc261"></a><span class="line-modified">1653         ASCENDING {</span>
<span class="line-modified">1654             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1655                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1656                     a[i] = m + i;</span>
1657                 }
<a name="262" id="anc262"></a><span class="line-modified">1658             }</span>
<span class="line-modified">1659         },</span>
<span class="line-added">1660 </span>
<span class="line-added">1661         DESCENDING {</span>
<span class="line-added">1662             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1663                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1664                     a[i] = a.length - m - i;</span>
1665                 }
1666             }
<a name="263" id="anc263"></a><span class="line-modified">1667         },</span>

1668 
<a name="264" id="anc264"></a><span class="line-modified">1669         EQUAL {</span>
<span class="line-modified">1670             void build(int[] a, int m, Random random) {</span>
<span class="line-modified">1671                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1672                     a[i] = m;</span>
<span class="line-added">1673                 }</span>
<span class="line-added">1674             }</span>
<span class="line-added">1675         },</span>
1676 
<a name="265" id="anc265"></a><span class="line-modified">1677         SAW {</span>
<span class="line-modified">1678             void build(int[] a, int m, Random random) {</span>
<span class="line-modified">1679                 int incCount = 1;</span>
<span class="line-modified">1680                 int decCount = a.length;</span>
<span class="line-modified">1681                 int i = 0;</span>
<span class="line-modified">1682                 int period = m--;</span>

1683 
<a name="266" id="anc266"></a><span class="line-modified">1684                 while (true) {</span>
<span class="line-modified">1685                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-added">1686                         if (i &gt;= a.length) {</span>
<span class="line-added">1687                             return;</span>
<span class="line-added">1688                         }</span>
<span class="line-added">1689                         a[i++] = incCount++;</span>
<span class="line-added">1690                     }</span>
<span class="line-added">1691                     period += m;</span>
<span class="line-added">1692 </span>
<span class="line-added">1693                     for (int k = 1; k &lt;= period; k++) {</span>
<span class="line-added">1694                         if (i &gt;= a.length) {</span>
<span class="line-added">1695                             return;</span>
<span class="line-added">1696                         }</span>
<span class="line-added">1697                         a[i++] = decCount--;</span>
<span class="line-added">1698                     }</span>
<span class="line-added">1699                     period += m;</span>
<span class="line-added">1700                 }</span>
1701             }
<a name="267" id="anc267"></a><span class="line-modified">1702         },</span>


1703 
<a name="268" id="anc268"></a><span class="line-modified">1704         REPEATED {</span>
<span class="line-modified">1705             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1706                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1707                     a[i] = i % m;</span>
1708                 }
<a name="269" id="anc269"></a><span class="line-modified">1709             }</span>
<span class="line-modified">1710         },</span>
<span class="line-added">1711 </span>
<span class="line-added">1712         DUPLICATED {</span>
<span class="line-added">1713             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1714                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1715                     a[i] = random.nextInt(m);</span>
1716                 }
1717             }
<a name="270" id="anc270"></a><span class="line-modified">1718         },</span>

1719 
<a name="271" id="anc271"></a><span class="line-modified">1720         ORGAN_PIPES {</span>
<span class="line-modified">1721             void build(int[] a, int m, Random random) {</span>
<span class="line-modified">1722                 int middle = a.length / (m + 1);</span>
1723 
<a name="272" id="anc272"></a><span class="line-modified">1724                 for (int i = 0; i &lt; middle; i++) {</span>
<span class="line-modified">1725                     a[i] = i;</span>
<span class="line-modified">1726                 }</span>




1727 
<a name="273" id="anc273"></a><span class="line-modified">1728                 for (int i = middle; i &lt; a.length; i++) {</span>
<span class="line-modified">1729                     a[i] = a.length - i - 1;</span>
<span class="line-added">1730                 }</span>
1731             }
<a name="274" id="anc274"></a><span class="line-modified">1732         },</span>


1733 
<a name="275" id="anc275"></a><span class="line-modified">1734         STAGGER {</span>
<span class="line-modified">1735             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1736                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1737                     a[i] = (i * m + i) % a.length;</span>
1738                 }
<a name="276" id="anc276"></a><span class="line-modified">1739             }</span>
<span class="line-modified">1740         },</span>
<span class="line-added">1741 </span>
<span class="line-added">1742         PLATEAU {</span>
<span class="line-added">1743             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1744                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1745                     a[i] = Math.min(i, m);</span>
1746                 }
1747             }
<a name="277" id="anc277"></a><span class="line-modified">1748         },</span>
<span class="line-added">1749 </span>
<span class="line-added">1750         SHUFFLE {</span>
<span class="line-added">1751             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1752                 int x = 0, y = 0;</span>
<span class="line-added">1753 </span>
<span class="line-added">1754                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1755                     a[i] = random.nextBoolean() ? (x += 2) : (y += 2);</span>
<span class="line-added">1756                 }</span>
<span class="line-added">1757             }</span>
<span class="line-added">1758         },</span>
<span class="line-added">1759 </span>
<span class="line-added">1760         LATCH {</span>
<span class="line-added">1761             void build(int[] a, int m, Random random) {</span>
<span class="line-added">1762                 int max = a.length / m;</span>
<span class="line-added">1763                 max = max &lt; 2 ? 2 : max;</span>
<span class="line-added">1764 </span>
<span class="line-added">1765                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1766                     a[i] = i % max;</span>
<span class="line-added">1767                 }</span>
<span class="line-added">1768             }</span>
<span class="line-added">1769         };</span>
<span class="line-added">1770 </span>
<span class="line-added">1771         abstract void build(int[] a, int m, Random random);</span>
1772     }
1773 
<a name="278" id="anc278"></a><span class="line-modified">1774     private static enum MergingBuilder {</span>
<span class="line-modified">1775         ASCENDING {</span>
<span class="line-modified">1776             void build(int[] a, int m) {</span>
<span class="line-added">1777                 int period = a.length / m;</span>
<span class="line-added">1778                 int v = 1, i = 0;</span>
1779 
<a name="279" id="anc279"></a><span class="line-modified">1780                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-modified">1781                     v = 1;</span>
<span class="line-modified">1782 </span>
<span class="line-modified">1783                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-modified">1784                         a[i++] = v++;</span>
<span class="line-modified">1785                     }</span>
<span class="line-modified">1786                 }</span>
1787 
<a name="280" id="anc280"></a><span class="line-modified">1788                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-modified">1789                     a[j] = v++;</span>
<span class="line-added">1790                 }</span>
<span class="line-added">1791 </span>
<span class="line-added">1792                 a[a.length - 1] = 0;</span>
1793             }
<a name="281" id="anc281"></a><span class="line-modified">1794         },</span>


1795 
<a name="282" id="anc282"></a><span class="line-modified">1796         DESCENDING {</span>
<span class="line-modified">1797             void build(int[] a, int m) {</span>
<span class="line-added">1798                 int period = a.length / m;</span>
<span class="line-added">1799                 int v = -1, i = 0;</span>
<span class="line-added">1800 </span>
<span class="line-added">1801                 for (int k = 0; k &lt; m; k++) {</span>
<span class="line-added">1802                     v = -1;</span>
<span class="line-added">1803 </span>
<span class="line-added">1804                     for (int p = 0; p &lt; period; p++) {</span>
<span class="line-added">1805                         a[i++] = v--;</span>
<span class="line-added">1806                     }</span>
1807                 }
<a name="283" id="anc283"></a><span class="line-modified">1808 </span>
<span class="line-modified">1809                 for (int j = i; j &lt; a.length - 1; j++) {</span>
<span class="line-added">1810                     a[j] = v--;</span>
1811                 }
<a name="284" id="anc284"></a><span class="line-added">1812 </span>
<span class="line-added">1813                 a[a.length - 1] = 0;</span>
1814             }
<a name="285" id="anc285"></a><span class="line-modified">1815         },</span>

1816 
<a name="286" id="anc286"></a><span class="line-modified">1817         POINT {</span>
<span class="line-modified">1818             void build(int[] a, int m) {</span>
<span class="line-modified">1819                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1820                     a[i] = 0;</span>
<span class="line-added">1821                 }</span>
<span class="line-added">1822                 a[a.length / 2] = m;</span>
<span class="line-added">1823             }</span>
<span class="line-added">1824         },</span>
1825 
<a name="287" id="anc287"></a><span class="line-modified">1826         LINE {</span>
<span class="line-modified">1827             void build(int[] a, int m) {</span>
<span class="line-modified">1828                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-modified">1829                     a[i] = i;</span>
<span class="line-modified">1830                 }</span>
<span class="line-modified">1831                 reverse(a, 0, a.length - 1);</span>
<span class="line-modified">1832             }</span>
<span class="line-added">1833         },</span>
1834 
<a name="288" id="anc288"></a><span class="line-modified">1835         PEARL {</span>
<span class="line-modified">1836             void build(int[] a, int m) {</span>
<span class="line-added">1837                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1838                     a[i] = i;</span>
<span class="line-added">1839                 }</span>
<span class="line-added">1840                 reverse(a, 0, 2);</span>
1841             }
<a name="289" id="anc289"></a><span class="line-modified">1842         },</span>
<span class="line-modified">1843 </span>
<span class="line-modified">1844         RING {</span>
<span class="line-added">1845             void build(int[] a, int m) {</span>
<span class="line-added">1846                 int k1 = a.length / 3;</span>
<span class="line-added">1847                 int k2 = a.length / 3 * 2;</span>
<span class="line-added">1848                 int level = a.length / 3;</span>
1849 
<a name="290" id="anc290"></a><span class="line-modified">1850                 for (int i = 0, k = level; i &lt; k1; i++) {</span>
<span class="line-modified">1851                     a[i] = k--;</span>
1852                 }
<a name="291" id="anc291"></a><span class="line-modified">1853 </span>
<span class="line-modified">1854                 for (int i = k1; i &lt; k2; i++) {</span>
<span class="line-added">1855                     a[i] = 0;</span>
<span class="line-added">1856                 }</span>
<span class="line-added">1857 </span>
<span class="line-added">1858                 for (int i = k2, k = level; i &lt; a.length; i++) {</span>
<span class="line-added">1859                     a[i] = k--;</span>
1860                 }
1861             }
<a name="292" id="anc292"></a><span class="line-added">1862         };</span>
<span class="line-added">1863 </span>
<span class="line-added">1864         abstract void build(int[] a, int m);</span>
<span class="line-added">1865 </span>
<span class="line-added">1866         private static void reverse(int[] a, int lo, int hi) {</span>
<span class="line-added">1867             for (--hi; lo &lt; hi; ) {</span>
<span class="line-added">1868                 int tmp = a[lo];</span>
<span class="line-added">1869                 a[lo++] = a[hi];</span>
<span class="line-added">1870                 a[hi--] = tmp;</span>
<span class="line-added">1871             }</span>
1872         }
1873     }
1874 
<a name="293" id="anc293"></a><span class="line-modified">1875     private static enum NegativeZeroBuilder {</span>
<span class="line-modified">1876         FLOAT {</span>
<span class="line-modified">1877             void build(Object o, Random random) {</span>
<span class="line-modified">1878                 float[] a = (float[]) o;</span>
<span class="line-modified">1879 </span>
<span class="line-added">1880                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1881                     a[i] = random.nextBoolean() ? -0.0f : 0.0f;</span>
<span class="line-added">1882                 }</span>
<span class="line-added">1883             }</span>
<span class="line-added">1884         },</span>
<span class="line-added">1885 </span>
<span class="line-added">1886         DOUBLE {</span>
<span class="line-added">1887             void build(Object o, Random random) {</span>
<span class="line-added">1888                 double[] a = (double[]) o;</span>
<span class="line-added">1889 </span>
<span class="line-added">1890                 for (int i = 0; i &lt; a.length; i++) {</span>
<span class="line-added">1891                     a[i] = random.nextBoolean() ? -0.0d : 0.0d;</span>
<span class="line-added">1892                 }</span>
<span class="line-added">1893             }</span>
<span class="line-added">1894         };</span>
<span class="line-added">1895 </span>
<span class="line-added">1896         abstract void build(Object o, Random random);</span>
1897     }
1898 
<a name="294" id="anc294"></a><span class="line-modified">1899     private static enum FloatingPointBuilder {</span>
<span class="line-modified">1900         FLOAT {</span>
<span class="line-modified">1901             void build(Object o, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-added">1902                 float negativeValue = -random.nextFloat();</span>
<span class="line-added">1903                 float positiveValue =  random.nextFloat();</span>
<span class="line-added">1904                 float[] x = (float[]) o;</span>
<span class="line-added">1905                 int fromIndex = 0;</span>
<span class="line-added">1906 </span>
<span class="line-added">1907                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-added">1908                 fromIndex += n;</span>
<span class="line-added">1909 </span>
<span class="line-added">1910                 writeValue(x, -0.0f, fromIndex, g);</span>
<span class="line-added">1911                 fromIndex += g;</span>
<span class="line-added">1912 </span>
<span class="line-added">1913                 writeValue(x, 0.0f, fromIndex, z);</span>
<span class="line-added">1914                 fromIndex += z;</span>
<span class="line-added">1915 </span>
<span class="line-added">1916                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-added">1917                 fromIndex += p;</span>
<span class="line-added">1918 </span>
<span class="line-added">1919                 writeValue(x, Float.NaN, fromIndex, a);</span>
<span class="line-added">1920             }</span>
<span class="line-added">1921         },</span>
<span class="line-added">1922 </span>
<span class="line-added">1923         DOUBLE {</span>
<span class="line-added">1924             void build(Object o, int a, int g, int z, int n, int p, Random random) {</span>
<span class="line-added">1925                 double negativeValue = -random.nextFloat();</span>
<span class="line-added">1926                 double positiveValue =  random.nextFloat();</span>
<span class="line-added">1927                 double[] x = (double[]) o;</span>
<span class="line-added">1928                 int fromIndex = 0;</span>
<span class="line-added">1929 </span>
<span class="line-added">1930                 writeValue(x, negativeValue, fromIndex, n);</span>
<span class="line-added">1931                 fromIndex += n;</span>
<span class="line-added">1932 </span>
<span class="line-added">1933                 writeValue(x, -0.0d, fromIndex, g);</span>
<span class="line-added">1934                 fromIndex += g;</span>
<span class="line-added">1935 </span>
<span class="line-added">1936                 writeValue(x, 0.0d, fromIndex, z);</span>
<span class="line-added">1937                 fromIndex += z;</span>
<span class="line-added">1938 </span>
<span class="line-added">1939                 writeValue(x, positiveValue, fromIndex, p);</span>
<span class="line-added">1940                 fromIndex += p;</span>
<span class="line-added">1941 </span>
<span class="line-added">1942                 writeValue(x, Double.NaN, fromIndex, a);</span>
<span class="line-added">1943             }</span>
<span class="line-added">1944         };</span>
<span class="line-added">1945 </span>
<span class="line-added">1946         abstract void build(Object o, int a, int g, int z, int n, int p, Random random);</span>
<span class="line-added">1947 </span>
<span class="line-added">1948         private static void writeValue(float[] a, float value, int fromIndex, int count) {</span>
<span class="line-added">1949             for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-added">1950                 a[i] = value;</span>
<span class="line-added">1951             }</span>
1952         }
<a name="295" id="anc295"></a>

1953 
<a name="296" id="anc296"></a><span class="line-modified">1954         private static void writeValue(double[] a, double value, int fromIndex, int count) {</span>
<span class="line-modified">1955             for (int i = fromIndex; i &lt; fromIndex + count; i++) {</span>
<span class="line-modified">1956                 a[i] = value;</span>
<span class="line-added">1957             }</span>
1958         }
<a name="297" id="anc297"></a>
1959     }
1960 
<a name="298" id="anc298"></a><span class="line-modified">1961     private static Comparator&lt;Pair&gt; pairComparator = new Comparator&lt;Pair&gt;() {</span>
<span class="line-modified">1962 </span>
<span class="line-modified">1963         @Override</span>
<span class="line-added">1964         public int compare(Pair p1, Pair p2) {</span>
<span class="line-added">1965             return p1.compareTo(p2);</span>
1966         }
<a name="299" id="anc299"></a><span class="line-modified">1967     };</span>
<span class="line-added">1968 </span>
<span class="line-added">1969     private static class Pair implements Comparable&lt;Pair&gt; {</span>
<span class="line-added">1970 </span>
<span class="line-added">1971         private Pair(int key, int value) {</span>
<span class="line-added">1972             this.key = key;</span>
<span class="line-added">1973             this.value = value;</span>
<span class="line-added">1974         }</span>
<span class="line-added">1975 </span>
<span class="line-added">1976         int getKey() {</span>
<span class="line-added">1977             return key;</span>
<span class="line-added">1978         }</span>
<span class="line-added">1979 </span>
<span class="line-added">1980         int getValue() {</span>
<span class="line-added">1981             return value;</span>
<span class="line-added">1982         }</span>
<span class="line-added">1983 </span>
<span class="line-added">1984         @Override</span>
<span class="line-added">1985         public int compareTo(Pair pair) {</span>
<span class="line-added">1986             return Integer.compare(key, pair.key);</span>
<span class="line-added">1987         }</span>
<span class="line-added">1988 </span>
<span class="line-added">1989         @Override</span>
<span class="line-added">1990         public String toString() {</span>
<span class="line-added">1991             return &quot;(&quot; + key + &quot;, &quot; + value + &quot;)&quot;;</span>
<span class="line-added">1992         }</span>
<span class="line-added">1993 </span>
<span class="line-added">1994         private int key;</span>
<span class="line-added">1995         private int value;</span>
1996     }
1997 
<a name="300" id="anc300"></a><span class="line-modified">1998     private static class TestRandom extends Random {</span>
<span class="line-modified">1999 </span>
<span class="line-added">2000         private static final TestRandom BABA = new TestRandom(0xBABA);</span>
<span class="line-added">2001         private static final TestRandom DEDA = new TestRandom(0xDEDA);</span>
<span class="line-added">2002         private static final TestRandom C0FFEE = new TestRandom(0xC0FFEE);</span>
<span class="line-added">2003 </span>
<span class="line-added">2004         private TestRandom(long seed) {</span>
2005             super(seed);
<a name="301" id="anc301"></a><span class="line-modified">2006             this.seed = Long.toHexString(seed).toUpperCase();</span>
2007         }
2008 
<a name="302" id="anc302"></a><span class="line-modified">2009         @Override</span>
<span class="line-modified">2010         public String toString() {</span>
<span class="line-added">2011             return seed;</span>
2012         }
2013 
<a name="303" id="anc303"></a><span class="line-modified">2014         private String seed;</span>
2015     }
<a name="304" id="anc304"></a>

2016 }
<a name="305" id="anc305"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="305" type="hidden" />
</body>
</html>