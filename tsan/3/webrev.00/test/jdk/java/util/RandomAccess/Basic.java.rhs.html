<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/util/RandomAccess/Basic.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
<a name="2" id="anc2"></a><span class="line-modified"> 24 /**</span>
 25  * @test
<a name="3" id="anc3"></a><span class="line-modified"> 26  * @bug 4327164 8229338</span>
 27  * @summary Basic test for new RandomAccess interface
<a name="4" id="anc4"></a><span class="line-added"> 28  * @run testng Basic</span>
 29  */
 30 
<a name="5" id="anc5"></a><span class="line-modified"> 31 import org.testng.annotations.DataProvider;</span>
<span class="line-modified"> 32 import org.testng.annotations.Test;</span>
<span class="line-modified"> 33 </span>
<span class="line-modified"> 34 import static org.testng.Assert.assertEquals;</span>
<span class="line-modified"> 35 </span>
<span class="line-modified"> 36 import java.util.*;</span>
<span class="line-modified"> 37 import java.util.concurrent.CopyOnWriteArrayList;</span>
<span class="line-modified"> 38 import java.util.function.Function;</span>
<span class="line-added"> 39 import java.util.function.Supplier;</span>
 40 
 41 public class Basic {
<a name="6" id="anc6"></a>














































 42 
<a name="7" id="anc7"></a><span class="line-modified"> 43     /*</span>
<span class="line-modified"> 44      * Lists which implement Random Access interface</span>
<span class="line-modified"> 45      */</span>
<span class="line-modified"> 46     @DataProvider(name = &quot;testLists&quot;)</span>
<span class="line-modified"> 47     public Object[][] testData() {</span>
<span class="line-modified"> 48         var intArray = new Integer[100];</span>
<span class="line-added"> 49         var stack = new Stack&lt;&gt;();</span>
<span class="line-added"> 50         var random = new Random();</span>
 51         for (int i = 0; i &lt; 100; i++) {
<a name="8" id="anc8"></a><span class="line-modified"> 52             var r = random.nextInt(100);</span>
<span class="line-modified"> 53             stack.push(r);</span>
<span class="line-modified"> 54             intArray[i] = r;</span>
<span class="line-modified"> 55         }</span>
<span class="line-added"> 56         List&lt;Integer&gt; list = Arrays.asList(intArray);</span>
<span class="line-added"> 57         return new Object[][]{</span>
<span class="line-added"> 58                 {list, true, &quot;Arrays.asList&quot;},</span>
<span class="line-added"> 59                 {stack, true, &quot;Stack&quot;},</span>
<span class="line-added"> 60                 {new ArrayList&lt;&gt;(list), true, &quot;ArrayList&quot;},</span>
<span class="line-added"> 61                 {new LinkedList&lt;&gt;(list), false, &quot;LinkedList&quot;},</span>
<span class="line-added"> 62                 {new Vector&lt;&gt;(list), true, &quot;Vector&quot;},</span>
<span class="line-added"> 63                 {new CopyOnWriteArrayList&lt;&gt;(list), true, &quot;CopyOnWriteArrayList&quot;}</span>
<span class="line-added"> 64         };</span>
<span class="line-added"> 65     }</span>
<span class="line-added"> 66 </span>
<span class="line-added"> 67     @Test(dataProvider = &quot;testLists&quot;)</span>
<span class="line-added"> 68     public void testRandomAccess(List&lt;Integer&gt; list, boolean expectedRA, String failMsg) {</span>
<span class="line-added"> 69 </span>
<span class="line-added"> 70         var actualRA = list instanceof RandomAccess;</span>
<span class="line-added"> 71         assertEquals(actualRA, expectedRA, failMsg);</span>
<span class="line-added"> 72 </span>
<span class="line-added"> 73         List&lt;Integer&gt; unmodList = Collections.unmodifiableList(list);</span>
<span class="line-added"> 74         List&lt;Integer&gt; syncList = Collections.synchronizedList(list);</span>
<span class="line-added"> 75         assertEquals((unmodList instanceof RandomAccess), actualRA,</span>
<span class="line-added"> 76                 &quot;Unmodifiable fails to preserve RandomAccess&quot;);</span>
<span class="line-added"> 77         assertEquals((syncList instanceof RandomAccess), actualRA,</span>
<span class="line-added"> 78                 &quot;Synchronized fails to preserve RandomAccess&quot;);</span>
<span class="line-added"> 79 </span>
<span class="line-added"> 80         while (list.size() &gt; 0) {</span>
<span class="line-added"> 81             list = list.subList(0, list.size() - 1);</span>
<span class="line-added"> 82             assertEquals((list instanceof RandomAccess), actualRA,</span>
<span class="line-added"> 83                     &quot;SubList fails to preserve RandomAccess: &quot; + list.size());</span>
<span class="line-added"> 84 </span>
<span class="line-added"> 85             unmodList = unmodList.subList(0, unmodList.size() - 1);</span>
<span class="line-added"> 86             assertEquals((unmodList instanceof RandomAccess), actualRA,</span>
<span class="line-added"> 87                     &quot;SubList(unmodifiable) fails to preserve RandomAccess: &quot;</span>
<span class="line-added"> 88                             + unmodList.size());</span>
<span class="line-added"> 89 </span>
<span class="line-added"> 90             syncList = syncList.subList(0, syncList.size() - 1);</span>
<span class="line-added"> 91             assertEquals((syncList instanceof RandomAccess), actualRA,</span>
<span class="line-added"> 92                     &quot;SubList(synchronized) fails to preserve RandomAccess: &quot;</span>
<span class="line-added"> 93                             + syncList.size());</span>
 94         }
<a name="9" id="anc9"></a><span class="line-added"> 95     }</span>
 96 
<a name="10" id="anc10"></a><span class="line-modified"> 97     @Test(dataProvider = &quot;testLists&quot;)</span>
<span class="line-modified"> 98     public void testListCopy(List&lt;Integer&gt; list, boolean expectedRA, String failMsg) {</span>
<span class="line-modified"> 99         ArrayList testCollection = new ArrayList&lt;&gt;(Collections.nCopies(100, 0));</span>
<span class="line-modified">100         // Test that copy works on random &amp; sequential access</span>
<span class="line-modified">101         Collections.copy(list, testCollection);</span>
<span class="line-modified">102         assertEquals(list, testCollection, &quot;Copy failed: &quot; + failMsg);</span>
<span class="line-modified">103     }</span>

104 
<a name="11" id="anc11"></a><span class="line-added">105     @Test(dataProvider = &quot;testLists&quot;)</span>
<span class="line-added">106     public void testListFill(List&lt;Integer&gt; list, boolean expectedRA, String failMsg) {</span>
<span class="line-added">107         ArrayList testCollection = new ArrayList&lt;&gt;(Collections.nCopies(100, 0));</span>
108         // Test that copy works on random &amp; sequential access
<a name="12" id="anc12"></a><span class="line-modified">109         Collections.fill(list, 0);</span>
<span class="line-modified">110         assertEquals(list, testCollection, &quot;Fill failed: &quot; + failMsg);</span>
<span class="line-modified">111     }</span>
<span class="line-modified">112 </span>
<span class="line-modified">113     /*</span>
<span class="line-modified">114      * Test that shuffle and binarySearch work the same on random and sequential access lists.</span>
<span class="line-modified">115      */</span>
<span class="line-modified">116     @DataProvider(name = &quot;testFactoryLists&quot;)</span>
<span class="line-modified">117     public Object[][] testDataFactory() {</span>
<span class="line-modified">118         return new Object[][]{</span>
<span class="line-modified">119                 {&quot;ArrayList -&gt; LinkedList&quot;, supplier(ArrayList::new), copyCtor(LinkedList::new)},</span>
<span class="line-modified">120                 {&quot;CopyOnWriteArrayList -&gt; Stack&quot;, supplier(CopyOnWriteArrayList::new),</span>
<span class="line-modified">121                         copyCtor((list) -&gt; { var s = new Stack();s.addAll(list);return s; })}</span>
<span class="line-added">122         };</span>
<span class="line-added">123     }</span>
<span class="line-added">124 </span>
<span class="line-added">125     private Supplier&lt;List&lt;Integer&gt;&gt; supplier(Supplier&lt;List&lt;Integer&gt;&gt; supplier) {</span>
<span class="line-added">126         return supplier;</span>
<span class="line-added">127     }</span>
<span class="line-added">128 </span>
<span class="line-added">129     private Function&lt;List&lt;Integer&gt;, List&lt;Integer&gt;&gt; copyCtor(Function&lt;List&lt;Integer&gt;, List&lt;Integer&gt;&gt; ctor) {</span>
<span class="line-added">130         return ctor;</span>
<span class="line-added">131     }</span>
<span class="line-added">132 </span>
<span class="line-added">133     @Test(dataProvider = &quot;testFactoryLists&quot;)</span>
<span class="line-added">134     public void testListShuffle(String description, Supplier&lt;List&lt;Integer&gt;&gt; randomAccessListSupplier,</span>
<span class="line-added">135                                 Function&lt;List&lt;Integer&gt;, List&lt;Integer&gt;&gt; otherListFactory) {</span>
<span class="line-added">136 </span>
<span class="line-added">137         //e.g: ArrayList&lt;Integer&gt; al = new ArrayList&lt;&gt;();</span>
<span class="line-added">138         List&lt;Integer&gt; l1 = randomAccessListSupplier.get();</span>
<span class="line-added">139         for (int j = 0; j &lt; 100; j++) {</span>
<span class="line-added">140             l1.add(Integer.valueOf(2 * j));</span>
<span class="line-added">141         }</span>
<span class="line-added">142         // e.g: List&lt;Integer&gt; ll = new LinkedList&lt;&gt;(al);</span>
<span class="line-added">143         List&lt;Integer&gt; l2 = otherListFactory.apply(l1);</span>
<span class="line-added">144         for (int i = 0; i &lt; 100; i++) {</span>
<span class="line-added">145             Collections.shuffle(l1, new Random(666));</span>
<span class="line-added">146             Collections.shuffle(l2, new Random(666));</span>
<span class="line-added">147             assertEquals(l1, l2, &quot;Shuffle failed: &quot; + description);</span>
<span class="line-added">148         }</span>
<span class="line-added">149     }</span>
<span class="line-added">150 </span>
<span class="line-added">151     @Test(dataProvider = &quot;testFactoryLists&quot;)</span>
<span class="line-added">152     public void testListBinarySearch(String description, Supplier&lt;List&lt;Integer&gt;&gt; randomAccessListSupplier,</span>
<span class="line-added">153                                      Function&lt;List&lt;Integer&gt;, List&lt;Integer&gt;&gt; otherListFactory) {</span>
<span class="line-added">154 </span>
<span class="line-added">155         //e.g: ArrayList&lt;Integer&gt; al = new ArrayList&lt;&gt;();</span>
<span class="line-added">156         List&lt;Integer&gt; l1 = randomAccessListSupplier.get();</span>
<span class="line-added">157         for (int i = 0; i &lt; 10000; i++) {</span>
<span class="line-added">158             l1.add(Integer.valueOf(2 * i));</span>
<span class="line-added">159         }</span>
<span class="line-added">160         // e.g: List&lt;Integer&gt; ll = new LinkedList&lt;&gt;(al);</span>
<span class="line-added">161         List&lt;Integer&gt; l2 = otherListFactory.apply(l1);</span>
162         for (int i = 0; i &lt; 500; i++) {
<a name="13" id="anc13"></a><span class="line-modified">163             Integer key = Integer.valueOf(new Random(666).nextInt(20000));</span>
<span class="line-modified">164             assertEquals(Collections.binarySearch(l1, key), Collections</span>
<span class="line-modified">165                     .binarySearch(l2, key), &quot;Binary search failed: &quot; + description);</span>

166         }
167     }
168 }
<a name="14" id="anc14"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="14" type="hidden" />
</body>
</html>