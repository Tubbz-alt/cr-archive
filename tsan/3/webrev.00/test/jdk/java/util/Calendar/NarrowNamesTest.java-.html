<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/jdk/java/util/Calendar/NarrowNamesTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8000983 8008577
 27  * @summary Unit test for narrow names support. This test is locale data-dependent
 28  *          and assumes that both JRE and CLDR have the same narrow names.
 29  * @modules jdk.localedata
 30  * @comment Locale providers: JRE,SPI
 31  * @run main/othervm -Djava.locale.providers=JRE,SPI NarrowNamesTest JRE,SPI
 32  * @comment Locale providers: CLDR
 33  * @run main/othervm -Djava.locale.providers=CLDR NarrowNamesTest CLDR
 34  */
 35 
 36 import java.time.LocalDateTime;
 37 import java.util.Calendar;
 38 import java.util.Comparator;
 39 import java.util.Locale;
 40 import java.util.Map;
 41 import java.util.TreeMap;
 42 import static java.util.GregorianCalendar.*;
 43 
 44 public class NarrowNamesTest {
 45     private static final Locale US = Locale.US;
 46     private static final Locale JAJPJP = new Locale(&quot;ja&quot;, &quot;JP&quot;, &quot;JP&quot;);
 47     private static final Locale THTH = new Locale(&quot;th&quot;, &quot;TH&quot;);
 48 
 49     private static final String RESET_INDEX = &quot;RESET_INDEX&quot;;
 50 
 51     private static int errors = 0;
 52 
 53     private static String providers;
 54 
 55     // This test is locale data-dependent.
 56     public static void main(String[] args) {
 57         providers = args[0];
 58 
 59         test(US, ERA, &quot;B&quot;,
 60              ERA, BC, YEAR, 1);
 61         test(US, ERA, &quot;A&quot;,
 62              ERA, AD, YEAR, 2012);
 63         test(US, DAY_OF_WEEK, &quot;S&quot;,
 64              YEAR, 2012, MONTH, DECEMBER, DAY_OF_MONTH, 23);
 65         test(US, AM_PM, &quot;a&quot;,
 66              HOUR_OF_DAY, 10);
 67         test(US, AM_PM, &quot;p&quot;,
 68              HOUR_OF_DAY, 23);
 69         test(JAJPJP, DAY_OF_WEEK,
 70              LocalDateTime.now().isBefore(LocalDateTime.of(2019, 5, 1, 0, 0)) ?
 71                 &quot;\u65e5&quot; : &quot;\u706b&quot;, // &quot;Sun&quot; for HEISEI, &quot;Tue&quot; for NEWERA
 72              YEAR, 24, MONTH, DECEMBER, DAY_OF_MONTH, 23);
 73         test(THTH, MONTH, NARROW_STANDALONE, &quot;\u0e18.\u0e04.&quot;,
 74              YEAR, 2555, MONTH, DECEMBER, DAY_OF_MONTH, 5);
 75         test(THTH, DAY_OF_WEEK, &quot;\u0e1e&quot;,
 76              YEAR, 2555, MONTH, DECEMBER, DAY_OF_MONTH, 5);
 77 
 78         testMap(US, DAY_OF_WEEK, ALL_STYLES, // shouldn&#39;t include any narrow names
 79                 &quot;&quot;, // 1-based indexing for DAY_OF_WEEK
 80                 &quot;Sunday&quot;,    // Sunday
 81                 &quot;Monday&quot;,    // Monday
 82                 &quot;Tuesday&quot;,   // Tuesday
 83                 &quot;Wednesday&quot;, // Wednesday
 84                 &quot;Thursday&quot;,  // Thursday
 85                 &quot;Friday&quot;,    // Friday
 86                 &quot;Saturday&quot;,  // Saturday
 87                 RESET_INDEX,
 88                 &quot;&quot;, // 1-based indexing for DAY_OF_WEEK
 89                 &quot;Sun&quot;,       // abb Sunday
 90                 &quot;Mon&quot;,       // abb Monday
 91                 &quot;Tue&quot;,       // abb Tuesday
 92                 &quot;Wed&quot;,       // abb Wednesday
 93                 &quot;Thu&quot;,       // abb Thursday
 94                 &quot;Fri&quot;,       // abb Friday
 95                 &quot;Sat&quot;        // abb Saturday
 96                 );
 97         testMap(US, DAY_OF_WEEK, NARROW_FORMAT); // expect null
 98         testMap(US, AM_PM, ALL_STYLES,
 99                 &quot;AM&quot;, &quot;PM&quot;,
100                 RESET_INDEX,
101                 &quot;a&quot;, &quot;p&quot;);
102         testMap(JAJPJP, DAY_OF_WEEK, NARROW_STANDALONE,
103                 &quot;&quot;, // 1-based indexing for DAY_OF_WEEK
104                 &quot;\u65e5&quot;,
105                 &quot;\u6708&quot;,
106                 &quot;\u706b&quot;,
107                 &quot;\u6c34&quot;,
108                 &quot;\u6728&quot;,
109                 &quot;\u91d1&quot;,
110                 &quot;\u571f&quot;);
111         testMap(JAJPJP, DAY_OF_WEEK, NARROW_FORMAT,
112                 &quot;&quot;, // 1-based indexing for DAY_OF_WEEK
113                 &quot;\u65e5&quot;,
114                 &quot;\u6708&quot;,
115                 &quot;\u706b&quot;,
116                 &quot;\u6c34&quot;,
117                 &quot;\u6728&quot;,
118                 &quot;\u91d1&quot;,
119                 &quot;\u571f&quot;);
120         testMap(THTH, MONTH, NARROW_FORMAT,
121                 &quot;\u0e21.\u0e04.&quot;,
122                 &quot;\u0e01.\u0e1e.&quot;,
123                 &quot;\u0e21\u0e35.\u0e04.&quot;,
124                 &quot;\u0e40\u0e21.\u0e22.&quot;,
125                 &quot;\u0e1e.\u0e04.&quot;,
126                 (providers.startsWith(&quot;CLDR&quot;) ?
127                     &quot;\u0e21\u0e34.\u0e22.&quot; :
128                     &quot;\u0e21\u0e34.\u0e22&quot;),  // no last dot in JRE
129                 &quot;\u0e01.\u0e04.&quot;,
130                 &quot;\u0e2a.\u0e04.&quot;,
131                 &quot;\u0e01.\u0e22.&quot;,
132                 &quot;\u0e15.\u0e04.&quot;,
133                 &quot;\u0e1e.\u0e22.&quot;,
134                 &quot;\u0e18.\u0e04.&quot;);
135         testMap(THTH, MONTH, NARROW_STANDALONE,
136                 &quot;\u0e21.\u0e04.&quot;,
137                 &quot;\u0e01.\u0e1e.&quot;,
138                 &quot;\u0e21\u0e35.\u0e04.&quot;,
139                 &quot;\u0e40\u0e21.\u0e22.&quot;,
140                 &quot;\u0e1e.\u0e04.&quot;,
141                 &quot;\u0e21\u0e34.\u0e22.&quot;,
142                 &quot;\u0e01.\u0e04.&quot;,
143                 &quot;\u0e2a.\u0e04.&quot;,
144                 &quot;\u0e01.\u0e22.&quot;,
145                 &quot;\u0e15.\u0e04.&quot;,
146                 &quot;\u0e1e.\u0e22.&quot;,
147                 &quot;\u0e18.\u0e04.&quot;);
148 
149         if (errors != 0) {
150             throw new RuntimeException(&quot;test failed&quot;);
151         }
152     }
153 
154     private static void test(Locale locale, int field, String expected, int... data) {
155         test(locale, field, NARROW_FORMAT, expected, data);
156     }
157 
158     private static void test(Locale locale, int field, int style, String expected, int... fieldValuePairs) {
159         Calendar cal = Calendar.getInstance(locale);
160         cal.clear();
161         for (int i = 0; i &lt; fieldValuePairs.length;) {
162             int f = fieldValuePairs[i++];
163             int v = fieldValuePairs[i++];
164             cal.set(f, v);
165         }
166         String got = cal.getDisplayName(field, style, locale);
167         if (!expected.equals(got)) {
168             System.err.printf(&quot;test: locale=%s, field=%d, value=%d, style=%d, got=\&quot;%s\&quot;, expected=\&quot;%s\&quot;%n&quot;,
169                               locale, field, cal.get(field), style, got, expected);
170             errors++;
171         }
172     }
173 
174     private static void testMap(Locale locale, int field, int style, String... expected) {
175         Map&lt;String, Integer&gt; expectedMap = null;
176         if (expected.length &gt; 0) {
177             expectedMap = new TreeMap&lt;&gt;(LengthBasedComparator.INSTANCE);
178             int index = 0;
179             for (int i = 0; i &lt; expected.length; i++) {
180                 if (expected[i].isEmpty()) {
181                     index++;
182                     continue;
183                 }
184                 if (expected[i] == RESET_INDEX) {
185                     index = 0;
186                     continue;
187                 }
188                 expectedMap.put(expected[i], index++);
189             }
190         }
191         Calendar cal = Calendar.getInstance(locale);
192         Map&lt;String, Integer&gt; got = cal.getDisplayNames(field, style, locale);
193         if (!(expectedMap == null &amp;&amp; got == null)
194             &amp;&amp; !(expectedMap != null &amp;&amp; expectedMap.equals(got))) {
195             System.err.printf(&quot;testMap: locale=%s, field=%d, style=%d, expected=%s, got=%s%n&quot;,
196                               locale, field, style, expectedMap, got);
197             errors++;
198         }
199     }
200 
201     /**
202      * Comparator implementation for TreeMap which iterates keys from longest
203      * to shortest.
204      */
205     private static class LengthBasedComparator implements Comparator&lt;String&gt; {
206         private static final LengthBasedComparator INSTANCE = new LengthBasedComparator();
207 
208         private LengthBasedComparator() {
209         }
210 
211         @Override
212         public int compare(String o1, String o2) {
213             int n = o2.length() - o1.length();
214             return (n == 0) ? o1.compareTo(o2) : n;
215         }
216     }
217 }
    </pre>
  </body>
</html>