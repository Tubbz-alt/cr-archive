<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/java/util/Locale/LocaleProviders.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="Bug8179071.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="LocaleProvidersRun.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/Locale/LocaleProviders.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -22,14 +22,18 @@</span>
   */
  import java.text.*;
  import java.text.spi.*;
  import java.util.*;
  import java.util.spi.*;
<span class="udiff-line-added">+ import java.util.stream.IntStream;</span>
  import sun.util.locale.provider.LocaleProviderAdapter;
  
  public class LocaleProviders {
  
<span class="udiff-line-added">+     private static final boolean IS_WINDOWS = System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;);</span>
<span class="udiff-line-added">+     private static final boolean IS_MAC = System.getProperty(&quot;os.name&quot;).startsWith(&quot;Mac&quot;);</span>
<span class="udiff-line-added">+ </span>
      public static void main(String[] args) {
          String methodName = args[0];
  
          switch (methodName) {
              case &quot;getPlatformLocale&quot;:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -74,10 +78,22 @@</span>
  
              case &quot;bug8220227Test&quot;:
                  bug8220227Test();
                  break;
  
<span class="udiff-line-added">+             case &quot;bug8228465Test&quot;:</span>
<span class="udiff-line-added">+                 bug8228465Test();</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             case &quot;bug8232871Test&quot;:</span>
<span class="udiff-line-added">+                 bug8232871Test();</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             case &quot;bug8232860Test&quot;:</span>
<span class="udiff-line-added">+                 bug8232860Test();</span>
<span class="udiff-line-added">+                 break;</span>
<span class="udiff-line-added">+ </span>
              default:
                  throw new RuntimeException(&quot;Test method &#39;&quot;+methodName+&quot;&#39; not found.&quot;);
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -104,11 +120,11 @@</span>
      }
  
      static void bug7198834Test() {
          LocaleProviderAdapter lda = LocaleProviderAdapter.getAdapter(DateFormatProvider.class, Locale.US);
          LocaleProviderAdapter.Type type = lda.getAdapterType();
<span class="udiff-line-modified-removed">-         if (type == LocaleProviderAdapter.Type.HOST &amp;&amp; System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
<span class="udiff-line-modified-added">+         if (type == LocaleProviderAdapter.Type.HOST &amp;&amp; IS_WINDOWS) {</span>
              DateFormat df = DateFormat.getDateInstance(DateFormat.FULL, Locale.US);
              String date = df.format(new Date());
              if (date.charAt(date.length()-1) == &#39; &#39;) {
                  throw new RuntimeException(&quot;Windows Host Locale Provider returns a trailing space.&quot;);
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -131,11 +147,11 @@</span>
          String nu = nf.format(1234560);
      }
  
      // This test assumes Windows localized language/country display names.
      static void bug8010666Test() {
<span class="udiff-line-modified-removed">-         if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
<span class="udiff-line-modified-added">+         if (IS_WINDOWS) {</span>
              NumberFormat nf = NumberFormat.getInstance(Locale.US);
              try {
                  double ver = nf.parse(System.getProperty(&quot;os.version&quot;))
                                 .doubleValue();
                  System.out.printf(&quot;Windows version: %.1f\n&quot;, ver);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -213,11 +229,11 @@</span>
              // ParseException is fine in this test, as it&#39;s not &quot;UTC&quot;
  }
      }
  
      static void bug8013903Test() {
<span class="udiff-line-modified-removed">-         if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
<span class="udiff-line-modified-added">+         if (IS_WINDOWS) {</span>
              Date sampleDate = new Date(0x10000000000L);
              String hostResult = &quot;\u5e73\u6210 16.11.03 (Wed) AM 11:53:47&quot;;
              String jreResult = &quot;\u5e73\u6210 16.11.03 (\u6c34) \u5348\u524d 11:53:47&quot;;
              Locale l = new Locale(&quot;ja&quot;, &quot;JP&quot;, &quot;JP&quot;);
              SimpleDateFormat sdf = new SimpleDateFormat(&quot;GGGG yyyy.MMM.dd &#39;(&#39;E&#39;)&#39; a hh:mm:ss&quot;, l);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -239,11 +255,11 @@</span>
              }
          }
      }
  
      static void bug8027289Test(String expectedCodePoint) {
<span class="udiff-line-modified-removed">-         if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
<span class="udiff-line-modified-added">+         if (IS_WINDOWS) {</span>
              char[] expectedSymbol = Character.toChars(Integer.valueOf(expectedCodePoint, 16));
              NumberFormat nf = NumberFormat.getCurrencyInstance(Locale.CHINA);
              char formatted = nf.format(7000).charAt(0);
              System.out.println(&quot;returned: &quot; + formatted + &quot;, expected: &quot; + expectedSymbol[0]);
              if (formatted != expectedSymbol[0]) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -253,15 +269,109 @@</span>
              }
          }
      }
  
      static void bug8220227Test() {
<span class="udiff-line-modified-removed">-         if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
<span class="udiff-line-modified-added">+         if (IS_WINDOWS) {</span>
              Locale l = new Locale(&quot;xx&quot;,&quot;XX&quot;);
              String country = l.getDisplayCountry();
              if (country.endsWith(&quot;(XX)&quot;)) {
                  throw new RuntimeException(
                          &quot;Unexpected Region name: &quot; + country);
              }
          }
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static void bug8228465Test() {</span>
<span class="udiff-line-added">+         LocaleProviderAdapter lda = LocaleProviderAdapter.getAdapter(CalendarNameProvider.class, Locale.US);</span>
<span class="udiff-line-added">+         LocaleProviderAdapter.Type type = lda.getAdapterType();</span>
<span class="udiff-line-added">+         if (type == LocaleProviderAdapter.Type.HOST &amp;&amp; IS_WINDOWS) {</span>
<span class="udiff-line-added">+             var names =  new GregorianCalendar()</span>
<span class="udiff-line-added">+                 .getDisplayNames(Calendar.ERA, Calendar.SHORT_FORMAT, Locale.US);</span>
<span class="udiff-line-added">+             if (!names.keySet().contains(&quot;AD&quot;) ||</span>
<span class="udiff-line-added">+                 names.get(&quot;AD&quot;).intValue() != 1) {</span>
<span class="udiff-line-added">+                     throw new RuntimeException(</span>
<span class="udiff-line-added">+                             &quot;Short Era name for &#39;AD&#39; is missing or incorrect&quot;);</span>
<span class="udiff-line-added">+             } else {</span>
<span class="udiff-line-added">+                 System.out.println(&quot;bug8228465Test succeeded.&quot;);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static void bug8232871Test() {</span>
<span class="udiff-line-added">+         LocaleProviderAdapter lda = LocaleProviderAdapter.getAdapter(CalendarNameProvider.class, Locale.US);</span>
<span class="udiff-line-added">+         LocaleProviderAdapter.Type type = lda.getAdapterType();</span>
<span class="udiff-line-added">+         var lang = Locale.getDefault().getLanguage();</span>
<span class="udiff-line-added">+         var cal = Calendar.getInstance();</span>
<span class="udiff-line-added">+         var calType = cal.getCalendarType();</span>
<span class="udiff-line-added">+         var expected = &quot;\u4ee4\u548c1\u5e745\u67081\u65e5 \u6c34\u66dc\u65e5 \u5348\u524d0:00:00 \u30a2\u30e1\u30ea\u30ab\u592a\u5e73\u6d0b\u590f\u6642\u9593&quot;;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (type == LocaleProviderAdapter.Type.HOST &amp;&amp;</span>
<span class="udiff-line-added">+             IS_MAC &amp;&amp;</span>
<span class="udiff-line-added">+             lang.equals(&quot;ja&quot;) &amp;&amp;</span>
<span class="udiff-line-added">+             calType.equals(&quot;japanese&quot;)) {</span>
<span class="udiff-line-added">+             cal.set(1, 4, 1, 0, 0, 0);</span>
<span class="udiff-line-added">+             cal.setTimeZone(TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;));</span>
<span class="udiff-line-added">+             DateFormat df = DateFormat.getDateTimeInstance(DateFormat.FULL, DateFormat.FULL,</span>
<span class="udiff-line-added">+                             Locale.JAPAN);</span>
<span class="udiff-line-added">+             df.setCalendar(cal);</span>
<span class="udiff-line-added">+             var result = df.format(cal.getTime());</span>
<span class="udiff-line-added">+             if (result.equals(expected)) {</span>
<span class="udiff-line-added">+                 System.out.println(&quot;bug8232871Test succeeded.&quot;);</span>
<span class="udiff-line-added">+             } else {</span>
<span class="udiff-line-added">+                 throw new RuntimeException(</span>
<span class="udiff-line-added">+                             &quot;Japanese calendar names mismatch. result: &quot; +</span>
<span class="udiff-line-added">+                             result +</span>
<span class="udiff-line-added">+                             &quot;, expected: &quot; +</span>
<span class="udiff-line-added">+                             expected);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             System.out.println(&quot;Test ignored. Either :-\n&quot; +</span>
<span class="udiff-line-added">+                 &quot;OS is not macOS, or\n&quot; +</span>
<span class="udiff-line-added">+                 &quot;provider is not HOST: &quot; + type + &quot;, or\n&quot; +</span>
<span class="udiff-line-added">+                 &quot;Language is not Japanese: &quot; + lang + &quot;, or\n&quot; +</span>
<span class="udiff-line-added">+                 &quot;native calendar is not JapaneseCalendar: &quot; + calType);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static void bug8232860Test() {</span>
<span class="udiff-line-added">+         var inputList = List.of(123, 123.4);</span>
<span class="udiff-line-added">+         var nfExpectedList = List.of(&quot;123&quot;, &quot;123.4&quot;);</span>
<span class="udiff-line-added">+         var ifExpectedList = List.of(&quot;123&quot;, &quot;123&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         var defLoc = Locale.getDefault(Locale.Category.FORMAT);</span>
<span class="udiff-line-added">+         var type = LocaleProviderAdapter.getAdapter(CalendarNameProvider.class, Locale.US)</span>
<span class="udiff-line-added">+                                         .getAdapterType();</span>
<span class="udiff-line-added">+         if (defLoc.equals(Locale.US) &amp;&amp;</span>
<span class="udiff-line-added">+             type == LocaleProviderAdapter.Type.HOST &amp;&amp;</span>
<span class="udiff-line-added">+             (IS_WINDOWS || IS_MAC)) {</span>
<span class="udiff-line-added">+             final var numf = NumberFormat.getNumberInstance(Locale.US);</span>
<span class="udiff-line-added">+             final var intf = NumberFormat.getIntegerInstance(Locale.US);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             IntStream.range(0, inputList.size())</span>
<span class="udiff-line-added">+                 .forEach(i -&gt; {</span>
<span class="udiff-line-added">+                     var input = inputList.get(i);</span>
<span class="udiff-line-added">+                     var nfExpected = nfExpectedList.get(i);</span>
<span class="udiff-line-added">+                     var result = numf.format(input);</span>
<span class="udiff-line-added">+                     if (!result.equals(nfExpected)) {</span>
<span class="udiff-line-added">+                         throw new RuntimeException(&quot;Incorrect number format. &quot; +</span>
<span class="udiff-line-added">+                             &quot;input: &quot; + input + &quot;, expected: &quot; +</span>
<span class="udiff-line-added">+                             nfExpected + &quot;, result: &quot; + result);</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                     var ifExpected = ifExpectedList.get(i);</span>
<span class="udiff-line-added">+                     result = intf.format(input);</span>
<span class="udiff-line-added">+                     if (!result.equals(ifExpected)) {</span>
<span class="udiff-line-added">+                         throw new RuntimeException(&quot;Incorrect integer format. &quot; +</span>
<span class="udiff-line-added">+                             &quot;input: &quot; + input + &quot;, expected: &quot; +</span>
<span class="udiff-line-added">+                             ifExpected + &quot;, result: &quot; + result);</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                 });</span>
<span class="udiff-line-added">+             System.out.println(&quot;bug8232860Test succeeded.&quot;);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             System.out.println(&quot;Test ignored. Either :-\n&quot; +</span>
<span class="udiff-line-added">+                 &quot;Default format locale is not Locale.US: &quot; + defLoc + &quot;, or\n&quot; +</span>
<span class="udiff-line-added">+                 &quot;OS is neither macOS/Windows, or\n&quot; +</span>
<span class="udiff-line-added">+                 &quot;provider is not HOST: &quot; + type);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
  }
</pre>
<center><a href="Bug8179071.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="LocaleProvidersRun.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>