<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/util/Locale/Bug8040211.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../HashMap/WhiteBoxResizeTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Bug8179071.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/Locale/Bug8040211.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8040211 8191404 8203872</span>
 27  * @summary Checks the IANA language subtag registry data update
<span class="line-modified"> 28  *          (LSR Revision: 2018-04-23) with Locale and Locale.LanguageRange</span>
 29  *          class methods.
 30  * @run main Bug8040211
 31  */
 32 
 33 import java.util.ArrayList;
 34 import java.util.Iterator;
 35 import java.util.Locale;
 36 import java.util.List;
 37 import java.util.Locale.LanguageRange;
 38 import java.util.Locale.FilteringMode;
 39 import static java.util.Locale.FilteringMode.EXTENDED_FILTERING;
 40 
 41 public class Bug8040211 {
 42 
 43     static boolean err = false;
 44 














































































 45     public static void main(String[] args) {
 46         testLanguageRange();
 47         testLocale();
 48 
 49         if (err) {
 50             throw new RuntimeException(&quot;Failed.&quot;);
 51         }
 52     }
 53 
 54     private static void testLanguageRange() {
 55         System.out.println(&quot;Test LanguageRange class parse method...&quot;);
 56         test_parse();
 57     }
 58 
 59     private static void testLocale() {
 60         System.out.println(&quot;Test Locale class methods...&quot;);
 61         test_filter();
 62         test_filterTags();
 63         test_lookup();
 64         test_lookupTag();
 65     }
 66 
 67     private static void test_parse() {
 68         boolean error = false;
<span class="line-modified"> 69         String str = &quot;Accept-Language: aam, adp, aue, bcg, cqu, ema,&quot;</span>
<span class="line-modified"> 70                 + &quot; en-gb-oed, gti, kdz, koj, kwq, kxe, lii, lmm, mtm, ngv,&quot;</span>
<span class="line-removed"> 71                 + &quot; oyb, phr, pub, suj, taj;q=0.9, ar-hyw;q=0.8, yug;q=0.5, gfx;q=0.4&quot;;</span>
<span class="line-removed"> 72         ArrayList&lt;LanguageRange&gt; expected = new ArrayList&lt;&gt;();</span>
<span class="line-removed"> 73         expected.add(new LanguageRange(&quot;aam&quot;, 1.0));</span>
<span class="line-removed"> 74         expected.add(new LanguageRange(&quot;aas&quot;, 1.0));</span>
<span class="line-removed"> 75         expected.add(new LanguageRange(&quot;adp&quot;, 1.0));</span>
<span class="line-removed"> 76         expected.add(new LanguageRange(&quot;dz&quot;, 1.0));</span>
<span class="line-removed"> 77         expected.add(new LanguageRange(&quot;aue&quot;, 1.0));</span>
<span class="line-removed"> 78         expected.add(new LanguageRange(&quot;ktz&quot;, 1.0));</span>
<span class="line-removed"> 79         expected.add(new LanguageRange(&quot;bcg&quot;, 1.0));</span>
<span class="line-removed"> 80         expected.add(new LanguageRange(&quot;bgm&quot;, 1.0));</span>
<span class="line-removed"> 81         expected.add(new LanguageRange(&quot;cqu&quot;, 1.0));</span>
<span class="line-removed"> 82         expected.add(new LanguageRange(&quot;quh&quot;, 1.0));</span>
<span class="line-removed"> 83         expected.add(new LanguageRange(&quot;ema&quot;, 1.0));</span>
<span class="line-removed"> 84         expected.add(new LanguageRange(&quot;uok&quot;, 1.0));</span>
<span class="line-removed"> 85         expected.add(new LanguageRange(&quot;en-gb-oed&quot;, 1.0));</span>
<span class="line-removed"> 86         expected.add(new LanguageRange(&quot;en-gb-oxendict&quot;, 1.0));</span>
<span class="line-removed"> 87         expected.add(new LanguageRange(&quot;gti&quot;, 1.0));</span>
<span class="line-removed"> 88         expected.add(new LanguageRange(&quot;nyc&quot;, 1.0));</span>
<span class="line-removed"> 89         expected.add(new LanguageRange(&quot;kdz&quot;, 1.0));</span>
<span class="line-removed"> 90         expected.add(new LanguageRange(&quot;ncp&quot;, 1.0));</span>
<span class="line-removed"> 91         expected.add(new LanguageRange(&quot;koj&quot;, 1.0));</span>
<span class="line-removed"> 92         expected.add(new LanguageRange(&quot;kwv&quot;, 1.0));</span>
<span class="line-removed"> 93         expected.add(new LanguageRange(&quot;kwq&quot;, 1.0));</span>
<span class="line-removed"> 94         expected.add(new LanguageRange(&quot;yam&quot;, 1.0));</span>
<span class="line-removed"> 95         expected.add(new LanguageRange(&quot;kxe&quot;, 1.0));</span>
<span class="line-removed"> 96         expected.add(new LanguageRange(&quot;tvd&quot;, 1.0));</span>
<span class="line-removed"> 97         expected.add(new LanguageRange(&quot;lii&quot;, 1.0));</span>
<span class="line-removed"> 98         expected.add(new LanguageRange(&quot;raq&quot;, 1.0));</span>
<span class="line-removed"> 99         expected.add(new LanguageRange(&quot;lmm&quot;, 1.0));</span>
<span class="line-removed">100         expected.add(new LanguageRange(&quot;rmx&quot;, 1.0));</span>
<span class="line-removed">101         expected.add(new LanguageRange(&quot;mtm&quot;, 1.0));</span>
<span class="line-removed">102         expected.add(new LanguageRange(&quot;ymt&quot;, 1.0));</span>
<span class="line-removed">103         expected.add(new LanguageRange(&quot;ngv&quot;, 1.0));</span>
<span class="line-removed">104         expected.add(new LanguageRange(&quot;nnx&quot;, 1.0));</span>
<span class="line-removed">105         expected.add(new LanguageRange(&quot;oyb&quot;, 1.0));</span>
<span class="line-removed">106         expected.add(new LanguageRange(&quot;thx&quot;, 1.0));</span>
<span class="line-removed">107         expected.add(new LanguageRange(&quot;skk&quot;, 1.0));</span>
<span class="line-removed">108         expected.add(new LanguageRange(&quot;jeg&quot;, 1.0));</span>
<span class="line-removed">109         expected.add(new LanguageRange(&quot;phr&quot;, 1.0));</span>
<span class="line-removed">110         expected.add(new LanguageRange(&quot;pmu&quot;, 1.0));</span>
<span class="line-removed">111         expected.add(new LanguageRange(&quot;pub&quot;, 1.0));</span>
<span class="line-removed">112         expected.add(new LanguageRange(&quot;puz&quot;, 1.0));</span>
<span class="line-removed">113         expected.add(new LanguageRange(&quot;suj&quot;, 1.0));</span>
<span class="line-removed">114         expected.add(new LanguageRange(&quot;xsj&quot;, 1.0));</span>
<span class="line-removed">115         expected.add(new LanguageRange(&quot;taj&quot;, 0.9));</span>
<span class="line-removed">116         expected.add(new LanguageRange(&quot;tsf&quot;, 0.9));</span>
<span class="line-removed">117         expected.add(new LanguageRange(&quot;ar-hyw&quot;, 0.8));</span>
<span class="line-removed">118         expected.add(new LanguageRange(&quot;ar-arevmda&quot;, 0.8));</span>
<span class="line-removed">119         expected.add(new LanguageRange(&quot;yug&quot;, 0.5));</span>
<span class="line-removed">120         expected.add(new LanguageRange(&quot;yuu&quot;, 0.5));</span>
<span class="line-removed">121         expected.add(new LanguageRange(&quot;gfx&quot;, 0.4));</span>
<span class="line-removed">122         expected.add(new LanguageRange(&quot;oun&quot;, 0.4));</span>
<span class="line-removed">123         expected.add(new LanguageRange(&quot;mwj&quot;, 0.4));</span>
<span class="line-removed">124         expected.add(new LanguageRange(&quot;vaj&quot;, 0.4));</span>
<span class="line-removed">125         List&lt;LanguageRange&gt; got = LanguageRange.parse(str);</span>
<span class="line-removed">126         if (!areEqual(expected, got)) {</span>
127             error = true;
128             System.err.println(&quot;    language parse() test failed.&quot;);
129         }
130 
131         if (error) {
132             err = true;
<span class="line-modified">133             System.err.println(&quot;  test_parse() failed.&quot;);</span>
134         } else {
135             System.out.println(&quot;  test_parse() passed.&quot;);
136         }
137 
138     }
139 
140     private static boolean areEqual(List&lt;LanguageRange&gt; expected,
141             List&lt;LanguageRange&gt; got) {
142         boolean error = false;
143 
144         int expectedSize = expected.size();
145         int actualSize = got.size();
146 
147         if (expectedSize != actualSize) {
148             error = true;
149 
150             System.err.println(&quot;  Expected size=&quot; + expectedSize);
151             for (LanguageRange lr : expected) {
152                 System.err.println(&quot;    range=&quot; + lr.getRange()
153                         + &quot;, weight=&quot; + lr.getWeight());
154             }
155 
<span class="line-modified">156             System.out.println(&quot;  Actual size=&quot; + actualSize);</span>
157             for (LanguageRange lr : got) {
158                 System.err.println(&quot;    range=&quot; + lr.getRange()
159                         + &quot;, weight=&quot; + lr.getWeight());
160             }
161         } else {
162             for (int i = 0; i &lt; expectedSize; i++) {
163                 LanguageRange lr1 = expected.get(i);
164                 LanguageRange lr2 = got.get(i);
165 
166                 if (!lr1.getRange().equals(lr2.getRange())
167                         || lr1.getWeight() != lr2.getWeight()) {
168                     error = true;
169                     System.err.println(&quot;  &quot; + i + &quot;: Expected: range=&quot; + lr1.getRange()
170                             + &quot;, weight=&quot; + lr1.getWeight());
171                     System.err.println(&quot;  &quot; + i + &quot;: Actual:   range=&quot; + lr2.getRange()
172                             + &quot;, weight=&quot; + lr2.getWeight());
173                 }
174             }
175         }
176 
177         return !error;
178     }
179 
180     private static void test_filter() {
181         boolean error = false;
182 
183         String ranges = &quot;mtm-RU, en-gb-oed, coy, ar-HY&quot;;
184         String tags = &quot;de-DE, en, mtm-RU, ymt-RU, en-gb-oxendict, ja-JP, pij, nts, ar-arevela&quot;;
185         FilteringMode mode = EXTENDED_FILTERING;
186 
187         List&lt;LanguageRange&gt; priorityList = LanguageRange.parse(ranges);
188         List&lt;Locale&gt; tagList = generateLocales(tags);
189         String actualLocales
190                 = showLocales(Locale.filter(priorityList, tagList, mode));
<span class="line-modified">191         String expectedLocales = &quot;mtm-RU, ymt-RU, en-GB-oxendict, nts, pij, ar-arevela&quot;;</span>
192 
193         if (!expectedLocales.equals(actualLocales)) {
194             error = true;
195             showErrorMessage(&quot;#1 filter(&quot; + mode + &quot;)&quot;,
196                     ranges, tags, expectedLocales, actualLocales);
197         }
198 
199         ranges = &quot;phr-*-IN, ja-JP&quot;;
200         tags = &quot;en, pmu-Guru-IN, ja-Latn-JP, iw&quot;;
201         mode = EXTENDED_FILTERING;
202 
203         priorityList = LanguageRange.parse(ranges);
204         tagList = generateLocales(tags);
205         actualLocales = showLocales(Locale.filter(priorityList, tagList, mode));
206         expectedLocales = &quot;pmu-Guru-IN, ja-Latn-JP&quot;;
207 
208         if (!expectedLocales.equals(actualLocales)) {
209             error = true;
210             showErrorMessage(&quot;#2 filter(&quot; + mode + &quot;)&quot;,
211                     ranges, tags, expectedLocales, actualLocales);
</pre>
<hr />
<pre>
335     private static String showLocales(List&lt;Locale&gt; locales) {
336         StringBuilder sb = new StringBuilder();
337 
338         java.util.Iterator&lt;Locale&gt; itr = locales.iterator();
339         if (itr.hasNext()) {
340             sb.append(itr.next().toLanguageTag());
341         }
342         while (itr.hasNext()) {
343             sb.append(&quot;, &quot;);
344             sb.append(itr.next().toLanguageTag());
345         }
346 
347         return sb.toString().trim();
348     }
349 
350     private static void showErrorMessage(String methodName,
351             String priorityList,
352             String tags,
353             String expectedTags,
354             String actualTags) {
<span class="line-modified">355         System.out.println(&quot;\nIncorrect &quot; + methodName + &quot; result.&quot;);</span>
<span class="line-modified">356         System.out.println(&quot;  Priority list  :  &quot; + priorityList);</span>
<span class="line-modified">357         System.out.println(&quot;  Language tags  :  &quot; + tags);</span>
<span class="line-modified">358         System.out.println(&quot;  Expected value : &quot; + expectedTags);</span>
<span class="line-modified">359         System.out.println(&quot;  Actual value   : &quot; + actualTags);</span>
360     }
361 
362 }
363 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8040211 8191404 8203872 8222980 8225435</span>
 27  * @summary Checks the IANA language subtag registry data update
<span class="line-modified"> 28  *          (LSR Revision: 2019-09-16) with Locale and Locale.LanguageRange</span>
 29  *          class methods.
 30  * @run main Bug8040211
 31  */
 32 
 33 import java.util.ArrayList;
 34 import java.util.Iterator;
 35 import java.util.Locale;
 36 import java.util.List;
 37 import java.util.Locale.LanguageRange;
 38 import java.util.Locale.FilteringMode;
 39 import static java.util.Locale.FilteringMode.EXTENDED_FILTERING;
 40 
 41 public class Bug8040211 {
 42 
 43     static boolean err = false;
 44 
<span class="line-added"> 45     private static final String ACCEPT_LANGUAGE =</span>
<span class="line-added"> 46         &quot;Accept-Language: aam, adp, aog, aue, bcg, cey, cqu, dif, ema,&quot;</span>
<span class="line-added"> 47         + &quot; en-gb-oed, gti, kdz, koj, kwq, kxe, lii, lmm, lsn, lsv, lvi, mtm,&quot;</span>
<span class="line-added"> 48         + &quot; ngv, nns, oyb, phr, pnd, pub, snz, suj, szy,taj, tjj, tjp, tvx,&quot;</span>
<span class="line-added"> 49         + &quot; uss, uth, wkr;q=0.9, ar-hyw;q=0.8, yug;q=0.5, gfx;q=0.4&quot;;</span>
<span class="line-added"> 50     private static final List&lt;LanguageRange&gt; EXPECTED_RANGE_LIST = List.of(</span>
<span class="line-added"> 51             new LanguageRange(&quot;aam&quot;, 1.0),</span>
<span class="line-added"> 52             new LanguageRange(&quot;aas&quot;, 1.0),</span>
<span class="line-added"> 53             new LanguageRange(&quot;adp&quot;, 1.0),</span>
<span class="line-added"> 54             new LanguageRange(&quot;dz&quot;, 1.0),</span>
<span class="line-added"> 55             new LanguageRange(&quot;aog&quot;, 1.0),</span>
<span class="line-added"> 56             new LanguageRange(&quot;myd&quot;, 1.0),</span>
<span class="line-added"> 57             new LanguageRange(&quot;aue&quot;, 1.0),</span>
<span class="line-added"> 58             new LanguageRange(&quot;ktz&quot;, 1.0),</span>
<span class="line-added"> 59             new LanguageRange(&quot;bcg&quot;, 1.0),</span>
<span class="line-added"> 60             new LanguageRange(&quot;bgm&quot;, 1.0),</span>
<span class="line-added"> 61             new LanguageRange(&quot;cey&quot;, 1.0),</span>
<span class="line-added"> 62             new LanguageRange(&quot;cqu&quot;, 1.0),</span>
<span class="line-added"> 63             new LanguageRange(&quot;quh&quot;, 1.0),</span>
<span class="line-added"> 64             new LanguageRange(&quot;dif&quot;, 1.0),</span>
<span class="line-added"> 65             new LanguageRange(&quot;dit&quot;, 1.0),</span>
<span class="line-added"> 66             new LanguageRange(&quot;ema&quot;, 1.0),</span>
<span class="line-added"> 67             new LanguageRange(&quot;uok&quot;, 1.0),</span>
<span class="line-added"> 68             new LanguageRange(&quot;en-gb-oed&quot;, 1.0),</span>
<span class="line-added"> 69             new LanguageRange(&quot;en-gb-oxendict&quot;, 1.0),</span>
<span class="line-added"> 70             new LanguageRange(&quot;gti&quot;, 1.0),</span>
<span class="line-added"> 71             new LanguageRange(&quot;nyc&quot;, 1.0),</span>
<span class="line-added"> 72             new LanguageRange(&quot;kdz&quot;, 1.0),</span>
<span class="line-added"> 73             new LanguageRange(&quot;ncp&quot;, 1.0),</span>
<span class="line-added"> 74             new LanguageRange(&quot;koj&quot;, 1.0),</span>
<span class="line-added"> 75             new LanguageRange(&quot;kwv&quot;, 1.0),</span>
<span class="line-added"> 76             new LanguageRange(&quot;kwq&quot;, 1.0),</span>
<span class="line-added"> 77             new LanguageRange(&quot;yam&quot;, 1.0),</span>
<span class="line-added"> 78             new LanguageRange(&quot;kxe&quot;, 1.0),</span>
<span class="line-added"> 79             new LanguageRange(&quot;tvd&quot;, 1.0),</span>
<span class="line-added"> 80             new LanguageRange(&quot;lii&quot;, 1.0),</span>
<span class="line-added"> 81             new LanguageRange(&quot;raq&quot;, 1.0),</span>
<span class="line-added"> 82             new LanguageRange(&quot;lmm&quot;, 1.0),</span>
<span class="line-added"> 83             new LanguageRange(&quot;rmx&quot;, 1.0),</span>
<span class="line-added"> 84             new LanguageRange(&quot;lsn&quot;, 1.0),</span>
<span class="line-added"> 85             new LanguageRange(&quot;lsv&quot;, 1.0),</span>
<span class="line-added"> 86             new LanguageRange(&quot;lvi&quot;, 1.0),</span>
<span class="line-added"> 87             new LanguageRange(&quot;mtm&quot;, 1.0),</span>
<span class="line-added"> 88             new LanguageRange(&quot;ymt&quot;, 1.0),</span>
<span class="line-added"> 89             new LanguageRange(&quot;ngv&quot;, 1.0),</span>
<span class="line-added"> 90             new LanguageRange(&quot;nnx&quot;, 1.0),</span>
<span class="line-added"> 91             new LanguageRange(&quot;nns&quot;, 1.0),</span>
<span class="line-added"> 92             new LanguageRange(&quot;nbr&quot;, 1.0),</span>
<span class="line-added"> 93             new LanguageRange(&quot;oyb&quot;, 1.0),</span>
<span class="line-added"> 94             new LanguageRange(&quot;thx&quot;, 1.0),</span>
<span class="line-added"> 95             new LanguageRange(&quot;skk&quot;, 1.0),</span>
<span class="line-added"> 96             new LanguageRange(&quot;jeg&quot;, 1.0),</span>
<span class="line-added"> 97             new LanguageRange(&quot;phr&quot;, 1.0),</span>
<span class="line-added"> 98             new LanguageRange(&quot;pmu&quot;, 1.0),</span>
<span class="line-added"> 99             new LanguageRange(&quot;pnd&quot;, 1.0),</span>
<span class="line-added">100             new LanguageRange(&quot;pub&quot;, 1.0),</span>
<span class="line-added">101             new LanguageRange(&quot;puz&quot;, 1.0),</span>
<span class="line-added">102             new LanguageRange(&quot;snz&quot;, 1.0),</span>
<span class="line-added">103             new LanguageRange(&quot;asd&quot;, 1.0),</span>
<span class="line-added">104             new LanguageRange(&quot;suj&quot;, 1.0),</span>
<span class="line-added">105             new LanguageRange(&quot;szy&quot;, 1.0),</span>
<span class="line-added">106             new LanguageRange(&quot;taj&quot;, 1.0),</span>
<span class="line-added">107             new LanguageRange(&quot;tsf&quot;, 1.0),</span>
<span class="line-added">108             new LanguageRange(&quot;tjj&quot;, 1.0),</span>
<span class="line-added">109             new LanguageRange(&quot;tjp&quot;, 1.0),</span>
<span class="line-added">110             new LanguageRange(&quot;tvx&quot;, 1.0),</span>
<span class="line-added">111             new LanguageRange(&quot;uss&quot;, 1.0),</span>
<span class="line-added">112             new LanguageRange(&quot;uth&quot;, 1.0),</span>
<span class="line-added">113             new LanguageRange(&quot;wkr&quot;, 0.9),</span>
<span class="line-added">114             new LanguageRange(&quot;ar-hyw&quot;, 0.8),</span>
<span class="line-added">115             new LanguageRange(&quot;yug&quot;, 0.5),</span>
<span class="line-added">116             new LanguageRange(&quot;yuu&quot;, 0.5),</span>
<span class="line-added">117             new LanguageRange(&quot;gfx&quot;, 0.4),</span>
<span class="line-added">118             new LanguageRange(&quot;oun&quot;, 0.4),</span>
<span class="line-added">119             new LanguageRange(&quot;mwj&quot;, 0.4),</span>
<span class="line-added">120             new LanguageRange(&quot;vaj&quot;, 0.4)</span>
<span class="line-added">121         );</span>
<span class="line-added">122 </span>
123     public static void main(String[] args) {
124         testLanguageRange();
125         testLocale();
126 
127         if (err) {
128             throw new RuntimeException(&quot;Failed.&quot;);
129         }
130     }
131 
132     private static void testLanguageRange() {
133         System.out.println(&quot;Test LanguageRange class parse method...&quot;);
134         test_parse();
135     }
136 
137     private static void testLocale() {
138         System.out.println(&quot;Test Locale class methods...&quot;);
139         test_filter();
140         test_filterTags();
141         test_lookup();
142         test_lookupTag();
143     }
144 
145     private static void test_parse() {
146         boolean error = false;
<span class="line-modified">147         List&lt;LanguageRange&gt; got = LanguageRange.parse(ACCEPT_LANGUAGE);</span>
<span class="line-modified">148         if (!areEqual(EXPECTED_RANGE_LIST, got)) {</span>
























































149             error = true;
150             System.err.println(&quot;    language parse() test failed.&quot;);
151         }
152 
153         if (error) {
154             err = true;
<span class="line-modified">155             System.out.println(&quot;  test_parse() failed.&quot;);</span>
156         } else {
157             System.out.println(&quot;  test_parse() passed.&quot;);
158         }
159 
160     }
161 
162     private static boolean areEqual(List&lt;LanguageRange&gt; expected,
163             List&lt;LanguageRange&gt; got) {
164         boolean error = false;
165 
166         int expectedSize = expected.size();
167         int actualSize = got.size();
168 
169         if (expectedSize != actualSize) {
170             error = true;
171 
172             System.err.println(&quot;  Expected size=&quot; + expectedSize);
173             for (LanguageRange lr : expected) {
174                 System.err.println(&quot;    range=&quot; + lr.getRange()
175                         + &quot;, weight=&quot; + lr.getWeight());
176             }
177 
<span class="line-modified">178             System.err.println(&quot;  Actual size=&quot; + actualSize);</span>
179             for (LanguageRange lr : got) {
180                 System.err.println(&quot;    range=&quot; + lr.getRange()
181                         + &quot;, weight=&quot; + lr.getWeight());
182             }
183         } else {
184             for (int i = 0; i &lt; expectedSize; i++) {
185                 LanguageRange lr1 = expected.get(i);
186                 LanguageRange lr2 = got.get(i);
187 
188                 if (!lr1.getRange().equals(lr2.getRange())
189                         || lr1.getWeight() != lr2.getWeight()) {
190                     error = true;
191                     System.err.println(&quot;  &quot; + i + &quot;: Expected: range=&quot; + lr1.getRange()
192                             + &quot;, weight=&quot; + lr1.getWeight());
193                     System.err.println(&quot;  &quot; + i + &quot;: Actual:   range=&quot; + lr2.getRange()
194                             + &quot;, weight=&quot; + lr2.getWeight());
195                 }
196             }
197         }
198 
199         return !error;
200     }
201 
202     private static void test_filter() {
203         boolean error = false;
204 
205         String ranges = &quot;mtm-RU, en-gb-oed, coy, ar-HY&quot;;
206         String tags = &quot;de-DE, en, mtm-RU, ymt-RU, en-gb-oxendict, ja-JP, pij, nts, ar-arevela&quot;;
207         FilteringMode mode = EXTENDED_FILTERING;
208 
209         List&lt;LanguageRange&gt; priorityList = LanguageRange.parse(ranges);
210         List&lt;Locale&gt; tagList = generateLocales(tags);
211         String actualLocales
212                 = showLocales(Locale.filter(priorityList, tagList, mode));
<span class="line-modified">213         String expectedLocales = &quot;mtm-RU, ymt-RU, en-GB-oxendict, nts, pij&quot;;</span>
214 
215         if (!expectedLocales.equals(actualLocales)) {
216             error = true;
217             showErrorMessage(&quot;#1 filter(&quot; + mode + &quot;)&quot;,
218                     ranges, tags, expectedLocales, actualLocales);
219         }
220 
221         ranges = &quot;phr-*-IN, ja-JP&quot;;
222         tags = &quot;en, pmu-Guru-IN, ja-Latn-JP, iw&quot;;
223         mode = EXTENDED_FILTERING;
224 
225         priorityList = LanguageRange.parse(ranges);
226         tagList = generateLocales(tags);
227         actualLocales = showLocales(Locale.filter(priorityList, tagList, mode));
228         expectedLocales = &quot;pmu-Guru-IN, ja-Latn-JP&quot;;
229 
230         if (!expectedLocales.equals(actualLocales)) {
231             error = true;
232             showErrorMessage(&quot;#2 filter(&quot; + mode + &quot;)&quot;,
233                     ranges, tags, expectedLocales, actualLocales);
</pre>
<hr />
<pre>
357     private static String showLocales(List&lt;Locale&gt; locales) {
358         StringBuilder sb = new StringBuilder();
359 
360         java.util.Iterator&lt;Locale&gt; itr = locales.iterator();
361         if (itr.hasNext()) {
362             sb.append(itr.next().toLanguageTag());
363         }
364         while (itr.hasNext()) {
365             sb.append(&quot;, &quot;);
366             sb.append(itr.next().toLanguageTag());
367         }
368 
369         return sb.toString().trim();
370     }
371 
372     private static void showErrorMessage(String methodName,
373             String priorityList,
374             String tags,
375             String expectedTags,
376             String actualTags) {
<span class="line-modified">377         System.err.println(&quot;\nIncorrect &quot; + methodName + &quot; result.&quot;);</span>
<span class="line-modified">378         System.err.println(&quot;  Priority list  :  &quot; + priorityList);</span>
<span class="line-modified">379         System.err.println(&quot;  Language tags  :  &quot; + tags);</span>
<span class="line-modified">380         System.err.println(&quot;  Expected value : &quot; + expectedTags);</span>
<span class="line-modified">381         System.err.println(&quot;  Actual value   : &quot; + actualTags);</span>
382     }
383 
384 }
385 
</pre>
</td>
</tr>
</table>
<center><a href="../HashMap/WhiteBoxResizeTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Bug8179071.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>