<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/util/Locale/LocaleProviders.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 import java.text.*;
 24 import java.text.spi.*;
 25 import java.util.*;
 26 import java.util.spi.*;
<a name="2" id="anc2"></a>
 27 import sun.util.locale.provider.LocaleProviderAdapter;
 28 
 29 public class LocaleProviders {
 30 
<a name="3" id="anc3"></a>


 31     public static void main(String[] args) {
 32         String methodName = args[0];
 33 
 34         switch (methodName) {
 35             case &quot;getPlatformLocale&quot;:
 36                 if (args[1].equals(&quot;format&quot;)) {
 37                     getPlatformLocale(Locale.Category.FORMAT);
 38                 } else {
 39                     getPlatformLocale(Locale.Category.DISPLAY);
 40                 }
 41                 break;
 42 
 43             case &quot;adapterTest&quot;:
 44                 adapterTest(args[1], args[2], (args.length &gt;= 4 ? args[3] : &quot;&quot;));
 45                 break;
 46 
 47             case &quot;bug7198834Test&quot;:
 48                 bug7198834Test();
 49                 break;
 50 
 51             case &quot;tzNameTest&quot;:
 52                 tzNameTest(args[1]);
 53                 break;
 54 
 55             case &quot;bug8001440Test&quot;:
 56                 bug8001440Test();
 57                 break;
 58 
 59             case &quot;bug8010666Test&quot;:
 60                 bug8010666Test();
 61                 break;
 62 
 63             case &quot;bug8013086Test&quot;:
 64                 bug8013086Test(args[1], args[2]);
 65                 break;
 66 
 67             case &quot;bug8013903Test&quot;:
 68                 bug8013903Test();
 69                 break;
 70 
 71             case &quot;bug8027289Test&quot;:
 72                 bug8027289Test(args[1]);
 73                 break;
 74 
 75             case &quot;bug8220227Test&quot;:
 76                 bug8220227Test();
 77                 break;
 78 
<a name="4" id="anc4"></a>











 79             default:
 80                 throw new RuntimeException(&quot;Test method &#39;&quot;+methodName+&quot;&#39; not found.&quot;);
 81         }
 82     }
 83 
 84     static void getPlatformLocale(Locale.Category cat) {
 85         Locale defloc = Locale.getDefault(cat);
 86         System.out.printf(&quot;%s,%s\n&quot;, defloc.getLanguage(), defloc.getCountry());
 87     }
 88 
 89     static void adapterTest(String expected, String lang, String ctry) {
 90         Locale testLocale = new Locale(lang, ctry);
 91         LocaleProviderAdapter ldaExpected =
 92             LocaleProviderAdapter.forType(LocaleProviderAdapter.Type.valueOf(expected));
 93         if (!ldaExpected.getDateFormatProvider().isSupportedLocale(testLocale)) {
 94             System.out.println(&quot;test locale: &quot;+testLocale+&quot; is not supported by the expected provider: &quot;+ldaExpected+&quot;. Ignoring the test.&quot;);
 95             return;
 96         }
 97         String preference = System.getProperty(&quot;java.locale.providers&quot;, &quot;&quot;);
 98         LocaleProviderAdapter lda = LocaleProviderAdapter.getAdapter(DateFormatProvider.class, testLocale);
 99         LocaleProviderAdapter.Type type = lda.getAdapterType();
100         System.out.printf(&quot;testLocale: %s, got: %s, expected: %s\n&quot;, testLocale, type, expected);
101         if (!type.toString().equals(expected)) {
102             throw new RuntimeException(&quot;Returned locale data adapter is not correct.&quot;);
103         }
104     }
105 
106     static void bug7198834Test() {
107         LocaleProviderAdapter lda = LocaleProviderAdapter.getAdapter(DateFormatProvider.class, Locale.US);
108         LocaleProviderAdapter.Type type = lda.getAdapterType();
<a name="5" id="anc5"></a><span class="line-modified">109         if (type == LocaleProviderAdapter.Type.HOST &amp;&amp; System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
110             DateFormat df = DateFormat.getDateInstance(DateFormat.FULL, Locale.US);
111             String date = df.format(new Date());
112             if (date.charAt(date.length()-1) == &#39; &#39;) {
113                 throw new RuntimeException(&quot;Windows Host Locale Provider returns a trailing space.&quot;);
114             }
115         } else {
116             System.out.println(&quot;Windows HOST locale adapter not found. Ignoring this test.&quot;);
117         }
118     }
119 
120     static void tzNameTest(String id) {
121         TimeZone tz = TimeZone.getTimeZone(id);
122         String tzName = tz.getDisplayName(false, TimeZone.SHORT, Locale.US);
123         if (tzName.startsWith(&quot;GMT&quot;)) {
124             throw new RuntimeException(&quot;JRE&#39;s localized time zone name for &quot;+id+&quot; could not be retrieved. Returned name was: &quot;+tzName);
125         }
126     }
127 
128     static void bug8001440Test() {
129         Locale locale = Locale.forLanguageTag(&quot;th-TH-u-nu-hoge&quot;);
130         NumberFormat nf = NumberFormat.getInstance(locale);
131         String nu = nf.format(1234560);
132     }
133 
134     // This test assumes Windows localized language/country display names.
135     static void bug8010666Test() {
<a name="6" id="anc6"></a><span class="line-modified">136         if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
137             NumberFormat nf = NumberFormat.getInstance(Locale.US);
138             try {
139                 double ver = nf.parse(System.getProperty(&quot;os.version&quot;))
140                                .doubleValue();
141                 System.out.printf(&quot;Windows version: %.1f\n&quot;, ver);
142                 if (ver &gt;= 6.0) {
143                     LocaleProviderAdapter lda =
144                         LocaleProviderAdapter.getAdapter(
145                             LocaleNameProvider.class, Locale.ENGLISH);
146                     LocaleProviderAdapter.Type type = lda.getAdapterType();
147                     if (type == LocaleProviderAdapter.Type.HOST) {
148                         LocaleNameProvider lnp = lda.getLocaleNameProvider();
149                         Locale mkmk = Locale.forLanguageTag(&quot;mk-MK&quot;);
150                         String result = mkmk.getDisplayLanguage(Locale.ENGLISH);
151                         String hostResult =
152                             lnp.getDisplayLanguage(mkmk.getLanguage(),
153                                                    Locale.ENGLISH);
154                         System.out.printf(&quot;  Display language name for&quot; +
155                             &quot; (mk_MK): result(HOST): \&quot;%s\&quot;, returned: \&quot;%s\&quot;\n&quot;,
156                             hostResult, result);
157                         if (result == null ||
158                             hostResult != null &amp;&amp;
159                             !result.equals(hostResult)) {
160                             throw new RuntimeException(&quot;Display language name&quot; +
161                                 &quot; mismatch for \&quot;mk\&quot;. Returned name was&quot; +
162                                 &quot; \&quot;&quot; + result + &quot;\&quot;, result(HOST): \&quot;&quot; +
163                                 hostResult + &quot;\&quot;&quot;);
164                         }
165                         result = Locale.US.getDisplayLanguage(Locale.ENGLISH);
166                         hostResult =
167                             lnp.getDisplayLanguage(Locale.US.getLanguage(),
168                                                    Locale.ENGLISH);
169                         System.out.printf(&quot;  Display language name for&quot; +
170                             &quot; (en_US): result(HOST): \&quot;%s\&quot;, returned: \&quot;%s\&quot;\n&quot;,
171                             hostResult, result);
172                         if (result == null ||
173                             hostResult != null &amp;&amp;
174                             !result.equals(hostResult)) {
175                             throw new RuntimeException(&quot;Display language name&quot; +
176                                 &quot; mismatch for \&quot;en\&quot;. Returned name was&quot; +
177                                 &quot; \&quot;&quot; + result + &quot;\&quot;, result(HOST): \&quot;&quot; +
178                                 hostResult + &quot;\&quot;&quot;);
179                         }
180                         if (ver &gt;= 6.1) {
181                             result = Locale.US.getDisplayCountry(Locale.ENGLISH);
182                             hostResult = lnp.getDisplayCountry(
183                                 Locale.US.getCountry(), Locale.ENGLISH);
184                             System.out.printf(&quot;  Display country name for&quot; +
185                                 &quot; (en_US): result(HOST): \&quot;%s\&quot;, returned: \&quot;%s\&quot;\n&quot;,
186                                 hostResult, result);
187                             if (result == null ||
188                                 hostResult != null &amp;&amp;
189                                 !result.equals(hostResult)) {
190                                 throw new RuntimeException(&quot;Display country name&quot; +
191                                     &quot; mismatch for \&quot;US\&quot;. Returned name was&quot; +
192                                     &quot; \&quot;&quot; + result + &quot;\&quot;, result(HOST): \&quot;&quot; +
193                                     hostResult + &quot;\&quot;&quot;);
194                             }
195                         }
196                     } else {
197                         throw new RuntimeException(&quot;Windows Host&quot; +
198                             &quot; LocaleProviderAdapter was not selected for&quot; +
199                             &quot; English locale.&quot;);
200                     }
201                 }
202             } catch (ParseException pe) {
203                 throw new RuntimeException(&quot;Parsing Windows version failed: &quot;+pe.toString());
204             }
205         }
206     }
207 
208     static void bug8013086Test(String lang, String ctry) {
209         try {
210             // Throws a NullPointerException if the test fails.
211             System.out.println(new SimpleDateFormat(&quot;z&quot;, new Locale(lang, ctry)).parse(&quot;UTC&quot;));
212         } catch (ParseException pe) {
213             // ParseException is fine in this test, as it&#39;s not &quot;UTC&quot;
214 }
215     }
216 
217     static void bug8013903Test() {
<a name="7" id="anc7"></a><span class="line-modified">218         if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
219             Date sampleDate = new Date(0x10000000000L);
220             String hostResult = &quot;\u5e73\u6210 16.11.03 (Wed) AM 11:53:47&quot;;
221             String jreResult = &quot;\u5e73\u6210 16.11.03 (\u6c34) \u5348\u524d 11:53:47&quot;;
222             Locale l = new Locale(&quot;ja&quot;, &quot;JP&quot;, &quot;JP&quot;);
223             SimpleDateFormat sdf = new SimpleDateFormat(&quot;GGGG yyyy.MMM.dd &#39;(&#39;E&#39;)&#39; a hh:mm:ss&quot;, l);
224             sdf.setTimeZone(TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;));
225             String result = sdf.format(sampleDate);
226             System.out.println(result);
227             if (LocaleProviderAdapter.getAdapterPreference()
228                 .contains(LocaleProviderAdapter.Type.JRE)) {
229                 if (!jreResult.equals(result)) {
230                     throw new RuntimeException(&quot;Format failed. result: \&quot;&quot; +
231                         result + &quot;\&quot;, expected: \&quot;&quot; + jreResult);
232                 }
233             } else {
234                 // Windows display names. Subject to change if Windows changes its format.
235                 if (!hostResult.equals(result)) {
236                     throw new RuntimeException(&quot;Format failed. result: \&quot;&quot; +
237                         result + &quot;\&quot;, expected: \&quot;&quot; + hostResult);
238                 }
239             }
240         }
241     }
242 
243     static void bug8027289Test(String expectedCodePoint) {
<a name="8" id="anc8"></a><span class="line-modified">244         if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
245             char[] expectedSymbol = Character.toChars(Integer.valueOf(expectedCodePoint, 16));
246             NumberFormat nf = NumberFormat.getCurrencyInstance(Locale.CHINA);
247             char formatted = nf.format(7000).charAt(0);
248             System.out.println(&quot;returned: &quot; + formatted + &quot;, expected: &quot; + expectedSymbol[0]);
249             if (formatted != expectedSymbol[0]) {
250                 throw new RuntimeException(
251                         &quot;Unexpected Chinese currency symbol. returned: &quot;
252                                 + formatted + &quot;, expected: &quot; + expectedSymbol[0]);
253             }
254         }
255     }
256 
257     static void bug8220227Test() {
<a name="9" id="anc9"></a><span class="line-modified">258         if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
259             Locale l = new Locale(&quot;xx&quot;,&quot;XX&quot;);
260             String country = l.getDisplayCountry();
261             if (country.endsWith(&quot;(XX)&quot;)) {
262                 throw new RuntimeException(
263                         &quot;Unexpected Region name: &quot; + country);
264             }
265         }
266     }
<a name="10" id="anc10"></a>





























































































267 }
<a name="11" id="anc11"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="11" type="hidden" />
</body>
</html>