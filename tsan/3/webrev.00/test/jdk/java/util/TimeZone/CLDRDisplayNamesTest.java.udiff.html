<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/java/util/TimeZone/CLDRDisplayNamesTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="Bug8066652Run.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TimeZoneDatePermissionCheckRun.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/util/TimeZone/CLDRDisplayNamesTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,11 +21,12 @@</span>
   * questions.
   */
  
   /*
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8005471 8008577 8129881 8130845 8136518 8181157 8210490</span>
<span class="udiff-line-modified-added">+  * @bug 8005471 8008577 8129881 8130845 8136518 8181157 8210490 8220037</span>
<span class="udiff-line-added">+  *      8234347 8236548</span>
   * @modules jdk.localedata
   * @run main/othervm -Djava.locale.providers=CLDR CLDRDisplayNamesTest
   * @summary Make sure that localized time zone names of CLDR are used
   * if specified.
   */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -93,25 +94,27 @@</span>
                  }
              }
          }
  
          // for 8129881
<span class="udiff-line-added">+         /* 8234347: CLDR Converter will not pre-fill short display names from COMPAT anymore.</span>
          tz = TimeZone.getTimeZone(&quot;Europe/Vienna&quot;);
          String name = tz.getDisplayName(false, SHORT, Locale.ENGLISH);
          if (!&quot;CET&quot;.equals(name)) {
              System.err.printf(&quot;error: got &#39;%s&#39; expected &#39;CET&#39; %n&quot;, name);
              errors++;
          }
<span class="udiff-line-added">+         */</span>
  
          // for 8130845
          SimpleDateFormat fmtROOT = new SimpleDateFormat(&quot;EEE MMM d hh:mm:ss z yyyy&quot;, Locale.ROOT);
          SimpleDateFormat fmtUS = new SimpleDateFormat(&quot;EEE MMM d hh:mm:ss z yyyy&quot;, Locale.US);
          SimpleDateFormat fmtUK = new SimpleDateFormat(&quot;EEE MMM d hh:mm:ss z yyyy&quot;, Locale.UK);
          Locale originalLocale = Locale.getDefault();
          try {
              Locale.setDefault(Locale.ROOT);
<span class="udiff-line-modified-removed">-             fmtROOT.parse(&quot;Thu Nov 13 04:35:51 AKST 2008&quot;);</span>
<span class="udiff-line-modified-added">+             fmtROOT.parse(&quot;Thu Nov 13 04:35:51 GMT-09:00 2008&quot;);</span>
              fmtUS.parse(&quot;Thu Nov 13 04:35:51 AKST 2008&quot;);
              fmtUK.parse(&quot;Thu Nov 13 04:35:51 GMT-09:00 2008&quot;);
          } catch (ParseException pe) {
              System.err.println(pe);
              errors++;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -128,17 +131,14 @@</span>
          Locale.setDefault(originalLocale);
          if (!displayName.equals(&quot;GMT+05:00&quot;)) {
              System.err.printf(&quot;Wrong display name for timezone Etc/GMT-5 : expected GMT+05:00,  Actual &quot; + displayName);
              errors++;
          }
<span class="udiff-line-removed">-         if (errors &gt; 0) {</span>
<span class="udiff-line-removed">-             throw new RuntimeException(&quot;test failed&quot;);</span>
<span class="udiff-line-removed">-         }</span>
  
          // 8217366: No &quot;no inheritance marker&quot; should be left in the returned array
          // from DateFormatSymbols.getZoneStrings()
<span class="udiff-line-modified-removed">-         List.of(Locale.ROOT,</span>
<span class="udiff-line-modified-added">+         errors += List.of(Locale.ROOT,</span>
                  Locale.CHINA,
                  Locale.GERMANY,
                  Locale.JAPAN,
                  Locale.UK,
                  Locale.US,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -147,13 +147,30 @@</span>
              .peek(System.out::println)
              .map(l -&gt; DateFormatSymbols.getInstance(l).getZoneStrings())
              .flatMap(zoneStrings -&gt; Arrays.stream(zoneStrings))
              .filter(namesArray -&gt; Arrays.stream(namesArray)
                  .anyMatch(aName -&gt; aName.equals(NO_INHERITANCE_MARKER)))
<span class="udiff-line-modified-removed">-             .findAny()</span>
<span class="udiff-line-modified-removed">-             .ifPresentOrElse(marker -&gt; {</span>
<span class="udiff-line-removed">-                     throw new RuntimeException(&quot;No inheritance marker detected with tzid: &quot;</span>
<span class="udiff-line-modified-added">+             .peek(marker -&gt; {</span>
<span class="udiff-line-modified-added">+                  System.err.println(&quot;No-inheritance-marker is detected with tzid: &quot;</span>
                                                  + marker[0]);
<span class="udiff-line-modified-removed">-                 },</span>
<span class="udiff-line-modified-removed">-                 () -&gt; System.out.println(&quot;Success: No \&quot;no inheritance marker\&quot; detected.&quot;));</span>
<span class="udiff-line-modified-added">+             })</span>
<span class="udiff-line-modified-added">+             .count();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // 8220037: Make sure CLDRConverter uniquely produces bundles, regardless of the</span>
<span class="udiff-line-added">+         // source file enumeration order.</span>
<span class="udiff-line-added">+         /* 8234347: CLDR Converter will not pre-fill short display names from COMPAT anymore.</span>
<span class="udiff-line-added">+         tz = TimeZone.getTimeZone(&quot;America/Argentina/La_Rioja&quot;);</span>
<span class="udiff-line-added">+         if (!&quot;ARST&quot;.equals(tz.getDisplayName(true, TimeZone.SHORT,</span>
<span class="udiff-line-added">+                                 new Locale.Builder()</span>
<span class="udiff-line-added">+                                     .setLanguage(&quot;en&quot;)</span>
<span class="udiff-line-added">+                                     .setRegion(&quot;CA&quot;)</span>
<span class="udiff-line-added">+                                     .build()))) {</span>
<span class="udiff-line-added">+             System.err.println(&quot;Short display name of \&quot;&quot; + tz.getID() + &quot;\&quot; was not \&quot;ARST\&quot;&quot;);</span>
<span class="udiff-line-added">+             errors++;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         */</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (errors &gt; 0) {</span>
<span class="udiff-line-added">+             throw new RuntimeException(&quot;test failed&quot;);</span>
<span class="udiff-line-added">+         }</span>
      }
  }
</pre>
<center><a href="Bug8066652Run.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="TimeZoneDatePermissionCheckRun.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>