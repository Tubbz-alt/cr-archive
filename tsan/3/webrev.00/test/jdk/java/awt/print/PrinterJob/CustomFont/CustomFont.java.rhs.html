<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/awt/print/PrinterJob/CustomFont/CustomFont.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2007, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25   @test
<a name="2" id="anc2"></a><span class="line-modified"> 26   @bug 4386025 8231243</span>
 27   @summary fonts not in win32 font directory print incorrectly.
 28   @author prr: area=PrinterJob
 29   @run main/manual CustomFont
 30 */
 31 import java.io.*;
 32 import java.awt.*;
 33 import java.awt.event.*;
 34 import java.awt.print.*;
 35 
 36 
 37 public class CustomFont implements Printable {
 38 
 39    private Image opaqueimg,transimg;
 40 
 41    private static void init() {
 42 
 43         //*** Create instructions for the user here ***
 44 
 45         String[] instructions = {
 46          &quot;On-screen inspection is not possible for this printing-specific&quot;,
 47          &quot;test therefore its only output is a printed page.&quot;,
 48          &quot;To be able to run this test it is required to have a default&quot;,
 49          &quot;printer configured in your user environment.&quot;,
 50          &quot;&quot;,
 51          &quot;Visual inspection of the printed page is needed. A passing&quot;,
 52          &quot;test will print a page on which one line of text will be&quot;,
 53          &quot;printed: a long string of &#39;A&#39; characters.&quot;,
 54          &quot;The A should have of a curly style&quot;,
 55          &quot;If instead its in the default sansserif font, the test fails&quot;,
 56        };
 57 
 58       Sysout.createDialog( );
 59       Sysout.printInstructions( instructions );
 60 
 61         PrinterJob pjob = PrinterJob.getPrinterJob();
 62 
 63         Book book = new Book();
 64 
 65         PageFormat portrait = pjob.defaultPage();
 66         book.append(new CustomFont(),portrait);
 67 
 68         pjob.setPageable(book);
 69 
 70         if (pjob.printDialog()) {
 71             try {
 72                 pjob.print();
 73             } catch (PrinterException e) {
 74                 System.err.println(e);
 75                 e.printStackTrace();
 76             }
 77         }
 78         System.out.println(&quot;Done Printing&quot;);
 79 
 80     }//End  init()
 81 
 82 
 83   Font customFont;
 84   public CustomFont() {
 85        try {
<a name="3" id="anc3"></a><span class="line-modified"> 86              String dir = System.getProperty(&quot;test.src&quot;, &quot;.&quot;);</span>
<span class="line-added"> 87              String fileName = dir + File.separator + &quot;A.ttf&quot;;</span>
<span class="line-added"> 88              FileInputStream fin = new FileInputStream(fileName);</span>
 89              Font cf = Font.createFont(Font.TRUETYPE_FONT, fin);
 90              customFont = cf.deriveFont(Font.PLAIN, 14);
 91         } catch (Exception ioe) {
<a name="4" id="anc4"></a><span class="line-modified"> 92              throw new RuntimeException(ioe);</span>

 93         }
 94   }
 95 
 96   public int print(Graphics g, PageFormat pgFmt, int pgIndex) {
 97 
 98        Graphics2D g2D = (Graphics2D) g;
 99        g2D.translate(pgFmt.getImageableX(), pgFmt.getImageableY());
100 
101        g2D.setColor(Color.black);
102        g2D.setFont(customFont);
<a name="5" id="anc5"></a><span class="line-modified">103        String str = &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;;</span>
104        g.drawString(str, 100, 100);
105 
106        return Printable.PAGE_EXISTS;
107   }
108 
109   /**
110    * The graphics is scaled and the font and the positions
111    * are reduced in respect to the scaling, so that all
112    * printing should be the same.
113    *
114    * @param g2D     graphics2D to paint on
115    * @param font    font to paint
116    * @param scale   scale for the painting
117    * @param x       x position
118    * @param y       y position
119    */
120   private void printScale(Graphics2D g2D, Font font,
121                            float scale, float x, float y) {
122 
123     int RES = 72;
124 
125     g2D.scale(scale, scale);
126 
127     g2D.setFont   (font.deriveFont(10.0f / scale));
128     g2D.drawString(&quot;This text is scaled by a factor of &quot; + scale,
129                    x * RES / scale, y * RES / scale);
130 
131     g2D.scale(1/scale, 1/scale);
132 
133 }
134 
135    /*****************************************************
136      Standard Test Machinery Section
137       DO NOT modify anything in this section -- it&#39;s a
138       standard chunk of code which has all of the
139       synchronisation necessary for the test harness.
140       By keeping it the same in all tests, it is easier
141       to read and understand someone else&#39;s test, as
142       well as insuring that all tests behave correctly
143       with the test harness.
144      There is a section following this for test-defined
145       classes
146    ******************************************************/
147    private static boolean theTestPassed = false;
148    private static boolean testGeneratedInterrupt = false;
149    private static String failureMessage = &quot;&quot;;
150 
151    private static Thread mainThread = null;
152 
153    private static int sleepTime = 300000;
154 
155    public static void main( String args[] ) throws InterruptedException
156     {
157       mainThread = Thread.currentThread();
158       try
159        {
160          init();
161        }
162       catch( TestPassedException e )
163        {
164          //The test passed, so just return from main and harness will
165          // interepret this return as a pass
166          return;
167        }
168       //At this point, neither test passed nor test failed has been
169       // called -- either would have thrown an exception and ended the
170       // test, so we know we have multiple threads.
171 
172       //Test involves other threads, so sleep and wait for them to
173       // called pass() or fail()
174       try
175        {
176          Thread.sleep( sleepTime );
177          //Timed out, so fail the test
178          throw new RuntimeException( &quot;Timed out after &quot; + sleepTime/1000 + &quot; seconds&quot; );
179        }
180       catch (InterruptedException e)
181        {
182          if( ! testGeneratedInterrupt ) throw e;
183 
184          //reset flag in case hit this code more than once for some reason (just safety)
185          testGeneratedInterrupt = false;
186          if ( theTestPassed == false )
187           {
188             throw new RuntimeException( failureMessage );
189           }
190        }
191 
192     }//main
193 
194    public static synchronized void setTimeoutTo( int seconds )
195     {
196       sleepTime = seconds * 1000;
197     }
198 
199    public static synchronized void pass()
200     {
201       Sysout.println( &quot;The test passed.&quot; );
202       Sysout.println( &quot;The test is over, hit  Ctl-C to stop Java VM&quot; );
203       //first check if this is executing in main thread
204       if ( mainThread == Thread.currentThread() )
205        {
206          //Still in the main thread, so set the flag just for kicks,
207          // and throw a test passed exception which will be caught
208          // and end the test.
209          theTestPassed = true;
210          throw new TestPassedException();
211        }
212       //pass was called from a different thread, so set the flag and interrupt
213       // the main thead.
214       theTestPassed = true;
215       testGeneratedInterrupt = true;
216       mainThread.interrupt();
217     }//pass()
218 
219    public static synchronized void fail()
220     {
221       //test writer didn&#39;t specify why test failed, s     fail( &quot;it just plain failed! :-)&quot; );
222     }
223 
224    public static synchronized void fail( String whyFailed )
225     {
226       Sysout.println( &quot;The test failed: &quot; + whyFailed );
227       Sysout.println( &quot;The test is over, hit  Ctl-C to stop Java VM&quot; );
228       //check if this called from main thread
229       if ( mainThread == Thread.currentThread() )
230        {
231          //If main thread, fail now &#39;cause not sleeping
232          throw new RuntimeException( whyFailed );
233        }
234       theTestPassed = false;
235       testGeneratedInterrupt = true;
236       failureMessage = whyFailed;
237       mainThread.interrupt();
238     }//fail()
239 
240 }// class CustomFont
241 
242 //This exception is used to exit from any level of call nesting
243 // when it&#39;s determined that the test has passed, and immediately
244 // end the test.
245 class TestPassedException extends RuntimeException
246  {
247  }
248 
249 
250 //************** End classes defined for the test *******************
251 
252 
253 
254 
255 /****************************************************
256  Standard Test Machinery
257  DO NOT modify anything below -- it&#39;s a standard
258   chunk of code whose purpose is to make user
259   interaction uniform, and thereby make it simpler
260   to read and understand someone else&#39;s test.
261  ****************************************************/
262 
263 /**
264  This is part of the standard test machinery.
265  It creates a dialog (with the instructions), and is the interface
266   for sending text messages to the user.
267  To print the instructions, send an array of strings to Sysout.createDialog
268   WithInstructions method.  Put one line of instructions per array entry.
269  To display a message for the tester to see, simply call Sysout.println
270   with the string to be displayed.
271  This mimics System.out.println but works within the test harness as well
272   as standalone.
273  */
274 
275 class Sysout
276  {
277    private static TestDialog dialog;
278 
279    public static void createDialogWithInstructions( String[] instructions )
280     {
281       dialog = new TestDialog( new Frame(), &quot;Instructions&quot; );
282       dialog.printInstructions( instructions );
283       dialog.show();
284       println( &quot;Any messages for the tester will display here.&quot; );
285     }
286 
287    public static void createDialog( )
288     {
289       dialog = new TestDialog( new Frame(), &quot;Instructions&quot; );
290       String[] defInstr = { &quot;Instructions will appear here. &quot;, &quot;&quot; } ;
291       dialog.printInstructions( defInstr );
292       dialog.show();
293       println( &quot;Any messages for the tester will display here.&quot; );
294     }
295 
296 
297    public static void printInstructions( String[] instructions )
298     {
299       dialog.printInstructions( instructions );
300     }
301 
302 
303    public static void println( String messageIn )
304     {
305       dialog.displayMessage( messageIn );
306     }
307 
308  }// Sysout  class
309 
310 /**
311   This is part of the standard test machinery.  It provides a place for the
312    test instructions to be displayed, and a place for interactive messages
313    to the user to be displayed.
314   To have the test instructions displayed, see Sysout.
315   To have a message to the user be displayed, see Sysout.
316   Do not call anything in this dialog directly.
317   */
318 class TestDialog extends Dialog implements ActionListener {
319 
320    TextArea instructionsText;
321    TextArea messageText;
322    int maxStringLength = 80;
323    Panel  buttonP = new Panel();
324    Button passB = new Button( &quot;pass&quot; );
325    Button failB = new Button( &quot;fail&quot; );
326 
327    //DO NOT call this directly, go through Sysout
328    public TestDialog( Frame frame, String name )
329     {
330       super( frame, name );
331       int scrollBoth = TextArea.SCROLLBARS_BOTH;
332       instructionsText = new TextArea( &quot;&quot;, 15, maxStringLength, scrollBoth );
333       add( &quot;North&quot;, instructionsText );
334 
335       messageText = new TextArea( &quot;&quot;, 5, maxStringLength, scrollBoth );
336       add(&quot;Center&quot;, messageText);
337 
338       passB = new Button( &quot;pass&quot; );
339       passB.setActionCommand( &quot;pass&quot; );
340       passB.addActionListener( this );
341       buttonP.add( &quot;East&quot;, passB );
342 
343       failB = new Button( &quot;fail&quot; );
344       failB.setActionCommand( &quot;fail&quot; );
345       failB.addActionListener( this );
346       buttonP.add( &quot;West&quot;, failB );
347 
348       add( &quot;South&quot;, buttonP );
349       pack();
350 
351       show();
352     }// TestDialog()
353 
354    //DO NOT call this directly, go through Sysout
355    public void printInstructions( String[] instructions )
356     {
357       //Clear out any current instructions
358       instructionsText.setText( &quot;&quot; );
359 
360       //Go down array of instruction strings
361 
362       String printStr, remainingStr;
363       for( int i=0; i &lt; instructions.length; i++ )
364        {
365          //chop up each into pieces maxSringLength long
366          remainingStr = instructions[ i ];
367          while( remainingStr.length() &gt; 0 )
368           {
369             //if longer than max then chop off first max chars to print
370             if( remainingStr.length() &gt;= maxStringLength )
371              {
372                //Try to chop on a word boundary
373                int posOfSpace = remainingStr.
374                   lastIndexOf( &#39; &#39;, maxStringLength - 1 );
375 
376                if( posOfSpace &lt;= 0 ) posOfSpace = maxStringLength - 1;
377 
378                printStr = remainingStr.substring( 0, posOfSpace + 1 );
379                remainingStr = remainingStr.substring( posOfSpace + 1 );
380              }
381             //else just print
382             else
383              {
384                printStr = remainingStr;
385                remainingStr = &quot;&quot;;
386              }
387 
388             instructionsText.append( printStr + &quot;\n&quot; );
389 
390           }// while
391 
392        }// for
393 
394     }//printInstructions()
395 
396    //DO NOT call this directly, go through Sysout
397    public void displayMessage( String messageIn )
398     {
399       messageText.append( messageIn + &quot;\n&quot; );
400     }
401 
402    //catch presses of the passed and failed buttons.
403    //simply call the standard pass() or fail() static methods of
404    //CustomFont
405    public void actionPerformed( ActionEvent e )
406     {
407       if( e.getActionCommand() == &quot;pass&quot; )
408        {
409          CustomFont.pass();
410        }
411       else
412        {
413          CustomFont.fail();
414        }
415     }
416 
417  }// TestDialog  class
<a name="6" id="anc6"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="6" type="hidden" />
</body>
</html>