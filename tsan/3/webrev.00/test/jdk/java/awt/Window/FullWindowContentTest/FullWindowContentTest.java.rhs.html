<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/awt/Window/FullWindowContentTest/FullWindowContentTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 /**
 27  * @test
 28  * @key headful
 29  * @bug 8211301
 30  * @summary [macosx] support full window content options
 31  * @author Alan Snyder
 32  * @run main FullWindowContentTest
 33  * @requires (os.family == &quot;mac&quot;)
<a name="2" id="anc2"></a><span class="line-modified"> 34  */</span>
 35 
 36 import java.awt.AWTException;
 37 import java.awt.Color;
 38 import java.awt.Rectangle;
 39 import java.awt.Robot;
 40 import java.awt.image.BufferedImage;
 41 import java.lang.reflect.InvocationTargetException;
 42 import javax.swing.JComponent;
 43 import javax.swing.JFrame;
 44 import javax.swing.JRootPane;
 45 import javax.swing.SwingUtilities;
 46 
 47 public class FullWindowContentTest
 48 {
 49     static FullWindowContentTest theTest;
 50     private Robot robot;
 51     private JFrame frame;
 52     private JRootPane rootPane;
 53     static boolean isTransparentSupported = getOSVersion() &gt;= 1010;
 54 
 55     private int DELAY = 1000;
 56 
 57     public FullWindowContentTest() {
 58         try {
 59             robot = new Robot();
 60         } catch (AWTException ex) {
 61             throw new RuntimeException(ex);
 62         }
 63     }
 64 
 65     public void performTest() {
 66 
 67         runSwing(() -&gt; {
 68             frame = new JFrame(&quot;Test&quot;);
 69             frame.setBounds(200, 200, 300, 100);
 70             rootPane = frame.getRootPane();
 71             JComponent contentPane = (JComponent) frame.getContentPane();
 72             contentPane.setBackground(Color.RED);
 73             rootPane.putClientProperty(&quot;apple.awt.fullWindowContent&quot;, true);
 74             rootPane.putClientProperty(&quot;apple.awt.transparentTitleBar&quot;, true);
 75             frame.setVisible(true);
 76         });
 77 
 78         robot.delay(DELAY);
 79         checkTransparent();
 80 
 81         runSwing(() -&gt; rootPane.putClientProperty(&quot;apple.awt.transparentTitleBar&quot;, false));
 82 
 83         robot.delay(DELAY);
 84         checkTranslucent();
 85 
 86         runSwing(() -&gt; rootPane.putClientProperty(&quot;apple.awt.fullWindowContent&quot;, false));
 87 
 88         robot.delay(DELAY);
 89         checkNormal();
 90 
 91         runSwing(() -&gt; rootPane.putClientProperty(&quot;apple.awt.fullWindowContent&quot;, true));
 92 
 93         robot.delay(DELAY);
 94         checkTranslucent();
 95 
 96         runSwing(() -&gt; rootPane.putClientProperty(&quot;apple.awt.transparentTitleBar&quot;, true));
 97 
 98         robot.delay(DELAY);
 99         checkTransparent();
100 
101         runSwing(() -&gt; frame.dispose());
102 
103         frame = null;
104         rootPane = null;
105     }
106 
107     private void checkTransparent() {
108         if (isTransparentSupported) {
109             Color c = getTestPixel();
110             int delta = c.getRed() - c.getBlue();
111             if (delta &lt; 200) {
112                 throw new RuntimeException(&quot;Test failed: did not find transparent title bar color&quot;);
113             }
114             checkContent();
115         } else {
116             checkTranslucent();
117         }
118     }
119 
120     private void checkTranslucent() {
121         Color c = getTestPixel();
122         int delta = c.getRed() - c.getBlue();
<a name="3" id="anc3"></a><span class="line-modified">123         if (delta &lt; 40 || delta &gt; 150) {</span>
124             throw new RuntimeException(&quot;Test failed: did not find translucent title bar color&quot;);
125         }
126         checkContent();
127     }
128 
129     private void checkNormal() {
130         Color c = getTestPixel();
131         int delta = c.getRed() - c.getBlue();
<a name="4" id="anc4"></a><span class="line-modified">132         if (delta &lt; -40 || delta &gt; 40) {</span>
133             throw new RuntimeException(&quot;Test failed: did not find normal title bar color&quot;);
134         }
135         checkContent();
136     }
137 
138     private void checkContent() {
139         // Check the bottom of the content area to make sure the insets were changed.
140         Color c = getContentPixel();
141         int delta = c.getRed() - c.getBlue();
142         if (delta &lt; 200) {
143             throw new RuntimeException(&quot;Test failed: did not find content color&quot;);
144         }
145     }
146 
147     private Color getContentPixel() {
148         Rectangle bounds = frame.getBounds();
149         Color c = robot.getPixelColor(bounds.x + 80, bounds.y + bounds.height - 10);
150         return c;
151     }
152 
153     private Color getTestPixel() {
154         Rectangle bounds = frame.getBounds();
155         BufferedImage screenImage = robot.createScreenCapture(bounds);
156         int rgb = screenImage.getRGB(80, 10);
157         int red = (rgb &gt;&gt; 16) &amp; 0xFF;
158         int green = (rgb &gt;&gt; 8) &amp; 0xFF;
159         int blue = rgb &amp; 0xFF;
160         Color c = new Color(red, green, blue);
161 
162         // Note: the following code returns significantly wrong values.
163         // For example, it returns 42 24 24 for a translucent red that should be more like 243 151 151.
164 
165 //        Color c = robot.getPixelColor(bounds.x + 80, bounds.y + 10);
166 
167         return c;
168     }
169 
170     public void dispose() {
171         if (frame != null) {
172             frame.dispose();
173             frame = null;
174         }
175     }
176 
177     private static int getOSVersion() {
178         String s = System.getProperty(&quot;os.version&quot;);
179         int p = s.indexOf(&#39;.&#39;);
180         int major = Integer.parseInt(s.substring(0, p));
181         s = s.substring(p+1);
182         p = s.indexOf(&#39;.&#39;);
183         int minor = Integer.parseInt(p &gt;= 0 ? s.substring(0, p) : s);
184         return major * 100 + minor;
185     }
186 
187     private static void runSwing(Runnable r) {
188         try {
189             SwingUtilities.invokeAndWait(r);
190         } catch (InterruptedException e) {
191         } catch (InvocationTargetException e) {
192             throw new RuntimeException(e);
193         }
194     }
195 
196     public static void main(String[] args) {
197         if (!System.getProperty(&quot;os.name&quot;).contains(&quot;OS X&quot;)) {
198             System.out.println(&quot;This test is for MacOS only. Automatically passed on other platforms.&quot;);
199             return;
200         }
201 
202         try {
203             runSwing(() -&gt; theTest = new FullWindowContentTest());
204             theTest.performTest();
<a name="5" id="anc5"></a>
205         } finally {
206             if (theTest != null) {
207                 runSwing(() -&gt; theTest.dispose());
208             }
209         }
210     }
211 }
<a name="6" id="anc6"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="6" type="hidden" />
</body>
</html>