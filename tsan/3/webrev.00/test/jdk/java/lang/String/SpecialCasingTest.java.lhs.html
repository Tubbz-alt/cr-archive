<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/lang/String/SpecialCasingTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 /*
 27  * @test
 28  * @bug 4397357 6565620 6959267 7070436 7198195 8041791 8032446 8072600
<a name="2" id="anc2"></a>
 29  * @summary Confirm special case mappings are handled correctly.
<a name="3" id="anc3"></a>
 30  */
 31 
 32 import java.io.BufferedReader;
 33 import java.io.IOException;
 34 import java.nio.file.Files;
 35 import java.nio.file.Paths;
 36 import java.util.ArrayList;
 37 import java.util.List;
 38 import java.util.Locale;
 39 import java.util.StringTokenizer;
 40 
 41 public class SpecialCasingTest {
 42 
 43     private static boolean err = false;
 44 
 45     // Locales which are used for testing
 46     private static List&lt;Locale&gt; locales = new ArrayList&lt;&gt;();
 47     static {
 48         locales.add(new Locale(&quot;az&quot;, &quot;&quot;));
 49         locales.addAll(java.util.Arrays.asList(Locale.getAvailableLocales()));
 50     }
 51 
 52     // Default locale
 53     private static String defaultLang;
 54 
 55     // True if the default language is az, lt, or tr which has locale-specific
 56     // mappings.
 57     private static boolean specificLocale;
 58 
 59     // Additional test cases
 60     //   Pseudo-locales which are used here:
 61     //     L1: locales other than lt
 62     //     L2: locales other than az and tr
 63     //     L3: locales other than az, lt and tr
 64     private static final String[] additionalTestData = {
 65         // Format:
 66         //   &lt;code&gt;; &lt;lower&gt;; &lt;title&gt;; &lt;upper&gt;; (&lt;condition_list&gt;)
 67 
 68         // Counterpart of Final_Sigma test case
 69         //   03A3; 03C2; 03A3; 03A3; Final_Sigma
 70             &quot;03A3; 03C3; 03A3; 03A3; SunSpecific_Not_Final_Sigma1&quot;,
 71             &quot;03A3; 03C3; 03A3; 03A3; SunSpecific_Not_Final_Sigma2&quot;,
 72 
 73         // Counterpart of After_Soft_Dotted test case
 74         //   0307; 0307;     ;     ; lt After_Soft_Dotted
 75             &quot;0307; 0307; 0307; 0307; L1 After_Soft_Dotted&quot;,
 76             &quot;0307; 0307; 0307; 0307; lt SunSpecific_Not_After_Soft_Dotted&quot;,
 77             &quot;0307; 0307; 0307; 0307; L1 SunSpecific_Not_After_Soft_Dotted&quot;,
 78 
 79         // Counterpart of More_Above test cases
 80         //   0049; 0069 0307; 0049; 0049; lt More_Above
 81             &quot;0049; 0131     ; 0049; 0049; az More_Above&quot;,
 82             &quot;0049; 0131     ; 0049; 0049; tr More_Above&quot;,
 83             &quot;0049; 0069     ; 0049; 0049; L3 More_Above&quot;,
 84             &quot;0049; 0069     ; 0049; 0049; lt SunSpecific_Not_More_Above&quot;,
 85             &quot;0049; 0131     ; 0049; 0049; az SunSpecific_Not_More_Above&quot;,
 86             &quot;0049; 0131     ; 0049; 0049; tr SunSpecific_Not_More_Above&quot;,
 87             &quot;0049; 0069     ; 0049; 0049; L3 SunSpecific_Not_More_Above&quot;,
 88         //   004A; 006A 0307; 004A; 004A; lt More_Above
 89             &quot;004A; 006A     ; 004A; 004A; L1 More_Above&quot;,
 90             &quot;004A; 006A     ; 004A; 004A; lt SunSpecific_Not_More_Above&quot;,
 91             &quot;004A; 006A     ; 004A; 004A; L1 SunSpecific_Not_More_Above&quot;,
 92         //   012E; 012F 0307; 012E; 012E; lt More_Above
 93             &quot;012E; 012F     ; 012E; 012E; L1 More_Above&quot;,
 94             &quot;012E; 012F     ; 012E; 012E; lt SunSpecific_Not_More_Above&quot;,
 95             &quot;012E; 012F     ; 012E; 012E; L1 SunSpecific_Not_More_Above&quot;,
 96 
 97         // Counterpart of After_I test cases
 98         //   0307;          ; 0307; 0307; tr After_I
 99         //   0307;          ; 0307; 0307; az After_I
100             &quot;0307; 0307 0307; 0307; 0307; lt After_I&quot;,
101             &quot;0307; 0307     ; 0307; 0307; L3 After_I&quot;,
102             &quot;0307; 0307     ; 0307; 0307; tr SunSpecific_Not_After_I&quot;,
103             &quot;0307; 0307     ; 0307; 0307; az SunSpecific_Not_After_I&quot;,
104             &quot;0307; 0307     ; 0307; 0307; L2 SunSpecific_Not_After_I&quot;,
105 
106         // Counterpart of Not_Before_Dot test cases
107         //   0049; 0131          ; 0049; 0049; tr Not_Before_Dot
108         //   0049; 0131          ; 0049; 0049; az Not_Before_Dot
109             &quot;0049; 0069          ; 0049; 0049; L2 Not_Before_Dot&quot;,
110             &quot;0049; 0069          ; 0049; 0049; tr SunSpecific_Before_Dot&quot;,
111             &quot;0049; 0069          ; 0049; 0049; az SunSpecific_Before_Dot&quot;,
112             &quot;0049; 0069 0307 0307; 0049; 0049; lt SunSpecific_Before_Dot&quot;,
113             &quot;0049; 0069 0307     ; 0049; 0049; L3 SunSpecific_Before_Dot&quot;,
114     };
115 
116     public static void main (String[] args) {
117         SpecialCasingTest specialCasingTest = new SpecialCasingTest();
118         specialCasingTest.test();
119     }
120 
121     private void test ()  {
122         Locale defaultLocale = Locale.getDefault();
123         BufferedReader in = null;
124 
125         try {
126             int locale_num = locales.size();
127             for (int l = 0; l &lt; locale_num; l++) {
128                 Locale locale = locales.get(l);
129                 Locale.setDefault(locale);
130                 System.out.println(&quot;Testing on &quot; + locale + &quot; locale....&quot;);
131 
132                 defaultLang = locale.getLanguage();
133                 if (defaultLang.equals(&quot;az&quot;) ||
134                     defaultLang.equals(&quot;lt&quot;) ||
135                     defaultLang.equals(&quot;tr&quot;)) {
136                     specificLocale = true;
137                 } else {
138                     specificLocale = false;
139                 }
<a name="4" id="anc4"></a><span class="line-modified">140                 in = Files.newBufferedReader(Paths.get(System.getProperty(&quot;test.src.path&quot;), &quot;..&quot;, &quot;/Character/SpecialCasing.txt&quot;)</span>
<span class="line-removed">141                      .toRealPath());</span>
142                 String line;
143                 while ((line = in.readLine()) != null) {
144                     if (line.length() == 0 || line.charAt(0) == &#39;#&#39;) {
145                         continue;
146                     }
147                     test(line);
148                 }
149                 in.close();
150                 in = null;
151                 System.out.println(&quot;Testing with Sun original data....&quot;);
152                 for (String additionalTestData1 : additionalTestData) {
153                     test(additionalTestData1);
154                 }
155             }
156         }
157         catch (IOException e) {
158             err = true;
159             e.printStackTrace();
160         }
161         finally {
162             if (in != null) {
163                 try {
164                     in.close();
165                 }
166                 catch (IOException e) {
167                 }
168             }
169             Locale.setDefault(defaultLocale);
170             if (err) {
171                 throw new RuntimeException(&quot;SpecialCasingTest failed.&quot;);
172             } else {
173                 System.out.println(&quot;*** SpecialCasingTest passed.&quot;);
174             }
175         }
176     }
177 
178     private void test(String line) {
179         int index = line.indexOf(&#39;#&#39;);
180         if (index != -1) {
181             line = line.substring(0, index);
182         }
183 
184         String lang = null;
185         String condition = null;
186         String[] fields = line.split(&quot;; &quot;);
187 
188         for (int i = 0; i &lt; 4; i++) {
189             if (fields[i].length() != 0) {
190                 fields[i] = convert(fields[i]);
191             }
192         }
193         if (fields.length != 4) {
194             StringTokenizer st = new StringTokenizer(fields[4]);
195 
196             while (st.hasMoreTokens()) {
197                 String token = st.nextToken();
198 
199                 if (token.equals(&quot;Final_Sigma&quot;)) {
200                     condition = &quot;Final Sigma&quot;;
201                     fields[0] = &quot;Abc&quot; + fields[0];
202                     fields[1] = &quot;abc&quot; + fields[1];
203                     fields[3] = &quot;ABC&quot; + fields[3];
204                 } else if (token.equals(&quot;SunSpecific_Not_Final_Sigma1&quot;)) {
205                     condition = &quot;*Sun Specific* Not Final Sigma 1&quot;;
206                     fields[0] = &quot;Abc&quot; + fields[0] + &quot;xyz&quot;;
207                     fields[1] = &quot;abc&quot; + fields[1] + &quot;xyz&quot;;
208                     fields[3] = &quot;ABC&quot; + fields[3] + &quot;XYZ&quot;;
209                 } else if (token.equals(&quot;SunSpecific_Not_Final_Sigma2&quot;)) {
210                     condition = &quot;*Sun Specific* Not Final Sigma 2&quot;;
211                 } else if (token.equals(&quot;After_Soft_Dotted&quot;)) {
212                     condition = &quot;After Soft-Dotted&quot;;
213                     fields[0] = &quot;\u1E2D&quot; + fields[0];
214                     fields[1] = &quot;\u1E2D&quot; + fields[1];
215                     fields[3] = &quot;\u1E2C&quot; + fields[3];
216                 } else if (token.equals(&quot;SunSpecific_Not_After_Soft_Dotted&quot;)) {
217                     condition = &quot;*Sun Specific* Not After Soft-Dotted&quot;;
218                     fields[0] = &quot;Dot&quot; + fields[0];
219                     fields[1] = &quot;dot&quot; + fields[1];
220                     fields[3] = &quot;DOT&quot; + fields[3];
221                 } else if (token.equals(&quot;More_Above&quot;)) {
222                     condition = &quot;More Above&quot;;
223                     fields[0] = fields[0] + &quot;\u0306&quot;;
224                     fields[1] = fields[1] + &quot;\u0306&quot;;
225                     fields[3] = fields[3] + &quot;\u0306&quot;;
226                 } else if (token.equals(&quot;SunSpecific_Not_More_Above&quot;)) {
227                     condition = &quot;*Sun Specific* Not More Above&quot;;
228                     fields[0] = fields[0] + &quot;breve&quot;;
229                     fields[1] = fields[1] + &quot;breve&quot;;
230                     fields[3] = fields[3] + &quot;BREVE&quot;;
231                 } else if (token.equals(&quot;After_I&quot;)) {
232                     condition = &quot;After I&quot;;
233                     fields[0] = &quot;I&quot; + fields[0];
234                     fields[1] = &quot;i&quot; + fields[1];
235                     fields[3] = &quot;I&quot; + fields[3];
236                 } else if (token.equals(&quot;SunSpecific_Not_After_I&quot;)) {
237                     condition = &quot;*Sun Specific* Not After I&quot;;
238                     fields[0] = &quot;A&quot; + fields[0];
239                     fields[1] = &quot;a&quot; + fields[1];
240                     fields[3] = &quot;A&quot; + fields[3];
241                 } else if (token.equals(&quot;Not_Before_Dot&quot;)) {
242                     condition = &quot;Not Before Dot&quot;;
243                     fields[0] = fields[0] + &quot;Z&quot;;
244                     fields[1] = fields[1] + &quot;z&quot;;
245                     fields[3] = fields[3] + &quot;Z&quot;;
246                 } else if (token.equals(&quot;SunSpecific_Before_Dot&quot;)) {
247                     condition = &quot;*Sun Specific* Before Dot&quot;;
248                     fields[0] = fields[0] + &quot;\u0307&quot;;
249                     fields[3] = fields[3] + &quot;\u0307&quot;;
250                 } else if (token.length() == 2) {
251                     lang = token;
252 
253                     if (lang.equals(&quot;L1&quot;)) {
254                         if (defaultLang.equals(&quot;lt&quot;)) {
255                             lang = &quot;en&quot;;
256                         } else {
257                             lang = defaultLang;
258                         }
259                     } else if (lang.equals(&quot;L2&quot;)) {
260                         if (defaultLang.equals(&quot;az&quot;) ||
261                             defaultLang.equals(&quot;tr&quot;)) {
262                             lang = &quot;en&quot;;
263                         } else {
264                             lang = defaultLang;
265                         }
266                     } else if (lang.equals(&quot;L3&quot;)) {
267                         if (defaultLang.equals(&quot;az&quot;) ||
268                             defaultLang.equals(&quot;lt&quot;) ||
269                             defaultLang.equals(&quot;tr&quot;)) {
270                             lang = &quot;en&quot;;
271                         } else {
272                             lang = defaultLang;
273                         }
274                     // I want to have another test case here for double-check.
275                     // Current implementation for Character and String considers
276                     // only az, lt, and tr locales. I want to detect if other
277                     // locales are specified.
278                     } else if (!lang.equals(&quot;az&quot;) &amp;&amp;
279                                !lang.equals(&quot;lt&quot;) &amp;&amp;
280                                !lang.equals(&quot;tr&quot;)) {
281                         throw new RuntimeException(&quot;Unsupported locale: &quot; +
282                             lang + &quot;. It may need to be considered in ConditionalSpecialCasing.java. Please confirm.&quot;);
283                     }
284                 } else {
285                     throw new RuntimeException(&quot;Unknown condition: &quot; + token);
286                 }
287             }
288         } else if (fields[0].equals(&quot;\u0130&quot;)) {
289             // special case for \u0130
290             if (defaultLang.equals(&quot;az&quot;) ||
291                 defaultLang.equals(&quot;tr&quot;)) {
292                 lang = &quot;en&quot;;
293             } else {
294                 lang = defaultLang;
295             }
296         }
297         testLowerCase(fields[0], fields[1], lang, condition);
298         testUpperCase(fields[0], fields[3], lang, condition);
299     }
300 
301     private void testLowerCase(String orig, String expected,
302                                String lang, String condition) {
303         String got = (lang == null) ?
304             orig.toLowerCase() : orig.toLowerCase(new Locale(lang, &quot;&quot;));
305 
306         if (!expected.equals(got)) {
307             err = true;
308             System.err.println(&quot;toLowerCase(lang=&quot; + lang +
309                 &quot;) failed.\n\tOriginal: &quot; + toString(orig) +
310                 &quot;\n\tGot:      &quot; + toString(got) +
311                 &quot;\n\tExpected: &quot; + toString(expected) +
312                 ((condition == null) ? &quot;&quot; : (&quot;\n    under condition(&quot; +
313                 condition + &quot;)&quot;)));
314         }
315     }
316 
317     private void testUpperCase(String orig, String expected,
318                                String lang, String condition) {
319         String got = (lang == null) ?
320             orig.toUpperCase() : orig.toUpperCase(new Locale(lang, &quot;&quot;));
321 
322         if (!expected.equals(got)) {
323             err = true;
324             System.err.println(&quot;toUpperCase(lang=&quot; + lang +
325                 &quot;) failed.\n\tOriginal: &quot; + toString(orig) +
326                 &quot;\n\tGot:      &quot; + toString(got) +
327                 &quot;\n\tExpected: &quot; + toString(expected) +
328                 ((condition == null) ? &quot;&quot; : (&quot;\n    under condition(&quot; +
329                 condition + &quot;)&quot;)));
330         }
331     }
332     StringBuilder sb = new StringBuilder();
333 
334     private String convert(String str) {
335         sb.setLength(0);
336 
337         String[] tokens = str.split(&quot; &quot;);
338         for (String token : tokens) {
339             sb.append((char) Integer.parseInt(token, 16));
340         }
341         return sb.toString();
342     }
343 
344     private String toString(String str) {
345         sb.setLength(0);
346 
347         int len = str.length();
348         for (int i = 0; i &lt; len; i++) {
349             sb.append(&quot;0x&quot;).append(Integer.toHexString(str.charAt(i)).toUpperCase()).append(&quot; &quot;);
350         }
351         return sb.toString();
352     }
353 
354 }
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>