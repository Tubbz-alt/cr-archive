<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/jdk/java/lang/String/LiteralReplace.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2015, 2017, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /* @test
 25  * @bug 8058779 8054307
 26  * @library /test/lib
 27  * @build jdk.test.lib.RandomFactory
 28  * @run testng LiteralReplace
 29  * @summary Basic tests of String.replace(CharSequence, CharSequence)
 30  * @key randomness
 31  */
 32 
 33 import java.util.ArrayList;
 34 import java.util.Arrays;
 35 import java.util.Iterator;
 36 import java.util.regex.Matcher;
 37 import java.util.regex.Pattern;
 38 import java.util.Random;
 39 
 40 import jdk.test.lib.RandomFactory;
 41 
 42 import org.testng.annotations.Test;
 43 import org.testng.annotations.DataProvider;
 44 import static org.testng.Assert.fail;
 45 
 46 public class LiteralReplace {
 47 
 48     @Test(dataProvider=&quot;sourceTargetReplacementExpected&quot;)
 49     public void testExpected(String source, String target,
 50              String replacement, String expected)
 51     {
 52         String canonical = canonicalReplace(source, target, replacement);
 53         if (!canonical.equals(expected)) {
 54             fail(&quot;Canonical: &quot; + canonical + &quot; != &quot; + expected);
 55         }
 56         test0(source, target, replacement, expected);
 57     }
 58 
 59     @Test(dataProvider=&quot;sourceTargetReplacement&quot;)
 60     public void testCanonical(String source, String target,
 61             String replacement)
 62     {
 63         String canonical = canonicalReplace(source, target, replacement);
 64         test0(source, target, replacement, canonical);
 65     }
 66 
 67     private void test0(String source, String target, String replacement,
 68             String expected)
 69     {
 70         String result = source.replace(target, replacement);
 71         if (!result.equals(expected)) {
 72             fail(result + &quot; != &quot; + expected);
 73         }
 74     }
 75 
 76     @Test(dataProvider=&quot;sourceTargetReplacementWithNull&quot;,
 77             expectedExceptions = {NullPointerException.class})
 78     public void testNPE(String source, String target, String replacement) {
 79         source.replace(target, replacement);
 80     }
 81 
 82 
 83     @DataProvider
 84     public static Object[][] sourceTargetReplacementExpected() {
 85         return new Object[][] {
 86             {&quot;aaa&quot;, &quot;aa&quot;, &quot;b&quot;, &quot;ba&quot;},
 87             {&quot;abcdefgh&quot;, &quot;def&quot;, &quot;DEF&quot;, &quot;abcDEFgh&quot;},
 88             {&quot;abcdefgh&quot;, &quot;123&quot;, &quot;DEF&quot;, &quot;abcdefgh&quot;},
 89             {&quot;abcdefgh&quot;, &quot;abcdefghi&quot;, &quot;DEF&quot;, &quot;abcdefgh&quot;},
 90             {&quot;abcdefghabc&quot;, &quot;abc&quot;, &quot;DEF&quot;, &quot;DEFdefghDEF&quot;},
 91             {&quot;abcdefghdef&quot;, &quot;def&quot;, &quot;&quot;, &quot;abcgh&quot;},
 92             {&quot;abcdefgh&quot;, &quot;&quot;, &quot;_&quot;, &quot;_a_b_c_d_e_f_g_h_&quot;},
 93             {&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;},
 94             {&quot;&quot;, &quot;a&quot;, &quot;b&quot;, &quot;&quot;},
 95             {&quot;&quot;, &quot;&quot;, &quot;abc&quot;, &quot;abc&quot;},
 96             {&quot;abcdefgh&quot;, &quot;abcdefgh&quot;, &quot;abcdefgh&quot;, &quot;abcdefgh&quot;},
 97             {&quot;abcdefgh&quot;, &quot;abcdefgh&quot;, &quot;abcdefghi&quot;, &quot;abcdefghi&quot;},
 98             {&quot;abcdefgh&quot;, &quot;abcdefgh&quot;, &quot;&quot;, &quot;&quot;},
 99             {&quot;abcdabcd&quot;, &quot;abcd&quot;, &quot;&quot;, &quot;&quot;},
100             {&quot;aaaaaaaaa&quot;, &quot;aa&quot;, &quot;_X_&quot;, &quot;_X__X__X__X_a&quot;},
101             {&quot;aaaaaaaaa&quot;, &quot;aa&quot;, &quot;aaa&quot;, &quot;aaaaaaaaaaaaa&quot;},
102             {&quot;aaaaaaaaa&quot;, &quot;aa&quot;, &quot;aa&quot;, &quot;aaaaaaaaa&quot;},
103             {&quot;a.c.e.g.&quot;, &quot;.&quot;, &quot;-&quot;, &quot;a-c-e-g-&quot;},
104             {&quot;abcdefgh&quot;, &quot;[a-h]&quot;, &quot;X&quot;, &quot;abcdefgh&quot;},
105             {&quot;aa+&quot;, &quot;a+&quot;, &quot;&quot;, &quot;a&quot;},
106             {&quot;^abc$&quot;, &quot;abc&quot;, &quot;x&quot;, &quot;^x$&quot;},
107 
108             // more with non-latin1 characters
109             {&quot;\u4e00\u4e00\u4e00&quot;,
110              &quot;\u4e00\u4e00&quot;,
111              &quot;\u4e01&quot;,
112              &quot;\u4e01\u4e00&quot;},
113 
114             {&quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e05\u4e06\u4e07\u4e08&quot;,
115              &quot;\u4e03\u4e04\u4e05&quot;,
116              &quot;\u4e10\u4e11\u4e12&quot;,
117              &quot;\u4e00\u4e01\u4e02\u4e10\u4e11\u4e12\u4e06\u4e07\u4e08&quot;},
118 
119             {&quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e05\u4e06\u4e07\u4e08&quot;,
120              &quot;ABC&quot;,
121              &quot;\u4e10\u4e11\u4e12&quot;,
122              &quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e05\u4e06\u4e07\u4e08&quot;},
123 
124             {&quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e02\u4e03\u4e07\u4e08&quot;,
125              &quot;\u4e02\u4e03&quot;,
126              &quot;\u4e12\u4e13&quot;,
127              &quot;\u4e00\u4e01\u4e12\u4e13\u4e04\u4e12\u4e13\u4e07\u4e08&quot;},
128 
129             {&quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e02\u4e03\u4e07\u4e08&quot;,
130              &quot;\u4e02\u4e03&quot;,
131              &quot;ab&quot;,
132              &quot;\u4e00\u4e01ab\u4e04ab\u4e07\u4e08&quot;},
133 
134             {&quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e05\u4e06\u4e07&quot;,
135              &quot;&quot;,
136              &quot;_&quot;,
137              &quot;_\u4e00_\u4e01_\u4e02_\u4e03_\u4e04_\u4e05_\u4e06_\u4e07_&quot;},
138             {&quot;^\u4e00\u4e01\u4e02$&quot;,
139              &quot;\u4e00\u4e01\u4e02&quot;,
140              &quot;\u4e03&quot;,
141              &quot;^\u4e03$&quot;},
142 
143             {&quot;&quot;, &quot;\u4e00&quot;, &quot;\u4e01&quot;, &quot;&quot;},
144             {&quot;&quot;, &quot;&quot;, &quot;\u4e00\u4e01\u4e02&quot;, &quot;\u4e00\u4e01\u4e02&quot;},
145 
146             {&quot;^\u4e00\u4e01\u4e02$&quot;,
147              &quot;\u4e00\u4e01\u4e02&quot;,
148              &quot;X&quot;,
149              &quot;^X$&quot;},
150 
151             {&quot;abcdefgh&quot;,
152              &quot;def&quot;,
153              &quot;\u4e01&quot;,
154              &quot;abc\u4e01gh&quot;},
155 
156             {&quot;abcdefgh&quot;,
157              &quot;def&quot;,
158              &quot;\u4e01\u4e02&quot;,
159              &quot;abc\u4e01\u4e02gh&quot;},
160 
161             {&quot;abcdefabcgh&quot;,
162              &quot;abc&quot;,
163              &quot;\u4e01\u4e02&quot;,
164              &quot;\u4e01\u4e02def\u4e01\u4e02gh&quot;},
165 
166             {&quot;abcdefabcghabc&quot;,
167              &quot;abc&quot;,
168              &quot;\u4e01\u4e02&quot;,
169              &quot;\u4e01\u4e02def\u4e01\u4e02gh\u4e01\u4e02&quot;},
170 
171             {&quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e05&quot;,
172              &quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e05&quot;,
173              &quot;abcd&quot;,
174              &quot;abcd&quot;},
175 
176             {&quot;\u4e00\u4e01&quot;,
177              &quot;\u4e00\u4e01&quot;,
178              &quot;abcdefg&quot;,
179              &quot;abcdefg&quot;},
180 
181             {&quot;\u4e00\u4e01xyz&quot;,
182              &quot;\u4e00\u4e01&quot;,
183              &quot;abcdefg&quot;,
184              &quot;abcdefgxyz&quot;},
185 
186             {&quot;\u4e00\u4e00\u4e00\u4e00\u4e00\u4e00&quot;,
187              &quot;\u4e00\u4e00&quot;,
188              &quot;\u4e00\u4e00\u4e00&quot;,
189              &quot;\u4e00\u4e00\u4e00\u4e00\u4e00\u4e00\u4e00\u4e00\u4e00&quot;},
190 
191             {&quot;\u4e00\u4e00\u4e00\u4e00\u4e00\u4e00&quot;,
192              &quot;\u4e00\u4e00\u4e00&quot;,
193              &quot;\u4e00\u4e00&quot;,
194              &quot;\u4e00\u4e00\u4e00\u4e00&quot;},
195 
196             {&quot;\u4e00.\u4e01.\u4e02.\u4e03.\u4e04.&quot;,
197              &quot;.&quot;,
198              &quot;-&quot;,
199              &quot;\u4e00-\u4e01-\u4e02-\u4e03-\u4e04-&quot;},
200 
201             {&quot;\u4e00\u4e00\u4e00\u4e00\u4e00\u4e00&quot;,
202              &quot;\u4e00&quot;,
203              &quot;&quot;,
204              &quot;&quot;},
205 
206             {&quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e05&quot;,
207              &quot;\u4e00\u4e01\u4e02\u4e03\u4e04\u4e05&quot;,
208              &quot;&quot;,
209              &quot;&quot;},
210         };
211     }
212 
213     @DataProvider
214     public static Iterator&lt;Object[]&gt; sourceTargetReplacement() {
215         ArrayList&lt;Object[]&gt; list = new ArrayList&lt;&gt;();
216         for (int maxSrcLen = 1; maxSrcLen &lt;= (1 &lt;&lt; 10); maxSrcLen &lt;&lt;= 1) {
217             for (int maxTrgLen = 1; maxTrgLen &lt;= (1 &lt;&lt; 10); maxTrgLen &lt;&lt;= 1) {
218                 for (int maxPrlLen = 1; maxPrlLen &lt;= (1 &lt;&lt; 10); maxPrlLen &lt;&lt;= 1) {
219                     list.add(makeArray(makeRandomString(maxSrcLen),
220                                        makeRandomString(maxTrgLen),
221                                        makeRandomString(maxPrlLen)));
222 
223                     String source = makeRandomString(maxSrcLen);
224                     list.add(makeArray(source,
225                                        mekeRandomSubstring(source, maxTrgLen),
226                                        makeRandomString(maxPrlLen)));
227                 }
228             }
229         }
230         return list.iterator();
231     }
232 
233     @DataProvider
234     public static Iterator&lt;Object[]&gt; sourceTargetReplacementWithNull() {
235         ArrayList&lt;Object[]&gt; list = new ArrayList&lt;&gt;();
236         Object[] arr = {null, &quot;&quot;, &quot;a&quot;, &quot;b&quot;, &quot;string&quot;, &quot;str&quot;, &quot;ababstrstr&quot;};
237         for (int i = 0; i &lt; arr.length; ++i) {
238             for (int j = 0; j &lt; arr.length; ++j) {
239                 for (int k = 0; k &lt; arr.length; ++k) {
240                     if (arr[i] != null &amp;&amp; (arr[j] == null || arr[k] == null)) {
241                         list.add(makeArray(arr[i], arr[j], arr[k]));
242                     }
243                 }
244             }
245         }
246         return list.iterator();
247     }
248 
249     // utilities
250 
251     /**
252      * How the String.replace(CharSequence, CharSequence) used to be implemented
253      */
254     private static String canonicalReplace(String source, String target, String replacement) {
255         return Pattern.compile(target.toString(), Pattern.LITERAL).matcher(
256                 source).replaceAll(Matcher.quoteReplacement(replacement.toString()));
257     }
258 
259     private static final Random random = RandomFactory.getRandom();
260 
261     private static final char[] CHARS = (&quot;qwertyuiop[]12345678&quot; +
262         &quot;90-=\\`asdfghjkl;&#39;zxcvbnm,./~!@#$%^&amp;*()_+|QWERTYUIOP{&quot; +
263         &quot;}ASDFGHJKL:\&quot;ZXCVBNM&lt;&gt;?\n\r\t\u0444\u044B\u0432\u0430&quot;).toCharArray();
264 
265     private static String makeRandomString(int maxLen) {
266         int len = random.nextInt(maxLen);
267         char[] buf = new char[len];
268         for (int i = 0; i &lt; len; ++i) {
269             buf[i] = CHARS[random.nextInt(CHARS.length)];
270         }
271         return new String(buf);
272     }
273 
274     private static String mekeRandomSubstring(String source, int maxLen) {
275         if (source.isEmpty()) {
276             return source;
277         }
278         int pos = random.nextInt(source.length());
279         int len = Integer.min(source.length() - pos,
280                               random.nextInt(maxLen));
281         return source.substring(pos, pos + len);
282     }
283 
284     private static Object[] makeArray(Object... array) {
285          return array;
286     }
287 }
    </pre>
  </body>
</html>