<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/lang/System/Logger/custom/CustomLoggerTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../StringBuffer/CompactStringBuffer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../default/DefaultLoggerTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/lang/System/Logger/custom/CustomLoggerTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
687             perms.add(p);
688             return this;
689         }
690         public PermissionsBuilder addAll(PermissionCollection col) {
691             if (col != null) {
692                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
693                     perms.add(e.nextElement());
694                 }
695             }
696             return this;
697         }
698         public Permissions toPermissions() {
699             final PermissionsBuilder builder = new PermissionsBuilder();
700             builder.addAll(perms);
701             return builder.perms;
702         }
703     }
704 
705     public static class SimplePolicy extends Policy {
706 


707         static final RuntimePermission LOGGERFINDER_PERMISSION =
708                 new RuntimePermission(&quot;loggerFinder&quot;);
709         final Permissions permissions;
710         final Permissions controlPermissions;
711         final Permissions allPermissions;
712         final ThreadLocal&lt;AtomicBoolean&gt; allowControl;
713         final ThreadLocal&lt;AtomicBoolean&gt; allowAll;
714         public SimplePolicy(ThreadLocal&lt;AtomicBoolean&gt; allowControl, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
715             this.allowControl = allowControl;
716             this.allowAll = allowAll;
717             permissions = new Permissions();
718 
719             // these are used for configuring the test itself...
720             controlPermissions = new Permissions();
721             controlPermissions.add(LOGGERFINDER_PERMISSION);
722 
723             // these are used for simulating a doPrivileged call from
724             // a class in the BCL
725             allPermissions = new Permissions();
726             allPermissions.add(new AllPermission());
727 
728         }
729 
730         Permissions permissions() {
731             if (allowAll.get().get()) return allPermissions;
732             if (allowControl.get().get()) return controlPermissions;
733             return permissions;
734 
735         }
736 
737         @Override
738         public boolean implies(ProtectionDomain domain, Permission permission) {
<span class="line-modified">739             return permissions().implies(permission);</span>
740         }
741 
742         @Override
743         public PermissionCollection getPermissions(CodeSource codesource) {
744             return new PermissionsBuilder().addAll(permissions()).toPermissions();
745         }
746 
747         @Override
748         public PermissionCollection getPermissions(ProtectionDomain domain) {
749             return new PermissionsBuilder().addAll(permissions()).toPermissions();
750         }
751     }
752 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
687             perms.add(p);
688             return this;
689         }
690         public PermissionsBuilder addAll(PermissionCollection col) {
691             if (col != null) {
692                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
693                     perms.add(e.nextElement());
694                 }
695             }
696             return this;
697         }
698         public Permissions toPermissions() {
699             final PermissionsBuilder builder = new PermissionsBuilder();
700             builder.addAll(perms);
701             return builder.perms;
702         }
703     }
704 
705     public static class SimplePolicy extends Policy {
706 
<span class="line-added">707         static final Policy DEFAULT_POLICY = Policy.getPolicy();</span>
<span class="line-added">708 </span>
709         static final RuntimePermission LOGGERFINDER_PERMISSION =
710                 new RuntimePermission(&quot;loggerFinder&quot;);
711         final Permissions permissions;
712         final Permissions controlPermissions;
713         final Permissions allPermissions;
714         final ThreadLocal&lt;AtomicBoolean&gt; allowControl;
715         final ThreadLocal&lt;AtomicBoolean&gt; allowAll;
716         public SimplePolicy(ThreadLocal&lt;AtomicBoolean&gt; allowControl, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
717             this.allowControl = allowControl;
718             this.allowAll = allowAll;
719             permissions = new Permissions();
720 
721             // these are used for configuring the test itself...
722             controlPermissions = new Permissions();
723             controlPermissions.add(LOGGERFINDER_PERMISSION);
724 
725             // these are used for simulating a doPrivileged call from
726             // a class in the BCL
727             allPermissions = new Permissions();
728             allPermissions.add(new AllPermission());
729 
730         }
731 
732         Permissions permissions() {
733             if (allowAll.get().get()) return allPermissions;
734             if (allowControl.get().get()) return controlPermissions;
735             return permissions;
736 
737         }
738 
739         @Override
740         public boolean implies(ProtectionDomain domain, Permission permission) {
<span class="line-modified">741             return permissions().implies(permission) || DEFAULT_POLICY.implies(domain, permission);</span>
742         }
743 
744         @Override
745         public PermissionCollection getPermissions(CodeSource codesource) {
746             return new PermissionsBuilder().addAll(permissions()).toPermissions();
747         }
748 
749         @Override
750         public PermissionCollection getPermissions(ProtectionDomain domain) {
751             return new PermissionsBuilder().addAll(permissions()).toPermissions();
752         }
753     }
754 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../StringBuffer/CompactStringBuffer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../default/DefaultLoggerTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>