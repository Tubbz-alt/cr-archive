<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/lang/System/Logger/default/DefaultLoggerTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../custom/CustomLoggerTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../LoggerFinder/BaseLoggerFinderTest/BaseLoggerFinderTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/lang/System/Logger/default/DefaultLoggerTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
867         public PermissionsBuilder add(Permission p) {
868             perms.add(p);
869             return this;
870         }
871         public PermissionsBuilder addAll(PermissionCollection col) {
872             if (col != null) {
873                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
874                     perms.add(e.nextElement());
875                 }
876             }
877             return this;
878         }
879         public Permissions toPermissions() {
880             final PermissionsBuilder builder = new PermissionsBuilder();
881             builder.addAll(perms);
882             return builder.perms;
883         }
884     }
885 
886     public static class SimplePolicy extends Policy {



887         static final RuntimePermission LOGGERFINDER_PERMISSION =
888                 new RuntimePermission(&quot;loggerFinder&quot;);
889         final Permissions permissions;
890         final Permissions allPermissions;
891         final Permissions controlPermissions;
892         final ThreadLocal&lt;AtomicBoolean&gt; allowControl;
893         final ThreadLocal&lt;AtomicBoolean&gt; allowAll;
894         public SimplePolicy(ThreadLocal&lt;AtomicBoolean&gt; allowControl, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
895             this.allowControl = allowControl;
896             this.allowAll = allowAll;
897             permissions = new Permissions();
898 
899             // these are used for configuring the test itself...
900             controlPermissions = new Permissions();
901             controlPermissions.add(LOGGERFINDER_PERMISSION);
902             allPermissions = new Permissions();
903             allPermissions.add(new java.security.AllPermission());
904 
905         }
906 
907         @Override
908         public boolean implies(ProtectionDomain domain, Permission permission) {
909             if (allowAll.get().get()) return allPermissions.implies(permission);
910             if (allowControl.get().get()) return controlPermissions.implies(permission);
<span class="line-modified">911             return permissions.implies(permission);</span>
912         }
913 
914         @Override
915         public PermissionCollection getPermissions(CodeSource codesource) {
916             return new PermissionsBuilder().addAll(allowAll.get().get()
917                     ? allPermissions : allowControl.get().get()
918                     ? controlPermissions : permissions).toPermissions();
919         }
920 
921         @Override
922         public PermissionCollection getPermissions(ProtectionDomain domain) {
923             return new PermissionsBuilder().addAll(allowAll.get().get()
924                     ? allPermissions : allowControl.get().get()
925                     ? controlPermissions : permissions).toPermissions();
926         }
927     }
928 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
867         public PermissionsBuilder add(Permission p) {
868             perms.add(p);
869             return this;
870         }
871         public PermissionsBuilder addAll(PermissionCollection col) {
872             if (col != null) {
873                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
874                     perms.add(e.nextElement());
875                 }
876             }
877             return this;
878         }
879         public Permissions toPermissions() {
880             final PermissionsBuilder builder = new PermissionsBuilder();
881             builder.addAll(perms);
882             return builder.perms;
883         }
884     }
885 
886     public static class SimplePolicy extends Policy {
<span class="line-added">887 </span>
<span class="line-added">888         static final Policy DEFAULT_POLICY = Policy.getPolicy();</span>
<span class="line-added">889 </span>
890         static final RuntimePermission LOGGERFINDER_PERMISSION =
891                 new RuntimePermission(&quot;loggerFinder&quot;);
892         final Permissions permissions;
893         final Permissions allPermissions;
894         final Permissions controlPermissions;
895         final ThreadLocal&lt;AtomicBoolean&gt; allowControl;
896         final ThreadLocal&lt;AtomicBoolean&gt; allowAll;
897         public SimplePolicy(ThreadLocal&lt;AtomicBoolean&gt; allowControl, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
898             this.allowControl = allowControl;
899             this.allowAll = allowAll;
900             permissions = new Permissions();
901 
902             // these are used for configuring the test itself...
903             controlPermissions = new Permissions();
904             controlPermissions.add(LOGGERFINDER_PERMISSION);
905             allPermissions = new Permissions();
906             allPermissions.add(new java.security.AllPermission());
907 
908         }
909 
910         @Override
911         public boolean implies(ProtectionDomain domain, Permission permission) {
912             if (allowAll.get().get()) return allPermissions.implies(permission);
913             if (allowControl.get().get()) return controlPermissions.implies(permission);
<span class="line-modified">914             return permissions.implies(permission) || DEFAULT_POLICY.implies(domain, permission);</span>
915         }
916 
917         @Override
918         public PermissionCollection getPermissions(CodeSource codesource) {
919             return new PermissionsBuilder().addAll(allowAll.get().get()
920                     ? allPermissions : allowControl.get().get()
921                     ? controlPermissions : permissions).toPermissions();
922         }
923 
924         @Override
925         public PermissionCollection getPermissions(ProtectionDomain domain) {
926             return new PermissionsBuilder().addAll(allowAll.get().get()
927                     ? allPermissions : allowControl.get().get()
928                     ? controlPermissions : permissions).toPermissions();
929         }
930     }
931 }
</pre>
</td>
</tr>
</table>
<center><a href="../custom/CustomLoggerTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../LoggerFinder/BaseLoggerFinderTest/BaseLoggerFinderTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>