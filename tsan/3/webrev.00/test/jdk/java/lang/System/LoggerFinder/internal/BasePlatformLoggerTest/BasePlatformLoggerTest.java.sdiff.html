<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/lang/System/LoggerFinder/internal/BasePlatformLoggerTest/BasePlatformLoggerTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../BaseLoggerBridgeTest/BaseLoggerBridgeTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../LoggerBridgeTest/LoggerBridgeTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/lang/System/LoggerFinder/internal/BasePlatformLoggerTest/BasePlatformLoggerTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
646         }
647         public PermissionsBuilder addAll(PermissionCollection col) {
648             if (col != null) {
649                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
650                     perms.add(e.nextElement());
651                 }
652             }
653             return this;
654         }
655         public Permissions toPermissions() {
656             final PermissionsBuilder builder = new PermissionsBuilder();
657             builder.addAll(perms);
658             return builder.perms;
659         }
660     }
661 
662     public static class SimplePolicy extends Policy {
663         final static RuntimePermission CONTROL = LOGGERFINDER_PERMISSION;
664         final static RuntimePermission ACCESS_LOGGING = new RuntimePermission(&quot;accessClassInPackage.sun.util.logging&quot;);
665 


666         final Permissions permissions;
667         final Permissions allPermissions;
668         final ThreadLocal&lt;AtomicBoolean&gt; allowControl;
669         final ThreadLocal&lt;AtomicBoolean&gt; allowAccess;
670         final ThreadLocal&lt;AtomicBoolean&gt; allowAll;
671         public SimplePolicy(ThreadLocal&lt;AtomicBoolean&gt; allowControl,
672                 ThreadLocal&lt;AtomicBoolean&gt; allowAccess,
673                 ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
674             this.allowControl = allowControl;
675             this.allowAccess = allowAccess;
676             this.allowAll = allowAll;
677             permissions = new Permissions();
678             allPermissions = new PermissionsBuilder()
679                     .add(new java.security.AllPermission())
680                     .toPermissions();
681         }
682 
683         Permissions getPermissions() {
684             if (allowControl.get().get() || allowAccess.get().get() || allowAll.get().get()) {
685                 PermissionsBuilder builder =  new PermissionsBuilder()
686                         .addAll(permissions);
687                 if (allowControl.get().get()) {
688                     builder.add(CONTROL);
689                 }
690                 if (allowAccess.get().get()) {
691                     builder.add(ACCESS_LOGGING);
692                 }
693                 if (allowAll.get().get()) {
694                     builder.addAll(allPermissions);
695                 }
696                 return builder.toPermissions();
697             }
698             return permissions;
699         }
700 
701         @Override
702         public boolean implies(ProtectionDomain domain, Permission permission) {
<span class="line-modified">703             return getPermissions().implies(permission);</span>
704         }
705 
706         @Override
707         public PermissionCollection getPermissions(CodeSource codesource) {
708             return new PermissionsBuilder().addAll(getPermissions()).toPermissions();
709         }
710 
711         @Override
712         public PermissionCollection getPermissions(ProtectionDomain domain) {
713             return new PermissionsBuilder().addAll(getPermissions()).toPermissions();
714         }
715     }
716 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
646         }
647         public PermissionsBuilder addAll(PermissionCollection col) {
648             if (col != null) {
649                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
650                     perms.add(e.nextElement());
651                 }
652             }
653             return this;
654         }
655         public Permissions toPermissions() {
656             final PermissionsBuilder builder = new PermissionsBuilder();
657             builder.addAll(perms);
658             return builder.perms;
659         }
660     }
661 
662     public static class SimplePolicy extends Policy {
663         final static RuntimePermission CONTROL = LOGGERFINDER_PERMISSION;
664         final static RuntimePermission ACCESS_LOGGING = new RuntimePermission(&quot;accessClassInPackage.sun.util.logging&quot;);
665 
<span class="line-added">666         static final Policy DEFAULT_POLICY = Policy.getPolicy();</span>
<span class="line-added">667 </span>
668         final Permissions permissions;
669         final Permissions allPermissions;
670         final ThreadLocal&lt;AtomicBoolean&gt; allowControl;
671         final ThreadLocal&lt;AtomicBoolean&gt; allowAccess;
672         final ThreadLocal&lt;AtomicBoolean&gt; allowAll;
673         public SimplePolicy(ThreadLocal&lt;AtomicBoolean&gt; allowControl,
674                 ThreadLocal&lt;AtomicBoolean&gt; allowAccess,
675                 ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
676             this.allowControl = allowControl;
677             this.allowAccess = allowAccess;
678             this.allowAll = allowAll;
679             permissions = new Permissions();
680             allPermissions = new PermissionsBuilder()
681                     .add(new java.security.AllPermission())
682                     .toPermissions();
683         }
684 
685         Permissions getPermissions() {
686             if (allowControl.get().get() || allowAccess.get().get() || allowAll.get().get()) {
687                 PermissionsBuilder builder =  new PermissionsBuilder()
688                         .addAll(permissions);
689                 if (allowControl.get().get()) {
690                     builder.add(CONTROL);
691                 }
692                 if (allowAccess.get().get()) {
693                     builder.add(ACCESS_LOGGING);
694                 }
695                 if (allowAll.get().get()) {
696                     builder.addAll(allPermissions);
697                 }
698                 return builder.toPermissions();
699             }
700             return permissions;
701         }
702 
703         @Override
704         public boolean implies(ProtectionDomain domain, Permission permission) {
<span class="line-modified">705             return getPermissions().implies(permission) || DEFAULT_POLICY.implies(domain, permission);</span>
706         }
707 
708         @Override
709         public PermissionCollection getPermissions(CodeSource codesource) {
710             return new PermissionsBuilder().addAll(getPermissions()).toPermissions();
711         }
712 
713         @Override
714         public PermissionCollection getPermissions(ProtectionDomain domain) {
715             return new PermissionsBuilder().addAll(getPermissions()).toPermissions();
716         }
717     }
718 }
</pre>
</td>
</tr>
</table>
<center><a href="../BaseLoggerBridgeTest/BaseLoggerBridgeTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../LoggerBridgeTest/LoggerBridgeTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>