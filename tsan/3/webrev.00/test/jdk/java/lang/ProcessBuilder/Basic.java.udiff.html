<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/java/lang/ProcessBuilder/Basic.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../Math/ExactArithTests.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="SecurityManagerClinit.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/lang/ProcessBuilder/Basic.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -25,11 +25,11 @@</span>
   * @test
   * @bug 4199068 4738465 4937983 4930681 4926230 4931433 4932663 4986689
   *      5026830 5023243 5070673 4052517 4811767 6192449 6397034 6413313
   *      6464154 6523983 6206031 4960438 6631352 6631966 6850957 6850958
   *      4947220 7018606 7034570 4244896 5049299 8003488 8054494 8058464
<span class="udiff-line-modified-removed">-  *      8067796</span>
<span class="udiff-line-modified-added">+  *      8067796 8224905</span>
   * @key intermittent
   * @summary Basic tests for Process and Environment Variable code
   * @modules java.base/java.lang:open
   * @run main/othervm/timeout=300 Basic
   * @run main/othervm/timeout=300 -Djdk.lang.Process.launchMechanism=fork Basic
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2109,10 +2109,23 @@</span>
                              switch (action &amp; 0x2) {
                                  case 0: r = s.read(); break;
                                  case 2: r = s.read(bytes); break;
                                  default: throw new Error();
                              }
<span class="udiff-line-added">+                             if (r &gt;= 0) {</span>
<span class="udiff-line-added">+                                 // The child sent unexpected output; print it to diagnose</span>
<span class="udiff-line-added">+                                 System.out.println(&quot;Unexpected child output:&quot;);</span>
<span class="udiff-line-added">+                                 if ((action &amp; 0x2) == 0) {</span>
<span class="udiff-line-added">+                                     System.out.write(r);    // Single character</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                                 } else {</span>
<span class="udiff-line-added">+                                     System.out.write(bytes, 0, r);</span>
<span class="udiff-line-added">+                                 }</span>
<span class="udiff-line-added">+                                 for (int c = s.read(); c &gt;= 0; c = s.read())</span>
<span class="udiff-line-added">+                                     System.out.write(c);</span>
<span class="udiff-line-added">+                                 System.out.println(&quot;\nEND Child output.&quot;);</span>
<span class="udiff-line-added">+                             }</span>
                              equal(-1, r);
                          } catch (IOException ioe) {
                              if (!ioe.getMessage().equals(&quot;Stream closed&quot;)) {
                                  // BufferedInputStream may throw IOE(&quot;Stream closed&quot;).
                                  unexpected(ioe);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2185,12 +2198,14 @@</span>
                          try { stdout.read(); }
                          catch (IOException e) {
                              // Check that reader failed because stream was
                              // asynchronously closed.
                              // e.printStackTrace();
<span class="udiff-line-added">+                             String msg = e.getMessage();</span>
                              if (EnglishUnix.is() &amp;&amp;
<span class="udiff-line-modified-removed">-                                 ! (e.getMessage().matches(&quot;.*Bad file.*&quot;)))</span>
<span class="udiff-line-modified-added">+                                 ! (msg.matches(&quot;.*Bad file.*&quot;) ||</span>
<span class="udiff-line-added">+                                         msg.matches(&quot;.*Stream closed.*&quot;)))</span>
                                  unexpected(e);
                          }
                          catch (Throwable t) { unexpected(t); }}};
                  reader.setDaemon(true);
                  reader.start();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2598,10 +2613,12 @@</span>
  
      //----------------------------------------------------------------
      // A Policy class designed to make permissions fiddling very easy.
      //----------------------------------------------------------------
      private static class Policy extends java.security.Policy {
<span class="udiff-line-added">+         static final java.security.Policy DEFAULT_POLICY = java.security.Policy.getPolicy();</span>
<span class="udiff-line-added">+ </span>
          private Permissions perms;
  
          public void setPermissions(Permission...permissions) {
              perms = new Permissions();
              for (Permission permission : permissions)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2617,11 +2634,11 @@</span>
          public PermissionCollection getPermissions(ProtectionDomain pd) {
              return perms;
          }
  
          public boolean implies(ProtectionDomain pd, Permission p) {
<span class="udiff-line-modified-removed">-             return perms.implies(p);</span>
<span class="udiff-line-modified-added">+             return perms.implies(p) || DEFAULT_POLICY.implies(pd, p);</span>
          }
  
          public void refresh() {}
      }
  
</pre>
<center><a href="../Math/ExactArithTests.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="SecurityManagerClinit.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>