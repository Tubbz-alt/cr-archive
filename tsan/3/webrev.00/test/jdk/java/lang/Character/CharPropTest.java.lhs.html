<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/lang/Character/CharPropTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<a name="2" id="anc2"></a><span class="line-modified"> 26  * @bug 8202771</span>
 27  * @summary Check j.l.Character.isDigit/isLetter/isLetterOrDigit/isSpaceChar
 28  * /isWhitespace/isTitleCase/isISOControl/isIdentifierIgnorable
 29  * /isJavaIdentifierStart/isJavaIdentifierPart/isUnicodeIdentifierStart
 30  * /isUnicodeIdentifierPart
<a name="3" id="anc3"></a>
 31  * @run main CharPropTest
 32  */
 33 
 34 import java.nio.file.Files;
<a name="4" id="anc4"></a><span class="line-removed"> 35 import java.nio.file.Path;</span>
<span class="line-removed"> 36 import java.nio.file.Paths;</span>
 37 import java.util.stream.Stream;
 38 
 39 public class CharPropTest {
 40     private static int diffs = 0;
 41     private static int rangeStart = 0x0000;
 42     private static boolean isRange = false;
 43 
 44     public static void main(String[] args) throws Exception {
<a name="5" id="anc5"></a><span class="line-modified"> 45         Path path = Paths.get(System.getProperty(&quot;test.src&quot;, &quot;.&quot;),</span>
<span class="line-removed"> 46                 &quot;UnicodeData.txt&quot;);</span>
<span class="line-removed"> 47         try (Stream&lt;String&gt; lines = Files.lines(path)) {</span>
 48             lines.map(String::trim)
 49                  .filter(line -&gt; line.length() != 0 &amp;&amp; line.charAt(0) != &#39;#&#39;)
 50                  .forEach(line -&gt; handleOneLine(line));
 51 
 52             if (diffs != 0) {
 53                 throw new RuntimeException(&quot;Total differences: &quot; + diffs);
 54             }
 55         }
 56     }
 57 
 58     private static void handleOneLine(String line) {
 59         String[] fields = line.split(&quot;;&quot;);
 60         int currentCp = Integer.parseInt(fields[0], 16);
 61         String name = fields[1];
 62         String category = fields[2];
 63 
 64         // Except single code point, also handle ranges like the following:
 65         // 3400;&lt;CJK Ideograph Extension A, First&gt;;Lo;0;L;;;;;N;;;;;
 66         // 4DB5;&lt;CJK Ideograph Extension A, Last&gt;;Lo;0;L;;;;;N;;;;
 67         if (isRange) {
 68             if (name.endsWith(&quot;Last&gt;&quot;)) {
 69                 for (int cp = rangeStart; cp &lt;= currentCp; cp++) {
 70                     testCodePoint(cp, category);
 71                 }
 72             } else {
 73                 throw new RuntimeException(&quot;Not a valid range, first range &lt;&quot;
 74                         + Integer.toHexString(rangeStart) + &quot;&gt; without last.&quot;);
 75             }
 76             isRange = false;
 77         } else {
 78             if (name.endsWith(&quot;First&gt;&quot;)) {
 79                 rangeStart = currentCp;
 80                 isRange = true;
 81             } else {
 82                 testCodePoint(currentCp, category);
 83             }
 84         }
 85     }
 86 
 87     private static void testCodePoint(int codePoint, String category) {
 88         isDigitTest(codePoint, category);
 89         isLetterTest(codePoint, category);
 90         isLetterOrDigitTest(codePoint, category);
 91 
 92         isSpaceCharTest(codePoint, category);
 93         isWhitespaceTest(codePoint, category);
 94 
 95         isTitleCaseTest(codePoint, category);
 96 
 97         isISOControlTest(codePoint);
 98 
 99         isIdentifierIgnorableTest(codePoint, category);
100         isJavaIdentifierStartTest(codePoint, category);
101         isJavaIdentifierPartTest(codePoint, category);
102         isUnicodeIdentifierStartTest(codePoint, category);
103         isUnicodeIdentifierPartTest(codePoint, category);
104     }
105 
106     private static void isDigitTest(int codePoint, String category) {
107         boolean actual = Character.isDigit(codePoint);
108         boolean expected = category.equals(&quot;Nd&quot;);
109         if (actual != expected) {
110             printDiff(codePoint, &quot;isDigit&quot;, actual, expected);
111         }
112     }
113 
114     private static void isLetterTest(int codePoint, String category) {
115         boolean actual = Character.isLetter(codePoint);
116         boolean expected = isLetter(category);
117         if (actual != expected) {
118             printDiff(codePoint, &quot;isLetter&quot;, actual, expected);
119         }
120     }
121 
122     private static void isLetterOrDigitTest(int codePoint, String category) {
123         boolean actual = Character.isLetterOrDigit(codePoint);
124         boolean expected = isLetter(category) || category.equals(&quot;Nd&quot;);
125         if (actual != expected) {
126             printDiff(codePoint, &quot;isLetterOrDigit&quot;, actual, expected);
127         }
128     }
129 
130     private static void isSpaceCharTest(int codePoint, String category) {
131         boolean actual = Character.isSpaceChar(codePoint);
132         boolean expected = isSpaceChar(category);
133         if (actual != expected) {
134             printDiff(codePoint, &quot;isSpaceChar&quot;, actual, expected);
135         }
136     }
137 
138     private static void isWhitespaceTest(int codePoint, String category) {
139         boolean actual = Character.isWhitespace(codePoint);
140         boolean expected = isWhitespace(codePoint, category);
141         if (actual != expected) {
142             printDiff(codePoint, &quot;isWhitespace&quot;, actual, expected);
143         }
144     }
145 
146     private static void isTitleCaseTest(int codePoint, String category) {
147         boolean actual = Character.isTitleCase(codePoint);
148         boolean expected = category.equals(&quot;Lt&quot;);
149         if (actual != expected) {
150             printDiff(codePoint, &quot;isTitleCase&quot;, actual, expected);
151         }
152     }
153 
154     private static void isISOControlTest(int codePoint) {
155         boolean actual = Character.isISOControl(codePoint);
156         boolean expected = isISOControl(codePoint);
157         if (actual != expected) {
158             printDiff(codePoint, &quot;isISOControl&quot;, actual, expected);
159         }
160     }
161 
162     private static void isIdentifierIgnorableTest(int codePoint, String category) {
163         boolean actual = Character.isIdentifierIgnorable(codePoint);
164         boolean expected = isIdentifierIgnorable(codePoint, category);
165         if (actual != expected) {
166             printDiff(codePoint, &quot;isIdentifierIgnorable&quot;, actual, expected);
167         }
168     }
169 
170     private static void isJavaIdentifierStartTest(int codePoint, String category) {
171         boolean actual = Character.isJavaIdentifierStart(codePoint);
172         boolean expected = isJavaIdentifierStart(category);
173         if (actual != expected) {
174             printDiff(codePoint, &quot;isJavaIdentifierStart&quot;, actual, expected);
175         }
176     }
177 
178     private static void isJavaIdentifierPartTest(int codePoint, String category) {
179         boolean actual = Character.isJavaIdentifierPart(codePoint);
180         boolean expected = isJavaIdentifierPart(codePoint, category);
181         if (actual != expected) {
182             printDiff(codePoint, &quot;isJavaIdentifierPart&quot;, actual, expected);
183         }
184     }
185 
186     private static void isUnicodeIdentifierStartTest(int codePoint, String category) {
187         boolean actual = Character.isUnicodeIdentifierStart(codePoint);
<a name="6" id="anc6"></a><span class="line-modified">188         boolean expected = isUnicodeIdentifierStart(category);</span>
189         if (actual != expected) {
190             printDiff(codePoint, &quot;isUnicodeIdentifierStart&quot;, actual, expected);
191         }
192     }
193 
194     private static void isUnicodeIdentifierPartTest(int codePoint, String category) {
195         boolean actual = Character.isUnicodeIdentifierPart(codePoint);
196         boolean expected = isUnicodeIdentifierPart(codePoint, category);
197         if (actual != expected) {
198             printDiff(codePoint, &quot;isUnicodeIdentifierPart&quot;, actual, expected);
199         }
200     }
201 
202     private static boolean isLetter(String category) {
203         return category.equals(&quot;Lu&quot;) || category.equals(&quot;Ll&quot;)
204                || category.equals(&quot;Lt&quot;) || category.equals(&quot;Lm&quot;)
205                || category.equals(&quot;Lo&quot;);
206     }
207 
208     private static boolean isSpaceChar(String category) {
209         return category.equals(&quot;Zs&quot;) || category.equals(&quot;Zl&quot;)
210                || category.equals(&quot;Zp&quot;);
211     }
212 
213     private static boolean isWhitespace(int codePoint, String category) {
214         if (isSpaceChar(category) &amp;&amp; codePoint != Integer.parseInt(&quot;00A0&quot;, 16)
215                 &amp;&amp; codePoint != Integer.parseInt(&quot;2007&quot;, 16)
216                 &amp;&amp; codePoint != Integer.parseInt(&quot;202F&quot;, 16)) {
217             return true;
218         } else {
219             if (codePoint == Integer.parseInt(&quot;0009&quot;, 16)
220                     || codePoint == Integer.parseInt(&quot;000A&quot;, 16)
221                     || codePoint == Integer.parseInt(&quot;000B&quot;, 16)
222                     || codePoint == Integer.parseInt(&quot;000C&quot;, 16)
223                     || codePoint == Integer.parseInt(&quot;000D&quot;, 16)
224                     || codePoint == Integer.parseInt(&quot;001C&quot;, 16)
225                     || codePoint == Integer.parseInt(&quot;001D&quot;, 16)
226                     || codePoint == Integer.parseInt(&quot;001E&quot;, 16)
227                     || codePoint == Integer.parseInt(&quot;001F&quot;, 16)) {
228                 return true;
229             }
230         }
231         return false;
232     }
233 
234     private static boolean isISOControl(int codePoint) {
235         return (codePoint &gt; 0x00 &amp;&amp; codePoint &lt; 0x1f)
236                || (codePoint &gt; 0x7f &amp;&amp; codePoint &lt; 0x9f)
237                || (codePoint == 0x00 || codePoint == 0x1f || codePoint == 0x7f || codePoint == 0x9f);
238     }
239 
240     private static boolean isIdentifierIgnorable(int codePoint, String category) {
241         if (category.equals(&quot;Cf&quot;)) {
242             return true;
243         } else {
244             int a1 = Integer.parseInt(&quot;0000&quot;, 16);
245             int a2 = Integer.parseInt(&quot;0008&quot;, 16);
246             int b1 = Integer.parseInt(&quot;000E&quot;, 16);
247             int b2 = Integer.parseInt(&quot;001B&quot;, 16);
248             int c1 = Integer.parseInt(&quot;007F&quot;, 16);
249             int c2 = Integer.parseInt(&quot;009F&quot;, 16);
250 
251             if ((codePoint &gt; a1 &amp;&amp; codePoint &lt; a2) || (codePoint &gt; b1 &amp;&amp; codePoint &lt; b2)
252                     || (codePoint &gt; c1 &amp;&amp; codePoint &lt; c2) || (codePoint == a1 || codePoint == a2
253                     || codePoint == b1 || codePoint == b2 || codePoint == c1 || codePoint == c2)) {
254                 return true;
255             }
256         }
257         return false;
258     }
259 
260     private static boolean isJavaIdentifierStart(String category) {
261         return isLetter(category) || category.equals(&quot;Nl&quot;) || category.equals(&quot;Sc&quot;)
262                || category.equals(&quot;Pc&quot;);
263     }
264 
265     private static boolean isJavaIdentifierPart(int codePoint, String category) {
266         return isLetter(category) || category.equals(&quot;Sc&quot;) || category.equals(&quot;Pc&quot;)
267                || category.equals(&quot;Nd&quot;) || category.equals(&quot;Nl&quot;)
268                || category.equals(&quot;Mc&quot;) || category.equals(&quot;Mn&quot;)
269                || isIdentifierIgnorable(codePoint, category);
270     }
271 
<a name="7" id="anc7"></a><span class="line-modified">272     private static boolean isUnicodeIdentifierStart(String category) {</span>
<span class="line-modified">273         return isLetter(category) || category.equals(&quot;Nl&quot;);</span>

274     }
275 
276     private static boolean isUnicodeIdentifierPart(int codePoint, String category) {
277         return isLetter(category) || category.equals(&quot;Pc&quot;) || category.equals(&quot;Nd&quot;)
278                || category.equals(&quot;Nl&quot;) || category.equals(&quot;Mc&quot;) || category.equals(&quot;Mn&quot;)
<a name="8" id="anc8"></a><span class="line-modified">279                || isIdentifierIgnorable(codePoint, category);</span>


















280     }
281 
282     private static void printDiff(int codePoint, String method, boolean actual, boolean expected) {
283         System.out.println(&quot;Not equal at codePoint &lt;&quot; + Integer.toHexString(codePoint)
284                 + &quot;&gt;, method: &quot; + method
285                 + &quot;, actual: &quot; + actual + &quot;, expected: &quot; + expected);
286         diffs++;
287     }
288 }
<a name="9" id="anc9"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="9" type="hidden" />
</body>
</html>