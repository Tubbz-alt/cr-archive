<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/java/lang/invoke/TryFinallyTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="MethodHandlesTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="VarHandles/accessibility/TestFieldLookupAccessibility.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/lang/invoke/TryFinallyTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 22,12 ***</span>
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   */
  
  /* @test
<span class="line-modified">!  * @bug 8139885 8150824 8150825 8194238</span>
<span class="line-modified">!  * @run testng/othervm -ea -esa test.java.lang.invoke.TryFinallyTest</span>
   */
  
  package test.java.lang.invoke;
  
  import java.lang.invoke.MethodHandle;
<span class="line-new-header">--- 22,12 ---</span>
   * or visit www.oracle.com if you need additional information or have any
   * questions.
   */
  
  /* @test
<span class="line-modified">!  * @bug 8139885 8150824 8150825 8194238 8233920</span>
<span class="line-modified">!  * @run testng/othervm -ea -esa -Xverify:all test.java.lang.invoke.TryFinallyTest</span>
   */
  
  package test.java.lang.invoke;
  
  import java.lang.invoke.MethodHandle;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 53,10 ***</span>
<span class="line-new-header">--- 53,45 ---</span>
          MethodHandle hello = MethodHandles.tryFinally(TryFinally.MH_greet, TryFinally.MH_exclaim);
          assertEquals(TryFinally.MT_hello, hello.type());
          assertEquals(&quot;Hello, world!&quot;, hello.invoke(&quot;world&quot;));
      }
  
<span class="line-added">+     @DataProvider</span>
<span class="line-added">+     static Object[][] tryFinallyArgs() {</span>
<span class="line-added">+         return new Object[][] {</span>
<span class="line-added">+                 { boolean.class, true },</span>
<span class="line-added">+                 { byte.class, (byte) 2 },</span>
<span class="line-added">+                 { short.class, (short) 2 },</span>
<span class="line-added">+                 { char.class, (char) 2 },</span>
<span class="line-added">+                 { int.class, 2 },</span>
<span class="line-added">+                 { long.class, 2L },</span>
<span class="line-added">+                 { float.class, 2f },</span>
<span class="line-added">+                 { double.class, 2D },</span>
<span class="line-added">+                 { Object.class, new Object() }</span>
<span class="line-added">+         };</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Test(dataProvider = &quot;tryFinallyArgs&quot;)</span>
<span class="line-added">+     public static void testTryFinally(Class&lt;?&gt; argType, Object arg) throws Throwable {</span>
<span class="line-added">+         MethodHandle identity = MethodHandles.identity(argType);</span>
<span class="line-added">+         MethodHandle tryFinally = MethodHandles.tryFinally(</span>
<span class="line-added">+                 identity,</span>
<span class="line-added">+                 MethodHandles.dropArguments(identity, 0, Throwable.class));</span>
<span class="line-added">+         assertEquals(methodType(argType, argType), tryFinally.type());</span>
<span class="line-added">+         assertEquals(arg, tryFinally.invoke(arg));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Test(dataProvider = &quot;tryFinallyArgs&quot;, expectedExceptions = TryFinally.T1.class)</span>
<span class="line-added">+     public static void testTryFinallyException(Class&lt;?&gt; argType, Object arg) throws Throwable {</span>
<span class="line-added">+         MethodHandle identity = TryFinally.MH_throwingTargetIdentity.asType(methodType(argType, argType));</span>
<span class="line-added">+         MethodHandle tryFinally = MethodHandles.tryFinally(</span>
<span class="line-added">+                 identity,</span>
<span class="line-added">+                 MethodHandles.dropArguments(identity, 0, TryFinally.T1.class));</span>
<span class="line-added">+         assertEquals(methodType(argType, argType), tryFinally.type());</span>
<span class="line-added">+         tryFinally.invoke(arg); // should throw</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      @Test
      public static void testTryFinallyVoid() throws Throwable {
          MethodHandle tfVoid = MethodHandles.tryFinally(TryFinally.MH_print, TryFinally.MH_printMore);
          assertEquals(TryFinally.MT_printHello, tfVoid.type());
          tfVoid.invoke(&quot;world&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 173,10 ***</span>
<span class="line-new-header">--- 208,14 ---</span>
  
          static void throwingTarget() throws Throwable {
              throw new T1();
          }
  
<span class="line-added">+         static Object throwingTargetIdentity(Object o) throws Throwable {</span>
<span class="line-added">+             throw new T1();</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
          static void catchingCleanup(T2 t) throws Throwable {
          }
  
          static final Class&lt;TryFinally&gt; TRY_FINALLY = TryFinally.class;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 187,10 ***</span>
<span class="line-new-header">--- 226,11 ---</span>
          static final MethodType MT_greetMore = methodType(String.class, String.class, String.class);
          static final MethodType MT_exclaimMore = methodType(String.class, Throwable.class, String.class, String.class);
          static final MethodType MT_voidTarget = methodType(void.class);
          static final MethodType MT_voidCleanup = methodType(void.class, Throwable.class);
          static final MethodType MT_throwingTarget = methodType(void.class);
<span class="line-added">+         static final MethodType MT_throwingTargetIdentity = methodType(Object.class, Object.class);</span>
          static final MethodType MT_catchingCleanup = methodType(void.class, T2.class);
  
          static final MethodHandle MH_greet;
          static final MethodHandle MH_exclaim;
          static final MethodHandle MH_print;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 198,10 ***</span>
<span class="line-new-header">--- 238,11 ---</span>
          static final MethodHandle MH_greetMore;
          static final MethodHandle MH_exclaimMore;
          static final MethodHandle MH_voidTarget;
          static final MethodHandle MH_voidCleanup;
          static final MethodHandle MH_throwingTarget;
<span class="line-added">+         static final MethodHandle MH_throwingTargetIdentity;</span>
          static final MethodHandle MH_catchingCleanup;
  
          static final MethodHandle MH_dummyTarget;
  
          static final MethodType MT_hello = methodType(String.class, String.class);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 217,10 ***</span>
<span class="line-new-header">--- 258,11 ---</span>
                  MH_greetMore = LOOKUP.findStatic(TRY_FINALLY, &quot;greetMore&quot;, MT_greetMore);
                  MH_exclaimMore = LOOKUP.findStatic(TRY_FINALLY, &quot;exclaimMore&quot;, MT_exclaimMore);
                  MH_voidTarget = LOOKUP.findStatic(TRY_FINALLY, &quot;voidTarget&quot;, MT_voidTarget);
                  MH_voidCleanup = LOOKUP.findStatic(TRY_FINALLY, &quot;voidCleanup&quot;, MT_voidCleanup);
                  MH_throwingTarget = LOOKUP.findStatic(TRY_FINALLY, &quot;throwingTarget&quot;, MT_throwingTarget);
<span class="line-added">+                 MH_throwingTargetIdentity = LOOKUP.findStatic(TRY_FINALLY, &quot;throwingTargetIdentity&quot;, MT_throwingTargetIdentity);</span>
                  MH_catchingCleanup = LOOKUP.findStatic(TRY_FINALLY, &quot;catchingCleanup&quot;, MT_catchingCleanup);
                  MH_dummyTarget = MethodHandles.dropArguments(MH_voidTarget, 0, int.class, long.class, Object.class,
                          int.class, long.class, Object.class);
              } catch (Exception e) {
                  throw new ExceptionInInitializerError(e);
</pre>
<center><a href="MethodHandlesTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="VarHandles/accessibility/TestFieldLookupAccessibility.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>