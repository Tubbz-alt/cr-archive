<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/lang/management/MemoryMXBean/CollectionUsageThreshold.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../GarbageCollectorMXBean/GcInfoCompositeType.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="LowMemoryTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/lang/management/MemoryMXBean/CollectionUsageThreshold.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 59     private static final int THRESHOLD = 10;
 60     private static volatile int numGCs = 0;
 61 
 62     // semaphore to signal the arrival of a low memory notification
 63     private static final Semaphore signals = new Semaphore(0);
 64     // barrier for the main thread to wait until the checker thread
 65     // finishes checking the low memory notification result
 66     private static final CyclicBarrier barrier = new CyclicBarrier(2);
 67 
 68     /**
 69      * Run the test multiple times with different GC versions.
 70      * First with default command line specified by the framework.
 71      * Then with GC versions specified by the test.
 72      */
 73     public static void main(String a[]) throws Throwable {
 74         final String main = &quot;CollectionUsageThreshold$TestMain&quot;;
 75         RunUtil.runTestKeepGcOpts(main);
 76         RunUtil.runTestClearGcOpts(main, &quot;-XX:+UseSerialGC&quot;);
 77         RunUtil.runTestClearGcOpts(main, &quot;-XX:+UseParallelGC&quot;);
 78         RunUtil.runTestClearGcOpts(main, &quot;-XX:+UseG1GC&quot;);
<span class="line-removed"> 79         if (!Compiler.isGraalEnabled()) { // Graal does not support CMS</span>
<span class="line-removed"> 80             RunUtil.runTestClearGcOpts(main, &quot;-XX:+UseConcMarkSweepGC&quot;);</span>
<span class="line-removed"> 81         }</span>
 82     }
 83 
 84     static class PoolRecord {
 85         private final MemoryPoolMXBean pool;
 86         private final AtomicInteger listenerInvoked = new AtomicInteger(0);
 87         private volatile long notifCount = 0;
 88         PoolRecord(MemoryPoolMXBean p) {
 89             this.pool = p;
 90         }
 91         int getListenerInvokedCount() {
 92             return listenerInvoked.get();
 93         }
 94         long getNotifCount() {
 95             return notifCount;
 96         }
 97         MemoryPoolMXBean getPool() {
 98             return pool;
 99         }
100         void addNotification(MemoryNotificationInfo minfo) {
101             listenerInvoked.incrementAndGet();
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 59     private static final int THRESHOLD = 10;
 60     private static volatile int numGCs = 0;
 61 
 62     // semaphore to signal the arrival of a low memory notification
 63     private static final Semaphore signals = new Semaphore(0);
 64     // barrier for the main thread to wait until the checker thread
 65     // finishes checking the low memory notification result
 66     private static final CyclicBarrier barrier = new CyclicBarrier(2);
 67 
 68     /**
 69      * Run the test multiple times with different GC versions.
 70      * First with default command line specified by the framework.
 71      * Then with GC versions specified by the test.
 72      */
 73     public static void main(String a[]) throws Throwable {
 74         final String main = &quot;CollectionUsageThreshold$TestMain&quot;;
 75         RunUtil.runTestKeepGcOpts(main);
 76         RunUtil.runTestClearGcOpts(main, &quot;-XX:+UseSerialGC&quot;);
 77         RunUtil.runTestClearGcOpts(main, &quot;-XX:+UseParallelGC&quot;);
 78         RunUtil.runTestClearGcOpts(main, &quot;-XX:+UseG1GC&quot;);



 79     }
 80 
 81     static class PoolRecord {
 82         private final MemoryPoolMXBean pool;
 83         private final AtomicInteger listenerInvoked = new AtomicInteger(0);
 84         private volatile long notifCount = 0;
 85         PoolRecord(MemoryPoolMXBean p) {
 86             this.pool = p;
 87         }
 88         int getListenerInvokedCount() {
 89             return listenerInvoked.get();
 90         }
 91         long getNotifCount() {
 92             return notifCount;
 93         }
 94         MemoryPoolMXBean getPool() {
 95             return pool;
 96         }
 97         void addNotification(MemoryNotificationInfo minfo) {
 98             listenerInvoked.incrementAndGet();
</pre>
</td>
</tr>
</table>
<center><a href="../GarbageCollectorMXBean/GcInfoCompositeType.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="LowMemoryTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>