<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/java/lang/Class/getDeclaredField/FieldSetAccessibleTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="ClassDeclaredFieldsTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../ClassLoader/LibraryPathProperty.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/java/lang/Class/getDeclaredField/FieldSetAccessibleTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
368             return this;
369         }
370         public PermissionsBuilder addAll(PermissionCollection col) {
371             if (col != null) {
372                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
373                     perms.add(e.nextElement());
374                 }
375             }
376             return this;
377         }
378         public Permissions toPermissions() {
379             final PermissionsBuilder builder = new PermissionsBuilder();
380             builder.addAll(perms);
381             return builder.perms;
382         }
383     }
384 
385     // Policy for the test...
386     public static class SimplePolicy extends Policy {
387 


388         final Permissions permissions;
389         final Permissions allPermissions;
390         final ThreadLocal&lt;AtomicBoolean&gt; allowAll;
391         public SimplePolicy(TestCase test, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
392             this.allowAll = allowAll;
393 
394             // Permission needed by the tested code exercised in the test
395             permissions = new Permissions();
396             permissions.add(new RuntimePermission(&quot;fileSystemProvider&quot;));
397             permissions.add(new RuntimePermission(&quot;createClassLoader&quot;));
398             permissions.add(new RuntimePermission(&quot;closeClassLoader&quot;));
399             permissions.add(new RuntimePermission(&quot;getClassLoader&quot;));
400             permissions.add(new RuntimePermission(&quot;accessDeclaredMembers&quot;));
401             permissions.add(new RuntimePermission(&quot;accessSystemModules&quot;));
402             permissions.add(new ReflectPermission(&quot;suppressAccessChecks&quot;));
403             permissions.add(new PropertyPermission(&quot;*&quot;, &quot;read&quot;));
404             permissions.add(new FilePermission(&quot;&lt;&lt;ALL FILES&gt;&gt;&quot;, &quot;read&quot;));
405 
406             // these are used for configuring the test itself...
407             allPermissions = new Permissions();
408             allPermissions.add(new java.security.AllPermission());
409         }
410 
411         @Override
412         public boolean implies(ProtectionDomain domain, Permission permission) {
413             if (allowAll.get().get()) return allPermissions.implies(permission);
414             if (permissions.implies(permission)) return true;
415             if (permission instanceof java.lang.RuntimePermission) {
416                 if (permission.getName().startsWith(&quot;accessClassInPackage.&quot;)) {
417                     // add these along to the set of permission we have, when we
418                     // discover that we need them.
419                     permissions.add(permission);
420                     return true;
421                 }
422             }

423             return false;
424         }
425 
426         @Override
427         public PermissionCollection getPermissions(CodeSource codesource) {
428             return new PermissionsBuilder().addAll(allowAll.get().get()
429                     ? allPermissions : permissions).toPermissions();
430         }
431 
432         @Override
433         public PermissionCollection getPermissions(ProtectionDomain domain) {
434             return new PermissionsBuilder().addAll(allowAll.get().get()
435                     ? allPermissions : permissions).toPermissions();
436         }
437     }
438 
439 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
368             return this;
369         }
370         public PermissionsBuilder addAll(PermissionCollection col) {
371             if (col != null) {
372                 for (Enumeration&lt;Permission&gt; e = col.elements(); e.hasMoreElements(); ) {
373                     perms.add(e.nextElement());
374                 }
375             }
376             return this;
377         }
378         public Permissions toPermissions() {
379             final PermissionsBuilder builder = new PermissionsBuilder();
380             builder.addAll(perms);
381             return builder.perms;
382         }
383     }
384 
385     // Policy for the test...
386     public static class SimplePolicy extends Policy {
387 
<span class="line-added">388         static final Policy DEFAULT_POLICY = Policy.getPolicy();</span>
<span class="line-added">389 </span>
390         final Permissions permissions;
391         final Permissions allPermissions;
392         final ThreadLocal&lt;AtomicBoolean&gt; allowAll;
393         public SimplePolicy(TestCase test, ThreadLocal&lt;AtomicBoolean&gt; allowAll) {
394             this.allowAll = allowAll;
395 
396             // Permission needed by the tested code exercised in the test
397             permissions = new Permissions();
398             permissions.add(new RuntimePermission(&quot;fileSystemProvider&quot;));
399             permissions.add(new RuntimePermission(&quot;createClassLoader&quot;));
400             permissions.add(new RuntimePermission(&quot;closeClassLoader&quot;));
401             permissions.add(new RuntimePermission(&quot;getClassLoader&quot;));
402             permissions.add(new RuntimePermission(&quot;accessDeclaredMembers&quot;));
403             permissions.add(new RuntimePermission(&quot;accessSystemModules&quot;));
404             permissions.add(new ReflectPermission(&quot;suppressAccessChecks&quot;));
405             permissions.add(new PropertyPermission(&quot;*&quot;, &quot;read&quot;));
406             permissions.add(new FilePermission(&quot;&lt;&lt;ALL FILES&gt;&gt;&quot;, &quot;read&quot;));
407 
408             // these are used for configuring the test itself...
409             allPermissions = new Permissions();
410             allPermissions.add(new java.security.AllPermission());
411         }
412 
413         @Override
414         public boolean implies(ProtectionDomain domain, Permission permission) {
415             if (allowAll.get().get()) return allPermissions.implies(permission);
416             if (permissions.implies(permission)) return true;
417             if (permission instanceof java.lang.RuntimePermission) {
418                 if (permission.getName().startsWith(&quot;accessClassInPackage.&quot;)) {
419                     // add these along to the set of permission we have, when we
420                     // discover that we need them.
421                     permissions.add(permission);
422                     return true;
423                 }
424             }
<span class="line-added">425             if (DEFAULT_POLICY.implies(domain, permission)) return true;</span>
426             return false;
427         }
428 
429         @Override
430         public PermissionCollection getPermissions(CodeSource codesource) {
431             return new PermissionsBuilder().addAll(allowAll.get().get()
432                     ? allPermissions : permissions).toPermissions();
433         }
434 
435         @Override
436         public PermissionCollection getPermissions(ProtectionDomain domain) {
437             return new PermissionsBuilder().addAll(allowAll.get().get()
438                     ? allPermissions : permissions).toPermissions();
439         }
440     }
441 
442 }
</pre>
</td>
</tr>
</table>
<center><a href="ClassDeclaredFieldsTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../ClassLoader/LibraryPathProperty.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>