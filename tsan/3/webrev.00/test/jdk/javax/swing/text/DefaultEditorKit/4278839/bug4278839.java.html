<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/javax/swing/text/DefaultEditorKit/4278839/bug4278839.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2011, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @key headful
 27  * @bug 4278839 8233634
 28  * @summary Incorrect cursor movement between words at the end of line
 29  * @author Anton Nashatyrev
 30  * @library ../../../regtesthelpers
 31  * @build Util
 32  * @run main bug4278839
 33  */
 34 
 35 import java.awt.*;
 36 import java.awt.event.*;
 37 import javax.swing.*;
 38 
 39 public class bug4278839 extends JFrame {
 40 
 41     private static boolean passed = true;
 42     private static JTextArea area;
 43     private static Robot robo;
 44     private static JFrame frame;
 45 
 46     public static void main(String[] args) throws Exception {
 47         try {
 48 
 49             robo = new Robot();
 50             robo.setAutoDelay(200);
 51 
 52             SwingUtilities.invokeAndWait(new Runnable() {
 53                 @Override
 54                 public void run() {
 55                     createAndShowGUI();
 56                 }
 57             });
 58 
 59             robo.waitForIdle();
 60 
 61             clickMouse();
 62             robo.waitForIdle();
 63 
 64             area.setCaretPosition(0);
 65 
 66             if (&quot;Aqua&quot;.equals(UIManager.getLookAndFeel().getID())) {
 67                 Util.hitKeys(robo, KeyEvent.VK_HOME);
 68             } else {
 69                 Util.hitKeys(robo, KeyEvent.VK_CONTROL, KeyEvent.VK_HOME);
 70             }
 71             robo.waitForIdle();
 72 
 73             passed &amp;= moveCaret(true) == 1;
 74             passed &amp;= moveCaret(true) == 5;
 75             passed &amp;= moveCaret(true) == 8;
 76             passed &amp;= moveCaret(true) == 9;
 77             passed &amp;= moveCaret(true) == 13;
 78             passed &amp;= moveCaret(true) == 16;
 79             passed &amp;= moveCaret(true) == 17;
 80             passed &amp;= moveCaret(false) == 16;
 81             passed &amp;= moveCaret(false) == 13;
 82             passed &amp;= moveCaret(false) == 9;
 83             passed &amp;= moveCaret(false) == 8;
 84             passed &amp;= moveCaret(false) == 5;
 85             passed &amp;= moveCaret(false) == 1;
 86             passed &amp;= moveCaret(false) == 0;
 87 
 88         } catch (Exception e) {
 89             throw new RuntimeException(&quot;Test failed because of an exception:&quot;,
 90                     e);
 91         } finally {
 92             if (frame != null) {
 93                 SwingUtilities.invokeAndWait(() -&gt; frame.dispose());
 94             }
 95         }
 96 
 97         if (!passed) {
 98             throw new RuntimeException(&quot;Test failed.&quot;);
 99         }
100     }
101 
102     private static int moveCaret(boolean right) throws Exception {
103         Util.hitKeys(robo, getCtrlKey(),
104                 right ? KeyEvent.VK_RIGHT : KeyEvent.VK_LEFT);
105         robo.waitForIdle();
106 
107         final int[] result = new int[1];
108 
109         SwingUtilities.invokeAndWait(new Runnable() {
110 
111             @Override
112             public void run() {
113                 result[0] = area.getCaretPosition();
114             }
115         });
116 
117         int pos = result[0];
118         return pos;
119     }
120 
121     private static void clickMouse() throws Exception {
122         final Rectangle result[] = new Rectangle[1];
123 
124         SwingUtilities.invokeAndWait(new Runnable() {
125             @Override
126             public void run() {
127                 result[0] = new Rectangle(area.getLocationOnScreen(), area.getSize());
128             }
129         });
130 
131         Rectangle rect = result[0];
132 
133         robo.mouseMove(rect.x + rect.width / 2, rect.y + rect.width / 2);
134         robo.mousePress(InputEvent.BUTTON1_MASK);
135         robo.mouseRelease(InputEvent.BUTTON1_MASK);
136     }
137 
138     /**
139      * Gets a control key related to the used Look &amp; Feel
140      * Returns VK_ALT for Aqua and VK_CONTROL for others
141      */
142     public static int getCtrlKey() {
143 
144         if (&quot;Aqua&quot;.equals(UIManager.getLookAndFeel().getID())) {
145             return KeyEvent.VK_ALT;
146         }
147 
148         return KeyEvent.VK_CONTROL;
149     }
150 
151     private static void createAndShowGUI() {
152         frame = new JFrame();
153         frame.setTitle(&quot;Bug# 4278839&quot;);
154         frame.setSize(200, 200);
155         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
156         area = new JTextArea(&quot;\naaa bbb\nccc ddd\n&quot;);
157         frame.getContentPane().add(new JScrollPane(area));
158         frame.setVisible(true);
159     }
160 }
    </pre>
  </body>
</html>