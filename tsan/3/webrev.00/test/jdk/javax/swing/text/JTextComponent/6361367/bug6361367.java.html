<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/javax/swing/text/JTextComponent/6361367/bug6361367.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2006, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /* @test
 25    @bug 6361367 7109126 8225144
 26    @key headful
 27    @summary Tests that backspace key does delete when Shift is pressed
 28 */
 29 
 30 import java.awt.Robot;
 31 import java.awt.event.KeyEvent;
 32 import java.util.Arrays;
 33 import java.util.List;
 34 import java.util.concurrent.Callable;
 35 import java.util.concurrent.FutureTask;
 36 import java.util.concurrent.atomic.AtomicReference;
 37 
 38 import javax.swing.JComponent;
 39 import javax.swing.JEditorPane;
 40 import javax.swing.JFormattedTextField;
 41 import javax.swing.JFrame;
 42 import javax.swing.JPasswordField;
 43 import javax.swing.JTextArea;
 44 import javax.swing.JTextField;
 45 import javax.swing.JTextPane;
 46 import javax.swing.SwingUtilities;
 47 import javax.swing.UIManager;
 48 import javax.swing.text.Caret;
 49 import javax.swing.text.JTextComponent;
 50 
 51 public class bug6361367 {
 52     final static String testString = &quot;123 456 789&quot;;
 53     final static String resultString = &quot;123 456 78&quot;;
 54     final static List&lt;Class&lt;? extends JTextComponent&gt;&gt; textClasses = Arrays.asList(
 55         JTextArea.class, JEditorPane.class, JTextPane.class,
 56         JTextField.class, JFormattedTextField.class, JPasswordField.class);
 57 
 58     public static void main(String[] args) throws Exception {
 59         for(UIManager.LookAndFeelInfo info: UIManager.getInstalledLookAndFeels()) {
 60             UIManager.setLookAndFeel(info.getClassName());
 61             System.out.println(info);
 62             for (Class&lt;? extends JTextComponent&gt; clazz : textClasses) {
 63                 boolean res = test(clazz);
 64                 if (! res) {
 65                     throw new RuntimeException(&quot;failed&quot;);
 66                 }
 67             }
 68         }
 69     }
 70 
 71     static boolean test(final Class&lt;? extends JTextComponent&gt; textComponentClass) throws Exception  {
 72         final AtomicReference&lt;JFrame&gt; ref = new AtomicReference&lt;&gt;();
 73         final JTextComponent textComponent = invokeAndWait(
 74             new Callable&lt;JTextComponent&gt;() {
 75                 public JTextComponent call() throws Exception {
 76                     return initialize(textComponentClass, ref);
 77                 }
 78             });
 79         waitForFocus(textComponent);
 80         Robot robot = new Robot();
 81         robot.setAutoWaitForIdle(true);
 82         robot.setAutoDelay(250);
 83         robot.keyPress(KeyEvent.VK_END);
 84         robot.keyRelease(KeyEvent.VK_END);
 85         robot.keyPress(KeyEvent.VK_SHIFT);
 86         robot.keyPress(KeyEvent.VK_BACK_SPACE);
 87         robot.keyRelease(KeyEvent.VK_BACK_SPACE);
 88         robot.keyRelease(KeyEvent.VK_SHIFT);
 89         String str = invokeAndWait(
 90             new Callable&lt;String&gt;() {
 91                 public String call() throws Exception {
 92                     JFrame frame = ref.get();
 93                     if (frame != null) {
 94                         frame.dispose();
 95                     }
 96                     return textComponent.getText();
 97                 }
 98         });
 99         return resultString.equals(str);
100     }
101 
102     static JTextComponent initialize(
103             Class&lt;? extends JTextComponent&gt; textComponentClass,
104             AtomicReference&lt;JFrame&gt; ref) throws Exception {
105         JFrame frame = new JFrame(&quot;bug6361367&quot;);
106         ref.set(frame);
107         JTextComponent textComponent = textComponentClass.newInstance();
108         textComponent.setText(testString);
109         frame.add(textComponent);
110         frame.pack();
111         frame.setLocationRelativeTo(null);
112         frame.setVisible(true);
113         textComponent.requestFocus();
114         Caret caret = textComponent.getCaret();
115         caret.setDot(textComponent.getDocument().getLength());
116         return textComponent;
117     }
118 
119     static &lt;T&gt; T invokeAndWait(Callable&lt;T&gt; callable) throws Exception {
120         FutureTask&lt;T&gt; future = new FutureTask&lt;T&gt;(callable);
121         SwingUtilities.invokeLater(future);
122         return future.get();
123     }
124 
125     static void waitForFocus(JComponent component) throws Exception  {
126         synchronized (component) {
127             while(! component.isFocusOwner()) {
128                 component.wait(100);
129             }
130         }
131     }
132 }
    </pre>
  </body>
</html>