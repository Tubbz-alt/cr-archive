<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/javax/swing/JComboBox/4523758/bug4523758.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../JColorChooser/Test8051548.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../6236162/bug6236162.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/javax/swing/JComboBox/4523758/bug4523758.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 26  * @key headful
 27  * @bug 4523758
 28  * @summary Directly check that torn-off combo works
 29  * @library /lib/client
 30  * @build ExtendedRobot
 31  * @run main bug4523758
 32  */
 33 /*
 34  * There is another regression test for this bug created by ssi with a
 35  * fix. It is purely AWT and designed to verify the (absence of) underlying Component issue.
 36  * This functional test does test, well, functionality of the swing control.
 37  *
 38  */
 39 
 40 import javax.swing.*;
 41 import java.awt.*;
 42 import java.awt.event.*;
 43 
 44 public class bug4523758 {
 45 
<span class="line-modified"> 46     private JFrame frame;</span>
 47     private JToolBar tools;
 48     private JComboBox combo;
 49 
 50     private boolean passed = true;
 51     private boolean itemStateChanged = false;
 52     private Object itemLock = new Object();
 53 
 54     private static int delay = 500;
 55     private static final int WAIT_EVENT_DELAY = 60000;
 56 
 57     public bug4523758() {
 58         try {
 59             SwingUtilities.invokeAndWait(new Runnable() {
 60                 public void run() {
 61                     initializeGUI();
 62                 }
 63             });
 64         } catch (Exception e) {
 65             e.printStackTrace();
 66             throw new RuntimeException(&quot;Failed to initialize GUI&quot;);
</pre>
<hr />
<pre>
136                 try {
137                     itemLock.wait(WAIT_EVENT_DELAY);
138                 } catch (Exception e) {
139                 }
140             }
141         }
142         if (! itemStateChanged) {
143             System.err.println(&quot;FAIL: ItemEvent not triggered when mouse clicked on combo box drop down&quot;);
144             passed = false;
145         }
146 
147         if (! passed) {
148             System.err.println(&quot;Test failed!&quot;);
149             captureScreenAndSave();
150             throw new RuntimeException(&quot;FAIL&quot;);
151         } else {
152             System.out.println(&quot;Test passed!&quot;);
153         }
154     }
155 
<span class="line-modified">156     public static void main(String[] args) {</span>
157         try {
158             bug4523758 test = new bug4523758();
159             test.doTest();
160         } catch (Exception e) {
161             e.printStackTrace();
162             throw new RuntimeException(&quot;FAIL&quot;);


163         }
164     }
165 
166     /**
167      * Do screen capture and save it as image
168      */
169     private static void captureScreenAndSave() {
170 
171         try {
172             Robot robot = new Robot();
173             Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
174             Rectangle rectangle = new Rectangle(0, 0, screenSize.width, screenSize.height);
175             System.out.println(&quot;About to screen capture - &quot; + rectangle);
176             java.awt.image.BufferedImage image = robot.createScreenCapture(rectangle);
177             javax.imageio.ImageIO.write(image, &quot;jpg&quot;, new java.io.File(&quot;ScreenImage.jpg&quot;));
178             robot.delay(3000);
179         } catch (Throwable t) {
180             System.out.println(&quot;WARNING: Exception thrown while screen capture!&quot;);
181             t.printStackTrace();
182         }
</pre>
</td>
<td>
<hr />
<pre>
 26  * @key headful
 27  * @bug 4523758
 28  * @summary Directly check that torn-off combo works
 29  * @library /lib/client
 30  * @build ExtendedRobot
 31  * @run main bug4523758
 32  */
 33 /*
 34  * There is another regression test for this bug created by ssi with a
 35  * fix. It is purely AWT and designed to verify the (absence of) underlying Component issue.
 36  * This functional test does test, well, functionality of the swing control.
 37  *
 38  */
 39 
 40 import javax.swing.*;
 41 import java.awt.*;
 42 import java.awt.event.*;
 43 
 44 public class bug4523758 {
 45 
<span class="line-modified"> 46     private static JFrame frame;</span>
 47     private JToolBar tools;
 48     private JComboBox combo;
 49 
 50     private boolean passed = true;
 51     private boolean itemStateChanged = false;
 52     private Object itemLock = new Object();
 53 
 54     private static int delay = 500;
 55     private static final int WAIT_EVENT_DELAY = 60000;
 56 
 57     public bug4523758() {
 58         try {
 59             SwingUtilities.invokeAndWait(new Runnable() {
 60                 public void run() {
 61                     initializeGUI();
 62                 }
 63             });
 64         } catch (Exception e) {
 65             e.printStackTrace();
 66             throw new RuntimeException(&quot;Failed to initialize GUI&quot;);
</pre>
<hr />
<pre>
136                 try {
137                     itemLock.wait(WAIT_EVENT_DELAY);
138                 } catch (Exception e) {
139                 }
140             }
141         }
142         if (! itemStateChanged) {
143             System.err.println(&quot;FAIL: ItemEvent not triggered when mouse clicked on combo box drop down&quot;);
144             passed = false;
145         }
146 
147         if (! passed) {
148             System.err.println(&quot;Test failed!&quot;);
149             captureScreenAndSave();
150             throw new RuntimeException(&quot;FAIL&quot;);
151         } else {
152             System.out.println(&quot;Test passed!&quot;);
153         }
154     }
155 
<span class="line-modified">156     public static void main(String[] args) throws Exception {</span>
157         try {
158             bug4523758 test = new bug4523758();
159             test.doTest();
160         } catch (Exception e) {
161             e.printStackTrace();
162             throw new RuntimeException(&quot;FAIL&quot;);
<span class="line-added">163         } finally {</span>
<span class="line-added">164             if (frame != null) SwingUtilities.invokeAndWait(() -&gt; frame.dispose());</span>
165         }
166     }
167 
168     /**
169      * Do screen capture and save it as image
170      */
171     private static void captureScreenAndSave() {
172 
173         try {
174             Robot robot = new Robot();
175             Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
176             Rectangle rectangle = new Rectangle(0, 0, screenSize.width, screenSize.height);
177             System.out.println(&quot;About to screen capture - &quot; + rectangle);
178             java.awt.image.BufferedImage image = robot.createScreenCapture(rectangle);
179             javax.imageio.ImageIO.write(image, &quot;jpg&quot;, new java.io.File(&quot;ScreenImage.jpg&quot;));
180             robot.delay(3000);
181         } catch (Throwable t) {
182             System.out.println(&quot;WARNING: Exception thrown while screen capture!&quot;);
183             t.printStackTrace();
184         }
</pre>
</td>
</tr>
</table>
<center><a href="../../JColorChooser/Test8051548.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../6236162/bug6236162.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>