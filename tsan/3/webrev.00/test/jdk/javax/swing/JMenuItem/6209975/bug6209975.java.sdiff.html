<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/javax/swing/JMenuItem/6209975/bug6209975.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../4654927/bug4654927.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../JPopupMenu/4634626/bug4634626.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/javax/swing/JMenuItem/6209975/bug6209975.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 23 
 24 /*
 25  * @test
 26  * @key headful
 27  * @bug 6209975
 28  * @summary regression: JMenuItem icons overimposed on JMenuItem labels under Metal LAF
 29  * @author Alexander Zuev
 30  * @run main bug6209975
 31  */
 32 import javax.swing.*;
 33 import java.awt.*;
 34 import java.awt.event.InputEvent;
 35 
 36 public class bug6209975 {
 37 
 38     private static final ReturnObject RO1 = new ReturnObject();
 39     private static final ReturnObject RO2 = new ReturnObject();
 40 
 41     private static JMenu menu;
 42     private static JButton button;

 43 
 44     public static void main(String[] args) throws Exception {



 45 
<span class="line-removed"> 46         Robot robot = new Robot();</span>
<span class="line-removed"> 47         robot.setAutoDelay(500);</span>
 48 

 49 
<span class="line-modified"> 50         SwingUtilities.invokeAndWait(new Runnable() {</span>




 51 
<span class="line-modified"> 52             @Override</span>
<span class="line-removed"> 53             public void run() {</span>
<span class="line-removed"> 54                 createAndShowGUI();</span>
<span class="line-removed"> 55             }</span>
<span class="line-removed"> 56         });</span>
<span class="line-removed"> 57 </span>
<span class="line-removed"> 58         robot.waitForIdle();</span>
 59 
<span class="line-modified"> 60         Point clickPoint = getButtonClickPoint();</span>
<span class="line-modified"> 61         robot.mouseMove(clickPoint.x, clickPoint.y);</span>
<span class="line-modified"> 62         robot.mousePress(InputEvent.BUTTON1_MASK);</span>
<span class="line-modified"> 63         robot.mouseRelease(InputEvent.BUTTON1_MASK);</span>
<span class="line-modified"> 64         robot.waitForIdle();</span>
 65 
<span class="line-modified"> 66         clickPoint = getMenuClickPoint();</span>
<span class="line-modified"> 67         robot.mouseMove(clickPoint.x, clickPoint.y);</span>
<span class="line-modified"> 68         robot.mousePress(InputEvent.BUTTON1_MASK);</span>
<span class="line-modified"> 69         robot.mouseRelease(InputEvent.BUTTON1_MASK);</span>
<span class="line-modified"> 70         robot.waitForIdle();</span>
 71 
<span class="line-modified"> 72         if (RO1.itsValue &lt;= RO2.itsValue) {</span>
<span class="line-modified"> 73             throw new RuntimeException(&quot;Offset if the second icon is invalid.&quot;);</span>



 74         }
 75     }
 76 
 77     private static Point getButtonClickPoint() throws Exception {
 78         final Point[] result = new Point[1];
 79 
 80         SwingUtilities.invokeAndWait(new Runnable() {
 81 
 82             @Override
 83             public void run() {
 84                 Point p = button.getLocationOnScreen();
 85                 Dimension size = button.getSize();
 86                 result[0] = new Point(p.x + size.width / 2, p.y + size.height / 2);
 87             }
 88         });
 89         return result[0];
 90     }
 91 
 92     private static Point getMenuClickPoint() throws Exception {
 93         final Point[] result = new Point[1];
 94 
 95         SwingUtilities.invokeAndWait(new Runnable() {
 96 
 97             @Override
 98             public void run() {
 99                 Point p = menu.getLocationOnScreen();
100                 Dimension size = menu.getSize();
101                 result[0] = new Point(p.x + size.width / 2, p.y + size.height / 2);
102             }
103         });
104         return result[0];
105     }
106 
107     private static void createAndShowGUI() {
<span class="line-modified">108         JFrame frame = new JFrame(&quot;Test6209975&quot;);</span>
109         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
110         frame.applyComponentOrientation(ComponentOrientation.LEFT_TO_RIGHT);
111         frame.setLayout(new BorderLayout());
112         button = new JButton(&quot;Focus holder&quot;);
113         frame.add(button);
114 
115         JMenuBar mb = new JMenuBar();
116         menu = new JMenu(&quot;File&quot;);
117 
118         JMenuItem item;
119 
120         item = new JMenuItem(&quot;Just a menu item&quot;);
121         item.setIcon(new MyIcon(RO1));
122         item.setHorizontalTextPosition(SwingConstants.LEADING);
123         menu.add(item);
124 
125         item = new JMenuItem(&quot;Menu Item with another icon&quot;);
126         item.setIcon(new MyIcon(RO2));
127         item.setHorizontalTextPosition(SwingConstants.TRAILING);
128         menu.add(item);
</pre>
</td>
<td>
<hr />
<pre>
 23 
 24 /*
 25  * @test
 26  * @key headful
 27  * @bug 6209975
 28  * @summary regression: JMenuItem icons overimposed on JMenuItem labels under Metal LAF
 29  * @author Alexander Zuev
 30  * @run main bug6209975
 31  */
 32 import javax.swing.*;
 33 import java.awt.*;
 34 import java.awt.event.InputEvent;
 35 
 36 public class bug6209975 {
 37 
 38     private static final ReturnObject RO1 = new ReturnObject();
 39     private static final ReturnObject RO2 = new ReturnObject();
 40 
 41     private static JMenu menu;
 42     private static JButton button;
<span class="line-added"> 43     private static JFrame frame;</span>
 44 
 45     public static void main(String[] args) throws Exception {
<span class="line-added"> 46         try {</span>
<span class="line-added"> 47             Robot robot = new Robot();</span>
<span class="line-added"> 48             robot.setAutoDelay(500);</span>
 49 


 50 
<span class="line-added"> 51             SwingUtilities.invokeAndWait(new Runnable() {</span>
 52 
<span class="line-modified"> 53                 @Override</span>
<span class="line-added"> 54                 public void run() {</span>
<span class="line-added"> 55                     createAndShowGUI();</span>
<span class="line-added"> 56                 }</span>
<span class="line-added"> 57             });</span>
 58 
<span class="line-modified"> 59             robot.waitForIdle();</span>






 60 
<span class="line-modified"> 61             Point clickPoint = getButtonClickPoint();</span>
<span class="line-modified"> 62             robot.mouseMove(clickPoint.x, clickPoint.y);</span>
<span class="line-modified"> 63             robot.mousePress(InputEvent.BUTTON1_MASK);</span>
<span class="line-modified"> 64             robot.mouseRelease(InputEvent.BUTTON1_MASK);</span>
<span class="line-modified"> 65             robot.waitForIdle();</span>
 66 
<span class="line-modified"> 67             clickPoint = getMenuClickPoint();</span>
<span class="line-modified"> 68             robot.mouseMove(clickPoint.x, clickPoint.y);</span>
<span class="line-modified"> 69             robot.mousePress(InputEvent.BUTTON1_MASK);</span>
<span class="line-modified"> 70             robot.mouseRelease(InputEvent.BUTTON1_MASK);</span>
<span class="line-modified"> 71             robot.waitForIdle();</span>
 72 
<span class="line-modified"> 73             if (RO1.itsValue &lt;= RO2.itsValue) {</span>
<span class="line-modified"> 74                 throw new RuntimeException(&quot;Offset if the second icon is invalid.&quot;);</span>
<span class="line-added"> 75             }</span>
<span class="line-added"> 76         } finally {</span>
<span class="line-added"> 77             if (frame != null) SwingUtilities.invokeAndWait(() -&gt; frame.dispose());</span>
 78         }
 79     }
 80 
 81     private static Point getButtonClickPoint() throws Exception {
 82         final Point[] result = new Point[1];
 83 
 84         SwingUtilities.invokeAndWait(new Runnable() {
 85 
 86             @Override
 87             public void run() {
 88                 Point p = button.getLocationOnScreen();
 89                 Dimension size = button.getSize();
 90                 result[0] = new Point(p.x + size.width / 2, p.y + size.height / 2);
 91             }
 92         });
 93         return result[0];
 94     }
 95 
 96     private static Point getMenuClickPoint() throws Exception {
 97         final Point[] result = new Point[1];
 98 
 99         SwingUtilities.invokeAndWait(new Runnable() {
100 
101             @Override
102             public void run() {
103                 Point p = menu.getLocationOnScreen();
104                 Dimension size = menu.getSize();
105                 result[0] = new Point(p.x + size.width / 2, p.y + size.height / 2);
106             }
107         });
108         return result[0];
109     }
110 
111     private static void createAndShowGUI() {
<span class="line-modified">112         frame = new JFrame(&quot;Test6209975&quot;);</span>
113         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
114         frame.applyComponentOrientation(ComponentOrientation.LEFT_TO_RIGHT);
115         frame.setLayout(new BorderLayout());
116         button = new JButton(&quot;Focus holder&quot;);
117         frame.add(button);
118 
119         JMenuBar mb = new JMenuBar();
120         menu = new JMenu(&quot;File&quot;);
121 
122         JMenuItem item;
123 
124         item = new JMenuItem(&quot;Just a menu item&quot;);
125         item.setIcon(new MyIcon(RO1));
126         item.setHorizontalTextPosition(SwingConstants.LEADING);
127         menu.add(item);
128 
129         item = new JMenuItem(&quot;Menu Item with another icon&quot;);
130         item.setIcon(new MyIcon(RO2));
131         item.setHorizontalTextPosition(SwingConstants.TRAILING);
132         menu.add(item);
</pre>
</td>
</tr>
</table>
<center><a href="../4654927/bug4654927.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../JPopupMenu/4634626/bug4634626.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>