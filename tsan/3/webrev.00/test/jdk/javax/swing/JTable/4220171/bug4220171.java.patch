diff a/test/jdk/javax/swing/JTable/4220171/bug4220171.java b/test/jdk/javax/swing/JTable/4220171/bug4220171.java
--- a/test/jdk/javax/swing/JTable/4220171/bug4220171.java
+++ b/test/jdk/javax/swing/JTable/4220171/bug4220171.java
@@ -41,44 +41,49 @@
 import javax.swing.border.LineBorder;
 
 public class bug4220171 {
 
     private static JTable table;
+    private static JFrame frame;
 
     public static void main(String args[]) throws Exception {
+        try {
 
-        Robot robot = new Robot();
-        robot.setAutoDelay(50);
+            Robot robot = new Robot();
+            robot.setAutoDelay(50);
 
-        javax.swing.SwingUtilities.invokeAndWait(new Runnable() {
+            javax.swing.SwingUtilities.invokeAndWait(new Runnable() {
 
-            public void run() {
-                createAndShowGUI();
-            }
-        });
-
-        robot.waitForIdle();
-
-        clickMouse(robot, 0, 0);
-        Util.hitKeys(robot, KeyEvent.VK_A, KeyEvent.VK_B, KeyEvent.VK_ENTER);
-        robot.waitForIdle();
-        checkCell(0, 0);
-
-        clickMouse(robot, 0, 1);
-        Util.hitKeys(robot, KeyEvent.VK_D, KeyEvent.VK_E, KeyEvent.VK_ENTER);
-        robot.waitForIdle();
-        checkCell(0, 1);
-
-        clickMouse(robot, 1, 0);
-        Util.hitKeys(robot, KeyEvent.VK_1, KeyEvent.VK_2, KeyEvent.VK_ENTER);
-        robot.waitForIdle();
-        checkCell(1, 0);
-
-        clickMouse(robot, 1, 1);
-        Util.hitKeys(robot, KeyEvent.VK_4, KeyEvent.VK_5, KeyEvent.VK_ENTER);
-        robot.waitForIdle();
-        checkCell(1, 1);
+                public void run() {
+                    createAndShowGUI();
+                }
+            });
+
+            robot.waitForIdle();
+
+            clickMouse(robot, 0, 0);
+            Util.hitKeys(robot, KeyEvent.VK_A, KeyEvent.VK_B, KeyEvent.VK_ENTER);
+            robot.waitForIdle();
+            checkCell(0, 0);
+
+            clickMouse(robot, 0, 1);
+            Util.hitKeys(robot, KeyEvent.VK_D, KeyEvent.VK_E, KeyEvent.VK_ENTER);
+            robot.waitForIdle();
+            checkCell(0, 1);
+
+            clickMouse(robot, 1, 0);
+            Util.hitKeys(robot, KeyEvent.VK_1, KeyEvent.VK_2, KeyEvent.VK_ENTER);
+            robot.waitForIdle();
+            checkCell(1, 0);
+
+            clickMouse(robot, 1, 1);
+            Util.hitKeys(robot, KeyEvent.VK_4, KeyEvent.VK_5, KeyEvent.VK_ENTER);
+            robot.waitForIdle();
+            checkCell(1, 1);
+        } finally {
+            if (frame != null) SwingUtilities.invokeAndWait(() -> frame.dispose());
+        }
     }
 
     static void checkCell(final int row, final int column) throws Exception {
         SwingUtilities.invokeAndWait(new Runnable() {
 
@@ -114,11 +119,11 @@
 
         return result[0];
     }
 
     private static void createAndShowGUI() {
-        JFrame frame = new JFrame("Test");
+        frame = new JFrame("Test");
         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
         frame.setSize(200, 200);
 
         table = new JTable(2, 2);
         table.setEnabled(false);
