<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/javax/swing/JTabbedPane/8134116/Bug8134116.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../7161568/bug7161568.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../JTable/4220171/bug4220171.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/javax/swing/JTabbedPane/8134116/Bug8134116.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 18,152 ***</span>
   * @run main Bug8134116
   */
  public class Bug8134116 {
  
      private static volatile Exception exception = null;
  
      public static void main(String args[]) throws Exception {
  
          try {
              UIManager.setLookAndFeel(new NimbusLookAndFeel());
          } catch (Exception e) {
              throw new RuntimeException(e);
          }
  
<span class="line-modified">!         SwingUtilities.invokeAndWait(() -&gt; {</span>
<span class="line-modified">!             JPanel panel0 = new JPanel();</span>
<span class="line-modified">!             JPanel panel2 = new JPanel();</span>
<span class="line-modified">!             BadPane badPane = new BadPane();</span>
<span class="line-modified">!             badPane.add(&quot;zero&quot;, panel0);</span>
<span class="line-modified">!             badPane.add(&quot;one&quot;, null);  // no component</span>
<span class="line-modified">!             badPane.add(&quot;&quot;, panel2);  // no title</span>
<span class="line-modified">!             badPane.add(&quot;&quot;, null); // no component, no title</span>
<span class="line-modified">!             // but give it that via a tabComponent</span>
<span class="line-modified">!             JPanel tabComponent = new JPanel();</span>
<span class="line-modified">!             JLabel tabComponentLabel = new JLabel(&quot;three&quot;);</span>
<span class="line-modified">!             tabComponent.add(tabComponentLabel);</span>
<span class="line-modified">!             badPane.setTabComponentAt(3, tabComponent);</span>
<span class="line-modified">!             JFrame frame = new JFrame();</span>
<span class="line-modified">!             frame.add(badPane);</span>
<span class="line-modified">!             frame.setSize(300, 300);</span>
<span class="line-modified">!             frame.setVisible(true);</span>
  
<span class="line-modified">!             try {</span>
<span class="line-modified">!                 AccessibleContext ac = badPane.getAccessibleContext();</span>
<span class="line-modified">!                 Accessible page0 = ac.getAccessibleChild(0);</span>
<span class="line-modified">!                 if (page0 == null) {</span>
<span class="line-modified">!                     // Not something being tested, but checking anyway</span>
<span class="line-modified">!                     throw new RuntimeException(&quot;getAccessibleChild(0) is null&quot;);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 Accessible page1 = ac.getAccessibleChild(1);</span>
<span class="line-modified">!                 if (page1 == null) {</span>
<span class="line-modified">!                     // Not something being tested, but checking anyway</span>
<span class="line-modified">!                     throw new RuntimeException(&quot;getAccessibleChild(1) is null&quot;);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 Accessible page2 = ac.getAccessibleChild(2);</span>
<span class="line-modified">!                 Accessible page3 = ac.getAccessibleChild(3);</span>
<span class="line-modified">!                 // page0 - page3 are JTabbedPane.Page, a private inner class</span>
<span class="line-modified">!                 // and is an AccessibleContext</span>
<span class="line-modified">!                 // and implements Accessible and AccessibleComponent</span>
<span class="line-modified">!                 AccessibleContext pac0 = page0.getAccessibleContext();</span>
<span class="line-modified">!                 AccessibleContext pac1 = page1.getAccessibleContext();</span>
<span class="line-modified">!                 AccessibleContext pac2 = page2.getAccessibleContext();</span>
<span class="line-modified">!                 AccessibleContext pac3 = page3.getAccessibleContext();</span>
  
<span class="line-modified">!                 // test Page.getBounds</span>
<span class="line-modified">!                 // ensure no IndexOutOfBoundsException</span>
<span class="line-modified">!                 Rectangle r0 = pac0.getAccessibleComponent().getBounds();</span>
<span class="line-modified">!                 // make sure second Bounds is different than first</span>
<span class="line-modified">!                 Rectangle r1  = pac1.getAccessibleComponent().getBounds();</span>
<span class="line-modified">!                 if (r1.equals(r0)) {</span>
<span class="line-modified">!                     String msg = &quot;Second tab should not have same bounds as first tab&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
  
<span class="line-modified">!                 // test Page.getAccessibleStateSet</span>
<span class="line-modified">!                 // At this point page 0 is selected</span>
<span class="line-modified">!                 AccessibleStateSet accSS0 = pac0.getAccessibleStateSet();</span>
<span class="line-modified">!                 if (!accSS0.contains(AccessibleState.SELECTED)) {</span>
<span class="line-modified">!                     String msg = &quot;Empty title -&gt; AccessibleState.SELECTED not set&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 // select second tab</span>
<span class="line-modified">!                 badPane.setSelectedIndex(1);</span>
<span class="line-modified">!                 AccessibleStateSet accSS1 = pac1.getAccessibleStateSet();</span>
<span class="line-modified">!                 if (!accSS1.contains(AccessibleState.SELECTED)) {</span>
<span class="line-modified">!                     String msg = &quot;Second tab selected but AccessibleState.SELECTED not set&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 // select third tab</span>
<span class="line-modified">!                 badPane.setSelectedIndex(2);</span>
<span class="line-modified">!                 AccessibleStateSet accSS2 = pac2.getAccessibleStateSet();</span>
<span class="line-modified">!                 if (!accSS1.contains(AccessibleState.SELECTED)) {</span>
<span class="line-modified">!                     String msg = &quot;Third tab selected but AccessibleState.SELECTED not set&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 // select fourth tab</span>
<span class="line-modified">!                 badPane.setSelectedIndex(3);</span>
<span class="line-modified">!                 AccessibleStateSet accSS3 = pac3.getAccessibleStateSet();</span>
<span class="line-modified">!                 if (!accSS1.contains(AccessibleState.SELECTED)) {</span>
<span class="line-modified">!                     String msg = &quot;Fourth tab selected but AccessibleState.SELECTED not set&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
  
<span class="line-modified">!                 // test Page.getAccessibleIndexInParent</span>
<span class="line-modified">!                 if (pac0.getAccessibleIndexInParent() == -1) {</span>
<span class="line-modified">!                     String msg = &quot;Empty title -&gt; negative AccessibleIndexInParent&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 if (pac0.getAccessibleIndexInParent() != 0) {</span>
<span class="line-modified">!                     String msg = &quot;first tab is not at index 0 in parent&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 if (pac1.getAccessibleIndexInParent() != 1) {</span>
<span class="line-modified">!                     String msg = &quot;second tab (null component) is not at index 1 in parent&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 if (pac2.getAccessibleIndexInParent() != 2) {</span>
<span class="line-modified">!                     String msg = &quot;third tab (empty title) string is not at index 2 in parent&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 if (pac3.getAccessibleIndexInParent() != 3) {</span>
<span class="line-modified">!                     String msg = &quot;fourth tab (empty title, null component, has tabComponent) string is not at index 3 in parent&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
  
<span class="line-modified">!                 // test Page.getAccessibleName</span>
<span class="line-modified">!                 String accName = pac0.getAccessibleName();</span>
<span class="line-modified">!                 if (!accName.equals(&quot;zero&quot;)) {</span>
<span class="line-modified">!                     String msg = &quot;Empty title -&gt; empty AccessibleName&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 // test Page.getAccessibleName when component is null</span>
<span class="line-modified">!                 accName = pac1.getAccessibleName();</span>
<span class="line-modified">!                 if (!accName.equals(&quot;one&quot;)) {</span>
<span class="line-modified">!                     String msg = &quot;AccessibleName of null panel not &#39;one&#39;&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
<span class="line-modified">!                 }</span>
  
<span class="line-modified">!                 // test Page.setDisplayedMnemonicIndex</span>
<span class="line-modified">!                 //  Empty title -&gt; IllegalArgumnetException</span>
<span class="line-modified">!                 badPane.setDisplayedMnemonicIndexAt(0, 1);</span>
  
<span class="line-modified">!                 // test Page.updateDisplayedMnemonicIndex</span>
<span class="line-modified">!                 badPane.setMnemonicAt(0, KeyEvent.VK_Z);</span>
<span class="line-modified">!                 if (badPane.getDisplayedMnemonicIndexAt(0) == -1) {</span>
<span class="line-modified">!                     String msg=&quot;Empty title -&gt; getDisplayedMnemonicIndexAt failure&quot;;</span>
<span class="line-modified">!                     throw new RuntimeException(msg);</span>
                  }
<span class="line-modified">!             } catch (Exception e) {</span>
<span class="line-modified">!                 exception = e;</span>
              }
<span class="line-modified">!         });</span>
<span class="line-modified">!         if (exception != null) {</span>
<span class="line-removed">-             System.out.println(&quot;Test failed: &quot; + exception.getMessage());</span>
<span class="line-removed">-             throw exception;</span>
<span class="line-removed">-         } else {</span>
<span class="line-removed">-             System.out.println(&quot;Test passed.&quot;);</span>
          }
      }
  
      // The following is likely what is being done in Burp Suite
      // https://portswigger.net/burp/ which fails in the same way, i.e. the
<span class="line-new-header">--- 18,157 ---</span>
   * @run main Bug8134116
   */
  public class Bug8134116 {
  
      private static volatile Exception exception = null;
<span class="line-added">+     private static JFrame frame;</span>
  
      public static void main(String args[]) throws Exception {
  
          try {
              UIManager.setLookAndFeel(new NimbusLookAndFeel());
          } catch (Exception e) {
              throw new RuntimeException(e);
          }
  
<span class="line-modified">!         try {</span>
<span class="line-modified">!             SwingUtilities.invokeAndWait(() -&gt; {</span>
<span class="line-modified">!                 JPanel panel0 = new JPanel();</span>
<span class="line-modified">!                 JPanel panel2 = new JPanel();</span>
<span class="line-modified">!                 BadPane badPane = new BadPane();</span>
<span class="line-modified">!                 badPane.add(&quot;zero&quot;, panel0);</span>
<span class="line-modified">!                 badPane.add(&quot;one&quot;, null);  // no component</span>
<span class="line-modified">!                 badPane.add(&quot;&quot;, panel2);  // no title</span>
<span class="line-modified">!                 badPane.add(&quot;&quot;, null); // no component, no title</span>
<span class="line-modified">!                 // but give it that via a tabComponent</span>
<span class="line-modified">!                 JPanel tabComponent = new JPanel();</span>
<span class="line-modified">!                 JLabel tabComponentLabel = new JLabel(&quot;three&quot;);</span>
<span class="line-modified">!                 tabComponent.add(tabComponentLabel);</span>
<span class="line-modified">!                 badPane.setTabComponentAt(3, tabComponent);</span>
<span class="line-modified">!                 frame = new JFrame();</span>
<span class="line-modified">!                 frame.add(badPane);</span>
<span class="line-modified">!                 frame.setSize(300, 300);</span>
<span class="line-added">+                 frame.setVisible(true);</span>
  
<span class="line-modified">!                 try {</span>
<span class="line-modified">!                     AccessibleContext ac = badPane.getAccessibleContext();</span>
<span class="line-modified">!                     Accessible page0 = ac.getAccessibleChild(0);</span>
<span class="line-modified">!                     if (page0 == null) {</span>
<span class="line-modified">!                         // Not something being tested, but checking anyway</span>
<span class="line-modified">!                         throw new RuntimeException(&quot;getAccessibleChild(0) is null&quot;);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     Accessible page1 = ac.getAccessibleChild(1);</span>
<span class="line-modified">!                     if (page1 == null) {</span>
<span class="line-modified">!                         // Not something being tested, but checking anyway</span>
<span class="line-modified">!                         throw new RuntimeException(&quot;getAccessibleChild(1) is null&quot;);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     Accessible page2 = ac.getAccessibleChild(2);</span>
<span class="line-modified">!                     Accessible page3 = ac.getAccessibleChild(3);</span>
<span class="line-modified">!                     // page0 - page3 are JTabbedPane.Page, a private inner class</span>
<span class="line-modified">!                     // and is an AccessibleContext</span>
<span class="line-modified">!                     // and implements Accessible and AccessibleComponent</span>
<span class="line-modified">!                     AccessibleContext pac0 = page0.getAccessibleContext();</span>
<span class="line-modified">!                     AccessibleContext pac1 = page1.getAccessibleContext();</span>
<span class="line-modified">!                     AccessibleContext pac2 = page2.getAccessibleContext();</span>
<span class="line-modified">!                     AccessibleContext pac3 = page3.getAccessibleContext();</span>
  
<span class="line-modified">!                     // test Page.getBounds</span>
<span class="line-modified">!                     // ensure no IndexOutOfBoundsException</span>
<span class="line-modified">!                     Rectangle r0 = pac0.getAccessibleComponent().getBounds();</span>
<span class="line-modified">!                     // make sure second Bounds is different than first</span>
<span class="line-modified">!                     Rectangle r1  = pac1.getAccessibleComponent().getBounds();</span>
<span class="line-modified">!                     if (r1.equals(r0)) {</span>
<span class="line-modified">!                         String msg = &quot;Second tab should not have same bounds as first tab&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
  
<span class="line-modified">!                     // test Page.getAccessibleStateSet</span>
<span class="line-modified">!                     // At this point page 0 is selected</span>
<span class="line-modified">!                     AccessibleStateSet accSS0 = pac0.getAccessibleStateSet();</span>
<span class="line-modified">!                     if (!accSS0.contains(AccessibleState.SELECTED)) {</span>
<span class="line-modified">!                         String msg = &quot;Empty title -&gt; AccessibleState.SELECTED not set&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     // select second tab</span>
<span class="line-modified">!                     badPane.setSelectedIndex(1);</span>
<span class="line-modified">!                     AccessibleStateSet accSS1 = pac1.getAccessibleStateSet();</span>
<span class="line-modified">!                     if (!accSS1.contains(AccessibleState.SELECTED)) {</span>
<span class="line-modified">!                         String msg = &quot;Second tab selected but AccessibleState.SELECTED not set&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     // select third tab</span>
<span class="line-modified">!                     badPane.setSelectedIndex(2);</span>
<span class="line-modified">!                     AccessibleStateSet accSS2 = pac2.getAccessibleStateSet();</span>
<span class="line-modified">!                     if (!accSS1.contains(AccessibleState.SELECTED)) {</span>
<span class="line-modified">!                         String msg = &quot;Third tab selected but AccessibleState.SELECTED not set&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     // select fourth tab</span>
<span class="line-modified">!                     badPane.setSelectedIndex(3);</span>
<span class="line-modified">!                     AccessibleStateSet accSS3 = pac3.getAccessibleStateSet();</span>
<span class="line-modified">!                     if (!accSS1.contains(AccessibleState.SELECTED)) {</span>
<span class="line-modified">!                         String msg = &quot;Fourth tab selected but AccessibleState.SELECTED not set&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
  
<span class="line-modified">!                     // test Page.getAccessibleIndexInParent</span>
<span class="line-modified">!                     if (pac0.getAccessibleIndexInParent() == -1) {</span>
<span class="line-modified">!                         String msg = &quot;Empty title -&gt; negative AccessibleIndexInParent&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     if (pac0.getAccessibleIndexInParent() != 0) {</span>
<span class="line-modified">!                         String msg = &quot;first tab is not at index 0 in parent&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     if (pac1.getAccessibleIndexInParent() != 1) {</span>
<span class="line-modified">!                         String msg = &quot;second tab (null component) is not at index 1 in parent&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     if (pac2.getAccessibleIndexInParent() != 2) {</span>
<span class="line-modified">!                         String msg = &quot;third tab (empty title) string is not at index 2 in parent&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     if (pac3.getAccessibleIndexInParent() != 3) {</span>
<span class="line-modified">!                         String msg = &quot;fourth tab (empty title, null component, has tabComponent) string is not at index 3 in parent&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
  
<span class="line-modified">!                     // test Page.getAccessibleName</span>
<span class="line-modified">!                     String accName = pac0.getAccessibleName();</span>
<span class="line-modified">!                     if (!accName.equals(&quot;zero&quot;)) {</span>
<span class="line-modified">!                         String msg = &quot;Empty title -&gt; empty AccessibleName&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                     // test Page.getAccessibleName when component is null</span>
<span class="line-modified">!                     accName = pac1.getAccessibleName();</span>
<span class="line-modified">!                     if (!accName.equals(&quot;one&quot;)) {</span>
<span class="line-modified">!                         String msg = &quot;AccessibleName of null panel not &#39;one&#39;&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-modified">!                     }</span>
  
<span class="line-modified">!                     // test Page.setDisplayedMnemonicIndex</span>
<span class="line-modified">!                     //  Empty title -&gt; IllegalArgumnetException</span>
<span class="line-modified">!                     badPane.setDisplayedMnemonicIndexAt(0, 1);</span>
  
<span class="line-modified">!                     // test Page.updateDisplayedMnemonicIndex</span>
<span class="line-modified">!                     badPane.setMnemonicAt(0, KeyEvent.VK_Z);</span>
<span class="line-modified">!                     if (badPane.getDisplayedMnemonicIndexAt(0) == -1) {</span>
<span class="line-modified">!                         String msg=&quot;Empty title -&gt; getDisplayedMnemonicIndexAt failure&quot;;</span>
<span class="line-modified">!                         throw new RuntimeException(msg);</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                 } catch (Exception e) {</span>
<span class="line-added">+                     exception = e;</span>
                  }
<span class="line-modified">!             });</span>
<span class="line-modified">!             if (exception != null) {</span>
<span class="line-added">+                 System.out.println(&quot;Test failed: &quot; + exception.getMessage());</span>
<span class="line-added">+                 throw exception;</span>
<span class="line-added">+             } else {</span>
<span class="line-added">+                 System.out.println(&quot;Test passed.&quot;);</span>
              }
<span class="line-modified">!         } finally {</span>
<span class="line-modified">!             if (frame != null) SwingUtilities.invokeAndWait(() -&gt; frame.dispose());</span>
          }
      }
  
      // The following is likely what is being done in Burp Suite
      // https://portswigger.net/burp/ which fails in the same way, i.e. the
</pre>
<center><a href="../7161568/bug7161568.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../JTable/4220171/bug4220171.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>