diff a/test/jdk/javax/swing/JComponent/7154030/bug7154030.java b/test/jdk/javax/swing/JComponent/7154030/bug7154030.java
--- a/test/jdk/javax/swing/JComponent/7154030/bug7154030.java
+++ b/test/jdk/javax/swing/JComponent/7154030/bug7154030.java
@@ -54,117 +54,121 @@
  */
 
 public class bug7154030 {
 
     private static JButton button = null;
+    private static JFrame frame;
 
     public static void main(String[] args) throws Exception {
-        BufferedImage imageInit = null;
-
-        BufferedImage imageShow = null;
-
-        BufferedImage imageHide = null;
-
-        ExtendedRobot robot = new ExtendedRobot();
-
-        SwingUtilities.invokeAndWait(new Runnable() {
-
-            @Override
-            public void run() {
-                JDesktopPane desktop = new JDesktopPane();
-                button = new JButton("button");
-                JFrame frame = new JFrame();
-
-                button.setSize(200, 200);
-                button.setLocation(100, 100);
-                button.setForeground(Color.RED);
-                button.setBackground(Color.RED);
-                button.setOpaque(true);
-                button.setVisible(false);
-                desktop.add(button);
-
-                frame.setContentPane(desktop);
-                frame.setSize(300, 300);
-                frame.setLocation(0, 0);
-                frame.setVisible(true);
-                frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
+        try {
+            BufferedImage imageInit = null;
+
+            BufferedImage imageShow = null;
+
+            BufferedImage imageHide = null;
+
+            ExtendedRobot robot = new ExtendedRobot();
+
+            SwingUtilities.invokeAndWait(new Runnable() {
+
+                @Override
+                public void run() {
+                    JDesktopPane desktop = new JDesktopPane();
+                    button = new JButton("button");
+                    frame = new JFrame();
+
+                    button.setSize(200, 200);
+                    button.setLocation(100, 100);
+                    button.setForeground(Color.RED);
+                    button.setBackground(Color.RED);
+                    button.setOpaque(true);
+                    button.setVisible(false);
+                    desktop.add(button);
+
+                    frame.setContentPane(desktop);
+                    frame.setSize(300, 300);
+                    frame.setLocation(0, 0);
+                    frame.setVisible(true);
+                    frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
+                }
+            });
+
+            robot.waitForIdle(500);
+            imageInit = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
+
+            SwingUtilities.invokeAndWait(new Runnable() {
+
+                @Override
+                public void run() {
+                    button.show();
+                }
+            });
+
+            robot.waitForIdle(500);
+            imageShow = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
+            if (Util.compareBufferedImages(imageInit, imageShow)) {
+                throw new Exception("Failed to show opaque button");
             }
-        });
 
-        robot.waitForIdle(500);
-        imageInit = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
+            robot.waitForIdle();
 
-        SwingUtilities.invokeAndWait(new Runnable() {
+            SwingUtilities.invokeAndWait(new Runnable() {
+                @Override
+                public void run() {
+                    button.hide();
+                }
+            });
 
-            @Override
-            public void run() {
-                button.show();
-            }
-        });
-
-        robot.waitForIdle(500);
-        imageShow = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
-        if (Util.compareBufferedImages(imageInit, imageShow)) {
-            throw new Exception("Failed to show opaque button");
-        }
+            robot.waitForIdle(500);
+            imageHide = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
 
-        robot.waitForIdle();
-
-        SwingUtilities.invokeAndWait(new Runnable() {
-
-            @Override
-            public void run() {
-                button.hide();
+            if (!Util.compareBufferedImages(imageInit, imageHide)) {
+                throw new Exception("Failed to hide opaque button");
             }
-        });
 
-        robot.waitForIdle(500);
-        imageHide = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
+            SwingUtilities.invokeAndWait(new Runnable() {
 
-        if (!Util.compareBufferedImages(imageInit, imageHide)) {
-            throw new Exception("Failed to hide opaque button");
-        }
+                @Override
+                public void run() {
+                    button.setOpaque(false);
+                    button.setBackground(new Color(128, 128, 0));
+                    button.setVisible(false);
+                }
+            });
 
-        SwingUtilities.invokeAndWait(new Runnable() {
+            robot.waitForIdle(500);
+            imageInit = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
 
-            @Override
-            public void run() {
-                button.setOpaque(false);
-                button.setBackground(new Color(128, 128, 0));
-                button.setVisible(false);
-            }
-        });
+            SwingUtilities.invokeAndWait(new Runnable() {
 
-        robot.waitForIdle(500);
-        imageInit = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
+                @Override
+                public void run() {
+                    button.show();
+                }
+            });
 
-        SwingUtilities.invokeAndWait(new Runnable() {
+            robot.waitForIdle(500);
+            imageShow = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
 
-            @Override
-            public void run() {
-                button.show();
-            }
-        });
+            SwingUtilities.invokeAndWait(new Runnable() {
 
-        robot.waitForIdle(500);
-        imageShow = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
+                @Override
+                public void run() {
+                    button.hide();
+                }
+            });
 
-        SwingUtilities.invokeAndWait(new Runnable() {
-
-            @Override
-            public void run() {
-                button.hide();
+            if (Util.compareBufferedImages(imageInit, imageShow)) {
+                throw new Exception("Failed to show non-opaque button");
             }
-        });
-
-        if (Util.compareBufferedImages(imageInit, imageShow)) {
-            throw new Exception("Failed to show non-opaque button");
-        }
 
-        robot.waitForIdle(500);
-        imageHide = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
+            robot.waitForIdle(500);
+            imageHide = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
 
-        if (!Util.compareBufferedImages(imageInit, imageHide)) {
-            throw new Exception("Failed to hide non-opaque button");
+            if (!Util.compareBufferedImages(imageInit, imageHide)) {
+                throw new Exception("Failed to hide non-opaque button");
+            }
+        } finally {
+            if (frame != null) SwingUtilities.invokeAndWait(() -> frame.dispose());
         }
     }
 }
