<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/javax/swing/JComponent/7154030/bug7154030.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2012, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * Portions Copyright (c) 2012 IBM Corporation
 26  */
 27 
 28 import javax.swing.JButton;
 29 import javax.swing.JDesktopPane;
 30 import javax.swing.JFrame;
 31 import javax.swing.SwingUtilities;
 32 
 33 import java.awt.AWTException;
 34 import java.awt.AlphaComposite;
 35 import java.awt.Color;
 36 import java.awt.Graphics;
 37 import java.awt.Graphics2D;
 38 import java.awt.Rectangle;
 39 import java.awt.Robot;
 40 import java.awt.Toolkit;
 41 import java.awt.image.BufferedImage;
 42 
 43 /*
 44  * @test
 45  * @key headful
 46  * @bug 7154030
 47  * @summary Swing components fail to hide after calling hide()
 48  * @author Jonathan Lu
 49  * @library ../../regtesthelpers/
 50  * @library /lib/client/
 51  * @build Util
 52  * @build ExtendedRobot
 53  * @run main bug7154030
 54  */
 55 
 56 public class bug7154030 {
 57 
 58     private static JButton button = null;
 59     private static JFrame frame;
 60 
 61     public static void main(String[] args) throws Exception {
 62         try {
 63             BufferedImage imageInit = null;
 64 
 65             BufferedImage imageShow = null;
 66 
 67             BufferedImage imageHide = null;
 68 
 69             ExtendedRobot robot = new ExtendedRobot();
 70 
 71             SwingUtilities.invokeAndWait(new Runnable() {
 72 
 73                 @Override
 74                 public void run() {
 75                     JDesktopPane desktop = new JDesktopPane();
 76                     button = new JButton(&quot;button&quot;);
 77                     frame = new JFrame();
 78 
 79                     button.setSize(200, 200);
 80                     button.setLocation(100, 100);
 81                     button.setForeground(Color.RED);
 82                     button.setBackground(Color.RED);
 83                     button.setOpaque(true);
 84                     button.setVisible(false);
 85                     desktop.add(button);
 86 
 87                     frame.setContentPane(desktop);
 88                     frame.setSize(300, 300);
 89                     frame.setLocation(0, 0);
 90                     frame.setVisible(true);
 91                     frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
 92                 }
 93             });
 94 
 95             robot.waitForIdle(500);
 96             imageInit = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
 97 
 98             SwingUtilities.invokeAndWait(new Runnable() {
 99 
100                 @Override
101                 public void run() {
102                     button.show();
103                 }
104             });
105 
106             robot.waitForIdle(500);
107             imageShow = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
108             if (Util.compareBufferedImages(imageInit, imageShow)) {
109                 throw new Exception(&quot;Failed to show opaque button&quot;);
110             }
111 
112             robot.waitForIdle();
113 
114             SwingUtilities.invokeAndWait(new Runnable() {
115                 @Override
116                 public void run() {
117                     button.hide();
118                 }
119             });
120 
121             robot.waitForIdle(500);
122             imageHide = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
123 
124             if (!Util.compareBufferedImages(imageInit, imageHide)) {
125                 throw new Exception(&quot;Failed to hide opaque button&quot;);
126             }
127 
128             SwingUtilities.invokeAndWait(new Runnable() {
129 
130                 @Override
131                 public void run() {
132                     button.setOpaque(false);
133                     button.setBackground(new Color(128, 128, 0));
134                     button.setVisible(false);
135                 }
136             });
137 
138             robot.waitForIdle(500);
139             imageInit = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
140 
141             SwingUtilities.invokeAndWait(new Runnable() {
142 
143                 @Override
144                 public void run() {
145                     button.show();
146                 }
147             });
148 
149             robot.waitForIdle(500);
150             imageShow = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
151 
152             SwingUtilities.invokeAndWait(new Runnable() {
153 
154                 @Override
155                 public void run() {
156                     button.hide();
157                 }
158             });
159 
160             if (Util.compareBufferedImages(imageInit, imageShow)) {
161                 throw new Exception(&quot;Failed to show non-opaque button&quot;);
162             }
163 
164             robot.waitForIdle(500);
165             imageHide = robot.createScreenCapture(new Rectangle(0, 0, 300, 300));
166 
167             if (!Util.compareBufferedImages(imageInit, imageHide)) {
168                 throw new Exception(&quot;Failed to hide non-opaque button&quot;);
169             }
170         } finally {
171             if (frame != null) SwingUtilities.invokeAndWait(() -&gt; frame.dispose());
172         }
173     }
174 }
    </pre>
  </body>
</html>