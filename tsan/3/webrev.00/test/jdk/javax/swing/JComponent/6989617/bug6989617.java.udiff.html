<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/javax/swing/JComponent/6989617/bug6989617.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../4337267/bug4337267.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../7154030/bug7154030.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/javax/swing/JComponent/6989617/bug6989617.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -34,72 +34,77 @@</span>
  import java.awt.*;
  
  public class bug6989617 {
      private static MyPanel panel;
      private static JButton button;
<span class="udiff-line-added">+     private static JFrame frame;</span>
  
      public static void main(String... args) throws Exception {
<span class="udiff-line-modified-removed">-         Robot robot = new Robot();</span>
<span class="udiff-line-modified-removed">-         SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-modified-removed">-             public void run() {</span>
<span class="udiff-line-modified-removed">-                 JFrame frame = new JFrame();</span>
<span class="udiff-line-modified-removed">-                 frame. setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="udiff-line-modified-removed">-                 panel = new MyPanel();</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             Robot robot = new Robot();</span>
<span class="udiff-line-modified-added">+             SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-modified-added">+                 public void run() {</span>
<span class="udiff-line-modified-added">+                     frame = new JFrame();</span>
<span class="udiff-line-modified-added">+                     frame. setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="udiff-line-added">+                     panel = new MyPanel();</span>
  
<span class="udiff-line-modified-removed">-                 button = new JButton(&quot;Hello&quot;);</span>
<span class="udiff-line-modified-removed">-                 panel.add(button);</span>
<span class="udiff-line-modified-removed">-                 frame.add(panel);</span>
<span class="udiff-line-modified-added">+                     button = new JButton(&quot;Hello&quot;);</span>
<span class="udiff-line-modified-added">+                     panel.add(button);</span>
<span class="udiff-line-modified-added">+                     frame.add(panel);</span>
  
<span class="udiff-line-modified-removed">-                 frame.setSize(200, 300);</span>
<span class="udiff-line-modified-removed">-                 frame.setVisible(true);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         });</span>
<span class="udiff-line-removed">-         // Testing the panel as a painting origin,</span>
<span class="udiff-line-removed">-         // the panel.paintImmediately() must be triggered</span>
<span class="udiff-line-removed">-         // when button.repaint() is called</span>
<span class="udiff-line-removed">-         robot.waitForIdle();</span>
<span class="udiff-line-removed">-         SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-removed">-             public void run() {</span>
<span class="udiff-line-removed">-                 panel.resetPaintRectangle();</span>
<span class="udiff-line-removed">-                 button.repaint();</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         });</span>
<span class="udiff-line-removed">-         robot.waitForIdle();</span>
<span class="udiff-line-removed">-         SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-removed">-             public void run() {</span>
<span class="udiff-line-removed">-                 Rectangle pr = panel.getPaintRectangle();</span>
<span class="udiff-line-removed">-                 if (!pr.getSize().equals(button.getSize())) {</span>
<span class="udiff-line-removed">-                     throw new RuntimeException(&quot;wrong size of the dirty area&quot;);</span>
<span class="udiff-line-modified-added">+                     frame.setSize(200, 300);</span>
<span class="udiff-line-modified-added">+                     frame.setVisible(true);</span>
                  }
<span class="udiff-line-modified-removed">-                 if (!pr.getLocation().equals(button.getLocation())) {</span>
<span class="udiff-line-modified-removed">-                     throw new RuntimeException(&quot;wrong location of the dirty area&quot;);</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+             // Testing the panel as a painting origin,</span>
<span class="udiff-line-added">+             // the panel.paintImmediately() must be triggered</span>
<span class="udiff-line-added">+             // when button.repaint() is called</span>
<span class="udiff-line-added">+             robot.waitForIdle();</span>
<span class="udiff-line-added">+             SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-added">+                 public void run() {</span>
<span class="udiff-line-added">+                     panel.resetPaintRectangle();</span>
<span class="udiff-line-added">+                     button.repaint();</span>
                  }
<span class="udiff-line-modified-removed">-             }</span>
<span class="udiff-line-modified-removed">-         });</span>
<span class="udiff-line-modified-removed">-         // Testing the panel as NOT a painting origin</span>
<span class="udiff-line-modified-removed">-         // the panel.paintImmediately() must NOT be triggered</span>
<span class="udiff-line-modified-removed">-         // when button.repaint() is called</span>
<span class="udiff-line-modified-removed">-         robot.waitForIdle();</span>
<span class="udiff-line-modified-removed">-         SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-modified-removed">-             public void run() {</span>
<span class="udiff-line-modified-removed">-                 panel.resetPaintRectangle();</span>
<span class="udiff-line-modified-removed">-                 panel.setPaintingOrigin(false);</span>
<span class="udiff-line-modified-removed">-                 if (panel.getPaintRectangle() != null) {</span>
<span class="udiff-line-removed">-                     throw new RuntimeException(&quot;paint rectangle is not null&quot;);</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+             robot.waitForIdle();</span>
<span class="udiff-line-modified-added">+             SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-modified-added">+                 public void run() {</span>
<span class="udiff-line-modified-added">+                     Rectangle pr = panel.getPaintRectangle();</span>
<span class="udiff-line-modified-added">+                     if (!pr.getSize().equals(button.getSize())) {</span>
<span class="udiff-line-modified-added">+                         throw new RuntimeException(&quot;wrong size of the dirty area&quot;);</span>
<span class="udiff-line-modified-added">+                     }</span>
<span class="udiff-line-modified-added">+                     if (!pr.getLocation().equals(button.getLocation())) {</span>
<span class="udiff-line-modified-added">+                         throw new RuntimeException(&quot;wrong location of the dirty area&quot;);</span>
<span class="udiff-line-modified-added">+                     }</span>
                  }
<span class="udiff-line-modified-removed">-                 button.repaint();</span>
<span class="udiff-line-modified-removed">-             }</span>
<span class="udiff-line-modified-removed">-         });</span>
<span class="udiff-line-modified-removed">-         robot.waitForIdle();</span>
<span class="udiff-line-modified-removed">-         SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-modified-removed">-             public void run() {</span>
<span class="udiff-line-modified-removed">-                 if(panel.getPaintRectangle() != null) {</span>
<span class="udiff-line-modified-removed">-                     throw new RuntimeException(&quot;paint rectangle is not null&quot;);</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+             // Testing the panel as NOT a painting origin</span>
<span class="udiff-line-modified-added">+             // the panel.paintImmediately() must NOT be triggered</span>
<span class="udiff-line-modified-added">+             // when button.repaint() is called</span>
<span class="udiff-line-modified-added">+             robot.waitForIdle();</span>
<span class="udiff-line-modified-added">+             SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-modified-added">+                 public void run() {</span>
<span class="udiff-line-modified-added">+                     panel.resetPaintRectangle();</span>
<span class="udiff-line-added">+                     panel.setPaintingOrigin(false);</span>
<span class="udiff-line-added">+                     if (panel.getPaintRectangle() != null) {</span>
<span class="udiff-line-added">+                         throw new RuntimeException(&quot;paint rectangle is not null&quot;);</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     button.repaint();</span>
                  }
<span class="udiff-line-modified-removed">-                 System.out.println(&quot;Test passed...&quot;);</span>
<span class="udiff-line-modified-removed">-             }</span>
<span class="udiff-line-modified-removed">-         });</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+             robot.waitForIdle();</span>
<span class="udiff-line-modified-added">+             SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-added">+                 public void run() {</span>
<span class="udiff-line-added">+                     if(panel.getPaintRectangle() != null) {</span>
<span class="udiff-line-added">+                         throw new RuntimeException(&quot;paint rectangle is not null&quot;);</span>
<span class="udiff-line-added">+                     }</span>
<span class="udiff-line-added">+                     System.out.println(&quot;Test passed...&quot;);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             });</span>
<span class="udiff-line-added">+         } finally {</span>
<span class="udiff-line-added">+             if (frame != null) SwingUtilities.invokeAndWait(() -&gt; frame.dispose());</span>
<span class="udiff-line-added">+         }</span>
      }
  
      static class MyPanel extends JPanel {
          private boolean isPaintingOrigin = true;
          private Rectangle paintRectangle;
</pre>
<center><a href="../4337267/bug4337267.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../7154030/bug7154030.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>