diff a/test/jdk/javax/swing/JMenu/4417601/bug4417601.java b/test/jdk/javax/swing/JMenu/4417601/bug4417601.java
--- a/test/jdk/javax/swing/JMenu/4417601/bug4417601.java
+++ b/test/jdk/javax/swing/JMenu/4417601/bug4417601.java
@@ -37,19 +37,20 @@
 import java.awt.*;
 
 public class bug4417601 {
     static JMenu menu;
     static volatile boolean flag;
+    static JFrame frame;
 
     public static void main(String[] args) throws Exception {
 
         ExtendedRobot robot = new ExtendedRobot();
         robot.setAutoDelay(10);
 
         SwingUtilities.invokeLater(new Runnable() {
             public void run() {
-                JFrame frame = new JFrame();
+                frame = new JFrame();
                 frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
                 menu = new JMenu("Menu");
                 JMenuBar bar = new JMenuBar();
                 bar.add(menu);
                 frame.setJMenuBar(bar);
@@ -73,10 +74,11 @@
         p.y += size.height / 2;
         robot.mouseMove(p.x, p.y);
         robot.mousePress(InputEvent.BUTTON1_MASK);
         robot.mouseRelease(InputEvent.BUTTON1_MASK);
         robot.waitForIdle();
+        if (frame != null) SwingUtilities.invokeAndWait(() -> frame.dispose());
         if (flag) {
             throw new RuntimeException("Empty popup was shown");
         }
     }
 }
