<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/javax/swing/JMenu/4417601/bug4417601.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../JList/6510999/bug6510999.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../4515762/bug4515762.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/javax/swing/JMenu/4417601/bug4417601.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
22  */
23 
24 /*
25  * @test
26  * @key headful
27  * @bug 4417601
28  * @summary JMenus with no items paint a tiny menu.
29  * @author Alexander Potochkin
30  * @library /lib/client
31  * @build ExtendedRobot
32  * @run main bug4417601
33  */
34 
35 import javax.swing.*;
36 import java.awt.event.*;
37 import java.awt.*;
38 
39 public class bug4417601 {
40     static JMenu menu;
41     static volatile boolean flag;

42 
43     public static void main(String[] args) throws Exception {
44 
45         ExtendedRobot robot = new ExtendedRobot();
46         robot.setAutoDelay(10);
47 
48         SwingUtilities.invokeLater(new Runnable() {
49             public void run() {
<span class="line-modified">50                 JFrame frame = new JFrame();</span>
51                 frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
52                 menu = new JMenu(&quot;Menu&quot;);
53                 JMenuBar bar = new JMenuBar();
54                 bar.add(menu);
55                 frame.setJMenuBar(bar);
56 
57                 frame.getLayeredPane().addContainerListener(new ContainerAdapter() {
58                     public void componentAdded(ContainerEvent e) {
59                         flag = true;
60                     }
61                 });
62 
63                 frame.pack();
64                 frame.setSize(200, 200);
65                 frame.setLocationRelativeTo(null);
66                 frame.setVisible(true);
67             }
68         });
69         robot.waitForIdle();
70         Point p = menu.getLocationOnScreen();
71         Dimension size = menu.getSize();
72         p.x += size.width / 2;
73         p.y += size.height / 2;
74         robot.mouseMove(p.x, p.y);
75         robot.mousePress(InputEvent.BUTTON1_MASK);
76         robot.mouseRelease(InputEvent.BUTTON1_MASK);
77         robot.waitForIdle();

78         if (flag) {
79             throw new RuntimeException(&quot;Empty popup was shown&quot;);
80         }
81     }
82 }
</pre>
</td>
<td>
<hr />
<pre>
22  */
23 
24 /*
25  * @test
26  * @key headful
27  * @bug 4417601
28  * @summary JMenus with no items paint a tiny menu.
29  * @author Alexander Potochkin
30  * @library /lib/client
31  * @build ExtendedRobot
32  * @run main bug4417601
33  */
34 
35 import javax.swing.*;
36 import java.awt.event.*;
37 import java.awt.*;
38 
39 public class bug4417601 {
40     static JMenu menu;
41     static volatile boolean flag;
<span class="line-added">42     static JFrame frame;</span>
43 
44     public static void main(String[] args) throws Exception {
45 
46         ExtendedRobot robot = new ExtendedRobot();
47         robot.setAutoDelay(10);
48 
49         SwingUtilities.invokeLater(new Runnable() {
50             public void run() {
<span class="line-modified">51                 frame = new JFrame();</span>
52                 frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
53                 menu = new JMenu(&quot;Menu&quot;);
54                 JMenuBar bar = new JMenuBar();
55                 bar.add(menu);
56                 frame.setJMenuBar(bar);
57 
58                 frame.getLayeredPane().addContainerListener(new ContainerAdapter() {
59                     public void componentAdded(ContainerEvent e) {
60                         flag = true;
61                     }
62                 });
63 
64                 frame.pack();
65                 frame.setSize(200, 200);
66                 frame.setLocationRelativeTo(null);
67                 frame.setVisible(true);
68             }
69         });
70         robot.waitForIdle();
71         Point p = menu.getLocationOnScreen();
72         Dimension size = menu.getSize();
73         p.x += size.width / 2;
74         p.y += size.height / 2;
75         robot.mouseMove(p.x, p.y);
76         robot.mousePress(InputEvent.BUTTON1_MASK);
77         robot.mouseRelease(InputEvent.BUTTON1_MASK);
78         robot.waitForIdle();
<span class="line-added">79         if (frame != null) SwingUtilities.invokeAndWait(() -&gt; frame.dispose());</span>
80         if (flag) {
81             throw new RuntimeException(&quot;Empty popup was shown&quot;);
82         }
83     }
84 }
</pre>
</td>
</tr>
</table>
<center><a href="../../JList/6510999/bug6510999.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../4515762/bug4515762.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>