<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/javax/swing/JMenu/6538132/bug6538132.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../6470128/bug6470128.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../JMenuBar/4750590/bug4750590.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/javax/swing/JMenu/6538132/bug6538132.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -40,10 +40,11 @@</span>
  
  public class bug6538132 {
      private static JMenu menu1;
      private static JMenu menu2;
      private static volatile boolean isWinLaf;
<span class="udiff-line-added">+     private static JFrame frame;</span>
  
      private static void createGui() {
          try {
              UIManager.setLookAndFeel(&quot;com.sun.java.swing.plaf.windows.WindowsLookAndFeel&quot;);
              isWinLaf = true;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -51,11 +52,11 @@</span>
              // If we can&#39;t set WinLaf it means we are not under Windows
              // make the test pass
              isWinLaf = false;
              return;
          }
<span class="udiff-line-modified-removed">-         JFrame frame = new JFrame();</span>
<span class="udiff-line-modified-added">+         frame = new JFrame();</span>
          frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
  
          JMenuBar menuBar = new JMenuBar();
          menu1 = createMenu();
          menuBar.add(menu1);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -74,39 +75,43 @@</span>
          menu.add(new JMenuItem(&quot;MenuItem&quot;));
          return menu;
      }
  
      public static void main(String[] args) throws Exception {
<span class="udiff-line-modified-removed">-         SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-modified-removed">-             public void run() {</span>
<span class="udiff-line-modified-removed">-                 bug6538132.createGui();</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-modified-added">+                 public void run() {</span>
<span class="udiff-line-added">+                     bug6538132.createGui();</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             });</span>
<span class="udiff-line-added">+             if(isWinLaf) {</span>
<span class="udiff-line-added">+                 ExtendedRobot robot = new ExtendedRobot();</span>
<span class="udiff-line-added">+                 robot.setAutoDelay(10);</span>
<span class="udiff-line-added">+                 robot.waitForIdle();</span>
<span class="udiff-line-added">+                 Point p1 = menu1.getLocationOnScreen();</span>
<span class="udiff-line-added">+                 final int x1 = p1.x + menu1.getWidth() / 2;</span>
<span class="udiff-line-added">+                 final int y1 = p1.y + menu1.getHeight() / 2;</span>
<span class="udiff-line-added">+                 robot.glide(0, 0, x1, y1);</span>
<span class="udiff-line-added">+                 robot.mousePress(InputEvent.BUTTON1_MASK);</span>
<span class="udiff-line-added">+                 robot.mouseRelease(InputEvent.BUTTON1_MASK);</span>
<span class="udiff-line-added">+                 assertPopupOpen();</span>
<span class="udiff-line-added">+                 Point p2 = menu2.getLocationOnScreen();</span>
<span class="udiff-line-added">+                 final int x2 = p2.x + menu2.getWidth() / 2;</span>
<span class="udiff-line-added">+                 final int y2 = p2.y + menu2.getHeight() / 2;</span>
<span class="udiff-line-added">+                 robot.glide(x1, y1, x2, y2);</span>
<span class="udiff-line-added">+                 assertPopupOpen();</span>
<span class="udiff-line-added">+                 robot.keyPress(KeyEvent.VK_ESCAPE);</span>
<span class="udiff-line-added">+                 robot.keyRelease(KeyEvent.VK_ESCAPE);</span>
<span class="udiff-line-added">+                 assertPopupNotOpen();</span>
<span class="udiff-line-added">+                 robot.glide(x2, y2, x1, y1);</span>
<span class="udiff-line-added">+                 assertPopupNotOpen();</span>
<span class="udiff-line-added">+                 robot.mousePress(InputEvent.BUTTON1_MASK);</span>
<span class="udiff-line-added">+                 robot.mouseRelease(InputEvent.BUTTON1_MASK);</span>
<span class="udiff-line-added">+                 assertPopupOpen();</span>
              }
<span class="udiff-line-modified-removed">-         });</span>
<span class="udiff-line-modified-removed">-         if(isWinLaf) {</span>
<span class="udiff-line-removed">-             ExtendedRobot robot = new ExtendedRobot();</span>
<span class="udiff-line-removed">-             robot.setAutoDelay(10);</span>
<span class="udiff-line-removed">-             robot.waitForIdle();</span>
<span class="udiff-line-removed">-             Point p1 = menu1.getLocationOnScreen();</span>
<span class="udiff-line-removed">-             final int x1 = p1.x + menu1.getWidth() / 2;</span>
<span class="udiff-line-removed">-             final int y1 = p1.y + menu1.getHeight() / 2;</span>
<span class="udiff-line-removed">-             robot.glide(0, 0, x1, y1);</span>
<span class="udiff-line-removed">-             robot.mousePress(InputEvent.BUTTON1_MASK);</span>
<span class="udiff-line-removed">-             robot.mouseRelease(InputEvent.BUTTON1_MASK);</span>
<span class="udiff-line-removed">-             assertPopupOpen();</span>
<span class="udiff-line-removed">-             Point p2 = menu2.getLocationOnScreen();</span>
<span class="udiff-line-removed">-             final int x2 = p2.x + menu2.getWidth() / 2;</span>
<span class="udiff-line-removed">-             final int y2 = p2.y + menu2.getHeight() / 2;</span>
<span class="udiff-line-removed">-             robot.glide(x1, y1, x2, y2);</span>
<span class="udiff-line-removed">-             assertPopupOpen();</span>
<span class="udiff-line-removed">-             robot.keyPress(KeyEvent.VK_ESCAPE);</span>
<span class="udiff-line-removed">-             robot.keyRelease(KeyEvent.VK_ESCAPE);</span>
<span class="udiff-line-removed">-             assertPopupNotOpen();</span>
<span class="udiff-line-removed">-             robot.glide(x2, y2, x1, y1);</span>
<span class="udiff-line-removed">-             assertPopupNotOpen();</span>
<span class="udiff-line-removed">-             robot.mousePress(InputEvent.BUTTON1_MASK);</span>
<span class="udiff-line-removed">-             robot.mouseRelease(InputEvent.BUTTON1_MASK);</span>
<span class="udiff-line-removed">-             assertPopupOpen();</span>
<span class="udiff-line-modified-added">+         } finally {</span>
<span class="udiff-line-modified-added">+             if (frame != null) SwingUtilities.invokeAndWait(() -&gt; frame.dispose());</span>
          }
      }
  
      static void assertPopupOpen() {
          if (getLastPopup() == null) {
</pre>
<center><a href="../6470128/bug6470128.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../JMenuBar/4750590/bug4750590.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>