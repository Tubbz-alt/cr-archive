<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/jdk/javax/swing/JRadioButton/8033699/bug8033699.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2014, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24  /*
 25  * @test
 26  * @key headful
 27  * @library ../../regtesthelpers
 28  * @build Util
 29  * @bug 8033699 8154043 8167160 8208640
 30  * @summary  Incorrect radio button behavior when pressing tab key
 31  * @run main bug8033699
 32  */
 33 import java.awt.KeyboardFocusManager;
 34 import java.awt.Robot;
 35 import java.awt.event.KeyEvent;
 36 import java.util.logging.Level;
 37 import java.util.logging.Logger;
 38 import javax.swing.BorderFactory;
 39 import javax.swing.BoxLayout;
 40 import javax.swing.ButtonGroup;
 41 import javax.swing.JButton;
 42 import javax.swing.JFrame;
 43 import javax.swing.JPanel;
 44 import javax.swing.JRadioButton;
 45 import javax.swing.SwingUtilities;
 46 import javax.swing.UIManager;
 47 import javax.swing.UnsupportedLookAndFeelException;
 48 
 49 public class bug8033699 {
 50 
 51     private static JFrame mainFrame;
 52     private static Robot robot;
 53     private static JButton btnStart;
 54     private static JButton btnEnd;
 55     private static JButton btnMiddle;
 56     private static JRadioButton radioBtn1;
 57     private static JRadioButton radioBtn2;
 58     private static JRadioButton radioBtn3;
 59     private static JRadioButton radioBtnSingle;
 60 
 61     public static void main(String args[]) throws Throwable {
 62         SwingUtilities.invokeAndWait(() -&gt; {
 63                 changeLAF();
 64                 createAndShowGUI();
 65         });
 66 
 67         robot = new Robot();
 68         Thread.sleep(100);
 69 
 70         robot.setAutoDelay(100);
 71 
 72         // tab key test grouped radio button
 73         runTest1();
 74 
 75         // tab key test non-grouped radio button
 76         runTest2();
 77 
 78         // shift tab key test grouped and non grouped radio button
 79         runTest3();
 80 
 81         // left/up key test in grouped radio button
 82         runTest4();
 83 
 84         // down/right key test in grouped radio button
 85         runTest5();
 86 
 87         // tab from radio button in group to next component in the middle of button group layout
 88         runTest6();
 89 
 90         // tab to radio button in group from component in the middle of button group layout
 91         runTest7();
 92 
 93         // down key circle back to first button in grouped radio button
 94         runTest8();
 95 
 96         SwingUtilities.invokeAndWait(() -&gt; mainFrame.dispose());
 97     }
 98 
 99     private static void changeLAF() {
100         String currentLAF = UIManager.getLookAndFeel().toString();
101         System.out.println(currentLAF);
102         currentLAF = currentLAF.toLowerCase();
103         if (currentLAF.contains(&quot;nimbus&quot;)) {
104             try {
105                 UIManager.setLookAndFeel(&quot;javax.swing.plaf.metal.MetalLookAndFeel&quot;);
106             } catch (Exception ex) {
107                 ex.printStackTrace();
108             }
109         }
110     }
111 
112     private static void createAndShowGUI() {
113         mainFrame = new JFrame(&quot;Bug 8033699 - 8 Tests for Grouped/Non Group Radio Buttons&quot;);
114         btnStart = new JButton(&quot;Start&quot;);
115         btnEnd = new JButton(&quot;End&quot;);
116         btnMiddle = new JButton(&quot;Middle&quot;);
117 
118         JPanel box = new JPanel();
119         box.setLayout(new BoxLayout(box, BoxLayout.Y_AXIS));
120         box.setBorder(BorderFactory.createTitledBorder(&quot;Grouped Radio Buttons&quot;));
121         radioBtn1 = new JRadioButton(&quot;A&quot;);
122         radioBtn2 = new JRadioButton(&quot;B&quot;);
123         radioBtn3 = new JRadioButton(&quot;C&quot;);
124 
125         ButtonGroup btnGrp = new ButtonGroup();
126         btnGrp.add(radioBtn1);
127         btnGrp.add(radioBtn2);
128         btnGrp.add(radioBtn3);
129         radioBtn1.setSelected(true);
130 
131         box.add(radioBtn1);
132         box.add(radioBtn2);
133         box.add(btnMiddle);
134         box.add(radioBtn3);
135 
136         radioBtnSingle = new JRadioButton(&quot;Not Grouped&quot;);
137         radioBtnSingle.setSelected(true);
138 
139         mainFrame.getContentPane().add(btnStart);
140         mainFrame.getContentPane().add(box);
141         mainFrame.getContentPane().add(radioBtnSingle);
142         mainFrame.getContentPane().add(btnEnd);
143 
144         mainFrame.getRootPane().setDefaultButton(btnStart);
145         btnStart.requestFocus();
146 
147         mainFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
148         mainFrame.setLayout(new BoxLayout(mainFrame.getContentPane(), BoxLayout.Y_AXIS));
149 
150         mainFrame.setSize(300, 300);
151         mainFrame.setLocation(200, 200);
152         mainFrame.setVisible(true);
153         mainFrame.toFront();
154     }
155 
156     // Radio button Group as a single component when traversing through tab key
157     private static void runTest1() throws Exception {
158         hitKey(robot, KeyEvent.VK_TAB);
159         hitKey(robot, KeyEvent.VK_TAB);
160         hitKey(robot, KeyEvent.VK_TAB);
161 
162         SwingUtilities.invokeAndWait(() -&gt; {
163             if (KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner() != radioBtnSingle) {
164                 System.out.println(&quot;Radio Button Group Go To Next Component through Tab Key failed&quot;);
165                 throw new RuntimeException(&quot;Focus is not on Radio Button Single as Expected&quot;);
166             }
167         });
168     }
169 
170     // Non-Grouped Radio button as a single component when traversing through tab key
171     private static void runTest2() throws Exception {
172         hitKey(robot, KeyEvent.VK_TAB);
173         SwingUtilities.invokeAndWait(() -&gt; {
174             if (KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner() != btnEnd) {
175                 System.out.println(&quot;Non Grouped Radio Button Go To Next Component through Tab Key failed&quot;);
176                 throw new RuntimeException(&quot;Focus is not on Button End as Expected&quot;);
177             }
178         });
179     }
180 
181     // Non-Grouped Radio button and Group Radio button as a single component when traversing through shift-tab key
182     private static void runTest3() throws Exception {
183         hitKey(robot, KeyEvent.VK_SHIFT, KeyEvent.VK_TAB);
184         hitKey(robot, KeyEvent.VK_SHIFT, KeyEvent.VK_TAB);
185         hitKey(robot, KeyEvent.VK_SHIFT, KeyEvent.VK_TAB);
186         SwingUtilities.invokeAndWait(() -&gt; {
187             if (KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner() != radioBtn1) {
188                 System.out.println(&quot;Radio button Group/Non Grouped Radio Button SHIFT-Tab Key Test failed&quot;);
189                 throw new RuntimeException(&quot;Focus is not on Radio Button A as Expected&quot;);
190             }
191         });
192     }
193 
194     // Using arrow key to move focus in radio button group
195     private static void runTest4() throws Exception {
196         hitKey(robot, KeyEvent.VK_DOWN);
197         hitKey(robot, KeyEvent.VK_RIGHT);
198         SwingUtilities.invokeAndWait(() -&gt; {
199             if (KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner() != radioBtn3) {
200                 System.out.println(&quot;Radio button Group UP/LEFT Arrow Key Move Focus Failed&quot;);
201                 throw new RuntimeException(&quot;Focus is not on Radio Button C as Expected&quot;);
202             }
203         });
204     }
205 
206     private static void runTest5() throws Exception {
207         hitKey(robot, KeyEvent.VK_UP);
208         hitKey(robot, KeyEvent.VK_LEFT);
209         SwingUtilities.invokeAndWait(() -&gt; {
210             if (KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner() != radioBtn1) {
211                 System.out.println(&quot;Radio button Group Left/Up Arrow Key Move Focus Failed&quot;);
212                 throw new RuntimeException(&quot;Focus is not on Radio Button A as Expected&quot;);
213             }
214         });
215     }
216 
217     private static void runTest6() throws Exception {
218         hitKey(robot, KeyEvent.VK_UP);
219         hitKey(robot, KeyEvent.VK_UP);
220         SwingUtilities.invokeAndWait(() -&gt; {
221             if (KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner() != radioBtn2) {
222                 System.out.println(&quot;Radio button Group Circle Back To First Button Test&quot;);
223                 throw new RuntimeException(&quot;Focus is not on Radio Button B as Expected&quot;);
224             }
225         });
226     }
227 
228     private static void runTest7() throws Exception {
229         hitKey(robot, KeyEvent.VK_TAB);
230         SwingUtilities.invokeAndWait(() -&gt; {
231             if (KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner() != btnMiddle) {
232                 System.out.println(&quot;Separate Component added in button group layout&quot;);
233                 throw new RuntimeException(&quot;Focus is not on Middle Button as Expected&quot;);
234             }
235         });
236     }
237 
238     private static void runTest8() throws Exception {
239         hitKey(robot, KeyEvent.VK_TAB);
240         SwingUtilities.invokeAndWait(() -&gt; {
241             if (KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner() != radioBtnSingle) {
242                 System.out.println(&quot;Separate Component added in button group layout&quot;);
243                 throw new RuntimeException(&quot;Focus is not on Radio Button Single as Expected&quot;);
244             }
245         });
246     }
247 
248     private static void hitKey(Robot robot, int keycode) {
249         robot.keyPress(keycode);
250         robot.keyRelease(keycode);
251         robot.waitForIdle();
252     }
253 
254     private static void hitKey(Robot robot, int mode, int keycode) {
255         robot.keyPress(mode);
256         robot.keyPress(keycode);
257         robot.keyRelease(mode);
258         robot.keyRelease(keycode);
259         robot.waitForIdle();
260     }
261 }
    </pre>
  </body>
</html>