diff a/test/jdk/javax/swing/JButton/4796987/bug4796987.java b/test/jdk/javax/swing/JButton/4796987/bug4796987.java
--- a/test/jdk/javax/swing/JButton/4796987/bug4796987.java
+++ b/test/jdk/javax/swing/JButton/4796987/bug4796987.java
@@ -22,10 +22,11 @@
  */
 
 /*
  * @test
  * @bug 4796987
+ * @key headful
  * @requires (os.family == "windows")
  * @summary XP Only: JButton.setBorderPainted() does not work with XP L&F
  * @author Alexander Scherbatiy
  * @library ../../regtesthelpers
  * @library /test/lib
@@ -44,16 +45,21 @@
 
 public class bug4796987 {
 
     private static JButton button1;
     private static JButton button2;
+    private static JFrame frame;
 
     public static void main(String[] args) throws Exception {
-        if (Platform.isWindows()
+        try {
+            if (Platform.isWindows()
                 && OSVersion.current().equals(OSVersion.WINDOWS_XP)) {
-            UIManager.setLookAndFeel(new WindowsLookAndFeel());
-            testButtonBorder();
+                UIManager.setLookAndFeel(new WindowsLookAndFeel());
+                testButtonBorder();
+            }
+        } finally {
+            if (frame != null) SwingUtilities.invokeAndWait(() -> frame.dispose());
         }
     }
 
     private static void testButtonBorder() throws Exception {
         Robot robot = new Robot();
@@ -87,11 +93,11 @@
         button.setFocusable(false);
         return button;
     }
 
     private static void createAndShowGUI() {
-        JFrame frame = new JFrame("Test");
+        frame = new JFrame("Test");
         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
         frame.setSize(200, 200);
 
         JButton button = new JButton();
         button.setBorder(null);
