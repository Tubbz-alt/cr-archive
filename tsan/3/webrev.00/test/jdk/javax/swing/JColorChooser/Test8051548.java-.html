<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/jdk/javax/swing/JColorChooser/Test8051548.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2014, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.awt.Color;
 25 import java.awt.Component;
 26 import java.awt.Container;
 27 import java.awt.Frame;
 28 import java.awt.Robot;
 29 import java.awt.event.KeyEvent;
 30 import java.util.function.Predicate;
 31 import javax.swing.JColorChooser;
 32 import javax.swing.JFormattedTextField;
 33 import javax.swing.JFrame;
 34 import javax.swing.JTabbedPane;
 35 import javax.swing.SwingUtilities;
 36 import javax.swing.colorchooser.AbstractColorChooserPanel;
 37 
 38 /*
 39  * @test
 40  * @key headful
 41  * @bug 8051548
 42  * @summary JColorChooser should have a way to disable transparency controls
 43  * @author Alexandr Scherbatiy
 44  * @run main Test8051548
 45  */
 46 
 47 public class Test8051548 {
 48 
 49     private static final String[][] TABS = {
 50         {&quot;HSV&quot;, &quot;0&quot;},
 51         {&quot;HSL&quot;, &quot;0&quot;},
 52         {&quot;RGB&quot;, &quot;255&quot;},
 53         {&quot;CMYK&quot;, &quot;255&quot;}
 54     };
 55 
 56     private static JColorChooser colorChooser;
 57     private static boolean propertyChangeListenerInvoked;
 58     private static volatile Color color;
 59 
 60     public static void main(String[] args) throws Exception {
 61         testColorPanels();
 62         testShowDialog(true);
 63         testShowDialog(false);
 64     }
 65 
 66     private static void testColorPanels() throws Exception {
 67         SwingUtilities.invokeAndWait(() -&gt; createAndShowGUI());
 68 
 69         Robot robot = new Robot();
 70         robot.setAutoDelay(50);
 71         robot.waitForIdle();
 72 
 73         for (String[] tabs : TABS) {
 74             final String tab = tabs[0];
 75             final String initialValue = tabs[1];
 76 
 77             SwingUtilities.invokeAndWait(() -&gt; {
 78 
 79                 colorChooser.setColor(new Color(50, 100, 85));
 80                 JTabbedPane tabbedPane =
 81                         (JTabbedPane) findComponent(colorChooser, &quot;JTabbedPane&quot;);
 82                 int index = tabbedPane.indexOfTab(tab);
 83                 tabbedPane.setSelectedIndex(index);
 84 
 85                 AbstractColorChooserPanel colorChooserPanel
 86                         = (AbstractColorChooserPanel) findComponent(
 87                                 tabbedPane.getComponent(index), &quot;ColorChooserPanel&quot;);
 88 
 89                 propertyChangeListenerInvoked = false;
 90                 colorChooserPanel.addPropertyChangeListener((e) -&gt; {
 91                     if (AbstractColorChooserPanel.TRANSPARENCY_ENABLED_PROPERTY.
 92                             equals(e.getPropertyName())) {
 93                         propertyChangeListenerInvoked = true;
 94                         if(!(Boolean)e.getOldValue()){
 95                             throw new RuntimeException(&quot;Old color transparency&quot;
 96                                     + &quot; selection property should be true!&quot;);
 97                         }
 98                         if((Boolean)e.getNewValue()){
 99                             throw new RuntimeException(&quot;New color transparency&quot;
100                                     + &quot; selection property should be false!&quot;);
101                         }
102                     }
103                 });
104 
105                 if (!colorChooserPanel.isColorTransparencySelectionEnabled()) {
106                     throw new RuntimeException(&quot;Color transparency selection&quot;
107                             + &quot; should be enabled by default&quot;);
108                 }
109 
110                 JFormattedTextField transparencyTextField = (JFormattedTextField)
111                         findTextField(colorChooserPanel, initialValue);
112 
113                 if (!transparencyTextField.isEnabled()) {
114                     throw new RuntimeException(&quot;Transparency controls are&quot;
115                             + &quot; disabled by default!&quot;);
116                 }
117 
118                 transparencyTextField.setValue(50);
119 
120                 if(!colorHasAlpha()){
121                     throw new RuntimeException(&quot;Transparency selection should&quot;
122                             + &quot; be enabled!&quot;);
123                 }
124 
125                 colorChooserPanel.setColorTransparencySelectionEnabled(false);
126 
127                 if (colorChooserPanel.isColorTransparencySelectionEnabled()) {
128                     throw new RuntimeException(&quot;Color transparency selection&quot;
129                             + &quot; should be disabled!&quot;);
130                 }
131 
132                 if(!propertyChangeListenerInvoked){
133                     throw new RuntimeException(&quot;Property change listener is not&quot;
134                             + &quot; invoked!&quot;);
135                 }
136 
137                 if(colorHasAlpha()){
138                     throw new RuntimeException(&quot;Transparency selection should&quot;
139                             + &quot; be disabled!&quot;);
140                 }
141             });
142 
143             robot.waitForIdle();
144         }
145 
146     }
147 
148     static void testShowDialog(boolean colorTransparencySelectionEnabled) throws Exception {
149         int alphaValue = 123;
150         Robot robot = new Robot();
151         robot.setAutoDelay(50);
152 
153         SwingUtilities.invokeLater(() -&gt; {
154             color = JColorChooser.showDialog(null, &quot;Change Color&quot;,
155                     new Color(10, 20, 30, alphaValue),
156                     colorTransparencySelectionEnabled);
157         });
158 
159         SwingUtilities.invokeAndWait(() -&gt; {
160             // wait for dialog is shown
161         });
162 
163         robot.waitForIdle();
164 
165         robot.keyPress(KeyEvent.VK_ENTER);
166         robot.keyRelease(KeyEvent.VK_ENTER);
167         robot.waitForIdle();
168 
169         if (colorTransparencySelectionEnabled) {
170             if (color.getAlpha() != alphaValue) {
171                 throw new RuntimeException(&quot;Color alpha has not bee reseted!&quot;);
172             }
173         } else {
174             if (color.getAlpha() != 255) {
175                 throw new RuntimeException(&quot;Color alpha has not bee reseted!&quot;);
176             }
177         }
178     }
179 
180     private static boolean colorHasAlpha(){
181         return colorChooser.getColor().getAlpha() != 255;
182     }
183 
184     private static void createAndShowGUI() {
185         JFrame frame = new JFrame();
186         frame.setSize(700, 500);
187         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
188         colorChooser = new JColorChooser();
189         frame.getContentPane().add(colorChooser);
190         frame.setVisible(true);
191     }
192 
193     private static Component findComponent(Component component, String name) {
194         return findComponent(component,
195                 (comp) -&gt; comp.getClass().getName().contains(name));
196     }
197 
198     private static Component findTextField(Component component, String value) {
199         return findComponent(component, (comp) -&gt; {
200 
201             if (comp instanceof JFormattedTextField) {
202                 JFormattedTextField textField = (JFormattedTextField) comp;
203                 return value.equals(textField.getText());
204             }
205             return false;
206         });
207     }
208 
209     private static Component findComponent(Component component,
210             Predicate&lt;Component&gt; predicate) {
211 
212         if (predicate.test(component)) {
213             return component;
214         }
215 
216         if (component instanceof Container) {
217             Container container = (Container) component;
218             for (int i = 0; i &lt; container.getComponentCount(); i++) {
219                 Component child = findComponent(container.getComponent(i),
220                         predicate);
221                 if (child != null) {
222                     return child;
223                 }
224             }
225         }
226 
227         return null;
228     }
229 }
    </pre>
  </body>
</html>