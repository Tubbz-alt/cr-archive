<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/javax/swing/JColorChooser/Test8051548.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2014, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.awt.Color;
 25 import java.awt.Component;
 26 import java.awt.Container;
 27 import java.awt.Frame;
 28 import java.awt.Robot;
 29 import java.awt.event.KeyEvent;
 30 import java.util.function.Predicate;
 31 import javax.swing.JColorChooser;
 32 import javax.swing.JFormattedTextField;
 33 import javax.swing.JFrame;
 34 import javax.swing.JTabbedPane;
 35 import javax.swing.SwingUtilities;
 36 import javax.swing.colorchooser.AbstractColorChooserPanel;
 37 
 38 /*
 39  * @test
 40  * @key headful
 41  * @bug 8051548
 42  * @summary JColorChooser should have a way to disable transparency controls
 43  * @author Alexandr Scherbatiy
 44  * @run main Test8051548
 45  */
 46 
 47 public class Test8051548 {
 48 
 49     private static final String[][] TABS = {
 50         {&quot;HSV&quot;, &quot;0&quot;},
 51         {&quot;HSL&quot;, &quot;0&quot;},
 52         {&quot;RGB&quot;, &quot;255&quot;},
 53         {&quot;CMYK&quot;, &quot;255&quot;}
 54     };
 55 
 56     private static JColorChooser colorChooser;
 57     private static boolean propertyChangeListenerInvoked;
 58     private static volatile Color color;
<a name="1" id="anc1"></a><span class="line-added"> 59     private static JFrame frame;</span>
 60 
 61     public static void main(String[] args) throws Exception {
<a name="2" id="anc2"></a><span class="line-modified"> 62         try {</span>
<span class="line-modified"> 63             testColorPanels();</span>
<span class="line-modified"> 64             testShowDialog(true);</span>
<span class="line-added"> 65             testShowDialog(false);</span>
<span class="line-added"> 66         } finally {</span>
<span class="line-added"> 67             if(frame != null) SwingUtilities.invokeAndWait(() -&gt; frame.dispose());</span>
<span class="line-added"> 68         }</span>
 69     }
 70 
 71     private static void testColorPanels() throws Exception {
 72         SwingUtilities.invokeAndWait(() -&gt; createAndShowGUI());
 73 
 74         Robot robot = new Robot();
 75         robot.setAutoDelay(50);
 76         robot.waitForIdle();
 77 
 78         for (String[] tabs : TABS) {
 79             final String tab = tabs[0];
 80             final String initialValue = tabs[1];
 81 
 82             SwingUtilities.invokeAndWait(() -&gt; {
 83 
 84                 colorChooser.setColor(new Color(50, 100, 85));
 85                 JTabbedPane tabbedPane =
 86                         (JTabbedPane) findComponent(colorChooser, &quot;JTabbedPane&quot;);
 87                 int index = tabbedPane.indexOfTab(tab);
 88                 tabbedPane.setSelectedIndex(index);
 89 
 90                 AbstractColorChooserPanel colorChooserPanel
 91                         = (AbstractColorChooserPanel) findComponent(
 92                                 tabbedPane.getComponent(index), &quot;ColorChooserPanel&quot;);
 93 
 94                 propertyChangeListenerInvoked = false;
 95                 colorChooserPanel.addPropertyChangeListener((e) -&gt; {
 96                     if (AbstractColorChooserPanel.TRANSPARENCY_ENABLED_PROPERTY.
 97                             equals(e.getPropertyName())) {
 98                         propertyChangeListenerInvoked = true;
 99                         if(!(Boolean)e.getOldValue()){
100                             throw new RuntimeException(&quot;Old color transparency&quot;
101                                     + &quot; selection property should be true!&quot;);
102                         }
103                         if((Boolean)e.getNewValue()){
104                             throw new RuntimeException(&quot;New color transparency&quot;
105                                     + &quot; selection property should be false!&quot;);
106                         }
107                     }
108                 });
109 
110                 if (!colorChooserPanel.isColorTransparencySelectionEnabled()) {
111                     throw new RuntimeException(&quot;Color transparency selection&quot;
112                             + &quot; should be enabled by default&quot;);
113                 }
114 
115                 JFormattedTextField transparencyTextField = (JFormattedTextField)
116                         findTextField(colorChooserPanel, initialValue);
117 
118                 if (!transparencyTextField.isEnabled()) {
119                     throw new RuntimeException(&quot;Transparency controls are&quot;
120                             + &quot; disabled by default!&quot;);
121                 }
122 
123                 transparencyTextField.setValue(50);
124 
125                 if(!colorHasAlpha()){
126                     throw new RuntimeException(&quot;Transparency selection should&quot;
127                             + &quot; be enabled!&quot;);
128                 }
129 
130                 colorChooserPanel.setColorTransparencySelectionEnabled(false);
131 
132                 if (colorChooserPanel.isColorTransparencySelectionEnabled()) {
133                     throw new RuntimeException(&quot;Color transparency selection&quot;
134                             + &quot; should be disabled!&quot;);
135                 }
136 
137                 if(!propertyChangeListenerInvoked){
138                     throw new RuntimeException(&quot;Property change listener is not&quot;
139                             + &quot; invoked!&quot;);
140                 }
141 
142                 if(colorHasAlpha()){
143                     throw new RuntimeException(&quot;Transparency selection should&quot;
144                             + &quot; be disabled!&quot;);
145                 }
146             });
147 
148             robot.waitForIdle();
149         }
150 
151     }
152 
153     static void testShowDialog(boolean colorTransparencySelectionEnabled) throws Exception {
154         int alphaValue = 123;
155         Robot robot = new Robot();
156         robot.setAutoDelay(50);
157 
158         SwingUtilities.invokeLater(() -&gt; {
159             color = JColorChooser.showDialog(null, &quot;Change Color&quot;,
160                     new Color(10, 20, 30, alphaValue),
161                     colorTransparencySelectionEnabled);
162         });
163 
164         SwingUtilities.invokeAndWait(() -&gt; {
165             // wait for dialog is shown
166         });
167 
168         robot.waitForIdle();
169 
170         robot.keyPress(KeyEvent.VK_ENTER);
171         robot.keyRelease(KeyEvent.VK_ENTER);
172         robot.waitForIdle();
173 
174         if (colorTransparencySelectionEnabled) {
175             if (color.getAlpha() != alphaValue) {
176                 throw new RuntimeException(&quot;Color alpha has not bee reseted!&quot;);
177             }
178         } else {
179             if (color.getAlpha() != 255) {
180                 throw new RuntimeException(&quot;Color alpha has not bee reseted!&quot;);
181             }
182         }
183     }
184 
185     private static boolean colorHasAlpha(){
186         return colorChooser.getColor().getAlpha() != 255;
187     }
188 
189     private static void createAndShowGUI() {
<a name="3" id="anc3"></a><span class="line-modified">190         frame = new JFrame();</span>
191         frame.setSize(700, 500);
192         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
193         colorChooser = new JColorChooser();
194         frame.getContentPane().add(colorChooser);
195         frame.setVisible(true);
196     }
197 
198     private static Component findComponent(Component component, String name) {
199         return findComponent(component,
200                 (comp) -&gt; comp.getClass().getName().contains(name));
201     }
202 
203     private static Component findTextField(Component component, String value) {
204         return findComponent(component, (comp) -&gt; {
205 
206             if (comp instanceof JFormattedTextField) {
207                 JFormattedTextField textField = (JFormattedTextField) comp;
208                 return value.equals(textField.getText());
209             }
210             return false;
211         });
212     }
213 
214     private static Component findComponent(Component component,
215             Predicate&lt;Component&gt; predicate) {
216 
217         if (predicate.test(component)) {
218             return component;
219         }
220 
221         if (component instanceof Container) {
222             Container container = (Container) component;
223             for (int i = 0; i &lt; container.getComponentCount(); i++) {
224                 Component child = findComponent(container.getComponent(i),
225                         predicate);
226                 if (child != null) {
227                     return child;
228                 }
229             }
230         }
231 
232         return null;
233     }
234 }
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>