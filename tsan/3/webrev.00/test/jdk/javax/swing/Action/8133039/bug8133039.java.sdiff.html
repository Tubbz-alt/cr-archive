<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/javax/swing/Action/8133039/bug8133039.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../AbstractButton/6711682/bug6711682.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../JButton/4368790/bug4368790.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/javax/swing/Action/8133039/bug8133039.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 28 import javax.swing.Action;
 29 import javax.swing.JComboBox;
 30 import javax.swing.JFrame;
 31 import javax.swing.JLabel;
 32 import javax.swing.KeyStroke;
 33 import javax.swing.SwingUtilities;
 34 import sun.swing.UIAction;
 35 
 36 /**
 37  * @test
 38  * @key headful
 39  * @bug 8133039
 40  * @summary Provide public API to sun.swing.UIAction#isEnabled(Object)
 41  * @modules java.desktop/sun.swing
 42  * @author Alexander Scherbatiy
 43  */
 44 public class bug8133039 {
 45 
 46     private static volatile int ACTION_PERFORMED_CALLS = 0;
 47     private static volatile int ACTION_ACCEPTED_CALLS = 0;

 48 
 49     public static void main(String[] args) throws Exception {
<span class="line-modified"> 50         testActionNotification();</span>
<span class="line-modified"> 51         testPopupAction();</span>




 52     }
 53 
 54     private static void testActionNotification() {
 55 
 56         KeyEvent keyEvent = new KeyEvent(new JLabel(&quot;Test&quot;), 0, 0, 0, 0, &#39;A&#39;);
 57         SenderObject rejectedSenderObject = new SenderObject();
 58         SwingUtilities.notifyAction(new TestAction(false), null, keyEvent,
 59                 rejectedSenderObject, 0);
 60 
 61         if (rejectedSenderObject.accepted) {
 62             throw new RuntimeException(&quot;The sender is incorrectly accepted!&quot;);
 63         }
 64 
 65         if (rejectedSenderObject.performed) {
 66             throw new RuntimeException(&quot;The action is incorrectly performed!&quot;);
 67         }
 68 
 69         SenderObject acceptedSenderObject = new SenderObject();
 70         SwingUtilities.notifyAction(new TestAction(true), null, keyEvent,
 71                 acceptedSenderObject, 0);
</pre>
<hr />
<pre>
 97 
 98         if (ACTION_PERFORMED_CALLS != 1) {
 99             throw new RuntimeException(&quot;Method actionPerformed is not invoked!&quot;);
100         }
101 
102         robot.keyPress(KeyEvent.VK_A);
103         robot.keyRelease(KeyEvent.VK_A);
104         robot.waitForIdle();
105 
106         if (ACTION_ACCEPTED_CALLS != 2) {
107             throw new RuntimeException(&quot;Method accept is not invoked!&quot;);
108         }
109 
110         if (ACTION_PERFORMED_CALLS != 1) {
111             throw new RuntimeException(&quot;Method actionPerformed is invoked twice!&quot;);
112         }
113     }
114 
115     private static void createAndShowGUI() {
116 
<span class="line-modified">117         JFrame frame = new JFrame();</span>
118         frame.setSize(300, 300);
119         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
120 
121         JComboBox&lt;String&gt; comboBox = new JComboBox&lt;&gt;(new String[]{&quot;1&quot;, &quot;2&quot;, &quot;3&quot;});
122 
123         Action showPopupAction = new ShowPopupAction();
124         comboBox.getInputMap().put(KeyStroke.getKeyStroke(&quot;A&quot;), &quot;showPopup&quot;);
125         comboBox.getActionMap().put(&quot;showPopup&quot;, showPopupAction);
126 
127         frame.getContentPane().add(comboBox);
128         frame.setVisible(true);
129     }
130 
131     private static class ShowPopupAction extends UIAction {
132 
133         public ShowPopupAction() {
134             super(&quot;showPopup&quot;);
135         }
136 
137         @Override
</pre>
</td>
<td>
<hr />
<pre>
 28 import javax.swing.Action;
 29 import javax.swing.JComboBox;
 30 import javax.swing.JFrame;
 31 import javax.swing.JLabel;
 32 import javax.swing.KeyStroke;
 33 import javax.swing.SwingUtilities;
 34 import sun.swing.UIAction;
 35 
 36 /**
 37  * @test
 38  * @key headful
 39  * @bug 8133039
 40  * @summary Provide public API to sun.swing.UIAction#isEnabled(Object)
 41  * @modules java.desktop/sun.swing
 42  * @author Alexander Scherbatiy
 43  */
 44 public class bug8133039 {
 45 
 46     private static volatile int ACTION_PERFORMED_CALLS = 0;
 47     private static volatile int ACTION_ACCEPTED_CALLS = 0;
<span class="line-added"> 48     private static JFrame frame;</span>
 49 
 50     public static void main(String[] args) throws Exception {
<span class="line-modified"> 51         try {</span>
<span class="line-modified"> 52             testActionNotification();</span>
<span class="line-added"> 53             testPopupAction();</span>
<span class="line-added"> 54         } finally {</span>
<span class="line-added"> 55             if (frame != null) SwingUtilities.invokeAndWait(() -&gt; frame.dispose());</span>
<span class="line-added"> 56         }</span>
 57     }
 58 
 59     private static void testActionNotification() {
 60 
 61         KeyEvent keyEvent = new KeyEvent(new JLabel(&quot;Test&quot;), 0, 0, 0, 0, &#39;A&#39;);
 62         SenderObject rejectedSenderObject = new SenderObject();
 63         SwingUtilities.notifyAction(new TestAction(false), null, keyEvent,
 64                 rejectedSenderObject, 0);
 65 
 66         if (rejectedSenderObject.accepted) {
 67             throw new RuntimeException(&quot;The sender is incorrectly accepted!&quot;);
 68         }
 69 
 70         if (rejectedSenderObject.performed) {
 71             throw new RuntimeException(&quot;The action is incorrectly performed!&quot;);
 72         }
 73 
 74         SenderObject acceptedSenderObject = new SenderObject();
 75         SwingUtilities.notifyAction(new TestAction(true), null, keyEvent,
 76                 acceptedSenderObject, 0);
</pre>
<hr />
<pre>
102 
103         if (ACTION_PERFORMED_CALLS != 1) {
104             throw new RuntimeException(&quot;Method actionPerformed is not invoked!&quot;);
105         }
106 
107         robot.keyPress(KeyEvent.VK_A);
108         robot.keyRelease(KeyEvent.VK_A);
109         robot.waitForIdle();
110 
111         if (ACTION_ACCEPTED_CALLS != 2) {
112             throw new RuntimeException(&quot;Method accept is not invoked!&quot;);
113         }
114 
115         if (ACTION_PERFORMED_CALLS != 1) {
116             throw new RuntimeException(&quot;Method actionPerformed is invoked twice!&quot;);
117         }
118     }
119 
120     private static void createAndShowGUI() {
121 
<span class="line-modified">122         frame = new JFrame();</span>
123         frame.setSize(300, 300);
124         frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
125 
126         JComboBox&lt;String&gt; comboBox = new JComboBox&lt;&gt;(new String[]{&quot;1&quot;, &quot;2&quot;, &quot;3&quot;});
127 
128         Action showPopupAction = new ShowPopupAction();
129         comboBox.getInputMap().put(KeyStroke.getKeyStroke(&quot;A&quot;), &quot;showPopup&quot;);
130         comboBox.getActionMap().put(&quot;showPopup&quot;, showPopupAction);
131 
132         frame.getContentPane().add(comboBox);
133         frame.setVisible(true);
134     }
135 
136     private static class ShowPopupAction extends UIAction {
137 
138         public ShowPopupAction() {
139             super(&quot;showPopup&quot;);
140         }
141 
142         @Override
</pre>
</td>
</tr>
</table>
<center><a href="../../AbstractButton/6711682/bug6711682.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../JButton/4368790/bug4368790.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>