<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/javax/net/ssl/sanity/ciphersuites/CheckCipherSuites.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 4750141 4895631 8217579 8163326
 27  * @summary Check enabled and supported ciphersuites are correct
 28  * @run main/othervm CheckCipherSuites default
 29  * @run main/othervm CheckCipherSuites limited
 30  */
 31 
 32 import java.util.*;
 33 import java.security.Security;
 34 import javax.net.ssl.*;
 35 
 36 public class CheckCipherSuites {
 37 
 38     // List of enabled cipher suites when the &quot;crypto.policy&quot; security
 39     // property is set to &quot;unlimited&quot; (the default value).
 40     private final static String[] ENABLED_DEFAULT = {
 41         // TLS 1.3 cipher suites
 42         &quot;TLS_AES_256_GCM_SHA384&quot;,
 43         &quot;TLS_AES_128_GCM_SHA256&quot;,
 44         &quot;TLS_CHACHA20_POLY1305_SHA256&quot;,
 45 
 46         // Suite B compliant cipher suites
 47         &quot;TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384&quot;,
 48         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&quot;,
 49 
 50         // Not suite B, but we want it to position the suite early
 51         &quot;TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256&quot;,
 52 
 53         // AES_256(GCM) - ECDHE - forward screcy
 54         &quot;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&quot;,
 55         &quot;TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256&quot;,
 56 
 57         // AES_128(GCM) - ECDHE - forward screcy
 58         &quot;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&quot;,
 59 
 60         // AES_256(GCM) - DHE - forward screcy
 61         &quot;TLS_DHE_RSA_WITH_AES_256_GCM_SHA384&quot;,
 62         &quot;TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256&quot;,
 63         &quot;TLS_DHE_DSS_WITH_AES_256_GCM_SHA384&quot;,
 64 
 65         // AES_128(GCM) - DHE - forward screcy
 66         &quot;TLS_DHE_RSA_WITH_AES_128_GCM_SHA256&quot;,
 67         &quot;TLS_DHE_DSS_WITH_AES_128_GCM_SHA256&quot;,
 68 
 69         // AES_256(CBC) - ECDHE - forward screcy
 70         &quot;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384&quot;,
 71         &quot;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384&quot;,
 72 
 73         // AES_256(CBC) - ECDHE - forward screcy
 74         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256&quot;,
 75         &quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256&quot;,
 76 
 77         // AES_256(CBC) - DHE - forward screcy
 78         &quot;TLS_DHE_RSA_WITH_AES_256_CBC_SHA256&quot;,
 79         &quot;TLS_DHE_DSS_WITH_AES_256_CBC_SHA256&quot;,
 80 
 81         // AES_128(CBC) - DHE - forward screcy
 82         &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;,
 83         &quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA256&quot;,
 84 
 85         // AES_256(GCM) - not forward screcy
 86         &quot;TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384&quot;,
 87         &quot;TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384&quot;,
 88 
 89         // AES_128(GCM) - not forward screcy
 90         &quot;TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256&quot;,
 91         &quot;TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256&quot;,
 92 
 93         // AES_256(CBC) - not forward screcy
 94         &quot;TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384&quot;,
 95         &quot;TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384&quot;,
 96 
 97         // AES_128(CBC) - not forward screcy
 98         &quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256&quot;,
 99         &quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256&quot;,
100 
101         // AES_256(CBC) - ECDHE - using SHA
102         &quot;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA&quot;,
103         &quot;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA&quot;,
104 
105         // AES_128(CBC) - ECDHE - using SHA
106         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA&quot;,
107         &quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&quot;,
108 
109         // AES_256(CBC) - DHE - using SHA
110         &quot;TLS_DHE_RSA_WITH_AES_256_CBC_SHA&quot;,
111         &quot;TLS_DHE_DSS_WITH_AES_256_CBC_SHA&quot;,
112 
113         // AES_128(CBC) - DHE - using SHA
114         &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA&quot;,
115         &quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA&quot;,
116 
117         // AES_256(CBC) - using SHA, not forward screcy
118         &quot;TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA&quot;,
119         &quot;TLS_ECDH_RSA_WITH_AES_256_CBC_SHA&quot;,
120 
121         // AES_128(CBC) - using SHA, not forward screcy
122         &quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA&quot;,
123         &quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA&quot;,
124 
125         // deprecated
126         &quot;TLS_RSA_WITH_AES_256_GCM_SHA384&quot;,
127         &quot;TLS_RSA_WITH_AES_128_GCM_SHA256&quot;,
128         &quot;TLS_RSA_WITH_AES_256_CBC_SHA256&quot;,
129         &quot;TLS_RSA_WITH_AES_128_CBC_SHA256&quot;,
130         &quot;TLS_RSA_WITH_AES_256_CBC_SHA&quot;,
131         &quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;,
132         &quot;TLS_EMPTY_RENEGOTIATION_INFO_SCSV&quot;
133     };
134 
135     // List of enabled cipher suites when the &quot;crypto.policy&quot; security
136     // property is set to &quot;limited&quot;.
137     private final static String[] ENABLED_LIMITED = {
138         &quot;TLS_AES_128_GCM_SHA256&quot;,
139         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&quot;,
140         &quot;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&quot;,
141         &quot;TLS_DHE_RSA_WITH_AES_128_GCM_SHA256&quot;,
142         &quot;TLS_DHE_DSS_WITH_AES_128_GCM_SHA256&quot;,
143         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256&quot;,
144         &quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256&quot;,
145         &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;,
146         &quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA256&quot;,
147         &quot;TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256&quot;,
148         &quot;TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256&quot;,
149         &quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256&quot;,
150         &quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256&quot;,
151         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA&quot;,
152         &quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&quot;,
153         &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA&quot;,
154         &quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA&quot;,
155         &quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA&quot;,
156         &quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA&quot;,
157         &quot;TLS_RSA_WITH_AES_128_GCM_SHA256&quot;,
158         &quot;TLS_RSA_WITH_AES_128_CBC_SHA256&quot;,
159         &quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;,
160         &quot;TLS_EMPTY_RENEGOTIATION_INFO_SCSV&quot;
161     };
162 
163     // List of supported cipher suites when the &quot;crypto.policy&quot; security
164     // property is set to &quot;unlimited&quot; (the default value).
165     private final static String[] SUPPORTED_DEFAULT = {
166         // TLS 1.3 cipher suites
167         &quot;TLS_AES_256_GCM_SHA384&quot;,
168         &quot;TLS_AES_128_GCM_SHA256&quot;,
169         &quot;TLS_CHACHA20_POLY1305_SHA256&quot;,
170 
171         // Suite B compliant cipher suites
172         &quot;TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384&quot;,
173         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&quot;,
174 
175         // Not suite B, but we want it to position the suite early
176         &quot;TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256&quot;,
177 
178         // AES_256(GCM) - ECDHE - forward screcy
179         &quot;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&quot;,
180         &quot;TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256&quot;,
181 
182         // AES_128(GCM) - ECDHE - forward screcy
183         &quot;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&quot;,
184 
185         // AES_256(GCM) - DHE - forward screcy
186         &quot;TLS_DHE_RSA_WITH_AES_256_GCM_SHA384&quot;,
187         &quot;TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256&quot;,
188         &quot;TLS_DHE_DSS_WITH_AES_256_GCM_SHA384&quot;,
189 
190         // AES_128(GCM) - DHE - forward screcy
191         &quot;TLS_DHE_RSA_WITH_AES_128_GCM_SHA256&quot;,
192         &quot;TLS_DHE_DSS_WITH_AES_128_GCM_SHA256&quot;,
193 
194         // AES_256(CBC) - ECDHE - forward screcy
195         &quot;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384&quot;,
196         &quot;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384&quot;,
197 
198         // AES_256(CBC) - ECDHE - forward screcy
199         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256&quot;,
200         &quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256&quot;,
201 
202         // AES_256(CBC) - DHE - forward screcy
203         &quot;TLS_DHE_RSA_WITH_AES_256_CBC_SHA256&quot;,
204         &quot;TLS_DHE_DSS_WITH_AES_256_CBC_SHA256&quot;,
205 
206         // AES_128(CBC) - DHE - forward screcy
207         &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;,
208         &quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA256&quot;,
209 
210         // AES_256(GCM) - not forward screcy
211         &quot;TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384&quot;,
212         &quot;TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384&quot;,
213 
214         // AES_128(GCM) - not forward screcy
215         &quot;TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256&quot;,
216         &quot;TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256&quot;,
217 
218         // AES_256(CBC) - not forward screcy
219         &quot;TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384&quot;,
220         &quot;TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384&quot;,
221 
222         // AES_128(CBC) - not forward screcy
223         &quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256&quot;,
224         &quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256&quot;,
225 
226         // AES_256(CBC) - ECDHE - using SHA
227         &quot;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA&quot;,
228         &quot;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA&quot;,
229 
230         // AES_128(CBC) - ECDHE - using SHA
231         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA&quot;,
232         &quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&quot;,
233 
234         // AES_256(CBC) - DHE - using SHA
235         &quot;TLS_DHE_RSA_WITH_AES_256_CBC_SHA&quot;,
236         &quot;TLS_DHE_DSS_WITH_AES_256_CBC_SHA&quot;,
237 
238         // AES_128(CBC) - DHE - using SHA
239         &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA&quot;,
240         &quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA&quot;,
241 
242         // AES_256(CBC) - using SHA, not forward screcy
243         &quot;TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA&quot;,
244         &quot;TLS_ECDH_RSA_WITH_AES_256_CBC_SHA&quot;,
245 
246         // AES_128(CBC) - using SHA, not forward screcy
247         &quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA&quot;,
248         &quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA&quot;,
249 
250         // deprecated
251         &quot;TLS_RSA_WITH_AES_256_GCM_SHA384&quot;,
252         &quot;TLS_RSA_WITH_AES_128_GCM_SHA256&quot;,
253         &quot;TLS_RSA_WITH_AES_256_CBC_SHA256&quot;,
254         &quot;TLS_RSA_WITH_AES_128_CBC_SHA256&quot;,
255         &quot;TLS_RSA_WITH_AES_256_CBC_SHA&quot;,
256         &quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;,
257         &quot;TLS_EMPTY_RENEGOTIATION_INFO_SCSV&quot;
258     };
259 
260     // List of supported cipher suites when the &quot;crypto.policy&quot; security
261     // property is set to &quot;limited&quot;.
262     private final static String[] SUPPORTED_LIMITED = {
263         &quot;TLS_AES_128_GCM_SHA256&quot;,
264         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&quot;,
265         &quot;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&quot;,
266         &quot;TLS_DHE_RSA_WITH_AES_128_GCM_SHA256&quot;,
267         &quot;TLS_DHE_DSS_WITH_AES_128_GCM_SHA256&quot;,
268         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256&quot;,
269         &quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256&quot;,
270         &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;,
271         &quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA256&quot;,
272         &quot;TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256&quot;,
273         &quot;TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256&quot;,
274         &quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256&quot;,
275         &quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256&quot;,
276         &quot;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA&quot;,
277         &quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&quot;,
278         &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA&quot;,
279         &quot;TLS_DHE_DSS_WITH_AES_128_CBC_SHA&quot;,
280         &quot;TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA&quot;,
281         &quot;TLS_ECDH_RSA_WITH_AES_128_CBC_SHA&quot;,
282         &quot;TLS_RSA_WITH_AES_128_GCM_SHA256&quot;,
283         &quot;TLS_RSA_WITH_AES_128_CBC_SHA256&quot;,
284         &quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;,
285         &quot;TLS_EMPTY_RENEGOTIATION_INFO_SCSV&quot;
286     };
287 
288     private static void showSuites(String[] suites) {
289         if ((suites == null) || (suites.length == 0)) {
290             System.out.println(&quot;&lt;none&gt;&quot;);
291         }
292         for (int i = 0; i &lt; suites.length; i++) {
293             System.out.println(&quot;  &quot; + suites[i]);
294         }
295     }
296 
297     public static void main(String[] args) throws Exception {
298         long start = System.currentTimeMillis();
299 
300         if (args.length != 1) {
301             throw new Exception(&quot;One arg required&quot;);
302         }
303 
304         String[] ENABLED;
305         String[] SUPPORTED;
306         if (args[0].equals(&quot;default&quot;)) {
307             ENABLED = ENABLED_DEFAULT;
308             SUPPORTED = SUPPORTED_DEFAULT;
309         } else if (args[0].equals(&quot;limited&quot;)) {
310             Security.setProperty(&quot;crypto.policy&quot;, &quot;limited&quot;);
311             ENABLED = ENABLED_LIMITED;
312             SUPPORTED = SUPPORTED_LIMITED;
313         } else {
314             throw new Exception(&quot;Illegal argument&quot;);
315         }
316 
317         SSLSocketFactory factory =
318                 (SSLSocketFactory)SSLSocketFactory.getDefault();
319         SSLSocket socket = (SSLSocket)factory.createSocket();
320         String[] enabled = socket.getEnabledCipherSuites();
321 
322         System.out.println(&quot;Default enabled ciphersuites:&quot;);
323         showSuites(enabled);
324 
325         if (Arrays.equals(ENABLED, enabled) == false) {
326             System.out.println(&quot;*** MISMATCH, should be ***&quot;);
327             showSuites(ENABLED);
328             throw new Exception(&quot;Enabled ciphersuite mismatch&quot;);
329         }
330         System.out.println(&quot;OK&quot;);
331         System.out.println();
332 
333         String[] supported = socket.getSupportedCipherSuites();
334         System.out.println(&quot;Supported ciphersuites:&quot;);
335         showSuites(supported);
336 
337         if (Arrays.equals(SUPPORTED, supported) == false) {
338             System.out.println(&quot;*** MISMATCH, should be ***&quot;);
339             showSuites(SUPPORTED);
340             throw new Exception(&quot;Supported ciphersuite mismatch&quot;);
341         }
342         System.out.println(&quot;OK&quot;);
343 
344         long end = System.currentTimeMillis();
345         System.out.println(&quot;Done (&quot; + (end - start) + &quot; ms).&quot;);
346     }
347 }
    </pre>
  </body>
</html>