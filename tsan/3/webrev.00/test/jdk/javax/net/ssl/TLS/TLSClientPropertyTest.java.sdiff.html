<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/javax/net/ssl/TLS/TLSClientPropertyTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../ServerName/SSLSocketExplorer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestJSSEClientDefaultProtocol.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/javax/net/ssl/TLS/TLSClientPropertyTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8049432 8069038</span>
 27  * @summary New tests for TLS property jdk.tls.client.protocols
 28  * @summary javax/net/ssl/TLS/TLSClientPropertyTest.java needs to be
 29  *     updated for JDK-8061210
 30  * @modules java.security.jgss
 31  *          java.security.jgss/sun.security.jgss.krb5
 32  *          java.security.jgss/sun.security.krb5:+open
 33  *          java.security.jgss/sun.security.krb5.internal:+open
 34  *          java.security.jgss/sun.security.krb5.internal.ccache
 35  *          java.security.jgss/sun.security.krb5.internal.crypto
 36  *          java.security.jgss/sun.security.krb5.internal.ktab
 37  *          java.base/sun.security.util
 38  * @run main/othervm TLSClientPropertyTest NoProperty
 39  * @run main/othervm TLSClientPropertyTest SSLv3
 40  * @run main/othervm TLSClientPropertyTest TLSv1
 41  * @run main/othervm TLSClientPropertyTest TLSv11
 42  * @run main/othervm TLSClientPropertyTest TLSv12


 43  * @run main/othervm TLSClientPropertyTest WrongProperty
 44  */
 45 
 46 import java.security.KeyManagementException;
 47 import java.security.NoSuchAlgorithmException;
 48 import java.util.Arrays;
 49 import java.util.List;
 50 import javax.net.ssl.SSLContext;
 51 
 52 /**
 53  * Sets the property jdk.tls.client.protocols to one of this protocols:
 54  * SSLv3,TLSv1,TLSv1.1,TLSv1.2 and TLSV(invalid) or removes this
 55  * property (if any),then validates the default, supported and current
 56  * protocols in the SSLContext.
 57  */
 58 public class TLSClientPropertyTest {
 59     private final String[] expectedSupportedProtos = new String[] {
<span class="line-modified"> 60             &quot;SSLv2Hello&quot;, &quot;SSLv3&quot;, &quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot;</span>
 61     };
 62 
 63     public static void main(String[] args) throws Exception {
 64 
 65         if (args.length &lt; 1) {
 66             throw new RuntimeException(
 67                     &quot;Incorrect arguments,expected arguments: testCase&quot;);
 68         }
 69 
 70         String[] expectedDefaultProtos;
 71         String testCase = args[0];
 72         String contextProtocol;
 73         switch (testCase) {
 74         case &quot;NoProperty&quot;:
 75             if (System.getProperty(&quot;jdk.tls.client.protocols&quot;) != null) {
 76                 System.getProperties().remove(&quot;jdk.tls.client.protocols&quot;);
 77             }
 78             contextProtocol = null;
 79             expectedDefaultProtos = new String[] {
<span class="line-modified"> 80                     &quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot;</span>
 81             };
 82             break;
 83         case &quot;SSLv3&quot;:
 84             contextProtocol = &quot;SSLv3&quot;;
 85             expectedDefaultProtos = new String[] {
 86             };
 87             break;
 88         case &quot;TLSv1&quot;:
 89             contextProtocol = &quot;TLSv1&quot;;
 90             expectedDefaultProtos = new String[] {
 91                     &quot;TLSv1&quot;
 92             };
 93             break;
 94         case &quot;TLSv11&quot;:
 95             contextProtocol = &quot;TLSv1.1&quot;;
 96             expectedDefaultProtos = new String[] {
 97                     &quot;TLSv1&quot;, &quot;TLSv1.1&quot;
 98             };
 99             break;
100         case &quot;TLSv12&quot;:
101             contextProtocol = &quot;TLSv1.2&quot;;
102             expectedDefaultProtos = new String[] {
103                     &quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot;
104             };
105             break;







106         case &quot;WrongProperty&quot;:
107             expectedDefaultProtos = new String[] {};
108             contextProtocol = &quot;TLSV&quot;;
109             break;
110         default:
111             throw new RuntimeException(&quot;test case is wrong&quot;);
112         }
113         if (contextProtocol != null) {
114             System.setProperty(&quot;jdk.tls.client.protocols&quot;, contextProtocol);
115         }
116         try {
117             TLSClientPropertyTest test = new TLSClientPropertyTest();
118             test.test(contextProtocol, expectedDefaultProtos);
119             if (testCase.equals(&quot;WrongProperty&quot;)) {
120                 throw new RuntimeException(
121                         &quot;Test failed: NoSuchAlgorithmException &quot; +
122                         &quot;is expected when input wrong protocol&quot;);
123             } else {
124                 System.out.println(&quot;Test &quot; + contextProtocol + &quot; passed&quot;);
125             }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug 8049432 8069038 8234723</span>
 27  * @summary New tests for TLS property jdk.tls.client.protocols
 28  * @summary javax/net/ssl/TLS/TLSClientPropertyTest.java needs to be
 29  *     updated for JDK-8061210
 30  * @modules java.security.jgss
 31  *          java.security.jgss/sun.security.jgss.krb5
 32  *          java.security.jgss/sun.security.krb5:+open
 33  *          java.security.jgss/sun.security.krb5.internal:+open
 34  *          java.security.jgss/sun.security.krb5.internal.ccache
 35  *          java.security.jgss/sun.security.krb5.internal.crypto
 36  *          java.security.jgss/sun.security.krb5.internal.ktab
 37  *          java.base/sun.security.util
 38  * @run main/othervm TLSClientPropertyTest NoProperty
 39  * @run main/othervm TLSClientPropertyTest SSLv3
 40  * @run main/othervm TLSClientPropertyTest TLSv1
 41  * @run main/othervm TLSClientPropertyTest TLSv11
 42  * @run main/othervm TLSClientPropertyTest TLSv12
<span class="line-added"> 43  * @run main/othervm TLSClientPropertyTest TLSv13</span>
<span class="line-added"> 44  * @run main/othervm TLSClientPropertyTest TLS</span>
 45  * @run main/othervm TLSClientPropertyTest WrongProperty
 46  */
 47 
 48 import java.security.KeyManagementException;
 49 import java.security.NoSuchAlgorithmException;
 50 import java.util.Arrays;
 51 import java.util.List;
 52 import javax.net.ssl.SSLContext;
 53 
 54 /**
 55  * Sets the property jdk.tls.client.protocols to one of this protocols:
 56  * SSLv3,TLSv1,TLSv1.1,TLSv1.2 and TLSV(invalid) or removes this
 57  * property (if any),then validates the default, supported and current
 58  * protocols in the SSLContext.
 59  */
 60 public class TLSClientPropertyTest {
 61     private final String[] expectedSupportedProtos = new String[] {
<span class="line-modified"> 62             &quot;SSLv2Hello&quot;, &quot;SSLv3&quot;, &quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot;, &quot;TLSv1.3&quot;</span>
 63     };
 64 
 65     public static void main(String[] args) throws Exception {
 66 
 67         if (args.length &lt; 1) {
 68             throw new RuntimeException(
 69                     &quot;Incorrect arguments,expected arguments: testCase&quot;);
 70         }
 71 
 72         String[] expectedDefaultProtos;
 73         String testCase = args[0];
 74         String contextProtocol;
 75         switch (testCase) {
 76         case &quot;NoProperty&quot;:
 77             if (System.getProperty(&quot;jdk.tls.client.protocols&quot;) != null) {
 78                 System.getProperties().remove(&quot;jdk.tls.client.protocols&quot;);
 79             }
 80             contextProtocol = null;
 81             expectedDefaultProtos = new String[] {
<span class="line-modified"> 82                     &quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot;, &quot;TLSv1.3&quot;</span>
 83             };
 84             break;
 85         case &quot;SSLv3&quot;:
 86             contextProtocol = &quot;SSLv3&quot;;
 87             expectedDefaultProtos = new String[] {
 88             };
 89             break;
 90         case &quot;TLSv1&quot;:
 91             contextProtocol = &quot;TLSv1&quot;;
 92             expectedDefaultProtos = new String[] {
 93                     &quot;TLSv1&quot;
 94             };
 95             break;
 96         case &quot;TLSv11&quot;:
 97             contextProtocol = &quot;TLSv1.1&quot;;
 98             expectedDefaultProtos = new String[] {
 99                     &quot;TLSv1&quot;, &quot;TLSv1.1&quot;
100             };
101             break;
102         case &quot;TLSv12&quot;:
103             contextProtocol = &quot;TLSv1.2&quot;;
104             expectedDefaultProtos = new String[] {
105                     &quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot;
106             };
107             break;
<span class="line-added">108         case &quot;TLSv13&quot;:</span>
<span class="line-added">109         case &quot;TLS&quot;:</span>
<span class="line-added">110             contextProtocol = &quot;TLSv1.3&quot;;</span>
<span class="line-added">111             expectedDefaultProtos = new String[] {</span>
<span class="line-added">112                     &quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot;, &quot;TLSv1.3&quot;</span>
<span class="line-added">113             };</span>
<span class="line-added">114             break;</span>
115         case &quot;WrongProperty&quot;:
116             expectedDefaultProtos = new String[] {};
117             contextProtocol = &quot;TLSV&quot;;
118             break;
119         default:
120             throw new RuntimeException(&quot;test case is wrong&quot;);
121         }
122         if (contextProtocol != null) {
123             System.setProperty(&quot;jdk.tls.client.protocols&quot;, contextProtocol);
124         }
125         try {
126             TLSClientPropertyTest test = new TLSClientPropertyTest();
127             test.test(contextProtocol, expectedDefaultProtos);
128             if (testCase.equals(&quot;WrongProperty&quot;)) {
129                 throw new RuntimeException(
130                         &quot;Test failed: NoSuchAlgorithmException &quot; +
131                         &quot;is expected when input wrong protocol&quot;);
132             } else {
133                 System.out.println(&quot;Test &quot; + contextProtocol + &quot; passed&quot;);
134             }
</pre>
</td>
</tr>
</table>
<center><a href="../ServerName/SSLSocketExplorer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TestJSSEClientDefaultProtocol.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>