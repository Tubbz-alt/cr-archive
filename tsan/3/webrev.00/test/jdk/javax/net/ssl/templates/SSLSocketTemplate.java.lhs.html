<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/javax/net/ssl/templates/SSLSocketTemplate.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 //
 25 // Please run in othervm mode.  SunJSSE does not support dynamic system
 26 // properties, no way to re-use system properties in samevm/agentvm mode.
 27 //
 28 
 29 /*
 30  * @test
 31  * @bug 8161106 8170329
 32  * @modules jdk.crypto.ec
 33  * @summary Improve SSLSocket test template
 34  * @run main/othervm SSLSocketTemplate
 35  */
 36 
 37 import java.io.ByteArrayInputStream;
 38 import java.io.InputStream;
 39 import java.io.IOException;
 40 import java.io.OutputStream;
 41 import javax.net.ssl.KeyManagerFactory;
 42 import javax.net.ssl.SSLContext;
 43 import javax.net.ssl.SSLServerSocket;
 44 import javax.net.ssl.SSLServerSocketFactory;
 45 import javax.net.ssl.SSLSocket;
 46 import javax.net.ssl.SSLSocketFactory;
 47 import javax.net.ssl.TrustManagerFactory;
<a name="2" id="anc2"></a>
 48 import java.net.InetSocketAddress;
 49 import java.net.SocketTimeoutException;
 50 import java.security.KeyStore;
 51 import java.security.PrivateKey;
 52 import java.security.KeyFactory;
 53 import java.security.cert.Certificate;
 54 import java.security.cert.CertificateFactory;
 55 import java.security.spec.PKCS8EncodedKeySpec;
 56 import java.util.Base64;
 57 
 58 import java.util.concurrent.CountDownLatch;
 59 import java.util.concurrent.TimeUnit;
 60 
 61 /**
 62  * Template to help speed your client/server tests.
 63  *
 64  * Two examples that use this template:
 65  *    test/sun/security/ssl/ServerHandshaker/AnonCipherWithWantClientAuth.java
 66  *    test/sun/net/www/protocol/https/HttpsClient/ServerIdentityTest.java
 67  */
 68 public class SSLSocketTemplate {
 69 
 70     /*
 71      * ==================
 72      * Run the test case.
 73      */
 74     public static void main(String[] args) throws Exception {
 75         (new SSLSocketTemplate()).run();
 76     }
 77 
 78     /*
 79      * Run the test case.
 80      */
 81     public void run() throws Exception {
 82         bootup();
 83     }
 84 
 85     /*
 86      * Define the server side application of the test for the specified socket.
 87      */
 88     protected void runServerApplication(SSLSocket socket) throws Exception {
 89         // here comes the test logic
 90         InputStream sslIS = socket.getInputStream();
 91         OutputStream sslOS = socket.getOutputStream();
 92 
 93         sslIS.read();
 94         sslOS.write(85);
 95         sslOS.flush();
 96     }
 97 
 98     /*
 99      * Define the client side application of the test for the specified socket.
100      * This method is used if the returned value of
101      * isCustomizedClientConnection() is false.
102      *
103      * @param socket may be null is no client socket is generated.
104      *
105      * @see #isCustomizedClientConnection()
106      */
107     protected void runClientApplication(SSLSocket socket) throws Exception {
108         InputStream sslIS = socket.getInputStream();
109         OutputStream sslOS = socket.getOutputStream();
110 
111         sslOS.write(280);
112         sslOS.flush();
113         sslIS.read();
114     }
115 
116     /*
117      * Define the client side application of the test for the specified
118      * server port.  This method is used if the returned value of
119      * isCustomizedClientConnection() is true.
120      *
121      * Note that the client need to connect to the server port by itself
122      * for the actual message exchange.
123      *
124      * @see #isCustomizedClientConnection()
125      */
126     protected void runClientApplication(int serverPort) throws Exception {
127         // blank
128     }
129 
130     /*
131      * Create an instance of SSLContext for client use.
132      */
133     protected SSLContext createClientSSLContext() throws Exception {
<a name="3" id="anc3"></a><span class="line-modified">134         return createSSLContext(trustedCertStrs,</span>
<span class="line-removed">135                 endEntityCertStrs, endEntityPrivateKeys,</span>
<span class="line-removed">136                 endEntityPrivateKeyAlgs,</span>
<span class="line-removed">137                 endEntityPrivateKeyNames,</span>
138                 getClientContextParameters());
139     }
140 
141     /*
142      * Create an instance of SSLContext for server use.
143      */
144     protected SSLContext createServerSSLContext() throws Exception {
<a name="4" id="anc4"></a><span class="line-modified">145         return createSSLContext(trustedCertStrs,</span>
<span class="line-removed">146                 endEntityCertStrs, endEntityPrivateKeys,</span>
<span class="line-removed">147                 endEntityPrivateKeyAlgs,</span>
<span class="line-removed">148                 endEntityPrivateKeyNames,</span>
149                 getServerContextParameters());
150     }
151 
152     /*
153      * The parameters used to configure SSLContext.
154      */
155     protected static final class ContextParameters {
156         final String contextProtocol;
157         final String tmAlgorithm;
158         final String kmAlgorithm;
159 
160         ContextParameters(String contextProtocol,
161                 String tmAlgorithm, String kmAlgorithm) {
162 
163             this.contextProtocol = contextProtocol;
164             this.tmAlgorithm = tmAlgorithm;
165             this.kmAlgorithm = kmAlgorithm;
166         }
167     }
168 
169     /*
170      * Get the client side parameters of SSLContext.
171      */
172     protected ContextParameters getClientContextParameters() {
173         return new ContextParameters(&quot;TLS&quot;, &quot;PKIX&quot;, &quot;NewSunX509&quot;);
174     }
175 
176     /*
177      * Get the server side parameters of SSLContext.
178      */
179     protected ContextParameters getServerContextParameters() {
180         return new ContextParameters(&quot;TLS&quot;, &quot;PKIX&quot;, &quot;NewSunX509&quot;);
181     }
182 
183     /*
184      * Does the client side use customized connection other than
185      * explicit Socket.connect(), for example, URL.openConnection()?
186      */
187     protected boolean isCustomizedClientConnection() {
188         return false;
189     }
190 
<a name="5" id="anc5"></a>





191     /*
192      * Configure the server side socket.
193      */
194     protected void configureServerSocket(SSLServerSocket socket) {
<a name="6" id="anc6"></a><span class="line-removed">195 </span>
196     }
197 
198     /*
199      * =============================================
200      * Define the client and server side operations.
201      *
202      * If the client or server is doing some kind of object creation
203      * that the other side depends on, and that thread prematurely
204      * exits, you may experience a hang.  The test harness will
205      * terminate all hung threads after its timeout has expired,
206      * currently 3 minutes by default, but you might try to be
207      * smart about it....
208      */
209 
210     /*
211      * Is the server ready to serve?
212      */
213     private final CountDownLatch serverCondition = new CountDownLatch(1);
214 
215     /*
216      * Is the client ready to handshake?
217      */
218     private final CountDownLatch clientCondition = new CountDownLatch(1);
219 
220     /*
221      * What&#39;s the server port?  Use any free port by default
222      */
223     protected volatile int serverPort = 0;
224 
<a name="7" id="anc7"></a>




225     /*
226      * Define the server side of the test.
227      */
228     protected void doServerSide() throws Exception {
229         // kick start the server side service
230         SSLContext context = createServerSSLContext();
231         SSLServerSocketFactory sslssf = context.getServerSocketFactory();
<a name="8" id="anc8"></a><span class="line-modified">232         SSLServerSocket sslServerSocket =</span>
<span class="line-modified">233                 (SSLServerSocket)sslssf.createServerSocket(serverPort);</span>





234         configureServerSocket(sslServerSocket);
235         serverPort = sslServerSocket.getLocalPort();
236 
237         // Signal the client, the server is ready to accept connection.
238         serverCondition.countDown();
239 
240         // Try to accept a connection in 30 seconds.
241         SSLSocket sslSocket;
242         try {
243             sslServerSocket.setSoTimeout(30000);
244             sslSocket = (SSLSocket)sslServerSocket.accept();
245         } catch (SocketTimeoutException ste) {
246             // Ignore the test case if no connection within 30 seconds.
247             System.out.println(
248                 &quot;No incoming client connection in 30 seconds. &quot; +
249                 &quot;Ignore in server side.&quot;);
250             return;
251         } finally {
252             sslServerSocket.close();
253         }
254 
255         // handle the connection
256         try {
257             // Is it the expected client connection?
258             //
259             // Naughty test cases or third party routines may try to
260             // connection to this server port unintentionally.  In
261             // order to mitigate the impact of unexpected client
262             // connections and avoid intermittent failure, it should
263             // be checked that the accepted connection is really linked
264             // to the expected client.
265             boolean clientIsReady =
266                     clientCondition.await(30L, TimeUnit.SECONDS);
267 
268             if (clientIsReady) {
269                 // Run the application in server side.
270                 runServerApplication(sslSocket);
271             } else {    // Otherwise, ignore
272                 // We don&#39;t actually care about plain socket connections
273                 // for TLS communication testing generally.  Just ignore
274                 // the test if the accepted connection is not linked to
275                 // the expected client or the client connection timeout
276                 // in 30 seconds.
277                 System.out.println(
278                         &quot;The client is not the expected one or timeout. &quot; +
279                         &quot;Ignore in server side.&quot;);
280             }
281         } finally {
282             sslSocket.close();
283         }
284     }
285 
286     /*
287      * Define the client side of the test.
288      */
289     protected void doClientSide() throws Exception {
290 
291         // Wait for server to get started.
292         //
293         // The server side takes care of the issue if the server cannot
294         // get started in 90 seconds.  The client side would just ignore
295         // the test case if the serer is not ready.
296         boolean serverIsReady =
297                 serverCondition.await(90L, TimeUnit.SECONDS);
298         if (!serverIsReady) {
299             System.out.println(
300                     &quot;The server is not ready yet in 90 seconds. &quot; +
301                     &quot;Ignore in client side.&quot;);
302             return;
303         }
304 
305         if (isCustomizedClientConnection()) {
306             // Signal the server, the client is ready to communicate.
307             clientCondition.countDown();
308 
309             // Run the application in client side.
310             runClientApplication(serverPort);
311 
312             return;
313         }
314 
315         SSLContext context = createClientSSLContext();
316         SSLSocketFactory sslsf = context.getSocketFactory();
317 
318         try (SSLSocket sslSocket = (SSLSocket)sslsf.createSocket()) {
319             try {
<a name="9" id="anc9"></a><span class="line-modified">320                 sslSocket.connect(</span>
<span class="line-modified">321                         new InetSocketAddress(&quot;localhost&quot;, serverPort), 15000);</span>




322             } catch (IOException ioe) {
323                 // The server side may be impacted by naughty test cases or
324                 // third party routines, and cannot accept connections.
325                 //
326                 // Just ignore the test if the connection cannot be
327                 // established.
328                 System.out.println(
329                         &quot;Cannot make a connection in 15 seconds. &quot; +
330                         &quot;Ignore in client side.&quot;);
331                 return;
332             }
333 
334             // OK, here the client and server get connected.
335 
336             // Signal the server, the client is ready to communicate.
337             clientCondition.countDown();
338 
339             // There is still a chance in theory that the server thread may
340             // wait client-ready timeout and then quit.  The chance should
341             // be really rare so we don&#39;t consider it until it becomes a
342             // real problem.
343 
344             // Run the application in client side.
345             runClientApplication(sslSocket);
346         }
347     }
348 
349     /*
350      * =============================================
351      * Stuffs to customize the SSLContext instances.
352      */
353 
354     /*
355      * =======================================
356      * Certificates and keys used in the test.
357      */
358     // Trusted certificates.
<a name="10" id="anc10"></a><span class="line-modified">359     private final static String[] trustedCertStrs = {</span>
<span class="line-modified">360         // SHA256withECDSA, curve prime256v1</span>
<span class="line-modified">361         // Validity</span>
<span class="line-modified">362         //     Not Before: May 22 07:18:16 2018 GMT</span>
<span class="line-removed">363         //     Not After : May 17 07:18:16 2038 GMT</span>
<span class="line-removed">364         // Subject Key Identifier:</span>
<span class="line-removed">365         //     60:CF:BD:73:FF:FA:1A:30:D2:A4:EC:D3:49:71:46:EF:1A:35:A0:86</span>
<span class="line-removed">366         &quot;-----BEGIN CERTIFICATE-----\n&quot; +</span>
<span class="line-removed">367         &quot;MIIBvjCCAWOgAwIBAgIJAIvFG6GbTroCMAoGCCqGSM49BAMCMDsxCzAJBgNVBAYT\n&quot; +</span>
<span class="line-removed">368         &quot;AlVTMQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2VyaXZj\n&quot; +</span>
<span class="line-removed">369         &quot;ZTAeFw0xODA1MjIwNzE4MTZaFw0zODA1MTcwNzE4MTZaMDsxCzAJBgNVBAYTAlVT\n&quot; +</span>
<span class="line-removed">370         &quot;MQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2VyaXZjZTBZ\n&quot; +</span>
<span class="line-removed">371         &quot;MBMGByqGSM49AgEGCCqGSM49AwEHA0IABBz1WeVb6gM2mh85z3QlvaB/l11b5h0v\n&quot; +</span>
<span class="line-removed">372         &quot;LIzmkC3DKlVukZT+ltH2Eq1oEkpXuf7QmbM0ibrUgtjsWH3mULfmcWmjUDBOMB0G\n&quot; +</span>
<span class="line-removed">373         &quot;A1UdDgQWBBRgz71z//oaMNKk7NNJcUbvGjWghjAfBgNVHSMEGDAWgBRgz71z//oa\n&quot; +</span>
<span class="line-removed">374         &quot;MNKk7NNJcUbvGjWghjAMBgNVHRMEBTADAQH/MAoGCCqGSM49BAMCA0kAMEYCIQCG\n&quot; +</span>
<span class="line-removed">375         &quot;6wluh1r2/T6L31mZXRKf9JxeSf9pIzoLj+8xQeUChQIhAJ09wAi1kV8yePLh2FD9\n&quot; +</span>
<span class="line-removed">376         &quot;2YEHlSQUAbwwqCDEVB5KxaqP\n&quot; +</span>
<span class="line-removed">377         &quot;-----END CERTIFICATE-----&quot;,</span>
<span class="line-removed">378         // -----BEGIN PRIVATE KEY-----</span>
<span class="line-removed">379         // MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQg/HcHdoLJCdq3haVd</span>
<span class="line-removed">380         // XZTSKP00YzM3xX97l98vGL/RI1KhRANCAAQc9VnlW+oDNpofOc90Jb2gf5ddW+Yd</span>
<span class="line-removed">381         // LyyM5pAtwypVbpGU/pbR9hKtaBJKV7n+0JmzNIm61ILY7Fh95lC35nFp</span>
<span class="line-removed">382         // -----END PRIVATE KEY-----</span>
<span class="line-removed">383 </span>
<span class="line-removed">384         // SHA256withRSA, 2048 bits</span>
<span class="line-removed">385         // Validity</span>
<span class="line-removed">386         //     Not Before: May 22 07:18:16 2018 GMT</span>
<span class="line-removed">387         //     Not After : May 17 07:18:16 2038 GMT</span>
<span class="line-removed">388         // Subject Key Identifier:</span>
<span class="line-removed">389         //     0D:DD:93:C9:FE:4B:BD:35:B7:E8:99:78:90:FB:DB:5A:3D:DB:15:4C</span>
<span class="line-removed">390         &quot;-----BEGIN CERTIFICATE-----\n&quot; +</span>
<span class="line-removed">391         &quot;MIIDSTCCAjGgAwIBAgIJAI4ZF3iy8zG+MA0GCSqGSIb3DQEBCwUAMDsxCzAJBgNV\n&quot; +</span>
<span class="line-removed">392         &quot;BAYTAlVTMQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2Vy\n&quot; +</span>
<span class="line-removed">393         &quot;aXZjZTAeFw0xODA1MjIwNzE4MTZaFw0zODA1MTcwNzE4MTZaMDsxCzAJBgNVBAYT\n&quot; +</span>
<span class="line-removed">394         &quot;AlVTMQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2VyaXZj\n&quot; +</span>
<span class="line-removed">395         &quot;ZTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALpMcY7aWieXDEM1/YJf\n&quot; +</span>
<span class="line-removed">396         &quot;JW27b4nRIFZyEYhEloyGsKTuQiiQjc8cqRZFNXe2vwziDB4IyTEl0Hjl5QF6ZaQE\n&quot; +</span>
<span class="line-removed">397         &quot;huPzzwvQm1pv64KrRXrmj3FisQK8B5OWLty9xp6xDqsaMRoyObLK+oIb20T5fSlE\n&quot; +</span>
<span class="line-removed">398         &quot;evmo1vYjnh8CX0Yzx5Gr5ye6YSEHQvYOWEws8ad17OlyToR2KMeC8w4qo6rs59pW\n&quot; +</span>
<span class="line-removed">399         &quot;g7Mxn9vo22ImDzrtAbTbXbCias3xlE0Bp0h5luyf+5U4UgksoL9B9r2oP4GrLNEV\n&quot; +</span>
<span class="line-removed">400         &quot;oJk57t8lwaR0upiv3CnS8LcJELpegZub5ggqLY8ZPYFQPjlK6IzLOm6rXPgZiZ3m\n&quot; +</span>
<span class="line-removed">401         &quot;RL0CAwEAAaNQME4wHQYDVR0OBBYEFA3dk8n+S701t+iZeJD721o92xVMMB8GA1Ud\n&quot; +</span>
<span class="line-removed">402         &quot;IwQYMBaAFA3dk8n+S701t+iZeJD721o92xVMMAwGA1UdEwQFMAMBAf8wDQYJKoZI\n&quot; +</span>
<span class="line-removed">403         &quot;hvcNAQELBQADggEBAJTRC3rKUUhVH07/1+stUungSYgpM08dY4utJq0BDk36BbmO\n&quot; +</span>
<span class="line-removed">404         &quot;0AnLDMbkwFdHEoqF6hQIfpm7SQTmXk0Fss6Eejm8ynYr6+EXiRAsaXOGOBCzF918\n&quot; +</span>
<span class="line-removed">405         &quot;/RuKOzqABfgSU4UBKECLM5bMfQTL60qx+HdbdVIpnikHZOFfmjCDVxoHsGyXc1LW\n&quot; +</span>
<span class="line-removed">406         &quot;Jhkht8IGOgc4PMGvyzTtRFjz01kvrVQZ75aN2E0GQv6dCxaEY0i3ypSzjUWAKqDh\n&quot; +</span>
<span class="line-removed">407         &quot;3e2OLwUSvumcdaxyCdZAOUsN6pDBQ+8VRG7KxnlRlY1SMEk46QgQYLbPDe/+W/yH\n&quot; +</span>
<span class="line-removed">408         &quot;ca4PejicPeh+9xRAwoTpiE2gulfT7Lm+fVM7Ruc=\n&quot; +</span>
<span class="line-removed">409         &quot;-----END CERTIFICATE-----&quot;,</span>
<span class="line-removed">410         // -----BEGIN PRIVATE KEY-----</span>
<span class="line-removed">411         // MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQC6THGO2lonlwxD</span>
<span class="line-removed">412         // Nf2CXyVtu2+J0SBWchGIRJaMhrCk7kIokI3PHKkWRTV3tr8M4gweCMkxJdB45eUB</span>
<span class="line-removed">413         // emWkBIbj888L0Jtab+uCq0V65o9xYrECvAeTli7cvcaesQ6rGjEaMjmyyvqCG9tE</span>
<span class="line-removed">414         // +X0pRHr5qNb2I54fAl9GM8eRq+cnumEhB0L2DlhMLPGndezpck6EdijHgvMOKqOq</span>
<span class="line-removed">415         // 7OfaVoOzMZ/b6NtiJg867QG0212womrN8ZRNAadIeZbsn/uVOFIJLKC/Qfa9qD+B</span>
<span class="line-removed">416         // qyzRFaCZOe7fJcGkdLqYr9wp0vC3CRC6XoGbm+YIKi2PGT2BUD45SuiMyzpuq1z4</span>
<span class="line-removed">417         // GYmd5kS9AgMBAAECggEAFHSoU2MuWwJ+2jJnb5U66t2V1bAcuOE1g5zkWvG/G5z9</span>
<span class="line-removed">418         // rq6Qo5kmB8f5ovdx6tw3MGUOklLwnRXBG3RxDJ1iokz3AvkY1clMNsDPlDsUrQKF</span>
<span class="line-removed">419         // JSO4QUBQTPSZhnsyfR8XHSU+qJ8Y+ohMfzpVv95BEoCzebtXdVgxVegBlcEmVHo2</span>
<span class="line-removed">420         // kMmkRN+bYNsr8eb2r+b0EpyumS39ZgKYh09+cFb78y3T6IFMGcVJTP6nlGBFkmA/</span>
<span class="line-removed">421         // 25pYeCF2tSki08qtMJZQAvKfw0Kviibk7ZxRbJqmc7B1yfnOEHP6ftjuvKl2+RP/</span>
<span class="line-removed">422         // +5P5f8CfIP6gtA0LwSzAqQX/hfIKrGV5j0pCqrD0kQKBgQDeNR6Xi4sXVq79lihO</span>
<span class="line-removed">423         // a1bSeV7r8yoQrS8x951uO+ox+UIZ1MsAULadl7zB/P0er92p198I9M/0Jth3KBuS</span>
<span class="line-removed">424         // zj45mucvpiiGvmQlMKMEfNq4nN7WHOu55kufPswQB2mR4J3xmwI+4fM/nl1zc82h</span>
<span class="line-removed">425         // De8JSazRldJXNhfx0RGFPmgzbwKBgQDWoVXrXLbCAn41oVnWB8vwY9wjt92ztDqJ</span>
<span class="line-removed">426         // HMFA/SUohjePep9UDq6ooHyAf/Lz6oE5NgeVpPfTDkgvrCFVKnaWdwALbYoKXT2W</span>
<span class="line-removed">427         // 9FlyJox6eQzrtHAacj3HJooXWuXlphKSizntfxj3LtMR9BmrmRJOfK+SxNOVJzW2</span>
<span class="line-removed">428         // +MowT20EkwKBgHmpB8jdZBgxI7o//m2BI5Y1UZ1KE5vx1kc7VXzHXSBjYqeV9FeF</span>
<span class="line-removed">429         // 2ZZLP9POWh/1Fh4pzTmwIDODGT2UPhSQy0zq3O0fwkyT7WzXRknsuiwd53u/dejg</span>
<span class="line-removed">430         // iEL2NPAJvulZ2+AuiHo5Z99LK8tMeidV46xoJDDUIMgTG+UQHNGhK5gNAoGAZn/S</span>
<span class="line-removed">431         // Cn7SgMC0CWSvBHnguULXZO9wH1wZAFYNLL44OqwuaIUFBh2k578M9kkke7woTmwx</span>
<span class="line-removed">432         // HxQTjmWpr6qimIuY6q6WBN8hJ2Xz/d1fwhYKzIp20zHuv5KDUlJjbFfqpsuy3u1C</span>
<span class="line-removed">433         // kts5zwI7pr1ObRbDGVyOdKcu7HI3QtR5qqyjwaUCgYABo7Wq6oHva/9V34+G3Goh</span>
<span class="line-removed">434         // 63bYGUnRw2l5BD11yhQv8XzGGZFqZVincD8gltNThB0Dc/BI+qu3ky4YdgdZJZ7K</span>
<span class="line-removed">435         // z51GQGtaHEbrHS5caV79yQ8QGY5mUVH3E+VXSxuIqb6pZq2DH4sTAEFHyncddmOH</span>
<span class="line-removed">436         // zoXBInYwRG9KE/Bw5elhUw==</span>
<span class="line-removed">437         // -----END PRIVATE KEY-----</span>
<span class="line-removed">438 </span>
<span class="line-removed">439         // SHA256withDSA, 2048 bits</span>
<span class="line-removed">440         // Validity</span>
<span class="line-removed">441         //     Not Before: May 22 07:18:18 2018 GMT</span>
<span class="line-removed">442         //     Not After : May 17 07:18:18 2038 GMT</span>
<span class="line-removed">443         // Subject Key Identifier:</span>
<span class="line-removed">444         //     76:66:9E:F7:3B:DD:45:E5:3B:D9:72:3C:3F:F0:54:39:86:31:26:53</span>
<span class="line-removed">445         &quot;-----BEGIN CERTIFICATE-----\n&quot; +</span>
<span class="line-removed">446         &quot;MIIErjCCBFSgAwIBAgIJAOktYLNCbr02MAsGCWCGSAFlAwQDAjA7MQswCQYDVQQG\n&quot; +</span>
<span class="line-removed">447         &quot;EwJVUzENMAsGA1UECgwESmF2YTEdMBsGA1UECwwUU3VuSlNTRSBUZXN0IFNlcml2\n&quot; +</span>
<span class="line-removed">448         &quot;Y2UwHhcNMTgwNTIyMDcxODE4WhcNMzgwNTE3MDcxODE4WjA7MQswCQYDVQQGEwJV\n&quot; +</span>
<span class="line-removed">449         &quot;UzENMAsGA1UECgwESmF2YTEdMBsGA1UECwwUU3VuSlNTRSBUZXN0IFNlcml2Y2Uw\n&quot; +</span>
<span class="line-removed">450         &quot;ggNHMIICOQYHKoZIzjgEATCCAiwCggEBAO5GyPhSm0ze3LSu+gicdULLj05iOfTL\n&quot; +</span>
<span class="line-removed">451         &quot;UvZQ29sYz41zmqrLBQbdKiHqgJu2Re9sgTb5suLNjF047TOLPnU3jhPtWm2X8Xzi\n&quot; +</span>
<span class="line-removed">452         &quot;VGIcHym/Q/MeZxStt/88seqroI3WOKzIML2GcrishT+lcGrtH36Tf1+ue2Snn3PS\n&quot; +</span>
<span class="line-removed">453         &quot;WyxygNqPjllP5uUjYmFLvAf4QLMldkd/D2VxcwsHjB8y5iUZsXezc/LEhRZS/02m\n&quot; +</span>
<span class="line-removed">454         &quot;ivqlRw3AMkq/OVe/ZtxFWsP0nsfxEGdZuaUFpppGfixxFvymrB3+J51cTt+pZBDq\n&quot; +</span>
<span class="line-removed">455         &quot;D2y0DYfc+88iCs4jwHTfcDIpLb538HBjBj2rEgtQESQmB0ooD/+wsPsCIQC1bYch\n&quot; +</span>
<span class="line-removed">456         &quot;gElNtDYL3FgpLgNSUYp7gIWv9ehaC7LO2z7biQKCAQBitvFOnDkUja8NAF7lDpOV\n&quot; +</span>
<span class="line-removed">457         &quot;b5ipQ8SicBLW3kQamxhyuyxgZyy/PojZ/oPorkqW/T/A0rhnG6MssEpAtdiwVB+c\n&quot; +</span>
<span class="line-removed">458         &quot;rBYGo3bcwmExJhdOJ6dYuKFppPWhCwKMHs9npK+lqBMl8l5j58xlcFeC7ZfGf8GY\n&quot; +</span>
<span class="line-removed">459         &quot;GkhFW0c44vEQhMMbac6ZTTP4mw+1t7xJfmDMlLEyIpTXaAAk8uoVLWzQWnR40sHi\n&quot; +</span>
<span class="line-removed">460         &quot;ybvS0u3JxQkb7/y8tOOZu8qlz/YOS7lQ6UxUGX27Ce1E0+agfPphetoRAlS1cezq\n&quot; +</span>
<span class="line-removed">461         &quot;Wa7r64Ga0nkj1kwkcRqjgTiJx0NwnUXr78VAXFhVF95+O3lfqhvdtEGtkhDGPg7N\n&quot; +</span>
<span class="line-removed">462         &quot;A4IBBgACggEBAMmSHQK0w2i+iqUjOPzn0yNEZrzepLlLeQ1tqtn0xnlv5vBAeefD\n&quot; +</span>
<span class="line-removed">463         &quot;Pm9dd3tZOjufVWP7hhEz8xPobb1CS4e3vuQiv5UBfhdPL3f3l9T7JMAKPH6C9Vve\n&quot; +</span>
<span class="line-removed">464         &quot;OQXE5eGqbjsySbcmseHoYUt1WCSnSda1opX8zchX04e7DhGfE2/L9flpYEoSt8lI\n&quot; +</span>
<span class="line-removed">465         &quot;vMNjgOwvKdW3yvPt1/eBBHYNFG5gWPv/Q5KoyCtHS03uqGm4rNc/wZTIEEfd66C+\n&quot; +</span>
<span class="line-removed">466         &quot;QRaUltjOaHmtwOdDHaNqwhYZSVOip+Mo+TfyzHFREcdHLapo7ZXqbdYkRGxRR3d+\n&quot; +</span>
<span class="line-removed">467         &quot;3DfHaraJO0OKoYlPkr3JMvM/MSGR9AnZOcejUDBOMB0GA1UdDgQWBBR2Zp73O91F\n&quot; +</span>
<span class="line-removed">468         &quot;5TvZcjw/8FQ5hjEmUzAfBgNVHSMEGDAWgBR2Zp73O91F5TvZcjw/8FQ5hjEmUzAM\n&quot; +</span>
<span class="line-removed">469         &quot;BgNVHRMEBTADAQH/MAsGCWCGSAFlAwQDAgNHADBEAiBzriYE41M2y9Hy5ppkL0Qn\n&quot; +</span>
<span class="line-removed">470         &quot;dIlNc8JhXT/PHW7GDtViagIgMko8Qoj9gDGPK3+O9E8DC3wGiiF9CObM4LN387ok\n&quot; +</span>
<span class="line-removed">471         &quot;J+g=\n&quot; +</span>
<span class="line-removed">472         &quot;-----END CERTIFICATE-----&quot;</span>
<span class="line-removed">473         // -----BEGIN PRIVATE KEY-----</span>
<span class="line-removed">474         // MIICZQIBADCCAjkGByqGSM44BAEwggIsAoIBAQDuRsj4UptM3ty0rvoInHVCy49O</span>
<span class="line-removed">475         // Yjn0y1L2UNvbGM+Nc5qqywUG3Soh6oCbtkXvbIE2+bLizYxdOO0ziz51N44T7Vpt</span>
<span class="line-removed">476         // l/F84lRiHB8pv0PzHmcUrbf/PLHqq6CN1jisyDC9hnK4rIU/pXBq7R9+k39frntk</span>
<span class="line-removed">477         // p59z0lsscoDaj45ZT+blI2JhS7wH+ECzJXZHfw9lcXMLB4wfMuYlGbF3s3PyxIUW</span>
<span class="line-removed">478         // Uv9Npor6pUcNwDJKvzlXv2bcRVrD9J7H8RBnWbmlBaaaRn4scRb8pqwd/iedXE7f</span>
<span class="line-removed">479         // qWQQ6g9stA2H3PvPIgrOI8B033AyKS2+d/BwYwY9qxILUBEkJgdKKA//sLD7AiEA</span>
<span class="line-removed">480         // tW2HIYBJTbQ2C9xYKS4DUlGKe4CFr/XoWguyzts+24kCggEAYrbxTpw5FI2vDQBe</span>
<span class="line-removed">481         // 5Q6TlW+YqUPEonAS1t5EGpsYcrssYGcsvz6I2f6D6K5Klv0/wNK4ZxujLLBKQLXY</span>
<span class="line-removed">482         // sFQfnKwWBqN23MJhMSYXTienWLihaaT1oQsCjB7PZ6SvpagTJfJeY+fMZXBXgu2X</span>
<span class="line-removed">483         // xn/BmBpIRVtHOOLxEITDG2nOmU0z+JsPtbe8SX5gzJSxMiKU12gAJPLqFS1s0Fp0</span>
<span class="line-removed">484         // eNLB4sm70tLtycUJG+/8vLTjmbvKpc/2Dku5UOlMVBl9uwntRNPmoHz6YXraEQJU</span>
<span class="line-removed">485         // tXHs6lmu6+uBmtJ5I9ZMJHEao4E4icdDcJ1F6+/FQFxYVRfefjt5X6ob3bRBrZIQ</span>
<span class="line-removed">486         // xj4OzQQjAiEAsceWOM8do4etxp2zgnoNXV8PUUyqWhz1+0srcKV7FR4=</span>
<span class="line-removed">487         // -----END PRIVATE KEY-----</span>
<span class="line-removed">488         };</span>
489 
490     // End entity certificate.
<a name="11" id="anc11"></a><span class="line-modified">491     private final static String[] endEntityCertStrs = {</span>
<span class="line-modified">492         // SHA256withECDSA, curve prime256v1</span>
<span class="line-modified">493         // Validity</span>
<span class="line-modified">494         //     Not Before: May 22 07:18:16 2018 GMT</span>
<span class="line-modified">495         //     Not After : May 17 07:18:16 2038 GMT</span>
<span class="line-removed">496         // Authority Key Identifier:</span>
<span class="line-removed">497         //     60:CF:BD:73:FF:FA:1A:30:D2:A4:EC:D3:49:71:46:EF:1A:35:A0:86</span>
<span class="line-removed">498         &quot;-----BEGIN CERTIFICATE-----\n&quot; +</span>
<span class="line-removed">499         &quot;MIIBqjCCAVCgAwIBAgIJAPLY8qZjgNRAMAoGCCqGSM49BAMCMDsxCzAJBgNVBAYT\n&quot; +</span>
<span class="line-removed">500         &quot;AlVTMQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2VyaXZj\n&quot; +</span>
<span class="line-removed">501         &quot;ZTAeFw0xODA1MjIwNzE4MTZaFw0zODA1MTcwNzE4MTZaMFUxCzAJBgNVBAYTAlVT\n&quot; +</span>
<span class="line-removed">502         &quot;MQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2VyaXZjZTEY\n&quot; +</span>
<span class="line-removed">503         &quot;MBYGA1UEAwwPUmVncmVzc2lvbiBUZXN0MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcD\n&quot; +</span>
<span class="line-removed">504         &quot;QgAEb+9n05qfXnfHUb0xtQJNS4JeSi6IjOfW5NqchvKnfJey9VkJzR7QHLuOESdf\n&quot; +</span>
<span class="line-removed">505         &quot;xlR7q8YIWgih3iWLGfB+wxHiOqMjMCEwHwYDVR0jBBgwFoAUYM+9c//6GjDSpOzT\n&quot; +</span>
<span class="line-removed">506         &quot;SXFG7xo1oIYwCgYIKoZIzj0EAwIDSAAwRQIgWpRegWXMheiD3qFdd8kMdrkLxRbq\n&quot; +</span>
<span class="line-removed">507         &quot;1zj8nQMEwFTUjjQCIQDRIrAjZX+YXHN9b0SoWWLPUq0HmiFIi8RwMnO//wJIGQ==\n&quot; +</span>
<span class="line-removed">508         &quot;-----END CERTIFICATE-----&quot;,</span>
<span class="line-removed">509 </span>
<span class="line-removed">510         // SHA256withRSA, 2048 bits</span>
<span class="line-removed">511         // Validity</span>
<span class="line-removed">512         //     Not Before: May 22 07:18:16 2018 GMT</span>
<span class="line-removed">513         //     Not After : May 17 07:18:16 2038 GMT</span>
<span class="line-removed">514         // Authority Key Identifier:</span>
<span class="line-removed">515         //     0D:DD:93:C9:FE:4B:BD:35:B7:E8:99:78:90:FB:DB:5A:3D:DB:15:4C</span>
<span class="line-removed">516         &quot;-----BEGIN CERTIFICATE-----\n&quot; +</span>
<span class="line-removed">517         &quot;MIIDNjCCAh6gAwIBAgIJAO2+yPcFryUTMA0GCSqGSIb3DQEBCwUAMDsxCzAJBgNV\n&quot; +</span>
<span class="line-removed">518         &quot;BAYTAlVTMQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2Vy\n&quot; +</span>
<span class="line-removed">519         &quot;aXZjZTAeFw0xODA1MjIwNzE4MTZaFw0zODA1MTcwNzE4MTZaMFUxCzAJBgNVBAYT\n&quot; +</span>
<span class="line-removed">520         &quot;AlVTMQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2VyaXZj\n&quot; +</span>
<span class="line-removed">521         &quot;ZTEYMBYGA1UEAwwPUmVncmVzc2lvbiBUZXN0MIIBIjANBgkqhkiG9w0BAQEFAAOC\n&quot; +</span>
<span class="line-removed">522         &quot;AQ8AMIIBCgKCAQEAszfBobWfZIp8AgC6PiWDDavP65mSvgCXUGxACbxVNAfkLhNR\n&quot; +</span>
<span class="line-removed">523         &quot;QOsHriRB3X1Q3nvO9PetC6wKlvE9jlnDDj7D+1j1r1CHO7ms1fq8rfcQYdkanDtu\n&quot; +</span>
<span class="line-removed">524         &quot;4AlHo8v+SSWX16MIXFRYDj2VVHmyPtgbltcg4zGAuwT746FdLI94uXjJjq1IOr/v\n&quot; +</span>
<span class="line-removed">525         &quot;0VIlwE5ORWH5Xc+5Tj+oFWK0E4a4GHDgtKKhn2m72hN56/GkPKGkguP5NRS1qYYV\n&quot; +</span>
<span class="line-removed">526         &quot;/EFkdyQMOV8J1M7HaicSft4OL6eKjTrgo93+kHk+tv0Dc6cpVBnalX3TorG8QI6B\n&quot; +</span>
<span class="line-removed">527         &quot;cHj1XQd78oAlAC+/jF4pc0mwi0un49kdK9gRfQIDAQABoyMwITAfBgNVHSMEGDAW\n&quot; +</span>
<span class="line-removed">528         &quot;gBQN3ZPJ/ku9NbfomXiQ+9taPdsVTDANBgkqhkiG9w0BAQsFAAOCAQEApXS0nKwm\n&quot; +</span>
<span class="line-removed">529         &quot;Kp8gpmO2yG1rpd1+2wBABiMU4JZaTqmma24DQ3RzyS+V2TeRb29dl5oTUEm98uc0\n&quot; +</span>
<span class="line-removed">530         &quot;GPZvhK8z5RFr4YE17dc04nI/VaNDCw4y1NALXGs+AHkjoPjLyGbWpi1S+gfq2sNB\n&quot; +</span>
<span class="line-removed">531         &quot;Ekkjp6COb/cb9yiFXOGVls7UOIjnVZVd0r7KaPFjZhYh82/f4PA/A1SnIKd1+nfH\n&quot; +</span>
<span class="line-removed">532         &quot;2yk7mSJNC7Z3qIVDL8MM/jBVwiC3uNe5GPB2uwhd7k5LGAVN3j4HQQGB0Sz+VC1h\n&quot; +</span>
<span class="line-removed">533         &quot;92oi6xDa+YBva2fvHuCd8P50DDjxmp9CemC7rnZ5j8egj88w14X44Xjb/Fd/ApG9\n&quot; +</span>
<span class="line-removed">534         &quot;e57NnbT7KM+Grw==\n&quot; +</span>
<span class="line-removed">535         &quot;-----END CERTIFICATE-----&quot;,</span>
<span class="line-removed">536 </span>
<span class="line-removed">537         // SHA256withRSA, curv prime256v1</span>
<span class="line-removed">538         // Validity</span>
<span class="line-removed">539         //     Not Before: May 22 07:18:16 2018 GMT</span>
<span class="line-removed">540         //     Not After : May 21 07:18:16 2028 GMT</span>
<span class="line-removed">541         // Authority Key Identifier:</span>
<span class="line-removed">542         //     0D:DD:93:C9:FE:4B:BD:35:B7:E8:99:78:90:FB:DB:5A:3D:DB:15:4C</span>
<span class="line-removed">543         &quot;-----BEGIN CERTIFICATE-----\n&quot; +</span>
<span class="line-removed">544         &quot;MIICazCCAVOgAwIBAgIJAO2+yPcFryUUMA0GCSqGSIb3DQEBCwUAMDsxCzAJBgNV\n&quot; +</span>
<span class="line-removed">545         &quot;BAYTAlVTMQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2Vy\n&quot; +</span>
<span class="line-removed">546         &quot;aXZjZTAeFw0xODA1MjIwNzE4MTZaFw0yODA1MjEwNzE4MTZaMFUxCzAJBgNVBAYT\n&quot; +</span>
<span class="line-removed">547         &quot;AlVTMQ0wCwYDVQQKDARKYXZhMR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2VyaXZj\n&quot; +</span>
<span class="line-removed">548         &quot;ZTEYMBYGA1UEAwwPUmVncmVzc2lvbiBUZXN0MFkwEwYHKoZIzj0CAQYIKoZIzj0D\n&quot; +</span>
<span class="line-removed">549         &quot;AQcDQgAE59MERNTlVZ1eeps8Z3Oue5ZkgQdPtD+WIE6tj3PbIKpxGPDxvfNP959A\n&quot; +</span>
<span class="line-removed">550         &quot;yQjEK/ehWQVrCMmNoEkIzY+IIBgB06MjMCEwHwYDVR0jBBgwFoAUDd2Tyf5LvTW3\n&quot; +</span>
<span class="line-removed">551         &quot;6Jl4kPvbWj3bFUwwDQYJKoZIhvcNAQELBQADggEBAFOTVEqs70ykhZiIdrEsF1Ra\n&quot; +</span>
<span class="line-removed">552         &quot;I3B2rLvwXZk52uSltk2/bzVvewA577ZCoxQ1pL7ynkisPfBN1uVYtHjM1VA3RC+4\n&quot; +</span>
<span class="line-removed">553         &quot;+TAK78dnI7otYjWoHp5rvs4l6c/IbOspS290IlNuDUxMErEm5wxIwj+Aukx/1y68\n&quot; +</span>
<span class="line-removed">554         &quot;hOyCvHBLMY2c1LskH1MMBbDuS1aI+lnGpToi+MoYObxGcV458vxuT8+wwV8Fkpvd\n&quot; +</span>
<span class="line-removed">555         &quot;ll8IIFmeNPRv+1E+lXbES6CSNCVaZ/lFhPgdgYKleN7sfspiz50DG4dqafuEAaX5\n&quot; +</span>
<span class="line-removed">556         &quot;xaK1NWXJxTRz0ROH/IUziyuDW6jphrlgit4+3NCzp6vP9hAJQ8Vhcj0n15BKHIQ=\n&quot; +</span>
<span class="line-removed">557         &quot;-----END CERTIFICATE-----&quot;,</span>
<span class="line-removed">558 </span>
<span class="line-removed">559         // SHA256withDSA, 2048 bits</span>
<span class="line-removed">560         // Validity</span>
<span class="line-removed">561         //     Not Before: May 22 07:18:20 2018 GMT</span>
<span class="line-removed">562         //     Not After : May 17 07:18:20 2038 GMT</span>
<span class="line-removed">563         // Authority Key Identifier:</span>
<span class="line-removed">564         //     76:66:9E:F7:3B:DD:45:E5:3B:D9:72:3C:3F:F0:54:39:86:31:26:53</span>
<span class="line-removed">565         &quot;-----BEGIN CERTIFICATE-----\n&quot; +</span>
<span class="line-removed">566         &quot;MIIEnDCCBEGgAwIBAgIJAP/jh1qVhNVjMAsGCWCGSAFlAwQDAjA7MQswCQYDVQQG\n&quot; +</span>
<span class="line-removed">567         &quot;EwJVUzENMAsGA1UECgwESmF2YTEdMBsGA1UECwwUU3VuSlNTRSBUZXN0IFNlcml2\n&quot; +</span>
<span class="line-removed">568         &quot;Y2UwHhcNMTgwNTIyMDcxODIwWhcNMzgwNTE3MDcxODIwWjBVMQswCQYDVQQGEwJV\n&quot; +</span>
<span class="line-removed">569         &quot;UzENMAsGA1UECgwESmF2YTEdMBsGA1UECwwUU3VuSlNTRSBUZXN0IFNlcml2Y2Ux\n&quot; +</span>
<span class="line-removed">570         &quot;GDAWBgNVBAMMD1JlZ3Jlc3Npb24gVGVzdDCCA0cwggI6BgcqhkjOOAQBMIICLQKC\n&quot; +</span>
<span class="line-removed">571         &quot;AQEAmlavgoJrMcjqWRVcDE2dmWAPREgnzQvneEDef68cprDzjSwvOs5QeFyx75ib\n&quot; +</span>
<span class="line-removed">572         &quot;ado1e6jO/rW1prCGWHDD1oA/Tn4Pk3vu0nUxzvl1qATc+aJbpUU5Op0bvp6LbCsQ\n&quot; +</span>
<span class="line-removed">573         &quot;QslV9FeRh7Eb7bP6gpc/kHCBzEgC1VCK7prccXWy+t6SMOHbND3h+UbckfSaUuaV\n&quot; +</span>
<span class="line-removed">574         &quot;sVJNTD1D6GElfRj4Nmz1BGPfSYvKorwNZEU3gXwFgtDoAcGx7tcyClLpDHfqRfw/\n&quot; +</span>
<span class="line-removed">575         &quot;7yiqLyeiP7D4hl5lMNouJWDlAdMFp0FMgS3s9VDFinIcr6VtBWMTG7+4+czHAB+3\n&quot; +</span>
<span class="line-removed">576         &quot;fvrwlqNzhBn3uFHrekN/w8fNxwIhAJo7Sae1za7IMW0Q6hE5B4b+s2B/FaKPoA4E\n&quot; +</span>
<span class="line-removed">577         &quot;jtZu13B9AoIBAQCOZqLMKfvqZWUgT0PQ3QjR7dAFdd06I9Y3+TOQzZk1+j+vw/6E\n&quot; +</span>
<span class="line-removed">578         &quot;X4vFItX4gihb/u5Q9CdmpwhVGi7bvo+7+/IKeTgoQ6f5+PSug7SrWWUQ5sPwaZui\n&quot; +</span>
<span class="line-removed">579         &quot;zXZJ5nTeZDucFc2yFx0wgnjbPwiUxZklOT7xGiOMtzOTa2koCz5KuIBL+/wPKKxm\n&quot; +</span>
<span class="line-removed">580         &quot;ypo9VoY9xfbdU6LMXZv/lpD5XTM9rYHr/vUTNkukvV6Hpm0YMEWhVZKUJiqCqTqG\n&quot; +</span>
<span class="line-removed">581         &quot;XHaleOxSw6uQWB/+TznifcC7gB48UOQjCqOKf5VuwQneJLhlhU/jhRV3xtr+hLZa\n&quot; +</span>
<span class="line-removed">582         &quot;hW1wYhVi8cjLDrZFKlgEQqhB4crnJU0mJY+tA4IBBQACggEAID0ezl00/X8mv7eb\n&quot; +</span>
<span class="line-removed">583         &quot;bzovum1+DEEP7FM57k6HZEG2N3ve4CW+0m9Cd+cWPz8wkZ+M0j/Eqa6F0IdbkXEc\n&quot; +</span>
<span class="line-removed">584         &quot;Q7CuzvUyJ57xQ3L/WCgXsiS+Bh8O4Mz7GwW22CGmHqafbVv+hKBfr8MkskO6GJUt\n&quot; +</span>
<span class="line-removed">585         &quot;SUF/CVLzB4gMIvZMH26tBP2xK+i7FeEK9kT+nGdzQSZBAhFYpEVCBplHZO24/OYq\n&quot; +</span>
<span class="line-removed">586         &quot;1DNoU327nUuXIhmsfA8N0PjiWbIZIjTPwBGr9H0LpATI7DIDNcvRRvtROP+pBU9y\n&quot; +</span>
<span class="line-removed">587         &quot;fuykPkptg9C0rCM9t06bukpOSaEz/2VIQdLE8fHYFA6pHZ6CIc2+5cfvMgTPhcjz\n&quot; +</span>
<span class="line-removed">588         &quot;W2jCt6MjMCEwHwYDVR0jBBgwFoAUdmae9zvdReU72XI8P/BUOYYxJlMwCwYJYIZI\n&quot; +</span>
<span class="line-removed">589         &quot;AWUDBAMCA0gAMEUCIQCeI5fN08b9BpOaHdc3zQNGjp24FOL/RxlBLeBAorswJgIg\n&quot; +</span>
<span class="line-removed">590         &quot;JEZ8DhYxQy1O7mmZ2UIT7op6epWMB4dENjs0qWPmcKo=\n&quot; +</span>
<span class="line-removed">591         &quot;-----END CERTIFICATE-----&quot;</span>
<span class="line-removed">592         };</span>
<span class="line-removed">593 </span>
<span class="line-removed">594     // Private key in the format of PKCS#8.</span>
<span class="line-removed">595     private final static String[] endEntityPrivateKeys = {</span>
<span class="line-removed">596         //</span>
<span class="line-removed">597         // EC private key related to cert endEntityCertStrs[0].</span>
<span class="line-removed">598         //</span>
<span class="line-removed">599         &quot;MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgn5K03bpTLjEtFQRa\n&quot; +</span>
<span class="line-removed">600         &quot;JUtx22gtmGEvvSUSQdimhGthdtihRANCAARv72fTmp9ed8dRvTG1Ak1Lgl5KLoiM\n&quot; +</span>
<span class="line-removed">601         &quot;59bk2pyG8qd8l7L1WQnNHtAcu44RJ1/GVHurxghaCKHeJYsZ8H7DEeI6&quot;,</span>
<span class="line-removed">602 </span>
<span class="line-removed">603         //</span>
<span class="line-removed">604         // RSA private key related to cert endEntityCertStrs[1].</span>
<span class="line-removed">605         //</span>
<span class="line-removed">606         &quot;MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCzN8GhtZ9kinwC\n&quot; +</span>
<span class="line-removed">607         &quot;ALo+JYMNq8/rmZK+AJdQbEAJvFU0B+QuE1FA6weuJEHdfVDee870960LrAqW8T2O\n&quot; +</span>
<span class="line-removed">608         &quot;WcMOPsP7WPWvUIc7uazV+ryt9xBh2RqcO27gCUejy/5JJZfXowhcVFgOPZVUebI+\n&quot; +</span>
<span class="line-removed">609         &quot;2BuW1yDjMYC7BPvjoV0sj3i5eMmOrUg6v+/RUiXATk5FYfldz7lOP6gVYrQThrgY\n&quot; +</span>
<span class="line-removed">610         &quot;cOC0oqGfabvaE3nr8aQ8oaSC4/k1FLWphhX8QWR3JAw5XwnUzsdqJxJ+3g4vp4qN\n&quot; +</span>
<span class="line-removed">611         &quot;OuCj3f6QeT62/QNzpylUGdqVfdOisbxAjoFwePVdB3vygCUAL7+MXilzSbCLS6fj\n&quot; +</span>
<span class="line-removed">612         &quot;2R0r2BF9AgMBAAECggEASIkPkMCuw4WdTT44IwERus3IOIYOs2IP3BgEDyyvm4B6\n&quot; +</span>
<span class="line-removed">613         &quot;JP/iihDWKfA4zEl1Gqcni1RXMHswSglXra682J4kui02Ov+vzEeJIY37Ibn2YnP5\n&quot; +</span>
<span class="line-removed">614         &quot;ZjRT2s9GtI/S2o4hl8A/mQb2IMViFC+xKehTukhV4j5d6NPKk0XzLR7gcMjnYxwn\n&quot; +</span>
<span class="line-removed">615         &quot;l21fS6D2oM1xRG/di7sL+uLF8EXLRzfiWDNi12uQv4nwtxPKvuKhH6yzHt7YqMH0\n&quot; +</span>
<span class="line-removed">616         &quot;46pmDKDaxV4w1JdycjCb6NrCJOYZygoQobuZqOQ30UZoZsPJrtovkncFr1e+lNcO\n&quot; +</span>
<span class="line-removed">617         &quot;+aWDfOLCtTH046dEQh5oCShyXMybNlry/QHsOtHOwQKBgQDh2iIjs+FPpQy7Z3EX\n&quot; +</span>
<span class="line-removed">618         &quot;DGEvHYqPjrYO9an2KSRr1m9gzRlWYxKY46WmPKwjMerYtra0GP+TBHrgxsfO8tD2\n&quot; +</span>
<span class="line-removed">619         &quot;wUAII6sd1qup0a/Sutgf2JxVilLykd0+Ge4/Cs51tCdJ8EqDV2B6WhTewOY2EGvg\n&quot; +</span>
<span class="line-removed">620         &quot;JiKYkeNwgRX/9M9CFSAMAk0hUQKBgQDLJAartL3DoGUPjYtpJnfgGM23yAGl6G5r\n&quot; +</span>
<span class="line-removed">621         &quot;NSXDn80BiYIC1p0bG3N0xm3yAjqOtJAUj9jZbvDNbCe3GJfLARMr23legX4tRrgZ\n&quot; +</span>
<span class="line-removed">622         &quot;nEdKnAFKAKL01oM+A5/lHdkwaZI9yyv+hgSVdYzUjB8rDmzeVQzo1BT7vXypt2yV\n&quot; +</span>
<span class="line-removed">623         &quot;6O1OnUpCbQKBgA/0rzDChopv6KRcvHqaX0tK1P0rYeVQqb9ATNhpf9jg5Idb3HZ8\n&quot; +</span>
<span class="line-removed">624         &quot;rrk91BNwdVz2G5ZBpdynFl9G69rNAMJOCM4KZw5mmh4XOEq09Ivba8AHU7DbaTv3\n&quot; +</span>
<span class="line-removed">625         &quot;7QL7KnbaUWRB26HHzIMYVh0el6T+KADf8NXCiMTr+bfpfbL3dxoiF3zhAoGAbCJD\n&quot; +</span>
<span class="line-removed">626         &quot;Qse1dBs/cKYCHfkSOsI5T6kx52Tw0jS6Y4X/FOBjyqr/elyEexbdk8PH9Ar931Qr\n&quot; +</span>
<span class="line-removed">627         &quot;NKMvn8oA4iA/PRrXX7M2yi3YQrWwbkGYWYjtzrzEAdzmg+5eARKAeJrZ8/bg9l3U\n&quot; +</span>
<span class="line-removed">628         &quot;ttKaItJsDPlizn8rngy3FsJpR9aSAMK6/+wOiYkCgYEA1tZkI1rD1W9NYZtbI9BE\n&quot; +</span>
<span class="line-removed">629         &quot;qlJVFi2PBOJMKNuWdouPX3HLQ72GJSQff2BFzLTELjweVVJ0SvY4IipzpQOHQOBy\n&quot; +</span>
<span class="line-removed">630         &quot;5qh/p6izXJZh3IHtvwVBjHoEVplg1b2+I5e3jDCfqnwcQw82dW5SxOJMg1h/BD0I\n&quot; +</span>
<span class="line-removed">631         &quot;qAL3go42DYeYhu/WnECMeis=&quot;,</span>
<span class="line-removed">632 </span>
<span class="line-removed">633         //</span>
<span class="line-removed">634         // EC private key related to cert endEntityCertStrs[2].</span>
<span class="line-removed">635         //</span>
<span class="line-removed">636         &quot;MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgGVc7hICpmp91jbYe\n&quot; +</span>
<span class="line-removed">637         &quot;nrr8nYHD37RZP3VENY+szuA7WjuhRANCAATn0wRE1OVVnV56mzxnc657lmSBB0+0\n&quot; +</span>
<span class="line-removed">638         &quot;P5YgTq2Pc9sgqnEY8PG980/3n0DJCMQr96FZBWsIyY2gSQjNj4ggGAHT&quot;,</span>
<span class="line-removed">639 </span>
<span class="line-removed">640         //</span>
<span class="line-removed">641         // DSA private key related to cert endEntityCertStrs[3].</span>
<span class="line-removed">642         //</span>
<span class="line-removed">643         &quot;MIICZQIBADCCAjoGByqGSM44BAEwggItAoIBAQCaVq+CgmsxyOpZFVwMTZ2ZYA9E\n&quot; +</span>
<span class="line-removed">644         &quot;SCfNC+d4QN5/rxymsPONLC86zlB4XLHvmJtp2jV7qM7+tbWmsIZYcMPWgD9Ofg+T\n&quot; +</span>
<span class="line-removed">645         &quot;e+7SdTHO+XWoBNz5olulRTk6nRu+notsKxBCyVX0V5GHsRvts/qClz+QcIHMSALV\n&quot; +</span>
<span class="line-removed">646         &quot;UIrumtxxdbL63pIw4ds0PeH5RtyR9JpS5pWxUk1MPUPoYSV9GPg2bPUEY99Ji8qi\n&quot; +</span>
<span class="line-removed">647         &quot;vA1kRTeBfAWC0OgBwbHu1zIKUukMd+pF/D/vKKovJ6I/sPiGXmUw2i4lYOUB0wWn\n&quot; +</span>
<span class="line-removed">648         &quot;QUyBLez1UMWKchyvpW0FYxMbv7j5zMcAH7d++vCWo3OEGfe4Uet6Q3/Dx83HAiEA\n&quot; +</span>
<span class="line-removed">649         &quot;mjtJp7XNrsgxbRDqETkHhv6zYH8Voo+gDgSO1m7XcH0CggEBAI5moswp++plZSBP\n&quot; +</span>
<span class="line-removed">650         &quot;Q9DdCNHt0AV13Toj1jf5M5DNmTX6P6/D/oRfi8Ui1fiCKFv+7lD0J2anCFUaLtu+\n&quot; +</span>
<span class="line-removed">651         &quot;j7v78gp5OChDp/n49K6DtKtZZRDmw/Bpm6LNdknmdN5kO5wVzbIXHTCCeNs/CJTF\n&quot; +</span>
<span class="line-removed">652         &quot;mSU5PvEaI4y3M5NraSgLPkq4gEv7/A8orGbKmj1Whj3F9t1Tosxdm/+WkPldMz2t\n&quot; +</span>
<span class="line-removed">653         &quot;gev+9RM2S6S9XoembRgwRaFVkpQmKoKpOoZcdqV47FLDq5BYH/5POeJ9wLuAHjxQ\n&quot; +</span>
<span class="line-removed">654         &quot;5CMKo4p/lW7BCd4kuGWFT+OFFXfG2v6EtlqFbXBiFWLxyMsOtkUqWARCqEHhyucl\n&quot; +</span>
<span class="line-removed">655         &quot;TSYlj60EIgIgLfA75+8KcKxdN8mr6gzGjQe7jPFGG42Ejhd7Q2F4wuw=&quot;</span>
<span class="line-removed">656         };</span>
<span class="line-removed">657 </span>
<span class="line-removed">658     // Private key algorithm of endEntityPrivateKeys.</span>
<span class="line-removed">659     private final static String[] endEntityPrivateKeyAlgs = {</span>
<span class="line-removed">660         &quot;EC&quot;,</span>
<span class="line-removed">661         &quot;RSA&quot;,</span>
<span class="line-removed">662         &quot;EC&quot;,</span>
<span class="line-removed">663         &quot;DSA&quot;,</span>
<span class="line-removed">664         };</span>
<span class="line-removed">665 </span>
<span class="line-removed">666     // Private key names of endEntityPrivateKeys.</span>
<span class="line-removed">667     private final static String[] endEntityPrivateKeyNames = {</span>
<span class="line-removed">668         &quot;ecdsa&quot;,</span>
<span class="line-removed">669         &quot;rsa&quot;,</span>
<span class="line-removed">670         &quot;ec-rsa&quot;,</span>
<span class="line-removed">671         &quot;dsa&quot;,</span>
<span class="line-removed">672         };</span>
673 
674     /*
675      * Create an instance of SSLContext with the specified trust/key materials.
676      */
<a name="12" id="anc12"></a><span class="line-modified">677     private SSLContext createSSLContext(</span>
<span class="line-modified">678             String[] trustedMaterials,</span>
<span class="line-modified">679             String[] keyMaterialCerts,</span>
<span class="line-removed">680             String[] keyMaterialKeys,</span>
<span class="line-removed">681             String[] keyMaterialKeyAlgs,</span>
<span class="line-removed">682             String[] keyMaterialKeyNames,</span>
683             ContextParameters params) throws Exception {
684 
685         KeyStore ts = null;     // trust store
686         KeyStore ks = null;     // key store
687         char passphrase[] = &quot;passphrase&quot;.toCharArray();
688 
689         // Generate certificate from cert string.
690         CertificateFactory cf = CertificateFactory.getInstance(&quot;X.509&quot;);
691 
692         // Import the trused certs.
693         ByteArrayInputStream is;
<a name="13" id="anc13"></a><span class="line-modified">694         if (trustedMaterials != null &amp;&amp; trustedMaterials.length != 0) {</span>
695             ts = KeyStore.getInstance(&quot;JKS&quot;);
696             ts.load(null, null);
697 
<a name="14" id="anc14"></a><span class="line-modified">698             Certificate[] trustedCert =</span>
<span class="line-modified">699                     new Certificate[trustedMaterials.length];</span>
<span class="line-modified">700             for (int i = 0; i &lt; trustedMaterials.length; i++) {</span>
<span class="line-removed">701                 String trustedCertStr = trustedMaterials[i];</span>
<span class="line-removed">702 </span>
<span class="line-removed">703                 is = new ByteArrayInputStream(trustedCertStr.getBytes());</span>
704                 try {
705                     trustedCert[i] = cf.generateCertificate(is);
706                 } finally {
707                     is.close();
708                 }
709 
<a name="15" id="anc15"></a><span class="line-modified">710                 ts.setCertificateEntry(&quot;trusted-cert-&quot; + i, trustedCert[i]);</span>

711             }
712         }
713 
714         // Import the key materials.
<a name="16" id="anc16"></a><span class="line-modified">715         //</span>
<span class="line-removed">716         // Note that certification pathes bigger than one are not supported yet.</span>
<span class="line-removed">717         boolean hasKeyMaterials =</span>
<span class="line-removed">718             (keyMaterialCerts != null) &amp;&amp; (keyMaterialCerts.length != 0) &amp;&amp;</span>
<span class="line-removed">719             (keyMaterialKeys != null) &amp;&amp; (keyMaterialKeys.length != 0) &amp;&amp;</span>
<span class="line-removed">720             (keyMaterialKeyAlgs != null) &amp;&amp; (keyMaterialKeyAlgs.length != 0) &amp;&amp;</span>
<span class="line-removed">721             (keyMaterialCerts.length == keyMaterialKeys.length) &amp;&amp;</span>
<span class="line-removed">722             (keyMaterialCerts.length == keyMaterialKeyAlgs.length);</span>
<span class="line-removed">723         if (hasKeyMaterials) {</span>
724             ks = KeyStore.getInstance(&quot;JKS&quot;);
725             ks.load(null, null);
726 
<a name="17" id="anc17"></a><span class="line-modified">727             for (int i = 0; i &lt; keyMaterialCerts.length; i++) {</span>
<span class="line-removed">728                 String keyCertStr = keyMaterialCerts[i];</span>
<span class="line-removed">729 </span>
730                 // generate the private key.
731                 PKCS8EncodedKeySpec priKeySpec = new PKCS8EncodedKeySpec(
<a name="18" id="anc18"></a><span class="line-modified">732                     Base64.getMimeDecoder().decode(keyMaterialKeys[i]));</span>
733                 KeyFactory kf =
<a name="19" id="anc19"></a><span class="line-modified">734                     KeyFactory.getInstance(keyMaterialKeyAlgs[i]);</span>

735                 PrivateKey priKey = kf.generatePrivate(priKeySpec);
736 
737                 // generate certificate chain
<a name="20" id="anc20"></a><span class="line-modified">738                 is = new ByteArrayInputStream(keyCertStr.getBytes());</span>

739                 Certificate keyCert = null;
740                 try {
741                     keyCert = cf.generateCertificate(is);
742                 } finally {
743                     is.close();
744                 }
745 
746                 Certificate[] chain = new Certificate[] { keyCert };
747 
748                 // import the key entry.
<a name="21" id="anc21"></a><span class="line-modified">749                 ks.setKeyEntry(&quot;cert-&quot; + keyMaterialKeyNames[i],</span>
750                         priKey, passphrase, chain);
751             }
752         }
753 
754         // Create an SSLContext object.
755         TrustManagerFactory tmf =
756                 TrustManagerFactory.getInstance(params.tmAlgorithm);
757         tmf.init(ts);
758 
759         SSLContext context = SSLContext.getInstance(params.contextProtocol);
<a name="22" id="anc22"></a><span class="line-modified">760         if (hasKeyMaterials &amp;&amp; ks != null) {</span>
761             KeyManagerFactory kmf =
762                     KeyManagerFactory.getInstance(params.kmAlgorithm);
763             kmf.init(ks, passphrase);
764 
765             context.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);
766         } else {
767             context.init(null, tmf.getTrustManagers(), null);
768         }
769 
770         return context;
771     }
772 
773     /*
774      * =================================================
775      * Stuffs to boot up the client-server mode testing.
776      */
777     private Thread clientThread = null;
778     private Thread serverThread = null;
779     private volatile Exception serverException = null;
780     private volatile Exception clientException = null;
781 
782     /*
783      * Should we run the client or server in a separate thread?
784      * Both sides can throw exceptions, but do you have a preference
785      * as to which side should be the main thread.
786      */
787     private static final boolean separateServerThread = false;
788 
789     /*
790      * Boot up the testing, used to drive remainder of the test.
791      */
792     private void bootup() throws Exception {
793         Exception startException = null;
794         try {
795             if (separateServerThread) {
796                 startServer(true);
797                 startClient(false);
798             } else {
799                 startClient(true);
800                 startServer(false);
801             }
802         } catch (Exception e) {
803             startException = e;
804         }
805 
806         /*
807          * Wait for other side to close down.
808          */
809         if (separateServerThread) {
810             if (serverThread != null) {
811                 serverThread.join();
812             }
813         } else {
814             if (clientThread != null) {
815                 clientThread.join();
816             }
817         }
818 
819         /*
820          * When we get here, the test is pretty much over.
821          * Which side threw the error?
822          */
823         Exception local;
824         Exception remote;
825 
826         if (separateServerThread) {
827             remote = serverException;
828             local = clientException;
829         } else {
830             remote = clientException;
831             local = serverException;
832         }
833 
834         Exception exception = null;
835 
836         /*
837          * Check various exception conditions.
838          */
839         if ((local != null) &amp;&amp; (remote != null)) {
840             // If both failed, return the curthread&#39;s exception.
841             local.initCause(remote);
842             exception = local;
843         } else if (local != null) {
844             exception = local;
845         } else if (remote != null) {
846             exception = remote;
847         } else if (startException != null) {
848             exception = startException;
849         }
850 
851         /*
852          * If there was an exception *AND* a startException,
853          * output it.
854          */
855         if (exception != null) {
856             if (exception != startException &amp;&amp; startException != null) {
857                 exception.addSuppressed(startException);
858             }
859             throw exception;
860         }
861 
862         // Fall-through: no exception to throw!
863     }
864 
865     private void startServer(boolean newThread) throws Exception {
866         if (newThread) {
867             serverThread = new Thread() {
868                 @Override
869                 public void run() {
870                     try {
871                         doServerSide();
872                     } catch (Exception e) {
873                         /*
874                          * Our server thread just died.
875                          *
876                          * Release the client, if not active already...
877                          */
878                         logException(&quot;Server died&quot;, e);
879                         serverException = e;
880                     }
881                 }
882             };
883             serverThread.start();
884         } else {
885             try {
886                 doServerSide();
887             } catch (Exception e) {
888                 logException(&quot;Server failed&quot;, e);
889                 serverException = e;
890             }
891         }
892     }
893 
894     private void startClient(boolean newThread) throws Exception {
895         if (newThread) {
896             clientThread = new Thread() {
897                 @Override
898                 public void run() {
899                     try {
900                         doClientSide();
901                     } catch (Exception e) {
902                         /*
903                          * Our client thread just died.
904                          */
905                         logException(&quot;Client died&quot;, e);
906                         clientException = e;
907                     }
908                 }
909             };
910             clientThread.start();
911         } else {
912             try {
913                 doClientSide();
914             } catch (Exception e) {
915                 logException(&quot;Client failed&quot;, e);
916                 clientException = e;
917             }
918         }
919     }
920 
921     private synchronized void logException(String prefix, Throwable cause) {
922         System.out.println(prefix + &quot;: &quot; + cause);
923         cause.printStackTrace(System.out);
924     }
<a name="23" id="anc23"></a>
























































































































































































































































































































































































































925 }
<a name="24" id="anc24"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="24" type="hidden" />
</body>
</html>