<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/tools/jar/multiRelease/Basic.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../modularJar/Basic.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="MRTestBase.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/jar/multiRelease/Basic.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2016, 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2016, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,11 +21,11 @@</span>
   * questions.
   */
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  # @bug 8186087 8196748</span>
<span class="udiff-line-modified-added">+  # @bug 8186087 8196748 8212807</span>
   * @library /test/lib
   * @modules java.base/jdk.internal.misc
   *          jdk.compiler
   *          jdk.jartool
   * @build jdk.test.lib.util.FileUtils
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -37,32 +37,35 @@</span>
   *        jdk.test.lib.process.*
   *        MRTestBase
   * @run testng Basic
   */
  
<span class="udiff-line-removed">- import static org.testng.Assert.*;</span>
<span class="udiff-line-removed">- </span>
  import jdk.test.lib.util.FileUtils;
  import org.testng.annotations.*;
  
  import java.io.File;
<span class="udiff-line-modified-removed">- import java.nio.file.*;</span>
<span class="udiff-line-modified-removed">- import java.util.*;</span>
<span class="udiff-line-modified-added">+ import java.nio.file.Files;</span>
<span class="udiff-line-modified-added">+ import java.nio.file.Path;</span>
<span class="udiff-line-added">+ import java.nio.file.Paths;</span>
<span class="udiff-line-added">+ import java.util.List;</span>
<span class="udiff-line-added">+ import java.util.Map;</span>
  import java.util.jar.JarFile;
  import java.util.zip.ZipFile;
  
<span class="udiff-line-added">+ import static org.testng.Assert.*;</span>
<span class="udiff-line-added">+ </span>
  public class Basic extends MRTestBase {
  
      @Test
      // create a regular, non-multi-release jar
      public void test00() throws Throwable {
          String jarfile = &quot;test.jar&quot;;
  
          compile(&quot;test01&quot;);  //use same data as test01
  
          Path classes = Paths.get(&quot;classes&quot;);
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;)</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;)</span>
                  .shouldHaveExitValue(SUCCESS);
  
          checkMultiRelease(jarfile, false);
  
          Map&lt;String, String[]&gt; names = Map.of(
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -85,11 +88,11 @@</span>
          String jarfile = &quot;test.jar&quot;;
  
          compile(&quot;test01&quot;);
  
          Path classes = Paths.get(&quot;classes&quot;);
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;,
                  &quot;--release&quot;, &quot;10&quot;, &quot;-C&quot;, classes.resolve(&quot;v10&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS);
  
          checkMultiRelease(jarfile, true);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -122,19 +125,19 @@</span>
  
          Path classes = Paths.get(&quot;classes&quot;);
  
          // valid
          for (String release : List.of(&quot;10000&quot;, &quot;09&quot;, &quot;00010&quot;, &quot;10&quot;)) {
<span class="udiff-line-modified-removed">-             jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+             jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                      &quot;--release&quot;, release, &quot;-C&quot;, classes.resolve(&quot;v10&quot;).toString(), &quot;.&quot;)
                      .shouldHaveExitValue(SUCCESS)
                      .shouldBeEmptyIgnoreVMWarnings();
          }
          // invalid
          for (String release : List.of(&quot;9.0&quot;, &quot;8&quot;, &quot;v9&quot;,
                  &quot;9v&quot;, &quot;0&quot;, &quot;-10&quot;)) {
<span class="udiff-line-modified-removed">-             jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+             jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                      &quot;--release&quot;, release, &quot;-C&quot;, classes.resolve(&quot;v10&quot;).toString(), &quot;.&quot;)
                      .shouldNotHaveExitValue(SUCCESS)
                      .shouldContain(&quot;release &quot; + release + &quot; not valid&quot;);
          }
          FileUtils.deleteFileIfExistsWithRetry(Paths.get(jarfile));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -147,16 +150,16 @@</span>
          String jarfile = &quot;test.jar&quot;;
  
          compile(&quot;test01&quot;);  //use same data as test01
  
          Path classes = Paths.get(&quot;classes&quot;);
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;)</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;)</span>
                  .shouldHaveExitValue(SUCCESS);
  
          checkMultiRelease(jarfile, false);
  
<span class="udiff-line-modified-removed">-         jar(&quot;uf&quot;, jarfile,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;uf&quot;, jarfile,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS);
  
          checkMultiRelease(jarfile, true);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -183,11 +186,11 @@</span>
          String jarfile = &quot;test.jar&quot;;
  
          compile(&quot;test01&quot;);  //use same data as test01
  
          Path classes = Paths.get(&quot;classes&quot;);
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS);
  
          checkMultiRelease(jarfile, true);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -204,11 +207,11 @@</span>
  
          compare(jarfile, names);
  
          // write the v9 version/Version.class entry in base and the v10
          // version/Version.class entry in versions/9 section
<span class="udiff-line-modified-removed">-         jar(&quot;uf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;version&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;uf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;version&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v10&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS);
  
          checkMultiRelease(jarfile, true);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -244,11 +247,11 @@</span>
  
          // replace the v9 class
          Path source = Paths.get(src, &quot;data&quot;, &quot;test04&quot;, &quot;v9&quot;, &quot;version&quot;);
          javac(classes.resolve(&quot;v9&quot;), source.resolve(&quot;Version.java&quot;));
  
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldNotHaveExitValue(SUCCESS)
                  .shouldContain(&quot;different api from earlier&quot;);
  
          FileUtils.deleteFileIfExistsWithRetry(Paths.get(jarfile));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -266,11 +269,11 @@</span>
  
          // add the new v9 class
          Path source = Paths.get(src, &quot;data&quot;, &quot;test05&quot;, &quot;v9&quot;, &quot;version&quot;);
          javac(classes.resolve(&quot;v9&quot;), source.resolve(&quot;Extra.java&quot;));
  
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldNotHaveExitValue(SUCCESS)
                  .shouldContain(&quot;contains a new public class&quot;);
  
          FileUtils.deleteFileIfExistsWithRetry(Paths.get(jarfile));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -288,11 +291,11 @@</span>
  
          // add the new v9 class
          Path source = Paths.get(src, &quot;data&quot;, &quot;test06&quot;, &quot;v9&quot;, &quot;version&quot;);
          javac(classes.resolve(&quot;v9&quot;), source.resolve(&quot;Extra.java&quot;));
  
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS);
  
          FileUtils.deleteFileIfExistsWithRetry(Paths.get(jarfile));
          FileUtils.deleteFileTreeWithRetry(Paths.get(usr, &quot;classes&quot;));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -310,11 +313,11 @@</span>
  
          // add the new v9 class
          Path source = Paths.get(src, &quot;data&quot;, &quot;test01&quot;, &quot;base&quot;, &quot;version&quot;);
          javac(classes.resolve(&quot;v9&quot;), source.resolve(&quot;Version.java&quot;));
  
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS)
                  .shouldContain(&quot;contains a class that&quot;)
                  .shouldContain(&quot;is identical&quot;);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -330,15 +333,15 @@</span>
  
          compile(&quot;test01&quot;);  //use same data as test01
  
          Path classes = Paths.get(&quot;classes&quot;);
  
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS)
                  .shouldBeEmptyIgnoreVMWarnings();
<span class="udiff-line-modified-removed">-         jar(&quot;uf&quot;, jarfile,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;uf&quot;, jarfile,</span>
                  &quot;--release&quot;, &quot;10&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS)
                  .shouldContain(&quot;contains a class that&quot;)
                  .shouldContain(&quot;is identical&quot;);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -357,11 +360,11 @@</span>
  
          Path base = classes.resolve(&quot;base&quot;).resolve(&quot;version&quot;);
  
          Files.copy(base.resolve(&quot;Main.class&quot;), base.resolve(&quot;Foo.class&quot;));
  
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldNotHaveExitValue(SUCCESS)
                  .shouldContain(&quot;names do not match&quot;);
  
          FileUtils.deleteFileIfExistsWithRetry(Paths.get(jarfile));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -383,11 +386,11 @@</span>
  
          // add a versioned class with a nested class
          source = Paths.get(src, &quot;data&quot;, &quot;test10&quot;, &quot;v9&quot;, &quot;version&quot;);
          javac(classes.resolve(&quot;v9&quot;), source.resolve(&quot;Nested.java&quot;));
  
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS);
  
          FileUtils.deleteFileIfExistsWithRetry(Paths.get(jarfile));
          FileUtils.deleteFileTreeWithRetry(Paths.get(usr, &quot;classes&quot;));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -411,11 +414,11 @@</span>
  
          // add a versioned class with a nested class
          source = Paths.get(src, &quot;data&quot;, &quot;test10&quot;, &quot;v9&quot;, &quot;version&quot;);
          javac(classes.resolve(&quot;v9&quot;), source.resolve(&quot;Nested.java&quot;));
  
<span class="udiff-line-modified-removed">-         List&lt;String&gt; output = jar(&quot;cf&quot;, jarfile,</span>
<span class="udiff-line-modified-added">+         List&lt;String&gt; output = jarTool(&quot;cf&quot;, jarfile,</span>
                  &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldNotHaveExitValue(SUCCESS)
                  .asLinesWithoutVMWarnings();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -464,11 +467,11 @@</span>
          javac(classes.resolve(&quot;v9&quot;), source.resolve(&quot;Nested.java&quot;));
  
          // remove the top level class, thus isolating the nested class
          Files.delete(classes.resolve(&quot;v9&quot;).resolve(&quot;version&quot;).resolve(&quot;Nested.class&quot;));
  
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;9&quot;, &quot;-C&quot;, classes.resolve(&quot;v9&quot;).toString(), &quot;.&quot;)
                  .shouldNotHaveExitValue(SUCCESS)
                  .shouldContain(&quot;an isolated nested class&quot;);
  
          FileUtils.deleteFileIfExistsWithRetry(Paths.get(jarfile));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -490,11 +493,11 @@</span>
  
          // add a versioned class with a nested and nested-nested class
          source = Paths.get(src, &quot;data&quot;, &quot;test13&quot;, &quot;v10&quot;, &quot;version&quot;);
          javac(classes.resolve(&quot;v10&quot;), source.resolve(&quot;Nested.java&quot;));
  
<span class="udiff-line-modified-removed">-         jar(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cf&quot;, jarfile, &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,</span>
                  &quot;--release&quot;, &quot;10&quot;, &quot;-C&quot;, classes.resolve(&quot;v10&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS);
  
          FileUtils.deleteFileIfExistsWithRetry(Paths.get(jarfile));
          FileUtils.deleteFileTreeWithRetry(Paths.get(usr, &quot;classes&quot;));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -510,11 +513,11 @@</span>
          Path manifest = Paths.get(&quot;Manifest.txt&quot;);
  
          // create
          Files.write(manifest, &quot;Class-Path: MyUtils.jar\n&quot;.getBytes());
  
<span class="udiff-line-modified-removed">-         jar(&quot;cfm&quot;, jarfile, manifest.toString(),</span>
<span class="udiff-line-modified-added">+         jarTool(&quot;cfm&quot;, jarfile, manifest.toString(),</span>
                  &quot;-C&quot;, classes.resolve(&quot;base&quot;).toString(), &quot;.&quot;,
                  &quot;--release&quot;, &quot;10&quot;, &quot;-C&quot;, classes.resolve(&quot;v10&quot;).toString(), &quot;.&quot;)
                  .shouldHaveExitValue(SUCCESS)
                  .shouldBeEmptyIgnoreVMWarnings();
  
</pre>
<center><a href="../modularJar/Basic.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="MRTestBase.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>