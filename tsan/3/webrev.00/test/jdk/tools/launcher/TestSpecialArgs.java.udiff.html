<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/tools/launcher/TestSpecialArgs.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="TestHelper.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TooSmallStackSize.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/launcher/TestSpecialArgs.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2012, 2015, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -130,15 +130,13 @@</span>
           * 3) execute with invalid parameter: -XX:NativeMemoryTracking
           *    !) Won&#39;t find &quot;NativeMemoryTracking:&quot;
           *       Code to create env variable not executed.
           * 4) give and invalid value and check to make sure JVM commented
           */
<span class="udiff-line-removed">-         String launcherPidString = &quot;launcher.pid=&quot;;</span>
          String envVarPidString = &quot;TRACER_MARKER: NativeMemoryTracking: env var is NMT_LEVEL_&quot;;
          String NMT_Option_Value = &quot;off&quot;;
          String myClassName = &quot;helloworld&quot;;
<span class="udiff-line-removed">-         boolean haveLauncherPid = false;</span>
  
          // === Run the tests ===
          // ---Test 1a
          tr = doExec(envMap, javaCmd, &quot;-XX:NativeMemoryTracking=&quot; + NMT_Option_Value,
                  &quot;-version&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -161,50 +159,10 @@</span>
          if (envVarPid.length() &lt; 1) {
              System.out.println(tr);
              throw new RuntimeException(&quot;Error: env Var Pid in tracking info is empty string&quot;);
          }
  
<span class="udiff-line-removed">-         /*</span>
<span class="udiff-line-removed">-          * On Linux, Launcher Tracking will print the PID.  Use this info</span>
<span class="udiff-line-removed">-          * to validate what we got as the PID in the Launcher itself.</span>
<span class="udiff-line-removed">-          * Linux is the only one that prints this, and trying to get it</span>
<span class="udiff-line-removed">-          * here for win is awful.  So let the linux test make sure we get</span>
<span class="udiff-line-removed">-          * the valid pid, and for non-linux, just make sure pid string is</span>
<span class="udiff-line-removed">-          * non-zero.</span>
<span class="udiff-line-removed">-          */</span>
<span class="udiff-line-removed">-         if (isLinux) {</span>
<span class="udiff-line-removed">-             // get what the test says is the launcher pid</span>
<span class="udiff-line-removed">-             String launcherPid = null;</span>
<span class="udiff-line-removed">-             for (String line : tr.testOutput) {</span>
<span class="udiff-line-removed">-                 int index = line.indexOf(launcherPidString);</span>
<span class="udiff-line-removed">-                 if (index &gt;= 0) {</span>
<span class="udiff-line-removed">-                     int sindex = index + launcherPidString.length();</span>
<span class="udiff-line-removed">-                     int tindex = sindex + line.substring(sindex).indexOf(&quot;&#39;&quot;);</span>
<span class="udiff-line-removed">-                     System.out.println(&quot;DEBUG INFO: sindex = &quot; + sindex);</span>
<span class="udiff-line-removed">-                     System.out.println(&quot;DEBUG INFO: searching substring: &quot; + line.substring(sindex));</span>
<span class="udiff-line-removed">-                     System.out.println(&quot;DEBUG INFO: tindex = &quot; + tindex);</span>
<span class="udiff-line-removed">-                     // DEBUG INFO</span>
<span class="udiff-line-removed">-                     System.out.println(tr);</span>
<span class="udiff-line-removed">-                     launcherPid = line.substring(sindex, tindex);</span>
<span class="udiff-line-removed">-                     break;</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             if (launcherPid == null) {</span>
<span class="udiff-line-removed">-                 System.out.println(tr);</span>
<span class="udiff-line-removed">-                 throw new RuntimeException(&quot;Error: failed to find launcher Pid in launcher tracking info&quot;);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             // did we create the env var with the correct pid?</span>
<span class="udiff-line-removed">-             if (!launcherPid.equals(envVarPid)) {</span>
<span class="udiff-line-removed">-                 System.out.println(tr);</span>
<span class="udiff-line-removed">-                 System.out.println(&quot;Error: wrong pid in creating env var&quot;);</span>
<span class="udiff-line-removed">-                 System.out.println(&quot;Error Info: launcherPid = &quot; + launcherPid);</span>
<span class="udiff-line-removed">-                 System.out.println(&quot;Error Info: envVarPid   = &quot; + envVarPid);</span>
<span class="udiff-line-removed">-                 throw new RuntimeException(&quot;Error: wrong pid in creating env var&quot;);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
          // --- Test 1b
          if (!tr.contains(&quot;NativeMemoryTracking: got value &quot; + NMT_Option_Value)) {
              System.out.println(tr);
              throw new RuntimeException(&quot;Error: Valid param failed to set env variable&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -286,10 +244,14 @@</span>
          // resolution is performed by the JVM.
          tr = doExec(javaCmd, &quot;AbsentClass&quot;, &quot;-XX:NativeMemoryTracking=summary&quot;);
          if (!tr.contains(&quot;Error: Could not find or load main class AbsentClass&quot;)) {
              throw new RuntimeException(&quot;Test Fails&quot;);
          }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // Make sure we handle correctly the module long form (--module=)</span>
<span class="udiff-line-added">+         tr = doExec(javaCmd, &quot;-XX:NativeMemoryTracking=summary&quot;, &quot;--module=jdk.compiler/com.sun.tools.javac.Main&quot;, &quot;--help&quot;);</span>
<span class="udiff-line-added">+         ensureNoWarnings(tr);</span>
      }
  
      void ensureNoWarnings(TestResult tr) {
          checkTestResult(tr);
          if (tr.contains(&quot;warning: Native Memory Tracking&quot;)) {
</pre>
<center><a href="TestHelper.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TooSmallStackSize.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>