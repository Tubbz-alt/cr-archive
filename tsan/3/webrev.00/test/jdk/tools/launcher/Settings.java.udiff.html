<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/tools/launcher/Settings.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="JniInvocationTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestHelper.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/launcher/Settings.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -66,10 +66,11 @@</span>
  
      private static final String VM_SETTINGS = &quot;VM settings:&quot;;
      private static final String PROP_SETTINGS = &quot;Property settings:&quot;;
      private static final String LOCALE_SETTINGS = &quot;Locale settings:&quot;;
      private static final String SYSTEM_SETTINGS = &quot;Operating System Metrics:&quot;;
<span class="udiff-line-added">+     private static final String STACKSIZE_SETTINGS = &quot;Stack Size:&quot;;</span>
  
      static void containsAllOptions(TestResult tr) {
          checkContains(tr, VM_SETTINGS);
          checkContains(tr, PROP_SETTINGS);
          checkContains(tr, LOCALE_SETTINGS);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -80,21 +81,34 @@</span>
  
      static void runTestOptionDefault() throws IOException {
          int stackSize = 256; // in kb
          if (getArch().equals(&quot;ppc64&quot;) || getArch().equals(&quot;ppc64le&quot;)) {
              stackSize = 800;
<span class="udiff-line-added">+         } else if (getArch().equals(&quot;aarch64&quot;)) {</span>
<span class="udiff-line-added">+             /*</span>
<span class="udiff-line-added">+              * The max value of minimum stack size allowed for aarch64 can be estimated as</span>
<span class="udiff-line-added">+              * such: suppose the vm page size is 64KB and the test runs with a debug build,</span>
<span class="udiff-line-added">+              * the initial _java_thread_min_stack_allowed defined in os_linux_aarch64.cpp is</span>
<span class="udiff-line-added">+              * 72K, stack guard zones could take 192KB, and the shadow zone needs 128KB,</span>
<span class="udiff-line-added">+              * after aligning up all parts to the page size, the final size would be 448KB.</span>
<span class="udiff-line-added">+              * See details in JDK-8163363</span>
<span class="udiff-line-added">+              */</span>
<span class="udiff-line-added">+             stackSize = 448;</span>
          }
          TestResult tr;
          tr = doExec(javaCmd, &quot;-Xms64m&quot;, &quot;-Xmx512m&quot;,
                  &quot;-Xss&quot; + stackSize + &quot;k&quot;, &quot;-XshowSettings&quot;, &quot;-jar&quot;, testJar.getAbsolutePath());
<span class="udiff-line-added">+         // Check the stack size logs printed by -XshowSettings to verify -Xss meaningfully.</span>
<span class="udiff-line-added">+         checkContains(tr, STACKSIZE_SETTINGS);</span>
          containsAllOptions(tr);
          if (!tr.isOK()) {
              System.out.println(tr);
              throw new RuntimeException(&quot;test fails&quot;);
          }
          tr = doExec(javaCmd, &quot;-Xms65536k&quot;, &quot;-Xmx712m&quot;,
                  &quot;-Xss&quot; + (stackSize * 1024), &quot;-XshowSettings&quot;, &quot;-jar&quot;, testJar.getAbsolutePath());
<span class="udiff-line-added">+         checkContains(tr, STACKSIZE_SETTINGS);</span>
          containsAllOptions(tr);
          if (!tr.isOK()) {
              System.out.println(tr);
              throw new RuntimeException(&quot;test fails&quot;);
          }
</pre>
<center><a href="JniInvocationTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestHelper.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>