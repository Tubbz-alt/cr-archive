<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/tools/launcher/TestHelper.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="Settings.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestSpecialArgs.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/launcher/TestHelper.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
332         int n = in.read(buf);
333         while (n &gt; 0) {
334             out.write(buf, 0, n);
335             n = in.read(buf);
336         }
337     }
338 
339    static void copyFile(File src, File dst) throws IOException {
340         Path parent = dst.toPath().getParent();
341         if (parent != null) {
342             Files.createDirectories(parent);
343         }
344         Files.copy(src.toPath(), dst.toPath(), COPY_ATTRIBUTES, REPLACE_EXISTING);
345     }
346 
347     /**
348      * Attempt to create a file at the given location. If an IOException
349      * occurs then back off for a moment and try again. When a number of
350      * attempts fail, give up and throw an exception.
351      */
<span class="line-modified">352     void createAFile(File aFile, List&lt;String&gt; contents) throws IOException {</span>




353         IOException cause = null;
354         for (int attempts = 0; attempts &lt; 10; attempts++) {
355             try {
<span class="line-modified">356                 Files.write(aFile.getAbsoluteFile().toPath(), contents,</span>
<span class="line-modified">357                     Charset.defaultCharset(), CREATE, TRUNCATE_EXISTING, WRITE);</span>







358                 if (cause != null) {
359                     /*
360                      * report attempts and errors that were encountered
361                      * for diagnostic purposes
362                      */
363                     System.err.println(&quot;Created batch file &quot; +
364                                         aFile + &quot; in &quot; + (attempts + 1) +
365                                         &quot; attempts&quot;);
366                     System.err.println(&quot;Errors encountered: &quot; + cause);
367                     cause.printStackTrace();
368                 }
369                 return;
370             } catch (IOException ioe) {
371                 if (cause != null) {
372                     // chain the exceptions so they all get reported for diagnostics
373                     cause.addSuppressed(ioe);
374                 } else {
375                     cause = ioe;
376                 }
377             }
</pre>
<hr />
<pre>
472         }
473     }
474 
475     static FileFilter createFilter(final String extension) {
476         return new FileFilter() {
477             @Override
478             public boolean accept(File pathname) {
479                 String name = pathname.getName();
480                 if (name.endsWith(extension)) {
481                     return true;
482                 }
483                 return false;
484             }
485         };
486     }
487 
488     static boolean isEnglishLocale() {
489         return Locale.getDefault().getLanguage().equals(&quot;en&quot;);
490     }
491 


































492     /*
493      * A class to encapsulate the test results and stuff, with some ease
494      * of use methods to check the test results.
495      */
496     static class TestResult {
497         PrintWriter status;
498         StringWriter sw;
499         int exitValue;
500         List&lt;String&gt; testOutput;
501         Map&lt;String, String&gt; env;
502         Throwable t;
503         boolean testStatus;
504 
505         public TestResult(String str, int rv, List&lt;String&gt; oList,
506                 Map&lt;String, String&gt; env, Throwable t) {
507             sw = new StringWriter();
508             status = new PrintWriter(sw);
509             status.println(&quot;Executed command: &quot; + str + &quot;\n&quot;);
510             exitValue = rv;
511             testOutput = oList;
</pre>
</td>
<td>
<hr />
<pre>
332         int n = in.read(buf);
333         while (n &gt; 0) {
334             out.write(buf, 0, n);
335             n = in.read(buf);
336         }
337     }
338 
339    static void copyFile(File src, File dst) throws IOException {
340         Path parent = dst.toPath().getParent();
341         if (parent != null) {
342             Files.createDirectories(parent);
343         }
344         Files.copy(src.toPath(), dst.toPath(), COPY_ATTRIBUTES, REPLACE_EXISTING);
345     }
346 
347     /**
348      * Attempt to create a file at the given location. If an IOException
349      * occurs then back off for a moment and try again. When a number of
350      * attempts fail, give up and throw an exception.
351      */
<span class="line-modified">352     void createAFile(File aFile, List&lt;String&gt; lines) throws IOException {</span>
<span class="line-added">353         createAFile(aFile, lines, true);</span>
<span class="line-added">354     }</span>
<span class="line-added">355 </span>
<span class="line-added">356     void createAFile(File aFile, List&lt;String&gt; lines, boolean endWithNewline) throws IOException {</span>
357         IOException cause = null;
358         for (int attempts = 0; attempts &lt; 10; attempts++) {
359             try {
<span class="line-modified">360                 if (endWithNewline) {</span>
<span class="line-modified">361                     Files.write(aFile.getAbsoluteFile().toPath(),</span>
<span class="line-added">362                         lines, Charset.defaultCharset(),</span>
<span class="line-added">363                         CREATE, TRUNCATE_EXISTING, WRITE);</span>
<span class="line-added">364                 } else {</span>
<span class="line-added">365                     Files.write(aFile.getAbsoluteFile().toPath(),</span>
<span class="line-added">366                         String.join(System.lineSeparator(), lines).getBytes(Charset.defaultCharset()),</span>
<span class="line-added">367                         CREATE, TRUNCATE_EXISTING, WRITE);</span>
<span class="line-added">368                 }</span>
369                 if (cause != null) {
370                     /*
371                      * report attempts and errors that were encountered
372                      * for diagnostic purposes
373                      */
374                     System.err.println(&quot;Created batch file &quot; +
375                                         aFile + &quot; in &quot; + (attempts + 1) +
376                                         &quot; attempts&quot;);
377                     System.err.println(&quot;Errors encountered: &quot; + cause);
378                     cause.printStackTrace();
379                 }
380                 return;
381             } catch (IOException ioe) {
382                 if (cause != null) {
383                     // chain the exceptions so they all get reported for diagnostics
384                     cause.addSuppressed(ioe);
385                 } else {
386                     cause = ioe;
387                 }
388             }
</pre>
<hr />
<pre>
483         }
484     }
485 
486     static FileFilter createFilter(final String extension) {
487         return new FileFilter() {
488             @Override
489             public boolean accept(File pathname) {
490                 String name = pathname.getName();
491                 if (name.endsWith(extension)) {
492                     return true;
493                 }
494                 return false;
495             }
496         };
497     }
498 
499     static boolean isEnglishLocale() {
500         return Locale.getDefault().getLanguage().equals(&quot;en&quot;);
501     }
502 
<span class="line-added">503     /**</span>
<span class="line-added">504      * Helper method to initialize a simple module that just prints the passed in arguments</span>
<span class="line-added">505      */</span>
<span class="line-added">506     static void createEchoArgumentsModule(File modulesDir) throws IOException {</span>
<span class="line-added">507         if (modulesDir.exists()) {</span>
<span class="line-added">508             recursiveDelete(modulesDir);</span>
<span class="line-added">509         }</span>
<span class="line-added">510 </span>
<span class="line-added">511         modulesDir.mkdirs();</span>
<span class="line-added">512 </span>
<span class="line-added">513         File srcDir = new File(modulesDir, &quot;src&quot;);</span>
<span class="line-added">514         File modsDir = new File(modulesDir, &quot;mods&quot;);</span>
<span class="line-added">515         File testDir = new File(srcDir, &quot;test&quot;);</span>
<span class="line-added">516         File launcherTestDir = new File(testDir, &quot;launcher&quot;);</span>
<span class="line-added">517         srcDir.mkdir();</span>
<span class="line-added">518         modsDir.mkdir();</span>
<span class="line-added">519         testDir.mkdir();</span>
<span class="line-added">520         launcherTestDir.mkdir();</span>
<span class="line-added">521 </span>
<span class="line-added">522         String[] moduleInfoCode = { &quot;module test {}&quot; };</span>
<span class="line-added">523         createFile(new File(testDir, &quot;module-info.java&quot;), Arrays.asList(moduleInfoCode));</span>
<span class="line-added">524 </span>
<span class="line-added">525         String[] moduleCode = {</span>
<span class="line-added">526             &quot;package launcher;&quot;,</span>
<span class="line-added">527             &quot;import java.util.Arrays;&quot;,</span>
<span class="line-added">528             &quot;public class Main {&quot;,</span>
<span class="line-added">529             &quot;public static void main(String[] args) {&quot;,</span>
<span class="line-added">530             &quot;System.out.println(Arrays.toString(args));&quot;,</span>
<span class="line-added">531             &quot;}&quot;,</span>
<span class="line-added">532             &quot;}&quot;</span>
<span class="line-added">533         };</span>
<span class="line-added">534         createFile(new File(launcherTestDir, &quot;Main.java&quot;), Arrays.asList(moduleCode));</span>
<span class="line-added">535     }</span>
<span class="line-added">536 </span>
537     /*
538      * A class to encapsulate the test results and stuff, with some ease
539      * of use methods to check the test results.
540      */
541     static class TestResult {
542         PrintWriter status;
543         StringWriter sw;
544         int exitValue;
545         List&lt;String&gt; testOutput;
546         Map&lt;String, String&gt; env;
547         Throwable t;
548         boolean testStatus;
549 
550         public TestResult(String str, int rv, List&lt;String&gt; oList,
551                 Map&lt;String, String&gt; env, Throwable t) {
552             sw = new StringWriter();
553             status = new PrintWriter(sw);
554             status.println(&quot;Executed command: &quot; + str + &quot;\n&quot;);
555             exitValue = rv;
556             testOutput = oList;
</pre>
</td>
</tr>
</table>
<center><a href="Settings.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestSpecialArgs.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>