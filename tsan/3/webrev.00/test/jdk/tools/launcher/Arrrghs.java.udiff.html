<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/tools/launcher/Arrrghs.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="ArgsFileTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="HelpFlagsTest.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/launcher/Arrrghs.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2007, 2015, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2007, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -22,11 +22,11 @@</span>
   */
  
  /**
   * @test
   * @bug 5030233 6214916 6356475 6571029 6684582 6742159 4459600 6758881 6753938
<span class="udiff-line-modified-removed">-  *      6894719 6968053 7151434 7146424 8007333 8077822 8143640 8132379</span>
<span class="udiff-line-modified-added">+  *      6894719 6968053 7151434 7146424 8007333 8077822 8143640 8132379 8218547</span>
   * @summary Argument parsing validation.
   * @modules jdk.compiler
   *          jdk.zipfs
   * @compile -XDignore.symbol.file Arrrghs.java
   * @run main/othervm Arrrghs
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -34,10 +34,13 @@</span>
  
  
  import java.io.File;
  import java.io.FileNotFoundException;
  import java.io.IOException;
<span class="udiff-line-added">+ import java.nio.file.Files;</span>
<span class="udiff-line-added">+ import java.nio.file.Paths;</span>
<span class="udiff-line-added">+ import java.nio.file.Path;</span>
  import java.util.ArrayList;
  import java.util.Arrays;
  import java.util.HashMap;
  import java.util.List;
  import java.util.Map;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -53,24 +56,10 @@</span>
       * implementations were notoriously buggy. Implementing these tests purely
       * in Java is not only portable but also robust.
       *
       */
  
<span class="udiff-line-removed">-     /*</span>
<span class="udiff-line-removed">-      * SIGH, On Windows all strings are quoted, we need to unwrap it</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     private static String removeExtraQuotes(String in) {</span>
<span class="udiff-line-removed">-         if (isWindows) {</span>
<span class="udiff-line-removed">-             // Trim the string and remove the enclosed quotes if any.</span>
<span class="udiff-line-removed">-             in = in.trim();</span>
<span class="udiff-line-removed">-             if (in.startsWith(&quot;\&quot;&quot;) &amp;&amp; in.endsWith(&quot;\&quot;&quot;)) {</span>
<span class="udiff-line-removed">-                 return in.substring(1, in.length()-1);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return in;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      // the pattern we hope to see in the output
      static final Pattern ArgPattern = Pattern.compile(&quot;\\s*argv\\[[0-9]*\\].*=.*&quot;);
  
      void checkArgumentParsing(String inArgs, String... expArgs) throws IOException {
          List&lt;String&gt; scratchpad = new ArrayList&lt;&gt;();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -487,10 +476,31 @@</span>
          tr.contains(&quot;Unrecognized option: -W&quot;);
          if (!tr.testStatus)
              System.out.println(tr);
      }
  
<span class="udiff-line-added">+     /*</span>
<span class="udiff-line-added">+      * Tests -jar command on a jar file with &quot;long&quot; (&gt; 260 chars) full path on Windows</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     @Test</span>
<span class="udiff-line-added">+     void testLongPathJarFile() throws IOException {</span>
<span class="udiff-line-added">+         if (!isWindows) {</span>
<span class="udiff-line-added">+             return;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         // put the jar file to a location with long path</span>
<span class="udiff-line-added">+         String longPathPart = &quot;longpathtest_longpathtest/&quot;;</span>
<span class="udiff-line-added">+         String longPathStr = longPathPart.repeat(15);</span>
<span class="udiff-line-added">+         Path longPath = Paths.get(longPathStr);</span>
<span class="udiff-line-added">+         Path jarPath = Files.createDirectories(longPath).resolve(&quot;elp.jar&quot;);</span>
<span class="udiff-line-added">+         File elp = jarPath.toFile();</span>
<span class="udiff-line-added">+         createJar(elp, new File(&quot;Foo&quot;), &quot;public static void main(String[] args){ System.out.println(\&quot;Hello from ELP\&quot;); }&quot;);</span>
<span class="udiff-line-added">+         System.out.println(&quot;execute &quot; + elp.getAbsolutePath());</span>
<span class="udiff-line-added">+         TestResult tr = doExec(javaCmd, &quot;-jar&quot;, elp.getAbsolutePath());</span>
<span class="udiff-line-added">+         tr.checkPositive();</span>
<span class="udiff-line-added">+         tr.contains(&quot;Hello from ELP&quot;);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /*
       * Tests various dispositions of the main method, these tests are limited
       * to English locales as they check for error messages that are localized.
       */
      @Test
</pre>
<center><a href="ArgsFileTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="HelpFlagsTest.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>