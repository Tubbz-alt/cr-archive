<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/tools/launcher/ArgsEnvVar.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../jpackage/resources/icon4.ico.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ArgsFileTest.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/launcher/ArgsEnvVar.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -35,10 +35,12 @@</span>
  import java.util.ArrayList;
  import java.util.HashMap;
  import java.util.List;
  import java.util.Map;
  import java.util.regex.Pattern;
<span class="udiff-line-added">+ import java.nio.file.Paths;</span>
<span class="udiff-line-added">+ import java.nio.file.Path;</span>
  
  public class ArgsEnvVar extends TestHelper {
      private static File testJar = null;
      private static Map&lt;String, String&gt; env = new HashMap&lt;&gt;();
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -151,10 +153,11 @@</span>
      public void noTerminalOpt() throws IOException {
          List&lt;List&lt;String&gt;&gt; terminal_opts = List.of(
                  List.of(&quot;-jar&quot;, &quot;test.jar&quot;),
                  List.of(&quot;-m&quot;, &quot;test/Foo&quot;),
                  List.of(&quot;--module&quot;, &quot;test/Foo&quot;),
<span class="udiff-line-added">+                 List.of(&quot;--module=test/Foo&quot;),</span>
                  List.of(&quot;--dry-run&quot;),
                  List.of(&quot;-h&quot;),
                  List.of(&quot;-?&quot;),
                  List.of(&quot;-help&quot;),
                  List.of(&quot;--help&quot;),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -239,10 +242,73 @@</span>
          env.put(JDK_JAVA_OPTIONS, &quot;  --add-exports java.base/jdk.internal.misc=ALL-UNNAMED &quot;);
          tr = doExec(env, javaCmd, &quot;-jar&quot;, &quot;test.jar&quot;);
          verifyOptions(List.of(&quot;--add-exports&quot;, &quot;java.base/jdk.internal.misc=ALL-UNNAMED&quot;, &quot;-jar&quot;, &quot;test.jar&quot;), tr);
      }
  
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Test</span>
<span class="udiff-line-added">+     // That that we can correctly handle the module longform argument option</span>
<span class="udiff-line-added">+     // when supplied in an argument file</span>
<span class="udiff-line-added">+     public void modulesInArgsFile() throws IOException {</span>
<span class="udiff-line-added">+         File cwd = new File(&quot;.&quot;);</span>
<span class="udiff-line-added">+         File testModuleDir = new File(cwd, &quot;modules_test&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         createEchoArgumentsModule(testModuleDir);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         Path SRC_DIR = Paths.get(testModuleDir.getAbsolutePath(), &quot;src&quot;);</span>
<span class="udiff-line-added">+         Path MODS_DIR = Paths.get(testModuleDir.getAbsolutePath(), &quot;mods&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // test module / main class</span>
<span class="udiff-line-added">+         String MODULE_OPTION = &quot;--module=test/launcher.Main&quot;;</span>
<span class="udiff-line-added">+         String TEST_MODULE = &quot;test&quot;;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // javac -d mods/test src/test/**</span>
<span class="udiff-line-added">+         TestResult tr = doExec(</span>
<span class="udiff-line-added">+             javacCmd,</span>
<span class="udiff-line-added">+             &quot;-d&quot;, MODS_DIR.toString(),</span>
<span class="udiff-line-added">+             &quot;--module-source-path&quot;, SRC_DIR.toString(),</span>
<span class="udiff-line-added">+             &quot;--module&quot;, TEST_MODULE);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (!tr.isOK()) {</span>
<span class="udiff-line-added">+             System.out.println(&quot;test did not compile&quot;);</span>
<span class="udiff-line-added">+             throw new RuntimeException(&quot;Error: modules test did not compile&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // verify the terminating ability of --module= through environment variables</span>
<span class="udiff-line-added">+         File argFile = createArgFile(&quot;cmdargs&quot;, List.of(&quot;--module-path&quot;, MODS_DIR.toString(), MODULE_OPTION, &quot;--hello&quot;));</span>
<span class="udiff-line-added">+         env.put(JDK_JAVA_OPTIONS, &quot;@cmdargs&quot;);</span>
<span class="udiff-line-added">+         tr = doExec(env, javaCmd);</span>
<span class="udiff-line-added">+         tr.checkNegative();</span>
<span class="udiff-line-added">+         tr.contains(&quot;Error: Option &quot; + MODULE_OPTION + &quot; in @cmdargs is not allowed in environment variable JDK_JAVA_OPTIONS&quot;);</span>
<span class="udiff-line-added">+         if (!tr.testStatus) {</span>
<span class="udiff-line-added">+             System.out.println(tr);</span>
<span class="udiff-line-added">+             throw new RuntimeException(&quot;test fails&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // check that specifying --module and --module-path with file works</span>
<span class="udiff-line-added">+         tr = doExec(javaCmd, &quot;-Dfile.encoding=UTF-8&quot;, &quot;@cmdargs&quot;);</span>
<span class="udiff-line-added">+         tr.contains(&quot;[--hello]&quot;);</span>
<span class="udiff-line-added">+         if (!tr.testStatus) {</span>
<span class="udiff-line-added">+             System.out.println(tr);</span>
<span class="udiff-line-added">+             throw new RuntimeException(&quot;test fails&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // check with reversed --module-path and --module in the arguments file, this will fail, --module= is terminating</span>
<span class="udiff-line-added">+         File argFile1 = createArgFile(&quot;cmdargs1&quot;, List.of(MODULE_OPTION, &quot;--module-path&quot;, MODS_DIR.toString(), &quot;--hello&quot;));</span>
<span class="udiff-line-added">+         tr = doExec(javaCmd, &quot;-Dfile.encoding=UTF-8&quot;, &quot;@cmdargs1&quot;);</span>
<span class="udiff-line-added">+         tr.checkNegative();</span>
<span class="udiff-line-added">+         if (!tr.testStatus) {</span>
<span class="udiff-line-added">+             System.out.println(tr);</span>
<span class="udiff-line-added">+             throw new RuntimeException(&quot;test fails&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // clean-up</span>
<span class="udiff-line-added">+         argFile.delete();</span>
<span class="udiff-line-added">+         argFile1.delete();</span>
<span class="udiff-line-added">+         recursiveDelete(testModuleDir);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      public static void main(String... args) throws Exception {
          init();
          ArgsEnvVar a = new ArgsEnvVar();
          a.run(args);
          if (testExitValue &gt; 0) {
</pre>
<center><a href="../jpackage/resources/icon4.ico.udiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="ArgsFileTest.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>