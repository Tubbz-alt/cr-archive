<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/tools/launcher/Settings.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="JniInvocationTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestHelper.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/launcher/Settings.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 51     }
 52 
 53     static void checkContains(TestResult tr, String str) {
 54         if (!tr.contains(str)) {
 55             System.out.println(tr);
 56             throw new RuntimeException(str + &quot; not found&quot;);
 57         }
 58     }
 59 
 60     static void checkNotContains(TestResult tr, String str) {
 61         if (!tr.notContains(str)) {
 62             System.out.println(tr);
 63             throw new RuntimeException(str + &quot; found&quot;);
 64         }
 65     }
 66 
 67     private static final String VM_SETTINGS = &quot;VM settings:&quot;;
 68     private static final String PROP_SETTINGS = &quot;Property settings:&quot;;
 69     private static final String LOCALE_SETTINGS = &quot;Locale settings:&quot;;
 70     private static final String SYSTEM_SETTINGS = &quot;Operating System Metrics:&quot;;

 71 
 72     static void containsAllOptions(TestResult tr) {
 73         checkContains(tr, VM_SETTINGS);
 74         checkContains(tr, PROP_SETTINGS);
 75         checkContains(tr, LOCALE_SETTINGS);
 76         if (System.getProperty(&quot;os.name&quot;).contains(&quot;Linux&quot;)) {
 77             checkContains(tr, SYSTEM_SETTINGS);
 78         }
 79     }
 80 
 81     static void runTestOptionDefault() throws IOException {
 82         int stackSize = 256; // in kb
 83         if (getArch().equals(&quot;ppc64&quot;) || getArch().equals(&quot;ppc64le&quot;)) {
 84             stackSize = 800;










 85         }
 86         TestResult tr;
 87         tr = doExec(javaCmd, &quot;-Xms64m&quot;, &quot;-Xmx512m&quot;,
 88                 &quot;-Xss&quot; + stackSize + &quot;k&quot;, &quot;-XshowSettings&quot;, &quot;-jar&quot;, testJar.getAbsolutePath());


 89         containsAllOptions(tr);
 90         if (!tr.isOK()) {
 91             System.out.println(tr);
 92             throw new RuntimeException(&quot;test fails&quot;);
 93         }
 94         tr = doExec(javaCmd, &quot;-Xms65536k&quot;, &quot;-Xmx712m&quot;,
 95                 &quot;-Xss&quot; + (stackSize * 1024), &quot;-XshowSettings&quot;, &quot;-jar&quot;, testJar.getAbsolutePath());

 96         containsAllOptions(tr);
 97         if (!tr.isOK()) {
 98             System.out.println(tr);
 99             throw new RuntimeException(&quot;test fails&quot;);
100         }
101     }
102 
103     static void runTestOptionAll() throws IOException {
104         init();
105         TestResult tr = doExec(javaCmd, &quot;-XshowSettings:all&quot;);
106         containsAllOptions(tr);
107     }
108 
109     static void runTestOptionVM() throws IOException {
110         TestResult tr = doExec(javaCmd, &quot;-XshowSettings:vm&quot;);
111         checkContains(tr, VM_SETTINGS);
112         checkNotContains(tr, PROP_SETTINGS);
113         checkNotContains(tr, LOCALE_SETTINGS);
114     }
115 
</pre>
</td>
<td>
<hr />
<pre>
 51     }
 52 
 53     static void checkContains(TestResult tr, String str) {
 54         if (!tr.contains(str)) {
 55             System.out.println(tr);
 56             throw new RuntimeException(str + &quot; not found&quot;);
 57         }
 58     }
 59 
 60     static void checkNotContains(TestResult tr, String str) {
 61         if (!tr.notContains(str)) {
 62             System.out.println(tr);
 63             throw new RuntimeException(str + &quot; found&quot;);
 64         }
 65     }
 66 
 67     private static final String VM_SETTINGS = &quot;VM settings:&quot;;
 68     private static final String PROP_SETTINGS = &quot;Property settings:&quot;;
 69     private static final String LOCALE_SETTINGS = &quot;Locale settings:&quot;;
 70     private static final String SYSTEM_SETTINGS = &quot;Operating System Metrics:&quot;;
<span class="line-added"> 71     private static final String STACKSIZE_SETTINGS = &quot;Stack Size:&quot;;</span>
 72 
 73     static void containsAllOptions(TestResult tr) {
 74         checkContains(tr, VM_SETTINGS);
 75         checkContains(tr, PROP_SETTINGS);
 76         checkContains(tr, LOCALE_SETTINGS);
 77         if (System.getProperty(&quot;os.name&quot;).contains(&quot;Linux&quot;)) {
 78             checkContains(tr, SYSTEM_SETTINGS);
 79         }
 80     }
 81 
 82     static void runTestOptionDefault() throws IOException {
 83         int stackSize = 256; // in kb
 84         if (getArch().equals(&quot;ppc64&quot;) || getArch().equals(&quot;ppc64le&quot;)) {
 85             stackSize = 800;
<span class="line-added"> 86         } else if (getArch().equals(&quot;aarch64&quot;)) {</span>
<span class="line-added"> 87             /*</span>
<span class="line-added"> 88              * The max value of minimum stack size allowed for aarch64 can be estimated as</span>
<span class="line-added"> 89              * such: suppose the vm page size is 64KB and the test runs with a debug build,</span>
<span class="line-added"> 90              * the initial _java_thread_min_stack_allowed defined in os_linux_aarch64.cpp is</span>
<span class="line-added"> 91              * 72K, stack guard zones could take 192KB, and the shadow zone needs 128KB,</span>
<span class="line-added"> 92              * after aligning up all parts to the page size, the final size would be 448KB.</span>
<span class="line-added"> 93              * See details in JDK-8163363</span>
<span class="line-added"> 94              */</span>
<span class="line-added"> 95             stackSize = 448;</span>
 96         }
 97         TestResult tr;
 98         tr = doExec(javaCmd, &quot;-Xms64m&quot;, &quot;-Xmx512m&quot;,
 99                 &quot;-Xss&quot; + stackSize + &quot;k&quot;, &quot;-XshowSettings&quot;, &quot;-jar&quot;, testJar.getAbsolutePath());
<span class="line-added">100         // Check the stack size logs printed by -XshowSettings to verify -Xss meaningfully.</span>
<span class="line-added">101         checkContains(tr, STACKSIZE_SETTINGS);</span>
102         containsAllOptions(tr);
103         if (!tr.isOK()) {
104             System.out.println(tr);
105             throw new RuntimeException(&quot;test fails&quot;);
106         }
107         tr = doExec(javaCmd, &quot;-Xms65536k&quot;, &quot;-Xmx712m&quot;,
108                 &quot;-Xss&quot; + (stackSize * 1024), &quot;-XshowSettings&quot;, &quot;-jar&quot;, testJar.getAbsolutePath());
<span class="line-added">109         checkContains(tr, STACKSIZE_SETTINGS);</span>
110         containsAllOptions(tr);
111         if (!tr.isOK()) {
112             System.out.println(tr);
113             throw new RuntimeException(&quot;test fails&quot;);
114         }
115     }
116 
117     static void runTestOptionAll() throws IOException {
118         init();
119         TestResult tr = doExec(javaCmd, &quot;-XshowSettings:all&quot;);
120         containsAllOptions(tr);
121     }
122 
123     static void runTestOptionVM() throws IOException {
124         TestResult tr = doExec(javaCmd, &quot;-XshowSettings:vm&quot;);
125         checkContains(tr, VM_SETTINGS);
126         checkNotContains(tr, PROP_SETTINGS);
127         checkNotContains(tr, LOCALE_SETTINGS);
128     }
129 
</pre>
</td>
</tr>
</table>
<center><a href="JniInvocationTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="TestHelper.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>