<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/tools/jimage/JImageExtractTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../jar/multiRelease/MRTestBase.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="JImageTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/jimage/JImageExtractTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 29,24 ***</span>
<span class="line-new-header">--- 29,57 ---</span>
   * @build jdk.test.lib.Asserts
   * @run main/othervm/timeout=300 JImageExtractTest
   */
  
  import java.io.IOException;
<span class="line-added">+ import java.io.UncheckedIOException;</span>
  import java.nio.file.Files;
  import java.nio.file.Path;
  import java.nio.file.Paths;
  import java.nio.file.attribute.*;
  import java.util.Arrays;
  import java.util.HashSet;
  import java.util.List;
  import java.util.Set;
  import java.util.stream.Collectors;
<span class="line-added">+ import java.util.spi.ToolProvider;</span>
  
  import static jdk.test.lib.Asserts.assertEquals;
  import static jdk.test.lib.Asserts.assertTrue;
  
  public class JImageExtractTest extends JImageCliTest {
<span class="line-added">+     private static final ToolProvider JLINK_TOOL = ToolProvider.findFirst(&quot;jlink&quot;)</span>
<span class="line-added">+         .orElseThrow(() -&gt;</span>
<span class="line-added">+             new RuntimeException(&quot;jlink tool not found&quot;)</span>
<span class="line-added">+         );</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
<span class="line-added">+     private String smallBootImagePath;</span>
<span class="line-added">+ </span>
<span class="line-added">+     public JImageExtractTest() {</span>
<span class="line-added">+         try {</span>
<span class="line-added">+             Path tmp = Files.createTempDirectory(Paths.get(&quot;.&quot;), getClass().getName());</span>
<span class="line-added">+             tmp = tmp.toAbsolutePath();</span>
<span class="line-added">+             tmp.toFile().deleteOnExit();</span>
<span class="line-added">+             Path smalljre = tmp.resolve(&quot;smalljdk&quot;);</span>
<span class="line-added">+             if (JLINK_TOOL.run(System.out, System.err,</span>
<span class="line-added">+                     &quot;--add-modules&quot;, &quot;java.base&quot;,</span>
<span class="line-added">+                     &quot;--add-modules&quot;, &quot;jdk.zipfs&quot;,</span>
<span class="line-added">+                     &quot;--output&quot;, smalljre.toString()) != 0) {</span>
<span class="line-added">+                 throw new RuntimeException(&quot;failed to create small boot image&quot;);</span>
<span class="line-added">+             }</span>
<span class="line-added">+             this.smallBootImagePath = smalljre.resolve(&quot;lib&quot;).resolve(&quot;modules&quot;).toString();</span>
<span class="line-added">+         } catch (IOException ioExp) {</span>
<span class="line-added">+             throw new UncheckedIOException(ioExp);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Override</span>
<span class="line-added">+     public String getImagePath() {</span>
<span class="line-added">+         return smallBootImagePath;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      public void testExtract() throws IOException {
          Set&lt;Path&gt; notJImageModules = Files.walk(Paths.get(&quot;.&quot;),1).collect(Collectors.toSet());
          jimage(&quot;extract&quot;, getImagePath())
                  .assertSuccess()
                  .resultChecker(r -&gt; {
</pre>
<center><a href="../jar/multiRelease/MRTestBase.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="JImageTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>