<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/tools/jimage/JImageExtractTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="../jar/multiRelease/MRTestBase.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="JImageTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/jimage/JImageExtractTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @summary Tests to verify jimage &#39;extract&#39; action
 27  * @library /test/lib
 28  * @modules jdk.jlink/jdk.tools.jimage
 29  * @build jdk.test.lib.Asserts
 30  * @run main/othervm/timeout=300 JImageExtractTest
 31  */
 32 
 33 import java.io.IOException;

 34 import java.nio.file.Files;
 35 import java.nio.file.Path;
 36 import java.nio.file.Paths;
 37 import java.nio.file.attribute.*;
 38 import java.util.Arrays;
 39 import java.util.HashSet;
 40 import java.util.List;
 41 import java.util.Set;
 42 import java.util.stream.Collectors;

 43 
 44 import static jdk.test.lib.Asserts.assertEquals;
 45 import static jdk.test.lib.Asserts.assertTrue;
 46 
 47 public class JImageExtractTest extends JImageCliTest {































 48     public void testExtract() throws IOException {
 49         Set&lt;Path&gt; notJImageModules = Files.walk(Paths.get(&quot;.&quot;),1).collect(Collectors.toSet());
 50         jimage(&quot;extract&quot;, getImagePath())
 51                 .assertSuccess()
 52                 .resultChecker(r -&gt; {
 53                     assertTrue(r.output.isEmpty(), &quot;Output is not expected&quot;);
 54                 });
 55         verifyExplodedImage(Paths.get(&quot;.&quot;), notJImageModules);
 56     }
 57 
 58     public void testExtractHelp() {
 59         for (String opt : Arrays.asList(&quot;-h&quot;, &quot;--help&quot;)) {
 60             jimage(&quot;extract&quot;, &quot;--help&quot;)
 61                     .assertSuccess()
 62                     .resultChecker(r -&gt; {
 63                         // extract  -  descriptive text
 64                         assertMatches(&quot;\\s+extract\\s+-\\s+.*&quot;, r.output);
 65                     });
 66         }
 67     }
</pre>
</td>
<td>
<hr />
<pre>
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @summary Tests to verify jimage &#39;extract&#39; action
 27  * @library /test/lib
 28  * @modules jdk.jlink/jdk.tools.jimage
 29  * @build jdk.test.lib.Asserts
 30  * @run main/othervm/timeout=300 JImageExtractTest
 31  */
 32 
 33 import java.io.IOException;
<span class="line-added"> 34 import java.io.UncheckedIOException;</span>
 35 import java.nio.file.Files;
 36 import java.nio.file.Path;
 37 import java.nio.file.Paths;
 38 import java.nio.file.attribute.*;
 39 import java.util.Arrays;
 40 import java.util.HashSet;
 41 import java.util.List;
 42 import java.util.Set;
 43 import java.util.stream.Collectors;
<span class="line-added"> 44 import java.util.spi.ToolProvider;</span>
 45 
 46 import static jdk.test.lib.Asserts.assertEquals;
 47 import static jdk.test.lib.Asserts.assertTrue;
 48 
 49 public class JImageExtractTest extends JImageCliTest {
<span class="line-added"> 50     private static final ToolProvider JLINK_TOOL = ToolProvider.findFirst(&quot;jlink&quot;)</span>
<span class="line-added"> 51         .orElseThrow(() -&gt;</span>
<span class="line-added"> 52             new RuntimeException(&quot;jlink tool not found&quot;)</span>
<span class="line-added"> 53         );</span>
<span class="line-added"> 54 </span>
<span class="line-added"> 55 </span>
<span class="line-added"> 56     private String smallBootImagePath;</span>
<span class="line-added"> 57 </span>
<span class="line-added"> 58     public JImageExtractTest() {</span>
<span class="line-added"> 59         try {</span>
<span class="line-added"> 60             Path tmp = Files.createTempDirectory(Paths.get(&quot;.&quot;), getClass().getName());</span>
<span class="line-added"> 61             tmp = tmp.toAbsolutePath();</span>
<span class="line-added"> 62             tmp.toFile().deleteOnExit();</span>
<span class="line-added"> 63             Path smalljre = tmp.resolve(&quot;smalljdk&quot;);</span>
<span class="line-added"> 64             if (JLINK_TOOL.run(System.out, System.err,</span>
<span class="line-added"> 65                     &quot;--add-modules&quot;, &quot;java.base&quot;,</span>
<span class="line-added"> 66                     &quot;--add-modules&quot;, &quot;jdk.zipfs&quot;,</span>
<span class="line-added"> 67                     &quot;--output&quot;, smalljre.toString()) != 0) {</span>
<span class="line-added"> 68                 throw new RuntimeException(&quot;failed to create small boot image&quot;);</span>
<span class="line-added"> 69             }</span>
<span class="line-added"> 70             this.smallBootImagePath = smalljre.resolve(&quot;lib&quot;).resolve(&quot;modules&quot;).toString();</span>
<span class="line-added"> 71         } catch (IOException ioExp) {</span>
<span class="line-added"> 72             throw new UncheckedIOException(ioExp);</span>
<span class="line-added"> 73         }</span>
<span class="line-added"> 74     }</span>
<span class="line-added"> 75 </span>
<span class="line-added"> 76     @Override</span>
<span class="line-added"> 77     public String getImagePath() {</span>
<span class="line-added"> 78         return smallBootImagePath;</span>
<span class="line-added"> 79     }</span>
<span class="line-added"> 80 </span>
 81     public void testExtract() throws IOException {
 82         Set&lt;Path&gt; notJImageModules = Files.walk(Paths.get(&quot;.&quot;),1).collect(Collectors.toSet());
 83         jimage(&quot;extract&quot;, getImagePath())
 84                 .assertSuccess()
 85                 .resultChecker(r -&gt; {
 86                     assertTrue(r.output.isEmpty(), &quot;Output is not expected&quot;);
 87                 });
 88         verifyExplodedImage(Paths.get(&quot;.&quot;), notJImageModules);
 89     }
 90 
 91     public void testExtractHelp() {
 92         for (String opt : Arrays.asList(&quot;-h&quot;, &quot;--help&quot;)) {
 93             jimage(&quot;extract&quot;, &quot;--help&quot;)
 94                     .assertSuccess()
 95                     .resultChecker(r -&gt; {
 96                         // extract  -  descriptive text
 97                         assertMatches(&quot;\\s+extract\\s+-\\s+.*&quot;, r.output);
 98                     });
 99         }
100     }
</pre>
</td>
</tr>
</table>
<center><a href="../jar/multiRelease/MRTestBase.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="JImageTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>