<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/tools/jpackage/helpers/jdk/jpackage/test/JavaAppDesc.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 package jdk.jpackage.test;
 24 
 25 import java.io.File;
 26 import java.nio.file.Path;
 27 
 28 
 29 public final class JavaAppDesc {
 30     public JavaAppDesc() {
 31     }
 32 
 33     public JavaAppDesc setClassName(String v) {
 34         qualifiedClassName = v;
 35         return this;
 36     }
 37 
 38     public JavaAppDesc setModuleName(String v) {
 39         moduleName = v;
 40         return this;
 41     }
 42 
 43     public JavaAppDesc setBundleFileName(String v) {
 44         bundleFileName = v;
 45         return this;
 46     }
 47 
 48     public JavaAppDesc setModuleVersion(String v) {
 49         moduleVersion = v;
 50         return this;
 51     }
 52 
 53     public JavaAppDesc setWithMainClass(boolean v) {
 54         withMainClass = v;
 55         return this;
 56     }
 57 
 58     public String className() {
 59         return qualifiedClassName;
 60     }
 61 
 62     public Path classFilePath() {
 63         return Path.of(qualifiedClassName.replace(&quot;.&quot;, File.separator)
 64                 + &quot;.class&quot;);
 65     }
 66 
 67     public String moduleName() {
 68         return moduleName;
 69     }
 70 
 71     public String packageName() {
 72         int lastDotIdx = qualifiedClassName.lastIndexOf(&#39;.&#39;);
 73         if (lastDotIdx == -1) {
 74             return null;
 75         }
 76         return qualifiedClassName.substring(0, lastDotIdx);
 77     }
 78 
 79     public String jarFileName() {
 80         if (bundleFileName != null &amp;&amp; bundleFileName.endsWith(&quot;.jar&quot;)) {
 81             return bundleFileName;
 82         }
 83         return null;
 84     }
 85 
 86     public String jmodFileName() {
 87         if (bundleFileName != null &amp;&amp; bundleFileName.endsWith(&quot;.jmod&quot;)) {
 88             return bundleFileName;
 89         }
 90         return null;
 91     }
 92 
 93     public boolean isWithBundleFileName() {
 94         return bundleFileName != null;
 95     }
 96 
 97     public String moduleVersion() {
 98         return moduleVersion;
 99     }
100 
101     public boolean isWithMainClass() {
102         return withMainClass;
103     }
104 
105     @Override
106     public String toString() {
107         StringBuilder sb = new StringBuilder();
108         if (bundleFileName != null) {
109             sb.append(bundleFileName).append(&#39;:&#39;);
110         }
111         if (moduleName != null) {
112             sb.append(moduleName).append(&#39;/&#39;);
113         }
114         if (qualifiedClassName != null) {
115             sb.append(qualifiedClassName);
116         }
117         if (withMainClass) {
118             sb.append(&#39;!&#39;);
119         }
120         if (moduleVersion != null) {
121             sb.append(&#39;@&#39;).append(moduleVersion);
122         }
123         return sb.toString();
124     }
125 
126     /**
127      * Create Java application description form encoded string value.
128      *
129      * Syntax of encoded Java application description is
130      * [(jar_file|jmods_file):][module_name/]qualified_class_name[!][@module_version].
131      *
132      * E.g.: `duke.jar:com.other/com.other.foo.bar.Buz!@3.7` encodes modular
133      * application. Module name is `com.other`. Main class is
134      * `com.other.foo.bar.Buz`. Module version is `3.7`. Application will be
135      * compiled and packed in `duke.jar` jar file. jar command will set module
136      * version (3.7) and main class (Buz) attributes in the jar file.
137      *
138      * E.g.: `bar.jmod:com.another/com.another.One` encodes modular
139      * application. Module name is `com.another`. Main class is
140      * `com.another.One`. Application will be
141      * compiled and packed in `bar.jmod` jmod file.
142      *
143      * E.g.: `Ciao` encodes non-modular `Ciao` class in the default package.
144      * jar command will not put main class attribute in the jar file.
145      * Default name will be picked for jar file - `hello.jar`.
146      *
147      * @param cmd jpackage command to configure
148      * @param javaAppDesc encoded Java application description
149      */
150     public static JavaAppDesc parse(final String javaAppDesc) {
151         JavaAppDesc desc = HelloApp.createDefaltAppDesc();
152 
153         if (javaAppDesc == null) {
154             return desc;
155         }
156 
157         String moduleNameAndOther = Functional.identity(() -&gt; {
158             String[] components = javaAppDesc.split(&quot;:&quot;, 2);
159             if (components.length == 2) {
160                 desc.setBundleFileName(components[0]);
161             }
162             return components[components.length - 1];
163         }).get();
164 
165         String classNameAndOther = Functional.identity(() -&gt; {
166             String[] components = moduleNameAndOther.split(&quot;/&quot;, 2);
167             if (components.length == 2) {
168                 desc.setModuleName(components[0]);
169             }
170             return components[components.length - 1];
171         }).get();
172 
173         Functional.identity(() -&gt; {
174             String[] components = classNameAndOther.split(&quot;@&quot;, 2);
175             if (components[0].endsWith(&quot;!&quot;)) {
176                 components[0] = components[0].substring(0,
177                         components[0].length() - 1);
178                 desc.setWithMainClass(true);
179             }
180             desc.setClassName(components[0]);
181             if (components.length == 2) {
182                 desc.setModuleVersion(components[1]);
183             }
184         }).run();
185 
186         if (desc.jmodFileName() != null &amp;&amp; desc.moduleName() == null) {
187             throw new IllegalArgumentException(String.format(
188                     &quot;Java Application Descriptor [%s] is invalid. Non modular app can&#39;t be packed in .jmod bundle&quot;,
189                     javaAppDesc));
190         }
191 
192         return desc;
193     }
194 
195     private String qualifiedClassName;
196     private String moduleName;
197     private String bundleFileName;
198     private String moduleVersion;
199     private boolean withMainClass;
200 }
    </pre>
  </body>
</html>