<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/tools/jpackage/linux/LinuxResourceTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.io.IOException;
 25 import java.nio.file.Path;
 26 import jdk.jpackage.test.TKit;
 27 import jdk.jpackage.test.PackageTest;
 28 import jdk.jpackage.test.PackageType;
 29 import jdk.jpackage.test.LinuxHelper;
 30 import jdk.jpackage.test.Annotations.Test;
 31 import java.util.List;
 32 
 33 /*
 34  * @test
 35  * @summary jpackage with --resource-dir
 36  * @library ../helpers
 37  * @build jdk.jpackage.test.*
 38  * @requires (os.family == &quot;linux&quot;)
 39  * @modules jdk.incubator.jpackage/jdk.incubator.jpackage.internal
 40  * @compile LinuxResourceTest.java
 41  * @run main/othervm/timeout=360 -Xmx512m jdk.jpackage.test.Main
 42  *  --jpt-run=LinuxResourceTest
 43  */
 44 
 45 public class LinuxResourceTest {
 46     @Test
 47     public static void testHardcodedProperties() throws IOException {
 48         new PackageTest()
 49         .forTypes(PackageType.LINUX)
 50         .configureHelloApp()
 51         .addInitializer(cmd -&gt; {
 52             cmd
 53             .setFakeRuntime()
 54             .saveConsoleOutput(true)
 55             .addArguments(&quot;--resource-dir&quot;, TKit.createTempDirectory(&quot;resources&quot;));
 56         })
 57         .forTypes(PackageType.LINUX_DEB)
 58         .addInitializer(cmd -&gt; {
 59             Path controlFile = Path.of(cmd.getArgumentValue(&quot;--resource-dir&quot;),
 60                     &quot;control&quot;);
 61             TKit.createTextFile(controlFile, List.of(
 62                 &quot;Package: dont-install-me&quot;,
 63                 &quot;Version: 1.2.3-R2&quot;,
 64                 &quot;Section: APPLICATION_SECTION&quot;,
 65                 &quot;Maintainer: APPLICATION_MAINTAINER&quot;,
 66                 &quot;Priority: optional&quot;,
 67                 &quot;Architecture: bar&quot;,
 68                 &quot;Provides: dont-install-me&quot;,
 69                 &quot;Description: APPLICATION_DESCRIPTION&quot;,
 70                 &quot;Installed-Size: APPLICATION_INSTALLED_SIZE&quot;,
 71                 &quot;Depends: PACKAGE_DEFAULT_DEPENDENCIES&quot;
 72             ));
 73         })
 74         .addBundleVerifier((cmd, result) -&gt; {
 75             TKit.assertTextStream(&quot;Using custom package resource [DEB control file]&quot;)
 76                     .predicate(String::startsWith)
 77                     .apply(result.getOutput().stream());
 78             TKit.assertTextStream(String.format(
 79                     &quot;Expected value of \&quot;Package\&quot; property is [%s]. Actual value in output package is [dont-install-me]&quot;,
 80                     LinuxHelper.getPackageName(cmd)))
 81                     .predicate(String::startsWith)
 82                     .apply(result.getOutput().stream());
 83             TKit.assertTextStream(
 84                     &quot;Expected value of \&quot;Version\&quot; property is [1.0-1]. Actual value in output package is [1.2.3-R2]&quot;)
 85                     .predicate(String::startsWith)
 86                     .apply(result.getOutput().stream());
 87             TKit.assertTextStream(String.format(
 88                     &quot;Expected value of \&quot;Architecture\&quot; property is [%s]. Actual value in output package is [bar]&quot;,
 89                     LinuxHelper.getDefaultPackageArch(cmd.packageType())))
 90                     .predicate(String::startsWith)
 91                     .apply(result.getOutput().stream());
 92         })
 93         .forTypes(PackageType.LINUX_RPM)
 94         .addInitializer(cmd -&gt; {
 95             Path specFile = Path.of(cmd.getArgumentValue(&quot;--resource-dir&quot;),
 96                     LinuxHelper.getPackageName(cmd) + &quot;.spec&quot;);
 97             TKit.createTextFile(specFile, List.of(
 98                 &quot;Name: dont-install-me&quot;,
 99                 &quot;Version: 1.2.3&quot;,
100                 &quot;Release: R2&quot;,
101                 &quot;Summary: APPLICATION_SUMMARY&quot;,
102                 &quot;License: APPLICATION_LICENSE_TYPE&quot;,
103                 &quot;Prefix: %{dirname:APPLICATION_DIRECTORY}&quot;,
104                 &quot;Provides: dont-install-me&quot;,
105                 &quot;%description&quot;,
106                 &quot;APPLICATION_DESCRIPTION&quot;,
107                 &quot;%prep&quot;,
108                 &quot;%build&quot;,
109                 &quot;%install&quot;,
110                 &quot;rm -rf %{buildroot}&quot;,
111                 &quot;install -d -m 755 %{buildroot}APPLICATION_DIRECTORY&quot;,
112                 &quot;cp -r %{_sourcedir}APPLICATION_DIRECTORY/* %{buildroot}APPLICATION_DIRECTORY&quot;,
113                 &quot;%files&quot;,
114                 &quot;APPLICATION_DIRECTORY&quot;
115             ));
116         })
117         .addBundleVerifier((cmd, result) -&gt; {
118             TKit.assertTextStream(&quot;Using custom package resource [RPM spec file]&quot;)
119                     .predicate(String::startsWith)
120                     .apply(result.getOutput().stream());
121             TKit.assertTextStream(String.format(
122                     &quot;Expected value of \&quot;Name\&quot; property is [%s]. Actual value in output package is [dont-install-me]&quot;,
123                     LinuxHelper.getPackageName(cmd)))
124                     .predicate(String::startsWith)
125                     .apply(result.getOutput().stream());
126             TKit.assertTextStream(
127                     &quot;Expected value of \&quot;Version\&quot; property is [1.0]. Actual value in output package is [1.2.3]&quot;)
128                     .predicate(String::startsWith)
129                     .apply(result.getOutput().stream());
130             TKit.assertTextStream(
131                     &quot;Expected value of \&quot;Release\&quot; property is [1]. Actual value in output package is [R2]&quot;)
132                     .predicate(String::startsWith)
133                     .apply(result.getOutput().stream());
134         })
135         .run();
136     }
137 }
    </pre>
  </body>
</html>