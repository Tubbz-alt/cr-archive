<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/tools/jlink/JLinkReproducibleTest.java</title>
    <link rel="stylesheet" href="../../../../style.css" />
  </head>
<body>
<center><a href="IntegrationTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="basic/BasicTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/jlink/JLinkReproducibleTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 41,19 ***</span>
          var pb = new ProcessBuilder(cmd.toArray(new String[0]));
          var res = ProcessTools.executeProcess(pb);
          res.shouldHaveExitValue(0);
      }
  
<span class="line-modified">!     private static void jlink(Path image) throws Exception {</span>
          var cmd = new ArrayList&lt;String&gt;();
          cmd.add(JDKToolFinder.getJDKTool(&quot;jlink&quot;));
          cmd.addAll(List.of(
              &quot;--module-path&quot;, JMODS_DIR.toString() + File.pathSeparator + CLASS_DIR.toString(),
              &quot;--add-modules&quot;, &quot;main&quot;,
              &quot;--compress=2&quot;,
              &quot;--output&quot;, image.toString()
          ));
          run(cmd);
      }
  
      private static void javac(String... args) throws Exception {
          var cmd = new ArrayList&lt;String&gt;();
<span class="line-new-header">--- 41,22 ---</span>
          var pb = new ProcessBuilder(cmd.toArray(new String[0]));
          var res = ProcessTools.executeProcess(pb);
          res.shouldHaveExitValue(0);
      }
  
<span class="line-modified">!     private static void jlink(Path image, boolean with_default_trace_file) throws Exception {</span>
          var cmd = new ArrayList&lt;String&gt;();
          cmd.add(JDKToolFinder.getJDKTool(&quot;jlink&quot;));
          cmd.addAll(List.of(
              &quot;--module-path&quot;, JMODS_DIR.toString() + File.pathSeparator + CLASS_DIR.toString(),
              &quot;--add-modules&quot;, &quot;main&quot;,
              &quot;--compress=2&quot;,
              &quot;--output&quot;, image.toString()
          ));
<span class="line-added">+         if (!with_default_trace_file) {</span>
<span class="line-added">+             cmd.add(&quot;--generate-jli-classes=@file-not-exists&quot;);</span>
<span class="line-added">+         }</span>
          run(cmd);
      }
  
      private static void javac(String... args) throws Exception {
          var cmd = new ArrayList&lt;String&gt;();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 96,19 ***</span>
                &quot;--module&quot;, &quot;main&quot;,
                &quot;-d&quot;, CLASS_DIR.toString());
  
          // Link the first image
          var firstImage = Path.of(&quot;image-first&quot;);
<span class="line-modified">!         jlink(firstImage);</span>
          var firstModulesFile = firstImage.resolve(&quot;lib&quot;)
                                           .resolve(&quot;modules&quot;);
  
          // Link the second image
          var secondImage = Path.of(&quot;image-second&quot;);
<span class="line-modified">!         jlink(secondImage);</span>
          var secondModulesFile = secondImage.resolve(&quot;lib&quot;)
                                             .resolve(&quot;modules&quot;);
  
          // Ensure module files are identical
          assertEquals(-1L, Files.mismatch(firstModulesFile, secondModulesFile));
      }
  }
<span class="line-new-header">--- 99,33 ---</span>
                &quot;--module&quot;, &quot;main&quot;,
                &quot;-d&quot;, CLASS_DIR.toString());
  
          // Link the first image
          var firstImage = Path.of(&quot;image-first&quot;);
<span class="line-modified">!         jlink(firstImage, true);</span>
          var firstModulesFile = firstImage.resolve(&quot;lib&quot;)
                                           .resolve(&quot;modules&quot;);
  
          // Link the second image
          var secondImage = Path.of(&quot;image-second&quot;);
<span class="line-modified">!         jlink(secondImage, true);</span>
          var secondModulesFile = secondImage.resolve(&quot;lib&quot;)
                                             .resolve(&quot;modules&quot;);
  
          // Ensure module files are identical
          assertEquals(-1L, Files.mismatch(firstModulesFile, secondModulesFile));
<span class="line-added">+ </span>
<span class="line-added">+         // Link the third image</span>
<span class="line-added">+         var thirdImage = Path.of(&quot;image-third&quot;);</span>
<span class="line-added">+         jlink(thirdImage, false);</span>
<span class="line-added">+         var thirdModulesFile = thirdImage.resolve(&quot;lib&quot;)</span>
<span class="line-added">+                                          .resolve(&quot;modules&quot;);</span>
<span class="line-added">+         // Link the fourth image</span>
<span class="line-added">+         var fourthImage = Path.of(&quot;image-fourth&quot;);</span>
<span class="line-added">+         jlink(fourthImage, false);</span>
<span class="line-added">+         var fourthModulesFile = fourthImage.resolve(&quot;lib&quot;)</span>
<span class="line-added">+                                            .resolve(&quot;modules&quot;);</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Ensure module files are identical</span>
<span class="line-added">+         assertEquals(-1L, Files.mismatch(thirdModulesFile, fourthModulesFile));</span>
      }
  }
</pre>
<center><a href="IntegrationTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../index.html" target="_top">index</a> <a href="basic/BasicTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>