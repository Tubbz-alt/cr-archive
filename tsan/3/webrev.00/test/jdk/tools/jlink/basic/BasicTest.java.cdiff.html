<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/tools/jlink/basic/BasicTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../JLinkReproducibleTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../plugins/ExcludeVMPluginTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/tools/jlink/basic/BasicTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 98,19 ***</span>
  
          image = Paths.get(&quot;myimage&quot;);
          runJmod(classes.toString(), TEST_MODULE, true);
          runJlink(image, TEST_MODULE, &quot;--launcher&quot;, &quot;bar=&quot; + TEST_MODULE);
          execute(image, &quot;bar&quot;);
<span class="line-removed">- </span>
          Files.delete(jmods.resolve(TEST_MODULE + &quot;.jmod&quot;));
  
          image = Paths.get(&quot;myimage2&quot;);
          runJmod(classes.toString(), TEST_MODULE, false /* no ModuleMainClass! */);
          // specify main class in --launcher command line
          runJlink(image, TEST_MODULE, &quot;--launcher&quot;, &quot;bar2=&quot; + TEST_MODULE + &quot;/jdk.test.Test&quot;);
          execute(image, &quot;bar2&quot;);
  
      }
  
      private void execute(Path image, String scriptName) throws Throwable {
          String cmd = image.resolve(&quot;bin&quot;).resolve(scriptName).toString();
          OutputAnalyzer analyzer;
<span class="line-new-header">--- 98,39 ---</span>
  
          image = Paths.get(&quot;myimage&quot;);
          runJmod(classes.toString(), TEST_MODULE, true);
          runJlink(image, TEST_MODULE, &quot;--launcher&quot;, &quot;bar=&quot; + TEST_MODULE);
          execute(image, &quot;bar&quot;);
          Files.delete(jmods.resolve(TEST_MODULE + &quot;.jmod&quot;));
  
          image = Paths.get(&quot;myimage2&quot;);
          runJmod(classes.toString(), TEST_MODULE, false /* no ModuleMainClass! */);
          // specify main class in --launcher command line
          runJlink(image, TEST_MODULE, &quot;--launcher&quot;, &quot;bar2=&quot; + TEST_MODULE + &quot;/jdk.test.Test&quot;);
          execute(image, &quot;bar2&quot;);
<span class="line-added">+         Files.delete(jmods.resolve(TEST_MODULE + &quot;.jmod&quot;));</span>
<span class="line-added">+ </span>
<span class="line-added">+         image = Paths.get(&quot;myadder&quot;);</span>
<span class="line-added">+         runJmod(classes.toString(), TEST_MODULE, false /* no ModuleMainClass! */);</span>
<span class="line-added">+         // specify main class in --launcher command line</span>
<span class="line-added">+         runJlink(image, TEST_MODULE, &quot;--launcher&quot;, &quot;adder=&quot; + TEST_MODULE + &quot;/jdk.test.Adder&quot;);</span>
<span class="line-added">+         addAndCheck(image, &quot;adder&quot;);</span>
<span class="line-added">+     }</span>
  
<span class="line-added">+     private void addAndCheck(Path image, String scriptName) throws Throwable {</span>
<span class="line-added">+         String cmd = image.resolve(&quot;bin&quot;).resolve(scriptName).toString();</span>
<span class="line-added">+         OutputAnalyzer analyzer;</span>
<span class="line-added">+         if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
<span class="line-added">+             analyzer = ProcessTools.executeProcess(&quot;sh.exe&quot;, cmd, &quot;12&quot;, &quot;8&quot;, &quot;7&quot;, &quot;--&quot;, &quot;foo bar&quot;);</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             analyzer = ProcessTools.executeProcess(cmd, &quot;12&quot;, &quot;8&quot;, &quot;7&quot;, &quot;--&quot;, &quot;foo bar&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (analyzer.getExitValue() != 27) {</span>
<span class="line-added">+             throw new AssertionError(&quot;Image invocation failed: expected 27, rc=&quot; + analyzer.getExitValue());</span>
<span class="line-added">+         }</span>
<span class="line-added">+         // last argument contains space and should be properly quoted.</span>
<span class="line-added">+         analyzer.stdoutShouldContain(&quot;Num args: 5&quot;);</span>
      }
  
      private void execute(Path image, String scriptName) throws Throwable {
          String cmd = image.resolve(&quot;bin&quot;).resolve(scriptName).toString();
          OutputAnalyzer analyzer;
</pre>
<center><a href="../JLinkReproducibleTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../plugins/ExcludeVMPluginTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>