<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/jdk/modules/etc/DefaultModules.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../jfr/tool/TestPrint.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="JdkQualifiedExportTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/modules/etc/DefaultModules.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 42 import jdk.test.lib.process.ProcessTools;
 43 
 44 /**
 45  * This test compiles and runs the following tests on the class path:
 46  *
 47  *   TestRootModules.java.java - tests that every module that exports an API
 48  *       is resolved. Also tests that java.se is not resolved.
 49  *
 50  *   TestJson.java - exercises APIs exported by the java.json module. The
 51  *       java.json module is not a Java SE module.
 52  */
 53 
 54 public class DefaultModules {
 55     private static final PrintStream out = System.out;
 56 
 57     public static void main(String[] args) throws Exception {
 58         String javaHome = System.getProperty(&quot;java.home&quot;);
 59         String testSrc = System.getProperty(&quot;test.src&quot;);
 60 
 61         // $JDK_HOME/bin/java TestModules.java
<span class="line-modified"> 62         String source = Path.of(testSrc, &quot;src&quot;, &quot;TestRootModules.java&quot;).toString();</span>
<span class="line-modified"> 63         ProcessTools.executeTestJava(source)</span>
 64                 .outputTo(System.out)
 65                 .errorTo(System.err)
 66                 .shouldHaveExitValue(0);
 67 
 68         /**
 69          * Create a run-time image containing java.se, java.json and the javac
 70          * compiler. Use the run-time image to compile and run both
 71          * TestModules.java and JsonTest.java
 72          */
 73         if (Files.exists(Path.of(javaHome, &quot;jmods&quot;, &quot;java.se.jmod&quot;))) {
 74             // jlink --add-modules java.se,java.json,jdk.compiler,jdk.zipfs
 75             Path here = Path.of(&quot;.&quot;);
 76             Path image = Files.createTempDirectory(here, &quot;images&quot;).resolve(&quot;myimage&quot;);
 77             ToolProvider jlink = ToolProvider.findFirst(&quot;jlink&quot;)
 78                     .orElseThrow(() -&gt; new RuntimeException(&quot;jlink not found&quot;));
 79             int exitCode = jlink.run(System.out, System.err,
 80                     &quot;--module-path&quot;, System.getProperty(&quot;test.module.path&quot;),
 81                     &quot;--add-modules&quot;, &quot;java.se,java.json,jdk.compiler,jdk.zipfs&quot;,
 82                     &quot;--output&quot;, image.toString());
 83             if (exitCode != 0)
 84                 throw new RuntimeException(&quot;jlink failed&quot;);
 85 
 86             // path to java launcher in run-time image
 87             String javaLauncher = image.resolve(&quot;bin&quot;).resolve(&quot;java&quot;).toString();
 88             if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;))
 89                 javaLauncher += &quot;.exe&quot;;
 90 
 91             // $CUSTOM_JDK/bin/java TestRootModules.java
<span class="line-modified"> 92             source = Path.of(testSrc, &quot;src&quot;, &quot;TestRootModules.java&quot;).toString();</span>
<span class="line-modified"> 93             out.format(&quot;Command line: [%s %s]%n&quot;, javaLauncher, source);</span>
<span class="line-modified"> 94             ProcessTools.executeProcess(new ProcessBuilder(javaLauncher, source))</span>



 95                     .outputTo(System.out)
 96                     .errorTo(System.err)
 97                     .shouldHaveExitValue(0);
 98 
 99             // $CUSTOM_JDK/bin/java TestJson.java
<span class="line-modified">100             source = Path.of(testSrc, &quot;src&quot;, &quot;TestJson.java&quot;).toString();</span>
101             out.format(&quot;Command line: [%s %s]%n&quot;, javaLauncher, source);
102             ProcessTools.executeProcess(new ProcessBuilder(javaLauncher, source))
103                     .outputTo(System.out)
104                     .errorTo(System.err)
105                     .shouldHaveExitValue(0);
106         }
107     }
108 }
</pre>
</td>
<td>
<hr />
<pre>
 42 import jdk.test.lib.process.ProcessTools;
 43 
 44 /**
 45  * This test compiles and runs the following tests on the class path:
 46  *
 47  *   TestRootModules.java.java - tests that every module that exports an API
 48  *       is resolved. Also tests that java.se is not resolved.
 49  *
 50  *   TestJson.java - exercises APIs exported by the java.json module. The
 51  *       java.json module is not a Java SE module.
 52  */
 53 
 54 public class DefaultModules {
 55     private static final PrintStream out = System.out;
 56 
 57     public static void main(String[] args) throws Exception {
 58         String javaHome = System.getProperty(&quot;java.home&quot;);
 59         String testSrc = System.getProperty(&quot;test.src&quot;);
 60 
 61         // $JDK_HOME/bin/java TestModules.java
<span class="line-modified"> 62         String source = Path.of(testSrc, &quot;TestRootModules.java&quot;).toString();</span>
<span class="line-modified"> 63         ProcessTools.executeTestJava(&quot;--add-exports&quot;, &quot;java.base/jdk.internal.module=ALL-UNNAMED&quot;, source)</span>
 64                 .outputTo(System.out)
 65                 .errorTo(System.err)
 66                 .shouldHaveExitValue(0);
 67 
 68         /**
 69          * Create a run-time image containing java.se, java.json and the javac
 70          * compiler. Use the run-time image to compile and run both
 71          * TestModules.java and JsonTest.java
 72          */
 73         if (Files.exists(Path.of(javaHome, &quot;jmods&quot;, &quot;java.se.jmod&quot;))) {
 74             // jlink --add-modules java.se,java.json,jdk.compiler,jdk.zipfs
 75             Path here = Path.of(&quot;.&quot;);
 76             Path image = Files.createTempDirectory(here, &quot;images&quot;).resolve(&quot;myimage&quot;);
 77             ToolProvider jlink = ToolProvider.findFirst(&quot;jlink&quot;)
 78                     .orElseThrow(() -&gt; new RuntimeException(&quot;jlink not found&quot;));
 79             int exitCode = jlink.run(System.out, System.err,
 80                     &quot;--module-path&quot;, System.getProperty(&quot;test.module.path&quot;),
 81                     &quot;--add-modules&quot;, &quot;java.se,java.json,jdk.compiler,jdk.zipfs&quot;,
 82                     &quot;--output&quot;, image.toString());
 83             if (exitCode != 0)
 84                 throw new RuntimeException(&quot;jlink failed&quot;);
 85 
 86             // path to java launcher in run-time image
 87             String javaLauncher = image.resolve(&quot;bin&quot;).resolve(&quot;java&quot;).toString();
 88             if (System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;))
 89                 javaLauncher += &quot;.exe&quot;;
 90 
 91             // $CUSTOM_JDK/bin/java TestRootModules.java
<span class="line-modified"> 92             source = Path.of(testSrc, &quot;TestRootModules.java&quot;).toString();</span>
<span class="line-modified"> 93             ProcessBuilder pb = new ProcessBuilder(javaLauncher,</span>
<span class="line-modified"> 94                     &quot;--add-exports&quot;, &quot;java.base/jdk.internal.module=ALL-UNNAMED&quot;,</span>
<span class="line-added"> 95                     source);</span>
<span class="line-added"> 96             out.format(&quot;Command line: [%s]%n&quot;, pb.command());</span>
<span class="line-added"> 97             ProcessTools.executeProcess(pb)</span>
 98                     .outputTo(System.out)
 99                     .errorTo(System.err)
100                     .shouldHaveExitValue(0);
101 
102             // $CUSTOM_JDK/bin/java TestJson.java
<span class="line-modified">103             source = Path.of(testSrc, &quot;TestJson.java&quot;).toString();</span>
104             out.format(&quot;Command line: [%s %s]%n&quot;, javaLauncher, source);
105             ProcessTools.executeProcess(new ProcessBuilder(javaLauncher, source))
106                     .outputTo(System.out)
107                     .errorTo(System.err)
108                     .shouldHaveExitValue(0);
109         }
110     }
111 }
</pre>
</td>
</tr>
</table>
<center><a href="../../jfr/tool/TestPrint.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="JdkQualifiedExportTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>