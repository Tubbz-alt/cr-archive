<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/jdk/internal/jrtfs/Basic.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../jimage/TEST.properties.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../loader/URLClassPath/JarClassPathFileEntry.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/internal/jrtfs/Basic.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @summary Basic test of jrt file system provider
 27  * @run testng Basic
 28  */
 29 
 30 import java.io.InputStream;

 31 import java.io.IOException;
 32 import java.io.DataInputStream;
 33 import java.nio.file.DirectoryStream;
 34 import java.nio.file.InvalidPathException;
 35 import java.nio.file.Files;
 36 import java.nio.file.FileSystem;
 37 import java.nio.file.FileSystems;
 38 import java.nio.file.Path;
 39 import java.nio.file.PathMatcher;
 40 import java.nio.file.Paths;
 41 import java.net.URI;
 42 import java.util.Collections;
 43 import java.util.HashMap;
 44 import java.util.Iterator;
 45 import java.util.Map;
 46 import java.util.NoSuchElementException;
 47 import java.util.stream.Stream;
 48 
 49 import org.testng.annotations.AfterClass;
 50 import org.testng.annotations.BeforeClass;
</pre>
<hr />
<pre>
254     }
255 
256     @Test(dataProvider = &quot;topLevelPkgDirs&quot;)
257     public void testNotExists(String path) throws Exception {
258         FileSystem fs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));
259         Path dir = fs.getPath(path);
260 
261         // package directories should not be there at top level
262         assertTrue(Files.notExists(dir));
263     }
264 
265     /**
266      * Test the URI of every file in the jrt file system
267      */
268     @Test
269     public void testToAndFromUri() throws Exception {
270         FileSystem fs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));
271         Path top = fs.getPath(&quot;/&quot;);
272         try (Stream&lt;Path&gt; stream = Files.walk(top)) {
273             stream.forEach(path -&gt; {
<span class="line-modified">274                 URI u = path.toUri();</span>








275                 assertTrue(u.getScheme().equalsIgnoreCase(&quot;jrt&quot;));
276                 assertFalse(u.isOpaque());
277                 assertTrue(u.getAuthority() == null);
<span class="line-modified">278                 assertEquals(u.getPath(), path.toAbsolutePath().toString());</span>





279                 Path p = Paths.get(u);
280                 assertEquals(p, path);
281             });
282         }
283     }
284 






























285     @Test
286     public void testDirectoryNames() throws Exception {
287         FileSystem fs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));
288         Path top = fs.getPath(&quot;/&quot;);
289         // check that directory names do not have trailing &#39;/&#39; char
290         try (Stream&lt;Path&gt; stream = Files.walk(top)) {
291             stream.skip(1).filter(Files::isDirectory).forEach(path -&gt; {
292                 assertFalse(path.toString().endsWith(&quot;/&quot;));
293             });
294         }
295     }
296 
297     @DataProvider(name = &quot;pathPrefixs&quot;)
298     private Object[][] pathPrefixes() {
299         return new Object[][] {
300             { &quot;/&quot;                       },
301             { &quot;modules/java.base/java/lang&quot;     },
302             { &quot;./modules/java.base/java/lang&quot;   },
303             { &quot;/modules/java.base/java/lang&quot;    },
304             { &quot;/./modules/java.base/java/lang&quot;  },
</pre>
</td>
<td>
<hr />
<pre>
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @summary Basic test of jrt file system provider
 27  * @run testng Basic
 28  */
 29 
 30 import java.io.InputStream;
<span class="line-added"> 31 import java.io.IOError;</span>
 32 import java.io.IOException;
 33 import java.io.DataInputStream;
 34 import java.nio.file.DirectoryStream;
 35 import java.nio.file.InvalidPathException;
 36 import java.nio.file.Files;
 37 import java.nio.file.FileSystem;
 38 import java.nio.file.FileSystems;
 39 import java.nio.file.Path;
 40 import java.nio.file.PathMatcher;
 41 import java.nio.file.Paths;
 42 import java.net.URI;
 43 import java.util.Collections;
 44 import java.util.HashMap;
 45 import java.util.Iterator;
 46 import java.util.Map;
 47 import java.util.NoSuchElementException;
 48 import java.util.stream.Stream;
 49 
 50 import org.testng.annotations.AfterClass;
 51 import org.testng.annotations.BeforeClass;
</pre>
<hr />
<pre>
255     }
256 
257     @Test(dataProvider = &quot;topLevelPkgDirs&quot;)
258     public void testNotExists(String path) throws Exception {
259         FileSystem fs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));
260         Path dir = fs.getPath(path);
261 
262         // package directories should not be there at top level
263         assertTrue(Files.notExists(dir));
264     }
265 
266     /**
267      * Test the URI of every file in the jrt file system
268      */
269     @Test
270     public void testToAndFromUri() throws Exception {
271         FileSystem fs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));
272         Path top = fs.getPath(&quot;/&quot;);
273         try (Stream&lt;Path&gt; stream = Files.walk(top)) {
274             stream.forEach(path -&gt; {
<span class="line-modified">275                 String pathStr = path.toAbsolutePath().toString();</span>
<span class="line-added">276                 URI u = null;</span>
<span class="line-added">277                 try {</span>
<span class="line-added">278                     u = path.toUri();</span>
<span class="line-added">279                 } catch (IOError e) {</span>
<span class="line-added">280                     assertFalse(pathStr.startsWith(&quot;/modules&quot;));</span>
<span class="line-added">281                     return;</span>
<span class="line-added">282                 }</span>
<span class="line-added">283 </span>
284                 assertTrue(u.getScheme().equalsIgnoreCase(&quot;jrt&quot;));
285                 assertFalse(u.isOpaque());
286                 assertTrue(u.getAuthority() == null);
<span class="line-modified">287 </span>
<span class="line-added">288                 pathStr = pathStr.substring(&quot;/modules&quot;.length());</span>
<span class="line-added">289                 if (pathStr.isEmpty()) {</span>
<span class="line-added">290                     pathStr = &quot;/&quot;;</span>
<span class="line-added">291                 }</span>
<span class="line-added">292                 assertEquals(u.getPath(), pathStr);</span>
293                 Path p = Paths.get(u);
294                 assertEquals(p, path);
295             });
296         }
297     }
298 
<span class="line-added">299     // @bug 8216553: JrtFIleSystemProvider getPath(URI) omits /modules element from file path</span>
<span class="line-added">300     @Test</span>
<span class="line-added">301     public void testPathToURIConversion() throws Exception {</span>
<span class="line-added">302         var uri = URI.create(&quot;jrt:/java.base/module-info.class&quot;);</span>
<span class="line-added">303         var path = Path.of(uri);</span>
<span class="line-added">304         assertTrue(Files.exists(path));</span>
<span class="line-added">305 </span>
<span class="line-added">306         uri = URI.create(&quot;jrt:/java.base/../java.base/module-info.class&quot;);</span>
<span class="line-added">307         boolean seenIAE = false;</span>
<span class="line-added">308         try {</span>
<span class="line-added">309             Path.of(uri);</span>
<span class="line-added">310         } catch (IllegalArgumentException iaExp) {</span>
<span class="line-added">311             seenIAE = true;</span>
<span class="line-added">312         }</span>
<span class="line-added">313         assertTrue(seenIAE);</span>
<span class="line-added">314 </span>
<span class="line-added">315         // check round-trip</span>
<span class="line-added">316         var jrtfs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));</span>
<span class="line-added">317         assertTrue(Files.exists(jrtfs.getPath(path.toString())));</span>
<span class="line-added">318 </span>
<span class="line-added">319         path = jrtfs.getPath(&quot;/modules/../modules/java.base/&quot;);</span>
<span class="line-added">320         boolean seenIOError = false;</span>
<span class="line-added">321         try {</span>
<span class="line-added">322             path.toUri();</span>
<span class="line-added">323         } catch (IOError ioError) {</span>
<span class="line-added">324             seenIOError = true;</span>
<span class="line-added">325         }</span>
<span class="line-added">326         assertTrue(seenIOError);</span>
<span class="line-added">327     }</span>
<span class="line-added">328 </span>
329     @Test
330     public void testDirectoryNames() throws Exception {
331         FileSystem fs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));
332         Path top = fs.getPath(&quot;/&quot;);
333         // check that directory names do not have trailing &#39;/&#39; char
334         try (Stream&lt;Path&gt; stream = Files.walk(top)) {
335             stream.skip(1).filter(Files::isDirectory).forEach(path -&gt; {
336                 assertFalse(path.toString().endsWith(&quot;/&quot;));
337             });
338         }
339     }
340 
341     @DataProvider(name = &quot;pathPrefixs&quot;)
342     private Object[][] pathPrefixes() {
343         return new Object[][] {
344             { &quot;/&quot;                       },
345             { &quot;modules/java.base/java/lang&quot;     },
346             { &quot;./modules/java.base/java/lang&quot;   },
347             { &quot;/modules/java.base/java/lang&quot;    },
348             { &quot;/./modules/java.base/java/lang&quot;  },
</pre>
</td>
</tr>
</table>
<center><a href="../jimage/TEST.properties.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../loader/URLClassPath/JarClassPathFileEntry.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>