<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/jdk/internal/jrtfs/Basic.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../jimage/TEST.properties.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../loader/URLClassPath/JarClassPathFileEntry.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/internal/jrtfs/Basic.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,10 +26,11 @@</span>
   * @summary Basic test of jrt file system provider
   * @run testng Basic
   */
  
  import java.io.InputStream;
<span class="udiff-line-added">+ import java.io.IOError;</span>
  import java.io.IOException;
  import java.io.DataInputStream;
  import java.nio.file.DirectoryStream;
  import java.nio.file.InvalidPathException;
  import java.nio.file.Files;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -269,21 +270,64 @@</span>
      public void testToAndFromUri() throws Exception {
          FileSystem fs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));
          Path top = fs.getPath(&quot;/&quot;);
          try (Stream&lt;Path&gt; stream = Files.walk(top)) {
              stream.forEach(path -&gt; {
<span class="udiff-line-modified-removed">-                 URI u = path.toUri();</span>
<span class="udiff-line-modified-added">+                 String pathStr = path.toAbsolutePath().toString();</span>
<span class="udiff-line-added">+                 URI u = null;</span>
<span class="udiff-line-added">+                 try {</span>
<span class="udiff-line-added">+                     u = path.toUri();</span>
<span class="udiff-line-added">+                 } catch (IOError e) {</span>
<span class="udiff-line-added">+                     assertFalse(pathStr.startsWith(&quot;/modules&quot;));</span>
<span class="udiff-line-added">+                     return;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+ </span>
                  assertTrue(u.getScheme().equalsIgnoreCase(&quot;jrt&quot;));
                  assertFalse(u.isOpaque());
                  assertTrue(u.getAuthority() == null);
<span class="udiff-line-modified-removed">-                 assertEquals(u.getPath(), path.toAbsolutePath().toString());</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+                 pathStr = pathStr.substring(&quot;/modules&quot;.length());</span>
<span class="udiff-line-added">+                 if (pathStr.isEmpty()) {</span>
<span class="udiff-line-added">+                     pathStr = &quot;/&quot;;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 assertEquals(u.getPath(), pathStr);</span>
                  Path p = Paths.get(u);
                  assertEquals(p, path);
              });
          }
      }
  
<span class="udiff-line-added">+     // @bug 8216553: JrtFIleSystemProvider getPath(URI) omits /modules element from file path</span>
<span class="udiff-line-added">+     @Test</span>
<span class="udiff-line-added">+     public void testPathToURIConversion() throws Exception {</span>
<span class="udiff-line-added">+         var uri = URI.create(&quot;jrt:/java.base/module-info.class&quot;);</span>
<span class="udiff-line-added">+         var path = Path.of(uri);</span>
<span class="udiff-line-added">+         assertTrue(Files.exists(path));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         uri = URI.create(&quot;jrt:/java.base/../java.base/module-info.class&quot;);</span>
<span class="udiff-line-added">+         boolean seenIAE = false;</span>
<span class="udiff-line-added">+         try {</span>
<span class="udiff-line-added">+             Path.of(uri);</span>
<span class="udiff-line-added">+         } catch (IllegalArgumentException iaExp) {</span>
<span class="udiff-line-added">+             seenIAE = true;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         assertTrue(seenIAE);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // check round-trip</span>
<span class="udiff-line-added">+         var jrtfs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));</span>
<span class="udiff-line-added">+         assertTrue(Files.exists(jrtfs.getPath(path.toString())));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         path = jrtfs.getPath(&quot;/modules/../modules/java.base/&quot;);</span>
<span class="udiff-line-added">+         boolean seenIOError = false;</span>
<span class="udiff-line-added">+         try {</span>
<span class="udiff-line-added">+             path.toUri();</span>
<span class="udiff-line-added">+         } catch (IOError ioError) {</span>
<span class="udiff-line-added">+             seenIOError = true;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         assertTrue(seenIOError);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      @Test
      public void testDirectoryNames() throws Exception {
          FileSystem fs = FileSystems.getFileSystem(URI.create(&quot;jrt:/&quot;));
          Path top = fs.getPath(&quot;/&quot;);
          // check that directory names do not have trailing &#39;/&#39; char
</pre>
<center><a href="../jimage/TEST.properties.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../loader/URLClassPath/JarClassPathFileEntry.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>