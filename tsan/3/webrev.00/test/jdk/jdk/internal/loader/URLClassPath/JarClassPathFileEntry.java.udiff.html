<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/jdk/internal/loader/URLClassPath/JarClassPathFileEntry.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../jrtfs/Basic.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../platform/cgroup/TestCgroupMetrics.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/internal/loader/URLClassPath/JarClassPathFileEntry.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -31,12 +31,12 @@</span>
  import jdk.test.lib.util.JarUtils;
  import jdk.test.lib.compiler.InMemoryJavaCompiler;
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8216401</span>
<span class="udiff-line-modified-removed">-  * @summary Test loading of JAR Class-Path entry with file: scheme</span>
<span class="udiff-line-modified-added">+  * @bug 8216401 8235361</span>
<span class="udiff-line-modified-added">+  * @summary Test classloading via JAR Class-Path entries</span>
   * @library /test/lib
   *
   * @run main/othervm JarClassPathFileEntry
   * @run main/othervm -Djdk.net.URLClassPath.disableClassPathURLCheck=true JarClassPathFileEntry
   * @run main/othervm -Djdk.net.URLClassPath.disableClassPathURLCheck=false JarClassPathFileEntry
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -50,10 +50,23 @@</span>
  
      private final static Path OTHER_JAR_PATH = Paths.get(OTHER_DIR, &quot;Other.jar&quot;);
      private final static Path CONTEXT_JAR_PATH = Paths.get(TEST_CLASSES, &quot;Context.jar&quot;);
  
      public static void main(String[] args) throws Throwable {
<span class="udiff-line-added">+         String fileScheme = &quot;file:&quot; + (IS_WINDOWS ? toUnixPath(OTHER_JAR_PATH.toString())</span>
<span class="udiff-line-added">+                                                       :        OTHER_JAR_PATH.toString());</span>
<span class="udiff-line-added">+         doTest(fileScheme);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (IS_WINDOWS) {</span>
<span class="udiff-line-added">+             // Relative URL encoding of absolute path, e.g. /C:\\path\\to\\file.jar</span>
<span class="udiff-line-added">+             String driveLetter = &quot;/&quot; + OTHER_JAR_PATH;</span>
<span class="udiff-line-added">+             doTest(driveLetter);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /* Load a class from Other.jar via the given Class-Path entry */</span>
<span class="udiff-line-added">+     private static void doTest(String classPathEntry) throws Throwable {</span>
          // Create Other.class in OTHER_DIR, off the default classpath
          byte klassbuf[] = InMemoryJavaCompiler.compile(&quot;Other&quot;,
                                                         &quot;public class Other {}&quot;);
          ClassFileInstaller.writeClassToDisk(&quot;Other&quot;, klassbuf, OTHER_DIR);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -70,12 +83,10 @@</span>
          // Create Context.jar w/ &quot;file:&quot; entry for Other.jar
          Manifest mf = new Manifest();
          Attributes attrs = mf.getMainAttributes();
          attrs.put(Attributes.Name.MANIFEST_VERSION, &quot;1.0&quot;);
  
<span class="udiff-line-removed">-         String classPathEntry = &quot;file:&quot; + (IS_WINDOWS ? toUnixPath(OTHER_JAR_PATH.toString())</span>
<span class="udiff-line-removed">-                                                       :            OTHER_JAR_PATH.toString());</span>
          attrs.put(Attributes.Name.CLASS_PATH, classPathEntry);
  
          System.out.println(&quot;Creating Context.jar with Class-Path: &quot; + classPathEntry);
          JarUtils.createJarFile(CONTEXT_JAR_PATH, mf,
                                 Paths.get(TEST_CLASSES),
</pre>
<center><a href="../../jrtfs/Basic.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../platform/cgroup/TestCgroupMetrics.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>