<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/jdk/nio/zipfs/PathOps.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2009, 2011, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import java.io.IOException;
 25 import java.nio.file.FileSystem;
 26 import java.nio.file.FileSystems;
 27 import java.nio.file.Files;
 28 import java.nio.file.InvalidPathException;
 29 import java.nio.file.Path;
 30 import java.nio.file.Paths;
 31 import java.nio.file.ProviderMismatchException;
 32 
 33 /**
 34  *
 35  * @test
 36  * @bug 8038500 8040059 8139956 8146754 8172921 8186142
 37  * @summary Tests path operations for zip provider.
 38  *
 39  * @modules jdk.zipfs
 40  * @run main PathOps
 41  * @run main/othervm/java.security.policy=test.policy PathOps
 42  */
 43 
 44 public class PathOps {
 45 
 46     static final java.io.PrintStream out = System.out;
 47     static FileSystem fs;
 48 
<a name="2" id="anc2"></a><span class="line-removed"> 49     private String input;</span>
 50     private Path path;
 51     private Exception exc;
 52 
 53     private PathOps(String first, String... more) {
 54         out.println();
<a name="3" id="anc3"></a><span class="line-removed"> 55         input = first;</span>
 56         try {
 57             path = fs.getPath(first, more);
 58             out.format(&quot;%s -&gt; %s&quot;, first, path);
 59         } catch (Exception x) {
 60             exc = x;
 61             out.format(&quot;%s -&gt; %s&quot;, first, x);
 62         }
 63         out.println();
 64     }
 65 
 66     Path path() {
 67         return path;
 68     }
 69 
 70     void fail() {
 71         throw new RuntimeException(&quot;PathOps failed&quot;);
 72     }
 73 
 74     void checkPath() {
 75         if (path == null) {
 76             throw new InternalError(&quot;path is null&quot;);
 77         }
 78     }
 79 
 80     void check(Object result, String expected) {
 81         out.format(&quot;\tExpected: %s\n&quot;, expected);
 82         out.format(&quot;\tActual: %s\n&quot;,  result);
 83         if (result == null) {
 84             if (expected == null) return;
 85         } else {
 86             // compare string representations
 87             if (expected != null &amp;&amp; result.toString().equals(expected.toString()))
 88                 return;
 89         }
 90         fail();
 91     }
 92 
 93     void check(Object result, boolean expected) {
 94         check(result, Boolean.toString(expected));
 95     }
 96 
 97     PathOps root(String expected) {
 98         out.println(&quot;check root&quot;);
 99         checkPath();
100         check(path.getRoot(), expected);
101         return this;
102     }
103 
104     PathOps parent(String expected) {
105         out.println(&quot;check parent&quot;);
106         checkPath();
107         check(path.getParent(), expected);
108         return this;
109     }
110 
111     PathOps name(String expected) {
112         out.println(&quot;check name&quot;);
113         checkPath();
114         check(path.getFileName(), expected);
115         return this;
116     }
117 
118     PathOps element(int index, String expected) {
119         out.format(&quot;check element %d\n&quot;, index);
120         checkPath();
121         check(path.getName(index), expected);
122         return this;
123     }
124 
125     PathOps subpath(int startIndex, int endIndex, String expected) {
126         out.format(&quot;test subpath(%d,%d)\n&quot;, startIndex, endIndex);
127         checkPath();
128         check(path.subpath(startIndex, endIndex), expected);
129         return this;
130     }
131 
132     PathOps starts(String prefix) {
133         out.format(&quot;test startsWith with %s\n&quot;, prefix);
134         checkPath();
135         Path s = fs.getPath(prefix);
136         check(path.startsWith(s), true);
137         return this;
138     }
139 
140     PathOps notStarts(String prefix) {
141         out.format(&quot;test not startsWith with %s\n&quot;, prefix);
142         checkPath();
143         Path s = fs.getPath(prefix);
144         check(path.startsWith(s), false);
145         return this;
146     }
147 
148     PathOps ends(String suffix) {
149         out.format(&quot;test endsWith %s\n&quot;, suffix);
150         checkPath();
151         Path s = fs.getPath(suffix);
152         check(path.endsWith(s), true);
153         return this;
154     }
155 
156     PathOps notEnds(String suffix) {
157         out.format(&quot;test not endsWith %s\n&quot;, suffix);
158         checkPath();
159         Path s = fs.getPath(suffix);
160         check(path.endsWith(s), false);
161         return this;
162     }
163 
164     PathOps absolute() {
165         out.println(&quot;check path is absolute&quot;);
166         checkPath();
167         check(path.isAbsolute(), true);
168         return this;
169     }
170 
171     PathOps notAbsolute() {
172         out.println(&quot;check path is not absolute&quot;);
173         checkPath();
174         check(path.isAbsolute(), false);
175         return this;
176     }
177 
178     PathOps resolve(String other, String expected) {
179         out.format(&quot;test resolve %s\n&quot;, other);
180         checkPath();
181         check(path.resolve(other), expected);
182         return this;
183     }
184 
185     PathOps resolvePath(String other, String expected) {
186         out.format(&quot;test resolve %s\n&quot;, other);
187         checkPath();
188         check(path.resolve(fs.getPath(other)), expected);
189         return this;
190     }
191 
192     PathOps resolveSibling(String other, String expected) {
193         out.format(&quot;test resolveSibling %s\n&quot;, other);
194         checkPath();
195         check(path.resolveSibling(other), expected);
196         return this;
197     }
198 
199     PathOps relativize(String other, String expected) {
200         out.format(&quot;test relativize %s\n&quot;, other);
201         checkPath();
202         Path that = fs.getPath(other);
203         check(path.relativize(that), expected);
204         return this;
205     }
206 
207     PathOps normalize(String expected) {
208         out.println(&quot;check normalized path&quot;);
209         checkPath();
210         check(path.normalize(), expected);
211         return this;
212     }
213 
214     PathOps string(String expected) {
215         out.println(&quot;check string representation&quot;);
216         checkPath();
217         check(path, expected);
218         return this;
219     }
220 
221     PathOps isSameFile(String target) {
222         try {
223             out.println(&quot;check two paths are same&quot;);
224             checkPath();
225             check(Files.isSameFile(path, test(target).path()), true);
226         } catch (IOException ioe) {
227             fail();
228         }
229         return this;
230     }
231 
232     PathOps invalid() {
233         if (!(exc instanceof InvalidPathException)) {
234             out.println(&quot;InvalidPathException not thrown as expected&quot;);
235             fail();
236         }
237         return this;
238     }
239 
240     static PathOps test(String s) {
241         return new PathOps(s);
242     }
243 
244     static PathOps test(String first, String... more) {
245         return new PathOps(first, more);
246     }
247 
248     // -- PathOpss --
249 
250     static void header(String s) {
251         out.println();
252         out.println();
253         out.println(&quot;-- &quot; + s + &quot; --&quot;);
254     }
255 
256     static void doPathOpTests() {
257         header(&quot;Path operations&quot;);
258 
259         // construction
260         test(&quot;/&quot;)
261             .string(&quot;/&quot;);
262         test(&quot;/&quot;, &quot;&quot;)
263             .string(&quot;/&quot;);
264         test(&quot;/&quot;, &quot;foo&quot;)
265             .string(&quot;/foo&quot;);
266         test(&quot;/&quot;, &quot;/foo&quot;)
267             .string(&quot;/foo&quot;);
268         test(&quot;/&quot;, &quot;foo/&quot;)
269             .string(&quot;/foo&quot;);
270         test(&quot;foo&quot;, &quot;bar&quot;, &quot;gus&quot;)
271             .string(&quot;foo/bar/gus&quot;);
272         test(&quot;&quot;)
273             .string(&quot;&quot;);
274         test(&quot;&quot;, &quot;/&quot;)
275             .string(&quot;/&quot;);
276         test(&quot;&quot;, &quot;foo&quot;, &quot;&quot;, &quot;bar&quot;, &quot;&quot;, &quot;/gus&quot;)
277             .string(&quot;foo/bar/gus&quot;);
278 
279         // all components
280         test(&quot;/a/b/c&quot;)
281             .root(&quot;/&quot;)
282             .parent(&quot;/a/b&quot;)
283             .name(&quot;c&quot;);
284 
285         // root component only
286         test(&quot;/&quot;)
287             .root(&quot;/&quot;)
288             .parent(null)
289             .name(null);
290 
291         // no root component
292         test(&quot;a/b&quot;)
293             .root(null)
294             .parent(&quot;a&quot;)
295             .name(&quot;b&quot;);
296 
297         // name component only
298         test(&quot;foo&quot;)
299             .root(null)
300             .parent(null)
301             .name(&quot;foo&quot;);
302 
303         // startsWith
304         test(&quot;&quot;)
305             .starts(&quot;&quot;)
306             .notStarts(&quot;/&quot;);
307         test(&quot;/&quot;)
308             .starts(&quot;/&quot;)
309             .notStarts(&quot;/foo&quot;);
310         test(&quot;/foo&quot;)
311             .starts(&quot;/&quot;)
312             .starts(&quot;/foo&quot;)
313             .notStarts(&quot;/f&quot;)
314             .notStarts(&quot;&quot;);
315         test(&quot;/foo/bar&quot;)
316             .starts(&quot;/&quot;)
317             .starts(&quot;/foo&quot;)
318             .starts(&quot;/foo/&quot;)
319             .starts(&quot;/foo/bar&quot;)
320             .notStarts(&quot;/f&quot;)
321             .notStarts(&quot;foo&quot;)
322             .notStarts(&quot;foo/bar&quot;)
323             .notStarts(&quot;&quot;);
324         test(&quot;foo&quot;)
325             .starts(&quot;foo&quot;)
326             .notStarts(&quot;f&quot;);
327         test(&quot;foo/bar&quot;)
328             .starts(&quot;foo&quot;)
329             .starts(&quot;foo/&quot;)
330             .starts(&quot;foo/bar&quot;)
331             .notStarts(&quot;f&quot;)
332             .notStarts(&quot;/foo&quot;)
333             .notStarts(&quot;/foo/bar&quot;);
334 
335         // endsWith
336         test(&quot;&quot;)
337             .ends(&quot;&quot;)
338             .notEnds(&quot;/&quot;);
339         test(&quot;/&quot;)
340             .ends(&quot;/&quot;)
341             .notEnds(&quot;foo&quot;)
342             .notEnds(&quot;/foo&quot;);
343         test(&quot;/foo&quot;)
344             .ends(&quot;foo&quot;)
345             .ends(&quot;/foo&quot;)
346             .notEnds(&quot;/&quot;);
347         test(&quot;/foo/bar&quot;)
348             .ends(&quot;bar&quot;)
349             .ends(&quot;foo/bar&quot;)
350             .ends(&quot;foo/bar/&quot;)
351             .ends(&quot;/foo/bar&quot;)
352             .notEnds(&quot;/bar&quot;);
353         test(&quot;/foo/bar/&quot;)
354             .ends(&quot;bar&quot;)
355             .ends(&quot;foo/bar&quot;)
356             .ends(&quot;foo/bar/&quot;)
357             .ends(&quot;/foo/bar&quot;)
358             .notEnds(&quot;/bar&quot;);
359         test(&quot;foo&quot;)
360             .ends(&quot;foo&quot;);
361         test(&quot;foo/bar&quot;)
362             .ends(&quot;bar&quot;)
363             .ends(&quot;bar/&quot;)
364             .ends(&quot;foo/bar/&quot;)
365             .ends(&quot;foo/bar&quot;);
366 
367         // elements
368         test(&quot;a/b/c&quot;)
369             .element(0,&quot;a&quot;)
370             .element(1,&quot;b&quot;)
371             .element(2,&quot;c&quot;);
372 
373         // isAbsolute
374         test(&quot;/&quot;)
375             .absolute();
376         test(&quot;/tmp&quot;)
377             .absolute();
378         test(&quot;tmp&quot;)
379             .notAbsolute();
380         test(&quot;&quot;)
381             .notAbsolute();
382 
383         // resolve
384         test(&quot;/tmp&quot;)
385             .resolve(&quot;foo&quot;, &quot;/tmp/foo&quot;)
386             .resolve(&quot;/foo&quot;, &quot;/foo&quot;)
387             .resolve(&quot;&quot;, &quot;/tmp&quot;);
388         test(&quot;tmp&quot;)
389             .resolve(&quot;foo&quot;, &quot;tmp/foo&quot;)
390             .resolve(&quot;/foo&quot;, &quot;/foo&quot;)
391             .resolve(&quot;&quot;, &quot;tmp&quot;);
392         test(&quot;&quot;)
393             .resolve(&quot;&quot;, &quot;&quot;)
394             .resolve(&quot;foo&quot;, &quot;foo&quot;)
395             .resolve(&quot;/foo&quot;, &quot;/foo&quot;);
396         test(&quot;/&quot;)
397             .resolve(&quot;&quot;, &quot;/&quot;)
398             .resolve(&quot;foo&quot;, &quot;/foo&quot;)
399             .resolve(&quot;/foo&quot;, &quot;/foo&quot;)
400             .resolve(&quot;/foo/&quot;, &quot;/foo&quot;);
401 
402         // resolve(Path)
403         test(&quot;/tmp&quot;)
404             .resolvePath(&quot;foo&quot;, &quot;/tmp/foo&quot;)
405             .resolvePath(&quot;/foo&quot;, &quot;/foo&quot;)
406             .resolvePath(&quot;&quot;, &quot;/tmp&quot;);
407         test(&quot;tmp&quot;)
408             .resolvePath(&quot;foo&quot;, &quot;tmp/foo&quot;)
409             .resolvePath(&quot;/foo&quot;, &quot;/foo&quot;)
410             .resolvePath(&quot;&quot;, &quot;tmp&quot;);
411         test(&quot;&quot;)
412             .resolvePath(&quot;&quot;, &quot;&quot;)
413             .resolvePath(&quot;foo&quot;, &quot;foo&quot;)
414             .resolvePath(&quot;/foo&quot;, &quot;/foo&quot;);
415         test(&quot;/&quot;)
416             .resolvePath(&quot;&quot;, &quot;/&quot;)
417             .resolvePath(&quot;foo&quot;, &quot;/foo&quot;)
418             .resolvePath(&quot;/foo&quot;, &quot;/foo&quot;)
419             .resolvePath(&quot;/foo/&quot;, &quot;/foo&quot;);
420 
421         // resolveSibling
422         test(&quot;foo&quot;)
423             .resolveSibling(&quot;bar&quot;, &quot;bar&quot;)
424             .resolveSibling(&quot;/bar&quot;, &quot;/bar&quot;)
425             .resolveSibling(&quot;&quot;, &quot;&quot;);
426         test(&quot;foo/bar&quot;)
427             .resolveSibling(&quot;gus&quot;, &quot;foo/gus&quot;)
428             .resolveSibling(&quot;/gus&quot;, &quot;/gus&quot;)
429             .resolveSibling(&quot;&quot;, &quot;foo&quot;);
430         test(&quot;/foo&quot;)
431             .resolveSibling(&quot;gus&quot;, &quot;/gus&quot;)
432             .resolveSibling(&quot;/gus&quot;, &quot;/gus&quot;)
433             .resolveSibling(&quot;&quot;, &quot;/&quot;);
434         test(&quot;/foo/bar&quot;)
435             .resolveSibling(&quot;gus&quot;, &quot;/foo/gus&quot;)
436             .resolveSibling(&quot;/gus&quot;, &quot;/gus&quot;)
437             .resolveSibling(&quot;&quot;, &quot;/foo&quot;);
438         test(&quot;&quot;)
439             .resolveSibling(&quot;foo&quot;, &quot;foo&quot;)
440             .resolveSibling(&quot;/foo&quot;, &quot;/foo&quot;)
441             .resolve(&quot;&quot;, &quot;&quot;);
442 
443         // relativize
444         test(&quot;/a/b/c&quot;)
445             .relativize(&quot;/a/b/c&quot;, &quot;&quot;)
446             .relativize(&quot;/a/b/c/d/e&quot;, &quot;d/e&quot;)
447             .relativize(&quot;/a/x&quot;, &quot;../../x&quot;)
448             .relativize(&quot;/x&quot;, &quot;../../../x&quot;);
449         test(&quot;a/b/c&quot;)
450             .relativize(&quot;a/b/c/d&quot;, &quot;d&quot;)
451             .relativize(&quot;a/x&quot;, &quot;../../x&quot;)
452             .relativize(&quot;x&quot;, &quot;../../../x&quot;)
453             .relativize(&quot;&quot;, &quot;../../..&quot;);
454         test(&quot;&quot;)
455             .relativize(&quot;a&quot;, &quot;a&quot;)
456             .relativize(&quot;a/b/c&quot;, &quot;a/b/c&quot;)
457             .relativize(&quot;&quot;, &quot;&quot;);
458         test(&quot;/&quot;)
459             .relativize(&quot;/a&quot;, &quot;a&quot;)
460             .relativize(&quot;/a/c&quot;, &quot;a/c&quot;);
461         // 8146754
462         test(&quot;/tmp/path&quot;)
463             .relativize(&quot;/tmp/path/a.txt&quot;, &quot;a.txt&quot;);
464         test(&quot;/tmp/path/&quot;)
465             .relativize(&quot;/tmp/path/a.txt&quot;, &quot;a.txt&quot;);
466 
467         // normalize
468         test(&quot;/&quot;)
469             .normalize(&quot;/&quot;);
470         test(&quot;foo&quot;)
471             .normalize(&quot;foo&quot;);
472         test(&quot;/foo&quot;)
473             .normalize(&quot;/foo&quot;);
474         test(&quot;.&quot;)
475             .normalize(&quot;&quot;);
476         test(&quot;..&quot;)
477             .normalize(&quot;..&quot;);
478         test(&quot;/..&quot;)
479             .normalize(&quot;/&quot;);
480         test(&quot;/../..&quot;)
481             .normalize(&quot;/&quot;);
482         test(&quot;foo/.&quot;)
483             .normalize(&quot;foo&quot;);
484         test(&quot;./foo&quot;)
485             .normalize(&quot;foo&quot;);
486         test(&quot;foo/..&quot;)
487             .normalize(&quot;&quot;);
488         test(&quot;../foo&quot;)
489             .normalize(&quot;../foo&quot;);
490         test(&quot;../../foo&quot;)
491             .normalize(&quot;../../foo&quot;);
492         test(&quot;foo/bar/..&quot;)
493             .normalize(&quot;foo&quot;);
494         test(&quot;foo/bar/gus/../..&quot;)
495             .normalize(&quot;foo&quot;);
496         test(&quot;/foo/bar/gus/../..&quot;)
497             .normalize(&quot;/foo&quot;);
498         test(&quot;/./.&quot;)
499             .normalize(&quot;/&quot;);
500         test(&quot;/.&quot;)
501             .normalize(&quot;/&quot;);
502         test(&quot;/./abc&quot;)
503             .normalize(&quot;/abc&quot;);
504         // invalid
505         test(&quot;foo\u0000bar&quot;)
506             .invalid();
507         test(&quot;\u0000foo&quot;)
508             .invalid();
509         test(&quot;bar\u0000&quot;)
510             .invalid();
511         test(&quot;//foo\u0000bar&quot;)
512             .invalid();
513         test(&quot;//\u0000foo&quot;)
514             .invalid();
515         test(&quot;//bar\u0000&quot;)
516             .invalid();
517 
518         // normalization
519         test(&quot;//foo//bar&quot;)
520             .string(&quot;/foo/bar&quot;)
521             .root(&quot;/&quot;)
522             .parent(&quot;/foo&quot;)
523             .name(&quot;bar&quot;);
524 
525         // isSameFile
526         test(&quot;/fileDoesNotExist&quot;)
527             .isSameFile(&quot;/fileDoesNotExist&quot;);
528 
529         // 8139956
530         out.println(&quot;check getNameCount&quot;);
531         int nc = fs.getPath(&quot;/&quot;).relativize(fs.getPath(&quot;/&quot;)).getNameCount();
532         if (nc != 1) {
533             out.format(&quot;\tExpected: 1\n&quot;);
534             out.format(&quot;\tActual: %d\n&quot;,  nc);
535             throw new RuntimeException(&quot;getNameCount of empty path failed&quot;);
536         }
537      }
538 
539     static void npes() {
540         header(&quot;NullPointerException&quot;);
541 
542         Path path = fs.getPath(&quot;foo&quot;);
543 
544         try {
545             path.resolve((String)null);
546             throw new RuntimeException(&quot;NullPointerException not thrown&quot;);
547         } catch (NullPointerException npe) {
548         }
549 
550         try {
551             path.relativize(null);
552             throw new RuntimeException(&quot;NullPointerException not thrown&quot;);
553         } catch (NullPointerException npe) {
554         }
555 
556         try {
557             path.compareTo(null);
558             throw new RuntimeException(&quot;NullPointerException not thrown&quot;);
559         } catch (NullPointerException npe) {
560         }
561 
562         try {
563             path.startsWith((Path)null);
564             throw new RuntimeException(&quot;NullPointerException not thrown&quot;);
565         } catch (NullPointerException npe) {
566         }
567 
568         try {
569             path.endsWith((Path)null);
570             throw new RuntimeException(&quot;NullPointerException not thrown&quot;);
571         } catch (NullPointerException npe) {
572         }
573 
574     }
575 
576     static void mismatchedProviders() {
577         header(&quot;ProviderMismatchException&quot;);
578         Path path = fs.getPath(&quot;foo&quot;);
579         Path other = Paths.get(&quot;foo&quot;);
580         try {
581             path.compareTo(other);
582             throw new RuntimeException(&quot;ProviderMismatchException not thrown&quot;);
583         } catch (ProviderMismatchException pme) {}
584 
585         try {
586             path.resolve(other);
587             throw new RuntimeException(&quot;ProviderMismatchException not thrown&quot;);
588         } catch (ProviderMismatchException pme) {}
589 
590         try {
591             path.relativize(other);
592             throw new RuntimeException(&quot;ProviderMismatchException not thrown&quot;);
593         } catch (ProviderMismatchException pme) {}
594 
595         try {
596             if (path.startsWith(other))
597                 throw new RuntimeException(&quot;providerMismatched startsWith() returns true &quot;);
598             if (path.endsWith(other))
599                 throw new RuntimeException(&quot;providerMismatched endsWith() returns true &quot;);
600         } catch (ProviderMismatchException pme) {
601             throw new RuntimeException(&quot;ProviderMismatchException is thrown for starts/endsWith()&quot;);
602         }
603     }
604 
605     public static void main(String[] args) throws IOException {
606         // create empty JAR file, test doesn&#39;t require any contents
607         Path emptyJar = Utils.createJarFile(&quot;empty.jar&quot;);
608 
<a name="4" id="anc4"></a><span class="line-modified">609         fs = FileSystems.newFileSystem(emptyJar, null);</span>
610         try {
611             npes();
612             mismatchedProviders();
613             doPathOpTests();
614         } finally {
615             fs.close();
616         }
617     }
618 }
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>