<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/jdk/nio/zipfs/ZipFSTester.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="PathOps.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jarfs/JFSTester.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/nio/zipfs/ZipFSTester.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2010, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2010, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -79,11 +79,10 @@</span>
   * @run main ZipFSTester
   * @run main/othervm/java.security.policy=test.policy ZipFSTester
   */
  
  public class ZipFSTester {
<span class="udiff-line-removed">- </span>
      public static void main(String[] args) throws Exception {
          // create JAR file for test, actual contents don&#39;t matter
          Path jarFile = Utils.createJarFile(&quot;tester.jar&quot;,
                  &quot;META-INF/MANIFEST.MF&quot;,
                  &quot;dir1/foo&quot;,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -144,11 +143,11 @@</span>
              z2zcopy(fs0, copy, &quot;/&quot;, 0);
  
              // copy the test jar itself in
              Files.copy(Paths.get(fs0.toString()), copy.getPath(&quot;/foo.jar&quot;));
              Path zpath = copy.getPath(&quot;/foo.jar&quot;);
<span class="udiff-line-modified-removed">-             try (FileSystem zzfs = FileSystems.newFileSystem(zpath, null)) {</span>
<span class="udiff-line-modified-added">+             try (FileSystem zzfs = FileSystems.newFileSystem(zpath)) {</span>
                  Files.copy(src, zzfs.getPath(&quot;/srcInjarjar&quot;));
              }
          }
  
          try (FileSystem fs = newZipFileSystem(tmpfsPath, new HashMap&lt;String, Object&gt;())) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -227,11 +226,11 @@</span>
              Path parent = dst2.getParent();
              try {
                  Files.newInputStream(parent);
                  throw new RuntimeException(&quot;Failed&quot;);
              } catch (FileSystemException e) {
<span class="udiff-line-modified-removed">-                 e.printStackTrace();    // expected fse</span>
<span class="udiff-line-modified-added">+                 // expected fse</span>
              }
  
              // rmdirs
              try {
                  rmdirs(parent);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -252,11 +251,11 @@</span>
              Files.delete(dst);
  
              // test foo.jar in jar/zipfs #8034802
              Path jpath = fs.getPath(&quot;/foo.jar&quot;);
              System.out.println(&quot;walking: &quot; + jpath);
<span class="udiff-line-modified-removed">-             try (FileSystem zzfs = FileSystems.newFileSystem(jpath, null)) {</span>
<span class="udiff-line-modified-added">+             try (FileSystem zzfs = FileSystems.newFileSystem(jpath)) {</span>
                  walk(zzfs.getPath(&quot;/&quot;));
                  // foojar:/srcInjarjar
                  checkEqual(src, zzfs.getPath(&quot;/srcInjarjar&quot;));
  
                  dst = getPathWithParents(zzfs, tmpName);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -419,11 +418,19 @@</span>
      static final int METHOD_STORED     = 0;
      static final int METHOD_DEFLATED   = 8;
  
      static Object[][] getEntries() {
          Object[][] entries = new Object[10 + rdm.nextInt(20)][3];
<span class="udiff-line-modified-removed">-         for (int i = 0; i &lt; entries.length; i++) {</span>
<span class="udiff-line-modified-added">+         // first entries shall test the corner case of 0 bytes of data</span>
<span class="udiff-line-added">+         entries[0][0] = &quot;entries&quot; + 0;</span>
<span class="udiff-line-added">+         entries[0][1] = METHOD_STORED;</span>
<span class="udiff-line-added">+         entries[0][2] = new byte[0];</span>
<span class="udiff-line-added">+         entries[1][0] = &quot;entries&quot; + 1;</span>
<span class="udiff-line-added">+         entries[1][1] = METHOD_DEFLATED;</span>
<span class="udiff-line-added">+         entries[1][2] = new byte[0];</span>
<span class="udiff-line-added">+         // the rest is random data</span>
<span class="udiff-line-added">+         for (int i = 2; i &lt; entries.length; i++) {</span>
              entries[i][0] = &quot;entries&quot; + i;
              entries[i][1] = rdm.nextInt(10) % 2 == 0 ?
                  METHOD_STORED : METHOD_DEFLATED;
              entries[i][2] = new byte[rdm.nextInt(8192)];
              rdm.nextBytes((byte[])entries[i][2]);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -531,14 +538,11 @@</span>
                  }
              }
              try (var zfs = newZipFileSystem(zpath, Collections.emptyMap())) {
                  for (Object[] e : entries) {
                      Path path = zfs.getPath((String)e[0]);
<span class="udiff-line-removed">-                     int method = (int)e[1];</span>
                      byte[] bytes = (byte[])e[2];
<span class="udiff-line-removed">-                     // System.out.printf(&quot;checking read [%s, %d, %d]%n&quot;,</span>
<span class="udiff-line-removed">-                     //                   path.toString(), bytes.length, method);</span>
                      checkRead(path, bytes);
                  }
              }
              Files.deleteIfExists(zpath);
  
</pre>
<center><a href="PathOps.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="jarfs/JFSTester.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>