<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/jdk/jfr/jvm/TestFormatDuration.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2019, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package jdk.jfr.jvm;
 26 
 27 import jdk.jfr.internal.Utils;
 28 import jdk.test.lib.Asserts;
 29 
 30 import java.time.Duration;
 31 import java.util.Locale;
 32 
 33 /**
 34  * @test
 35  * @key jfr
 36  * @requires vm.hasJFR
 37  * @library /test/lib
 38  * @modules jdk.jfr/jdk.jfr.internal
 39  * @run main/othervm jdk.jfr.jvm.TestFormatDuration
 40  */
 41 public class TestFormatDuration {
 42     public static void main(String[] args) throws Exception{
 43         Locale.setDefault(Locale.US);
 44 
 45         // Nanoseconds
 46         assertDuration(&quot;0 ns   &quot;, &quot;0 s&quot;);
 47         assertDuration(&quot;1 ns   &quot;, &quot;0.000001 ms&quot;);
 48         assertDuration(&quot;10 ns  &quot;, &quot;0.000010 ms&quot;);
 49         assertDuration(&quot;100 ns &quot;, &quot;0.000100 ms&quot;);
 50         assertDuration(&quot;999 ns &quot;, &quot;0.000999 ms&quot;);
 51         assertDuration(&quot;1000 ns&quot;, &quot;0.00100 ms&quot;);
 52         assertDuration(&quot;1004 ns&quot;, &quot;0.00100 ms&quot;);
 53         assertDuration(&quot;1005 ns&quot;, &quot;0.00101 ms&quot;);
 54 
 55         // 10 us
 56         assertDuration(&quot;9 us 994 ns&quot;, &quot;0.00999 ms&quot;);
 57         assertDuration(&quot;9 us 995 ns&quot;, &quot;0.0100 ms&quot;);
 58         assertDuration(&quot;10 us      &quot;, &quot;0.0100 ms&quot;);
 59         assertDuration(&quot;10 us 49 ns&quot;, &quot;0.0100 ms&quot;);
 60         assertDuration(&quot;10 us 50 ns&quot;, &quot;0.0101 ms&quot;);
 61 
 62         // 100 us
 63         assertDuration(&quot;99 us 949 ns &quot;, &quot;0.0999 ms&quot;);
 64         assertDuration(&quot;99 us 950 ns &quot;, &quot;0.100 ms&quot;);
 65         assertDuration(&quot;100 us       &quot;, &quot;0.100 ms&quot;);
 66         assertDuration(&quot;100 us 499 ns&quot;, &quot;0.100 ms&quot;);
 67         assertDuration(&quot;100 us 500 ns&quot;, &quot;0.101 ms&quot;);
 68 
 69         // 1 ms
 70         assertDuration(&quot;999 us 499 ns       &quot;, &quot;0.999 ms&quot;);
 71         assertDuration(&quot;999 us 500 ns       &quot;, &quot;1.00 ms&quot;);
 72         assertDuration(&quot;1 ms                &quot;, &quot;1.00 ms&quot;);
 73         assertDuration(&quot;1 ms 4 us 999 ns    &quot;, &quot;1.00 ms&quot;);
 74         assertDuration(&quot;1 ms 5 us&quot;, &quot;1.01 ms&quot;);
 75 
 76         // 10 ms
 77         assertDuration(&quot;9 ms 994 us 999 ns&quot;, &quot;9.99 ms&quot;);
 78         assertDuration(&quot;9 ms 995 us       &quot;, &quot;10.0 ms&quot;);
 79         assertDuration(&quot;10 ms             &quot;, &quot;10.0 ms&quot;);
 80         assertDuration(&quot;10 ms 49 us 999 ns&quot;, &quot;10.0 ms&quot;);
 81         assertDuration(&quot;10 ms 50 us 999 ns&quot;, &quot;10.1 ms&quot;);
 82 
 83         // 100 ms
 84         assertDuration(&quot;99 ms 949 us 999 ns &quot;, &quot;99.9 ms&quot;);
 85         assertDuration(&quot;99 ms 950 us 000 ns &quot;, &quot;100 ms&quot;);
 86         assertDuration(&quot;100 ms              &quot;, &quot;100 ms&quot;);
 87         assertDuration(&quot;100 ms 499 us 999 ns&quot;, &quot;100 ms&quot;);
 88         assertDuration(&quot;100 ms 500 us       &quot;, &quot;101 ms&quot;);
 89 
 90         // 1 second
 91         assertDuration(&quot;999 ms 499 us 999 ns  &quot;, &quot;999 ms&quot;);
 92         assertDuration(&quot;999 ms 500 us         &quot;, &quot;1.00 s&quot;);
 93         assertDuration(&quot;1 s                   &quot;, &quot;1.00 s&quot;);
 94         assertDuration(&quot;1 s 4 ms 999 us 999 ns&quot;, &quot;1.00 s&quot;);
 95         assertDuration(&quot;1 s 5 ms              &quot;, &quot;1.01 s&quot;);
 96 
 97         // 10 seconds
 98         assertDuration(&quot;9 s 994 ms 999 us 999 ns &quot;, &quot;9.99 s&quot;);
 99         assertDuration(&quot;9 s 995 ms               &quot;, &quot;10.0 s&quot;);
100         assertDuration(&quot;10 s                     &quot;, &quot;10.0 s&quot;);
101         assertDuration(&quot;10 s 049 ms 999 us 999 ns&quot;, &quot;10.0 s&quot;);
102         assertDuration(&quot;10 s 050 ms              &quot;, &quot;10.1 s&quot;);
103 
104         // 1 minute
105         assertDuration(&quot;59 s 949 ms 999 us 999 ns&quot;, &quot;59.9 s&quot;);
106         assertDuration(&quot;59 s 950 ms              &quot;, &quot;1 m 0 s&quot;);
107         assertDuration(&quot;1 m 0 s                  &quot;, &quot;1 m 0 s&quot;);
108         assertDuration(&quot;60 s 499 ms 999 us 999 ns&quot;, &quot;1 m 0 s&quot;);
109         assertDuration(&quot;60 s 500 ms              &quot;, &quot;1 m 1 s&quot;);
110 
111         // 10 minutes
112         assertDuration(&quot;10 m 0 s&quot;, &quot;10 m 0 s&quot;);
113 
114         // 1 hour
115         assertDuration(&quot;59 m 59 s 499 ms 999 us 999 ns&quot;, &quot;59 m 59 s&quot;);
116         assertDuration(&quot;59 m 59 s 500 ms              &quot;, &quot;1 h 0 m&quot;);
117         assertDuration(&quot;1 h 0 m                       &quot;, &quot;1 h 0 m&quot;);
118         assertDuration(&quot;1 h 29 s 999 ms 999 us 999 ns &quot;, &quot;1 h 0 m&quot;);
119         assertDuration(&quot;1 h 30 s                      &quot;, &quot;1 h 1 m&quot;);
120 
121         // 1 day
122         assertDuration(&quot;23 h 59 m 29 s 999 ms 999 us 999 ns&quot;, &quot;23 h 59 m&quot;);
123         assertDuration(&quot;23 h 59 m 30 s                     &quot;, &quot;1 d 0 h&quot;);
124         assertDuration(&quot;1 d 0 h                            &quot;, &quot;1 d 0 h&quot;);
125         assertDuration(&quot;1 d 29 m 59 s 999 ms 999 us 999 ns &quot;, &quot;1 d 0 h&quot;);
126         assertDuration(&quot;1 d 30 m                           &quot;, &quot;1 d 1 h&quot;);
127 
128         // 100 days
129         assertDuration(&quot;100 d 13 h&quot;, &quot;100 d 13 h&quot;);
130 
131         // 1000 days
132         assertDuration(&quot;1000 d 13 h&quot;, &quot;1000 d 13 h&quot;);
133     }
134 
135     private static void assertDuration(String value, String expected) throws Exception {
136         long nanos = parse(value);
137         System.out.println(value + &quot; == &quot; + expected + &quot; ? (&quot; + nanos + &quot; ns) &quot;);
138         Asserts.assertEquals(Utils.formatDuration(Duration.ofNanos(nanos)), expected);
139         if (nanos != 0) {
140             Asserts.assertEquals(Utils.formatDuration(Duration.ofNanos(-nanos)), &quot;-&quot; + expected);
141         }
142     }
143 
144 
145     private static long parse(String duration) throws Exception {
146         String[] t = duration.trim().split(&quot; &quot;);
147         long nanos = 0;
148         for (int i = 0; i &lt; t.length - 1; i += 2) {
149             nanos += Long.parseLong(t[i]) * parseUnit(t[i + 1]);
150         }
151         return nanos;
152     }
153 
154     private static long parseUnit(String unit) throws Exception {
155         switch (unit) {
156             case &quot;ns&quot;:
157                 return 1L;
158             case &quot;us&quot;:
159                 return 1_000L;
160             case &quot;ms&quot;:
161                 return 1_000_000L;
162             case &quot;s&quot;:
163                 return 1_000_000_000L;
164             case &quot;m&quot;:
165                 return 60 * 1_000_000_000L;
166             case &quot;h&quot;:
167                 return 3600 * 1_000_000_000L;
168             case &quot;d&quot;:
169                 return 24 * 3600 * 1_000_000_000L;
170         }
171         throw new Exception(&quot;Test error. Unknown unit &quot; + unit);
172     }
173 }
    </pre>
  </body>
</html>