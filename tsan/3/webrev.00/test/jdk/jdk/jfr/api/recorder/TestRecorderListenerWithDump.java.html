<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/jdk/jfr/api/recorder/TestRecorderListenerWithDump.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 package jdk.jfr.api.recorder;
 2 
 3 import java.nio.file.Paths;
 4 import java.util.concurrent.atomic.AtomicBoolean;
 5 
 6 import jdk.jfr.FlightRecorder;
 7 import jdk.jfr.FlightRecorderListener;
 8 import jdk.jfr.Recording;
 9 /**
10  * @test TestRecorderListenerWithDump
11  *
12  * @key jfr
13  * @requires vm.hasJFR
14  * @run main/othervm jdk.jfr.api.recorder.TestRecorderListenerWithDump
15  */
16 public class TestRecorderListenerWithDump {
17 
18     public static void main(String... args) throws Exception {
19         AtomicBoolean nullRecording = new AtomicBoolean();
20         FlightRecorder.addListener(new FlightRecorderListener() {
21             public void recordingStateChanged(Recording r) {
22                 if (r == null) {
23                     nullRecording.set(true);
24                 } else {
25                     System.out.println(&quot;Recording &quot; + r.getName() + &quot; &quot; + r.getState());
26                 }
27             }
28         });
29         try (Recording r = new Recording()) {
30             r.start();
31             r.dump(Paths.get(&quot;dump.jfr&quot;));
32         }
33         if (nullRecording.get()) {
34             throw new Exception(&quot;FlightRecorderListener returned null recording&quot;);
35         }
36     }
37 }
    </pre>
  </body>
</html>