<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/jdk/jfr/event/gc/stacktrace/AllocationStackTrace.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../refstat/TestRefStatEventWithParallelOld.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../io/IOEvent.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/jdk/jfr/event/gc/stacktrace/AllocationStackTrace.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
192 
193         testAllocEvent(bean, memory, expectedStack);
194     }
195 
196     /**
197      * Tests event stacktrace during metaspace GC threshold if -XX:+UseSerialGC
198      * is used
199      */
200     public static void testMetaspaceSerialGCAllocEvent() throws Exception {
201         GarbageCollectorMXBean bean = garbageCollectorMXBean(&quot;MarkSweepCompact&quot;);
202         MemoryAllocator memory = new MetaspaceMemoryAllocator();
203 
204         String[] expectedStack = new String[]{
205             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testAllocEvent&quot;,
206             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testMetaspaceSerialGCAllocEvent&quot;
207         };
208 
209         testAllocEvent(bean, memory, expectedStack);
210     }
211 
<span class="line-removed">212     /**</span>
<span class="line-removed">213      * Tests event stacktrace for young GC if -XX:+UseConcMarkSweepGC is used</span>
<span class="line-removed">214      */</span>
<span class="line-removed">215     public static void testParNewAllocEvent() throws Exception {</span>
<span class="line-removed">216         GarbageCollectorMXBean bean = garbageCollectorMXBean(&quot;ParNew&quot;);</span>
<span class="line-removed">217         MemoryAllocator memory = new EdenMemoryAllocator();</span>
<span class="line-removed">218 </span>
<span class="line-removed">219         String[] expectedStack = new String[]{</span>
<span class="line-removed">220             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testAllocEvent&quot;,</span>
<span class="line-removed">221             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testParNewAllocEvent&quot;</span>
<span class="line-removed">222         };</span>
<span class="line-removed">223 </span>
<span class="line-removed">224         testAllocEvent(bean, memory, expectedStack);</span>
<span class="line-removed">225     }</span>
<span class="line-removed">226 </span>
<span class="line-removed">227     /**</span>
<span class="line-removed">228      * Tests event stacktrace for old GC if -XX:+UseConcMarkSweepGC is used</span>
<span class="line-removed">229      */</span>
<span class="line-removed">230     public static void testConcMarkSweepAllocEvent() throws Exception {</span>
<span class="line-removed">231         GarbageCollectorMXBean bean = garbageCollectorMXBean(&quot;ConcurrentMarkSweep&quot;);</span>
<span class="line-removed">232         MemoryAllocator memory = new OldGenMemoryAllocator();</span>
<span class="line-removed">233 </span>
<span class="line-removed">234         String[] expectedStack = new String[]{</span>
<span class="line-removed">235             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testAllocEvent&quot;,</span>
<span class="line-removed">236             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testConcMarkSweepAllocEvent&quot;</span>
<span class="line-removed">237         };</span>
<span class="line-removed">238 </span>
<span class="line-removed">239         testAllocEvent(bean, memory, expectedStack);</span>
<span class="line-removed">240     }</span>
<span class="line-removed">241 </span>
<span class="line-removed">242     /**</span>
<span class="line-removed">243      * Tests event stacktrace during metaspace GC threshold if</span>
<span class="line-removed">244      * -XX:+UseConcMarkSweepGC is used</span>
<span class="line-removed">245      */</span>
<span class="line-removed">246     public static void testMetaspaceConcMarkSweepGCAllocEvent() throws Exception {</span>
<span class="line-removed">247         GarbageCollectorMXBean bean = garbageCollectorMXBean(&quot;ConcurrentMarkSweep&quot;);</span>
<span class="line-removed">248         MemoryAllocator memory = new MetaspaceMemoryAllocator();</span>
<span class="line-removed">249 </span>
<span class="line-removed">250         String[] expectedStack = new String[]{</span>
<span class="line-removed">251             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testAllocEvent&quot;,</span>
<span class="line-removed">252             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testMetaspaceConcMarkSweepGCAllocEvent&quot;</span>
<span class="line-removed">253         };</span>
<span class="line-removed">254 </span>
<span class="line-removed">255         testAllocEvent(bean, memory, expectedStack);</span>
<span class="line-removed">256     }</span>
<span class="line-removed">257 </span>
258     /**
259      * Tests event stacktrace for young GC if -XX:+UseParallelGC is used
260      */
261     public static void testParallelScavengeAllocEvent() throws Exception {
262         GarbageCollectorMXBean bean = garbageCollectorMXBean(&quot;PS Scavenge&quot;);
263         MemoryAllocator memory = new EdenMemoryAllocator();
264 
265         String[] expectedStack = new String[]{
266             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testAllocEvent&quot;,
267             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testParallelScavengeAllocEvent&quot;
268         };
269 
270         testAllocEvent(bean, memory, expectedStack);
271     }
272 
273     /**
274      * Tests event stacktrace for old GC if -XX:+UseParallelGC is used
275      */
276     public static void testParallelMarkSweepAllocEvent() throws Exception {
277         GarbageCollectorMXBean bean = garbageCollectorMXBean(&quot;PS MarkSweep&quot;);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
192 
193         testAllocEvent(bean, memory, expectedStack);
194     }
195 
196     /**
197      * Tests event stacktrace during metaspace GC threshold if -XX:+UseSerialGC
198      * is used
199      */
200     public static void testMetaspaceSerialGCAllocEvent() throws Exception {
201         GarbageCollectorMXBean bean = garbageCollectorMXBean(&quot;MarkSweepCompact&quot;);
202         MemoryAllocator memory = new MetaspaceMemoryAllocator();
203 
204         String[] expectedStack = new String[]{
205             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testAllocEvent&quot;,
206             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testMetaspaceSerialGCAllocEvent&quot;
207         };
208 
209         testAllocEvent(bean, memory, expectedStack);
210     }
211 














































212     /**
213      * Tests event stacktrace for young GC if -XX:+UseParallelGC is used
214      */
215     public static void testParallelScavengeAllocEvent() throws Exception {
216         GarbageCollectorMXBean bean = garbageCollectorMXBean(&quot;PS Scavenge&quot;);
217         MemoryAllocator memory = new EdenMemoryAllocator();
218 
219         String[] expectedStack = new String[]{
220             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testAllocEvent&quot;,
221             &quot;jdk.jfr.event.gc.stacktrace.AllocationStackTrace.testParallelScavengeAllocEvent&quot;
222         };
223 
224         testAllocEvent(bean, memory, expectedStack);
225     }
226 
227     /**
228      * Tests event stacktrace for old GC if -XX:+UseParallelGC is used
229      */
230     public static void testParallelMarkSweepAllocEvent() throws Exception {
231         GarbageCollectorMXBean bean = garbageCollectorMXBean(&quot;PS MarkSweep&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../refstat/TestRefStatEventWithParallelOld.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../io/IOEvent.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>