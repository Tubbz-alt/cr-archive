<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/jdk/jfr/event/gc/configuration/TestGCConfigurationEvent.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2013, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr.event.gc.configuration;
 27 
 28 import static jdk.test.lib.Asserts.assertGreaterThanOrEqual;
 29 
 30 import java.util.List;
 31 
 32 import jdk.jfr.Recording;
 33 import jdk.jfr.consumer.RecordedEvent;
 34 import jdk.test.lib.jfr.EventNames;
 35 import jdk.test.lib.jfr.EventVerifier;
 36 import jdk.test.lib.jfr.Events;
 37 
 38 /**
 39  * @test
 40  * @key jfr
 41  * @requires vm.hasJFR
 42  * @requires (vm.gc == &quot;Parallel&quot; | vm.gc == null)
 43  *           &amp; vm.opt.ExplicitGCInvokesConcurrent != true
 44  * @library /test/lib /test/jdk
<a name="1" id="anc1"></a><span class="line-modified"> 45  * @run main/othervm -XX:+UnlockExperimentalVMOptions -XX:-UseFastUnorderedTimeStamps -XX:+UseParallelGC -XX:+UseParallelOldGC -XX:ParallelGCThreads=3 -XX:ConcGCThreads=2 -XX:+UseDynamicNumberOfGCThreads -XX:-ExplicitGCInvokesConcurrent -XX:-DisableExplicitGC -XX:MaxGCPauseMillis=800 -XX:GCTimeRatio=19 jdk.jfr.event.gc.configuration.TestGCConfigurationEvent</span>
 46  */
 47 public class TestGCConfigurationEvent {
 48     public static void main(String[] args) throws Exception {
 49         Recording recording = new Recording();
 50         recording.enable(EventNames.GCConfiguration);
 51         recording.start();
 52         recording.stop();
 53         List&lt;RecordedEvent&gt; events = Events.fromRecording(recording);
 54         assertGreaterThanOrEqual(events.size(), 1, &quot;Expected at least 1 event&quot;);
 55         GCConfigurationEventVerifier verifier = new GCConfigurationEventVerifier(events.get(0));
 56         verifier.verify();
 57     }
 58 }
 59 
 60 class GCConfigurationEventVerifier extends EventVerifier {
 61     public GCConfigurationEventVerifier(RecordedEvent event) {
 62         super(event);
 63     }
 64 
 65     @Override
 66     public void verify() throws Exception {
 67         verifyYoungGCIs(&quot;ParallelScavenge&quot;);
 68         verifyOldGCIs(&quot;ParallelOld&quot;);
 69         verifyParallelGCThreadsIs(3);
 70         verifyConcurrentGCThreadsIs(2);
 71         verifyUsesDynamicGCThreadsIs(true);
 72         verifyIsExplicitGCConcurrentIs(false);
 73         verifyIsExplicitGCDisabledIs(false);
 74         verifyPauseTargetIs(800);
 75         verifyGCTimeRatioIs(19);
 76     }
 77 
 78     private void verifyYoungGCIs(String expected) throws Exception {
 79         verifyEquals(&quot;youngCollector&quot;, expected);
 80     }
 81 
 82     private void verifyOldGCIs(String expected) throws Exception {
 83         verifyEquals(&quot;oldCollector&quot;, expected);
 84     }
 85 
 86     private void verifyParallelGCThreadsIs(int expected) throws Exception {
 87         verifyEquals(&quot;parallelGCThreads&quot;, expected);
 88     }
 89 
 90     private void verifyConcurrentGCThreadsIs(int expected) throws Exception {
 91         verifyEquals(&quot;concurrentGCThreads&quot;, expected);
 92     }
 93 
 94     private void verifyUsesDynamicGCThreadsIs(boolean expected) throws Exception {
 95         verifyEquals(&quot;usesDynamicGCThreads&quot;, expected);
 96     }
 97 
 98     private void verifyIsExplicitGCConcurrentIs(boolean expected) throws Exception {
 99         verifyEquals(&quot;isExplicitGCConcurrent&quot;, expected);
100     }
101 
102     private void verifyIsExplicitGCDisabledIs(boolean expected) throws Exception {
103         verifyEquals(&quot;isExplicitGCDisabled&quot;, expected);
104     }
105 
106     private void verifyPauseTargetIs(long expected) throws Exception {
107         verifyEquals(&quot;pauseTarget&quot;, expected);
108     }
109 
110     private void verifyGCTimeRatioIs(int expected) throws Exception {
111         verifyEquals(&quot;gcTimeRatio&quot;, expected);
112     }
113 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>