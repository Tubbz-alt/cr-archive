<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/com/sun/net/httpserver/bugs/TruncatedRequestBody.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="HeadTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../nio/sctp/SctpChannel/Bind.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/com/sun/net/httpserver/bugs/TruncatedRequestBody.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 73             // shouldn&#39;t get to here
 74             error = true;
 75             latch.countDown();
 76             System.out.println(&quot;Read &quot; + count + &quot; bytes&quot;);
 77             is.close();
 78             exch.sendResponseHeaders(200, -1);
 79         }
 80 
 81     }
 82 
 83     /**
 84      * @param args the command line arguments
 85      */
 86     public static void main(String[] args) throws IOException, InterruptedException {
 87         Logger logger = Logger.getLogger(&quot;com.sun.net.httpserver&quot;);
 88         ConsoleHandler h = new ConsoleHandler();
 89         h.setLevel(Level.ALL);
 90         logger.setLevel(Level.ALL);
 91         logger.addHandler(h);
 92 
<span class="line-modified"> 93         InetSocketAddress addr = new InetSocketAddress(0);</span>

 94         HttpServer server = HttpServer.create(addr, 10);
 95         HttpContext ct = server.createContext(&quot;/&quot;, new Handler());
 96         ExecutorService ex = Executors.newCachedThreadPool();
 97         server.setExecutor(ex);
 98         server.start();
 99 
100         int port = server.getAddress().getPort();
101 
102         // Test 1: fixed length
103 
<span class="line-modified">104         Socket sock = new Socket(InetAddress.getLoopbackAddress(), port);</span>
105         String s1 = &quot;POST /foo HTTP/1.1\r\nContent-length: 200000\r\n&quot;
106                 + &quot;\r\nfoo bar99&quot;;
107 
108         OutputStream os = sock.getOutputStream();
109         os.write(s1.getBytes(StandardCharsets.ISO_8859_1));
110         Thread.sleep(500);
111 
112         sock.close();
113 
114         // Test 2: chunked
115 
116         String s2 = &quot;POST /foo HTTP/1.1\r\nTransfer-encoding: chunked\r\n\r\n&quot; +
117                 &quot;100\r\nFoo bar&quot;;
<span class="line-modified">118         sock = new Socket(InetAddress.getLoopbackAddress(), port);</span>
119         os = sock.getOutputStream();
120         os.write(s2.getBytes(StandardCharsets.ISO_8859_1));
121         Thread.sleep(500);
122         sock.close();
123         latch.await();
124         server.stop(0);
125         ex.shutdownNow();
126         if (error)
127             throw new RuntimeException(&quot;Test failed&quot;);
128     }
129 }
</pre>
</td>
<td>
<hr />
<pre>
 73             // shouldn&#39;t get to here
 74             error = true;
 75             latch.countDown();
 76             System.out.println(&quot;Read &quot; + count + &quot; bytes&quot;);
 77             is.close();
 78             exch.sendResponseHeaders(200, -1);
 79         }
 80 
 81     }
 82 
 83     /**
 84      * @param args the command line arguments
 85      */
 86     public static void main(String[] args) throws IOException, InterruptedException {
 87         Logger logger = Logger.getLogger(&quot;com.sun.net.httpserver&quot;);
 88         ConsoleHandler h = new ConsoleHandler();
 89         h.setLevel(Level.ALL);
 90         logger.setLevel(Level.ALL);
 91         logger.addHandler(h);
 92 
<span class="line-modified"> 93         InetAddress loopback = InetAddress.getLoopbackAddress();</span>
<span class="line-added"> 94         InetSocketAddress addr = new InetSocketAddress(loopback, 0);</span>
 95         HttpServer server = HttpServer.create(addr, 10);
 96         HttpContext ct = server.createContext(&quot;/&quot;, new Handler());
 97         ExecutorService ex = Executors.newCachedThreadPool();
 98         server.setExecutor(ex);
 99         server.start();
100 
101         int port = server.getAddress().getPort();
102 
103         // Test 1: fixed length
104 
<span class="line-modified">105         Socket sock = new Socket(loopback, port);</span>
106         String s1 = &quot;POST /foo HTTP/1.1\r\nContent-length: 200000\r\n&quot;
107                 + &quot;\r\nfoo bar99&quot;;
108 
109         OutputStream os = sock.getOutputStream();
110         os.write(s1.getBytes(StandardCharsets.ISO_8859_1));
111         Thread.sleep(500);
112 
113         sock.close();
114 
115         // Test 2: chunked
116 
117         String s2 = &quot;POST /foo HTTP/1.1\r\nTransfer-encoding: chunked\r\n\r\n&quot; +
118                 &quot;100\r\nFoo bar&quot;;
<span class="line-modified">119         sock = new Socket(loopback, port);</span>
120         os = sock.getOutputStream();
121         os.write(s2.getBytes(StandardCharsets.ISO_8859_1));
122         Thread.sleep(500);
123         sock.close();
124         latch.await();
125         server.stop(0);
126         ex.shutdownNow();
127         if (error)
128             throw new RuntimeException(&quot;Test failed&quot;);
129     }
130 }
</pre>
</td>
</tr>
</table>
<center><a href="HeadTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../nio/sctp/SctpChannel/Bind.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>