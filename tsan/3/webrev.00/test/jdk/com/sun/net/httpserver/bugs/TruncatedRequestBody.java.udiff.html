<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/com/sun/net/httpserver/bugs/TruncatedRequestBody.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="HeadTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../nio/sctp/SctpChannel/Bind.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/com/sun/net/httpserver/bugs/TruncatedRequestBody.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -88,22 +88,23 @@</span>
          ConsoleHandler h = new ConsoleHandler();
          h.setLevel(Level.ALL);
          logger.setLevel(Level.ALL);
          logger.addHandler(h);
  
<span class="udiff-line-modified-removed">-         InetSocketAddress addr = new InetSocketAddress(0);</span>
<span class="udiff-line-modified-added">+         InetAddress loopback = InetAddress.getLoopbackAddress();</span>
<span class="udiff-line-added">+         InetSocketAddress addr = new InetSocketAddress(loopback, 0);</span>
          HttpServer server = HttpServer.create(addr, 10);
          HttpContext ct = server.createContext(&quot;/&quot;, new Handler());
          ExecutorService ex = Executors.newCachedThreadPool();
          server.setExecutor(ex);
          server.start();
  
          int port = server.getAddress().getPort();
  
          // Test 1: fixed length
  
<span class="udiff-line-modified-removed">-         Socket sock = new Socket(InetAddress.getLoopbackAddress(), port);</span>
<span class="udiff-line-modified-added">+         Socket sock = new Socket(loopback, port);</span>
          String s1 = &quot;POST /foo HTTP/1.1\r\nContent-length: 200000\r\n&quot;
                  + &quot;\r\nfoo bar99&quot;;
  
          OutputStream os = sock.getOutputStream();
          os.write(s1.getBytes(StandardCharsets.ISO_8859_1));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -113,11 +114,11 @@</span>
  
          // Test 2: chunked
  
          String s2 = &quot;POST /foo HTTP/1.1\r\nTransfer-encoding: chunked\r\n\r\n&quot; +
                  &quot;100\r\nFoo bar&quot;;
<span class="udiff-line-modified-removed">-         sock = new Socket(InetAddress.getLoopbackAddress(), port);</span>
<span class="udiff-line-modified-added">+         sock = new Socket(loopback, port);</span>
          os = sock.getOutputStream();
          os.write(s2.getBytes(StandardCharsets.ISO_8859_1));
          Thread.sleep(500);
          sock.close();
          latch.await();
</pre>
<center><a href="HeadTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../nio/sctp/SctpChannel/Bind.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>