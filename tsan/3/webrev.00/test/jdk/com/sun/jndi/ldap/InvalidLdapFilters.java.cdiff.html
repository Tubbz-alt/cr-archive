<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/com/sun/jndi/ldap/InvalidLdapFilters.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../jdi/lib/jdb/JdbTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="LdapDnsProviderTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/com/sun/jndi/ldap/InvalidLdapFilters.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2010, 2012, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2010, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 22,10 ***</span>
<span class="line-new-header">--- 22,11 ---</span>
   */
  
  /**
   * @test
   * @bug 6916202 7041125
<span class="line-added">+  * @library /test/lib</span>
   * @summary More cases of invalid ldap filters accepted and processed
   *      LDAP API does not catch malformed filters that contain two operands
   *      for the ! operator
   * @run main/othervm InvalidLdapFilters valid (cn=Babs)
   * @run main/othervm InvalidLdapFilters valid (&amp;(cn=Bob))
</pre>
<hr />
<pre>
<span class="line-old-header">*** 85,16 ***</span>
   */
  
  import java.io.*;
  import javax.naming.*;
  import javax.naming.directory.*;
<span class="line-modified">! import java.util.Properties;</span>
  import java.util.Hashtable;
  
  import java.net.Socket;
  import java.net.ServerSocket;
  
  public class InvalidLdapFilters {
      // Should we run the client or server in a separate thread?
      //
      // Both sides can throw exceptions, but do you have a preference
      // as to which side should be the main thread.
<span class="line-new-header">--- 86,20 ---</span>
   */
  
  import java.io.*;
  import javax.naming.*;
  import javax.naming.directory.*;
<span class="line-modified">! import java.net.InetAddress;</span>
<span class="line-added">+ import java.net.InetSocketAddress;</span>
<span class="line-added">+ import java.net.SocketAddress;</span>
  import java.util.Hashtable;
  
  import java.net.Socket;
  import java.net.ServerSocket;
  
<span class="line-added">+ import jdk.test.lib.net.URIBuilder;</span>
<span class="line-added">+ </span>
  public class InvalidLdapFilters {
      // Should we run the client or server in a separate thread?
      //
      // Both sides can throw exceptions, but do you have a preference
      // as to which side should be the main thread.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 109,13 ***</span>
      // Define the server side of the test.
      //
      // If the server prematurely exits, serverReady will be set to true
      // to avoid infinite hangs.
      void doServerSide() throws Exception {
<span class="line-modified">!         ServerSocket serverSock = new ServerSocket(serverPort);</span>
  
<span class="line-modified">!         // signal client, it&#39;s ready to accecpt connection</span>
          serverPort = serverSock.getLocalPort();
          serverReady = true;
  
          // accept a connection
          Socket socket = serverSock.accept();
<span class="line-new-header">--- 114,17 ---</span>
      // Define the server side of the test.
      //
      // If the server prematurely exits, serverReady will be set to true
      // to avoid infinite hangs.
      void doServerSide() throws Exception {
<span class="line-modified">!         ServerSocket serverSock = new ServerSocket();</span>
<span class="line-added">+         SocketAddress sockAddr = new InetSocketAddress(</span>
<span class="line-added">+                 InetAddress.getLoopbackAddress(), serverPort);</span>
<span class="line-added">+         // Bind server socket</span>
<span class="line-added">+         serverSock.bind(sockAddr);</span>
  
<span class="line-modified">!         // signal client, it&#39;s ready to accept connection</span>
          serverPort = serverSock.getLocalPort();
          serverReady = true;
  
          // accept a connection
          Socket socket = serverSock.accept();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 158,14 ***</span>
          while (!serverReady) {
              Thread.sleep(50);
          }
  
          // set up the environment for creating the initial context
<span class="line-modified">!         Hashtable&lt;Object, Object&gt; env = new Hashtable&lt;Object, Object&gt;();</span>
          env.put(Context.INITIAL_CONTEXT_FACTORY,
                                  &quot;com.sun.jndi.ldap.LdapCtxFactory&quot;);
<span class="line-modified">!         env.put(Context.PROVIDER_URL, &quot;ldap://localhost:&quot; + serverPort);</span>
          env.put(&quot;com.sun.jndi.ldap.read.timeout&quot;, &quot;1000&quot;);
  
          // env.put(Context.SECURITY_AUTHENTICATION, &quot;simple&quot;);
          // env.put(Context.SECURITY_PRINCIPAL,&quot;cn=root&quot;);
          // env.put(Context.SECURITY_CREDENTIALS,&quot;root&quot;);
<span class="line-new-header">--- 167,20 ---</span>
          while (!serverReady) {
              Thread.sleep(50);
          }
  
          // set up the environment for creating the initial context
<span class="line-modified">!         Hashtable&lt;Object, Object&gt; env = new Hashtable&lt;&gt;();</span>
          env.put(Context.INITIAL_CONTEXT_FACTORY,
                                  &quot;com.sun.jndi.ldap.LdapCtxFactory&quot;);
<span class="line-modified">!         String providerUrl = URIBuilder.newBuilder()</span>
<span class="line-added">+                 .scheme(&quot;ldap&quot;)</span>
<span class="line-added">+                 .loopback()</span>
<span class="line-added">+                 .port(serverPort)</span>
<span class="line-added">+                 .build()</span>
<span class="line-added">+                 .toString();</span>
<span class="line-added">+         env.put(Context.PROVIDER_URL, providerUrl);</span>
          env.put(&quot;com.sun.jndi.ldap.read.timeout&quot;, &quot;1000&quot;);
  
          // env.put(Context.SECURITY_AUTHENTICATION, &quot;simple&quot;);
          // env.put(Context.SECURITY_PRINCIPAL,&quot;cn=root&quot;);
          // env.put(Context.SECURITY_CREDENTIALS,&quot;root&quot;);
</pre>
<center><a href="../../jdi/lib/jdb/JdbTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="LdapDnsProviderTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>