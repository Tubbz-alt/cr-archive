<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/com/sun/management/ThreadMXBean/ThreadAllocatedMemory.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../OperatingSystemMXBean/GetCommittedVirtualMemorySize.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../net/httpserver/EchoHandler.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/com/sun/management/ThreadMXBean/ThreadAllocatedMemory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2015, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug     6173675</span>
 27  * @summary Basic test of ThreadMXBean.getThreadAllocatedBytes
 28  * @author  Paul Hohensee
 29  */
 30 
 31 import java.lang.management.*;
 32 
 33 public class ThreadAllocatedMemory {
 34     private static com.sun.management.ThreadMXBean mbean =
 35         (com.sun.management.ThreadMXBean)ManagementFactory.getThreadMXBean();
<span class="line-modified"> 36     private static boolean testFailed = false;</span>
<span class="line-modified"> 37     private static boolean done = false;</span>
<span class="line-removed"> 38     private static boolean done1 = false;</span>
 39     private static Object obj = new Object();
 40     private static final int NUM_THREADS = 10;
 41     private static Thread[] threads = new Thread[NUM_THREADS];
 42     private static long[] sizes = new long[NUM_THREADS];
 43 
 44     public static void main(String[] argv)
 45         throws Exception {
 46 
















 47         if (!mbean.isThreadAllocatedMemorySupported()) {
 48             return;
 49         }
 50 
 51         // disable allocated memory measurement
 52         if (mbean.isThreadAllocatedMemoryEnabled()) {
 53             mbean.setThreadAllocatedMemoryEnabled(false);
 54         }
 55 
 56         if (mbean.isThreadAllocatedMemoryEnabled()) {
 57             throw new RuntimeException(
 58                 &quot;ThreadAllocatedMemory is expected to be disabled&quot;);
 59         }
 60 
<span class="line-modified"> 61         Thread curThread = Thread.currentThread();</span>
<span class="line-removed"> 62         long id = curThread.getId();</span>
<span class="line-removed"> 63 </span>
<span class="line-removed"> 64         long s = mbean.getThreadAllocatedBytes(id);</span>
 65         if (s != -1) {
 66             throw new RuntimeException(
 67                 &quot;Invalid ThreadAllocatedBytes returned = &quot; +
 68                 s + &quot; expected = -1&quot;);
 69         }
 70 
 71         // enable allocated memory measurement
 72         if (!mbean.isThreadAllocatedMemoryEnabled()) {
 73             mbean.setThreadAllocatedMemoryEnabled(true);
 74         }
 75 
 76         if (!mbean.isThreadAllocatedMemoryEnabled()) {
 77             throw new RuntimeException(
 78                 &quot;ThreadAllocatedMemory is expected to be enabled&quot;);
 79         }
















 80 
 81         long size = mbean.getThreadAllocatedBytes(id);
<span class="line-modified"> 82         // implementation could have started measurement when</span>
<span class="line-removed"> 83         // measurement was enabled, in which case size can be 0</span>
<span class="line-removed"> 84         if (size &lt; 0) {</span>
<span class="line-removed"> 85             throw new RuntimeException(</span>
<span class="line-removed"> 86                 &quot;Invalid allocated bytes returned = &quot; + size);</span>
<span class="line-removed"> 87         }</span>
 88 

 89         doit();
 90 
<span class="line-modified"> 91         // Expected to be size1 &gt;= size</span>
<span class="line-modified"> 92         long size1 = mbean.getThreadAllocatedBytes(id);</span>
<span class="line-modified"> 93         if (size1 &lt; size) {</span>
<span class="line-modified"> 94             throw new RuntimeException(&quot;Allocated bytes &quot; + size1 +</span>
<span class="line-modified"> 95                 &quot; expected &gt;= &quot; + size);</span>






























 96         }
<span class="line-removed"> 97         System.out.println(curThread.getName() +</span>
<span class="line-removed"> 98             &quot; Current thread allocated bytes = &quot; + size +</span>
<span class="line-removed"> 99             &quot; allocated bytes = &quot; + size1);</span>
100 







101 
<span class="line-modified">102         // start threads, wait for them to block</span>




103         for (int i = 0; i &lt; NUM_THREADS; i++) {
104             threads[i] = new MyThread(&quot;MyThread-&quot; + i);
105             threads[i].start();
106         }
107 
<span class="line-modified">108         // threads block after doing some allocation</span>
<span class="line-modified">109         waitUntilThreadBlocked();</span>
110 
111         for (int i = 0; i &lt; NUM_THREADS; i++) {
112             sizes[i] = mbean.getThreadAllocatedBytes(threads[i].getId());

113         }
114 
<span class="line-modified">115         // let threads go and do some more allocation</span>
116         synchronized (obj) {
117             done = true;
118             obj.notifyAll();
119         }
120 
<span class="line-modified">121         // wait for threads to get going again.  we don&#39;t care if we</span>
122         // catch them in mid-execution or if some of them haven&#39;t
123         // restarted after we&#39;re done sleeping.
124         goSleep(400);
125 
126         for (int i = 0; i &lt; NUM_THREADS; i++) {
<span class="line-modified">127             long newSize = mbean.getThreadAllocatedBytes(threads[i].getId());</span>
<span class="line-modified">128             if (sizes[i] &gt; newSize) {</span>
<span class="line-removed">129                 throw new RuntimeException(&quot;TEST FAILED: &quot; +</span>
<span class="line-removed">130                     threads[i].getName() +</span>
<span class="line-removed">131                     &quot; previous allocated bytes = &quot; + sizes[i] +</span>
<span class="line-removed">132                     &quot; &gt; current allocated bytes = &quot; + newSize);</span>
<span class="line-removed">133             }</span>
<span class="line-removed">134             System.out.println(threads[i].getName() +</span>
<span class="line-removed">135                 &quot; Previous allocated bytes = &quot; + sizes[i] +</span>
<span class="line-removed">136                 &quot; Current allocated bytes = &quot; + newSize);</span>
137         }
138 
139         // let threads exit
140         synchronized (obj) {
141             done1 = true;
142             obj.notifyAll();
143         }
144 
145         for (int i = 0; i &lt; NUM_THREADS; i++) {
146             try {
147                 threads[i].join();
148             } catch (InterruptedException e) {
149                 System.out.println(&quot;Unexpected exception is thrown.&quot;);
150                 e.printStackTrace(System.out);
<span class="line-removed">151                 testFailed = true;</span>
152                 break;
153             }
154         }
<span class="line-modified">155         if (testFailed) {</span>
<span class="line-removed">156             throw new RuntimeException(&quot;TEST FAILED&quot;);</span>
<span class="line-removed">157         }</span>
158 
<span class="line-modified">159         System.out.println(&quot;Test passed&quot;);</span>






160     }
161 










162 
163     private static void goSleep(long ms) throws Exception {
164         try {
165             Thread.sleep(ms);
166         } catch (InterruptedException e) {
167             System.out.println(&quot;Unexpected exception is thrown.&quot;);
168             throw e;
169         }
170     }
171 
<span class="line-modified">172     private static void waitUntilThreadBlocked()</span>











173         throws Exception {
174         int count = 0;
175         while (count != NUM_THREADS) {
176             goSleep(100);
177             count = 0;
178             for (int i = 0; i &lt; NUM_THREADS; i++) {
179                 ThreadInfo info = mbean.getThreadInfo(threads[i].getId());
180                 if (info.getThreadState() == Thread.State.WAITING) {
181                     count++;
182                 }
183             }
184         }
185     }
186 
187     public static void doit() {
188         String tmp = &quot;&quot;;
189         long hashCode = 0;
190         for (int counter = 0; counter &lt; 1000; counter++) {
191             tmp += counter;
192             hashCode = tmp.hashCode();
193         }
194         System.out.println(Thread.currentThread().getName() +
195                            &quot; hashcode: &quot; + hashCode);
196     }
197 
198     static class MyThread extends Thread {
199         public MyThread(String name) {
200             super(name);
201         }
202 
203         public void run() {
204             ThreadAllocatedMemory.doit();
205 
206             synchronized (obj) {
207                 while (!done) {
208                     try {
209                         obj.wait();
210                     } catch (InterruptedException e) {
211                         System.out.println(&quot;Unexpected exception is thrown.&quot;);
212                         e.printStackTrace(System.out);
<span class="line-removed">213                         testFailed = true;</span>
214                         break;
215                     }
216                 }
217             }
218 
219             long size1 = mbean.getThreadAllocatedBytes(getId());
220             ThreadAllocatedMemory.doit();
221             long size2 = mbean.getThreadAllocatedBytes(getId());
222 
223             System.out.println(getName() + &quot;: &quot; +
224                 &quot;ThreadAllocatedBytes  = &quot; + size1 +
225                 &quot; ThreadAllocatedBytes  = &quot; + size2);
226 
227             if (size1 &gt; size2) {
<span class="line-modified">228                 throw new RuntimeException(&quot;TEST FAILED: &quot; + getName() +</span>
229                     &quot; ThreadAllocatedBytes = &quot; + size1 +
230                     &quot; &gt; ThreadAllocatedBytes = &quot; + size2);
231             }
232 
233             synchronized (obj) {
234                 while (!done1) {
235                     try {
236                         obj.wait();
237                     } catch (InterruptedException e) {
238                         System.out.println(&quot;Unexpected exception is thrown.&quot;);
239                         e.printStackTrace(System.out);
<span class="line-removed">240                         testFailed = true;</span>
241                         break;
242                     }
243                 }
244             }
245         }
246     }
247 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<span class="line-modified"> 26  * @bug     6173675 8231209</span>
 27  * @summary Basic test of ThreadMXBean.getThreadAllocatedBytes
 28  * @author  Paul Hohensee
 29  */
 30 
 31 import java.lang.management.*;
 32 
 33 public class ThreadAllocatedMemory {
 34     private static com.sun.management.ThreadMXBean mbean =
 35         (com.sun.management.ThreadMXBean)ManagementFactory.getThreadMXBean();
<span class="line-modified"> 36     private static volatile boolean done = false;</span>
<span class="line-modified"> 37     private static volatile boolean done1 = false;</span>

 38     private static Object obj = new Object();
 39     private static final int NUM_THREADS = 10;
 40     private static Thread[] threads = new Thread[NUM_THREADS];
 41     private static long[] sizes = new long[NUM_THREADS];
 42 
 43     public static void main(String[] argv)
 44         throws Exception {
 45 
<span class="line-added"> 46         testSupportEnableDisable();</span>
<span class="line-added"> 47 </span>
<span class="line-added"> 48         // Test current thread two ways</span>
<span class="line-added"> 49         testGetCurrentThreadAllocatedBytes();</span>
<span class="line-added"> 50         testCurrentThreadGetThreadAllocatedBytes();</span>
<span class="line-added"> 51 </span>
<span class="line-added"> 52         // Test a single thread that is not this one</span>
<span class="line-added"> 53         testGetThreadAllocatedBytes();</span>
<span class="line-added"> 54 </span>
<span class="line-added"> 55         // Test many threads that are not this one</span>
<span class="line-added"> 56         testGetThreadsAllocatedBytes();</span>
<span class="line-added"> 57 </span>
<span class="line-added"> 58         System.out.println(&quot;Test passed&quot;);</span>
<span class="line-added"> 59     }</span>
<span class="line-added"> 60 </span>
<span class="line-added"> 61     private static void testSupportEnableDisable() {</span>
 62         if (!mbean.isThreadAllocatedMemorySupported()) {
 63             return;
 64         }
 65 
 66         // disable allocated memory measurement
 67         if (mbean.isThreadAllocatedMemoryEnabled()) {
 68             mbean.setThreadAllocatedMemoryEnabled(false);
 69         }
 70 
 71         if (mbean.isThreadAllocatedMemoryEnabled()) {
 72             throw new RuntimeException(
 73                 &quot;ThreadAllocatedMemory is expected to be disabled&quot;);
 74         }
 75 
<span class="line-modified"> 76         long s = mbean.getCurrentThreadAllocatedBytes();</span>



 77         if (s != -1) {
 78             throw new RuntimeException(
 79                 &quot;Invalid ThreadAllocatedBytes returned = &quot; +
 80                 s + &quot; expected = -1&quot;);
 81         }
 82 
 83         // enable allocated memory measurement
 84         if (!mbean.isThreadAllocatedMemoryEnabled()) {
 85             mbean.setThreadAllocatedMemoryEnabled(true);
 86         }
 87 
 88         if (!mbean.isThreadAllocatedMemoryEnabled()) {
 89             throw new RuntimeException(
 90                 &quot;ThreadAllocatedMemory is expected to be enabled&quot;);
 91         }
<span class="line-added"> 92     }</span>
<span class="line-added"> 93 </span>
<span class="line-added"> 94     private static void testGetCurrentThreadAllocatedBytes() {</span>
<span class="line-added"> 95         long size = mbean.getCurrentThreadAllocatedBytes();</span>
<span class="line-added"> 96         ensureValidSize(size);</span>
<span class="line-added"> 97 </span>
<span class="line-added"> 98         // do some more allocation</span>
<span class="line-added"> 99         doit();</span>
<span class="line-added">100 </span>
<span class="line-added">101         checkResult(Thread.currentThread(), size,</span>
<span class="line-added">102                     mbean.getCurrentThreadAllocatedBytes());</span>
<span class="line-added">103     }</span>
<span class="line-added">104 </span>
<span class="line-added">105     private static void testCurrentThreadGetThreadAllocatedBytes() {</span>
<span class="line-added">106         Thread curThread = Thread.currentThread();</span>
<span class="line-added">107         long id = curThread.getId();</span>
108 
109         long size = mbean.getThreadAllocatedBytes(id);
<span class="line-modified">110         ensureValidSize(size);</span>





111 
<span class="line-added">112         // do some more allocation</span>
113         doit();
114 
<span class="line-modified">115         checkResult(curThread, size, mbean.getThreadAllocatedBytes(id));</span>
<span class="line-modified">116     }</span>
<span class="line-modified">117 </span>
<span class="line-modified">118     private static void testGetThreadAllocatedBytes()</span>
<span class="line-modified">119         throws Exception {</span>
<span class="line-added">120 </span>
<span class="line-added">121         // start a thread</span>
<span class="line-added">122         done = false; done1 = false;</span>
<span class="line-added">123         Thread curThread = new MyThread(&quot;MyThread&quot;);</span>
<span class="line-added">124         curThread.start();</span>
<span class="line-added">125         long id = curThread.getId();</span>
<span class="line-added">126 </span>
<span class="line-added">127         // wait for thread to block after doing some allocation</span>
<span class="line-added">128         waitUntilThreadBlocked(curThread);</span>
<span class="line-added">129 </span>
<span class="line-added">130         long size = mbean.getThreadAllocatedBytes(id);</span>
<span class="line-added">131         ensureValidSize(size);</span>
<span class="line-added">132 </span>
<span class="line-added">133         // let thread go to do some more allocation</span>
<span class="line-added">134         synchronized (obj) {</span>
<span class="line-added">135             done = true;</span>
<span class="line-added">136             obj.notifyAll();</span>
<span class="line-added">137         }</span>
<span class="line-added">138 </span>
<span class="line-added">139         // wait for thread to get going again. we don&#39;t care if we</span>
<span class="line-added">140         // catch it in mid-execution or if it hasn&#39;t</span>
<span class="line-added">141         // restarted after we&#39;re done sleeping.</span>
<span class="line-added">142         goSleep(400);</span>
<span class="line-added">143 </span>
<span class="line-added">144         checkResult(curThread, size, mbean.getThreadAllocatedBytes(id));</span>
<span class="line-added">145 </span>
<span class="line-added">146         // let thread exit</span>
<span class="line-added">147         synchronized (obj) {</span>
<span class="line-added">148             done1 = true;</span>
<span class="line-added">149             obj.notifyAll();</span>
150         }



151 
<span class="line-added">152         try {</span>
<span class="line-added">153             curThread.join();</span>
<span class="line-added">154         } catch (InterruptedException e) {</span>
<span class="line-added">155             System.out.println(&quot;Unexpected exception is thrown.&quot;);</span>
<span class="line-added">156             e.printStackTrace(System.out);</span>
<span class="line-added">157         }</span>
<span class="line-added">158     }</span>
159 
<span class="line-modified">160     private static void testGetThreadsAllocatedBytes()</span>
<span class="line-added">161         throws Exception {</span>
<span class="line-added">162 </span>
<span class="line-added">163         // start threads</span>
<span class="line-added">164         done = false; done1 = false;</span>
165         for (int i = 0; i &lt; NUM_THREADS; i++) {
166             threads[i] = new MyThread(&quot;MyThread-&quot; + i);
167             threads[i].start();
168         }
169 
<span class="line-modified">170         // wait for threads to block after doing some allocation</span>
<span class="line-modified">171         waitUntilThreadsBlocked();</span>
172 
173         for (int i = 0; i &lt; NUM_THREADS; i++) {
174             sizes[i] = mbean.getThreadAllocatedBytes(threads[i].getId());
<span class="line-added">175             ensureValidSize(sizes[i]);</span>
176         }
177 
<span class="line-modified">178         // let threads go to do some more allocation</span>
179         synchronized (obj) {
180             done = true;
181             obj.notifyAll();
182         }
183 
<span class="line-modified">184         // wait for threads to get going again. we don&#39;t care if we</span>
185         // catch them in mid-execution or if some of them haven&#39;t
186         // restarted after we&#39;re done sleeping.
187         goSleep(400);
188 
189         for (int i = 0; i &lt; NUM_THREADS; i++) {
<span class="line-modified">190             checkResult(threads[i], sizes[i],</span>
<span class="line-modified">191                         mbean.getThreadAllocatedBytes(threads[i].getId()));</span>








192         }
193 
194         // let threads exit
195         synchronized (obj) {
196             done1 = true;
197             obj.notifyAll();
198         }
199 
200         for (int i = 0; i &lt; NUM_THREADS; i++) {
201             try {
202                 threads[i].join();
203             } catch (InterruptedException e) {
204                 System.out.println(&quot;Unexpected exception is thrown.&quot;);
205                 e.printStackTrace(System.out);

206                 break;
207             }
208         }
<span class="line-modified">209     }</span>


210 
<span class="line-modified">211     private static void ensureValidSize(long size) {</span>
<span class="line-added">212         // implementation could have started measurement when</span>
<span class="line-added">213         // measurement was enabled, in which case size can be 0</span>
<span class="line-added">214         if (size &lt; 0) {</span>
<span class="line-added">215             throw new RuntimeException(</span>
<span class="line-added">216                 &quot;Invalid allocated bytes returned = &quot; + size);</span>
<span class="line-added">217         }</span>
218     }
219 
<span class="line-added">220     private static void checkResult(Thread curThread,</span>
<span class="line-added">221                                     long prev_size, long curr_size) {</span>
<span class="line-added">222         if (curr_size &lt; prev_size) {</span>
<span class="line-added">223             throw new RuntimeException(&quot;Allocated bytes &quot; + curr_size +</span>
<span class="line-added">224                                        &quot; expected &gt;= &quot; + prev_size);</span>
<span class="line-added">225         }</span>
<span class="line-added">226         System.out.println(curThread.getName() +</span>
<span class="line-added">227                            &quot; Previous allocated bytes = &quot; + prev_size +</span>
<span class="line-added">228                            &quot; Current allocated bytes = &quot; + curr_size);</span>
<span class="line-added">229     }</span>
230 
231     private static void goSleep(long ms) throws Exception {
232         try {
233             Thread.sleep(ms);
234         } catch (InterruptedException e) {
235             System.out.println(&quot;Unexpected exception is thrown.&quot;);
236             throw e;
237         }
238     }
239 
<span class="line-modified">240     private static void waitUntilThreadBlocked(Thread thread)</span>
<span class="line-added">241         throws Exception {</span>
<span class="line-added">242         while (true) {</span>
<span class="line-added">243             goSleep(100);</span>
<span class="line-added">244             ThreadInfo info = mbean.getThreadInfo(thread.getId());</span>
<span class="line-added">245             if (info.getThreadState() == Thread.State.WAITING) {</span>
<span class="line-added">246                 break;</span>
<span class="line-added">247             }</span>
<span class="line-added">248         }</span>
<span class="line-added">249     }</span>
<span class="line-added">250 </span>
<span class="line-added">251     private static void waitUntilThreadsBlocked()</span>
252         throws Exception {
253         int count = 0;
254         while (count != NUM_THREADS) {
255             goSleep(100);
256             count = 0;
257             for (int i = 0; i &lt; NUM_THREADS; i++) {
258                 ThreadInfo info = mbean.getThreadInfo(threads[i].getId());
259                 if (info.getThreadState() == Thread.State.WAITING) {
260                     count++;
261                 }
262             }
263         }
264     }
265 
266     public static void doit() {
267         String tmp = &quot;&quot;;
268         long hashCode = 0;
269         for (int counter = 0; counter &lt; 1000; counter++) {
270             tmp += counter;
271             hashCode = tmp.hashCode();
272         }
273         System.out.println(Thread.currentThread().getName() +
274                            &quot; hashcode: &quot; + hashCode);
275     }
276 
277     static class MyThread extends Thread {
278         public MyThread(String name) {
279             super(name);
280         }
281 
282         public void run() {
283             ThreadAllocatedMemory.doit();
284 
285             synchronized (obj) {
286                 while (!done) {
287                     try {
288                         obj.wait();
289                     } catch (InterruptedException e) {
290                         System.out.println(&quot;Unexpected exception is thrown.&quot;);
291                         e.printStackTrace(System.out);

292                         break;
293                     }
294                 }
295             }
296 
297             long size1 = mbean.getThreadAllocatedBytes(getId());
298             ThreadAllocatedMemory.doit();
299             long size2 = mbean.getThreadAllocatedBytes(getId());
300 
301             System.out.println(getName() + &quot;: &quot; +
302                 &quot;ThreadAllocatedBytes  = &quot; + size1 +
303                 &quot; ThreadAllocatedBytes  = &quot; + size2);
304 
305             if (size1 &gt; size2) {
<span class="line-modified">306                 throw new RuntimeException(getName() +</span>
307                     &quot; ThreadAllocatedBytes = &quot; + size1 +
308                     &quot; &gt; ThreadAllocatedBytes = &quot; + size2);
309             }
310 
311             synchronized (obj) {
312                 while (!done1) {
313                     try {
314                         obj.wait();
315                     } catch (InterruptedException e) {
316                         System.out.println(&quot;Unexpected exception is thrown.&quot;);
317                         e.printStackTrace(System.out);

318                         break;
319                     }
320                 }
321             }
322         }
323     }
324 }
</pre>
</td>
</tr>
</table>
<center><a href="../OperatingSystemMXBean/GetCommittedVirtualMemorySize.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../net/httpserver/EchoHandler.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>