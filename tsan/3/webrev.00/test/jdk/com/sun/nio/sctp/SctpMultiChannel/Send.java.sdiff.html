<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/com/sun/nio/sctp/SctpMultiChannel/Send.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="Branch.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SendFailed.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/com/sun/nio/sctp/SctpMultiChannel/Send.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
259                 buffer.flip();
260                 check(info != null, &quot;info is null&quot;);
261                 check(info.streamNumber() == 0,
262                         &quot;message not sent on the correct stream&quot;);
263                 check(info.bytes() == Util.SMALL_MESSAGE.getBytes(&quot;ISO-8859-1&quot;).
264                       length, &quot;bytes received not equal to message length&quot;);
265                 check(info.bytes() == buffer.remaining(), &quot;bytes != remaining&quot;);
266                 check(Util.compare(buffer, Util.SMALL_MESSAGE),
267                   &quot;received message not the same as sent message&quot;);
268 
269                 check(info != null, &quot;info is null&quot;);
270                 Set&lt;Association&gt; assocs = serverChannel.associations();
271                 check(assocs.size() == 1, &quot;there should be only one association&quot;);
272                 Iterator&lt;Association&gt; it = assocs.iterator();
273                 check(it.hasNext());
274                 Association assoc = it.next();
275 
276                 /* echo the message */
277                 debug(&quot;Server: echoing first message&quot;);
278                 buffer.flip();
<span class="line-modified">279                 int bytes = serverChannel.send(buffer, info);</span>

280                 debug(&quot;Server: sent &quot; + bytes + &quot;bytes&quot;);
281 
282                 /* receive a large message */
283                 buffer.clear();
284                 do {
285                     info = serverChannel.receive(buffer, null, null);
286                     if (info == null) {
287                         fail(&quot;Server: unexpected null from receive&quot;);
288                             return;
289                     }
290                 } while (!info.isComplete());
291 
292                 buffer.flip();
293 
294                 check(info.streamNumber() == assoc.maxInboundStreams() - 1,
295                         &quot;message not sent on the correct stream&quot;);
296                 check(info.bytes() == Util.LARGE_MESSAGE.getBytes(&quot;ISO-8859-1&quot;).
297                       length, &quot;bytes received not equal to message length&quot;);
298                 check(info.bytes() == buffer.remaining(), &quot;bytes != remaining&quot;);
299                 check(Util.compare(buffer, Util.LARGE_MESSAGE),
300                   &quot;received message not the same as sent message&quot;);
301 
302                 /* echo the message */
303                 debug(&quot;Server: echoing second message&quot;);
304                 buffer.flip();
<span class="line-modified">305                 bytes = serverChannel.send(buffer, info);</span>

306                 debug(&quot;Server: sent &quot; + bytes + &quot;bytes&quot;);
307 
308                 /* TEST 6 */
309                 ByteBuffer expected = ByteBuffer.allocate(Util.SMALL_BUFFER);
310                 expected.put(Util.SMALL_MESSAGE.getBytes(&quot;ISO-8859-1&quot;));
311                 expected.flip();
312                 final int offset = 1;
313                 expected.position(offset);
314                 buffer.clear();
315                 do {
316                     info = serverChannel.receive(buffer, null, null);
317                     if (info == null) {
318                         fail(&quot;Server: unexpected null from receive&quot;);
319                         return;
320                     }
321                 } while (!info.isComplete());
322 
323                 buffer.flip();
324                 check(info != null, &quot;info is null&quot;);
325                 check(info.streamNumber() == 0, &quot;message not sent on the correct stream&quot;);
</pre>
</td>
<td>
<hr />
<pre>
259                 buffer.flip();
260                 check(info != null, &quot;info is null&quot;);
261                 check(info.streamNumber() == 0,
262                         &quot;message not sent on the correct stream&quot;);
263                 check(info.bytes() == Util.SMALL_MESSAGE.getBytes(&quot;ISO-8859-1&quot;).
264                       length, &quot;bytes received not equal to message length&quot;);
265                 check(info.bytes() == buffer.remaining(), &quot;bytes != remaining&quot;);
266                 check(Util.compare(buffer, Util.SMALL_MESSAGE),
267                   &quot;received message not the same as sent message&quot;);
268 
269                 check(info != null, &quot;info is null&quot;);
270                 Set&lt;Association&gt; assocs = serverChannel.associations();
271                 check(assocs.size() == 1, &quot;there should be only one association&quot;);
272                 Iterator&lt;Association&gt; it = assocs.iterator();
273                 check(it.hasNext());
274                 Association assoc = it.next();
275 
276                 /* echo the message */
277                 debug(&quot;Server: echoing first message&quot;);
278                 buffer.flip();
<span class="line-modified">279                 MessageInfo sendInfo = MessageInfo.createOutgoing(assoc, null, info.streamNumber());</span>
<span class="line-added">280                 int bytes = serverChannel.send(buffer, sendInfo);</span>
281                 debug(&quot;Server: sent &quot; + bytes + &quot;bytes&quot;);
282 
283                 /* receive a large message */
284                 buffer.clear();
285                 do {
286                     info = serverChannel.receive(buffer, null, null);
287                     if (info == null) {
288                         fail(&quot;Server: unexpected null from receive&quot;);
289                             return;
290                     }
291                 } while (!info.isComplete());
292 
293                 buffer.flip();
294 
295                 check(info.streamNumber() == assoc.maxInboundStreams() - 1,
296                         &quot;message not sent on the correct stream&quot;);
297                 check(info.bytes() == Util.LARGE_MESSAGE.getBytes(&quot;ISO-8859-1&quot;).
298                       length, &quot;bytes received not equal to message length&quot;);
299                 check(info.bytes() == buffer.remaining(), &quot;bytes != remaining&quot;);
300                 check(Util.compare(buffer, Util.LARGE_MESSAGE),
301                   &quot;received message not the same as sent message&quot;);
302 
303                 /* echo the message */
304                 debug(&quot;Server: echoing second message&quot;);
305                 buffer.flip();
<span class="line-modified">306                 sendInfo = MessageInfo.createOutgoing(assoc, null, info.streamNumber());</span>
<span class="line-added">307                 bytes = serverChannel.send(buffer, sendInfo);</span>
308                 debug(&quot;Server: sent &quot; + bytes + &quot;bytes&quot;);
309 
310                 /* TEST 6 */
311                 ByteBuffer expected = ByteBuffer.allocate(Util.SMALL_BUFFER);
312                 expected.put(Util.SMALL_MESSAGE.getBytes(&quot;ISO-8859-1&quot;));
313                 expected.flip();
314                 final int offset = 1;
315                 expected.position(offset);
316                 buffer.clear();
317                 do {
318                     info = serverChannel.receive(buffer, null, null);
319                     if (info == null) {
320                         fail(&quot;Server: unexpected null from receive&quot;);
321                         return;
322                     }
323                 } while (!info.isComplete());
324 
325                 buffer.flip();
326                 check(info != null, &quot;info is null&quot;);
327                 check(info.streamNumber() == 0, &quot;message not sent on the correct stream&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="Branch.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SendFailed.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>