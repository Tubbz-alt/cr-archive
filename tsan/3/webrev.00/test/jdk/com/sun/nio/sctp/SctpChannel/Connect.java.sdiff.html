<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/com/sun/nio/sctp/SctpChannel/Connect.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="CommUp.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SocketOptionTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/com/sun/nio/sctp/SctpChannel/Connect.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 44 import static java.lang.System.err;
 45 
 46 /**
 47  * Tests connect, finishConnect, isConnectionPending,
 48  * getRemoteAddresses and association.
 49  */
 50 public class Connect {
 51 
 52     void test(String[] args) {
 53         if (!Util.isSCTPSupported()) {
 54             out.println(&quot;SCTP protocol is not supported&quot;);
 55             out.println(&quot;Test cannot be run&quot;);
 56             return;
 57         }
 58 
 59         doTest();
 60     }
 61 
 62     void doTest() {
 63         SctpChannel channel = null;
<span class="line-removed"> 64         SctpServerChannel ssc = null;</span>
 65 
<span class="line-modified"> 66         try {</span>
 67             /* Create a server channel to connect to */
<span class="line-modified"> 68             ssc = SctpServerChannel.open().bind(null);</span>
 69             Set&lt;SocketAddress&gt; addrs = ssc.getAllLocalAddresses();
 70             if (addrs.isEmpty())
 71                 debug(&quot;addrs should not be empty&quot;);
 72             final SocketAddress peerAddress = (InetSocketAddress) addrs.iterator().next();
 73 
 74             channel = SctpChannel.open();
 75 
 76             /* TEST 0.5 Verify default values for new/unconnected channel */
 77             check(channel.getRemoteAddresses().isEmpty(),
 78                     &quot;non empty set for unconnected channel&quot;);
 79             check(channel.association() == null,
 80                     &quot;non-null association for unconnected channel&quot;);
 81             check(!channel.isConnectionPending(),
 82                     &quot;should not have a connection pending&quot;);
 83 
 84             /* TEST 1: non-blocking connect */
 85             channel.configureBlocking(false);
 86             if (channel.connect(peerAddress) != true) {
 87                 debug(&quot;non-blocking connect did not immediately succeed&quot;);
 88                 check(channel.isConnectionPending(),
</pre>
<hr />
<pre>
192             testCCE(new Callable&lt;Void&gt;() {
193                 public Void call() throws IOException {
194                     cceChannel.finishConnect(); return null; } });
195 
196             /* TEST 8: IOException: Connection refused. Exercises handleSocketError.
197              *         Assumption: no sctp socket listening on 3456 */
198             SocketAddress addr = new InetSocketAddress(&quot;localhost&quot;, 3456);
199             channel = SctpChannel.open();
200             try {
201                 channel.connect(addr);
202                 fail(&quot;should have thrown ConnectException: Connection refused&quot;);
203             } catch (IOException ioe) {
204                 pass();
205             }
206 
207         } catch (IOException ioe) {
208             unexpected(ioe);
209         } finally {
210             try { if (channel != null) channel.close(); }
211             catch (IOException unused) {}
<span class="line-removed">212             try { if (ssc != null) ssc.close(); }</span>
<span class="line-removed">213             catch (IOException unused) {}</span>
214         }
215     }
216 
217     class UnsupportedSocketAddress extends SocketAddress { }
218 
219     void testCCE(Callable callable) {
220         try {
221             callable.call();
222             fail(&quot;should have thrown ClosedChannelException&quot;);
223         } catch (ClosedChannelException cce) {
224            pass();
225         } catch (Exception ioe) {
226             unexpected(ioe);
227         }
228     }
229 
230         //--------------------- Infrastructure ---------------------------
231     boolean debug = true;
232     volatile int passed = 0, failed = 0;
233     void pass() {passed++;}
</pre>
</td>
<td>
<hr />
<pre>
 44 import static java.lang.System.err;
 45 
 46 /**
 47  * Tests connect, finishConnect, isConnectionPending,
 48  * getRemoteAddresses and association.
 49  */
 50 public class Connect {
 51 
 52     void test(String[] args) {
 53         if (!Util.isSCTPSupported()) {
 54             out.println(&quot;SCTP protocol is not supported&quot;);
 55             out.println(&quot;Test cannot be run&quot;);
 56             return;
 57         }
 58 
 59         doTest();
 60     }
 61 
 62     void doTest() {
 63         SctpChannel channel = null;

 64 
<span class="line-modified"> 65         try (SctpServerChannel ssc = SctpServerChannel.open()) {</span>
 66             /* Create a server channel to connect to */
<span class="line-modified"> 67             ssc.bind(null);</span>
 68             Set&lt;SocketAddress&gt; addrs = ssc.getAllLocalAddresses();
 69             if (addrs.isEmpty())
 70                 debug(&quot;addrs should not be empty&quot;);
 71             final SocketAddress peerAddress = (InetSocketAddress) addrs.iterator().next();
 72 
 73             channel = SctpChannel.open();
 74 
 75             /* TEST 0.5 Verify default values for new/unconnected channel */
 76             check(channel.getRemoteAddresses().isEmpty(),
 77                     &quot;non empty set for unconnected channel&quot;);
 78             check(channel.association() == null,
 79                     &quot;non-null association for unconnected channel&quot;);
 80             check(!channel.isConnectionPending(),
 81                     &quot;should not have a connection pending&quot;);
 82 
 83             /* TEST 1: non-blocking connect */
 84             channel.configureBlocking(false);
 85             if (channel.connect(peerAddress) != true) {
 86                 debug(&quot;non-blocking connect did not immediately succeed&quot;);
 87                 check(channel.isConnectionPending(),
</pre>
<hr />
<pre>
191             testCCE(new Callable&lt;Void&gt;() {
192                 public Void call() throws IOException {
193                     cceChannel.finishConnect(); return null; } });
194 
195             /* TEST 8: IOException: Connection refused. Exercises handleSocketError.
196              *         Assumption: no sctp socket listening on 3456 */
197             SocketAddress addr = new InetSocketAddress(&quot;localhost&quot;, 3456);
198             channel = SctpChannel.open();
199             try {
200                 channel.connect(addr);
201                 fail(&quot;should have thrown ConnectException: Connection refused&quot;);
202             } catch (IOException ioe) {
203                 pass();
204             }
205 
206         } catch (IOException ioe) {
207             unexpected(ioe);
208         } finally {
209             try { if (channel != null) channel.close(); }
210             catch (IOException unused) {}


211         }
212     }
213 
214     class UnsupportedSocketAddress extends SocketAddress { }
215 
216     void testCCE(Callable callable) {
217         try {
218             callable.call();
219             fail(&quot;should have thrown ClosedChannelException&quot;);
220         } catch (ClosedChannelException cce) {
221            pass();
222         } catch (Exception ioe) {
223             unexpected(ioe);
224         }
225     }
226 
227         //--------------------- Infrastructure ---------------------------
228     boolean debug = true;
229     volatile int passed = 0, failed = 0;
230     void pass() {passed++;}
</pre>
</td>
</tr>
</table>
<center><a href="CommUp.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SocketOptionTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>