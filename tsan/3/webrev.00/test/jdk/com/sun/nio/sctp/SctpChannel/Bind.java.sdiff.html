<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/com/sun/nio/sctp/SctpChannel/Bind.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../net/httpserver/bugs/TruncatedRequestBody.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CommUp.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/com/sun/nio/sctp/SctpChannel/Bind.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2009, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 93                     + channel.getAllLocalAddresses());
 94 
 95             /* TEST 4: AlreadyBoundException if this channel is already bound */
 96             try { channel.bind(null); }
 97             catch (AlreadyBoundException unused) { pass(); }
 98             catch (IOException ioe) { unexpected(ioe); }
 99 
100             /* TEST 5: UnsupportedAddressTypeException */
101             try {
102                 channel.close();  /* open a new unbound channel for test */
103                 channel = SctpChannel.open();
104                 channel.bind(new UnsupportedSocketAddress());
105                 fail(&quot;UnsupportedSocketAddress expected&quot;);
106             } catch (UnsupportedAddressTypeException unused) { pass();
107             } catch (IOException ioe) { unexpected(ioe); }
108 
109             /* TEST 6: AlreadyConnectedException */
110             try {
111                 channel.close();  /* open a new unbound channel for test */
112                 channel = SctpChannel.open();
<span class="line-modified">113                 connectChannel(channel);</span>
<span class="line-modified">114                 channel.bind(null);</span>
<span class="line-modified">115                 fail(&quot;AlreadyConnectedException expected&quot;);</span>

116             } catch (AlreadyConnectedException unused) { pass();
117             } catch (IOException ioe) { unexpected(ioe); }
118 
119             /* TEST 7: ClosedChannelException - If this channel is closed */
120             try {
121                 channel.close();  /* open a new unbound channel for test */
122                 channel = SctpChannel.open();
123                 channel.close();
124                 channel.bind(null);
125                 fail(&quot;ClosedChannelException expected&quot;);
126             } catch (ClosedChannelException unused) { pass();
127             } catch (IOException ioe) { unexpected(ioe); }
128 
129             /* TEST 8: ClosedChannelException if channel is closed */
130             try {
131                 channel.getAllLocalAddresses();
132                 fail(&quot;should have thrown ClosedChannelException&quot;);
133             } catch (ClosedChannelException cce) {
134                pass();
135             } catch (Exception ioe) {
</pre>
<hr />
<pre>
247                             debug(&quot;peerChannel Reached EOF&quot;);
248                             break;
249                         }
250                     }
251                 }
252 
253                 while((info = channel.receive(buffer, null, handler)) != null) {
254                     if (info != null) {
255                         if (info.bytes() == -1) {
256                             debug(&quot;channel Reached EOF&quot;);
257                             break;
258                         }
259                     }
260                 }
261             }
262         } catch (IOException ioe) {
263             ioe.printStackTrace();
264         } finally {
265             try { if (channel != null) channel.close(); }
266             catch (IOException ioe) { unexpected(ioe); }
<span class="line-modified">267         }</span>


268     }
269 
270     boolean boundAddress(SctpChannel channel, InetAddress addr)
271         throws IOException {
272         for (SocketAddress boundAddr : channel.getAllLocalAddresses()) {
273             if (((InetSocketAddress) boundAddr).getAddress().equals(addr))
274                 return true;
275         }
276         return false;
277     }
278 
279     SctpChannel connectChannel(SctpChannel channel)
280         throws IOException {
281         debug(&quot;connecting channel...&quot;);
282         try {
283             SctpServerChannel ssc = SctpServerChannel.open();
284             ssc.bind(null);
285             Set&lt;SocketAddress&gt; addrs = ssc.getAllLocalAddresses();
286             Iterator&lt;SocketAddress&gt; iterator = addrs.iterator();
287             SocketAddress addr = iterator.next();
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2009, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 93                     + channel.getAllLocalAddresses());
 94 
 95             /* TEST 4: AlreadyBoundException if this channel is already bound */
 96             try { channel.bind(null); }
 97             catch (AlreadyBoundException unused) { pass(); }
 98             catch (IOException ioe) { unexpected(ioe); }
 99 
100             /* TEST 5: UnsupportedAddressTypeException */
101             try {
102                 channel.close();  /* open a new unbound channel for test */
103                 channel = SctpChannel.open();
104                 channel.bind(new UnsupportedSocketAddress());
105                 fail(&quot;UnsupportedSocketAddress expected&quot;);
106             } catch (UnsupportedAddressTypeException unused) { pass();
107             } catch (IOException ioe) { unexpected(ioe); }
108 
109             /* TEST 6: AlreadyConnectedException */
110             try {
111                 channel.close();  /* open a new unbound channel for test */
112                 channel = SctpChannel.open();
<span class="line-modified">113                 try (var peer = connectChannel(channel)) {</span>
<span class="line-modified">114                     channel.bind(null);</span>
<span class="line-modified">115                     fail(&quot;AlreadyConnectedException expected&quot;);</span>
<span class="line-added">116                 }</span>
117             } catch (AlreadyConnectedException unused) { pass();
118             } catch (IOException ioe) { unexpected(ioe); }
119 
120             /* TEST 7: ClosedChannelException - If this channel is closed */
121             try {
122                 channel.close();  /* open a new unbound channel for test */
123                 channel = SctpChannel.open();
124                 channel.close();
125                 channel.bind(null);
126                 fail(&quot;ClosedChannelException expected&quot;);
127             } catch (ClosedChannelException unused) { pass();
128             } catch (IOException ioe) { unexpected(ioe); }
129 
130             /* TEST 8: ClosedChannelException if channel is closed */
131             try {
132                 channel.getAllLocalAddresses();
133                 fail(&quot;should have thrown ClosedChannelException&quot;);
134             } catch (ClosedChannelException cce) {
135                pass();
136             } catch (Exception ioe) {
</pre>
<hr />
<pre>
248                             debug(&quot;peerChannel Reached EOF&quot;);
249                             break;
250                         }
251                     }
252                 }
253 
254                 while((info = channel.receive(buffer, null, handler)) != null) {
255                     if (info != null) {
256                         if (info.bytes() == -1) {
257                             debug(&quot;channel Reached EOF&quot;);
258                             break;
259                         }
260                     }
261                 }
262             }
263         } catch (IOException ioe) {
264             ioe.printStackTrace();
265         } finally {
266             try { if (channel != null) channel.close(); }
267             catch (IOException ioe) { unexpected(ioe); }
<span class="line-modified">268             try { if (peerChannel != null) peerChannel.close(); }</span>
<span class="line-added">269             catch (IOException ioe) { unexpected(ioe); }</span>
<span class="line-added">270          }</span>
271     }
272 
273     boolean boundAddress(SctpChannel channel, InetAddress addr)
274         throws IOException {
275         for (SocketAddress boundAddr : channel.getAllLocalAddresses()) {
276             if (((InetSocketAddress) boundAddr).getAddress().equals(addr))
277                 return true;
278         }
279         return false;
280     }
281 
282     SctpChannel connectChannel(SctpChannel channel)
283         throws IOException {
284         debug(&quot;connecting channel...&quot;);
285         try {
286             SctpServerChannel ssc = SctpServerChannel.open();
287             ssc.bind(null);
288             Set&lt;SocketAddress&gt; addrs = ssc.getAllLocalAddresses();
289             Iterator&lt;SocketAddress&gt; iterator = addrs.iterator();
290             SocketAddress addr = iterator.next();
</pre>
</td>
</tr>
</table>
<center><a href="../../../net/httpserver/bugs/TruncatedRequestBody.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CommUp.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>