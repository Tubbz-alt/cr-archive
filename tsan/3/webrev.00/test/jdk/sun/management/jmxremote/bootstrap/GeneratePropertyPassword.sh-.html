<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/jdk/sun/management/jmxremote/bootstrap/GeneratePropertyPassword.sh</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 #
  2 # Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.
  8 #
  9 # This code is distributed in the hope that it will be useful, but WITHOUT
 10 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12 # version 2 for more details (a copy is included in the LICENSE file that
 13 # accompanied this code).
 14 #
 15 # You should have received a copy of the GNU General Public License version
 16 # 2 along with this work; if not, write to the Free Software Foundation,
 17 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18 #
 19 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20 # or visit www.oracle.com if you need additional information or have any
 21 # questions.
 22 #
 23 
 24 #
 25 # Utility Shell Script for generating .properties files or .password files
 26 # or .access files from a list of input .in files.
 27 #
 28 # Source in this GeneratePropertyPassword.sh and call the function
 29 # generatePropertyPasswordFiles.
 30 # Call restoreFilePermissions to restore file permissions after the test completes
 31 #
 32 
 33 
 34 OS=`uname -s`
 35 UMASK=`umask`
 36 
 37 case $OS in
 38 CYGWIN_NT*)
 39     OS=&quot;Windows_NT&quot;
 40     if [ -z &quot;$SystemRoot&quot; ] ;  then
 41         SystemRoot=`cygpath $SYSTEMROOT`
 42     fi
 43 esac
 44 
 45 case $OS in
 46 SunOS | Linux | Darwin | AIX )
 47     PATHSEP=&quot;:&quot;
 48     FILESEP=&quot;/&quot;
 49     DFILESEP=$FILESEP
 50     TMP_FILE=${TESTCLASSES}${FILESEP}${TESTCLASS}.sed.tmpfile
 51 
 52 cat &lt;&lt;EOF &gt; ${TMP_FILE}
 53 s^@TEST-SRC@/^${TESTCLASSES}${DFILESEP}^g
 54 EOF
 55     ;;
 56 Windows_95 | Windows_98 | Windows_NT | Windows_ME | CYGWIN*)
 57     PATHSEP=&quot;;&quot;
 58     FILESEP=&quot;\\&quot;
 59     DFILESEP=$FILESEP$FILESEP
 60     TMP_FILE=${TESTCLASSES}${FILESEP}${TESTCLASS}.sed.tmpfile
 61 
 62 cat &lt;&lt;EOF &gt; ${TMP_FILE}0
 63 s^@TEST-SRC@/^${TESTCLASSES}${DFILESEP}^g
 64 EOF
 65     # Need to put double backslash in the .properties files
 66     cat ${TMP_FILE}0 | sed -e &#39;s^\\\\^ZZZZ^g&#39; | \
 67         sed -e &#39;s^\\^ZZZZ^g&#39; | \
 68         sed -e &#39;s^ZZZZ^\\\\\\\\^g&#39; &gt; ${TMP_FILE}
 69 
 70     if [ &quot;$OS&quot; = &quot;Windows_NT&quot; ]; then
 71         USER=`id -u -n`
 72         CACLS=&quot;$SystemRoot/system32/cacls.exe&quot;
 73         TEST_SRC=`cygpath ${TESTSRC}`
 74         REVOKEALL=&quot;$TEST_SRC/../../windows/revokeall.exe&quot;
 75         if [ ! -f &quot;$REVOKEALL&quot; ] ; then
 76             echo &quot;$REVOKEALL missing&quot;
 77             exit 1
 78         fi
 79         chmod ug+x $REVOKEALL
 80     fi
 81     ;;
 82 *)
 83     echo &quot;Unrecognized system! $OS&quot;
 84     exit 1
 85     ;;
 86 esac
 87 
 88 generatePropertyPasswordFiles()
 89 {
 90    for f in $@
 91    do
 92         echo processing $f
 93         suffix=`basename $f .in`
 94         f2=&quot;${TESTCLASSES}${FILESEP}${suffix}&quot;
 95 
 96         if [ -f &quot;$f2&quot; ] ; then
 97             rm -f $f2 || echo WARNING: $f2 already exits - unable to remove old copy
 98         fi
 99 
100         echo creating $f2
101         sed -f $TMP_FILE $f &gt; $f2
102 
103         if [ &quot;$OS&quot; = &quot;Windows_NT&quot; ]; then
104             chown $USER $f2
105             # Grant this user full access
106             echo Y|$CACLS $f2 \/E \/G $USER:F
107             # Revoke everyone else
108             $REVOKEALL $f2
109             # Display ACLs
110             $CACLS $f2
111         else
112             chmod 600 $f2
113         fi
114    done
115 }
116 
117 restoreFilePermissions()
118 {
119     for f in $@
120     do
121         suffix=`basename $f .in`
122         f2=&quot;${TESTCLASSES}${FILESEP}${suffix}&quot;
123 
124         if [ &quot;$OS&quot; = &quot;Windows_NT&quot; ]; then
125             # Grant everyone full control
126             $CACLS $f2 \/E \/G Everyone:F
127         else
128             chmod 777 $f2
129         fi
130 
131     done
132 }
133 
    </pre>
  </body>
</html>