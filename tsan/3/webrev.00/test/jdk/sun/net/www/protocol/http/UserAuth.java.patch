diff a/test/jdk/sun/net/www/protocol/http/UserAuth.java b/test/jdk/sun/net/www/protocol/http/UserAuth.java
--- a/test/jdk/sun/net/www/protocol/http/UserAuth.java
+++ b/test/jdk/sun/net/www/protocol/http/UserAuth.java
@@ -1,7 +1,7 @@
 /*
- * Copyright (c) 2006, 2016, Oracle and/or its affiliates. All rights reserved.
+ * Copyright (c) 2006, 2019, Oracle and/or its affiliates. All rights reserved.
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
  * This code is free software; you can redistribute it and/or modify it
  * under the terms of the GNU General Public License version 2 only, as
  * published by the Free Software Foundation.
@@ -33,11 +33,11 @@
 import com.sun.net.httpserver.*;
 import java.util.*;
 import java.io.*;
 import java.util.concurrent.Executors;
 import java.util.concurrent.ExecutorService;
-
+import static java.net.Proxy.NO_PROXY;
 
 public class UserAuth
 {
     com.sun.net.httpserver.HttpServer httpServer;
     ExecutorService executorService;
@@ -59,11 +59,11 @@
         try {
             InetSocketAddress address = httpServer.getAddress();
 
             // GET Request
             URL url = new URL("http://" + address.getHostName() + ":" + address.getPort() + "/redirect/");
-            HttpURLConnection uc = (HttpURLConnection)url.openConnection();
+            HttpURLConnection uc = (HttpURLConnection)url.openConnection(NO_PROXY);
             uc.setRequestProperty("Authorization", "testString:ValueDoesNotMatter");
             int resp = uc.getResponseCode();
 
             System.out.println("Response Code is " + resp);
             if (resp != 200)
@@ -79,11 +79,23 @@
 
      /**
      * Http Server
      */
     void startHttpServer() throws IOException {
-        httpServer = com.sun.net.httpserver.HttpServer.create(new InetSocketAddress(0), 0);
+        InetAddress address = InetAddress.getLocalHost();
+        if (!InetAddress.getByName(address.getHostName()).equals(address)) {
+            // if this happens then we should possibly change the client
+            // side to use the address literal in its URL instead of
+            // the host name.
+            throw new IOException(address.getHostName()
+                                  + " resolves to "
+                                  + InetAddress.getByName(address.getHostName())
+                                  + " not to "
+                                  + address + ": check host configuration.");
+        }
+
+        httpServer = com.sun.net.httpserver.HttpServer.create(new InetSocketAddress(address, 0), 0);
 
         // create HttpServer context
         HttpContext ctx = httpServer.createContext("/redirect/", new RedirectHandler());
         HttpContext ctx1 = httpServer.createContext("/doStuff/", new HasAuthHandler());
 
