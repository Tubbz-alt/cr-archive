<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/net/www/ftptest/FtpServer.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="FtpCommandHandler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../http/ChunkedInputStream/ChunkedEncodingTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/net/www/ftptest/FtpServer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2006, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 37  *
 38  * Usage example:&lt;p&gt;
 39  *
 40  * &lt;code&gt;
 41  * FtpServer server = new FtpServer(0);
 42  * int port = server.getLocalPort();
 43  * server.setFileSystemHandler(myFSHandler);
 44  * server.setAuthHandler(myAuthHandler);
 45  * server.start();
 46  * &lt;/code&gt;
 47  *
 48  */
 49 
 50 public class FtpServer extends Thread implements AutoCloseable {
 51     private ServerSocket listener = null;
 52     private FtpFileSystemHandler fsh = null;
 53     private FtpAuthHandler auth = null;
 54     private boolean done = false;
 55     private ArrayList&lt;FtpCommandHandler&gt; clients = new ArrayList&lt;FtpCommandHandler&gt;();
 56 










 57     /**
 58      * Creates an instance of an FTP server which will listen for incoming
 59      * connections on the specified port. If the port is set to 0, it will
 60      * automatically select an available ephemeral port.
 61      */
 62     public FtpServer(int port) throws IOException {
 63         listener = new ServerSocket(port);
 64     }
 65 
 66     /**
 67      * Creates an instance of an FTP server that will listen on the default
 68      * FTP port, usually 21.
 69      */
 70     public FtpServer() throws IOException {
 71         this(21);
 72     }
 73 
 74     public void setFileSystemHandler(FtpFileSystemHandler f) {
 75         fsh = f;
 76     }
</pre>
<hr />
<pre>
 83         done = true;
 84         interrupt();
 85     }
 86 
 87     public void killClients() {
 88         synchronized (clients) {
 89             int c = clients.size();
 90             while (c &gt; 0) {
 91                 c--;
 92                 FtpCommandHandler cl = clients.get(c);
 93                 cl.terminate();
 94                 cl.interrupt();
 95             }
 96         }
 97     }
 98 
 99     public int getLocalPort() {
100         return listener.getLocalPort();
101     }
102 















103     void addClient(Socket client) {
104         FtpCommandHandler h = new FtpCommandHandler(client, this);
105         h.setHandlers(fsh, auth);
106         synchronized (clients) {
107             clients.add(h);
108         }
109         h.start();
110     }
111 
112     void removeClient(FtpCommandHandler cl) {
113         synchronized (clients) {
114             clients.remove(cl);
115         }
116     }
117 
118     public int activeClientsCount() {
119         synchronized (clients) {
120             return clients.size();
121         }
122     }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2006, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 37  *
 38  * Usage example:&lt;p&gt;
 39  *
 40  * &lt;code&gt;
 41  * FtpServer server = new FtpServer(0);
 42  * int port = server.getLocalPort();
 43  * server.setFileSystemHandler(myFSHandler);
 44  * server.setAuthHandler(myAuthHandler);
 45  * server.start();
 46  * &lt;/code&gt;
 47  *
 48  */
 49 
 50 public class FtpServer extends Thread implements AutoCloseable {
 51     private ServerSocket listener = null;
 52     private FtpFileSystemHandler fsh = null;
 53     private FtpAuthHandler auth = null;
 54     private boolean done = false;
 55     private ArrayList&lt;FtpCommandHandler&gt; clients = new ArrayList&lt;FtpCommandHandler&gt;();
 56 
<span class="line-added"> 57     /**</span>
<span class="line-added"> 58      * Creates an instance of an FTP server which will listen for incoming</span>
<span class="line-added"> 59      * connections on the specified port. If the port is set to 0, it will</span>
<span class="line-added"> 60      * automatically select an available ephemeral port.</span>
<span class="line-added"> 61      */</span>
<span class="line-added"> 62     public FtpServer(InetAddress addr, int port) throws IOException {</span>
<span class="line-added"> 63         listener = new ServerSocket();</span>
<span class="line-added"> 64         listener.bind(new InetSocketAddress(addr, port));</span>
<span class="line-added"> 65     }</span>
<span class="line-added"> 66 </span>
 67     /**
 68      * Creates an instance of an FTP server which will listen for incoming
 69      * connections on the specified port. If the port is set to 0, it will
 70      * automatically select an available ephemeral port.
 71      */
 72     public FtpServer(int port) throws IOException {
 73         listener = new ServerSocket(port);
 74     }
 75 
 76     /**
 77      * Creates an instance of an FTP server that will listen on the default
 78      * FTP port, usually 21.
 79      */
 80     public FtpServer() throws IOException {
 81         this(21);
 82     }
 83 
 84     public void setFileSystemHandler(FtpFileSystemHandler f) {
 85         fsh = f;
 86     }
</pre>
<hr />
<pre>
 93         done = true;
 94         interrupt();
 95     }
 96 
 97     public void killClients() {
 98         synchronized (clients) {
 99             int c = clients.size();
100             while (c &gt; 0) {
101                 c--;
102                 FtpCommandHandler cl = clients.get(c);
103                 cl.terminate();
104                 cl.interrupt();
105             }
106         }
107     }
108 
109     public int getLocalPort() {
110         return listener.getLocalPort();
111     }
112 
<span class="line-added">113     public InetAddress getInetAddress() {</span>
<span class="line-added">114         return listener.getInetAddress();</span>
<span class="line-added">115     }</span>
<span class="line-added">116 </span>
<span class="line-added">117     public String getAuthority() {</span>
<span class="line-added">118         InetAddress address = getInetAddress();</span>
<span class="line-added">119         String hostaddr = address.isAnyLocalAddress()</span>
<span class="line-added">120             ? &quot;localhost&quot; : address.getHostAddress();</span>
<span class="line-added">121         if (hostaddr.indexOf(&#39;:&#39;) &gt; -1) {</span>
<span class="line-added">122             hostaddr = &quot;[&quot; + hostaddr + &quot;]&quot;;</span>
<span class="line-added">123         }</span>
<span class="line-added">124         return hostaddr + &quot;:&quot; + getLocalPort();</span>
<span class="line-added">125     }</span>
<span class="line-added">126 </span>
<span class="line-added">127 </span>
128     void addClient(Socket client) {
129         FtpCommandHandler h = new FtpCommandHandler(client, this);
130         h.setHandlers(fsh, auth);
131         synchronized (clients) {
132             clients.add(h);
133         }
134         h.start();
135     }
136 
137     void removeClient(FtpCommandHandler cl) {
138         synchronized (clients) {
139             clients.remove(cl);
140         }
141     }
142 
143     public int activeClientsCount() {
144         synchronized (clients) {
145             return clients.size();
146         }
147     }
</pre>
</td>
</tr>
</table>
<center><a href="FtpCommandHandler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../http/ChunkedInputStream/ChunkedEncodingTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>