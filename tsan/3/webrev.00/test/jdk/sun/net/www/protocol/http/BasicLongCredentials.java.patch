diff a/test/jdk/sun/net/www/protocol/http/BasicLongCredentials.java b/test/jdk/sun/net/www/protocol/http/BasicLongCredentials.java
--- a/test/jdk/sun/net/www/protocol/http/BasicLongCredentials.java
+++ b/test/jdk/sun/net/www/protocol/http/BasicLongCredentials.java
@@ -1,7 +1,7 @@
 /*
- * Copyright (c) 2010, 2016, Oracle and/or its affiliates. All rights reserved.
+ * Copyright (c) 2010, 2019, Oracle and/or its affiliates. All rights reserved.
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
  * This code is free software; you can redistribute it and/or modify it
  * under the terms of the GNU General Public License version 2 only, as
  * published by the Free Software Foundation.
@@ -24,10 +24,13 @@
 /**
  * @test
  * @bug 6947917
  * @modules jdk.httpserver
  * @summary  Error in basic authentication when user name and password are long
+ * @library /test/lib
+ * @run main BasicLongCredentials
+ * @run main/othervm -Djava.net.preferIPv6Addresses=true BasicLongCredentials
  */
 
 import com.sun.net.httpserver.BasicAuthenticator;
 import com.sun.net.httpserver.HttpContext;
 import com.sun.net.httpserver.HttpExchange;
@@ -35,25 +38,30 @@
 import com.sun.net.httpserver.HttpPrincipal;
 import com.sun.net.httpserver.HttpServer;
 import java.io.InputStream;
 import java.io.IOException;
 import java.net.Authenticator;
+import java.net.InetAddress;
 import java.net.InetSocketAddress;
 import java.net.PasswordAuthentication;
+import java.net.Proxy;
 import java.net.HttpURLConnection;
 import java.net.URL;
 
+import jdk.test.lib.net.URIBuilder;
+
 public class BasicLongCredentials {
 
     static final String USERNAME = "ThisIsMyReallyReallyReallyReallyReallyReally" +
                                    "LongFirstNameDotLastNameAtCompanyEmailAddress";
     static final String PASSWORD = "AndThisIsALongLongLongLongLongLongLongLongLong" +
                                    "LongLongLongLongLongLongLongLongLongPassword";
     static final String REALM = "foobar@test.realm";
 
     public static void main (String[] args) throws Exception {
-        HttpServer server = HttpServer.create(new InetSocketAddress(0), 0);
+        InetAddress loopback = InetAddress.getLoopbackAddress();
+        HttpServer server = HttpServer.create(new InetSocketAddress(loopback, 0), 0);
         try {
             Handler handler = new Handler();
             HttpContext ctx = server.createContext("/test", handler);
 
             BasicAuthenticator a = new BasicAuthenticator(REALM) {
@@ -64,12 +72,17 @@
             ctx.setAuthenticator(a);
             server.start();
 
             Authenticator.setDefault(new MyAuthenticator());
 
-            URL url = new URL("http://localhost:"+server.getAddress().getPort()+"/test/");
-            HttpURLConnection urlc = (HttpURLConnection)url.openConnection();
+            URL url = URIBuilder.newBuilder()
+                      .scheme("http")
+                      .host(server.getAddress().getAddress())
+                      .port(server.getAddress().getPort())
+                      .path("/test/")
+                      .toURL();
+            HttpURLConnection urlc = (HttpURLConnection)url.openConnection(Proxy.NO_PROXY);
             InputStream is = urlc.getInputStream();
             int c = 0;
             while (is.read()!= -1) { c ++; }
 
             if (c != 0) { throw new RuntimeException("Test failed c = " + c); }
