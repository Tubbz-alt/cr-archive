<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/net/www/protocol/https/HttpsURLConnection/Identities.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="IPIdentities.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ImpactOnSNI.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/net/www/protocol/https/HttpsURLConnection/Identities.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2010, 2015, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
634     volatile static boolean closeReady = false;
635 
636     /*
637      * Turn on SSL debugging?
638      */
639     static boolean debug = false;
640 
641     private SSLServerSocket sslServerSocket = null;
642 
643     /*
644      * Define the server side of the test.
645      *
646      * If the server prematurely exits, serverReady will be set to true
647      * to avoid infinite hangs.
648      */
649     void doServerSide() throws Exception {
650         SSLContext context = getSSLContext(trusedCertStr, serverCertStr,
651             serverModulus, serverPrivateExponent, passphrase);
652         SSLServerSocketFactory sslssf = context.getServerSocketFactory();
653 




654         sslServerSocket =
<span class="line-modified">655             (SSLServerSocket) sslssf.createServerSocket(serverPort);</span>

656         serverPort = sslServerSocket.getLocalPort();
657 
658         /*
659          * Signal Client, we&#39;re ready for his connect.
660          */
661         serverReady = true;
662 
663         SSLSocket sslSocket = (SSLSocket) sslServerSocket.accept();
664         sslSocket.setNeedClientAuth(true);
665 
666         PrintStream out =
667                 new PrintStream(sslSocket.getOutputStream());
668 
669         try {
670             // ignore request data
671 
672             // send the response
673             out.print(&quot;HTTP/1.1 200 OK\r\n&quot;);
674             out.print(&quot;Content-Type: text/html; charset=iso-8859-1\r\n&quot;);
675             out.print(&quot;Content-Length: &quot;+ 9 +&quot;\r\n&quot;);
</pre>
<hr />
<pre>
700         try {
701             SSLContext context = getSSLContext(trusedCertStr, clientCertStr,
702                 clientModulus, clientPrivateExponent, passphrase);
703 
704             SSLContext.setDefault(context);
705 
706             /*
707              * Wait for server to get started.
708              */
709             while (!serverReady) {
710                 Thread.sleep(50);
711             }
712 
713             HttpsURLConnection http = null;
714 
715             /* establish http connection to server */
716             URL url = new URL(&quot;https://localhost:&quot; + serverPort+&quot;/&quot;);
717             System.out.println(&quot;url is &quot;+url.toString());
718 
719             try {
<span class="line-modified">720                 http = (HttpsURLConnection)url.openConnection();</span>
721 
722                 int respCode = http.getResponseCode();
723                 System.out.println(&quot;respCode = &quot;+respCode);
724             } finally {
725                 if (http != null) {
726                     http.disconnect();
727                 }
728                 closeReady = true;
729             }
730         } finally {
731             SSLContext.setDefault(reservedSSLContext);
732         }
733     }
734 
735     /*
736      * =============================================================
737      * The remainder is just support stuff
738      */
739 
740     // use any free port by default
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2010, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
634     volatile static boolean closeReady = false;
635 
636     /*
637      * Turn on SSL debugging?
638      */
639     static boolean debug = false;
640 
641     private SSLServerSocket sslServerSocket = null;
642 
643     /*
644      * Define the server side of the test.
645      *
646      * If the server prematurely exits, serverReady will be set to true
647      * to avoid infinite hangs.
648      */
649     void doServerSide() throws Exception {
650         SSLContext context = getSSLContext(trusedCertStr, serverCertStr,
651             serverModulus, serverPrivateExponent, passphrase);
652         SSLServerSocketFactory sslssf = context.getServerSocketFactory();
653 
<span class="line-added">654         // doClientSide() connects to &quot;localhost&quot;</span>
<span class="line-added">655         InetAddress localHost = InetAddress.getByName(&quot;localhost&quot;);</span>
<span class="line-added">656         InetSocketAddress address = new InetSocketAddress(localHost, serverPort);</span>
<span class="line-added">657 </span>
658         sslServerSocket =
<span class="line-modified">659             (SSLServerSocket) sslssf.createServerSocket();</span>
<span class="line-added">660         sslServerSocket.bind(address);</span>
661         serverPort = sslServerSocket.getLocalPort();
662 
663         /*
664          * Signal Client, we&#39;re ready for his connect.
665          */
666         serverReady = true;
667 
668         SSLSocket sslSocket = (SSLSocket) sslServerSocket.accept();
669         sslSocket.setNeedClientAuth(true);
670 
671         PrintStream out =
672                 new PrintStream(sslSocket.getOutputStream());
673 
674         try {
675             // ignore request data
676 
677             // send the response
678             out.print(&quot;HTTP/1.1 200 OK\r\n&quot;);
679             out.print(&quot;Content-Type: text/html; charset=iso-8859-1\r\n&quot;);
680             out.print(&quot;Content-Length: &quot;+ 9 +&quot;\r\n&quot;);
</pre>
<hr />
<pre>
705         try {
706             SSLContext context = getSSLContext(trusedCertStr, clientCertStr,
707                 clientModulus, clientPrivateExponent, passphrase);
708 
709             SSLContext.setDefault(context);
710 
711             /*
712              * Wait for server to get started.
713              */
714             while (!serverReady) {
715                 Thread.sleep(50);
716             }
717 
718             HttpsURLConnection http = null;
719 
720             /* establish http connection to server */
721             URL url = new URL(&quot;https://localhost:&quot; + serverPort+&quot;/&quot;);
722             System.out.println(&quot;url is &quot;+url.toString());
723 
724             try {
<span class="line-modified">725                 http = (HttpsURLConnection)url.openConnection(Proxy.NO_PROXY);</span>
726 
727                 int respCode = http.getResponseCode();
728                 System.out.println(&quot;respCode = &quot;+respCode);
729             } finally {
730                 if (http != null) {
731                     http.disconnect();
732                 }
733                 closeReady = true;
734             }
735         } finally {
736             SSLContext.setDefault(reservedSSLContext);
737         }
738     }
739 
740     /*
741      * =============================================================
742      * The remainder is just support stuff
743      */
744 
745     // use any free port by default
</pre>
</td>
</tr>
</table>
<center><a href="IPIdentities.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ImpactOnSNI.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>