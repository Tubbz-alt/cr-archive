<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/net/www/http/HttpClient/ProxyTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ProxyFromCache.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="RetryPost.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/net/www/http/HttpClient/ProxyTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2002, 2013, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
109                 out.println(&quot;Proxy-Connection: close&quot;);
110                 out.println();
111                 out.println(&quot;&lt;!doctype html public \&quot;-//w3c//dtd html 4.0 transitional//en\&quot;&gt;&quot;);
112                 out.println(&quot;&lt;html&gt;&quot;);
113                 out.println(&quot;&lt;head&gt;&quot;);
114                 out.println(&quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=iso-8859-1\&quot;&gt;&quot;);
115                 out.println(&quot;&lt;TITLE&gt;Hoth Downloads&lt;/TITLE&gt;&quot;);
116                 out.println(&quot;&lt;/head&gt;&quot;);
117                 out.println(&quot;&lt;body background=\&quot;/images/background.gif\&quot;&gt;&quot;);
118                 out.println(&quot;&lt;center&gt;&quot;);
119                 out.println(&quot;&lt;h1&gt;&quot;);
120                 out.println(&quot;&lt;b&gt;Hoth Downloads&lt;/b&gt;&lt;/h1&gt;&lt;/center&gt;&quot;);
121                 out.println(&quot;&lt;/body&gt;&quot;);
122                 out.println(&quot;&lt;/html&gt;&quot;);
123                 out.flush();
124                 out.close();
125             }
126         }
127 
128         public HttpProxyServer() throws IOException {
<span class="line-modified">129             server = new ServerSocket(0);</span>


130         }
131 
132         public int getPort() {
133             if (server != null)
134                 return server.getLocalPort();
135             return 0;
136         }
137 
138         public String getURL() {
139             return askedUrl;
140         }
141 
142         /**
143          * A way to tell the server that it can stop.
144          */
145         synchronized public void terminate() {
146             done = true;
147             try { server.close(); } catch (IOException unused) {}
148         }
149 
</pre>
<hr />
<pre>
166             return new java.net.URL(&quot;ftp://&quot;) != null;
167         } catch (java.net.MalformedURLException x) {
168             System.out.println(&quot;FTP not supported by this runtime.&quot;);
169             return false;
170         }
171     }
172 
173     public static void main(String[] args) throws Exception {
174         if (hasFtp())
175            new ProxyTest();
176     }
177 
178     public ProxyTest() throws Exception {
179         BufferedReader in = null;
180         String testURL = &quot;ftp://anonymous:password@myhost.mydomain/index.html&quot;;
181         HttpProxyServer server = new HttpProxyServer();
182         try {
183             server.start();
184             int port = server.getPort();
185 
<span class="line-modified">186             Proxy ftpProxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress(&quot;localhost&quot;, port));</span>

187             URL url = new URL(testURL);
188             InputStream ins = (url.openConnection(ftpProxy)).getInputStream();
189             in = new BufferedReader(new InputStreamReader(ins));
190             String line;
191             do {
192                 line = in.readLine();
193             } while (line != null);
194             in.close();
195         } catch (Exception e) {
196             e.printStackTrace();
197         } finally {
198             server.terminate();
199             try { in.close(); } catch (IOException unused) {}
200         }
201         /*
202          * If the URLs don&#39;t match, we&#39;ve got a bug!
203          */
204         if (!testURL.equals(server.getURL())) {
205             throw new RuntimeException(server.getURL() + &quot; != &quot; + testURL);
206         }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
109                 out.println(&quot;Proxy-Connection: close&quot;);
110                 out.println();
111                 out.println(&quot;&lt;!doctype html public \&quot;-//w3c//dtd html 4.0 transitional//en\&quot;&gt;&quot;);
112                 out.println(&quot;&lt;html&gt;&quot;);
113                 out.println(&quot;&lt;head&gt;&quot;);
114                 out.println(&quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=iso-8859-1\&quot;&gt;&quot;);
115                 out.println(&quot;&lt;TITLE&gt;Hoth Downloads&lt;/TITLE&gt;&quot;);
116                 out.println(&quot;&lt;/head&gt;&quot;);
117                 out.println(&quot;&lt;body background=\&quot;/images/background.gif\&quot;&gt;&quot;);
118                 out.println(&quot;&lt;center&gt;&quot;);
119                 out.println(&quot;&lt;h1&gt;&quot;);
120                 out.println(&quot;&lt;b&gt;Hoth Downloads&lt;/b&gt;&lt;/h1&gt;&lt;/center&gt;&quot;);
121                 out.println(&quot;&lt;/body&gt;&quot;);
122                 out.println(&quot;&lt;/html&gt;&quot;);
123                 out.flush();
124                 out.close();
125             }
126         }
127 
128         public HttpProxyServer() throws IOException {
<span class="line-modified">129             InetAddress loopback = InetAddress.getLoopbackAddress();</span>
<span class="line-added">130             server = new ServerSocket();</span>
<span class="line-added">131             server.bind(new InetSocketAddress(loopback, 0));</span>
132         }
133 
134         public int getPort() {
135             if (server != null)
136                 return server.getLocalPort();
137             return 0;
138         }
139 
140         public String getURL() {
141             return askedUrl;
142         }
143 
144         /**
145          * A way to tell the server that it can stop.
146          */
147         synchronized public void terminate() {
148             done = true;
149             try { server.close(); } catch (IOException unused) {}
150         }
151 
</pre>
<hr />
<pre>
168             return new java.net.URL(&quot;ftp://&quot;) != null;
169         } catch (java.net.MalformedURLException x) {
170             System.out.println(&quot;FTP not supported by this runtime.&quot;);
171             return false;
172         }
173     }
174 
175     public static void main(String[] args) throws Exception {
176         if (hasFtp())
177            new ProxyTest();
178     }
179 
180     public ProxyTest() throws Exception {
181         BufferedReader in = null;
182         String testURL = &quot;ftp://anonymous:password@myhost.mydomain/index.html&quot;;
183         HttpProxyServer server = new HttpProxyServer();
184         try {
185             server.start();
186             int port = server.getPort();
187 
<span class="line-modified">188             InetAddress loopback = InetAddress.getLoopbackAddress();</span>
<span class="line-added">189             Proxy ftpProxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress(loopback, port));</span>
190             URL url = new URL(testURL);
191             InputStream ins = (url.openConnection(ftpProxy)).getInputStream();
192             in = new BufferedReader(new InputStreamReader(ins));
193             String line;
194             do {
195                 line = in.readLine();
196             } while (line != null);
197             in.close();
198         } catch (Exception e) {
199             e.printStackTrace();
200         } finally {
201             server.terminate();
202             try { in.close(); } catch (IOException unused) {}
203         }
204         /*
205          * If the URLs don&#39;t match, we&#39;ve got a bug!
206          */
207         if (!testURL.equals(server.getURL())) {
208             throw new RuntimeException(server.getURL() + &quot; != &quot; + testURL);
209         }
</pre>
</td>
</tr>
</table>
<center><a href="ProxyFromCache.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="RetryPost.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>