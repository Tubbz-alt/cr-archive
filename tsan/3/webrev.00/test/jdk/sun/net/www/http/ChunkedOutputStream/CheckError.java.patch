diff a/test/jdk/sun/net/www/http/ChunkedOutputStream/CheckError.java b/test/jdk/sun/net/www/http/ChunkedOutputStream/CheckError.java
--- a/test/jdk/sun/net/www/http/ChunkedOutputStream/CheckError.java
+++ b/test/jdk/sun/net/www/http/ChunkedOutputStream/CheckError.java
@@ -1,7 +1,7 @@
 /*
- * Copyright (c) 2004, 2016, Oracle and/or its affiliates. All rights reserved.
+ * Copyright (c) 2004, 2019, Oracle and/or its affiliates. All rights reserved.
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
  * This code is free software; you can redistribute it and/or modify it
  * under the terms of the GNU General Public License version 2 only, as
  * published by the Free Software Foundation.
@@ -22,24 +22,32 @@
  */
 
 /**
  * @test
  * @bug 5054016
+ * @library /test/lib
  * @summary get the failure immediately when writing individual chunks over socket fail
+ * @run main CheckError
+ * @run main/othervm -Djava.net.preferIPv6Addresses=true CheckError
  */
 
 import java.io.BufferedReader;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
 import java.io.OutputStream;
 import java.net.HttpURLConnection;
+import java.net.InetAddress;
+import java.net.InetSocketAddress;
+import java.net.Proxy;
 import java.net.ServerSocket;
 import java.net.Socket;
 import java.net.URL;
 import static java.lang.System.out;
 
+import jdk.test.lib.net.URIBuilder;
+
 public class CheckError {
 
     static int BUFFER_SIZE = 8192; // 8k
     static int TOTAL_BYTES = 1 * 1024 * 1024; // 1M
 
@@ -49,12 +57,17 @@
         server.start();
         int port = server.getPort();
         out.println("Server listening on " + port);
 
 
-        URL url = new URL("http://localhost:" + port);
-        HttpURLConnection conn = (HttpURLConnection)url.openConnection();
+        URL url = URIBuilder.newBuilder()
+                  .scheme("http")
+                  .host(server.getAddress())
+                  .port(port)
+                  .toURL();
+
+        HttpURLConnection conn = (HttpURLConnection)url.openConnection(Proxy.NO_PROXY);
         conn.setRequestMethod("POST");
         conn.setDoOutput(true);
         conn.setChunkedStreamingMode(1024);
 
         out.println("sending " + TOTAL_BYTES + " bytes");
@@ -96,17 +109,23 @@
     static class HTTPServer extends Thread {
 
         final ServerSocket serverSocket;
 
         HTTPServer() throws IOException {
-            serverSocket = new ServerSocket(0);
+            InetAddress loopback = InetAddress.getLoopbackAddress();
+            serverSocket = new ServerSocket();
+            serverSocket.bind(new InetSocketAddress(loopback, 0));
         }
 
         int getPort() {
             return serverSocket.getLocalPort();
         }
 
+        InetAddress getAddress() {
+            return serverSocket.getInetAddress();
+        }
+
         public void run() {
             try (Socket client = serverSocket.accept()) {
 
                 InputStream in = client.getInputStream();
                 BufferedReader reader = new BufferedReader(new InputStreamReader(in));
