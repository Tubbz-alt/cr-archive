<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/net/www/protocol/https/HttpsURLConnection/ImpactOnSNI.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Identities.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PostThruProxy.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/net/www/protocol/https/HttpsURLConnection/ImpactOnSNI.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 78 
 79     /*
 80      * Message posted
 81      */
 82     private static final String postMsg = &quot;HTTP post on a https server&quot;;
 83 
 84     /*
 85      * the fully qualified domain name of localhost
 86      */
 87     private static String hostname = null;
 88 
 89     /*
 90      * If the client or server is doing some kind of object creation
 91      * that the other side depends on, and that thread prematurely
 92      * exits, you may experience a hang.  The test harness will
 93      * terminate all hung threads after its timeout has expired,
 94      * currently 3 minutes by default, but you might try to be
 95      * smart about it....
 96      */
 97 










 98     /*
 99      * Define the server side of the test.
100      *
101      * If the server prematurely exits, serverReady will be set to true
102      * to avoid infinite hangs.
103      */
104     private void doServerSide() throws Exception {
105         SSLServerSocketFactory sslssf =
106             (SSLServerSocketFactory)SSLServerSocketFactory.getDefault();
<span class="line-modified">107         try (SSLServerSocket sslServerSocket =</span>
<span class="line-removed">108                 (SSLServerSocket)sslssf.createServerSocket(serverPort)) {</span>
109 
110             serverPort = sslServerSocket.getLocalPort();
111 
112             /*
113              * Signal Client, we&#39;re ready for his connect.
114              */
115             serverReady = true;
116 
117             /*
118              * Accept connections
119              */
120             try (SSLSocket sslSocket = (SSLSocket)sslServerSocket.accept()) {
121                 InputStream sslIS = sslSocket.getInputStream();
122                 OutputStream sslOS = sslSocket.getOutputStream();
123                 BufferedReader br =
124                         new BufferedReader(new InputStreamReader(sslIS));
125                 PrintStream ps = new PrintStream(sslOS);
126 
127                 // process HTTP POST request from client
128                 System.out.println(&quot;status line: &quot; + br.readLine());
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 78 
 79     /*
 80      * Message posted
 81      */
 82     private static final String postMsg = &quot;HTTP post on a https server&quot;;
 83 
 84     /*
 85      * the fully qualified domain name of localhost
 86      */
 87     private static String hostname = null;
 88 
 89     /*
 90      * If the client or server is doing some kind of object creation
 91      * that the other side depends on, and that thread prematurely
 92      * exits, you may experience a hang.  The test harness will
 93      * terminate all hung threads after its timeout has expired,
 94      * currently 3 minutes by default, but you might try to be
 95      * smart about it....
 96      */
 97 
<span class="line-added"> 98     private SSLServerSocket createServerSocket(SSLServerSocketFactory sslssf)</span>
<span class="line-added"> 99         throws Exception {</span>
<span class="line-added">100         SSLServerSocket sslServerSocket =</span>
<span class="line-added">101             (SSLServerSocket)sslssf.createServerSocket();</span>
<span class="line-added">102         InetAddress localHost = InetAddress.getLocalHost();</span>
<span class="line-added">103         InetSocketAddress address = new InetSocketAddress(localHost, serverPort);</span>
<span class="line-added">104         sslServerSocket.bind(address);</span>
<span class="line-added">105         return sslServerSocket;</span>
<span class="line-added">106     }</span>
<span class="line-added">107 </span>
108     /*
109      * Define the server side of the test.
110      *
111      * If the server prematurely exits, serverReady will be set to true
112      * to avoid infinite hangs.
113      */
114     private void doServerSide() throws Exception {
115         SSLServerSocketFactory sslssf =
116             (SSLServerSocketFactory)SSLServerSocketFactory.getDefault();
<span class="line-modified">117         try (SSLServerSocket sslServerSocket = createServerSocket(sslssf)) {</span>

118 
119             serverPort = sslServerSocket.getLocalPort();
120 
121             /*
122              * Signal Client, we&#39;re ready for his connect.
123              */
124             serverReady = true;
125 
126             /*
127              * Accept connections
128              */
129             try (SSLSocket sslSocket = (SSLSocket)sslServerSocket.accept()) {
130                 InputStream sslIS = sslSocket.getInputStream();
131                 OutputStream sslOS = sslSocket.getOutputStream();
132                 BufferedReader br =
133                         new BufferedReader(new InputStreamReader(sslIS));
134                 PrintStream ps = new PrintStream(sslOS);
135 
136                 // process HTTP POST request from client
137                 System.out.println(&quot;status line: &quot; + br.readLine());
</pre>
</td>
</tr>
</table>
<center><a href="Identities.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PostThruProxy.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>