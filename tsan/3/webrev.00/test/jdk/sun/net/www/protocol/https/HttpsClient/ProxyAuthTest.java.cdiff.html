<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/sun/net/www/protocol/https/HttpsClient/ProxyAuthTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../HttpCallback.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ProxyTunnelServer.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/net/www/protocol/https/HttpsClient/ProxyAuthTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2001, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2001, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 57,10 ***</span>
<span class="line-new-header">--- 57,11 ---</span>
  import java.io.BufferedReader;
  import java.io.DataOutputStream;
  import java.io.IOException;
  import java.io.InputStreamReader;
  import java.net.Authenticator;
<span class="line-added">+ import java.net.InetAddress;</span>
  import java.net.InetSocketAddress;
  import java.net.PasswordAuthentication;
  import java.net.Proxy;
  import java.net.URL;
  import javax.net.ssl.HostnameVerifier;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 78,10 ***</span>
<span class="line-new-header">--- 79,14 ---</span>
   */
  
  public class ProxyAuthTest extends SSLSocketTemplate {
      private static boolean expectSuccess;
  
<span class="line-added">+     ProxyAuthTest() {</span>
<span class="line-added">+         serverAddress = InetAddress.getLoopbackAddress();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      /*
       * Run the test case.
       */
      public static void main(String[] args) throws Exception {
          // Get the customized arguments.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 141,22 ***</span>
           * we want to avoid URLspoofCheck failures in cases where the cert
           * DN name does not match the hostname in the URL.
           */
          HttpsURLConnection.setDefaultHostnameVerifier(new NameVerifier());
  
<span class="line-modified">!         InetSocketAddress paddr =</span>
<span class="line-modified">!                 new InetSocketAddress(&quot;localhost&quot;, ps.getPort());</span>
          Proxy proxy = new Proxy(Proxy.Type.HTTP, paddr);
  
          URL url = new URL(
<span class="line-modified">!                 &quot;https://&quot; + &quot;localhost:&quot; + serverPort + &quot;/index.html&quot;);</span>
          BufferedReader in = null;
          HttpsURLConnection uc = (HttpsURLConnection) url.openConnection(proxy);
          try {
              in = new BufferedReader(new InputStreamReader(uc.getInputStream()));
              String inputLine;
<span class="line-modified">!             System.out.print(&quot;Client recieved from the server: &quot;);</span>
              while ((inputLine = in.readLine()) != null) {
                  System.out.println(inputLine);
              }
              if (!expectSuccess) {
                  throw new RuntimeException(
<span class="line-new-header">--- 146,29 ---</span>
           * we want to avoid URLspoofCheck failures in cases where the cert
           * DN name does not match the hostname in the URL.
           */
          HttpsURLConnection.setDefaultHostnameVerifier(new NameVerifier());
  
<span class="line-modified">!         InetSocketAddress paddr = InetSocketAddress</span>
<span class="line-modified">!             .createUnresolved(ps.getInetAddress().getHostAddress(),</span>
<span class="line-added">+                               ps.getPort());</span>
          Proxy proxy = new Proxy(Proxy.Type.HTTP, paddr);
  
<span class="line-added">+         InetAddress serverAddress = this.serverAddress;</span>
<span class="line-added">+         String host = serverAddress == null</span>
<span class="line-added">+                 ? &quot;localhost&quot;</span>
<span class="line-added">+                 : serverAddress.getHostAddress();</span>
<span class="line-added">+         if (host.indexOf(&#39;:&#39;) &gt; -1) host = &quot;[&quot; + host + &quot;]&quot;;</span>
          URL url = new URL(
<span class="line-modified">!                 &quot;https://&quot; + host + &quot;:&quot; + serverPort + &quot;/index.html&quot;);</span>
<span class="line-added">+         System.out.println(&quot;URL: &quot; + url);</span>
          BufferedReader in = null;
          HttpsURLConnection uc = (HttpsURLConnection) url.openConnection(proxy);
          try {
              in = new BufferedReader(new InputStreamReader(uc.getInputStream()));
              String inputLine;
<span class="line-modified">!             System.out.print(&quot;Client received from the server: &quot;);</span>
              while ((inputLine = in.readLine()) != null) {
                  System.out.println(inputLine);
              }
              if (!expectSuccess) {
                  throw new RuntimeException(
</pre>
<hr />
<pre>
<span class="line-old-header">*** 224,11 ***</span>
              return true;
          }
      }
  
      private static ProxyTunnelServer setupProxy() throws IOException {
<span class="line-modified">!         ProxyTunnelServer pserver = new ProxyTunnelServer();</span>
  
          /*
           * register a system wide authenticator and setup the proxy for
           * authentication
           */
<span class="line-new-header">--- 236,12 ---</span>
              return true;
          }
      }
  
      private static ProxyTunnelServer setupProxy() throws IOException {
<span class="line-modified">!         InetAddress loopback = InetAddress.getLoopbackAddress();</span>
<span class="line-added">+         ProxyTunnelServer pserver = new ProxyTunnelServer(loopback);</span>
  
          /*
           * register a system wide authenticator and setup the proxy for
           * authentication
           */
</pre>
<center><a href="../HttpCallback.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ProxyTunnelServer.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>