<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/sun/net/idn/PunycodeTest.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
    <script type="text/javascript" src="../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2005, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
<a name="2" id="anc2"></a><span class="line-modified"> 26  * @summary Unit test for jdk.internal.icu.impl.Punycode</span>
<span class="line-modified"> 27  * @bug 4737170 8174270</span>
<span class="line-modified"> 28  * @modules java.base/jdk.internal.icu.impl</span>
 29  * @compile -XDignore.symbol.file PunycodeTest.java
 30  * @run main/othervm -ea PunycodeTest
 31  * @author Edward Wang
 32  */
 33 
 34 import java.util.Scanner;
<a name="3" id="anc3"></a><span class="line-modified"> 35 import jdk.internal.icu.impl.Punycode;</span>

 36 
 37 /**
 38  * unit test for Punycode that is also originated from the sample code
 39  * provided in rfc3492.txt
 40  */
 41 public class PunycodeTest {
 42 
 43     /* For testing, we&#39;ll just set some compile-time limits rather than */
 44     /* use malloc(), and set a compile-time option rather than using a  */
 45     /* command-line option.                                             */
 46 
 47     static final int  unicode_max_length = 256;
 48     static final int  ace_max_length = 256;
 49 
 50     static final String too_big =
 51             &quot;input or output is too large, recompile with larger limits\n&quot;;
 52     static final String invalid_input = &quot;invalid input\n&quot;;
 53     static final String overflow = &quot;arithmetic overflow\n&quot;;
 54     static final String io_error = &quot;I/O error\n&quot;;
 55 
 56     /* The following string is used to convert printable */
 57     /* characters between ASCII and the native charset:  */
 58 
 59     static void fail(String msg, String input) {
 60         System.out.println(msg+&quot; input: &quot;+input);
 61         throw new RuntimeException(msg+&quot; input: &quot;+input);
 62     }
 63 
 64 
 65     public int testCount = 0;
 66 
 67     private int input_length, j;
 68     private int output_length[] = new int[1];
 69     private boolean case_flags[] = new boolean[unicode_max_length];
 70 
 71     public String testEncoding(String inputS) {
 72         char input[] = new char[unicode_max_length];
 73         int codept = 0;
 74         char uplus[] = new char[2];
 75         StringBuffer output;
 76         int c;
 77 
 78         /* Read the input code points: */
 79 
 80         input_length = 0;
 81 
 82         Scanner sc = new Scanner(inputS);
 83 
 84         while (sc.hasNext()) {  // need to stop at end of line
 85             try {
 86                 String next = sc.next();
 87                 uplus[0] = next.charAt(0);
 88                 uplus[1] = next.charAt(1);
 89                 codept = Integer.parseInt(next.substring(2), 16);
 90             } catch (Exception ex) {
 91                 fail(invalid_input, inputS);
 92             }
 93 
 94             if (uplus[1] != &#39;+&#39; || codept &gt; Integer.MAX_VALUE) {
 95                 fail(invalid_input, inputS);
 96             }
 97 
 98             if (input_length == unicode_max_length) fail(too_big, inputS);
 99 
100             if (uplus[0] == &#39;u&#39;) case_flags[input_length] = false;
101             else if (uplus[0] == &#39;U&#39;) case_flags[input_length] = true;
102             else fail(invalid_input, inputS);
103 
104             input[input_length++] = (char)codept;
105         }
106 
107         /* Encode: */
108 
109         output_length[0] = ace_max_length;
110         try {
111             output = Punycode.encode((new StringBuffer()).append(input, 0, input_length), case_flags);
112         } catch (Exception e) {
113             fail(invalid_input, inputS);
114             // never reach here, just to make compiler happy
115             return null;
116         }
117 
118         testCount++;
119         return output.toString();
120     }
121 
122     public String testDecoding(String inputS) {
123         char input[] = new char[0];
124         int pp;
125         StringBuffer output;
126 
127         /* Read the Punycode input string and convert to ASCII: */
128 
129         if (inputS.length() &lt;= ace_max_length+2) {
130             input = inputS.toCharArray();
131         } else {
132             fail(invalid_input, inputS);
133         }
134         input_length = input.length;
135 
136         /* Decode: */
137 
138         output_length[0] = unicode_max_length;
139         try {
140             output = Punycode.decode((new StringBuffer()).append(input, 0, input_length), case_flags);
141         } catch (Exception e) {
142             fail(invalid_input, inputS);
143             // never reach here, just to make compiler happy
144             return null;
145         }
146 
147         /* Output the result: */
148         StringBuffer result = new StringBuffer();
149         for (j = 0;  j &lt; output.length();  ++j) {
150             result.append(String.format(&quot;%s+%04X &quot;,
151                     case_flags[j] ? &quot;U&quot; : &quot;u&quot;,
152                     (int)output.charAt(j) ));
153         }
154 
155         testCount++;
156         return result.substring(0, result.length() - 1);
157     }
158 
159   // test data from rfc3492
160   static String[][] testdata = {
161     {&quot;(A) Arabic (Egyptian):&quot;,
162      &quot;u+0644 u+064A u+0647 u+0645 u+0627 u+0628 u+062A u+0643 u+0644 &quot;+
163      &quot;u+0645 u+0648 u+0634 u+0639 u+0631 u+0628 u+064A u+061F&quot;,
164      &quot;egbpdaj6bu4bxfgehfvwxn&quot;},
165     {&quot;(B) Chinese (simplified):&quot;,
166      &quot;u+4ED6 u+4EEC u+4E3A u+4EC0 u+4E48 u+4E0D u+8BF4 u+4E2D u+6587&quot;,
167      &quot;ihqwcrb4cv8a8dqg056pqjye&quot;},
168     {&quot;(C) Chinese (traditional):&quot;,
169     &quot;u+4ED6 u+5011 u+7232 u+4EC0 u+9EBD u+4E0D u+8AAA u+4E2D u+6587&quot;,
170     &quot;ihqwctvzc91f659drss3x8bo0yb&quot;},
171     {&quot;(D) Czech: Pro&lt;ccaron&gt;prost&lt;ecaron&gt;nemluv&lt;iacute&gt;&lt;ccaron&gt;esky&quot;,
172     &quot;U+0050 u+0072 u+006F u+010D u+0070 u+0072 u+006F u+0073 u+0074 &quot;+
173      &quot;u+011B u+006E u+0065 u+006D u+006C u+0075 u+0076 u+00ED u+010D &quot;+
174      &quot;u+0065 u+0073 u+006B u+0079&quot;,
175     &quot;Proprostnemluvesky-uyb24dma41a&quot;},
176     {&quot;(E) Hebrew:&quot;,
177     &quot;u+05DC u+05DE u+05D4 u+05D4 u+05DD u+05E4 u+05E9 u+05D5 u+05D8 &quot;+
178      &quot;u+05DC u+05D0 u+05DE u+05D3 u+05D1 u+05E8 u+05D9 u+05DD u+05E2 &quot;+
179      &quot;u+05D1 u+05E8 u+05D9 u+05EA&quot;,
180     &quot;4dbcagdahymbxekheh6e0a7fei0b&quot;},
181     {&quot;(F) Hindi (Devanagari):&quot;,
182     &quot;u+092F u+0939 u+0932 u+094B u+0917 u+0939 u+093F u+0928 u+094D &quot;+
183      &quot;u+0926 u+0940 u+0915 u+094D u+092F u+094B u+0902 u+0928 u+0939 &quot;+
184      &quot;u+0940 u+0902 u+092C u+094B u+0932 u+0938 u+0915 u+0924 u+0947 &quot;+
185      &quot;u+0939 u+0948 u+0902&quot;,
186     &quot;i1baa7eci9glrd9b2ae1bj0hfcgg6iyaf8o0a1dig0cd&quot;},
187     {&quot;(G) Japanese (kanji and hiragana):&quot;,
188     &quot;u+306A u+305C u+307F u+3093 u+306A u+65E5 u+672C u+8A9E u+3092 &quot;+
189      &quot;u+8A71 u+3057 u+3066 u+304F u+308C u+306A u+3044 u+306E u+304B&quot;,
190     &quot;n8jok5ay5dzabd5bym9f0cm5685rrjetr6pdxa&quot;},
191     {&quot;(H) Korean (Hangul syllables):&quot;,
192     &quot;u+C138 u+ACC4 u+C758 u+BAA8 u+B4E0 u+C0AC u+B78C u+B4E4 u+C774 &quot;+
193      &quot;u+D55C u+AD6D u+C5B4 u+B97C u+C774 u+D574 u+D55C u+B2E4 u+BA74 &quot;+
194      &quot;u+C5BC u+B9C8 u+B098 u+C88B u+C744 u+AE4C&quot;,
195     &quot;989aomsvi5e83db1d2a355cv1e0vak1dwrv93d5xbh15a0dt30a5j&quot;+
196     &quot;psd879ccm6fea98c&quot;},
197     {&quot;(I) Russian (Cyrillic):&quot;,
198     &quot;U+043F u+043E u+0447 u+0435 u+043C u+0443 u+0436 u+0435 u+043E &quot;+
199      &quot;u+043D u+0438 u+043D u+0435 u+0433 u+043E u+0432 u+043E u+0440 &quot;+
200      &quot;u+044F u+0442 u+043F u+043E u+0440 u+0443 u+0441 u+0441 u+043A &quot;+
201      &quot;u+0438&quot;,
202     &quot;b1abfaaepdrnnbgefbaDotcwatmq2g4l&quot;},
203     {&quot;(J) Spanish: Porqu&lt;eacute&gt;nopuedensimplementehablarenEspa&lt;ntilde&gt;ol&quot;,
204     &quot;U+0050 u+006F u+0072 u+0071 u+0075 u+00E9 u+006E u+006F u+0070 &quot;+
205      &quot;u+0075 u+0065 u+0064 u+0065 u+006E u+0073 u+0069 u+006D u+0070 &quot;+
206      &quot;u+006C u+0065 u+006D u+0065 u+006E u+0074 u+0065 u+0068 u+0061 &quot;+
207      &quot;u+0062 u+006C u+0061 u+0072 u+0065 u+006E U+0045 u+0073 u+0070 &quot;+
208      &quot;u+0061 u+00F1 u+006F u+006C&quot;,
209     &quot;PorqunopuedensimplementehablarenEspaol-fmd56a&quot;},
210     {&quot;(K) Vietnamese:&quot;+
211      &quot;T&lt;adotbelow&gt;isaoh&lt;odotbelow&gt;kh&lt;ocirc&gt;ngth&lt;ecirchookabove&gt;ch&quot;+
212      &quot;&lt;ihookabove&gt;n&lt;oacute&gt;iti&lt;ecircacute&gt;ngVi&lt;ecircdotbelow&gt;t&quot;,
213     &quot;U+0054 u+1EA1 u+0069 u+0073 u+0061 u+006F u+0068 u+1ECD u+006B &quot;+
214      &quot;u+0068 u+00F4 u+006E u+0067 u+0074 u+0068 u+1EC3 u+0063 u+0068 &quot;+
215      &quot;u+1EC9 u+006E u+00F3 u+0069 u+0074 u+0069 u+1EBF u+006E u+0067 &quot;+
216      &quot;U+0056 u+0069 u+1EC7 u+0074&quot;,
217     &quot;TisaohkhngthchnitingVit-kjcr8268qyxafd2f1b9g&quot;},
218     {&quot;(L) 3&lt;nen&gt;B&lt;gumi&gt;&lt;kinpachi&gt;&lt;sensei&gt;&quot;,
219      &quot;u+0033 u+5E74 U+0042 u+7D44 u+91D1 u+516B u+5148 u+751F&quot;,
220     &quot;3B-ww4c5e180e575a65lsy2b&quot;},
221     {&quot;(M) &lt;amuro&gt;&lt;namie&gt;-with-SUPER-MONKEYS&quot;,
222      &quot;u+5B89 u+5BA4 u+5948 u+7F8E u+6075 u+002D u+0077 u+0069 u+0074 &quot;+
223      &quot;u+0068 u+002D U+0053 U+0055 U+0050 U+0045 U+0052 u+002D U+004D &quot;+
224      &quot;U+004F U+004E U+004B U+0045 U+0059 U+0053&quot;,
225     &quot;-with-SUPER-MONKEYS-pc58ag80a8qai00g7n9n&quot;},
226     {&quot;(N) Hello-Another-Way-&lt;sorezore&gt;&lt;no&gt;&lt;basho&gt;&quot;,
227     &quot;U+0048 u+0065 u+006C u+006C u+006F u+002D U+0041 u+006E u+006F &quot;+
228      &quot;u+0074 u+0068 u+0065 u+0072 u+002D U+0057 u+0061 u+0079 u+002D &quot;+
229      &quot;u+305D u+308C u+305E u+308C u+306E u+5834 u+6240&quot;,
230     &quot;Hello-Another-Way--fc4qua05auwb3674vfr0b&quot;},
231     {&quot;(O) &lt;hitotsu&gt;&lt;yane&gt;&lt;no&gt;&lt;shita&gt;2&quot;,
232      &quot;u+3072 u+3068 u+3064 u+5C4B u+6839 u+306E u+4E0B u+0032&quot;,
233     &quot;2-u9tlzr9756bt3uc0v&quot;},
234     {&quot;(P) Maji&lt;de&gt;Koi&lt;suru&gt;5&lt;byou&gt;&lt;mae&gt;&quot;,
235      &quot;U+004D u+0061 u+006A u+0069 u+3067 U+004B u+006F u+0069 u+3059 &quot;+
236      &quot;u+308B u+0035 u+79D2 u+524D&quot;,
237     &quot;MajiKoi5-783gue6qz075azm5e&quot;},
238     {&quot;(Q) &lt;pafii&gt;de&lt;runba&gt;&quot;,
239      &quot;u+30D1 u+30D5 u+30A3 u+30FC u+0064 u+0065 u+30EB u+30F3 u+30D0&quot;,
240     &quot;de-jg4avhby1noc0d&quot;},
241     {&quot;(R) &lt;sono&gt;&lt;supiido&gt;&lt;de&gt;&quot;,
242      &quot;u+305D u+306E u+30B9 u+30D4 u+30FC u+30C9 u+3067&quot;,
243     &quot;d9juau41awczczp&quot;},
244     {&quot;(S) -&gt; $1.00 &lt;-&quot;,
245      &quot;u+002D u+003E u+0020 u+0024 u+0031 u+002E u+0030 u+0030 u+0020 &quot;+
246      &quot;u+003C u+002D&quot;,
247     &quot;-&gt; $1.00 &lt;--&quot;},
248   };
249 
250   public static void main(String[] argv) throws Exception {
251       PunycodeTest mytest = new PunycodeTest();
252       for (int i = 0; i &lt; testdata.length; i++) {
253           String encodeResult = mytest.testEncoding(testdata[i][1]);
254           String decodeResult = mytest.testDecoding(testdata[i][2]);
255 
256           checkResult(encodeResult, testdata[i][2]);
257           checkResult(decodeResult, testdata[i][1]);
258       }
259 
260       System.out.println(&quot;Test cases: &quot; + mytest.testCount);
261   }
262 
263   public static void checkResult(String actual, String expected) {
264       if (!actual.equals(expected)) {
265           System.out.printf(&quot;\n%15s: %s\n&quot;, &quot;FAILED&quot;, actual);
266           System.out.printf(&quot;%15s: %s\n\n&quot;, &quot;should be&quot;, expected);
267           throw new RuntimeException(&quot;Punycode test failed.&quot;);
268       } else {
269           System.out.printf(&quot;%15s: %s\n&quot;, &quot;SUCCEEDED&quot;, actual);
270       }
271   }
272 
273 }
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>