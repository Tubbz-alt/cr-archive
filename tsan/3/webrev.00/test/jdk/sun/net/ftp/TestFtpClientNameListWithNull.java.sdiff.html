<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/net/ftp/TestFtpClientNameListWithNull.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="MarkResetTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../idn/NFS4StringPrep.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/net/ftp/TestFtpClientNameListWithNull.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8022580
 27  * @summary &quot;null&quot; should be treated as &quot;current directory&quot; in nameList()
 28  * method of FtpClient
 29  * @modules java.base/sun.net.ftp
 30  * @run main TestFtpClientNameListWithNull
 31 */
 32 
 33 
 34 import sun.net.ftp.FtpClient;
 35 
 36 import java.io.BufferedReader;
 37 import java.io.IOException;
 38 import java.io.InputStreamReader;
 39 import java.io.PrintWriter;

 40 import java.net.InetSocketAddress;
 41 import java.net.ServerSocket;
 42 import java.net.Socket;
 43 import java.net.SocketException;
 44 
 45 
 46 public class TestFtpClientNameListWithNull {
 47 
 48     private static volatile boolean commandHasArgs;
 49 
 50     public static void main(String[] args) throws Exception {
 51         try (FtpServer server = new FtpServer();
 52              FtpClient client = FtpClient.create()) {
 53             (new Thread(server)).start();
 54             int port = server.getPort();
<span class="line-modified"> 55             client.connect(new InetSocketAddress(&quot;localhost&quot;, port));</span>

 56             client.nameList(null);
 57         } finally {
 58             if (commandHasArgs) {
 59                 throw new RuntimeException(&quot;Test failed. NLST shouldn&#39;t have &quot; +
 60                         &quot;args if nameList parameter is null&quot;);
 61             }
 62         }
 63     }
 64 
 65     private static class FtpServer implements AutoCloseable, Runnable {
 66         private final ServerSocket serverSocket;
 67 
 68         FtpServer() throws IOException {
<span class="line-modified"> 69             serverSocket = new ServerSocket(0);</span>


 70         }
 71 
 72         public void handleClient(Socket client) throws IOException {
 73             boolean done = false;
 74             String str;
 75 
 76             client.setSoTimeout(2000);
 77             BufferedReader in = new BufferedReader(new InputStreamReader(client.
 78                     getInputStream()));
 79             PrintWriter out = new PrintWriter(client.getOutputStream(), true);
 80             out.println(&quot;220 FTP serverSocket is ready.&quot;);
 81             while (!done) {
 82                 try {
 83                     str = in.readLine();
 84                 } catch (SocketException e) {
 85                     done = true;
 86                     continue;
 87                 }
 88                 String cmd = str.substring(0, str.indexOf(&quot; &quot;) &gt; 0 ?
 89                         str.indexOf(&quot; &quot;) : str.length());
</pre>
</td>
<td>
<hr />
<pre>
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8022580
 27  * @summary &quot;null&quot; should be treated as &quot;current directory&quot; in nameList()
 28  * method of FtpClient
 29  * @modules java.base/sun.net.ftp
 30  * @run main TestFtpClientNameListWithNull
 31 */
 32 
 33 
 34 import sun.net.ftp.FtpClient;
 35 
 36 import java.io.BufferedReader;
 37 import java.io.IOException;
 38 import java.io.InputStreamReader;
 39 import java.io.PrintWriter;
<span class="line-added"> 40 import java.net.InetAddress;</span>
 41 import java.net.InetSocketAddress;
 42 import java.net.ServerSocket;
 43 import java.net.Socket;
 44 import java.net.SocketException;
 45 
 46 
 47 public class TestFtpClientNameListWithNull {
 48 
 49     private static volatile boolean commandHasArgs;
 50 
 51     public static void main(String[] args) throws Exception {
 52         try (FtpServer server = new FtpServer();
 53              FtpClient client = FtpClient.create()) {
 54             (new Thread(server)).start();
 55             int port = server.getPort();
<span class="line-modified"> 56             InetAddress loopback = InetAddress.getLoopbackAddress();</span>
<span class="line-added"> 57             client.connect(new InetSocketAddress(loopback, port));</span>
 58             client.nameList(null);
 59         } finally {
 60             if (commandHasArgs) {
 61                 throw new RuntimeException(&quot;Test failed. NLST shouldn&#39;t have &quot; +
 62                         &quot;args if nameList parameter is null&quot;);
 63             }
 64         }
 65     }
 66 
 67     private static class FtpServer implements AutoCloseable, Runnable {
 68         private final ServerSocket serverSocket;
 69 
 70         FtpServer() throws IOException {
<span class="line-modified"> 71             InetAddress loopback = InetAddress.getLoopbackAddress();</span>
<span class="line-added"> 72             serverSocket = new ServerSocket();</span>
<span class="line-added"> 73             serverSocket.bind(new InetSocketAddress(loopback, 0));</span>
 74         }
 75 
 76         public void handleClient(Socket client) throws IOException {
 77             boolean done = false;
 78             String str;
 79 
 80             client.setSoTimeout(2000);
 81             BufferedReader in = new BufferedReader(new InputStreamReader(client.
 82                     getInputStream()));
 83             PrintWriter out = new PrintWriter(client.getOutputStream(), true);
 84             out.println(&quot;220 FTP serverSocket is ready.&quot;);
 85             while (!done) {
 86                 try {
 87                     str = in.readLine();
 88                 } catch (SocketException e) {
 89                     done = true;
 90                     continue;
 91                 }
 92                 String cmd = str.substring(0, str.indexOf(&quot; &quot;) &gt; 0 ?
 93                         str.indexOf(&quot; &quot;) : str.length());
</pre>
</td>
</tr>
</table>
<center><a href="MarkResetTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../idn/NFS4StringPrep.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>