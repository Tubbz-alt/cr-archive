<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/sun/tools/jps/LingeredApp.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="JpsHelper.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="LingeredAppForJps.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/tools/jps/LingeredApp.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -30,14 +30,16 @@</span>
  import java.nio.file.Path;
  import java.nio.file.Paths;
  import java.nio.file.attribute.BasicFileAttributes;
  import java.nio.file.attribute.FileTime;
  import java.util.ArrayList;
<span class="udiff-line-added">+ import java.util.Collections;</span>
  import java.util.Date;
  import java.util.List;
  import java.util.Map;
  import java.util.UUID;
<span class="udiff-line-added">+ import jdk.test.lib.Utils;</span>
  
  /**
   * This is a framework to launch an app that could be synchronized with caller
   * to make further attach actions reliable across supported platforms
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -255,11 +257,11 @@</span>
  
      /**
       * Analyze an environment and prepare a command line to
       * run the app, app name should be added explicitly
       */
<span class="udiff-line-modified-removed">-     public List&lt;String&gt; runAppPrepare(List&lt;String&gt; vmArguments) {</span>
<span class="udiff-line-modified-added">+     public List&lt;String&gt; runAppPrepare(String[] vmArguments) {</span>
          // We should always use testjava or throw an exception,
          // so we can&#39;t use JDKToolFinder.getJDKTool(&quot;java&quot;);
          // that falls back to compile java on error
          String jdkPath = System.getProperty(&quot;test.jdk&quot;);
          if (jdkPath == null) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -276,24 +278,17 @@</span>
          String javapath = jdkPath + ((osname.startsWith(&quot;window&quot;)) ? &quot;/bin/java.exe&quot; : &quot;/bin/java&quot;);
  
          List&lt;String&gt; cmd = new ArrayList&lt;String&gt;();
          cmd.add(javapath);
  
<span class="udiff-line-removed">- </span>
          if (vmArguments == null) {
<span class="udiff-line-modified-removed">-             // Propagate test.vm.options to LingeredApp, filter out possible empty options</span>
<span class="udiff-line-modified-removed">-             String testVmOpts[] = System.getProperty(&quot;test.vm.opts&quot;,&quot;&quot;).split(&quot;\\s+&quot;);</span>
<span class="udiff-line-modified-removed">-             for (String s : testVmOpts) {</span>
<span class="udiff-line-removed">-                 if (!s.equals(&quot;&quot;)) {</span>
<span class="udiff-line-removed">-                     cmd.add(s);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         else{</span>
<span class="udiff-line-modified-added">+             // Propagate getTestJavaOpts() to LingeredApp</span>
<span class="udiff-line-modified-added">+             vmArguments = Utils.getTestJavaOpts();</span>
<span class="udiff-line-modified-added">+         } else {</span>
              // Lets user manage LingeredApp options
<span class="udiff-line-removed">-             cmd.addAll(vmArguments);</span>
          }
<span class="udiff-line-added">+         Collections.addAll(cmd, vmArguments);</span>
  
          // Make sure we set correct classpath to run the app
          cmd.add(&quot;-cp&quot;);
          String classpath = System.getProperty(&quot;test.class.path&quot;);
          cmd.add((classpath == null) ? &quot;.&quot; : classpath);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -324,11 +319,11 @@</span>
       * Run the app.
       *
       * @param vmArguments
       * @throws IOException
       */
<span class="udiff-line-modified-removed">-     public void runApp(List&lt;String&gt; vmArguments)</span>
<span class="udiff-line-modified-added">+     public void runApp(String[] vmArguments)</span>
              throws IOException {
  
          List&lt;String&gt; cmd = runAppPrepare(vmArguments);
  
          cmd.add(this.getAppName());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -365,53 +360,39 @@</span>
      }
  
      /**
       *  High level interface for test writers
       */
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Factory method that creates LingeredApp object with ready to use application</span>
<span class="udiff-line-removed">-      * lock name is autogenerated</span>
<span class="udiff-line-removed">-      * @param cmd - vm options, could be null to auto add testvm.options</span>
<span class="udiff-line-removed">-      * @return LingeredApp object</span>
<span class="udiff-line-removed">-      * @throws IOException</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public static LingeredApp startApp(List&lt;String&gt; cmd) throws IOException {</span>
<span class="udiff-line-removed">-         LingeredApp a = new LingeredApp();</span>
<span class="udiff-line-removed">-         a.createLock();</span>
<span class="udiff-line-removed">-         try {</span>
<span class="udiff-line-removed">-             a.runApp(cmd);</span>
<span class="udiff-line-removed">-             a.waitAppReady(appWaitTime);</span>
<span class="udiff-line-removed">-         } catch (Exception ex) {</span>
<span class="udiff-line-removed">-             a.deleteLock();</span>
<span class="udiff-line-removed">-             throw ex;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         return a;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      /**
       * Factory method that starts pre-created LingeredApp
       * lock name is autogenerated
<span class="udiff-line-modified-removed">-      * @param cmd - vm options, could be null to auto add testvm.options</span>
<span class="udiff-line-modified-added">+      * @param cmd - vm options, could be null to auto add Utils.getTestJavaOpts()</span>
       * @param theApp - app to start
<span class="udiff-line-removed">-      * @return LingeredApp object</span>
       * @throws IOException
       */
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-     public static void startApp(List&lt;String&gt; cmd, LingeredApp theApp) throws IOException {</span>
<span class="udiff-line-modified-added">+     public static void startApp(LingeredApp theApp, String... cmd) throws IOException {</span>
          theApp.createLock();
          try {
              theApp.runApp(cmd);
              theApp.waitAppReady(appWaitTime);
          } catch (Exception ex) {
              theApp.deleteLock();
              throw ex;
          }
      }
  
<span class="udiff-line-modified-removed">-     public static LingeredApp startApp() throws IOException {</span>
<span class="udiff-line-modified-removed">-         return startApp(null);</span>
<span class="udiff-line-modified-added">+     /**</span>
<span class="udiff-line-modified-added">+      * Factory method that creates LingeredApp object with ready to use application</span>
<span class="udiff-line-added">+      * lock name is autogenerated</span>
<span class="udiff-line-added">+      * @param cmd - vm options, could be null to auto add Utils.getTestJavaOpts()</span>
<span class="udiff-line-added">+      * @return LingeredApp object</span>
<span class="udiff-line-added">+      * @throws IOException</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     public static LingeredApp startApp(String... cmd) throws IOException {</span>
<span class="udiff-line-added">+         LingeredApp a = new LingeredApp();</span>
<span class="udiff-line-added">+         startApp(a, cmd);</span>
<span class="udiff-line-added">+         return a;</span>
      }
  
      public static void stopApp(LingeredApp app) throws IOException {
          if (app != null) {
              // LingeredApp can throw an exception during the intialization,
</pre>
<center><a href="JpsHelper.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="LingeredAppForJps.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>