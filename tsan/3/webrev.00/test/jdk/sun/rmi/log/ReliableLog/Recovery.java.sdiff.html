<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/rmi/log/ReliableLog/Recovery.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../nio/cs/TestMS5022X.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../security/krb5/auto/KDC.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/rmi/log/ReliableLog/Recovery.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2002, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 71             int size;
 72             int deathpoint;
 73             for (size = 1; size &lt; 256; size *= 2) {
 74                 for (deathpoint = 0; deathpoint &lt;= 8; deathpoint++) {
 75                     // Trash the log directory
 76                     try {
 77                         (new File(dir,&quot;Version_Number&quot;)).delete();
 78                     } catch (Exception e) {
 79                     }
 80                     try {
 81                         (new File(dir,&quot;New_Version_Number&quot;)).delete();
 82                     } catch (Exception e) {
 83                     }
 84                     try {
 85                         (new File(dir,&quot;Old_Version_Number&quot;)).delete();
 86                     } catch (Exception e) {
 87                     }
 88 
 89                     Recovery handler = new Recovery();
 90                     ReliableLog log;
<span class="line-removed"> 91                     if (size == 4 &amp;&amp; deathpoint == 6) {</span>
<span class="line-removed"> 92                         Runtime.getRuntime().traceMethodCalls(true);</span>
<span class="line-removed"> 93                     }</span>
 94                     log = new ReliableLog(dir, handler);
<span class="line-removed"> 95                     if (size == 4 &amp;&amp; deathpoint == 6) {</span>
<span class="line-removed"> 96                         Runtime.getRuntime().traceMethodCalls(false);</span>
<span class="line-removed"> 97                     }</span>
 98 
 99                     // Generate a number of updates (size - 1) until failing
100                     int i;
101                     StringBuffer writ = new StringBuffer();
102                     char[] u = new char[1];
103                     for (i = 1; i &lt; size; i++) {
104                         u[0] = (char)(64 + (i % 26));
105                         String update = new String(u);
106                         handler.basicUpdate(update);
107                         log.update(update, true);
108                         writ.append(update);
109                     }
110 
111                     // Fail
112                     String f = (&quot;FALL&quot; + deathpoint);
113                     boolean failed_as_desired = false;
114                     try {
115                         ReliableLog.fallOverPoint = deathpoint;
116                         handler.basicUpdate(f);
117                         log.update(f, true);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 71             int size;
 72             int deathpoint;
 73             for (size = 1; size &lt; 256; size *= 2) {
 74                 for (deathpoint = 0; deathpoint &lt;= 8; deathpoint++) {
 75                     // Trash the log directory
 76                     try {
 77                         (new File(dir,&quot;Version_Number&quot;)).delete();
 78                     } catch (Exception e) {
 79                     }
 80                     try {
 81                         (new File(dir,&quot;New_Version_Number&quot;)).delete();
 82                     } catch (Exception e) {
 83                     }
 84                     try {
 85                         (new File(dir,&quot;Old_Version_Number&quot;)).delete();
 86                     } catch (Exception e) {
 87                     }
 88 
 89                     Recovery handler = new Recovery();
 90                     ReliableLog log;



 91                     log = new ReliableLog(dir, handler);



 92 
 93                     // Generate a number of updates (size - 1) until failing
 94                     int i;
 95                     StringBuffer writ = new StringBuffer();
 96                     char[] u = new char[1];
 97                     for (i = 1; i &lt; size; i++) {
 98                         u[0] = (char)(64 + (i % 26));
 99                         String update = new String(u);
100                         handler.basicUpdate(update);
101                         log.update(update, true);
102                         writ.append(update);
103                     }
104 
105                     // Fail
106                     String f = (&quot;FALL&quot; + deathpoint);
107                     boolean failed_as_desired = false;
108                     try {
109                         ReliableLog.fallOverPoint = deathpoint;
110                         handler.basicUpdate(f);
111                         log.update(f, true);
</pre>
</td>
</tr>
</table>
<center><a href="../../../nio/cs/TestMS5022X.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../security/krb5/auto/KDC.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>