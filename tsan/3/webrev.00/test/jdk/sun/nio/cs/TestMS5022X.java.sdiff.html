<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/nio/cs/TestMS5022X.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../net/www/protocol/jar/MultiReleaseJarURLConnection.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../rmi/log/ReliableLog/Recovery.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/nio/cs/TestMS5022X.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2008, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /* @test
<span class="line-modified"> 25  * @bug 6173388 6319716</span>
 26  * @summary Check full coverage encode/decode for Microsoft
 27  *          ISO2022_JP variants MS50220, MS50221 and MSISO2022JP
 28  * @modules jdk.charsets
 29  */
 30 
 31 import java.io.*;
 32 import java.nio.charset.*;
 33 public class TestMS5022X {
 34 
 35     private static String US_ASCII =
 36         &quot;\u0000\u0001\u0002\u0003\u0004\u0005\u0006\u0007&quot; +
 37         &quot;\b\t\n\u000B\f\r&quot; +
 38         &quot;\u0010\u0011\u0012\u0013\u0014\u0015\u0016\u0017&quot; +
 39         &quot;\u0018\u0019\u001A\u001C\u001D\u001E\u001F&quot; +
 40         &quot;\u0020\u0021\&quot;\u0023\u0024\u0025\u0026\&#39;&quot; +
 41         &quot;\u0028\u0029\u002A\u002B\u002C\u002D\u002E\u002F&quot; +
 42         &quot;\u0030\u0031\u0032\u0033\u0034\u0035\u0036\u0037&quot; +
 43         &quot;\u0038\u0039\u003A\u003B\u003C\u003D\u003E\u003F&quot; +
 44         &quot;\u0040\u0041\u0042\u0043\u0044\u0045\u0046\u0047&quot; +
 45         &quot;\u0048\u0049\u004A\u004B\u004C\u004D\u004E\u004F&quot; +
</pre>
<hr />
<pre>
649         for (int i = 0; i &lt; expectBytes.length; i++) {
650 
651             if (encodedBytes[i] != expectBytes[i])  {
652                 //System.out.printf(&quot;---&gt;&quot;);
653                 //throw new Exception(name + &quot; Encoder error&quot;);
654             }
655             //System.out.printf(&quot;%x, %x\n&quot;,
656             //encodedBytes[i],expectBytes[i]);
657         }
658         String decoded = new String(encodedBytes, name);
659         if (!decoded.equals(testStr)) {
660             throw new Exception(name + &quot; Decoder error&quot;);
661         }
662         String decoded2 = new String(repeatingEscapes, name);
663         if (!decoded2.equals(MIXEDCONTENT)) {
664             throw new Exception(name + &quot; Decoder error&quot;);
665         }
666      }
667 
668     public static void main(String[] args) throws Exception {
<span class="line-removed">669         String map = System.getProperty(&quot;sun.nio.cs.map&quot;);</span>
<span class="line-removed">670         if (map != null) {</span>
<span class="line-removed">671             map = map.toLowerCase(java.util.Locale.US);</span>
<span class="line-removed">672             Charset cs = Charset.forName(&quot;ISO-2022-JP&quot;);</span>
<span class="line-removed">673             if (map.indexOf(&quot;x-windows-50221/ISO-2022-jp&quot;) != -1 &amp;&amp;</span>
<span class="line-removed">674                 !&quot;x-windows-50220&quot;.equals(cs.name()) ||</span>
<span class="line-removed">675                 map.indexOf(&quot;x-windows-50220/ISO-2022-jp&quot;) != -1 &amp;&amp;</span>
<span class="line-removed">676                 !&quot;x-windows-50220&quot;.equals(cs.name()) ||</span>
<span class="line-removed">677                 map.indexOf(&quot;x-windows-iso2022jp/ISO-2022-jp&quot;) != -1 &amp;&amp;</span>
<span class="line-removed">678                 !&quot;x-windows-iso2022jp&quot;.equals(cs.name())) {</span>
<span class="line-removed">679                 throw new Exception(&quot;Error: sun.nio.cs.map=&quot; + map +</span>
<span class="line-removed">680                                     &quot;, ISO-2022-JP=&quot; + cs.name());</span>
<span class="line-removed">681             } else {</span>
<span class="line-removed">682                 System.out.printf(&quot;ISO-2022-JP=%s\n&quot;, cs.name());</span>
<span class="line-removed">683             }</span>
<span class="line-removed">684         }</span>
<span class="line-removed">685 </span>
686         String testStr = US_ASCII +
687                          JISX0208SUBSET +
688                          JISX0201KATAKANA +
689                          JISX0208NECROW13;
690 
691         byte[] expectedBytes= (new String(expectedBytes_US_ASCII, &quot;ASCII&quot;) +
692                                new String(expectedBytes_JISX0208SUBSET, &quot;ASCII&quot;) +
693                                new String(expectedBytes_JISX0201KATAKANA1, &quot;ASCII&quot;) +
694                                new String(expectedBytes_JISX0208NECROW13, &quot;ASCII&quot;)).
695           getBytes(&quot;ASCII&quot;);
696 
697         //MS50221
698         roundTrip(&quot;MS50221&quot;, testStr, expectedBytes);
699         roundTrip(&quot;MS50221&quot;, JISX0212, expectedBytes_JISX0212);
700 
701         //MS50220 without halfwidth kana
702         roundTrip(&quot;MS50220&quot;,
703                   US_ASCII + JISX0208SUBSET + JISX0208NECROW13,
704                   (new String(expectedBytes_US_ASCII, &quot;ASCII&quot;) +
705                    new String(expectedBytes_JISX0208SUBSET, &quot;ASCII&quot;) +
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /* @test
<span class="line-modified"> 25  * @bug 6173388 6319716 8229960</span>
 26  * @summary Check full coverage encode/decode for Microsoft
 27  *          ISO2022_JP variants MS50220, MS50221 and MSISO2022JP
 28  * @modules jdk.charsets
 29  */
 30 
 31 import java.io.*;
 32 import java.nio.charset.*;
 33 public class TestMS5022X {
 34 
 35     private static String US_ASCII =
 36         &quot;\u0000\u0001\u0002\u0003\u0004\u0005\u0006\u0007&quot; +
 37         &quot;\b\t\n\u000B\f\r&quot; +
 38         &quot;\u0010\u0011\u0012\u0013\u0014\u0015\u0016\u0017&quot; +
 39         &quot;\u0018\u0019\u001A\u001C\u001D\u001E\u001F&quot; +
 40         &quot;\u0020\u0021\&quot;\u0023\u0024\u0025\u0026\&#39;&quot; +
 41         &quot;\u0028\u0029\u002A\u002B\u002C\u002D\u002E\u002F&quot; +
 42         &quot;\u0030\u0031\u0032\u0033\u0034\u0035\u0036\u0037&quot; +
 43         &quot;\u0038\u0039\u003A\u003B\u003C\u003D\u003E\u003F&quot; +
 44         &quot;\u0040\u0041\u0042\u0043\u0044\u0045\u0046\u0047&quot; +
 45         &quot;\u0048\u0049\u004A\u004B\u004C\u004D\u004E\u004F&quot; +
</pre>
<hr />
<pre>
649         for (int i = 0; i &lt; expectBytes.length; i++) {
650 
651             if (encodedBytes[i] != expectBytes[i])  {
652                 //System.out.printf(&quot;---&gt;&quot;);
653                 //throw new Exception(name + &quot; Encoder error&quot;);
654             }
655             //System.out.printf(&quot;%x, %x\n&quot;,
656             //encodedBytes[i],expectBytes[i]);
657         }
658         String decoded = new String(encodedBytes, name);
659         if (!decoded.equals(testStr)) {
660             throw new Exception(name + &quot; Decoder error&quot;);
661         }
662         String decoded2 = new String(repeatingEscapes, name);
663         if (!decoded2.equals(MIXEDCONTENT)) {
664             throw new Exception(name + &quot; Decoder error&quot;);
665         }
666      }
667 
668     public static void main(String[] args) throws Exception {

















669         String testStr = US_ASCII +
670                          JISX0208SUBSET +
671                          JISX0201KATAKANA +
672                          JISX0208NECROW13;
673 
674         byte[] expectedBytes= (new String(expectedBytes_US_ASCII, &quot;ASCII&quot;) +
675                                new String(expectedBytes_JISX0208SUBSET, &quot;ASCII&quot;) +
676                                new String(expectedBytes_JISX0201KATAKANA1, &quot;ASCII&quot;) +
677                                new String(expectedBytes_JISX0208NECROW13, &quot;ASCII&quot;)).
678           getBytes(&quot;ASCII&quot;);
679 
680         //MS50221
681         roundTrip(&quot;MS50221&quot;, testStr, expectedBytes);
682         roundTrip(&quot;MS50221&quot;, JISX0212, expectedBytes_JISX0212);
683 
684         //MS50220 without halfwidth kana
685         roundTrip(&quot;MS50220&quot;,
686                   US_ASCII + JISX0208SUBSET + JISX0208NECROW13,
687                   (new String(expectedBytes_US_ASCII, &quot;ASCII&quot;) +
688                    new String(expectedBytes_JISX0208SUBSET, &quot;ASCII&quot;) +
</pre>
</td>
</tr>
</table>
<center><a href="../../net/www/protocol/jar/MultiReleaseJarURLConnection.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../rmi/log/ReliableLog/Recovery.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>