<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/sun/util/calendar/zi/TestZoneInfo310.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../tools/jstatd/TestJstatdUsage.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../resources/cldr/Bug8134384.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/util/calendar/zi/TestZoneInfo310.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2012, 2016, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,11 +21,11 @@</span>
   * questions.
   */
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8007572 8008161 8157792</span>
<span class="udiff-line-modified-added">+  * @bug 8007572 8008161 8157792 8212970 8224560</span>
   * @summary Test whether the TimeZone generated from JSR310 tzdb is the same
   * as the one from the tz data from javazic
   * @modules java.base/sun.util.calendar:+open
   * @build BackEnd Checksum DayOfWeek Gen GenDoc Main Mappings Month
   *        Rule RuleDay RuleRec Simple TestZoneInfo310 Time Timezone
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -44,34 +44,34 @@</span>
  public class TestZoneInfo310 {
  
      public static void main(String[] args) throws Throwable {
  
          String TESTDIR = System.getProperty(&quot;test.dir&quot;, &quot;.&quot;);
<span class="udiff-line-modified-removed">-         String SRCDIR = System.getProperty(&quot;test.src&quot;, &quot;.&quot;);</span>
<span class="udiff-line-modified-removed">-         String tzdir = SRCDIR + File.separator + &quot;tzdata&quot;;</span>
<span class="udiff-line-modified-removed">-         String tzfiles = &quot;africa antarctica asia australasia europe northamerica pacificnew southamerica backward etcetera systemv&quot;;</span>
<span class="udiff-line-modified-removed">-         String jdk_tzdir = SRCDIR + File.separator + &quot;tzdata_jdk&quot;;</span>
<span class="udiff-line-modified-removed">-         String jdk_tzfiles = &quot;gmt jdk11_backward&quot;;</span>
<span class="udiff-line-modified-added">+         Path tzdir = Paths.get(System.getProperty(&quot;test.root&quot;),</span>
<span class="udiff-line-modified-added">+             &quot;..&quot;, &quot;..&quot;, &quot;make&quot;, &quot;data&quot;, &quot;tzdata&quot;);</span>
<span class="udiff-line-modified-added">+         String tzfiles = &quot;africa antarctica asia australasia europe northamerica pacificnew southamerica backward etcetera systemv gmt&quot;;</span>
<span class="udiff-line-modified-added">+         Path jdk_tzdir = Paths.get(System.getProperty(&quot;test.src&quot;), &quot;tzdata_jdk&quot;);</span>
<span class="udiff-line-modified-added">+         String jdk_tzfiles = &quot;jdk11_backward&quot;;</span>
          String zidir = TESTDIR + File.separator + &quot;zi&quot;;
          File fZidir = new File(zidir);
          if (!fZidir.exists()) {
              fZidir.mkdirs();
          }
          Matcher m = Pattern.compile(&quot;tzdata(?&lt;ver&gt;[0-9]{4}[A-z])&quot;)
<span class="udiff-line-modified-removed">-                            .matcher(new String(Files.readAllBytes(Paths.get(tzdir, &quot;VERSION&quot;)), &quot;ascii&quot;));</span>
<span class="udiff-line-modified-added">+                            .matcher(new String(Files.readAllBytes(tzdir.resolve(&quot;VERSION&quot;)), &quot;ascii&quot;));</span>
          String ver = m.find() ? m.group(&quot;ver&quot;) : &quot;NULL&quot;;
  
          ArrayList&lt;String&gt; alist = new ArrayList&lt;&gt;();
          alist.add(&quot;-V&quot;);
          alist.add(ver);
          alist.add(&quot;-d&quot;);
          alist.add(zidir);
          for (String f : tzfiles.split(&quot; &quot;)) {
<span class="udiff-line-modified-removed">-             alist.add(tzdir + File.separator + f);</span>
<span class="udiff-line-modified-added">+             alist.add(tzdir.resolve(f).toString());</span>
          }
          for (String f : jdk_tzfiles.split(&quot; &quot;)) {
<span class="udiff-line-modified-removed">-             alist.add(jdk_tzdir + File.separator + f);</span>
<span class="udiff-line-modified-added">+             alist.add(jdk_tzdir.resolve(f).toString());</span>
          }
          System.out.println(&quot;Compiling tz files!&quot;);
          Main.main(alist.toArray(new String[alist.size()]));
  
          //////////////////////////////////
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -168,10 +168,39 @@</span>
          }
  
          for (String zid : zids_new) {
              ZoneInfoOld zi = toZoneInfoOld(TimeZone.getTimeZone(zid));
              ZoneInfoOld ziOLD = (ZoneInfoOld)ZoneInfoOld.getTimeZone(zid);
<span class="udiff-line-added">+             /*</span>
<span class="udiff-line-added">+              * Temporary ignoring the failing TimeZones which are having zone</span>
<span class="udiff-line-added">+              * rules defined till year 2037 and/or above and have negative DST</span>
<span class="udiff-line-added">+              * save time in IANA tzdata. This bug is tracked via JDK-8223388.</span>
<span class="udiff-line-added">+              *</span>
<span class="udiff-line-added">+              * These are the zones/rules that employ negative DST in vanguard</span>
<span class="udiff-line-added">+              * format (as of 2019a):</span>
<span class="udiff-line-added">+              *</span>
<span class="udiff-line-added">+              *  - Rule &quot;Eire&quot;</span>
<span class="udiff-line-added">+              *  - Rule &quot;Morocco&quot;</span>
<span class="udiff-line-added">+              *  - Rule &quot;Namibia&quot;</span>
<span class="udiff-line-added">+              *  - Zone &quot;Europe/Prague&quot;</span>
<span class="udiff-line-added">+              *</span>
<span class="udiff-line-added">+              * Tehran/Iran rule has rules beyond 2037, in which javazic assumes</span>
<span class="udiff-line-added">+              * to be the last year. Thus javazic&#39;s rule is based on year 2037</span>
<span class="udiff-line-added">+              * (Mar 20th/Sep 20th are the cutover dates), while the real rule</span>
<span class="udiff-line-added">+              * has year 2087 where Mar 21st/Sep 21st are the cutover dates.</span>
<span class="udiff-line-added">+              */</span>
<span class="udiff-line-added">+             if (zid.equals(&quot;Africa/Casablanca&quot;) || // uses &quot;Morocco&quot; rule</span>
<span class="udiff-line-added">+                 zid.equals(&quot;Africa/El_Aaiun&quot;) || // uses &quot;Morocco&quot; rule</span>
<span class="udiff-line-added">+                 zid.equals(&quot;Africa/Windhoek&quot;) || // uses &quot;Namibia&quot; rule</span>
<span class="udiff-line-added">+                 zid.equals(&quot;Eire&quot;) ||</span>
<span class="udiff-line-added">+                 zid.equals(&quot;Europe/Bratislava&quot;) || // link to &quot;Europe/Prague&quot;</span>
<span class="udiff-line-added">+                 zid.equals(&quot;Europe/Dublin&quot;) || // uses &quot;Eire&quot; rule</span>
<span class="udiff-line-added">+                 zid.equals(&quot;Europe/Prague&quot;) ||</span>
<span class="udiff-line-added">+                 zid.equals(&quot;Asia/Tehran&quot;) || // last rule mismatch</span>
<span class="udiff-line-added">+                 zid.equals(&quot;Iran&quot;)) { // last rule mismatch</span>
<span class="udiff-line-added">+                     continue;</span>
<span class="udiff-line-added">+             }</span>
              if (! zi.equalsTo(ziOLD)) {
                  System.out.println(zi.diffsTo(ziOLD));
                  throw new RuntimeException(&quot;  FAILED:  &quot; + zid);
              }
          }
</pre>
<center><a href="../../../tools/jstatd/TestJstatdUsage.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../resources/cldr/Bug8134384.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>