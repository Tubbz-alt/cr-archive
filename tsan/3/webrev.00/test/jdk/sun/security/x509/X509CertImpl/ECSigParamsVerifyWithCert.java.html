<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/sun/security/x509/X509CertImpl/ECSigParamsVerifyWithCert.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  *
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  */
23 
24 /*
25  * @test
26  * @bug 8225745
27  * @summary Ensure ECDSA certificates with signature algorithm parameters
28  *          can be verified successfully
29  * @run main ECSigParamsVerifyWithCert
30  */
31 import java.io.*;
32 import java.security.cert.CertificateFactory;
33 import java.security.cert.X509Certificate;
34 
35 public class ECSigParamsVerifyWithCert {
36 
37     // ECDSA certificate with non-null signature parameters, i.e.
38     // Signature Algorithm: SHA256withECDSA, params unparsed,
39     // OID = 1.2.840.10045.4.3.2
40     private static String ecEntityWithSigParamsStr =
41         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
42         &quot;MIICXjCCAfmgAwIBAgIIHzREzASpiTowFAYIKoZIzj0EAwIGCCqGSM49AwEHMGAx\n&quot; +
43         &quot;IzAhBgNVBAMMGkNvcmRhIE5vZGUgSW50ZXJtZWRpYXRlIENBMQswCQYDVQQKDAJS\n&quot; +
44         &quot;MzEOMAwGA1UECwwFY29yZGExDzANBgNVBAcMBkxvbmRvbjELMAkGA1UEBhMCVUsw\n&quot; +
45         &quot;HhcNMTgwNjI1MDAwMDAwWhcNMjcwNTIwMDAwMDAwWjAxMQswCQYDVQQGEwJHQjEP\n&quot; +
46         &quot;MA0GA1UEBwwGTG9uZG9uMREwDwYDVQQKDAhNZWdhQ29ycDBZMBMGByqGSM49AgEG\n&quot; +
47         &quot;CCqGSM49AwEHA0IABG2VjWPPFnGVka3G9++Sz/GPRkAkht4BDoYTlkRz8hpwr4iu\n&quot; +
48         &quot;fU6NlReirLOB4LBLZcmp16xm4RYsN5ouTS7Z3wKjgcEwgb4wHQYDVR0OBBYEFBnY\n&quot; +
49         &quot;sikYpaSL9U8FUygbqN3sIvMOMA8GA1UdEwEB/wQFMAMBAf8wCwYDVR0PBAQDAgGG\n&quot; +
50         &quot;MCMGA1UdJQQcMBoGCCsGAQUFBwMBBggrBgEFBQcDAgYEVR0lADARBgorBgEEAYOK\n&quot; +
51         &quot;YgEBBAMCAQQwRwYDVR0eAQH/BD0wO6A3MDWkMzAxMQswCQYDVQQGEwJHQjEPMA0G\n&quot; +
52         &quot;A1UEBwwGTG9uZG9uMREwDwYDVQQKDAhNZWdhQ29ycKEAMBQGCCqGSM49BAMCBggq\n&quot; +
53         &quot;hkjOPQMBBwNJADBGAiEAos+QzgwwH2hfOtrlLncHnoT2YXXHP4q5h01T2DRmjcMC\n&quot; +
54         &quot;IQDa3xZz7CkyyNO1+paAthiNVIlGwwnl4UxuYMwkAiWACw==\n&quot; +
55         &quot;-----END CERTIFICATE-----\n&quot;;
56 
57     // ECDSA certificate with only signature algorithm oid, no parameters, i.e.
58     // Signature Algorithm: SHA256withECDSA, OID = 1.2.840.10045.4.3.2
59     private static String ecSigner =
60         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
61         &quot;MIICETCCAbigAwIBAgIIaHr3YTnjT8YwCgYIKoZIzj0EAwIwWDEbMBkGA1UEAwwS\n&quot; +
62         &quot;Q29yZGEgTm9kZSBSb290IENBMQswCQYDVQQKDAJSMzEOMAwGA1UECwwFY29yZGEx\n&quot; +
63         &quot;DzANBgNVBAcMBkxvbmRvbjELMAkGA1UEBhMCVUswHhcNMTcwNTIyMDAwMDAwWhcN\n&quot; +
64         &quot;MjcwNTIwMDAwMDAwWjBgMSMwIQYDVQQDDBpDb3JkYSBOb2RlIEludGVybWVkaWF0\n&quot; +
65         &quot;ZSBDQTELMAkGA1UECgwCUjMxDjAMBgNVBAsMBWNvcmRhMQ8wDQYDVQQHDAZMb25k\n&quot; +
66         &quot;b24xCzAJBgNVBAYTAlVLMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEA8veoCbh\n&quot; +
67         &quot;ZmazlyIFWjExBd8ru5OYdFW9Z9ZD5BVg/dswdKC4dlHMHe/sQ4TxFmkYNqf7DTTt\n&quot; +
68         &quot;ePtdHT7Eb1LGYKNkMGIwHQYDVR0OBBYEFOvuLjAVKUCuGZge2G/jfX8HosITMAsG\n&quot; +
69         &quot;A1UdDwQEAwIBhjAjBgNVHSUEHDAaBggrBgEFBQcDAQYIKwYBBQUHAwIGBFUdJQAw\n&quot; +
70         &quot;DwYDVR0TAQH/BAUwAwEB/zAKBggqhkjOPQQDAgNHADBEAiB6wr47tuC71qi6+FbY\n&quot; +
71         &quot;XYDTvK+QmAi5ywkFc95I9fPLaQIgIM+nNNQ50NwK610h3bG37XC2tGu+A7Dhtt2Q\n&quot; +
72         &quot;4nDqu30=\n&quot; +
73         &quot;-----END CERTIFICATE-----\n&quot;;
74 
75     public static void main(String[] args) throws Exception {
76         CertificateFactory certFactory = CertificateFactory.getInstance(&quot;X.509&quot;);
77         ByteArrayInputStream is
78                 = new ByteArrayInputStream(ecEntityWithSigParamsStr.getBytes());
79         X509Certificate ecEntityWithSigParams = (X509Certificate)certFactory.generateCertificate(is);
80         is = new ByteArrayInputStream(ecSigner.getBytes());
81         X509Certificate ecSigner = (X509Certificate)certFactory.generateCertificate(is);
82 
83         try {
84             ecEntityWithSigParams.verify(ecSigner.getPublicKey());
85             System.out.println(&quot;Test Passed: EC Cert verified&quot;);
86         } catch (Exception e) {
87             System.out.println(&quot;Failed, cannot verify EC certificate with sig params&quot;);
88             throw e;
89         }
90     }
91 }
    </pre>
  </body>
</html>