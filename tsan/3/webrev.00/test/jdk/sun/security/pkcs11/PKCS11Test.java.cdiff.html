<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/sun/security/pkcs11/PKCS11Test.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="MessageDigest/ByteBuffers.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Secmod/AddTrustedCert.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/security/pkcs11/PKCS11Test.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 37,10 ***</span>
<span class="line-new-header">--- 37,11 ---</span>
  import java.nio.file.Paths;
  import java.security.AlgorithmParameters;
  import java.security.InvalidAlgorithmParameterException;
  import java.security.KeyPairGenerator;
  import java.security.NoSuchProviderException;
<span class="line-added">+ import java.security.Policy;</span>
  import java.security.Provider;
  import java.security.ProviderException;
  import java.security.Security;
  import java.security.spec.ECGenParameterSpec;
  import java.security.spec.ECParameterSpec;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 80,15 ***</span>
      static final String CLOSED_BASE;
  
      static {
          // hack
          String absBase = new File(BASE).getAbsolutePath();
<span class="line-modified">!         int k = absBase.indexOf(SEP + &quot;test&quot; + SEP + &quot;sun&quot; + SEP);</span>
          if (k &lt; 0) k = 0;
<span class="line-modified">!         String p1 = absBase.substring(0, k + 6);</span>
<span class="line-modified">!         String p2 = absBase.substring(k + 5);</span>
<span class="line-modified">!         CLOSED_BASE = p1 + &quot;closed&quot; + p2;</span>
  
          // set it as a system property to make it available in policy file
          System.setProperty(&quot;closed.base&quot;, CLOSED_BASE);
      }
  
<span class="line-new-header">--- 81,15 ---</span>
      static final String CLOSED_BASE;
  
      static {
          // hack
          String absBase = new File(BASE).getAbsolutePath();
<span class="line-modified">!         int k = absBase.indexOf(SEP + &quot;test&quot; + SEP + &quot;jdk&quot; + SEP);</span>
          if (k &lt; 0) k = 0;
<span class="line-modified">!         String p1 = absBase.substring(0, k);</span>
<span class="line-modified">!         String p2 = absBase.substring(k);</span>
<span class="line-modified">!         CLOSED_BASE = p1 + &quot;/../closed&quot; + p2;</span>
  
          // set it as a system property to make it available in policy file
          System.setProperty(&quot;closed.base&quot;, CLOSED_BASE);
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 382,15 ***</span>
          }
      }
  
      static boolean loadNSPR(String libdir) throws Exception {
          // load NSS softoken dependencies in advance to avoid resolver issues
<span class="line-modified">!         safeReload(libdir + System.mapLibraryName(&quot;nspr4&quot;));</span>
<span class="line-modified">!         safeReload(libdir + System.mapLibraryName(&quot;plc4&quot;));</span>
<span class="line-modified">!         safeReload(libdir + System.mapLibraryName(&quot;plds4&quot;));</span>
<span class="line-modified">!         safeReload(libdir + System.mapLibraryName(&quot;sqlite3&quot;));</span>
<span class="line-modified">!         safeReload(libdir + System.mapLibraryName(&quot;nssutil3&quot;));</span>
          return true;
      }
  
      // Check the provider being used is NSS
      public static boolean isNSS(Provider p) {
<span class="line-new-header">--- 383,18 ---</span>
          }
      }
  
      static boolean loadNSPR(String libdir) throws Exception {
          // load NSS softoken dependencies in advance to avoid resolver issues
<span class="line-modified">!         String dir = libdir.endsWith(File.separator)</span>
<span class="line-modified">!                      ? libdir</span>
<span class="line-modified">!                      : libdir + File.separator;</span>
<span class="line-modified">!         safeReload(dir + System.mapLibraryName(&quot;nspr4&quot;));</span>
<span class="line-modified">!         safeReload(dir + System.mapLibraryName(&quot;plc4&quot;));</span>
<span class="line-added">+         safeReload(dir + System.mapLibraryName(&quot;plds4&quot;));</span>
<span class="line-added">+         safeReload(dir + System.mapLibraryName(&quot;sqlite3&quot;));</span>
<span class="line-added">+         safeReload(dir + System.mapLibraryName(&quot;nssutil3&quot;));</span>
          return true;
      }
  
      // Check the provider being used is NSS
      public static boolean isNSS(Provider p) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 874,10 ***</span>
<span class="line-new-header">--- 878,13 ---</span>
              return fetchNssLib(WINDOWS_X64.class);
  
          case &quot;MacOSX-x86_64-64&quot;:
              return fetchNssLib(MACOSX_X64.class);
  
<span class="line-added">+         case &quot;Linux-amd64-64&quot;:</span>
<span class="line-added">+             return fetchNssLib(LINUX_X64.class);</span>
<span class="line-added">+ </span>
          default:
              return null;
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 895,29 ***</span>
              } else {
                  throw new RuntimeException(&quot;Fetch artifact failed: &quot; + clazz
                          + &quot;\nPlease make sure the artifact is available.&quot;);
              }
          }
          return path;
      }
  
      @Artifact(
              organization = &quot;jpg.tests.jdk.nsslib&quot;,
              name = &quot;nsslib-windows_x64&quot;,
<span class="line-modified">!             revision = &quot;3.35&quot;,</span>
              extension = &quot;zip&quot;)
      private static class WINDOWS_X64 { }
  
      @Artifact(
              organization = &quot;jpg.tests.jdk.nsslib&quot;,
              name = &quot;nsslib-windows_x86&quot;,
<span class="line-modified">!             revision = &quot;3.35&quot;,</span>
              extension = &quot;zip&quot;)
      private static class WINDOWS_X86 { }
  
      @Artifact(
              organization = &quot;jpg.tests.jdk.nsslib&quot;,
              name = &quot;nsslib-macosx_x64&quot;,
<span class="line-modified">!             revision = &quot;3.35&quot;,</span>
              extension = &quot;zip&quot;)
      private static class MACOSX_X64 { }
  }
<span class="line-new-header">--- 902,37 ---</span>
              } else {
                  throw new RuntimeException(&quot;Fetch artifact failed: &quot; + clazz
                          + &quot;\nPlease make sure the artifact is available.&quot;);
              }
          }
<span class="line-added">+         Policy.setPolicy(null); // Clear the policy created by JIB if any</span>
          return path;
      }
  
      @Artifact(
              organization = &quot;jpg.tests.jdk.nsslib&quot;,
              name = &quot;nsslib-windows_x64&quot;,
<span class="line-modified">!             revision = &quot;3.46-VS2017&quot;,</span>
              extension = &quot;zip&quot;)
      private static class WINDOWS_X64 { }
  
      @Artifact(
              organization = &quot;jpg.tests.jdk.nsslib&quot;,
              name = &quot;nsslib-windows_x86&quot;,
<span class="line-modified">!             revision = &quot;3.46-VS2017&quot;,</span>
              extension = &quot;zip&quot;)
      private static class WINDOWS_X86 { }
  
      @Artifact(
              organization = &quot;jpg.tests.jdk.nsslib&quot;,
              name = &quot;nsslib-macosx_x64&quot;,
<span class="line-modified">!             revision = &quot;3.46&quot;,</span>
              extension = &quot;zip&quot;)
      private static class MACOSX_X64 { }
<span class="line-added">+ </span>
<span class="line-added">+     @Artifact(</span>
<span class="line-added">+             organization = &quot;jpg.tests.jdk.nsslib&quot;,</span>
<span class="line-added">+             name = &quot;nsslib-linux_x64&quot;,</span>
<span class="line-added">+             revision = &quot;3.46&quot;,</span>
<span class="line-added">+             extension = &quot;zip&quot;)</span>
<span class="line-added">+     private static class LINUX_X64 { }</span>
  }
</pre>
<center><a href="MessageDigest/ByteBuffers.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Secmod/AddTrustedCert.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>