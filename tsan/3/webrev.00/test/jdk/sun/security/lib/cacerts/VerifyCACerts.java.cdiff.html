<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/sun/security/lib/cacerts/VerifyCACerts.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../krb5/auto/KDC.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../mscapi/KeyAlgorithms.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/security/lib/cacerts/VerifyCACerts.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2017, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 23,32 ***</span>
   */
  
  /**
   * @test
   * @bug 8189131 8198240 8191844 8189949 8191031 8196141 8204923 8195774 8199779
<span class="line-modified">!  *      8209452 8209506 8210432 8195793</span>
   * @summary Check root CA entries in cacerts file
   */
  import java.io.File;
<span class="line-modified">! import java.io.FileInputStream;</span>
  import java.security.KeyStore;
  import java.security.MessageDigest;
<span class="line-modified">! import java.security.cert.*;</span>
<span class="line-modified">! import java.util.*;</span>
  
  public class VerifyCACerts {
  
      private static final String CACERTS
              = System.getProperty(&quot;java.home&quot;) + File.separator + &quot;lib&quot;
              + File.separator + &quot;security&quot; + File.separator + &quot;cacerts&quot;;
  
      // The numbers of certs now.
<span class="line-modified">!     private static final int COUNT = 92;</span>
  
      // map of cert alias to SHA-256 fingerprint
<span class="line-modified">!     private static final Map&lt;String, String&gt; FINGERPRINT_MAP</span>
<span class="line-modified">!             = new HashMap&lt;String, String&gt;() {</span>
          {
              put(&quot;actalisauthenticationrootca [jdk]&quot;,
                      &quot;55:92:60:84:EC:96:3A:64:B9:6E:2A:BE:01:CE:0B:A8:6A:64:FB:FE:BC:C7:AA:B5:AF:C1:55:B3:7F:D7:60:66&quot;);
              put(&quot;buypassclass2ca [jdk]&quot;,
                      &quot;9A:11:40:25:19:7C:5B:B9:5D:94:E6:3D:55:CD:43:79:08:47:B6:46:B2:3C:DF:11:AD:A4:A0:0E:FF:15:FB:48&quot;);
<span class="line-new-header">--- 23,47 ---</span>
   */
  
  /**
   * @test
   * @bug 8189131 8198240 8191844 8189949 8191031 8196141 8204923 8195774 8199779
<span class="line-modified">!  *      8209452 8209506 8210432 8195793 8216577 8222089 8222133 8222137 8222136</span>
<span class="line-added">+  *      8223499 8225392 8232019 8234245 8233223</span>
   * @summary Check root CA entries in cacerts file
   */
<span class="line-added">+ import java.io.ByteArrayInputStream;</span>
  import java.io.File;
<span class="line-modified">! import java.nio.file.Files;</span>
<span class="line-added">+ import java.nio.file.Path;</span>
  import java.security.KeyStore;
  import java.security.MessageDigest;
<span class="line-modified">! import java.security.cert.Certificate;</span>
<span class="line-modified">! import java.security.cert.CertificateExpiredException;</span>
<span class="line-added">+ import java.security.cert.CertificateNotYetValidException;</span>
<span class="line-added">+ import java.security.cert.X509Certificate;</span>
<span class="line-added">+ import java.util.Date;</span>
<span class="line-added">+ import java.util.Enumeration;</span>
<span class="line-added">+ import java.util.HashMap;</span>
<span class="line-added">+ import java.util.HashSet;</span>
<span class="line-added">+ import java.util.Map;</span>
  
  public class VerifyCACerts {
  
      private static final String CACERTS
              = System.getProperty(&quot;java.home&quot;) + File.separator + &quot;lib&quot;
              + File.separator + &quot;security&quot; + File.separator + &quot;cacerts&quot;;
  
      // The numbers of certs now.
<span class="line-modified">!     private static final int COUNT = 93;</span>
<span class="line-added">+ </span>
<span class="line-added">+     // SHA-256 of cacerts, can be generated with</span>
<span class="line-added">+     // shasum -a 256 cacerts | sed -e &#39;s/../&amp;:/g&#39; | tr &#39;[:lower:]&#39; &#39;[:upper:]&#39; | cut -c1-95</span>
<span class="line-added">+     private static final String CHECKSUM</span>
<span class="line-added">+             = &quot;22:AA:EB:89:4E:A4:EA:25:CA:3E:DA:0F:F1:2B:FA:05:4B:68:C5:E1:3A:F9:03:40:BF:EF:F5:13:7C:CE:BC:60&quot;;</span>
  
      // map of cert alias to SHA-256 fingerprint
<span class="line-modified">!     @SuppressWarnings(&quot;serial&quot;)</span>
<span class="line-modified">!     private static final Map&lt;String, String&gt; FINGERPRINT_MAP = new HashMap&lt;&gt;() {</span>
          {
              put(&quot;actalisauthenticationrootca [jdk]&quot;,
                      &quot;55:92:60:84:EC:96:3A:64:B9:6E:2A:BE:01:CE:0B:A8:6A:64:FB:FE:BC:C7:AA:B5:AF:C1:55:B3:7F:D7:60:66&quot;);
              put(&quot;buypassclass2ca [jdk]&quot;,
                      &quot;9A:11:40:25:19:7C:5B:B9:5D:94:E6:3D:55:CD:43:79:08:47:B6:46:B2:3C:DF:11:AD:A4:A0:0E:FF:15:FB:48&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 76,14 ***</span>
                      &quot;E7:93:C9:B0:2F:D8:AA:13:E2:1C:31:22:8A:CC:B0:81:19:64:3B:74:9C:89:89:64:B1:74:6D:46:C3:D4:CB:D2&quot;);
              put(&quot;usertrusteccca [jdk]&quot;,
                      &quot;4F:F4:60:D5:4B:9C:86:DA:BF:BC:FC:57:12:E0:40:0D:2B:ED:3F:BC:4D:4F:BD:AA:86:E0:6A:DC:D2:A9:AD:7A&quot;);
              put(&quot;utnuserfirstobjectca [jdk]&quot;,
                      &quot;6F:FF:78:E4:00:A7:0C:11:01:1C:D8:59:77:C4:59:FB:5A:F9:6A:3D:F0:54:08:20:D0:F4:B8:60:78:75:E5:8F&quot;);
<span class="line-removed">-             put(&quot;utnuserfirstclientauthemailca [jdk]&quot;,</span>
<span class="line-removed">-                     &quot;43:F2:57:41:2D:44:0D:62:74:76:97:4F:87:7D:A8:F1:FC:24:44:56:5A:36:7A:E6:0E:DD:C2:7A:41:25:31:AE&quot;);</span>
<span class="line-removed">-             put(&quot;utnuserfirsthardwareca [jdk]&quot;,</span>
<span class="line-removed">-                     &quot;6E:A5:47:41:D0:04:66:7E:ED:1B:48:16:63:4A:A3:A7:9E:6E:4B:96:95:0F:82:79:DA:FC:8D:9B:D8:81:21:37&quot;);</span>
              put(&quot;addtrustclass1ca [jdk]&quot;,
                      &quot;8C:72:09:27:9A:C0:4E:27:5E:16:D0:7F:D3:B7:75:E8:01:54:B5:96:80:46:E3:1F:52:DD:25:76:63:24:E9:A7&quot;);
              put(&quot;addtrustexternalca [jdk]&quot;,
                      &quot;68:7F:A4:51:38:22:78:FF:F0:C8:B1:1F:8D:43:D5:76:67:1C:6E:B2:BC:EA:B4:13:FB:83:D9:65:D0:6D:2F:F2&quot;);
              put(&quot;addtrustqualifiedca [jdk]&quot;,
<span class="line-new-header">--- 91,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 138,14 ***</span>
                      &quot;EB:04:CF:5E:B1:F3:9A:FA:76:2F:2B:B1:20:F2:96:CB:A5:20:C1:B9:7D:B1:58:95:65:B8:1C:B9:A1:7B:72:44&quot;);
              put(&quot;verisignclass3g4ca [jdk]&quot;,
                      &quot;69:DD:D7:EA:90:BB:57:C9:3E:13:5D:C8:5E:A6:FC:D5:48:0B:60:32:39:BD:C4:54:FC:75:8B:2A:26:CF:7F:79&quot;);
              put(&quot;verisignclass3g5ca [jdk]&quot;,
                      &quot;9A:CF:AB:7E:43:C8:D8:80:D0:6B:26:2A:94:DE:EE:E4:B4:65:99:89:C3:D0:CA:F1:9B:AF:64:05:E4:1A:B7:DF&quot;);
<span class="line-removed">-             put(&quot;certplusclass2primaryca [jdk]&quot;,</span>
<span class="line-removed">-                     &quot;0F:99:3C:8A:EF:97:BA:AF:56:87:14:0E:D5:9A:D1:82:1B:B4:AF:AC:F0:AA:9A:58:B5:D5:7A:33:8A:3A:FB:CB&quot;);</span>
<span class="line-removed">-             put(&quot;certplusclass3pprimaryca [jdk]&quot;,</span>
<span class="line-removed">-                     &quot;CC:C8:94:89:37:1B:AD:11:1C:90:61:9B:EA:24:0A:2E:6D:AD:D9:9F:9F:6E:1D:4D:41:E5:8E:D6:DE:3D:02:85&quot;);</span>
              put(&quot;keynectisrootca [jdk]&quot;,
                      &quot;42:10:F1:99:49:9A:9A:C3:3C:8D:E0:2B:A6:DB:AA:14:40:8B:DD:8A:6E:32:46:89:C1:92:2D:06:97:15:A3:32&quot;);
              put(&quot;dtrustclass3ca2 [jdk]&quot;,
                      &quot;49:E7:A4:42:AC:F0:EA:62:87:05:00:54:B5:25:64:B6:50:E4:F4:9E:42:E3:48:D6:AA:38:E0:39:E9:57:B1:C1&quot;);
              put(&quot;dtrustclass3ca2ev [jdk]&quot;,
<span class="line-new-header">--- 149,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 210,12 ***</span>
                      &quot;70:A7:3F:7F:37:6B:60:07:42:48:90:45:34:B1:14:82:D5:BF:0E:69:8E:CC:49:8D:F5:25:77:EB:F2:E9:3B:9A&quot;);
              put(&quot;affirmtrustcommercialca [jdk]&quot;,
                      &quot;03:76:AB:1D:54:C5:F9:80:3C:E4:B2:E2:01:A0:EE:7E:EF:7B:57:B6:36:E8:A9:3C:9B:8D:48:60:C9:6F:5F:A7&quot;);
              put(&quot;affirmtrustpremiumeccca [jdk]&quot;,
                      &quot;BD:71:FD:F6:DA:97:E4:CF:62:D1:64:7A:DD:25:81:B0:7D:79:AD:F8:39:7E:B4:EC:BA:9C:5E:84:88:82:14:23&quot;);
<span class="line-removed">-             put(&quot;deutschetelekomrootca2 [jdk]&quot;,</span>
<span class="line-removed">-                     &quot;B6:19:1A:50:D0:C3:97:7F:7D:A9:9B:CD:AA:C8:6A:22:7D:AE:B9:67:9E:C7:0B:A3:B0:C9:D9:22:71:C1:70:D3&quot;);</span>
              put(&quot;ttelesecglobalrootclass3ca [jdk]&quot;,
                      &quot;FD:73:DA:D3:1C:64:4F:F1:B4:3B:EF:0C:CD:DA:96:71:0B:9C:D9:87:5E:CA:7E:31:70:7A:F3:E9:6D:52:2B:BD&quot;);
              put(&quot;ttelesecglobalrootclass2ca [jdk]&quot;,
                      &quot;91:E2:F5:78:8D:58:10:EB:A7:BA:58:73:7D:E1:54:8A:8E:CA:CD:01:45:98:BC:0B:14:3E:04:1B:17:05:25:52&quot;);
              put(&quot;starfieldservicesrootg2ca [jdk]&quot;,
<span class="line-new-header">--- 217,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 230,16 ***</span>
                      &quot;BE:C9:49:11:C2:95:56:76:DB:6C:0A:55:09:86:D7:6E:3B:A0:05:66:7C:44:2C:97:62:B4:FB:B7:73:DE:22:8C&quot;);
              put(&quot;globalsignr2ca [jdk]&quot;,
                      &quot;CA:42:DD:41:74:5F:D0:B8:1E:B9:02:36:2C:F9:D8:BF:71:9D:A1:BD:1B:1E:FC:94:6F:5B:4C:99:F4:2C:1B:9E&quot;);
              put(&quot;teliasonerarootcav1 [jdk]&quot;,
                      &quot;DD:69:36:FE:21:F8:F0:77:C1:23:A1:A5:21:C1:22:24:F7:22:55:B7:3E:03:A7:26:06:93:E8:A2:4B:0F:A3:89&quot;);
          }
      };
  
      // Exception list to 90 days expiry policy
      // No error will be reported if certificate in this list expires
<span class="line-modified">!     private static final HashSet&lt;String&gt; EXPIRY_EXC_ENTRIES = new HashSet&lt;&gt;();</span>
  
      // Ninety days in milliseconds
      private static final long NINETY_DAYS = 7776000000L;
  
      private static boolean atLeastOneFailed = false;
<span class="line-new-header">--- 235,36 ---</span>
                      &quot;BE:C9:49:11:C2:95:56:76:DB:6C:0A:55:09:86:D7:6E:3B:A0:05:66:7C:44:2C:97:62:B4:FB:B7:73:DE:22:8C&quot;);
              put(&quot;globalsignr2ca [jdk]&quot;,
                      &quot;CA:42:DD:41:74:5F:D0:B8:1E:B9:02:36:2C:F9:D8:BF:71:9D:A1:BD:1B:1E:FC:94:6F:5B:4C:99:F4:2C:1B:9E&quot;);
              put(&quot;teliasonerarootcav1 [jdk]&quot;,
                      &quot;DD:69:36:FE:21:F8:F0:77:C1:23:A1:A5:21:C1:22:24:F7:22:55:B7:3E:03:A7:26:06:93:E8:A2:4B:0F:A3:89&quot;);
<span class="line-added">+             put(&quot;globalsignrootcar6 [jdk]&quot;,</span>
<span class="line-added">+                     &quot;2C:AB:EA:FE:37:D0:6C:A2:2A:BA:73:91:C0:03:3D:25:98:29:52:C4:53:64:73:49:76:3A:3A:B5:AD:6C:CF:69&quot;);</span>
<span class="line-added">+             put(&quot;luxtrustglobalroot2ca [jdk]&quot;,</span>
<span class="line-added">+                     &quot;54:45:5F:71:29:C2:0B:14:47:C4:18:F9:97:16:8F:24:C5:8F:C5:02:3B:F5:DA:5B:E2:EB:6E:1D:D8:90:2E:D5&quot;);</span>
<span class="line-added">+             put(&quot;amazonrootca1 [jdk]&quot;,</span>
<span class="line-added">+                     &quot;8E:CD:E6:88:4F:3D:87:B1:12:5B:A3:1A:C3:FC:B1:3D:70:16:DE:7F:57:CC:90:4F:E1:CB:97:C6:AE:98:19:6E&quot;);</span>
<span class="line-added">+             put(&quot;amazonrootca2 [jdk]&quot;,</span>
<span class="line-added">+                     &quot;1B:A5:B2:AA:8C:65:40:1A:82:96:01:18:F8:0B:EC:4F:62:30:4D:83:CE:C4:71:3A:19:C3:9C:01:1E:A4:6D:B4&quot;);</span>
<span class="line-added">+             put(&quot;amazonrootca3 [jdk]&quot;,</span>
<span class="line-added">+                     &quot;18:CE:6C:FE:7B:F1:4E:60:B2:E3:47:B8:DF:E8:68:CB:31:D0:2E:BB:3A:DA:27:15:69:F5:03:43:B4:6D:B3:A4&quot;);</span>
<span class="line-added">+             put(&quot;amazonrootca4 [jdk]&quot;,</span>
<span class="line-added">+                     &quot;E3:5D:28:41:9E:D0:20:25:CF:A6:90:38:CD:62:39:62:45:8D:A5:C6:95:FB:DE:A3:C2:2B:0B:FB:25:89:70:92&quot;);</span>
          }
      };
  
      // Exception list to 90 days expiry policy
      // No error will be reported if certificate in this list expires
<span class="line-modified">!     @SuppressWarnings(&quot;serial&quot;)</span>
<span class="line-added">+     private static final HashSet&lt;String&gt; EXPIRY_EXC_ENTRIES = new HashSet&lt;&gt;() {</span>
<span class="line-added">+         {</span>
<span class="line-added">+             // Valid until: Tue Jul 09 14:40:36 EDT 2019</span>
<span class="line-added">+             add(&quot;utnuserfirstobjectca [jdk]&quot;);</span>
<span class="line-added">+             // Valid until: Tue May 26 00:00:00 GMT 2020</span>
<span class="line-added">+             add(&quot;keynectisrootca [jdk]&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     };</span>
  
      // Ninety days in milliseconds
      private static final long NINETY_DAYS = 7776000000L;
  
      private static boolean atLeastOneFailed = false;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 247,12 ***</span>
      private static MessageDigest md;
  
      public static void main(String[] args) throws Exception {
          System.out.println(&quot;cacerts file: &quot; + CACERTS);
          md = MessageDigest.getInstance(&quot;SHA-256&quot;);
          KeyStore ks = KeyStore.getInstance(&quot;JKS&quot;);
<span class="line-modified">!         ks.load(new FileInputStream(CACERTS), &quot;changeit&quot;.toCharArray());</span>
  
          // check the count of certs inside
          if (ks.size() != COUNT) {
              atLeastOneFailed = true;
              System.err.println(&quot;ERROR: &quot; + ks.size() + &quot; entries, should be &quot;
<span class="line-new-header">--- 272,21 ---</span>
      private static MessageDigest md;
  
      public static void main(String[] args) throws Exception {
          System.out.println(&quot;cacerts file: &quot; + CACERTS);
          md = MessageDigest.getInstance(&quot;SHA-256&quot;);
<span class="line-added">+ </span>
<span class="line-added">+         byte[] data = Files.readAllBytes(Path.of(CACERTS));</span>
<span class="line-added">+         String checksum = toHexString(md.digest(data));</span>
<span class="line-added">+         if (!checksum.equals(CHECKSUM)) {</span>
<span class="line-added">+             atLeastOneFailed = true;</span>
<span class="line-added">+             System.err.println(&quot;ERROR: wrong checksum\n&quot; + checksum);</span>
<span class="line-added">+             System.err.println(&quot;Expected checksum\n&quot; + CHECKSUM);</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
          KeyStore ks = KeyStore.getInstance(&quot;JKS&quot;);
<span class="line-modified">!         ks.load(new ByteArrayInputStream(data), &quot;changeit&quot;.toCharArray());</span>
  
          // check the count of certs inside
          if (ks.size() != COUNT) {
              atLeastOneFailed = true;
              System.err.println(&quot;ERROR: &quot; + ks.size() + &quot; entries, should be &quot;
</pre>
<center><a href="../../krb5/auto/KDC.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../mscapi/KeyAlgorithms.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>