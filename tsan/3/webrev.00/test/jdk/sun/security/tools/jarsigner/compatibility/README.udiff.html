<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/sun/security/tools/jarsigner/compatibility/README</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="JdkUtils.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../multiRelease/MVJarSigningTest.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/security/tools/jarsigner/compatibility/README</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,6 +1,6 @@</span>
<span class="udiff-line-modified-removed">- # Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+ # Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -33,23 +33,40 @@</span>
  Please note that, the test may output a great deal of logs if the jdk list and
  TSA list are big, and that would lead to jtreg output overflow. So, it redirects
  stdout and stderr to file JTwork/scratch/details.out.
  
  ##### Report Columns #####
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ Jarfile</span>
<span class="udiff-line-added">+     The filenames used in the tests</span>
<span class="udiff-line-added">+ </span>
  Certificate
      Certificate identifier. The identifier consists of specific attributes of
      the certificate. Generally, the naming convention is:
      KeyAlgorithm_DigestAlgorithm_[KeySize][_Expired]
  
  Signer JDK
      The JDK version that signs jar.
  
  Signature Algorithm
<span class="udiff-line-modified-removed">-     The signature algorithm used by signing.</span>
<span class="udiff-line-modified-added">+     The signature algorithm used to sign the key as in &#39;keytool -sigalg&#39;.</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     Note: The values displayed in this column are specified to jarsigner only</span>
<span class="udiff-line-added">+     in case a test does not work with a default value.</span>
<span class="udiff-line-added">+     In any case the specified value or expected default value is compared in</span>
<span class="udiff-line-added">+     verifying phase against jarsigner&#39;s output and the test fails if it does</span>
<span class="udiff-line-added">+     not match.</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ Jar Digest Algorithm</span>
<span class="udiff-line-added">+     The digest algorithm used to digest the files contained in the JAR file and</span>
<span class="udiff-line-added">+     the manifest and signature files as in &#39;jarsigner -digestalg&#39;.</span>
<span class="udiff-line-added">+     See also note above about default values for Signature Algorithm.</span>
  
<span class="udiff-line-modified-removed">- TSA Digest</span>
<span class="udiff-line-modified-removed">-     The timestamp digest algorithm used by signing.</span>
<span class="udiff-line-modified-added">+ TSA Digest Algorithm</span>
<span class="udiff-line-modified-added">+     The timestamp digest algorithm used by TSA as in &#39;jarsigner -tsadigestalg&#39;.</span>
<span class="udiff-line-added">+     Shows no value if no TSA used.</span>
<span class="udiff-line-added">+     See also note above about default values for Signature Algorithm.</span>
  
  TSA
      TSA URL index. All of TSA URLs and their indices can be found at the top
      of this report.
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -78,28 +95,42 @@</span>
  ##### Usages #####
  jtreg [-options] \
      -jdk:&lt;path/to/testing/JDK&gt;
      [-DproxyHost=&lt;host&gt; \
       -DproxyPort=&lt;port&gt; \
<span class="udiff-line-added">+      -Dteeout=filename \</span>
       -DtsaListFile=&lt;/url/to/tsaListFile&gt; \
<span class="udiff-line-modified-removed">-      -DtsaList=&lt;/path/to/tsa1#/path/to/tsa2#/path/to/tsa3#...&gt; \</span>
<span class="udiff-line-modified-added">+      -DtsaList=&lt;/path/to/tsa1#/path/to/tsa2#/path/to/tsa3#...|notsa&gt; \</span>
       -DjdkListFile=&lt;/path/to/jdkListFile&gt; \
       -DjdkList=&lt;/path/to/jdk1#/path/to/jdk2#/path/to/jdk3#...&gt; \
       -DjavaSecurityFile=&lt;/path/to/java/security/properties/file&gt; \
       -DdelayVerify=&lt;true|false&gt; \
       -DcertValidity=&lt;[1, 1440]&gt;] \
<span class="udiff-line-modified-removed">-     &lt;JDK_REPO&gt;/jdk/test/sun/security/tools/jarsigner/compatibility/Compatibility.java</span>
<span class="udiff-line-modified-added">+     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java</span>
  
  Besides the common jtreg options, like -jdk, this test introduces a set of
  properties for receiving users&#39; inputs and making the test more flexible. These
<span class="udiff-line-modified-removed">- properties are:</span>
<span class="udiff-line-modified-added">+ properties are (all to specify after -D as system properties):</span>
<span class="udiff-line-added">+ </span>
  proxyHost=&lt;host&gt;
      This property indicates proxy host.
  
  proxyPort=&lt;port&gt;
      This property indicates proxy port. The default value is 80.
  
<span class="udiff-line-added">+ o=filename</span>
<span class="udiff-line-added">+     Redirects a copy of what is written to stdout into the specified file which</span>
<span class="udiff-line-added">+     allows for observing progress or problems during a longer running test.</span>
<span class="udiff-line-added">+     (Compatibility test replaces System.out to collect the output but even if</span>
<span class="udiff-line-added">+     it didn&#39;t jtreg would not print anything until the test would have ended.)</span>
<span class="udiff-line-added">+     Note that relative paths resolve relatively to some temporary working</span>
<span class="udiff-line-added">+     directory created by jtreg. Defaults to JTwork/scratch/details.out.</span>
<span class="udiff-line-added">+     The specified file is not deleted or emptied and the output is appended</span>
<span class="udiff-line-added">+     though jtreg deletes the default file with the whole directory if this</span>
<span class="udiff-line-added">+     option is not specified or the file point into JTwork/scratch.</span>
<span class="udiff-line-added">+     Example (Bash style): tail -F log &amp; jtreg ... -Do=$(pwd)/log ...</span>
<span class="udiff-line-added">+ </span>
  tsaListFile=&lt;/path/to/tsaListFile&gt;
      This property indicates a local file, which contains a set of TSA URLs and
      the supported digest algorithms (by optional parameter digests). The format
      of the file content looks like the below,
      http://path/to/tsa1
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -110,15 +141,16 @@</span>
      If a TSA line does not list the supported digest algorithms, that means
      the TSA supports SHA-1, SHA-256 and SHA-512. Because the test only focus
      on SHA-1, SHA-256 and SHA-512. So, if other digest algorithms, like SHA-224
      and SHA-384, are listed, they just be ignored.
  
<span class="udiff-line-modified-removed">- tsaList=&lt;/path/to/tsa1#/path/to/tsa2;digests=SHA-1,SHA-256#...&gt;</span>
<span class="udiff-line-modified-added">+ tsaList=&lt;/path/to/tsa1#/path/to/tsa2;digests=SHA-1,SHA-256#...|notsa&gt;</span>
      This property directly lists a set of TSAs in command. &quot;#&quot; is the delimiter.
      Note that, if both of tsaListFile and tsaList are specified, only property
<span class="udiff-line-modified-removed">-     jdkListFile is selected. If neither of tsaListFile and tsaList is specified,</span>
<span class="udiff-line-modified-removed">-     the test will fails immediately.</span>
<span class="udiff-line-modified-added">+     tsaListFile is selected. If neither of tsaListFile and tsaList is specified,</span>
<span class="udiff-line-modified-added">+     the test fails immediately.</span>
<span class="udiff-line-added">+     If tsaList has a value of &quot;notsa&quot;, no tsa is used.</span>
  
  jdkListFile=&lt;/path/to/jdkListFile&gt;
      This property indicates a local file, which contains a set of local JDK
      paths. The style of the file content looks like the below,
      /path/to/jdk1
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -127,34 +159,85 @@</span>
      ...
  
  jdkList=&lt;/path/to/jdk1#/path/to/jdk2#/path/to/jdk3#...&gt;
      This property directly lists a set of local JDK paths in command. &quot;#&quot; is
      the delimiter.
<span class="udiff-line-added">+     An element &quot;TEST_JDK&quot; as in</span>
<span class="udiff-line-added">+ jdkList=&lt;/path/to/jdk1#/path/to/jdk2#TEST_JDK#...&gt;</span>
<span class="udiff-line-added">+     adds the testing JDK, which is specified by jtreg option -jdk, to the jdk</span>
<span class="udiff-line-added">+     list. All signed jars are verified with the current testing JDK, which is</span>
<span class="udiff-line-added">+     specified by jtreg option -jdk, by default in addition to the JDKs given</span>
<span class="udiff-line-added">+     in jdkList but it is not used to also sign jars by default.</span>
<span class="udiff-line-added">+     If neither jdkList nor jdkListFile are specified, the current testing JDK,</span>
<span class="udiff-line-added">+     which is specified by jtreg option -jdk, is used to sign the jars, like:</span>
<span class="udiff-line-added">+ jdkList=TEST_JDK</span>
      Note that, if both of jdkListFile and jdkList are specified, only property
      jdkListFile is selected. If neither of jdkListFile nor jdkList is specified,
<span class="udiff-line-modified-removed">-     the testing JDK, which is specified by jtreg option -jdk will be used as</span>
<span class="udiff-line-modified-added">+     the testing JDK, which is specified by jtreg option -jdk, will be used as</span>
      the only one JDK in the JDK list.
  
<span class="udiff-line-added">+     The testing JDK, which is specified by jtreg option &quot;-jdk&quot;, should include</span>
<span class="udiff-line-added">+     the fix for JDK-8163304. Otherwise, the signature algorithm and timestamp</span>
<span class="udiff-line-added">+     digest algorithm cannot be extracted from verification output. And this JDK</span>
<span class="udiff-line-added">+     should support as many as possible signature algorithms. Anyway the latest</span>
<span class="udiff-line-added">+     JDK build is always recommended.</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ testComprehensiveJarContents=&lt;false|true&gt;</span>
<span class="udiff-line-added">+     If false, all tests are executed with only one typical JAR file. Otherwise,</span>
<span class="udiff-line-added">+     if true, a whole bunch of JAR files with several edge case contents are</span>
<span class="udiff-line-added">+     fed through the tests such as empty manifest or manifests with non-default</span>
<span class="udiff-line-added">+     line breaks. Default is false.</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ testJarUpdate=&lt;false|true&gt;</span>
<span class="udiff-line-added">+     If false, all tested JAR files are signed with one JDK and verified with</span>
<span class="udiff-line-added">+     each JDK, same or other. If true, in addition, all JAR files are modified</span>
<span class="udiff-line-added">+     after having been signed, and are then each signed again with each JDK and</span>
<span class="udiff-line-added">+     verified each JDK, same or other. Default is false.</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ strict=&lt;false|true&gt;</span>
<span class="udiff-line-added">+     If true, &#39;-strict&#39; option is specified to jarsigner along with &#39;-verify&#39;.</span>
<span class="udiff-line-added">+     Default is false.</span>
<span class="udiff-line-added">+ </span>
  javaSecurityFile=&lt;/path/to/java/security/properties/file&gt;
      This property indicates an alternative java security properties file. The
      default file is the path of file java.scurity that is distributed with
      this test.
  
  delayVerify=&lt;true|false&gt;
      This property indicates if doing an additional verifying after all of valid
      certificates expire. The default value is false.
  
<span class="udiff-line-added">+ expired=&lt;false|true&gt;</span>
<span class="udiff-line-added">+     This property indicates whether or not all tests should be repeated with an</span>
<span class="udiff-line-added">+     expired certificate. Refers to the certificate validity period and not to</span>
<span class="udiff-line-added">+     TSA. The default value is true.</span>
<span class="udiff-line-added">+ </span>
  certValidity=&lt;[1, 1440]&gt;
      This property indicates the remaining validity period in minutes for valid
      certificates. The value range is [1, 1440]. The default value is 1440.
      Note that, if delayVerify is false, this property doesn&#39;t take effect.
  
<span class="udiff-line-modified-removed">- The testing JDK, which is specified by jtreg option &quot;-jdk&quot;, should include the</span>
<span class="udiff-line-modified-removed">- fix for JDK-8163304. Otherwise, the signature algorithm and timestamp digest</span>
<span class="udiff-line-modified-removed">- algorithm cannot be extracted from verification output. And this JDK should</span>
<span class="udiff-line-modified-removed">- support as many as possible signature algorithms. Anyway the latest JDK build</span>
<span class="udiff-line-modified-removed">- is always recommended.</span>
<span class="udiff-line-modified-added">+ keyAlgs=RSA;1024;2048;#DSA;1024;2048;#EC;384;521;</span>
<span class="udiff-line-modified-added">+     Specifies key algorithms to use in the test. For each key algorithm the</span>
<span class="udiff-line-modified-added">+     sizes it should be tested with can be specified after semicolons and</span>
<span class="udiff-line-modified-added">+     otherwise default values are used. An empty keysize denotes the default</span>
<span class="udiff-line-modified-added">+     keysize and invokes keytool without a keysize specified. On JDK 6 and</span>
<span class="udiff-line-added">+     earlier, EC is not supported and always skipped.</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ digestAlgs=SHA-1#SHA-256#SHA-384#SHA-512#</span>
<span class="udiff-line-added">+     Specifies the digest algorithms used for both digesting files contained in</span>
<span class="udiff-line-added">+     the JAR file, manifests and signature files as well as certificates (keys)</span>
<span class="udiff-line-added">+     and for TSA.</span>
<span class="udiff-line-added">+     Ignored with TSA for jarsigner versions that don&#39;t support &#39;-tsadigestalg&#39;</span>
<span class="udiff-line-added">+     parameter, for digest algorithms specified not to be supported by a TSA</span>
<span class="udiff-line-added">+     server (&#39;digests&#39; sub-option is given to a tsaList item where digest</span>
<span class="udiff-line-added">+     algorithm is not contained in list), or in cases no TSA is used at all</span>
<span class="udiff-line-added">+     (&#39;tsaList=notsa&#39;).</span>
<span class="udiff-line-added">+     Note that the same set of digest algorithms is used in all three places</span>
<span class="udiff-line-added">+     (signing the key, digesting the JAR, and for the TSA) and cannot be</span>
<span class="udiff-line-added">+     specified individually except that some TSAs may exclude some digest</span>
<span class="udiff-line-added">+     algorithms.</span>
  
  ##### Examples #####
  $ cat /path/to/jdkList
  /path/to/jdk6u171-b05
  /path/to/jdk7u161-b05
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -175,17 +258,17 @@</span>
  http://time.certum.pl
  http://tsa.swisssign.net
  http://zeitstempel.dfn.de
  https://tsp.iaik.tugraz.at/tsp/TspRequest
  
<span class="udiff-line-modified-removed">- $ jtreg -va -nr -timeout:100 \</span>
<span class="udiff-line-modified-added">+ $ jtreg -va -nr \</span>
      -jdk:/path/to/latest/jdk \
      -DproxyHost=&lt;proxy&gt; -DproxyPort=&lt;port&gt; \
      -DjdkListFile=/path/to/jdkList \
      -DtsaListFile=/path/to/tsaList \
      -DdelayVerify=true -DcertValidity=60 \
<span class="udiff-line-modified-removed">-     &lt;JDK_REPO&gt;/jdk/test/sun/security/tools/jarsigner/compatibility/Compatibility.java</span>
<span class="udiff-line-modified-added">+     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java</span>
  
  The above is a comprehensive usage example. File &quot;jdkList&quot; lists the paths of
  testing JDK builds, and file &quot;tsaList&quot; lists the URLs of TSA services. Some TSAs,
  like http://timestamp.entrust.net/TSS/RFC3161sha1TS, specify the supported digest
  algorithms. Other TSAs, which don&#39;t specify parameter digests, are regarded to
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -195,21 +278,30 @@</span>
  of valid certificates expire and then does verification again.
  
  If don&#39;t want to provide such JDK list and TSA list files, the test allows to
  specify JDKs and TSAs (via properties jdkList and tsaList respectively) in the
  command directly, like the below style,
<span class="udiff-line-modified-removed">- $ jtreg -va -nr -timeout:100 \</span>
<span class="udiff-line-modified-added">+ $ jtreg -va -nr \</span>
      -jdk:/path/to/latest/jdk \
      -DproxyHost=&lt;proxy&gt; -DproxyPort=&lt;port&gt; \
      -DjdkList=/path/to/jdk6u171-b05#/path/to/jdk7u161-b05#/path/to/jdk8u144-b01#/path/to/jdk9-179 \
      -DtsaList=http://timestamp.comodoca.com/rfc3161#http://timestamp.entrust.net/TSS/RFC3161sha1TS;digests=SHA-1,SHA-256 \
      -DdelayVerify=true -DcertValidity=60 \
<span class="udiff-line-modified-removed">-     &lt;JDK_REPO&gt;/jdk/test/sun/security/tools/jarsigner/compatibility/Compatibility.java</span>
<span class="udiff-line-modified-added">+     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java</span>
  
  Furthermore, here introduces one of the simplest usages. It doesn&#39;t specify any
  JDK list, so the testing JDK, which is specified by jtreg option &quot;-jdk&quot;, will
  be tested. And it doesn&#39;t apply delay verifying, and no proxy is used, and use
  only one TSA. Now, the command is pretty simple and looks like the followings,
<span class="udiff-line-modified-removed">- $ jtreg -va -nr -timeout:100 \</span>
<span class="udiff-line-modified-added">+ $ jtreg -va -nr \</span>
      -jdk:/path/to/latest/jdk \
      -DtsaList=http://timestamp.comodoca.com/rfc3161 \
<span class="udiff-line-modified-removed">-     &lt;JDK_REPO&gt;/jdk/test/sun/security/tools/jarsigner/compatibility/Compatibility.java</span>
<span class="udiff-line-modified-added">+     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ It also works without a tsaList but not without the tsaList argument present</span>
<span class="udiff-line-added">+ in order to prevent it going missing or ignored unnoticed. May be useful for</span>
<span class="udiff-line-added">+ local tests but not recommended for real regression tests. Together with other</span>
<span class="udiff-line-added">+ arguments, a very short running test could be started for example with:</span>
<span class="udiff-line-added">+ $ jtreg -va -nr \</span>
<span class="udiff-line-added">+     -jdk:/path/to/latest/jdk \</span>
<span class="udiff-line-added">+     -DtsaList=notsa &quot;-DkeyAlgs=EC;&quot; -DdigestAlgs=SHA-256 -Dexpired=false</span>
<span class="udiff-line-added">+     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java</span>
</pre>
<center><a href="JdkUtils.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../multiRelease/MVJarSigningTest.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>