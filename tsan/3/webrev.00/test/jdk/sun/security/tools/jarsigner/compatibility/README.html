<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New test/jdk/sun/security/tools/jarsigner/compatibility/README</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 # Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.
  2 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  3 #
  4 # This code is free software; you can redistribute it and/or modify it
  5 # under the terms of the GNU General Public License version 2 only, as
  6 # published by the Free Software Foundation.
  7 #
  8 # This code is distributed in the hope that it will be useful, but WITHOUT
  9 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 10 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 11 # version 2 for more details (a copy is included in the LICENSE file that
 12 # accompanied this code).
 13 #
 14 # You should have received a copy of the GNU General Public License version
 15 # 2 along with this work; if not, write to the Free Software Foundation,
 16 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 17 #
 18 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 19 # or visit www.oracle.com if you need additional information or have any
 20 # questions.
 21 
 22 ##### Summary #####
 23 This test is used to verify the compatibility on jarsigner cross different JDK
 24 releases. It also can be used to check jar signing (w/ and w/o TSA) and verifying
 25 on some specific key algorithms and digest algorithms.
 26 
 27 ##### Output #####
 28 The test will generate a report, at JTwork/scratch/report.html, to display the
 29 key parameters for signing and the status of signing and verifying. And it will
 30 generate another report, at JTwork/scratch/failedReport.html, to collect all of
 31 failed cases.
 32 
 33 Please note that, the test may output a great deal of logs if the jdk list and
 34 TSA list are big, and that would lead to jtreg output overflow. So, it redirects
 35 stdout and stderr to file JTwork/scratch/details.out.
 36 
 37 ##### Report Columns #####
 38 
 39 Jarfile
 40     The filenames used in the tests
 41 
 42 Certificate
 43     Certificate identifier. The identifier consists of specific attributes of
 44     the certificate. Generally, the naming convention is:
 45     KeyAlgorithm_DigestAlgorithm_[KeySize][_Expired]
 46 
 47 Signer JDK
 48     The JDK version that signs jar.
 49 
 50 Signature Algorithm
 51     The signature algorithm used to sign the key as in &#39;keytool -sigalg&#39;.
 52 
 53     Note: The values displayed in this column are specified to jarsigner only
 54     in case a test does not work with a default value.
 55     In any case the specified value or expected default value is compared in
 56     verifying phase against jarsigner&#39;s output and the test fails if it does
 57     not match.
 58 
 59 Jar Digest Algorithm
 60     The digest algorithm used to digest the files contained in the JAR file and
 61     the manifest and signature files as in &#39;jarsigner -digestalg&#39;.
 62     See also note above about default values for Signature Algorithm.
 63 
 64 TSA Digest Algorithm
 65     The timestamp digest algorithm used by TSA as in &#39;jarsigner -tsadigestalg&#39;.
 66     Shows no value if no TSA used.
 67     See also note above about default values for Signature Algorithm.
 68 
 69 TSA
 70     TSA URL index. All of TSA URLs and their indices can be found at the top
 71     of this report.
 72 
 73 Signing Status
 74     Signing process result status. The status are the followings:
 75     [1]NONE, no action.
 76     [2]NORMAL, no any error and warning.
 77     [3]WARNING, no any error but some warnings raise.
 78     [4]ERROR, some errors raise.
 79 
 80 Verifier JDK
 81     The JDK version that verifies signed jars.
 82 
 83 Verifying Status
 84     Verifying process result status. The status are the same as those for
 85     &quot;Status of Signing&quot;.
 86 
 87 Delay Verifying Status
 88     Delay verifying process result status. The status are the same as those
 89     for &quot;Status of Signing&quot;.
 90 
 91 Failed
 92     It highlights which case fails. The failed cases (rows) are marked with
 93     letter X.
 94 
 95 ##### Usages #####
 96 jtreg [-options] \
 97     -jdk:&lt;path/to/testing/JDK&gt;
 98     [-DproxyHost=&lt;host&gt; \
 99      -DproxyPort=&lt;port&gt; \
100      -Dteeout=filename \
101      -DtsaListFile=&lt;/url/to/tsaListFile&gt; \
102      -DtsaList=&lt;/path/to/tsa1#/path/to/tsa2#/path/to/tsa3#...|notsa&gt; \
103      -DjdkListFile=&lt;/path/to/jdkListFile&gt; \
104      -DjdkList=&lt;/path/to/jdk1#/path/to/jdk2#/path/to/jdk3#...&gt; \
105      -DjavaSecurityFile=&lt;/path/to/java/security/properties/file&gt; \
106      -DdelayVerify=&lt;true|false&gt; \
107      -DcertValidity=&lt;[1, 1440]&gt;] \
108     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java
109 
110 Besides the common jtreg options, like -jdk, this test introduces a set of
111 properties for receiving users&#39; inputs and making the test more flexible. These
112 properties are (all to specify after -D as system properties):
113 
114 proxyHost=&lt;host&gt;
115     This property indicates proxy host.
116 
117 proxyPort=&lt;port&gt;
118     This property indicates proxy port. The default value is 80.
119 
120 o=filename
121     Redirects a copy of what is written to stdout into the specified file which
122     allows for observing progress or problems during a longer running test.
123     (Compatibility test replaces System.out to collect the output but even if
124     it didn&#39;t jtreg would not print anything until the test would have ended.)
125     Note that relative paths resolve relatively to some temporary working
126     directory created by jtreg. Defaults to JTwork/scratch/details.out.
127     The specified file is not deleted or emptied and the output is appended
128     though jtreg deletes the default file with the whole directory if this
129     option is not specified or the file point into JTwork/scratch.
130     Example (Bash style): tail -F log &amp; jtreg ... -Do=$(pwd)/log ...
131 
132 tsaListFile=&lt;/path/to/tsaListFile&gt;
133     This property indicates a local file, which contains a set of TSA URLs and
134     the supported digest algorithms (by optional parameter digests). The format
135     of the file content looks like the below,
136     http://path/to/tsa1
137     http://path/to/tsa2;digests=SHA-1,SHA-256
138     https://path/to/tsa3
139     ...
140 
141     If a TSA line does not list the supported digest algorithms, that means
142     the TSA supports SHA-1, SHA-256 and SHA-512. Because the test only focus
143     on SHA-1, SHA-256 and SHA-512. So, if other digest algorithms, like SHA-224
144     and SHA-384, are listed, they just be ignored.
145 
146 tsaList=&lt;/path/to/tsa1#/path/to/tsa2;digests=SHA-1,SHA-256#...|notsa&gt;
147     This property directly lists a set of TSAs in command. &quot;#&quot; is the delimiter.
148     Note that, if both of tsaListFile and tsaList are specified, only property
149     tsaListFile is selected. If neither of tsaListFile and tsaList is specified,
150     the test fails immediately.
151     If tsaList has a value of &quot;notsa&quot;, no tsa is used.
152 
153 jdkListFile=&lt;/path/to/jdkListFile&gt;
154     This property indicates a local file, which contains a set of local JDK
155     paths. The style of the file content looks like the below,
156     /path/to/jdk1
157     /path/to/jdk2
158     /path/to/jdk3
159     ...
160 
161 jdkList=&lt;/path/to/jdk1#/path/to/jdk2#/path/to/jdk3#...&gt;
162     This property directly lists a set of local JDK paths in command. &quot;#&quot; is
163     the delimiter.
164     An element &quot;TEST_JDK&quot; as in
165 jdkList=&lt;/path/to/jdk1#/path/to/jdk2#TEST_JDK#...&gt;
166     adds the testing JDK, which is specified by jtreg option -jdk, to the jdk
167     list. All signed jars are verified with the current testing JDK, which is
168     specified by jtreg option -jdk, by default in addition to the JDKs given
169     in jdkList but it is not used to also sign jars by default.
170     If neither jdkList nor jdkListFile are specified, the current testing JDK,
171     which is specified by jtreg option -jdk, is used to sign the jars, like:
172 jdkList=TEST_JDK
173     Note that, if both of jdkListFile and jdkList are specified, only property
174     jdkListFile is selected. If neither of jdkListFile nor jdkList is specified,
175     the testing JDK, which is specified by jtreg option -jdk, will be used as
176     the only one JDK in the JDK list.
177 
178     The testing JDK, which is specified by jtreg option &quot;-jdk&quot;, should include
179     the fix for JDK-8163304. Otherwise, the signature algorithm and timestamp
180     digest algorithm cannot be extracted from verification output. And this JDK
181     should support as many as possible signature algorithms. Anyway the latest
182     JDK build is always recommended.
183 
184 testComprehensiveJarContents=&lt;false|true&gt;
185     If false, all tests are executed with only one typical JAR file. Otherwise,
186     if true, a whole bunch of JAR files with several edge case contents are
187     fed through the tests such as empty manifest or manifests with non-default
188     line breaks. Default is false.
189 
190 testJarUpdate=&lt;false|true&gt;
191     If false, all tested JAR files are signed with one JDK and verified with
192     each JDK, same or other. If true, in addition, all JAR files are modified
193     after having been signed, and are then each signed again with each JDK and
194     verified each JDK, same or other. Default is false.
195 
196 strict=&lt;false|true&gt;
197     If true, &#39;-strict&#39; option is specified to jarsigner along with &#39;-verify&#39;.
198     Default is false.
199 
200 javaSecurityFile=&lt;/path/to/java/security/properties/file&gt;
201     This property indicates an alternative java security properties file. The
202     default file is the path of file java.scurity that is distributed with
203     this test.
204 
205 delayVerify=&lt;true|false&gt;
206     This property indicates if doing an additional verifying after all of valid
207     certificates expire. The default value is false.
208 
209 expired=&lt;false|true&gt;
210     This property indicates whether or not all tests should be repeated with an
211     expired certificate. Refers to the certificate validity period and not to
212     TSA. The default value is true.
213 
214 certValidity=&lt;[1, 1440]&gt;
215     This property indicates the remaining validity period in minutes for valid
216     certificates. The value range is [1, 1440]. The default value is 1440.
217     Note that, if delayVerify is false, this property doesn&#39;t take effect.
218 
219 keyAlgs=RSA;1024;2048;#DSA;1024;2048;#EC;384;521;
220     Specifies key algorithms to use in the test. For each key algorithm the
221     sizes it should be tested with can be specified after semicolons and
222     otherwise default values are used. An empty keysize denotes the default
223     keysize and invokes keytool without a keysize specified. On JDK 6 and
224     earlier, EC is not supported and always skipped.
225 
226 digestAlgs=SHA-1#SHA-256#SHA-384#SHA-512#
227     Specifies the digest algorithms used for both digesting files contained in
228     the JAR file, manifests and signature files as well as certificates (keys)
229     and for TSA.
230     Ignored with TSA for jarsigner versions that don&#39;t support &#39;-tsadigestalg&#39;
231     parameter, for digest algorithms specified not to be supported by a TSA
232     server (&#39;digests&#39; sub-option is given to a tsaList item where digest
233     algorithm is not contained in list), or in cases no TSA is used at all
234     (&#39;tsaList=notsa&#39;).
235     Note that the same set of digest algorithms is used in all three places
236     (signing the key, digesting the JAR, and for the TSA) and cannot be
237     specified individually except that some TSAs may exclude some digest
238     algorithms.
239 
240 ##### Examples #####
241 $ cat /path/to/jdkList
242 /path/to/jdk6u171-b05
243 /path/to/jdk7u161-b05
244 /path/to/jdk8u144-b01
245 /path/to/jdk9-179 
246 
247 $ cat /path/to/tsaList
248 http://timestamp.comodoca.com/rfc3161
249 http://sha256timestamp.ws.symantec.com/sha256/timestamp
250 http://tsa.starfieldtech.com
251 http://timestamp.entrust.net/TSS/RFC3161sha1TS;digests=SHA-1,SHA-256
252 http://timestamp.entrust.net/TSS/RFC3161sha2TS;digests=SHA-1,SHA-256
253 http://rfc3161timestamp.globalsign.com/advanced;digests=SHA-256,SHA-512
254 http://rfc3161timestamp.globalsign.com/standard
255 http://timestamp.globalsign.com/scripts/timstamp.dll
256 http://timestamp.globalsign.com/?signature=sha2;digests=SHA-256,SHA-512
257 http://timestamp.digicert.com
258 http://time.certum.pl
259 http://tsa.swisssign.net
260 http://zeitstempel.dfn.de
261 https://tsp.iaik.tugraz.at/tsp/TspRequest
262 
263 $ jtreg -va -nr \
264     -jdk:/path/to/latest/jdk \
265     -DproxyHost=&lt;proxy&gt; -DproxyPort=&lt;port&gt; \
266     -DjdkListFile=/path/to/jdkList \
267     -DtsaListFile=/path/to/tsaList \
268     -DdelayVerify=true -DcertValidity=60 \
269     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java
270 
271 The above is a comprehensive usage example. File &quot;jdkList&quot; lists the paths of
272 testing JDK builds, and file &quot;tsaList&quot; lists the URLs of TSA services. Some TSAs,
273 like http://timestamp.entrust.net/TSS/RFC3161sha1TS, specify the supported digest
274 algorithms. Other TSAs, which don&#39;t specify parameter digests, are regarded to
275 support SHA-1, SHA-256 and SHA-512. The test uses a proxy to access TSA services.
276 And it enables delay verifying and set the certificate validity period to 60
277 minutes. So, after the first verification is done, the test will wait for all
278 of valid certificates expire and then does verification again.
279 
280 If don&#39;t want to provide such JDK list and TSA list files, the test allows to
281 specify JDKs and TSAs (via properties jdkList and tsaList respectively) in the
282 command directly, like the below style,
283 $ jtreg -va -nr \
284     -jdk:/path/to/latest/jdk \
285     -DproxyHost=&lt;proxy&gt; -DproxyPort=&lt;port&gt; \
286     -DjdkList=/path/to/jdk6u171-b05#/path/to/jdk7u161-b05#/path/to/jdk8u144-b01#/path/to/jdk9-179 \
287     -DtsaList=http://timestamp.comodoca.com/rfc3161#http://timestamp.entrust.net/TSS/RFC3161sha1TS;digests=SHA-1,SHA-256 \
288     -DdelayVerify=true -DcertValidity=60 \
289     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java
290 
291 Furthermore, here introduces one of the simplest usages. It doesn&#39;t specify any
292 JDK list, so the testing JDK, which is specified by jtreg option &quot;-jdk&quot;, will
293 be tested. And it doesn&#39;t apply delay verifying, and no proxy is used, and use
294 only one TSA. Now, the command is pretty simple and looks like the followings,
295 $ jtreg -va -nr \
296     -jdk:/path/to/latest/jdk \
297     -DtsaList=http://timestamp.comodoca.com/rfc3161 \
298     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java
299 
300 It also works without a tsaList but not without the tsaList argument present
301 in order to prevent it going missing or ignored unnoticed. May be useful for
302 local tests but not recommended for real regression tests. Together with other
303 arguments, a very short running test could be started for example with:
304 $ jtreg -va -nr \
305     -jdk:/path/to/latest/jdk \
306     -DtsaList=notsa &quot;-DkeyAlgs=EC;&quot; -DdigestAlgs=SHA-256 -Dexpired=false
307     &lt;JDK_REPO&gt;/test/jdk/sun/security/tools/jarsigner/compatibility/Compatibility.java
    </pre>
  </body>
</html>