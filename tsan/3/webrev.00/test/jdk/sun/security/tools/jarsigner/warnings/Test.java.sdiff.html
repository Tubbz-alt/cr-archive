<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/security/tools/jarsigner/warnings/Test.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="NotSignedByAliasTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../keytool/DupImport.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/security/tools/jarsigner/warnings/Test.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
<span class="line-removed"> 24 import jdk.test.lib.process.OutputAnalyzer;</span>
<span class="line-removed"> 25 import jdk.test.lib.process.ProcessTools;</span>
<span class="line-removed"> 26 </span>
 27 import java.util.ArrayList;
 28 import java.util.Arrays;
 29 import java.util.List;




 30 
 31 /**
 32  * Base class.
 33  */
 34 public abstract class Test {
 35 
 36     static final String TEST_SOURCES = System.getProperty(&quot;test.src&quot;, &quot;.&quot;);
 37     static final String TEST_CLASSES = System.getProperty(&quot;test.classes&quot;);
 38     static final String FS = System.getProperty(&quot;file.separator&quot;);
 39     static final String JAVA_HOME = System.getProperty(&quot;java.home&quot;);
 40     static final String KEYTOOL = JAVA_HOME + FS + &quot;bin&quot; + FS + &quot;keytool&quot;;
 41     static final String JARSIGNER = JAVA_HOME + FS + &quot;bin&quot; + FS + &quot;jarsigner&quot;;
 42     static final String UNSIGNED_JARFILE = &quot;unsigned.jar&quot;;
 43     static final String SIGNED_JARFILE = &quot;signed.jar&quot;;
 44     static final String UPDATED_SIGNED_JARFILE = &quot;updated_signed.jar&quot;;
 45     static final String FIRST_FILE = &quot;first.txt&quot;;
 46     static final String SECOND_FILE = &quot;second.txt&quot;;
 47     static final String PASSWORD = &quot;password&quot;;
 48     static final String FIRST_KEY_KEYSTORE = &quot;first_key.jks&quot;;
 49     static final String KEYSTORE = &quot;keystore.jks&quot;;
 50     static final String FIRST_KEY_ALIAS = &quot;first&quot;;
 51     static final String SECOND_KEY_ALIAS = &quot;second&quot;;
 52     static final String KEY_ALG = &quot;RSA&quot;;
 53     static final String KEY_ALIAS = &quot;alias&quot;;
 54     static final String CERT_REQUEST_FILENAME = &quot;test.req&quot;;
 55     static final String CERT_FILENAME = &quot;test.crt&quot;;
 56     static final String CA_KEY_ALIAS = &quot;ca&quot;;
 57     static final String CA2_KEY_ALIAS = &quot;ca2&quot;;
 58     static final int KEY_SIZE = 2048;
 59     static final int TIMEOUT = 6 * 60 * 1000;   // in millis
 60     static final int VALIDITY = 365;
 61 
 62     static final String WARNING = &quot;Warning:&quot;;
<span class="line-modified"> 63     static final String WARNING_OR_ERROR = &quot;(Warning|Error):&quot;;</span>

 64 
 65     static final String CHAIN_NOT_VALIDATED_VERIFYING_WARNING
 66             = &quot;This jar contains entries &quot;
 67             + &quot;whose certificate chain is invalid.&quot;;
 68 



 69     static final String ALIAS_NOT_IN_STORE_VERIFYING_WARNING
 70             = &quot;This jar contains signed entries &quot;
 71             + &quot;that are not signed by alias in this keystore.&quot;;
 72 
 73     static final String BAD_EXTENDED_KEY_USAGE_SIGNING_WARNING
 74             = &quot;The signer certificate&#39;s ExtendedKeyUsage extension &quot;
 75             + &quot;doesn&#39;t allow code signing.&quot;;
 76 
 77     static final String BAD_EXTENDED_KEY_USAGE_VERIFYING_WARNING
 78             = &quot;This jar contains entries whose signer certificate&#39;s &quot;
 79             + &quot;ExtendedKeyUsage extension doesn&#39;t allow code signing.&quot;;
 80 
 81     static final String BAD_KEY_USAGE_SIGNING_WARNING
 82             = &quot;The signer certificate&#39;s KeyUsage extension &quot;
 83             + &quot;doesn&#39;t allow code signing.&quot;;
 84 
 85     static final String BAD_KEY_USAGE_VERIFYING_WARNING
 86             = &quot;This jar contains entries whose signer certificate&#39;s KeyUsage &quot;
 87             + &quot;extension doesn&#39;t allow code signing.&quot;;
 88 
</pre>
<hr />
<pre>
242         }
243         if (count &gt; 0) {
244             analyzer.shouldMatch(WARNING_OR_ERROR);
245         }
246         analyzer.shouldContain(JAR_SIGNED);
247     }
248 
249     protected OutputAnalyzer keytool(String... cmd) throws Throwable {
250         return tool(KEYTOOL, cmd);
251     }
252 
253     protected OutputAnalyzer jarsigner(String... cmd) throws Throwable {
254         return tool(JARSIGNER, cmd);
255     }
256 
257     private OutputAnalyzer tool(String tool, String... args) throws Throwable {
258         List&lt;String&gt; cmd = new ArrayList&lt;&gt;();
259         cmd.add(tool);
260         cmd.add(&quot;-J-Duser.language=en&quot;);
261         cmd.add(&quot;-J-Duser.country=US&quot;);
<span class="line-modified">262         cmd.addAll(Arrays.asList(args));</span>


263         return ProcessTools.executeCommand(cmd.toArray(new String[cmd.size()]));
264     }
265 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 



 24 import java.util.ArrayList;
 25 import java.util.Arrays;
 26 import java.util.List;
<span class="line-added"> 27 import java.util.stream.Collectors;</span>
<span class="line-added"> 28 </span>
<span class="line-added"> 29 import jdk.test.lib.process.OutputAnalyzer;</span>
<span class="line-added"> 30 import jdk.test.lib.process.ProcessTools;</span>
 31 
 32 /**
 33  * Base class.
 34  */
 35 public abstract class Test {
 36 
 37     static final String TEST_SOURCES = System.getProperty(&quot;test.src&quot;, &quot;.&quot;);
 38     static final String TEST_CLASSES = System.getProperty(&quot;test.classes&quot;);
 39     static final String FS = System.getProperty(&quot;file.separator&quot;);
 40     static final String JAVA_HOME = System.getProperty(&quot;java.home&quot;);
 41     static final String KEYTOOL = JAVA_HOME + FS + &quot;bin&quot; + FS + &quot;keytool&quot;;
 42     static final String JARSIGNER = JAVA_HOME + FS + &quot;bin&quot; + FS + &quot;jarsigner&quot;;
 43     static final String UNSIGNED_JARFILE = &quot;unsigned.jar&quot;;
 44     static final String SIGNED_JARFILE = &quot;signed.jar&quot;;
 45     static final String UPDATED_SIGNED_JARFILE = &quot;updated_signed.jar&quot;;
 46     static final String FIRST_FILE = &quot;first.txt&quot;;
 47     static final String SECOND_FILE = &quot;second.txt&quot;;
 48     static final String PASSWORD = &quot;password&quot;;
 49     static final String FIRST_KEY_KEYSTORE = &quot;first_key.jks&quot;;
 50     static final String KEYSTORE = &quot;keystore.jks&quot;;
 51     static final String FIRST_KEY_ALIAS = &quot;first&quot;;
 52     static final String SECOND_KEY_ALIAS = &quot;second&quot;;
 53     static final String KEY_ALG = &quot;RSA&quot;;
 54     static final String KEY_ALIAS = &quot;alias&quot;;
 55     static final String CERT_REQUEST_FILENAME = &quot;test.req&quot;;
 56     static final String CERT_FILENAME = &quot;test.crt&quot;;
 57     static final String CA_KEY_ALIAS = &quot;ca&quot;;
 58     static final String CA2_KEY_ALIAS = &quot;ca2&quot;;
 59     static final int KEY_SIZE = 2048;
 60     static final int TIMEOUT = 6 * 60 * 1000;   // in millis
 61     static final int VALIDITY = 365;
 62 
 63     static final String WARNING = &quot;Warning:&quot;;
<span class="line-modified"> 64     static final String ERROR = &quot;[Ee]rror:&quot;;</span>
<span class="line-added"> 65     static final String WARNING_OR_ERROR = &quot;(&quot; + WARNING + &quot;|&quot; + ERROR + &quot;)&quot;;</span>
 66 
 67     static final String CHAIN_NOT_VALIDATED_VERIFYING_WARNING
 68             = &quot;This jar contains entries &quot;
 69             + &quot;whose certificate chain is invalid.&quot;;
 70 
<span class="line-added"> 71     static final String CERTIFICATE_SELF_SIGNED</span>
<span class="line-added"> 72             = &quot;The signer&#39;s certificate is self-signed.&quot;;</span>
<span class="line-added"> 73 </span>
 74     static final String ALIAS_NOT_IN_STORE_VERIFYING_WARNING
 75             = &quot;This jar contains signed entries &quot;
 76             + &quot;that are not signed by alias in this keystore.&quot;;
 77 
 78     static final String BAD_EXTENDED_KEY_USAGE_SIGNING_WARNING
 79             = &quot;The signer certificate&#39;s ExtendedKeyUsage extension &quot;
 80             + &quot;doesn&#39;t allow code signing.&quot;;
 81 
 82     static final String BAD_EXTENDED_KEY_USAGE_VERIFYING_WARNING
 83             = &quot;This jar contains entries whose signer certificate&#39;s &quot;
 84             + &quot;ExtendedKeyUsage extension doesn&#39;t allow code signing.&quot;;
 85 
 86     static final String BAD_KEY_USAGE_SIGNING_WARNING
 87             = &quot;The signer certificate&#39;s KeyUsage extension &quot;
 88             + &quot;doesn&#39;t allow code signing.&quot;;
 89 
 90     static final String BAD_KEY_USAGE_VERIFYING_WARNING
 91             = &quot;This jar contains entries whose signer certificate&#39;s KeyUsage &quot;
 92             + &quot;extension doesn&#39;t allow code signing.&quot;;
 93 
</pre>
<hr />
<pre>
247         }
248         if (count &gt; 0) {
249             analyzer.shouldMatch(WARNING_OR_ERROR);
250         }
251         analyzer.shouldContain(JAR_SIGNED);
252     }
253 
254     protected OutputAnalyzer keytool(String... cmd) throws Throwable {
255         return tool(KEYTOOL, cmd);
256     }
257 
258     protected OutputAnalyzer jarsigner(String... cmd) throws Throwable {
259         return tool(JARSIGNER, cmd);
260     }
261 
262     private OutputAnalyzer tool(String tool, String... args) throws Throwable {
263         List&lt;String&gt; cmd = new ArrayList&lt;&gt;();
264         cmd.add(tool);
265         cmd.add(&quot;-J-Duser.language=en&quot;);
266         cmd.add(&quot;-J-Duser.country=US&quot;);
<span class="line-modified">267         cmd.addAll(Arrays.asList(args).stream().filter(arg -&gt; {</span>
<span class="line-added">268             return arg != null &amp;&amp; !arg.isEmpty();</span>
<span class="line-added">269         }).collect(Collectors.toList()));</span>
270         return ProcessTools.executeCommand(cmd.toArray(new String[cmd.size()]));
271     }
272 }
</pre>
</td>
</tr>
</table>
<center><a href="NotSignedByAliasTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../keytool/DupImport.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>