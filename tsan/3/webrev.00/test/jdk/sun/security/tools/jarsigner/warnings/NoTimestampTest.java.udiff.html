<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/sun/security/tools/jarsigner/warnings/NoTimestampTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="HasUnsignedEntryTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="NotSignedByAliasTest.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/security/tools/jarsigner/warnings/NoTimestampTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2013, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -25,10 +25,11 @@</span>
  import java.io.InputStream;
  import java.security.KeyStore;
  import java.security.cert.X509Certificate;
  import java.util.Date;
  import java.util.Locale;
<span class="udiff-line-added">+ import java.util.TimeZone;</span>
  
  import jdk.test.lib.process.OutputAnalyzer;
  import jdk.test.lib.util.JarUtils;
  
  /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -44,10 +45,11 @@</span>
      /**
       * The test signs and verifies a jar file without -tsa and -tsacert options,
       * and checks that proper warnings are shown.
       */
      public static void main(String[] args) throws Throwable {
<span class="udiff-line-added">+ </span>
          Locale reservedLocale = Locale.getDefault();
          Locale.setDefault(Locale.US);
  
          try {
              NoTimestampTest test = new NoTimestampTest();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -59,26 +61,30 @@</span>
      }
  
      private void start() throws Throwable {
          String timezone = System.getProperty(&quot;user.timezone&quot;);
          System.out.println(String.format(&quot;Timezone = %s&quot;, timezone));
<span class="udiff-line-added">+         if (timezone != null) {</span>
<span class="udiff-line-added">+             TimeZone.setDefault(TimeZone.getTimeZone(timezone));</span>
<span class="udiff-line-added">+         }</span>
  
          // create a jar file that contains one class file
          Utils.createFiles(FIRST_FILE);
          JarUtils.createJar(UNSIGNED_JARFILE, FIRST_FILE);
  
          // create key pair
<span class="udiff-line-modified-removed">-         createAlias(CA_KEY_ALIAS);</span>
<span class="udiff-line-modified-added">+         createAlias(CA_KEY_ALIAS, &quot;-ext&quot;, &quot;bc:c&quot;);</span>
          createAlias(KEY_ALIAS);
          issueCert(KEY_ALIAS,
                  &quot;-validity&quot;, Integer.toString(VALIDITY));
  
          Date expirationDate = getCertExpirationDate();
<span class="udiff-line-added">+         System.out.println(&quot;Cert expiration: &quot; + expirationDate);</span>
  
          // sign jar file
          OutputAnalyzer analyzer = jarsigner(
<span class="udiff-line-modified-removed">-                 &quot;-J-Duser.timezone=&quot; + timezone,</span>
<span class="udiff-line-modified-added">+                 userTimezoneOpt(timezone),</span>
                  &quot;-keystore&quot;, KEYSTORE,
                  &quot;-storepass&quot;, PASSWORD,
                  &quot;-keypass&quot;, PASSWORD,
                  &quot;-signedjar&quot;, SIGNED_JARFILE,
                  UNSIGNED_JARFILE,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -88,11 +94,11 @@</span>
                  expirationDate);
          checkSigning(analyzer, warning);
  
          // verify signed jar
          analyzer = jarsigner(
<span class="udiff-line-modified-removed">-                 &quot;-J-Duser.timezone=&quot; + timezone,</span>
<span class="udiff-line-modified-added">+                 userTimezoneOpt(timezone),</span>
                  &quot;-verify&quot;,
                  &quot;-keystore&quot;, KEYSTORE,
                  &quot;-storepass&quot;, PASSWORD,
                  &quot;-keypass&quot;, PASSWORD,
                  SIGNED_JARFILE,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -101,11 +107,11 @@</span>
          warning = String.format(NO_TIMESTAMP_VERIFYING_WARN_TEMPLATE, expirationDate);
          checkVerifying(analyzer, 0, warning);
  
          // verify signed jar in strict mode
          analyzer = jarsigner(
<span class="udiff-line-modified-removed">-                 &quot;-J-Duser.timezone=&quot; + timezone,</span>
<span class="udiff-line-modified-added">+                 userTimezoneOpt(timezone),</span>
                  &quot;-verify&quot;,
                  &quot;-strict&quot;,
                  &quot;-keystore&quot;, KEYSTORE,
                  &quot;-storepass&quot;, PASSWORD,
                  &quot;-keypass&quot;, PASSWORD,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -115,10 +121,14 @@</span>
          checkVerifying(analyzer, 0, warning);
  
          System.out.println(&quot;Test passed&quot;);
      }
  
<span class="udiff-line-added">+     private static String userTimezoneOpt(String timezone) {</span>
<span class="udiff-line-added">+         return timezone == null ? null : &quot;-J-Duser.timezone=&quot; + timezone;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      private static Date getCertExpirationDate() throws Exception {
          KeyStore ks = KeyStore.getInstance(&quot;JKS&quot;);
          try (InputStream in = new FileInputStream(KEYSTORE)) {
              ks.load(in, PASSWORD.toCharArray());
          }
</pre>
<center><a href="HasUnsignedEntryTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="NotSignedByAliasTest.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>