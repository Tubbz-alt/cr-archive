<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/jdk/sun/security/pkcs12/PBES2Encoding.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 /*
 25  * @test
 26  * @bug 8202837
 27  * @summary PBES2 AlgorithmId encoding error in PKCS12 KeyStore
 28  */
 29 
 30 import java.io.ByteArrayInputStream;
 31 import java.security.KeyStore;
 32 
 33 public class PBES2Encoding {
 34 
 35     // This is a PKCS 12 file using PBES2 to encrypt the cert and key. It is
 36     // generated with these commands:
 37     //
 38     // keytool -keystore ks -genkeypair -storepass changeit -alias a -dname CN=A
 39     // openssl pkcs12 -in ks -nodes -out kandc -passin pass:changeit
 40     // openssl pkcs12 -export -in kandc -out p12 -name a -passout pass:changeit
 41     //         -certpbe AES-128-CBC -keypbe AES-128-CBC
 42 
 43     static final String P12_FILE =
 44             &quot;308208860201033082084c06092a864886f70d010701a082083d048208393082&quot; +
 45             &quot;08353082050406092a864886f70d010706a08204f5308204f1020100308204ea&quot; +
 46             &quot;06092a864886f70d010701304906092a864886f70d01050d303c301b06092a86&quot; +
 47             &quot;4886f70d01050c300e040879e103dcdf95bd3e02020800301d06096086480165&quot; +
 48             &quot;0304010204108afe09885014c1315a431956bf051cd1808204909af1a5964e45&quot; +
 49             &quot;fa24887c963d422500a54576bda5b79beba0a97ec61fd7f68e1d7acca9c7a2ff&quot; +
 50             &quot;fa90cc161d1e930a8315158089ce5e842ae758f63d723bd02b82120e663c2965&quot; +
 51             &quot;a32101d27f268f7101d9b8786ddeeb8ddfa57d63c7b110ad9015b6279f8c5adf&quot; +
 52             &quot;d2a78f82d6641bbb4c363bfe6d5be78993c54a1a52d83acba21f70a70c104c18&quot; +
 53             &quot;1968df3009896fb3af534661a8a3d25a09974adfd6dd587f067fd5a2017f0d34&quot; +
 54             &quot;99ca0dfd9950f555e950ceb3120408fb9b72e3b43020e4cde2f1c7726901328d&quot; +
 55             &quot;78471d7825ce6c9968d9f8e3ae2f2963cfc7d81bd1facfa55f56d711f3568673&quot; +
 56             &quot;6c75bc6ae67beee1a70355bf1daa17aba7cdc4fe35b06881503b7a99d1c3efeb&quot; +
 57             &quot;e036217042e2f7918c038dc5505447acbe84db6ac10527dd65597b25c8d5f68a&quot; +
 58             &quot;349ca4da866b76934aa7c1f4c452b6c45bd97d991c35d3ce63e20342817f7874&quot; +
 59             &quot;40d73d2b3329aafba3c95ed2601d2fc85231f0f1797f7e36ae4ff379af030a09&quot; +
 60             &quot;1d9c476468eff8be50632c706f0308a5e3a307a1929241b8fcd4fef447c6606b&quot; +
 61             &quot;7c45cc01c3dae196b54479d453428c378ec9cdbd45ff514793a91d61d0b230ff&quot; +
 62             &quot;4af62765773e9b51ef2f5965c046b25e7c09b42838b2a19fe5262756a64e7b96&quot; +
 63             &quot;6fa0159f369d6afb9f4486e2cc7e56a9b9d5afdd28e8c0e19ff4cdf2f7904a12&quot; +
 64             &quot;8284201f51dbdfb3fffb2d482764226c8bee83190d99e6bd0bf310eab5501922&quot; +
 65             &quot;aede091d3ee8fc405874a63fc696c577829192c65b70964bf54db87c77fe823b&quot; +
 66             &quot;19a8344275142387926909c39c0008d9111c78d7e296ba74ca448010db327e11&quot; +
 67             &quot;0927fe2029a5fcfde66d6883a26bab78e3dfdb9569a64d117b26e04d627b35b7&quot; +
 68             &quot;3a795eb9e6ea7bd4469403cb8a822831c71bc587d3b81b0ae4ca381df8b6872c&quot; +
 69             &quot;8bea5f8c99be643f34bafe5bac178c5a36a4c8088e0535eda0511326e3b0ae5e&quot; +
 70             &quot;dafde080886fa539f659525d3fcd38468e8c00c05d223d6bd060ef875894f7bc&quot; +
 71             &quot;63e61854fad5f6146959d0447a4714a3b79292890ae52c7aa82075f56386e3d3&quot; +
 72             &quot;fa2d3376156dc2f5811bd1ac2ca97cb1068a22577513e68a7a0116c6268f9146&quot; +
 73             &quot;a718c9e11dad701f3562be8cb9beb3aadd2003b32e3d88afbf178f7a7b5daf09&quot; +
 74             &quot;f5acaad1fe0dd27d7094a522a39ede71e621dc2b25b4e855d9a1853cdfa5f6f7&quot; +
 75             &quot;b4a0e1c7a5eacd4903aef9eae6a1c2df370137830bcf5cae2e96eef2d9934e9d&quot; +
 76             &quot;21e756499370cba32dc923f26915864b2a3cd5b046fad05922ff686f8ccb0b2b&quot; +
 77             &quot;4bce27d4c91a0c4d3fab3fd65eb0327d2435c27bdd789b66cb88fe56c31b1785&quot; +
 78             &quot;b8820a7c07947f3bf0d6d18ab2d334d927a70dad2fcdad31422138bb3ef39a3d&quot; +
 79             &quot;0e66c298e66d38efad20a8e963b98a59e8b6c5d92aea4364c5f720ea9ab6f510&quot; +
 80             &quot;2c5ccad50bcb3b5d3fe1ae2810118af0339a6b980c3e2ff1014675ef3a8ea84c&quot; +
 81             &quot;3a27b18a088979cddaee68cb65761fdeafc1ab766c13ca8c073cadedec3bf7c0&quot; +
 82             &quot;bdc2e91dcbb1295100a3d66838992a19049a7c25ad683c55ed9831cf187dfdba&quot; +
 83             &quot;242c38a9a32b9d023753c31519987f43d57a02b238230e93f8c5f5ab64516ece&quot; +
 84             &quot;eb915dda45ceb7257e87c909a381248a809b30202884b26eac08b53f9de2478f&quot; +
 85             &quot;3b0b410698e44744fbe63082032906092a864886f70d010701a082031a048203&quot; +
 86             &quot;16308203123082030e060b2a864886f70d010c0a0102a08202c3308202bf3049&quot; +
 87             &quot;06092a864886f70d01050d303c301b06092a864886f70d01050c300e040875ea&quot; +
 88             &quot;e60a1bd8525102020800301d060960864801650304010204101c066ab644ec44&quot; +
 89             &quot;506b2accab7458b77f04820270c4f2702354ebcd5eb1bfb82bd22382035a7907&quot; +
 90             &quot;ab5af91d045250ac1d56f95e4b0d944a99bccd266ea4f7402e5c2082f70ac8ff&quot; +
 91             &quot;081242bbd0e9b374eedcafbca01983ca9e324d8850cad4ac43396b1a3250e365&quot; +
 92             &quot;fa01e3882d19a01f017724a90242d0558d75399cf310ac551cd60d92e26bc8b2&quot; +
 93             &quot;7872882b1f41819d1f660f18a0a2825bd81c861e02124c586046a3609f36713b&quot; +
 94             &quot;dcefdc617788032d13268dfb6530205757aba368950041830cbd07ad3ef3987a&quot; +
 95             &quot;5d71c1cf9987be05de696b4191a44f405227c89fc857dfbf956fe0ab1a0d8c02&quot; +
 96             &quot;613773b1234acd9d3c75994ea00883c1686e3e57661d9937c1837770b3dd2874&quot; +
 97             &quot;0ccfcff02d1998cb9907a78b9d95475542cd3e064231f40e425a745dbc5cfec8&quot; +
 98             &quot;30f7b6e935487e68b664d998ddfaa06db44c247a0f012f17099c8bb955827e13&quot; +
 99             &quot;5017b2526bee9a222e70933f6d7b8968dffe4ca033022d4eac85259434d68e89&quot; +
100             &quot;43d3c9e4c516ec88bb81971d6751803aef4afdb01505f81f8f71d3c074ab788f&quot; +
101             &quot;7a5d197c3985488b6acc53c23bef91906f3009c6ec199cc916fcb88876a28727&quot; +
102             &quot;32ee95d59f636d78e597e10a0e305bd1a5ccda8ad9716f0b5e9c8ca9bfa9ee54&quot; +
103             &quot;224c1183d499d063c6c1ec02b7f9a482b8983bcbad6b64eefc77ef961ec4dd02&quot; +
104             &quot;1f832e3c048b9f77034bbd896b7ab13a9f22d7fe94c88626e77b7c0b2d9fac44&quot; +
105             &quot;914bd9c50cc69ef58044ae1cc423eb321bf5ce2c7505df45d21b932c675c0c5b&quot; +
106             &quot;3705328245bc70ac262808519681f94489912a3dea891aab2d3bdc573b6b17cf&quot; +
107             &quot;6bfd8c1a93404a91efaca5441cd2192b71529a543938056382a7f54fabea4760&quot; +
108             &quot;6ef9ea7c8cdd663036e528ae6043ff138354b43b85cf488f3748fb1051313830&quot; +
109             &quot;1106092a864886f70d01091431041e020061302306092a864886f70d01091531&quot; +
110             &quot;160414664fad18d5583599e1cbe7fe694f36237e2272c530313021300906052b&quot; +
111             &quot;0e03021a0500041472658e404aba0df42263cff430397794c379977504084962&quot; +
112             &quot;aeaf211dfa1f02020800&quot;;
113 
114     public static void main(String[] args) throws Exception {
115 
116         byte[] p12 = new byte[P12_FILE.length() / 2];
117         for (int i = 0; i &lt; p12.length; i++) {
118             p12[i] = Integer.valueOf(P12_FILE.substring(2 * i, 2 * i + 2), 16)
119                     .byteValue();
120         }
121 
122         KeyStore ks = KeyStore.getInstance(&quot;pkcs12&quot;);
123         ks.load(new ByteArrayInputStream(p12), &quot;changeit&quot;.toCharArray());
124 
125         // Make sure both cert and key can be retrieved
126         System.out.println(ks.getCertificate(&quot;a&quot;));
127         System.out.println(ks.getKey(&quot;a&quot;, &quot;changeit&quot;.toCharArray()));
128     }
129 }
    </pre>
  </body>
</html>