<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/security/ssl/X509TrustManagerImpl/SelfIssuedCert.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="BasicConstraints.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../rsa/SignatureOffsets.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/security/ssl/X509TrustManagerImpl/SelfIssuedCert.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2009, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 //
 25 // SunJSSE does not support dynamic system properties, no way to re-use
 26 // system properties in samevm/agentvm mode.
 27 //
 28 
 29 /*
 30  * @test
 31  * @bug 6822460
 32  * @summary support self-issued certificate
 33  * @run main/othervm SelfIssuedCert PKIX
 34  * @run main/othervm SelfIssuedCert SunX509
 35  * @author Xuelei Fan
 36  */
 37 
<span class="line-removed"> 38 import java.net.*;</span>
<span class="line-removed"> 39 import java.util.*;</span>
 40 import java.io.*;
 41 import javax.net.ssl.*;
<span class="line-removed"> 42 import java.security.Security;</span>
 43 import java.security.KeyStore;
 44 import java.security.KeyFactory;
 45 import java.security.cert.Certificate;
 46 import java.security.cert.CertificateFactory;
 47 import java.security.spec.*;
 48 import java.security.interfaces.*;
<span class="line-removed"> 49 import java.math.BigInteger;</span>
 50 
 51 import java.util.Base64;
 52 
 53 public class SelfIssuedCert {
 54 
 55     /*
 56      * =============================================================
 57      * Set the various variables needed for the tests, then
 58      * specify what tests to run on each side.
 59      */
 60 
 61     /*
 62      * Should we run the client or server in a separate thread?
 63      * Both sides can throw exceptions, but do you have a preference
 64      * as to which side should be the main thread.
 65      */
 66     static boolean separateServerThread = true;
 67 
 68     /*
 69      * Where do we find the keystores?
 70      */
 71     // Certificate information:
 72     // Issuer: C=US, O=Example, CN=localhost
 73     // Validity
<span class="line-modified"> 74     //     Not Before: May 25 00:35:58 2009 GMT</span>
<span class="line-modified"> 75     //     Not After : May  5 00:35:58 2030 GMT</span>
 76     // Subject: C=US, O=Example, CN=localhost
 77     // X509v3 Subject Key Identifier:
<span class="line-modified"> 78     //     56:AB:FE:15:4C:9C:4A:70:90:DC:0B:9B:EB:BE:DC:03:CC:7F:CE:CF</span>
 79     // X509v3 Authority Key Identifier:
<span class="line-modified"> 80     //     keyid:56:AB:FE:15:4C:9C:4A:70:90:DC:0B:9B:EB:BE:DC:03:CC:7F:CE:CF</span>
<span class="line-removed"> 81     //     DirName:/C=US/O=Example/CN=localhost</span>
<span class="line-removed"> 82     //     serial:00</span>
 83     static String trusedCertStr =
 84         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified"> 85         &quot;MIICejCCAeOgAwIBAgIBADANBgkqhkiG9w0BAQQFADAzMQswCQYDVQQGEwJVUzEQ\n&quot; +</span>
<span class="line-modified"> 86         &quot;MA4GA1UEChMHRXhhbXBsZTESMBAGA1UEAxMJbG9jYWxob3N0MB4XDTA5MDUyNTAw\n&quot; +</span>
<span class="line-modified"> 87         &quot;MDQ0M1oXDTMwMDUwNTAwMDQ0M1owMzELMAkGA1UEBhMCVVMxEDAOBgNVBAoTB0V4\n&quot; +</span>
<span class="line-modified"> 88         &quot;YW1wbGUxEjAQBgNVBAMTCWxvY2FsaG9zdDCBnzANBgkqhkiG9w0BAQEFAAOBjQAw\n&quot; +</span>
<span class="line-modified"> 89         &quot;gYkCgYEA0Wvh3FHYGQ3vvw59yTjUxT6QuY0fzwCGQTM9evXr/V9+pjWmaTkNDW+7\n&quot; +</span>
<span class="line-modified"> 90         &quot;S/LErlWz64gOWTgcMZN162sVgx4ct/q27brY+SlUO5eSud1fSac6SfefhOPBa965\n&quot; +</span>
<span class="line-modified"> 91         &quot;Xc4mnpDt5sgQPMDCuFK7Le6A+/S9J42BO2WYmNcmvcwWWrv+ehcCAwEAAaOBnTCB\n&quot; +</span>
<span class="line-modified"> 92         &quot;mjAdBgNVHQ4EFgQUq3q5fYEibdvLpab+JY4pmifj2vYwWwYDVR0jBFQwUoAUq3q5\n&quot; +</span>
<span class="line-modified"> 93         &quot;fYEibdvLpab+JY4pmifj2vahN6Q1MDMxCzAJBgNVBAYTAlVTMRAwDgYDVQQKEwdF\n&quot; +</span>
<span class="line-modified"> 94         &quot;eGFtcGxlMRIwEAYDVQQDEwlsb2NhbGhvc3SCAQAwDwYDVR0TAQH/BAUwAwEB/zAL\n&quot; +</span>
<span class="line-modified"> 95         &quot;BgNVHQ8EBAMCAgQwDQYJKoZIhvcNAQEEBQADgYEAHL8BSwtX6s8WPPG2FbQBX+K8\n&quot; +</span>
<span class="line-modified"> 96         &quot;GquAyQNtgfJNm60B4i+fVBkJiQJtLmE0emvHx/3sIaHmB0Gd0HKnk/cIQXY304vr\n&quot; +</span>
<span class="line-modified"> 97         &quot;QpqwudKcIZuzmj+pa7807joV+WzRDVIlt4HpYg7tiUvEoyw+X8jwY2lgiGR7mWu6\n&quot; +</span>
<span class="line-modified"> 98         &quot;jQU8PN/06+qgtvSGFpo=\n&quot; +</span>




 99         &quot;-----END CERTIFICATE-----&quot;;
100 
101     // Certificate information:
102     // Issuer: C=US, O=Example, CN=localhost
103     // Validity
<span class="line-modified">104     //     Not Before: May 25 00:35:58 2009 GMT</span>
<span class="line-modified">105     //     Not After : May  5 00:35:58 2030 GMT</span>
106     // Subject: C=US, O=Example, CN=localhost
107     // X509v3 Subject Key Identifier:
<span class="line-modified">108     //     0D:30:76:22:D6:9D:75:EF:FD:83:50:31:18:08:83:CD:01:4E:6A:C4</span>
109     // X509v3 Authority Key Identifier:
<span class="line-modified">110     //     keyid:56:AB:FE:15:4C:9C:4A:70:90:DC:0B:9B:EB:BE:DC:03:CC:7F:CE:CF</span>
<span class="line-removed">111     //     DirName:/C=US/O=Example/CN=localhost</span>
<span class="line-removed">112     //     serial:00</span>
113     static String targetCertStr =
114         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">115         &quot;MIICaTCCAdKgAwIBAgIBAjANBgkqhkiG9w0BAQQFADAzMQswCQYDVQQGEwJVUzEQ\n&quot; +</span>
<span class="line-modified">116         &quot;MA4GA1UEChMHRXhhbXBsZTESMBAGA1UEAxMJbG9jYWxob3N0MB4XDTA5MDUyNTAw\n&quot; +</span>
<span class="line-modified">117         &quot;MDQ0M1oXDTI5MDIwOTAwMDQ0M1owMzELMAkGA1UEBhMCVVMxEDAOBgNVBAoTB0V4\n&quot; +</span>
<span class="line-modified">118         &quot;YW1wbGUxEjAQBgNVBAMTCWxvY2FsaG9zdDCBnzANBgkqhkiG9w0BAQEFAAOBjQAw\n&quot; +</span>
<span class="line-modified">119         &quot;gYkCgYEAzmPahrH9LTQv3HEWsua+hIpzyU1ACooSd5BtDjc7XnVzSdGW8QD9R8EA\n&quot; +</span>
<span class="line-modified">120         &quot;xko7TvfJo6IH6wwgHBspySwsl+6xvHhbwQjgtWlT71ksrUbqcUzmvSvcycQYA8RC\n&quot; +</span>
<span class="line-modified">121         &quot;yk9HK5pEJQgSxldpR3Kmy0V6CHC4dCm15trnJYWisTuezY3fjXECAwEAAaOBjDCB\n&quot; +</span>
<span class="line-modified">122         &quot;iTAdBgNVHQ4EFgQUQkiWFRkjKsfwFo7UMQfGEzNNW60wWwYDVR0jBFQwUoAUq3q5\n&quot; +</span>
<span class="line-modified">123         &quot;fYEibdvLpab+JY4pmifj2vahN6Q1MDMxCzAJBgNVBAYTAlVTMRAwDgYDVQQKEwdF\n&quot; +</span>
<span class="line-modified">124         &quot;eGFtcGxlMRIwEAYDVQQDEwlsb2NhbGhvc3SCAQAwCwYDVR0PBAQDAgPoMA0GCSqG\n&quot; +</span>
<span class="line-modified">125         &quot;SIb3DQEBBAUAA4GBAIMz7c1R+6KEO7FmH4rnv9XE62xkg03ff0vKXLZMjjs0CX2z\n&quot; +</span>
<span class="line-modified">126         &quot;ybRttuTFafHA6/JS+Wz0G83FCRVeiw2WPU6BweMwwejzzIrQ/K6mbp6w6sRFcbNa\n&quot; +</span>
<span class="line-modified">127         &quot;eLBtzkjEtI/htOSSq3/0mbKmWn5uVJckO4QiB8kUR4F7ngM9l1uuI46ZfUsk\n&quot; +</span>





128         &quot;-----END CERTIFICATE-----&quot;;
129 
130     // Private key in the format of PKCS#8
131     static String targetPrivateKey =
<span class="line-modified">132         &quot;MIICeQIBADANBgkqhkiG9w0BAQEFAASCAmMwggJfAgEAAoGBAM5j2oax/S00L9xx\n&quot; +</span>
<span class="line-modified">133         &quot;FrLmvoSKc8lNQAqKEneQbQ43O151c0nRlvEA/UfBAMZKO073yaOiB+sMIBwbKcks\n&quot; +</span>
<span class="line-modified">134         &quot;LJfusbx4W8EI4LVpU+9ZLK1G6nFM5r0r3MnEGAPEQspPRyuaRCUIEsZXaUdypstF\n&quot; +</span>
<span class="line-modified">135         &quot;eghwuHQpteba5yWForE7ns2N341xAgMBAAECgYEAgZ8k98OBhopoJMLBxso0jXmH\n&quot; +</span>
<span class="line-modified">136         &quot;Dr59oiDlSEJku7DkkIajSZFggyxj5lTI78BfT1FASozQ/EY5RG2q6LXdq+41oU/U\n&quot; +</span>
<span class="line-modified">137         &quot;JVEQWhdIE1mQDwE0vgaYdjzMaVIsC3cZYOCOmCYvNxCiTt7e/z8yBMmAE5udqJMB\n&quot; +</span>
<span class="line-modified">138         &quot;pim4WXDfpy0ssK81oCECQQDwMC4xu+kn0yD/Qyi9Zn26gIRDv4bjzDQoJfSvMhrY\n&quot; +</span>
<span class="line-modified">139         &quot;a4duxLzh9u4gCDd0+wHxpPQvNxGCk0c1JUxBJ2rb4G3HAkEA2/oVRV6+xiRXUnoo\n&quot; +</span>
<span class="line-modified">140         &quot;bdPEO27zEJmdpE42yU/JLIy6DPu2IUhEqY45fU2ZERmwMdhpiK/vsf/CZKJ2j/ZU\n&quot; +</span>
<span class="line-modified">141         &quot;PdMLBwJBAJIYTFDWAqjFpCGAASzLRZiGiW0H941h7Suqgp159ZhEN5mps1Yis47q\n&quot; +</span>
<span class="line-modified">142         &quot;UIkoEHOiKSD69vychsiNykcrKbVaWosCQQC1UrYX4Vo1r5z/EkyjAwzcxL68rzM/\n&quot; +</span>
<span class="line-modified">143         &quot;TW1hkU/NVg7CRvXBB3X5oY+H1t/WNauD2tRa5FMbESwmkbhTQIP+FikfAkEA4goD\n&quot; +</span>
<span class="line-modified">144         &quot;HCxUn0Z1OQq9QL6y1Yoof6sHxicUwABosuCLJnDJmA5vhpemvdXQTzFII8g1hyQf\n&quot; +</span>
<span class="line-modified">145         &quot;z1yyDoxhddcleKlJvQ==&quot;;</span>












146 
147     static char passphrase[] = &quot;passphrase&quot;.toCharArray();
148 
149     /*
150      * Is the server ready to serve?
151      */
152     volatile static boolean serverReady = false;
153 
154     /*
155      * Turn on SSL debugging?
156      */
157     static boolean debug = false;
158 
159     /*
160      * Define the server side of the test.
161      *
162      * If the server prematurely exits, serverReady will be set to true
163      * to avoid infinite hangs.
164      */
165     void doServerSide() throws Exception {
</pre>
<hr />
<pre>
192 
193     /*
194      * Define the client side of the test.
195      *
196      * If the server prematurely exits, serverReady will be set to true
197      * to avoid infinite hangs.
198      */
199     void doClientSide() throws Exception {
200         /*
201          * Wait for server to get started.
202          */
203         while (!serverReady) {
204             Thread.sleep(50);
205         }
206 
207         SSLContext context = getSSLContext(trusedCertStr, null, null);
208         SSLSocketFactory sslsf = context.getSocketFactory();
209 
210         SSLSocket sslSocket =
211             (SSLSocket)sslsf.createSocket(&quot;localhost&quot;, serverPort);
<span class="line-removed">212         sslSocket.setEnabledProtocols(new String[] { &quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot; });</span>
213 
214         InputStream sslIS = sslSocket.getInputStream();
215         OutputStream sslOS = sslSocket.getOutputStream();
216 
217         sslOS.write(280);
218         sslOS.flush();
219         sslIS.read();
220 
221         sslSocket.close();
222     }
223 
224     // get the ssl context
225     private static SSLContext getSSLContext(String trusedCertStr,
226             String keyCertStr, String keySpecStr) throws Exception {
227 
228         // generate certificate from cert string
229         CertificateFactory cf = CertificateFactory.getInstance(&quot;X.509&quot;);
230 
231         // create a key store
232         KeyStore ks = KeyStore.getInstance(&quot;JKS&quot;);
</pre>
<hr />
<pre>
289     }
290 
291     private static String tmAlgorithm;        // trust manager
292 
293     private static void parseArguments(String[] args) {
294         tmAlgorithm = args[0];
295     }
296 
297     /*
298      * =============================================================
299      * The remainder is just support stuff
300      */
301 
302     // use any free port by default
303     volatile int serverPort = 0;
304 
305     volatile Exception serverException = null;
306     volatile Exception clientException = null;
307 
308     public static void main(String args[]) throws Exception {
<span class="line-removed">309         // MD5 is used in this test case, don&#39;t disable MD5 algorithm.</span>
<span class="line-removed">310         Security.setProperty(&quot;jdk.certpath.disabledAlgorithms&quot;,</span>
<span class="line-removed">311                 &quot;MD2, RSA keySize &lt; 1024&quot;);</span>
<span class="line-removed">312         Security.setProperty(&quot;jdk.tls.disabledAlgorithms&quot;,</span>
<span class="line-removed">313                 &quot;SSLv3, RC4, DH keySize &lt; 768&quot;);</span>
<span class="line-removed">314 </span>
315         if (debug)
316             System.setProperty(&quot;javax.net.debug&quot;, &quot;all&quot;);
317 
<span class="line-removed">318 </span>
319         /*
320          * Get the customized arguments.
321          */
322         parseArguments(args);
323 
324         /*
325          * Start the tests.
326          */
327         new SelfIssuedCert();
328     }
329 
330     Thread clientThread = null;
331     Thread serverThread = null;
332     /*
333      * Primary constructor, used to drive remainder of the test.
334      *
335      * Fork off the other side, then do your work.
336      */
337     SelfIssuedCert() throws Exception {
338         if (separateServerThread) {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2009, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 //
 25 // SunJSSE does not support dynamic system properties, no way to re-use
 26 // system properties in samevm/agentvm mode.
 27 //
 28 
 29 /*
 30  * @test
 31  * @bug 6822460
 32  * @summary support self-issued certificate
 33  * @run main/othervm SelfIssuedCert PKIX
 34  * @run main/othervm SelfIssuedCert SunX509
 35  * @author Xuelei Fan
 36  */
 37 


 38 import java.io.*;
 39 import javax.net.ssl.*;

 40 import java.security.KeyStore;
 41 import java.security.KeyFactory;
 42 import java.security.cert.Certificate;
 43 import java.security.cert.CertificateFactory;
 44 import java.security.spec.*;
 45 import java.security.interfaces.*;

 46 
 47 import java.util.Base64;
 48 
 49 public class SelfIssuedCert {
 50 
 51     /*
 52      * =============================================================
 53      * Set the various variables needed for the tests, then
 54      * specify what tests to run on each side.
 55      */
 56 
 57     /*
 58      * Should we run the client or server in a separate thread?
 59      * Both sides can throw exceptions, but do you have a preference
 60      * as to which side should be the main thread.
 61      */
 62     static boolean separateServerThread = true;
 63 
 64     /*
 65      * Where do we find the keystores?
 66      */
 67     // Certificate information:
 68     // Issuer: C=US, O=Example, CN=localhost
 69     // Validity
<span class="line-modified"> 70     //     Not Before: Dec 19 06:11:58 2019 GMT</span>
<span class="line-modified"> 71     //     Not After : Dec 16 06:11:58 2029 GMT</span>
 72     // Subject: C=US, O=Example, CN=localhost
 73     // X509v3 Subject Key Identifier:
<span class="line-modified"> 74     //     80:67:BA:EE:10:6A:E3:8E:3E:8E:F7:2D:90:B6:FD:F9:54:87:47:B1</span>
 75     // X509v3 Authority Key Identifier:
<span class="line-modified"> 76     //     keyid:80:67:BA:EE:10:6A:E3:8E:3E:8E:F7:2D:90:B6:FD:F9:54:87:47:B1</span>


 77     static String trusedCertStr =
 78         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified"> 79         &quot;MIIDRzCCAi+gAwIBAgIUFjy13iZYWMGQcGF4svfix/9q4dcwDQYJKoZIhvcNAQEL\n&quot; +</span>
<span class="line-modified"> 80         &quot;BQAwMzELMAkGA1UEBhMCVVMxEDAOBgNVBAoMB0V4YW1wbGUxEjAQBgNVBAMMCWxv\n&quot; +</span>
<span class="line-modified"> 81         &quot;Y2FsaG9zdDAeFw0xOTEyMTkwNjExNThaFw0yOTEyMTYwNjExNThaMDMxCzAJBgNV\n&quot; +</span>
<span class="line-modified"> 82         &quot;BAYTAlVTMRAwDgYDVQQKDAdFeGFtcGxlMRIwEAYDVQQDDAlsb2NhbGhvc3QwggEi\n&quot; +</span>
<span class="line-modified"> 83         &quot;MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCy57BG8Dt+a4ZwWGM07f0z/mzK\n&quot; +</span>
<span class="line-modified"> 84         &quot;T/myXM4W//3pkZxO0+4oyYM7G8ks9O64NPpA0CpTPCpfY6dI1Y/kwBUdSoqx2D8t\n&quot; +</span>
<span class="line-modified"> 85         &quot;OEfHOat2/AQvvWmEChFH4ZmmQFkLXBy0ueDq0TJbEd94+WhL3q9bA4uqvBsuuaTt\n&quot; +</span>
<span class="line-modified"> 86         &quot;bX/GyOC52bpjg0TWY4BRdRVhveISZvqOCoqqJ1aPOnfxqySaZIC34q9gdUCUNxZD\n&quot; +</span>
<span class="line-modified"> 87         &quot;qjhuQF3Q0xYsNGZSUmnKj3/0GS600BwQPqSHy287Vda88NvqJGFS4DKrw3HV3Wsk\n&quot; +</span>
<span class="line-modified"> 88         &quot;IHGN+tzB5THBy70XrE+XIdXJ/I86q+FvNcTnJygn2nVNG4+vUhW8S3BzTiKPAgMB\n&quot; +</span>
<span class="line-modified"> 89         &quot;AAGjUzBRMB0GA1UdDgQWBBSAZ7ruEGrjjj6O9y2Qtv35VIdHsTAfBgNVHSMEGDAW\n&quot; +</span>
<span class="line-modified"> 90         &quot;gBSAZ7ruEGrjjj6O9y2Qtv35VIdHsTAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3\n&quot; +</span>
<span class="line-modified"> 91         &quot;DQEBCwUAA4IBAQBX7icKmR/iUPJhfnvNHiqsyTIcowY3JSAJAyJFrViKx2tdo+qq\n&quot; +</span>
<span class="line-modified"> 92         &quot;yA+EUsZlZsCwhiiG4/SjFxgaAp0Z3BBmsO/njWUEx3/fSufTHcs0+fPNkFLru5Lr\n&quot; +</span>
<span class="line-added"> 93         &quot;das4wW9Cv/wO4rz2L6qK/x7+r/wkPccaqxTpdZvXqDid2va5Lv3F7jOW5ns13piZ\n&quot; +</span>
<span class="line-added"> 94         &quot;z571RCpmhGSytYKFrAOGoI4ZBWXrkCiYQZ8KvhdBQP/MNJM+e6ajtF27rK08XTao\n&quot; +</span>
<span class="line-added"> 95         &quot;mW3FXfK6SjKQDGVwtNJ7M1qGutIpe0pNBGwvDpQuY2mk0Le46OXdaQ7AAzE+OnRJ\n&quot; +</span>
<span class="line-added"> 96         &quot;1uRDV+p95MzhtolPgB3I8Rzyd23nfrx6uxMA\n&quot; +</span>
 97         &quot;-----END CERTIFICATE-----&quot;;
 98 
 99     // Certificate information:
100     // Issuer: C=US, O=Example, CN=localhost
101     // Validity
<span class="line-modified">102     //     Not Before: Dec 19 06:12:04 2019 GMT</span>
<span class="line-modified">103     //     Not After : Dec 16 06:12:04 2029 GMT</span>
104     // Subject: C=US, O=Example, CN=localhost
105     // X509v3 Subject Key Identifier:
<span class="line-modified">106     //     73:79:B7:73:F5:41:BB:3A:90:07:87:F2:CA:A5:B3:C3:45:E0:18:E0</span>
107     // X509v3 Authority Key Identifier:
<span class="line-modified">108     //     keyid:80:67:BA:EE:10:6A:E3:8E:3E:8E:F7:2D:90:B6:FD:F9:54:87:47:B1</span>


109     static String targetCertStr =
110         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">111         &quot;MIIDNjCCAh6gAwIBAgIURM+bID1TFw41Z/Vz9tPp7HzpH7QwDQYJKoZIhvcNAQEL\n&quot; +</span>
<span class="line-modified">112         &quot;BQAwMzELMAkGA1UEBhMCVVMxEDAOBgNVBAoMB0V4YW1wbGUxEjAQBgNVBAMMCWxv\n&quot; +</span>
<span class="line-modified">113         &quot;Y2FsaG9zdDAeFw0xOTEyMTkwNjEyMDRaFw0yOTEyMTYwNjEyMDRaMDMxCzAJBgNV\n&quot; +</span>
<span class="line-modified">114         &quot;BAYTAlVTMRAwDgYDVQQKDAdFeGFtcGxlMRIwEAYDVQQDDAlsb2NhbGhvc3QwggEi\n&quot; +</span>
<span class="line-modified">115         &quot;MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCtxQXQdTlZNoASIE0TM+tgtUY3\n&quot; +</span>
<span class="line-modified">116         &quot;jnu0EymO+RGljOIFYhz2MxN0OQ5ABofxdIhbSqtoCO9HbsVWIPKOvbACoAJ4HjTV\n&quot; +</span>
<span class="line-modified">117         &quot;antLPlvCqbUoR96q6JWbnbQ6uZOsgiQTveQMhLJ+k9BehzcwKvwCFGNY3qW0xwUv\n&quot; +</span>
<span class="line-modified">118         &quot;mXKWRveRAbTOjZ3i1YzcmkLOwYaeyt2Al3jPCbZySUlB94NRRAQZ4RzqfuetAvEd\n&quot; +</span>
<span class="line-modified">119         &quot;LFW1fXNwL5bHE7JbJkWInciLOqHf5GuyXDjKE8Oz2/Ywv/5C2K2LtWa1g5jIEQtB\n&quot; +</span>
<span class="line-modified">120         &quot;cjRa9Cjwcrs8peisC5OmL5cbJweNKr6H0mrVR8KFdFHUmM5X4uSiOMVFr/rTAgMB\n&quot; +</span>
<span class="line-modified">121         &quot;AAGjQjBAMB0GA1UdDgQWBBRzebdz9UG7OpAHh/LKpbPDReAY4DAfBgNVHSMEGDAW\n&quot; +</span>
<span class="line-modified">122         &quot;gBSAZ7ruEGrjjj6O9y2Qtv35VIdHsTANBgkqhkiG9w0BAQsFAAOCAQEAZ/Ijlics\n&quot; +</span>
<span class="line-modified">123         &quot;YGCw9k4he3ZkNfqCPFTJKgkbTuM1Cy+aCXzhhdGKCZ2R0Xyi3ma3snwPtqHy5Aru\n&quot; +</span>
<span class="line-added">124         &quot;WwoGssxL6S8+Pb/BPZ9OelU7lEmS69AeBKOHHIEs+wEi2oco8J+WU1O4zekP8Clv\n&quot; +</span>
<span class="line-added">125         &quot;hHuwPhoL6g0aAUXAISaqYpHYC15oXGOJcC539kgv4VrL9UZJekxtDERUXKyzW+UC\n&quot; +</span>
<span class="line-added">126         &quot;ZBPalts1zM5wD43+9PuoeLiPdvMg1kH4obJYnj23zej41iwqPOWhgm0NuGoJVjSg\n&quot; +</span>
<span class="line-added">127         &quot;4YqtS1ePD/I2oRV0bu4P7Q72cMYdcFHfPDoe3vCcEMxUTgGBaoPHw9GwEeRoWn/L\n&quot; +</span>
<span class="line-added">128         &quot;whBwzXBsD0aZqQ==\n&quot; +</span>
129         &quot;-----END CERTIFICATE-----&quot;;
130 
131     // Private key in the format of PKCS#8
132     static String targetPrivateKey =
<span class="line-modified">133         &quot;MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCtxQXQdTlZNoAS\n&quot; +</span>
<span class="line-modified">134         &quot;IE0TM+tgtUY3jnu0EymO+RGljOIFYhz2MxN0OQ5ABofxdIhbSqtoCO9HbsVWIPKO\n&quot; +</span>
<span class="line-modified">135         &quot;vbACoAJ4HjTVantLPlvCqbUoR96q6JWbnbQ6uZOsgiQTveQMhLJ+k9BehzcwKvwC\n&quot; +</span>
<span class="line-modified">136         &quot;FGNY3qW0xwUvmXKWRveRAbTOjZ3i1YzcmkLOwYaeyt2Al3jPCbZySUlB94NRRAQZ\n&quot; +</span>
<span class="line-modified">137         &quot;4RzqfuetAvEdLFW1fXNwL5bHE7JbJkWInciLOqHf5GuyXDjKE8Oz2/Ywv/5C2K2L\n&quot; +</span>
<span class="line-modified">138         &quot;tWa1g5jIEQtBcjRa9Cjwcrs8peisC5OmL5cbJweNKr6H0mrVR8KFdFHUmM5X4uSi\n&quot; +</span>
<span class="line-modified">139         &quot;OMVFr/rTAgMBAAECggEAIFDvz+C9FZZJIxXWv6d8MrQDpvlckBSwOeKgIYWd0xp4\n&quot; +</span>
<span class="line-modified">140         &quot;AGFnUMn7mHSee40Mfs3YKrTeqw4yrN3bvigQv6w6SVR0xuvSmh+yuPUOt7sF8grn\n&quot; +</span>
<span class="line-modified">141         &quot;J9WgWvuANyjMxM8fxiQ3fcrHiYzj+pVD4K8h+rkNYB1THZMP+FqiV9lVYsR7hF+b\n&quot; +</span>
<span class="line-modified">142         &quot;1D967LB4oLmAaMExaSo23NZLGVTxZSxxGw6Qidz7CyKvIdVXnNIEzMnuXX60xiJm\n&quot; +</span>
<span class="line-modified">143         &quot;PnLyZUKDmlw5kI4KaDG+6OIOpDu2FGCFVLZmycs4Ri6h6xJp3jhKAVjCcZJUty80\n&quot; +</span>
<span class="line-modified">144         &quot;+rBfAx4BHfDrcgyEiTN7NA8gnnCzUc6uX6I/tm62gQKBgQDniWuFjSzhaAhj04+N\n&quot; +</span>
<span class="line-modified">145         &quot;vG8sQjfVmTbON6SfFfujR/Z57qamJ8zcS/REHfc5swdn9uUTJ2xoRRNCwKZyuMXo\n&quot; +</span>
<span class="line-modified">146         &quot;4B2/O9+sKfEPYGyjAyGo6E4rGLRNcw6Tb8hx/EFvfTOunwapynOJDDs2Z6FzWNIx\n&quot; +</span>
<span class="line-added">147         &quot;x4+FHs9hStwL/OTdXF/OY2vGsQKBgQDAIR93LrCC6OpGi89/UDIwpT9pFLa8cvpr\n&quot; +</span>
<span class="line-added">148         &quot;1MUNlHhcxQusPUgWT4pTucF/SQpPf77g3YNb5pt3DG0GELM8YAB0Uv9oZIWfJoFY\n&quot; +</span>
<span class="line-added">149         &quot;ebYy6tMVxhHhT0OuryMj48BMHnQG78hq8+c0NnjK7jXV6t0iKjN8ANnFqAovm+U9\n&quot; +</span>
<span class="line-added">150         &quot;VMobar5CwwKBgFCKN9GsCxmZg5meBQiLrKxbmGp/slXHe0cvcWoZ5T4C6wtPOu7C\n&quot; +</span>
<span class="line-added">151         &quot;qQRs3AvBH+llM8gW5ZnbtVh6BSxQ498e3pof7K1JpaXwp7mIpFPKAy7wl/9872wP\n&quot; +</span>
<span class="line-added">152         &quot;7UzhL63lgm3SuZGkb84TaCGDqOCj2/Ie9eibkA3K6YJuBPqPYHA9m0bxAoGARdcE\n&quot; +</span>
<span class="line-added">153         &quot;iB9pvHyMRM6nw8DULciz7y+/aWtmSnJSmyggRKDAKIEyRiHtx5eblfhoDhQCv9zl\n&quot; +</span>
<span class="line-added">154         &quot;1i9SzgivTOgfL1A6eg59l2YLCJpHpHDB4WppBt40O7HDialSXcZ5bXIYfTkGopI8\n&quot; +</span>
<span class="line-added">155         &quot;tkciy6mh2jwA3F14z5fDkc0OvtWtlAjRWvwHY18CgYAPONVJtVFiMogBU5Iyv1LB\n&quot; +</span>
<span class="line-added">156         &quot;oygn6AFvTI8Pjy2g5GsJBbRnKFjAJrP7HpgUxLdW+Mlnv3Xgtr/L6ep+VKoXTEwv\n&quot; +</span>
<span class="line-added">157         &quot;Y83gliDwG2YRjaUbkMfQqcm20/Pi4XPwhy5pwTVsXVBfzKzqJjKAFk97BD9xCUIH\n&quot; +</span>
<span class="line-added">158         &quot;FOGe+jaEsWvaEQrH5y17FQ==&quot;;</span>
159 
160     static char passphrase[] = &quot;passphrase&quot;.toCharArray();
161 
162     /*
163      * Is the server ready to serve?
164      */
165     volatile static boolean serverReady = false;
166 
167     /*
168      * Turn on SSL debugging?
169      */
170     static boolean debug = false;
171 
172     /*
173      * Define the server side of the test.
174      *
175      * If the server prematurely exits, serverReady will be set to true
176      * to avoid infinite hangs.
177      */
178     void doServerSide() throws Exception {
</pre>
<hr />
<pre>
205 
206     /*
207      * Define the client side of the test.
208      *
209      * If the server prematurely exits, serverReady will be set to true
210      * to avoid infinite hangs.
211      */
212     void doClientSide() throws Exception {
213         /*
214          * Wait for server to get started.
215          */
216         while (!serverReady) {
217             Thread.sleep(50);
218         }
219 
220         SSLContext context = getSSLContext(trusedCertStr, null, null);
221         SSLSocketFactory sslsf = context.getSocketFactory();
222 
223         SSLSocket sslSocket =
224             (SSLSocket)sslsf.createSocket(&quot;localhost&quot;, serverPort);

225 
226         InputStream sslIS = sslSocket.getInputStream();
227         OutputStream sslOS = sslSocket.getOutputStream();
228 
229         sslOS.write(280);
230         sslOS.flush();
231         sslIS.read();
232 
233         sslSocket.close();
234     }
235 
236     // get the ssl context
237     private static SSLContext getSSLContext(String trusedCertStr,
238             String keyCertStr, String keySpecStr) throws Exception {
239 
240         // generate certificate from cert string
241         CertificateFactory cf = CertificateFactory.getInstance(&quot;X.509&quot;);
242 
243         // create a key store
244         KeyStore ks = KeyStore.getInstance(&quot;JKS&quot;);
</pre>
<hr />
<pre>
301     }
302 
303     private static String tmAlgorithm;        // trust manager
304 
305     private static void parseArguments(String[] args) {
306         tmAlgorithm = args[0];
307     }
308 
309     /*
310      * =============================================================
311      * The remainder is just support stuff
312      */
313 
314     // use any free port by default
315     volatile int serverPort = 0;
316 
317     volatile Exception serverException = null;
318     volatile Exception clientException = null;
319 
320     public static void main(String args[]) throws Exception {






321         if (debug)
322             System.setProperty(&quot;javax.net.debug&quot;, &quot;all&quot;);
323 

324         /*
325          * Get the customized arguments.
326          */
327         parseArguments(args);
328 
329         /*
330          * Start the tests.
331          */
332         new SelfIssuedCert();
333     }
334 
335     Thread clientThread = null;
336     Thread serverThread = null;
337     /*
338      * Primary constructor, used to drive remainder of the test.
339      *
340      * Fork off the other side, then do your work.
341      */
342     SelfIssuedCert() throws Exception {
343         if (separateServerThread) {
</pre>
</td>
</tr>
</table>
<center><a href="BasicConstraints.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../rsa/SignatureOffsets.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>