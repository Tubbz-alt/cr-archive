<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sun/security/ssl/X509TrustManagerImpl/BasicConstraints.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../SSLSocketImpl/NoImpactServerRenego.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SelfIssuedCert.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sun/security/ssl/X509TrustManagerImpl/BasicConstraints.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 //
 25 // SunJSSE does not support dynamic system properties, no way to re-use
 26 // system properties in samevm/agentvm mode.
 27 //
 28 
 29 /*
 30  * @test
 31  * @bug 7166570
 32  * @summary JSSE certificate validation has started to fail for
 33  *     certificate chains
 34  * @run main/othervm BasicConstraints PKIX
 35  * @run main/othervm BasicConstraints SunX509
 36  */
 37 
<span class="line-removed"> 38 import java.net.*;</span>
 39 import java.util.*;
 40 import java.io.*;
 41 import javax.net.ssl.*;
<span class="line-removed"> 42 import java.security.Security;</span>
 43 import java.security.KeyStore;
 44 import java.security.KeyFactory;
 45 import java.security.cert.*;
 46 import java.security.spec.*;
 47 import java.security.interfaces.*;
<span class="line-removed"> 48 import java.math.BigInteger;</span>
 49 
 50 import java.util.Base64;
 51 
 52 public class BasicConstraints {
 53 
 54     /*
 55      * =============================================================
 56      * Set the various variables needed for the tests, then
 57      * specify what tests to run on each side.
 58      */
 59 
 60     /*
 61      * Should we run the client or server in a separate thread?
 62      * Both sides can throw exceptions, but do you have a preference
 63      * as to which side should be the main thread.
 64      */
 65     static boolean separateServerThread = true;
 66 
 67     /*
 68      * Where do we find the keystores?
 69      */
 70     // Certificate information:
 71     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce
 72     // Validity
<span class="line-modified"> 73     //     Not Before: May  5 02:40:50 2012 GMT</span>
<span class="line-modified"> 74     //     Not After : Apr 15 02:40:50 2033 GMT</span>
 75     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce
 76     // X509v3 Subject Key Identifier:
<span class="line-modified"> 77     //     DD:4E:8D:2A:11:C0:83:03:F0:AC:EB:A2:BF:F9:F2:7D:C8:69:1F:9B</span>
 78     // X509v3 Authority Key Identifier:
<span class="line-modified"> 79     //     keyid:DD:4E:8D:2A:11:C0:83:03:F0:AC:EB:A2:BF:F9:F2:7D:C8:69:1F:9B</span>
<span class="line-removed"> 80     //     DirName:/C=US/O=Java/OU=SunJSSE Test Serivce</span>
<span class="line-removed"> 81     //     serial:00</span>
 82     static String trusedCertStr =
 83         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified"> 84         &quot;MIICkjCCAfugAwIBAgIBADANBgkqhkiG9w0BAQIFADA7MQswCQYDVQQGEwJVUzEN\n&quot; +</span>
<span class="line-modified"> 85         &quot;MAsGA1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNTRSBUZXN0IFNlcml2Y2UwHhcN\n&quot; +</span>
<span class="line-modified"> 86         &quot;MTIwNTA1MDI0MDUwWhcNMzMwNDE1MDI0MDUwWjA7MQswCQYDVQQGEwJVUzENMAsG\n&quot; +</span>
<span class="line-modified"> 87         &quot;A1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNTRSBUZXN0IFNlcml2Y2UwgZ8wDQYJ\n&quot; +</span>
<span class="line-modified"> 88         &quot;KoZIhvcNAQEBBQADgY0AMIGJAoGBANtiq0AIJK+iVRwFrqcD7fYXTCbMYC5Qz/k6\n&quot; +</span>
<span class="line-modified"> 89         &quot;AXBy7/1rI8wDhEJLE3m/+NSqiJwZcmdq2dNh/1fJFrwvzuURbc9+paOBWeHbN+Sc\n&quot; +</span>
<span class="line-modified"> 90         &quot;x3huw91oPZme385VpoK3G13rSE114S/rF4DM9mz4EStFhSHXATjtdbskNOAYGLTV\n&quot; +</span>
<span class="line-modified"> 91         &quot;x8uEy9GbAgMBAAGjgaUwgaIwHQYDVR0OBBYEFN1OjSoRwIMD8Kzror/58n3IaR+b\n&quot; +</span>
<span class="line-modified"> 92         &quot;MGMGA1UdIwRcMFqAFN1OjSoRwIMD8Kzror/58n3IaR+boT+kPTA7MQswCQYDVQQG\n&quot; +</span>
<span class="line-modified"> 93         &quot;EwJVUzENMAsGA1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNTRSBUZXN0IFNlcml2\n&quot; +</span>
<span class="line-modified"> 94         &quot;Y2WCAQAwDwYDVR0TAQH/BAUwAwEB/zALBgNVHQ8EBAMCAQYwDQYJKoZIhvcNAQEC\n&quot; +</span>
<span class="line-modified"> 95         &quot;BQADgYEAjjkJesQrkbr36N40egybaIxw7RcqT6iy5fkAGS1JYlBDk8uSCK1o6bCH\n&quot; +</span>
<span class="line-modified"> 96         &quot;ls5EpYcGeEoabSS73WRdkO1lgeyWDduO4ef8cCCSpmpT6/YdZG0QS1PtcREeVig+\n&quot; +</span>
<span class="line-modified"> 97         &quot;Zr25jNemS4ADHX0aaXP4kiV/G80cR7nX5t5XCUm4bYdbwM07NgI=\n&quot; +</span>





 98         &quot;-----END CERTIFICATE-----&quot;;
 99     static String trustedPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">100         &quot;MIICeAIBADANBgkqhkiG9w0BAQEFAASCAmIwggJeAgEAAoGBANtiq0AIJK+iVRwF\n&quot; +</span>
<span class="line-modified">101         &quot;rqcD7fYXTCbMYC5Qz/k6AXBy7/1rI8wDhEJLE3m/+NSqiJwZcmdq2dNh/1fJFrwv\n&quot; +</span>
<span class="line-modified">102         &quot;zuURbc9+paOBWeHbN+Scx3huw91oPZme385VpoK3G13rSE114S/rF4DM9mz4EStF\n&quot; +</span>
<span class="line-modified">103         &quot;hSHXATjtdbskNOAYGLTVx8uEy9GbAgMBAAECgYEA2VjHkIiA0ABjkX+PqKeb+VLb\n&quot; +</span>
<span class="line-modified">104         &quot;fxS7tSca5C8zfdRhLxAWRui0/3ihst0eCJNrBDuxvAOACovsDWyLuaUjtI2v2ysz\n&quot; +</span>
<span class="line-modified">105         &quot;vz6SPyGy82PhQOFzyKQuQ814N6EpothpiZzF0yFchfKIGhUsdY89UrGs9nM7m6NT\n&quot; +</span>
<span class="line-modified">106         &quot;rztYvgIu4avg2VPR2AECQQD+pFAqipR2BplQRIuuRSZfHRxvoEyDjT1xnHJsC6WP\n&quot; +</span>
<span class="line-modified">107         &quot;I5hCLghL91MhQGWbP4EJMKYQOTRVukWlcp2Kycpf+P5hAkEA3I43gmVUAPEdyZdY\n&quot; +</span>
<span class="line-modified">108         &quot;fatW7OaLlbbYJb6qEtpCZ1Rwe/BIvm6H6E3qSi/lpz7Ia7WDulpbF6BawHH3pRFq\n&quot; +</span>
<span class="line-modified">109         &quot;CUY5ewJBAP3pUDqrRpBN0jB0uSeDslhjSciQ+dqvSpZv3rSYBHUvlBJhnkpJiy37\n&quot; +</span>
<span class="line-modified">110         &quot;7ZUZhIxqYxyIPgRBolLwb+FFh7OdL+ECQCtldDic9WVmC+VheRDpCKZ+SlK/8lGi\n&quot; +</span>
<span class="line-modified">111         &quot;7VXeShiIvcU1JysJFoa35fSI7hf1O3wt7+hX5PqGG7Un94EsJwACKEcCQQC1TWt6\n&quot; +</span>
<span class="line-modified">112         &quot;ArKH6tRxKjOxFtqfs8fgEVYUaOr3j1jF4KBUuX2mtQtddZe3VfJ2wPsuKMMxmhkB\n&quot; +</span>
<span class="line-modified">113         &quot;e7xWWZnJsErt2e+E&quot;;</span>












114 
115     // Certificate information:
116     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce
117     // Validity
<span class="line-modified">118     //     Not Before: May  5 02:40:53 2012 GMT</span>
<span class="line-modified">119     //     Not After : Jan 21 02:40:53 2032 GMT</span>
120     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce, CN=casigner
121     // X509v3 Subject Key Identifier:
<span class="line-modified">122     //     13:07:E0:11:07:DB:EB:33:23:87:31:D0:DB:7E:16:56:BE:11:90:0A</span>
123     // X509v3 Authority Key Identifier:
<span class="line-modified">124     //     keyid:DD:4E:8D:2A:11:C0:83:03:F0:AC:EB:A2:BF:F9:F2:7D:C8:69:1F:9B</span>
<span class="line-removed">125     //     DirName:/C=US/O=Java/OU=SunJSSE Test Serivce</span>
<span class="line-removed">126     //     serial:00</span>
127     static String caSignerStr =
128         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">129         &quot;MIICqDCCAhGgAwIBAgIBAjANBgkqhkiG9w0BAQQFADA7MQswCQYDVQQGEwJVUzEN\n&quot; +</span>
<span class="line-modified">130         &quot;MAsGA1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNTRSBUZXN0IFNlcml2Y2UwHhcN\n&quot; +</span>
<span class="line-modified">131         &quot;MTIwNTA1MDI0MDUzWhcNMzIwMTIxMDI0MDUzWjBOMQswCQYDVQQGEwJVUzENMAsG\n&quot; +</span>
<span class="line-modified">132         &quot;A1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNTRSBUZXN0IFNlcml2Y2UxETAPBgNV\n&quot; +</span>
<span class="line-modified">133         &quot;BAMTCGNhc2lnbmVyMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC+x8+o7oM0\n&quot; +</span>
<span class="line-modified">134         &quot;ct/LZmZLXBL4CQ8jrULD5P7NtEW0hg/zxBFZfBHf+44Oo2eMPYZj+7xaREOH5BmV\n&quot; +</span>
<span class="line-modified">135         &quot;KRYlzRtONAaC5Ng4Mrm5UKNPcMIIUjUOvm7vWM4oSTMSfoEcSX+vp99uUAkw3w7Z\n&quot; +</span>
<span class="line-modified">136         &quot;+frYDm1M4At/j0b+lLij71GFN2L8drpgPQIDAQABo4GoMIGlMB0GA1UdDgQWBBQT\n&quot; +</span>
<span class="line-modified">137         &quot;B+ARB9vrMyOHMdDbfhZWvhGQCjBjBgNVHSMEXDBagBTdTo0qEcCDA/Cs66K/+fJ9\n&quot; +</span>
<span class="line-modified">138         &quot;yGkfm6E/pD0wOzELMAkGA1UEBhMCVVMxDTALBgNVBAoTBEphdmExHTAbBgNVBAsT\n&quot; +</span>
<span class="line-modified">139         &quot;FFN1bkpTU0UgVGVzdCBTZXJpdmNlggEAMBIGA1UdEwEB/wQIMAYBAf8CAQEwCwYD\n&quot; +</span>
<span class="line-modified">140         &quot;VR0PBAQDAgEGMA0GCSqGSIb3DQEBBAUAA4GBAI+LXA/UCPkTANablUkt80JNPWsl\n&quot; +</span>
<span class="line-modified">141         &quot;pS4XLNgPxWaN0bkRDs5oI4ooWAz1rwpeJ/nfetOvWlpmrVjSeovBFja5Hl+dUHTf\n&quot; +</span>
<span class="line-modified">142         &quot;VfuyzkxXbhuNiJIpo1mVBpNsjwu9YRxuwX6UA2LTUQpgvtVJEE012x3zRvxBCbu2\n&quot; +</span>
<span class="line-modified">143         &quot;Y/v1R5fZ4c+hXDfC\n&quot; +</span>




144         &quot;-----END CERTIFICATE-----&quot;;
145     static String caSignerPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">146         &quot;MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBAL7Hz6jugzRy38tm\n&quot; +</span>
<span class="line-modified">147         &quot;ZktcEvgJDyOtQsPk/s20RbSGD/PEEVl8Ed/7jg6jZ4w9hmP7vFpEQ4fkGZUpFiXN\n&quot; +</span>
<span class="line-modified">148         &quot;G040BoLk2DgyublQo09wwghSNQ6+bu9YzihJMxJ+gRxJf6+n325QCTDfDtn5+tgO\n&quot; +</span>
<span class="line-modified">149         &quot;bUzgC3+PRv6UuKPvUYU3Yvx2umA9AgMBAAECgYBYvu30cW8LONyt62Zua9hPFTe7\n&quot; +</span>
<span class="line-modified">150         &quot;qt9B7QYyfkdmoG5PQMepTrOp84SzfoOukvgvDm0huFuJnSvhXQl2cCDhkgXskvFj\n&quot; +</span>
<span class="line-modified">151         &quot;Hh7KBCFViVXokGdq5YoS0/KYMyQV0TZfJUvILBl51uc4/siQ2tClC/N4sa+1JhgW\n&quot; +</span>
<span class="line-modified">152         &quot;a6dFGfRjiUKSSlmMwQJBAPWpIz3Q/c+DYMvoQr5OD8EaYwYIevlTdXb97RnJJh2b\n&quot; +</span>
<span class="line-modified">153         &quot;UnhB9jrqesJiHYVzPmP0ukyPOXOwlp2T5Am4Kw0LFOkCQQDGz150NoHOp28Mvyc4\n&quot; +</span>
<span class="line-modified">154         &quot;CTqz/zYzUhy2eCJESl196uyP4N65Y01VYQ3JDww4DlsXiU17tVSbgA9TCcfTYOzy\n&quot; +</span>
<span class="line-modified">155         &quot;vyw1AkARUky+1hafZCcWGZljK8PmnMKwsTZikCTvL/Zg5BMA8Wu+OQBwpQnk3OAy\n&quot; +</span>
<span class="line-modified">156         &quot;Aa87gw0DyvGFG8Vy9POWT9sRP1/JAkBqP0hrMvYMSs6+MSn0eHo2151PsAJIQcuO\n&quot; +</span>
<span class="line-modified">157         &quot;U2/Da1khSzu8N6WMi2GiobgV/RYRbf9KrY2ZzMZjykZQYOxAjopBAkEAghCu38cN\n&quot; +</span>
<span class="line-modified">158         &quot;aOsW6ueo24uzsWI1FTdE+qWNVEi3RSP120xXBCyhaBjIq4WVSlJK9K2aBaJpit3j\n&quot; +</span>
<span class="line-modified">159         &quot;iQ5tl6zrLlxQhg==&quot;;</span>












160 
161     // Certificate information:
162     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce, CN=casigner
163     // Validity
164     //     Not Before: May  5 02:40:57 2012 GMT
165     //     Not After : Jan 21 02:40:57 2032 GMT
166     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce, CN=certissuer
167     // X509v3 Subject Key Identifier:
<span class="line-modified">168     //     39:0E:C6:33:B1:50:BC:73:07:31:E5:D8:04:F7:BB:97:55:CF:9B:C8</span>
169     // X509v3 Authority Key Identifier:
<span class="line-modified">170     //     keyid:13:07:E0:11:07:DB:EB:33:23:87:31:D0:DB:7E:16:56:BE:11:90:0A</span>
<span class="line-removed">171     //     DirName:/C=US/O=Java/OU=SunJSSE Test Serivce</span>
<span class="line-removed">172     //     serial:02</span>
173     static String certIssuerStr =
174         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">175         &quot;MIICvjCCAiegAwIBAgIBAzANBgkqhkiG9w0BAQQFADBOMQswCQYDVQQGEwJVUzEN\n&quot; +</span>
<span class="line-modified">176         &quot;MAsGA1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNTRSBUZXN0IFNlcml2Y2UxETAP\n&quot; +</span>
<span class="line-modified">177         &quot;BgNVBAMTCGNhc2lnbmVyMB4XDTEyMDUwNTAyNDA1N1oXDTMyMDEyMTAyNDA1N1ow\n&quot; +</span>
<span class="line-modified">178         &quot;UDELMAkGA1UEBhMCVVMxDTALBgNVBAoTBEphdmExHTAbBgNVBAsTFFN1bkpTU0Ug\n&quot; +</span>
<span class="line-modified">179         &quot;VGVzdCBTZXJpdmNlMRMwEQYDVQQDEwpjZXJ0aXNzdWVyMIGfMA0GCSqGSIb3DQEB\n&quot; +</span>
<span class="line-modified">180         &quot;AQUAA4GNADCBiQKBgQCyz55zinU6kNL/LeiTNiBI0QWYmDG0YTotuC4D75liBNqs\n&quot; +</span>
<span class="line-modified">181         &quot;7Mmladsh2mTtQUAwmuGaGzaZV25a+cUax0DXZoyBwdbTI09u1bUYsZcaUUKbPoCC\n&quot; +</span>
<span class="line-modified">182         &quot;HH26e4jLFL4olW13Sv4ZAd57tIYevMw+Fp5f4fLPFGegCJTFlv2Qjpmic/cuvQID\n&quot; +</span>
<span class="line-modified">183         &quot;AQABo4GpMIGmMB0GA1UdDgQWBBQ5DsYzsVC8cwcx5dgE97uXVc+byDBjBgNVHSME\n&quot; +</span>
<span class="line-modified">184         &quot;XDBagBQTB+ARB9vrMyOHMdDbfhZWvhGQCqE/pD0wOzELMAkGA1UEBhMCVVMxDTAL\n&quot; +</span>
<span class="line-modified">185         &quot;BgNVBAoTBEphdmExHTAbBgNVBAsTFFN1bkpTU0UgVGVzdCBTZXJpdmNlggECMBMG\n&quot; +</span>
<span class="line-modified">186         &quot;A1UdEwEB/wQJMAcBAf8CAgQAMAsGA1UdDwQEAwIBBjANBgkqhkiG9w0BAQQFAAOB\n&quot; +</span>
<span class="line-modified">187         &quot;gQCQTagenCdClT98C+oTJGJrw/dUBD9K3tE6ZJKPMc/2bUia8G5ei1C0eXj4mWG2\n&quot; +</span>
<span class="line-modified">188         &quot;lu9umR6C90/A6qB050QB2h50qtqxSrkpu+ym1yypauZpg7U3nUY9wZWJNI1vqrQZ\n&quot; +</span>
<span class="line-modified">189         &quot;pqUMRcXY3iQIVKx+Qj+4/Za1wwFQzpEoGmqRW31V1SdMEw==\n&quot; +</span>




190         &quot;-----END CERTIFICATE-----&quot;;
191     static String certIssuerPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">192         &quot;MIICeQIBADANBgkqhkiG9w0BAQEFAASCAmMwggJfAgEAAoGBALLPnnOKdTqQ0v8t\n&quot; +</span>
<span class="line-modified">193         &quot;6JM2IEjRBZiYMbRhOi24LgPvmWIE2qzsyaVp2yHaZO1BQDCa4ZobNplXblr5xRrH\n&quot; +</span>
<span class="line-modified">194         &quot;QNdmjIHB1tMjT27VtRixlxpRQps+gIIcfbp7iMsUviiVbXdK/hkB3nu0hh68zD4W\n&quot; +</span>
<span class="line-modified">195         &quot;nl/h8s8UZ6AIlMWW/ZCOmaJz9y69AgMBAAECgYEAjtew2tgm4gxDojqIauF4VPM1\n&quot; +</span>
<span class="line-modified">196         &quot;pzsdqd1p3pAdomNLgrQiBLZ8N7oiph6TNb1EjA+OXc+ThFgF/oM9ZDD8qZZwcvjN\n&quot; +</span>
<span class="line-modified">197         &quot;qDZlpTkFs2TaGcyEZfUaMB45NHVs6Nn+pSkagSNwwy3xeyAct7sQEzGNTDlEwVv5\n&quot; +</span>
<span class="line-modified">198         &quot;7V9LQutQtBd6xT48KzkCQQDpNRfv2OFNG/6GtzJoO68oJhpnpl2MsYNi4ntRkre/\n&quot; +</span>
<span class="line-modified">199         &quot;6uXpiCYaDskcrPMRwOOs0m7mxG+Ev+uKnLnSoEMm1GCbAkEAxEmDtiD0Psb8Z9BL\n&quot; +</span>
<span class="line-modified">200         &quot;ZRb83Jqho3xe2MCAh3xUfz9b/Mhae9dZ44o4OCgQZuwvW1mczF0NtpgZl93BmYa2\n&quot; +</span>
<span class="line-modified">201         &quot;hTwHhwJBAKHrEj6ep/fA6x0gD2idoATRR94VfbiU+7NpqtO9ecVP0+gsdr/66hn1\n&quot; +</span>
<span class="line-modified">202         &quot;3yLBeZLh3MxvMTrLgkAQh1i9m0JXjOcCQQClLXAHHegrw+u3uNMZeKTFR+Lp3sk6\n&quot; +</span>
<span class="line-modified">203         &quot;AZSnbvr0Me9I45kxSeG81x3ENALJecvIRbrrRws5MvmmkNhQR8rkh8WVAkEAk6b+\n&quot; +</span>
<span class="line-modified">204         &quot;aVtmBgUaTS5+FFlHGHJY9HFrfT1a1C/dwyMuqlmbC3YsBmZaMOlKli5TXNybLff8\n&quot; +</span>
<span class="line-modified">205         &quot;5KMeGEpXMzgC7AscGA==&quot;;</span>












206 
207     // Certificate information:
208     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce, CN=certissuer
209     // Validity
<span class="line-modified">210     //     Not Before: May  5 02:41:01 2012 GMT</span>
<span class="line-modified">211     //     Not After : Jan 21 02:41:01 2032 GMT</span>
212     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce, CN=localhost
213     // X509v3 Subject Key Identifier:
<span class="line-modified">214     //     AD:C0:2C:4C:E4:C2:2E:A1:BB:5D:92:BE:66:E0:4E:E0:0D:2F:11:EF</span>
215     // X509v3 Authority Key Identifier:
<span class="line-modified">216     //     keyid:39:0E:C6:33:B1:50:BC:73:07:31:E5:D8:04:F7:BB:97:55:CF:9B:C8</span>
217     static String serverCertStr =
218         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">219         &quot;MIICjTCCAfagAwIBAgIBBDANBgkqhkiG9w0BAQQFADBQMQswCQYDVQQGEwJVUzEN\n&quot; +</span>
<span class="line-modified">220         &quot;MAsGA1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNTRSBUZXN0IFNlcml2Y2UxEzAR\n&quot; +</span>
<span class="line-modified">221         &quot;BgNVBAMTCmNlcnRpc3N1ZXIwHhcNMTIwNTA1MDI0MTAxWhcNMzIwMTIxMDI0MTAx\n&quot; +</span>
<span class="line-modified">222         &quot;WjBPMQswCQYDVQQGEwJVUzENMAsGA1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNT\n&quot; +</span>
<span class="line-modified">223         &quot;RSBUZXN0IFNlcml2Y2UxEjAQBgNVBAMTCWxvY2FsaG9zdDCBnzANBgkqhkiG9w0B\n&quot; +</span>
<span class="line-modified">224         &quot;AQEFAAOBjQAwgYkCgYEAvwaUd7wmBSKqycEstYLWD26vkU08DM39EtaT8wL9HnQ0\n&quot; +</span>
<span class="line-modified">225         &quot;fgPblwBFI4zdLa2cuYXRZcFUb04N8nrkcpR0D6kkE+AlFAoRWrrZF80B7JTbtEK4\n&quot; +</span>
<span class="line-modified">226         &quot;1PIeurihXvUT+4MpzGLOojIihMfvM4ufelblD56SInso4WFHm7t4qCln88J1gjkC\n&quot; +</span>
<span class="line-modified">227         &quot;AwEAAaN4MHYwCwYDVR0PBAQDAgPoMB0GA1UdDgQWBBStwCxM5MIuobtdkr5m4E7g\n&quot; +</span>
<span class="line-modified">228         &quot;DS8R7zAfBgNVHSMEGDAWgBQ5DsYzsVC8cwcx5dgE97uXVc+byDAnBgNVHSUEIDAe\n&quot; +</span>
<span class="line-modified">229         &quot;BggrBgEFBQcDAQYIKwYBBQUHAwIGCCsGAQUFBwMDMA0GCSqGSIb3DQEBBAUAA4GB\n&quot; +</span>
<span class="line-modified">230         &quot;AGfwcfdvEG/nSCiAn2MGbYHp34mgF3OA1SJLWUW0LvWJhwm2cn4AXlSoyvbwrkaB\n&quot; +</span>
<span class="line-modified">231         &quot;IDDCwhJvvc0vUyL2kTx7sqVaFTq3mDs+ktlB/FfH0Pb+i8FE+g+7T42Iw/j0qxHL\n&quot; +</span>
<span class="line-modified">232         &quot;YmgbrjBQf5WYN1AvBE/rrPt9aOtS3UsqtVGW574b0shW\n&quot; +</span>





233         &quot;-----END CERTIFICATE-----&quot;;
234     static String serverPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">235         &quot;MIICdAIBADANBgkqhkiG9w0BAQEFAASCAl4wggJaAgEAAoGBAL8GlHe8JgUiqsnB\n&quot; +</span>
<span class="line-modified">236         &quot;LLWC1g9ur5FNPAzN/RLWk/MC/R50NH4D25cARSOM3S2tnLmF0WXBVG9ODfJ65HKU\n&quot; +</span>
<span class="line-modified">237         &quot;dA+pJBPgJRQKEVq62RfNAeyU27RCuNTyHrq4oV71E/uDKcxizqIyIoTH7zOLn3pW\n&quot; +</span>
<span class="line-modified">238         &quot;5Q+ekiJ7KOFhR5u7eKgpZ/PCdYI5AgMBAAECf3CscOYvFD3zNMnMJ5LomVqA7w3F\n&quot; +</span>
<span class="line-modified">239         &quot;gKYM2jlCWAH+wU41PMEXhW6Lujw92jgXL1o+lERwxFzirVdZJWZwKgUSvzP1G0h3\n&quot; +</span>
<span class="line-modified">240         &quot;fkucq1/UWnToK+8NSXNM/yS8hXbBgSEoJo5f7LKcIi1Ev6doBVofMxs+njzyWKbM\n&quot; +</span>
<span class="line-modified">241         &quot;Nb7rOLHadghoon0CQQDgQzbzzSN8Dc1YmmylhI5v+0sQRHH0DL7D24k4Weh4vInG\n&quot; +</span>
<span class="line-modified">242         &quot;EAbt4x8M7ZKEo8/dv0s4hbmNmAnJl93/RRxIyEqLAkEA2g87DiswSQam2pZ8GlrO\n&quot; +</span>
<span class="line-modified">243         &quot;+w4Qg9mH8uxx8ou2rl0XlHzH1XiTNbkjfY0EZoL7L31BHFk9n11Fb2P85g6ws+Hy\n&quot; +</span>
<span class="line-modified">244         &quot;ywJAM/xgyLNM/nzUlS128geAXUULaYH0SHaL4isJ7B4rXZGW/mrIsGxtzjlkNYsj\n&quot; +</span>
<span class="line-modified">245         &quot;rGujrD6TfNc5rZmexIXowJZtcQJBAIww+pCzZ4mrgx5JXWQ8OZHiiu+ZrPOa2+9J\n&quot; +</span>
<span class="line-modified">246         &quot;r5sOMpi+WGN/73S8oHqZbNjTINZ5OqEVJq8MchWZPQBTNXuQql0CQHEjUzzkCQa3\n&quot; +</span>
<span class="line-modified">247         &quot;j6JTa2KAdqyvLOx0XF9zcc1gA069uNQI2gPUHS8V215z57f/gMGnDNhVfLs/vMKz\n&quot; +</span>
<span class="line-modified">248         &quot;sFkVZ3zg7As=&quot;;</span>












249 
250     // Certificate information:
251     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce, CN=certissuer
252     // Validity
<span class="line-modified">253     //     Not Before: May  5 02:41:02 2012 GMT</span>
<span class="line-modified">254     //     Not After : Jan 21 02:41:02 2032 GMT</span>
255     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce, CN=InterOp Tester
256     // X509v3 Subject Key Identifier:
<span class="line-modified">257     //     57:7D:E2:33:33:60:DF:DD:5E:ED:81:3F:EB:F2:1B:59:7F:50:9C:99</span>
258     // X509v3 Authority Key Identifier:
<span class="line-modified">259     //     keyid:39:0E:C6:33:B1:50:BC:73:07:31:E5:D8:04:F7:BB:97:55:CF:9B:C8</span>
260     static String clientCertStr =
261         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">262         &quot;MIICaTCCAdKgAwIBAgIBBTANBgkqhkiG9w0BAQQFADBQMQswCQYDVQQGEwJVUzEN\n&quot; +</span>
<span class="line-modified">263         &quot;MAsGA1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNTRSBUZXN0IFNlcml2Y2UxEzAR\n&quot; +</span>
<span class="line-modified">264         &quot;BgNVBAMTCmNlcnRpc3N1ZXIwHhcNMTIwNTA1MDI0MTAyWhcNMzIwMTIxMDI0MTAy\n&quot; +</span>
<span class="line-modified">265         &quot;WjBUMQswCQYDVQQGEwJVUzENMAsGA1UEChMESmF2YTEdMBsGA1UECxMUU3VuSlNT\n&quot; +</span>
<span class="line-modified">266         &quot;RSBUZXN0IFNlcml2Y2UxFzAVBgNVBAMTDkludGVyT3AgVGVzdGVyMIGfMA0GCSqG\n&quot; +</span>
<span class="line-modified">267         &quot;SIb3DQEBAQUAA4GNADCBiQKBgQC1pA71nDg1KhhnHjRdi/eVDUa7uFZAtN8R9huu\n&quot; +</span>
<span class="line-modified">268         &quot;pTwFoyqSX8lDMz8jDawOMmaI9dVZLjTh3hnf4KBEqQOearFVz45yBOjlgPLBuI4F\n&quot; +</span>
<span class="line-modified">269         &quot;D/ORhgmDaIu2NK+c1yj6YQlyiO0DPwh55GtPLVG3iuEpejU7gQyaMuTaddoXrO7s\n&quot; +</span>
<span class="line-modified">270         &quot;xwzanQIDAQABo08wTTALBgNVHQ8EBAMCA+gwHQYDVR0OBBYEFFd94jMzYN/dXu2B\n&quot; +</span>
<span class="line-modified">271         &quot;P+vyG1l/UJyZMB8GA1UdIwQYMBaAFDkOxjOxULxzBzHl2AT3u5dVz5vIMA0GCSqG\n&quot; +</span>
<span class="line-modified">272         &quot;SIb3DQEBBAUAA4GBAHTgB5W7wnl7Jnb4wNQcb6JdR8FRHIdslcRfnReFfZBHZZux\n&quot; +</span>
<span class="line-modified">273         &quot;ChpA1lf62KIzYohKoxQXXMul86vnVSHnXq5xctHEmxCBnALEnoAcCOv6wfWqEA7g\n&quot; +</span>
<span class="line-modified">274         &quot;2rX+ydmu+0ArbqKhSOypZ7K3ame0UOJJ6HDxdsgBYJuotmSou4KKq9e8GF+d\n&quot; +</span>






275         &quot;-----END CERTIFICATE-----&quot;;
276     static String clientPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">277         &quot;MIICeAIBADANBgkqhkiG9w0BAQEFAASCAmIwggJeAgEAAoGBALWkDvWcODUqGGce\n&quot; +</span>
<span class="line-modified">278         &quot;NF2L95UNRru4VkC03xH2G66lPAWjKpJfyUMzPyMNrA4yZoj11VkuNOHeGd/goESp\n&quot; +</span>
<span class="line-modified">279         &quot;A55qsVXPjnIE6OWA8sG4jgUP85GGCYNoi7Y0r5zXKPphCXKI7QM/CHnka08tUbeK\n&quot; +</span>
<span class="line-modified">280         &quot;4Sl6NTuBDJoy5Np12hes7uzHDNqdAgMBAAECgYEAjLwygwapXjfhdHQoqpp6F9iT\n&quot; +</span>
<span class="line-modified">281         &quot;h3sKCVSaybXgOO75lHyZzZO9wv1/288KEm3mmBOxXEm6245UievnAYvaq/GKt93O\n&quot; +</span>
<span class="line-modified">282         &quot;pj2zRefBzZjGbz0v84fmna/MN6zUUYX1PcVRMKWLx9HKKmQihzwoXdBX0o9PPXdi\n&quot; +</span>
<span class="line-modified">283         &quot;LfzujNa/q8/mpI5PmEECQQDZwLSaL7OReWZTY4NoQuNzwhx5IKJUOtCFQfmHKZSW\n&quot; +</span>
<span class="line-modified">284         &quot;wtXntZf+E5W9tGaDY5wjpq5cilKDAHdEAlFWxDe1PoE1AkEA1YuTBpctOLBfquFn\n&quot; +</span>
<span class="line-modified">285         &quot;Y/S3lzGVlnIHDk3dj4bFglkoJ2bCdlwRNUyBSjAjBDcbYhper8S7GlEN5SiEdz9I\n&quot; +</span>
<span class="line-modified">286         &quot;3OjIyQJBAKEPMgYhZjYhjxf6sQV7A/VpC9pj0u1uGzGVXNUmYisorUKXRHa/UbBh\n&quot; +</span>
<span class="line-modified">287         &quot;MLnaAXE1Jh54iRMwUwbQmA0PUQ0T0EkCQQCcr6/umwhkWw2nHYK2Vf5LoudGn15M\n&quot; +</span>
<span class="line-modified">288         &quot;AZg7UsEjVnXfC0hOfllmCT+ohs96rVCbWAv33lsHAUg3x9YChV3aMbf5AkAj1kuV\n&quot; +</span>
<span class="line-modified">289         &quot;jUTgFKjediyQC6uof7YdLn+gQGiXK1XE0GBN4WMkzcLiS0jC+MFTgKfFnFdh9K0y\n&quot; +</span>
<span class="line-modified">290         &quot;fswYKdTA/o8RKaa5&quot;;</span>












291 
292     static char passphrase[] = &quot;passphrase&quot;.toCharArray();
293 
294     /*
295      * Is the server ready to serve?
296      */
297     volatile static boolean serverReady = false;
298 
299     /*
300      * Turn on SSL debugging?
301      */
302     static boolean debug = false;
303 
304     /*
305      * Define the server side of the test.
306      *
307      * If the server prematurely exits, serverReady will be set to true
308      * to avoid infinite hangs.
309      */
310     void doServerSide() throws Exception {
311         SSLContext context = getSSLContext(true);
312         SSLServerSocketFactory sslssf = context.getServerSocketFactory();
313 
314         SSLServerSocket sslServerSocket =
<span class="line-modified">315             (SSLServerSocket)sslssf.createServerSocket(serverPort);</span>
316         serverPort = sslServerSocket.getLocalPort();
317         SSLSocket sslSocket = null;
318         try {
319             /*
320              * Signal Client, we&#39;re ready for his connect.
321              */
322             serverReady = true;
323 
324             sslSocket = (SSLSocket) sslServerSocket.accept();
325             sslSocket.setNeedClientAuth(true);
326 
327             InputStream sslIS = sslSocket.getInputStream();
328             OutputStream sslOS = sslSocket.getOutputStream();
329 
330             sslIS.read();
331             sslOS.write(85);
332             sslOS.flush();
333         } finally {
334             if (sslSocket != null) {
335                 sslSocket.close();
</pre>
<hr />
<pre>
339     }
340 
341     /*
342      * Define the client side of the test.
343      *
344      * If the server prematurely exits, serverReady will be set to true
345      * to avoid infinite hangs.
346      */
347     void doClientSide() throws Exception {
348         /*
349          * Wait for server to get started.
350          */
351         while (!serverReady) {
352             Thread.sleep(50);
353         }
354 
355         SSLContext context = getSSLContext(false);
356         SSLSocketFactory sslsf = context.getSocketFactory();
357 
358         SSLSocket sslSocket =
<span class="line-modified">359             (SSLSocket)sslsf.createSocket(&quot;localhost&quot;, serverPort);</span>
<span class="line-removed">360         sslSocket.setEnabledProtocols(new String[] { &quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot; });</span>
361         try {
362             InputStream sslIS = sslSocket.getInputStream();
363             OutputStream sslOS = sslSocket.getOutputStream();
364 
365             sslOS.write(280);
366             sslOS.flush();
367             sslIS.read();
368         } finally {
369             sslSocket.close();
370         }
371     }
372 
373     // get the ssl context
374     private static SSLContext getSSLContext(boolean isServer) throws Exception {
375 
376         // generate certificate from cert string
377         CertificateFactory cf = CertificateFactory.getInstance(&quot;X.509&quot;);
378 
379         // create a key store
380         KeyStore ks = KeyStore.getInstance(&quot;JKS&quot;);
</pre>
<hr />
<pre>
441     }
442 
443     private static String tmAlgorithm;        // trust manager
444 
445     private static void parseArguments(String[] args) {
446         tmAlgorithm = args[0];
447     }
448 
449     /*
450      * =============================================================
451      * The remainder is just support stuff
452      */
453 
454     // use any free port by default
455     volatile int serverPort = 0;
456 
457     volatile Exception serverException = null;
458     volatile Exception clientException = null;
459 
460     public static void main(String args[]) throws Exception {
<span class="line-removed">461         // MD5 is used in this test case, don&#39;t disable MD5 algorithm.</span>
<span class="line-removed">462         Security.setProperty(&quot;jdk.certpath.disabledAlgorithms&quot;,</span>
<span class="line-removed">463                 &quot;MD2, RSA keySize &lt; 1024&quot;);</span>
<span class="line-removed">464         Security.setProperty(&quot;jdk.tls.disabledAlgorithms&quot;,</span>
<span class="line-removed">465                 &quot;SSLv3, RC4, DH keySize &lt; 768&quot;);</span>
<span class="line-removed">466 </span>
467         if (debug)
468             System.setProperty(&quot;javax.net.debug&quot;, &quot;all&quot;);
469 
<span class="line-removed">470 </span>
471         /*
472          * Get the customized arguments.
473          */
474         parseArguments(args);
475 
476         /*
477          * Start the tests.
478          */
479         new BasicConstraints();
480     }
481 
482     Thread clientThread = null;
483     Thread serverThread = null;
484     /*
485      * Primary constructor, used to drive remainder of the test.
486      *
487      * Fork off the other side, then do your work.
488      */
489     BasicConstraints() throws Exception {
490         if (separateServerThread) {
</pre>
<hr />
<pre>
544     void startClient(boolean newThread) throws Exception {
545         if (newThread) {
546             clientThread = new Thread() {
547                 public void run() {
548                     try {
549                         doClientSide();
550                     } catch (Exception e) {
551                         /*
552                          * Our client thread just died.
553                          */
554                         System.err.println(&quot;Client died...&quot;);
555                         clientException = e;
556                     }
557                 }
558             };
559             clientThread.start();
560         } else {
561             doClientSide();
562         }
563     }
<span class="line-removed">564 </span>
565 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 //
 25 // SunJSSE does not support dynamic system properties, no way to re-use
 26 // system properties in samevm/agentvm mode.
 27 //
 28 
 29 /*
 30  * @test
 31  * @bug 7166570
 32  * @summary JSSE certificate validation has started to fail for
 33  *     certificate chains
 34  * @run main/othervm BasicConstraints PKIX
 35  * @run main/othervm BasicConstraints SunX509
 36  */
 37 

 38 import java.util.*;
 39 import java.io.*;
 40 import javax.net.ssl.*;

 41 import java.security.KeyStore;
 42 import java.security.KeyFactory;
 43 import java.security.cert.*;
 44 import java.security.spec.*;
 45 import java.security.interfaces.*;

 46 
 47 import java.util.Base64;
 48 
 49 public class BasicConstraints {
 50 
 51     /*
 52      * =============================================================
 53      * Set the various variables needed for the tests, then
 54      * specify what tests to run on each side.
 55      */
 56 
 57     /*
 58      * Should we run the client or server in a separate thread?
 59      * Both sides can throw exceptions, but do you have a preference
 60      * as to which side should be the main thread.
 61      */
 62     static boolean separateServerThread = true;
 63 
 64     /*
 65      * Where do we find the keystores?
 66      */
 67     // Certificate information:
 68     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce
 69     // Validity
<span class="line-modified"> 70     //     Not Before: Dec 20 13:13:44 2019 GMT</span>
<span class="line-modified"> 71     //     Not After : Dec 17 13:13:44 2029 GMT</span>
 72     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce
 73     // X509v3 Subject Key Identifier:
<span class="line-modified"> 74     //     88:A7:8D:A1:4F:85:3C:9B:32:47:88:E8:74:81:65:45:00:DE:DD:45</span>
 75     // X509v3 Authority Key Identifier:
<span class="line-modified"> 76     //     keyid:88:A7:8D:A1:4F:85:3C:9B:32:47:88:E8:74:81:65:45:00:DE:DD:45</span>


 77     static String trusedCertStr =
 78         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified"> 79         &quot;MIIDZDCCAkygAwIBAgIUSXd4x4/VUhfEFGgfxEt/BG2n8RIwDQYJKoZIhvcNAQEL\n&quot; +</span>
<span class="line-modified"> 80         &quot;BQAwOzELMAkGA1UEBhMCVVMxDTALBgNVBAoMBEphdmExHTAbBgNVBAsMFFN1bkpT\n&quot; +</span>
<span class="line-modified"> 81         &quot;U0UgVGVzdCBTZXJpdmNlMB4XDTE5MTIyMDEzMTM0NFoXDTI5MTIxNzEzMTM0NFow\n&quot; +</span>
<span class="line-modified"> 82         &quot;OzELMAkGA1UEBhMCVVMxDTALBgNVBAoMBEphdmExHTAbBgNVBAsMFFN1bkpTU0Ug\n&quot; +</span>
<span class="line-modified"> 83         &quot;VGVzdCBTZXJpdmNlMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1Cd4\n&quot; +</span>
<span class="line-modified"> 84         &quot;U//Y2P4vIu9BBGi+pm64YXYP2LNRNK/e5/nWWmNKJapCAYYda/FJClrbzpI/FgRU\n&quot; +</span>
<span class="line-modified"> 85         &quot;NLM9B4Uo065FRIrBi1vu8zyYgwT7UK0WsLwg6Z81KH50PfM0ClEx44tTqocYDc7C\n&quot; +</span>
<span class="line-modified"> 86         &quot;gsvbyIeTIbV9AnRlEnBA15WFJAJMTCglaNleXUZ9+A/tazRhHlsRp0Ob8j4tCMJa\n&quot; +</span>
<span class="line-modified"> 87         &quot;RDpGMYTy1XbG+WqC8wXP63a63cwjPrL5uzt/C4W1bgNBfTRwIHSUShNhfdc7ZJNS\n&quot; +</span>
<span class="line-modified"> 88         &quot;r2NFPcwodd7uVle5JePNag7oyhjOFFEaBGq21dl6/ozVRkqSWWAi1P7MRay9eYj3\n&quot; +</span>
<span class="line-modified"> 89         &quot;mLZiZaL6NlWxXnfzVwIDAQABo2AwXjAdBgNVHQ4EFgQUiKeNoU+FPJsyR4jodIFl\n&quot; +</span>
<span class="line-modified"> 90         &quot;RQDe3UUwHwYDVR0jBBgwFoAUiKeNoU+FPJsyR4jodIFlRQDe3UUwDwYDVR0TAQH/\n&quot; +</span>
<span class="line-modified"> 91         &quot;BAUwAwEB/zALBgNVHQ8EBAMCAQYwDQYJKoZIhvcNAQELBQADggEBAI1Lgf1Sd/iR\n&quot; +</span>
<span class="line-modified"> 92         &quot;pXBW6OKE9Oa6WkZx/hKrtm3tw+m5OTU4veQijMPIIgnXw0QYXFMieWSjSz+OGq+v\n&quot; +</span>
<span class="line-added"> 93         &quot;t5NJWj7afCOADrhswrfAY3q3XY9+HnoXv1OvANFhokos25w6fB9t0lrm5KR+3d8l\n&quot; +</span>
<span class="line-added"> 94         &quot;RwQbxhr8I6tDn2pDExVXRe8k2PYqkabgG6IqPnLzt4iLhPx4ivzo4Zc+zfQZc672\n&quot; +</span>
<span class="line-added"> 95         &quot;oyNJw2/iNufHRsoRa8QqHJM9vziYfChZqdSSlTiqaoyijT0Br6/2yyIKfjjt5Abt\n&quot; +</span>
<span class="line-added"> 96         &quot;cwIDUWqQda62xV7ChkTh7ia3uvBXob2iiB0aI3gVTTqDfK9F5XXtW4BXfqx0hvwB\n&quot; +</span>
<span class="line-added"> 97         &quot;6JzgmNyDQos=\n&quot; +</span>
 98         &quot;-----END CERTIFICATE-----&quot;;
 99     static String trustedPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">100         &quot;MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDUJ3hT/9jY/i8i\n&quot; +</span>
<span class="line-modified">101         &quot;70EEaL6mbrhhdg/Ys1E0r97n+dZaY0olqkIBhh1r8UkKWtvOkj8WBFQ0sz0HhSjT\n&quot; +</span>
<span class="line-modified">102         &quot;rkVEisGLW+7zPJiDBPtQrRawvCDpnzUofnQ98zQKUTHji1OqhxgNzsKCy9vIh5Mh\n&quot; +</span>
<span class="line-modified">103         &quot;tX0CdGUScEDXlYUkAkxMKCVo2V5dRn34D+1rNGEeWxGnQ5vyPi0IwlpEOkYxhPLV\n&quot; +</span>
<span class="line-modified">104         &quot;dsb5aoLzBc/rdrrdzCM+svm7O38LhbVuA0F9NHAgdJRKE2F91ztkk1KvY0U9zCh1\n&quot; +</span>
<span class="line-modified">105         &quot;3u5WV7kl481qDujKGM4UURoEarbV2Xr+jNVGSpJZYCLU/sxFrL15iPeYtmJlovo2\n&quot; +</span>
<span class="line-modified">106         &quot;VbFed/NXAgMBAAECggEAUZvlQ5q1VbNhenTCc+m+/NK2hncd3WQNJtFIU7/dXuO2\n&quot; +</span>
<span class="line-modified">107         &quot;0ApQXbmzc6RbTmppB2tmbRe5NJSGM3BbpiHxb05Y6TyyDEsQ98Vgz0Xl5pJXrsaZ\n&quot; +</span>
<span class="line-modified">108         &quot;cjxChtoY+KcHI9qikoRpElaoqBu3LcpJJLxlnB4eCxu3NbbEgneH1fvTeCO1kvcp\n&quot; +</span>
<span class="line-modified">109         &quot;i3DDdyfY7WB9RW1yWAveiuqvtnbsPfJJLKEhFvZL2ArYCRTm/oIw64yukNe/QLR5\n&quot; +</span>
<span class="line-modified">110         &quot;bGzEJMT2ZNQMld1f+CW9tOrUKrnnPCGfMa351T5we+8B6sujWfftPutgEVx5TmHs\n&quot; +</span>
<span class="line-modified">111         &quot;AOW1SntMapbgg46K9EC/C5YQa5D1aNOH9ZTEMkgUMQKBgQDrpPQIHFozeeyZ0iiq\n&quot; +</span>
<span class="line-modified">112         &quot;HtReLPcqpkwr/9ELc3SjgUypSvpu0l/m++um0yLinlXMn25km/BP6Mv3t/+1uzAc\n&quot; +</span>
<span class="line-modified">113         &quot;qpopkcyek8X1hzNRhDkWuMv4KDOKk5c6qLx8FGSm6q8PYm5KbsiyeCM7CJoeoqJ5\n&quot; +</span>
<span class="line-added">114         &quot;74IZjOIw7UrYLckCb6W8xGQLIwKBgQDmew3vGRR3JmCCSumtJQOqhF6bBYrNb6Qc\n&quot; +</span>
<span class="line-added">115         &quot;r4vrng+QhNIquwGqHKPorAI1J8J1jOS+dkDWTxSz2xQKQ83nsOspzVPskpDh5mWL\n&quot; +</span>
<span class="line-added">116         &quot;gGk5QCkX87jFsXfhvZFLksZMbIdpWze997Zs2fe/PWfPaH6o3erqo2zAhQV0eA9q\n&quot; +</span>
<span class="line-added">117         &quot;C7tfImREPQKBgQDi2Xq/8CN52M9IScQx+dnyC5Gqckt0NCKXxn8sBIa7l129oDMI\n&quot; +</span>
<span class="line-added">118         &quot;187FXA8CYPEyOu14V5KiKvdos66s0daAUlB04lI8+v+g3ZYuzH50/FQHwxPTPUBi\n&quot; +</span>
<span class="line-added">119         &quot;DRzeyncXJWiAA/8vErWM8hDgfOh5w5Fsl4EEfdcmyNm7gWA4Qyknr1ysRwKBgQDC\n&quot; +</span>
<span class="line-added">120         &quot;JSPepUy09VHUTxA59nT5HRmoEeoTFRizxTfi2LkZrphuwCotxoRXiRUu+3f1lyJU\n&quot; +</span>
<span class="line-added">121         &quot;Qb5qCCFTQ5bE8squgTwGcVxhajC66V3ePePlAuPatkWN2ek28X1DoLaDR+Rk3h69\n&quot; +</span>
<span class="line-added">122         &quot;Wb2EQbNMl4grkUUoMA8jaVhBb4vhyQSK+qjyAUFerQKBgQDXZPuflfsjH/d/O2yw\n&quot; +</span>
<span class="line-added">123         &quot;qZbssKe9AKORjv795teblAc3vmsSlNwwVnPdS2aq1LHyoNbetc/OaZV151hTQ/9z\n&quot; +</span>
<span class="line-added">124         &quot;bsA48oOojgrDD07Ovg3uDcNEIufxR0aGeSSvqhElp1r7wAYj8bAr6W/RH6MS16WW\n&quot; +</span>
<span class="line-added">125         &quot;dRd+PH6hsap8BD2RlVCnrT3vIQ==&quot;;</span>
126 
127     // Certificate information:
128     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce
129     // Validity
<span class="line-modified">130     //     Not Before: Dec 20 13:13:44 2019 GMT</span>
<span class="line-modified">131     //     Not After : Dec 17 13:13:44 2029 GMT</span>
132     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce, CN=casigner
133     // X509v3 Subject Key Identifier:
<span class="line-modified">134     //     4B:6D:B0:B0:E6:EF:45:15:35:B5:FC:6B:E2:C7:FC:A6:E6:C4:EC:95</span>
135     // X509v3 Authority Key Identifier:
<span class="line-modified">136     //     keyid:88:A7:8D:A1:4F:85:3C:9B:32:47:88:E8:74:81:65:45:00:DE:DD:45</span>


137     static String caSignerStr =
138         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">139         &quot;MIIDdzCCAl+gAwIBAgIUDYDCpVXk72hlpeNam094GPxl9Z0wDQYJKoZIhvcNAQEL\n&quot; +</span>
<span class="line-modified">140         &quot;BQAwOzELMAkGA1UEBhMCVVMxDTALBgNVBAoMBEphdmExHTAbBgNVBAsMFFN1bkpT\n&quot; +</span>
<span class="line-modified">141         &quot;U0UgVGVzdCBTZXJpdmNlMB4XDTE5MTIyMDEzMTM0NFoXDTI5MTIxNzEzMTM0NFow\n&quot; +</span>
<span class="line-modified">142         &quot;TjELMAkGA1UEBhMCVVMxDTALBgNVBAoMBEphdmExHTAbBgNVBAsMFFN1bkpTU0Ug\n&quot; +</span>
<span class="line-modified">143         &quot;VGVzdCBTZXJpdmNlMREwDwYDVQQDDAhjYXNpZ25lcjCCASIwDQYJKoZIhvcNAQEB\n&quot; +</span>
<span class="line-modified">144         &quot;BQADggEPADCCAQoCggEBAMC8Z4sqVbWWNp567w28MKN9bkE0rZzQLivLsiz7WYzg\n&quot; +</span>
<span class="line-modified">145         &quot;8LsUDhtGkxpAcoiMuxnkPWGgD3Xzdy/enVo/vn9lgw7LHWJ3+FeZt3eOnwFHTBu+\n&quot; +</span>
<span class="line-modified">146         &quot;srFrnf7iU7RLkAvl06lTYBWFx15Dv4PCgvqIC4eo1wAGDcKKOshwV5kdw8zBpkx3\n&quot; +</span>
<span class="line-modified">147         &quot;1jEkbpiuc0cxaNtdMYqmZrTY0wHVSdHGx02mGp9G3aCRSzXyXrr3uxInt5uW9JYR\n&quot; +</span>
<span class="line-modified">148         &quot;bDUGa2uD02jbxRSyIXyrSb2L8bRDNg6tLq+CG6blukcCLHF8D1n+jMes3yB/yA0N\n&quot; +</span>
<span class="line-modified">149         &quot;NGcbqmEPBVvVSP2c7Z/3JMCvHsrPkS1E2YPH1I0xL2sCAwEAAaNgMF4wHQYDVR0O\n&quot; +</span>
<span class="line-modified">150         &quot;BBYEFEttsLDm70UVNbX8a+LH/KbmxOyVMB8GA1UdIwQYMBaAFIinjaFPhTybMkeI\n&quot; +</span>
<span class="line-modified">151         &quot;6HSBZUUA3t1FMA8GA1UdEwEB/wQFMAMBAf8wCwYDVR0PBAQDAgEGMA0GCSqGSIb3\n&quot; +</span>
<span class="line-modified">152         &quot;DQEBCwUAA4IBAQBpwrPMDlCvxRvv91w4oFYhYTV2zj9BecsYQPhbqG9zRiHrJoNE\n&quot; +</span>
<span class="line-modified">153         &quot;dDPxZQnjb3P5u2LAe7Cp+Nah1ZSvjnF1oVk7ct+Usz02InojHxN72xDsZOMLWuAN\n&quot; +</span>
<span class="line-added">154         &quot;3CJhjGp6WyYUstRWybpiJzPehZdYfk+FaMxwM54REAiipDTFO07PZrj1h/aDQ0Tl\n&quot; +</span>
<span class="line-added">155         &quot;7D6w2v1pz1IR/ctuij7sFReFvjFEE4JoTNjfqzNWO4ML1vDHVi5MHeBgUckujOrI\n&quot; +</span>
<span class="line-added">156         &quot;P0QqaqP+xJIY+sRrzdckxSfS9AOOrJk2VXY8qEoxCN4wCvHJWuHEAF/Lm65d/hq3\n&quot; +</span>
<span class="line-added">157         &quot;2Uh8P+QHLeuEwF8RoTpjiGM9dXvaqcQz7w5G\n&quot; +</span>
158         &quot;-----END CERTIFICATE-----&quot;;
159     static String caSignerPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">160         &quot;MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDAvGeLKlW1ljae\n&quot; +</span>
<span class="line-modified">161         &quot;eu8NvDCjfW5BNK2c0C4ry7Is+1mM4PC7FA4bRpMaQHKIjLsZ5D1hoA9183cv3p1a\n&quot; +</span>
<span class="line-modified">162         &quot;P75/ZYMOyx1id/hXmbd3jp8BR0wbvrKxa53+4lO0S5AL5dOpU2AVhcdeQ7+DwoL6\n&quot; +</span>
<span class="line-modified">163         &quot;iAuHqNcABg3CijrIcFeZHcPMwaZMd9YxJG6YrnNHMWjbXTGKpma02NMB1UnRxsdN\n&quot; +</span>
<span class="line-modified">164         &quot;phqfRt2gkUs18l6697sSJ7eblvSWEWw1Bmtrg9No28UUsiF8q0m9i/G0QzYOrS6v\n&quot; +</span>
<span class="line-modified">165         &quot;ghum5bpHAixxfA9Z/ozHrN8gf8gNDTRnG6phDwVb1Uj9nO2f9yTArx7Kz5EtRNmD\n&quot; +</span>
<span class="line-modified">166         &quot;x9SNMS9rAgMBAAECggEAZk6cF/8s5+sIqy9OXdgbaW1XbT1tOuQ23gCOX9o8Os/c\n&quot; +</span>
<span class="line-modified">167         &quot;eTG4GzpnM3QqV9l8J85D1uKD0nSeO8bLd/CGSlG0M9IVkwNjy/xIqyoFtUQHXmLn\n&quot; +</span>
<span class="line-modified">168         &quot;r84UXAv/qqDBoc8pf6RGSKZuodcMfgBuTlaQ6D3zgou0GiQN9//KP/jQyouwnr3A\n&quot; +</span>
<span class="line-modified">169         &quot;LyXQekxriwPuSYAPak8s5XLfugOebbSRm2UdGEgX3yrT9FVu9rtgeMKdRaCOU8T4\n&quot; +</span>
<span class="line-modified">170         &quot;G2UdpGaiDfm5yrR+2XEIv4oaH3WFxmmfQCxVcOFJ1iRvfKBbLb1UCgtJuCBD067y\n&quot; +</span>
<span class="line-modified">171         &quot;dq5PrwUTeAvd7hwZd0lxCSnWY7VvYFNr7iJfyElowQKBgQD8eosot+Th03hpkYDs\n&quot; +</span>
<span class="line-modified">172         &quot;BIVsw7oqhJmcrPV1bSZ+aQwqqrOGypNmb7nLGTC8Cj1sT+EzfGs7GqxiLOEn4NXr\n&quot; +</span>
<span class="line-modified">173         &quot;TYV//RUPBSEXVp2y+2dot1a9oq0BJ8FwGTYL0qSwJrIXJfkQFrYhVVz3JLIWJbwV\n&quot; +</span>
<span class="line-added">174         &quot;cy4YCQr094BhXTS7joJOUDRsYwKBgQDDbI3Lv+bBK8lLfIBll1RY1k5Gqy/H+qxp\n&quot; +</span>
<span class="line-added">175         &quot;sMN8FmadmIGzHhe9xml6b5EfAZphAUF4vZJhQXloT5Wm+NNIAf6X6dRjvzyw7N9B\n&quot; +</span>
<span class="line-added">176         &quot;d48EFJF4ChqNGBocsQRNr2wPRzQ+k2caw9YyYMIjbhktDzO1U/FJGYW6/Vgr2v4K\n&quot; +</span>
<span class="line-added">177         &quot;siROnXfLWQKBgBOVAZQP5z2opC8z7NbhZuPPrnG7xRpEw+jupUyqoxnwEWqD7bjF\n&quot; +</span>
<span class="line-added">178         &quot;M5jQBFqhRLBQ5buTi9GSuQoIRxJLuuu8IH2TyH1YvX9M5YBLRXL2vVCJ/HcZeURT\n&quot; +</span>
<span class="line-added">179         &quot;gECcfs92wNtQw6d+y3N8ZnB4tSNIm/Th8RJGKUZkp91lWECvxeWDDP3XAoGASfNq\n&quot; +</span>
<span class="line-added">180         &quot;NRAJYlAPfGFAtTDu2i8+r79X9XUGiXg6gVp4umpbqkxY75eFkq9lWzZgFRVEkUwr\n&quot; +</span>
<span class="line-added">181         &quot;eGIubyquluDSEw2uKg5yMMzNSqZYVY3IsOKXqbUpFvtn5jOWTU90tNNdEdD100sI\n&quot; +</span>
<span class="line-added">182         &quot;Y0f6Ly4amNKH3rZFOERQNtJn6zCTsbh3xMgR7QECgYBhQTqxLU5eIu38MKobzRue\n&quot; +</span>
<span class="line-added">183         &quot;RoUkMcoY3DePkKPSYjilFhkUDozIXf/xUGnB8kERZKO+44wUkuPGljiFL1/P/RO9\n&quot; +</span>
<span class="line-added">184         &quot;zhHAV94Kw2ddtfxy05GVtUZ99miBmsMb2m8vumGJqfR8h2xpfc1Ra0zfrsPgLNru\n&quot; +</span>
<span class="line-added">185         &quot;xDTDW+bNbM7XyPvg9mOf7Q==&quot;;</span>
186 
187     // Certificate information:
188     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce, CN=casigner
189     // Validity
190     //     Not Before: May  5 02:40:57 2012 GMT
191     //     Not After : Jan 21 02:40:57 2032 GMT
192     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce, CN=certissuer
193     // X509v3 Subject Key Identifier:
<span class="line-modified">194     //     B4:E8:EA:80:A9:2B:F5:62:B5:2C:A6:F8:FF:65:BC:CF:51:40:9C:15</span>
195     // X509v3 Authority Key Identifier:
<span class="line-modified">196     //     keyid:4B:6D:B0:B0:E6:EF:45:15:35:B5:FC:6B:E2:C7:FC:A6:E6:C4:EC:95</span>


197     static String certIssuerStr =
198         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">199         &quot;MIIDjDCCAnSgAwIBAgIUJWLHjJR9tY2/5DX3iOcZ2JRKY8cwDQYJKoZIhvcNAQEL\n&quot; +</span>
<span class="line-modified">200         &quot;BQAwTjELMAkGA1UEBhMCVVMxDTALBgNVBAoMBEphdmExHTAbBgNVBAsMFFN1bkpT\n&quot; +</span>
<span class="line-modified">201         &quot;U0UgVGVzdCBTZXJpdmNlMREwDwYDVQQDDAhjYXNpZ25lcjAeFw0xOTEyMjAxMzEz\n&quot; +</span>
<span class="line-modified">202         &quot;NDVaFw0yOTEyMTcxMzEzNDVaMFAxCzAJBgNVBAYTAlVTMQ0wCwYDVQQKDARKYXZh\n&quot; +</span>
<span class="line-modified">203         &quot;MR0wGwYDVQQLDBRTdW5KU1NFIFRlc3QgU2VyaXZjZTETMBEGA1UEAwwKY2VydGlz\n&quot; +</span>
<span class="line-modified">204         &quot;c3VlcjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALWUNWnObPBso4vI\n&quot; +</span>
<span class="line-modified">205         &quot;VaSM+Oq1f3EsyrtJWqhu+EG/5UKEwYaNBs1A9u1zM5xc05y4wXJfFj755djtzfsz\n&quot; +</span>
<span class="line-modified">206         &quot;OFt1ke/hjhpYSf4DcSJfb99MBvHHXrmrEqIdsPYSaUqT9DrIi+L0z0Rdev++IQJj\n&quot; +</span>
<span class="line-modified">207         &quot;j9J213gpi18RNrQWl8Xn9mlkxhCjwj1GoFA6aF+9cvWX8uh2Vrl6Vm28hTKnmTad\n&quot; +</span>
<span class="line-modified">208         &quot;FB7nwDF4/mGuKVsiB+YTJJ/2Y6RpNqVF/Z6kET/BE0DtCLlKvY7iljbHc892YzI0\n&quot; +</span>
<span class="line-modified">209         &quot;vhxlo4lOB3J4NhsQxJbq+mIlbbqZr+p4WA8hdnwI4UlktI4S7fXQzhA51JHVjZyX\n&quot; +</span>
<span class="line-modified">210         &quot;f9XYTRUCAwEAAaNgMF4wHQYDVR0OBBYEFLTo6oCpK/VitSym+P9lvM9RQJwVMB8G\n&quot; +</span>
<span class="line-modified">211         &quot;A1UdIwQYMBaAFEttsLDm70UVNbX8a+LH/KbmxOyVMA8GA1UdEwEB/wQFMAMBAf8w\n&quot; +</span>
<span class="line-modified">212         &quot;CwYDVR0PBAQDAgEGMA0GCSqGSIb3DQEBCwUAA4IBAQCGrjnGs23pQkQoUu8+C2y/\n&quot; +</span>
<span class="line-modified">213         &quot;OAT5k9uyPCcLxFPM+Hon5WI6DACxpj7mu2ekN0fswu6B7beQVygpnNSQFVqLrJw1\n&quot; +</span>
<span class="line-added">214         &quot;daYdhTMzkNCkPk6q0cUmj5k94jfCHBl4jw+qoZiIehuR9qFHhpLkT4zMTkFof+P+\n&quot; +</span>
<span class="line-added">215         &quot;Lfc92QJppUAOh3jTvHK01YwP2sxK3KXhcbofQnxGS4WHrqmmZC2YO/LQRoYDZdUY\n&quot; +</span>
<span class="line-added">216         &quot;zr4da2aIg9CKrH2QWoMkDfRKkJvrU3/VhVfVWpNbXFE2xZXftQl3hpFCJ3FkpciA\n&quot; +</span>
<span class="line-added">217         &quot;l3hKeq4byY3LXxhAClHpk1KkXJkMnQdOfA5aGekj/Cjuaz1/iKYAG2vRq7YcuM/o\n&quot; +</span>
218         &quot;-----END CERTIFICATE-----&quot;;
219     static String certIssuerPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">220         &quot;MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQC1lDVpzmzwbKOL\n&quot; +</span>
<span class="line-modified">221         &quot;yFWkjPjqtX9xLMq7SVqobvhBv+VChMGGjQbNQPbtczOcXNOcuMFyXxY++eXY7c37\n&quot; +</span>
<span class="line-modified">222         &quot;MzhbdZHv4Y4aWEn+A3EiX2/fTAbxx165qxKiHbD2EmlKk/Q6yIvi9M9EXXr/viEC\n&quot; +</span>
<span class="line-modified">223         &quot;Y4/Sdtd4KYtfETa0FpfF5/ZpZMYQo8I9RqBQOmhfvXL1l/Lodla5elZtvIUyp5k2\n&quot; +</span>
<span class="line-modified">224         &quot;nRQe58AxeP5hrilbIgfmEySf9mOkaTalRf2epBE/wRNA7Qi5Sr2O4pY2x3PPdmMy\n&quot; +</span>
<span class="line-modified">225         &quot;NL4cZaOJTgdyeDYbEMSW6vpiJW26ma/qeFgPIXZ8COFJZLSOEu310M4QOdSR1Y2c\n&quot; +</span>
<span class="line-modified">226         &quot;l3/V2E0VAgMBAAECggEBAJjfVrjl2kHwtSCSYchQB6FTfSBDnctgTrtP8iMo9FO0\n&quot; +</span>
<span class="line-modified">227         &quot;gVpOkVNtRndTbjhOzro7smIgPBJ5QlIIpErBLMmTinJza7gybNk2/KD7yKwuzgnw\n&quot; +</span>
<span class="line-modified">228         &quot;2IdoyB9E8B+8EHmBZzW2ck953KaqLUvzPsdMG2IOPAomr/gx/eRQwScVzBefiEGo\n&quot; +</span>
<span class="line-modified">229         &quot;sN+rGfUt/RNAHwWje1KuNDj21S84agQhN6hdYUnIMsvJLu/9mOwUb9ff+AzTUfFr\n&quot; +</span>
<span class="line-modified">230         &quot;zyx2MJL4Cx59DkUUMESCfinlHUc21llQjFWmX/zOoGY0X0qV/YM/GRsv1ZDFHw9o\n&quot; +</span>
<span class="line-modified">231         &quot;hQ6m8Ov7D9wB3TKZBI97sCyggjBfSeuYQlNbs99KWQECgYEA7IKNL0ME7FuIrKYu\n&quot; +</span>
<span class="line-modified">232         &quot;FCQ/Duz1N3oQXLzrTGKUSU1qSbrU2Jwk4SfJ8ZYCW1TP6vZkaQsTXmXun3yyCAqZ\n&quot; +</span>
<span class="line-modified">233         &quot;hcOtDBhI+b7Wpmmyf6nb83oYJtzHMRQZ5qS+9vOBfV9Uf1za8XI4p90EqkFHByCF\n&quot; +</span>
<span class="line-added">234         &quot;tHfjVbjK39zN4CvaO3tqpOaYtL0CgYEAxIrTAhGWy9nBsxf8QeqDou0rV5Cw50Kl\n&quot; +</span>
<span class="line-added">235         &quot;kQsE7KLmjvrMaFFpUc5lgWoC+pm/69VpNBUuN/38YozwxVjVi/nMJuuK150mhdWI\n&quot; +</span>
<span class="line-added">236         &quot;B28FI7ORnFmVeSvTrP4mBX1ct2Tny9zpchXn3rpHR5NZUs7oBhjudHSfRMrHxeBs\n&quot; +</span>
<span class="line-added">237         &quot;Kv2pr2s6uzkCgYAtrEh3iAm7WzHZpX3ghd9nknsIa5odTp5h8eeRAFI2Ss4vxneY\n&quot; +</span>
<span class="line-added">238         &quot;w4ZMERwDZy1/wnVBk9H5uNWMFxiKVQGww0j3vPjawe/R0zeVT8gaDMn9N0WARNF7\n&quot; +</span>
<span class="line-added">239         &quot;qPT3265196LptZTSa6xlPllYR6LfzXgEkeJk+3qyIIHheJZ8RikiDyYOQQKBgQC/\n&quot; +</span>
<span class="line-added">240         &quot;rxlegiMNC4KDldf7vanGxAKqcz5lPbXWQOX7mGC+f9HNx+Cs3VxYHDltiXgJnOju\n&quot; +</span>
<span class="line-added">241         &quot;191s1HRK9WR5REt5KhY2uzB9WxJQItJ5VYiwqhhQYXqLY/gdVv1kC0DayDndtMWk\n&quot; +</span>
<span class="line-added">242         &quot;88JhklGkeAv83DikgbpGr9sJr6+oyFkWkLDmmfD82QKBgQCMgkZJzrdSNNlB0n5x\n&quot; +</span>
<span class="line-added">243         &quot;xC3MzlsQ5aBJuUctnMfuyDi+11yLAuP1oLzGEJ7qEfFoGRO0V8zJWmHAfNhmVYEX\n&quot; +</span>
<span class="line-added">244         &quot;ow5g0WbPT16GoRCiOAzq+ewH+TEELMF6HWqnDuTnCg28Jg0dw2kdVTqeyzKOQlLG\n&quot; +</span>
<span class="line-added">245         &quot;ua9c2DY3PUTXQPNqLVhz+XxZKA==&quot;;</span>
246 
247     // Certificate information:
248     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce, CN=certissuer
249     // Validity
<span class="line-modified">250     //     Not Before: Dec 20 13:13:45 2019 GMT</span>
<span class="line-modified">251     //     Not After : Dec 17 13:13:45 2029 GMT</span>
252     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce, CN=localhost
253     // X509v3 Subject Key Identifier:
<span class="line-modified">254     //     46:FC:94:7A:61:6D:BF:5F:AE:D7:20:EC:BF:6A:74:2A:26:F1:D4:4C</span>
255     // X509v3 Authority Key Identifier:
<span class="line-modified">256     //     keyid:B4:E8:EA:80:A9:2B:F5:62:B5:2C:A6:F8:FF:65:BC:CF:51:40:9C:15</span>
257     static String serverCertStr =
258         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">259         &quot;MIIDfDCCAmSgAwIBAgIUHsJi1HTWpR3FCiOiG/qLK6BDluwwDQYJKoZIhvcNAQEL\n&quot; +</span>
<span class="line-modified">260         &quot;BQAwUDELMAkGA1UEBhMCVVMxDTALBgNVBAoMBEphdmExHTAbBgNVBAsMFFN1bkpT\n&quot; +</span>
<span class="line-modified">261         &quot;U0UgVGVzdCBTZXJpdmNlMRMwEQYDVQQDDApjZXJ0aXNzdWVyMB4XDTE5MTIyMDEz\n&quot; +</span>
<span class="line-modified">262         &quot;MTM0NVoXDTI5MTIxNzEzMTM0NVowTzELMAkGA1UEBhMCVVMxDTALBgNVBAoMBEph\n&quot; +</span>
<span class="line-modified">263         &quot;dmExHTAbBgNVBAsMFFN1bkpTU0UgVGVzdCBTZXJpdmNlMRIwEAYDVQQDDAlsb2Nh\n&quot; +</span>
<span class="line-modified">264         &quot;bGhvc3QwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCaDgoxN2UQQero\n&quot; +</span>
<span class="line-modified">265         &quot;oBQ4JlQP1BFaZEtIkdIU2VJs4whz85J0LSB/68iEOS5e8wCz9wiQWr4isor7sl3e\n&quot; +</span>
<span class="line-modified">266         &quot;B2dnLGY28BthOTw2j/CYw/dRqyDbPZniooB233uLGarKjqQWXpRFQi6bgEQmNqWe\n&quot; +</span>
<span class="line-modified">267         &quot;C32w+V+Oq3CTkinwgPvA5mnSe0P8gpF9NLZBFn0TtxaY0bQIie2WNk/HjrVQIhq3\n&quot; +</span>
<span class="line-modified">268         &quot;qmG/zVxeBc3PVOOU/OKrwjHbim9YI+zdDRXjNm8siHi0RF2+fkxfyAm8Qg+mT8L4\n&quot; +</span>
<span class="line-modified">269         &quot;xdtr0a+eP4oIvkymRURxIrXNnvoX+MhYKSOQnizpW0NMOZ5L9nyw1cYX8j9Ed6eM\n&quot; +</span>
<span class="line-modified">270         &quot;kzxZwRrlAgMBAAGjTzBNMB0GA1UdDgQWBBRG/JR6YW2/X67XIOy/anQqJvHUTDAf\n&quot; +</span>
<span class="line-modified">271         &quot;BgNVHSMEGDAWgBS06OqAqSv1YrUspvj/ZbzPUUCcFTALBgNVHQ8EBAMCA+gwDQYJ\n&quot; +</span>
<span class="line-modified">272         &quot;KoZIhvcNAQELBQADggEBAGXHGefA1j136yenwK+j9K5VnG2kYGXCadi9bKtTXf/X\n&quot; +</span>
<span class="line-added">273         &quot;6Xasb7QE2QWEIlq+78AaV9Dwc7qk1TuBsN05LbQUSe7h5UAfS4AZ5l/XSay2cxrZ\n&quot; +</span>
<span class="line-added">274         &quot;TKoyuzh9kj38QkEBxZlrClyBzU8Mct0L9F8yEm4V7AqQOshn9gEQl9lzJUb2KHeZ\n&quot; +</span>
<span class="line-added">275         &quot;AxblrQhPQDrWhmQjQkl/xaiOiU31sHKTnB/L2CKvJtmsKIyBdrQCQTlIOcRu4/PQ\n&quot; +</span>
<span class="line-added">276         &quot;4z/sjecKP08Xkf5+p4RzPL+OZHkJoejSEjBndLC8BK9IZD94kHZYDz8ulWrQJ5Nr\n&quot; +</span>
<span class="line-added">277         &quot;u/inkyf8NcG7zLBJJyuKfUXO/OzGPD5QMviVc+PCGTY=\n&quot; +</span>
278         &quot;-----END CERTIFICATE-----&quot;;
279     static String serverPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">280         &quot;MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCaDgoxN2UQQero\n&quot; +</span>
<span class="line-modified">281         &quot;oBQ4JlQP1BFaZEtIkdIU2VJs4whz85J0LSB/68iEOS5e8wCz9wiQWr4isor7sl3e\n&quot; +</span>
<span class="line-modified">282         &quot;B2dnLGY28BthOTw2j/CYw/dRqyDbPZniooB233uLGarKjqQWXpRFQi6bgEQmNqWe\n&quot; +</span>
<span class="line-modified">283         &quot;C32w+V+Oq3CTkinwgPvA5mnSe0P8gpF9NLZBFn0TtxaY0bQIie2WNk/HjrVQIhq3\n&quot; +</span>
<span class="line-modified">284         &quot;qmG/zVxeBc3PVOOU/OKrwjHbim9YI+zdDRXjNm8siHi0RF2+fkxfyAm8Qg+mT8L4\n&quot; +</span>
<span class="line-modified">285         &quot;xdtr0a+eP4oIvkymRURxIrXNnvoX+MhYKSOQnizpW0NMOZ5L9nyw1cYX8j9Ed6eM\n&quot; +</span>
<span class="line-modified">286         &quot;kzxZwRrlAgMBAAECggEBAIPF4p36ni3r1H2q/+CPmHP5l+ZTx7mJUcOXqNOO11on\n&quot; +</span>
<span class="line-modified">287         &quot;TGyndRc2ncvMBYgeH8nQUrj3hY+0XQGyrmwOtTohVkVD2IevJ3wcX1asuU5YLMCb\n&quot; +</span>
<span class="line-modified">288         &quot;zpd3HJ+RxeFT0S12GZEw0W70j11ft+tf7wZjGd5ZUI1+w8rWyZz5F18HOBlcauj/\n&quot; +</span>
<span class="line-modified">289         &quot;iqMgrlVLZ7qXEb6WV9zP5hWx5nZwrnuuiM1zXLVuO9rg7qk+zCts2oyM8KRTfQIi\n&quot; +</span>
<span class="line-modified">290         &quot;Zo3VDO0nwnEoxxTQ/2g2g/jBJ1GiFygiFm/i2SHQOJgaFS3Y3InjWEAiINIsdMIt\n&quot; +</span>
<span class="line-modified">291         &quot;yZk6twMG6ODjy8agZ4LLhZSyCkC33AN7MIkSCtvFubkCgYEAyRm+yvYxwiHCzZV8\n&quot; +</span>
<span class="line-modified">292         &quot;LZNuBBRliujgG41iuyUyRVBSaMyJMNRoOMm8XwDOF1BA44YPz4yCkfiiEk2ub/f0\n&quot; +</span>
<span class="line-modified">293         &quot;hDhfBW3EWvYHrWkEbx9Th2YmFq20JlgcBGaM2TiiL+qx4ct687idPbJVZnwc4HtR\n&quot; +</span>
<span class="line-added">294         &quot;Kc0eTwRlFsf2O3rwIy52mvIf/48CgYEAxBxsllVz7+/nm0UcxwHNDN+bPyDBxsu9\n&quot; +</span>
<span class="line-added">295         &quot;QuSyR+zSnfcL6xaS4SClBLKxHSjbJ2Hi+UOXezO+eozDp/zEFI6BygNRKTaLTVKr\n&quot; +</span>
<span class="line-added">296         &quot;ezk9rbyKydRIXNlxFoX07U0KlD4lCrbrpsvcO/OlzJe6q5R0B/CIQmx2Y4wlRrE/\n&quot; +</span>
<span class="line-added">297         &quot;Tu+hsf3tBEsCgYBBltsKmXerKJW/tbS1rLMiM4DW6JNHiTqdbUlTIBpwwd0xBuYj\n&quot; +</span>
<span class="line-added">298         &quot;N3Dvz3RoWC2Bx9TaTaq8b0p1C88MB+RBR51+SMnVHQ9t+KWQlLgKnj9oACmUpAIn\n&quot; +</span>
<span class="line-added">299         &quot;UUc5BeaoGDUCPvqQCTOHzuVZsrs8YBwdtR/gh79sybU+ux8damcWrEfRcwKBgEsU\n&quot; +</span>
<span class="line-added">300         &quot;HrZHLMWU8PROtz+w/tGI4aR/Y/A5m9F6QI6sqc10AQoVcFHj74km6Auj0pL3NK/9\n&quot; +</span>
<span class="line-added">301         &quot;Ioc2Phwou9caO+8qx6GRN4cxrI8DsUbRmT1kSzYNoU56qILY8fXPYtdyGzhI41rN\n&quot; +</span>
<span class="line-added">302         &quot;/RiupLD4/awmf21ytpfHcmOWCcdQoE4WC69a6VyVAoGAboeogM5/TRKj80rXfUH2\n&quot; +</span>
<span class="line-added">303         &quot;lFZzgX246XGwNyOVVgOuv/Oxa61b5FeeCpnFQcjpZmC5vd63X3w7oYSDe2wUt+Wh\n&quot; +</span>
<span class="line-added">304         &quot;LhYunmcCEj+yb3of33loQb/FM2OLW9UoQakB7ewio9vtw+BAnWxnHFkEaqdxMXpy\n&quot; +</span>
<span class="line-added">305         &quot;TiSXLpQ1Q9GvDpzngDzJzzY=&quot;;</span>
306 
307     // Certificate information:
308     // Issuer: C=US, O=Java, OU=SunJSSE Test Serivce, CN=certissuer
309     // Validity
<span class="line-modified">310     //     Not Before: Dec 20 14:21:29 2019 GMT</span>
<span class="line-modified">311     //     Not After : Dec 17 14:21:29 2029 GMT</span>
312     // Subject: C=US, O=Java, OU=SunJSSE Test Serivce, CN=InterOp Tester
313     // X509v3 Subject Key Identifier:
<span class="line-modified">314     //     1F:E4:C0:F5:B8:68:DB:D2:EB:9E:6F:BB:B5:9E:92:6D:BA:7D:97:3A</span>
315     // X509v3 Authority Key Identifier:
<span class="line-modified">316     //     keyid:B4:E8:EA:80:A9:2B:F5:62:B5:2C:A6:F8:FF:65:BC:CF:51:40:9C:15</span>
317     static String clientCertStr =
318         &quot;-----BEGIN CERTIFICATE-----\n&quot; +
<span class="line-modified">319         &quot;MIIDgTCCAmmgAwIBAgIUHFQOStLURT5sQ57OWO2z8iNJ9P8wDQYJKoZIhvcNAQEL\n&quot; +</span>
<span class="line-modified">320         &quot;BQAwUDELMAkGA1UEBhMCVVMxDTALBgNVBAoMBEphdmExHTAbBgNVBAsMFFN1bkpT\n&quot; +</span>
<span class="line-modified">321         &quot;U0UgVGVzdCBTZXJpdmNlMRMwEQYDVQQDDApjZXJ0aXNzdWVyMB4XDTE5MTIyMDE0\n&quot; +</span>
<span class="line-modified">322         &quot;MjEyOVoXDTI5MTIxNzE0MjEyOVowVDELMAkGA1UEBhMCVVMxDTALBgNVBAoMBEph\n&quot; +</span>
<span class="line-modified">323         &quot;dmExHTAbBgNVBAsMFFN1bkpTU0UgVGVzdCBTZXJpdmNlMRcwFQYDVQQDDA5JbnRl\n&quot; +</span>
<span class="line-modified">324         &quot;ck9wIFRlc3RlcjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMXA3NV+\n&quot; +</span>
<span class="line-modified">325         &quot;pDnwnQgXFQ7WeDtcTe4qDQV9tDj9cRZFqQXo94C30lkuXzdH761bZB84DESV0qLI\n&quot; +</span>
<span class="line-modified">326         &quot;k6/n+D9SOsg7SPe7uejG24rph/VpPANrPXo8jxwh/KW+8y0pYNigFUZDi+mEDAOG\n&quot; +</span>
<span class="line-modified">327         &quot;gyqaAbahQePDYTa09uY3MTTOcaUnKZEJkfVZnmrwmcH7qapCCz0N4Mv6Xddi87Fk\n&quot; +</span>
<span class="line-modified">328         &quot;j9R225XXW5ZZ+jwVGi1WubjxqLpbQo9VwdTgozBfxwzjQQWDOlUIics3RRaV4Yz0\n&quot; +</span>
<span class="line-modified">329         &quot;F3Sr4xZiq09O4x8ZT8jrQgduzVZhWjc7rHHbBeMmVBhOveSCvu54onZ2Y+G7+xU/\n&quot; +</span>
<span class="line-modified">330         &quot;Zc1Z6s2Wb5N2I40CAwEAAaNPME0wHQYDVR0OBBYEFB/kwPW4aNvS655vu7Wekm26\n&quot; +</span>
<span class="line-modified">331         &quot;fZc6MB8GA1UdIwQYMBaAFLTo6oCpK/VitSym+P9lvM9RQJwVMAsGA1UdDwQEAwID\n&quot; +</span>
<span class="line-added">332         &quot;6DANBgkqhkiG9w0BAQsFAAOCAQEAdgWs2wVkPoOrShdYTJM2/v7sDYENCsj3VGEq\n&quot; +</span>
<span class="line-added">333         &quot;NvTeL98FCjRZhRmozVi0mli6z2LjDM/858vZoJWDJ08O0XvhXT4yJWWHCJz4xTY1\n&quot; +</span>
<span class="line-added">334         &quot;GBern25Y8VjZGUwAIzK3EDjYzJCZpbhBREF8XZx46OxHt04BKtQwJKBtpJ1/6bRS\n&quot; +</span>
<span class="line-added">335         &quot;wvia3wGspFLW78P2Y5rFXzqptaqBD06Dcc4xBgvFLSocSKUzLc8BdNsixtPBQZNs\n&quot; +</span>
<span class="line-added">336         &quot;l3X3TUNYoYW677E7EWO8NHUJg+2Qbpo11tkb0AyScSxOu2aHuPfYIchRZXnDdq20\n&quot; +</span>
<span class="line-added">337         &quot;tL85OZz8ov7d2jVet/w7FD4M5XfcogsNtpX4kaMsctyvQbDYRA==\n&quot; +</span>
338         &quot;-----END CERTIFICATE-----&quot;;
339     static String clientPrivateKey = // Private key in the format of PKCS#8
<span class="line-modified">340         &quot;MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDFwNzVfqQ58J0I\n&quot; +</span>
<span class="line-modified">341         &quot;FxUO1ng7XE3uKg0FfbQ4/XEWRakF6PeAt9JZLl83R++tW2QfOAxEldKiyJOv5/g/\n&quot; +</span>
<span class="line-modified">342         &quot;UjrIO0j3u7noxtuK6Yf1aTwDaz16PI8cIfylvvMtKWDYoBVGQ4vphAwDhoMqmgG2\n&quot; +</span>
<span class="line-modified">343         &quot;oUHjw2E2tPbmNzE0znGlJymRCZH1WZ5q8JnB+6mqQgs9DeDL+l3XYvOxZI/UdtuV\n&quot; +</span>
<span class="line-modified">344         &quot;11uWWfo8FRotVrm48ai6W0KPVcHU4KMwX8cM40EFgzpVCInLN0UWleGM9Bd0q+MW\n&quot; +</span>
<span class="line-modified">345         &quot;YqtPTuMfGU/I60IHbs1WYVo3O6xx2wXjJlQYTr3kgr7ueKJ2dmPhu/sVP2XNWerN\n&quot; +</span>
<span class="line-modified">346         &quot;lm+TdiONAgMBAAECggEBAK3PX8n+L1YFl9++efG6q55w+MX2C8/htn/IspbCz1a0\n&quot; +</span>
<span class="line-modified">347         &quot;dqWZ67YavfGWtqCGDTArUQ0PKj2NUdFwb48oNSY8hVvIkhR4hApKTAd1YRwYK8a+\n&quot; +</span>
<span class="line-modified">348         &quot;Z4JwlOERPidZkReVTF2fjN/IAc8vcSYGiq78eS85UL6Gu+OIayVgth5Ul4I1CSa8\n&quot; +</span>
<span class="line-modified">349         &quot;+b0n/RAI+yk2HxKlkq40Ofn0VWiGg1dLP2MPwwPNIk+w7nKUysfPmXCHfyBr+CZv\n&quot; +</span>
<span class="line-modified">350         &quot;1BQ0E/tVau9wsyCjO6wxFsAKteBGdYa0ToEeT0D8MEeY9leKhAAxRneBVCz9AfHj\n&quot; +</span>
<span class="line-modified">351         &quot;wMGYucxwL0cDLi1IjZB5wlvm5JPqNCKrkHE2XE+UyTkCgYEA/iNP11cqHNPItoXP\n&quot; +</span>
<span class="line-modified">352         &quot;D2wN4uX60kLNbzZ2dOF1ItybS8OcQvTxA1XulARiCVDIT/+QDETbDQclfhgMOfhe\n&quot; +</span>
<span class="line-modified">353         &quot;ZCdMrL5RG0YTwg9OGbLcA+8gqd9e/3gs9g8pWNdCfuGIwsnJbpO7iBoCBzHaHHJJ\n&quot; +</span>
<span class="line-added">354         &quot;PbWDFS6jxvsqKIGPPwrhL9yp4VMCgYEAxzPKNLclBHorUs9rYRqiG9NTkLRNx4ll\n&quot; +</span>
<span class="line-added">355         &quot;LUh0FBItOnG85BxkjQaIlzimNvXZEzZnpOtblugAszxFyq2KTEE9qeB/V3w3FkXi\n&quot; +</span>
<span class="line-added">356         &quot;PSpDG5sdRHnl5Qu4PuQ9WsmN7g193tOEdtWQ4NKxPqlC72ehqVDOY7In2quYLUiq\n&quot; +</span>
<span class="line-added">357         &quot;C377esv0658CgYAJ0I1N0LT0pg0zV1mWy+KBZ8ZXBnNunxjWDLr8XK62r1hCkbkZ\n&quot; +</span>
<span class="line-added">358         &quot;GuF63+x1VaRWypTilGotR6BgDUezmW7zyTzB0xvIxN0QeozWmzy5/isxxEmj7h02\n&quot; +</span>
<span class="line-added">359         &quot;Z4F+R9nukoE4nJhl59ivOenoIzm8LYG8m1zznXh/v8VyCQbiNWZa9dettwKBgQDB\n&quot; +</span>
<span class="line-added">360         &quot;Yz4DP2noltJIaqXMd5a5fMe7y89Wz8Qx2g0XDy5pdtHygr37S0R/yrdS1AoR5Ndp\n&quot; +</span>
<span class="line-added">361         &quot;/DPGpSVI3FLFGQUSUqQSr6fwvt6b+OxShRzxR/155P2TB3WvWNVXtiTb3q08Dgyj\n&quot; +</span>
<span class="line-added">362         &quot;cWJdYS5BrwEUen8vaQt1LhgS6lOqYsjysCxkYm078QKBgEJuq4RzecgiGx8srWDb\n&quot; +</span>
<span class="line-added">363         &quot;pQKpxrdEt82Y7OXLVj+W9vixcW/xUYhDYGsfdUigZoOjo4nV8KVmMbuI48PIYwnw\n&quot; +</span>
<span class="line-added">364         &quot;haLwWrBWlki4x9MRwuZUdewOYoo7hDZToZmIDescdiwv8CA/Dg9kOX3YYLPW+cWl\n&quot; +</span>
<span class="line-added">365         &quot;i1pnyMPaloBOhz3Y07sWXxCz&quot;;</span>
366 
367     static char passphrase[] = &quot;passphrase&quot;.toCharArray();
368 
369     /*
370      * Is the server ready to serve?
371      */
372     volatile static boolean serverReady = false;
373 
374     /*
375      * Turn on SSL debugging?
376      */
377     static boolean debug = false;
378 
379     /*
380      * Define the server side of the test.
381      *
382      * If the server prematurely exits, serverReady will be set to true
383      * to avoid infinite hangs.
384      */
385     void doServerSide() throws Exception {
386         SSLContext context = getSSLContext(true);
387         SSLServerSocketFactory sslssf = context.getServerSocketFactory();
388 
389         SSLServerSocket sslServerSocket =
<span class="line-modified">390                 (SSLServerSocket) sslssf.createServerSocket(serverPort);</span>
391         serverPort = sslServerSocket.getLocalPort();
392         SSLSocket sslSocket = null;
393         try {
394             /*
395              * Signal Client, we&#39;re ready for his connect.
396              */
397             serverReady = true;
398 
399             sslSocket = (SSLSocket) sslServerSocket.accept();
400             sslSocket.setNeedClientAuth(true);
401 
402             InputStream sslIS = sslSocket.getInputStream();
403             OutputStream sslOS = sslSocket.getOutputStream();
404 
405             sslIS.read();
406             sslOS.write(85);
407             sslOS.flush();
408         } finally {
409             if (sslSocket != null) {
410                 sslSocket.close();
</pre>
<hr />
<pre>
414     }
415 
416     /*
417      * Define the client side of the test.
418      *
419      * If the server prematurely exits, serverReady will be set to true
420      * to avoid infinite hangs.
421      */
422     void doClientSide() throws Exception {
423         /*
424          * Wait for server to get started.
425          */
426         while (!serverReady) {
427             Thread.sleep(50);
428         }
429 
430         SSLContext context = getSSLContext(false);
431         SSLSocketFactory sslsf = context.getSocketFactory();
432 
433         SSLSocket sslSocket =
<span class="line-modified">434                 (SSLSocket) sslsf.createSocket(&quot;localhost&quot;, serverPort);</span>

435         try {
436             InputStream sslIS = sslSocket.getInputStream();
437             OutputStream sslOS = sslSocket.getOutputStream();
438 
439             sslOS.write(280);
440             sslOS.flush();
441             sslIS.read();
442         } finally {
443             sslSocket.close();
444         }
445     }
446 
447     // get the ssl context
448     private static SSLContext getSSLContext(boolean isServer) throws Exception {
449 
450         // generate certificate from cert string
451         CertificateFactory cf = CertificateFactory.getInstance(&quot;X.509&quot;);
452 
453         // create a key store
454         KeyStore ks = KeyStore.getInstance(&quot;JKS&quot;);
</pre>
<hr />
<pre>
515     }
516 
517     private static String tmAlgorithm;        // trust manager
518 
519     private static void parseArguments(String[] args) {
520         tmAlgorithm = args[0];
521     }
522 
523     /*
524      * =============================================================
525      * The remainder is just support stuff
526      */
527 
528     // use any free port by default
529     volatile int serverPort = 0;
530 
531     volatile Exception serverException = null;
532     volatile Exception clientException = null;
533 
534     public static void main(String args[]) throws Exception {






535         if (debug)
536             System.setProperty(&quot;javax.net.debug&quot;, &quot;all&quot;);
537 

538         /*
539          * Get the customized arguments.
540          */
541         parseArguments(args);
542 
543         /*
544          * Start the tests.
545          */
546         new BasicConstraints();
547     }
548 
549     Thread clientThread = null;
550     Thread serverThread = null;
551     /*
552      * Primary constructor, used to drive remainder of the test.
553      *
554      * Fork off the other side, then do your work.
555      */
556     BasicConstraints() throws Exception {
557         if (separateServerThread) {
</pre>
<hr />
<pre>
611     void startClient(boolean newThread) throws Exception {
612         if (newThread) {
613             clientThread = new Thread() {
614                 public void run() {
615                     try {
616                         doClientSide();
617                     } catch (Exception e) {
618                         /*
619                          * Our client thread just died.
620                          */
621                         System.err.println(&quot;Client died...&quot;);
622                         clientException = e;
623                     }
624                 }
625             };
626             clientThread.start();
627         } else {
628             doClientSide();
629         }
630     }

631 }
</pre>
</td>
</tr>
</table>
<center><a href="../SSLSocketImpl/NoImpactServerRenego.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SelfIssuedCert.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>