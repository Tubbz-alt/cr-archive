<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jdk/sanity/client/lib/SwingSet3/src/com/sun/swingset3/demos/colorchooser/BezierAnimationPanel.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../TEST.properties.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../tree/TreeDemo.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sanity/client/lib/SwingSet3/src/com/sun/swingset3/demos/colorchooser/BezierAnimationPanel.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -26,229 +26,237 @@</span>
  import java.awt.*;
  import java.awt.event.HierarchyEvent;
  import java.awt.event.HierarchyListener;
  import java.awt.geom.GeneralPath;
  import java.awt.image.BufferedImage;
<span class="udiff-line-added">+ import java.lang.reflect.InvocationTargetException;</span>
  import java.util.Hashtable;
  import java.util.Map;
  import javax.swing.*;
  
  import static com.sun.swingset3.demos.colorchooser.BezierAnimationPanel.BezierColor.*;
  
  /**
<span class="udiff-line-modified-removed">- * BezierAnimationPanel</span>
<span class="udiff-line-modified-removed">- *</span>
<span class="udiff-line-modified-removed">- * @author Jim Graham</span>
<span class="udiff-line-modified-removed">- * @author Jeff Dinkins (removed dynamic setting changes, made swing friendly)</span>
<span class="udiff-line-modified-removed">- * @version 1.16 11/17/05</span>
<span class="udiff-line-modified-removed">- */</span>
<span class="udiff-line-modified-added">+  * BezierAnimationPanel</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * @author Jim Graham</span>
<span class="udiff-line-modified-added">+  * @author Jeff Dinkins (removed dynamic setting changes, made swing friendly)</span>
<span class="udiff-line-modified-added">+  * @version 1.16 11/17/05</span>
<span class="udiff-line-modified-added">+  */</span>
  public class BezierAnimationPanel extends JPanel implements Runnable {
<span class="udiff-line-modified-removed">- public static enum BezierColor {</span>
<span class="udiff-line-modified-removed">- BACKGROUND, OUTER, GRADIENT_A, GRADIENT_B</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- private final Map&lt;BezierColor, Color&gt; colors = new Hashtable&lt;BezierColor, Color&gt;();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- private GradientPaint gradient = null;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- private static final int NUMPTS = 6;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- private final float[] animpts = new float[NUMPTS * 2];</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- private final float[] deltas = new float[NUMPTS * 2];</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- private BufferedImage img;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- private Thread anim;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- private final Object lock = new Object();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- /**</span>
<span class="udiff-line-modified-removed">- * BezierAnimationPanel Constructor</span>
<span class="udiff-line-modified-removed">- */</span>
<span class="udiff-line-modified-removed">- public BezierAnimationPanel() {</span>
<span class="udiff-line-modified-removed">- setOpaque(true);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- colors.put(BACKGROUND, new Color(0, 0, 153));</span>
<span class="udiff-line-modified-removed">- colors.put(OUTER, new Color(255, 255, 255));</span>
<span class="udiff-line-modified-removed">- colors.put(GRADIENT_A, new Color(255, 0, 101));</span>
<span class="udiff-line-modified-removed">- colors.put(GRADIENT_B, new Color(255, 255, 0));</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- addHierarchyListener(new HierarchyListener() {</span>
<span class="udiff-line-modified-removed">- public void hierarchyChanged(HierarchyEvent e) {</span>
<span class="udiff-line-modified-removed">- if (isShowing()) {</span>
<span class="udiff-line-modified-removed">- start();</span>
<span class="udiff-line-modified-removed">- } else {</span>
<span class="udiff-line-modified-removed">- stop();</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- });</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- public Color getBezierColor(BezierColor bezierColor) {</span>
<span class="udiff-line-modified-removed">- return colors.get(bezierColor);</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- public void setBezierColor(BezierColor bezierColor, Color value) {</span>
<span class="udiff-line-modified-removed">- if (value != null) {</span>
<span class="udiff-line-modified-removed">- colors.put(bezierColor, value);</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- public void start() {</span>
<span class="udiff-line-modified-removed">- Dimension size = getSize();</span>
<span class="udiff-line-modified-removed">- for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="udiff-line-modified-removed">- animpts[i] = (float) (Math.random() * size.width);</span>
<span class="udiff-line-modified-removed">- animpts[i + 1] = (float) (Math.random() * size.height);</span>
<span class="udiff-line-modified-removed">- deltas[i] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="udiff-line-modified-removed">- deltas[i + 1] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="udiff-line-modified-removed">- if (animpts[i] &gt; size.width / 6.0f) {</span>
<span class="udiff-line-modified-removed">- deltas[i] = -deltas[i];</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- if (animpts[i + 1] &gt; size.height / 6.0f) {</span>
<span class="udiff-line-modified-removed">- deltas[i + 1] = -deltas[i + 1];</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- anim = new Thread(this);</span>
<span class="udiff-line-modified-removed">- anim.setPriority(Thread.MIN_PRIORITY);</span>
<span class="udiff-line-modified-removed">- anim.start();</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- public synchronized void stop() {</span>
<span class="udiff-line-modified-removed">- anim = null;</span>
<span class="udiff-line-modified-removed">- notify();</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- private static void animate(float[] pts, float[] deltas, int index, int limit) {</span>
<span class="udiff-line-modified-removed">- float newpt = pts[index] + deltas[index];</span>
<span class="udiff-line-modified-removed">- if (newpt &lt;= 0) {</span>
<span class="udiff-line-modified-removed">- newpt = -newpt;</span>
<span class="udiff-line-modified-removed">- deltas[index] = (float) (Math.random() * 3.0 + 2.0);</span>
<span class="udiff-line-modified-removed">- } else if (newpt &gt;= (float) limit) {</span>
<span class="udiff-line-modified-removed">- newpt = 2.0f * limit - newpt;</span>
<span class="udiff-line-modified-removed">- deltas[index] = -(float) (Math.random() * 3.0 + 2.0);</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- pts[index] = newpt;</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- public void run() {</span>
<span class="udiff-line-modified-removed">- Thread me = Thread.currentThread();</span>
<span class="udiff-line-modified-removed">- while (getSize().width &lt;= 0) {</span>
<span class="udiff-line-modified-removed">- try {</span>
<span class="udiff-line-modified-removed">- Thread.sleep(500);</span>
<span class="udiff-line-modified-removed">- } catch (InterruptedException e) {</span>
<span class="udiff-line-modified-removed">- return;</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- Graphics2D g2d = null;</span>
<span class="udiff-line-modified-removed">- Graphics2D bufferG2D = null;</span>
<span class="udiff-line-modified-removed">- BasicStroke solid = new BasicStroke(9.0f, BasicStroke.CAP_BUTT, BasicStroke.JOIN_ROUND, 9.0f);</span>
<span class="udiff-line-modified-removed">- GeneralPath gp = new GeneralPath(GeneralPath.WIND_NON_ZERO);</span>
<span class="udiff-line-modified-removed">- int rule = AlphaComposite.SRC_OVER;</span>
<span class="udiff-line-modified-removed">- AlphaComposite opaque = AlphaComposite.SrcOver;</span>
<span class="udiff-line-modified-removed">- AlphaComposite blend = AlphaComposite.getInstance(rule, 0.9f);</span>
<span class="udiff-line-modified-removed">- AlphaComposite set = AlphaComposite.Src;</span>
<span class="udiff-line-modified-removed">- Dimension oldSize = getSize();</span>
<span class="udiff-line-modified-removed">- Shape clippath = null;</span>
<span class="udiff-line-modified-removed">- while (anim == me) {</span>
<span class="udiff-line-modified-removed">- Dimension size = getSize();</span>
<span class="udiff-line-modified-removed">- if (size.width != oldSize.width || size.height != oldSize.height) {</span>
<span class="udiff-line-modified-removed">- img = null;</span>
<span class="udiff-line-modified-removed">- clippath = null;</span>
<span class="udiff-line-modified-removed">- if (bufferG2D != null) {</span>
<span class="udiff-line-modified-removed">- bufferG2D.dispose();</span>
<span class="udiff-line-modified-removed">- bufferG2D = null;</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- oldSize = size;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- if (img == null) {</span>
<span class="udiff-line-modified-removed">- img = (BufferedImage) createImage(size.width, size.height);</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- if (bufferG2D == null) {</span>
<span class="udiff-line-modified-removed">- bufferG2D = img.createGraphics();</span>
<span class="udiff-line-modified-removed">- bufferG2D.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_DEFAULT);</span>
<span class="udiff-line-modified-removed">- bufferG2D.setClip(clippath);</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- g2d = bufferG2D;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- float[] ctrlpts;</span>
<span class="udiff-line-modified-removed">- for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="udiff-line-modified-removed">- animate(animpts, deltas, i, size.width);</span>
<span class="udiff-line-modified-removed">- animate(animpts, deltas, i + 1, size.height);</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- ctrlpts = animpts;</span>
<span class="udiff-line-modified-removed">- int len = ctrlpts.length;</span>
<span class="udiff-line-modified-removed">- gp.reset();</span>
<span class="udiff-line-modified-removed">- float prevx = ctrlpts[len - 2];</span>
<span class="udiff-line-modified-removed">- float prevy = ctrlpts[len - 1];</span>
<span class="udiff-line-modified-removed">- float curx = ctrlpts[0];</span>
<span class="udiff-line-modified-removed">- float cury = ctrlpts[1];</span>
<span class="udiff-line-modified-removed">- float midx = (curx + prevx) / 2.0f;</span>
<span class="udiff-line-modified-removed">- float midy = (cury + prevy) / 2.0f;</span>
<span class="udiff-line-modified-removed">- gp.moveTo(midx, midy);</span>
<span class="udiff-line-modified-removed">- for (int i = 2; i &lt;= ctrlpts.length; i += 2) {</span>
<span class="udiff-line-modified-removed">- float x1 = (midx + curx) / 2.0f;</span>
<span class="udiff-line-modified-removed">- float y1 = (midy + cury) / 2.0f;</span>
<span class="udiff-line-modified-removed">- prevx = curx;</span>
<span class="udiff-line-modified-removed">- prevy = cury;</span>
<span class="udiff-line-modified-removed">- if (i &lt; ctrlpts.length) {</span>
<span class="udiff-line-modified-removed">- curx = ctrlpts[i];</span>
<span class="udiff-line-modified-removed">- cury = ctrlpts[i + 1];</span>
<span class="udiff-line-modified-removed">- } else {</span>
<span class="udiff-line-modified-removed">- curx = ctrlpts[0];</span>
<span class="udiff-line-modified-removed">- cury = ctrlpts[1];</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- midx = (curx + prevx) / 2.0f;</span>
<span class="udiff-line-modified-removed">- midy = (cury + prevy) / 2.0f;</span>
<span class="udiff-line-modified-removed">- float x2 = (prevx + midx) / 2.0f;</span>
<span class="udiff-line-modified-removed">- float y2 = (prevy + midy) / 2.0f;</span>
<span class="udiff-line-modified-removed">- gp.curveTo(x1, y1, x2, y2, midx, midy);</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- gp.closePath();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- synchronized (lock) {</span>
<span class="udiff-line-modified-removed">- g2d.setComposite(set);</span>
<span class="udiff-line-modified-removed">- g2d.setBackground(getBezierColor(BACKGROUND));</span>
<span class="udiff-line-modified-removed">- g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_OFF);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- // g2d.clearRect(bounds.x-5, bounds.y-5, bounds.x + bounds.width</span>
<span class="udiff-line-modified-removed">- // + 5, bounds.y + bounds.height + 5);</span>
<span class="udiff-line-modified-removed">- g2d.clearRect(0, 0, getWidth(), getHeight());</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>
<span class="udiff-line-modified-removed">- g2d.setColor(getBezierColor(OUTER));</span>
<span class="udiff-line-modified-removed">- g2d.setComposite(opaque);</span>
<span class="udiff-line-modified-removed">- g2d.setStroke(solid);</span>
<span class="udiff-line-modified-removed">- g2d.draw(gp);</span>
<span class="udiff-line-modified-removed">- g2d.setPaint(gradient);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- Rectangle bounds = gp.getBounds();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- gradient = new GradientPaint(bounds.x, bounds.y, getBezierColor(GRADIENT_A), bounds.x + bounds.width,</span>
<span class="udiff-line-modified-removed">- bounds.y + bounds.height, getBezierColor(GRADIENT_B), true);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- g2d.setComposite(blend);</span>
<span class="udiff-line-modified-removed">- g2d.fill(gp);</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- repaint();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- Thread.yield();</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- if (g2d != null) {</span>
<span class="udiff-line-modified-removed">- g2d.dispose();</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- public void paint(Graphics g) {</span>
<span class="udiff-line-modified-removed">- synchronized (lock) {</span>
<span class="udiff-line-modified-removed">- Graphics2D g2d = (Graphics2D) g;</span>
<span class="udiff-line-modified-removed">- if (img != null) {</span>
<span class="udiff-line-modified-removed">- g2d.setComposite(AlphaComposite.Src);</span>
<span class="udiff-line-modified-removed">- g2d.drawImage(img, null, 0, 0);</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-added">+     public static enum BezierColor {</span>
<span class="udiff-line-modified-added">+         BACKGROUND, OUTER, GRADIENT_A, GRADIENT_B</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private final Map&lt;BezierColor, Color&gt; colors = new Hashtable&lt;BezierColor, Color&gt;();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private GradientPaint gradient = null;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private static final int NUMPTS = 6;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private final float[] animpts = new float[NUMPTS * 2];</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private final float[] deltas = new float[NUMPTS * 2];</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private BufferedImage img;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private Thread anim;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private final Object lock = new Object();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     /**</span>
<span class="udiff-line-modified-added">+      * BezierAnimationPanel Constructor</span>
<span class="udiff-line-modified-added">+      */</span>
<span class="udiff-line-modified-added">+     public BezierAnimationPanel() {</span>
<span class="udiff-line-modified-added">+         setOpaque(true);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         colors.put(BACKGROUND, new Color(0, 0, 153));</span>
<span class="udiff-line-modified-added">+         colors.put(OUTER, new Color(255, 255, 255));</span>
<span class="udiff-line-modified-added">+         colors.put(GRADIENT_A, new Color(255, 0, 101));</span>
<span class="udiff-line-modified-added">+         colors.put(GRADIENT_B, new Color(255, 255, 0));</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         addHierarchyListener(new HierarchyListener() {</span>
<span class="udiff-line-modified-added">+             public void hierarchyChanged(HierarchyEvent e) {</span>
<span class="udiff-line-modified-added">+                 if (isShowing()) {</span>
<span class="udiff-line-modified-added">+                     start();</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-modified-added">+                     stop();</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         });</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     public Color getBezierColor(BezierColor bezierColor) {</span>
<span class="udiff-line-modified-added">+         return colors.get(bezierColor);</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     public void setBezierColor(BezierColor bezierColor, Color value) {</span>
<span class="udiff-line-modified-added">+         if (value != null) {</span>
<span class="udiff-line-modified-added">+             colors.put(bezierColor, value);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     public void start() {</span>
<span class="udiff-line-modified-added">+         Dimension size = getSize();</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="udiff-line-modified-added">+             animpts[i] = (float) (Math.random() * size.width);</span>
<span class="udiff-line-modified-added">+             animpts[i + 1] = (float) (Math.random() * size.height);</span>
<span class="udiff-line-modified-added">+             deltas[i] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="udiff-line-modified-added">+             deltas[i + 1] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="udiff-line-modified-added">+             if (animpts[i] &gt; size.width / 6.0f) {</span>
<span class="udiff-line-modified-added">+                 deltas[i] = -deltas[i];</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             if (animpts[i + 1] &gt; size.height / 6.0f) {</span>
<span class="udiff-line-modified-added">+                 deltas[i + 1] = -deltas[i + 1];</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         anim = new Thread(this);</span>
<span class="udiff-line-modified-added">+         anim.setPriority(Thread.MIN_PRIORITY);</span>
<span class="udiff-line-modified-added">+         anim.start();</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     public synchronized void stop() {</span>
<span class="udiff-line-modified-added">+         anim = null;</span>
<span class="udiff-line-modified-added">+         notify();</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     private static void animate(float[] pts, float[] deltas, int index, int limit) {</span>
<span class="udiff-line-modified-added">+         float newpt = pts[index] + deltas[index];</span>
<span class="udiff-line-modified-added">+         if (newpt &lt;= 0) {</span>
<span class="udiff-line-modified-added">+             newpt = -newpt;</span>
<span class="udiff-line-modified-added">+             deltas[index] = (float) (Math.random() * 3.0 + 2.0);</span>
<span class="udiff-line-modified-added">+         } else if (newpt &gt;= (float) limit) {</span>
<span class="udiff-line-modified-added">+             newpt = 2.0f * limit - newpt;</span>
<span class="udiff-line-modified-added">+             deltas[index] = -(float) (Math.random() * 3.0 + 2.0);</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         pts[index] = newpt;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     public void run() {</span>
<span class="udiff-line-modified-added">+         Thread me = Thread.currentThread();</span>
<span class="udiff-line-modified-added">+         while (getSize().width &lt;= 0) {</span>
<span class="udiff-line-modified-added">+             try {</span>
<span class="udiff-line-modified-added">+                 Thread.sleep(500);</span>
<span class="udiff-line-modified-added">+             } catch (InterruptedException e) {</span>
<span class="udiff-line-modified-added">+                 return;</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         Graphics2D g2d = null;</span>
<span class="udiff-line-modified-added">+         Graphics2D bufferG2D = null;</span>
<span class="udiff-line-modified-added">+         BasicStroke solid = new BasicStroke(9.0f, BasicStroke.CAP_BUTT, BasicStroke.JOIN_ROUND, 9.0f);</span>
<span class="udiff-line-modified-added">+         GeneralPath gp = new GeneralPath(GeneralPath.WIND_NON_ZERO);</span>
<span class="udiff-line-modified-added">+         int rule = AlphaComposite.SRC_OVER;</span>
<span class="udiff-line-modified-added">+         AlphaComposite opaque = AlphaComposite.SrcOver;</span>
<span class="udiff-line-modified-added">+         AlphaComposite blend = AlphaComposite.getInstance(rule, 0.9f);</span>
<span class="udiff-line-modified-added">+         AlphaComposite set = AlphaComposite.Src;</span>
<span class="udiff-line-modified-added">+         Dimension oldSize = getSize();</span>
<span class="udiff-line-modified-added">+         Shape clippath = null;</span>
<span class="udiff-line-modified-added">+         while (anim == me) {</span>
<span class="udiff-line-modified-added">+             Dimension size = getSize();</span>
<span class="udiff-line-modified-added">+             if (size.width != oldSize.width || size.height != oldSize.height) {</span>
<span class="udiff-line-modified-added">+                 img = null;</span>
<span class="udiff-line-modified-added">+                 clippath = null;</span>
<span class="udiff-line-modified-added">+                 if (bufferG2D != null) {</span>
<span class="udiff-line-modified-added">+                     bufferG2D.dispose();</span>
<span class="udiff-line-modified-added">+                     bufferG2D = null;</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             oldSize = size;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+             if (img == null) {</span>
<span class="udiff-line-modified-added">+                 img = (BufferedImage) createImage(size.width, size.height);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+             if (bufferG2D == null) {</span>
<span class="udiff-line-modified-added">+                 bufferG2D = img.createGraphics();</span>
<span class="udiff-line-modified-added">+                 bufferG2D.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_DEFAULT);</span>
<span class="udiff-line-modified-added">+                 bufferG2D.setClip(clippath);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             g2d = bufferG2D;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+             float[] ctrlpts;</span>
<span class="udiff-line-modified-added">+             for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="udiff-line-modified-added">+                 animate(animpts, deltas, i, size.width);</span>
<span class="udiff-line-modified-added">+                 animate(animpts, deltas, i + 1, size.height);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             ctrlpts = animpts;</span>
<span class="udiff-line-modified-added">+             int len = ctrlpts.length;</span>
<span class="udiff-line-modified-added">+             gp.reset();</span>
<span class="udiff-line-modified-added">+             float prevx = ctrlpts[len - 2];</span>
<span class="udiff-line-modified-added">+             float prevy = ctrlpts[len - 1];</span>
<span class="udiff-line-modified-added">+             float curx = ctrlpts[0];</span>
<span class="udiff-line-modified-added">+             float cury = ctrlpts[1];</span>
<span class="udiff-line-modified-added">+             float midx = (curx + prevx) / 2.0f;</span>
<span class="udiff-line-modified-added">+             float midy = (cury + prevy) / 2.0f;</span>
<span class="udiff-line-modified-added">+             gp.moveTo(midx, midy);</span>
<span class="udiff-line-modified-added">+             for (int i = 2; i &lt;= ctrlpts.length; i += 2) {</span>
<span class="udiff-line-modified-added">+                 float x1 = (midx + curx) / 2.0f;</span>
<span class="udiff-line-modified-added">+                 float y1 = (midy + cury) / 2.0f;</span>
<span class="udiff-line-modified-added">+                 prevx = curx;</span>
<span class="udiff-line-modified-added">+                 prevy = cury;</span>
<span class="udiff-line-modified-added">+                 if (i &lt; ctrlpts.length) {</span>
<span class="udiff-line-modified-added">+                     curx = ctrlpts[i];</span>
<span class="udiff-line-modified-added">+                     cury = ctrlpts[i + 1];</span>
<span class="udiff-line-modified-added">+                 } else {</span>
<span class="udiff-line-modified-added">+                     curx = ctrlpts[0];</span>
<span class="udiff-line-modified-added">+                     cury = ctrlpts[1];</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-modified-added">+                 midx = (curx + prevx) / 2.0f;</span>
<span class="udiff-line-modified-added">+                 midy = (cury + prevy) / 2.0f;</span>
<span class="udiff-line-modified-added">+                 float x2 = (prevx + midx) / 2.0f;</span>
<span class="udiff-line-modified-added">+                 float y2 = (prevy + midy) / 2.0f;</span>
<span class="udiff-line-modified-added">+                 gp.curveTo(x1, y1, x2, y2, midx, midy);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+             gp.closePath();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+             synchronized (lock) {</span>
<span class="udiff-line-modified-added">+                 g2d.setComposite(set);</span>
<span class="udiff-line-modified-added">+                 g2d.setBackground(getBezierColor(BACKGROUND));</span>
<span class="udiff-line-modified-added">+                 g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_OFF);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                 // g2d.clearRect(bounds.x-5, bounds.y-5, bounds.x + bounds.width</span>
<span class="udiff-line-modified-added">+                 // + 5, bounds.y + bounds.height + 5);</span>
<span class="udiff-line-modified-added">+                 g2d.clearRect(0, 0, getWidth(), getHeight());</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                 g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>
<span class="udiff-line-modified-added">+                 g2d.setColor(getBezierColor(OUTER));</span>
<span class="udiff-line-modified-added">+                 g2d.setComposite(opaque);</span>
<span class="udiff-line-modified-added">+                 g2d.setStroke(solid);</span>
<span class="udiff-line-modified-added">+                 g2d.draw(gp);</span>
<span class="udiff-line-modified-added">+                 g2d.setPaint(gradient);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                 Rectangle bounds = gp.getBounds();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                 gradient = new GradientPaint(bounds.x, bounds.y, getBezierColor(GRADIENT_A), bounds.x + bounds.width,</span>
<span class="udiff-line-modified-added">+                         bounds.y + bounds.height, getBezierColor(GRADIENT_B), true);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                 g2d.setComposite(blend);</span>
<span class="udiff-line-modified-added">+                 g2d.fill(gp);</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+             try {</span>
<span class="udiff-line-modified-added">+                 SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="udiff-line-modified-added">+                     @Override</span>
<span class="udiff-line-modified-added">+                     public void run() {</span>
<span class="udiff-line-modified-added">+                         repaint();</span>
<span class="udiff-line-modified-added">+                     }</span>
<span class="udiff-line-modified-added">+                 });</span>
<span class="udiff-line-modified-added">+             } catch (InvocationTargetException | InterruptedException e) {</span>
<span class="udiff-line-modified-added">+                 e.printStackTrace();</span>
<span class="udiff-line-modified-added">+             }</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+         if (g2d != null) {</span>
<span class="udiff-line-modified-added">+             g2d.dispose();</span>
<span class="udiff-line-modified-added">+         }</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     public void paint(Graphics g) {</span>
<span class="udiff-line-added">+         synchronized (lock) {</span>
<span class="udiff-line-added">+             Graphics2D g2d = (Graphics2D) g;</span>
<span class="udiff-line-added">+             if (img != null) {</span>
<span class="udiff-line-added">+                 g2d.setComposite(AlphaComposite.Src);</span>
<span class="udiff-line-added">+                 g2d.drawImage(img, null, 0, 0);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
  }
<span class="udiff-line-removed">- }</span>
</pre>
<center><a href="../../../../../../../../TEST.properties.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../tree/TreeDemo.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>