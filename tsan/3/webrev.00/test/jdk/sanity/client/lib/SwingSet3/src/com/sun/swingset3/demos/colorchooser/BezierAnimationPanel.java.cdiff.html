<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jdk/sanity/client/lib/SwingSet3/src/com/sun/swingset3/demos/colorchooser/BezierAnimationPanel.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../TEST.properties.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../tree/TreeDemo.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sanity/client/lib/SwingSet3/src/com/sun/swingset3/demos/colorchooser/BezierAnimationPanel.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 26,229 ***</span>
  import java.awt.*;
  import java.awt.event.HierarchyEvent;
  import java.awt.event.HierarchyListener;
  import java.awt.geom.GeneralPath;
  import java.awt.image.BufferedImage;
  import java.util.Hashtable;
  import java.util.Map;
  import javax.swing.*;
  
  import static com.sun.swingset3.demos.colorchooser.BezierAnimationPanel.BezierColor.*;
  
  /**
<span class="line-modified">! * BezierAnimationPanel</span>
<span class="line-modified">! *</span>
<span class="line-modified">! * @author Jim Graham</span>
<span class="line-modified">! * @author Jeff Dinkins (removed dynamic setting changes, made swing friendly)</span>
<span class="line-modified">! * @version 1.16 11/17/05</span>
<span class="line-modified">! */</span>
  public class BezierAnimationPanel extends JPanel implements Runnable {
<span class="line-modified">! public static enum BezierColor {</span>
<span class="line-modified">! BACKGROUND, OUTER, GRADIENT_A, GRADIENT_B</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! private final Map&lt;BezierColor, Color&gt; colors = new Hashtable&lt;BezierColor, Color&gt;();</span>
<span class="line-modified">! </span>
<span class="line-modified">! private GradientPaint gradient = null;</span>
<span class="line-modified">! </span>
<span class="line-modified">! private static final int NUMPTS = 6;</span>
<span class="line-modified">! </span>
<span class="line-modified">! private final float[] animpts = new float[NUMPTS * 2];</span>
<span class="line-modified">! </span>
<span class="line-modified">! private final float[] deltas = new float[NUMPTS * 2];</span>
<span class="line-modified">! </span>
<span class="line-modified">! private BufferedImage img;</span>
<span class="line-modified">! </span>
<span class="line-modified">! private Thread anim;</span>
<span class="line-modified">! </span>
<span class="line-modified">! private final Object lock = new Object();</span>
<span class="line-modified">! </span>
<span class="line-modified">! /**</span>
<span class="line-modified">! * BezierAnimationPanel Constructor</span>
<span class="line-modified">! */</span>
<span class="line-modified">! public BezierAnimationPanel() {</span>
<span class="line-modified">! setOpaque(true);</span>
<span class="line-modified">! </span>
<span class="line-modified">! colors.put(BACKGROUND, new Color(0, 0, 153));</span>
<span class="line-modified">! colors.put(OUTER, new Color(255, 255, 255));</span>
<span class="line-modified">! colors.put(GRADIENT_A, new Color(255, 0, 101));</span>
<span class="line-modified">! colors.put(GRADIENT_B, new Color(255, 255, 0));</span>
<span class="line-modified">! </span>
<span class="line-modified">! addHierarchyListener(new HierarchyListener() {</span>
<span class="line-modified">! public void hierarchyChanged(HierarchyEvent e) {</span>
<span class="line-modified">! if (isShowing()) {</span>
<span class="line-modified">! start();</span>
<span class="line-modified">! } else {</span>
<span class="line-modified">! stop();</span>
<span class="line-modified">! }</span>
<span class="line-modified">! }</span>
<span class="line-modified">! });</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! public Color getBezierColor(BezierColor bezierColor) {</span>
<span class="line-modified">! return colors.get(bezierColor);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! public void setBezierColor(BezierColor bezierColor, Color value) {</span>
<span class="line-modified">! if (value != null) {</span>
<span class="line-modified">! colors.put(bezierColor, value);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! public void start() {</span>
<span class="line-modified">! Dimension size = getSize();</span>
<span class="line-modified">! for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="line-modified">! animpts[i] = (float) (Math.random() * size.width);</span>
<span class="line-modified">! animpts[i + 1] = (float) (Math.random() * size.height);</span>
<span class="line-modified">! deltas[i] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="line-modified">! deltas[i + 1] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="line-modified">! if (animpts[i] &gt; size.width / 6.0f) {</span>
<span class="line-modified">! deltas[i] = -deltas[i];</span>
<span class="line-modified">! }</span>
<span class="line-modified">! if (animpts[i + 1] &gt; size.height / 6.0f) {</span>
<span class="line-modified">! deltas[i + 1] = -deltas[i + 1];</span>
<span class="line-modified">! }</span>
<span class="line-modified">! }</span>
<span class="line-modified">! anim = new Thread(this);</span>
<span class="line-modified">! anim.setPriority(Thread.MIN_PRIORITY);</span>
<span class="line-modified">! anim.start();</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! public synchronized void stop() {</span>
<span class="line-modified">! anim = null;</span>
<span class="line-modified">! notify();</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! private static void animate(float[] pts, float[] deltas, int index, int limit) {</span>
<span class="line-modified">! float newpt = pts[index] + deltas[index];</span>
<span class="line-modified">! if (newpt &lt;= 0) {</span>
<span class="line-modified">! newpt = -newpt;</span>
<span class="line-modified">! deltas[index] = (float) (Math.random() * 3.0 + 2.0);</span>
<span class="line-modified">! } else if (newpt &gt;= (float) limit) {</span>
<span class="line-modified">! newpt = 2.0f * limit - newpt;</span>
<span class="line-modified">! deltas[index] = -(float) (Math.random() * 3.0 + 2.0);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! pts[index] = newpt;</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! public void run() {</span>
<span class="line-modified">! Thread me = Thread.currentThread();</span>
<span class="line-modified">! while (getSize().width &lt;= 0) {</span>
<span class="line-modified">! try {</span>
<span class="line-modified">! Thread.sleep(500);</span>
<span class="line-modified">! } catch (InterruptedException e) {</span>
<span class="line-modified">! return;</span>
<span class="line-modified">! }</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! Graphics2D g2d = null;</span>
<span class="line-modified">! Graphics2D bufferG2D = null;</span>
<span class="line-modified">! BasicStroke solid = new BasicStroke(9.0f, BasicStroke.CAP_BUTT, BasicStroke.JOIN_ROUND, 9.0f);</span>
<span class="line-modified">! GeneralPath gp = new GeneralPath(GeneralPath.WIND_NON_ZERO);</span>
<span class="line-modified">! int rule = AlphaComposite.SRC_OVER;</span>
<span class="line-modified">! AlphaComposite opaque = AlphaComposite.SrcOver;</span>
<span class="line-modified">! AlphaComposite blend = AlphaComposite.getInstance(rule, 0.9f);</span>
<span class="line-modified">! AlphaComposite set = AlphaComposite.Src;</span>
<span class="line-modified">! Dimension oldSize = getSize();</span>
<span class="line-modified">! Shape clippath = null;</span>
<span class="line-modified">! while (anim == me) {</span>
<span class="line-modified">! Dimension size = getSize();</span>
<span class="line-modified">! if (size.width != oldSize.width || size.height != oldSize.height) {</span>
<span class="line-modified">! img = null;</span>
<span class="line-modified">! clippath = null;</span>
<span class="line-modified">! if (bufferG2D != null) {</span>
<span class="line-modified">! bufferG2D.dispose();</span>
<span class="line-modified">! bufferG2D = null;</span>
<span class="line-modified">! }</span>
<span class="line-modified">! }</span>
<span class="line-modified">! oldSize = size;</span>
<span class="line-modified">! </span>
<span class="line-modified">! if (img == null) {</span>
<span class="line-modified">! img = (BufferedImage) createImage(size.width, size.height);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! if (bufferG2D == null) {</span>
<span class="line-modified">! bufferG2D = img.createGraphics();</span>
<span class="line-modified">! bufferG2D.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_DEFAULT);</span>
<span class="line-modified">! bufferG2D.setClip(clippath);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! g2d = bufferG2D;</span>
<span class="line-modified">! </span>
<span class="line-modified">! float[] ctrlpts;</span>
<span class="line-modified">! for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="line-modified">! animate(animpts, deltas, i, size.width);</span>
<span class="line-modified">! animate(animpts, deltas, i + 1, size.height);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! ctrlpts = animpts;</span>
<span class="line-modified">! int len = ctrlpts.length;</span>
<span class="line-modified">! gp.reset();</span>
<span class="line-modified">! float prevx = ctrlpts[len - 2];</span>
<span class="line-modified">! float prevy = ctrlpts[len - 1];</span>
<span class="line-modified">! float curx = ctrlpts[0];</span>
<span class="line-modified">! float cury = ctrlpts[1];</span>
<span class="line-modified">! float midx = (curx + prevx) / 2.0f;</span>
<span class="line-modified">! float midy = (cury + prevy) / 2.0f;</span>
<span class="line-modified">! gp.moveTo(midx, midy);</span>
<span class="line-modified">! for (int i = 2; i &lt;= ctrlpts.length; i += 2) {</span>
<span class="line-modified">! float x1 = (midx + curx) / 2.0f;</span>
<span class="line-modified">! float y1 = (midy + cury) / 2.0f;</span>
<span class="line-modified">! prevx = curx;</span>
<span class="line-modified">! prevy = cury;</span>
<span class="line-modified">! if (i &lt; ctrlpts.length) {</span>
<span class="line-modified">! curx = ctrlpts[i];</span>
<span class="line-modified">! cury = ctrlpts[i + 1];</span>
<span class="line-modified">! } else {</span>
<span class="line-modified">! curx = ctrlpts[0];</span>
<span class="line-modified">! cury = ctrlpts[1];</span>
<span class="line-modified">! }</span>
<span class="line-modified">! midx = (curx + prevx) / 2.0f;</span>
<span class="line-modified">! midy = (cury + prevy) / 2.0f;</span>
<span class="line-modified">! float x2 = (prevx + midx) / 2.0f;</span>
<span class="line-modified">! float y2 = (prevy + midy) / 2.0f;</span>
<span class="line-modified">! gp.curveTo(x1, y1, x2, y2, midx, midy);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! gp.closePath();</span>
<span class="line-modified">! </span>
<span class="line-modified">! synchronized (lock) {</span>
<span class="line-modified">! g2d.setComposite(set);</span>
<span class="line-modified">! g2d.setBackground(getBezierColor(BACKGROUND));</span>
<span class="line-modified">! g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_OFF);</span>
<span class="line-modified">! </span>
<span class="line-modified">! // g2d.clearRect(bounds.x-5, bounds.y-5, bounds.x + bounds.width</span>
<span class="line-modified">! // + 5, bounds.y + bounds.height + 5);</span>
<span class="line-modified">! g2d.clearRect(0, 0, getWidth(), getHeight());</span>
<span class="line-modified">! </span>
<span class="line-modified">! g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>
<span class="line-modified">! g2d.setColor(getBezierColor(OUTER));</span>
<span class="line-modified">! g2d.setComposite(opaque);</span>
<span class="line-modified">! g2d.setStroke(solid);</span>
<span class="line-modified">! g2d.draw(gp);</span>
<span class="line-modified">! g2d.setPaint(gradient);</span>
<span class="line-modified">! </span>
<span class="line-modified">! Rectangle bounds = gp.getBounds();</span>
<span class="line-modified">! </span>
<span class="line-modified">! gradient = new GradientPaint(bounds.x, bounds.y, getBezierColor(GRADIENT_A), bounds.x + bounds.width,</span>
<span class="line-modified">! bounds.y + bounds.height, getBezierColor(GRADIENT_B), true);</span>
<span class="line-modified">! </span>
<span class="line-modified">! g2d.setComposite(blend);</span>
<span class="line-modified">! g2d.fill(gp);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! repaint();</span>
<span class="line-modified">! </span>
<span class="line-modified">! Thread.yield();</span>
<span class="line-modified">! }</span>
<span class="line-modified">! if (g2d != null) {</span>
<span class="line-modified">! g2d.dispose();</span>
<span class="line-modified">! }</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-modified">! public void paint(Graphics g) {</span>
<span class="line-modified">! synchronized (lock) {</span>
<span class="line-modified">! Graphics2D g2d = (Graphics2D) g;</span>
<span class="line-modified">! if (img != null) {</span>
<span class="line-modified">! g2d.setComposite(AlphaComposite.Src);</span>
<span class="line-modified">! g2d.drawImage(img, null, 0, 0);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! }</span>
  }
<span class="line-removed">- }</span>
<span class="line-new-header">--- 26,237 ---</span>
  import java.awt.*;
  import java.awt.event.HierarchyEvent;
  import java.awt.event.HierarchyListener;
  import java.awt.geom.GeneralPath;
  import java.awt.image.BufferedImage;
<span class="line-added">+ import java.lang.reflect.InvocationTargetException;</span>
  import java.util.Hashtable;
  import java.util.Map;
  import javax.swing.*;
  
  import static com.sun.swingset3.demos.colorchooser.BezierAnimationPanel.BezierColor.*;
  
  /**
<span class="line-modified">!  * BezierAnimationPanel</span>
<span class="line-modified">!  *</span>
<span class="line-modified">!  * @author Jim Graham</span>
<span class="line-modified">!  * @author Jeff Dinkins (removed dynamic setting changes, made swing friendly)</span>
<span class="line-modified">!  * @version 1.16 11/17/05</span>
<span class="line-modified">!  */</span>
  public class BezierAnimationPanel extends JPanel implements Runnable {
<span class="line-modified">!     public static enum BezierColor {</span>
<span class="line-modified">!         BACKGROUND, OUTER, GRADIENT_A, GRADIENT_B</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private final Map&lt;BezierColor, Color&gt; colors = new Hashtable&lt;BezierColor, Color&gt;();</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private GradientPaint gradient = null;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private static final int NUMPTS = 6;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private final float[] animpts = new float[NUMPTS * 2];</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private final float[] deltas = new float[NUMPTS * 2];</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private BufferedImage img;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private Thread anim;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private final Object lock = new Object();</span>
<span class="line-modified">! </span>
<span class="line-modified">!     /**</span>
<span class="line-modified">!      * BezierAnimationPanel Constructor</span>
<span class="line-modified">!      */</span>
<span class="line-modified">!     public BezierAnimationPanel() {</span>
<span class="line-modified">!         setOpaque(true);</span>
<span class="line-modified">! </span>
<span class="line-modified">!         colors.put(BACKGROUND, new Color(0, 0, 153));</span>
<span class="line-modified">!         colors.put(OUTER, new Color(255, 255, 255));</span>
<span class="line-modified">!         colors.put(GRADIENT_A, new Color(255, 0, 101));</span>
<span class="line-modified">!         colors.put(GRADIENT_B, new Color(255, 255, 0));</span>
<span class="line-modified">! </span>
<span class="line-modified">!         addHierarchyListener(new HierarchyListener() {</span>
<span class="line-modified">!             public void hierarchyChanged(HierarchyEvent e) {</span>
<span class="line-modified">!                 if (isShowing()) {</span>
<span class="line-modified">!                     start();</span>
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     stop();</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         });</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     public Color getBezierColor(BezierColor bezierColor) {</span>
<span class="line-modified">!         return colors.get(bezierColor);</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     public void setBezierColor(BezierColor bezierColor, Color value) {</span>
<span class="line-modified">!         if (value != null) {</span>
<span class="line-modified">!             colors.put(bezierColor, value);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     public void start() {</span>
<span class="line-modified">!         Dimension size = getSize();</span>
<span class="line-modified">!         for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="line-modified">!             animpts[i] = (float) (Math.random() * size.width);</span>
<span class="line-modified">!             animpts[i + 1] = (float) (Math.random() * size.height);</span>
<span class="line-modified">!             deltas[i] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="line-modified">!             deltas[i + 1] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="line-modified">!             if (animpts[i] &gt; size.width / 6.0f) {</span>
<span class="line-modified">!                 deltas[i] = -deltas[i];</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             if (animpts[i + 1] &gt; size.height / 6.0f) {</span>
<span class="line-modified">!                 deltas[i + 1] = -deltas[i + 1];</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         anim = new Thread(this);</span>
<span class="line-modified">!         anim.setPriority(Thread.MIN_PRIORITY);</span>
<span class="line-modified">!         anim.start();</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     public synchronized void stop() {</span>
<span class="line-modified">!         anim = null;</span>
<span class="line-modified">!         notify();</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private static void animate(float[] pts, float[] deltas, int index, int limit) {</span>
<span class="line-modified">!         float newpt = pts[index] + deltas[index];</span>
<span class="line-modified">!         if (newpt &lt;= 0) {</span>
<span class="line-modified">!             newpt = -newpt;</span>
<span class="line-modified">!             deltas[index] = (float) (Math.random() * 3.0 + 2.0);</span>
<span class="line-modified">!         } else if (newpt &gt;= (float) limit) {</span>
<span class="line-modified">!             newpt = 2.0f * limit - newpt;</span>
<span class="line-modified">!             deltas[index] = -(float) (Math.random() * 3.0 + 2.0);</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         pts[index] = newpt;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     public void run() {</span>
<span class="line-modified">!         Thread me = Thread.currentThread();</span>
<span class="line-modified">!         while (getSize().width &lt;= 0) {</span>
<span class="line-modified">!             try {</span>
<span class="line-modified">!                 Thread.sleep(500);</span>
<span class="line-modified">!             } catch (InterruptedException e) {</span>
<span class="line-modified">!                 return;</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         }</span>
<span class="line-modified">! </span>
<span class="line-modified">!         Graphics2D g2d = null;</span>
<span class="line-modified">!         Graphics2D bufferG2D = null;</span>
<span class="line-modified">!         BasicStroke solid = new BasicStroke(9.0f, BasicStroke.CAP_BUTT, BasicStroke.JOIN_ROUND, 9.0f);</span>
<span class="line-modified">!         GeneralPath gp = new GeneralPath(GeneralPath.WIND_NON_ZERO);</span>
<span class="line-modified">!         int rule = AlphaComposite.SRC_OVER;</span>
<span class="line-modified">!         AlphaComposite opaque = AlphaComposite.SrcOver;</span>
<span class="line-modified">!         AlphaComposite blend = AlphaComposite.getInstance(rule, 0.9f);</span>
<span class="line-modified">!         AlphaComposite set = AlphaComposite.Src;</span>
<span class="line-modified">!         Dimension oldSize = getSize();</span>
<span class="line-modified">!         Shape clippath = null;</span>
<span class="line-modified">!         while (anim == me) {</span>
<span class="line-modified">!             Dimension size = getSize();</span>
<span class="line-modified">!             if (size.width != oldSize.width || size.height != oldSize.height) {</span>
<span class="line-modified">!                 img = null;</span>
<span class="line-modified">!                 clippath = null;</span>
<span class="line-modified">!                 if (bufferG2D != null) {</span>
<span class="line-modified">!                     bufferG2D.dispose();</span>
<span class="line-modified">!                     bufferG2D = null;</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             oldSize = size;</span>
<span class="line-modified">! </span>
<span class="line-modified">!             if (img == null) {</span>
<span class="line-modified">!                 img = (BufferedImage) createImage(size.width, size.height);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">! </span>
<span class="line-modified">!             if (bufferG2D == null) {</span>
<span class="line-modified">!                 bufferG2D = img.createGraphics();</span>
<span class="line-modified">!                 bufferG2D.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_DEFAULT);</span>
<span class="line-modified">!                 bufferG2D.setClip(clippath);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             g2d = bufferG2D;</span>
<span class="line-modified">! </span>
<span class="line-modified">!             float[] ctrlpts;</span>
<span class="line-modified">!             for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="line-modified">!                 animate(animpts, deltas, i, size.width);</span>
<span class="line-modified">!                 animate(animpts, deltas, i + 1, size.height);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             ctrlpts = animpts;</span>
<span class="line-modified">!             int len = ctrlpts.length;</span>
<span class="line-modified">!             gp.reset();</span>
<span class="line-modified">!             float prevx = ctrlpts[len - 2];</span>
<span class="line-modified">!             float prevy = ctrlpts[len - 1];</span>
<span class="line-modified">!             float curx = ctrlpts[0];</span>
<span class="line-modified">!             float cury = ctrlpts[1];</span>
<span class="line-modified">!             float midx = (curx + prevx) / 2.0f;</span>
<span class="line-modified">!             float midy = (cury + prevy) / 2.0f;</span>
<span class="line-modified">!             gp.moveTo(midx, midy);</span>
<span class="line-modified">!             for (int i = 2; i &lt;= ctrlpts.length; i += 2) {</span>
<span class="line-modified">!                 float x1 = (midx + curx) / 2.0f;</span>
<span class="line-modified">!                 float y1 = (midy + cury) / 2.0f;</span>
<span class="line-modified">!                 prevx = curx;</span>
<span class="line-modified">!                 prevy = cury;</span>
<span class="line-modified">!                 if (i &lt; ctrlpts.length) {</span>
<span class="line-modified">!                     curx = ctrlpts[i];</span>
<span class="line-modified">!                     cury = ctrlpts[i + 1];</span>
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     curx = ctrlpts[0];</span>
<span class="line-modified">!                     cury = ctrlpts[1];</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">!                 midx = (curx + prevx) / 2.0f;</span>
<span class="line-modified">!                 midy = (cury + prevy) / 2.0f;</span>
<span class="line-modified">!                 float x2 = (prevx + midx) / 2.0f;</span>
<span class="line-modified">!                 float y2 = (prevy + midy) / 2.0f;</span>
<span class="line-modified">!                 gp.curveTo(x1, y1, x2, y2, midx, midy);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!             gp.closePath();</span>
<span class="line-modified">! </span>
<span class="line-modified">!             synchronized (lock) {</span>
<span class="line-modified">!                 g2d.setComposite(set);</span>
<span class="line-modified">!                 g2d.setBackground(getBezierColor(BACKGROUND));</span>
<span class="line-modified">!                 g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_OFF);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 // g2d.clearRect(bounds.x-5, bounds.y-5, bounds.x + bounds.width</span>
<span class="line-modified">!                 // + 5, bounds.y + bounds.height + 5);</span>
<span class="line-modified">!                 g2d.clearRect(0, 0, getWidth(), getHeight());</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>
<span class="line-modified">!                 g2d.setColor(getBezierColor(OUTER));</span>
<span class="line-modified">!                 g2d.setComposite(opaque);</span>
<span class="line-modified">!                 g2d.setStroke(solid);</span>
<span class="line-modified">!                 g2d.draw(gp);</span>
<span class="line-modified">!                 g2d.setPaint(gradient);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 Rectangle bounds = gp.getBounds();</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 gradient = new GradientPaint(bounds.x, bounds.y, getBezierColor(GRADIENT_A), bounds.x + bounds.width,</span>
<span class="line-modified">!                         bounds.y + bounds.height, getBezierColor(GRADIENT_B), true);</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 g2d.setComposite(blend);</span>
<span class="line-modified">!                 g2d.fill(gp);</span>
<span class="line-modified">!             }</span>
<span class="line-modified">! </span>
<span class="line-modified">!             try {</span>
<span class="line-modified">!                 SwingUtilities.invokeAndWait(new Runnable() {</span>
<span class="line-modified">!                     @Override</span>
<span class="line-modified">!                     public void run() {</span>
<span class="line-modified">!                         repaint();</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">!                 });</span>
<span class="line-modified">!             } catch (InvocationTargetException | InterruptedException e) {</span>
<span class="line-modified">!                 e.printStackTrace();</span>
<span class="line-modified">!             }</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         if (g2d != null) {</span>
<span class="line-modified">!             g2d.dispose();</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     public void paint(Graphics g) {</span>
<span class="line-added">+         synchronized (lock) {</span>
<span class="line-added">+             Graphics2D g2d = (Graphics2D) g;</span>
<span class="line-added">+             if (img != null) {</span>
<span class="line-added">+                 g2d.setComposite(AlphaComposite.Src);</span>
<span class="line-added">+                 g2d.drawImage(img, null, 0, 0);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
  }
</pre>
<center><a href="../../../../../../../../TEST.properties.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../tree/TreeDemo.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>