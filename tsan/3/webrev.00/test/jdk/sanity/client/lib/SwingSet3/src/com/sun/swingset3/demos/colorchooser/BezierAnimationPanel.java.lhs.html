<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/sanity/client/lib/SwingSet3/src/com/sun/swingset3/demos/colorchooser/BezierAnimationPanel.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2 * Copyright (c) 2007, 2019, Oracle and/or its affiliates. All rights reserved.
  3 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 *
  5 * This code is free software; you can redistribute it and/or modify it
  6 * under the terms of the GNU General Public License version 2 only, as
  7 * published by the Free Software Foundation.
  8 *
  9 * This code is distributed in the hope that it will be useful, but WITHOUT
 10 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12 * version 2 for more details (a copy is included in the LICENSE file that
 13 * accompanied this code).
 14 *
 15 * You should have received a copy of the GNU General Public License version
 16 * 2 along with this work; if not, write to the Free Software Foundation,
 17 * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18 *
 19 * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20 * or visit www.oracle.com if you need additional information or have any
 21 * questions.
 22 */
 23 
 24 package com.sun.swingset3.demos.colorchooser;
 25 
 26 import java.awt.*;
 27 import java.awt.event.HierarchyEvent;
 28 import java.awt.event.HierarchyListener;
 29 import java.awt.geom.GeneralPath;
 30 import java.awt.image.BufferedImage;
<a name="1" id="anc1"></a>
 31 import java.util.Hashtable;
 32 import java.util.Map;
 33 import javax.swing.*;
 34 
 35 import static com.sun.swingset3.demos.colorchooser.BezierAnimationPanel.BezierColor.*;
 36 
 37 /**
<a name="2" id="anc2"></a><span class="line-modified"> 38 * BezierAnimationPanel</span>
<span class="line-modified"> 39 *</span>
<span class="line-modified"> 40 * @author Jim Graham</span>
<span class="line-modified"> 41 * @author Jeff Dinkins (removed dynamic setting changes, made swing friendly)</span>
<span class="line-modified"> 42 * @version 1.16 11/17/05</span>
<span class="line-modified"> 43 */</span>
 44 public class BezierAnimationPanel extends JPanel implements Runnable {
<a name="3" id="anc3"></a><span class="line-modified"> 45 public static enum BezierColor {</span>
<span class="line-modified"> 46 BACKGROUND, OUTER, GRADIENT_A, GRADIENT_B</span>
<span class="line-modified"> 47 }</span>
<span class="line-modified"> 48 </span>
<span class="line-modified"> 49 private final Map&lt;BezierColor, Color&gt; colors = new Hashtable&lt;BezierColor, Color&gt;();</span>
<span class="line-modified"> 50 </span>
<span class="line-modified"> 51 private GradientPaint gradient = null;</span>
<span class="line-modified"> 52 </span>
<span class="line-modified"> 53 private static final int NUMPTS = 6;</span>
<span class="line-modified"> 54 </span>
<span class="line-modified"> 55 private final float[] animpts = new float[NUMPTS * 2];</span>
<span class="line-modified"> 56 </span>
<span class="line-modified"> 57 private final float[] deltas = new float[NUMPTS * 2];</span>
<span class="line-modified"> 58 </span>
<span class="line-modified"> 59 private BufferedImage img;</span>
<span class="line-modified"> 60 </span>
<span class="line-modified"> 61 private Thread anim;</span>
<span class="line-modified"> 62 </span>
<span class="line-modified"> 63 private final Object lock = new Object();</span>
<span class="line-modified"> 64 </span>
<span class="line-modified"> 65 /**</span>
<span class="line-modified"> 66 * BezierAnimationPanel Constructor</span>
<span class="line-modified"> 67 */</span>
<span class="line-modified"> 68 public BezierAnimationPanel() {</span>
<span class="line-modified"> 69 setOpaque(true);</span>
<span class="line-modified"> 70 </span>
<span class="line-modified"> 71 colors.put(BACKGROUND, new Color(0, 0, 153));</span>
<span class="line-modified"> 72 colors.put(OUTER, new Color(255, 255, 255));</span>
<span class="line-modified"> 73 colors.put(GRADIENT_A, new Color(255, 0, 101));</span>
<span class="line-modified"> 74 colors.put(GRADIENT_B, new Color(255, 255, 0));</span>
<span class="line-modified"> 75 </span>
<span class="line-modified"> 76 addHierarchyListener(new HierarchyListener() {</span>
<span class="line-modified"> 77 public void hierarchyChanged(HierarchyEvent e) {</span>
<span class="line-modified"> 78 if (isShowing()) {</span>
<span class="line-modified"> 79 start();</span>
<span class="line-modified"> 80 } else {</span>
<span class="line-modified"> 81 stop();</span>
<span class="line-modified"> 82 }</span>
<span class="line-modified"> 83 }</span>
<span class="line-modified"> 84 });</span>
<span class="line-modified"> 85 }</span>
<span class="line-modified"> 86 </span>
<span class="line-modified"> 87 public Color getBezierColor(BezierColor bezierColor) {</span>
<span class="line-modified"> 88 return colors.get(bezierColor);</span>
<span class="line-modified"> 89 }</span>
<span class="line-modified"> 90 </span>
<span class="line-modified"> 91 public void setBezierColor(BezierColor bezierColor, Color value) {</span>
<span class="line-modified"> 92 if (value != null) {</span>
<span class="line-modified"> 93 colors.put(bezierColor, value);</span>
<span class="line-modified"> 94 }</span>
<span class="line-modified"> 95 }</span>
<span class="line-modified"> 96 </span>
<span class="line-modified"> 97 public void start() {</span>
<span class="line-modified"> 98 Dimension size = getSize();</span>
<span class="line-modified"> 99 for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="line-modified">100 animpts[i] = (float) (Math.random() * size.width);</span>
<span class="line-modified">101 animpts[i + 1] = (float) (Math.random() * size.height);</span>
<span class="line-modified">102 deltas[i] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="line-modified">103 deltas[i + 1] = (float) (Math.random() * 4.0 + 2.0);</span>
<span class="line-modified">104 if (animpts[i] &gt; size.width / 6.0f) {</span>
<span class="line-modified">105 deltas[i] = -deltas[i];</span>
<span class="line-modified">106 }</span>
<span class="line-modified">107 if (animpts[i + 1] &gt; size.height / 6.0f) {</span>
<span class="line-modified">108 deltas[i + 1] = -deltas[i + 1];</span>
<span class="line-modified">109 }</span>
<span class="line-modified">110 }</span>
<span class="line-modified">111 anim = new Thread(this);</span>
<span class="line-modified">112 anim.setPriority(Thread.MIN_PRIORITY);</span>
<span class="line-modified">113 anim.start();</span>
<span class="line-modified">114 }</span>
<span class="line-modified">115 </span>
<span class="line-modified">116 public synchronized void stop() {</span>
<span class="line-modified">117 anim = null;</span>
<span class="line-modified">118 notify();</span>
<span class="line-modified">119 }</span>
<span class="line-modified">120 </span>
<span class="line-modified">121 private static void animate(float[] pts, float[] deltas, int index, int limit) {</span>
<span class="line-modified">122 float newpt = pts[index] + deltas[index];</span>
<span class="line-modified">123 if (newpt &lt;= 0) {</span>
<span class="line-modified">124 newpt = -newpt;</span>
<span class="line-modified">125 deltas[index] = (float) (Math.random() * 3.0 + 2.0);</span>
<span class="line-modified">126 } else if (newpt &gt;= (float) limit) {</span>
<span class="line-modified">127 newpt = 2.0f * limit - newpt;</span>
<span class="line-modified">128 deltas[index] = -(float) (Math.random() * 3.0 + 2.0);</span>
<span class="line-modified">129 }</span>
<span class="line-modified">130 pts[index] = newpt;</span>
<span class="line-modified">131 }</span>
<span class="line-modified">132 </span>
<span class="line-modified">133 public void run() {</span>
<span class="line-modified">134 Thread me = Thread.currentThread();</span>
<span class="line-modified">135 while (getSize().width &lt;= 0) {</span>
<span class="line-modified">136 try {</span>
<span class="line-modified">137 Thread.sleep(500);</span>
<span class="line-modified">138 } catch (InterruptedException e) {</span>
<span class="line-modified">139 return;</span>
<span class="line-modified">140 }</span>
<span class="line-modified">141 }</span>
<span class="line-modified">142 </span>
<span class="line-modified">143 Graphics2D g2d = null;</span>
<span class="line-modified">144 Graphics2D bufferG2D = null;</span>
<span class="line-modified">145 BasicStroke solid = new BasicStroke(9.0f, BasicStroke.CAP_BUTT, BasicStroke.JOIN_ROUND, 9.0f);</span>
<span class="line-modified">146 GeneralPath gp = new GeneralPath(GeneralPath.WIND_NON_ZERO);</span>
<span class="line-modified">147 int rule = AlphaComposite.SRC_OVER;</span>
<span class="line-modified">148 AlphaComposite opaque = AlphaComposite.SrcOver;</span>
<span class="line-modified">149 AlphaComposite blend = AlphaComposite.getInstance(rule, 0.9f);</span>
<span class="line-modified">150 AlphaComposite set = AlphaComposite.Src;</span>
<span class="line-modified">151 Dimension oldSize = getSize();</span>
<span class="line-modified">152 Shape clippath = null;</span>
<span class="line-modified">153 while (anim == me) {</span>
<span class="line-modified">154 Dimension size = getSize();</span>
<span class="line-modified">155 if (size.width != oldSize.width || size.height != oldSize.height) {</span>
<span class="line-modified">156 img = null;</span>
<span class="line-modified">157 clippath = null;</span>
<span class="line-modified">158 if (bufferG2D != null) {</span>
<span class="line-modified">159 bufferG2D.dispose();</span>
<span class="line-modified">160 bufferG2D = null;</span>
<span class="line-modified">161 }</span>
<span class="line-modified">162 }</span>
<span class="line-modified">163 oldSize = size;</span>
<span class="line-modified">164 </span>
<span class="line-modified">165 if (img == null) {</span>
<span class="line-modified">166 img = (BufferedImage) createImage(size.width, size.height);</span>
<span class="line-modified">167 }</span>
<span class="line-modified">168 </span>
<span class="line-modified">169 if (bufferG2D == null) {</span>
<span class="line-modified">170 bufferG2D = img.createGraphics();</span>
<span class="line-modified">171 bufferG2D.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_DEFAULT);</span>
<span class="line-modified">172 bufferG2D.setClip(clippath);</span>
<span class="line-modified">173 }</span>
<span class="line-modified">174 g2d = bufferG2D;</span>
<span class="line-modified">175 </span>
<span class="line-modified">176 float[] ctrlpts;</span>
<span class="line-modified">177 for (int i = 0; i &lt; animpts.length; i += 2) {</span>
<span class="line-modified">178 animate(animpts, deltas, i, size.width);</span>
<span class="line-modified">179 animate(animpts, deltas, i + 1, size.height);</span>
<span class="line-modified">180 }</span>
<span class="line-modified">181 ctrlpts = animpts;</span>
<span class="line-modified">182 int len = ctrlpts.length;</span>
<span class="line-modified">183 gp.reset();</span>
<span class="line-modified">184 float prevx = ctrlpts[len - 2];</span>
<span class="line-modified">185 float prevy = ctrlpts[len - 1];</span>
<span class="line-modified">186 float curx = ctrlpts[0];</span>
<span class="line-modified">187 float cury = ctrlpts[1];</span>
<span class="line-modified">188 float midx = (curx + prevx) / 2.0f;</span>
<span class="line-modified">189 float midy = (cury + prevy) / 2.0f;</span>
<span class="line-modified">190 gp.moveTo(midx, midy);</span>
<span class="line-modified">191 for (int i = 2; i &lt;= ctrlpts.length; i += 2) {</span>
<span class="line-modified">192 float x1 = (midx + curx) / 2.0f;</span>
<span class="line-modified">193 float y1 = (midy + cury) / 2.0f;</span>
<span class="line-modified">194 prevx = curx;</span>
<span class="line-modified">195 prevy = cury;</span>
<span class="line-modified">196 if (i &lt; ctrlpts.length) {</span>
<span class="line-modified">197 curx = ctrlpts[i];</span>
<span class="line-modified">198 cury = ctrlpts[i + 1];</span>
<span class="line-modified">199 } else {</span>
<span class="line-modified">200 curx = ctrlpts[0];</span>
<span class="line-modified">201 cury = ctrlpts[1];</span>
<span class="line-modified">202 }</span>
<span class="line-modified">203 midx = (curx + prevx) / 2.0f;</span>
<span class="line-modified">204 midy = (cury + prevy) / 2.0f;</span>
<span class="line-modified">205 float x2 = (prevx + midx) / 2.0f;</span>
<span class="line-modified">206 float y2 = (prevy + midy) / 2.0f;</span>
<span class="line-modified">207 gp.curveTo(x1, y1, x2, y2, midx, midy);</span>
<span class="line-modified">208 }</span>
<span class="line-modified">209 gp.closePath();</span>
<span class="line-modified">210 </span>
<span class="line-modified">211 synchronized (lock) {</span>
<span class="line-modified">212 g2d.setComposite(set);</span>
<span class="line-modified">213 g2d.setBackground(getBezierColor(BACKGROUND));</span>
<span class="line-modified">214 g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_OFF);</span>
<span class="line-modified">215 </span>
<span class="line-modified">216 // g2d.clearRect(bounds.x-5, bounds.y-5, bounds.x + bounds.width</span>
<span class="line-modified">217 // + 5, bounds.y + bounds.height + 5);</span>
<span class="line-modified">218 g2d.clearRect(0, 0, getWidth(), getHeight());</span>
<span class="line-modified">219 </span>
<span class="line-modified">220 g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>
<span class="line-modified">221 g2d.setColor(getBezierColor(OUTER));</span>
<span class="line-modified">222 g2d.setComposite(opaque);</span>
<span class="line-modified">223 g2d.setStroke(solid);</span>
<span class="line-modified">224 g2d.draw(gp);</span>
<span class="line-modified">225 g2d.setPaint(gradient);</span>
<span class="line-modified">226 </span>
<span class="line-modified">227 Rectangle bounds = gp.getBounds();</span>
<span class="line-modified">228 </span>
<span class="line-modified">229 gradient = new GradientPaint(bounds.x, bounds.y, getBezierColor(GRADIENT_A), bounds.x + bounds.width,</span>
<span class="line-modified">230 bounds.y + bounds.height, getBezierColor(GRADIENT_B), true);</span>
<span class="line-modified">231 </span>
<span class="line-modified">232 g2d.setComposite(blend);</span>
<span class="line-modified">233 g2d.fill(gp);</span>
<span class="line-modified">234 }</span>
<span class="line-modified">235 </span>
<span class="line-modified">236 repaint();</span>
<span class="line-modified">237 </span>
<span class="line-modified">238 Thread.yield();</span>
<span class="line-modified">239 }</span>
<span class="line-modified">240 if (g2d != null) {</span>
<span class="line-modified">241 g2d.dispose();</span>
<span class="line-modified">242 }</span>
<span class="line-modified">243 }</span>
<span class="line-modified">244 </span>
<span class="line-modified">245 public void paint(Graphics g) {</span>
<span class="line-modified">246 synchronized (lock) {</span>
<span class="line-modified">247 Graphics2D g2d = (Graphics2D) g;</span>
<span class="line-modified">248 if (img != null) {</span>
<span class="line-modified">249 g2d.setComposite(AlphaComposite.Src);</span>
<span class="line-modified">250 g2d.drawImage(img, null, 0, 0);</span>
<span class="line-modified">251 }</span>
<span class="line-modified">252 }</span>








253 }
<a name="4" id="anc4"></a><span class="line-removed">254 }</span>
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>