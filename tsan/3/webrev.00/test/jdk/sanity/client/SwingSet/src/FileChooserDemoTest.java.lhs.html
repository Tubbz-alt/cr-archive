<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/sanity/client/SwingSet/src/FileChooserDemoTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 import org.jtregext.GuiTestListener;
 25 import com.sun.swingset3.demos.filechooser.FileChooserDemo;
 26 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.APPLY_FILTER_TOOLTIP;
 27 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.DEMO_TITLE;
 28 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.FILE_CHOOSER_DEMO_CANCEL_TEXT;
 29 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.FILE_CHOOSER_DEMO_SAVEQUESTION_TITLE;
 30 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.FILE_CHOOSER_DEMO_SAVE_TEXT;
 31 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.FILE_CHOOSER_DEMO_SELECT_TEXT;
 32 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.FILE_CHOOSER_DEMO_SELECT_WITH_PREVIEW;
 33 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.FLIP_HORIZONTAL_TOOLTIP;
 34 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.FLIP_VERTICAL_TOOLTIP;
 35 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.GRAY;
 36 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.ROTATE_LEFT_TOOLTIP;
 37 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.ROTATE_RIGHT_TOOLTIP;
 38 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.getFlipHorizontalCount;
 39 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.getFlipVerticalCount;
 40 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.getLastAppliedFilterId;
 41 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.getRotateLeftCount;
 42 import static com.sun.swingset3.demos.filechooser.FileChooserDemo.getRotateRightCount;
 43 
 44 import java.awt.Container;
 45 import java.awt.event.KeyEvent;
 46 import java.io.File;
 47 import java.nio.file.Files;
 48 import java.nio.file.Path;
 49 import java.nio.file.Paths;
 50 import org.testng.annotations.Test;
 51 import javax.swing.UIManager;
 52 
 53 import org.netbeans.jemmy.ClassReference;
 54 import org.netbeans.jemmy.operators.JFrameOperator;
 55 import org.netbeans.jemmy.operators.JPopupMenuOperator;
 56 import org.netbeans.jemmy.operators.JRadioButtonMenuItemOperator;
 57 import org.netbeans.jemmy.operators.JButtonOperator;
 58 import org.netbeans.jemmy.operators.JComboBoxOperator;
 59 import org.netbeans.jemmy.operators.JToggleButtonOperator;
 60 import org.netbeans.jemmy.operators.JFileChooserOperator;
 61 import org.netbeans.jemmy.operators.JDialogOperator;
 62 import org.netbeans.jemmy.operators.JComponentOperator.JComponentByTipFinder;
 63 import org.netbeans.jemmy.util.Platform;
<a name="2" id="anc2"></a>
 64 import org.testng.annotations.BeforeTest;
 65 import org.testng.annotations.Listeners;
 66 import org.jemmy2ext.JemmyExt.ByToolTipChooser;
 67 
 68 /*
 69  * @test
 70  * @key headful
 71  * @summary Verifies SwingSet3 FileChooserDemo by selecting an image file
 72  *  using Select Image and Select with preview, performing image
 73  *  transformation operations on the selected image and saving it.
 74  *
 75  * @library /sanity/client/lib/jemmy/src
 76  * @library /sanity/client/lib/Extensions/src
 77  * @library /sanity/client/lib/SwingSet3/src
 78  * @modules java.desktop
 79  *          java.logging
 80  * @build org.jemmy2ext.JemmyExt
 81  * @build com.sun.swingset3.demos.filechooser.FileChooserDemo
 82  * @run testng/timeout=600 FileChooserDemoTest
 83  */
 84 @Listeners(GuiTestListener.class)
 85 public class FileChooserDemoTest {
 86 
 87     public static final Path TEST_SRC = Paths.get(System.getProperty(&quot;test.src&quot;));
 88     public static final Path TEST_WORK_DIR = Paths.get(System.getProperty(&quot;user.dir&quot;));
 89     public static final Path IMAGE_DIR = TEST_SRC.resolve(&quot;resources&quot;).resolve(&quot;images&quot;);
 90     public static final String IMAGE = &quot;duke.jpg&quot;;
 91     private static final String YES = &quot;Yes&quot;;
 92     private static final String NO = &quot;No&quot;;
 93     private static final String OPEN = &quot;Open&quot;;
 94     private static final String OK = &quot;OK&quot;;
 95     private static final String CANCEL = &quot;Cancel&quot;;
 96     private static final String USER_HOME = &quot;user.home&quot;;
 97     private static final String DESKTOP = &quot;Desktop&quot;;
 98     private static final int greyFilterID = 7;
 99 
100     private JFrameOperator frame;
101     private JButtonOperator selectImageButton;
102     private JButtonOperator selectWithPreviewButton;
103     private JFileChooserOperator fileChooser;
104     private JButtonOperator upLevelButton;
105     private JButtonOperator rotateLeftButton;
106     private JButtonOperator rotateRightButton;
107     private JButtonOperator flipHorizontalButton;
108     private JButtonOperator flipVerticalButton;
109     private JButtonOperator applyFilterButton;
110     private JButtonOperator saveButton;
111     private JButtonOperator cancelButton;
112     private JButtonOperator yesButton;
113     private JButtonOperator noButton;
114     private JButtonOperator openButton;
115     private JComboBoxOperator filterComboBox;
116     private JDialogOperator confirmationDialog;
117     private JToggleButtonOperator getDetailsToggleButton;
118     private JToggleButtonOperator getListToggleButton;
119     private JDialogOperator fileChooserDialog;
120 
121     @BeforeTest
122     public void beforeTest() throws Exception {
123         Files.copy(IMAGE_DIR.resolve(IMAGE), TEST_WORK_DIR.resolve(IMAGE));
124     }
125 
126     @Test(dataProvider = &quot;availableLookAndFeels&quot;, dataProviderClass = TestHelpers.class)
127     public void test(String lookAndFeel) throws Exception {
128         UIManager.setLookAndFeel(lookAndFeel);
129         new ClassReference(FileChooserDemo.class.getCanonicalName()).startApplication();
130         frame = new JFrameOperator(DEMO_TITLE);
131         initializeSelectImageButtons();
132         initializeImageOperationButtons();
133         checkSelectImage();
134         checkImageOperations();
135         checkSelectWithPreview();
136         checkImageOperations();
137     }
138 
139     private void checkSelectImage() throws Exception {
140         selectImageButton.push();
141         fileChooser = new JFileChooserOperator(JFileChooserOperator.findJFileChooser((Container) frame.getSource()));
142         // In Aqua, GTK and Motif L&amp;Fs, JFileChooser does not have
143         // &quot;Go Home&quot;, &quot;Up One Level&quot;, &quot;Get Details&quot;, &quot;Get List&quot; buttons.
<a name="3" id="anc3"></a><span class="line-modified">144         if (!UIManager.getLookAndFeel().getID().equals(&quot;Aqua&quot;)</span>
<span class="line-removed">145                 &amp;&amp; !UIManager.getLookAndFeel().getID().equals(&quot;Motif&quot;)</span>
<span class="line-removed">146                 &amp;&amp; !UIManager.getLookAndFeel().getID().equals(&quot;GTK&quot;)) {</span>
147             File previousDirectory = fileChooser.getCurrentDirectory();
148             fileChooser.goHome();
149             // In Windows, pressing goHome navigates to Desktop inside the home directory.
150             // This is the expected behavior for windows.
151             if (!Platform.isWindows()) {
152                 waitCurrentPath(Paths.get(System.getProperty(USER_HOME)));
153             } else {
154                 waitCurrentPath(Paths.get(System.getProperty(USER_HOME)).resolve(DESKTOP));
155             }
156             fileChooser.setCurrentDirectory(previousDirectory);
157             fileChooser.rescanCurrentDirectory();
158             // In Windows and Windows Classic L&amp;F, List and Details views are
159             // implemented as a popup menu item
<a name="4" id="anc4"></a><span class="line-modified">160             if(UIManager.getLookAndFeel().getID().equals(&quot;Windows&quot;)) {</span>
161                 JButtonOperator popupButton = new JButtonOperator(fileChooser, new JComponentByTipFinder(
162                         UIManager.getString(&quot;FileChooser.viewMenuButtonToolTipText&quot;, fileChooser.getLocale())));
163                 popupButton.push();
164                 JPopupMenuOperator popup = new JPopupMenuOperator();
165                 popup.pushKey(KeyEvent.VK_ENTER);
166                 JRadioButtonMenuItemOperator detailsMenuItem = new JRadioButtonMenuItemOperator(popup, 1);
167                 detailsMenuItem.push();
168                 detailsMenuItem.waitSelected(true);
169                 popupButton.push();
170                 JRadioButtonMenuItemOperator listMenuItem = new JRadioButtonMenuItemOperator(popup);
171                 listMenuItem.push();
172                 listMenuItem.waitSelected(true);
173             } else {
174                 initializeFileChooserButtons();
175                 upLevelButton.push();
176                 waitCurrentPath(previousDirectory.getParentFile().toPath());
177                 fileChooser.setCurrentDirectory(previousDirectory);
178                 fileChooser.rescanCurrentDirectory();
179                 getDetailsToggleButton.push();
180                 getDetailsToggleButton.waitSelected(true);
181                 getListToggleButton.push();
182                 getListToggleButton.waitSelected(true);
183             }
184             // Wait for the count of number of files to be 1
185             fileChooser.waitFileCount(1);
186             fileChooser.selectFile(IMAGE);
187         } else {
188             fileChooser.setCurrentDirectory(TEST_WORK_DIR.toFile());
189             fileChooser.selectFile(IMAGE);
190         }
191         selectImageButton.push();
192         applyFilterButton.waitComponentEnabled();
193     }
194 
195     private void checkSelectWithPreview() {
196         selectWithPreviewButton.pushNoBlock();
197         initializeSelectWithPreviewDialog();
198         cancelButton.push();
199         fileChooserDialog.waitClosed();
200         selectWithPreviewButton.pushNoBlock();
201         initializeSelectWithPreviewDialog();
202         fileChooser.selectFile(IMAGE);
203         openButton.push();
204         fileChooserDialog.waitClosed();
205     }
206 
207     private void checkImageOperations() throws Exception {
208         // Check Rotate Left Button
209         {
210             int initialValue = getRotateLeftCount();
211             // Push Button and wait for rotateLeftCount count to increment.
212             rotateLeftButton.push();
213             rotateLeftButton.waitState(button -&gt; getRotateLeftCount() == initialValue + 1);
214         }
215         // Check Rotate Right Button
216         {
217             int initialValue = getRotateRightCount();
218             // Push Button and wait for rotateRightCount count to increment.
219             rotateRightButton.push();
220             rotateRightButton.waitState(button -&gt; getRotateRightCount() == initialValue + 1);
221         }
222         // Check Apply Filter Button
223         filterComboBox.selectItem(GRAY);
224         applyFilterButton.push();
225         applyFilterButton.waitState(button -&gt; getLastAppliedFilterId() == greyFilterID);
226         // Check Save and Yes Buttons
227         initializeSaveAndCancelButton();
228         saveButton.pushNoBlock();
229         //Wait for the dialog to show and initialize it
230         waitAndinitializeConfirmationDialog();
231         yesButton.push();
232         waitButtonDisabled(saveButton);
233 
234         // Check Flip Vertical Button
235         {
236             int initialValue = getFlipVerticalCount();
237             // Push Button and wait for flipVerticalCount count to increment.
238             flipVerticalButton.push();
239             flipVerticalButton.waitState(button -&gt; getFlipVerticalCount() == initialValue + 1);
240 
241         }
242         // Check Save and No Buttons
243         saveButton.pushNoBlock();
244         //Wait for the dialog to show and initialize it
245         waitAndinitializeConfirmationDialog();
246         noButton.push();
247         confirmationDialog.waitClosed();
248         saveButton.waitComponentEnabled();
249         // Check Flip Horizontal Button
250         {
251             int initialValue = getFlipHorizontalCount();
252             // Push Button and wait for flipHorizontalCount count to increment.
253             flipHorizontalButton.push();
254             flipHorizontalButton.waitState(button -&gt; getFlipHorizontalCount() == initialValue + 1);
255         }
256         // Check Cancel Button
257         cancelButton.push();
258         waitButtonDisabled(saveButton);
259     }
260 
261     private void initializeFileChooserButtons() {
262         upLevelButton = new JButtonOperator(fileChooser.getUpLevelButton());
263         getDetailsToggleButton = new JToggleButtonOperator(fileChooser.getDetailsToggleButton());
264         getListToggleButton = new JToggleButtonOperator(fileChooser.getListToggleButton());
265     }
266 
267     private void initializeSelectImageButtons() {
268         selectImageButton = new JButtonOperator(frame, FILE_CHOOSER_DEMO_SELECT_TEXT);
269         selectWithPreviewButton = new JButtonOperator(frame, FILE_CHOOSER_DEMO_SELECT_WITH_PREVIEW);
270     }
271 
272     private void initializeSelectWithPreviewDialog() {
273         fileChooser = new JFileChooserOperator();
274         fileChooserDialog = new JDialogOperator(OPEN);
275         String openButtonText = OPEN;
276         // In GTK and Motif L&amp;F, open button text is &#39;OK&#39;
<a name="5" id="anc5"></a><span class="line-modified">277         if (UIManager.getLookAndFeel().getID().equals(&quot;Motif&quot;)</span>
<span class="line-removed">278                 || UIManager.getLookAndFeel().getID().equals(&quot;GTK&quot;)) {</span>
279             openButtonText = OK;
280         }
281         openButton = new JButtonOperator(fileChooser, openButtonText);
282         cancelButton = new JButtonOperator(fileChooser, CANCEL);
283     }
284 
285     private void initializeImageOperationButtons() {
286         rotateLeftButton = new JButtonOperator(frame,
287                 new ByToolTipChooser(ROTATE_LEFT_TOOLTIP));
288         rotateRightButton = new JButtonOperator(frame,
289                 new ByToolTipChooser(ROTATE_RIGHT_TOOLTIP));
290         flipHorizontalButton = new JButtonOperator(frame,
291                 new ByToolTipChooser(FLIP_HORIZONTAL_TOOLTIP));
292         flipVerticalButton = new JButtonOperator(frame,
293                 new ByToolTipChooser(FLIP_VERTICAL_TOOLTIP));
294         applyFilterButton = new JButtonOperator(frame,
295                 new ByToolTipChooser(APPLY_FILTER_TOOLTIP));
296         filterComboBox = new JComboBoxOperator(frame);
297     }
298 
299     private void initializeSaveAndCancelButton() {
300         saveButton = new JButtonOperator(frame, FILE_CHOOSER_DEMO_SAVE_TEXT);
301         cancelButton = new JButtonOperator(frame, FILE_CHOOSER_DEMO_CANCEL_TEXT);
302     }
303 
304     private void waitAndinitializeConfirmationDialog() {
305         //Wait for the dialog to show
306         JDialogOperator.waitJDialog(FILE_CHOOSER_DEMO_SAVEQUESTION_TITLE, true, true);
307         confirmationDialog = new JDialogOperator(FILE_CHOOSER_DEMO_SAVEQUESTION_TITLE);
308         yesButton = new JButtonOperator(confirmationDialog, YES);
309         noButton = new JButtonOperator(confirmationDialog, NO);
310     }
311 
312     private void waitButtonDisabled(JButtonOperator button) {
313         button.waitState(b -&gt; b.isEnabled() == false);
314     }
315 
316     private void waitCurrentPath(Path expectedPath) {
317         //Wait for the current path to be same as expected path
318         fileChooser.waitState(chooser -&gt; fileChooser.getCurrentDirectory().toPath().equals(expectedPath));
319     }
320 
321 }
322 
<a name="6" id="anc6"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="6" type="hidden" />
</body>
</html>