<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jdk/sanity/client/SwingSet/src/FileChooserDemoTest.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="EditorPaneDemoTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="InternalFrameDemoTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jdk/sanity/client/SwingSet/src/FileChooserDemoTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 44 import java.awt.Container;
 45 import java.awt.event.KeyEvent;
 46 import java.io.File;
 47 import java.nio.file.Files;
 48 import java.nio.file.Path;
 49 import java.nio.file.Paths;
 50 import org.testng.annotations.Test;
 51 import javax.swing.UIManager;
 52 
 53 import org.netbeans.jemmy.ClassReference;
 54 import org.netbeans.jemmy.operators.JFrameOperator;
 55 import org.netbeans.jemmy.operators.JPopupMenuOperator;
 56 import org.netbeans.jemmy.operators.JRadioButtonMenuItemOperator;
 57 import org.netbeans.jemmy.operators.JButtonOperator;
 58 import org.netbeans.jemmy.operators.JComboBoxOperator;
 59 import org.netbeans.jemmy.operators.JToggleButtonOperator;
 60 import org.netbeans.jemmy.operators.JFileChooserOperator;
 61 import org.netbeans.jemmy.operators.JDialogOperator;
 62 import org.netbeans.jemmy.operators.JComponentOperator.JComponentByTipFinder;
 63 import org.netbeans.jemmy.util.Platform;

 64 import org.testng.annotations.BeforeTest;
 65 import org.testng.annotations.Listeners;
 66 import org.jemmy2ext.JemmyExt.ByToolTipChooser;
 67 
 68 /*
 69  * @test
 70  * @key headful
 71  * @summary Verifies SwingSet3 FileChooserDemo by selecting an image file
 72  *  using Select Image and Select with preview, performing image
 73  *  transformation operations on the selected image and saving it.
 74  *
 75  * @library /sanity/client/lib/jemmy/src
 76  * @library /sanity/client/lib/Extensions/src
 77  * @library /sanity/client/lib/SwingSet3/src
 78  * @modules java.desktop
 79  *          java.logging
 80  * @build org.jemmy2ext.JemmyExt
 81  * @build com.sun.swingset3.demos.filechooser.FileChooserDemo
 82  * @run testng/timeout=600 FileChooserDemoTest
 83  */
</pre>
<hr />
<pre>
124     }
125 
126     @Test(dataProvider = &quot;availableLookAndFeels&quot;, dataProviderClass = TestHelpers.class)
127     public void test(String lookAndFeel) throws Exception {
128         UIManager.setLookAndFeel(lookAndFeel);
129         new ClassReference(FileChooserDemo.class.getCanonicalName()).startApplication();
130         frame = new JFrameOperator(DEMO_TITLE);
131         initializeSelectImageButtons();
132         initializeImageOperationButtons();
133         checkSelectImage();
134         checkImageOperations();
135         checkSelectWithPreview();
136         checkImageOperations();
137     }
138 
139     private void checkSelectImage() throws Exception {
140         selectImageButton.push();
141         fileChooser = new JFileChooserOperator(JFileChooserOperator.findJFileChooser((Container) frame.getSource()));
142         // In Aqua, GTK and Motif L&amp;Fs, JFileChooser does not have
143         // &quot;Go Home&quot;, &quot;Up One Level&quot;, &quot;Get Details&quot;, &quot;Get List&quot; buttons.
<span class="line-modified">144         if (!UIManager.getLookAndFeel().getID().equals(&quot;Aqua&quot;)</span>
<span class="line-removed">145                 &amp;&amp; !UIManager.getLookAndFeel().getID().equals(&quot;Motif&quot;)</span>
<span class="line-removed">146                 &amp;&amp; !UIManager.getLookAndFeel().getID().equals(&quot;GTK&quot;)) {</span>
147             File previousDirectory = fileChooser.getCurrentDirectory();
148             fileChooser.goHome();
149             // In Windows, pressing goHome navigates to Desktop inside the home directory.
150             // This is the expected behavior for windows.
151             if (!Platform.isWindows()) {
152                 waitCurrentPath(Paths.get(System.getProperty(USER_HOME)));
153             } else {
154                 waitCurrentPath(Paths.get(System.getProperty(USER_HOME)).resolve(DESKTOP));
155             }
156             fileChooser.setCurrentDirectory(previousDirectory);
157             fileChooser.rescanCurrentDirectory();
158             // In Windows and Windows Classic L&amp;F, List and Details views are
159             // implemented as a popup menu item
<span class="line-modified">160             if(UIManager.getLookAndFeel().getID().equals(&quot;Windows&quot;)) {</span>
161                 JButtonOperator popupButton = new JButtonOperator(fileChooser, new JComponentByTipFinder(
162                         UIManager.getString(&quot;FileChooser.viewMenuButtonToolTipText&quot;, fileChooser.getLocale())));
163                 popupButton.push();
164                 JPopupMenuOperator popup = new JPopupMenuOperator();
165                 popup.pushKey(KeyEvent.VK_ENTER);
166                 JRadioButtonMenuItemOperator detailsMenuItem = new JRadioButtonMenuItemOperator(popup, 1);
167                 detailsMenuItem.push();
168                 detailsMenuItem.waitSelected(true);
169                 popupButton.push();
170                 JRadioButtonMenuItemOperator listMenuItem = new JRadioButtonMenuItemOperator(popup);
171                 listMenuItem.push();
172                 listMenuItem.waitSelected(true);
173             } else {
174                 initializeFileChooserButtons();
175                 upLevelButton.push();
176                 waitCurrentPath(previousDirectory.getParentFile().toPath());
177                 fileChooser.setCurrentDirectory(previousDirectory);
178                 fileChooser.rescanCurrentDirectory();
179                 getDetailsToggleButton.push();
180                 getDetailsToggleButton.waitSelected(true);
</pre>
<hr />
<pre>
257         cancelButton.push();
258         waitButtonDisabled(saveButton);
259     }
260 
261     private void initializeFileChooserButtons() {
262         upLevelButton = new JButtonOperator(fileChooser.getUpLevelButton());
263         getDetailsToggleButton = new JToggleButtonOperator(fileChooser.getDetailsToggleButton());
264         getListToggleButton = new JToggleButtonOperator(fileChooser.getListToggleButton());
265     }
266 
267     private void initializeSelectImageButtons() {
268         selectImageButton = new JButtonOperator(frame, FILE_CHOOSER_DEMO_SELECT_TEXT);
269         selectWithPreviewButton = new JButtonOperator(frame, FILE_CHOOSER_DEMO_SELECT_WITH_PREVIEW);
270     }
271 
272     private void initializeSelectWithPreviewDialog() {
273         fileChooser = new JFileChooserOperator();
274         fileChooserDialog = new JDialogOperator(OPEN);
275         String openButtonText = OPEN;
276         // In GTK and Motif L&amp;F, open button text is &#39;OK&#39;
<span class="line-modified">277         if (UIManager.getLookAndFeel().getID().equals(&quot;Motif&quot;)</span>
<span class="line-removed">278                 || UIManager.getLookAndFeel().getID().equals(&quot;GTK&quot;)) {</span>
279             openButtonText = OK;
280         }
281         openButton = new JButtonOperator(fileChooser, openButtonText);
282         cancelButton = new JButtonOperator(fileChooser, CANCEL);
283     }
284 
285     private void initializeImageOperationButtons() {
286         rotateLeftButton = new JButtonOperator(frame,
287                 new ByToolTipChooser(ROTATE_LEFT_TOOLTIP));
288         rotateRightButton = new JButtonOperator(frame,
289                 new ByToolTipChooser(ROTATE_RIGHT_TOOLTIP));
290         flipHorizontalButton = new JButtonOperator(frame,
291                 new ByToolTipChooser(FLIP_HORIZONTAL_TOOLTIP));
292         flipVerticalButton = new JButtonOperator(frame,
293                 new ByToolTipChooser(FLIP_VERTICAL_TOOLTIP));
294         applyFilterButton = new JButtonOperator(frame,
295                 new ByToolTipChooser(APPLY_FILTER_TOOLTIP));
296         filterComboBox = new JComboBoxOperator(frame);
297     }
298 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
 44 import java.awt.Container;
 45 import java.awt.event.KeyEvent;
 46 import java.io.File;
 47 import java.nio.file.Files;
 48 import java.nio.file.Path;
 49 import java.nio.file.Paths;
 50 import org.testng.annotations.Test;
 51 import javax.swing.UIManager;
 52 
 53 import org.netbeans.jemmy.ClassReference;
 54 import org.netbeans.jemmy.operators.JFrameOperator;
 55 import org.netbeans.jemmy.operators.JPopupMenuOperator;
 56 import org.netbeans.jemmy.operators.JRadioButtonMenuItemOperator;
 57 import org.netbeans.jemmy.operators.JButtonOperator;
 58 import org.netbeans.jemmy.operators.JComboBoxOperator;
 59 import org.netbeans.jemmy.operators.JToggleButtonOperator;
 60 import org.netbeans.jemmy.operators.JFileChooserOperator;
 61 import org.netbeans.jemmy.operators.JDialogOperator;
 62 import org.netbeans.jemmy.operators.JComponentOperator.JComponentByTipFinder;
 63 import org.netbeans.jemmy.util.Platform;
<span class="line-added"> 64 import org.netbeans.jemmy.util.LookAndFeel;</span>
 65 import org.testng.annotations.BeforeTest;
 66 import org.testng.annotations.Listeners;
 67 import org.jemmy2ext.JemmyExt.ByToolTipChooser;
 68 
 69 /*
 70  * @test
 71  * @key headful
 72  * @summary Verifies SwingSet3 FileChooserDemo by selecting an image file
 73  *  using Select Image and Select with preview, performing image
 74  *  transformation operations on the selected image and saving it.
 75  *
 76  * @library /sanity/client/lib/jemmy/src
 77  * @library /sanity/client/lib/Extensions/src
 78  * @library /sanity/client/lib/SwingSet3/src
 79  * @modules java.desktop
 80  *          java.logging
 81  * @build org.jemmy2ext.JemmyExt
 82  * @build com.sun.swingset3.demos.filechooser.FileChooserDemo
 83  * @run testng/timeout=600 FileChooserDemoTest
 84  */
</pre>
<hr />
<pre>
125     }
126 
127     @Test(dataProvider = &quot;availableLookAndFeels&quot;, dataProviderClass = TestHelpers.class)
128     public void test(String lookAndFeel) throws Exception {
129         UIManager.setLookAndFeel(lookAndFeel);
130         new ClassReference(FileChooserDemo.class.getCanonicalName()).startApplication();
131         frame = new JFrameOperator(DEMO_TITLE);
132         initializeSelectImageButtons();
133         initializeImageOperationButtons();
134         checkSelectImage();
135         checkImageOperations();
136         checkSelectWithPreview();
137         checkImageOperations();
138     }
139 
140     private void checkSelectImage() throws Exception {
141         selectImageButton.push();
142         fileChooser = new JFileChooserOperator(JFileChooserOperator.findJFileChooser((Container) frame.getSource()));
143         // In Aqua, GTK and Motif L&amp;Fs, JFileChooser does not have
144         // &quot;Go Home&quot;, &quot;Up One Level&quot;, &quot;Get Details&quot;, &quot;Get List&quot; buttons.
<span class="line-modified">145         if (!LookAndFeel.isAqua() &amp;&amp; !LookAndFeel.isMotif() &amp;&amp; !LookAndFeel.isGTK()) {</span>


146             File previousDirectory = fileChooser.getCurrentDirectory();
147             fileChooser.goHome();
148             // In Windows, pressing goHome navigates to Desktop inside the home directory.
149             // This is the expected behavior for windows.
150             if (!Platform.isWindows()) {
151                 waitCurrentPath(Paths.get(System.getProperty(USER_HOME)));
152             } else {
153                 waitCurrentPath(Paths.get(System.getProperty(USER_HOME)).resolve(DESKTOP));
154             }
155             fileChooser.setCurrentDirectory(previousDirectory);
156             fileChooser.rescanCurrentDirectory();
157             // In Windows and Windows Classic L&amp;F, List and Details views are
158             // implemented as a popup menu item
<span class="line-modified">159             if(LookAndFeel.isWindows() || LookAndFeel.isWindowsClassic()) {</span>
160                 JButtonOperator popupButton = new JButtonOperator(fileChooser, new JComponentByTipFinder(
161                         UIManager.getString(&quot;FileChooser.viewMenuButtonToolTipText&quot;, fileChooser.getLocale())));
162                 popupButton.push();
163                 JPopupMenuOperator popup = new JPopupMenuOperator();
164                 popup.pushKey(KeyEvent.VK_ENTER);
165                 JRadioButtonMenuItemOperator detailsMenuItem = new JRadioButtonMenuItemOperator(popup, 1);
166                 detailsMenuItem.push();
167                 detailsMenuItem.waitSelected(true);
168                 popupButton.push();
169                 JRadioButtonMenuItemOperator listMenuItem = new JRadioButtonMenuItemOperator(popup);
170                 listMenuItem.push();
171                 listMenuItem.waitSelected(true);
172             } else {
173                 initializeFileChooserButtons();
174                 upLevelButton.push();
175                 waitCurrentPath(previousDirectory.getParentFile().toPath());
176                 fileChooser.setCurrentDirectory(previousDirectory);
177                 fileChooser.rescanCurrentDirectory();
178                 getDetailsToggleButton.push();
179                 getDetailsToggleButton.waitSelected(true);
</pre>
<hr />
<pre>
256         cancelButton.push();
257         waitButtonDisabled(saveButton);
258     }
259 
260     private void initializeFileChooserButtons() {
261         upLevelButton = new JButtonOperator(fileChooser.getUpLevelButton());
262         getDetailsToggleButton = new JToggleButtonOperator(fileChooser.getDetailsToggleButton());
263         getListToggleButton = new JToggleButtonOperator(fileChooser.getListToggleButton());
264     }
265 
266     private void initializeSelectImageButtons() {
267         selectImageButton = new JButtonOperator(frame, FILE_CHOOSER_DEMO_SELECT_TEXT);
268         selectWithPreviewButton = new JButtonOperator(frame, FILE_CHOOSER_DEMO_SELECT_WITH_PREVIEW);
269     }
270 
271     private void initializeSelectWithPreviewDialog() {
272         fileChooser = new JFileChooserOperator();
273         fileChooserDialog = new JDialogOperator(OPEN);
274         String openButtonText = OPEN;
275         // In GTK and Motif L&amp;F, open button text is &#39;OK&#39;
<span class="line-modified">276         if (LookAndFeel.isMotif() || LookAndFeel.isGTK()) {</span>

277             openButtonText = OK;
278         }
279         openButton = new JButtonOperator(fileChooser, openButtonText);
280         cancelButton = new JButtonOperator(fileChooser, CANCEL);
281     }
282 
283     private void initializeImageOperationButtons() {
284         rotateLeftButton = new JButtonOperator(frame,
285                 new ByToolTipChooser(ROTATE_LEFT_TOOLTIP));
286         rotateRightButton = new JButtonOperator(frame,
287                 new ByToolTipChooser(ROTATE_RIGHT_TOOLTIP));
288         flipHorizontalButton = new JButtonOperator(frame,
289                 new ByToolTipChooser(FLIP_HORIZONTAL_TOOLTIP));
290         flipVerticalButton = new JButtonOperator(frame,
291                 new ByToolTipChooser(FLIP_VERTICAL_TOOLTIP));
292         applyFilterButton = new JButtonOperator(frame,
293                 new ByToolTipChooser(APPLY_FILTER_TOOLTIP));
294         filterComboBox = new JComboBoxOperator(frame);
295     }
296 
</pre>
</td>
</tr>
</table>
<center><a href="EditorPaneDemoTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="InternalFrameDemoTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>