<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/lib/jdk/test/lib/Utils.java</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="SecurityTools.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="apps/LingeredApp.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/lib/jdk/test/lib/Utils.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2013, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,10 +23,11 @@</span>
  
  package jdk.test.lib;
  
  import java.io.File;
  import java.io.IOException;
<span class="udiff-line-added">+ import java.lang.annotation.Annotation;</span>
  import java.net.InetAddress;
  import java.net.InetSocketAddress;
  import java.net.MalformedURLException;
  import java.net.ServerSocket;
  import java.net.URL;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -141,19 +142,10 @@</span>
  
      private Utils() {
          // Private constructor to prevent class instantiation
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Returns the list of VM options.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @return List of VM options</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public static List&lt;String&gt; getVmOptions() {</span>
<span class="udiff-line-removed">-         return Arrays.asList(safeSplitString(VM_OPTIONS));</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      /**
       * Returns the list of VM options with -J prefix.
       *
       * @return The list of VM options with -J prefix
       */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -180,27 +172,47 @@</span>
      /**
       * Combines given arguments with default JTReg arguments for a jvm running a test.
       * This is the combination of JTReg arguments test.vm.opts and test.java.opts
       * @return The combination of JTReg test java options and user args.
       */
<span class="udiff-line-modified-removed">-     public static String[] addTestJavaOpts(String... userArgs) {</span>
<span class="udiff-line-modified-added">+     public static String[] prependTestJavaOpts(String... userArgs) {</span>
          List&lt;String&gt; opts = new ArrayList&lt;String&gt;();
          Collections.addAll(opts, getTestJavaOpts());
          Collections.addAll(opts, userArgs);
          return opts.toArray(new String[0]);
      }
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Combines given arguments with default JTReg arguments for a jvm running a test.</span>
<span class="udiff-line-added">+      * This is the combination of JTReg arguments test.vm.opts and test.java.opts</span>
<span class="udiff-line-added">+      * @return The combination of JTReg test java options and user args.</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     public static String[] appendTestJavaOpts(String... userArgs) {</span>
<span class="udiff-line-added">+         List&lt;String&gt; opts = new ArrayList&lt;String&gt;();</span>
<span class="udiff-line-added">+         Collections.addAll(opts, userArgs);</span>
<span class="udiff-line-added">+         Collections.addAll(opts, getTestJavaOpts());</span>
<span class="udiff-line-added">+         return opts.toArray(new String[0]);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Combines given arguments with default JTReg arguments for a jvm running a test.</span>
<span class="udiff-line-added">+      * This is the combination of JTReg arguments test.vm.opts and test.java.opts</span>
<span class="udiff-line-added">+      * @return The combination of JTReg test java options and user args.</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     public static String[] addTestJavaOpts(String... userArgs) {</span>
<span class="udiff-line-added">+         return prependTestJavaOpts(userArgs);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * Removes any options specifying which GC to use, for example &quot;-XX:+UseG1GC&quot;.
       * Removes any options matching: -XX:(+/-)Use*GC
       * Used when a test need to set its own GC version. Then any
       * GC specified by the framework must first be removed.
       * @return A copy of given opts with all GC options removed.
       */
      private static final Pattern useGcPattern = Pattern.compile(
<span class="udiff-line-modified-removed">-             &quot;(?:\\-XX\\:[\\+\\-]Use.+GC)&quot;</span>
<span class="udiff-line-removed">-             + &quot;|(?:\\-Xconcgc)&quot;);</span>
<span class="udiff-line-modified-added">+             &quot;(?:\\-XX\\:[\\+\\-]Use.+GC)&quot;);</span>
      public static List&lt;String&gt; removeGcOpts(List&lt;String&gt; opts) {
          List&lt;String&gt; optsWithoutGC = new ArrayList&lt;String&gt;();
          for (String opt : opts) {
              if (useGcPattern.matcher(opt).matches()) {
                  System.out.println(&quot;removeGcOpts: removed &quot; + opt);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -747,17 +759,18 @@</span>
      // It can handle both jtreg tests and a testng tests wrapped inside jtreg tests.
      // For jtreg tests the name of the test will be searched by stack-walking
      // until the method main() is found; the class containing that method is the
      // main test class and will be returned as the name of the test.
      // Special handling is used for testng tests.
<span class="udiff-line-added">+     @SuppressWarnings(&quot;unchecked&quot;)</span>
      public static String getTestName() {
          String result = null;
          // If we are using testng, then we should be able to load the &quot;Test&quot; annotation.
<span class="udiff-line-modified-removed">-         Class testClassAnnotation;</span>
<span class="udiff-line-modified-added">+         Class&lt;? extends Annotation&gt; testClassAnnotation;</span>
  
          try {
<span class="udiff-line-modified-removed">-             testClassAnnotation = Class.forName(&quot;org.testng.annotations.Test&quot;);</span>
<span class="udiff-line-modified-added">+             testClassAnnotation = (Class&lt;? extends Annotation&gt;)Class.forName(&quot;org.testng.annotations.Test&quot;);</span>
          } catch (ClassNotFoundException e) {
              testClassAnnotation = null;
          }
  
          StackTraceElement[] elms = (new Throwable()).getStackTrace();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -774,11 +787,11 @@</span>
              // If this is a testng test, the test will have no &quot;main&quot; method. We can
              // detect a testng test class by looking for the org.testng.annotations.Test
              // annotation. If present, then use the name of this class.
              if (testClassAnnotation != null) {
                  try {
<span class="udiff-line-modified-removed">-                     Class c = Class.forName(className);</span>
<span class="udiff-line-modified-added">+                     Class&lt;?&gt; c = Class.forName(className);</span>
                      if (c.isAnnotationPresent(testClassAnnotation)) {
                          result = className;
                          break;
                      }
                  } catch (ClassNotFoundException e) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -813,6 +826,26 @@</span>
       */
      public static Path createTempFile(String prefix, String suffix, FileAttribute&lt;?&gt;... attrs) throws IOException {
          Path dir = Paths.get(System.getProperty(&quot;user.dir&quot;, &quot;.&quot;));
          return Files.createTempFile(dir, prefix, suffix);
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Creates an empty directory in &quot;user.dir&quot; or &quot;.&quot;</span>
<span class="udiff-line-added">+      * &lt;p&gt;</span>
<span class="udiff-line-added">+      * This method is meant as a replacement for {@code Files#createTempDirectory(String, String, FileAttribute...)}</span>
<span class="udiff-line-added">+      * that doesn&#39;t leave files behind in /tmp directory of the test machine</span>
<span class="udiff-line-added">+      * &lt;p&gt;</span>
<span class="udiff-line-added">+      * If the property &quot;user.dir&quot; is not set, &quot;.&quot; will be used.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param prefix</span>
<span class="udiff-line-added">+      * @param attrs</span>
<span class="udiff-line-added">+      * @return the path to the newly created directory</span>
<span class="udiff-line-added">+      * @throws IOException</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @see {@link Files#createTempDirectory(String, String, FileAttribute...)}</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     public static Path createTempDirectory(String prefix, FileAttribute&lt;?&gt;... attrs) throws IOException {</span>
<span class="udiff-line-added">+         Path dir = Paths.get(System.getProperty(&quot;user.dir&quot;, &quot;.&quot;));</span>
<span class="udiff-line-added">+         return Files.createTempDirectory(dir, prefix);</span>
<span class="udiff-line-added">+     }</span>
  }
</pre>
<center><a href="SecurityTools.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="apps/LingeredApp.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>