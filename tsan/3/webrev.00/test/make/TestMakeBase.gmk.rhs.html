<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/make/TestMakeBase.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
    <script type="text/javascript" src="../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 #
<a name="1" id="anc1"></a><span class="line-modified">  2 # Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 default: all
 27 
 28 include $(SPEC)
 29 include MakeBase.gmk
 30 include UtilsForTests.gmk
 31 
 32 THIS_FILE := $(TOPDIR)/test/make/TestMakeBase.gmk
 33 DEPS := $(THIS_FILE) \
 34     $(TOPDIR)/make/common/MakeBase.gmk \
 35     #
 36 
 37 OUTPUT_DIR := $(TESTMAKE_OUTPUTDIR)/make-base
 38 $(call MakeDir, $(OUTPUT_DIR))
 39 
 40 ################################################################################
 41 # Escape $
 42 ifneq ($(call EscapeDollar, foo$$bar), foo\$$bar)
 43   $(error EscapeDollar failed $(call EscapeDollar, foo$$bar) foo\$$bar)
 44 endif
 45 
 46 ESCAPE_DOLLAR_DIR := $(OUTPUT_DIR)/escape-dollar
 47 
 48 $(ESCAPE_DOLLAR_DIR)/_escape_dollar: $(DEPS)
 49 	$(RM) -r $(@D)
 50 	$(MKDIR) -p $(@D)
 51 	$(ECHO) foo\$$bar &gt; $(@D)/file1
 52 	$(ECHO) $(call EscapeDollar, foo$$bar) &gt; $(@D)/file2
 53 	$(ECHO) $(call EscapeDollar, foo\$$bar) &gt; $(@D)/file3
 54 	$(DIFF) $(@D)/file1 $(@D)/file2
 55 	$(DIFF) $(@D)/file1 $(@D)/file3
 56 	$(TOUCH) $@
 57 
 58 TEST_TARGETS += $(ESCAPE_DOLLAR_DIR)/_escape_dollar
 59 
 60 ################################################################################
 61 # Test containing and not-containing
 62 
 63 CONT_LIST := foo bar baz foobar foobaz
 64 
 65 # Param 1 - string to look for
 66 # Param 2 - expected result
 67 define TestContaining
 68   value := $$(call containing, $1, $(CONT_LIST))
 69   ifneq ($$(value), $2)
 70     $$(info (call containing, $1, $(CONT_LIST)))
 71     $$(error result &gt;$$(value)&lt;, expected &gt;$2&lt;)
 72   endif
 73 endef
 74 
 75 $(eval $(call TestContaining,bar,bar foobar))
 76 $(eval $(call TestContaining,foo bar,foo bar foobar foobaz))
 77 
 78 # Param 1 - string to look for
 79 # Param 2 - expected result
 80 define TestNotContaining
 81   value := $$(call not-containing, $1, $(CONT_LIST))
 82   ifneq ($$(value), $2)
 83     $$(info (call not-containing, $1, $(CONT_LIST)))
 84     $$(error result &gt;$$(value)&lt;, expected &gt;$2&lt;)
 85   endif
 86 endef
 87 
 88 $(eval $(call TestNotContaining,bar,foo baz foobaz))
 89 $(eval $(call TestNotContaining,foo bar,baz))
 90 
 91 ################################################################################
 92 # Test Equals
 93 
 94 EQUALS_VALUE1 := value1$(SPACE)
 95 EQUALS_VALUE2 := value2
 96 EQUALS_EMPTY :=
 97 
 98 ifneq ($(call equals, $(EQUALS_VALUE1), $(EQUALS_VALUE2)), )
 99   $(error The strings &gt;$(EQUALS_VALUE1)&lt; and &gt;$(EQUALS_VALUE2)&lt; are equal)
100 endif
101 
102 ifeq ($(call equals, $(EQUALS_VALUE1), $(EQUALS_VALUE1)), )
103   $(error The strings &gt;$(EQUALS_VALUE1)&lt; and &gt;$(EQUALS_VALUE1)&lt; are not equal)
104 endif
105 
106 ifeq ($(call equals, $(EQUALS_EMPTY), $(EQUALS_EMPTY)), )
107   $(error The strings &gt;$(EQUALS_EMPTY)&lt; and &gt;$(EQUALS_EMPTY)&lt; are not equal)
108 endif
109 
110 ifneq ($(call equals, $(EQUALS_EMPTY), $(EQUALS_VALUE2)), )
111   $(error The strings &gt;$(EQUALS_EMPTY)&lt; and &gt;$(EQUALS_VALUE2)&lt; are equal)
112 endif
113 
114 ifneq ($(call equals, $(EQUALS_VALUE2), $(EQUALS_EMPTY)), )
115   $(error The strings &gt;$(EQUALS_VALUE2)&lt; and &gt;$(EQUALS_EMPTY)&lt; are equal)
116 endif
117 
118 ################################################################################
119 # Test boolean operators
120 
121 $(eval $(call assert-equals, $(call And,  true  true  true ), true))
122 $(eval $(call assert-equals, $(call And,  true  false true ), false))
123 $(eval $(call assert-equals, $(call And,  false false false ), false))
124 $(eval $(call assert-equals, $(call And, true), true))
125 $(eval $(call assert-equals, $(call And, false), false))
126 $(eval $(call assert-equals, $(call And,    ), true))
127 
128 $(eval $(call assert-equals, $(call Or,  true  true  true ), true))
129 $(eval $(call assert-equals, $(call Or,  true  false true ), true))
130 $(eval $(call assert-equals, $(call Or,  false false false ), false))
131 $(eval $(call assert-equals, $(call Or, true), true))
132 $(eval $(call assert-equals, $(call Or, false), false))
133 $(eval $(call assert-equals, $(call Or,    ), false))
134 
135 # We cannot catch $(error) while testing, but you can enable this manually
136 # by uncommenting and watch make fails.
137 #$(eval $(call assert-equals, $(call And,  non-boolean  ), $(error ...)))
138 #$(eval $(call assert-equals, $(call Or,  non-boolean  ), $(error ...)))
139 
140 ################################################################################
141 # Test remove-prefixes
142 
<a name="2" id="anc2"></a><span class="line-modified">143 $(call AssertEquals, \</span>
144     $(call remove-prefixes, pre, prefix postfix), fix postfix, \
<a name="3" id="anc3"></a><span class="line-modified">145     Prefixes not properly removed)</span>
146 
<a name="4" id="anc4"></a><span class="line-modified">147 $(call AssertEquals, \</span>
148     $(call remove-prefixes, pre post, prefix postfix), fix fix, \
<a name="5" id="anc5"></a><span class="line-modified">149     Prefixes not properly removed)</span>
150 
151 ################################################################################
152 # Test ShellQuote
153 
154 SHELL_QUOTE_VALUE := foo &#39;&quot;&quot;&#39; &quot;&#39;&#39;&quot; bar
155 SHELL_QUOTE_RESULT := $(shell $(ECHO) $(call ShellQuote, \
156     $(SHELL_QUOTE_VALUE)))
157 
158 ifneq ($(SHELL_QUOTE_VALUE), $(SHELL_QUOTE_RESULT))
159   $(error Expected: &gt;$(SHELL_QUOTE_VALUE)&lt; - Result: &gt;$(SHELL_QUOTE_RESULT)&lt;)
160 endif
161 
162 ################################################################################
163 # Test read and write to file
164 
165 READ_WRITE_FILE := $(OUTPUT_DIR)/read-write
166 READ_WRITE_VALUE := foo &#39;&quot;&quot;&#39; &quot;&#39;&#39;&quot; \t\n\\ bar
167 $(call WriteFile, $(READ_WRITE_VALUE), $(READ_WRITE_FILE))
168 READ_WRITE_RESULT := $(call ReadFile, $(READ_WRITE_FILE))
169 
170 ifneq ($(READ_WRITE_VALUE), $(READ_WRITE_RESULT))
171   $(error Expected: &gt;$(READ_WRITE_VALUE)&lt; - Result: &gt;$(READ_WRITE_RESULT)&lt;)
172 endif
173 
174 ################################################################################
175 # Test creating dependencies on make variables
176 
177 VARDEP_DIR := $(OUTPUT_DIR)/vardep
178 VARDEP_SRC_FILE := $(VARDEP_DIR)/src-file
179 VARDEP_TARGET_FILE := $(VARDEP_DIR)/target-file
180 VARDEP_FLAG_FILE := $(VARDEP_DIR)/flag-file
181 
182 $(VARDEP_DIR)/src-file:
183 	$(MKDIR) -p $(@D)
184 	$(ECHO) &quot;some string XXX&quot; &gt; $@
185 
186 $(VARDEP_TARGET_FILE): $(VARDEP_DIR)/src-file \
187     $(call DependOnVariable, VARDEP_TEST_VAR)
188 	$(MKDIR) -p $(@D)
189 	$(SED) -e &#39;s/XXX/$(VARDEP_TEST_VAR)/g&#39; $&lt; &gt; $@
190 	$(TOUCH) $(VARDEP_FLAG_FILE)
191 
192 test-vardep:
193 	$(RM) $(VARDEP_SRC_FILE) $(VARDEP_TARGET_FILE) $(VARDEP_FLAG_FILE)
194         #
195         # Simply create the target file and verify that it has the correct value
196         #
197 	$(MAKE) -f $(THIS_FILE) VARDEP_TEST_VAR=value1 $(VARDEP_TARGET_FILE)
198 	$(PRINTF) &quot;Expecting value1: %s\n&quot; &quot;`$(CAT) $(VARDEP_DIR)/target-file`&quot;
199 	test &quot;some string value1&quot; = &quot;`$(CAT) $(VARDEP_DIR)/target-file`&quot;
200 	test -e $(VARDEP_FLAG_FILE)
201         #
202         # Make the target file again and verify that the value is updated with
203         # the new value
204         #
205 	$(SLEEP_ON_MAC)
206 	$(MAKE) -f $(THIS_FILE) VARDEP_TEST_VAR=value2 $(VARDEP_TARGET_FILE)
207 	$(PRINTF) &quot;Expecting value2: %s\n&quot; &quot;`$(CAT) $(VARDEP_DIR)/target-file`&quot;
208 	test &quot;some string value2&quot; = &quot;`$(CAT) $(VARDEP_DIR)/target-file`&quot;
209 	test -e $(VARDEP_FLAG_FILE)
210         #
211         # Make the target again with the same value and verify that the recipe
212         # was never run by checking that the flag file was not recreated
213         #
214 	$(SLEEP_ON_MAC)
215 	$(RM) $(VARDEP_FLAG_FILE)
216 	$(MAKE) -f $(THIS_FILE) VARDEP_TEST_VAR=value2 $(VARDEP_TARGET_FILE)
217 	$(PRINTF) &quot;Expecting value2: %s\n&quot; &quot;`$(CAT) $(VARDEP_DIR)/target-file`&quot;
218 	test &quot;some string value2&quot; = &quot;`$(CAT) $(VARDEP_DIR)/target-file`&quot;
219 	test ! -e $(VARDEP_FLAG_FILE)
220         #
221         # Test running with spaces at the end and the middle of the value
222         # and verify that the file isn&#39;t rewritten the second time
223         #
224 	$(MAKE) -f $(THIS_FILE) VARDEP_TEST_VAR=&quot;value3  foo &quot; $(VARDEP_TARGET_FILE)
225 	$(RM) $(VARDEP_FLAG_FILE)
226 	$(MAKE) -f $(THIS_FILE) VARDEP_TEST_VAR=&quot;value3 foo&quot; $(VARDEP_TARGET_FILE)
227 	test ! -e $(VARDEP_FLAG_FILE)
228 	$(MAKE) -f $(THIS_FILE) VARDEP_TEST_VAR=&quot; value3  foo&quot; $(VARDEP_TARGET_FILE)
229 	test ! -e $(VARDEP_FLAG_FILE)
230         #
231         # Test including some problematic characters
232 	$(MAKE) -f $(THIS_FILE) VARDEP_TEST_VAR=&#39;value4 \$$ORIGIN&#39; $(VARDEP_TARGET_FILE)
233 	$(RM) $(VARDEP_FLAG_FILE)
234 	$(MAKE) -f $(THIS_FILE) VARDEP_TEST_VAR=&#39;value4 \$$ORIGIN&#39; $(VARDEP_TARGET_FILE)
235 	test ! -e $(VARDEP_FLAG_FILE)
236 
237 # Test specifying a specific value file to store variable in
238 VARDEP_VALUE_FILE := $(VARDEP_DIR)/value-file
239 VARDEP_TEST_VAR2 := value3
240 
241 VARDEP_RETURN_VALUE := $(call DependOnVariable, VARDEP_TEST_VAR2, $(VARDEP_VALUE_FILE))
<a name="6" id="anc6"></a><span class="line-modified">242 $(call AssertEquals, $(VARDEP_RETURN_VALUE), $(VARDEP_VALUE_FILE), \</span>
<span class="line-modified">243     Wrong filename returned)</span>
244 -include $(VARDEP_VALUE_FILE)
<a name="7" id="anc7"></a><span class="line-modified">245 $(call AssertEquals, $(VARDEP_TEST_VAR2_old), $(VARDEP_TEST_VAR2), \</span>
<span class="line-modified">246     Wrong contents in vardeps file)</span>
247 
248 # Test with a variable value containing some problematic characters
249 VARDEP_TEST_VAR3 := foo &#39;&quot;&quot;&#39; &quot;&#39;&#39;&quot; bar \$$ORIGIN &amp;\#x00a9
250 VARDEP_VALUE_FILE := $(call DependOnVariable, VARDEP_TEST_VAR3)
251 -include $(VARDEP_VALUE_FILE)
<a name="8" id="anc8"></a><span class="line-modified">252 $(call AssertEquals, $(call EscapeHash,$(VARDEP_TEST_VAR3_old)), \</span>
253     $(call EscapeHash,$(VARDEP_TEST_VAR3)), \
<a name="9" id="anc9"></a><span class="line-modified">254     Wrong contents in vardep file)</span>
255 
256 TEST_TARGETS += test-vardep
257 
258 ################################################################################
259 # Test sequence
260 
261 ifneq ($(call sequence, 1, 1), 1)
262   $(error Sequence 1, 1 should be &quot;1&quot;, but was $(call sequence, 1, 1))
263 endif
264 
265 ifneq ($(call sequence, 2, 3), 2 3)
266   $(error Sequence 2, 3 should be &quot;2 3&quot;, but was $(call sequence, 2, 3))
267 endif
268 
269 ifneq ($(call sequence, 4, 9), 4 5 6 7 8 9)
270   $(error Sequence 4, 9 should be &quot;4 5 6 7 8 9&quot;, but was $(call sequence, 4, 9))
271 endif
272 
273 ifneq ($(call sequence, 5, 15), 5 6 7 8 9 10 11 12 13 14 15)
274   $(error Sequence 5, 15 should be &quot;5 6 7 8 9 10 11 12 13 14 15&quot;, \
275       but was $(call sequence, 5, 15))
276 endif
277 
278 ################################################################################
279 # Test that PathList is safe when called multiple nested times.
280 
281 PATHLIST_INPUT := foo bar baz
282 
<a name="10" id="anc10"></a><span class="line-modified">283 $(call AssertEquals, \</span>
284     $(call PathList, $(call PathList, $(PATHLIST_INPUT))), \
285     $(call PathList, $(PATHLIST_INPUT)), \
<a name="11" id="anc11"></a><span class="line-modified">286     PathList call not safe for calling twice, \</span>
<span class="line-added">287 )</span>
288 
289 ################################################################################
290 # Test FindCommonPathPrefix
291 
<a name="12" id="anc12"></a><span class="line-modified">292 $(call AssertEquals, \</span>
293     $(call FindCommonPathPrefix, /foo/bar/baz, /foo/bar/banan), \
294     /foo/bar, \
295     FindCommonPathPrefix, \
<a name="13" id="anc13"></a><span class="line-modified">296 )</span>
297 
<a name="14" id="anc14"></a><span class="line-modified">298 $(call AssertEquals, \</span>
299     $(call FindCommonPathPrefix, /foo/bar/baz, /foo/bar), \
300     /foo/bar, \
301     FindCommonPathPrefix, \
<a name="15" id="anc15"></a><span class="line-modified">302 )</span>
303 
<a name="16" id="anc16"></a><span class="line-modified">304 $(call AssertEquals, \</span>
305     $(call FindCommonPathPrefix, /foo/bar/baz, /foo/bar/), \
306     /foo/bar, \
307     FindCommonPathPrefix, \
<a name="17" id="anc17"></a><span class="line-modified">308 )</span>
309 
<a name="18" id="anc18"></a><span class="line-modified">310 $(call AssertEquals, \</span>
311     $(call FindCommonPathPrefix, foo/bar/baz, foo/bar/banan), \
312     foo/bar, \
313     FindCommonPathPrefix, \
<a name="19" id="anc19"></a><span class="line-modified">314 )</span>
315 
<a name="20" id="anc20"></a><span class="line-modified">316 $(call AssertEquals, \</span>
317     $(call FindCommonPathPrefix, foo/bar/baz, /foo/bar/banan), \
318     , \
319     FindCommonPathPrefix, \
<a name="21" id="anc21"></a><span class="line-modified">320 )</span>
321 
322 ################################################################################
323 # DirToDotDot
324 
<a name="22" id="anc22"></a><span class="line-modified">325 $(call AssertEquals, \</span>
326     $(call DirToDotDot, foo/bar/baz/), \
327     ../../.., \
328     DirToDotDot, \
<a name="23" id="anc23"></a><span class="line-modified">329 )</span>
330 
<a name="24" id="anc24"></a><span class="line-modified">331 $(call AssertEquals, \</span>
332     $(call DirToDotDot, foo/bar), \
333     ../.., \
334     DirToDotDot, \
<a name="25" id="anc25"></a><span class="line-modified">335 )</span>
336 
<a name="26" id="anc26"></a><span class="line-modified">337 $(call AssertEquals, \</span>
338     $(call DirToDotDot, /foo), \
339     .., \
340     DirToDotDot, \
<a name="27" id="anc27"></a><span class="line-modified">341 )</span>
342 
343 ################################################################################
344 # RelativePath
345 
<a name="28" id="anc28"></a><span class="line-modified">346 $(call AssertEquals, \</span>
347     $(call RelativePath, foo/bar/baz, foo/bar/banan), \
348     ../baz, \
349     RelativePath, \
<a name="29" id="anc29"></a><span class="line-modified">350 )</span>
351 
<a name="30" id="anc30"></a><span class="line-modified">352 $(call AssertEquals, \</span>
353     $(call RelativePath, foo/bar/baz/banan/kung, foo/bar/banan/kung), \
354     ../../baz/banan/kung, \
355     RelativePath, \
<a name="31" id="anc31"></a><span class="line-modified">356 )</span>
357 
<a name="32" id="anc32"></a><span class="line-modified">358 $(call AssertEquals, \</span>
359     $(call RelativePath, /foo/bar/baz/banan/kung, /foo/bar/banan/kung/), \
360     ../../baz/banan/kung, \
361     RelativePath, \
<a name="33" id="anc33"></a><span class="line-modified">362 )</span>
<span class="line-added">363 </span>
<span class="line-added">364 $(call AssertEquals, \</span>
<span class="line-added">365     $(call RelativePath, /foo/bar/baz/banan/kung, /foo/bar/baz), \</span>
<span class="line-added">366     ./banan/kung, \</span>
<span class="line-added">367     RelativePath, \</span>
<span class="line-added">368 )</span>
<span class="line-added">369 </span>
<span class="line-added">370 $(call AssertEquals, \</span>
<span class="line-added">371     $(call RelativePath, /foo/bar/baz/banan/kung, /foo/bar/baz/), \</span>
<span class="line-added">372     ./banan/kung, \</span>
<span class="line-added">373     RelativePath, \</span>
<span class="line-added">374 )</span>
375 
376 ################################################################################
377 # Test ParseKeywordVariable
378 
379 KWBASE := APA=banan;GURKA=tomat;COUNT=1%202%203%204%205;SUM=1+2+3+4+5;MANY_WORDS=I have the best words.
380 
381 $(eval $(call ParseKeywordVariable, KWBASE, \
382     SINGLE_KEYWORDS := APA GURKA SUM, \
383     STRING_KEYWORDS := COUNT MANY_WORDS, \
384 ))
385 
<a name="34" id="anc34"></a><span class="line-modified">386 $(call AssertEquals, \</span>
387     $(KWBASE_APA), \
388     banan, \
389     ParseKeywordVariable failed to parse APA, \
<a name="35" id="anc35"></a><span class="line-modified">390 )</span>
391 
<a name="36" id="anc36"></a><span class="line-modified">392 $(call AssertEquals, \</span>
393     $(KWBASE_COUNT), \
394     1 2 3 4 5, \
395     ParseKeywordVariable failed to parse COUNT, \
<a name="37" id="anc37"></a><span class="line-modified">396 )</span>
397 
<a name="38" id="anc38"></a><span class="line-modified">398 $(call AssertEquals, \</span>
399     $(KWBASE_SUM), \
400     1+2+3+4+5, \
401     ParseKeywordVariable failed to parse SUM, \
<a name="39" id="anc39"></a><span class="line-modified">402 )</span>
403 
<a name="40" id="anc40"></a><span class="line-modified">404 $(call AssertEquals, \</span>
405     $(KWBASE_MANY_WORDS), \
406     I have the best words., \
407     ParseKeywordVariable failed to parse MANY_WORDS, \
<a name="41" id="anc41"></a><span class="line-modified">408 )</span>
409 
410 # Simulate variable set from command line by using &quot;override&quot;
411 override KWBASE_WEIRD_GURKA := paprika
412 KWBASE_WEIRD := ;;APA=banan;;;GURKA=apelsin;APA=skansen;;
413 
414 $(eval $(call ParseKeywordVariable, KWBASE_WEIRD, \
415     SINGLE_KEYWORDS := APA GURKA SUM, \
416     STRING_KEYWORDS := COUNT, \
417 ))
418 
<a name="42" id="anc42"></a><span class="line-modified">419 $(call AssertEquals, \</span>
420     $(KWBASE_WEIRD_APA), \
421     skansen, \
422     ParseKeywordVariable failed to overwrite APA, \
<a name="43" id="anc43"></a><span class="line-modified">423 )</span>
424 
<a name="44" id="anc44"></a><span class="line-modified">425 $(call AssertEquals, \</span>
426     $(KWBASE_WEIRD_GURKA), \
427     paprika, \
428     ParseKeywordVariable failed to preserve GURKA, \
<a name="45" id="anc45"></a><span class="line-modified">429 )</span>
<span class="line-added">430 </span>
<span class="line-added">431 ################################################################################</span>
<span class="line-added">432 # Test recursive wildcard</span>
<span class="line-added">433 </span>
<span class="line-added">434 A_FOOBAR := $(OUTPUT_DIR)/wildcard/a/foo.bar</span>
<span class="line-added">435 A_B_DOOBAR := $(OUTPUT_DIR)/wildcard/a/b/doo.bar</span>
<span class="line-added">436 A_B_FOOBAR := $(OUTPUT_DIR)/wildcard/a/b/foo.bar</span>
<span class="line-added">437 A_B_FOOBAZ := $(OUTPUT_DIR)/wildcard/a/b/foo.baz</span>
<span class="line-added">438 X_Y_FOOBAR := $(OUTPUT_DIR)/wildcard/x/y/foo.bar</span>
<span class="line-added">439 X_Y_FOOBAZ := $(OUTPUT_DIR)/wildcard/x/y/foo.baz</span>
<span class="line-added">440 X_Y_FOODOLLAR := $(OUTPUT_DIR)/wildcard/x/y/foo$$foo</span>
<span class="line-added">441 </span>
<span class="line-added">442 $(call MakeDir, $(OUTPUT_DIR)/wildcard/a/b)</span>
<span class="line-added">443 $(call MakeDir, $(OUTPUT_DIR)/wildcard/x/y)</span>
<span class="line-added">444 $(shell $(TOUCH) $(A_FOOBAR) $(A_B_FOOBAR) $(A_B_DOOBAR) $(A_B_FOOBAZ) \</span>
<span class="line-added">445     $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(call ShellQuote, $(X_Y_FOODOLLAR)))</span>
<span class="line-added">446 </span>
<span class="line-added">447 ifeq ($(RWILDCARD_WORKS), true)</span>
<span class="line-added">448   $(call AssertEquals, \</span>
<span class="line-added">449       $(sort $(call rwildcard, $(OUTPUT_DIR)/wildcard, *.bar)), \</span>
<span class="line-added">450       $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_FOOBAR) $(X_Y_FOOBAR)), \</span>
<span class="line-added">451       Wrong files returned from rwildcard, \</span>
<span class="line-added">452   )</span>
<span class="line-added">453 </span>
<span class="line-added">454   $(call AssertEquals, \</span>
<span class="line-added">455       $(sort $(call rwildcard, $(OUTPUT_DIR)/wildcard, doo.*)), \</span>
<span class="line-added">456       $(A_B_DOOBAR), \</span>
<span class="line-added">457       Wrong files returned from rwildcard, \</span>
<span class="line-added">458   )</span>
<span class="line-added">459 </span>
<span class="line-added">460   $(call AssertEquals, \</span>
<span class="line-added">461       $(sort $(call rwildcard, $(OUTPUT_DIR)/wildcard, *.bar *.baz)), \</span>
<span class="line-added">462       $(sort $(A_B_DOOBAR) $(A_FOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) \</span>
<span class="line-added">463       $(X_Y_FOOBAR) $(X_Y_FOOBAZ)), \</span>
<span class="line-added">464       Wrong files returned from rwildcard, \</span>
<span class="line-added">465   )</span>
<span class="line-added">466 </span>
<span class="line-added">467   $(call AssertEquals, \</span>
<span class="line-added">468       $(sort $(call WildcardFindFiles, $(OUTPUT_DIR)/wildcard)), \</span>
<span class="line-added">469       $(sort $(A_B_DOOBAR) $(A_FOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) \</span>
<span class="line-added">470       $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">471       Wrong files returned from WildcardFindFiles, \</span>
<span class="line-added">472   )</span>
<span class="line-added">473 </span>
<span class="line-added">474   $(call AssertEquals, \</span>
<span class="line-added">475       $(sort $(call WildcardFindFiles, $(OUTPUT_DIR)/wildcard/x/y)), \</span>
<span class="line-added">476       $(sort $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">477       Wrong files returned from WildcardFindFiles, \</span>
<span class="line-added">478   )</span>
<span class="line-added">479 </span>
<span class="line-added">480   $(call AssertEquals, \</span>
<span class="line-added">481       $(sort $(call WildcardFindFiles, $(OUTPUT_DIR)/wildcard/a/b $(OUTPUT_DIR)/wildcard/x)), \</span>
<span class="line-added">482       $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) \</span>
<span class="line-added">483       $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">484       Wrong files returned from WildcardFindFiles, \</span>
<span class="line-added">485   )</span>
<span class="line-added">486 endif</span>
<span class="line-added">487 </span>
<span class="line-added">488 $(call AssertEquals, \</span>
<span class="line-added">489     $(sort $(call ShellFindFiles, $(OUTPUT_DIR)/wildcard)), \</span>
<span class="line-added">490     $(sort $(A_B_DOOBAR) $(A_FOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) \</span>
<span class="line-added">491     $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">492     Wrong files returned from ShellFindFiles, \</span>
<span class="line-added">493 )</span>
<span class="line-added">494 </span>
<span class="line-added">495 $(call AssertEquals, \</span>
<span class="line-added">496     $(sort $(call ShellFindFiles, $(OUTPUT_DIR)/wildcard/x/y)), \</span>
<span class="line-added">497     $(sort $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">498     Wrong files returned from ShellFindFiles, \</span>
<span class="line-added">499 )</span>
<span class="line-added">500 </span>
<span class="line-added">501 $(call AssertEquals, \</span>
<span class="line-added">502     $(sort $(call ShellFindFiles, $(OUTPUT_DIR)/wildcard/a/b $(OUTPUT_DIR)/wildcard/x)), \</span>
<span class="line-added">503     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) \</span>
<span class="line-added">504     $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">505     Wrong files returned from ShellFindFiles, \</span>
<span class="line-added">506 )</span>
<span class="line-added">507 </span>
<span class="line-added">508 $(call AssertEquals, \</span>
<span class="line-added">509     $(sort $(call ShellFindFiles, $(OUTPUT_DIR)/wildcard, *.bar)), \</span>
<span class="line-added">510     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_FOOBAR) $(X_Y_FOOBAR)), \</span>
<span class="line-added">511     Wrong files returned from ShellFindFiles, \</span>
<span class="line-added">512 )</span>
<span class="line-added">513 </span>
<span class="line-added">514 $(call AssertEquals, \</span>
<span class="line-added">515     $(sort $(call ShellFindFiles, $(OUTPUT_DIR)/wildcard, doo.*)), \</span>
<span class="line-added">516     $(A_B_DOOBAR), \</span>
<span class="line-added">517     Wrong files returned from ShellFindFiles, \</span>
<span class="line-added">518 )</span>
<span class="line-added">519 </span>
<span class="line-added">520 $(call AssertEquals, \</span>
<span class="line-added">521     $(sort $(call ShellFindFiles, $(OUTPUT_DIR)/wildcard, *.bar *.baz)), \</span>
<span class="line-added">522     $(sort $(A_B_DOOBAR) $(A_FOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) \</span>
<span class="line-added">523     $(X_Y_FOOBAR) $(X_Y_FOOBAZ)), \</span>
<span class="line-added">524     Wrong files returned from ShellFindFiles, \</span>
<span class="line-added">525 )</span>
<span class="line-added">526 </span>
<span class="line-added">527 ################################################################################</span>
<span class="line-added">528 </span>
<span class="line-added">529 $(call AssertEquals, \</span>
<span class="line-added">530     $(sort $(call CacheFindFiles, $(OUTPUT_DIR)/wildcard/a/b)), \</span>
<span class="line-added">531     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ)), \</span>
<span class="line-added">532     CacheFindFiles test 1, \</span>
<span class="line-added">533 )</span>
<span class="line-added">534 $(call FillFindCache, $(OUTPUT_DIR)/wildcard/a/b)</span>
<span class="line-added">535 $(call AssertEquals, \</span>
<span class="line-added">536     $(CacheFindFiles_CACHED_DIRS), $(OUTPUT_DIR)/wildcard/a/b, \</span>
<span class="line-added">537     Wrong files in find cache dirs, \</span>
<span class="line-added">538 )</span>
<span class="line-added">539 $(call AssertEquals, \</span>
<span class="line-added">540     $(sort $(CacheFindFiles_CACHED_FILES)), \</span>
<span class="line-added">541     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ)), \</span>
<span class="line-added">542     Wrong files in find cache files, \</span>
<span class="line-added">543 )</span>
<span class="line-added">544 $(call AssertEquals, \</span>
<span class="line-added">545     $(sort $(call CacheFindFiles, $(OUTPUT_DIR)/wildcard/a/b)), \</span>
<span class="line-added">546     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ)), \</span>
<span class="line-added">547     CacheFindFiles test 1, \</span>
<span class="line-added">548 )</span>
<span class="line-added">549 </span>
<span class="line-added">550 $(call AssertEquals, \</span>
<span class="line-added">551     $(sort $(call CacheFindFiles, $(OUTPUT_DIR)/wildcard/a)), \</span>
<span class="line-added">552     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) $(A_FOOBAR)), \</span>
<span class="line-added">553     CacheFindFiles test 2, \</span>
<span class="line-added">554 )</span>
<span class="line-added">555 $(call FillFindCache, $(OUTPUT_DIR)/wildcard/a)</span>
<span class="line-added">556 $(call AssertEquals, \</span>
<span class="line-added">557     $(CacheFindFiles_CACHED_DIRS), \</span>
<span class="line-added">558     $(OUTPUT_DIR)/wildcard/a/b $(OUTPUT_DIR)/wildcard/a, \</span>
<span class="line-added">559     Wrong files in find cache dirs, \</span>
<span class="line-added">560 )</span>
<span class="line-added">561 $(call AssertEquals, \</span>
<span class="line-added">562     $(sort $(CacheFindFiles_CACHED_FILES)), \</span>
<span class="line-added">563     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) $(A_FOOBAR)), \</span>
<span class="line-added">564     Wrong files in find cache files, \</span>
<span class="line-added">565 )</span>
<span class="line-added">566 $(call AssertEquals, \</span>
<span class="line-added">567     $(words $(CacheFindFiles_CACHED_FILES)), 4, \</span>
<span class="line-added">568     Wrong files in find cache files &gt;$(CacheFindFiles_CACHED_FILES)&lt;, \</span>
<span class="line-added">569 )</span>
<span class="line-added">570 $(call AssertEquals, \</span>
<span class="line-added">571     $(sort $(call CacheFindFiles, $(OUTPUT_DIR)/wildcard/a)), \</span>
<span class="line-added">572     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) $(A_FOOBAR)), \</span>
<span class="line-added">573     CacheFindFiles test 2, \</span>
<span class="line-added">574 )</span>
<span class="line-added">575 </span>
<span class="line-added">576 $(call AssertEquals, \</span>
<span class="line-added">577     $(sort $(call CacheFindFiles, $(OUTPUT_DIR)/wildcard/x)), \</span>
<span class="line-added">578     $(sort $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">579     CacheFindFiles test 3, \</span>
<span class="line-added">580 )</span>
<span class="line-added">581 $(call FillFindCache, $(OUTPUT_DIR)/wildcard/x)</span>
<span class="line-added">582 $(call AssertEquals, \</span>
<span class="line-added">583     $(CacheFindFiles_CACHED_DIRS), \</span>
<span class="line-added">584     $(OUTPUT_DIR)/wildcard/a/b $(OUTPUT_DIR)/wildcard/a $(OUTPUT_DIR)/wildcard/x, \</span>
<span class="line-added">585     Wrong files in find cache dirs, \</span>
<span class="line-added">586 )</span>
<span class="line-added">587 $(call AssertEquals, \</span>
<span class="line-added">588     $(sort $(CacheFindFiles_CACHED_FILES)), \</span>
<span class="line-added">589     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) $(A_FOOBAR) \</span>
<span class="line-added">590         $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">591     Wrong files in find cache files, \</span>
<span class="line-added">592 )</span>
<span class="line-added">593 $(call AssertEquals, \</span>
<span class="line-added">594     $(words $(CacheFindFiles_CACHED_FILES)), 7, \</span>
<span class="line-added">595     Wrong files in find cache files, \</span>
<span class="line-added">596 )</span>
<span class="line-added">597 $(call AssertEquals, \</span>
<span class="line-added">598     $(sort $(call CacheFindFiles, $(OUTPUT_DIR)/wildcard/x)), \</span>
<span class="line-added">599     $(sort $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">600     CacheFindFiles test 3, \</span>
<span class="line-added">601 )</span>
<span class="line-added">602 </span>
<span class="line-added">603 $(call AssertEquals, \</span>
<span class="line-added">604     $(sort $(call CacheFindFiles, $(OUTPUT_DIR)/wildcard/x/y)), \</span>
<span class="line-added">605     $(sort $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">606     CacheFindFiles test 4, \</span>
<span class="line-added">607 )</span>
<span class="line-added">608 $(call FillFindCache, $(OUTPUT_DIR)/wildcard/x/y)</span>
<span class="line-added">609 $(call AssertEquals, \</span>
<span class="line-added">610     $(CacheFindFiles_CACHED_DIRS), \</span>
<span class="line-added">611     $(OUTPUT_DIR)/wildcard/a/b $(OUTPUT_DIR)/wildcard/a $(OUTPUT_DIR)/wildcard/x, \</span>
<span class="line-added">612     Wrong files in find cache dirs, \</span>
<span class="line-added">613 )</span>
<span class="line-added">614 $(call AssertEquals, \</span>
<span class="line-added">615     $(sort $(CacheFindFiles_CACHED_FILES)), \</span>
<span class="line-added">616     $(sort $(A_B_DOOBAR) $(A_B_FOOBAR) $(A_B_FOOBAZ) $(A_FOOBAR) \</span>
<span class="line-added">617         $(X_Y_FOOBAR) $(X_Y_FOOBAZ) $(X_Y_FOODOLLAR)), \</span>
<span class="line-added">618     Wrong files in find cache files, \</span>
<span class="line-added">619 )</span>
<span class="line-added">620 $(call AssertEquals, \</span>
<span class="line-added">621     $(words $(CacheFindFiles_CACHED_FILES)), 7, \</span>
<span class="line-added">622     Wrong files in find cache files, \</span>
<span class="line-added">623 )</span>
624 
625 ################################################################################
626 
627 all: $(TEST_TARGETS)
<a name="46" id="anc46"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="46" type="hidden" />
</body>
</html>