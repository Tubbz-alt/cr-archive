<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jaxp/javax/xml/jaxp/unittest/transform/OutputPropertiesTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../stream/XMLStreamWriterTest/XMLStreamWriterTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ProcessXSLT.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jaxp/javax/xml/jaxp/unittest/transform/OutputPropertiesTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package transform;
 25 
 26 import java.io.StringReader;

 27 import java.util.Properties;


 28 import javax.xml.transform.Templates;

 29 import javax.xml.transform.TransformerFactory;

 30 import javax.xml.transform.stream.StreamSource;
 31 import org.testng.Assert;

 32 import org.testng.annotations.Test;


 33 
 34 /*
 35  * @test
<span class="line-modified"> 36  * @bug 8219705</span>
 37  * @library /javax/xml/jaxp/libs /javax/xml/jaxp/unittest
 38  * @run testng transform.OutputPropertiesTest
 39  * @summary Verifies the output properties are set correctly
 40  */
 41 public class OutputPropertiesTest {


















































 42     @Test
 43     public void testOutputProperties() throws Exception {
 44         String xslData = &quot;&lt;?xml version=&#39;1.0&#39;?&gt;&quot;
 45                 + &quot;&lt;xsl:stylesheet&quot;
 46                 + &quot; xmlns:xsl=&#39;http://www.w3.org/1999/XSL/Transform&#39;&quot;
 47                 + &quot; version=&#39;1.0&#39;&quot;
 48                 + &quot;&gt;\n&quot;
 49                 + &quot;   &lt;xsl:output method=&#39;html&#39;/&gt;\n&quot;
 50                 + &quot;   &lt;xsl:template match=&#39;/&#39;&gt;\n&quot;
 51                 + &quot;     Hello World! \n&quot;
 52                 + &quot;   &lt;/xsl:template&gt;\n&quot;
 53                 + &quot;&lt;/xsl:stylesheet&gt;&quot;;
 54 
 55         System.out.println(xslData);
 56 
 57         Templates templates = TransformerFactory.newInstance()
 58                     .newTemplates(new StreamSource(new StringReader(xslData)));
 59 
 60         Properties properties = templates.getOutputProperties();
 61         String[] prNames = new String[]{&quot;method&quot;, &quot;version&quot;, &quot;indent&quot;, &quot;media-type&quot;};
 62         String[] prValues = new String[]{&quot;html&quot;, &quot;4.0&quot;, &quot;yes&quot;, &quot;text/html&quot;};
 63 
 64         for (int i = 0; i &lt; prNames.length; i++) {
 65             String value = properties.getProperty(prNames[i]);
 66             String msg = &quot;The value of the property &#39;&quot; + prNames[i] + &quot;&#39; should be &#39;&quot;
 67                     + prValues[i] + &quot;&#39; when the method is &#39;&quot; + prValues[0] + &quot;&#39;. \n&quot;;
 68             Assert.assertEquals(value, prValues[i], msg);
 69             System.out.println(
 70                     prNames[i] + &quot;: actual: &quot; + value + &quot;, expected: &quot; + prValues[i]);
 71         }
 72     }

 73 }
</pre>
</td>
<td>
<hr />
<pre>
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package transform;
 25 
 26 import java.io.StringReader;
<span class="line-added"> 27 import java.io.StringWriter;</span>
 28 import java.util.Properties;
<span class="line-added"> 29 import javax.xml.parsers.DocumentBuilderFactory;</span>
<span class="line-added"> 30 import javax.xml.transform.OutputKeys;</span>
 31 import javax.xml.transform.Templates;
<span class="line-added"> 32 import javax.xml.transform.Transformer;</span>
 33 import javax.xml.transform.TransformerFactory;
<span class="line-added"> 34 import javax.xml.transform.stream.StreamResult;</span>
 35 import javax.xml.transform.stream.StreamSource;
 36 import org.testng.Assert;
<span class="line-added"> 37 import org.testng.annotations.DataProvider;</span>
 38 import org.testng.annotations.Test;
<span class="line-added"> 39 import org.w3c.dom.Document;</span>
<span class="line-added"> 40 import org.xml.sax.InputSource;</span>
 41 
 42 /*
 43  * @test
<span class="line-modified"> 44  * @bug 8219705 8223291</span>
 45  * @library /javax/xml/jaxp/libs /javax/xml/jaxp/unittest
 46  * @run testng transform.OutputPropertiesTest
 47  * @summary Verifies the output properties are set correctly
 48  */
 49 public class OutputPropertiesTest {
<span class="line-added"> 50     /*</span>
<span class="line-added"> 51        DataProvider: for testing indentation</span>
<span class="line-added"> 52        Data: xml, expected result</span>
<span class="line-added"> 53      */</span>
<span class="line-added"> 54     @DataProvider(name = &quot;Indentation&quot;)</span>
<span class="line-added"> 55     public Object[][] getData() {</span>
<span class="line-added"> 56         String mix = &quot;\n&quot; +</span>
<span class="line-added"> 57                 &quot;        abc\n&quot; +</span>
<span class="line-added"> 58                 &quot;        mix\n&quot; +</span>
<span class="line-added"> 59                 &quot;        xyz\n&quot; +</span>
<span class="line-added"> 60                 &quot;    &quot;;</span>
<span class="line-added"> 61         return new Object[][]{</span>
<span class="line-added"> 62             {&quot;abc&lt;![CDATA[data]]&gt;xyz&quot;, &quot;abcdataxyz&quot;},</span>
<span class="line-added"> 63             {&quot;abc&lt;![CDATA[ &amp; ]]&gt;xyz&quot;, &quot;abc &amp; xyz&quot;},</span>
<span class="line-added"> 64             {&quot;&lt;![CDATA[data]]&gt;&quot;, &quot;data&quot;},</span>
<span class="line-added"> 65             {&quot;abc&lt;mix&gt;mix&lt;/mix&gt;xyz&quot;, mix}</span>
<span class="line-added"> 66         };</span>
<span class="line-added"> 67     }</span>
<span class="line-added"> 68 </span>
<span class="line-added"> 69 </span>
<span class="line-added"> 70     /**</span>
<span class="line-added"> 71      * bug 8223291</span>
<span class="line-added"> 72      * Verifies that no extra indentation is added for CDATA.</span>
<span class="line-added"> 73      * @param xml the xml content to be tested</span>
<span class="line-added"> 74      * @param expected the expected result</span>
<span class="line-added"> 75      * @throws Exception</span>
<span class="line-added"> 76      */</span>
<span class="line-added"> 77     @Test(dataProvider = &quot;Indentation&quot;)</span>
<span class="line-added"> 78     public void testIndentation(String xml, String expected) throws Exception</span>
<span class="line-added"> 79     {</span>
<span class="line-added"> 80         StreamSource source = new StreamSource(new StringReader(&quot;&lt;foo&gt;&lt;bar&gt;&quot; + xml + &quot;&lt;/bar&gt;&lt;/foo&gt;&quot;));</span>
<span class="line-added"> 81         StreamResult result = new StreamResult(new StringWriter());</span>
<span class="line-added"> 82 </span>
<span class="line-added"> 83         Transformer tform = TransformerFactory.newInstance().newTransformer();</span>
<span class="line-added"> 84         tform.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span>
<span class="line-added"> 85         tform.transform(source, result);</span>
<span class="line-added"> 86 </span>
<span class="line-added"> 87         String xml1 = result.getWriter().toString();</span>
<span class="line-added"> 88 </span>
<span class="line-added"> 89         Document document = DocumentBuilderFactory.newInstance()</span>
<span class="line-added"> 90             .newDocumentBuilder()</span>
<span class="line-added"> 91             .parse(new InputSource(new StringReader(xml1)));</span>
<span class="line-added"> 92 </span>
<span class="line-added"> 93         String resultData = document.getElementsByTagName(&quot;bar&quot;)</span>
<span class="line-added"> 94             .item(0)</span>
<span class="line-added"> 95             .getTextContent();</span>
<span class="line-added"> 96 </span>
<span class="line-added"> 97         Assert.assertEquals(resultData, expected);</span>
<span class="line-added"> 98     }</span>
<span class="line-added"> 99 </span>
100     @Test
101     public void testOutputProperties() throws Exception {
102         String xslData = &quot;&lt;?xml version=&#39;1.0&#39;?&gt;&quot;
103                 + &quot;&lt;xsl:stylesheet&quot;
104                 + &quot; xmlns:xsl=&#39;http://www.w3.org/1999/XSL/Transform&#39;&quot;
105                 + &quot; version=&#39;1.0&#39;&quot;
106                 + &quot;&gt;\n&quot;
107                 + &quot;   &lt;xsl:output method=&#39;html&#39;/&gt;\n&quot;
108                 + &quot;   &lt;xsl:template match=&#39;/&#39;&gt;\n&quot;
109                 + &quot;     Hello World! \n&quot;
110                 + &quot;   &lt;/xsl:template&gt;\n&quot;
111                 + &quot;&lt;/xsl:stylesheet&gt;&quot;;
112 
113         System.out.println(xslData);
114 
115         Templates templates = TransformerFactory.newInstance()
116                     .newTemplates(new StreamSource(new StringReader(xslData)));
117 
118         Properties properties = templates.getOutputProperties();
119         String[] prNames = new String[]{&quot;method&quot;, &quot;version&quot;, &quot;indent&quot;, &quot;media-type&quot;};
120         String[] prValues = new String[]{&quot;html&quot;, &quot;4.0&quot;, &quot;yes&quot;, &quot;text/html&quot;};
121 
122         for (int i = 0; i &lt; prNames.length; i++) {
123             String value = properties.getProperty(prNames[i]);
124             String msg = &quot;The value of the property &#39;&quot; + prNames[i] + &quot;&#39; should be &#39;&quot;
125                     + prValues[i] + &quot;&#39; when the method is &#39;&quot; + prValues[0] + &quot;&#39;. \n&quot;;
126             Assert.assertEquals(value, prValues[i], msg);
127             System.out.println(
128                     prNames[i] + &quot;: actual: &quot; + value + &quot;, expected: &quot; + prValues[i]);
129         }
130     }
<span class="line-added">131 </span>
132 }
</pre>
</td>
</tr>
</table>
<center><a href="../stream/XMLStreamWriterTest/XMLStreamWriterTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ProcessXSLT.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>