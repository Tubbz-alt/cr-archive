<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jaxp/javax/xml/jaxp/unittest/transform/OutputPropertiesTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../stream/XMLStreamWriterTest/XMLStreamWriterTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ProcessXSLT.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jaxp/javax/xml/jaxp/unittest/transform/OutputPropertiesTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 22,25 ***</span>
   */
  
  package transform;
  
  import java.io.StringReader;
  import java.util.Properties;
  import javax.xml.transform.Templates;
  import javax.xml.transform.TransformerFactory;
  import javax.xml.transform.stream.StreamSource;
  import org.testng.Assert;
  import org.testng.annotations.Test;
  
  /*
   * @test
<span class="line-modified">!  * @bug 8219705</span>
   * @library /javax/xml/jaxp/libs /javax/xml/jaxp/unittest
   * @run testng transform.OutputPropertiesTest
   * @summary Verifies the output properties are set correctly
   */
  public class OutputPropertiesTest {
      @Test
      public void testOutputProperties() throws Exception {
          String xslData = &quot;&lt;?xml version=&#39;1.0&#39;?&gt;&quot;
                  + &quot;&lt;xsl:stylesheet&quot;
                  + &quot; xmlns:xsl=&#39;http://www.w3.org/1999/XSL/Transform&#39;&quot;
<span class="line-new-header">--- 22,83 ---</span>
   */
  
  package transform;
  
  import java.io.StringReader;
<span class="line-added">+ import java.io.StringWriter;</span>
  import java.util.Properties;
<span class="line-added">+ import javax.xml.parsers.DocumentBuilderFactory;</span>
<span class="line-added">+ import javax.xml.transform.OutputKeys;</span>
  import javax.xml.transform.Templates;
<span class="line-added">+ import javax.xml.transform.Transformer;</span>
  import javax.xml.transform.TransformerFactory;
<span class="line-added">+ import javax.xml.transform.stream.StreamResult;</span>
  import javax.xml.transform.stream.StreamSource;
  import org.testng.Assert;
<span class="line-added">+ import org.testng.annotations.DataProvider;</span>
  import org.testng.annotations.Test;
<span class="line-added">+ import org.w3c.dom.Document;</span>
<span class="line-added">+ import org.xml.sax.InputSource;</span>
  
  /*
   * @test
<span class="line-modified">!  * @bug 8219705 8223291</span>
   * @library /javax/xml/jaxp/libs /javax/xml/jaxp/unittest
   * @run testng transform.OutputPropertiesTest
   * @summary Verifies the output properties are set correctly
   */
  public class OutputPropertiesTest {
<span class="line-added">+     /*</span>
<span class="line-added">+        DataProvider: for testing indentation</span>
<span class="line-added">+        Data: xml, expected result</span>
<span class="line-added">+      */</span>
<span class="line-added">+     @DataProvider(name = &quot;Indentation&quot;)</span>
<span class="line-added">+     public Object[][] getData() {</span>
<span class="line-added">+         String mix = &quot;\n&quot; +</span>
<span class="line-added">+                 &quot;        abc\n&quot; +</span>
<span class="line-added">+                 &quot;        mix\n&quot; +</span>
<span class="line-added">+                 &quot;        xyz\n&quot; +</span>
<span class="line-added">+                 &quot;    &quot;;</span>
<span class="line-added">+         return new Object[][]{</span>
<span class="line-added">+             {&quot;abc&lt;![CDATA[data]]&gt;xyz&quot;, &quot;abcdataxyz&quot;},</span>
<span class="line-added">+             {&quot;abc&lt;![CDATA[ &amp; ]]&gt;xyz&quot;, &quot;abc &amp; xyz&quot;},</span>
<span class="line-added">+             {&quot;&lt;![CDATA[data]]&gt;&quot;, &quot;data&quot;},</span>
<span class="line-added">+             {&quot;abc&lt;mix&gt;mix&lt;/mix&gt;xyz&quot;, mix}</span>
<span class="line-added">+         };</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * bug 8223291</span>
<span class="line-added">+      * Verifies that no extra indentation is added for CDATA.</span>
<span class="line-added">+      * @param xml the xml content to be tested</span>
<span class="line-added">+      * @param expected the expected result</span>
<span class="line-added">+      * @throws Exception</span>
<span class="line-added">+      */</span>
<span class="line-added">+     @Test(dataProvider = &quot;Indentation&quot;)</span>
<span class="line-added">+     public void testIndentation(String xml, String expected) throws Exception</span>
<span class="line-added">+     {</span>
<span class="line-added">+         StreamSource source = new StreamSource(new StringReader(&quot;&lt;foo&gt;&lt;bar&gt;&quot; + xml + &quot;&lt;/bar&gt;&lt;/foo&gt;&quot;));</span>
<span class="line-added">+         StreamResult result = new StreamResult(new StringWriter());</span>
<span class="line-added">+ </span>
<span class="line-added">+         Transformer tform = TransformerFactory.newInstance().newTransformer();</span>
<span class="line-added">+         tform.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span>
<span class="line-added">+         tform.transform(source, result);</span>
<span class="line-added">+ </span>
<span class="line-added">+         String xml1 = result.getWriter().toString();</span>
<span class="line-added">+ </span>
<span class="line-added">+         Document document = DocumentBuilderFactory.newInstance()</span>
<span class="line-added">+             .newDocumentBuilder()</span>
<span class="line-added">+             .parse(new InputSource(new StringReader(xml1)));</span>
<span class="line-added">+ </span>
<span class="line-added">+         String resultData = document.getElementsByTagName(&quot;bar&quot;)</span>
<span class="line-added">+             .item(0)</span>
<span class="line-added">+             .getTextContent();</span>
<span class="line-added">+ </span>
<span class="line-added">+         Assert.assertEquals(resultData, expected);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      @Test
      public void testOutputProperties() throws Exception {
          String xslData = &quot;&lt;?xml version=&#39;1.0&#39;?&gt;&quot;
                  + &quot;&lt;xsl:stylesheet&quot;
                  + &quot; xmlns:xsl=&#39;http://www.w3.org/1999/XSL/Transform&#39;&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 68,6 ***</span>
<span class="line-new-header">--- 126,7 ---</span>
              Assert.assertEquals(value, prValues[i], msg);
              System.out.println(
                      prNames[i] + &quot;: actual: &quot; + value + &quot;, expected: &quot; + prValues[i]);
          }
      }
<span class="line-added">+ </span>
  }
</pre>
<center><a href="../stream/XMLStreamWriterTest/XMLStreamWriterTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ProcessXSLT.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>