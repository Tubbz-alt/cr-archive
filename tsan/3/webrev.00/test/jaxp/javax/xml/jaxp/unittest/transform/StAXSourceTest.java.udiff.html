<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/jaxp/javax/xml/jaxp/unittest/transform/StAXSourceTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SecureProcessingTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../validation/SchemaTest.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/jaxp/javax/xml/jaxp/unittest/transform/StAXSourceTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2014, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,36 +21,41 @@</span>
   * questions.
   */
  
  package transform;
  
<span class="udiff-line-added">+ import java.io.ByteArrayInputStream;</span>
  import static jaxp.library.JAXPTestUtilities.setSystemProperty;
  import java.io.StringReader;
  import java.io.StringWriter;
  import javax.xml.stream.XMLEventReader;
  import javax.xml.stream.XMLEventWriter;
  import javax.xml.stream.XMLInputFactory;
  import javax.xml.stream.XMLOutputFactory;
  import javax.xml.stream.XMLStreamConstants;
  import javax.xml.stream.XMLStreamException;
  import javax.xml.stream.XMLStreamReader;
<span class="udiff-line-added">+ import javax.xml.transform.Result;</span>
<span class="udiff-line-added">+ import javax.xml.transform.Source;</span>
  import javax.xml.transform.Transformer;
  import javax.xml.transform.TransformerConfigurationException;
  import javax.xml.transform.TransformerException;
  import javax.xml.transform.TransformerFactory;
  import javax.xml.transform.dom.DOMResult;
  import javax.xml.transform.stax.StAXResult;
  import javax.xml.transform.stax.StAXSource;
  import javax.xml.transform.stream.StreamResult;
<span class="udiff-line-added">+ import javax.xml.transform.stream.StreamSource;</span>
  
  import org.testng.Assert;
<span class="udiff-line-added">+ import org.testng.annotations.DataProvider;</span>
  import org.testng.annotations.Listeners;
  import org.testng.annotations.Test;
  
  /*
   * @test
<span class="udiff-line-modified-removed">-  * @bug 8152530 8202426</span>
<span class="udiff-line-modified-added">+  * @bug 8152530 8202426 7148925</span>
   * @library /javax/xml/jaxp/libs /javax/xml/jaxp/unittest
   * @modules java.xml
   * @modules java.xml/com.sun.org.apache.xerces.internal.impl
   * @modules java.xml/com.sun.org.apache.xerces.internal.xni.parser
   * @modules java.xml/com.sun.xml.internal.stream
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -60,10 +65,104 @@</span>
   * @run testng/othervm transform.StAXSourceTest
   * @summary Test parsing from StAXSource.
   */
  @Listeners({jaxp.library.JAXPTestPolicy.class})
  public class StAXSourceTest {
<span class="udiff-line-added">+     @DataProvider(name = &quot;xml&quot;)</span>
<span class="udiff-line-added">+     public Object[][] getData() throws Exception {</span>
<span class="udiff-line-added">+         // from 6715417, all other data were from 7148925</span>
<span class="udiff-line-added">+         String xmlDT = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;!DOCTYPE bookstore [ &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;!ELEMENT bookstore (book)*&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;!ELEMENT book (title,author,price)&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;!ATTLIST book genre CDATA #REQUIRED&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;!ELEMENT title (#PCDATA)&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;!ELEMENT author (#PCDATA)&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;!ELEMENT price (#PCDATA)&gt; ]&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;bookstore&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;book genre=\&quot;fantasy\&quot; &gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;title&gt;Oberon&#39;s Legacy&lt;/title&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;author&gt;Corets, Eva&lt;/author&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;price&gt;5.95&lt;/price&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;/book&gt; &quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;/bookstore&gt;&quot;;</span>
<span class="udiff-line-added">+         return new Object[][]{</span>
<span class="udiff-line-added">+             {&quot;&lt;root/&gt;&quot;},</span>
<span class="udiff-line-added">+             {&quot;&lt;!DOCTYPE root [&lt;!ENTITY et &#39;Come Home&#39;&gt;]&gt;&lt;root et=&#39;&amp;et;&#39;/&gt;&quot;},</span>
<span class="udiff-line-added">+             {&quot;&lt;?xml-stylesheet href=&#39;show.xsl&#39; type=&#39;text/html&#39;?&gt;&lt;root/&gt;&quot;},</span>
<span class="udiff-line-added">+             {&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&lt;?xml-stylesheet href=&#39;show.xsl&#39; type=&#39;text/html&#39;?&gt;&lt;root/&gt;&quot;},</span>
<span class="udiff-line-added">+             {&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&lt;?xml-stylesheet href=&#39;show.xsl&#39; type=&#39;text/html&#39;?&gt;&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;!DOCTYPE root&gt;&lt;root/&gt;&quot;},</span>
<span class="udiff-line-added">+             {&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&lt;!DOCTYPE root [&lt;!ELEMENT greeting (#PCDATA)&gt;]&gt;&lt;root/&gt;&quot;},</span>
<span class="udiff-line-added">+             {&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&lt;?xml-stylesheet href=&#39;show.xsl&#39; type=&#39;text/html&#39;?&gt;&quot;</span>
<span class="udiff-line-added">+                 + &quot;&lt;!DOCTYPE root [&lt;!ELEMENT greeting (#PCDATA)&gt;]&gt;&lt;root/&gt;&quot;},</span>
<span class="udiff-line-added">+             {xmlDT},</span>
<span class="udiff-line-added">+         };</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * @bug 7148925 6715417</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * Verifies that the transformation is successful with a StreamSource.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param xml the xml</span>
<span class="udiff-line-added">+      * @throws Exception if the test fails</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     @Test(dataProvider = &quot;xml&quot;)</span>
<span class="udiff-line-added">+     public void parseStreamSource(String xml) throws Exception {</span>
<span class="udiff-line-added">+         Source source = new StreamSource(new StringReader(xml));</span>
<span class="udiff-line-added">+         transform(source, xml);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * @bug 7148925 6715417</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * Verifies that the transformation is successful with a StAXSource created</span>
<span class="udiff-line-added">+      * out of a StreamReader.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * Note that the patch fixes the Exception, but does not include any improvement</span>
<span class="udiff-line-added">+      * over the current. The result may differ from that of StreamSource.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param xml the xml</span>
<span class="udiff-line-added">+      * @throws Exception if the test fails</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     @Test(dataProvider = &quot;xml&quot;)</span>
<span class="udiff-line-added">+     public void parseSSSR(String xml) throws Exception {</span>
<span class="udiff-line-added">+         XMLInputFactory xif = XMLInputFactory.newDefaultFactory();</span>
<span class="udiff-line-added">+         XMLStreamReader sr = xif.createXMLStreamReader(new StringReader(xml));</span>
<span class="udiff-line-added">+         StAXSource source = new StAXSource(sr);</span>
<span class="udiff-line-added">+         transform(source, xml);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * @bug 7148925 6715417</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * Verifies that the transformation is successful with a StAXSource created</span>
<span class="udiff-line-added">+      * out of an EventReader.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * Note that the patch fixes the Exception, but does not include any improvement</span>
<span class="udiff-line-added">+      * over the current. The result may differ from that of StreamSource.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param xml the xml</span>
<span class="udiff-line-added">+      * @throws Exception if the test fails</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     @Test(dataProvider = &quot;xml&quot;)</span>
<span class="udiff-line-added">+     public void parseSSER(String xml) throws Exception {</span>
<span class="udiff-line-added">+         XMLInputFactory xif = XMLInputFactory.newDefaultFactory();</span>
<span class="udiff-line-added">+         XMLEventReader er = xif.createXMLEventReader(new StringReader(xml));</span>
<span class="udiff-line-added">+         StAXSource source = new StAXSource(er);</span>
<span class="udiff-line-added">+         transform(source, xml);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private void transform(Source source, String sourceXml) throws Exception{</span>
<span class="udiff-line-added">+         StringWriter sw = new StringWriter();</span>
<span class="udiff-line-added">+         Result result = new StreamResult(sw);</span>
<span class="udiff-line-added">+         TransformerFactory tf = TransformerFactory.newInstance();</span>
<span class="udiff-line-added">+         tf.newTransformer().transform(source, result);</span>
<span class="udiff-line-added">+         System.out.printf(&quot;%n%s:%nSource: %s%nResult: %s%n&quot;, source.getClass().getSimpleName(), sourceXml, sw);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * @bug 8202426
       * Verifies that a null Attribute type is handled. NPE was thrown before the fix.
       */
      @Test
</pre>
<center><a href="SecureProcessingTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../validation/SchemaTest.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>