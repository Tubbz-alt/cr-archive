<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/jaxp/javax/xml/jaxp/unittest/transform/StAXSourceTest.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SecureProcessingTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../validation/SchemaTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/jaxp/javax/xml/jaxp/unittest/transform/StAXSourceTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package transform;
 25 

 26 import static jaxp.library.JAXPTestUtilities.setSystemProperty;
 27 import java.io.StringReader;
 28 import java.io.StringWriter;
 29 import javax.xml.stream.XMLEventReader;
 30 import javax.xml.stream.XMLEventWriter;
 31 import javax.xml.stream.XMLInputFactory;
 32 import javax.xml.stream.XMLOutputFactory;
 33 import javax.xml.stream.XMLStreamConstants;
 34 import javax.xml.stream.XMLStreamException;
 35 import javax.xml.stream.XMLStreamReader;


 36 import javax.xml.transform.Transformer;
 37 import javax.xml.transform.TransformerConfigurationException;
 38 import javax.xml.transform.TransformerException;
 39 import javax.xml.transform.TransformerFactory;
 40 import javax.xml.transform.dom.DOMResult;
 41 import javax.xml.transform.stax.StAXResult;
 42 import javax.xml.transform.stax.StAXSource;
 43 import javax.xml.transform.stream.StreamResult;

 44 
 45 import org.testng.Assert;

 46 import org.testng.annotations.Listeners;
 47 import org.testng.annotations.Test;
 48 
 49 /*
 50  * @test
<span class="line-modified"> 51  * @bug 8152530 8202426</span>
 52  * @library /javax/xml/jaxp/libs /javax/xml/jaxp/unittest
 53  * @modules java.xml
 54  * @modules java.xml/com.sun.org.apache.xerces.internal.impl
 55  * @modules java.xml/com.sun.org.apache.xerces.internal.xni.parser
 56  * @modules java.xml/com.sun.xml.internal.stream
 57  * @clean MyXMLInputFactoryImpl MyXMLStreamReader
 58  * @build MyXMLInputFactoryImpl MyXMLStreamReader
 59  * @run testng/othervm -DrunSecMngr=true transform.StAXSourceTest
 60  * @run testng/othervm transform.StAXSourceTest
 61  * @summary Test parsing from StAXSource.
 62  */
 63 @Listeners({jaxp.library.JAXPTestPolicy.class})
 64 public class StAXSourceTest {






























































































 65     /**
 66      * @bug 8202426
 67      * Verifies that a null Attribute type is handled. NPE was thrown before the fix.
 68      */
 69     @Test
 70     public final void testAttributeTypeNull() throws Exception {
 71         String xml = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt; \n&quot; +
 72             &quot;&lt;t:test xmlns:t=\&quot;http://www.example.org/Test\&quot; attr=\&quot;value\&quot; /&gt; &quot;;
 73         setSystemProperty(&quot;javax.xml.stream.XMLInputFactory&quot;, &quot;transform.MyXMLInputFactoryImpl&quot;);
 74         XMLInputFactory xif = XMLInputFactory.newInstance();
 75         XMLStreamReader xsr = xif.createXMLStreamReader(new StringReader(xml));
 76         TransformerFactory tf = TransformerFactory.newInstance();
 77         Transformer t = tf.newTransformer();
 78 
 79         while (xsr.hasNext()) {
 80             xsr.next();
 81             if (xsr.getEventType() == XMLStreamConstants.START_ELEMENT) {
 82                 t.reset();
 83                 DOMResult result = new DOMResult();
 84                 t.transform(new StAXSource(xsr), result);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 package transform;
 25 
<span class="line-added"> 26 import java.io.ByteArrayInputStream;</span>
 27 import static jaxp.library.JAXPTestUtilities.setSystemProperty;
 28 import java.io.StringReader;
 29 import java.io.StringWriter;
 30 import javax.xml.stream.XMLEventReader;
 31 import javax.xml.stream.XMLEventWriter;
 32 import javax.xml.stream.XMLInputFactory;
 33 import javax.xml.stream.XMLOutputFactory;
 34 import javax.xml.stream.XMLStreamConstants;
 35 import javax.xml.stream.XMLStreamException;
 36 import javax.xml.stream.XMLStreamReader;
<span class="line-added"> 37 import javax.xml.transform.Result;</span>
<span class="line-added"> 38 import javax.xml.transform.Source;</span>
 39 import javax.xml.transform.Transformer;
 40 import javax.xml.transform.TransformerConfigurationException;
 41 import javax.xml.transform.TransformerException;
 42 import javax.xml.transform.TransformerFactory;
 43 import javax.xml.transform.dom.DOMResult;
 44 import javax.xml.transform.stax.StAXResult;
 45 import javax.xml.transform.stax.StAXSource;
 46 import javax.xml.transform.stream.StreamResult;
<span class="line-added"> 47 import javax.xml.transform.stream.StreamSource;</span>
 48 
 49 import org.testng.Assert;
<span class="line-added"> 50 import org.testng.annotations.DataProvider;</span>
 51 import org.testng.annotations.Listeners;
 52 import org.testng.annotations.Test;
 53 
 54 /*
 55  * @test
<span class="line-modified"> 56  * @bug 8152530 8202426 7148925</span>
 57  * @library /javax/xml/jaxp/libs /javax/xml/jaxp/unittest
 58  * @modules java.xml
 59  * @modules java.xml/com.sun.org.apache.xerces.internal.impl
 60  * @modules java.xml/com.sun.org.apache.xerces.internal.xni.parser
 61  * @modules java.xml/com.sun.xml.internal.stream
 62  * @clean MyXMLInputFactoryImpl MyXMLStreamReader
 63  * @build MyXMLInputFactoryImpl MyXMLStreamReader
 64  * @run testng/othervm -DrunSecMngr=true transform.StAXSourceTest
 65  * @run testng/othervm transform.StAXSourceTest
 66  * @summary Test parsing from StAXSource.
 67  */
 68 @Listeners({jaxp.library.JAXPTestPolicy.class})
 69 public class StAXSourceTest {
<span class="line-added"> 70     @DataProvider(name = &quot;xml&quot;)</span>
<span class="line-added"> 71     public Object[][] getData() throws Exception {</span>
<span class="line-added"> 72         // from 6715417, all other data were from 7148925</span>
<span class="line-added"> 73         String xmlDT = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt; &quot;</span>
<span class="line-added"> 74                 + &quot;&lt;!DOCTYPE bookstore [ &quot;</span>
<span class="line-added"> 75                 + &quot;&lt;!ELEMENT bookstore (book)*&gt; &quot;</span>
<span class="line-added"> 76                 + &quot;&lt;!ELEMENT book (title,author,price)&gt; &quot;</span>
<span class="line-added"> 77                 + &quot;&lt;!ATTLIST book genre CDATA #REQUIRED&gt; &quot;</span>
<span class="line-added"> 78                 + &quot;&lt;!ELEMENT title (#PCDATA)&gt; &quot;</span>
<span class="line-added"> 79                 + &quot;&lt;!ELEMENT author (#PCDATA)&gt; &quot;</span>
<span class="line-added"> 80                 + &quot;&lt;!ELEMENT price (#PCDATA)&gt; ]&gt; &quot;</span>
<span class="line-added"> 81                 + &quot;&lt;bookstore&gt; &quot;</span>
<span class="line-added"> 82                 + &quot;&lt;book genre=\&quot;fantasy\&quot; &gt; &quot;</span>
<span class="line-added"> 83                 + &quot;&lt;title&gt;Oberon&#39;s Legacy&lt;/title&gt; &quot;</span>
<span class="line-added"> 84                 + &quot;&lt;author&gt;Corets, Eva&lt;/author&gt; &quot;</span>
<span class="line-added"> 85                 + &quot;&lt;price&gt;5.95&lt;/price&gt; &quot;</span>
<span class="line-added"> 86                 + &quot;&lt;/book&gt; &quot;</span>
<span class="line-added"> 87                 + &quot;&lt;/bookstore&gt;&quot;;</span>
<span class="line-added"> 88         return new Object[][]{</span>
<span class="line-added"> 89             {&quot;&lt;root/&gt;&quot;},</span>
<span class="line-added"> 90             {&quot;&lt;!DOCTYPE root [&lt;!ENTITY et &#39;Come Home&#39;&gt;]&gt;&lt;root et=&#39;&amp;et;&#39;/&gt;&quot;},</span>
<span class="line-added"> 91             {&quot;&lt;?xml-stylesheet href=&#39;show.xsl&#39; type=&#39;text/html&#39;?&gt;&lt;root/&gt;&quot;},</span>
<span class="line-added"> 92             {&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&lt;?xml-stylesheet href=&#39;show.xsl&#39; type=&#39;text/html&#39;?&gt;&lt;root/&gt;&quot;},</span>
<span class="line-added"> 93             {&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&lt;?xml-stylesheet href=&#39;show.xsl&#39; type=&#39;text/html&#39;?&gt;&quot;</span>
<span class="line-added"> 94                 + &quot;&lt;!DOCTYPE root&gt;&lt;root/&gt;&quot;},</span>
<span class="line-added"> 95             {&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&lt;!DOCTYPE root [&lt;!ELEMENT greeting (#PCDATA)&gt;]&gt;&lt;root/&gt;&quot;},</span>
<span class="line-added"> 96             {&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&lt;?xml-stylesheet href=&#39;show.xsl&#39; type=&#39;text/html&#39;?&gt;&quot;</span>
<span class="line-added"> 97                 + &quot;&lt;!DOCTYPE root [&lt;!ELEMENT greeting (#PCDATA)&gt;]&gt;&lt;root/&gt;&quot;},</span>
<span class="line-added"> 98             {xmlDT},</span>
<span class="line-added"> 99         };</span>
<span class="line-added">100     }</span>
<span class="line-added">101 </span>
<span class="line-added">102     /**</span>
<span class="line-added">103      * @bug 7148925 6715417</span>
<span class="line-added">104      *</span>
<span class="line-added">105      * Verifies that the transformation is successful with a StreamSource.</span>
<span class="line-added">106      *</span>
<span class="line-added">107      * @param xml the xml</span>
<span class="line-added">108      * @throws Exception if the test fails</span>
<span class="line-added">109      */</span>
<span class="line-added">110     @Test(dataProvider = &quot;xml&quot;)</span>
<span class="line-added">111     public void parseStreamSource(String xml) throws Exception {</span>
<span class="line-added">112         Source source = new StreamSource(new StringReader(xml));</span>
<span class="line-added">113         transform(source, xml);</span>
<span class="line-added">114     }</span>
<span class="line-added">115 </span>
<span class="line-added">116     /**</span>
<span class="line-added">117      * @bug 7148925 6715417</span>
<span class="line-added">118      *</span>
<span class="line-added">119      * Verifies that the transformation is successful with a StAXSource created</span>
<span class="line-added">120      * out of a StreamReader.</span>
<span class="line-added">121      *</span>
<span class="line-added">122      * Note that the patch fixes the Exception, but does not include any improvement</span>
<span class="line-added">123      * over the current. The result may differ from that of StreamSource.</span>
<span class="line-added">124      *</span>
<span class="line-added">125      * @param xml the xml</span>
<span class="line-added">126      * @throws Exception if the test fails</span>
<span class="line-added">127      */</span>
<span class="line-added">128     @Test(dataProvider = &quot;xml&quot;)</span>
<span class="line-added">129     public void parseSSSR(String xml) throws Exception {</span>
<span class="line-added">130         XMLInputFactory xif = XMLInputFactory.newDefaultFactory();</span>
<span class="line-added">131         XMLStreamReader sr = xif.createXMLStreamReader(new StringReader(xml));</span>
<span class="line-added">132         StAXSource source = new StAXSource(sr);</span>
<span class="line-added">133         transform(source, xml);</span>
<span class="line-added">134     }</span>
<span class="line-added">135 </span>
<span class="line-added">136     /**</span>
<span class="line-added">137      * @bug 7148925 6715417</span>
<span class="line-added">138      *</span>
<span class="line-added">139      * Verifies that the transformation is successful with a StAXSource created</span>
<span class="line-added">140      * out of an EventReader.</span>
<span class="line-added">141      *</span>
<span class="line-added">142      * Note that the patch fixes the Exception, but does not include any improvement</span>
<span class="line-added">143      * over the current. The result may differ from that of StreamSource.</span>
<span class="line-added">144      *</span>
<span class="line-added">145      * @param xml the xml</span>
<span class="line-added">146      * @throws Exception if the test fails</span>
<span class="line-added">147      */</span>
<span class="line-added">148     @Test(dataProvider = &quot;xml&quot;)</span>
<span class="line-added">149     public void parseSSER(String xml) throws Exception {</span>
<span class="line-added">150         XMLInputFactory xif = XMLInputFactory.newDefaultFactory();</span>
<span class="line-added">151         XMLEventReader er = xif.createXMLEventReader(new StringReader(xml));</span>
<span class="line-added">152         StAXSource source = new StAXSource(er);</span>
<span class="line-added">153         transform(source, xml);</span>
<span class="line-added">154     }</span>
<span class="line-added">155 </span>
<span class="line-added">156     private void transform(Source source, String sourceXml) throws Exception{</span>
<span class="line-added">157         StringWriter sw = new StringWriter();</span>
<span class="line-added">158         Result result = new StreamResult(sw);</span>
<span class="line-added">159         TransformerFactory tf = TransformerFactory.newInstance();</span>
<span class="line-added">160         tf.newTransformer().transform(source, result);</span>
<span class="line-added">161         System.out.printf(&quot;%n%s:%nSource: %s%nResult: %s%n&quot;, source.getClass().getSimpleName(), sourceXml, sw);</span>
<span class="line-added">162     }</span>
<span class="line-added">163 </span>
164     /**
165      * @bug 8202426
166      * Verifies that a null Attribute type is handled. NPE was thrown before the fix.
167      */
168     @Test
169     public final void testAttributeTypeNull() throws Exception {
170         String xml = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt; \n&quot; +
171             &quot;&lt;t:test xmlns:t=\&quot;http://www.example.org/Test\&quot; attr=\&quot;value\&quot; /&gt; &quot;;
172         setSystemProperty(&quot;javax.xml.stream.XMLInputFactory&quot;, &quot;transform.MyXMLInputFactoryImpl&quot;);
173         XMLInputFactory xif = XMLInputFactory.newInstance();
174         XMLStreamReader xsr = xif.createXMLStreamReader(new StringReader(xml));
175         TransformerFactory tf = TransformerFactory.newInstance();
176         Transformer t = tf.newTransformer();
177 
178         while (xsr.hasNext()) {
179             xsr.next();
180             if (xsr.getEventType() == XMLStreamConstants.START_ELEMENT) {
181                 t.reset();
182                 DOMResult result = new DOMResult();
183                 t.transform(new StAXSource(xsr), result);
</pre>
</td>
</tr>
</table>
<center><a href="SecureProcessingTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../validation/SchemaTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>