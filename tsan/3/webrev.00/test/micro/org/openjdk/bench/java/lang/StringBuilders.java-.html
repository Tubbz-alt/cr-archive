<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old test/micro/org/openjdk/bench/java/lang/StringBuilders.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2014 Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 package org.openjdk.bench.java.lang;
 24 
 25 import org.openjdk.jmh.annotations.Benchmark;
 26 import org.openjdk.jmh.annotations.BenchmarkMode;
 27 import org.openjdk.jmh.annotations.Mode;
 28 import org.openjdk.jmh.annotations.OutputTimeUnit;
 29 import org.openjdk.jmh.annotations.Scope;
 30 import org.openjdk.jmh.annotations.Setup;
 31 import org.openjdk.jmh.annotations.State;
 32 
 33 import java.util.concurrent.TimeUnit;
 34 
 35 @BenchmarkMode(Mode.AverageTime)
 36 @OutputTimeUnit(TimeUnit.NANOSECONDS)
 37 @State(Scope.Thread)
 38 public class StringBuilders {
 39 
 40     private String[] strings;
 41     private String[] str3p4p2;
 42     private String[] str16p8p7;
 43     private String[] str3p9p8;
 44     private String[] str22p40p31;
 45 
 46     @Setup
 47     public void setup() {
 48         strings = new String[]{&quot;As&quot;, &quot;your&quot;, &quot;attorney,&quot;, &quot;I&quot;,
 49                 &quot;advise&quot;, &quot;you&quot;, &quot;to&quot;, &quot;drive&quot;, &quot;at&quot;, &quot;top&quot;, &quot;speed&quot;, &quot;it&#39;ll&quot;,
 50                 &quot;be&quot;, &quot;a&quot;, &quot;god&quot;, &quot;damn&quot;, &quot;miracle&quot;, &quot;if&quot;, &quot;we&quot;, &quot;can&quot;, &quot;get&quot;,
 51                 &quot;there&quot;, &quot;before&quot;, &quot;you&quot;, &quot;turn&quot;, &quot;into&quot;, &quot;a&quot;, &quot;wild&quot;, &quot;animal.&quot;};
 52         str3p4p2 = new String[]{&quot;123&quot;, &quot;1234&quot;, &quot;12&quot;};
 53         str16p8p7 = new String[]{&quot;1234567890123456&quot;, &quot;12345678&quot;, &quot;1234567&quot;};
 54         str3p9p8 = new String[]{&quot;123&quot;, &quot;123456789&quot;, &quot;12345678&quot;};
 55         str22p40p31 = new String[]{&quot;1234567890123456789012&quot;, &quot;1234567890123456789012345678901234567890&quot;, &quot;1234567890123456789012345678901&quot;};
 56     }
 57 
 58     /** StringBuilder wins over StringMaker. */
 59     @Benchmark
 60     public String concat3p4p2() throws Exception {
 61         return new StringBuilder(String.valueOf(str3p4p2[0])).append(str3p4p2[1]).append(str3p4p2[2]).toString();
 62     }
 63 
 64     /** StringBuilder wins over StringMaker. */
 65     @Benchmark
 66     public String concat16p8p7() throws Exception {
 67         return new StringBuilder(String.valueOf(str16p8p7[0])).append(str16p8p7[1]).append(str16p8p7[2]).toString();
 68     }
 69 
 70     /** StringMaker wins over StringBuilder since the two last strings causes StringBuilder to do expand. */
 71     @Benchmark
 72     public String concat3p9p8() throws Exception {
 73         return new StringBuilder(String.valueOf(str3p9p8[0])).append(str3p9p8[1]).append(str3p9p8[2]).toString();
 74     }
 75 
 76     /** StringMaker wins over StringBuilder. */
 77     @Benchmark
 78     public String concat22p40p31() throws Exception {
 79         return new StringBuilder(String.valueOf(str22p40p31[0])).append(str22p40p31[1]).append(str22p40p31[2]).toString();
 80     }
 81 
 82     @Benchmark
 83     public StringBuilder appendLoop8() {
 84         StringBuilder sb = new StringBuilder();
 85         for (int i = 0; i &lt; 8; i++) {
 86             sb.append(strings[i]);
 87         }
 88         return sb;
 89     }
 90 
 91     @Benchmark
 92     public StringBuilder appendLoop16() {
 93         StringBuilder sb = new StringBuilder();
 94         for (int i = 0; i &lt; 16; i++) {
 95             sb.append(strings[i]);
 96         }
 97         return sb;
 98     }
 99 
100     @Benchmark
101     public String toStringCharWithChar1() {
102         StringBuilder result = new StringBuilder();
103         result.append(&#39;a&#39;);
104         return result.toString();
105     }
106 
107     @Benchmark
108     public String toStringCharWithChar2() {
109         StringBuilder result = new StringBuilder();
110         result.append(&#39;a&#39;);
111         result.append(&#39;p&#39;);
112         return result.toString();
113     }
114 
115 
116     @Benchmark
117     public String toStringCharWithChar4() {
118         StringBuilder result = new StringBuilder();
119         result.append(&#39;a&#39;);
120         result.append(&#39;p&#39;);
121         result.append(&#39;a&#39;);
122         result.append(&#39; &#39;);
123         return result.toString();
124     }
125 
126     @Benchmark
127     public String toStringCharWithChar8() {
128         StringBuilder result = new StringBuilder();
129         result.append(&#39;a&#39;);
130         result.append(&#39;p&#39;);
131         result.append(&#39;a&#39;);
132         result.append(&#39; &#39;);
133         result.append(&#39;a&#39;);
134         result.append(&#39;p&#39;);
135         result.append(&#39;a&#39;);
136         result.append(&#39; &#39;);
137         return result.toString();
138     }
139 
140     @Benchmark
141     public String toStringCharWithChar16() {
142         StringBuilder result = new StringBuilder();
143         result.append(&#39;a&#39;);
144         result.append(&#39;b&#39;);
145         result.append(&#39;c&#39;);
146         result.append(&#39;d&#39;);
147         result.append(&#39;e&#39;);
148         result.append(&#39;f&#39;);
149         result.append(&#39;g&#39;);
150         result.append(&#39;h&#39;);
151         result.append(&#39;i&#39;);
152         result.append(&#39;j&#39;);
153         result.append(&#39;k&#39;);
154         result.append(&#39;l&#39;);
155         result.append(&#39;m&#39;);
156         result.append(&#39;n&#39;);
157         result.append(&#39;o&#39;);
158         result.append(&#39;p&#39;);
159         return result.toString();
160     }
161 
162 
163     @Benchmark
164     public String toStringCharWithString8() {
165         StringBuilder result = new StringBuilder();
166         result.append(&quot;a&quot;);
167         result.append(&quot;b&quot;);
168         result.append(&quot;c&quot;);
169         result.append(&quot;d&quot;);
170         result.append(&quot;e&quot;);
171         result.append(&quot;f&quot;);
172         result.append(&quot;g&quot;);
173         result.append(&quot;h&quot;);
174         return result.toString();
175     }
176 
177 
178     @Benchmark
179     public String toStringCharWithString16() {
180         StringBuilder result = new StringBuilder();
181         result.append(&quot;a&quot;);
182         result.append(&quot;b&quot;);
183         result.append(&quot;c&quot;);
184         result.append(&quot;d&quot;);
185         result.append(&quot;e&quot;);
186         result.append(&quot;f&quot;);
187         result.append(&quot;g&quot;);
188         result.append(&quot;h&quot;);
189         result.append(&quot;i&quot;);
190         result.append(&quot;j&quot;);
191         result.append(&quot;k&quot;);
192         result.append(&quot;l&quot;);
193         result.append(&quot;m&quot;);
194         result.append(&quot;n&quot;);
195         result.append(&quot;o&quot;);
196         result.append(&quot;p&quot;);
197         return result.toString();
198     }
199 
200 
201     @Benchmark
202     public String toStringCharWithInt8() {
203         StringBuilder result = new StringBuilder();
204         result.append(2048);
205         result.append(31337);
206         result.append(0xbeefcace);
207         result.append(9000);
208         result.append(4711);
209         result.append(1337);
210         result.append(2100);
211         result.append(2600);
212         return result.toString();
213     }
214 
215 
216     @Benchmark
217     public String toStringCharWithBool8() {
218         StringBuilder result = new StringBuilder();
219         result.append(true);
220         result.append(false);
221         result.append(true);
222         result.append(true);
223         result.append(false);
224         result.append(true);
225         result.append(false);
226         result.append(false);
227         return result.toString();
228     }
229 
230 
231     @Benchmark
232     public String toStringCharWithFloat8() {
233         StringBuilder result = new StringBuilder();
234         result.append(113.110F);
235         result.append(156456.36435637F);
236         result.append(65436434.64632F);
237         result.append(42654634.64540F);
238         result.append(63464351.64537F);
239         result.append(634564.645711F);
240         result.append(64547.64311F);
241         result.append(4763456341.64531F);
242         return result.toString();
243     }
244 
245 
246     @Benchmark
247     public String toStringCharWithMixed8() {
248         StringBuilder result = new StringBuilder();
249         result.append(&#39;a&#39;);
250         result.append(&quot;stringelinglinglinglong&quot;);
251         result.append(&#39;a&#39;);
252         result.append(&quot;stringelinglinglinglong&quot;);
253         result.append(&#39;a&#39;);
254         result.append(&quot;stringelinglinglinglong&quot;);
255         result.append(&#39;p&#39;);
256         result.append(&quot;stringelinglinglinglong&quot;);
257         return result.toString();
258     }
259 }
    </pre>
  </body>
</html>