<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/micro/org/openjdk/bench/java/lang/StringBuilders.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="StringBuffers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="StringConcat.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>test/micro/org/openjdk/bench/java/lang/StringBuilders.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014 Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 package org.openjdk.bench.java.lang;
 24 
 25 import org.openjdk.jmh.annotations.Benchmark;
 26 import org.openjdk.jmh.annotations.BenchmarkMode;
 27 import org.openjdk.jmh.annotations.Mode;
 28 import org.openjdk.jmh.annotations.OutputTimeUnit;

 29 import org.openjdk.jmh.annotations.Scope;
 30 import org.openjdk.jmh.annotations.Setup;
 31 import org.openjdk.jmh.annotations.State;
 32 
 33 import java.util.concurrent.TimeUnit;
 34 
 35 @BenchmarkMode(Mode.AverageTime)
 36 @OutputTimeUnit(TimeUnit.NANOSECONDS)
 37 @State(Scope.Thread)
 38 public class StringBuilders {
 39 
 40     private String[] strings;
 41     private String[] str3p4p2;
 42     private String[] str16p8p7;
 43     private String[] str3p9p8;
 44     private String[] str22p40p31;


 45 
 46     @Setup
 47     public void setup() {
 48         strings = new String[]{&quot;As&quot;, &quot;your&quot;, &quot;attorney,&quot;, &quot;I&quot;,
 49                 &quot;advise&quot;, &quot;you&quot;, &quot;to&quot;, &quot;drive&quot;, &quot;at&quot;, &quot;top&quot;, &quot;speed&quot;, &quot;it&#39;ll&quot;,
 50                 &quot;be&quot;, &quot;a&quot;, &quot;god&quot;, &quot;damn&quot;, &quot;miracle&quot;, &quot;if&quot;, &quot;we&quot;, &quot;can&quot;, &quot;get&quot;,
 51                 &quot;there&quot;, &quot;before&quot;, &quot;you&quot;, &quot;turn&quot;, &quot;into&quot;, &quot;a&quot;, &quot;wild&quot;, &quot;animal.&quot;};
 52         str3p4p2 = new String[]{&quot;123&quot;, &quot;1234&quot;, &quot;12&quot;};
 53         str16p8p7 = new String[]{&quot;1234567890123456&quot;, &quot;12345678&quot;, &quot;1234567&quot;};
 54         str3p9p8 = new String[]{&quot;123&quot;, &quot;123456789&quot;, &quot;12345678&quot;};
 55         str22p40p31 = new String[]{&quot;1234567890123456789012&quot;, &quot;1234567890123456789012345678901234567890&quot;, &quot;1234567890123456789012345678901&quot;};


 56     }
 57 
<span class="line-removed"> 58     /** StringBuilder wins over StringMaker. */</span>
 59     @Benchmark
 60     public String concat3p4p2() throws Exception {
 61         return new StringBuilder(String.valueOf(str3p4p2[0])).append(str3p4p2[1]).append(str3p4p2[2]).toString();
 62     }
 63 
<span class="line-removed"> 64     /** StringBuilder wins over StringMaker. */</span>
 65     @Benchmark
 66     public String concat16p8p7() throws Exception {
 67         return new StringBuilder(String.valueOf(str16p8p7[0])).append(str16p8p7[1]).append(str16p8p7[2]).toString();
 68     }
 69 
<span class="line-removed"> 70     /** StringMaker wins over StringBuilder since the two last strings causes StringBuilder to do expand. */</span>
 71     @Benchmark
 72     public String concat3p9p8() throws Exception {
 73         return new StringBuilder(String.valueOf(str3p9p8[0])).append(str3p9p8[1]).append(str3p9p8[2]).toString();
 74     }
 75 
<span class="line-removed"> 76     /** StringMaker wins over StringBuilder. */</span>
 77     @Benchmark
 78     public String concat22p40p31() throws Exception {
 79         return new StringBuilder(String.valueOf(str22p40p31[0])).append(str22p40p31[1]).append(str22p40p31[2]).toString();
 80     }
 81 
 82     @Benchmark
 83     public StringBuilder appendLoop8() {
 84         StringBuilder sb = new StringBuilder();
 85         for (int i = 0; i &lt; 8; i++) {
 86             sb.append(strings[i]);
 87         }
 88         return sb;
 89     }
 90 
 91     @Benchmark
 92     public StringBuilder appendLoop16() {
 93         StringBuilder sb = new StringBuilder();
 94         for (int i = 0; i &lt; 16; i++) {
 95             sb.append(strings[i]);
 96         }
</pre>
<hr />
<pre>
239         result.append(634564.645711F);
240         result.append(64547.64311F);
241         result.append(4763456341.64531F);
242         return result.toString();
243     }
244 
245 
246     @Benchmark
247     public String toStringCharWithMixed8() {
248         StringBuilder result = new StringBuilder();
249         result.append(&#39;a&#39;);
250         result.append(&quot;stringelinglinglinglong&quot;);
251         result.append(&#39;a&#39;);
252         result.append(&quot;stringelinglinglinglong&quot;);
253         result.append(&#39;a&#39;);
254         result.append(&quot;stringelinglinglinglong&quot;);
255         result.append(&#39;p&#39;);
256         result.append(&quot;stringelinglinglinglong&quot;);
257         return result.toString();
258     }
























































































































259 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 package org.openjdk.bench.java.lang;
 24 
 25 import org.openjdk.jmh.annotations.Benchmark;
 26 import org.openjdk.jmh.annotations.BenchmarkMode;
 27 import org.openjdk.jmh.annotations.Mode;
 28 import org.openjdk.jmh.annotations.OutputTimeUnit;
<span class="line-added"> 29 import org.openjdk.jmh.annotations.Param;</span>
 30 import org.openjdk.jmh.annotations.Scope;
 31 import org.openjdk.jmh.annotations.Setup;
 32 import org.openjdk.jmh.annotations.State;
 33 
 34 import java.util.concurrent.TimeUnit;
 35 
 36 @BenchmarkMode(Mode.AverageTime)
 37 @OutputTimeUnit(TimeUnit.NANOSECONDS)
 38 @State(Scope.Thread)
 39 public class StringBuilders {
 40 
 41     private String[] strings;
 42     private String[] str3p4p2;
 43     private String[] str16p8p7;
 44     private String[] str3p9p8;
 45     private String[] str22p40p31;
<span class="line-added"> 46     private StringBuilder sbLatin1;</span>
<span class="line-added"> 47     private StringBuilder sbUtf16;</span>
 48 
 49     @Setup
 50     public void setup() {
 51         strings = new String[]{&quot;As&quot;, &quot;your&quot;, &quot;attorney,&quot;, &quot;I&quot;,
 52                 &quot;advise&quot;, &quot;you&quot;, &quot;to&quot;, &quot;drive&quot;, &quot;at&quot;, &quot;top&quot;, &quot;speed&quot;, &quot;it&#39;ll&quot;,
 53                 &quot;be&quot;, &quot;a&quot;, &quot;god&quot;, &quot;damn&quot;, &quot;miracle&quot;, &quot;if&quot;, &quot;we&quot;, &quot;can&quot;, &quot;get&quot;,
 54                 &quot;there&quot;, &quot;before&quot;, &quot;you&quot;, &quot;turn&quot;, &quot;into&quot;, &quot;a&quot;, &quot;wild&quot;, &quot;animal.&quot;};
 55         str3p4p2 = new String[]{&quot;123&quot;, &quot;1234&quot;, &quot;12&quot;};
 56         str16p8p7 = new String[]{&quot;1234567890123456&quot;, &quot;12345678&quot;, &quot;1234567&quot;};
 57         str3p9p8 = new String[]{&quot;123&quot;, &quot;123456789&quot;, &quot;12345678&quot;};
 58         str22p40p31 = new String[]{&quot;1234567890123456789012&quot;, &quot;1234567890123456789012345678901234567890&quot;, &quot;1234567890123456789012345678901&quot;};
<span class="line-added"> 59         sbLatin1 = new StringBuilder(&quot;Latin1 string&quot;);</span>
<span class="line-added"> 60         sbUtf16 = new StringBuilder(&quot;UTF-\uFF11\uFF16 string&quot;);</span>
 61     }
 62 

 63     @Benchmark
 64     public String concat3p4p2() throws Exception {
 65         return new StringBuilder(String.valueOf(str3p4p2[0])).append(str3p4p2[1]).append(str3p4p2[2]).toString();
 66     }
 67 

 68     @Benchmark
 69     public String concat16p8p7() throws Exception {
 70         return new StringBuilder(String.valueOf(str16p8p7[0])).append(str16p8p7[1]).append(str16p8p7[2]).toString();
 71     }
 72 

 73     @Benchmark
 74     public String concat3p9p8() throws Exception {
 75         return new StringBuilder(String.valueOf(str3p9p8[0])).append(str3p9p8[1]).append(str3p9p8[2]).toString();
 76     }
 77 

 78     @Benchmark
 79     public String concat22p40p31() throws Exception {
 80         return new StringBuilder(String.valueOf(str22p40p31[0])).append(str22p40p31[1]).append(str22p40p31[2]).toString();
 81     }
 82 
 83     @Benchmark
 84     public StringBuilder appendLoop8() {
 85         StringBuilder sb = new StringBuilder();
 86         for (int i = 0; i &lt; 8; i++) {
 87             sb.append(strings[i]);
 88         }
 89         return sb;
 90     }
 91 
 92     @Benchmark
 93     public StringBuilder appendLoop16() {
 94         StringBuilder sb = new StringBuilder();
 95         for (int i = 0; i &lt; 16; i++) {
 96             sb.append(strings[i]);
 97         }
</pre>
<hr />
<pre>
240         result.append(634564.645711F);
241         result.append(64547.64311F);
242         result.append(4763456341.64531F);
243         return result.toString();
244     }
245 
246 
247     @Benchmark
248     public String toStringCharWithMixed8() {
249         StringBuilder result = new StringBuilder();
250         result.append(&#39;a&#39;);
251         result.append(&quot;stringelinglinglinglong&quot;);
252         result.append(&#39;a&#39;);
253         result.append(&quot;stringelinglinglinglong&quot;);
254         result.append(&#39;a&#39;);
255         result.append(&quot;stringelinglinglinglong&quot;);
256         result.append(&#39;p&#39;);
257         result.append(&quot;stringelinglinglinglong&quot;);
258         return result.toString();
259     }
<span class="line-added">260 </span>
<span class="line-added">261     @Benchmark</span>
<span class="line-added">262     public StringBuilder fromLatin1String() {</span>
<span class="line-added">263         return new StringBuilder(&quot;Latin1 string&quot;);</span>
<span class="line-added">264     }</span>
<span class="line-added">265 </span>
<span class="line-added">266     @Benchmark</span>
<span class="line-added">267     public StringBuilder fromUtf16String() {</span>
<span class="line-added">268         return new StringBuilder(&quot;UTF-\uFF11\uFF16 string&quot;);</span>
<span class="line-added">269     }</span>
<span class="line-added">270 </span>
<span class="line-added">271     @Benchmark</span>
<span class="line-added">272     public StringBuilder fromLatin1StringBuilder() {</span>
<span class="line-added">273         return new StringBuilder(sbLatin1);</span>
<span class="line-added">274     }</span>
<span class="line-added">275 </span>
<span class="line-added">276     @Benchmark</span>
<span class="line-added">277     public StringBuilder fromUtf16StringBuilder() {</span>
<span class="line-added">278         return new StringBuilder(sbUtf16);</span>
<span class="line-added">279     }</span>
<span class="line-added">280 </span>
<span class="line-added">281     @Benchmark</span>
<span class="line-added">282     @SuppressWarnings(&quot;StringBufferReplaceableByString&quot;)</span>
<span class="line-added">283     public String appendSubstring(Data data) {</span>
<span class="line-added">284         String str = data.str;</span>
<span class="line-added">285         int beginIndex = data.beginIndex;</span>
<span class="line-added">286         int endIndex = data.endIndex;</span>
<span class="line-added">287 </span>
<span class="line-added">288         String substring = str.substring(beginIndex, endIndex);</span>
<span class="line-added">289         return new StringBuilder().append(&#39;L&#39;).append(substring).append(&#39;;&#39;).toString();</span>
<span class="line-added">290     }</span>
<span class="line-added">291 </span>
<span class="line-added">292     @Benchmark</span>
<span class="line-added">293     public String appendBounds(Data data) {</span>
<span class="line-added">294         String str = data.str;</span>
<span class="line-added">295         int beginIndex = data.beginIndex;</span>
<span class="line-added">296         int endIndex = data.endIndex;</span>
<span class="line-added">297 </span>
<span class="line-added">298         return new StringBuilder().append(&#39;L&#39;).append(str, beginIndex, endIndex).append(&#39;;&#39;).toString();</span>
<span class="line-added">299     }</span>
<span class="line-added">300 </span>
<span class="line-added">301     @Benchmark</span>
<span class="line-added">302     @SuppressWarnings(&quot;StringBufferReplaceableByString&quot;)</span>
<span class="line-added">303     public String appendSubstringUtf16(Data data) {</span>
<span class="line-added">304         String str = data.utf16Str;</span>
<span class="line-added">305         int beginIndex = data.beginIndex;</span>
<span class="line-added">306         int endIndex = data.endIndex;</span>
<span class="line-added">307 </span>
<span class="line-added">308         String substring = str.substring(beginIndex, endIndex);</span>
<span class="line-added">309 </span>
<span class="line-added">310         return new StringBuilder().append(&#39;L&#39;).append(substring).append(&#39;;&#39;).toString();</span>
<span class="line-added">311     }</span>
<span class="line-added">312 </span>
<span class="line-added">313     @Benchmark</span>
<span class="line-added">314     public String appendBoundsUtf16(Data data) {</span>
<span class="line-added">315         String str = data.utf16Str;</span>
<span class="line-added">316         int beginIndex = data.beginIndex;</span>
<span class="line-added">317         int endIndex = data.endIndex;</span>
<span class="line-added">318 </span>
<span class="line-added">319         return new StringBuilder().append(&#39;L&#39;).append(str, beginIndex,</span>
<span class="line-added">320                 endIndex).append(&#39;;&#39;).toString();</span>
<span class="line-added">321     }</span>
<span class="line-added">322 </span>
<span class="line-added">323     @Benchmark</span>
<span class="line-added">324     public String appendBoundsMix(Data data) {</span>
<span class="line-added">325         CharSequence str = data.next();</span>
<span class="line-added">326         int beginIndex = data.beginIndex;</span>
<span class="line-added">327         int endIndex = data.endIndex;</span>
<span class="line-added">328 </span>
<span class="line-added">329         return new StringBuilder().append(&#39;L&#39;).append(str, beginIndex,</span>
<span class="line-added">330                 endIndex).append(&#39;;&#39;).toString();</span>
<span class="line-added">331     }</span>
<span class="line-added">332 </span>
<span class="line-added">333     @State(Scope.Thread)</span>
<span class="line-added">334     public static class Data {</span>
<span class="line-added">335         int i = 0;</span>
<span class="line-added">336 </span>
<span class="line-added">337         public CharSequence next() {</span>
<span class="line-added">338             i++;</span>
<span class="line-added">339             if (i == 1) {</span>
<span class="line-added">340                 return str;</span>
<span class="line-added">341             } else if (i == 2) {</span>
<span class="line-added">342                 return utf16Str;</span>
<span class="line-added">343             } else {</span>
<span class="line-added">344                 i = 0;</span>
<span class="line-added">345                 return cs;</span>
<span class="line-added">346             }</span>
<span class="line-added">347         }</span>
<span class="line-added">348 </span>
<span class="line-added">349         String str;</span>
<span class="line-added">350         String utf16Str;</span>
<span class="line-added">351         CharSequence cs;</span>
<span class="line-added">352 </span>
<span class="line-added">353         @Param({&quot;10&quot;, &quot;1000&quot;})</span>
<span class="line-added">354         private int length;</span>
<span class="line-added">355 </span>
<span class="line-added">356         private int beginIndex;</span>
<span class="line-added">357         private int endIndex;</span>
<span class="line-added">358 </span>
<span class="line-added">359         @Setup</span>
<span class="line-added">360         public void setup() {</span>
<span class="line-added">361             generateData();</span>
<span class="line-added">362             beginIndex = length / 4;</span>
<span class="line-added">363             endIndex = length / 4 * 3;</span>
<span class="line-added">364         }</span>
<span class="line-added">365 </span>
<span class="line-added">366         private void generateData() {</span>
<span class="line-added">367             char[] chars = &quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;.toCharArray();</span>
<span class="line-added">368 </span>
<span class="line-added">369             StringBuilder sb = new StringBuilder(length);</span>
<span class="line-added">370             for (int i = 0; i &lt; length; i++) {</span>
<span class="line-added">371                 char c = chars[i % chars.length];</span>
<span class="line-added">372                 sb.append(c);</span>
<span class="line-added">373             }</span>
<span class="line-added">374             str = sb.toString();</span>
<span class="line-added">375             sb.replace(length / 4 * 2, length / 4 * 2 + 1, &quot;\u04FF&quot;);</span>
<span class="line-added">376             utf16Str = sb.toString();</span>
<span class="line-added">377             cs = new StringBuilder(str);</span>
<span class="line-added">378         }</span>
<span class="line-added">379     }</span>
380 }
</pre>
</td>
</tr>
</table>
<center><a href="StringBuffers.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="StringConcat.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>