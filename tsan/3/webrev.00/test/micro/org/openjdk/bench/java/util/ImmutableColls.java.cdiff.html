<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/micro/org/openjdk/bench/java/util/ImmutableColls.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="HashMapBench.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="RandomNext.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/micro/org/openjdk/bench/java/util/ImmutableColls.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2019 Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2019, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 32,10 ***</span>
<span class="line-new-header">--- 32,13 ---</span>
   * Micros for the various collections implemented in
   * java.util.ImmutableCollections
   */
  @State(Scope.Benchmark)
  @OutputTimeUnit(TimeUnit.MICROSECONDS)
<span class="line-added">+ @Fork(value = 3)</span>
<span class="line-added">+ @Warmup(iterations = 5, time = 1, timeUnit = TimeUnit.SECONDS)</span>
<span class="line-added">+ @Measurement(iterations = 5, time = 2, timeUnit = TimeUnit.SECONDS)</span>
  public class ImmutableColls {
  
      public static String[] STRINGS = {&quot;hi&quot;, &quot;all&quot;, &quot;of&quot;, &quot;you&quot;};
  
      public static List&lt;String&gt; l0 = List.of();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 89,15 ***</span>
      public static final Map&lt;String, String&gt; fm1 = Map.copyOf(m1);
      public static final Map&lt;String, String&gt; fm2 = Map.copyOf(m2);
      public static final Map&lt;String, String&gt; fm3 = Map.copyOf(m3);
      public static final Map&lt;String, String&gt; fm4 = Map.copyOf(m4);
  
<span class="line-modified">!     public static final List&lt;String&gt; fa0 = new ArrayList&lt;&gt;(l0);</span>
<span class="line-modified">!     public static final List&lt;String&gt; fa1 = new ArrayList&lt;&gt;(l1);</span>
<span class="line-modified">!     public static final List&lt;String&gt; fa2 = new ArrayList&lt;&gt;(l2);</span>
<span class="line-modified">!     public static final List&lt;String&gt; fa3 = new ArrayList&lt;&gt;(l3);</span>
<span class="line-modified">!     public static final List&lt;String&gt; fa4 = new ArrayList&lt;&gt;(l4);</span>
  
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
      public int sumSizesList() {
          return sizeOf(l0) +
<span class="line-new-header">--- 92,25 ---</span>
      public static final Map&lt;String, String&gt; fm1 = Map.copyOf(m1);
      public static final Map&lt;String, String&gt; fm2 = Map.copyOf(m2);
      public static final Map&lt;String, String&gt; fm3 = Map.copyOf(m3);
      public static final Map&lt;String, String&gt; fm4 = Map.copyOf(m4);
  
<span class="line-modified">!     @Benchmark</span>
<span class="line-modified">!     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-modified">!     public void constructLists(Blackhole bh) {</span>
<span class="line-modified">!         bh.consume(List.of(STRINGS[0]));</span>
<span class="line-modified">!         bh.consume(List.of(STRINGS[0], STRINGS[1]));</span>
<span class="line-added">+         bh.consume(List.of(STRINGS[0], STRINGS[1], STRINGS[2]));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Benchmark</span>
<span class="line-added">+     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public void constructSets(Blackhole bh) {</span>
<span class="line-added">+         bh.consume(Set.of(STRINGS[0]));</span>
<span class="line-added">+         bh.consume(Set.of(STRINGS[0], STRINGS[1]));</span>
<span class="line-added">+         bh.consume(Set.of(STRINGS[0], STRINGS[1], STRINGS[2]));</span>
<span class="line-added">+     }</span>
  
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
      public int sumSizesList() {
          return sizeOf(l0) +
</pre>
<hr />
<pre>
<span class="line-old-header">*** 107,46 ***</span>
                  sizeOf(l4);
      }
  
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
<span class="line-modified">!     public int finalSumSizesList() {</span>
          return sizeOf(fl0) +
                  sizeOf(fl1) +
                  sizeOf(fl2) +
                  sizeOf(fl3) +
                  sizeOf(fl4);
      }
  
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
<span class="line-modified">!     public int sumSizesArrayList() {</span>
<span class="line-modified">!         return sizeOf2(a0) +</span>
<span class="line-modified">!                 sizeOf2(a1) +</span>
<span class="line-modified">!                 sizeOf2(a2) +</span>
<span class="line-modified">!                 sizeOf2(a3) +</span>
<span class="line-modified">!                 sizeOf2(a4);</span>
      }
  
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
<span class="line-modified">!     public int finalSumSizesArrayList() {</span>
<span class="line-modified">!         return sizeOf2(fa0) +</span>
<span class="line-modified">!                 sizeOf2(fa1) +</span>
<span class="line-modified">!                 sizeOf2(fa2) +</span>
<span class="line-modified">!                 sizeOf2(fa3) +</span>
<span class="line-modified">!                 sizeOf2(fa4);</span>
      }
  
<span class="line-modified">!     public int sizeOf2(List&lt;String&gt; list) {</span>
<span class="line-modified">!         return list.size();</span>
      }
  
      public int sizeOf(List&lt;String&gt; list) {
          return list.size();
      }
  
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
      public int getFromList() {
          return get(l1, 0).length() +
                  get(l2, 1).length() +
<span class="line-new-header">--- 120,141 ---</span>
                  sizeOf(l4);
      }
  
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
<span class="line-modified">!     public int sumSizesFinalList() {</span>
          return sizeOf(fl0) +
                  sizeOf(fl1) +
                  sizeOf(fl2) +
                  sizeOf(fl3) +
                  sizeOf(fl4);
      }
  
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
<span class="line-modified">!     public int sumSizesSet() {</span>
<span class="line-modified">!         return sizeOf(s0) +</span>
<span class="line-modified">!                 sizeOf(s1) +</span>
<span class="line-modified">!                 sizeOf(s2) +</span>
<span class="line-modified">!                 sizeOf(s3) +</span>
<span class="line-modified">!                 sizeOf(s4);</span>
      }
  
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
<span class="line-modified">!     public int sumSizesFinalSet() {</span>
<span class="line-modified">!         return sizeOf2(fs0) +</span>
<span class="line-modified">!                 sizeOf2(fs1) +</span>
<span class="line-modified">!                 sizeOf2(fs2) +</span>
<span class="line-modified">!                 sizeOf2(fs3) +</span>
<span class="line-modified">!                 sizeOf2(fs4);</span>
      }
  
<span class="line-modified">!     @Benchmark</span>
<span class="line-modified">!     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public boolean emptyFinalSet() {</span>
<span class="line-added">+         return fs0.isEmpty() &amp;</span>
<span class="line-added">+                 fs1.isEmpty() &amp;</span>
<span class="line-added">+                 fs2.isEmpty() &amp;</span>
<span class="line-added">+                 fs3.isEmpty() &amp;</span>
<span class="line-added">+                 fs4.isEmpty();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Benchmark</span>
<span class="line-added">+     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public boolean emptyFinalList() {</span>
<span class="line-added">+         return fl0.isEmpty() &amp;</span>
<span class="line-added">+                 fl1.isEmpty() &amp;</span>
<span class="line-added">+                 fl2.isEmpty() &amp;</span>
<span class="line-added">+                 fl3.isEmpty() &amp;</span>
<span class="line-added">+                 fl4.isEmpty();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Benchmark</span>
<span class="line-added">+     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public boolean emptyFinalMap() {</span>
<span class="line-added">+         return fm0.isEmpty() &amp;</span>
<span class="line-added">+                 fm1.isEmpty() &amp;</span>
<span class="line-added">+                 fm2.isEmpty() &amp;</span>
<span class="line-added">+                 fm3.isEmpty() &amp;</span>
<span class="line-added">+                 fm4.isEmpty();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Benchmark</span>
<span class="line-added">+     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public boolean containsFinalSet() {</span>
<span class="line-added">+         return fs0.contains(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fs1.contains(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fs2.contains(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fs3.contains(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fs4.contains(&quot;hi&quot;);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Benchmark</span>
<span class="line-added">+     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public boolean containsFinalList() {</span>
<span class="line-added">+         return fl0.contains(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fl1.contains(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fl2.contains(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fl3.contains(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fl4.contains(&quot;hi&quot;);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Benchmark</span>
<span class="line-added">+     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public boolean containsKeyFinalMap() {</span>
<span class="line-added">+         return fm0.containsKey(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fm1.containsKey(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fm2.containsKey(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fm3.containsKey(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fm4.containsKey(&quot;hi&quot;);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Benchmark</span>
<span class="line-added">+     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public boolean containsValueFinalMap() {</span>
<span class="line-added">+         return fm0.containsValue(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fm1.containsValue(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fm2.containsValue(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fm3.containsValue(&quot;hi&quot;) &amp;</span>
<span class="line-added">+                 fm4.containsValue(&quot;hi&quot;);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @Benchmark</span>
<span class="line-added">+     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public void getOrDefault(Blackhole bh) {</span>
<span class="line-added">+         bh.consume(fm4.getOrDefault(&quot;hi&quot;, &quot;test&quot;));</span>
<span class="line-added">+         bh.consume(fm4.getOrDefault(&quot;not_in_this_map&quot;, &quot;test&quot;));</span>
      }
  
      public int sizeOf(List&lt;String&gt; list) {
          return list.size();
      }
  
<span class="line-added">+     /**</span>
<span class="line-added">+      * Same as sizeOf(List), but duplicated to avoid any</span>
<span class="line-added">+      * potential profile pollution with tests using</span>
<span class="line-added">+      * sizeOf.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public int sizeOf2(List&lt;String&gt; list) {</span>
<span class="line-added">+         return list.size();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public int sizeOf(Set&lt;String&gt; set) {</span>
<span class="line-added">+         return set.size();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Same as sizeOf(Set), but duplicated to avoid any</span>
<span class="line-added">+      * potential profile pollution with tests using</span>
<span class="line-added">+      * sizeOf.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public int sizeOf2(Set&lt;String&gt; set) {</span>
<span class="line-added">+         return set.size();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
      public int getFromList() {
          return get(l1, 0).length() +
                  get(l2, 1).length() +
</pre>
<hr />
<pre>
<span class="line-old-header">*** 171,10 ***</span>
<span class="line-new-header">--- 279,26 ---</span>
          bh.consume(s3.toArray());
          bh.consume(fs2.toArray());
          bh.consume(s0.toArray());
      }
  
<span class="line-added">+     @Benchmark</span>
<span class="line-added">+     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-added">+     public void iterateOverSet(Blackhole bh) {</span>
<span class="line-added">+         iterateSet(bh, fs4);</span>
<span class="line-added">+         iterateSet(bh, s1);</span>
<span class="line-added">+         iterateSet(bh, s3);</span>
<span class="line-added">+         iterateSet(bh, fs2);</span>
<span class="line-added">+         iterateSet(bh, s0);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public void iterateSet(Blackhole bh, Set&lt;String&gt; coll) {</span>
<span class="line-added">+         for (String s : coll) {</span>
<span class="line-added">+             bh.consume(s);</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      @Benchmark
      @CompilerControl(CompilerControl.Mode.DONT_INLINE)
      public void toArrayFromMap(Blackhole bh) {
          bh.consume(fm4.entrySet().toArray());
          bh.consume(m1.entrySet().toArray());
</pre>
<hr />
<pre>
<span class="line-old-header">*** 230,19 ***</span>
          bh.consume(List.copyOf(fl4));
          bh.consume(List.copyOf(fsl2));
          bh.consume(List.copyOf(fsl3));
      }
  
<span class="line-removed">-     @Benchmark</span>
<span class="line-removed">-     @CompilerControl(CompilerControl.Mode.DONT_INLINE)</span>
<span class="line-removed">-     public int finalGetFromArrayList() {</span>
<span class="line-removed">-         return get2(fa1, 0).length() +</span>
<span class="line-removed">-                 get2(fa2, 1).length() +</span>
<span class="line-removed">-                 get2(fa3, 2).length() +</span>
<span class="line-removed">-                 get2(fa4, 3).length();</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      public String get2(List&lt;String&gt; list, int idx) {
          return list.get(idx);
      }
  
      public String get(List&lt;String&gt; list, int idx) {
<span class="line-new-header">--- 354,10 ---</span>
</pre>
<center><a href="HashMapBench.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="RandomNext.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>