<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff test/jtreg-ext/requires/VMProps.java</title>
    <link rel="stylesheet" href="../../../style.css" />
  </head>
<body>
<center><a href="../../jdk/tools/launcher/modules/basic/BasicTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="../../langtools/ProblemList.txt.cdiff.html" target="_top">next &gt;</a></center>    <h2>test/jtreg-ext/requires/VMProps.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 44,10 ***</span>
<span class="line-new-header">--- 44,11 ---</span>
  import sun.hotspot.code.Compiler;
  import sun.hotspot.cpuinfo.CPUInfo;
  import sun.hotspot.gc.GC;
  import sun.hotspot.WhiteBox;
  import jdk.test.lib.Platform;
<span class="line-added">+ import jdk.test.lib.Container;</span>
  
  /**
   * The Class to be invoked by jtreg prior Test Suite execution to
   * collect information about VM.
   * Do not use any APIs that may not be available in all target VMs.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 232,11 ***</span>
      /**
       * @return true if VM supports JVMCI and false otherwise
       */
      protected String vmJvmci() {
          // builds with jvmci have this flag
<span class="line-modified">!         return &quot;&quot; + (WB.getBooleanVMFlag(&quot;EnableJVMCI&quot;) != null);</span>
      }
  
      /**
       * @return true if VM runs in emulated-client mode and false otherwise.
       */
<span class="line-new-header">--- 233,26 ---</span>
      /**
       * @return true if VM supports JVMCI and false otherwise
       */
      protected String vmJvmci() {
          // builds with jvmci have this flag
<span class="line-modified">!         if (WB.getBooleanVMFlag(&quot;EnableJVMCI&quot;) == null) {</span>
<span class="line-added">+             return &quot;false&quot;;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         switch (GC.selected()) {</span>
<span class="line-added">+             case Serial:</span>
<span class="line-added">+             case Parallel:</span>
<span class="line-added">+             case G1:</span>
<span class="line-added">+                 // These GCs are supported with JVMCI</span>
<span class="line-added">+                 return &quot;true&quot;;</span>
<span class="line-added">+             default:</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Every other GC is not supported</span>
<span class="line-added">+         return &quot;false&quot;;</span>
      }
  
      /**
       * @return true if VM runs in emulated-client mode and false otherwise.
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 287,10 ***</span>
<span class="line-new-header">--- 303,11 ---</span>
       *
       * @param map - property-value pairs
       */
      protected void vmOptFinalFlags(SafeMap map) {
          vmOptFinalFlag(map, &quot;ClassUnloading&quot;);
<span class="line-added">+         vmOptFinalFlag(map, &quot;ClassUnloadingWithConcurrentMark&quot;);</span>
          vmOptFinalFlag(map, &quot;UseCompressedOops&quot;);
          vmOptFinalFlag(map, &quot;EnableJVMCI&quot;);
          vmOptFinalFlag(map, &quot;EliminateAllocations&quot;);
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 353,11 ***</span>
          if (Platform.isWindows()) {
              jaotc = bin.resolve(&quot;jaotc.exe&quot;);
          } else {
              jaotc = bin.resolve(&quot;jaotc&quot;);
          }
<span class="line-modified">!         return &quot;&quot; + Files.exists(jaotc);</span>
      }
  
      /*
       * @return true if there is at least one loaded AOT&#39;ed library.
       */
<span class="line-new-header">--- 370,28 ---</span>
          if (Platform.isWindows()) {
              jaotc = bin.resolve(&quot;jaotc.exe&quot;);
          } else {
              jaotc = bin.resolve(&quot;jaotc&quot;);
          }
<span class="line-modified">! </span>
<span class="line-added">+         if (!Files.exists(jaotc)) {</span>
<span class="line-added">+             // No jaotc =&gt; no AOT</span>
<span class="line-added">+             return &quot;false&quot;;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         switch (GC.selected()) {</span>
<span class="line-added">+             case Serial:</span>
<span class="line-added">+             case Parallel:</span>
<span class="line-added">+             case G1:</span>
<span class="line-added">+                 // These GCs are supported with AOT</span>
<span class="line-added">+                 return &quot;true&quot;;</span>
<span class="line-added">+             default:</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Every other GC is not supported</span>
<span class="line-added">+         return &quot;false&quot;;</span>
      }
  
      /*
       * @return true if there is at least one loaded AOT&#39;ed library.
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 453,11 ***</span>
  
          return &quot;&quot; + isSupported;
      }
  
      private boolean checkDockerSupport() throws IOException, InterruptedException {
<span class="line-modified">!         ProcessBuilder pb = new ProcessBuilder(&quot;docker&quot;, &quot;ps&quot;);</span>
          Process p = pb.start();
          p.waitFor(10, TimeUnit.SECONDS);
  
          return (p.exitValue() == 0);
      }
<span class="line-new-header">--- 487,11 ---</span>
  
          return &quot;&quot; + isSupported;
      }
  
      private boolean checkDockerSupport() throws IOException, InterruptedException {
<span class="line-modified">!         ProcessBuilder pb = new ProcessBuilder(Container.ENGINE_COMMAND, &quot;ps&quot;);</span>
          Process p = pb.start();
          p.waitFor(10, TimeUnit.SECONDS);
  
          return (p.exitValue() == 0);
      }
</pre>
<center><a href="../../jdk/tools/launcher/modules/basic/BasicTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../index.html" target="_top">index</a> <a href="../../langtools/ProblemList.txt.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>