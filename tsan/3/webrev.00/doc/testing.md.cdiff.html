<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff doc/testing.md</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="testing.html.cdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../make/Bundles.gmk.cdiff.html" target="_top">next &gt;</a></center>    <h2>doc/testing.md</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 10,23 ***</span>
  The main target `test` uses the jdk-image as the tested product. There is
  also an alternate target `exploded-test` that uses the exploded image
  instead. Not all tests will run successfully on the exploded image, but using
  this target can greatly improve rebuild times for certain workflows.
  
<span class="line-modified">! Previously, `make test` was used invoke an old system for running test, and</span>
  `make run-test` was used for the new test framework. For backward compatibility
  with scripts and muscle memory, `run-test` (and variants like
<span class="line-modified">! `exploded-run-test` or `run-test-tier1`) are kept as aliases. The old system</span>
<span class="line-removed">- can still be accessed for some time using `cd test &amp;&amp; make`.</span>
  
  Some example command-lines:
  
      $ make test-tier1
      $ make test-jdk_lang JTREG=&quot;JOBS=8&quot;
      $ make test TEST=jdk_lang
      $ make test-only TEST=&quot;gtest:LogTagSet gtest:LogTagSetDescriptions&quot; GTEST=&quot;REPEAT=-1&quot;
<span class="line-modified">!     $ make test TEST=&quot;hotspot:hotspot_gc&quot; JTREG=&quot;JOBS=1;TIMEOUT=8;VM_OPTIONS=-XshowSettings -Xlog:gc+ref=debug&quot;</span>
      $ make test TEST=&quot;jtreg:test/hotspot:hotspot_gc test/hotspot/jtreg/native_sanity/JniVersion.java&quot;
      $ make test TEST=&quot;micro:java.lang.reflect&quot; MICRO=&quot;FORK=1;WARMUP_ITER=2&quot;
      $ make exploded-test TEST=tier2
  
  ### Configuration
<span class="line-new-header">--- 10,22 ---</span>
  The main target `test` uses the jdk-image as the tested product. There is
  also an alternate target `exploded-test` that uses the exploded image
  instead. Not all tests will run successfully on the exploded image, but using
  this target can greatly improve rebuild times for certain workflows.
  
<span class="line-modified">! Previously, `make test` was used to invoke an old system for running tests, and</span>
  `make run-test` was used for the new test framework. For backward compatibility
  with scripts and muscle memory, `run-test` (and variants like
<span class="line-modified">! `exploded-run-test` or `run-test-tier1`) are kept as aliases.</span>
  
  Some example command-lines:
  
      $ make test-tier1
      $ make test-jdk_lang JTREG=&quot;JOBS=8&quot;
      $ make test TEST=jdk_lang
      $ make test-only TEST=&quot;gtest:LogTagSet gtest:LogTagSetDescriptions&quot; GTEST=&quot;REPEAT=-1&quot;
<span class="line-modified">!     $ make test TEST=&quot;hotspot:hotspot_gc&quot; JTREG=&quot;JOBS=1;TIMEOUT_FACTOR=8;VM_OPTIONS=-XshowSettings -Xlog:gc+ref=debug&quot;</span>
      $ make test TEST=&quot;jtreg:test/hotspot:hotspot_gc test/hotspot/jtreg/native_sanity/JniVersion.java&quot;
      $ make test TEST=&quot;micro:java.lang.reflect&quot; MICRO=&quot;FORK=1;WARMUP_ITER=2&quot;
      $ make exploded-test TEST=tier2
  
  ### Configuration
</pre>
<hr />
<pre>
<span class="line-old-header">*** 179,23 ***</span>
  
  It is possible to control various aspects of the test suites using make control
  variables.
  
  These variables use a keyword=value approach to allow multiple values to be
<span class="line-modified">! set. So, for instance, `JTREG=&quot;JOBS=1;TIMEOUT=8&quot;` will set the JTReg</span>
  concurrency level to 1 and the timeout factor to 8. This is equivalent to
<span class="line-modified">! setting `JTREG_JOBS=1 JTREG_TIMEOUT=8`, but using the keyword format means that</span>
  the `JTREG` variable is parsed and verified for correctness, so
<span class="line-modified">! `JTREG=&quot;TMIEOUT=8&quot;` would give an error, while `JTREG_TMIEOUT=8` would just</span>
  pass unnoticed.
  
  To separate multiple keyword=value pairs, use `;` (semicolon). Since the shell
  normally eats `;`, the recommended usage is to write the assignment inside
  qoutes, e.g. `JTREG=&quot;...;...&quot;`. This will also make sure spaces are preserved,
  as in `JTREG=&quot;VM_OPTIONS=-XshowSettings -Xlog:gc+ref=debug&quot;`.
  
<span class="line-modified">! (Other ways are possible, e.g. using backslash: `JTREG=JOBS=1\;TIMEOUT=8`.</span>
  Also, as a special technique, the string `%20` will be replaced with space for
  certain options, e.g. `JTREG=VM_OPTIONS=-XshowSettings%20-Xlog:gc+ref=debug`.
  This can be useful if you have layers of scripts and have trouble getting
  proper quoting of command line arguments through.)
  
<span class="line-new-header">--- 178,23 ---</span>
  
  It is possible to control various aspects of the test suites using make control
  variables.
  
  These variables use a keyword=value approach to allow multiple values to be
<span class="line-modified">! set. So, for instance, `JTREG=&quot;JOBS=1;TIMEOUT_FACTOR=8&quot;` will set the JTReg</span>
  concurrency level to 1 and the timeout factor to 8. This is equivalent to
<span class="line-modified">! setting `JTREG_JOBS=1 JTREG_TIMEOUT_FACTOR=8`, but using the keyword format means that</span>
  the `JTREG` variable is parsed and verified for correctness, so
<span class="line-modified">! `JTREG=&quot;TMIEOUT_FACTOR=8&quot;` would give an error, while `JTREG_TMIEOUT_FACTOR=8` would just</span>
  pass unnoticed.
  
  To separate multiple keyword=value pairs, use `;` (semicolon). Since the shell
  normally eats `;`, the recommended usage is to write the assignment inside
  qoutes, e.g. `JTREG=&quot;...;...&quot;`. This will also make sure spaces are preserved,
  as in `JTREG=&quot;VM_OPTIONS=-XshowSettings -Xlog:gc+ref=debug&quot;`.
  
<span class="line-modified">! (Other ways are possible, e.g. using backslash: `JTREG=JOBS=1\;TIMEOUT_FACTOR=8`.</span>
  Also, as a special technique, the string `%20` will be replaced with space for
  certain options, e.g. `JTREG=VM_OPTIONS=-XshowSettings%20-Xlog:gc+ref=debug`.
  This can be useful if you have layers of scripts and have trouble getting
  proper quoting of command line arguments through.)
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 260,13 ***</span>
  The timeout factor (`-timeoutFactor`).
  
  Defaults to 4.
  
  #### TEST_MODE
<span class="line-modified">! The test mode (`-agentvm`, `-samevm` or `-othervm`).</span>
  
<span class="line-modified">! Defaults to `-agentvm`.</span>
  
  #### ASSERT
  Enable asserts (`-ea -esa`, or none).
  
  Set to `true` or `false`. If true, adds `-ea -esa`. Defaults to true, except
<span class="line-new-header">--- 259,13 ---</span>
  The timeout factor (`-timeoutFactor`).
  
  Defaults to 4.
  
  #### TEST_MODE
<span class="line-modified">! The test mode (`agentvm` or `othervm`).</span>
  
<span class="line-modified">! Defaults to `agentvm`.</span>
  
  #### ASSERT
  Enable asserts (`-ea -esa`, or none).
  
  Set to `true` or `false`. If true, adds `-ea -esa`. Defaults to true, except
</pre>
<hr />
<pre>
<span class="line-old-header">*** 305,10 ***</span>
<span class="line-new-header">--- 304,18 ---</span>
  help avoid quoting issues, the special value `%20`).
  
  The file names should be either absolute, or relative to the JTReg test root of
  the tests to be run.
  
<span class="line-added">+ #### RUN_PROBLEM_LISTS</span>
<span class="line-added">+ </span>
<span class="line-added">+ Use the problem lists to select tests instead of excluding them.</span>
<span class="line-added">+ </span>
<span class="line-added">+ Set to `true` or `false`.</span>
<span class="line-added">+ If `true`, JTReg will use `-match:` option, otherwise `-exclude:` will be used.</span>
<span class="line-added">+ Default is `false`.</span>
<span class="line-added">+ </span>
  
  #### OPTIONS
  Additional options to the JTReg test framework.
  
  Use `JTREG=&quot;OPTIONS=--help all&quot;` to see all available JTReg options.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 323,10 ***</span>
<span class="line-new-header">--- 330,14 ---</span>
  
  Generate AOT modules before testing for the specified module, or set of
  modules. If multiple modules are specified, they should be separated by space
  (or, to help avoid quoting issues, the special value `%20`).
  
<span class="line-added">+ #### RETRY_COUNT</span>
<span class="line-added">+ </span>
<span class="line-added">+ Retry failed tests up to a set number of times. Defaults to 0.</span>
<span class="line-added">+ </span>
  ### Gtest keywords
  
  #### REPEAT
  The number of times to repeat the tests (`--gtest_repeat`).
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 372,10 ***</span>
<span class="line-new-header">--- 383,79 ---</span>
  Additional VM arguments to provide to forked off VMs. Same as `-jvmArgs &lt;args&gt;`
  
  #### OPTIONS
  Additional arguments to send to JMH.
  
<span class="line-added">+ ## Notes for Specific Tests</span>
<span class="line-added">+ </span>
<span class="line-added">+ ### Docker Tests</span>
<span class="line-added">+ </span>
<span class="line-added">+ Docker tests with default parameters may fail on systems with glibc versions not</span>
<span class="line-added">+ compatible with the one used in the default docker image (e.g., Oracle Linux 7.6 for x86).</span>
<span class="line-added">+ For example, they pass on Ubuntu 16.04 but fail on Ubuntu 18.04 if run like this on x86:</span>
<span class="line-added">+ </span>
<span class="line-added">+     $ make test TEST=&quot;jtreg:test/hotspot/jtreg/containers/docker&quot;</span>
<span class="line-added">+ </span>
<span class="line-added">+ To run these tests correctly, additional parameters for the correct docker image are</span>
<span class="line-added">+ required on Ubuntu 18.04 by using `JAVA_OPTIONS`.</span>
<span class="line-added">+ </span>
<span class="line-added">+     $ make test TEST=&quot;jtreg:test/hotspot/jtreg/containers/docker&quot; JTREG=&quot;JAVA_OPTIONS=-Djdk.test.docker.image.name=ubuntu -Djdk.test.docker.image.version=latest&quot;</span>
<span class="line-added">+ </span>
<span class="line-added">+ ### Non-US locale</span>
<span class="line-added">+ </span>
<span class="line-added">+ If your locale is non-US, some tests are likely to fail. To work around this you can</span>
<span class="line-added">+ set the locale to US. On Unix platforms simply setting `LANG=&quot;en_US&quot;` in the</span>
<span class="line-added">+ environment before running tests should work. On Windows, setting</span>
<span class="line-added">+ `JTREG=&quot;VM_OPTIONS=-Duser.language=en -Duser.country=US&quot;` helps for most, but not all test cases.</span>
<span class="line-added">+ For example:</span>
<span class="line-added">+ </span>
<span class="line-added">+     $ export LANG=&quot;en_US&quot; &amp;&amp; make test TEST=...</span>
<span class="line-added">+     $ make test JTREG=&quot;VM_OPTIONS=-Duser.language=en -Duser.country=US&quot; TEST=...</span>
<span class="line-added">+ </span>
<span class="line-added">+ ### PKCS11 Tests</span>
<span class="line-added">+ </span>
<span class="line-added">+ It is highly recommended to use the latest NSS version when running PKCS11 tests.</span>
<span class="line-added">+ Improper NSS version may lead to unexpected failures which are hard to diagnose.</span>
<span class="line-added">+ For example, sun/security/pkcs11/Secmod/AddTrustedCert.java may fail on Ubuntu</span>
<span class="line-added">+ 18.04 with the default NSS version in the system.</span>
<span class="line-added">+ To run these tests correctly, the system property `test.nss.lib.paths` is required</span>
<span class="line-added">+ on Ubuntu 18.04 to specify the alternative NSS lib directories.</span>
<span class="line-added">+ For example:</span>
<span class="line-added">+ </span>
<span class="line-added">+     $ make test TEST=&quot;jtreg:sun/security/pkcs11/Secmod/AddTrustedCert.java&quot; JTREG=&quot;JAVA_OPTIONS=-Dtest.nss.lib.paths=/path/to/your/latest/NSS-libs&quot;</span>
<span class="line-added">+ </span>
<span class="line-added">+ For more notes about the PKCS11 tests, please refer to test/jdk/sun/security/pkcs11/README.</span>
<span class="line-added">+ </span>
<span class="line-added">+ ### Client UI Tests</span>
<span class="line-added">+ </span>
<span class="line-added">+ Some Client UI tests use key sequences which may be reserved by the operating</span>
<span class="line-added">+ system. Usually that causes the test failure. So it is highly recommended to disable</span>
<span class="line-added">+ system key shortcuts prior testing. The steps to access and disable system key shortcuts</span>
<span class="line-added">+ for various platforms are provided below.</span>
<span class="line-added">+ </span>
<span class="line-added">+ #### MacOS</span>
<span class="line-added">+ Choose Apple menu; System Preferences, click Keyboard, then click Shortcuts;</span>
<span class="line-added">+ select or deselect desired shortcut.</span>
<span class="line-added">+ </span>
<span class="line-added">+ For example, test/jdk/javax/swing/TooltipManager/JMenuItemToolTipKeyBindingsTest/JMenuItemToolTipKeyBindingsTest.java fails</span>
<span class="line-added">+ on MacOS because it uses `CTRL + F1` key sequence to show or hide tooltip message</span>
<span class="line-added">+ but the key combination is reserved by the operating system. To run the test correctly</span>
<span class="line-added">+ the default global key shortcut should be disabled using the steps described above, and then deselect</span>
<span class="line-added">+ &quot;Turn keyboard access on or off&quot; option which is responsible for `CTRL + F1` combination.</span>
<span class="line-added">+ </span>
<span class="line-added">+ #### Linux</span>
<span class="line-added">+ Open the Activities overview and start typing Settings; Choose Settings, click Devices,</span>
<span class="line-added">+ then click Keyboard; set or override desired shortcut.</span>
<span class="line-added">+ </span>
<span class="line-added">+ #### Windows</span>
<span class="line-added">+ Type `gpedit` in the Search and then click Edit group policy; navigate to</span>
<span class="line-added">+ User Configuration -&gt; Administrative Templates -&gt; Windows Components -&gt; File Explorer;</span>
<span class="line-added">+ in the right-side pane look for &quot;Turn off Windows key hotkeys&quot; and double click on it;</span>
<span class="line-added">+ enable or disable hotkeys.</span>
<span class="line-added">+ </span>
<span class="line-added">+ Note: restart is required to make the settings take effect.</span>
<span class="line-added">+ </span>
  ---
  # Override some definitions in the global css file that are not optimal for
  # this document.
  header-includes:
   - &#39;&lt;style type=&quot;text/css&quot;&gt;pre, code, tt { color: #1d6ae5; }&lt;/style&gt;&#39;
</pre>
<center><a href="testing.html.cdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="../make/Bundles.gmk.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>