<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/Docs.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="CreateJmods.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="ExplodedImageOptimize.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/Docs.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 15 #
 16 # You should have received a copy of the GNU General Public License version
 17 # 2 along with this work; if not, write to the Free Software Foundation,
 18 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19 #
 20 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21 # or visit www.oracle.com if you need additional information or have any
 22 # questions.
 23 #
 24 
 25 default: all
 26 
 27 include $(SPEC)
 28 include MakeBase.gmk
 29 include Execute.gmk
 30 include Modules.gmk
 31 include ModuleTools.gmk
 32 include ProcessMarkdown.gmk
 33 include ToolsJdk.gmk
 34 include ZipArchive.gmk

 35 
 36 # This is needed to properly setup DOCS_MODULES.
 37 $(eval $(call ReadImportMetaData))
 38 
 39 ################################################################################
 40 # Hook to include the corresponding custom file, if present.
 41 $(eval $(call IncludeCustomExtension, Docs.gmk))
 42 
 43 ################################################################################
 44 # This file generates all documentation for OpenJDK.
 45 #
 46 # We will generate API documentation for two different selections of the source
 47 # code: &quot;Java SE&quot;, which contains just the modules covered by the top-level
 48 # module java.se and &quot;JDK&quot;, which covers all of Java SE and also all
 49 # other available modules that should be documented, including imported modules,
 50 # if any.
 51 #
 52 # We will also generate separate, free-standing specifications from either
 53 # markdown or existing html files.
 54 #
 55 
 56 ################################################################################
 57 # Javadoc settings
 58 
 59 # On top of the sources that was used to compile the JDK, we need some
 60 # extra java.rmi sources that are used just for javadoc.
 61 MODULES_SOURCE_PATH := $(call PathList, $(call GetModuleSrcPath) \
 62     $(SUPPORT_OUTPUTDIR)/rmic/* $(TOPDIR)/src/*/share/doc/stub)
 63 
 64 # URLs
 65 JAVADOC_BASE_URL := https://docs.oracle.com/pls/topic/lookup?ctx=javase$(VERSION_NUMBER)&amp;amp;id=homepage
 66 BUG_SUBMIT_URL := https://bugreport.java.com/bugreport/
<span class="line-modified"> 67 COPYRIGHT_URL := {@docroot}/../legal/copyright.html</span>
 68 LICENSE_URL := https://www.oracle.com/technetwork/java/javase/terms/license/java$(VERSION_NUMBER)speclicense.html
 69 REDISTRIBUTION_URL := https://www.oracle.com/technetwork/java/redist-137594.html
 70 
 71 # In order to get a specific ordering it&#39;s necessary to specify the total
 72 # ordering of tags as the tags are otherwise ordered in order of definition.
 73 JAVADOC_TAGS := \
 74     -tag beaninfo:X \
 75     -tag revised:X \
 76     -tag since.unbundled:X \
 77     -tag spec:X \
 78     -tag specdefault:X \
 79     -tag Note:X \
 80     -tag ToDo:X \
 81     -tag &#39;apiNote:a:API Note:&#39; \
 82     -tag &#39;implSpec:a:Implementation Requirements:&#39; \
 83     -tag &#39;implNote:a:Implementation Note:&#39; \
 84     -tag param \
 85     -tag return \
 86     -tag throws \


 87     -taglet build.tools.taglet.ModuleGraph \

 88     -tag since \
 89     -tag serialData \
 90     -tag factory \
 91     -tag see \
<span class="line-removed"> 92     -tag &#39;jvms:a:See &lt;cite&gt;The Java&amp;trade; Virtual Machine Specification&lt;/cite&gt;:&#39; \</span>
<span class="line-removed"> 93     -tag &#39;jls:a:See &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;:&#39; \</span>
 94     -taglet build.tools.taglet.ExtLink \
 95     -taglet build.tools.taglet.Incubating \

 96     -tagletpath $(BUILDTOOLS_OUTPUTDIR)/jdk_tools_classes \
 97     $(CUSTOM_JAVADOC_TAGS) \
 98     #
 99 
100 # The reference tags must stay stable to allow for comparisons across the
101 # development cycle. If JAVADOC_TAGS needs to change, make sure that
102 # REFERENCE_TAGS remains unchanged, by copying and hardcoding, if necessary.
103 REFERENCE_TAGS := $(JAVADOC_TAGS)
104 
105 # Which doclint checks to ignore
106 JAVADOC_DISABLED_DOCLINT := accessibility html missing syntax reference
107 
108 # The initial set of options for javadoc
109 JAVADOC_OPTIONS := -use -keywords -notimestamp \
110     -serialwarn -encoding ISO-8859-1 -docencoding UTF-8 -breakiterator \
111     -splitIndex --system none -javafx --expand-requires transitive \
112     --override-methods=summary
113 
114 # The reference options must stay stable to allow for comparisons across the
115 # development cycle.
</pre>
<hr />
<pre>
118     -html5 -javafx --expand-requires transitive
119 
120 # Should we add DRAFT stamps to the generated javadoc?
121 ifeq ($(VERSION_IS_GA), true)
122   IS_DRAFT := false
123 else
124   IS_DRAFT := true
125 endif
126 
127 ################################################################################
128 # General text snippets
129 
130 FULL_COMPANY_NAME := Oracle and/or its affiliates
131 COMPANY_ADDRESS := 500 Oracle Parkway, Redwood Shores, CA 94065 USA
132 
133 JAVA_PLATFORM := Java Platform
134 
135 ifeq ($(IS_DRAFT), true)
136   DRAFT_MARKER_STR := &lt;br&gt;&lt;strong&gt;DRAFT $(VERSION_STRING)&lt;/strong&gt;
137   ifeq ($(VERSION_BUILD), 0)
<span class="line-modified">138     DRAFT_MARKER_TITLE := [ad-hoc build]</span>
139   else
<span class="line-modified">140     DRAFT_MARKER_TITLE := [build $(VERSION_BUILD)]</span>
141   endif
142   DRAFT_TEXT := This specification is not final and is subject to change. \
143       Use is subject to &lt;a href=&quot;$(LICENSE_URL)&quot;&gt;license terms&lt;/a&gt;.
144 
145   # Workaround stylesheet bug
146   HEADER_STYLE := style=&quot;margin-top: 9px;&quot;
147 else
148   HEADER_STYLE := style=&quot;margin-top: 14px;&quot;
149 endif
150 









151 JAVADOC_BOTTOM := \
152     &lt;a href=&quot;$(BUG_SUBMIT_URL)&quot;&gt;Report a bug or suggest an enhancement&lt;/a&gt;&lt;br&gt; \
153     For further API reference and developer documentation see the \
154     &lt;a href=&quot;$(JAVADOC_BASE_URL)&quot; target=&quot;_blank&quot;&gt;Java SE \
155     Documentation&lt;/a&gt;, which contains more detailed, \
156     developer-targeted descriptions with conceptual overviews, definitions \
157     of terms, workarounds, and working code examples.&lt;br&gt; \
158     Java is a trademark or registered trademark of $(FULL_COMPANY_NAME) in \
159     the US and other countries.&lt;br&gt; \
<span class="line-modified">160     &lt;a href=&quot;$(COPYRIGHT_URL)&quot;&gt;Copyright&lt;/a&gt; \</span>
<span class="line-removed">161     &amp;copy; 1993, $(COPYRIGHT_YEAR), $(FULL_COMPANY_NAME), \</span>
<span class="line-removed">162     $(COMPANY_ADDRESS).&lt;br&gt;All rights reserved. \</span>
<span class="line-removed">163     Use is subject to &lt;a href=&quot;$(LICENSE_URL)&quot;&gt;license terms&lt;/a&gt; and the \</span>
<span class="line-removed">164     &lt;a href=&quot;$(REDISTRIBUTION_URL)&quot;&gt;documentation redistribution policy&lt;/a&gt;. \</span>
<span class="line-removed">165     $(DRAFT_MARKER_STR) &lt;!-- Version $(VERSION_STRING) --&gt;</span>
166 
167 JAVADOC_TOP := \
168     &lt;div style=&quot;padding: 6px; text-align: center; font-size: 80%; \
169     font-family: DejaVu Sans, Arial, Helvetica, sans-serif; \
170     font-weight: normal;&quot;&gt;$(DRAFT_TEXT)&lt;/div&gt;
171 
172 ################################################################################
173 # JDK javadoc titles/text snippets
174 
175 JDK_SHORT_NAME := Java SE $(VERSION_SPECIFICATION) &amp;amp; JDK $(VERSION_SPECIFICATION)
176 JDK_LONG_NAME := Java&lt;sup&gt;&amp;reg;&lt;/sup&gt; Platform, Standard Edition \
177     &amp;amp;&amp;nbsp;Java&amp;nbsp;Development&amp;nbsp;Kit
178 
179 ################################################################################
180 # Java SE javadoc titles/text snippets
181 
182 JAVASE_SHORT_NAME := Java SE $(VERSION_SPECIFICATION)
183 JAVASE_LONG_NAME := Java&lt;sup&gt;&amp;reg;&lt;/sup&gt; Platform, Standard Edition
184 
185 ################################################################################
186 # Functions
187 
<span class="line-modified">188 # Helper function for creating a png file from a dot file generated by the</span>
189 # GenGraphs tool.
190 # param 1: SetupJavadocGeneration namespace ($1)
191 # param 2: module name
192 #
<span class="line-modified">193 define setup_gengraph_dot_to_png</span>
194   $1_$2_DOT_SRC :=  $$($1_GENGRAPHS_DIR)/$2.dot
<span class="line-modified">195   $1_$2_PNG_TARGET := $$($1_TARGET_DIR)/$2/module-graph.png</span>
196 
<span class="line-modified">197     # For each module needing a graph, create a png file from the dot file</span>
198     # generated by the GenGraphs tool and store it in the target dir.
<span class="line-modified">199     $$(eval $$(call SetupExecute, gengraphs_png_$1_$2, \</span>
200         INFO := Running dot for module graphs for $2, \
201         DEPS := $$(gengraphs_$1_TARGET), \
<span class="line-modified">202         OUTPUT_FILE := $$($1_$2_PNG_TARGET), \</span>
203         SUPPORT_DIR := $$($1_GENGRAPHS_DIR), \
<span class="line-modified">204         COMMAND := $$(DOT) -Tpng -o $$($1_$2_PNG_TARGET) $$($1_$2_DOT_SRC), \</span>
205     ))
206 
<span class="line-modified">207   $1_MODULEGRAPH_TARGETS += $$($1_$2_PNG_TARGET)</span>
208 endef
209 
210 # Helper function to create the overview.html file to use with the -overview
211 # javadoc option.
212 # Returns the filename as $1_OVERVIEW.
213 #
214 # param 1: SetupJavadocGeneration namespace ($1)
215 define create_overview_file
216   $1_OVERVIEW_TEXT := \
217       &lt;!DOCTYPE html&gt; \
218       &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt; \
219       #
220   ifneq ($$($1_GROUPS),)
221     $1_OVERVIEW_TEXT += \
222       &lt;p&gt;This document is divided into \
223       $$(subst 2,two,$$(subst 3,three,$$(words $$($1_GROUPS)))) sections:&lt;/p&gt; \
224       &lt;blockquote&gt;&lt;dl&gt; \
225       #
226     $1_OVERVIEW_TEXT += $$(foreach g, $$($1_GROUPS), \
227         &lt;dt style=&quot;margin-top: 8px;&quot;&gt;$$($$g_GROUP_NAME)&lt;/dt&gt; \
</pre>
<hr />
<pre>
253 # Parameter 1 is the name of the rule. This name is used as variable prefix.
254 # Targets generated are returned as $1_JAVADOC_TARGETS and
255 # $1_MODULEGRAPH_TARGETS. Note that the index.html file will work as a &quot;touch
256 # file&quot; for all the magnitude of files that are generated by javadoc.
257 #
258 # Remaining parameters are named arguments. These include:
259 #   MODULES - Modules to generate javadoc for
260 #   GROUPS - Name of the groups to divide the modules into, if any
261 #   SHORT_NAME - The short name of this documentation collection
262 #   LONG_NAME - The long name of this documentation collection
263 #   TARGET_DIR - Where to store the output
264 #
265 SetupApiDocsGeneration = $(NamedParamsMacroTemplate)
266 define SetupApiDocsGenerationBody
267 
268   # Figure out all modules, both specified and transitive indirect exports, that
269   # will be processed by javadoc.
270   $1_INDIRECT_EXPORTS := $$(call FindTransitiveIndirectDepsForModules, $$($1_MODULES))
271   $1_ALL_MODULES := $$(sort $$($1_MODULES) $$($1_INDIRECT_EXPORTS))
272 
<span class="line-modified">273   $1_JAVA_ARGS := -Dextlink.spec.version=$$(VERSION_SPECIFICATION)</span>

274 
275   ifeq ($$(ENABLE_FULL_DOCS), true)
276     # Tell the ModuleGraph taglet to generate html links to soon-to-be-created
<span class="line-modified">277     # png files with module graphs.</span>
278     $1_JAVA_ARGS += -DenableModuleGraph=true
279   endif
280 
281   # Start with basic options and tags
282   ifeq ($$($1_OPTIONS), )
283     $1_OPTIONS := $$(JAVADOC_OPTIONS)
284   endif
285   ifeq ($$($1_TAGS), )
286     $1_TAGS := $$(JAVADOC_TAGS)
287   endif
288   $1_OPTIONS += $$($1_TAGS)
289 
290   $1_OPTIONS += --module-source-path $$(MODULES_SOURCE_PATH)
291   $1_OPTIONS += --module $$(call CommaList, $$($1_MODULES))
292 
293   # Create a string like &quot;-Xdoclint:all,-syntax,-html,...&quot;
294   $1_OPTIONS += -Xdoclint:all,$$(call CommaList, $$(addprefix -, \
295       $$(JAVADOC_DISABLED_DOCLINT)))
296 
297   $1_DOC_TITLE := $$($1_LONG_NAME)&lt;br&gt;Version $$(VERSION_SPECIFICATION) API \
298       Specification
<span class="line-modified">299   $1_WINDOW_TITLE := $$(subst &amp;amp;,&amp;,$$($1_SHORT_NAME)) $$(DRAFT_MARKER_TITLE)</span>
300   $1_HEADER_TITLE := &lt;div $$(HEADER_STYLE)&gt;&lt;strong&gt;$$($1_SHORT_NAME)&lt;/strong&gt; \
301       $$(DRAFT_MARKER_STR)&lt;/div&gt;
302 
303   $1_OPTIONS += -doctitle &#39;$$($1_DOC_TITLE)&#39;
304   $1_OPTIONS += -windowtitle &#39;$$($1_WINDOW_TITLE)&#39;
305   $1_OPTIONS += -header &#39;$$($1_HEADER_TITLE)&#39;
306   $1_OPTIONS += -bottom &#39;$$(JAVADOC_BOTTOM)&#39;
307   ifeq ($$(IS_DRAFT), true)
308     $1_OPTIONS += -top &#39;$$(JAVADOC_TOP)&#39;
309   endif
310 
311   # Do not store debug level options in VARDEPS.
312   ifneq ($$(LOG_LEVEL), trace)
313     $1_LOG_OPTION += -quiet
314   else
315     $1_LOG_OPTION += -verbose
316   endif
317 
318   # Generate the overview.html file. This will return the filename in
319   # $1_OVERVIEW.
320   $$(eval $$(call create_overview_file,$1))
321   $1_OPTIONS += -overview $$($1_OVERVIEW)
322 
323   $$(foreach g, $$($1_GROUPS), \
324     $$(eval $1_OPTIONS += -group &quot;$$($$g_GROUP_NAME)&quot; &quot;$$($$g_GROUP_MODULES)&quot;) \
325   )
326 
327   ifeq ($$($1_JAVADOC_CMD), )
328     $1_JAVADOC_CMD := $$(JAVA) -Djava.awt.headless=true $$($1_JAVA_ARGS) \
329         $$(NEW_JAVADOC)
330   else
331     $1_OPTIONS += $$(addprefix -J, $$($1_JAVA_ARGS))
332   endif
333 
334   $1_VARDEPS := $$($1_JAVA_ARGS) $$($1_OPTIONS) $$(MODULES_SOURCE_PATH) \
335       $$($1_ALL_MODULES) $$($1_JAVADOC_CMD)
336   $1_VARDEPS_FILE := $$(call DependOnVariable, $1_VARDEPS, \
337       $$(SUPPORT_OUTPUTDIR)/docs/$1.vardeps)
338 
339   # Get a list of all files in all the source dirs for all included modules
<span class="line-modified">340   $1_SOURCE_DEPS := $$(call CacheFind, $$(wildcard $$(foreach module, \</span>
341       $$($1_ALL_MODULES), $$(call FindModuleSrcDirs, $$(module)))))
342 
343   $$(eval $$(call SetupExecute, javadoc_$1, \
344       WARN := Generating $1 javadoc for $$(words $$($1_ALL_MODULES)) modules, \
345       INFO := Javadoc modules: $$($1_ALL_MODULES), \
346       DEPS := $$(BUILD_TOOLS_JDK) $$($1_VARDEPS_FILE) $$($1_SOURCE_DEPS) \
347           $$($1_OVERVIEW), \
348       OUTPUT_DIR := $$($1_TARGET_DIR), \
349       SUPPORT_DIR := $$(SUPPORT_OUTPUTDIR)/docs, \
350       COMMAND := $$($1_JAVADOC_CMD) -d $$($1_TARGET_DIR) $$($1_OPTIONS) \
351           $$($1_LOG_OPTION), \
352   ))
353 
354   $1_JAVADOC_TARGETS := $$(javadoc_$1_TARGET)
355 
356   ifeq ($$(ENABLE_FULL_DOCS), true)
<span class="line-modified">357     # We have asked ModuleGraph to generate links to png files. Now we must</span>
<span class="line-modified">358     # produce the png files.</span>
359 
360     # Locate which modules has the @moduleGraph tag in their module-info.java
361     $1_MODULES_NEEDING_GRAPH := $$(strip $$(foreach m, $$($1_ALL_MODULES), \
362       $$(if $$(shell $$(GREP) -e @moduleGraph \
363           $$(wildcard $$(addsuffix /module-info.java, \
364           $$(call FindModuleSrcDirs, $$m)))), \
365         $$m) \
366     ))
367 
368     # First we run the GenGraph tool. It will query the module structure of the
369     # running JVM and output .dot files for all existing modules.
370     GENGRAPHS_PROPS := \
371         $$(TOPDIR)/make/jdk/src/classes/build/tools/jigsaw/javadoc-graphs.properties
372 
373     $1_GENGRAPHS_DIR := $$(SUPPORT_OUTPUTDIR)/docs/$1-gengraphs
374 
375     $$(eval $$(call SetupExecute, gengraphs_$1, \
376         INFO := Running gengraphs for $1 documentation, \
377         DEPS := $$(BUILD_JIGSAW_TOOLS) $$(GENGRAPHS_PROPS), \
378         OUTPUT_DIR := $$($1_GENGRAPHS_DIR), \
379         COMMAND := $$(TOOL_GENGRAPHS) --spec --output $$($1_GENGRAPHS_DIR) \
380             --dot-attributes $$(GENGRAPHS_PROPS), \
381     ))
382 
<span class="line-modified">383     # For each module needing a graph, create a png file from the dot file</span>
384     # generated by the GenGraphs tool and store it in the target dir.
385     # They will depend on gengraphs_$1_TARGET, and will be added to $1.
386     $$(foreach m, $$($1_MODULES_NEEDING_GRAPH), \
<span class="line-modified">387       $$(eval $$(call setup_gengraph_dot_to_png,$1,$$m)) \</span>
388     )
389   endif
390 endef
391 
392 ################################################################################
393 # Setup generation of the JDK API documentation (javadoc + modulegraph)
394 
395 # Define the groups of the JDK API documentation
396 JavaSE_GROUP_NAME := Java SE
397 JavaSE_GROUP_MODULES := $(call ColonList, $(sort java.se \
398     $(call FindTransitiveIndirectDepsForModules, java.se)))
399 JavaSE_GROUP_DESCRIPTION := \
400     The Java Platform, Standard Edition (Java SE) APIs define the core Java \
401     platform for general-purpose computing. These APIs are in modules whose \
402     names start with {@code java}. \
403     #
404 JDK_GROUPS += JavaSE
405 
406 JDK_GROUP_NAME := JDK
407 JDK_GROUP_MODULES := jdk.*
</pre>
<hr />
<pre>
463 # The reference javadoc is just the same as javase, but using the BootJDK javadoc
464 # and a stable set of javadoc options.  Typically it is used for generating
465 # diffs between the reference javadoc and a javadoc bundle of a specific build
466 # generated in the same way.
467 
468 $(eval $(call SetupApiDocsGeneration, REFERENCE_API, \
469     MODULES := $(JAVASE_MODULES), \
470     SHORT_NAME := $(JAVASE_SHORT_NAME), \
471     LONG_NAME := $(JAVASE_LONG_NAME), \
472     TARGET_DIR := $(IMAGES_OUTPUTDIR)/reference-docs/api, \
473     JAVADOC_CMD := $(JAVADOC), \
474     OPTIONS := $(REFERENCE_OPTIONS), \
475     TAGS := $(REFERENCE_TAGS), \
476 ))
477 
478 # Targets generated are returned in REFERENCE_API_JAVADOC_TARGETS and
479 # REFERENCE_API_MODULEGRAPH_TARGETS.
480 
481 ################################################################################
482 














483 # Copy the global resources, including the top-level redirect index.html
<span class="line-modified">484 GLOBAL_SPECS_RESOURCES_DIR := $(TOPDIR)/make/data/docs-resources/</span>
485 $(eval $(call SetupCopyFiles, COPY_GLOBAL_RESOURCES, \
486     SRC := $(GLOBAL_SPECS_RESOURCES_DIR), \
<span class="line-modified">487     FILES := $(call CacheFind, $(GLOBAL_SPECS_RESOURCES_DIR)), \</span>
488     DEST := $(DOCS_OUTPUTDIR), \
489 ))
490 JDK_INDEX_TARGETS += $(COPY_GLOBAL_RESOURCES)
491 
492 # Copy the legal notices distributed with the docs bundle
493 $(eval $(call SetupCopyFiles, COPY_DOCS_LEGAL_NOTICES, \
494     SRC := $(TOPDIR)/src/jdk.javadoc/share/legal, \
<span class="line-modified">495     FILES := $(wildcard $(TOPDIR)/src/jdk.javadoc/share/legal/*), \</span>
496     DEST := $(DOCS_OUTPUTDIR)/legal, \
497 ))
498 JDK_INDEX_TARGETS += $(COPY_DOCS_LEGAL_NOTICES)
499 
500 ################################################################################
501 # Copy JDK specs files
502 
<span class="line-modified">503 # For all html documentation in $module/share/specs directories, copy it</span>
504 # unmodified
505 
506 ALL_MODULES := $(call FindAllModules)
<span class="line-modified">507 COPY_SPEC_FILTER := %.html %.gif %.jpg %.mib %.css</span>
508 
509 $(foreach m, $(ALL_MODULES), \
510   $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \
511   $(foreach d, $(SPECS_$m), \
<span class="line-modified">512     $(if $(filter $(COPY_SPEC_FILTER), $(call CacheFind, $d)), \</span>
513       $(eval $(call SetupCopyFiles, COPY_$m, \
514           SRC := $d, \
<span class="line-modified">515           FILES := $(filter $(COPY_SPEC_FILTER), $(call CacheFind, $d)), \</span>
516           DEST := $(DOCS_OUTPUTDIR)/specs/, \
517       )) \
518       $(eval JDK_SPECS_TARGETS += $(COPY_$m)) \
519     ) \
520   ) \
521 )
522 




































523 ifeq ($(ENABLE_PANDOC), true)
524   # For all markdown files in $module/share/specs directories, convert them to
525   # html, if we have pandoc (otherwise we&#39;ll just skip this).
526 
527   GLOBAL_SPECS_DEFAULT_CSS_FILE := $(DOCS_OUTPUTDIR)/resources/jdk-default.css
528 
529   $(foreach m, $(ALL_MODULES), \
530     $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \
531     $(foreach d, $(SPECS_$m), \
<span class="line-modified">532       $(if $(filter %.md, $(call CacheFind, $d)), \</span>
<span class="line-modified">533         $(eval $m_$d_NAME := SPECS_TO_HTML_$m_$(strip $(call RelativePath, $d, $(TOPDIR)))) \</span>
<span class="line-modified">534         $(eval $(call SetupProcessMarkdown, $($m_$d_NAME), \</span>

535             SRC := $d, \
<span class="line-modified">536             FILES := $(filter %.md, $(call CacheFind, $d)), \</span>
537             DEST := $(DOCS_OUTPUTDIR)/specs/, \
538             CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \





539         )) \
<span class="line-modified">540         $(eval JDK_SPECS_TARGETS += $($($m_$d_NAME))) \</span>
541       ) \
542     ) \
543   )
544 
545   # For all markdown files in $module/share/man directories, convert them to
546   # html.
547 
548   # Create dynamic man pages from markdown using pandoc. We need
549   # PANDOC_HTML_MANPAGE_FILTER, a wrapper around
550   # PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT. This is created by buildtools-jdk.
551 
552   # We should also depend on the source javascript filter
553   PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT := \
554       $(TOPDIR)/make/scripts/pandoc-html-manpage-filter.js
555 
556   $(foreach m, $(ALL_MODULES), \
557     $(eval MAN_$m := $(call FindModuleManDirs, $m)) \
558     $(foreach d, $(MAN_$m), \
<span class="line-modified">559       $(if $(filter %.md, $(call CacheFind, $d)), \</span>
<span class="line-modified">560         $(eval $m_$d_NAME := MAN_TO_HTML_$m_$(strip $(call RelativePath, $d, $(TOPDIR)))) \</span>
<span class="line-modified">561         $(eval $(call SetupProcessMarkdown, $($m_$d_NAME), \</span>
562             SRC := $d, \
<span class="line-modified">563             FILES := $(filter %.md, $(call CacheFind, $d)), \</span>
564             DEST := $(DOCS_OUTPUTDIR)/specs/man, \
565             FILTER := $(PANDOC_HTML_MANPAGE_FILTER), \
566             CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \
<span class="line-modified">567             REPLACEMENTS := @@VERSION_SHORT@@ =&gt; $(VERSION_SHORT), \</span>





568             EXTRA_DEPS := $(PANDOC_HTML_MANPAGE_FILTER) \
569                 $(PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT), \
570         )) \
<span class="line-modified">571         $(eval JDK_SPECS_TARGETS += $($($m_$d_NAME))) \</span>
572       ) \
573     ) \
574   )
575 
576   # The html generated from markdown also needs the css file
577   JDK_SPECS_TARGETS += $(COPY_GLOBAL_RESOURCES)
578 endif
579 
580 # Special treatment for generated documentation
581 
582 JDWP_PROTOCOL := $(SUPPORT_OUTPUTDIR)/gensrc/jdk.jdi/jdwp-protocol.html
<span class="line-modified">583 $(eval $(call SetupCopyFiles, COPY_JDWP_PROTOCOL, \</span>
<span class="line-modified">584     FILES := $(JDWP_PROTOCOL), \</span>
<span class="line-modified">585     DEST := $(DOCS_OUTPUTDIR)/specs/jdwp, \</span>
<span class="line-modified">586 ))</span>
<span class="line-modified">587 JDK_SPECS_TARGETS += $(COPY_JDWP_PROTOCOL)</span>





588 
589 # Get jvmti.html from the main jvm variant (all variants&#39; jvmti.html are identical).
590 JVMTI_HTML ?= $(HOTSPOT_OUTPUTDIR)/variant-$(JVM_VARIANT_MAIN)/gensrc/jvmtifiles/jvmti.html
<span class="line-modified">591 $(eval $(call SetupCopyFiles, COPY_JVMTI_HTML, \</span>
<span class="line-modified">592     FILES := $(JVMTI_HTML), \</span>
<span class="line-modified">593     DEST := $(DOCS_OUTPUTDIR)/specs, \</span>
<span class="line-modified">594 ))</span>
<span class="line-modified">595 JDK_SPECS_TARGETS += $(COPY_JVMTI_HTML)</span>





596 
597 ################################################################################
598 # Optional target which bundles all generated javadocs into a zip archive.
599 
600 JAVADOC_ZIP_NAME := jdk-$(VERSION_STRING)-docs.zip
601 JAVADOC_ZIP_FILE := $(OUTPUTDIR)/bundles/$(JAVADOC_ZIP_NAME)
602 
603 $(eval $(call SetupZipArchive, BUILD_JAVADOC_ZIP, \
604     SRC := $(DOCS_OUTPUTDIR), \
605     ZIP := $(JAVADOC_ZIP_FILE), \
606     EXTRA_DEPS := $(JDK_API_JAVADOC_TARGETS) $(JDK_API_MODULEGRAPH_TARGETS) \
607         $(JDK_SPECS_TARGETS), \
608 ))
609 
610 ZIP_TARGETS += $(BUILD_JAVADOC_ZIP)
611 


















612 ################################################################################
613 
614 docs-jdk-api-javadoc: $(JDK_API_JAVADOC_TARGETS) $(JDK_API_CUSTOM_TARGETS)
615 
616 docs-jdk-api-modulegraph: $(JDK_API_MODULEGRAPH_TARGETS)
617 
618 docs-javase-api-javadoc: $(JAVASE_API_JAVADOC_TARGETS) $(JAVASE_API_CUSTOM_TARGETS)
619 
620 docs-javase-api-modulegraph: $(JAVASE_API_MODULEGRAPH_TARGETS)
621 
622 docs-reference-api-javadoc: $(REFERENCE_API_JAVADOC_TARGETS) $(REFERENCE_API_CUSTOM_TARGETS)
623 
624 docs-reference-api-modulegraph: $(REFERENCE_API_MODULEGRAPH_TARGETS)
625 
626 docs-jdk-specs: $(JDK_SPECS_TARGETS)
627 
628 docs-jdk-index: $(JDK_INDEX_TARGETS)
629 
630 docs-zip: $(ZIP_TARGETS)
631 


632 all: docs-jdk-api-javadoc docs-jdk-api-modulegraph docs-javase-api-javadoc \
633     docs-javase-api-modulegraph docs-reference-api-javadoc \
<span class="line-modified">634     docs-reference-api-modulegraph docs-jdk-specs docs-jdk-index docs-zip</span>

635 
636 .PHONY: default all docs-jdk-api-javadoc docs-jdk-api-modulegraph \
637     docs-javase-api-javadoc docs-javase-api-modulegraph \
638     docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \
<span class="line-modified">639     docs-jdk-index docs-zip</span>
</pre>
</td>
<td>
<hr />
<pre>
 15 #
 16 # You should have received a copy of the GNU General Public License version
 17 # 2 along with this work; if not, write to the Free Software Foundation,
 18 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19 #
 20 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21 # or visit www.oracle.com if you need additional information or have any
 22 # questions.
 23 #
 24 
 25 default: all
 26 
 27 include $(SPEC)
 28 include MakeBase.gmk
 29 include Execute.gmk
 30 include Modules.gmk
 31 include ModuleTools.gmk
 32 include ProcessMarkdown.gmk
 33 include ToolsJdk.gmk
 34 include ZipArchive.gmk
<span class="line-added"> 35 include TextFileProcessing.gmk</span>
 36 
 37 # This is needed to properly setup DOCS_MODULES.
 38 $(eval $(call ReadImportMetaData))
 39 
 40 ################################################################################
 41 # Hook to include the corresponding custom file, if present.
 42 $(eval $(call IncludeCustomExtension, Docs.gmk))
 43 
 44 ################################################################################
 45 # This file generates all documentation for OpenJDK.
 46 #
 47 # We will generate API documentation for two different selections of the source
 48 # code: &quot;Java SE&quot;, which contains just the modules covered by the top-level
 49 # module java.se and &quot;JDK&quot;, which covers all of Java SE and also all
 50 # other available modules that should be documented, including imported modules,
 51 # if any.
 52 #
 53 # We will also generate separate, free-standing specifications from either
 54 # markdown or existing html files.
 55 #
 56 
 57 ################################################################################
 58 # Javadoc settings
 59 
 60 # On top of the sources that was used to compile the JDK, we need some
 61 # extra java.rmi sources that are used just for javadoc.
 62 MODULES_SOURCE_PATH := $(call PathList, $(call GetModuleSrcPath) \
 63     $(SUPPORT_OUTPUTDIR)/rmic/* $(TOPDIR)/src/*/share/doc/stub)
 64 
 65 # URLs
 66 JAVADOC_BASE_URL := https://docs.oracle.com/pls/topic/lookup?ctx=javase$(VERSION_NUMBER)&amp;amp;id=homepage
 67 BUG_SUBMIT_URL := https://bugreport.java.com/bugreport/
<span class="line-modified"> 68 COPYRIGHT_URL := legal/copyright.html</span>
 69 LICENSE_URL := https://www.oracle.com/technetwork/java/javase/terms/license/java$(VERSION_NUMBER)speclicense.html
 70 REDISTRIBUTION_URL := https://www.oracle.com/technetwork/java/redist-137594.html
 71 
 72 # In order to get a specific ordering it&#39;s necessary to specify the total
 73 # ordering of tags as the tags are otherwise ordered in order of definition.
 74 JAVADOC_TAGS := \
 75     -tag beaninfo:X \
 76     -tag revised:X \
 77     -tag since.unbundled:X \
 78     -tag spec:X \
 79     -tag specdefault:X \
 80     -tag Note:X \
 81     -tag ToDo:X \
 82     -tag &#39;apiNote:a:API Note:&#39; \
 83     -tag &#39;implSpec:a:Implementation Requirements:&#39; \
 84     -tag &#39;implNote:a:Implementation Note:&#39; \
 85     -tag param \
 86     -tag return \
 87     -tag throws \
<span class="line-added"> 88     -taglet build.tools.taglet.JSpec\$$JLS \</span>
<span class="line-added"> 89     -taglet build.tools.taglet.JSpec\$$JVMS \</span>
 90     -taglet build.tools.taglet.ModuleGraph \
<span class="line-added"> 91     -taglet build.tools.taglet.ToolGuide \</span>
 92     -tag since \
 93     -tag serialData \
 94     -tag factory \
 95     -tag see \


 96     -taglet build.tools.taglet.ExtLink \
 97     -taglet build.tools.taglet.Incubating \
<span class="line-added"> 98     -taglet build.tools.taglet.Preview \</span>
 99     -tagletpath $(BUILDTOOLS_OUTPUTDIR)/jdk_tools_classes \
100     $(CUSTOM_JAVADOC_TAGS) \
101     #
102 
103 # The reference tags must stay stable to allow for comparisons across the
104 # development cycle. If JAVADOC_TAGS needs to change, make sure that
105 # REFERENCE_TAGS remains unchanged, by copying and hardcoding, if necessary.
106 REFERENCE_TAGS := $(JAVADOC_TAGS)
107 
108 # Which doclint checks to ignore
109 JAVADOC_DISABLED_DOCLINT := accessibility html missing syntax reference
110 
111 # The initial set of options for javadoc
112 JAVADOC_OPTIONS := -use -keywords -notimestamp \
113     -serialwarn -encoding ISO-8859-1 -docencoding UTF-8 -breakiterator \
114     -splitIndex --system none -javafx --expand-requires transitive \
115     --override-methods=summary
116 
117 # The reference options must stay stable to allow for comparisons across the
118 # development cycle.
</pre>
<hr />
<pre>
121     -html5 -javafx --expand-requires transitive
122 
123 # Should we add DRAFT stamps to the generated javadoc?
124 ifeq ($(VERSION_IS_GA), true)
125   IS_DRAFT := false
126 else
127   IS_DRAFT := true
128 endif
129 
130 ################################################################################
131 # General text snippets
132 
133 FULL_COMPANY_NAME := Oracle and/or its affiliates
134 COMPANY_ADDRESS := 500 Oracle Parkway, Redwood Shores, CA 94065 USA
135 
136 JAVA_PLATFORM := Java Platform
137 
138 ifeq ($(IS_DRAFT), true)
139   DRAFT_MARKER_STR := &lt;br&gt;&lt;strong&gt;DRAFT $(VERSION_STRING)&lt;/strong&gt;
140   ifeq ($(VERSION_BUILD), 0)
<span class="line-modified">141     DRAFT_MARKER_TITLE := $(SPACE)[ad-hoc build]</span>
142   else
<span class="line-modified">143     DRAFT_MARKER_TITLE := $(SPACE)[build $(VERSION_BUILD)]</span>
144   endif
145   DRAFT_TEXT := This specification is not final and is subject to change. \
146       Use is subject to &lt;a href=&quot;$(LICENSE_URL)&quot;&gt;license terms&lt;/a&gt;.
147 
148   # Workaround stylesheet bug
149   HEADER_STYLE := style=&quot;margin-top: 9px;&quot;
150 else
151   HEADER_STYLE := style=&quot;margin-top: 14px;&quot;
152 endif
153 
<span class="line-added">154 # $1 - Relative prefix to COPYRIGHT_URL</span>
<span class="line-added">155 COPYRIGHT_BOTTOM = \</span>
<span class="line-added">156     &lt;a href=&quot;$(strip $1)$(COPYRIGHT_URL)&quot;&gt;Copyright&lt;/a&gt; \</span>
<span class="line-added">157     &amp;copy; 1993, $(COPYRIGHT_YEAR), $(FULL_COMPANY_NAME), \</span>
<span class="line-added">158     $(COMPANY_ADDRESS).&lt;br&gt;All rights reserved. \</span>
<span class="line-added">159     Use is subject to &lt;a href=&quot;$(LICENSE_URL)&quot;&gt;license terms&lt;/a&gt; and the \</span>
<span class="line-added">160     &lt;a href=&quot;$(REDISTRIBUTION_URL)&quot;&gt;documentation redistribution policy&lt;/a&gt;. \</span>
<span class="line-added">161     $(DRAFT_MARKER_STR) &lt;!-- Version $(VERSION_STRING) --&gt;</span>
<span class="line-added">162 </span>
163 JAVADOC_BOTTOM := \
164     &lt;a href=&quot;$(BUG_SUBMIT_URL)&quot;&gt;Report a bug or suggest an enhancement&lt;/a&gt;&lt;br&gt; \
165     For further API reference and developer documentation see the \
166     &lt;a href=&quot;$(JAVADOC_BASE_URL)&quot; target=&quot;_blank&quot;&gt;Java SE \
167     Documentation&lt;/a&gt;, which contains more detailed, \
168     developer-targeted descriptions with conceptual overviews, definitions \
169     of terms, workarounds, and working code examples.&lt;br&gt; \
170     Java is a trademark or registered trademark of $(FULL_COMPANY_NAME) in \
171     the US and other countries.&lt;br&gt; \
<span class="line-modified">172     $(call COPYRIGHT_BOTTOM, {@docroot}/../)</span>





173 
174 JAVADOC_TOP := \
175     &lt;div style=&quot;padding: 6px; text-align: center; font-size: 80%; \
176     font-family: DejaVu Sans, Arial, Helvetica, sans-serif; \
177     font-weight: normal;&quot;&gt;$(DRAFT_TEXT)&lt;/div&gt;
178 
179 ################################################################################
180 # JDK javadoc titles/text snippets
181 
182 JDK_SHORT_NAME := Java SE $(VERSION_SPECIFICATION) &amp;amp; JDK $(VERSION_SPECIFICATION)
183 JDK_LONG_NAME := Java&lt;sup&gt;&amp;reg;&lt;/sup&gt; Platform, Standard Edition \
184     &amp;amp;&amp;nbsp;Java&amp;nbsp;Development&amp;nbsp;Kit
185 
186 ################################################################################
187 # Java SE javadoc titles/text snippets
188 
189 JAVASE_SHORT_NAME := Java SE $(VERSION_SPECIFICATION)
190 JAVASE_LONG_NAME := Java&lt;sup&gt;&amp;reg;&lt;/sup&gt; Platform, Standard Edition
191 
192 ################################################################################
193 # Functions
194 
<span class="line-modified">195 # Helper function for creating a svg file from a dot file generated by the</span>
196 # GenGraphs tool.
197 # param 1: SetupJavadocGeneration namespace ($1)
198 # param 2: module name
199 #
<span class="line-modified">200 define setup_gengraph_dot_to_svg</span>
201   $1_$2_DOT_SRC :=  $$($1_GENGRAPHS_DIR)/$2.dot
<span class="line-modified">202   $1_$2_SVG_TARGET := $$($1_TARGET_DIR)/$2/module-graph.svg</span>
203 
<span class="line-modified">204     # For each module needing a graph, create a svg file from the dot file</span>
205     # generated by the GenGraphs tool and store it in the target dir.
<span class="line-modified">206     $$(eval $$(call SetupExecute, gengraphs_svg_$1_$2, \</span>
207         INFO := Running dot for module graphs for $2, \
208         DEPS := $$(gengraphs_$1_TARGET), \
<span class="line-modified">209         OUTPUT_FILE := $$($1_$2_SVG_TARGET), \</span>
210         SUPPORT_DIR := $$($1_GENGRAPHS_DIR), \
<span class="line-modified">211         COMMAND := $$(DOT) -Tsvg -o $$($1_$2_SVG_TARGET) $$($1_$2_DOT_SRC), \</span>
212     ))
213 
<span class="line-modified">214   $1_MODULEGRAPH_TARGETS += $$($1_$2_SVG_TARGET)</span>
215 endef
216 
217 # Helper function to create the overview.html file to use with the -overview
218 # javadoc option.
219 # Returns the filename as $1_OVERVIEW.
220 #
221 # param 1: SetupJavadocGeneration namespace ($1)
222 define create_overview_file
223   $1_OVERVIEW_TEXT := \
224       &lt;!DOCTYPE html&gt; \
225       &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt; \
226       #
227   ifneq ($$($1_GROUPS),)
228     $1_OVERVIEW_TEXT += \
229       &lt;p&gt;This document is divided into \
230       $$(subst 2,two,$$(subst 3,three,$$(words $$($1_GROUPS)))) sections:&lt;/p&gt; \
231       &lt;blockquote&gt;&lt;dl&gt; \
232       #
233     $1_OVERVIEW_TEXT += $$(foreach g, $$($1_GROUPS), \
234         &lt;dt style=&quot;margin-top: 8px;&quot;&gt;$$($$g_GROUP_NAME)&lt;/dt&gt; \
</pre>
<hr />
<pre>
260 # Parameter 1 is the name of the rule. This name is used as variable prefix.
261 # Targets generated are returned as $1_JAVADOC_TARGETS and
262 # $1_MODULEGRAPH_TARGETS. Note that the index.html file will work as a &quot;touch
263 # file&quot; for all the magnitude of files that are generated by javadoc.
264 #
265 # Remaining parameters are named arguments. These include:
266 #   MODULES - Modules to generate javadoc for
267 #   GROUPS - Name of the groups to divide the modules into, if any
268 #   SHORT_NAME - The short name of this documentation collection
269 #   LONG_NAME - The long name of this documentation collection
270 #   TARGET_DIR - Where to store the output
271 #
272 SetupApiDocsGeneration = $(NamedParamsMacroTemplate)
273 define SetupApiDocsGenerationBody
274 
275   # Figure out all modules, both specified and transitive indirect exports, that
276   # will be processed by javadoc.
277   $1_INDIRECT_EXPORTS := $$(call FindTransitiveIndirectDepsForModules, $$($1_MODULES))
278   $1_ALL_MODULES := $$(sort $$($1_MODULES) $$($1_INDIRECT_EXPORTS))
279 
<span class="line-modified">280   $1_JAVA_ARGS := -Dextlink.spec.version=$$(VERSION_SPECIFICATION) \</span>
<span class="line-added">281 	-Djspec.version=$$(VERSION_SPECIFICATION)</span>
282 
283   ifeq ($$(ENABLE_FULL_DOCS), true)
284     # Tell the ModuleGraph taglet to generate html links to soon-to-be-created
<span class="line-modified">285     # svg files with module graphs.</span>
286     $1_JAVA_ARGS += -DenableModuleGraph=true
287   endif
288 
289   # Start with basic options and tags
290   ifeq ($$($1_OPTIONS), )
291     $1_OPTIONS := $$(JAVADOC_OPTIONS)
292   endif
293   ifeq ($$($1_TAGS), )
294     $1_TAGS := $$(JAVADOC_TAGS)
295   endif
296   $1_OPTIONS += $$($1_TAGS)
297 
298   $1_OPTIONS += --module-source-path $$(MODULES_SOURCE_PATH)
299   $1_OPTIONS += --module $$(call CommaList, $$($1_MODULES))
300 
301   # Create a string like &quot;-Xdoclint:all,-syntax,-html,...&quot;
302   $1_OPTIONS += -Xdoclint:all,$$(call CommaList, $$(addprefix -, \
303       $$(JAVADOC_DISABLED_DOCLINT)))
304 
305   $1_DOC_TITLE := $$($1_LONG_NAME)&lt;br&gt;Version $$(VERSION_SPECIFICATION) API \
306       Specification
<span class="line-modified">307   $1_WINDOW_TITLE := $$(subst &amp;amp;,&amp;,$$($1_SHORT_NAME))$$(DRAFT_MARKER_TITLE)</span>
308   $1_HEADER_TITLE := &lt;div $$(HEADER_STYLE)&gt;&lt;strong&gt;$$($1_SHORT_NAME)&lt;/strong&gt; \
309       $$(DRAFT_MARKER_STR)&lt;/div&gt;
310 
311   $1_OPTIONS += -doctitle &#39;$$($1_DOC_TITLE)&#39;
312   $1_OPTIONS += -windowtitle &#39;$$($1_WINDOW_TITLE)&#39;
313   $1_OPTIONS += -header &#39;$$($1_HEADER_TITLE)&#39;
314   $1_OPTIONS += -bottom &#39;$$(JAVADOC_BOTTOM)&#39;
315   ifeq ($$(IS_DRAFT), true)
316     $1_OPTIONS += -top &#39;$$(JAVADOC_TOP)&#39;
317   endif
318 
319   # Do not store debug level options in VARDEPS.
320   ifneq ($$(LOG_LEVEL), trace)
321     $1_LOG_OPTION += -quiet
322   else
323     $1_LOG_OPTION += -verbose
324   endif
325 
326   # Generate the overview.html file. This will return the filename in
327   # $1_OVERVIEW.
328   $$(eval $$(call create_overview_file,$1))
329   $1_OPTIONS += -overview $$($1_OVERVIEW)
330 
331   $$(foreach g, $$($1_GROUPS), \
332     $$(eval $1_OPTIONS += -group &quot;$$($$g_GROUP_NAME)&quot; &quot;$$($$g_GROUP_MODULES)&quot;) \
333   )
334 
335   ifeq ($$($1_JAVADOC_CMD), )
336     $1_JAVADOC_CMD := $$(JAVA) -Djava.awt.headless=true $$($1_JAVA_ARGS) \
337         $$(NEW_JAVADOC)
338   else
339     $1_OPTIONS += $$(addprefix -J, $$($1_JAVA_ARGS))
340   endif
341 
342   $1_VARDEPS := $$($1_JAVA_ARGS) $$($1_OPTIONS) $$(MODULES_SOURCE_PATH) \
343       $$($1_ALL_MODULES) $$($1_JAVADOC_CMD)
344   $1_VARDEPS_FILE := $$(call DependOnVariable, $1_VARDEPS, \
345       $$(SUPPORT_OUTPUTDIR)/docs/$1.vardeps)
346 
347   # Get a list of all files in all the source dirs for all included modules
<span class="line-modified">348   $1_SOURCE_DEPS := $$(call FindFiles, $$(wildcard $$(foreach module, \</span>
349       $$($1_ALL_MODULES), $$(call FindModuleSrcDirs, $$(module)))))
350 
351   $$(eval $$(call SetupExecute, javadoc_$1, \
352       WARN := Generating $1 javadoc for $$(words $$($1_ALL_MODULES)) modules, \
353       INFO := Javadoc modules: $$($1_ALL_MODULES), \
354       DEPS := $$(BUILD_TOOLS_JDK) $$($1_VARDEPS_FILE) $$($1_SOURCE_DEPS) \
355           $$($1_OVERVIEW), \
356       OUTPUT_DIR := $$($1_TARGET_DIR), \
357       SUPPORT_DIR := $$(SUPPORT_OUTPUTDIR)/docs, \
358       COMMAND := $$($1_JAVADOC_CMD) -d $$($1_TARGET_DIR) $$($1_OPTIONS) \
359           $$($1_LOG_OPTION), \
360   ))
361 
362   $1_JAVADOC_TARGETS := $$(javadoc_$1_TARGET)
363 
364   ifeq ($$(ENABLE_FULL_DOCS), true)
<span class="line-modified">365     # We have asked ModuleGraph to generate links to svg files. Now we must</span>
<span class="line-modified">366     # produce the svg files.</span>
367 
368     # Locate which modules has the @moduleGraph tag in their module-info.java
369     $1_MODULES_NEEDING_GRAPH := $$(strip $$(foreach m, $$($1_ALL_MODULES), \
370       $$(if $$(shell $$(GREP) -e @moduleGraph \
371           $$(wildcard $$(addsuffix /module-info.java, \
372           $$(call FindModuleSrcDirs, $$m)))), \
373         $$m) \
374     ))
375 
376     # First we run the GenGraph tool. It will query the module structure of the
377     # running JVM and output .dot files for all existing modules.
378     GENGRAPHS_PROPS := \
379         $$(TOPDIR)/make/jdk/src/classes/build/tools/jigsaw/javadoc-graphs.properties
380 
381     $1_GENGRAPHS_DIR := $$(SUPPORT_OUTPUTDIR)/docs/$1-gengraphs
382 
383     $$(eval $$(call SetupExecute, gengraphs_$1, \
384         INFO := Running gengraphs for $1 documentation, \
385         DEPS := $$(BUILD_JIGSAW_TOOLS) $$(GENGRAPHS_PROPS), \
386         OUTPUT_DIR := $$($1_GENGRAPHS_DIR), \
387         COMMAND := $$(TOOL_GENGRAPHS) --spec --output $$($1_GENGRAPHS_DIR) \
388             --dot-attributes $$(GENGRAPHS_PROPS), \
389     ))
390 
<span class="line-modified">391     # For each module needing a graph, create a svg file from the dot file</span>
392     # generated by the GenGraphs tool and store it in the target dir.
393     # They will depend on gengraphs_$1_TARGET, and will be added to $1.
394     $$(foreach m, $$($1_MODULES_NEEDING_GRAPH), \
<span class="line-modified">395       $$(eval $$(call setup_gengraph_dot_to_svg,$1,$$m)) \</span>
396     )
397   endif
398 endef
399 
400 ################################################################################
401 # Setup generation of the JDK API documentation (javadoc + modulegraph)
402 
403 # Define the groups of the JDK API documentation
404 JavaSE_GROUP_NAME := Java SE
405 JavaSE_GROUP_MODULES := $(call ColonList, $(sort java.se \
406     $(call FindTransitiveIndirectDepsForModules, java.se)))
407 JavaSE_GROUP_DESCRIPTION := \
408     The Java Platform, Standard Edition (Java SE) APIs define the core Java \
409     platform for general-purpose computing. These APIs are in modules whose \
410     names start with {@code java}. \
411     #
412 JDK_GROUPS += JavaSE
413 
414 JDK_GROUP_NAME := JDK
415 JDK_GROUP_MODULES := jdk.*
</pre>
<hr />
<pre>
471 # The reference javadoc is just the same as javase, but using the BootJDK javadoc
472 # and a stable set of javadoc options.  Typically it is used for generating
473 # diffs between the reference javadoc and a javadoc bundle of a specific build
474 # generated in the same way.
475 
476 $(eval $(call SetupApiDocsGeneration, REFERENCE_API, \
477     MODULES := $(JAVASE_MODULES), \
478     SHORT_NAME := $(JAVASE_SHORT_NAME), \
479     LONG_NAME := $(JAVASE_LONG_NAME), \
480     TARGET_DIR := $(IMAGES_OUTPUTDIR)/reference-docs/api, \
481     JAVADOC_CMD := $(JAVADOC), \
482     OPTIONS := $(REFERENCE_OPTIONS), \
483     TAGS := $(REFERENCE_TAGS), \
484 ))
485 
486 # Targets generated are returned in REFERENCE_API_JAVADOC_TARGETS and
487 # REFERENCE_API_MODULEGRAPH_TARGETS.
488 
489 ################################################################################
490 
<span class="line-added">491 # Use this variable to control which spec files are included in the output.</span>
<span class="line-added">492 # Format: space-delimited list of names, including at most one &#39;%&#39; as a</span>
<span class="line-added">493 # wildcard. Spec source files match if their filename or any enclosing folder</span>
<span class="line-added">494 # name matches one of the items in SPEC_FILTER.</span>
<span class="line-added">495 SPEC_FILTER := %</span>
<span class="line-added">496 </span>
<span class="line-added">497 ApplySpecFilter = \</span>
<span class="line-added">498     $(strip $(foreach file, $(1), \</span>
<span class="line-added">499         $(eval searchkeys := $(subst /, ,$(subst $(WORKSPACE_ROOT),,$(file)))) \</span>
<span class="line-added">500         $(if $(filter $(SPEC_FILTER), $(searchkeys)), \</span>
<span class="line-added">501             $(file) \</span>
<span class="line-added">502         ) \</span>
<span class="line-added">503     ))</span>
<span class="line-added">504 </span>
505 # Copy the global resources, including the top-level redirect index.html
<span class="line-modified">506 GLOBAL_SPECS_RESOURCES_DIR := $(TOPDIR)/make/data/docs-resources</span>
507 $(eval $(call SetupCopyFiles, COPY_GLOBAL_RESOURCES, \
508     SRC := $(GLOBAL_SPECS_RESOURCES_DIR), \
<span class="line-modified">509     FILES := $(call ApplySpecFilter, $(call FindFiles, $(GLOBAL_SPECS_RESOURCES_DIR))), \</span>
510     DEST := $(DOCS_OUTPUTDIR), \
511 ))
512 JDK_INDEX_TARGETS += $(COPY_GLOBAL_RESOURCES)
513 
514 # Copy the legal notices distributed with the docs bundle
515 $(eval $(call SetupCopyFiles, COPY_DOCS_LEGAL_NOTICES, \
516     SRC := $(TOPDIR)/src/jdk.javadoc/share/legal, \
<span class="line-modified">517     FILES := $(call ApplySpecFilter, $(wildcard $(TOPDIR)/src/jdk.javadoc/share/legal/*)), \</span>
518     DEST := $(DOCS_OUTPUTDIR)/legal, \
519 ))
520 JDK_INDEX_TARGETS += $(COPY_DOCS_LEGAL_NOTICES)
521 
522 ################################################################################
523 # Copy JDK specs files
524 
<span class="line-modified">525 # For all non html/md files in $module/share/specs directories, copy them</span>
526 # unmodified
527 
528 ALL_MODULES := $(call FindAllModules)
<span class="line-modified">529 COPY_SPEC_FILTER := %.gif %.jpg %.mib %.css</span>
530 
531 $(foreach m, $(ALL_MODULES), \
532   $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \
533   $(foreach d, $(SPECS_$m), \
<span class="line-modified">534     $(if $(call ApplySpecFilter, $(filter $(COPY_SPEC_FILTER), $(call FindFiles, $d))), \</span>
535       $(eval $(call SetupCopyFiles, COPY_$m, \
536           SRC := $d, \
<span class="line-modified">537           FILES := $(call ApplySpecFilter, $(filter $(COPY_SPEC_FILTER), $(call FindFiles, $d))), \</span>
538           DEST := $(DOCS_OUTPUTDIR)/specs/, \
539       )) \
540       $(eval JDK_SPECS_TARGETS += $(COPY_$m)) \
541     ) \
542   ) \
543 )
544 
<span class="line-added">545 # Create copyright footer variables. We need different variables for different</span>
<span class="line-added">546 # relative paths to the copyright.html file. The number 0-2 below represent how</span>
<span class="line-added">547 # many extra directory levels down below the specs dir the specs html file is</span>
<span class="line-added">548 # located.</span>
<span class="line-added">549 SPECS_BOTTOM = &lt;footer class=&quot;legal-footer&quot;&gt;&lt;hr/&gt;$(COPYRIGHT_BOTTOM)&lt;/footer&gt;</span>
<span class="line-added">550 # The legal dir is one ../ below the specs dir, so start with one ../.</span>
<span class="line-added">551 specs_bottom_rel_path := ../</span>
<span class="line-added">552 $(foreach n, 0 1 2, \</span>
<span class="line-added">553   $(eval SPECS_BOTTOM_$n := $(call SPECS_BOTTOM,$(specs_bottom_rel_path))) \</span>
<span class="line-added">554   $(eval specs_bottom_rel_path := $(specs_bottom_rel_path)../) \</span>
<span class="line-added">555 )</span>
<span class="line-added">556 </span>
<span class="line-added">557 SPECS_TOP := $(if $(filter true, $(IS_DRAFT)), &lt;header class=&quot;draft-header&quot;&gt;$(DRAFT_TEXT)&lt;/header&gt;)</span>
<span class="line-added">558 </span>
<span class="line-added">559 # For all html files in $module/share/specs directories, copy and add the</span>
<span class="line-added">560 # copyright footer.</span>
<span class="line-added">561 </span>
<span class="line-added">562 $(foreach m, $(ALL_MODULES), \</span>
<span class="line-added">563   $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \</span>
<span class="line-added">564   $(foreach d, $(SPECS_$m), \</span>
<span class="line-added">565     $(foreach f, $(call ApplySpecFilter, $(filter %.html, $(call FindFiles, $d))), \</span>
<span class="line-added">566       $(eval $m_$f_NOF_SUBDIRS := $(words $(subst /, $(SPACE), $(subst $d, , $(dir $f))))) \</span>
<span class="line-added">567       $(eval $m_$f_NAME := PROCESS_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \</span>
<span class="line-added">568       $(eval $(call SetupTextFileProcessing, $($m_$f_NAME), \</span>
<span class="line-added">569           SOURCE_FILES := $f, \</span>
<span class="line-added">570           SOURCE_BASE_DIR := $d, \</span>
<span class="line-added">571           OUTPUT_DIR := $(DOCS_OUTPUTDIR)/specs/, \</span>
<span class="line-added">572           REPLACEMENTS := \</span>
<span class="line-added">573               &lt;body&gt; =&gt; &lt;body&gt;$(SPECS_TOP) ; \</span>
<span class="line-added">574               &lt;/body&gt; =&gt; $(SPECS_BOTTOM_$($m_$f_NOF_SUBDIRS))&lt;/body&gt;, \</span>
<span class="line-added">575       )) \</span>
<span class="line-added">576       $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \</span>
<span class="line-added">577     ) \</span>
<span class="line-added">578   ) \</span>
<span class="line-added">579 )</span>
<span class="line-added">580 </span>
581 ifeq ($(ENABLE_PANDOC), true)
582   # For all markdown files in $module/share/specs directories, convert them to
583   # html, if we have pandoc (otherwise we&#39;ll just skip this).
584 
585   GLOBAL_SPECS_DEFAULT_CSS_FILE := $(DOCS_OUTPUTDIR)/resources/jdk-default.css
586 
587   $(foreach m, $(ALL_MODULES), \
588     $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \
589     $(foreach d, $(SPECS_$m), \
<span class="line-modified">590       $(foreach f, $(call ApplySpecFilter, $(filter %.md, $(call FindFiles, $d))), \</span>
<span class="line-modified">591         $(eval $m_$f_NOF_SUBDIRS := $(words $(subst /, $(SPACE), $(subst $d, , $(dir $f))))) \</span>
<span class="line-modified">592         $(eval $m_$f_NAME := SPECS_TO_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \</span>
<span class="line-added">593         $(eval $(call SetupProcessMarkdown, $($m_$f_NAME), \</span>
594             SRC := $d, \
<span class="line-modified">595             FILES := $f, \</span>
596             DEST := $(DOCS_OUTPUTDIR)/specs/, \
597             CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \
<span class="line-added">598             OPTIONS := -V include-before=&#39;$(SPECS_TOP)&#39; -V include-after=&#39;$(SPECS_BOTTOM_$($m_$f_NOF_SUBDIRS))&#39;, \</span>
<span class="line-added">599             REPLACEMENTS := \</span>
<span class="line-added">600 		@@VERSION_SPECIFICATION@@ =&gt; $(VERSION_SPECIFICATION) ; \</span>
<span class="line-added">601 		@@VERSION_STRING@@ =&gt; $(VERSION_STRING), \</span>
<span class="line-added">602             POST_PROCESS := $(TOOL_FIXUPPANDOC), \</span>
603         )) \
<span class="line-modified">604         $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \</span>
605       ) \
606     ) \
607   )
608 
609   # For all markdown files in $module/share/man directories, convert them to
610   # html.
611 
612   # Create dynamic man pages from markdown using pandoc. We need
613   # PANDOC_HTML_MANPAGE_FILTER, a wrapper around
614   # PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT. This is created by buildtools-jdk.
615 
616   # We should also depend on the source javascript filter
617   PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT := \
618       $(TOPDIR)/make/scripts/pandoc-html-manpage-filter.js
619 
620   $(foreach m, $(ALL_MODULES), \
621     $(eval MAN_$m := $(call FindModuleManDirs, $m)) \
622     $(foreach d, $(MAN_$m), \
<span class="line-modified">623       $(foreach f, $(call ApplySpecFilter, $(filter %.md, $(call FindFiles, $d))), \</span>
<span class="line-modified">624         $(eval $m_$f_NAME := MAN_TO_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \</span>
<span class="line-modified">625         $(eval $(call SetupProcessMarkdown, $($m_$f_NAME), \</span>
626             SRC := $d, \
<span class="line-modified">627             FILES := $f, \</span>
628             DEST := $(DOCS_OUTPUTDIR)/specs/man, \
629             FILTER := $(PANDOC_HTML_MANPAGE_FILTER), \
630             CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \
<span class="line-modified">631             REPLACEMENTS := \</span>
<span class="line-added">632 		@@COPYRIGHT_YEAR@@ =&gt; $(COPYRIGHT_YEAR) ; \</span>
<span class="line-added">633 		@@VERSION_SHORT@@ =&gt; $(VERSION_SHORT) ; \</span>
<span class="line-added">634 		@@VERSION_SPECIFICATION@@ =&gt; $(VERSION_SPECIFICATION), \</span>
<span class="line-added">635             OPTIONS := --toc -V include-before=&#39;$(SPECS_TOP)&#39; -V include-after=&#39;$(SPECS_BOTTOM_1)&#39;, \</span>
<span class="line-added">636             POST_PROCESS := $(TOOL_FIXUPPANDOC), \</span>
637             EXTRA_DEPS := $(PANDOC_HTML_MANPAGE_FILTER) \
638                 $(PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT), \
639         )) \
<span class="line-modified">640         $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \</span>
641       ) \
642     ) \
643   )
644 
645   # The html generated from markdown also needs the css file
646   JDK_SPECS_TARGETS += $(COPY_GLOBAL_RESOURCES)
647 endif
648 
649 # Special treatment for generated documentation
650 
651 JDWP_PROTOCOL := $(SUPPORT_OUTPUTDIR)/gensrc/jdk.jdi/jdwp-protocol.html
<span class="line-modified">652 ifneq ($(call ApplySpecFilter, $(JDWP_PROTOCOL)), )</span>
<span class="line-modified">653   $(eval $(call SetupTextFileProcessing, PROCESS_JDWP_PROTOCOL, \</span>
<span class="line-modified">654       SOURCE_FILES := $(JDWP_PROTOCOL), \</span>
<span class="line-modified">655       OUTPUT_DIR := $(DOCS_OUTPUTDIR)/specs/jdwp, \</span>
<span class="line-modified">656       REPLACEMENTS := \</span>
<span class="line-added">657           &lt;body&gt; =&gt; &lt;body&gt;$(SPECS_TOP) ; \</span>
<span class="line-added">658           &lt;/body&gt; =&gt; $(SPECS_BOTTOM_1)&lt;/body&gt;, \</span>
<span class="line-added">659   ))</span>
<span class="line-added">660   JDK_SPECS_TARGETS += $(PROCESS_JDWP_PROTOCOL)</span>
<span class="line-added">661 endif</span>
662 
663 # Get jvmti.html from the main jvm variant (all variants&#39; jvmti.html are identical).
664 JVMTI_HTML ?= $(HOTSPOT_OUTPUTDIR)/variant-$(JVM_VARIANT_MAIN)/gensrc/jvmtifiles/jvmti.html
<span class="line-modified">665 ifneq ($(call ApplySpecFilter, $(JVMTI_HTML)), )</span>
<span class="line-modified">666   $(eval $(call SetupTextFileProcessing, PROCESS_JVMTI_HTML, \</span>
<span class="line-modified">667       SOURCE_FILES := $(JVMTI_HTML), \</span>
<span class="line-modified">668       OUTPUT_DIR := $(DOCS_OUTPUTDIR)/specs/, \</span>
<span class="line-modified">669       REPLACEMENTS := \</span>
<span class="line-added">670           &lt;body&gt; =&gt; &lt;body&gt;$(SPECS_TOP) ; \</span>
<span class="line-added">671           &lt;/body&gt; =&gt; $(SPECS_BOTTOM_0)&lt;/body&gt;, \</span>
<span class="line-added">672   ))</span>
<span class="line-added">673   JDK_SPECS_TARGETS += $(PROCESS_JVMTI_HTML)</span>
<span class="line-added">674 endif</span>
675 
676 ################################################################################
677 # Optional target which bundles all generated javadocs into a zip archive.
678 
679 JAVADOC_ZIP_NAME := jdk-$(VERSION_STRING)-docs.zip
680 JAVADOC_ZIP_FILE := $(OUTPUTDIR)/bundles/$(JAVADOC_ZIP_NAME)
681 
682 $(eval $(call SetupZipArchive, BUILD_JAVADOC_ZIP, \
683     SRC := $(DOCS_OUTPUTDIR), \
684     ZIP := $(JAVADOC_ZIP_FILE), \
685     EXTRA_DEPS := $(JDK_API_JAVADOC_TARGETS) $(JDK_API_MODULEGRAPH_TARGETS) \
686         $(JDK_SPECS_TARGETS), \
687 ))
688 
689 ZIP_TARGETS += $(BUILD_JAVADOC_ZIP)
690 
<span class="line-added">691 ################################################################################</span>
<span class="line-added">692 # Hook to include the corresponding custom file, if present.</span>
<span class="line-added">693 $(eval $(call IncludeCustomExtension, Docs-post.gmk))</span>
<span class="line-added">694 </span>
<span class="line-added">695 ################################################################################</span>
<span class="line-added">696 # Bundles all generated specs into a zip archive, skipping javadocs.</span>
<span class="line-added">697 </span>
<span class="line-added">698 SPECS_ZIP_NAME := jdk-$(VERSION_STRING)-specs.zip</span>
<span class="line-added">699 SPECS_ZIP_FILE := $(OUTPUTDIR)/bundles/$(SPECS_ZIP_NAME)</span>
<span class="line-added">700 </span>
<span class="line-added">701 $(eval $(call SetupZipArchive, BUILD_SPECS_ZIP, \</span>
<span class="line-added">702     SRC := $(DOCS_OUTPUTDIR), \</span>
<span class="line-added">703     ZIP := $(SPECS_ZIP_FILE), \</span>
<span class="line-added">704     EXTRA_DEPS := $(JDK_SPECS_TARGETS), \</span>
<span class="line-added">705 ))</span>
<span class="line-added">706 </span>
<span class="line-added">707 SPECS_ZIP_TARGETS += $(BUILD_SPECS_ZIP)</span>
<span class="line-added">708 </span>
709 ################################################################################
710 
711 docs-jdk-api-javadoc: $(JDK_API_JAVADOC_TARGETS) $(JDK_API_CUSTOM_TARGETS)
712 
713 docs-jdk-api-modulegraph: $(JDK_API_MODULEGRAPH_TARGETS)
714 
715 docs-javase-api-javadoc: $(JAVASE_API_JAVADOC_TARGETS) $(JAVASE_API_CUSTOM_TARGETS)
716 
717 docs-javase-api-modulegraph: $(JAVASE_API_MODULEGRAPH_TARGETS)
718 
719 docs-reference-api-javadoc: $(REFERENCE_API_JAVADOC_TARGETS) $(REFERENCE_API_CUSTOM_TARGETS)
720 
721 docs-reference-api-modulegraph: $(REFERENCE_API_MODULEGRAPH_TARGETS)
722 
723 docs-jdk-specs: $(JDK_SPECS_TARGETS)
724 
725 docs-jdk-index: $(JDK_INDEX_TARGETS)
726 
727 docs-zip: $(ZIP_TARGETS)
728 
<span class="line-added">729 docs-specs-zip: $(SPECS_ZIP_TARGETS)</span>
<span class="line-added">730 </span>
731 all: docs-jdk-api-javadoc docs-jdk-api-modulegraph docs-javase-api-javadoc \
732     docs-javase-api-modulegraph docs-reference-api-javadoc \
<span class="line-modified">733     docs-reference-api-modulegraph docs-jdk-specs docs-jdk-index docs-zip \</span>
<span class="line-added">734     docs-specs-zip</span>
735 
736 .PHONY: default all docs-jdk-api-javadoc docs-jdk-api-modulegraph \
737     docs-javase-api-javadoc docs-javase-api-modulegraph \
738     docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \
<span class="line-modified">739     docs-jdk-index docs-zip docs-specs-zip</span>
</pre>
</td>
</tr>
</table>
<center><a href="CreateJmods.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="ExplodedImageOptimize.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>