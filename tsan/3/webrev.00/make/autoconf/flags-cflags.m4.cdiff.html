<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/autoconf/flags-cflags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="configure.ac.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags-cflags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  #
<span class="line-modified">! # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  #
<span class="line-modified">! # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 119,17 ***</span>
      ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
      # -g0 enables debug symbols without disabling inlining.
      CFLAGS_DEBUG_SYMBOLS=&quot;-g0 -xs&quot;
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
<span class="line-modified">!     if test &quot;x$XLC_USES_CLANG&quot; = xtrue; then</span>
<span class="line-removed">-       CFLAGS_DEBUG_SYMBOLS=&quot;-g1&quot;</span>
<span class="line-removed">-     else</span>
<span class="line-removed">-       CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;</span>
<span class="line-removed">-     fi</span>
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
<span class="line-modified">!     CFLAGS_DEBUG_SYMBOLS=&quot;-Z7 -d2Zi+&quot;</span>
    fi
  
    AC_SUBST(CFLAGS_DEBUG_SYMBOLS)
    AC_SUBST(ASFLAGS_DEBUG_SYMBOLS)
  ])
<span class="line-new-header">--- 119,13 ---</span>
      ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
      # -g0 enables debug symbols without disabling inlining.
      CFLAGS_DEBUG_SYMBOLS=&quot;-g0 -xs&quot;
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
<span class="line-modified">!     CFLAGS_DEBUG_SYMBOLS=&quot;-g1&quot;</span>
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
<span class="line-modified">!     CFLAGS_DEBUG_SYMBOLS=&quot;-Z7&quot;</span>
    fi
  
    AC_SUBST(CFLAGS_DEBUG_SYMBOLS)
    AC_SUBST(ASFLAGS_DEBUG_SYMBOLS)
  ])
</pre>
<hr />
<pre>
<span class="line-old-header">*** 172,15 ***</span>
  
      solstudio)
        DISABLE_WARNING_PREFIX=&quot;-erroff=&quot;
        CFLAGS_WARNINGS_ARE_ERRORS=&quot;-errwarn=%all&quot;
  
<span class="line-modified">!       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-v&quot;</span>
<span class="line-modified">!       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;+w&quot;</span>
  
<span class="line-modified">!       DISABLED_WARNINGS_C=&quot;&quot;</span>
<span class="line-modified">!       DISABLED_WARNINGS_CXX=&quot;&quot;</span>
        ;;
  
      gcc)
        DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
        CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
<span class="line-new-header">--- 168,15 ---</span>
  
      solstudio)
        DISABLE_WARNING_PREFIX=&quot;-erroff=&quot;
        CFLAGS_WARNINGS_ARE_ERRORS=&quot;-errwarn=%all&quot;
  
<span class="line-modified">!       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-v -fd -xtransition&quot;</span>
<span class="line-modified">!       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;+w +w2&quot;</span>
  
<span class="line-modified">!       DISABLED_WARNINGS_C=&quot;E_OLD_STYLE_FUNC_DECL E_OLD_STYLE_FUNC_DEF E_SEMANTICS_OF_OP_CHG_IN_ANSI_C E_NO_REPLACEMENT_IN_STRING E_DECLARATION_IN_CODE&quot;</span>
<span class="line-modified">!       DISABLED_WARNINGS_CXX=&quot;inllargeuse inllargeint notused wemptydecl notemsource&quot;</span>
        ;;
  
      gcc)
        DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
        CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 192,24 ***</span>
        WARNINGS_ENABLE_ADDITIONAL_CXX=&quot;-Woverloaded-virtual -Wreorder&quot;
        WARNINGS_ENABLE_ALL_CFLAGS=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
        WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;$WARNINGS_ENABLE_ALL_CFLAGS $WARNINGS_ENABLE_ADDITIONAL_CXX&quot;
  
        DISABLED_WARNINGS=&quot;unused-parameter unused&quot;
<span class="line-removed">- </span>
<span class="line-removed">-       # Repeate the check for the BUILD_CC and BUILD_CXX. Need to also reset</span>
<span class="line-removed">-       # CFLAGS since any target specific flags will likely not work with the</span>
<span class="line-removed">-       # build compiler</span>
<span class="line-removed">-       CC_OLD=&quot;$CC&quot;</span>
<span class="line-removed">-       CXX_OLD=&quot;$CXX&quot;</span>
<span class="line-removed">-       CC=&quot;$BUILD_CC&quot;</span>
<span class="line-removed">-       CXX=&quot;$BUILD_CXX&quot;</span>
<span class="line-removed">-       CFLAGS_OLD=&quot;$CFLAGS&quot;</span>
<span class="line-removed">-       CFLAGS=&quot;&quot;</span>
        BUILD_CC_DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
<span class="line-removed">-       CC=&quot;$CC_OLD&quot;</span>
<span class="line-removed">-       CXX=&quot;$CXX_OLD&quot;</span>
<span class="line-removed">-       CFLAGS=&quot;$CFLAGS_OLD&quot;</span>
        ;;
  
      clang)
        DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
        CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
<span class="line-new-header">--- 188,11 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 217,21 ***</span>
        # Additional warnings that are not activated by -Wall and -Wextra
        WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare -Wreorder \
            -Wunused-function -Wundef -Wunused-value -Woverloaded-virtual&quot;
        WARNINGS_ENABLE_ALL=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
  
<span class="line-modified">!       DISABLED_WARNINGS=&quot;unused-parameter unused&quot;</span>
  
        if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
          # missing-method-return-type triggers in JavaNativeFoundation framework
          DISABLED_WARNINGS=&quot;$DISABLED_WARNINGS missing-method-return-type&quot;
        fi
  
        ;;
  
      xlc)
<span class="line-modified">!       DISABLE_WARNING_PREFIX=&quot;-qsuppress=&quot;</span>
        CFLAGS_WARNINGS_ARE_ERRORS=&quot;-qhalt=w&quot;
  
        # Possibly a better subset than &quot;all&quot; is &quot;lan:trx:ret:zea:cmp:ret&quot;
        WARNINGS_ENABLE_ALL=&quot;-qinfo=all -qformat=all&quot;
        DISABLED_WARNINGS=&quot;&quot;
<span class="line-new-header">--- 200,21 ---</span>
        # Additional warnings that are not activated by -Wall and -Wextra
        WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare -Wreorder \
            -Wunused-function -Wundef -Wunused-value -Woverloaded-virtual&quot;
        WARNINGS_ENABLE_ALL=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
  
<span class="line-modified">!       DISABLED_WARNINGS=&quot;unknown-warning-option unused-parameter unused&quot;</span>
  
        if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
          # missing-method-return-type triggers in JavaNativeFoundation framework
          DISABLED_WARNINGS=&quot;$DISABLED_WARNINGS missing-method-return-type&quot;
        fi
  
        ;;
  
      xlc)
<span class="line-modified">!       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;</span>
        CFLAGS_WARNINGS_ARE_ERRORS=&quot;-qhalt=w&quot;
  
        # Possibly a better subset than &quot;all&quot; is &quot;lan:trx:ret:zea:cmp:ret&quot;
        WARNINGS_ENABLE_ALL=&quot;-qinfo=all -qformat=all&quot;
        DISABLED_WARNINGS=&quot;&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 298,10 ***</span>
<span class="line-new-header">--- 281,24 ---</span>
      C_O_FLAG_NORM=&quot;-O2&quot;
      C_O_FLAG_SIZE=&quot;-Os&quot;
      C_O_FLAG_DEBUG=&quot;-O0&quot;
      C_O_FLAG_DEBUG_JVM=&quot;-O0&quot;
      C_O_FLAG_NONE=&quot;-O0&quot;
<span class="line-added">+     # -D_FORTIFY_SOURCE=2 hardening option needs optimization (at least -O1) enabled</span>
<span class="line-added">+     # set for lower O-levels -U_FORTIFY_SOURCE to overwrite previous settings</span>
<span class="line-added">+     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux -a &quot;x$DEBUG_LEVEL&quot; = &quot;xfastdebug&quot;; then</span>
<span class="line-added">+       ENABLE_FORTIFY_CFLAGS=&quot;-D_FORTIFY_SOURCE=2&quot;</span>
<span class="line-added">+       DISABLE_FORTIFY_CFLAGS=&quot;-U_FORTIFY_SOURCE&quot;</span>
<span class="line-added">+       C_O_FLAG_HIGHEST_JVM=&quot;${C_O_FLAG_HIGHEST_JVM} ${ENABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">+       C_O_FLAG_HIGHEST=&quot;${C_O_FLAG_HIGHEST} ${ENABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">+       C_O_FLAG_HI=&quot;${C_O_FLAG_HI} ${ENABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">+       C_O_FLAG_NORM=&quot;${C_O_FLAG_NORM} ${ENABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">+       C_O_FLAG_SIZE=&quot;${C_O_FLAG_SIZE} ${DISABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">+       C_O_FLAG_DEBUG=&quot;${C_O_FLAG_DEBUG} ${DISABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">+       C_O_FLAG_DEBUG_JVM=&quot;${C_O_FLAG_DEBUG_JVM} ${DISABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">+       C_O_FLAG_NONE=&quot;${C_O_FLAG_NONE} ${DISABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">+     fi</span>
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
      if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
        # On MacOSX we optimize for size, something
        # we should do for all platforms?
        C_O_FLAG_HIGHEST_JVM=&quot;-Os&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 408,20 ***</span>
<span class="line-new-header">--- 405,36 ---</span>
    FLAGS_CPU_LEGACY=$OPENJDK_TARGET_CPU_LEGACY
    FLAGS_CPU_LEGACY_LIB=$OPENJDK_TARGET_CPU_LEGACY_LIB
  
    FLAGS_SETUP_CFLAGS_CPU_DEP([TARGET])
  
<span class="line-added">+   # Repeat the check for the BUILD_CC and BUILD_CXX. Need to also reset CFLAGS</span>
<span class="line-added">+   # since any target specific flags will likely not work with the build compiler.</span>
<span class="line-added">+   CC_OLD=&quot;$CC&quot;</span>
<span class="line-added">+   CXX_OLD=&quot;$CXX&quot;</span>
<span class="line-added">+   CFLAGS_OLD=&quot;$CFLAGS&quot;</span>
<span class="line-added">+   CXXFLAGS_OLD=&quot;$CXXFLAGS&quot;</span>
<span class="line-added">+   CC=&quot;$BUILD_CC&quot;</span>
<span class="line-added">+   CXX=&quot;$BUILD_CXX&quot;</span>
<span class="line-added">+   CFLAGS=&quot;&quot;</span>
<span class="line-added">+   CXXFLAGS=&quot;&quot;</span>
<span class="line-added">+ </span>
    FLAGS_OS=$OPENJDK_BUILD_OS
    FLAGS_OS_TYPE=$OPENJDK_BUILD_OS_TYPE
    FLAGS_CPU=$OPENJDK_BUILD_CPU
    FLAGS_CPU_ARCH=$OPENJDK_BUILD_CPU_ARCH
    FLAGS_CPU_BITS=$OPENJDK_BUILD_CPU_BITS
    FLAGS_CPU_ENDIAN=$OPENJDK_BUILD_CPU_ENDIAN
    FLAGS_CPU_LEGACY=$OPENJDK_BUILD_CPU_LEGACY
    FLAGS_CPU_LEGACY_LIB=$OPENJDK_BUILD_CPU_LEGACY_LIB
  
    FLAGS_SETUP_CFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_], [BUILD_])
<span class="line-added">+ </span>
<span class="line-added">+   CC=&quot;$CC_OLD&quot;</span>
<span class="line-added">+   CXX=&quot;$CXX_OLD&quot;</span>
<span class="line-added">+   CFLAGS=&quot;$CFLAGS_OLD&quot;</span>
<span class="line-added">+   CXXFLAGS=&quot;$CXXFLAGS_OLD&quot;</span>
  ])
  
  ################################################################################
  # platform independent
  AC_DEFUN([FLAGS_SETUP_CFLAGS_HELPER],
</pre>
<hr />
<pre>
<span class="line-old-header">*** 517,10 ***</span>
<span class="line-new-header">--- 530,18 ---</span>
    fi
  
    if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
      TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -fcheck-new -fstack-protector&quot;
      TOOLCHAIN_CFLAGS_JDK=&quot;-pipe -fstack-protector&quot;
<span class="line-added">+     # reduce lib size on linux in link step, this needs also special compile flags</span>
<span class="line-added">+     # do this on s390x also for libjvm (where serviceability agent is not supported)</span>
<span class="line-added">+     if test &quot;x$ENABLE_LINKTIME_GC&quot; = xtrue; then</span>
<span class="line-added">+       TOOLCHAIN_CFLAGS_JDK=&quot;$TOOLCHAIN_CFLAGS_JDK -ffunction-sections -fdata-sections&quot;</span>
<span class="line-added">+       if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then</span>
<span class="line-added">+         TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -ffunction-sections -fdata-sections&quot;</span>
<span class="line-added">+       fi</span>
<span class="line-added">+     fi</span>
      # technically NOT for CXX (but since this gives *worse* performance, use
      # no-strict-aliasing everywhere!)
      TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot;
  
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
</pre>
<hr />
<pre>
<span class="line-old-header">*** 534,19 ***</span>
      # src/hotspot/cpu/*/globalDefinitions_*.hpp files, but this value currently
      # works for all platforms.
      TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mno-omit-leaf-frame-pointer -mstack-alignment=16&quot;
  
      if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
        TOOLCHAIN_CFLAGS_JDK=&quot;-pipe&quot;
        TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot; # technically NOT for CXX
      fi
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
      TOOLCHAIN_FLAGS=&quot;-errtags -errfmt&quot;
      TOOLCHAIN_CFLAGS=&quot;-errshort=tags&quot;
  
      TOOLCHAIN_CFLAGS_JDK=&quot;-mt $TOOLCHAIN_FLAGS&quot;
<span class="line-modified">!     TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-xCC -Xa -W0,-noglobal $TOOLCHAIN_CFLAGS&quot; # C only</span>
      TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;-features=no%except -norunpath -xnolib&quot; # CXX only
      TOOLCHAIN_CFLAGS_JVM=&quot;-template=no%extdef -features=no%split_init \
          -library=stlport4 -mt -features=no%except $TOOLCHAIN_FLAGS&quot;
      if test &quot;x$DEBUG_LEVEL&quot; = xslowdebug; then
        # Previously -g was used instead of -g0 for slowdebug; this is equivalent
<span class="line-new-header">--- 555,25 ---</span>
      # src/hotspot/cpu/*/globalDefinitions_*.hpp files, but this value currently
      # works for all platforms.
      TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mno-omit-leaf-frame-pointer -mstack-alignment=16&quot;
  
      if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
<span class="line-added">+       if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then</span>
<span class="line-added">+         # Clang does not inline as much as GCC does for functions with &quot;inline&quot; keyword by default.</span>
<span class="line-added">+         # This causes noticeable slowdown in pause time for G1, and possibly in other areas.</span>
<span class="line-added">+         # Increasing the inline hint threshold avoids the slowdown for Clang-built JVM.</span>
<span class="line-added">+         TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mllvm -inlinehint-threshold=100000&quot;</span>
<span class="line-added">+       fi</span>
        TOOLCHAIN_CFLAGS_JDK=&quot;-pipe&quot;
        TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot; # technically NOT for CXX
      fi
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
      TOOLCHAIN_FLAGS=&quot;-errtags -errfmt&quot;
      TOOLCHAIN_CFLAGS=&quot;-errshort=tags&quot;
  
      TOOLCHAIN_CFLAGS_JDK=&quot;-mt $TOOLCHAIN_FLAGS&quot;
<span class="line-modified">!     TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-W0,-noglobal $TOOLCHAIN_CFLAGS&quot; # C only</span>
      TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;-features=no%except -norunpath -xnolib&quot; # CXX only
      TOOLCHAIN_CFLAGS_JVM=&quot;-template=no%extdef -features=no%split_init \
          -library=stlport4 -mt -features=no%except $TOOLCHAIN_FLAGS&quot;
      if test &quot;x$DEBUG_LEVEL&quot; = xslowdebug; then
        # Previously -g was used instead of -g0 for slowdebug; this is equivalent
</pre>
<hr />
<pre>
<span class="line-old-header">*** 554,19 ***</span>
        TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM +d&quot;
      fi
  
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
      # Suggested additions: -qsrcmsg to get improved error reporting
<span class="line-modified">!     TOOLCHAIN_CFLAGS_JDK=&quot;-qchars=signed -qfullpath -qsaveopt -qstackprotect&quot;  # add on both CFLAGS</span>
<span class="line-modified">!     TOOLCHAIN_CFLAGS_JVM=&quot;-qtune=balanced \</span>
<span class="line-modified">!         -qalias=noansi -qstrict -qtls=default -qlanglvl=c99vla \</span>
<span class="line-modified">!         -qlanglvl=noredefmac -qnortti -qnoeh -qignerrno -qstackprotect&quot;</span>
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
      TOOLCHAIN_CFLAGS_JVM=&quot;-nologo -MD -MP&quot;
      TOOLCHAIN_CFLAGS_JDK=&quot;-nologo -MD -Zc:wchar_t-&quot;
    fi
  
    # CFLAGS WARNINGS STUFF
    # Set JVM_CFLAGS warning handling
    if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
      WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;
      WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
<span class="line-new-header">--- 581,42 ---</span>
        TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM +d&quot;
      fi
  
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
      # Suggested additions: -qsrcmsg to get improved error reporting
<span class="line-modified">!     # set -qtbtable=full for a better traceback table/better stacks in hs_err when xlc16 is used</span>
<span class="line-modified">!     TOOLCHAIN_CFLAGS_JDK=&quot;-qtbtable=full -qchars=signed -qfullpath -qsaveopt -qstackprotect&quot;  # add on both CFLAGS</span>
<span class="line-modified">!     TOOLCHAIN_CFLAGS_JVM=&quot;-qtbtable=full -qtune=balanced \</span>
<span class="line-modified">!         -qalias=noansi -qstrict -qtls=default -qnortti -qnoeh -qignerrno -qstackprotect&quot;</span>
    elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
      TOOLCHAIN_CFLAGS_JVM=&quot;-nologo -MD -MP&quot;
      TOOLCHAIN_CFLAGS_JDK=&quot;-nologo -MD -Zc:wchar_t-&quot;
    fi
  
<span class="line-added">+   # CFLAGS C language level for JDK sources (hotspot only uses C++)</span>
<span class="line-added">+   # Ideally we would have a common level across all toolchains so that all sources</span>
<span class="line-added">+   # are sure to conform to the same standard. Unfortunately neither our sources nor</span>
<span class="line-added">+   # our toolchains are in a condition to support that. But what we loosely aim for is</span>
<span class="line-added">+   # C99 level.</span>
<span class="line-added">+   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then</span>
<span class="line-added">+     # Explicitly set C99. clang and xlclang support the same flag.</span>
<span class="line-added">+     LANGSTD_CFLAGS=&quot;-std=c99&quot;</span>
<span class="line-added">+   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-added">+     # We can&#39;t turn on -std=c99 without breaking compilation of the splashscreen/png</span>
<span class="line-added">+     # utilities. But we can enable c99 as below (previously achieved by using -Xa).</span>
<span class="line-added">+     # It is the no_lib that makes the difference.</span>
<span class="line-added">+     LANGSTD_CFLAGS=&quot;-xc99=all,no_lib&quot;</span>
<span class="line-added">+   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then</span>
<span class="line-added">+     # MSVC doesn&#39;t support C99/C11 explicitly, unless you compile as C++:</span>
<span class="line-added">+     # LANGSTD_CFLAGS=&quot;-TP&quot;</span>
<span class="line-added">+     # but that requires numerous changes to the sources files. So we are limited</span>
<span class="line-added">+     # to C89/C90 plus whatever extensions Visual Studio has decided to implement.</span>
<span class="line-added">+     # This is the lowest bar for shared code.</span>
<span class="line-added">+     LANGSTD_CFLAGS=&quot;&quot;</span>
<span class="line-added">+   fi</span>
<span class="line-added">+   TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;$LANGSTD_CFLAGS $TOOLCHAIN_CFLAGS_JDK_CONLY&quot;</span>
<span class="line-added">+ </span>
    # CFLAGS WARNINGS STUFF
    # Set JVM_CFLAGS warning handling
    if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
      WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;
      WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 652,10 ***</span>
<span class="line-new-header">--- 702,24 ---</span>
      OS_CFLAGS_JVM=&quot;$OS_CFLAGS_JVM -DSUPPORTS_CLOCK_MONOTONIC&quot;
      if test &quot;x$CLOCK_GETTIME_IN_LIBRT&quot; = &quot;xtrue&quot;; then
        OS_CFLAGS_JVM=&quot;$OS_CFLAGS_JVM -DNEEDS_LIBRT&quot;
      fi
    fi
<span class="line-added">+ </span>
<span class="line-added">+   # Extra flags needed when building optional static versions of certain</span>
<span class="line-added">+   # JDK libraries.</span>
<span class="line-added">+   STATIC_LIBS_CFLAGS=&quot;-DSTATIC_BUILD=1&quot;</span>
<span class="line-added">+   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then</span>
<span class="line-added">+     STATIC_LIBS_CFLAGS=&quot;$STATIC_LIBS_CFLAGS -ffunction-sections -fdata-sections&quot;</span>
<span class="line-added">+   fi</span>
<span class="line-added">+   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then</span>
<span class="line-added">+     # Disable relax-relocation to enable compatibility with older linkers</span>
<span class="line-added">+     RELAX_RELOCATIONS_FLAG=&quot;-Xassembler -mrelax-relocations=no&quot;</span>
<span class="line-added">+     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${RELAX_RELOCATIONS_FLAG}],</span>
<span class="line-added">+         IF_TRUE: [STATIC_LIBS_CFLAGS=&quot;$STATIC_LIBS_CFLAGS ${RELAX_RELOCATIONS_FLAG}&quot;])</span>
<span class="line-added">+   fi</span>
<span class="line-added">+   AC_SUBST(STATIC_LIBS_CFLAGS)</span>
  ])
  
  ################################################################################
  # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
  #      conditionals against.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 749,11 ***</span>
        # for all archs except arm and ppc, prevent gcc to omit frame pointer
        $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
      fi
  
      $1_CXXSTD_CXXFLAG=&quot;-std=gnu++98&quot;
<span class="line-modified">!     FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${$1_CXXSTD_CXXFLAG} -Werror],</span>
          PREFIX: $3, IF_FALSE: [$1_CXXSTD_CXXFLAG=&quot;&quot;])
      $1_TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;${$1_CXXSTD_CXXFLAG}&quot;
      $1_TOOLCHAIN_CFLAGS_JVM=&quot;${$1_TOOLCHAIN_CFLAGS_JVM} ${$1_CXXSTD_CXXFLAG}&quot;
      $2ADLC_CXXFLAG=&quot;${$1_CXXSTD_CXXFLAG}&quot;
  
<span class="line-new-header">--- 813,11 ---</span>
        # for all archs except arm and ppc, prevent gcc to omit frame pointer
        $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
      fi
  
      $1_CXXSTD_CXXFLAG=&quot;-std=gnu++98&quot;
<span class="line-modified">!     FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${$1_CXXSTD_CXXFLAG}],</span>
          PREFIX: $3, IF_FALSE: [$1_CXXSTD_CXXFLAG=&quot;&quot;])
      $1_TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;${$1_CXXSTD_CXXFLAG}&quot;
      $1_TOOLCHAIN_CFLAGS_JVM=&quot;${$1_TOOLCHAIN_CFLAGS_JVM} ${$1_CXXSTD_CXXFLAG}&quot;
      $2ADLC_CXXFLAG=&quot;${$1_CXXSTD_CXXFLAG}&quot;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 797,19 ***</span>
      $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
  
      $1_WARNING_CFLAGS_JVM=&quot;-Wno-format-zero-length -Wtype-limits -Wuninitialized&quot;
    fi
  
    # EXPORT to API
    CFLAGS_JVM_COMMON=&quot;$ALWAYS_CFLAGS_JVM $ALWAYS_DEFINES_JVM \
        $TOOLCHAIN_CFLAGS_JVM ${$1_TOOLCHAIN_CFLAGS_JVM} \
        $OS_CFLAGS $OS_CFLAGS_JVM $CFLAGS_OS_DEF_JVM $DEBUG_CFLAGS_JVM \
<span class="line-modified">!       $WARNING_CFLAGS $WARNING_CFLAGS_JVM $JVM_PICFLAG&quot;</span>
  
    CFLAGS_JDK_COMMON=&quot;$ALWAYS_CFLAGS_JDK $ALWAYS_DEFINES_JDK $TOOLCHAIN_CFLAGS_JDK \
        $OS_CFLAGS $CFLAGS_OS_DEF_JDK $DEBUG_CFLAGS_JDK $DEBUG_OPTIONS_FLAGS_JDK \
<span class="line-modified">!       $WARNING_CFLAGS $WARNING_CFLAGS_JDK $DEBUG_SYMBOLS_CFLAGS_JDK&quot;</span>
  
    # Use ${$2EXTRA_CFLAGS} to block EXTRA_CFLAGS to be added to build flags.
    # (Currently we don&#39;t have any OPENJDK_BUILD_EXTRA_CFLAGS, but that might
    # change in the future.)
  
<span class="line-new-header">--- 861,33 ---</span>
      $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
  
      $1_WARNING_CFLAGS_JVM=&quot;-Wno-format-zero-length -Wtype-limits -Wuninitialized&quot;
    fi
  
<span class="line-added">+   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then</span>
<span class="line-added">+     # Check if compiler supports -fmacro-prefix-map. If so, use that to make</span>
<span class="line-added">+     # the __FILE__ macro resolve to paths relative to the workspace root.</span>
<span class="line-added">+     workspace_root_trailing_slash=&quot;${WORKSPACE_ROOT%/}/&quot;</span>
<span class="line-added">+     FILE_MACRO_CFLAGS=&quot;-fmacro-prefix-map=${workspace_root_trailing_slash}=&quot;</span>
<span class="line-added">+     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${FILE_MACRO_CFLAGS}],</span>
<span class="line-added">+         PREFIX: $3,</span>
<span class="line-added">+         IF_FALSE: [</span>
<span class="line-added">+             FILE_MACRO_CFLAGS=</span>
<span class="line-added">+         ]</span>
<span class="line-added">+     )</span>
<span class="line-added">+   fi</span>
<span class="line-added">+ </span>
    # EXPORT to API
    CFLAGS_JVM_COMMON=&quot;$ALWAYS_CFLAGS_JVM $ALWAYS_DEFINES_JVM \
        $TOOLCHAIN_CFLAGS_JVM ${$1_TOOLCHAIN_CFLAGS_JVM} \
        $OS_CFLAGS $OS_CFLAGS_JVM $CFLAGS_OS_DEF_JVM $DEBUG_CFLAGS_JVM \
<span class="line-modified">!       $WARNING_CFLAGS $WARNING_CFLAGS_JVM $JVM_PICFLAG $FILE_MACRO_CFLAGS&quot;</span>
  
    CFLAGS_JDK_COMMON=&quot;$ALWAYS_CFLAGS_JDK $ALWAYS_DEFINES_JDK $TOOLCHAIN_CFLAGS_JDK \
        $OS_CFLAGS $CFLAGS_OS_DEF_JDK $DEBUG_CFLAGS_JDK $DEBUG_OPTIONS_FLAGS_JDK \
<span class="line-modified">!       $WARNING_CFLAGS $WARNING_CFLAGS_JDK $DEBUG_SYMBOLS_CFLAGS_JDK \</span>
<span class="line-added">+       $FILE_MACRO_CFLAGS&quot;</span>
  
    # Use ${$2EXTRA_CFLAGS} to block EXTRA_CFLAGS to be added to build flags.
    # (Currently we don&#39;t have any OPENJDK_BUILD_EXTRA_CFLAGS, but that might
    # change in the future.)
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 862,14 ***</span>
    # These flags are required for GCC 6 builds as undefined behaviour in OpenJDK code
    # runs afoul of the more aggressive versions of these optimisations.
    # Notably, value range propagation now assumes that the this pointer of C++
    # member functions is non-null.
    NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;-fno-delete-null-pointer-checks&quot;
<span class="line-modified">!   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_DELETE_NULL_POINTER_CHECKS_CFLAG -Werror],</span>
        PREFIX: $2, IF_FALSE: [NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;&quot;])
    NO_LIFETIME_DSE_CFLAG=&quot;-fno-lifetime-dse&quot;
<span class="line-modified">!   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_LIFETIME_DSE_CFLAG -Werror],</span>
        PREFIX: $2, IF_FALSE: [NO_LIFETIME_DSE_CFLAG=&quot;&quot;])
    $1_GCC6_CFLAGS=&quot;${NO_DELETE_NULL_POINTER_CHECKS_CFLAG} ${NO_LIFETIME_DSE_CFLAG}&quot;
  ])
  
  # Documentation on common flags used for solstudio in HIGHEST.
<span class="line-new-header">--- 940,14 ---</span>
    # These flags are required for GCC 6 builds as undefined behaviour in OpenJDK code
    # runs afoul of the more aggressive versions of these optimisations.
    # Notably, value range propagation now assumes that the this pointer of C++
    # member functions is non-null.
    NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;-fno-delete-null-pointer-checks&quot;
<span class="line-modified">!   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_DELETE_NULL_POINTER_CHECKS_CFLAG],</span>
        PREFIX: $2, IF_FALSE: [NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;&quot;])
    NO_LIFETIME_DSE_CFLAG=&quot;-fno-lifetime-dse&quot;
<span class="line-modified">!   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_LIFETIME_DSE_CFLAG],</span>
        PREFIX: $2, IF_FALSE: [NO_LIFETIME_DSE_CFLAG=&quot;&quot;])
    $1_GCC6_CFLAGS=&quot;${NO_DELETE_NULL_POINTER_CHECKS_CFLAG} ${NO_LIFETIME_DSE_CFLAG}&quot;
  ])
  
  # Documentation on common flags used for solstudio in HIGHEST.
</pre>
<center><a href="configure.ac.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>