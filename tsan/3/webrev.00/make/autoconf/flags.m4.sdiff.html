<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/flags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="flags-other.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="help.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 32 # Setup ABI profile (for arm)
 33 #
 34 AC_DEFUN([FLAGS_SETUP_ABI_PROFILE],
 35 [
 36   AC_ARG_WITH(abi-profile, [AS_HELP_STRING([--with-abi-profile],
 37       [specify ABI profile for ARM builds (arm-vfp-sflt,arm-vfp-hflt,arm-sflt, armv5-vfp-sflt,armv6-vfp-hflt,aarch64) @&lt;:@toolchain dependent@:&gt;@ ])])
 38 
 39   if test &quot;x$with_abi_profile&quot; != x; then
 40     if test &quot;x$OPENJDK_TARGET_CPU&quot; != xarm &amp;&amp; \
 41         test &quot;x$OPENJDK_TARGET_CPU&quot; != xaarch64; then
 42       AC_MSG_ERROR([--with-abi-profile only available on arm/aarch64])
 43     fi
 44 
 45     OPENJDK_TARGET_ABI_PROFILE=$with_abi_profile
 46     AC_MSG_CHECKING([for ABI profle])
 47     AC_MSG_RESULT([$OPENJDK_TARGET_ABI_PROFILE])
 48 
 49     # --- Arm-sflt CFLAGS and ASFLAGS ---
 50     # Armv5te is required for assembler, because pld insn used in arm32 hotspot is only in v5E and above.
 51     # However, there is also a GCC bug which generates unaligned strd/ldrd instructions on armv5te:
<span class="line-modified"> 52     # https://gcc.gnu.org/bugzilla/show_bug.cgi?id=82445, and it was fixed only quite recently.</span>
 53     # The resulting compromise is to enable v5TE for assembler and let GCC generate code for v5T.
 54     if test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-vfp-sflt; then
 55       ARM_FLOAT_TYPE=vfp-sflt
 56       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv7-a -mthumb&#39;
 57       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv7-a -mthumb&#39;
 58     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-vfp-hflt; then
 59       ARM_FLOAT_TYPE=vfp-hflt
 60       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv7-a -mthumb&#39;
 61       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv7-a -mthumb&#39;
 62     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-sflt; then
 63       ARM_FLOAT_TYPE=sflt
 64       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv5t -marm&#39;
 65       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv5te&#39;
 66     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarmv5-vfp-sflt; then
 67       ARM_FLOAT_TYPE=vfp-sflt
 68       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv5t -marm&#39;
 69       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv5te&#39;
 70     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarmv6-vfp-hflt; then
 71       ARM_FLOAT_TYPE=vfp-hflt
 72       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv6 -marm&#39;
</pre>
<hr />
<pre>
159     AC_SUBST(MACOSX_VERSION_MAX)
160   fi
161 ])
162 
163 # Reset the global CFLAGS/LDFLAGS variables and initialize them with the
164 # corresponding configure arguments instead
165 AC_DEFUN_ONCE([FLAGS_SETUP_USER_SUPPLIED_FLAGS],
166 [
167   if test &quot;x$CFLAGS&quot; != &quot;x&quot;; then
168     AC_MSG_WARN([Ignoring CFLAGS($CFLAGS) found in environment. Use --with-extra-cflags])
169   fi
170 
171   if test &quot;x$CXXFLAGS&quot; != &quot;x&quot;; then
172     AC_MSG_WARN([Ignoring CXXFLAGS($CXXFLAGS) found in environment. Use --with-extra-cxxflags])
173   fi
174 
175   if test &quot;x$LDFLAGS&quot; != &quot;x&quot;; then
176     AC_MSG_WARN([Ignoring LDFLAGS($LDFLAGS) found in environment. Use --with-extra-ldflags])
177   fi
178 




179   AC_ARG_WITH(extra-cflags, [AS_HELP_STRING([--with-extra-cflags],
180       [extra flags to be used when compiling jdk c-files])])
181 
182   AC_ARG_WITH(extra-cxxflags, [AS_HELP_STRING([--with-extra-cxxflags],
183       [extra flags to be used when compiling jdk c++-files])])
184 
185   AC_ARG_WITH(extra-ldflags, [AS_HELP_STRING([--with-extra-ldflags],
186       [extra flags to be used when linking jdk])])
187 



188   USER_CFLAGS=&quot;$with_extra_cflags&quot;
189   USER_CXXFLAGS=&quot;$with_extra_cxxflags&quot;
190   USER_LDFLAGS=&quot;$with_extra_ldflags&quot;

191 ])
192 
193 # Setup the sysroot flags and add them to global CFLAGS and LDFLAGS so
194 # that configure can use them while detecting compilers.
195 # TOOLCHAIN_TYPE is available here.
196 # Param 1 - Optional prefix to all variables. (e.g BUILD_)
197 AC_DEFUN([FLAGS_SETUP_SYSROOT_FLAGS],
198 [
199   if test &quot;x[$]$1SYSROOT&quot; != &quot;x&quot;; then
200     if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
201       if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then
202         # Solaris Studio does not have a concept of sysroot. Instead we must
203         # make sure the default include and lib dirs are appended to each
204         # compile and link command line. Must also add -I-xbuiltin to enable
205         # inlining of system functions and intrinsics.
206         $1SYSROOT_CFLAGS=&quot;-I-xbuiltin -I[$]$1SYSROOT/usr/include&quot;
207         $1SYSROOT_LDFLAGS=&quot;-L[$]$1SYSROOT/usr/lib$OPENJDK_TARGET_CPU_ISADIR \
208             -L[$]$1SYSROOT/lib$OPENJDK_TARGET_CPU_ISADIR&quot;
209         # If the devkit contains the ld linker, make sure we use it.
210         AC_PATH_PROG(SOLARIS_LD, ld, , $DEVKIT_TOOLCHAIN_PATH:$DEVKIT_EXTRA_PATH)
</pre>
<hr />
<pre>
263     fi
264   fi
265 
266   # FIXME: global flags are not used yet...
267   # The &quot;global&quot; flags will *always* be set. Without them, it is not possible to
268   # get a working compilation.
269   GLOBAL_CFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CFLAGS&quot;
270   GLOBAL_CXXFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CXXFLAGS&quot;
271   GLOBAL_LDFLAGS=&quot;$MACHINE_FLAG $SYSROOT_LDFLAGS $USER_LDFLAGS&quot;
272   # FIXME: Don&#39;t really know how to do with this, but this was the old behavior
273   GLOBAL_CPPFLAGS=&quot;$SYSROOT_CFLAGS&quot;
274   AC_SUBST(GLOBAL_CFLAGS)
275   AC_SUBST(GLOBAL_CXXFLAGS)
276   AC_SUBST(GLOBAL_LDFLAGS)
277   AC_SUBST(GLOBAL_CPPFLAGS)
278 
279   # FIXME: For compatilibity, export this as EXTRA_CFLAGS for now.
280   EXTRA_CFLAGS=&quot;$MACHINE_FLAG $USER_CFLAGS&quot;
281   EXTRA_CXXFLAGS=&quot;$MACHINE_FLAG $USER_CXXFLAGS&quot;
282   EXTRA_LDFLAGS=&quot;$MACHINE_FLAG $USER_LDFLAGS&quot;

283 
284   AC_SUBST(EXTRA_CFLAGS)
285   AC_SUBST(EXTRA_CXXFLAGS)
286   AC_SUBST(EXTRA_LDFLAGS)

287 
288   # For autoconf testing to work, the global flags must also be stored in the
289   # &quot;unnamed&quot; CFLAGS etc.
290   CFLAGS=&quot;$GLOBAL_CFLAGS&quot;
291   CXXFLAGS=&quot;$GLOBAL_CXXFLAGS&quot;
292   LDFLAGS=&quot;$GLOBAL_LDFLAGS&quot;
293   CPPFLAGS=&quot;$GLOBAL_CPPFLAGS&quot;
294 ])
295 
296 AC_DEFUN([FLAGS_SETUP_TOOLCHAIN_CONTROL],
297 [
298   # COMPILER_TARGET_BITS_FLAG  : option for selecting 32- or 64-bit output
299   # COMPILER_COMMAND_FILE_FLAG : option for passing a command file to the compiler
300   # COMPILER_BINDCMD_FILE_FLAG : option for specifying a file which saves the binder
301   #                              commands produced by the link step (currently AIX only)
302   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
303     COMPILER_TARGET_BITS_FLAG=&quot;-q&quot;
304     COMPILER_COMMAND_FILE_FLAG=&quot;-f&quot;
305     COMPILER_BINDCMD_FILE_FLAG=&quot;-bloadmap:&quot;
306   else
</pre>
<hr />
<pre>
411   FLAGS_SETUP_STRIPFLAGS
412   FLAGS_SETUP_RCFLAGS
413 
414   FLAGS_SETUP_ASFLAGS
415   FLAGS_SETUP_ASFLAGS_CPU_DEP([TARGET])
416   FLAGS_SETUP_ASFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_])
417 ])
418 
419 # FLAGS_C_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
420 #                                  IF_FALSE: [RUN-IF-FALSE])
421 # ------------------------------------------------------------
422 # Check that the C compiler supports an argument
423 BASIC_DEFUN_NAMED([FLAGS_C_COMPILER_CHECK_ARGUMENTS],
424     [*ARGUMENT IF_TRUE IF_FALSE PREFIX], [$@],
425 [
426   AC_MSG_CHECKING([if ARG_PREFIX[CC] supports &quot;ARG_ARGUMENT&quot;])
427   supports=yes
428 
429   saved_cflags=&quot;$CFLAGS&quot;
430   saved_cc=&quot;$CC&quot;
<span class="line-modified">431   CFLAGS=&quot;$CFLAGS ARG_ARGUMENT&quot;</span>
432   CC=&quot;$ARG_PREFIX[CC]&quot;
433   AC_LANG_PUSH([C])
434   AC_COMPILE_IFELSE([AC_LANG_SOURCE([[int i;]])], [],
435       [supports=no])
436   AC_LANG_POP([C])
437   CC=&quot;$saved_cc&quot;
438   CFLAGS=&quot;$saved_cflags&quot;
439 
440   AC_MSG_RESULT([$supports])
441   if test &quot;x$supports&quot; = &quot;xyes&quot; ; then
442     :
443     ARG_IF_TRUE
444   else
445     :
446     ARG_IF_FALSE
447   fi
448 ])
449 
450 # FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
451 #                                    IF_FALSE: [RUN-IF-FALSE])
452 # ------------------------------------------------------------
453 # Check that the C++ compiler supports an argument
454 BASIC_DEFUN_NAMED([FLAGS_CXX_COMPILER_CHECK_ARGUMENTS],
455     [*ARGUMENT IF_TRUE IF_FALSE PREFIX], [$@],
456 [
457   AC_MSG_CHECKING([if ARG_PREFIX[CXX] supports &quot;ARG_ARGUMENT&quot;])
458   supports=yes
459 
460   saved_cxxflags=&quot;$CXXFLAGS&quot;
461   saved_cxx=&quot;$CXX&quot;
<span class="line-modified">462   CXXFLAGS=&quot;$CXXFLAG ARG_ARGUMENT&quot;</span>
463   CXX=&quot;$ARG_PREFIX[CXX]&quot;
464   AC_LANG_PUSH([C++])
465   AC_COMPILE_IFELSE([AC_LANG_SOURCE([[int i;]])], [],
466       [supports=no])
467   AC_LANG_POP([C++])
468   CXX=&quot;$saved_cxx&quot;
469   CXXFLAGS=&quot;$saved_cxxflags&quot;
470 
471   AC_MSG_RESULT([$supports])
472   if test &quot;x$supports&quot; = &quot;xyes&quot; ; then
473     :
474     ARG_IF_TRUE
475   else
476     :
477     ARG_IF_FALSE
478   fi
479 ])
480 
481 # FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
482 #                                IF_FALSE: [RUN-IF-FALSE])
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 32 # Setup ABI profile (for arm)
 33 #
 34 AC_DEFUN([FLAGS_SETUP_ABI_PROFILE],
 35 [
 36   AC_ARG_WITH(abi-profile, [AS_HELP_STRING([--with-abi-profile],
 37       [specify ABI profile for ARM builds (arm-vfp-sflt,arm-vfp-hflt,arm-sflt, armv5-vfp-sflt,armv6-vfp-hflt,aarch64) @&lt;:@toolchain dependent@:&gt;@ ])])
 38 
 39   if test &quot;x$with_abi_profile&quot; != x; then
 40     if test &quot;x$OPENJDK_TARGET_CPU&quot; != xarm &amp;&amp; \
 41         test &quot;x$OPENJDK_TARGET_CPU&quot; != xaarch64; then
 42       AC_MSG_ERROR([--with-abi-profile only available on arm/aarch64])
 43     fi
 44 
 45     OPENJDK_TARGET_ABI_PROFILE=$with_abi_profile
 46     AC_MSG_CHECKING([for ABI profle])
 47     AC_MSG_RESULT([$OPENJDK_TARGET_ABI_PROFILE])
 48 
 49     # --- Arm-sflt CFLAGS and ASFLAGS ---
 50     # Armv5te is required for assembler, because pld insn used in arm32 hotspot is only in v5E and above.
 51     # However, there is also a GCC bug which generates unaligned strd/ldrd instructions on armv5te:
<span class="line-modified"> 52     # https://gcc.gnu.org/bugzilla/show_bug.cgi?id=82445, and it was fixed in gcc 7.1.</span>
 53     # The resulting compromise is to enable v5TE for assembler and let GCC generate code for v5T.
 54     if test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-vfp-sflt; then
 55       ARM_FLOAT_TYPE=vfp-sflt
 56       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv7-a -mthumb&#39;
 57       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv7-a -mthumb&#39;
 58     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-vfp-hflt; then
 59       ARM_FLOAT_TYPE=vfp-hflt
 60       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv7-a -mthumb&#39;
 61       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv7-a -mthumb&#39;
 62     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-sflt; then
 63       ARM_FLOAT_TYPE=sflt
 64       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv5t -marm&#39;
 65       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv5te&#39;
 66     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarmv5-vfp-sflt; then
 67       ARM_FLOAT_TYPE=vfp-sflt
 68       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv5t -marm&#39;
 69       ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv5te&#39;
 70     elif test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarmv6-vfp-hflt; then
 71       ARM_FLOAT_TYPE=vfp-hflt
 72       ARM_ARCH_TYPE_FLAGS=&#39;-march=armv6 -marm&#39;
</pre>
<hr />
<pre>
159     AC_SUBST(MACOSX_VERSION_MAX)
160   fi
161 ])
162 
163 # Reset the global CFLAGS/LDFLAGS variables and initialize them with the
164 # corresponding configure arguments instead
165 AC_DEFUN_ONCE([FLAGS_SETUP_USER_SUPPLIED_FLAGS],
166 [
167   if test &quot;x$CFLAGS&quot; != &quot;x&quot;; then
168     AC_MSG_WARN([Ignoring CFLAGS($CFLAGS) found in environment. Use --with-extra-cflags])
169   fi
170 
171   if test &quot;x$CXXFLAGS&quot; != &quot;x&quot;; then
172     AC_MSG_WARN([Ignoring CXXFLAGS($CXXFLAGS) found in environment. Use --with-extra-cxxflags])
173   fi
174 
175   if test &quot;x$LDFLAGS&quot; != &quot;x&quot;; then
176     AC_MSG_WARN([Ignoring LDFLAGS($LDFLAGS) found in environment. Use --with-extra-ldflags])
177   fi
178 
<span class="line-added">179   if test &quot;x$ASFLAGS&quot; != &quot;x&quot;; then</span>
<span class="line-added">180     AC_MSG_WARN([Ignoring ASFLAGS($ASFLAGS) found in environment. Use --with-extra-asflags])</span>
<span class="line-added">181   fi</span>
<span class="line-added">182 </span>
183   AC_ARG_WITH(extra-cflags, [AS_HELP_STRING([--with-extra-cflags],
184       [extra flags to be used when compiling jdk c-files])])
185 
186   AC_ARG_WITH(extra-cxxflags, [AS_HELP_STRING([--with-extra-cxxflags],
187       [extra flags to be used when compiling jdk c++-files])])
188 
189   AC_ARG_WITH(extra-ldflags, [AS_HELP_STRING([--with-extra-ldflags],
190       [extra flags to be used when linking jdk])])
191 
<span class="line-added">192   AC_ARG_WITH(extra-asflags, [AS_HELP_STRING([--with-extra-asflags],</span>
<span class="line-added">193       [extra flags to be passed to the assembler])])</span>
<span class="line-added">194 </span>
195   USER_CFLAGS=&quot;$with_extra_cflags&quot;
196   USER_CXXFLAGS=&quot;$with_extra_cxxflags&quot;
197   USER_LDFLAGS=&quot;$with_extra_ldflags&quot;
<span class="line-added">198   USER_ASFLAGS=&quot;$with_extra_asflags&quot;</span>
199 ])
200 
201 # Setup the sysroot flags and add them to global CFLAGS and LDFLAGS so
202 # that configure can use them while detecting compilers.
203 # TOOLCHAIN_TYPE is available here.
204 # Param 1 - Optional prefix to all variables. (e.g BUILD_)
205 AC_DEFUN([FLAGS_SETUP_SYSROOT_FLAGS],
206 [
207   if test &quot;x[$]$1SYSROOT&quot; != &quot;x&quot;; then
208     if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
209       if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then
210         # Solaris Studio does not have a concept of sysroot. Instead we must
211         # make sure the default include and lib dirs are appended to each
212         # compile and link command line. Must also add -I-xbuiltin to enable
213         # inlining of system functions and intrinsics.
214         $1SYSROOT_CFLAGS=&quot;-I-xbuiltin -I[$]$1SYSROOT/usr/include&quot;
215         $1SYSROOT_LDFLAGS=&quot;-L[$]$1SYSROOT/usr/lib$OPENJDK_TARGET_CPU_ISADIR \
216             -L[$]$1SYSROOT/lib$OPENJDK_TARGET_CPU_ISADIR&quot;
217         # If the devkit contains the ld linker, make sure we use it.
218         AC_PATH_PROG(SOLARIS_LD, ld, , $DEVKIT_TOOLCHAIN_PATH:$DEVKIT_EXTRA_PATH)
</pre>
<hr />
<pre>
271     fi
272   fi
273 
274   # FIXME: global flags are not used yet...
275   # The &quot;global&quot; flags will *always* be set. Without them, it is not possible to
276   # get a working compilation.
277   GLOBAL_CFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CFLAGS&quot;
278   GLOBAL_CXXFLAGS=&quot;$MACHINE_FLAG $SYSROOT_CFLAGS $USER_CXXFLAGS&quot;
279   GLOBAL_LDFLAGS=&quot;$MACHINE_FLAG $SYSROOT_LDFLAGS $USER_LDFLAGS&quot;
280   # FIXME: Don&#39;t really know how to do with this, but this was the old behavior
281   GLOBAL_CPPFLAGS=&quot;$SYSROOT_CFLAGS&quot;
282   AC_SUBST(GLOBAL_CFLAGS)
283   AC_SUBST(GLOBAL_CXXFLAGS)
284   AC_SUBST(GLOBAL_LDFLAGS)
285   AC_SUBST(GLOBAL_CPPFLAGS)
286 
287   # FIXME: For compatilibity, export this as EXTRA_CFLAGS for now.
288   EXTRA_CFLAGS=&quot;$MACHINE_FLAG $USER_CFLAGS&quot;
289   EXTRA_CXXFLAGS=&quot;$MACHINE_FLAG $USER_CXXFLAGS&quot;
290   EXTRA_LDFLAGS=&quot;$MACHINE_FLAG $USER_LDFLAGS&quot;
<span class="line-added">291   EXTRA_ASFLAGS=&quot;$USER_ASFLAGS&quot;</span>
292 
293   AC_SUBST(EXTRA_CFLAGS)
294   AC_SUBST(EXTRA_CXXFLAGS)
295   AC_SUBST(EXTRA_LDFLAGS)
<span class="line-added">296   AC_SUBST(EXTRA_ASFLAGS)</span>
297 
298   # For autoconf testing to work, the global flags must also be stored in the
299   # &quot;unnamed&quot; CFLAGS etc.
300   CFLAGS=&quot;$GLOBAL_CFLAGS&quot;
301   CXXFLAGS=&quot;$GLOBAL_CXXFLAGS&quot;
302   LDFLAGS=&quot;$GLOBAL_LDFLAGS&quot;
303   CPPFLAGS=&quot;$GLOBAL_CPPFLAGS&quot;
304 ])
305 
306 AC_DEFUN([FLAGS_SETUP_TOOLCHAIN_CONTROL],
307 [
308   # COMPILER_TARGET_BITS_FLAG  : option for selecting 32- or 64-bit output
309   # COMPILER_COMMAND_FILE_FLAG : option for passing a command file to the compiler
310   # COMPILER_BINDCMD_FILE_FLAG : option for specifying a file which saves the binder
311   #                              commands produced by the link step (currently AIX only)
312   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
313     COMPILER_TARGET_BITS_FLAG=&quot;-q&quot;
314     COMPILER_COMMAND_FILE_FLAG=&quot;-f&quot;
315     COMPILER_BINDCMD_FILE_FLAG=&quot;-bloadmap:&quot;
316   else
</pre>
<hr />
<pre>
421   FLAGS_SETUP_STRIPFLAGS
422   FLAGS_SETUP_RCFLAGS
423 
424   FLAGS_SETUP_ASFLAGS
425   FLAGS_SETUP_ASFLAGS_CPU_DEP([TARGET])
426   FLAGS_SETUP_ASFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_])
427 ])
428 
429 # FLAGS_C_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
430 #                                  IF_FALSE: [RUN-IF-FALSE])
431 # ------------------------------------------------------------
432 # Check that the C compiler supports an argument
433 BASIC_DEFUN_NAMED([FLAGS_C_COMPILER_CHECK_ARGUMENTS],
434     [*ARGUMENT IF_TRUE IF_FALSE PREFIX], [$@],
435 [
436   AC_MSG_CHECKING([if ARG_PREFIX[CC] supports &quot;ARG_ARGUMENT&quot;])
437   supports=yes
438 
439   saved_cflags=&quot;$CFLAGS&quot;
440   saved_cc=&quot;$CC&quot;
<span class="line-modified">441   CFLAGS=&quot;$CFLAGS $CFLAGS_WARNINGS_ARE_ERRORS ARG_ARGUMENT&quot;</span>
442   CC=&quot;$ARG_PREFIX[CC]&quot;
443   AC_LANG_PUSH([C])
444   AC_COMPILE_IFELSE([AC_LANG_SOURCE([[int i;]])], [],
445       [supports=no])
446   AC_LANG_POP([C])
447   CC=&quot;$saved_cc&quot;
448   CFLAGS=&quot;$saved_cflags&quot;
449 
450   AC_MSG_RESULT([$supports])
451   if test &quot;x$supports&quot; = &quot;xyes&quot; ; then
452     :
453     ARG_IF_TRUE
454   else
455     :
456     ARG_IF_FALSE
457   fi
458 ])
459 
460 # FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
461 #                                    IF_FALSE: [RUN-IF-FALSE])
462 # ------------------------------------------------------------
463 # Check that the C++ compiler supports an argument
464 BASIC_DEFUN_NAMED([FLAGS_CXX_COMPILER_CHECK_ARGUMENTS],
465     [*ARGUMENT IF_TRUE IF_FALSE PREFIX], [$@],
466 [
467   AC_MSG_CHECKING([if ARG_PREFIX[CXX] supports &quot;ARG_ARGUMENT&quot;])
468   supports=yes
469 
470   saved_cxxflags=&quot;$CXXFLAGS&quot;
471   saved_cxx=&quot;$CXX&quot;
<span class="line-modified">472   CXXFLAGS=&quot;$CXXFLAG $CFLAGS_WARNINGS_ARE_ERRORS ARG_ARGUMENT&quot;</span>
473   CXX=&quot;$ARG_PREFIX[CXX]&quot;
474   AC_LANG_PUSH([C++])
475   AC_COMPILE_IFELSE([AC_LANG_SOURCE([[int i;]])], [],
476       [supports=no])
477   AC_LANG_POP([C++])
478   CXX=&quot;$saved_cxx&quot;
479   CXXFLAGS=&quot;$saved_cxxflags&quot;
480 
481   AC_MSG_RESULT([$supports])
482   if test &quot;x$supports&quot; = &quot;xyes&quot; ; then
483     :
484     ARG_IF_TRUE
485   else
486     :
487     ARG_IF_FALSE
488   fi
489 ])
490 
491 # FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [ARGUMENT], IF_TRUE: [RUN-IF-TRUE],
492 #                                IF_FALSE: [RUN-IF-FALSE])
</pre>
</td>
</tr>
</table>
<center><a href="flags-other.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="help.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>