<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/toolchain.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="toolchain_windows.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/toolchain.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 #
<span class="line-modified">   2 # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  35 
  36 # All valid toolchains, regardless of platform (used by help.m4)
  37 VALID_TOOLCHAINS_all=&quot;gcc clang solstudio xlc microsoft&quot;
  38 
  39 # These toolchains are valid on different platforms
  40 VALID_TOOLCHAINS_linux=&quot;gcc clang&quot;
  41 VALID_TOOLCHAINS_solaris=&quot;solstudio&quot;
  42 VALID_TOOLCHAINS_macosx=&quot;gcc clang&quot;
  43 VALID_TOOLCHAINS_aix=&quot;xlc&quot;
  44 VALID_TOOLCHAINS_windows=&quot;microsoft&quot;
  45 
  46 # Toolchain descriptions
  47 TOOLCHAIN_DESCRIPTION_clang=&quot;clang/LLVM&quot;
  48 TOOLCHAIN_DESCRIPTION_gcc=&quot;GNU Compiler Collection&quot;
  49 TOOLCHAIN_DESCRIPTION_microsoft=&quot;Microsoft Visual Studio&quot;
  50 TOOLCHAIN_DESCRIPTION_solstudio=&quot;Oracle Solaris Studio&quot;
  51 TOOLCHAIN_DESCRIPTION_xlc=&quot;IBM XL C/C++&quot;
  52 
  53 # Minimum supported versions, empty means unspecified
  54 TOOLCHAIN_MINIMUM_VERSION_clang=&quot;3.2&quot;
<span class="line-modified">  55 TOOLCHAIN_MINIMUM_VERSION_gcc=&quot;4.8&quot;</span>
  56 TOOLCHAIN_MINIMUM_VERSION_microsoft=&quot;16.00.30319.01&quot; # VS2010
  57 TOOLCHAIN_MINIMUM_VERSION_solstudio=&quot;5.13&quot;
  58 TOOLCHAIN_MINIMUM_VERSION_xlc=&quot;&quot;
  59 
  60 # Minimum supported linker versions, empty means unspecified
  61 TOOLCHAIN_MINIMUM_LD_VERSION_gcc=&quot;2.18&quot;
  62 
  63 # Prepare the system so that TOOLCHAIN_CHECK_COMPILER_VERSION can be called.
  64 # Must have CC_VERSION_NUMBER and CXX_VERSION_NUMBER.
  65 # $1 - optional variable prefix for compiler and version variables (BUILD_)
  66 # $2 - optional variable prefix for comparable variable (OPENJDK_BUILD_)

  67 AC_DEFUN([TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS],
  68 [
  69   if test &quot;x[$]$1CC_VERSION_NUMBER&quot; != &quot;x[$]$1CXX_VERSION_NUMBER&quot;; then
<span class="line-modified">  70     AC_MSG_WARN([C and C++ compiler have different version numbers, [$]$1CC_VERSION_NUMBER vs [$]$1CXX_VERSION_NUMBER.])</span>
  71     AC_MSG_WARN([This typically indicates a broken setup, and is not supported])
  72   fi
  73 
  74   # We only check CC_VERSION_NUMBER since we assume CXX_VERSION_NUMBER is equal.
  75   if [ [[ &quot;[$]$1CC_VERSION_NUMBER&quot; =~ (.*\.){4} ]] ]; then
  76     AC_MSG_WARN([C compiler version number has more than four parts (W.X.Y.Z): [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  77   fi
  78 
  79   if [ [[  &quot;[$]$1CC_VERSION_NUMBER&quot; =~ [0-9]{6} ]] ]; then
  80     AC_MSG_WARN([C compiler version number has a part larger than 99999: [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  81   fi
  82 
  83   $2COMPARABLE_ACTUAL_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;[$]$1CC_VERSION_NUMBER&quot;`
  84 ])
  85 
  86 # Check if the configured compiler (C and C++) is of a specific version or
  87 # newer. TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS must have been called before.
  88 #
  89 # Arguments:
  90 #   VERSION:   The version string to check against the found version
</pre>
<hr />
<pre>
 269       AC_MSG_NOTICE([Valid toolchains: $VALID_TOOLCHAINS.])
 270       AC_MSG_ERROR([Cannot continue.])
 271     fi
 272     TOOLCHAIN_TYPE=$with_toolchain_type
 273   else
 274     # No flag given, use default
 275     TOOLCHAIN_TYPE=$DEFAULT_TOOLCHAIN
 276   fi
 277   AC_SUBST(TOOLCHAIN_TYPE)
 278 
 279   # on AIX, check for xlclang++ on the PATH and TOOLCHAIN_PATH and use it if it is available
 280   if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
 281     if test &quot;x$TOOLCHAIN_PATH&quot; != x; then
 282       XLC_TEST_PATH=${TOOLCHAIN_PATH}/
 283     fi
 284 
 285     XLCLANG_VERSION_OUTPUT=`${XLC_TEST_PATH}xlclang++ -qversion 2&gt;&amp;1 | $HEAD -n 1`
 286     $ECHO &quot;$XLCLANG_VERSION_OUTPUT&quot; | $GREP &quot;IBM XL C/C++ for AIX&quot; &gt; /dev/null
 287     if test $? -eq 0; then
 288       AC_MSG_NOTICE([xlclang++ output: $XLCLANG_VERSION_OUTPUT])
<span class="line-modified"> 289       XLC_USES_CLANG=true</span>

 290     fi
 291   fi
 292 
 293   TOOLCHAIN_CC_BINARY_clang=&quot;clang&quot;
 294   TOOLCHAIN_CC_BINARY_gcc=&quot;gcc&quot;
 295   TOOLCHAIN_CC_BINARY_microsoft=&quot;cl$EXE_SUFFIX&quot;
 296   TOOLCHAIN_CC_BINARY_solstudio=&quot;cc&quot;
<span class="line-modified"> 297   TOOLCHAIN_CC_BINARY_xlc=&quot;xlc_r&quot;</span>
 298 
 299   TOOLCHAIN_CXX_BINARY_clang=&quot;clang++&quot;
 300   TOOLCHAIN_CXX_BINARY_gcc=&quot;g++&quot;
 301   TOOLCHAIN_CXX_BINARY_microsoft=&quot;cl$EXE_SUFFIX&quot;
 302   TOOLCHAIN_CXX_BINARY_solstudio=&quot;CC&quot;
<span class="line-modified"> 303   TOOLCHAIN_CXX_BINARY_xlc=&quot;xlC_r&quot;</span>
<span class="line-removed"> 304 </span>
<span class="line-removed"> 305   if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then</span>
<span class="line-removed"> 306     if test &quot;x$XLC_USES_CLANG&quot; = xtrue; then</span>
<span class="line-removed"> 307       AC_MSG_NOTICE([xlclang++ detected, using it])</span>
<span class="line-removed"> 308       TOOLCHAIN_CC_BINARY_xlc=&quot;xlclang&quot;</span>
<span class="line-removed"> 309       TOOLCHAIN_CXX_BINARY_xlc=&quot;xlclang++&quot;</span>
<span class="line-removed"> 310     fi</span>
<span class="line-removed"> 311   fi</span>
 312 
 313   # Use indirect variable referencing
 314   toolchain_var_name=TOOLCHAIN_DESCRIPTION_$TOOLCHAIN_TYPE
 315   TOOLCHAIN_DESCRIPTION=${!toolchain_var_name}
 316   toolchain_var_name=TOOLCHAIN_MINIMUM_VERSION_$TOOLCHAIN_TYPE
 317   TOOLCHAIN_MINIMUM_VERSION=${!toolchain_var_name}
 318   toolchain_var_name=TOOLCHAIN_MINIMUM_LD_VERSION_$TOOLCHAIN_TYPE
 319   TOOLCHAIN_MINIMUM_LD_VERSION=${!toolchain_var_name}
 320   toolchain_var_name=TOOLCHAIN_CC_BINARY_$TOOLCHAIN_TYPE
 321   TOOLCHAIN_CC_BINARY=${!toolchain_var_name}
 322   toolchain_var_name=TOOLCHAIN_CXX_BINARY_$TOOLCHAIN_TYPE
 323   TOOLCHAIN_CXX_BINARY=${!toolchain_var_name}
 324 
 325   TOOLCHAIN_SETUP_FILENAME_PATTERNS
 326 
 327   if test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;x$DEFAULT_TOOLCHAIN&quot;; then
 328     AC_MSG_NOTICE([Using default toolchain $TOOLCHAIN_TYPE ($TOOLCHAIN_DESCRIPTION)])
 329   else
 330     AC_MSG_NOTICE([Using user selected toolchain $TOOLCHAIN_TYPE ($TOOLCHAIN_DESCRIPTION). Default toolchain is $DEFAULT_TOOLCHAIN.])
 331   fi
</pre>
<hr />
<pre>
 440     #     IBM XL C/C++ for AIX, V11.1 (5724-X13)
 441     #     Version: 11.01.0000.0015
 442     COMPILER_VERSION_OUTPUT=`$COMPILER -qversion 2&gt;&amp;1`
 443     # Check that this is likely to be the IBM XL C compiler.
 444     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;IBM XL C&quot; &gt; /dev/null
 445     if test $? -ne 0; then
 446       ALT_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`
 447       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 448       AC_MSG_NOTICE([The result from running with -qversion was: &quot;$COMPILER_VERSION_OUTPUT&quot;])
 449       AC_MSG_NOTICE([The result from running with --version was: &quot;$ALT_VERSION_OUTPUT&quot;])
 450       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 451     fi
 452     # Collapse compiler output into a single line
 453     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT`
 454     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 455         $SED -e &#39;s/^.*, V\(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\).*$/\1/&#39;`
 456   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 457     # There is no specific version flag, but all output starts with a version string.
 458     # First line typically looks something like:
 459     # Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 16.00.40219.01 for 80x86

 460     COMPILER_VERSION_OUTPUT=`&quot;$COMPILER&quot; 2&gt;&amp;1 | $GREP -v &#39;ERROR.*UtilTranslatePathList&#39; | $HEAD -n 1 | $TR -d &#39;\r&#39;`
 461     # Check that this is likely to be Microsoft CL.EXE.
<span class="line-modified"> 462     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;Microsoft.*Compiler&quot; &gt; /dev/null</span>
 463     if test $? -ne 0; then
 464       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 465       AC_MSG_NOTICE([The result from running it was: &quot;$COMPILER_VERSION_OUTPUT&quot;])
 466       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 467     fi
 468     # Collapse compiler output into a single line
 469     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT`
 470     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 471         $SED -e &#39;s/^.*ersion.\(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\) .*$/\1/&#39;`
 472   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
 473     # gcc --version output typically looks like
 474     #     gcc (Ubuntu/Linaro 4.8.1-10ubuntu9) 4.8.1
 475     #     Copyright (C) 2013 Free Software Foundation, Inc.
 476     #     This is free software; see the source for copying conditions.  There is NO
 477     #     warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 478     COMPILER_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`
 479     # Check that this is likely to be GCC.
 480     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;Free Software Foundation&quot; &gt; /dev/null
 481     if test $? -ne 0; then
 482       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 483       AC_MSG_NOTICE([The result from running with --version was: &quot;$COMPILER_VERSION&quot;])
 484       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 485     fi
 486     # Remove Copyright and legalese from version string, and
 487     # collapse into a single line
 488     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT | \
 489         $SED -e &#39;s/ *Copyright .*//&#39;`
 490     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
<span class="line-modified"> 491         $SED -e &#39;s/^.* \(@&lt;:@1-9@:&gt;@\.@&lt;:@0-9.@:&gt;@*\)@&lt;:@^0-9.@:&gt;@.*$/\1/&#39;`</span>
 492   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 493     # clang --version output typically looks like
 494     #    Apple LLVM version 5.0 (clang-500.2.79) (based on LLVM 3.3svn)
 495     #    clang version 3.3 (tags/RELEASE_33/final)
 496     # or
 497     #    Debian clang version 3.2-7ubuntu1 (tags/RELEASE_32/final) (based on LLVM 3.2)
 498     #    Target: x86_64-pc-linux-gnu
 499     #    Thread model: posix
 500     COMPILER_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`
 501     # Check that this is likely to be clang
 502     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;clang&quot; &gt; /dev/null
 503     if test $? -ne 0; then
 504       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 505       AC_MSG_NOTICE([The result from running with --version was: &quot;$COMPILER_VERSION_OUTPUT&quot;])
 506       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 507     fi
 508     # Collapse compiler output into a single line
 509     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT`
 510     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 511         $SED -e &#39;s/^.* version \(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\).*$/\1/&#39;`
</pre>
<hr />
<pre>
 626     # solstudio cc requires us to have an existing file to pass as argument,
 627     # but it need not be a syntactically correct C file, so just use
 628     # ourself. :) The intermediate &#39;cat&#39; is needed to stop ld from leaving
 629     # a lingering a.out (!).
 630     LINKER_VERSION_STRING=`$LD -Wl,-V $TOPDIR/configure 2&gt;&amp;1 | $CAT | $HEAD -n 1 | $SED -e &#39;s/ld: //&#39;`
 631     # Extract version number
 632     [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 633         $SED -e &#39;s/.* \([0-9][0-9]*\.[0-9][0-9]*\)-\([0-9][0-9]*\.[0-9][0-9]*\)/\1.\2/&#39;` ]
 634   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
 635     LINKER_VERSION_STRING=&quot;Unknown&quot;
 636     LINKER_VERSION_NUMBER=&quot;0.0&quot;
 637   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 638     # There is no specific version flag, but all output starts with a version string.
 639     # First line typically looks something like:
 640     #   Microsoft (R) Incremental Linker Version 12.00.31101.0
 641     LINKER_VERSION_STRING=`$LD 2&gt;&amp;1 | $HEAD -n 1 | $TR -d &#39;\r&#39;`
 642     # Extract version number
 643     [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 644         $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*/\1/&#39;` ]
 645   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
<span class="line-modified"> 646     # gcc -Wl,-version output typically looks like</span>
 647     #   GNU ld (GNU Binutils for Ubuntu) 2.26.1
 648     #   Copyright (C) 2015 Free Software Foundation, Inc.
 649     #   This program is free software; [...]
<span class="line-modified"> 650     LINKER_VERSION_STRING=`$LD -Wl,-version 2&gt;&amp;1 | $HEAD -n 1`</span>


 651     # Extract version number
<span class="line-modified"> 652     [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \</span>
<span class="line-modified"> 653         $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*/\1/&#39;` ]</span>





 654   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 655     # clang -Wl,-v output typically looks like
 656     #   @(#)PROGRAM:ld  PROJECT:ld64-305
 657     #   configured to support archs: armv6 armv7 armv7s arm64 i386 x86_64 x86_64h armv6m armv7k armv7m armv7em (tvOS)
 658     #   Library search paths: [...]
 659     # or
 660     #   GNU ld (GNU Binutils for Ubuntu) 2.26.1
 661 
 662     LINKER_VERSION_STRING=`$LD -Wl,-v 2&gt;&amp;1 | $HEAD -n 1`
 663     # Check if we&#39;re using the GNU ld
 664     $ECHO &quot;$LINKER_VERSION_STRING&quot; | $GREP &quot;GNU&quot; &gt; /dev/null
 665     if test $? -eq 0; then
 666       # Extract version number
 667       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 668           $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*/\1/&#39;` ]
 669     else
 670       # Extract version number
 671       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 672           $SED -e &#39;s/.*-\([0-9][0-9]*\)/\1/&#39;` ]
 673     fi
</pre>
<hr />
<pre>
 980     BASIC_REQUIRE_PROGS(BUILD_CXX, [cl CC g++])
 981     BASIC_FIXUP_EXECUTABLE(BUILD_CXX)
 982     BASIC_PATH_PROGS(BUILD_NM, nm gcc-nm)
 983     BASIC_FIXUP_EXECUTABLE(BUILD_NM)
 984     BASIC_PATH_PROGS(BUILD_AR, ar gcc-ar)
 985     BASIC_FIXUP_EXECUTABLE(BUILD_AR)
 986     BASIC_PATH_PROGS(BUILD_OBJCOPY, objcopy)
 987     BASIC_FIXUP_EXECUTABLE(BUILD_OBJCOPY)
 988     BASIC_PATH_PROGS(BUILD_STRIP, strip)
 989     BASIC_FIXUP_EXECUTABLE(BUILD_STRIP)
 990     # Assume the C compiler is the assembler
 991     BUILD_AS=&quot;$BUILD_CC -c&quot;
 992     # Just like for the target compiler, use the compiler as linker
 993     BUILD_LD=&quot;$BUILD_CC&quot;
 994     BUILD_LDCXX=&quot;$BUILD_CXX&quot;
 995 
 996     PATH=&quot;$OLDPATH&quot;
 997 
 998     TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CC, [BuildC])
 999     TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CXX, [BuildC++])
<span class="line-modified">1000     TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_])</span>
1001     TOOLCHAIN_EXTRACT_LD_VERSION(BUILD_LD, [build linker])
1002     TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_])
1003   else
1004     # If we are not cross compiling, use the normal target compilers for
1005     # building the build platform executables.
1006     BUILD_CC=&quot;$CC&quot;
1007     BUILD_CXX=&quot;$CXX&quot;
1008     BUILD_LD=&quot;$LD&quot;
1009     BUILD_LDCXX=&quot;$LDCXX&quot;
1010     BUILD_NM=&quot;$NM&quot;
1011     BUILD_AS=&quot;$AS&quot;
1012     BUILD_OBJCOPY=&quot;$OBJCOPY&quot;
1013     BUILD_STRIP=&quot;$STRIP&quot;
1014     BUILD_AR=&quot;$AR&quot;
1015 
<span class="line-modified">1016     TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS([], [OPENJDK_BUILD_])</span>
1017     TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_])
1018   fi
1019 
1020   AC_SUBST(BUILD_CC)
1021   AC_SUBST(BUILD_CXX)
1022   AC_SUBST(BUILD_LD)
1023   AC_SUBST(BUILD_LDCXX)
1024   AC_SUBST(BUILD_NM)
1025   AC_SUBST(BUILD_AS)
1026   AC_SUBST(BUILD_AR)
1027 ])
1028 
1029 # Do some additional checks on the detected tools.
1030 AC_DEFUN_ONCE([TOOLCHAIN_MISC_CHECKS],
1031 [
1032   # Check for extra potential brokenness.
1033   if test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
1034     # On Windows, double-check that we got the right compiler.
1035     CC_VERSION_OUTPUT=`$CC 2&gt;&amp;1 | $GREP -v &#39;ERROR.*UtilTranslatePathList&#39; | $HEAD -n 1 | $TR -d &#39;\r&#39;`
1036     COMPILER_CPU_TEST=`$ECHO $CC_VERSION_OUTPUT | $SED -n &quot;s/^.* \(.*\)$/\1/p&quot;`
</pre>
</td>
<td>
<hr />
<pre>
   1 #
<span class="line-modified">   2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  35 
  36 # All valid toolchains, regardless of platform (used by help.m4)
  37 VALID_TOOLCHAINS_all=&quot;gcc clang solstudio xlc microsoft&quot;
  38 
  39 # These toolchains are valid on different platforms
  40 VALID_TOOLCHAINS_linux=&quot;gcc clang&quot;
  41 VALID_TOOLCHAINS_solaris=&quot;solstudio&quot;
  42 VALID_TOOLCHAINS_macosx=&quot;gcc clang&quot;
  43 VALID_TOOLCHAINS_aix=&quot;xlc&quot;
  44 VALID_TOOLCHAINS_windows=&quot;microsoft&quot;
  45 
  46 # Toolchain descriptions
  47 TOOLCHAIN_DESCRIPTION_clang=&quot;clang/LLVM&quot;
  48 TOOLCHAIN_DESCRIPTION_gcc=&quot;GNU Compiler Collection&quot;
  49 TOOLCHAIN_DESCRIPTION_microsoft=&quot;Microsoft Visual Studio&quot;
  50 TOOLCHAIN_DESCRIPTION_solstudio=&quot;Oracle Solaris Studio&quot;
  51 TOOLCHAIN_DESCRIPTION_xlc=&quot;IBM XL C/C++&quot;
  52 
  53 # Minimum supported versions, empty means unspecified
  54 TOOLCHAIN_MINIMUM_VERSION_clang=&quot;3.2&quot;
<span class="line-modified">  55 TOOLCHAIN_MINIMUM_VERSION_gcc=&quot;5.0&quot;</span>
  56 TOOLCHAIN_MINIMUM_VERSION_microsoft=&quot;16.00.30319.01&quot; # VS2010
  57 TOOLCHAIN_MINIMUM_VERSION_solstudio=&quot;5.13&quot;
  58 TOOLCHAIN_MINIMUM_VERSION_xlc=&quot;&quot;
  59 
  60 # Minimum supported linker versions, empty means unspecified
  61 TOOLCHAIN_MINIMUM_LD_VERSION_gcc=&quot;2.18&quot;
  62 
  63 # Prepare the system so that TOOLCHAIN_CHECK_COMPILER_VERSION can be called.
  64 # Must have CC_VERSION_NUMBER and CXX_VERSION_NUMBER.
  65 # $1 - optional variable prefix for compiler and version variables (BUILD_)
  66 # $2 - optional variable prefix for comparable variable (OPENJDK_BUILD_)
<span class="line-added">  67 # $3 - optional human readable description for the type of compilers (&quot;build &quot; or &quot;&quot;)</span>
  68 AC_DEFUN([TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS],
  69 [
  70   if test &quot;x[$]$1CC_VERSION_NUMBER&quot; != &quot;x[$]$1CXX_VERSION_NUMBER&quot;; then
<span class="line-modified">  71     AC_MSG_WARN([The $3C and C++ compilers have different version numbers, [$]$1CC_VERSION_NUMBER vs [$]$1CXX_VERSION_NUMBER.])</span>
  72     AC_MSG_WARN([This typically indicates a broken setup, and is not supported])
  73   fi
  74 
  75   # We only check CC_VERSION_NUMBER since we assume CXX_VERSION_NUMBER is equal.
  76   if [ [[ &quot;[$]$1CC_VERSION_NUMBER&quot; =~ (.*\.){4} ]] ]; then
  77     AC_MSG_WARN([C compiler version number has more than four parts (W.X.Y.Z): [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  78   fi
  79 
  80   if [ [[  &quot;[$]$1CC_VERSION_NUMBER&quot; =~ [0-9]{6} ]] ]; then
  81     AC_MSG_WARN([C compiler version number has a part larger than 99999: [$]$1CC_VERSION_NUMBER. Comparisons might be wrong.])
  82   fi
  83 
  84   $2COMPARABLE_ACTUAL_VERSION=`$AWK -F. &#39;{ printf(&quot;%05d%05d%05d%05d\n&quot;, [$]1, [$]2, [$]3, [$]4) }&#39; &lt;&lt;&lt; &quot;[$]$1CC_VERSION_NUMBER&quot;`
  85 ])
  86 
  87 # Check if the configured compiler (C and C++) is of a specific version or
  88 # newer. TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS must have been called before.
  89 #
  90 # Arguments:
  91 #   VERSION:   The version string to check against the found version
</pre>
<hr />
<pre>
 270       AC_MSG_NOTICE([Valid toolchains: $VALID_TOOLCHAINS.])
 271       AC_MSG_ERROR([Cannot continue.])
 272     fi
 273     TOOLCHAIN_TYPE=$with_toolchain_type
 274   else
 275     # No flag given, use default
 276     TOOLCHAIN_TYPE=$DEFAULT_TOOLCHAIN
 277   fi
 278   AC_SUBST(TOOLCHAIN_TYPE)
 279 
 280   # on AIX, check for xlclang++ on the PATH and TOOLCHAIN_PATH and use it if it is available
 281   if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
 282     if test &quot;x$TOOLCHAIN_PATH&quot; != x; then
 283       XLC_TEST_PATH=${TOOLCHAIN_PATH}/
 284     fi
 285 
 286     XLCLANG_VERSION_OUTPUT=`${XLC_TEST_PATH}xlclang++ -qversion 2&gt;&amp;1 | $HEAD -n 1`
 287     $ECHO &quot;$XLCLANG_VERSION_OUTPUT&quot; | $GREP &quot;IBM XL C/C++ for AIX&quot; &gt; /dev/null
 288     if test $? -eq 0; then
 289       AC_MSG_NOTICE([xlclang++ output: $XLCLANG_VERSION_OUTPUT])
<span class="line-modified"> 290     else</span>
<span class="line-added"> 291       AC_MSG_ERROR([xlclang++ version output check failed, output: $XLCLANG_VERSION_OUTPUT])</span>
 292     fi
 293   fi
 294 
 295   TOOLCHAIN_CC_BINARY_clang=&quot;clang&quot;
 296   TOOLCHAIN_CC_BINARY_gcc=&quot;gcc&quot;
 297   TOOLCHAIN_CC_BINARY_microsoft=&quot;cl$EXE_SUFFIX&quot;
 298   TOOLCHAIN_CC_BINARY_solstudio=&quot;cc&quot;
<span class="line-modified"> 299   TOOLCHAIN_CC_BINARY_xlc=&quot;xlclang&quot;</span>
 300 
 301   TOOLCHAIN_CXX_BINARY_clang=&quot;clang++&quot;
 302   TOOLCHAIN_CXX_BINARY_gcc=&quot;g++&quot;
 303   TOOLCHAIN_CXX_BINARY_microsoft=&quot;cl$EXE_SUFFIX&quot;
 304   TOOLCHAIN_CXX_BINARY_solstudio=&quot;CC&quot;
<span class="line-modified"> 305   TOOLCHAIN_CXX_BINARY_xlc=&quot;xlclang++&quot;</span>








 306 
 307   # Use indirect variable referencing
 308   toolchain_var_name=TOOLCHAIN_DESCRIPTION_$TOOLCHAIN_TYPE
 309   TOOLCHAIN_DESCRIPTION=${!toolchain_var_name}
 310   toolchain_var_name=TOOLCHAIN_MINIMUM_VERSION_$TOOLCHAIN_TYPE
 311   TOOLCHAIN_MINIMUM_VERSION=${!toolchain_var_name}
 312   toolchain_var_name=TOOLCHAIN_MINIMUM_LD_VERSION_$TOOLCHAIN_TYPE
 313   TOOLCHAIN_MINIMUM_LD_VERSION=${!toolchain_var_name}
 314   toolchain_var_name=TOOLCHAIN_CC_BINARY_$TOOLCHAIN_TYPE
 315   TOOLCHAIN_CC_BINARY=${!toolchain_var_name}
 316   toolchain_var_name=TOOLCHAIN_CXX_BINARY_$TOOLCHAIN_TYPE
 317   TOOLCHAIN_CXX_BINARY=${!toolchain_var_name}
 318 
 319   TOOLCHAIN_SETUP_FILENAME_PATTERNS
 320 
 321   if test &quot;x$TOOLCHAIN_TYPE&quot; = &quot;x$DEFAULT_TOOLCHAIN&quot;; then
 322     AC_MSG_NOTICE([Using default toolchain $TOOLCHAIN_TYPE ($TOOLCHAIN_DESCRIPTION)])
 323   else
 324     AC_MSG_NOTICE([Using user selected toolchain $TOOLCHAIN_TYPE ($TOOLCHAIN_DESCRIPTION). Default toolchain is $DEFAULT_TOOLCHAIN.])
 325   fi
</pre>
<hr />
<pre>
 434     #     IBM XL C/C++ for AIX, V11.1 (5724-X13)
 435     #     Version: 11.01.0000.0015
 436     COMPILER_VERSION_OUTPUT=`$COMPILER -qversion 2&gt;&amp;1`
 437     # Check that this is likely to be the IBM XL C compiler.
 438     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;IBM XL C&quot; &gt; /dev/null
 439     if test $? -ne 0; then
 440       ALT_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`
 441       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 442       AC_MSG_NOTICE([The result from running with -qversion was: &quot;$COMPILER_VERSION_OUTPUT&quot;])
 443       AC_MSG_NOTICE([The result from running with --version was: &quot;$ALT_VERSION_OUTPUT&quot;])
 444       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 445     fi
 446     # Collapse compiler output into a single line
 447     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT`
 448     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 449         $SED -e &#39;s/^.*, V\(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\).*$/\1/&#39;`
 450   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 451     # There is no specific version flag, but all output starts with a version string.
 452     # First line typically looks something like:
 453     # Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 16.00.40219.01 for 80x86
<span class="line-added"> 454     # but the compiler name may vary depending on locale.</span>
 455     COMPILER_VERSION_OUTPUT=`&quot;$COMPILER&quot; 2&gt;&amp;1 | $GREP -v &#39;ERROR.*UtilTranslatePathList&#39; | $HEAD -n 1 | $TR -d &#39;\r&#39;`
 456     # Check that this is likely to be Microsoft CL.EXE.
<span class="line-modified"> 457     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;Microsoft&quot; &gt; /dev/null</span>
 458     if test $? -ne 0; then
 459       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 460       AC_MSG_NOTICE([The result from running it was: &quot;$COMPILER_VERSION_OUTPUT&quot;])
 461       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 462     fi
 463     # Collapse compiler output into a single line
 464     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT`
 465     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 466         $SED -e &#39;s/^.*ersion.\(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\) .*$/\1/&#39;`
 467   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
 468     # gcc --version output typically looks like
 469     #     gcc (Ubuntu/Linaro 4.8.1-10ubuntu9) 4.8.1
 470     #     Copyright (C) 2013 Free Software Foundation, Inc.
 471     #     This is free software; see the source for copying conditions.  There is NO
 472     #     warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 473     COMPILER_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`
 474     # Check that this is likely to be GCC.
 475     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;Free Software Foundation&quot; &gt; /dev/null
 476     if test $? -ne 0; then
 477       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 478       AC_MSG_NOTICE([The result from running with --version was: &quot;$COMPILER_VERSION&quot;])
 479       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 480     fi
 481     # Remove Copyright and legalese from version string, and
 482     # collapse into a single line
 483     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT | \
 484         $SED -e &#39;s/ *Copyright .*//&#39;`
 485     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
<span class="line-modified"> 486         $SED -e &#39;s/^.* \(@&lt;:@1-9@:&gt;@&lt;:@0-9@:&gt;@*\.@&lt;:@0-9.@:&gt;@*\)@&lt;:@^0-9.@:&gt;@.*$/\1/&#39;`</span>
 487   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 488     # clang --version output typically looks like
 489     #    Apple LLVM version 5.0 (clang-500.2.79) (based on LLVM 3.3svn)
 490     #    clang version 3.3 (tags/RELEASE_33/final)
 491     # or
 492     #    Debian clang version 3.2-7ubuntu1 (tags/RELEASE_32/final) (based on LLVM 3.2)
 493     #    Target: x86_64-pc-linux-gnu
 494     #    Thread model: posix
 495     COMPILER_VERSION_OUTPUT=`$COMPILER --version 2&gt;&amp;1`
 496     # Check that this is likely to be clang
 497     $ECHO &quot;$COMPILER_VERSION_OUTPUT&quot; | $GREP &quot;clang&quot; &gt; /dev/null
 498     if test $? -ne 0; then
 499       AC_MSG_NOTICE([The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required $TOOLCHAIN_TYPE compiler.])
 500       AC_MSG_NOTICE([The result from running with --version was: &quot;$COMPILER_VERSION_OUTPUT&quot;])
 501       AC_MSG_ERROR([A $TOOLCHAIN_TYPE compiler is required. Try setting --with-tools-dir.])
 502     fi
 503     # Collapse compiler output into a single line
 504     COMPILER_VERSION_STRING=`$ECHO $COMPILER_VERSION_OUTPUT`
 505     COMPILER_VERSION_NUMBER=`$ECHO $COMPILER_VERSION_OUTPUT | \
 506         $SED -e &#39;s/^.* version \(@&lt;:@1-9@:&gt;@@&lt;:@0-9.@:&gt;@*\).*$/\1/&#39;`
</pre>
<hr />
<pre>
 621     # solstudio cc requires us to have an existing file to pass as argument,
 622     # but it need not be a syntactically correct C file, so just use
 623     # ourself. :) The intermediate &#39;cat&#39; is needed to stop ld from leaving
 624     # a lingering a.out (!).
 625     LINKER_VERSION_STRING=`$LD -Wl,-V $TOPDIR/configure 2&gt;&amp;1 | $CAT | $HEAD -n 1 | $SED -e &#39;s/ld: //&#39;`
 626     # Extract version number
 627     [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 628         $SED -e &#39;s/.* \([0-9][0-9]*\.[0-9][0-9]*\)-\([0-9][0-9]*\.[0-9][0-9]*\)/\1.\2/&#39;` ]
 629   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
 630     LINKER_VERSION_STRING=&quot;Unknown&quot;
 631     LINKER_VERSION_NUMBER=&quot;0.0&quot;
 632   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
 633     # There is no specific version flag, but all output starts with a version string.
 634     # First line typically looks something like:
 635     #   Microsoft (R) Incremental Linker Version 12.00.31101.0
 636     LINKER_VERSION_STRING=`$LD 2&gt;&amp;1 | $HEAD -n 1 | $TR -d &#39;\r&#39;`
 637     # Extract version number
 638     [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 639         $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*/\1/&#39;` ]
 640   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
<span class="line-modified"> 641     # gcc -Wl,-version output typically looks like:</span>
 642     #   GNU ld (GNU Binutils for Ubuntu) 2.26.1
 643     #   Copyright (C) 2015 Free Software Foundation, Inc.
 644     #   This program is free software; [...]
<span class="line-modified"> 645     # If using gold it will look like:</span>
<span class="line-added"> 646     #   GNU gold (GNU Binutils 2.30) 1.15</span>
<span class="line-added"> 647     LINKER_VERSION_STRING=`$LD -Wl,--version 2&gt; /dev/null | $HEAD -n 1`</span>
 648     # Extract version number
<span class="line-modified"> 649     if [ [[ &quot;$LINKER_VERSION_STRING&quot; == *gold* ]] ]; then</span>
<span class="line-modified"> 650       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \</span>
<span class="line-added"> 651           $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*) .*/\1/&#39;` ]</span>
<span class="line-added"> 652     else</span>
<span class="line-added"> 653       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \</span>
<span class="line-added"> 654           $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*/\1/&#39;` ]</span>
<span class="line-added"> 655     fi</span>
 656   elif test  &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
 657     # clang -Wl,-v output typically looks like
 658     #   @(#)PROGRAM:ld  PROJECT:ld64-305
 659     #   configured to support archs: armv6 armv7 armv7s arm64 i386 x86_64 x86_64h armv6m armv7k armv7m armv7em (tvOS)
 660     #   Library search paths: [...]
 661     # or
 662     #   GNU ld (GNU Binutils for Ubuntu) 2.26.1
 663 
 664     LINKER_VERSION_STRING=`$LD -Wl,-v 2&gt;&amp;1 | $HEAD -n 1`
 665     # Check if we&#39;re using the GNU ld
 666     $ECHO &quot;$LINKER_VERSION_STRING&quot; | $GREP &quot;GNU&quot; &gt; /dev/null
 667     if test $? -eq 0; then
 668       # Extract version number
 669       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 670           $SED -e &#39;s/.* \([0-9][0-9]*\(\.[0-9][0-9]*\)*\).*/\1/&#39;` ]
 671     else
 672       # Extract version number
 673       [ LINKER_VERSION_NUMBER=`$ECHO $LINKER_VERSION_STRING | \
 674           $SED -e &#39;s/.*-\([0-9][0-9]*\)/\1/&#39;` ]
 675     fi
</pre>
<hr />
<pre>
 982     BASIC_REQUIRE_PROGS(BUILD_CXX, [cl CC g++])
 983     BASIC_FIXUP_EXECUTABLE(BUILD_CXX)
 984     BASIC_PATH_PROGS(BUILD_NM, nm gcc-nm)
 985     BASIC_FIXUP_EXECUTABLE(BUILD_NM)
 986     BASIC_PATH_PROGS(BUILD_AR, ar gcc-ar)
 987     BASIC_FIXUP_EXECUTABLE(BUILD_AR)
 988     BASIC_PATH_PROGS(BUILD_OBJCOPY, objcopy)
 989     BASIC_FIXUP_EXECUTABLE(BUILD_OBJCOPY)
 990     BASIC_PATH_PROGS(BUILD_STRIP, strip)
 991     BASIC_FIXUP_EXECUTABLE(BUILD_STRIP)
 992     # Assume the C compiler is the assembler
 993     BUILD_AS=&quot;$BUILD_CC -c&quot;
 994     # Just like for the target compiler, use the compiler as linker
 995     BUILD_LD=&quot;$BUILD_CC&quot;
 996     BUILD_LDCXX=&quot;$BUILD_CXX&quot;
 997 
 998     PATH=&quot;$OLDPATH&quot;
 999 
1000     TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CC, [BuildC])
1001     TOOLCHAIN_EXTRACT_COMPILER_VERSION(BUILD_CXX, [BuildC++])
<span class="line-modified">1002     TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_], [build ])</span>
1003     TOOLCHAIN_EXTRACT_LD_VERSION(BUILD_LD, [build linker])
1004     TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_])
1005   else
1006     # If we are not cross compiling, use the normal target compilers for
1007     # building the build platform executables.
1008     BUILD_CC=&quot;$CC&quot;
1009     BUILD_CXX=&quot;$CXX&quot;
1010     BUILD_LD=&quot;$LD&quot;
1011     BUILD_LDCXX=&quot;$LDCXX&quot;
1012     BUILD_NM=&quot;$NM&quot;
1013     BUILD_AS=&quot;$AS&quot;
1014     BUILD_OBJCOPY=&quot;$OBJCOPY&quot;
1015     BUILD_STRIP=&quot;$STRIP&quot;
1016     BUILD_AR=&quot;$AR&quot;
1017 
<span class="line-modified">1018     TOOLCHAIN_PREPARE_FOR_VERSION_COMPARISONS([], [OPENJDK_BUILD_], [build ])</span>
1019     TOOLCHAIN_PREPARE_FOR_LD_VERSION_COMPARISONS([BUILD_], [OPENJDK_BUILD_])
1020   fi
1021 
1022   AC_SUBST(BUILD_CC)
1023   AC_SUBST(BUILD_CXX)
1024   AC_SUBST(BUILD_LD)
1025   AC_SUBST(BUILD_LDCXX)
1026   AC_SUBST(BUILD_NM)
1027   AC_SUBST(BUILD_AS)
1028   AC_SUBST(BUILD_AR)
1029 ])
1030 
1031 # Do some additional checks on the detected tools.
1032 AC_DEFUN_ONCE([TOOLCHAIN_MISC_CHECKS],
1033 [
1034   # Check for extra potential brokenness.
1035   if test  &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
1036     # On Windows, double-check that we got the right compiler.
1037     CC_VERSION_OUTPUT=`$CC 2&gt;&amp;1 | $GREP -v &#39;ERROR.*UtilTranslatePathList&#39; | $HEAD -n 1 | $TR -d &#39;\r&#39;`
1038     COMPILER_CPU_TEST=`$ECHO $CC_VERSION_OUTPUT | $SED -n &quot;s/^.* \(.*\)$/\1/p&quot;`
</pre>
</td>
</tr>
</table>
<center><a href="spec.gmk.in.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="toolchain_windows.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>