<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/basics.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../ZipSource.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="basics_windows.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/basics.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 188     if test &quot;x[$]$1&quot; = x; then
 189       $1=&quot;$2&quot;
 190     else
 191       $1=&quot;[$]$1:$2&quot;
 192     fi
 193   fi
 194 ])
 195 
 196 # Prepends a string to a path variable, only adding the : when needed.
 197 AC_DEFUN([BASIC_PREPEND_TO_PATH],
 198 [
 199   if test &quot;x$2&quot; != x; then
 200     if test &quot;x[$]$1&quot; = x; then
 201       $1=&quot;$2&quot;
 202     else
 203       $1=&quot;$2:[$]$1&quot;
 204     fi
 205   fi
 206 ])
 207 




























 208 ###############################################################################
 209 # This will make sure the given variable points to a full and proper
 210 # path. This means:
 211 # 1) There will be no spaces in the path. On unix platforms,
 212 #    spaces in the path will result in an error. On Windows,
 213 #    the path will be rewritten using short-style to be space-free.
 214 # 2) The path will be absolute, and it will be in unix-style (on
 215 #     cygwin).
 216 # $1: The name of the variable to fix
 217 AC_DEFUN([BASIC_FIXUP_PATH],
 218 [
 219   # Only process if variable expands to non-empty
<span class="line-removed"> 220 </span>
 221   if test &quot;x[$]$1&quot; != x; then
 222     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
 223       BASIC_FIXUP_PATH_CYGWIN($1)
 224     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
 225       BASIC_FIXUP_PATH_MSYS($1)
 226     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
 227       BASIC_FIXUP_PATH_WSL($1)
 228     else
 229       # We&#39;re on a unix platform. Hooray! :)
 230       path=&quot;[$]$1&quot;
 231       has_space=`$ECHO &quot;$path&quot; | $GREP &quot; &quot;`
 232       if test &quot;x$has_space&quot; != x; then
 233         AC_MSG_NOTICE([The path of $1, which resolves as &quot;$path&quot;, is invalid.])
 234         AC_MSG_ERROR([Spaces are not allowed in this path.])
 235       fi
 236 
<span class="line-modified"> 237       # Use eval to expand a potential ~</span>
<span class="line-modified"> 238       eval path=&quot;$path&quot;</span>
<span class="line-removed"> 239       if test ! -f &quot;$path&quot; &amp;&amp; test ! -d &quot;$path&quot;; then</span>
<span class="line-removed"> 240         AC_MSG_ERROR([The path of $1, which resolves as &quot;$path&quot;, is not found.])</span>
<span class="line-removed"> 241       fi</span>
<span class="line-removed"> 242 </span>
<span class="line-removed"> 243       if test -d &quot;$path&quot;; then</span>
<span class="line-removed"> 244         $1=&quot;`cd &quot;$path&quot;; $THEPWDCMD -L`&quot;</span>
<span class="line-removed"> 245       else</span>
<span class="line-removed"> 246         dir=&quot;`$DIRNAME &quot;$path&quot;`&quot;</span>
<span class="line-removed"> 247         base=&quot;`$BASENAME &quot;$path&quot;`&quot;</span>
<span class="line-removed"> 248         $1=&quot;`cd &quot;$dir&quot;; $THEPWDCMD -L`/$base&quot;</span>
<span class="line-removed"> 249       fi</span>
 250     fi
 251   fi
 252 ])
 253 
 254 ###############################################################################
 255 # This will make sure the given variable points to a executable
 256 # with a full and proper path. This means:
 257 # 1) There will be no spaces in the path. On unix platforms,
 258 #    spaces in the path will result in an error. On Windows,
 259 #    the path will be rewritten using short-style to be space-free.
 260 # 2) The path will be absolute, and it will be in unix-style (on
 261 #     cygwin).
 262 # Any arguments given to the executable is preserved.
 263 # If the input variable does not have a directory specification, then
 264 # it need to be in the PATH.
 265 # $1: The name of the variable to fix
 266 AC_DEFUN([BASIC_FIXUP_EXECUTABLE],
 267 [
 268   # Only process if variable expands to non-empty
 269 
</pre>
<hr />
<pre>
 394   if test &quot;x$enable_$2&quot; != x; then
 395     AC_MSG_WARN([Option --enable-$1 is deprecated and will be ignored.])
 396 
 397     if test &quot;x$3&quot; != x; then
 398       AC_MSG_WARN([$3])
 399     fi
 400 
 401   fi
 402 ])
 403 
 404 ###############################################################################
 405 AC_DEFUN_ONCE([BASIC_INIT],
 406 [
 407   # Save the original command line. This is passed to us by the wrapper configure script.
 408   AC_SUBST(CONFIGURE_COMMAND_LINE)
 409   # AUTOCONF might be set in the environment by the user. Preserve for &quot;make reconfigure&quot;.
 410   AC_SUBST(AUTOCONF)
 411   # Save the path variable before it gets changed
 412   ORIGINAL_PATH=&quot;$PATH&quot;
 413   AC_SUBST(ORIGINAL_PATH)
<span class="line-modified"> 414   DATE_WHEN_CONFIGURED=`LANG=C date`</span>
 415   AC_SUBST(DATE_WHEN_CONFIGURED)
 416   AC_MSG_NOTICE([Configuration created at $DATE_WHEN_CONFIGURED.])
 417 ])
 418 
 419 ###############################################################################
 420 # Test that variable $1 denoting a program is not empty. If empty, exit with an error.
 421 # $1: variable to check
 422 AC_DEFUN([BASIC_CHECK_NONEMPTY],
 423 [
 424   if test &quot;x[$]$1&quot; = x; then
 425     AC_MSG_ERROR([Could not find required tool for $1])
 426   fi
 427 ])
 428 
 429 ###############################################################################
 430 # Check that there are no unprocessed overridden variables left.
 431 # If so, they are an incorrect argument and we will exit with an error.
 432 AC_DEFUN([BASIC_CHECK_LEFTOVER_OVERRIDDEN],
 433 [
 434   if test &quot;x$CONFIGURE_OVERRIDDEN_VARIABLES&quot; != x; then
</pre>
<hr />
<pre>
 456     # The variable is set, but is it from the command line or the environment?
 457 
 458     # Try to remove the string !$1! from our list.
 459     try_remove_var=${CONFIGURE_OVERRIDDEN_VARIABLES//!$1!/}
 460     if test &quot;x$try_remove_var&quot; = &quot;x$CONFIGURE_OVERRIDDEN_VARIABLES&quot;; then
 461       # If it failed, the variable was not from the command line. Ignore it,
 462       # but warn the user (except for BASH, which is always set by the calling BASH).
 463       if test &quot;x$1&quot; != xBASH; then
 464         AC_MSG_WARN([Ignoring value of $1 from the environment. Use command line variables instead.])
 465       fi
 466       # Try to locate tool using the code snippet
 467       $2
 468     else
 469       # If it succeeded, then it was overridden by the user. We will use it
 470       # for the tool.
 471 
 472       # First remove it from the list of overridden variables, so we can test
 473       # for unknown variables in the end.
 474       CONFIGURE_OVERRIDDEN_VARIABLES=&quot;$try_remove_var&quot;
 475 



 476       # Check if we try to supply an empty value
<span class="line-modified"> 477       if test &quot;x[$]$1&quot; = x; then</span>
<span class="line-removed"> 478         AC_MSG_NOTICE([Setting user supplied tool $1= (no value)])</span>
 479         AC_MSG_CHECKING([for $1])
 480         AC_MSG_RESULT([disabled])
 481       else






 482         # Check if the provided tool contains a complete path.
<span class="line-modified"> 483         tool_specified=&quot;[$]$1&quot;</span>
<span class="line-modified"> 484         tool_basename=&quot;${tool_specified##*/}&quot;</span>
<span class="line-removed"> 485         if test &quot;x$tool_basename&quot; = &quot;x$tool_specified&quot;; then</span>
 486           # A command without a complete path is provided, search $PATH.
<span class="line-modified"> 487           AC_MSG_NOTICE([Will search for user supplied tool $1=$tool_basename])</span>
 488           AC_PATH_PROG($1, $tool_basename)
 489           if test &quot;x[$]$1&quot; = x; then
<span class="line-modified"> 490             AC_MSG_ERROR([User supplied tool $tool_basename could not be found])</span>
 491           fi
 492         else
 493           # Otherwise we believe it is a complete path. Use it as it is.
<span class="line-modified"> 494           AC_MSG_NOTICE([Will use user supplied tool $1=$tool_specified])</span>
<span class="line-modified"> 495           AC_MSG_CHECKING([for $1])</span>
<span class="line-modified"> 496           if test ! -x &quot;$tool_specified&quot;; then</span>
 497             AC_MSG_RESULT([not found])
<span class="line-modified"> 498             AC_MSG_ERROR([User supplied tool $1=$tool_specified does not exist or is not executable])</span>
 499           fi
<span class="line-modified"> 500           AC_MSG_RESULT([$tool_specified])</span>





 501         fi
 502       fi
 503     fi
 504     $3
 505   fi
 506 ])
 507 
 508 ###############################################################################
 509 # Call BASIC_SETUP_TOOL with AC_PATH_PROGS to locate the tool
 510 # $1: variable to set
 511 # $2: executable name (or list of names) to look for
 512 # $3: [path]
 513 AC_DEFUN([BASIC_PATH_PROGS],
 514 [
 515   BASIC_SETUP_TOOL($1, [AC_PATH_PROGS($1, $2, , $3)])
 516 ])
 517 
 518 ###############################################################################
 519 # Call BASIC_SETUP_TOOL with AC_CHECK_TOOLS to locate the tool
 520 # $1: variable to set
</pre>
<hr />
<pre>
 528 # Like BASIC_PATH_PROGS but fails if no tool was found.
 529 # $1: variable to set
 530 # $2: executable name (or list of names) to look for
 531 # $3: [path]
 532 AC_DEFUN([BASIC_REQUIRE_PROGS],
 533 [
 534   BASIC_PATH_PROGS($1, $2, , $3)
 535   BASIC_CHECK_NONEMPTY($1)
 536 ])
 537 
 538 ###############################################################################
 539 # Like BASIC_SETUP_TOOL but fails if no tool was found.
 540 # $1: variable to set
 541 # $2: autoconf macro to call to look for the special tool
 542 AC_DEFUN([BASIC_REQUIRE_SPECIAL],
 543 [
 544   BASIC_SETUP_TOOL($1, [$2])
 545   BASIC_CHECK_NONEMPTY($1)
 546 ])
 547 




















 548 ###############################################################################
 549 # Setup the most fundamental tools that relies on not much else to set up,
 550 # but is used by much of the early bootstrap code.
 551 AC_DEFUN_ONCE([BASIC_SETUP_FUNDAMENTAL_TOOLS],
 552 [
 553   # Start with tools that do not need have cross compilation support
 554   # and can be expected to be found in the default PATH. These tools are
 555   # used by configure.
 556 
 557   # First are all the simple required tools.
 558   BASIC_REQUIRE_PROGS(BASENAME, basename)
 559   BASIC_REQUIRE_PROGS(BASH, bash)
 560   BASIC_REQUIRE_PROGS(CAT, cat)
 561   BASIC_REQUIRE_PROGS(CHMOD, chmod)
 562   BASIC_REQUIRE_PROGS(CMP, cmp)
 563   BASIC_REQUIRE_PROGS(COMM, comm)
 564   BASIC_REQUIRE_PROGS(CP, cp)
 565   BASIC_REQUIRE_PROGS(CUT, cut)
 566   BASIC_REQUIRE_PROGS(DATE, date)
 567   BASIC_REQUIRE_PROGS(DIFF, [gdiff diff])
</pre>
<hr />
<pre>
 610   # pwd behaves differently on various platforms and some don&#39;t support the -L flag.
 611   # Always use the bash builtin pwd to get uniform behavior.
 612   THEPWDCMD=pwd
 613 
 614   # These are not required on all platforms
 615   BASIC_PATH_PROGS(CYGPATH, cygpath)
 616   BASIC_PATH_PROGS(WSLPATH, wslpath)
 617   BASIC_PATH_PROGS(DF, df)
 618   BASIC_PATH_PROGS(CPIO, [cpio bsdcpio])
 619   BASIC_PATH_PROGS(NICE, nice)
 620 
 621   BASIC_PATH_PROGS(LSB_RELEASE, lsb_release)
 622   BASIC_PATH_PROGS(CMD, [cmd.exe /mnt/c/Windows/System32/cmd.exe])
 623 ])
 624 
 625 ###############################################################################
 626 # Setup basic configuration paths, and platform-specific stuff related to PATHs.
 627 AC_DEFUN_ONCE([BASIC_SETUP_PATHS],
 628 [
 629   # Save the current directory this script was started from
<span class="line-modified"> 630   CURDIR=&quot;$PWD&quot;</span>
 631 
 632   # We might need to rewrite ORIGINAL_PATH, if it includes &quot;#&quot;, to quote them
 633   # for make. We couldn&#39;t do this when we retrieved ORIGINAL_PATH, since SED
 634   # was not available at that time.
 635   REWRITTEN_PATH=`$ECHO &quot;$ORIGINAL_PATH&quot; | $SED -e &#39;s/#/\\\\#/g&#39;`
 636   if test &quot;x$REWRITTEN_PATH&quot; != &quot;x$ORIGINAL_PATH&quot;; then
 637     ORIGINAL_PATH=&quot;$REWRITTEN_PATH&quot;
 638     AC_MSG_NOTICE([Rewriting ORIGINAL_PATH to $REWRITTEN_PATH])
 639   fi
 640 
 641   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
 642     PATH_SEP=&quot;;&quot;
 643     EXE_SUFFIX=&quot;.exe&quot;
 644     BASIC_CHECK_PATHS_WINDOWS
 645   else
 646     PATH_SEP=&quot;:&quot;
 647     EXE_SUFFIX=&quot;&quot;
 648   fi
 649   AC_SUBST(PATH_SEP)
 650   AC_SUBST(EXE_SUFFIX)
 651 
 652   # We get the top-level directory from the supporting wrappers.
 653   AC_MSG_CHECKING([for top-level directory])
 654   AC_MSG_RESULT([$TOPDIR])
 655   AC_SUBST(TOPDIR)

 656 
 657   # We can only call BASIC_FIXUP_PATH after BASIC_CHECK_PATHS_WINDOWS.
<span class="line-modified"> 658   BASIC_FIXUP_PATH(CURDIR)</span>
 659   BASIC_FIXUP_PATH(TOPDIR)
 660 
 661   # Locate the directory of this script.
 662   AUTOCONF_DIR=$TOPDIR/make/autoconf
 663 
 664   # Setup username (for use in adhoc version strings etc)
 665   # Outer [ ] to quote m4.
 666   [ USERNAME=`$ECHO &quot;$USER&quot; | $TR -d -c &#39;[a-z][A-Z][0-9]&#39;` ]
 667   AC_SUBST(USERNAME)
 668 ])
 669 
 670 ###############################################################################
 671 # Evaluates platform specific overrides for devkit variables.
 672 # $1: Name of variable
 673 AC_DEFUN([BASIC_EVAL_DEVKIT_VARIABLE],
 674 [
 675   if test &quot;x[$]$1&quot; = x; then
 676     eval $1=&quot;\${$1_${OPENJDK_TARGET_CPU}}&quot;
 677   fi
 678 ])
</pre>
<hr />
<pre>
 851   BASIC_PREPEND_TO_PATH([PATH],$EXTRA_PATH)
 852 
 853   AC_MSG_CHECKING([for sysroot])
 854   AC_MSG_RESULT([$SYSROOT])
 855   AC_MSG_CHECKING([for toolchain path])
 856   AC_MSG_RESULT([$TOOLCHAIN_PATH])
 857   AC_MSG_CHECKING([for extra path])
 858   AC_MSG_RESULT([$EXTRA_PATH])
 859 ])
 860 
 861 ###############################################################################
 862 AC_DEFUN_ONCE([BASIC_SETUP_OUTPUT_DIR],
 863 [
 864 
 865   AC_ARG_WITH(conf-name, [AS_HELP_STRING([--with-conf-name],
 866       [use this as the name of the configuration @&lt;:@generated from important configuration options@:&gt;@])],
 867       [ CONF_NAME=${with_conf_name} ])
 868 
 869   # Test from where we are running configure, in or outside of src root.
 870   AC_MSG_CHECKING([where to store configuration])
<span class="line-modified"> 871   if test &quot;x$CURDIR&quot; = &quot;x$TOPDIR&quot; || test &quot;x$CURDIR&quot; = &quot;x$CUSTOM_ROOT&quot; \</span>
<span class="line-modified"> 872       || test &quot;x$CURDIR&quot; = &quot;x$TOPDIR/make/autoconf&quot; \</span>
<span class="line-modified"> 873       || test &quot;x$CURDIR&quot; = &quot;x$TOPDIR/make&quot; ; then</span>

 874     # We are running configure from the src root.
 875     # Create a default ./build/target-variant-debuglevel output root.
 876     if test &quot;x${CONF_NAME}&quot; = x; then
 877       AC_MSG_RESULT([in default location])
 878       CONF_NAME=&quot;${OPENJDK_TARGET_OS}-${OPENJDK_TARGET_CPU}-${JVM_VARIANTS_WITH_AND}-${DEBUG_LEVEL}&quot;
 879     else
 880       AC_MSG_RESULT([in build directory with custom name])
 881     fi
 882 
 883     if test &quot;x$CUSTOM_ROOT&quot; != x; then
<span class="line-modified"> 884       OUTPUTDIR=&quot;${CUSTOM_ROOT}/build/${CONF_NAME}&quot;</span>
 885     else
<span class="line-modified"> 886       OUTPUTDIR=&quot;${TOPDIR}/build/${CONF_NAME}&quot;</span>
 887     fi

 888     $MKDIR -p &quot;$OUTPUTDIR&quot;
 889     if test ! -d &quot;$OUTPUTDIR&quot;; then
 890       AC_MSG_ERROR([Could not create build directory $OUTPUTDIR])
 891     fi
 892   else
 893     # We are running configure from outside of the src dir.
 894     # Then use the current directory as output dir!
 895     # If configuration is situated in normal build directory, just use the build
 896     # directory name as configuration name, otherwise use the complete path.
 897     if test &quot;x${CONF_NAME}&quot; = x; then
<span class="line-modified"> 898       CONF_NAME=`$ECHO $CURDIR | $SED -e &quot;s!^${TOPDIR}/build/!!&quot;`</span>
 899     fi
<span class="line-modified"> 900     OUTPUTDIR=&quot;$CURDIR&quot;</span>
 901     AC_MSG_RESULT([in current directory])
 902 
 903     # WARNING: This might be a bad thing to do. You need to be sure you want to
 904     # have a configuration in this directory. Do some sanity checks!
 905 
 906     if test ! -e &quot;$OUTPUTDIR/spec.gmk&quot;; then
 907       # If we have a spec.gmk, we have run here before and we are OK. Otherwise, check for
 908       # other files
 909       files_present=`$LS $OUTPUTDIR`
 910       # Configure has already touched config.log and confdefs.h in the current dir when this check
 911       # is performed.
 912       filtered_files=`$ECHO &quot;$files_present&quot; \
 913           | $SED -e &#39;s/config.log//g&#39; \
 914               -e &#39;s/configure.log//g&#39; \
 915               -e &#39;s/confdefs.h//g&#39; \
 916               -e &#39;s/configure-support//g&#39; \
 917               -e &#39;s/ //g&#39; \
 918           | $TR -d &#39;\n&#39;`
 919       if test &quot;x$filtered_files&quot; != x; then
<span class="line-modified"> 920         AC_MSG_NOTICE([Current directory is $CURDIR.])</span>
 921         AC_MSG_NOTICE([Since this is not the source root, configure will output the configuration here])
 922         AC_MSG_NOTICE([(as opposed to creating a configuration in &lt;src_root&gt;/build/&lt;conf-name&gt;).])
 923         AC_MSG_NOTICE([However, this directory is not empty. This is not allowed, since it could])
 924         AC_MSG_NOTICE([seriously mess up just about everything.])
 925         AC_MSG_NOTICE([Try &#39;cd $TOPDIR&#39; and restart configure])
 926         AC_MSG_NOTICE([(or create a new empty directory and cd to it).])
<span class="line-modified"> 927         AC_MSG_ERROR([Will not continue creating configuration in $CURDIR])</span>
 928       fi
 929     fi
 930   fi
 931   AC_MSG_CHECKING([what configuration name to use])
 932   AC_MSG_RESULT([$CONF_NAME])
 933 
 934   BASIC_FIXUP_PATH(OUTPUTDIR)
 935 
 936   CONFIGURESUPPORT_OUTPUTDIR=&quot;$OUTPUTDIR/configure-support&quot;
 937   $MKDIR -p &quot;$CONFIGURESUPPORT_OUTPUTDIR&quot;
 938 
 939   SPEC=&quot;$OUTPUTDIR/spec.gmk&quot;
 940   AC_SUBST(SPEC)
 941   AC_SUBST(CONF_NAME)
 942   AC_SUBST(OUTPUTDIR)

 943   AC_SUBST(CONFIGURESUPPORT_OUTPUTDIR)
 944 
 945   # The spec.gmk file contains all variables for the make system.
 946   AC_CONFIG_FILES([$OUTPUTDIR/spec.gmk:$AUTOCONF_DIR/spec.gmk.in])
 947   # The bootcycle-spec.gmk file contains support for boot cycle builds.
 948   AC_CONFIG_FILES([$OUTPUTDIR/bootcycle-spec.gmk:$AUTOCONF_DIR/bootcycle-spec.gmk.in])
 949   # The buildjdk-spec.gmk file contains support for building a buildjdk when cross compiling.
 950   AC_CONFIG_FILES([$OUTPUTDIR/buildjdk-spec.gmk:$AUTOCONF_DIR/buildjdk-spec.gmk.in])
 951   # The compare.sh is used to compare the build output to other builds.
 952   AC_CONFIG_FILES([$OUTPUTDIR/compare.sh:$AUTOCONF_DIR/compare.sh.in])
 953   # The generated Makefile knows where the spec.gmk is and where the source is.
 954   # You can run make from the OUTPUTDIR, or from the top-level Makefile
 955   # which will look for generated configurations
 956   AC_CONFIG_FILES([$OUTPUTDIR/Makefile:$AUTOCONF_DIR/Makefile.in])
 957 ])
 958 
 959 #%%% Simple tools %%%
 960 
 961 ###############################################################################
 962 # Check if we have found a usable version of make
</pre>
<hr />
<pre>
1113     AC_MSG_RESULT([no])
1114   else
1115     AC_MSG_RESULT([yes])
1116   fi
1117   $RMDIR $DELETEDIR
1118   AC_SUBST(FIND_DELETE)
1119 ])
1120 
1121 ###############################################################################
1122 AC_DEFUN([BASIC_CHECK_TAR],
1123 [
1124   # Test which kind of tar was found
1125   if test &quot;x$($TAR --version | $GREP &quot;GNU tar&quot;)&quot; != &quot;x&quot;; then
1126     TAR_TYPE=&quot;gnu&quot;
1127   elif test &quot;x$($TAR --version | $GREP &quot;bsdtar&quot;)&quot; != &quot;x&quot;; then
1128     TAR_TYPE=&quot;bsd&quot;
1129   elif test &quot;x$($TAR -v | $GREP &quot;bsdtar&quot;)&quot; != &quot;x&quot;; then
1130     TAR_TYPE=&quot;bsd&quot;
1131   elif test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xsolaris&quot;; then
1132     TAR_TYPE=&quot;solaris&quot;


1133   fi
1134   AC_MSG_CHECKING([what type of tar was found])
1135   AC_MSG_RESULT([$TAR_TYPE])
1136 
1137   TAR_CREATE_FILE_PARAM=&quot;&quot;
1138 
1139   if test &quot;x$TAR_TYPE&quot; = &quot;xgnu&quot;; then
1140     TAR_INCLUDE_PARAM=&quot;T&quot;
1141     TAR_SUPPORTS_TRANSFORM=&quot;true&quot;
1142     if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then
1143       # When using gnu tar for Solaris targets, need to use compatibility mode
1144       TAR_CREATE_EXTRA_PARAM=&quot;--format=ustar&quot;
1145     fi





1146   else
1147     TAR_INCLUDE_PARAM=&quot;I&quot;
1148     TAR_SUPPORTS_TRANSFORM=&quot;false&quot;
1149   fi
1150   AC_SUBST(TAR_TYPE)
1151   AC_SUBST(TAR_CREATE_EXTRA_PARAM)
1152   AC_SUBST(TAR_INCLUDE_PARAM)
1153   AC_SUBST(TAR_SUPPORTS_TRANSFORM)
1154 ])
1155 
1156 ###############################################################################
1157 AC_DEFUN([BASIC_CHECK_GREP],
1158 [
1159   # Test that grep supports -Fx with a list of pattern which includes null pattern.
1160   # This is a problem for the grep resident on AIX.
1161   AC_MSG_CHECKING([that grep ($GREP) -Fx handles empty lines in the pattern list correctly])
1162   # Multiple subsequent spaces..
1163   STACK_SPACES=&#39;aaa   bbb   ccc&#39;
1164   # ..converted to subsequent newlines, causes STACK_LIST to be a list with some empty
1165   # patterns in it.
</pre>
<hr />
<pre>
1211   BASIC_PATH_PROGS(TIME, time)
1212   BASIC_PATH_PROGS(FLOCK, flock)
1213   # Dtrace is usually found in /usr/sbin on Solaris, but that directory may not
1214   # be in the user path.
1215   BASIC_PATH_PROGS(DTRACE, dtrace, $PATH:/usr/sbin)
1216   BASIC_PATH_PROGS(PATCH, [gpatch patch])
1217   # Check if it&#39;s GNU time
1218   IS_GNU_TIME=`$TIME --version 2&gt;&amp;1 | $GREP &#39;GNU time&#39;`
1219   if test &quot;x$IS_GNU_TIME&quot; != x; then
1220     IS_GNU_TIME=yes
1221   else
1222     IS_GNU_TIME=no
1223   fi
1224   AC_SUBST(IS_GNU_TIME)
1225 
1226   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot;; then
1227     BASIC_REQUIRE_PROGS(DSYMUTIL, dsymutil)
1228     BASIC_REQUIRE_PROGS(MIG, mig)
1229     BASIC_REQUIRE_PROGS(XATTR, xattr)
1230     BASIC_PATH_PROGS(CODESIGN, codesign)

1231     if test &quot;x$CODESIGN&quot; != &quot;x&quot;; then
<span class="line-modified">1232       # Verify that the openjdk_codesign certificate is present</span>
<span class="line-modified">1233       AC_MSG_CHECKING([if openjdk_codesign certificate is present])</span>










1234       $RM codesign-testfile
1235       $TOUCH codesign-testfile
<span class="line-modified">1236       $CODESIGN -s openjdk_codesign codesign-testfile 2&gt;&amp;AS_MESSAGE_LOG_FD &gt;&amp;AS_MESSAGE_LOG_FD || CODESIGN=</span>
1237       $RM codesign-testfile
1238       if test &quot;x$CODESIGN&quot; = x; then
1239         AC_MSG_RESULT([no])
1240       else
1241         AC_MSG_RESULT([yes])
1242       fi
1243     fi
1244     BASIC_REQUIRE_PROGS(SETFILE, SetFile)
1245   elif test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then
1246     BASIC_REQUIRE_PROGS(ELFEDIT, elfedit)
1247   fi



1248 ])
1249 
1250 ###############################################################################
1251 # Check if build directory is on local disk. If not possible to determine,
1252 # we prefer to claim it&#39;s local.
1253 # Argument 1: directory to test
1254 # Argument 2: what to do if it is on local disk
1255 # Argument 3: what to do otherwise (remote disk or failure)
1256 AC_DEFUN([BASIC_CHECK_DIR_ON_LOCAL_DISK],
1257 [
1258   # df -l lists only local disks; if the given directory is not found then
1259   # a non-zero exit code is given
1260   if test &quot;x$DF&quot; = x; then
1261     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
1262       # msys does not have df; use Windows &quot;net use&quot; instead.
1263       IS_NETWORK_DISK=`net use | grep \`pwd -W | cut -d &quot;:&quot; -f 1 | tr a-z A-Z\`:`
1264       if test &quot;x$IS_NETWORK_DISK&quot; = x; then
1265         $2
1266       else
1267         $3
</pre>
</td>
<td>
<hr />
<pre>
 188     if test &quot;x[$]$1&quot; = x; then
 189       $1=&quot;$2&quot;
 190     else
 191       $1=&quot;[$]$1:$2&quot;
 192     fi
 193   fi
 194 ])
 195 
 196 # Prepends a string to a path variable, only adding the : when needed.
 197 AC_DEFUN([BASIC_PREPEND_TO_PATH],
 198 [
 199   if test &quot;x$2&quot; != x; then
 200     if test &quot;x[$]$1&quot; = x; then
 201       $1=&quot;$2&quot;
 202     else
 203       $1=&quot;$2:[$]$1&quot;
 204     fi
 205   fi
 206 ])
 207 
<span class="line-added"> 208 ################################################################################</span>
<span class="line-added"> 209 # This will make a path absolute. Assumes it&#39;s already a unix path. Also</span>
<span class="line-added"> 210 # resolves ~ to homedir.</span>
<span class="line-added"> 211 AC_DEFUN([BASIC_ABSOLUTE_PATH],</span>
<span class="line-added"> 212 [</span>
<span class="line-added"> 213   if test &quot;x[$]$1&quot; != x; then</span>
<span class="line-added"> 214     new_path=&quot;[$]$1&quot;</span>
<span class="line-added"> 215 </span>
<span class="line-added"> 216     # Use eval to expand a potential ~. This technique does not work if there</span>
<span class="line-added"> 217     # are spaces in the path (which is valid at this point on Windows), so only</span>
<span class="line-added"> 218     # try to apply it if there is an actual ~ first in the path.</span>
<span class="line-added"> 219     if [ [[ &quot;$new_path&quot; = &quot;~&quot;* ]] ]; then</span>
<span class="line-added"> 220       eval new_path=&quot;$new_path&quot;</span>
<span class="line-added"> 221       if test ! -f &quot;$new_path&quot; &amp;&amp; test ! -d &quot;$new_path&quot;; then</span>
<span class="line-added"> 222         AC_MSG_ERROR([The new_path of $1, which resolves as &quot;$new_path&quot;, is not found.])</span>
<span class="line-added"> 223       fi</span>
<span class="line-added"> 224     fi</span>
<span class="line-added"> 225 </span>
<span class="line-added"> 226     if test -d &quot;$new_path&quot;; then</span>
<span class="line-added"> 227       $1=&quot;`cd &quot;$new_path&quot;; $THEPWDCMD -L`&quot;</span>
<span class="line-added"> 228     else</span>
<span class="line-added"> 229       dir=&quot;`$DIRNAME &quot;$new_path&quot;`&quot;</span>
<span class="line-added"> 230       base=&quot;`$BASENAME &quot;$new_path&quot;`&quot;</span>
<span class="line-added"> 231       $1=&quot;`cd &quot;$dir&quot;; $THEPWDCMD -L`/$base&quot;</span>
<span class="line-added"> 232     fi</span>
<span class="line-added"> 233   fi</span>
<span class="line-added"> 234 ])</span>
<span class="line-added"> 235 </span>
 236 ###############################################################################
 237 # This will make sure the given variable points to a full and proper
 238 # path. This means:
 239 # 1) There will be no spaces in the path. On unix platforms,
 240 #    spaces in the path will result in an error. On Windows,
 241 #    the path will be rewritten using short-style to be space-free.
 242 # 2) The path will be absolute, and it will be in unix-style (on
 243 #     cygwin).
 244 # $1: The name of the variable to fix
 245 AC_DEFUN([BASIC_FIXUP_PATH],
 246 [
 247   # Only process if variable expands to non-empty

 248   if test &quot;x[$]$1&quot; != x; then
 249     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.cygwin&quot;; then
 250       BASIC_FIXUP_PATH_CYGWIN($1)
 251     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
 252       BASIC_FIXUP_PATH_MSYS($1)
 253     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
 254       BASIC_FIXUP_PATH_WSL($1)
 255     else
 256       # We&#39;re on a unix platform. Hooray! :)
 257       path=&quot;[$]$1&quot;
 258       has_space=`$ECHO &quot;$path&quot; | $GREP &quot; &quot;`
 259       if test &quot;x$has_space&quot; != x; then
 260         AC_MSG_NOTICE([The path of $1, which resolves as &quot;$path&quot;, is invalid.])
 261         AC_MSG_ERROR([Spaces are not allowed in this path.])
 262       fi
 263 
<span class="line-modified"> 264       BASIC_ABSOLUTE_PATH(path)</span>
<span class="line-modified"> 265       $1=&quot;$path&quot;</span>











 266     fi
 267   fi
 268 ])
 269 
 270 ###############################################################################
 271 # This will make sure the given variable points to a executable
 272 # with a full and proper path. This means:
 273 # 1) There will be no spaces in the path. On unix platforms,
 274 #    spaces in the path will result in an error. On Windows,
 275 #    the path will be rewritten using short-style to be space-free.
 276 # 2) The path will be absolute, and it will be in unix-style (on
 277 #     cygwin).
 278 # Any arguments given to the executable is preserved.
 279 # If the input variable does not have a directory specification, then
 280 # it need to be in the PATH.
 281 # $1: The name of the variable to fix
 282 AC_DEFUN([BASIC_FIXUP_EXECUTABLE],
 283 [
 284   # Only process if variable expands to non-empty
 285 
</pre>
<hr />
<pre>
 410   if test &quot;x$enable_$2&quot; != x; then
 411     AC_MSG_WARN([Option --enable-$1 is deprecated and will be ignored.])
 412 
 413     if test &quot;x$3&quot; != x; then
 414       AC_MSG_WARN([$3])
 415     fi
 416 
 417   fi
 418 ])
 419 
 420 ###############################################################################
 421 AC_DEFUN_ONCE([BASIC_INIT],
 422 [
 423   # Save the original command line. This is passed to us by the wrapper configure script.
 424   AC_SUBST(CONFIGURE_COMMAND_LINE)
 425   # AUTOCONF might be set in the environment by the user. Preserve for &quot;make reconfigure&quot;.
 426   AC_SUBST(AUTOCONF)
 427   # Save the path variable before it gets changed
 428   ORIGINAL_PATH=&quot;$PATH&quot;
 429   AC_SUBST(ORIGINAL_PATH)
<span class="line-modified"> 430   DATE_WHEN_CONFIGURED=`date`</span>
 431   AC_SUBST(DATE_WHEN_CONFIGURED)
 432   AC_MSG_NOTICE([Configuration created at $DATE_WHEN_CONFIGURED.])
 433 ])
 434 
 435 ###############################################################################
 436 # Test that variable $1 denoting a program is not empty. If empty, exit with an error.
 437 # $1: variable to check
 438 AC_DEFUN([BASIC_CHECK_NONEMPTY],
 439 [
 440   if test &quot;x[$]$1&quot; = x; then
 441     AC_MSG_ERROR([Could not find required tool for $1])
 442   fi
 443 ])
 444 
 445 ###############################################################################
 446 # Check that there are no unprocessed overridden variables left.
 447 # If so, they are an incorrect argument and we will exit with an error.
 448 AC_DEFUN([BASIC_CHECK_LEFTOVER_OVERRIDDEN],
 449 [
 450   if test &quot;x$CONFIGURE_OVERRIDDEN_VARIABLES&quot; != x; then
</pre>
<hr />
<pre>
 472     # The variable is set, but is it from the command line or the environment?
 473 
 474     # Try to remove the string !$1! from our list.
 475     try_remove_var=${CONFIGURE_OVERRIDDEN_VARIABLES//!$1!/}
 476     if test &quot;x$try_remove_var&quot; = &quot;x$CONFIGURE_OVERRIDDEN_VARIABLES&quot;; then
 477       # If it failed, the variable was not from the command line. Ignore it,
 478       # but warn the user (except for BASH, which is always set by the calling BASH).
 479       if test &quot;x$1&quot; != xBASH; then
 480         AC_MSG_WARN([Ignoring value of $1 from the environment. Use command line variables instead.])
 481       fi
 482       # Try to locate tool using the code snippet
 483       $2
 484     else
 485       # If it succeeded, then it was overridden by the user. We will use it
 486       # for the tool.
 487 
 488       # First remove it from the list of overridden variables, so we can test
 489       # for unknown variables in the end.
 490       CONFIGURE_OVERRIDDEN_VARIABLES=&quot;$try_remove_var&quot;
 491 
<span class="line-added"> 492       tool_override=[$]$1</span>
<span class="line-added"> 493       AC_MSG_NOTICE([User supplied override $1=&quot;$tool_override&quot;])</span>
<span class="line-added"> 494 </span>
 495       # Check if we try to supply an empty value
<span class="line-modified"> 496       if test &quot;x$tool_override&quot; = x; then</span>

 497         AC_MSG_CHECKING([for $1])
 498         AC_MSG_RESULT([disabled])
 499       else
<span class="line-added"> 500         # Split up override in command part and argument part</span>
<span class="line-added"> 501         tool_and_args=($tool_override)</span>
<span class="line-added"> 502         [ tool_command=${tool_and_args[0]} ]</span>
<span class="line-added"> 503         [ unset &#39;tool_and_args[0]&#39; ]</span>
<span class="line-added"> 504         [ tool_args=${tool_and_args[@]} ]</span>
<span class="line-added"> 505 </span>
 506         # Check if the provided tool contains a complete path.
<span class="line-modified"> 507         tool_basename=&quot;${tool_command##*/}&quot;</span>
<span class="line-modified"> 508         if test &quot;x$tool_basename&quot; = &quot;x$tool_command&quot;; then</span>

 509           # A command without a complete path is provided, search $PATH.
<span class="line-modified"> 510           AC_MSG_NOTICE([Will search for user supplied tool &quot;$tool_basename&quot;])</span>
 511           AC_PATH_PROG($1, $tool_basename)
 512           if test &quot;x[$]$1&quot; = x; then
<span class="line-modified"> 513             AC_MSG_ERROR([User supplied tool $1=&quot;$tool_basename&quot; could not be found])</span>
 514           fi
 515         else
 516           # Otherwise we believe it is a complete path. Use it as it is.
<span class="line-modified"> 517           AC_MSG_NOTICE([Will use user supplied tool &quot;$tool_command&quot;])</span>
<span class="line-modified"> 518           AC_MSG_CHECKING([for $tool_command])</span>
<span class="line-modified"> 519           if test ! -x &quot;$tool_command&quot;; then</span>
 520             AC_MSG_RESULT([not found])
<span class="line-modified"> 521             AC_MSG_ERROR([User supplied tool $1=&quot;$tool_command&quot; does not exist or is not executable])</span>
 522           fi
<span class="line-modified"> 523            $1=&quot;$tool_command&quot;</span>
<span class="line-added"> 524           AC_MSG_RESULT([found])</span>
<span class="line-added"> 525         fi</span>
<span class="line-added"> 526         if test &quot;x$tool_args&quot; != x; then</span>
<span class="line-added"> 527           # If we got arguments, re-append them to the command after the fixup.</span>
<span class="line-added"> 528           $1=&quot;[$]$1 $tool_args&quot;</span>
 529         fi
 530       fi
 531     fi
 532     $3
 533   fi
 534 ])
 535 
 536 ###############################################################################
 537 # Call BASIC_SETUP_TOOL with AC_PATH_PROGS to locate the tool
 538 # $1: variable to set
 539 # $2: executable name (or list of names) to look for
 540 # $3: [path]
 541 AC_DEFUN([BASIC_PATH_PROGS],
 542 [
 543   BASIC_SETUP_TOOL($1, [AC_PATH_PROGS($1, $2, , $3)])
 544 ])
 545 
 546 ###############################################################################
 547 # Call BASIC_SETUP_TOOL with AC_CHECK_TOOLS to locate the tool
 548 # $1: variable to set
</pre>
<hr />
<pre>
 556 # Like BASIC_PATH_PROGS but fails if no tool was found.
 557 # $1: variable to set
 558 # $2: executable name (or list of names) to look for
 559 # $3: [path]
 560 AC_DEFUN([BASIC_REQUIRE_PROGS],
 561 [
 562   BASIC_PATH_PROGS($1, $2, , $3)
 563   BASIC_CHECK_NONEMPTY($1)
 564 ])
 565 
 566 ###############################################################################
 567 # Like BASIC_SETUP_TOOL but fails if no tool was found.
 568 # $1: variable to set
 569 # $2: autoconf macro to call to look for the special tool
 570 AC_DEFUN([BASIC_REQUIRE_SPECIAL],
 571 [
 572   BASIC_SETUP_TOOL($1, [$2])
 573   BASIC_CHECK_NONEMPTY($1)
 574 ])
 575 
<span class="line-added"> 576 ###############################################################################</span>
<span class="line-added"> 577 # Like BASIC_REQUIRE_PROGS but also allows for bash built-ins</span>
<span class="line-added"> 578 # $1: variable to set</span>
<span class="line-added"> 579 # $2: executable name (or list of names) to look for</span>
<span class="line-added"> 580 # $3: [path]</span>
<span class="line-added"> 581 AC_DEFUN([BASIC_REQUIRE_BUILTIN_PROGS],</span>
<span class="line-added"> 582 [</span>
<span class="line-added"> 583   BASIC_SETUP_TOOL($1, [AC_PATH_PROGS($1, $2, , $3)])</span>
<span class="line-added"> 584   if test &quot;x[$]$1&quot; = x; then</span>
<span class="line-added"> 585     AC_MSG_NOTICE([Required tool $2 not found in PATH, checking built-in])</span>
<span class="line-added"> 586     if help $2 &gt; /dev/null 2&gt;&amp;1; then</span>
<span class="line-added"> 587       AC_MSG_NOTICE([Found $2 as shell built-in. Using it])</span>
<span class="line-added"> 588       $1=&quot;$2&quot;</span>
<span class="line-added"> 589     else</span>
<span class="line-added"> 590       AC_MSG_ERROR([Required tool $2 also not found as built-in.])</span>
<span class="line-added"> 591     fi</span>
<span class="line-added"> 592   fi</span>
<span class="line-added"> 593   BASIC_CHECK_NONEMPTY($1)</span>
<span class="line-added"> 594 ])</span>
<span class="line-added"> 595 </span>
 596 ###############################################################################
 597 # Setup the most fundamental tools that relies on not much else to set up,
 598 # but is used by much of the early bootstrap code.
 599 AC_DEFUN_ONCE([BASIC_SETUP_FUNDAMENTAL_TOOLS],
 600 [
 601   # Start with tools that do not need have cross compilation support
 602   # and can be expected to be found in the default PATH. These tools are
 603   # used by configure.
 604 
 605   # First are all the simple required tools.
 606   BASIC_REQUIRE_PROGS(BASENAME, basename)
 607   BASIC_REQUIRE_PROGS(BASH, bash)
 608   BASIC_REQUIRE_PROGS(CAT, cat)
 609   BASIC_REQUIRE_PROGS(CHMOD, chmod)
 610   BASIC_REQUIRE_PROGS(CMP, cmp)
 611   BASIC_REQUIRE_PROGS(COMM, comm)
 612   BASIC_REQUIRE_PROGS(CP, cp)
 613   BASIC_REQUIRE_PROGS(CUT, cut)
 614   BASIC_REQUIRE_PROGS(DATE, date)
 615   BASIC_REQUIRE_PROGS(DIFF, [gdiff diff])
</pre>
<hr />
<pre>
 658   # pwd behaves differently on various platforms and some don&#39;t support the -L flag.
 659   # Always use the bash builtin pwd to get uniform behavior.
 660   THEPWDCMD=pwd
 661 
 662   # These are not required on all platforms
 663   BASIC_PATH_PROGS(CYGPATH, cygpath)
 664   BASIC_PATH_PROGS(WSLPATH, wslpath)
 665   BASIC_PATH_PROGS(DF, df)
 666   BASIC_PATH_PROGS(CPIO, [cpio bsdcpio])
 667   BASIC_PATH_PROGS(NICE, nice)
 668 
 669   BASIC_PATH_PROGS(LSB_RELEASE, lsb_release)
 670   BASIC_PATH_PROGS(CMD, [cmd.exe /mnt/c/Windows/System32/cmd.exe])
 671 ])
 672 
 673 ###############################################################################
 674 # Setup basic configuration paths, and platform-specific stuff related to PATHs.
 675 AC_DEFUN_ONCE([BASIC_SETUP_PATHS],
 676 [
 677   # Save the current directory this script was started from
<span class="line-modified"> 678   CONFIGURE_START_DIR=&quot;$PWD&quot;</span>
 679 
 680   # We might need to rewrite ORIGINAL_PATH, if it includes &quot;#&quot;, to quote them
 681   # for make. We couldn&#39;t do this when we retrieved ORIGINAL_PATH, since SED
 682   # was not available at that time.
 683   REWRITTEN_PATH=`$ECHO &quot;$ORIGINAL_PATH&quot; | $SED -e &#39;s/#/\\\\#/g&#39;`
 684   if test &quot;x$REWRITTEN_PATH&quot; != &quot;x$ORIGINAL_PATH&quot;; then
 685     ORIGINAL_PATH=&quot;$REWRITTEN_PATH&quot;
 686     AC_MSG_NOTICE([Rewriting ORIGINAL_PATH to $REWRITTEN_PATH])
 687   fi
 688 
 689   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then
 690     PATH_SEP=&quot;;&quot;
 691     EXE_SUFFIX=&quot;.exe&quot;
 692     BASIC_CHECK_PATHS_WINDOWS
 693   else
 694     PATH_SEP=&quot;:&quot;
 695     EXE_SUFFIX=&quot;&quot;
 696   fi
 697   AC_SUBST(PATH_SEP)
 698   AC_SUBST(EXE_SUFFIX)
 699 
 700   # We get the top-level directory from the supporting wrappers.
 701   AC_MSG_CHECKING([for top-level directory])
 702   AC_MSG_RESULT([$TOPDIR])
 703   AC_SUBST(TOPDIR)
<span class="line-added"> 704   AC_SUBST(CONFIGURE_START_DIR)</span>
 705 
 706   # We can only call BASIC_FIXUP_PATH after BASIC_CHECK_PATHS_WINDOWS.
<span class="line-modified"> 707   BASIC_FIXUP_PATH(CONFIGURE_START_DIR)</span>
 708   BASIC_FIXUP_PATH(TOPDIR)
 709 
 710   # Locate the directory of this script.
 711   AUTOCONF_DIR=$TOPDIR/make/autoconf
 712 
 713   # Setup username (for use in adhoc version strings etc)
 714   # Outer [ ] to quote m4.
 715   [ USERNAME=`$ECHO &quot;$USER&quot; | $TR -d -c &#39;[a-z][A-Z][0-9]&#39;` ]
 716   AC_SUBST(USERNAME)
 717 ])
 718 
 719 ###############################################################################
 720 # Evaluates platform specific overrides for devkit variables.
 721 # $1: Name of variable
 722 AC_DEFUN([BASIC_EVAL_DEVKIT_VARIABLE],
 723 [
 724   if test &quot;x[$]$1&quot; = x; then
 725     eval $1=&quot;\${$1_${OPENJDK_TARGET_CPU}}&quot;
 726   fi
 727 ])
</pre>
<hr />
<pre>
 900   BASIC_PREPEND_TO_PATH([PATH],$EXTRA_PATH)
 901 
 902   AC_MSG_CHECKING([for sysroot])
 903   AC_MSG_RESULT([$SYSROOT])
 904   AC_MSG_CHECKING([for toolchain path])
 905   AC_MSG_RESULT([$TOOLCHAIN_PATH])
 906   AC_MSG_CHECKING([for extra path])
 907   AC_MSG_RESULT([$EXTRA_PATH])
 908 ])
 909 
 910 ###############################################################################
 911 AC_DEFUN_ONCE([BASIC_SETUP_OUTPUT_DIR],
 912 [
 913 
 914   AC_ARG_WITH(conf-name, [AS_HELP_STRING([--with-conf-name],
 915       [use this as the name of the configuration @&lt;:@generated from important configuration options@:&gt;@])],
 916       [ CONF_NAME=${with_conf_name} ])
 917 
 918   # Test from where we are running configure, in or outside of src root.
 919   AC_MSG_CHECKING([where to store configuration])
<span class="line-modified"> 920   if test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR&quot; \</span>
<span class="line-modified"> 921       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$CUSTOM_ROOT&quot; \</span>
<span class="line-modified"> 922       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make/autoconf&quot; \</span>
<span class="line-added"> 923       || test &quot;x$CONFIGURE_START_DIR&quot; = &quot;x$TOPDIR/make&quot; ; then</span>
 924     # We are running configure from the src root.
 925     # Create a default ./build/target-variant-debuglevel output root.
 926     if test &quot;x${CONF_NAME}&quot; = x; then
 927       AC_MSG_RESULT([in default location])
 928       CONF_NAME=&quot;${OPENJDK_TARGET_OS}-${OPENJDK_TARGET_CPU}-${JVM_VARIANTS_WITH_AND}-${DEBUG_LEVEL}&quot;
 929     else
 930       AC_MSG_RESULT([in build directory with custom name])
 931     fi
 932 
 933     if test &quot;x$CUSTOM_ROOT&quot; != x; then
<span class="line-modified"> 934       WORKSPACE_ROOT=&quot;${CUSTOM_ROOT}&quot;</span>
 935     else
<span class="line-modified"> 936       WORKSPACE_ROOT=&quot;${TOPDIR}&quot;</span>
 937     fi
<span class="line-added"> 938     OUTPUTDIR=&quot;${WORKSPACE_ROOT}/build/${CONF_NAME}&quot;</span>
 939     $MKDIR -p &quot;$OUTPUTDIR&quot;
 940     if test ! -d &quot;$OUTPUTDIR&quot;; then
 941       AC_MSG_ERROR([Could not create build directory $OUTPUTDIR])
 942     fi
 943   else
 944     # We are running configure from outside of the src dir.
 945     # Then use the current directory as output dir!
 946     # If configuration is situated in normal build directory, just use the build
 947     # directory name as configuration name, otherwise use the complete path.
 948     if test &quot;x${CONF_NAME}&quot; = x; then
<span class="line-modified"> 949       CONF_NAME=`$ECHO $CONFIGURE_START_DIR | $SED -e &quot;s!^${TOPDIR}/build/!!&quot;`</span>
 950     fi
<span class="line-modified"> 951     OUTPUTDIR=&quot;$CONFIGURE_START_DIR&quot;</span>
 952     AC_MSG_RESULT([in current directory])
 953 
 954     # WARNING: This might be a bad thing to do. You need to be sure you want to
 955     # have a configuration in this directory. Do some sanity checks!
 956 
 957     if test ! -e &quot;$OUTPUTDIR/spec.gmk&quot;; then
 958       # If we have a spec.gmk, we have run here before and we are OK. Otherwise, check for
 959       # other files
 960       files_present=`$LS $OUTPUTDIR`
 961       # Configure has already touched config.log and confdefs.h in the current dir when this check
 962       # is performed.
 963       filtered_files=`$ECHO &quot;$files_present&quot; \
 964           | $SED -e &#39;s/config.log//g&#39; \
 965               -e &#39;s/configure.log//g&#39; \
 966               -e &#39;s/confdefs.h//g&#39; \
 967               -e &#39;s/configure-support//g&#39; \
 968               -e &#39;s/ //g&#39; \
 969           | $TR -d &#39;\n&#39;`
 970       if test &quot;x$filtered_files&quot; != x; then
<span class="line-modified"> 971         AC_MSG_NOTICE([Current directory is $CONFIGURE_START_DIR.])</span>
 972         AC_MSG_NOTICE([Since this is not the source root, configure will output the configuration here])
 973         AC_MSG_NOTICE([(as opposed to creating a configuration in &lt;src_root&gt;/build/&lt;conf-name&gt;).])
 974         AC_MSG_NOTICE([However, this directory is not empty. This is not allowed, since it could])
 975         AC_MSG_NOTICE([seriously mess up just about everything.])
 976         AC_MSG_NOTICE([Try &#39;cd $TOPDIR&#39; and restart configure])
 977         AC_MSG_NOTICE([(or create a new empty directory and cd to it).])
<span class="line-modified"> 978         AC_MSG_ERROR([Will not continue creating configuration in $CONFIGURE_START_DIR])</span>
 979       fi
 980     fi
 981   fi
 982   AC_MSG_CHECKING([what configuration name to use])
 983   AC_MSG_RESULT([$CONF_NAME])
 984 
 985   BASIC_FIXUP_PATH(OUTPUTDIR)
 986 
 987   CONFIGURESUPPORT_OUTPUTDIR=&quot;$OUTPUTDIR/configure-support&quot;
 988   $MKDIR -p &quot;$CONFIGURESUPPORT_OUTPUTDIR&quot;
 989 
 990   SPEC=&quot;$OUTPUTDIR/spec.gmk&quot;
 991   AC_SUBST(SPEC)
 992   AC_SUBST(CONF_NAME)
 993   AC_SUBST(OUTPUTDIR)
<span class="line-added"> 994   AC_SUBST(WORKSPACE_ROOT)</span>
 995   AC_SUBST(CONFIGURESUPPORT_OUTPUTDIR)
 996 
 997   # The spec.gmk file contains all variables for the make system.
 998   AC_CONFIG_FILES([$OUTPUTDIR/spec.gmk:$AUTOCONF_DIR/spec.gmk.in])
 999   # The bootcycle-spec.gmk file contains support for boot cycle builds.
1000   AC_CONFIG_FILES([$OUTPUTDIR/bootcycle-spec.gmk:$AUTOCONF_DIR/bootcycle-spec.gmk.in])
1001   # The buildjdk-spec.gmk file contains support for building a buildjdk when cross compiling.
1002   AC_CONFIG_FILES([$OUTPUTDIR/buildjdk-spec.gmk:$AUTOCONF_DIR/buildjdk-spec.gmk.in])
1003   # The compare.sh is used to compare the build output to other builds.
1004   AC_CONFIG_FILES([$OUTPUTDIR/compare.sh:$AUTOCONF_DIR/compare.sh.in])
1005   # The generated Makefile knows where the spec.gmk is and where the source is.
1006   # You can run make from the OUTPUTDIR, or from the top-level Makefile
1007   # which will look for generated configurations
1008   AC_CONFIG_FILES([$OUTPUTDIR/Makefile:$AUTOCONF_DIR/Makefile.in])
1009 ])
1010 
1011 #%%% Simple tools %%%
1012 
1013 ###############################################################################
1014 # Check if we have found a usable version of make
</pre>
<hr />
<pre>
1165     AC_MSG_RESULT([no])
1166   else
1167     AC_MSG_RESULT([yes])
1168   fi
1169   $RMDIR $DELETEDIR
1170   AC_SUBST(FIND_DELETE)
1171 ])
1172 
1173 ###############################################################################
1174 AC_DEFUN([BASIC_CHECK_TAR],
1175 [
1176   # Test which kind of tar was found
1177   if test &quot;x$($TAR --version | $GREP &quot;GNU tar&quot;)&quot; != &quot;x&quot;; then
1178     TAR_TYPE=&quot;gnu&quot;
1179   elif test &quot;x$($TAR --version | $GREP &quot;bsdtar&quot;)&quot; != &quot;x&quot;; then
1180     TAR_TYPE=&quot;bsd&quot;
1181   elif test &quot;x$($TAR -v | $GREP &quot;bsdtar&quot;)&quot; != &quot;x&quot;; then
1182     TAR_TYPE=&quot;bsd&quot;
1183   elif test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xsolaris&quot;; then
1184     TAR_TYPE=&quot;solaris&quot;
<span class="line-added">1185   elif test &quot;x$OPENJDK_BUILD_OS&quot; = &quot;xaix&quot;; then</span>
<span class="line-added">1186     TAR_TYPE=&quot;aix&quot;</span>
1187   fi
1188   AC_MSG_CHECKING([what type of tar was found])
1189   AC_MSG_RESULT([$TAR_TYPE])
1190 
1191   TAR_CREATE_FILE_PARAM=&quot;&quot;
1192 
1193   if test &quot;x$TAR_TYPE&quot; = &quot;xgnu&quot;; then
1194     TAR_INCLUDE_PARAM=&quot;T&quot;
1195     TAR_SUPPORTS_TRANSFORM=&quot;true&quot;
1196     if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then
1197       # When using gnu tar for Solaris targets, need to use compatibility mode
1198       TAR_CREATE_EXTRA_PARAM=&quot;--format=ustar&quot;
1199     fi
<span class="line-added">1200   elif test &quot;x$TAR_TYPE&quot; = &quot;aix&quot;; then</span>
<span class="line-added">1201     # -L InputList of aix tar: name of file listing the files and directories</span>
<span class="line-added">1202     # that need to be   archived or extracted</span>
<span class="line-added">1203     TAR_INCLUDE_PARAM=&quot;L&quot;</span>
<span class="line-added">1204     TAR_SUPPORTS_TRANSFORM=&quot;false&quot;</span>
1205   else
1206     TAR_INCLUDE_PARAM=&quot;I&quot;
1207     TAR_SUPPORTS_TRANSFORM=&quot;false&quot;
1208   fi
1209   AC_SUBST(TAR_TYPE)
1210   AC_SUBST(TAR_CREATE_EXTRA_PARAM)
1211   AC_SUBST(TAR_INCLUDE_PARAM)
1212   AC_SUBST(TAR_SUPPORTS_TRANSFORM)
1213 ])
1214 
1215 ###############################################################################
1216 AC_DEFUN([BASIC_CHECK_GREP],
1217 [
1218   # Test that grep supports -Fx with a list of pattern which includes null pattern.
1219   # This is a problem for the grep resident on AIX.
1220   AC_MSG_CHECKING([that grep ($GREP) -Fx handles empty lines in the pattern list correctly])
1221   # Multiple subsequent spaces..
1222   STACK_SPACES=&#39;aaa   bbb   ccc&#39;
1223   # ..converted to subsequent newlines, causes STACK_LIST to be a list with some empty
1224   # patterns in it.
</pre>
<hr />
<pre>
1270   BASIC_PATH_PROGS(TIME, time)
1271   BASIC_PATH_PROGS(FLOCK, flock)
1272   # Dtrace is usually found in /usr/sbin on Solaris, but that directory may not
1273   # be in the user path.
1274   BASIC_PATH_PROGS(DTRACE, dtrace, $PATH:/usr/sbin)
1275   BASIC_PATH_PROGS(PATCH, [gpatch patch])
1276   # Check if it&#39;s GNU time
1277   IS_GNU_TIME=`$TIME --version 2&gt;&amp;1 | $GREP &#39;GNU time&#39;`
1278   if test &quot;x$IS_GNU_TIME&quot; != x; then
1279     IS_GNU_TIME=yes
1280   else
1281     IS_GNU_TIME=no
1282   fi
1283   AC_SUBST(IS_GNU_TIME)
1284 
1285   if test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xmacosx&quot;; then
1286     BASIC_REQUIRE_PROGS(DSYMUTIL, dsymutil)
1287     BASIC_REQUIRE_PROGS(MIG, mig)
1288     BASIC_REQUIRE_PROGS(XATTR, xattr)
1289     BASIC_PATH_PROGS(CODESIGN, codesign)
<span class="line-added">1290 </span>
1291     if test &quot;x$CODESIGN&quot; != &quot;x&quot;; then
<span class="line-modified">1292       # Check for user provided code signing identity.</span>
<span class="line-modified">1293       # If no identity was provided, fall back to &quot;openjdk_codesign&quot;.</span>
<span class="line-added">1294       AC_ARG_WITH([macosx-codesign-identity], [AS_HELP_STRING([--with-macosx-codesign-identity],</span>
<span class="line-added">1295         [specify the code signing identity])],</span>
<span class="line-added">1296         [MACOSX_CODESIGN_IDENTITY=$with_macosx_codesign_identity],</span>
<span class="line-added">1297         [MACOSX_CODESIGN_IDENTITY=openjdk_codesign]</span>
<span class="line-added">1298       )</span>
<span class="line-added">1299 </span>
<span class="line-added">1300       AC_SUBST(MACOSX_CODESIGN_IDENTITY)</span>
<span class="line-added">1301 </span>
<span class="line-added">1302       # Verify that the codesign certificate is present</span>
<span class="line-added">1303       AC_MSG_CHECKING([if codesign certificate is present])</span>
1304       $RM codesign-testfile
1305       $TOUCH codesign-testfile
<span class="line-modified">1306       $CODESIGN -s &quot;$MACOSX_CODESIGN_IDENTITY&quot; codesign-testfile 2&gt;&amp;AS_MESSAGE_LOG_FD &gt;&amp;AS_MESSAGE_LOG_FD || CODESIGN=</span>
1307       $RM codesign-testfile
1308       if test &quot;x$CODESIGN&quot; = x; then
1309         AC_MSG_RESULT([no])
1310       else
1311         AC_MSG_RESULT([yes])
1312       fi
1313     fi
1314     BASIC_REQUIRE_PROGS(SETFILE, SetFile)
1315   elif test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xsolaris&quot;; then
1316     BASIC_REQUIRE_PROGS(ELFEDIT, elfedit)
1317   fi
<span class="line-added">1318   if ! test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xwindows&quot;; then</span>
<span class="line-added">1319     BASIC_REQUIRE_BUILTIN_PROGS(ULIMIT, ulimit)</span>
<span class="line-added">1320   fi</span>
1321 ])
1322 
1323 ###############################################################################
1324 # Check if build directory is on local disk. If not possible to determine,
1325 # we prefer to claim it&#39;s local.
1326 # Argument 1: directory to test
1327 # Argument 2: what to do if it is on local disk
1328 # Argument 3: what to do otherwise (remote disk or failure)
1329 AC_DEFUN([BASIC_CHECK_DIR_ON_LOCAL_DISK],
1330 [
1331   # df -l lists only local disks; if the given directory is not found then
1332   # a non-zero exit code is given
1333   if test &quot;x$DF&quot; = x; then
1334     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
1335       # msys does not have df; use Windows &quot;net use&quot; instead.
1336       IS_NETWORK_DISK=`net use | grep \`pwd -W | cut -d &quot;:&quot; -f 1 | tr a-z A-Z\`:`
1337       if test &quot;x$IS_NETWORK_DISK&quot; = x; then
1338         $2
1339       else
1340         $3
</pre>
</td>
</tr>
</table>
<center><a href="../ZipSource.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="basics_windows.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>