<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/autoconf/jdk-options.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="hotspot.m4.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-version.m4.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/jdk-options.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  #
<span class="line-modified">! # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  #
<span class="line-modified">! # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 137,10 ***</span>
<span class="line-new-header">--- 137,34 ---</span>
      AC_MSG_ERROR([--enable-headless-only can only take yes or no])
    fi
  
    AC_SUBST(ENABLE_HEADLESS_ONLY)
  
<span class="line-added">+   # should we linktime gc unused code sections in the JDK build ?</span>
<span class="line-added">+   AC_MSG_CHECKING([linktime gc])</span>
<span class="line-added">+   AC_ARG_ENABLE([linktime-gc], [AS_HELP_STRING([--enable-linktime-gc],</span>
<span class="line-added">+       [linktime gc unused code sections in the JDK build @&lt;:@disabled@:&gt;@])])</span>
<span class="line-added">+ </span>
<span class="line-added">+   if test &quot;x$enable_linktime_gc&quot; = &quot;xyes&quot;; then</span>
<span class="line-added">+     ENABLE_LINKTIME_GC=&quot;true&quot;</span>
<span class="line-added">+     AC_MSG_RESULT([yes])</span>
<span class="line-added">+   elif test &quot;x$enable_linktime_gc&quot; = &quot;xno&quot;; then</span>
<span class="line-added">+     ENABLE_LINKTIME_GC=&quot;false&quot;</span>
<span class="line-added">+     AC_MSG_RESULT([no])</span>
<span class="line-added">+   elif test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then</span>
<span class="line-added">+     ENABLE_LINKTIME_GC=&quot;true&quot;</span>
<span class="line-added">+     AC_MSG_RESULT([yes])</span>
<span class="line-added">+   elif test &quot;x$enable_linktime_gc&quot; = &quot;x&quot;; then</span>
<span class="line-added">+     ENABLE_LINKTIME_GC=&quot;false&quot;</span>
<span class="line-added">+     AC_MSG_RESULT([no])</span>
<span class="line-added">+   else</span>
<span class="line-added">+     AC_MSG_ERROR([--enable-linktime-gc can only take yes or no])</span>
<span class="line-added">+   fi</span>
<span class="line-added">+ </span>
<span class="line-added">+   AC_SUBST(ENABLE_LINKTIME_GC)</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
    # Should we build the complete docs, or just a lightweight version?
    AC_ARG_ENABLE([full-docs], [AS_HELP_STRING([--enable-full-docs],
        [build complete documentation @&lt;:@enabled if all tools found@:&gt;@])])
  
    # Verify dependencies
</pre>
<hr />
<pre>
<span class="line-old-header">*** 300,28 ***</span>
        [
          if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
            if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
              AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
            fi
          fi
        ],
        [
<span class="line-modified">!         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then</span>
<span class="line-modified">!           # AIX doesn&#39;t support &#39;external&#39; so use &#39;internal&#39; as default</span>
<span class="line-removed">-           with_native_debug_symbols=&quot;internal&quot;</span>
          else
<span class="line-modified">!           if test &quot;x$STATIC_BUILD&quot; = xtrue; then</span>
<span class="line-modified">!             with_native_debug_symbols=&quot;none&quot;</span>
            else
              with_native_debug_symbols=&quot;external&quot;
            fi
          fi
        ])
    NATIVE_DEBUG_SYMBOLS=$with_native_debug_symbols
    AC_MSG_RESULT([$NATIVE_DEBUG_SYMBOLS])
  
<span class="line-modified">!   if test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xzipped; then</span>
  
      if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
        if test &quot;x$OBJCOPY&quot; = x; then
          # enabling of enable-debug-symbols and can&#39;t find objcopy
          # this is an error
<span class="line-new-header">--- 324,42 ---</span>
        [
          if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
            if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
              AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
            fi
<span class="line-added">+         else</span>
<span class="line-added">+           if test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then</span>
<span class="line-added">+             if test &quot;x$withval&quot; = xinternal; then</span>
<span class="line-added">+               AC_MSG_ERROR([Windows does not support the parameter &#39;internal&#39; for --with-native-debug-symbols])</span>
<span class="line-added">+             fi</span>
<span class="line-added">+           fi</span>
          fi
        ],
        [
<span class="line-modified">!         if test &quot;x$STATIC_BUILD&quot; = xtrue; then</span>
<span class="line-modified">!           with_native_debug_symbols=&quot;none&quot;</span>
          else
<span class="line-modified">!           if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then</span>
<span class="line-modified">!             # AIX doesn&#39;t support &#39;external&#39; so use &#39;internal&#39; as default</span>
<span class="line-added">+             with_native_debug_symbols=&quot;internal&quot;</span>
            else
              with_native_debug_symbols=&quot;external&quot;
            fi
          fi
        ])
    NATIVE_DEBUG_SYMBOLS=$with_native_debug_symbols
    AC_MSG_RESULT([$NATIVE_DEBUG_SYMBOLS])
  
<span class="line-modified">!   if test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xnone; then</span>
<span class="line-added">+     COMPILE_WITH_DEBUG_SYMBOLS=false</span>
<span class="line-added">+     COPY_DEBUG_SYMBOLS=false</span>
<span class="line-added">+     ZIP_EXTERNAL_DEBUG_SYMBOLS=false</span>
<span class="line-added">+   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xinternal; then</span>
<span class="line-added">+     COMPILE_WITH_DEBUG_SYMBOLS=true</span>
<span class="line-added">+     COPY_DEBUG_SYMBOLS=false</span>
<span class="line-added">+     ZIP_EXTERNAL_DEBUG_SYMBOLS=false</span>
<span class="line-added">+   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xexternal; then</span>
  
      if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
        if test &quot;x$OBJCOPY&quot; = x; then
          # enabling of enable-debug-symbols and can&#39;t find objcopy
          # this is an error
</pre>
<hr />
<pre>
<span class="line-old-header">*** 329,20 ***</span>
        fi
      fi
  
      COMPILE_WITH_DEBUG_SYMBOLS=true
      COPY_DEBUG_SYMBOLS=true
<span class="line-removed">-     ZIP_EXTERNAL_DEBUG_SYMBOLS=true</span>
<span class="line-removed">-   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xnone; then</span>
<span class="line-removed">-     COMPILE_WITH_DEBUG_SYMBOLS=false</span>
<span class="line-removed">-     COPY_DEBUG_SYMBOLS=false</span>
<span class="line-removed">-     ZIP_EXTERNAL_DEBUG_SYMBOLS=false</span>
<span class="line-removed">-   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xinternal; then</span>
<span class="line-removed">-     COMPILE_WITH_DEBUG_SYMBOLS=true</span>
<span class="line-removed">-     COPY_DEBUG_SYMBOLS=false</span>
      ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">!   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xexternal; then</span>
  
      if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
        if test &quot;x$OBJCOPY&quot; = x; then
          # enabling of enable-debug-symbols and can&#39;t find objcopy
          # this is an error
<span class="line-new-header">--- 367,12 ---</span>
        fi
      fi
  
      COMPILE_WITH_DEBUG_SYMBOLS=true
      COPY_DEBUG_SYMBOLS=true
      ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">!   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xzipped; then</span>
  
      if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
        if test &quot;x$OBJCOPY&quot; = x; then
          # enabling of enable-debug-symbols and can&#39;t find objcopy
          # this is an error
</pre>
<hr />
<pre>
<span class="line-old-header">*** 350,11 ***</span>
        fi
      fi
  
      COMPILE_WITH_DEBUG_SYMBOLS=true
      COPY_DEBUG_SYMBOLS=true
<span class="line-modified">!     ZIP_EXTERNAL_DEBUG_SYMBOLS=false</span>
    else
      AC_MSG_ERROR([Allowed native debug symbols are: none, internal, external, zipped])
    fi
  
    AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
<span class="line-new-header">--- 380,11 ---</span>
        fi
      fi
  
      COMPILE_WITH_DEBUG_SYMBOLS=true
      COPY_DEBUG_SYMBOLS=true
<span class="line-modified">!     ZIP_EXTERNAL_DEBUG_SYMBOLS=true</span>
    else
      AC_MSG_ERROR([Allowed native debug symbols are: none, internal, external, zipped])
    fi
  
    AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 402,13 ***</span>
<span class="line-new-header">--- 432,16 ---</span>
  
    AC_ARG_WITH(jcov, [AS_HELP_STRING([--with-jcov],
        [jcov library location])])
    AC_ARG_WITH(jcov-input-jdk, [AS_HELP_STRING([--with-jcov-input-jdk],
        [jdk image to instrument])])
<span class="line-added">+   AC_ARG_WITH(jcov-filters, [AS_HELP_STRING([--with-jcov-filters],</span>
<span class="line-added">+       [filters to limit code for jcov instrumentation and report generation])])</span>
    JCOV_HOME=
    JCOV_INPUT_JDK=
    JCOV_ENABLED=
<span class="line-added">+   JCOV_FILTERS=</span>
    if test &quot;x$with_jcov&quot; = &quot;x&quot; ; then
      JCOV_ENABLED=&quot;false&quot;
    else
      JCOV_HOME=&quot;$with_jcov&quot;
      if test ! -f &quot;$JCOV_HOME/lib/jcov.jar&quot;; then
</pre>
<hr />
<pre>
<span class="line-old-header">*** 423,14 ***</span>
<span class="line-new-header">--- 456,18 ---</span>
          AC_MSG_RESULT([fail])
          AC_MSG_ERROR([Invalid JDK bundle: &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot; does not exist])
        fi
        BASIC_FIXUP_PATH(JCOV_INPUT_JDK)
      fi
<span class="line-added">+     if test &quot;x$with_jcov_filters&quot; != &quot;x&quot; ; then</span>
<span class="line-added">+       JCOV_FILTERS=&quot;$with_jcov_filters&quot;</span>
<span class="line-added">+     fi</span>
    fi
    AC_SUBST(JCOV_ENABLED)
    AC_SUBST(JCOV_HOME)
    AC_SUBST(JCOV_INPUT_JDK)
<span class="line-added">+   AC_SUBST(JCOV_FILTERS)</span>
  ])
  
  ###############################################################################
  #
  # AddressSanitizer
</pre>
<hr />
<pre>
<span class="line-old-header">*** 590,11 ***</span>
    AC_MSG_CHECKING([if the CDS classlist generation should be enabled])
    if test &quot;x$enable_generate_classlist&quot; = &quot;xyes&quot;; then
      AC_MSG_RESULT([yes, forced])
      ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
      if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xfalse&quot;; then
<span class="line-modified">!       AC_MSG_WARN([Generation of classlist might not be possible with JVM Variants $JVM_VARIANTS and enable-cds=$ENABLE_CDS])</span>
      fi
    elif test &quot;x$enable_generate_classlist&quot; = &quot;xno&quot;; then
      AC_MSG_RESULT([no, forced])
      ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
    elif test &quot;x$enable_generate_classlist&quot; = &quot;x&quot;; then
<span class="line-new-header">--- 627,18 ---</span>
    AC_MSG_CHECKING([if the CDS classlist generation should be enabled])
    if test &quot;x$enable_generate_classlist&quot; = &quot;xyes&quot;; then
      AC_MSG_RESULT([yes, forced])
      ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
      if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xfalse&quot;; then
<span class="line-modified">!       if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then</span>
<span class="line-added">+         # In GenerateLinkOptData.gmk, DumpLoadedClassList is used to generate the</span>
<span class="line-added">+         # classlist file. It never will work in this case since the VM will report</span>
<span class="line-added">+         # an error for DumpLoadedClassList when CDS is disabled.</span>
<span class="line-added">+         AC_MSG_ERROR([Generation of classlist is not possible with enable-cds=false])</span>
<span class="line-added">+       else</span>
<span class="line-added">+         AC_MSG_WARN([Generation of classlist might not be possible with JVM Variants $JVM_VARIANTS and enable-cds=$ENABLE_CDS])</span>
<span class="line-added">+       fi</span>
      fi
    elif test &quot;x$enable_generate_classlist&quot; = &quot;xno&quot;; then
      AC_MSG_RESULT([no, forced])
      ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
    elif test &quot;x$enable_generate_classlist&quot; = &quot;x&quot;; then
</pre>
<center><a href="hotspot.m4.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-version.m4.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>