<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/jdk-options.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="hotspot.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-version.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/jdk-options.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
122   # Should we build a JDK without a graphical UI?
123   AC_MSG_CHECKING([headless only])
124   AC_ARG_ENABLE([headless-only], [AS_HELP_STRING([--enable-headless-only],
125       [only build headless (no GUI) support @&lt;:@disabled@:&gt;@])])
126 
127   if test &quot;x$enable_headless_only&quot; = &quot;xyes&quot;; then
128     ENABLE_HEADLESS_ONLY=&quot;true&quot;
129     AC_MSG_RESULT([yes])
130   elif test &quot;x$enable_headless_only&quot; = &quot;xno&quot;; then
131     ENABLE_HEADLESS_ONLY=&quot;false&quot;
132     AC_MSG_RESULT([no])
133   elif test &quot;x$enable_headless_only&quot; = &quot;x&quot;; then
134     ENABLE_HEADLESS_ONLY=&quot;false&quot;
135     AC_MSG_RESULT([no])
136   else
137     AC_MSG_ERROR([--enable-headless-only can only take yes or no])
138   fi
139 
140   AC_SUBST(ENABLE_HEADLESS_ONLY)
141 
























142   # Should we build the complete docs, or just a lightweight version?
143   AC_ARG_ENABLE([full-docs], [AS_HELP_STRING([--enable-full-docs],
144       [build complete documentation @&lt;:@enabled if all tools found@:&gt;@])])
145 
146   # Verify dependencies
147   AC_MSG_CHECKING([for graphviz dot])
148   if test &quot;x$DOT&quot; != &quot;x&quot;; then
149     AC_MSG_RESULT([yes])
150   else
151     AC_MSG_RESULT([no, cannot generate full docs])
152     FULL_DOCS_DEP_MISSING=true
153   fi
154 
155   AC_MSG_CHECKING([for pandoc])
156   if test &quot;x$PANDOC&quot; != &quot;x&quot;; then
157     AC_MSG_RESULT([yes])
158   else
159     AC_MSG_RESULT([no, cannot generate full docs])
160     FULL_DOCS_DEP_MISSING=true
161   fi
</pre>
<hr />
<pre>
285   fi
286 
287   AC_SUBST(ENABLE_INTREE_EC)
288 ])
289 
290 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_SYMBOLS],
291 [
292   #
293   # NATIVE_DEBUG_SYMBOLS
294   # This must be done after the toolchain is setup, since we&#39;re looking at objcopy.
295   #
296   AC_MSG_CHECKING([what type of native debug symbols to use])
297   AC_ARG_WITH([native-debug-symbols],
298       [AS_HELP_STRING([--with-native-debug-symbols],
299       [set the native debug symbol configuration (none, internal, external, zipped) @&lt;:@varying@:&gt;@])],
300       [
301         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
302           if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
303             AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
304           fi






305         fi
306       ],
307       [
<span class="line-modified">308         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then</span>
<span class="line-modified">309           # AIX doesn&#39;t support &#39;external&#39; so use &#39;internal&#39; as default</span>
<span class="line-removed">310           with_native_debug_symbols=&quot;internal&quot;</span>
311         else
<span class="line-modified">312           if test &quot;x$STATIC_BUILD&quot; = xtrue; then</span>
<span class="line-modified">313             with_native_debug_symbols=&quot;none&quot;</span>

314           else
315             with_native_debug_symbols=&quot;external&quot;
316           fi
317         fi
318       ])
319   NATIVE_DEBUG_SYMBOLS=$with_native_debug_symbols
320   AC_MSG_RESULT([$NATIVE_DEBUG_SYMBOLS])
321 
<span class="line-modified">322   if test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xzipped; then</span>








323 
324     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
325       if test &quot;x$OBJCOPY&quot; = x; then
326         # enabling of enable-debug-symbols and can&#39;t find objcopy
327         # this is an error
328         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
329       fi
330     fi
331 
332     COMPILE_WITH_DEBUG_SYMBOLS=true
333     COPY_DEBUG_SYMBOLS=true
<span class="line-removed">334     ZIP_EXTERNAL_DEBUG_SYMBOLS=true</span>
<span class="line-removed">335   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xnone; then</span>
<span class="line-removed">336     COMPILE_WITH_DEBUG_SYMBOLS=false</span>
<span class="line-removed">337     COPY_DEBUG_SYMBOLS=false</span>
<span class="line-removed">338     ZIP_EXTERNAL_DEBUG_SYMBOLS=false</span>
<span class="line-removed">339   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xinternal; then</span>
<span class="line-removed">340     COMPILE_WITH_DEBUG_SYMBOLS=true</span>
<span class="line-removed">341     COPY_DEBUG_SYMBOLS=false</span>
342     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">343   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xexternal; then</span>
344 
345     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
346       if test &quot;x$OBJCOPY&quot; = x; then
347         # enabling of enable-debug-symbols and can&#39;t find objcopy
348         # this is an error
349         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
350       fi
351     fi
352 
353     COMPILE_WITH_DEBUG_SYMBOLS=true
354     COPY_DEBUG_SYMBOLS=true
<span class="line-modified">355     ZIP_EXTERNAL_DEBUG_SYMBOLS=false</span>
356   else
357     AC_MSG_ERROR([Allowed native debug symbols are: none, internal, external, zipped])
358   fi
359 
360   AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
361   AC_SUBST(COPY_DEBUG_SYMBOLS)
362   AC_SUBST(ZIP_EXTERNAL_DEBUG_SYMBOLS)
363 ])
364 
365 ################################################################################
366 #
367 # Native and Java code coverage
368 #
369 AC_DEFUN_ONCE([JDKOPT_SETUP_CODE_COVERAGE],
370 [
371   AC_ARG_ENABLE(native-coverage, [AS_HELP_STRING([--enable-native-coverage],
372       [enable native compilation with code coverage data@&lt;:@disabled@:&gt;@])])
373   GCOV_ENABLED=&quot;false&quot;
374   if test &quot;x$enable_native_coverage&quot; = &quot;xyes&quot;; then
375     case $TOOLCHAIN_TYPE in
</pre>
<hr />
<pre>
387         LDFLAGS_JDKLIB=&quot;$LDFLAGS_JDKLIB $GCOV_LDFLAGS&quot;
388         LDFLAGS_JDKEXE=&quot;$LDFLAGS_JDKEXE $GCOV_LDFLAGS&quot;
389         GCOV_ENABLED=&quot;true&quot;
390         ;;
391       *)
392         AC_MSG_ERROR([--enable-native-coverage only works with toolchain type gcc or clang])
393         ;;
394     esac
395   elif test &quot;x$enable_native_coverage&quot; = &quot;xno&quot;; then
396     AC_MSG_CHECKING([if native coverage is enabled])
397     AC_MSG_RESULT([no])
398   elif test &quot;x$enable_native_coverage&quot; != &quot;x&quot;; then
399     AC_MSG_ERROR([--enable-native-coverage can only be assigned &quot;yes&quot; or &quot;no&quot;])
400   fi
401   AC_SUBST(GCOV_ENABLED)
402 
403   AC_ARG_WITH(jcov, [AS_HELP_STRING([--with-jcov],
404       [jcov library location])])
405   AC_ARG_WITH(jcov-input-jdk, [AS_HELP_STRING([--with-jcov-input-jdk],
406       [jdk image to instrument])])


407   JCOV_HOME=
408   JCOV_INPUT_JDK=
409   JCOV_ENABLED=

410   if test &quot;x$with_jcov&quot; = &quot;x&quot; ; then
411     JCOV_ENABLED=&quot;false&quot;
412   else
413     JCOV_HOME=&quot;$with_jcov&quot;
414     if test ! -f &quot;$JCOV_HOME/lib/jcov.jar&quot;; then
415       AC_MSG_RESULT([fail])
416       AC_MSG_ERROR([Invalid JCov bundle: &quot;$JCOV_HOME/lib/jcov.jar&quot; does not exist])
417     fi
418     JCOV_ENABLED=&quot;true&quot;
419     BASIC_FIXUP_PATH(JCOV_HOME)
420     if test &quot;x$with_jcov_input_jdk&quot; != &quot;x&quot; ; then
421       JCOV_INPUT_JDK=&quot;$with_jcov_input_jdk&quot;
422       if test ! -f &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot;; then
423         AC_MSG_RESULT([fail])
424         AC_MSG_ERROR([Invalid JDK bundle: &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot; does not exist])
425       fi
426       BASIC_FIXUP_PATH(JCOV_INPUT_JDK)
427     fi



428   fi
429   AC_SUBST(JCOV_ENABLED)
430   AC_SUBST(JCOV_HOME)
431   AC_SUBST(JCOV_INPUT_JDK)

432 ])
433 
434 ###############################################################################
435 #
436 # AddressSanitizer
437 #
438 AC_DEFUN_ONCE([JDKOPT_SETUP_ADDRESS_SANITIZER],
439 [
440   AC_ARG_ENABLE(asan, [AS_HELP_STRING([--enable-asan],
441       [enable AddressSanitizer if possible @&lt;:@disabled@:&gt;@])])
442   ASAN_ENABLED=&quot;no&quot;
443   if test &quot;x$enable_asan&quot; = &quot;xyes&quot;; then
444     case $TOOLCHAIN_TYPE in
445       gcc | clang)
446         AC_MSG_CHECKING([if asan is enabled])
447         AC_MSG_RESULT([yes])
448         ASAN_CFLAGS=&quot;-fsanitize=address -fno-omit-frame-pointer&quot;
449         ASAN_LDFLAGS=&quot;-fsanitize=address&quot;
450         JVM_CFLAGS=&quot;$JVM_CFLAGS $ASAN_CFLAGS&quot;
451         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $ASAN_LDFLAGS&quot;
</pre>
<hr />
<pre>
575 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_GENERATE_CLASSLIST],
576 [
577   AC_ARG_ENABLE([generate-classlist], [AS_HELP_STRING([--disable-generate-classlist],
578       [forces enabling or disabling of the generation of a CDS classlist at build time.
579       Default is to generate it when either the server or client JVMs are built and
580       enable-cds is true.])])
581 
582   # Check if it&#39;s likely that it&#39;s possible to generate the classlist. Depending
583   # on exact jvm configuration it could be possible anyway.
584   if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot; &amp;&amp; (HOTSPOT_CHECK_JVM_VARIANT(server) || HOTSPOT_CHECK_JVM_VARIANT(client) || HOTSPOT_CHECK_JVM_FEATURE(cds)); then
585     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;true&quot;
586   else
587     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;false&quot;
588   fi
589 
590   AC_MSG_CHECKING([if the CDS classlist generation should be enabled])
591   if test &quot;x$enable_generate_classlist&quot; = &quot;xyes&quot;; then
592     AC_MSG_RESULT([yes, forced])
593     ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
594     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xfalse&quot;; then
<span class="line-modified">595       AC_MSG_WARN([Generation of classlist might not be possible with JVM Variants $JVM_VARIANTS and enable-cds=$ENABLE_CDS])</span>







596     fi
597   elif test &quot;x$enable_generate_classlist&quot; = &quot;xno&quot;; then
598     AC_MSG_RESULT([no, forced])
599     ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
600   elif test &quot;x$enable_generate_classlist&quot; = &quot;x&quot;; then
601     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xtrue&quot;; then
602       AC_MSG_RESULT([yes])
603       ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
604     else
605       AC_MSG_RESULT([no])
606       ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
607     fi
608   else
609     AC_MSG_ERROR([Invalid value for --enable-generate-classlist: $enable_generate_classlist])
610   fi
611 
612   AC_SUBST(ENABLE_GENERATE_CLASSLIST)
613 ])
614 
615 ################################################################################
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
122   # Should we build a JDK without a graphical UI?
123   AC_MSG_CHECKING([headless only])
124   AC_ARG_ENABLE([headless-only], [AS_HELP_STRING([--enable-headless-only],
125       [only build headless (no GUI) support @&lt;:@disabled@:&gt;@])])
126 
127   if test &quot;x$enable_headless_only&quot; = &quot;xyes&quot;; then
128     ENABLE_HEADLESS_ONLY=&quot;true&quot;
129     AC_MSG_RESULT([yes])
130   elif test &quot;x$enable_headless_only&quot; = &quot;xno&quot;; then
131     ENABLE_HEADLESS_ONLY=&quot;false&quot;
132     AC_MSG_RESULT([no])
133   elif test &quot;x$enable_headless_only&quot; = &quot;x&quot;; then
134     ENABLE_HEADLESS_ONLY=&quot;false&quot;
135     AC_MSG_RESULT([no])
136   else
137     AC_MSG_ERROR([--enable-headless-only can only take yes or no])
138   fi
139 
140   AC_SUBST(ENABLE_HEADLESS_ONLY)
141 
<span class="line-added">142   # should we linktime gc unused code sections in the JDK build ?</span>
<span class="line-added">143   AC_MSG_CHECKING([linktime gc])</span>
<span class="line-added">144   AC_ARG_ENABLE([linktime-gc], [AS_HELP_STRING([--enable-linktime-gc],</span>
<span class="line-added">145       [linktime gc unused code sections in the JDK build @&lt;:@disabled@:&gt;@])])</span>
<span class="line-added">146 </span>
<span class="line-added">147   if test &quot;x$enable_linktime_gc&quot; = &quot;xyes&quot;; then</span>
<span class="line-added">148     ENABLE_LINKTIME_GC=&quot;true&quot;</span>
<span class="line-added">149     AC_MSG_RESULT([yes])</span>
<span class="line-added">150   elif test &quot;x$enable_linktime_gc&quot; = &quot;xno&quot;; then</span>
<span class="line-added">151     ENABLE_LINKTIME_GC=&quot;false&quot;</span>
<span class="line-added">152     AC_MSG_RESULT([no])</span>
<span class="line-added">153   elif test &quot;x$OPENJDK_TARGET_OS&quot; = &quot;xlinux&quot; &amp;&amp; test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then</span>
<span class="line-added">154     ENABLE_LINKTIME_GC=&quot;true&quot;</span>
<span class="line-added">155     AC_MSG_RESULT([yes])</span>
<span class="line-added">156   elif test &quot;x$enable_linktime_gc&quot; = &quot;x&quot;; then</span>
<span class="line-added">157     ENABLE_LINKTIME_GC=&quot;false&quot;</span>
<span class="line-added">158     AC_MSG_RESULT([no])</span>
<span class="line-added">159   else</span>
<span class="line-added">160     AC_MSG_ERROR([--enable-linktime-gc can only take yes or no])</span>
<span class="line-added">161   fi</span>
<span class="line-added">162 </span>
<span class="line-added">163   AC_SUBST(ENABLE_LINKTIME_GC)</span>
<span class="line-added">164 </span>
<span class="line-added">165 </span>
166   # Should we build the complete docs, or just a lightweight version?
167   AC_ARG_ENABLE([full-docs], [AS_HELP_STRING([--enable-full-docs],
168       [build complete documentation @&lt;:@enabled if all tools found@:&gt;@])])
169 
170   # Verify dependencies
171   AC_MSG_CHECKING([for graphviz dot])
172   if test &quot;x$DOT&quot; != &quot;x&quot;; then
173     AC_MSG_RESULT([yes])
174   else
175     AC_MSG_RESULT([no, cannot generate full docs])
176     FULL_DOCS_DEP_MISSING=true
177   fi
178 
179   AC_MSG_CHECKING([for pandoc])
180   if test &quot;x$PANDOC&quot; != &quot;x&quot;; then
181     AC_MSG_RESULT([yes])
182   else
183     AC_MSG_RESULT([no, cannot generate full docs])
184     FULL_DOCS_DEP_MISSING=true
185   fi
</pre>
<hr />
<pre>
309   fi
310 
311   AC_SUBST(ENABLE_INTREE_EC)
312 ])
313 
314 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_SYMBOLS],
315 [
316   #
317   # NATIVE_DEBUG_SYMBOLS
318   # This must be done after the toolchain is setup, since we&#39;re looking at objcopy.
319   #
320   AC_MSG_CHECKING([what type of native debug symbols to use])
321   AC_ARG_WITH([native-debug-symbols],
322       [AS_HELP_STRING([--with-native-debug-symbols],
323       [set the native debug symbol configuration (none, internal, external, zipped) @&lt;:@varying@:&gt;@])],
324       [
325         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
326           if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
327             AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
328           fi
<span class="line-added">329         else</span>
<span class="line-added">330           if test &quot;x$OPENJDK_TARGET_OS&quot; = xwindows; then</span>
<span class="line-added">331             if test &quot;x$withval&quot; = xinternal; then</span>
<span class="line-added">332               AC_MSG_ERROR([Windows does not support the parameter &#39;internal&#39; for --with-native-debug-symbols])</span>
<span class="line-added">333             fi</span>
<span class="line-added">334           fi</span>
335         fi
336       ],
337       [
<span class="line-modified">338         if test &quot;x$STATIC_BUILD&quot; = xtrue; then</span>
<span class="line-modified">339           with_native_debug_symbols=&quot;none&quot;</span>

340         else
<span class="line-modified">341           if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then</span>
<span class="line-modified">342             # AIX doesn&#39;t support &#39;external&#39; so use &#39;internal&#39; as default</span>
<span class="line-added">343             with_native_debug_symbols=&quot;internal&quot;</span>
344           else
345             with_native_debug_symbols=&quot;external&quot;
346           fi
347         fi
348       ])
349   NATIVE_DEBUG_SYMBOLS=$with_native_debug_symbols
350   AC_MSG_RESULT([$NATIVE_DEBUG_SYMBOLS])
351 
<span class="line-modified">352   if test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xnone; then</span>
<span class="line-added">353     COMPILE_WITH_DEBUG_SYMBOLS=false</span>
<span class="line-added">354     COPY_DEBUG_SYMBOLS=false</span>
<span class="line-added">355     ZIP_EXTERNAL_DEBUG_SYMBOLS=false</span>
<span class="line-added">356   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xinternal; then</span>
<span class="line-added">357     COMPILE_WITH_DEBUG_SYMBOLS=true</span>
<span class="line-added">358     COPY_DEBUG_SYMBOLS=false</span>
<span class="line-added">359     ZIP_EXTERNAL_DEBUG_SYMBOLS=false</span>
<span class="line-added">360   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xexternal; then</span>
361 
362     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
363       if test &quot;x$OBJCOPY&quot; = x; then
364         # enabling of enable-debug-symbols and can&#39;t find objcopy
365         # this is an error
366         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
367       fi
368     fi
369 
370     COMPILE_WITH_DEBUG_SYMBOLS=true
371     COPY_DEBUG_SYMBOLS=true








372     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
<span class="line-modified">373   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xzipped; then</span>
374 
375     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
376       if test &quot;x$OBJCOPY&quot; = x; then
377         # enabling of enable-debug-symbols and can&#39;t find objcopy
378         # this is an error
379         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
380       fi
381     fi
382 
383     COMPILE_WITH_DEBUG_SYMBOLS=true
384     COPY_DEBUG_SYMBOLS=true
<span class="line-modified">385     ZIP_EXTERNAL_DEBUG_SYMBOLS=true</span>
386   else
387     AC_MSG_ERROR([Allowed native debug symbols are: none, internal, external, zipped])
388   fi
389 
390   AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
391   AC_SUBST(COPY_DEBUG_SYMBOLS)
392   AC_SUBST(ZIP_EXTERNAL_DEBUG_SYMBOLS)
393 ])
394 
395 ################################################################################
396 #
397 # Native and Java code coverage
398 #
399 AC_DEFUN_ONCE([JDKOPT_SETUP_CODE_COVERAGE],
400 [
401   AC_ARG_ENABLE(native-coverage, [AS_HELP_STRING([--enable-native-coverage],
402       [enable native compilation with code coverage data@&lt;:@disabled@:&gt;@])])
403   GCOV_ENABLED=&quot;false&quot;
404   if test &quot;x$enable_native_coverage&quot; = &quot;xyes&quot;; then
405     case $TOOLCHAIN_TYPE in
</pre>
<hr />
<pre>
417         LDFLAGS_JDKLIB=&quot;$LDFLAGS_JDKLIB $GCOV_LDFLAGS&quot;
418         LDFLAGS_JDKEXE=&quot;$LDFLAGS_JDKEXE $GCOV_LDFLAGS&quot;
419         GCOV_ENABLED=&quot;true&quot;
420         ;;
421       *)
422         AC_MSG_ERROR([--enable-native-coverage only works with toolchain type gcc or clang])
423         ;;
424     esac
425   elif test &quot;x$enable_native_coverage&quot; = &quot;xno&quot;; then
426     AC_MSG_CHECKING([if native coverage is enabled])
427     AC_MSG_RESULT([no])
428   elif test &quot;x$enable_native_coverage&quot; != &quot;x&quot;; then
429     AC_MSG_ERROR([--enable-native-coverage can only be assigned &quot;yes&quot; or &quot;no&quot;])
430   fi
431   AC_SUBST(GCOV_ENABLED)
432 
433   AC_ARG_WITH(jcov, [AS_HELP_STRING([--with-jcov],
434       [jcov library location])])
435   AC_ARG_WITH(jcov-input-jdk, [AS_HELP_STRING([--with-jcov-input-jdk],
436       [jdk image to instrument])])
<span class="line-added">437   AC_ARG_WITH(jcov-filters, [AS_HELP_STRING([--with-jcov-filters],</span>
<span class="line-added">438       [filters to limit code for jcov instrumentation and report generation])])</span>
439   JCOV_HOME=
440   JCOV_INPUT_JDK=
441   JCOV_ENABLED=
<span class="line-added">442   JCOV_FILTERS=</span>
443   if test &quot;x$with_jcov&quot; = &quot;x&quot; ; then
444     JCOV_ENABLED=&quot;false&quot;
445   else
446     JCOV_HOME=&quot;$with_jcov&quot;
447     if test ! -f &quot;$JCOV_HOME/lib/jcov.jar&quot;; then
448       AC_MSG_RESULT([fail])
449       AC_MSG_ERROR([Invalid JCov bundle: &quot;$JCOV_HOME/lib/jcov.jar&quot; does not exist])
450     fi
451     JCOV_ENABLED=&quot;true&quot;
452     BASIC_FIXUP_PATH(JCOV_HOME)
453     if test &quot;x$with_jcov_input_jdk&quot; != &quot;x&quot; ; then
454       JCOV_INPUT_JDK=&quot;$with_jcov_input_jdk&quot;
455       if test ! -f &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot;; then
456         AC_MSG_RESULT([fail])
457         AC_MSG_ERROR([Invalid JDK bundle: &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot; does not exist])
458       fi
459       BASIC_FIXUP_PATH(JCOV_INPUT_JDK)
460     fi
<span class="line-added">461     if test &quot;x$with_jcov_filters&quot; != &quot;x&quot; ; then</span>
<span class="line-added">462       JCOV_FILTERS=&quot;$with_jcov_filters&quot;</span>
<span class="line-added">463     fi</span>
464   fi
465   AC_SUBST(JCOV_ENABLED)
466   AC_SUBST(JCOV_HOME)
467   AC_SUBST(JCOV_INPUT_JDK)
<span class="line-added">468   AC_SUBST(JCOV_FILTERS)</span>
469 ])
470 
471 ###############################################################################
472 #
473 # AddressSanitizer
474 #
475 AC_DEFUN_ONCE([JDKOPT_SETUP_ADDRESS_SANITIZER],
476 [
477   AC_ARG_ENABLE(asan, [AS_HELP_STRING([--enable-asan],
478       [enable AddressSanitizer if possible @&lt;:@disabled@:&gt;@])])
479   ASAN_ENABLED=&quot;no&quot;
480   if test &quot;x$enable_asan&quot; = &quot;xyes&quot;; then
481     case $TOOLCHAIN_TYPE in
482       gcc | clang)
483         AC_MSG_CHECKING([if asan is enabled])
484         AC_MSG_RESULT([yes])
485         ASAN_CFLAGS=&quot;-fsanitize=address -fno-omit-frame-pointer&quot;
486         ASAN_LDFLAGS=&quot;-fsanitize=address&quot;
487         JVM_CFLAGS=&quot;$JVM_CFLAGS $ASAN_CFLAGS&quot;
488         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $ASAN_LDFLAGS&quot;
</pre>
<hr />
<pre>
612 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_GENERATE_CLASSLIST],
613 [
614   AC_ARG_ENABLE([generate-classlist], [AS_HELP_STRING([--disable-generate-classlist],
615       [forces enabling or disabling of the generation of a CDS classlist at build time.
616       Default is to generate it when either the server or client JVMs are built and
617       enable-cds is true.])])
618 
619   # Check if it&#39;s likely that it&#39;s possible to generate the classlist. Depending
620   # on exact jvm configuration it could be possible anyway.
621   if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot; &amp;&amp; (HOTSPOT_CHECK_JVM_VARIANT(server) || HOTSPOT_CHECK_JVM_VARIANT(client) || HOTSPOT_CHECK_JVM_FEATURE(cds)); then
622     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;true&quot;
623   else
624     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;false&quot;
625   fi
626 
627   AC_MSG_CHECKING([if the CDS classlist generation should be enabled])
628   if test &quot;x$enable_generate_classlist&quot; = &quot;xyes&quot;; then
629     AC_MSG_RESULT([yes, forced])
630     ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
631     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xfalse&quot;; then
<span class="line-modified">632       if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then</span>
<span class="line-added">633         # In GenerateLinkOptData.gmk, DumpLoadedClassList is used to generate the</span>
<span class="line-added">634         # classlist file. It never will work in this case since the VM will report</span>
<span class="line-added">635         # an error for DumpLoadedClassList when CDS is disabled.</span>
<span class="line-added">636         AC_MSG_ERROR([Generation of classlist is not possible with enable-cds=false])</span>
<span class="line-added">637       else</span>
<span class="line-added">638         AC_MSG_WARN([Generation of classlist might not be possible with JVM Variants $JVM_VARIANTS and enable-cds=$ENABLE_CDS])</span>
<span class="line-added">639       fi</span>
640     fi
641   elif test &quot;x$enable_generate_classlist&quot; = &quot;xno&quot;; then
642     AC_MSG_RESULT([no, forced])
643     ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
644   elif test &quot;x$enable_generate_classlist&quot; = &quot;x&quot;; then
645     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xtrue&quot;; then
646       AC_MSG_RESULT([yes])
647       ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
648     else
649       AC_MSG_RESULT([no])
650       ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
651     fi
652   else
653     AC_MSG_ERROR([Invalid value for --enable-generate-classlist: $enable_generate_classlist])
654   fi
655 
656   AC_SUBST(ENABLE_GENERATE_CLASSLIST)
657 ])
658 
659 ################################################################################
</pre>
</td>
</tr>
</table>
<center><a href="hotspot.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="jdk-version.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>