<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames make/autoconf/configure</title>
    <link rel="stylesheet" href="../../style.css" />
    <script type="text/javascript" src="../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 #!/bin/bash
  2 #
  3 # Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.
  4 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5 #
  6 # This code is free software; you can redistribute it and/or modify it
  7 # under the terms of the GNU General Public License version 2 only, as
  8 # published by the Free Software Foundation.
  9 #
 10 # This code is distributed in the hope that it will be useful, but WITHOUT
 11 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 12 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 13 # version 2 for more details (a copy is included in the LICENSE file that
 14 # accompanied this code).
 15 #
 16 # You should have received a copy of the GNU General Public License version
 17 # 2 along with this work; if not, write to the Free Software Foundation,
 18 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19 #
 20 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21 # or visit www.oracle.com if you need additional information or have any
 22 # questions.
 23 #
 24 
 25 if test &quot;x$1&quot; != xCHECKME; then
 26   echo &quot;ERROR: Calling this wrapper script directly is not supported.&quot;
 27   echo &quot;Use the &#39;configure&#39; script in the top-level directory instead.&quot;
 28   exit 1
 29 fi
 30 
 31 # The next argument is the absolute top-level directory path.
 32 # The TOPDIR variable is passed on to configure.ac.
 33 TOPDIR=&quot;$2&quot;
 34 # Remove these two arguments to get to the user supplied arguments
 35 shift
 36 shift
 37 
 38 if test &quot;x$BASH&quot; = x; then
 39   echo &quot;Error: This script must be run using bash.&quot; 1&gt;&amp;2
 40   exit 1
 41 fi
 42 # Force autoconf to use bash. This also means we must disable autoconf re-exec.
 43 export CONFIG_SHELL=$BASH
 44 export _as_can_reexec=no
 45 
<a name="1" id="anc1"></a>


 46 if test &quot;x$CUSTOM_CONFIG_DIR&quot; != x; then
 47   custom_hook=$CUSTOM_CONFIG_DIR/custom-hook.m4
 48   if test ! -e $custom_hook; then
 49     echo &quot;CUSTOM_CONFIG_DIR not pointing to a proper custom config dir.&quot;
 50     echo &quot;Error: Cannot continue&quot; 1&gt;&amp;2
 51     exit 1
 52   fi
 53 fi
 54 
 55 CURRENT_DIR=`pwd`
 56 if test &quot;x$CURRENT_DIR&quot; = &quot;x$TOPDIR&quot;; then
 57   # We are running configure from the src root.
 58   # Create &#39;.configure-support&#39; under $TOPDIR/build
 59   build_support_dir=&quot;$TOPDIR/build/.configure-support&quot;
 60 elif test &quot;x$CURRENT_DIR&quot; = &quot;x$CUSTOM_ROOT&quot;; then
 61   # We are running configure from the custom root.
 62   # Create &#39;.configure-support&#39; under $CUSTOM_ROOT/build
 63   build_support_dir=&quot;$CUSTOM_ROOT/build/.configure-support&quot;
 64 else
 65   # We are running configure from outside of the src dir.
 66   # Create &#39;build_support_dir&#39; in the current directory.
 67   build_support_dir=&quot;$CURRENT_DIR/configure-support&quot;
 68 fi
 69 
 70 conf_script_dir=&quot;$TOPDIR/make/autoconf&quot;
 71 generated_script=&quot;$build_support_dir/generated-configure.sh&quot;
 72 
 73 ###
 74 ### Use autoconf to create a runnable configure script, if needed
 75 ###
 76 
 77 autoconf_missing_help() {
 78   APT_GET=&quot;`which apt-get 2&gt; /dev/null | grep -v &#39;^no apt-get in&#39;`&quot;
 79   YUM=&quot;`which yum 2&gt; /dev/null | grep -v &#39;^no yum in&#39;`&quot;
 80   BREW=&quot;`which brew 2&gt; /dev/null | grep -v &#39;^no brew in&#39;`&quot;
 81   ZYPPER=&quot;`which zypper 2&gt; /dev/null | grep -v &#39;^no zypper in&#39;`&quot;
 82   CYGWIN=&quot;`which cygpath 2&gt; /dev/null | grep -v &#39;^no cygpath in&#39;`&quot;
 83 
 84   if test &quot;x$ZYPPER&quot; != x; then
 85     PKGHANDLER_COMMAND=&quot;sudo zypper install autoconf&quot;
 86   elif test &quot;x$APT_GET&quot; != x; then
 87     PKGHANDLER_COMMAND=&quot;sudo apt-get install autoconf&quot;
 88   elif test &quot;x$YUM&quot; != x; then
 89     PKGHANDLER_COMMAND=&quot;sudo yum install autoconf&quot;
 90   elif test &quot;x$BREW&quot; != x; then
 91     PKGHANDLER_COMMAND=&quot;brew install autoconf&quot;
 92   elif test &quot;x$CYGWIN&quot; != x; then
 93     PKGHANDLER_COMMAND=&quot;( cd &lt;location of cygwin setup.exe&gt; &amp;&amp; cmd /c setup -q -P autoconf )&quot;
 94   fi
 95 
 96   if test &quot;x$PKGHANDLER_COMMAND&quot; != x; then
 97     echo &quot;You might be able to fix this by running &#39;$PKGHANDLER_COMMAND&#39;.&quot;
 98   fi
 99 }
100 
101 generate_configure_script() {
102   if test &quot;x$AUTOCONF&quot; != x; then
103     if test ! -x &quot;$AUTOCONF&quot;; then
104       echo
105       echo &quot;The specified AUTOCONF variable does not point to a valid autoconf executable:&quot;
106       echo &quot;AUTOCONF=$AUTOCONF&quot;
107       echo &quot;Error: Cannot continue&quot; 1&gt;&amp;2
108       exit 1
109     fi
110   else
111     AUTOCONF=&quot;`which autoconf 2&gt; /dev/null | grep -v &#39;^no autoconf in&#39;`&quot;
112     if test &quot;x$AUTOCONF&quot; = x; then
113       echo
114       echo &quot;Autoconf is not found on the PATH, and AUTOCONF is not set.&quot;
115       echo &quot;You need autoconf to be able to generate a runnable configure script.&quot;
116       autoconf_missing_help
117       echo &quot;Error: Cannot find autoconf&quot; 1&gt;&amp;2
118       exit 1
119     fi
120   fi
121 
122   autoconf_version=`$AUTOCONF --version | head -1`
123   echo &quot;Using autoconf at ${AUTOCONF} [$autoconf_version]&quot;
124 
125   if test &quot;x$CUSTOM_CONFIG_DIR&quot; != x; then
126     # Generate configure script with custom hooks compiled in.
127     custom_patcher=&#39;sed -e &quot;s|#CUSTOM_AUTOCONF_INCLUDE|m4_include([$custom_hook])|&quot;&#39;
128     custom_script_dir_include=&quot;-I$CUSTOM_CONFIG_DIR&quot;
129   else
130     custom_patcher=&#39;cat&#39;
131     custom_script_dir_include=&quot;&quot;
132   fi
133 
134   mkdir -p $build_support_dir
135   # Call autoconf but replace the &quot;magic&quot; variable in configure.ac if requested.
136 
137   cat $conf_script_dir/configure.ac | eval $custom_patcher | \
138       ${AUTOCONF} -W all $custom_script_dir_include -I$conf_script_dir - \
139       &gt; $generated_script
140   rm -rf autom4te.cache
141 
142   # Sanity check
143   if test ! -s $generated_script; then
144     echo &quot;Error: Failed to generate runnable configure script&quot; 1&gt;&amp;2
145     rm -f $generated_script
146     exit 1
147   fi
148 }
149 
150 test_generated_up_to_date() {
151   conf_source_files=&quot;$conf_script_dir/configure.ac $conf_script_dir/*.m4&quot;
152   if test &quot;x$CUSTOM_CONFIG_DIR&quot; != x; then
153     conf_custom_source_files=&quot;$CUSTOM_CONFIG_DIR/*.m4&quot;
154   else
155     conf_custom_source_files=&quot;&quot;
156   fi
157 
158   for file in $conf_source_files $conf_custom_source_files ; do
159     if test $file -nt $generated_script; then
160       return 0
161     fi
162   done
163   return 1
164 }
165 
166 run_autoconf=false
167 if test &quot;x$1&quot; = xautogen; then
168   # User called us as &quot;configure autogen&quot;, so force regeneration
169   run_autoconf=true
170   shift
171 fi
172 
173 if test ! -s $generated_script; then
174   # Generated script is missing, so we need to create it
175   echo &quot;Runnable configure script is not present&quot;
176   run_autoconf=true
177 else
178   # File is present, but is it up to date?
179   if test_generated_up_to_date; then
180     echo &quot;Runnable configure script is not up to date&quot;
181     run_autoconf=true
182   fi
183 fi
184 
185 if test &quot;x$run_autoconf&quot; = xtrue; then
186   echo &quot;Generating runnable configure script at $generated_script&quot;
187   generate_configure_script
188 fi
189 
190 # Autoconf calls the configure script recursively sometimes.
191 # Don&#39;t start logging twice in that case
192 if test &quot;x$conf_debug_configure&quot; = xtrue; then
193   conf_debug_configure=recursive
194 fi
195 
196 ###
197 ### Process command-line arguments
198 ###
199 
200 # Returns a shell-escaped version of the argument given.
201 function shell_quote() {
202   if [[ -n &quot;$1&quot; ]]; then
203     # Uses only shell-safe characters?  No quoting needed.
204     # &#39;=&#39; is a zsh meta-character, but only in word-initial position.
205     if echo &quot;$1&quot; | grep &#39;^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\.:,%/+=_-]\{1,\}$&#39; &gt; /dev/null \
206         &amp;&amp; ! echo &quot;$1&quot; | grep &#39;^=&#39; &gt; /dev/null; then
207       quoted=&quot;$1&quot;
208     else
209       if echo &quot;$1&quot; | grep &quot;[\&#39;!]&quot; &gt; /dev/null; then
210         # csh does history expansion within single quotes, but not
211         # when backslash-escaped!
212         local quoted_quote=&quot;&#39;\\&#39;&#39;&quot; quoted_exclam=&quot;&#39;\\!&#39;&quot;
213         word=&quot;${1//\&#39;/${quoted_quote}}&quot;
214         word=&quot;${1//\!/${quoted_exclam}}&quot;
215       fi
216       quoted=&quot;&#39;$1&#39;&quot;
217     fi
218     echo &quot;$quoted&quot;
219   fi
220 }
221 
222 conf_processed_arguments=()
223 conf_quoted_arguments=()
224 conf_openjdk_target=
225 
226 for conf_option
227 do
228 
229   # Process (and remove) our own extensions that will not be passed to autoconf
230   case $conf_option in
231     --openjdk-target=*)
232       conf_openjdk_target=`expr &quot;X$conf_option&quot; : &#39;[^=]*=\(.*\)&#39;`
233       ;;
234     --debug-configure)
235       if test &quot;x$conf_debug_configure&quot; != xrecursive; then
236         conf_debug_configure=true
237         export conf_debug_configure
238       fi
239       ;;
240     *)
241       conf_processed_arguments=(&quot;${conf_processed_arguments[@]}&quot; &quot;$conf_option&quot;)
242       ;;
243   esac
244 
245   # Store all variables overridden on the command line
246   case $conf_option in
247     [^-]*=*)
248       # Add name of variable to CONFIGURE_OVERRIDDEN_VARIABLES list inside !...!.
249       conf_env_var=`expr &quot;x$conf_option&quot; : &#39;x\([^=]*\)=&#39;`
250       CONFIGURE_OVERRIDDEN_VARIABLES=&quot;$CONFIGURE_OVERRIDDEN_VARIABLES!$conf_env_var!&quot;
251       ;;
252   esac
253 
254   # Save the arguments, intelligently quoted for CONFIGURE_COMMAND_LINE.
255   case $conf_option in
256     *=*)
257       conf_option_name=`expr &quot;x$conf_option&quot; : &#39;x\([^=]*\)=&#39;`
258       conf_option_name=$(shell_quote &quot;$conf_option_name&quot;)
259       conf_option_value=`expr &quot;x$conf_option&quot; : &#39;x[^=]*=\(.*\)&#39;`
260       conf_option_value=$(shell_quote &quot;$conf_option_value&quot;)
261       conf_quoted_arguments=(&quot;${conf_quoted_arguments[@]}&quot; &quot;$conf_option_name=$conf_option_value&quot;)
262       ;;
263     *)
264       conf_quoted_arguments=(&quot;${conf_quoted_arguments[@]}&quot; &quot;$(shell_quote &quot;$conf_option&quot;)&quot;)
265       ;;
266   esac
267 
268   # Check for certain autoconf options that require extra action
269   case $conf_option in
270     -build | --build | --buil | --bui | --bu |-build=* | --build=* | --buil=* | --bui=* | --bu=*)
271       conf_legacy_crosscompile=&quot;$conf_legacy_crosscompile $conf_option&quot; ;;
272     -target | --target | --targe | --targ | --tar | --ta | --t | -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
273       conf_legacy_crosscompile=&quot;$conf_legacy_crosscompile $conf_option&quot; ;;
274     -host | --host | --hos | --ho | -host=* | --host=* | --hos=* | --ho=*)
275       conf_legacy_crosscompile=&quot;$conf_legacy_crosscompile $conf_option&quot; ;;
276     -help | --help | --hel | --he | -h)
277       conf_print_help=true ;;
278   esac
279 done
280 
281 # Save the quoted command line
282 CONFIGURE_COMMAND_LINE=&quot;${conf_quoted_arguments[@]}&quot;
283 
284 if test &quot;x$conf_legacy_crosscompile&quot; != &quot;x&quot;; then
285   if test &quot;x$conf_openjdk_target&quot; != &quot;x&quot;; then
286     echo &quot;Error: Specifying --openjdk-target together with autoconf&quot;
287     echo &quot;legacy cross-compilation flags is not supported.&quot;
288     echo &quot;You specified: --openjdk-target=$conf_openjdk_target and $conf_legacy_crosscompile.&quot;
289     echo &quot;The recommended use is just --openjdk-target.&quot;
290     exit 1
291   else
292     echo &quot;Warning: You are using legacy autoconf cross-compilation flags.&quot;
293     echo &quot;It is recommended that you use --openjdk-target instead.&quot;
294     echo &quot;&quot;
295   fi
296 fi
297 
298 if test &quot;x$conf_openjdk_target&quot; != &quot;x&quot;; then
299   conf_build_platform=`sh $conf_script_dir/build-aux/config.guess`
300   conf_processed_arguments=(&quot;--build=$conf_build_platform&quot; &quot;--host=$conf_openjdk_target&quot; &quot;--target=$conf_openjdk_target&quot; &quot;${conf_processed_arguments[@]}&quot;)
301 fi
302 
303 # Make configure exit with error on invalid options as default.
304 # Can be overridden by --disable-option-checking, since we prepend our argument
305 # and later options override earlier.
306 conf_processed_arguments=(&quot;--enable-option-checking=fatal&quot; &quot;${conf_processed_arguments[@]}&quot;)
307 
308 ###
309 ### Call the configure script
310 ###
311 if test &quot;x$conf_debug_configure&quot; != x; then
312   # Turn on shell debug output if requested (initial or recursive)
313   set -x
314 fi
315 
316 # Now transfer control to the script generated by autoconf. This is where the
317 # main work is done.
318 RCDIR=`mktemp -dt jdk-build-configure.tmp.XXXXXX` || exit $?
319 trap &quot;rm -rf \&quot;$RCDIR\&quot;&quot; EXIT
320 conf_logfile=./configure.log
321 (exec 3&gt;&amp;1 ; ((. $generated_script &quot;${conf_processed_arguments[@]}&quot; 2&gt;&amp;1 1&gt;&amp;3 ) \
322     ; echo $? &gt; &quot;$RCDIR/rc&quot; ) \
323     | tee -a $conf_logfile 1&gt;&amp;2 ; exec 3&gt;&amp;-) | tee -a $conf_logfile
324 
325 conf_result_code=`cat &quot;$RCDIR/rc&quot;`
326 ###
327 ### Post-processing
328 ###
329 
330 if test $conf_result_code -eq 0; then
331   if test &quot;x$conf_print_help&quot; = xtrue; then
332     cat &lt;&lt;EOT
333 
334 Additional (non-autoconf) OpenJDK Options:
335   --openjdk-target=TARGET cross-compile with TARGET as target platform
336                           (i.e. the one you will run the resulting binary on).
337                           Equivalent to --host=TARGET --target=TARGET
338                           --build=&lt;current platform&gt;
339   --debug-configure       Run the configure script with additional debug
340                           logging enabled.
341 
342 EOT
343 
344     # Print additional help, e.g. a list of toolchains and JVM features.
345     # This must be done by the autoconf script.
346     ( CONFIGURE_PRINT_ADDITIONAL_HELP=true . $generated_script PRINTF=printf )
347 
348     cat &lt;&lt;EOT
349 
350 Please be aware that, when cross-compiling, the OpenJDK configure script will
351 generally use &#39;target&#39; where autoconf traditionally uses &#39;host&#39;.
352 
353 Also note that variables must be passed on the command line. Variables in the
354 environment will generally be ignored, unlike traditional autoconf scripts.
355 EOT
356   fi
357 else
358   echo configure exiting with result code $conf_result_code
359 fi
360 
361 exit $conf_result_code
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>