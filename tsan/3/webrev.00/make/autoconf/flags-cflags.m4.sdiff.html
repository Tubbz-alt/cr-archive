<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/flags-cflags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="configure.ac.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags-cflags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
104   AC_SUBST(SHARED_LIBRARY_FLAGS)
105 ])
106 
107 AC_DEFUN([FLAGS_SETUP_DEBUG_SYMBOLS],
108 [
109   # By default don&#39;t set any specific assembler debug
110   # info flags for toolchains unless we know they work.
111   # See JDK-8207057.
112   ASFLAGS_DEBUG_SYMBOLS=&quot;&quot;
113   # Debug symbols
114   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
115     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
116     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
117   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
118     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
119     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
120   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
121     # -g0 enables debug symbols without disabling inlining.
122     CFLAGS_DEBUG_SYMBOLS=&quot;-g0 -xs&quot;
123   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
<span class="line-modified">124     if test &quot;x$XLC_USES_CLANG&quot; = xtrue; then</span>
<span class="line-removed">125       CFLAGS_DEBUG_SYMBOLS=&quot;-g1&quot;</span>
<span class="line-removed">126     else</span>
<span class="line-removed">127       CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;</span>
<span class="line-removed">128     fi</span>
129   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
<span class="line-modified">130     CFLAGS_DEBUG_SYMBOLS=&quot;-Z7 -d2Zi+&quot;</span>
131   fi
132 
133   AC_SUBST(CFLAGS_DEBUG_SYMBOLS)
134   AC_SUBST(ASFLAGS_DEBUG_SYMBOLS)
135 ])
136 
137 AC_DEFUN([FLAGS_SETUP_WARNINGS],
138 [
139   AC_ARG_ENABLE([warnings-as-errors], [AS_HELP_STRING([--disable-warnings-as-errors],
140       [do not consider native warnings to be an error @&lt;:@enabled@:&gt;@])])
141 
142   # Set default value.
143   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
144     WARNINGS_AS_ERRORS=false
145   else
146     WARNINGS_AS_ERRORS=true
147   fi
148 
149   AC_MSG_CHECKING([if native warnings are errors])
150   if test &quot;x$enable_warnings_as_errors&quot; = &quot;xyes&quot;; then
</pre>
<hr />
<pre>
157     AC_MSG_RESULT([${WARNINGS_AS_ERRORS} (default)])
158   else
159     AC_MSG_ERROR([--enable-warnings-as-errors accepts no argument])
160   fi
161 
162   AC_SUBST(WARNINGS_AS_ERRORS)
163 
164   case &quot;${TOOLCHAIN_TYPE}&quot; in
165     microsoft)
166       DISABLE_WARNING_PREFIX=&quot;-wd&quot;
167       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-WX&quot;
168 
169       WARNINGS_ENABLE_ALL=&quot;-W3&quot;
170       DISABLED_WARNINGS=&quot;4800&quot;
171       ;;
172 
173     solstudio)
174       DISABLE_WARNING_PREFIX=&quot;-erroff=&quot;
175       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-errwarn=%all&quot;
176 
<span class="line-modified">177       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-v&quot;</span>
<span class="line-modified">178       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;+w&quot;</span>
179 
<span class="line-modified">180       DISABLED_WARNINGS_C=&quot;&quot;</span>
<span class="line-modified">181       DISABLED_WARNINGS_CXX=&quot;&quot;</span>
182       ;;
183 
184     gcc)
185       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
186       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
187 
188       # Additional warnings that are not activated by -Wall and -Wextra
189       WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare \
190           -Wunused-function -Wundef -Wunused-value -Wreturn-type \
191           -Wtrampolines&quot;
192       WARNINGS_ENABLE_ADDITIONAL_CXX=&quot;-Woverloaded-virtual -Wreorder&quot;
193       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
194       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;$WARNINGS_ENABLE_ALL_CFLAGS $WARNINGS_ENABLE_ADDITIONAL_CXX&quot;
195 
196       DISABLED_WARNINGS=&quot;unused-parameter unused&quot;
<span class="line-removed">197 </span>
<span class="line-removed">198       # Repeate the check for the BUILD_CC and BUILD_CXX. Need to also reset</span>
<span class="line-removed">199       # CFLAGS since any target specific flags will likely not work with the</span>
<span class="line-removed">200       # build compiler</span>
<span class="line-removed">201       CC_OLD=&quot;$CC&quot;</span>
<span class="line-removed">202       CXX_OLD=&quot;$CXX&quot;</span>
<span class="line-removed">203       CC=&quot;$BUILD_CC&quot;</span>
<span class="line-removed">204       CXX=&quot;$BUILD_CXX&quot;</span>
<span class="line-removed">205       CFLAGS_OLD=&quot;$CFLAGS&quot;</span>
<span class="line-removed">206       CFLAGS=&quot;&quot;</span>
207       BUILD_CC_DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
<span class="line-removed">208       CC=&quot;$CC_OLD&quot;</span>
<span class="line-removed">209       CXX=&quot;$CXX_OLD&quot;</span>
<span class="line-removed">210       CFLAGS=&quot;$CFLAGS_OLD&quot;</span>
211       ;;
212 
213     clang)
214       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
215       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
216 
217       # Additional warnings that are not activated by -Wall and -Wextra
218       WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare -Wreorder \
219           -Wunused-function -Wundef -Wunused-value -Woverloaded-virtual&quot;
220       WARNINGS_ENABLE_ALL=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
221 
<span class="line-modified">222       DISABLED_WARNINGS=&quot;unused-parameter unused&quot;</span>
223 
224       if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
225         # missing-method-return-type triggers in JavaNativeFoundation framework
226         DISABLED_WARNINGS=&quot;$DISABLED_WARNINGS missing-method-return-type&quot;
227       fi
228 
229       ;;
230 
231     xlc)
<span class="line-modified">232       DISABLE_WARNING_PREFIX=&quot;-qsuppress=&quot;</span>
233       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-qhalt=w&quot;
234 
235       # Possibly a better subset than &quot;all&quot; is &quot;lan:trx:ret:zea:cmp:ret&quot;
236       WARNINGS_ENABLE_ALL=&quot;-qinfo=all -qformat=all&quot;
237       DISABLED_WARNINGS=&quot;&quot;
238       ;;
239   esac
240   AC_SUBST(DISABLE_WARNING_PREFIX)
241   AC_SUBST(BUILD_CC_DISABLE_WARNING_PREFIX)
242   AC_SUBST(CFLAGS_WARNINGS_ARE_ERRORS)
243   AC_SUBST(DISABLED_WARNINGS)
244   AC_SUBST(DISABLED_WARNINGS_C)
245   AC_SUBST(DISABLED_WARNINGS_CXX)
246 ])
247 
248 AC_DEFUN([FLAGS_SETUP_QUALITY_CHECKS],
249 [
250   # bounds, memory and behavior checking options
251   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
252     case $DEBUG_LEVEL in
</pre>
<hr />
<pre>
283     C_O_FLAG_NONE=&quot;&quot;
284     if test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xx86&quot;; then
285       C_O_FLAG_HIGHEST=&quot;-xO4 -Wu,-O4~yz $CC_HIGHEST&quot;
286       C_O_FLAG_HI=&quot;-xO4 -Wu,-O4~yz&quot;
287       C_O_FLAG_NORM=&quot;-xO2 -Wu,-O2~yz&quot;
288     elif test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xsparc&quot;; then
289       C_O_FLAG_HIGHEST=&quot;-xO4 -Wc,-Qrm-s -Wc,-Qiselect-T0 \
290           -xprefetch=auto,explicit $CC_HIGHEST&quot;
291       C_O_FLAG_HI=&quot;-xO4 -Wc,-Qrm-s -Wc,-Qiselect-T0&quot;
292       C_O_FLAG_NORM=&quot;-xO2 -Wc,-Qrm-s -Wc,-Qiselect-T0&quot;
293     fi
294   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
295     C_O_FLAG_HIGHEST_JVM=&quot;-O3&quot;
296     C_O_FLAG_HIGHEST=&quot;-O3&quot;
297     C_O_FLAG_HI=&quot;-O3&quot;
298     C_O_FLAG_NORM=&quot;-O2&quot;
299     C_O_FLAG_SIZE=&quot;-Os&quot;
300     C_O_FLAG_DEBUG=&quot;-O0&quot;
301     C_O_FLAG_DEBUG_JVM=&quot;-O0&quot;
302     C_O_FLAG_NONE=&quot;-O0&quot;














303   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
304     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
305       # On MacOSX we optimize for size, something
306       # we should do for all platforms?
307       C_O_FLAG_HIGHEST_JVM=&quot;-Os&quot;
308       C_O_FLAG_HIGHEST=&quot;-Os&quot;
309       C_O_FLAG_HI=&quot;-Os&quot;
310       C_O_FLAG_NORM=&quot;-Os&quot;
311       C_O_FLAG_DEBUG_JVM=&quot;&quot;
312     else
313       C_O_FLAG_HIGHEST_JVM=&quot;-O3&quot;
314       C_O_FLAG_HIGHEST=&quot;-O3&quot;
315       C_O_FLAG_HI=&quot;-O3&quot;
316       C_O_FLAG_NORM=&quot;-O2&quot;
317       C_O_FLAG_DEBUG_JVM=&quot;-O0&quot;
318     fi
319     C_O_FLAG_SIZE=&quot;-Os&quot;
320     C_O_FLAG_DEBUG=&quot;-O0&quot;
321     C_O_FLAG_NONE=&quot;-O0&quot;
322   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
</pre>
<hr />
<pre>
393   AC_SUBST(CXX_O_FLAG_SIZE)
394 ])
395 
396 AC_DEFUN([FLAGS_SETUP_CFLAGS],
397 [
398   ### CFLAGS
399 
400   FLAGS_SETUP_CFLAGS_HELPER
401 
402   FLAGS_OS=$OPENJDK_TARGET_OS
403   FLAGS_OS_TYPE=$OPENJDK_TARGET_OS_TYPE
404   FLAGS_CPU=$OPENJDK_TARGET_CPU
405   FLAGS_CPU_ARCH=$OPENJDK_TARGET_CPU_ARCH
406   FLAGS_CPU_BITS=$OPENJDK_TARGET_CPU_BITS
407   FLAGS_CPU_ENDIAN=$OPENJDK_TARGET_CPU_ENDIAN
408   FLAGS_CPU_LEGACY=$OPENJDK_TARGET_CPU_LEGACY
409   FLAGS_CPU_LEGACY_LIB=$OPENJDK_TARGET_CPU_LEGACY_LIB
410 
411   FLAGS_SETUP_CFLAGS_CPU_DEP([TARGET])
412 











413   FLAGS_OS=$OPENJDK_BUILD_OS
414   FLAGS_OS_TYPE=$OPENJDK_BUILD_OS_TYPE
415   FLAGS_CPU=$OPENJDK_BUILD_CPU
416   FLAGS_CPU_ARCH=$OPENJDK_BUILD_CPU_ARCH
417   FLAGS_CPU_BITS=$OPENJDK_BUILD_CPU_BITS
418   FLAGS_CPU_ENDIAN=$OPENJDK_BUILD_CPU_ENDIAN
419   FLAGS_CPU_LEGACY=$OPENJDK_BUILD_CPU_LEGACY
420   FLAGS_CPU_LEGACY_LIB=$OPENJDK_BUILD_CPU_LEGACY_LIB
421 
422   FLAGS_SETUP_CFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_], [BUILD_])





423 ])
424 
425 ################################################################################
426 # platform independent
427 AC_DEFUN([FLAGS_SETUP_CFLAGS_HELPER],
428 [
429   #### OS DEFINES, these should be independent on toolchain
430   if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
431     CFLAGS_OS_DEF_JVM=&quot;-DLINUX&quot;
432     CFLAGS_OS_DEF_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE&quot;
433   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then
434     CFLAGS_OS_DEF_JVM=&quot;-DSOLARIS&quot;
435     CFLAGS_OS_DEF_JDK=&quot;-D__solaris__&quot;
436   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
437     CFLAGS_OS_DEF_JVM=&quot;-D_ALLBSD_SOURCE -D_DARWIN_C_SOURCE -D_XOPEN_SOURCE&quot;
438     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE -D_DARWIN_UNLIMITED_SELECT&quot;
439   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
440     CFLAGS_OS_DEF_JVM=&quot;-DAIX&quot;
441   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xbsd; then
442     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE&quot;
</pre>
<hr />
<pre>
502     ALWAYS_DEFINES_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE -DSTDC&quot;
503   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
504     ALWAYS_DEFINES_JDK=&quot;-DWIN32_LEAN_AND_MEAN -D_CRT_SECURE_NO_DEPRECATE \
505         -D_CRT_NONSTDC_NO_DEPRECATE -DWIN32 -DIAL&quot;
506     ALWAYS_DEFINES_JVM=&quot;-DNOMINMAX -DWIN32_LEAN_AND_MEAN&quot;
507   fi
508 
509   ###############################################################################
510   #
511   #
512   # CFLAGS BASIC
513   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
514     # COMMON to gcc and clang
515     TOOLCHAIN_CFLAGS_JVM=&quot;-pipe -fno-rtti -fno-exceptions \
516         -fvisibility=hidden -fno-strict-aliasing -fno-omit-frame-pointer&quot;
517   fi
518 
519   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
520     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -fcheck-new -fstack-protector&quot;
521     TOOLCHAIN_CFLAGS_JDK=&quot;-pipe -fstack-protector&quot;








522     # technically NOT for CXX (but since this gives *worse* performance, use
523     # no-strict-aliasing everywhere!)
524     TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot;
525 
526   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
527     # Restrict the debug information created by Clang to avoid
528     # too big object files and speed the build up a little bit
529     # (see http://llvm.org/bugs/show_bug.cgi?id=7554)
530     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -flimit-debug-info&quot;
531 
532     # In principle the stack alignment below is cpu- and ABI-dependent and
533     # should agree with values of StackAlignmentInBytes in various
534     # src/hotspot/cpu/*/globalDefinitions_*.hpp files, but this value currently
535     # works for all platforms.
536     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mno-omit-leaf-frame-pointer -mstack-alignment=16&quot;
537 
538     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then






539       TOOLCHAIN_CFLAGS_JDK=&quot;-pipe&quot;
540       TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot; # technically NOT for CXX
541     fi
542   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
543     TOOLCHAIN_FLAGS=&quot;-errtags -errfmt&quot;
544     TOOLCHAIN_CFLAGS=&quot;-errshort=tags&quot;
545 
546     TOOLCHAIN_CFLAGS_JDK=&quot;-mt $TOOLCHAIN_FLAGS&quot;
<span class="line-modified">547     TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-xCC -Xa -W0,-noglobal $TOOLCHAIN_CFLAGS&quot; # C only</span>
548     TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;-features=no%except -norunpath -xnolib&quot; # CXX only
549     TOOLCHAIN_CFLAGS_JVM=&quot;-template=no%extdef -features=no%split_init \
550         -library=stlport4 -mt -features=no%except $TOOLCHAIN_FLAGS&quot;
551     if test &quot;x$DEBUG_LEVEL&quot; = xslowdebug; then
552       # Previously -g was used instead of -g0 for slowdebug; this is equivalent
553       # to setting +d.
554       TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM +d&quot;
555     fi
556 
557   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
558     # Suggested additions: -qsrcmsg to get improved error reporting
<span class="line-modified">559     TOOLCHAIN_CFLAGS_JDK=&quot;-qchars=signed -qfullpath -qsaveopt -qstackprotect&quot;  # add on both CFLAGS</span>
<span class="line-modified">560     TOOLCHAIN_CFLAGS_JVM=&quot;-qtune=balanced \</span>
<span class="line-modified">561         -qalias=noansi -qstrict -qtls=default -qlanglvl=c99vla \</span>
<span class="line-modified">562         -qlanglvl=noredefmac -qnortti -qnoeh -qignerrno -qstackprotect&quot;</span>
563   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
564     TOOLCHAIN_CFLAGS_JVM=&quot;-nologo -MD -MP&quot;
565     TOOLCHAIN_CFLAGS_JDK=&quot;-nologo -MD -Zc:wchar_t-&quot;
566   fi
567 























568   # CFLAGS WARNINGS STUFF
569   # Set JVM_CFLAGS warning handling
570   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
571     WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;
572     WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
573     WARNING_CFLAGS_JVM=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
574 
575   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
576     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
577 
578   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
579     WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;
580     WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
581     WARNING_CFLAGS_JVM=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
582 
583   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
584     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
585 
586   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
587     WARNING_CFLAGS=&quot;&quot;  # currently left empty
</pre>
<hr />
<pre>
637   fi
638 
639   # Optional POSIX functionality needed by the JVM
640   #
641   # Check if clock_gettime is available and in which library. This indicates
642   # availability of CLOCK_MONOTONIC for hotspot. But we don&#39;t need to link, so
643   # don&#39;t let it update LIBS.
644   save_LIBS=&quot;$LIBS&quot;
645   AC_SEARCH_LIBS(clock_gettime, rt, [HAS_CLOCK_GETTIME=true], [])
646   if test &quot;x$LIBS&quot; = &quot;x-lrt &quot;; then
647     CLOCK_GETTIME_IN_LIBRT=true
648   fi
649   LIBS=&quot;$save_LIBS&quot;
650 
651   if test &quot;x$HAS_CLOCK_GETTIME&quot; = &quot;xtrue&quot;; then
652     OS_CFLAGS_JVM=&quot;$OS_CFLAGS_JVM -DSUPPORTS_CLOCK_MONOTONIC&quot;
653     if test &quot;x$CLOCK_GETTIME_IN_LIBRT&quot; = &quot;xtrue&quot;; then
654       OS_CFLAGS_JVM=&quot;$OS_CFLAGS_JVM -DNEEDS_LIBRT&quot;
655     fi
656   fi














657 ])
658 
659 ################################################################################
660 # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
661 #      conditionals against.
662 # $2 - Optional prefix for each variable defined.
663 # $3 - Optional prefix for compiler variables (either BUILD_ or nothing).
664 AC_DEFUN([FLAGS_SETUP_CFLAGS_CPU_DEP],
665 [
666   #### CPU DEFINES, these should (in theory) be independent on toolchain
667 
668   # Setup target CPU
669   # Setup endianness
670   if test &quot;x$FLAGS_CPU_ENDIAN&quot; = xlittle; then
671     $1_DEFINES_CPU_JVM=&quot;-DVM_LITTLE_ENDIAN&quot;
672   fi
673   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
674     # The macro _LITTLE_ENDIAN needs to be defined the same to avoid the
675     #   Sun C compiler warning message: warning: macro redefined: _LITTLE_ENDIAN
676     if test &quot;x$FLAGS_CPU_ENDIAN&quot; = xlittle; then
</pre>
<hr />
<pre>
734       $1_CFLAGS_CPU_JVM=&quot;-minsert-sched-nops=regroup_exact -mno-multiple -mno-string&quot;
735       if test &quot;x$FLAGS_CPU&quot; = xppc64; then
736         # -mminimal-toc fixes `relocation truncated to fit&#39; error for gcc 4.1.
737         # Use ppc64 instructions, but schedule for power5
738         $1_CFLAGS_CPU_JVM=&quot;${$1_CFLAGS_CPU_JVM} -mminimal-toc -mcpu=powerpc64 -mtune=power5&quot;
739       elif test &quot;x$FLAGS_CPU&quot; = xppc64le; then
740         # Little endian machine uses ELFv2 ABI.
741         # Use Power8, this is the first CPU to support PPC64 LE with ELFv2 ABI.
742         $1_CFLAGS_CPU_JVM=&quot;${$1_CFLAGS_CPU_JVM} -DABI_ELFv2 -mcpu=power8 -mtune=power8&quot;
743       fi
744     elif test &quot;x$FLAGS_CPU&quot; = xs390x; then
745       $1_CFLAGS_CPU=&quot;-mbackchain -march=z10&quot;
746     fi
747 
748     if test &quot;x$FLAGS_CPU_ARCH&quot; != xarm &amp;&amp;  test &quot;x$FLAGS_CPU_ARCH&quot; != xppc; then
749       # for all archs except arm and ppc, prevent gcc to omit frame pointer
750       $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
751     fi
752 
753     $1_CXXSTD_CXXFLAG=&quot;-std=gnu++98&quot;
<span class="line-modified">754     FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${$1_CXXSTD_CXXFLAG} -Werror],</span>
755         PREFIX: $3, IF_FALSE: [$1_CXXSTD_CXXFLAG=&quot;&quot;])
756     $1_TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;${$1_CXXSTD_CXXFLAG}&quot;
757     $1_TOOLCHAIN_CFLAGS_JVM=&quot;${$1_TOOLCHAIN_CFLAGS_JVM} ${$1_CXXSTD_CXXFLAG}&quot;
758     $2ADLC_CXXFLAG=&quot;${$1_CXXSTD_CXXFLAG}&quot;
759 
760   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
761     if test &quot;x$FLAGS_OS&quot; = xlinux; then
762       # ppc test not really needed for clang
763       if test &quot;x$FLAGS_CPU_ARCH&quot; != xarm &amp;&amp;  test &quot;x$FLAGS_CPU_ARCH&quot; != xppc; then
764         # for all archs except arm and ppc, prevent gcc to omit frame pointer
765         $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
766       fi
767     fi
768 
769   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
770     if test &quot;x$FLAGS_CPU&quot; = xx86_64; then
771       # NOTE: -xregs=no%frameptr is supposed to be default on x64
772       $1_CFLAGS_CPU_JDK=&quot;-xregs=no%frameptr&quot;
773     elif test &quot;x$FLAGS_CPU&quot; = xsparcv9; then
774       $1_CFLAGS_CPU_JVM=&quot;-xarch=sparc&quot;
</pre>
<hr />
<pre>
782 
783   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
784     if test &quot;x$FLAGS_CPU&quot; = xx86; then
785       $1_CFLAGS_CPU_JVM=&quot;-arch:IA32&quot;
786     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = xx86_64; then
787       if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
788         # NOTE: This is probably redundant; -homeparams is default on
789         # non-release builds.
790         $1_CFLAGS_CPU_JVM=&quot;-homeparams&quot;
791       fi
792     fi
793   fi
794 
795   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
796     FLAGS_SETUP_GCC6_COMPILER_FLAGS($1, $3)
797     $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
798 
799     $1_WARNING_CFLAGS_JVM=&quot;-Wno-format-zero-length -Wtype-limits -Wuninitialized&quot;
800   fi
801 













802   # EXPORT to API
803   CFLAGS_JVM_COMMON=&quot;$ALWAYS_CFLAGS_JVM $ALWAYS_DEFINES_JVM \
804       $TOOLCHAIN_CFLAGS_JVM ${$1_TOOLCHAIN_CFLAGS_JVM} \
805       $OS_CFLAGS $OS_CFLAGS_JVM $CFLAGS_OS_DEF_JVM $DEBUG_CFLAGS_JVM \
<span class="line-modified">806       $WARNING_CFLAGS $WARNING_CFLAGS_JVM $JVM_PICFLAG&quot;</span>
807 
808   CFLAGS_JDK_COMMON=&quot;$ALWAYS_CFLAGS_JDK $ALWAYS_DEFINES_JDK $TOOLCHAIN_CFLAGS_JDK \
809       $OS_CFLAGS $CFLAGS_OS_DEF_JDK $DEBUG_CFLAGS_JDK $DEBUG_OPTIONS_FLAGS_JDK \
<span class="line-modified">810       $WARNING_CFLAGS $WARNING_CFLAGS_JDK $DEBUG_SYMBOLS_CFLAGS_JDK&quot;</span>

811 
812   # Use ${$2EXTRA_CFLAGS} to block EXTRA_CFLAGS to be added to build flags.
813   # (Currently we don&#39;t have any OPENJDK_BUILD_EXTRA_CFLAGS, but that might
814   # change in the future.)
815 
816   CFLAGS_JDK_COMMON_CONLY=&quot;$TOOLCHAIN_CFLAGS_JDK_CONLY  \
817       $WARNING_CFLAGS_JDK_CONLY ${$2EXTRA_CFLAGS}&quot;
818   CFLAGS_JDK_COMMON_CXXONLY=&quot;$ALWAYS_DEFINES_JDK_CXXONLY \
819       $TOOLCHAIN_CFLAGS_JDK_CXXONLY \
820       ${$1_TOOLCHAIN_CFLAGS_JDK_CXXONLY} \
821       $WARNING_CFLAGS_JDK_CXXONLY ${$2EXTRA_CXXFLAGS}&quot;
822 
823   $1_CFLAGS_JVM=&quot;${$1_DEFINES_CPU_JVM} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JVM} ${$1_TOOLCHAIN_CFLAGS} ${$1_WARNING_CFLAGS_JVM}&quot;
824   $1_CFLAGS_JDK=&quot;${$1_DEFINES_CPU_JDK} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JDK} ${$1_TOOLCHAIN_CFLAGS}&quot;
825 
826   $2JVM_CFLAGS=&quot;$CFLAGS_JVM_COMMON ${$1_CFLAGS_JVM} ${$2EXTRA_CXXFLAGS}&quot;
827 
828   $2CFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK}&quot;
829   $2CXXFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK}&quot;
830   $2CFLAGS_JDKLIB=&quot;${$2CFLAGS_JDKEXE} $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;
</pre>
<hr />
<pre>
847   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
848     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${COMPILER_FP_CONTRACT_OFF_FLAG}],
849         PREFIX: $3,
850         IF_TRUE: [$2FDLIBM_CFLAGS=${COMPILER_FP_CONTRACT_OFF_FLAG}],
851         IF_FALSE: [$2FDLIBM_CFLAGS=&quot;&quot;])
852   fi
853   AC_SUBST($2FDLIBM_CFLAGS)
854 ])
855 
856 # FLAGS_SETUP_GCC6_COMPILER_FLAGS([PREFIX])
857 # Arguments:
858 # $1 - Prefix for each variable defined.
859 # $2 - Prefix for compiler variables (either BUILD_ or nothing).
860 AC_DEFUN([FLAGS_SETUP_GCC6_COMPILER_FLAGS],
861 [
862   # These flags are required for GCC 6 builds as undefined behaviour in OpenJDK code
863   # runs afoul of the more aggressive versions of these optimisations.
864   # Notably, value range propagation now assumes that the this pointer of C++
865   # member functions is non-null.
866   NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;-fno-delete-null-pointer-checks&quot;
<span class="line-modified">867   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_DELETE_NULL_POINTER_CHECKS_CFLAG -Werror],</span>
868       PREFIX: $2, IF_FALSE: [NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;&quot;])
869   NO_LIFETIME_DSE_CFLAG=&quot;-fno-lifetime-dse&quot;
<span class="line-modified">870   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_LIFETIME_DSE_CFLAG -Werror],</span>
871       PREFIX: $2, IF_FALSE: [NO_LIFETIME_DSE_CFLAG=&quot;&quot;])
872   $1_GCC6_CFLAGS=&quot;${NO_DELETE_NULL_POINTER_CHECKS_CFLAG} ${NO_LIFETIME_DSE_CFLAG}&quot;
873 ])
874 
875 # Documentation on common flags used for solstudio in HIGHEST.
876 #
877 # WARNING: Use of OPTIMIZATION_LEVEL=HIGHEST in your Makefile needs to be
878 #          done with care, there are some assumptions below that need to
879 #          be understood about the use of pointers, and IEEE behavior.
880 #
881 # -fns: Use non-standard floating point mode (not IEEE 754)
882 # -fsimple: Do some simplification of floating point arithmetic (not IEEE 754)
883 # -fsingle: Use single precision floating point with &#39;float&#39;
884 # -xalias_level=basic: Assume memory references via basic pointer types do not alias
885 #   (Source with excessing pointer casting and data access with mixed
886 #    pointer types are not recommended)
887 # -xbuiltin=%all: Use intrinsic or inline versions for math/std functions
888 #   (If you expect perfect errno behavior, do not use this)
889 # -xdepend: Loop data dependency optimizations (need -xO3 or higher)
890 # -xrestrict: Pointer parameters to functions do not overlap
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
104   AC_SUBST(SHARED_LIBRARY_FLAGS)
105 ])
106 
107 AC_DEFUN([FLAGS_SETUP_DEBUG_SYMBOLS],
108 [
109   # By default don&#39;t set any specific assembler debug
110   # info flags for toolchains unless we know they work.
111   # See JDK-8207057.
112   ASFLAGS_DEBUG_SYMBOLS=&quot;&quot;
113   # Debug symbols
114   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
115     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
116     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
117   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
118     CFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
119     ASFLAGS_DEBUG_SYMBOLS=&quot;-g&quot;
120   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
121     # -g0 enables debug symbols without disabling inlining.
122     CFLAGS_DEBUG_SYMBOLS=&quot;-g0 -xs&quot;
123   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
<span class="line-modified">124     CFLAGS_DEBUG_SYMBOLS=&quot;-g1&quot;</span>




125   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
<span class="line-modified">126     CFLAGS_DEBUG_SYMBOLS=&quot;-Z7&quot;</span>
127   fi
128 
129   AC_SUBST(CFLAGS_DEBUG_SYMBOLS)
130   AC_SUBST(ASFLAGS_DEBUG_SYMBOLS)
131 ])
132 
133 AC_DEFUN([FLAGS_SETUP_WARNINGS],
134 [
135   AC_ARG_ENABLE([warnings-as-errors], [AS_HELP_STRING([--disable-warnings-as-errors],
136       [do not consider native warnings to be an error @&lt;:@enabled@:&gt;@])])
137 
138   # Set default value.
139   if test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
140     WARNINGS_AS_ERRORS=false
141   else
142     WARNINGS_AS_ERRORS=true
143   fi
144 
145   AC_MSG_CHECKING([if native warnings are errors])
146   if test &quot;x$enable_warnings_as_errors&quot; = &quot;xyes&quot;; then
</pre>
<hr />
<pre>
153     AC_MSG_RESULT([${WARNINGS_AS_ERRORS} (default)])
154   else
155     AC_MSG_ERROR([--enable-warnings-as-errors accepts no argument])
156   fi
157 
158   AC_SUBST(WARNINGS_AS_ERRORS)
159 
160   case &quot;${TOOLCHAIN_TYPE}&quot; in
161     microsoft)
162       DISABLE_WARNING_PREFIX=&quot;-wd&quot;
163       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-WX&quot;
164 
165       WARNINGS_ENABLE_ALL=&quot;-W3&quot;
166       DISABLED_WARNINGS=&quot;4800&quot;
167       ;;
168 
169     solstudio)
170       DISABLE_WARNING_PREFIX=&quot;-erroff=&quot;
171       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-errwarn=%all&quot;
172 
<span class="line-modified">173       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-v -fd -xtransition&quot;</span>
<span class="line-modified">174       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;+w +w2&quot;</span>
175 
<span class="line-modified">176       DISABLED_WARNINGS_C=&quot;E_OLD_STYLE_FUNC_DECL E_OLD_STYLE_FUNC_DEF E_SEMANTICS_OF_OP_CHG_IN_ANSI_C E_NO_REPLACEMENT_IN_STRING E_DECLARATION_IN_CODE&quot;</span>
<span class="line-modified">177       DISABLED_WARNINGS_CXX=&quot;inllargeuse inllargeint notused wemptydecl notemsource&quot;</span>
178       ;;
179 
180     gcc)
181       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
182       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
183 
184       # Additional warnings that are not activated by -Wall and -Wextra
185       WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare \
186           -Wunused-function -Wundef -Wunused-value -Wreturn-type \
187           -Wtrampolines&quot;
188       WARNINGS_ENABLE_ADDITIONAL_CXX=&quot;-Woverloaded-virtual -Wreorder&quot;
189       WARNINGS_ENABLE_ALL_CFLAGS=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
190       WARNINGS_ENABLE_ALL_CXXFLAGS=&quot;$WARNINGS_ENABLE_ALL_CFLAGS $WARNINGS_ENABLE_ADDITIONAL_CXX&quot;
191 
192       DISABLED_WARNINGS=&quot;unused-parameter unused&quot;










193       BUILD_CC_DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;



194       ;;
195 
196     clang)
197       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;
198       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-Werror&quot;
199 
200       # Additional warnings that are not activated by -Wall and -Wextra
201       WARNINGS_ENABLE_ADDITIONAL=&quot;-Wpointer-arith -Wsign-compare -Wreorder \
202           -Wunused-function -Wundef -Wunused-value -Woverloaded-virtual&quot;
203       WARNINGS_ENABLE_ALL=&quot;-Wall -Wextra -Wformat=2 $WARNINGS_ENABLE_ADDITIONAL&quot;
204 
<span class="line-modified">205       DISABLED_WARNINGS=&quot;unknown-warning-option unused-parameter unused&quot;</span>
206 
207       if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
208         # missing-method-return-type triggers in JavaNativeFoundation framework
209         DISABLED_WARNINGS=&quot;$DISABLED_WARNINGS missing-method-return-type&quot;
210       fi
211 
212       ;;
213 
214     xlc)
<span class="line-modified">215       DISABLE_WARNING_PREFIX=&quot;-Wno-&quot;</span>
216       CFLAGS_WARNINGS_ARE_ERRORS=&quot;-qhalt=w&quot;
217 
218       # Possibly a better subset than &quot;all&quot; is &quot;lan:trx:ret:zea:cmp:ret&quot;
219       WARNINGS_ENABLE_ALL=&quot;-qinfo=all -qformat=all&quot;
220       DISABLED_WARNINGS=&quot;&quot;
221       ;;
222   esac
223   AC_SUBST(DISABLE_WARNING_PREFIX)
224   AC_SUBST(BUILD_CC_DISABLE_WARNING_PREFIX)
225   AC_SUBST(CFLAGS_WARNINGS_ARE_ERRORS)
226   AC_SUBST(DISABLED_WARNINGS)
227   AC_SUBST(DISABLED_WARNINGS_C)
228   AC_SUBST(DISABLED_WARNINGS_CXX)
229 ])
230 
231 AC_DEFUN([FLAGS_SETUP_QUALITY_CHECKS],
232 [
233   # bounds, memory and behavior checking options
234   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
235     case $DEBUG_LEVEL in
</pre>
<hr />
<pre>
266     C_O_FLAG_NONE=&quot;&quot;
267     if test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xx86&quot;; then
268       C_O_FLAG_HIGHEST=&quot;-xO4 -Wu,-O4~yz $CC_HIGHEST&quot;
269       C_O_FLAG_HI=&quot;-xO4 -Wu,-O4~yz&quot;
270       C_O_FLAG_NORM=&quot;-xO2 -Wu,-O2~yz&quot;
271     elif test &quot;x$OPENJDK_TARGET_CPU_ARCH&quot; = &quot;xsparc&quot;; then
272       C_O_FLAG_HIGHEST=&quot;-xO4 -Wc,-Qrm-s -Wc,-Qiselect-T0 \
273           -xprefetch=auto,explicit $CC_HIGHEST&quot;
274       C_O_FLAG_HI=&quot;-xO4 -Wc,-Qrm-s -Wc,-Qiselect-T0&quot;
275       C_O_FLAG_NORM=&quot;-xO2 -Wc,-Qrm-s -Wc,-Qiselect-T0&quot;
276     fi
277   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
278     C_O_FLAG_HIGHEST_JVM=&quot;-O3&quot;
279     C_O_FLAG_HIGHEST=&quot;-O3&quot;
280     C_O_FLAG_HI=&quot;-O3&quot;
281     C_O_FLAG_NORM=&quot;-O2&quot;
282     C_O_FLAG_SIZE=&quot;-Os&quot;
283     C_O_FLAG_DEBUG=&quot;-O0&quot;
284     C_O_FLAG_DEBUG_JVM=&quot;-O0&quot;
285     C_O_FLAG_NONE=&quot;-O0&quot;
<span class="line-added">286     # -D_FORTIFY_SOURCE=2 hardening option needs optimization (at least -O1) enabled</span>
<span class="line-added">287     # set for lower O-levels -U_FORTIFY_SOURCE to overwrite previous settings</span>
<span class="line-added">288     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux -a &quot;x$DEBUG_LEVEL&quot; = &quot;xfastdebug&quot;; then</span>
<span class="line-added">289       ENABLE_FORTIFY_CFLAGS=&quot;-D_FORTIFY_SOURCE=2&quot;</span>
<span class="line-added">290       DISABLE_FORTIFY_CFLAGS=&quot;-U_FORTIFY_SOURCE&quot;</span>
<span class="line-added">291       C_O_FLAG_HIGHEST_JVM=&quot;${C_O_FLAG_HIGHEST_JVM} ${ENABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">292       C_O_FLAG_HIGHEST=&quot;${C_O_FLAG_HIGHEST} ${ENABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">293       C_O_FLAG_HI=&quot;${C_O_FLAG_HI} ${ENABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">294       C_O_FLAG_NORM=&quot;${C_O_FLAG_NORM} ${ENABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">295       C_O_FLAG_SIZE=&quot;${C_O_FLAG_SIZE} ${DISABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">296       C_O_FLAG_DEBUG=&quot;${C_O_FLAG_DEBUG} ${DISABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">297       C_O_FLAG_DEBUG_JVM=&quot;${C_O_FLAG_DEBUG_JVM} ${DISABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">298       C_O_FLAG_NONE=&quot;${C_O_FLAG_NONE} ${DISABLE_FORTIFY_CFLAGS}&quot;</span>
<span class="line-added">299     fi</span>
300   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
301     if test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
302       # On MacOSX we optimize for size, something
303       # we should do for all platforms?
304       C_O_FLAG_HIGHEST_JVM=&quot;-Os&quot;
305       C_O_FLAG_HIGHEST=&quot;-Os&quot;
306       C_O_FLAG_HI=&quot;-Os&quot;
307       C_O_FLAG_NORM=&quot;-Os&quot;
308       C_O_FLAG_DEBUG_JVM=&quot;&quot;
309     else
310       C_O_FLAG_HIGHEST_JVM=&quot;-O3&quot;
311       C_O_FLAG_HIGHEST=&quot;-O3&quot;
312       C_O_FLAG_HI=&quot;-O3&quot;
313       C_O_FLAG_NORM=&quot;-O2&quot;
314       C_O_FLAG_DEBUG_JVM=&quot;-O0&quot;
315     fi
316     C_O_FLAG_SIZE=&quot;-Os&quot;
317     C_O_FLAG_DEBUG=&quot;-O0&quot;
318     C_O_FLAG_NONE=&quot;-O0&quot;
319   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
</pre>
<hr />
<pre>
390   AC_SUBST(CXX_O_FLAG_SIZE)
391 ])
392 
393 AC_DEFUN([FLAGS_SETUP_CFLAGS],
394 [
395   ### CFLAGS
396 
397   FLAGS_SETUP_CFLAGS_HELPER
398 
399   FLAGS_OS=$OPENJDK_TARGET_OS
400   FLAGS_OS_TYPE=$OPENJDK_TARGET_OS_TYPE
401   FLAGS_CPU=$OPENJDK_TARGET_CPU
402   FLAGS_CPU_ARCH=$OPENJDK_TARGET_CPU_ARCH
403   FLAGS_CPU_BITS=$OPENJDK_TARGET_CPU_BITS
404   FLAGS_CPU_ENDIAN=$OPENJDK_TARGET_CPU_ENDIAN
405   FLAGS_CPU_LEGACY=$OPENJDK_TARGET_CPU_LEGACY
406   FLAGS_CPU_LEGACY_LIB=$OPENJDK_TARGET_CPU_LEGACY_LIB
407 
408   FLAGS_SETUP_CFLAGS_CPU_DEP([TARGET])
409 
<span class="line-added">410   # Repeat the check for the BUILD_CC and BUILD_CXX. Need to also reset CFLAGS</span>
<span class="line-added">411   # since any target specific flags will likely not work with the build compiler.</span>
<span class="line-added">412   CC_OLD=&quot;$CC&quot;</span>
<span class="line-added">413   CXX_OLD=&quot;$CXX&quot;</span>
<span class="line-added">414   CFLAGS_OLD=&quot;$CFLAGS&quot;</span>
<span class="line-added">415   CXXFLAGS_OLD=&quot;$CXXFLAGS&quot;</span>
<span class="line-added">416   CC=&quot;$BUILD_CC&quot;</span>
<span class="line-added">417   CXX=&quot;$BUILD_CXX&quot;</span>
<span class="line-added">418   CFLAGS=&quot;&quot;</span>
<span class="line-added">419   CXXFLAGS=&quot;&quot;</span>
<span class="line-added">420 </span>
421   FLAGS_OS=$OPENJDK_BUILD_OS
422   FLAGS_OS_TYPE=$OPENJDK_BUILD_OS_TYPE
423   FLAGS_CPU=$OPENJDK_BUILD_CPU
424   FLAGS_CPU_ARCH=$OPENJDK_BUILD_CPU_ARCH
425   FLAGS_CPU_BITS=$OPENJDK_BUILD_CPU_BITS
426   FLAGS_CPU_ENDIAN=$OPENJDK_BUILD_CPU_ENDIAN
427   FLAGS_CPU_LEGACY=$OPENJDK_BUILD_CPU_LEGACY
428   FLAGS_CPU_LEGACY_LIB=$OPENJDK_BUILD_CPU_LEGACY_LIB
429 
430   FLAGS_SETUP_CFLAGS_CPU_DEP([BUILD], [OPENJDK_BUILD_], [BUILD_])
<span class="line-added">431 </span>
<span class="line-added">432   CC=&quot;$CC_OLD&quot;</span>
<span class="line-added">433   CXX=&quot;$CXX_OLD&quot;</span>
<span class="line-added">434   CFLAGS=&quot;$CFLAGS_OLD&quot;</span>
<span class="line-added">435   CXXFLAGS=&quot;$CXXFLAGS_OLD&quot;</span>
436 ])
437 
438 ################################################################################
439 # platform independent
440 AC_DEFUN([FLAGS_SETUP_CFLAGS_HELPER],
441 [
442   #### OS DEFINES, these should be independent on toolchain
443   if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
444     CFLAGS_OS_DEF_JVM=&quot;-DLINUX&quot;
445     CFLAGS_OS_DEF_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE&quot;
446   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris; then
447     CFLAGS_OS_DEF_JVM=&quot;-DSOLARIS&quot;
448     CFLAGS_OS_DEF_JDK=&quot;-D__solaris__&quot;
449   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xmacosx; then
450     CFLAGS_OS_DEF_JVM=&quot;-D_ALLBSD_SOURCE -D_DARWIN_C_SOURCE -D_XOPEN_SOURCE&quot;
451     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE -D_DARWIN_UNLIMITED_SELECT&quot;
452   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
453     CFLAGS_OS_DEF_JVM=&quot;-DAIX&quot;
454   elif test &quot;x$OPENJDK_TARGET_OS&quot; = xbsd; then
455     CFLAGS_OS_DEF_JDK=&quot;-D_ALLBSD_SOURCE&quot;
</pre>
<hr />
<pre>
515     ALWAYS_DEFINES_JDK=&quot;-D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE -DSTDC&quot;
516   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
517     ALWAYS_DEFINES_JDK=&quot;-DWIN32_LEAN_AND_MEAN -D_CRT_SECURE_NO_DEPRECATE \
518         -D_CRT_NONSTDC_NO_DEPRECATE -DWIN32 -DIAL&quot;
519     ALWAYS_DEFINES_JVM=&quot;-DNOMINMAX -DWIN32_LEAN_AND_MEAN&quot;
520   fi
521 
522   ###############################################################################
523   #
524   #
525   # CFLAGS BASIC
526   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
527     # COMMON to gcc and clang
528     TOOLCHAIN_CFLAGS_JVM=&quot;-pipe -fno-rtti -fno-exceptions \
529         -fvisibility=hidden -fno-strict-aliasing -fno-omit-frame-pointer&quot;
530   fi
531 
532   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
533     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -fcheck-new -fstack-protector&quot;
534     TOOLCHAIN_CFLAGS_JDK=&quot;-pipe -fstack-protector&quot;
<span class="line-added">535     # reduce lib size on linux in link step, this needs also special compile flags</span>
<span class="line-added">536     # do this on s390x also for libjvm (where serviceability agent is not supported)</span>
<span class="line-added">537     if test &quot;x$ENABLE_LINKTIME_GC&quot; = xtrue; then</span>
<span class="line-added">538       TOOLCHAIN_CFLAGS_JDK=&quot;$TOOLCHAIN_CFLAGS_JDK -ffunction-sections -fdata-sections&quot;</span>
<span class="line-added">539       if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x; then</span>
<span class="line-added">540         TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -ffunction-sections -fdata-sections&quot;</span>
<span class="line-added">541       fi</span>
<span class="line-added">542     fi</span>
543     # technically NOT for CXX (but since this gives *worse* performance, use
544     # no-strict-aliasing everywhere!)
545     TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot;
546 
547   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
548     # Restrict the debug information created by Clang to avoid
549     # too big object files and speed the build up a little bit
550     # (see http://llvm.org/bugs/show_bug.cgi?id=7554)
551     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -flimit-debug-info&quot;
552 
553     # In principle the stack alignment below is cpu- and ABI-dependent and
554     # should agree with values of StackAlignmentInBytes in various
555     # src/hotspot/cpu/*/globalDefinitions_*.hpp files, but this value currently
556     # works for all platforms.
557     TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mno-omit-leaf-frame-pointer -mstack-alignment=16&quot;
558 
559     if test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
<span class="line-added">560       if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then</span>
<span class="line-added">561         # Clang does not inline as much as GCC does for functions with &quot;inline&quot; keyword by default.</span>
<span class="line-added">562         # This causes noticeable slowdown in pause time for G1, and possibly in other areas.</span>
<span class="line-added">563         # Increasing the inline hint threshold avoids the slowdown for Clang-built JVM.</span>
<span class="line-added">564         TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM -mllvm -inlinehint-threshold=100000&quot;</span>
<span class="line-added">565       fi</span>
566       TOOLCHAIN_CFLAGS_JDK=&quot;-pipe&quot;
567       TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-fno-strict-aliasing&quot; # technically NOT for CXX
568     fi
569   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
570     TOOLCHAIN_FLAGS=&quot;-errtags -errfmt&quot;
571     TOOLCHAIN_CFLAGS=&quot;-errshort=tags&quot;
572 
573     TOOLCHAIN_CFLAGS_JDK=&quot;-mt $TOOLCHAIN_FLAGS&quot;
<span class="line-modified">574     TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;-W0,-noglobal $TOOLCHAIN_CFLAGS&quot; # C only</span>
575     TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;-features=no%except -norunpath -xnolib&quot; # CXX only
576     TOOLCHAIN_CFLAGS_JVM=&quot;-template=no%extdef -features=no%split_init \
577         -library=stlport4 -mt -features=no%except $TOOLCHAIN_FLAGS&quot;
578     if test &quot;x$DEBUG_LEVEL&quot; = xslowdebug; then
579       # Previously -g was used instead of -g0 for slowdebug; this is equivalent
580       # to setting +d.
581       TOOLCHAIN_CFLAGS_JVM=&quot;$TOOLCHAIN_CFLAGS_JVM +d&quot;
582     fi
583 
584   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
585     # Suggested additions: -qsrcmsg to get improved error reporting
<span class="line-modified">586     # set -qtbtable=full for a better traceback table/better stacks in hs_err when xlc16 is used</span>
<span class="line-modified">587     TOOLCHAIN_CFLAGS_JDK=&quot;-qtbtable=full -qchars=signed -qfullpath -qsaveopt -qstackprotect&quot;  # add on both CFLAGS</span>
<span class="line-modified">588     TOOLCHAIN_CFLAGS_JVM=&quot;-qtbtable=full -qtune=balanced \</span>
<span class="line-modified">589         -qalias=noansi -qstrict -qtls=default -qnortti -qnoeh -qignerrno -qstackprotect&quot;</span>
590   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
591     TOOLCHAIN_CFLAGS_JVM=&quot;-nologo -MD -MP&quot;
592     TOOLCHAIN_CFLAGS_JDK=&quot;-nologo -MD -Zc:wchar_t-&quot;
593   fi
594 
<span class="line-added">595   # CFLAGS C language level for JDK sources (hotspot only uses C++)</span>
<span class="line-added">596   # Ideally we would have a common level across all toolchains so that all sources</span>
<span class="line-added">597   # are sure to conform to the same standard. Unfortunately neither our sources nor</span>
<span class="line-added">598   # our toolchains are in a condition to support that. But what we loosely aim for is</span>
<span class="line-added">599   # C99 level.</span>
<span class="line-added">600   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang || test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then</span>
<span class="line-added">601     # Explicitly set C99. clang and xlclang support the same flag.</span>
<span class="line-added">602     LANGSTD_CFLAGS=&quot;-std=c99&quot;</span>
<span class="line-added">603   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then</span>
<span class="line-added">604     # We can&#39;t turn on -std=c99 without breaking compilation of the splashscreen/png</span>
<span class="line-added">605     # utilities. But we can enable c99 as below (previously achieved by using -Xa).</span>
<span class="line-added">606     # It is the no_lib that makes the difference.</span>
<span class="line-added">607     LANGSTD_CFLAGS=&quot;-xc99=all,no_lib&quot;</span>
<span class="line-added">608   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then</span>
<span class="line-added">609     # MSVC doesn&#39;t support C99/C11 explicitly, unless you compile as C++:</span>
<span class="line-added">610     # LANGSTD_CFLAGS=&quot;-TP&quot;</span>
<span class="line-added">611     # but that requires numerous changes to the sources files. So we are limited</span>
<span class="line-added">612     # to C89/C90 plus whatever extensions Visual Studio has decided to implement.</span>
<span class="line-added">613     # This is the lowest bar for shared code.</span>
<span class="line-added">614     LANGSTD_CFLAGS=&quot;&quot;</span>
<span class="line-added">615   fi</span>
<span class="line-added">616   TOOLCHAIN_CFLAGS_JDK_CONLY=&quot;$LANGSTD_CFLAGS $TOOLCHAIN_CFLAGS_JDK_CONLY&quot;</span>
<span class="line-added">617 </span>
618   # CFLAGS WARNINGS STUFF
619   # Set JVM_CFLAGS warning handling
620   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
621     WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;
622     WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
623     WARNING_CFLAGS_JVM=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
624 
625   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
626     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
627 
628   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
629     WARNING_CFLAGS_JDK_CONLY=&quot;$WARNINGS_ENABLE_ALL_CFLAGS&quot;
630     WARNING_CFLAGS_JDK_CXXONLY=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
631     WARNING_CFLAGS_JVM=&quot;$WARNINGS_ENABLE_ALL_CXXFLAGS&quot;
632 
633   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
634     WARNING_CFLAGS=&quot;$WARNINGS_ENABLE_ALL&quot;
635 
636   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xxlc; then
637     WARNING_CFLAGS=&quot;&quot;  # currently left empty
</pre>
<hr />
<pre>
687   fi
688 
689   # Optional POSIX functionality needed by the JVM
690   #
691   # Check if clock_gettime is available and in which library. This indicates
692   # availability of CLOCK_MONOTONIC for hotspot. But we don&#39;t need to link, so
693   # don&#39;t let it update LIBS.
694   save_LIBS=&quot;$LIBS&quot;
695   AC_SEARCH_LIBS(clock_gettime, rt, [HAS_CLOCK_GETTIME=true], [])
696   if test &quot;x$LIBS&quot; = &quot;x-lrt &quot;; then
697     CLOCK_GETTIME_IN_LIBRT=true
698   fi
699   LIBS=&quot;$save_LIBS&quot;
700 
701   if test &quot;x$HAS_CLOCK_GETTIME&quot; = &quot;xtrue&quot;; then
702     OS_CFLAGS_JVM=&quot;$OS_CFLAGS_JVM -DSUPPORTS_CLOCK_MONOTONIC&quot;
703     if test &quot;x$CLOCK_GETTIME_IN_LIBRT&quot; = &quot;xtrue&quot;; then
704       OS_CFLAGS_JVM=&quot;$OS_CFLAGS_JVM -DNEEDS_LIBRT&quot;
705     fi
706   fi
<span class="line-added">707 </span>
<span class="line-added">708   # Extra flags needed when building optional static versions of certain</span>
<span class="line-added">709   # JDK libraries.</span>
<span class="line-added">710   STATIC_LIBS_CFLAGS=&quot;-DSTATIC_BUILD=1&quot;</span>
<span class="line-added">711   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then</span>
<span class="line-added">712     STATIC_LIBS_CFLAGS=&quot;$STATIC_LIBS_CFLAGS -ffunction-sections -fdata-sections&quot;</span>
<span class="line-added">713   fi</span>
<span class="line-added">714   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then</span>
<span class="line-added">715     # Disable relax-relocation to enable compatibility with older linkers</span>
<span class="line-added">716     RELAX_RELOCATIONS_FLAG=&quot;-Xassembler -mrelax-relocations=no&quot;</span>
<span class="line-added">717     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${RELAX_RELOCATIONS_FLAG}],</span>
<span class="line-added">718         IF_TRUE: [STATIC_LIBS_CFLAGS=&quot;$STATIC_LIBS_CFLAGS ${RELAX_RELOCATIONS_FLAG}&quot;])</span>
<span class="line-added">719   fi</span>
<span class="line-added">720   AC_SUBST(STATIC_LIBS_CFLAGS)</span>
721 ])
722 
723 ################################################################################
724 # $1 - Either BUILD or TARGET to pick the correct OS/CPU variables to check
725 #      conditionals against.
726 # $2 - Optional prefix for each variable defined.
727 # $3 - Optional prefix for compiler variables (either BUILD_ or nothing).
728 AC_DEFUN([FLAGS_SETUP_CFLAGS_CPU_DEP],
729 [
730   #### CPU DEFINES, these should (in theory) be independent on toolchain
731 
732   # Setup target CPU
733   # Setup endianness
734   if test &quot;x$FLAGS_CPU_ENDIAN&quot; = xlittle; then
735     $1_DEFINES_CPU_JVM=&quot;-DVM_LITTLE_ENDIAN&quot;
736   fi
737   if test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
738     # The macro _LITTLE_ENDIAN needs to be defined the same to avoid the
739     #   Sun C compiler warning message: warning: macro redefined: _LITTLE_ENDIAN
740     if test &quot;x$FLAGS_CPU_ENDIAN&quot; = xlittle; then
</pre>
<hr />
<pre>
798       $1_CFLAGS_CPU_JVM=&quot;-minsert-sched-nops=regroup_exact -mno-multiple -mno-string&quot;
799       if test &quot;x$FLAGS_CPU&quot; = xppc64; then
800         # -mminimal-toc fixes `relocation truncated to fit&#39; error for gcc 4.1.
801         # Use ppc64 instructions, but schedule for power5
802         $1_CFLAGS_CPU_JVM=&quot;${$1_CFLAGS_CPU_JVM} -mminimal-toc -mcpu=powerpc64 -mtune=power5&quot;
803       elif test &quot;x$FLAGS_CPU&quot; = xppc64le; then
804         # Little endian machine uses ELFv2 ABI.
805         # Use Power8, this is the first CPU to support PPC64 LE with ELFv2 ABI.
806         $1_CFLAGS_CPU_JVM=&quot;${$1_CFLAGS_CPU_JVM} -DABI_ELFv2 -mcpu=power8 -mtune=power8&quot;
807       fi
808     elif test &quot;x$FLAGS_CPU&quot; = xs390x; then
809       $1_CFLAGS_CPU=&quot;-mbackchain -march=z10&quot;
810     fi
811 
812     if test &quot;x$FLAGS_CPU_ARCH&quot; != xarm &amp;&amp;  test &quot;x$FLAGS_CPU_ARCH&quot; != xppc; then
813       # for all archs except arm and ppc, prevent gcc to omit frame pointer
814       $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
815     fi
816 
817     $1_CXXSTD_CXXFLAG=&quot;-std=gnu++98&quot;
<span class="line-modified">818     FLAGS_CXX_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${$1_CXXSTD_CXXFLAG}],</span>
819         PREFIX: $3, IF_FALSE: [$1_CXXSTD_CXXFLAG=&quot;&quot;])
820     $1_TOOLCHAIN_CFLAGS_JDK_CXXONLY=&quot;${$1_CXXSTD_CXXFLAG}&quot;
821     $1_TOOLCHAIN_CFLAGS_JVM=&quot;${$1_TOOLCHAIN_CFLAGS_JVM} ${$1_CXXSTD_CXXFLAG}&quot;
822     $2ADLC_CXXFLAG=&quot;${$1_CXXSTD_CXXFLAG}&quot;
823 
824   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
825     if test &quot;x$FLAGS_OS&quot; = xlinux; then
826       # ppc test not really needed for clang
827       if test &quot;x$FLAGS_CPU_ARCH&quot; != xarm &amp;&amp;  test &quot;x$FLAGS_CPU_ARCH&quot; != xppc; then
828         # for all archs except arm and ppc, prevent gcc to omit frame pointer
829         $1_CFLAGS_CPU_JDK=&quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&quot;
830       fi
831     fi
832 
833   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xsolstudio; then
834     if test &quot;x$FLAGS_CPU&quot; = xx86_64; then
835       # NOTE: -xregs=no%frameptr is supposed to be default on x64
836       $1_CFLAGS_CPU_JDK=&quot;-xregs=no%frameptr&quot;
837     elif test &quot;x$FLAGS_CPU&quot; = xsparcv9; then
838       $1_CFLAGS_CPU_JVM=&quot;-xarch=sparc&quot;
</pre>
<hr />
<pre>
846 
847   elif test &quot;x$TOOLCHAIN_TYPE&quot; = xmicrosoft; then
848     if test &quot;x$FLAGS_CPU&quot; = xx86; then
849       $1_CFLAGS_CPU_JVM=&quot;-arch:IA32&quot;
850     elif test &quot;x$OPENJDK_TARGET_CPU&quot; = xx86_64; then
851       if test &quot;x$DEBUG_LEVEL&quot; != xrelease; then
852         # NOTE: This is probably redundant; -homeparams is default on
853         # non-release builds.
854         $1_CFLAGS_CPU_JVM=&quot;-homeparams&quot;
855       fi
856     fi
857   fi
858 
859   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc; then
860     FLAGS_SETUP_GCC6_COMPILER_FLAGS($1, $3)
861     $1_TOOLCHAIN_CFLAGS=&quot;${$1_GCC6_CFLAGS}&quot;
862 
863     $1_WARNING_CFLAGS_JVM=&quot;-Wno-format-zero-length -Wtype-limits -Wuninitialized&quot;
864   fi
865 
<span class="line-added">866   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then</span>
<span class="line-added">867     # Check if compiler supports -fmacro-prefix-map. If so, use that to make</span>
<span class="line-added">868     # the __FILE__ macro resolve to paths relative to the workspace root.</span>
<span class="line-added">869     workspace_root_trailing_slash=&quot;${WORKSPACE_ROOT%/}/&quot;</span>
<span class="line-added">870     FILE_MACRO_CFLAGS=&quot;-fmacro-prefix-map=${workspace_root_trailing_slash}=&quot;</span>
<span class="line-added">871     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${FILE_MACRO_CFLAGS}],</span>
<span class="line-added">872         PREFIX: $3,</span>
<span class="line-added">873         IF_FALSE: [</span>
<span class="line-added">874             FILE_MACRO_CFLAGS=</span>
<span class="line-added">875         ]</span>
<span class="line-added">876     )</span>
<span class="line-added">877   fi</span>
<span class="line-added">878 </span>
879   # EXPORT to API
880   CFLAGS_JVM_COMMON=&quot;$ALWAYS_CFLAGS_JVM $ALWAYS_DEFINES_JVM \
881       $TOOLCHAIN_CFLAGS_JVM ${$1_TOOLCHAIN_CFLAGS_JVM} \
882       $OS_CFLAGS $OS_CFLAGS_JVM $CFLAGS_OS_DEF_JVM $DEBUG_CFLAGS_JVM \
<span class="line-modified">883       $WARNING_CFLAGS $WARNING_CFLAGS_JVM $JVM_PICFLAG $FILE_MACRO_CFLAGS&quot;</span>
884 
885   CFLAGS_JDK_COMMON=&quot;$ALWAYS_CFLAGS_JDK $ALWAYS_DEFINES_JDK $TOOLCHAIN_CFLAGS_JDK \
886       $OS_CFLAGS $CFLAGS_OS_DEF_JDK $DEBUG_CFLAGS_JDK $DEBUG_OPTIONS_FLAGS_JDK \
<span class="line-modified">887       $WARNING_CFLAGS $WARNING_CFLAGS_JDK $DEBUG_SYMBOLS_CFLAGS_JDK \</span>
<span class="line-added">888       $FILE_MACRO_CFLAGS&quot;</span>
889 
890   # Use ${$2EXTRA_CFLAGS} to block EXTRA_CFLAGS to be added to build flags.
891   # (Currently we don&#39;t have any OPENJDK_BUILD_EXTRA_CFLAGS, but that might
892   # change in the future.)
893 
894   CFLAGS_JDK_COMMON_CONLY=&quot;$TOOLCHAIN_CFLAGS_JDK_CONLY  \
895       $WARNING_CFLAGS_JDK_CONLY ${$2EXTRA_CFLAGS}&quot;
896   CFLAGS_JDK_COMMON_CXXONLY=&quot;$ALWAYS_DEFINES_JDK_CXXONLY \
897       $TOOLCHAIN_CFLAGS_JDK_CXXONLY \
898       ${$1_TOOLCHAIN_CFLAGS_JDK_CXXONLY} \
899       $WARNING_CFLAGS_JDK_CXXONLY ${$2EXTRA_CXXFLAGS}&quot;
900 
901   $1_CFLAGS_JVM=&quot;${$1_DEFINES_CPU_JVM} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JVM} ${$1_TOOLCHAIN_CFLAGS} ${$1_WARNING_CFLAGS_JVM}&quot;
902   $1_CFLAGS_JDK=&quot;${$1_DEFINES_CPU_JDK} ${$1_CFLAGS_CPU} ${$1_CFLAGS_CPU_JDK} ${$1_TOOLCHAIN_CFLAGS}&quot;
903 
904   $2JVM_CFLAGS=&quot;$CFLAGS_JVM_COMMON ${$1_CFLAGS_JVM} ${$2EXTRA_CXXFLAGS}&quot;
905 
906   $2CFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CONLY ${$1_CFLAGS_JDK}&quot;
907   $2CXXFLAGS_JDKEXE=&quot;$CFLAGS_JDK_COMMON $CFLAGS_JDK_COMMON_CXXONLY ${$1_CFLAGS_JDK}&quot;
908   $2CFLAGS_JDKLIB=&quot;${$2CFLAGS_JDKEXE} $JDK_PICFLAG ${$1_CFLAGS_CPU_JDK_LIBONLY}&quot;
</pre>
<hr />
<pre>
925   if test &quot;x$TOOLCHAIN_TYPE&quot; = xgcc || test &quot;x$TOOLCHAIN_TYPE&quot; = xclang; then
926     FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${COMPILER_FP_CONTRACT_OFF_FLAG}],
927         PREFIX: $3,
928         IF_TRUE: [$2FDLIBM_CFLAGS=${COMPILER_FP_CONTRACT_OFF_FLAG}],
929         IF_FALSE: [$2FDLIBM_CFLAGS=&quot;&quot;])
930   fi
931   AC_SUBST($2FDLIBM_CFLAGS)
932 ])
933 
934 # FLAGS_SETUP_GCC6_COMPILER_FLAGS([PREFIX])
935 # Arguments:
936 # $1 - Prefix for each variable defined.
937 # $2 - Prefix for compiler variables (either BUILD_ or nothing).
938 AC_DEFUN([FLAGS_SETUP_GCC6_COMPILER_FLAGS],
939 [
940   # These flags are required for GCC 6 builds as undefined behaviour in OpenJDK code
941   # runs afoul of the more aggressive versions of these optimisations.
942   # Notably, value range propagation now assumes that the this pointer of C++
943   # member functions is non-null.
944   NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;-fno-delete-null-pointer-checks&quot;
<span class="line-modified">945   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_DELETE_NULL_POINTER_CHECKS_CFLAG],</span>
946       PREFIX: $2, IF_FALSE: [NO_DELETE_NULL_POINTER_CHECKS_CFLAG=&quot;&quot;])
947   NO_LIFETIME_DSE_CFLAG=&quot;-fno-lifetime-dse&quot;
<span class="line-modified">948   FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [$NO_LIFETIME_DSE_CFLAG],</span>
949       PREFIX: $2, IF_FALSE: [NO_LIFETIME_DSE_CFLAG=&quot;&quot;])
950   $1_GCC6_CFLAGS=&quot;${NO_DELETE_NULL_POINTER_CHECKS_CFLAG} ${NO_LIFETIME_DSE_CFLAG}&quot;
951 ])
952 
953 # Documentation on common flags used for solstudio in HIGHEST.
954 #
955 # WARNING: Use of OPTIMIZATION_LEVEL=HIGHEST in your Makefile needs to be
956 #          done with care, there are some assumptions below that need to
957 #          be understood about the use of pointers, and IEEE behavior.
958 #
959 # -fns: Use non-standard floating point mode (not IEEE 754)
960 # -fsimple: Do some simplification of floating point arithmetic (not IEEE 754)
961 # -fsingle: Use single precision floating point with &#39;float&#39;
962 # -xalias_level=basic: Assume memory references via basic pointer types do not alias
963 #   (Source with excessing pointer casting and data access with mixed
964 #    pointer types are not recommended)
965 # -xbuiltin=%all: Use intrinsic or inline versions for math/std functions
966 #   (If you expect perfect errno behavior, do not use this)
967 # -xdepend: Loop data dependency optimizations (need -xO3 or higher)
968 # -xrestrict: Pointer parameters to functions do not overlap
</pre>
</td>
</tr>
</table>
<center><a href="configure.ac.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="flags-ldflags.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>