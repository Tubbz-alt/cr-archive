<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/autoconf/flags.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="flags-other.m4.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="help.m4.udiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/flags.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  #
<span class="udiff-line-modified-removed">- # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+ # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -47,11 +47,11 @@</span>
      AC_MSG_RESULT([$OPENJDK_TARGET_ABI_PROFILE])
  
      # --- Arm-sflt CFLAGS and ASFLAGS ---
      # Armv5te is required for assembler, because pld insn used in arm32 hotspot is only in v5E and above.
      # However, there is also a GCC bug which generates unaligned strd/ldrd instructions on armv5te:
<span class="udiff-line-modified-removed">-     # https://gcc.gnu.org/bugzilla/show_bug.cgi?id=82445, and it was fixed only quite recently.</span>
<span class="udiff-line-modified-added">+     # https://gcc.gnu.org/bugzilla/show_bug.cgi?id=82445, and it was fixed in gcc 7.1.</span>
      # The resulting compromise is to enable v5TE for assembler and let GCC generate code for v5T.
      if test &quot;x$OPENJDK_TARGET_ABI_PROFILE&quot; = xarm-vfp-sflt; then
        ARM_FLOAT_TYPE=vfp-sflt
        ARM_ARCH_TYPE_FLAGS=&#39;-march=armv7-a -mthumb&#39;
        ARM_ARCH_TYPE_ASFLAGS=&#39;-march=armv7-a -mthumb&#39;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -174,22 +174,30 @@</span>
  
    if test &quot;x$LDFLAGS&quot; != &quot;x&quot;; then
      AC_MSG_WARN([Ignoring LDFLAGS($LDFLAGS) found in environment. Use --with-extra-ldflags])
    fi
  
<span class="udiff-line-added">+   if test &quot;x$ASFLAGS&quot; != &quot;x&quot;; then</span>
<span class="udiff-line-added">+     AC_MSG_WARN([Ignoring ASFLAGS($ASFLAGS) found in environment. Use --with-extra-asflags])</span>
<span class="udiff-line-added">+   fi</span>
<span class="udiff-line-added">+ </span>
    AC_ARG_WITH(extra-cflags, [AS_HELP_STRING([--with-extra-cflags],
        [extra flags to be used when compiling jdk c-files])])
  
    AC_ARG_WITH(extra-cxxflags, [AS_HELP_STRING([--with-extra-cxxflags],
        [extra flags to be used when compiling jdk c++-files])])
  
    AC_ARG_WITH(extra-ldflags, [AS_HELP_STRING([--with-extra-ldflags],
        [extra flags to be used when linking jdk])])
  
<span class="udiff-line-added">+   AC_ARG_WITH(extra-asflags, [AS_HELP_STRING([--with-extra-asflags],</span>
<span class="udiff-line-added">+       [extra flags to be passed to the assembler])])</span>
<span class="udiff-line-added">+ </span>
    USER_CFLAGS=&quot;$with_extra_cflags&quot;
    USER_CXXFLAGS=&quot;$with_extra_cxxflags&quot;
    USER_LDFLAGS=&quot;$with_extra_ldflags&quot;
<span class="udiff-line-added">+   USER_ASFLAGS=&quot;$with_extra_asflags&quot;</span>
  ])
  
  # Setup the sysroot flags and add them to global CFLAGS and LDFLAGS so
  # that configure can use them while detecting compilers.
  # TOOLCHAIN_TYPE is available here.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -278,14 +286,16 @@</span>
  
    # FIXME: For compatilibity, export this as EXTRA_CFLAGS for now.
    EXTRA_CFLAGS=&quot;$MACHINE_FLAG $USER_CFLAGS&quot;
    EXTRA_CXXFLAGS=&quot;$MACHINE_FLAG $USER_CXXFLAGS&quot;
    EXTRA_LDFLAGS=&quot;$MACHINE_FLAG $USER_LDFLAGS&quot;
<span class="udiff-line-added">+   EXTRA_ASFLAGS=&quot;$USER_ASFLAGS&quot;</span>
  
    AC_SUBST(EXTRA_CFLAGS)
    AC_SUBST(EXTRA_CXXFLAGS)
    AC_SUBST(EXTRA_LDFLAGS)
<span class="udiff-line-added">+   AC_SUBST(EXTRA_ASFLAGS)</span>
  
    # For autoconf testing to work, the global flags must also be stored in the
    # &quot;unnamed&quot; CFLAGS etc.
    CFLAGS=&quot;$GLOBAL_CFLAGS&quot;
    CXXFLAGS=&quot;$GLOBAL_CXXFLAGS&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -426,11 +436,11 @@</span>
    AC_MSG_CHECKING([if ARG_PREFIX[CC] supports &quot;ARG_ARGUMENT&quot;])
    supports=yes
  
    saved_cflags=&quot;$CFLAGS&quot;
    saved_cc=&quot;$CC&quot;
<span class="udiff-line-modified-removed">-   CFLAGS=&quot;$CFLAGS ARG_ARGUMENT&quot;</span>
<span class="udiff-line-modified-added">+   CFLAGS=&quot;$CFLAGS $CFLAGS_WARNINGS_ARE_ERRORS ARG_ARGUMENT&quot;</span>
    CC=&quot;$ARG_PREFIX[CC]&quot;
    AC_LANG_PUSH([C])
    AC_COMPILE_IFELSE([AC_LANG_SOURCE([[int i;]])], [],
        [supports=no])
    AC_LANG_POP([C])
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -457,11 +467,11 @@</span>
    AC_MSG_CHECKING([if ARG_PREFIX[CXX] supports &quot;ARG_ARGUMENT&quot;])
    supports=yes
  
    saved_cxxflags=&quot;$CXXFLAGS&quot;
    saved_cxx=&quot;$CXX&quot;
<span class="udiff-line-modified-removed">-   CXXFLAGS=&quot;$CXXFLAG ARG_ARGUMENT&quot;</span>
<span class="udiff-line-modified-added">+   CXXFLAGS=&quot;$CXXFLAG $CFLAGS_WARNINGS_ARE_ERRORS ARG_ARGUMENT&quot;</span>
    CXX=&quot;$ARG_PREFIX[CXX]&quot;
    AC_LANG_PUSH([C++])
    AC_COMPILE_IFELSE([AC_LANG_SOURCE([[int i;]])], [],
        [supports=no])
    AC_LANG_POP([C++])
</pre>
<center><a href="flags-other.m4.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="help.m4.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>