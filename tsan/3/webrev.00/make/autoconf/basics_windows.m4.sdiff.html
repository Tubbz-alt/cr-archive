<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/autoconf/basics_windows.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="basics.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="boot-jdk.m4.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/autoconf/basics_windows.m4</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
131         | $SED -e &#39;s|\r||g&#39; \
132         | $TR \\\\\\\\ / | $TR &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39; &#39;abcdefghijklmnopqrstuvwxyz&#39;`
133     # Rewrite back to unix style
134     BASIC_WINDOWS_REWRITE_AS_UNIX_PATH([new_path])
135   fi
136 ])
137 
138 # FIXME: The BASIC_FIXUP_*_CYGWIN/MSYS is most likely too convoluted
139 # and could probably be heavily simplified. However, all changes in this
140 # area tend to need lot of testing in different scenarios, and in lack of
141 # proper unit testing, cleaning this up has not been deemed worth the effort
142 # at the moment.
143 
144 AC_DEFUN([BASIC_FIXUP_PATH_CYGWIN],
145 [
146   # Input might be given as Windows format, start by converting to
147   # unix format.
148   path=&quot;[$]$1&quot;
149   new_path=`$CYGPATH -u &quot;$path&quot;`
150 


151   # Cygwin tries to hide some aspects of the Windows file system, such that binaries are
152   # named .exe but called without that suffix. Therefore, &quot;foo&quot; and &quot;foo.exe&quot; are considered
153   # the same file, most of the time (as in &quot;test -f&quot;). But not when running cygpath -s, then
154   # &quot;foo.exe&quot; is OK but &quot;foo&quot; is an error.
155   #
156   # This test is therefore slightly more accurate than &quot;test -f&quot; to check for file precense.
157   # It is also a way to make sure we got the proper file name for the real test later on.
158   test_shortpath=`$CYGPATH -s -m &quot;$new_path&quot; 2&gt; /dev/null`
159   if test &quot;x$test_shortpath&quot; = x; then
160     AC_MSG_NOTICE([The path of $1, which resolves as &quot;$path&quot;, is invalid.])
161     AC_MSG_ERROR([Cannot locate the the path of $1])
162   fi
163 
164   # Call helper function which possibly converts this using DOS-style short mode.
165   # If so, the updated path is stored in $new_path.
166   BASIC_MAKE_WINDOWS_SPACE_SAFE_CYGWIN([$new_path])
167 
168   if test &quot;x$path&quot; != &quot;x$new_path&quot;; then
169     $1=&quot;$new_path&quot;
170     AC_MSG_NOTICE([Rewriting $1 to &quot;$new_path&quot;])
171   fi
172 ])
173 
174 AC_DEFUN([BASIC_FIXUP_PATH_MSYS],
175 [
176   path=&quot;[$]$1&quot;
177   has_colon=`$ECHO $path | $GREP ^.:`
178   new_path=&quot;$path&quot;
179   if test &quot;x$has_colon&quot; = x; then
180     # Not in mixed or Windows style, start by that.
181     new_path=`cmd //c echo $path`
182   fi
183 


184   BASIC_MAKE_WINDOWS_SPACE_SAFE_MSYS([$new_path])
185   BASIC_WINDOWS_REWRITE_AS_UNIX_PATH(new_path)
186   if test &quot;x$path&quot; != &quot;x$new_path&quot;; then
187     $1=&quot;$new_path&quot;
188     AC_MSG_NOTICE([Rewriting $1 to &quot;$new_path&quot;])
189   fi
190 
191   # Save the first 10 bytes of this path to the storage, so fixpath can work.
192   all_fixpath_prefixes=(&quot;${all_fixpath_prefixes@&lt;:@@@:&gt;@}&quot; &quot;${new_path:0:10}&quot;)
193 ])
194 
195 AC_DEFUN([BASIC_FIXUP_PATH_WSL],
196 [
197   # Input might be given as Windows format, start by converting to
198   # unix format.
199   new_path=&quot;[$]$1&quot;
200   BASIC_WINDOWS_REWRITE_AS_UNIX_PATH([new_path])
201 


202   # Call helper function which possibly converts this using DOS-style short mode.
203   # If so, the updated path is stored in $new_path.
204   BASIC_MAKE_WINDOWS_SPACE_SAFE_WSL([$new_path])
205 
206   if test &quot;x$path&quot; != &quot;x$new_path&quot;; then
207     $1=&quot;$new_path&quot;
208     AC_MSG_NOTICE([Rewriting $1 to &quot;$new_path&quot;])
209   fi
210 ])
211 
212 AC_DEFUN([BASIC_FIXUP_EXECUTABLE_CYGWIN],
213 [
214   # First separate the path from the arguments. This will split at the first
215   # space.
216   complete=&quot;[$]$1&quot;
217   path=&quot;${complete%% *}&quot;
218   tmp=&quot;$complete EOL&quot;
219   arguments=&quot;${tmp#* }&quot;
220 
221   # Input might be given as Windows format, start by converting to
</pre>
<hr />
<pre>
534       # Important to keep the .exe suffix on Cygwin for Hotspot makefiles
535       FIXPATH=&quot;$FIXPATH_BIN -c&quot;
536     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = xwindows.msys; then
537       # Take all collected prefixes and turn them into a -m/c/foo@/c/bar@... command line
538       # @ was chosen as separator to minimize risk of other tools messing around with it
539       all_unique_prefixes=`echo &quot;${all_fixpath_prefixes@&lt;:@@@:&gt;@}&quot; \
540           | tr &#39; &#39; &#39;\n&#39; | $GREP &#39;^/./&#39; | $SORT | $UNIQ`
541       fixpath_argument_list=`echo $all_unique_prefixes  | tr &#39; &#39; &#39;@&#39;`
542       FIXPATH=&quot;$FIXPATH_BIN -m$fixpath_argument_list&quot;
543     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = xwindows.wsl; then
544       FIXPATH=&quot;$FIXPATH_BIN -w&quot;
545     fi
546     FIXPATH_SRC_W=&quot;$FIXPATH_SRC&quot;
547     FIXPATH_BIN_W=&quot;$FIXPATH_BIN&quot;
548     BASIC_WINDOWS_REWRITE_AS_WINDOWS_MIXED_PATH([FIXPATH_SRC_W])
549     BASIC_WINDOWS_REWRITE_AS_WINDOWS_MIXED_PATH([FIXPATH_BIN_W])
550     $RM -rf $FIXPATH_BIN $FIXPATH_DIR
551     $MKDIR -p $FIXPATH_DIR $CONFIGURESUPPORT_OUTPUTDIR/bin
552     cd $FIXPATH_DIR
553     $CC $FIXPATH_SRC_W -Fe$FIXPATH_BIN_W &gt; $FIXPATH_DIR/fixpath1.log 2&gt;&amp;1
<span class="line-modified">554     cd $CURDIR</span>
555 
556     if test ! -x $FIXPATH_BIN; then
557       AC_MSG_RESULT([no])
558       cat $FIXPATH_DIR/fixpath1.log
559       AC_MSG_ERROR([Could not create $FIXPATH_BIN])
560     fi
561     AC_MSG_RESULT([yes])
562 
563     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
564       OLD_WSLENV=&quot;$WSLENV&quot;
565       WSLENV=`$ECHO $WSLENV | $SED &#39;s/PATH\/l://&#39;`
566       BASIC_APPEND_TO_PATH(WSLENV, &quot;FIXPATH_PATH&quot;)
567       export WSLENV
568       export FIXPATH_PATH=$VS_PATH_WINDOWS
569       AC_MSG_NOTICE([FIXPATH_PATH is $FIXPATH_PATH])
570       AC_MSG_NOTICE([Rewriting WSLENV from $OLD_WSLENV to $WSLENV])
571     fi
572 
573     AC_MSG_CHECKING([if fixpath.exe works])
574     cd $FIXPATH_DIR
575     $FIXPATH $CC $FIXPATH_SRC -Fe$FIXPATH_DIR/fixpath2.exe \
576         &gt; $FIXPATH_DIR/fixpath2.log 2&gt;&amp;1
<span class="line-modified">577     cd $CURDIR</span>
578     if test ! -x $FIXPATH_DIR/fixpath2.exe; then
579       AC_MSG_RESULT([no])
580       cat $FIXPATH_DIR/fixpath2.log
581       AC_MSG_ERROR([fixpath did not work!])
582     fi
583     AC_MSG_RESULT([yes])
584 
585     FIXPATH_DETACH_FLAG=&quot;--detach&quot;
586   fi
587 
588   AC_SUBST(FIXPATH)
589   AC_SUBST(FIXPATH_DETACH_FLAG)
590 ])
</pre>
</td>
<td>
<hr />
<pre>
131         | $SED -e &#39;s|\r||g&#39; \
132         | $TR \\\\\\\\ / | $TR &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39; &#39;abcdefghijklmnopqrstuvwxyz&#39;`
133     # Rewrite back to unix style
134     BASIC_WINDOWS_REWRITE_AS_UNIX_PATH([new_path])
135   fi
136 ])
137 
138 # FIXME: The BASIC_FIXUP_*_CYGWIN/MSYS is most likely too convoluted
139 # and could probably be heavily simplified. However, all changes in this
140 # area tend to need lot of testing in different scenarios, and in lack of
141 # proper unit testing, cleaning this up has not been deemed worth the effort
142 # at the moment.
143 
144 AC_DEFUN([BASIC_FIXUP_PATH_CYGWIN],
145 [
146   # Input might be given as Windows format, start by converting to
147   # unix format.
148   path=&quot;[$]$1&quot;
149   new_path=`$CYGPATH -u &quot;$path&quot;`
150 
<span class="line-added">151   BASIC_ABSOLUTE_PATH(new_path)</span>
<span class="line-added">152 </span>
153   # Cygwin tries to hide some aspects of the Windows file system, such that binaries are
154   # named .exe but called without that suffix. Therefore, &quot;foo&quot; and &quot;foo.exe&quot; are considered
155   # the same file, most of the time (as in &quot;test -f&quot;). But not when running cygpath -s, then
156   # &quot;foo.exe&quot; is OK but &quot;foo&quot; is an error.
157   #
158   # This test is therefore slightly more accurate than &quot;test -f&quot; to check for file precense.
159   # It is also a way to make sure we got the proper file name for the real test later on.
160   test_shortpath=`$CYGPATH -s -m &quot;$new_path&quot; 2&gt; /dev/null`
161   if test &quot;x$test_shortpath&quot; = x; then
162     AC_MSG_NOTICE([The path of $1, which resolves as &quot;$path&quot;, is invalid.])
163     AC_MSG_ERROR([Cannot locate the the path of $1])
164   fi
165 
166   # Call helper function which possibly converts this using DOS-style short mode.
167   # If so, the updated path is stored in $new_path.
168   BASIC_MAKE_WINDOWS_SPACE_SAFE_CYGWIN([$new_path])
169 
170   if test &quot;x$path&quot; != &quot;x$new_path&quot;; then
171     $1=&quot;$new_path&quot;
172     AC_MSG_NOTICE([Rewriting $1 to &quot;$new_path&quot;])
173   fi
174 ])
175 
176 AC_DEFUN([BASIC_FIXUP_PATH_MSYS],
177 [
178   path=&quot;[$]$1&quot;
179   has_colon=`$ECHO $path | $GREP ^.:`
180   new_path=&quot;$path&quot;
181   if test &quot;x$has_colon&quot; = x; then
182     # Not in mixed or Windows style, start by that.
183     new_path=`cmd //c echo $path`
184   fi
185 
<span class="line-added">186   BASIC_ABSOLUTE_PATH(new_path)</span>
<span class="line-added">187 </span>
188   BASIC_MAKE_WINDOWS_SPACE_SAFE_MSYS([$new_path])
189   BASIC_WINDOWS_REWRITE_AS_UNIX_PATH(new_path)
190   if test &quot;x$path&quot; != &quot;x$new_path&quot;; then
191     $1=&quot;$new_path&quot;
192     AC_MSG_NOTICE([Rewriting $1 to &quot;$new_path&quot;])
193   fi
194 
195   # Save the first 10 bytes of this path to the storage, so fixpath can work.
196   all_fixpath_prefixes=(&quot;${all_fixpath_prefixes@&lt;:@@@:&gt;@}&quot; &quot;${new_path:0:10}&quot;)
197 ])
198 
199 AC_DEFUN([BASIC_FIXUP_PATH_WSL],
200 [
201   # Input might be given as Windows format, start by converting to
202   # unix format.
203   new_path=&quot;[$]$1&quot;
204   BASIC_WINDOWS_REWRITE_AS_UNIX_PATH([new_path])
205 
<span class="line-added">206   BASIC_ABSOLUTE_PATH(new_path)</span>
<span class="line-added">207 </span>
208   # Call helper function which possibly converts this using DOS-style short mode.
209   # If so, the updated path is stored in $new_path.
210   BASIC_MAKE_WINDOWS_SPACE_SAFE_WSL([$new_path])
211 
212   if test &quot;x$path&quot; != &quot;x$new_path&quot;; then
213     $1=&quot;$new_path&quot;
214     AC_MSG_NOTICE([Rewriting $1 to &quot;$new_path&quot;])
215   fi
216 ])
217 
218 AC_DEFUN([BASIC_FIXUP_EXECUTABLE_CYGWIN],
219 [
220   # First separate the path from the arguments. This will split at the first
221   # space.
222   complete=&quot;[$]$1&quot;
223   path=&quot;${complete%% *}&quot;
224   tmp=&quot;$complete EOL&quot;
225   arguments=&quot;${tmp#* }&quot;
226 
227   # Input might be given as Windows format, start by converting to
</pre>
<hr />
<pre>
540       # Important to keep the .exe suffix on Cygwin for Hotspot makefiles
541       FIXPATH=&quot;$FIXPATH_BIN -c&quot;
542     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = xwindows.msys; then
543       # Take all collected prefixes and turn them into a -m/c/foo@/c/bar@... command line
544       # @ was chosen as separator to minimize risk of other tools messing around with it
545       all_unique_prefixes=`echo &quot;${all_fixpath_prefixes@&lt;:@@@:&gt;@}&quot; \
546           | tr &#39; &#39; &#39;\n&#39; | $GREP &#39;^/./&#39; | $SORT | $UNIQ`
547       fixpath_argument_list=`echo $all_unique_prefixes  | tr &#39; &#39; &#39;@&#39;`
548       FIXPATH=&quot;$FIXPATH_BIN -m$fixpath_argument_list&quot;
549     elif test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = xwindows.wsl; then
550       FIXPATH=&quot;$FIXPATH_BIN -w&quot;
551     fi
552     FIXPATH_SRC_W=&quot;$FIXPATH_SRC&quot;
553     FIXPATH_BIN_W=&quot;$FIXPATH_BIN&quot;
554     BASIC_WINDOWS_REWRITE_AS_WINDOWS_MIXED_PATH([FIXPATH_SRC_W])
555     BASIC_WINDOWS_REWRITE_AS_WINDOWS_MIXED_PATH([FIXPATH_BIN_W])
556     $RM -rf $FIXPATH_BIN $FIXPATH_DIR
557     $MKDIR -p $FIXPATH_DIR $CONFIGURESUPPORT_OUTPUTDIR/bin
558     cd $FIXPATH_DIR
559     $CC $FIXPATH_SRC_W -Fe$FIXPATH_BIN_W &gt; $FIXPATH_DIR/fixpath1.log 2&gt;&amp;1
<span class="line-modified">560     cd $CONFIGURE_START_DIR</span>
561 
562     if test ! -x $FIXPATH_BIN; then
563       AC_MSG_RESULT([no])
564       cat $FIXPATH_DIR/fixpath1.log
565       AC_MSG_ERROR([Could not create $FIXPATH_BIN])
566     fi
567     AC_MSG_RESULT([yes])
568 
569     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
570       OLD_WSLENV=&quot;$WSLENV&quot;
571       WSLENV=`$ECHO $WSLENV | $SED &#39;s/PATH\/l://&#39;`
572       BASIC_APPEND_TO_PATH(WSLENV, &quot;FIXPATH_PATH&quot;)
573       export WSLENV
574       export FIXPATH_PATH=$VS_PATH_WINDOWS
575       AC_MSG_NOTICE([FIXPATH_PATH is $FIXPATH_PATH])
576       AC_MSG_NOTICE([Rewriting WSLENV from $OLD_WSLENV to $WSLENV])
577     fi
578 
579     AC_MSG_CHECKING([if fixpath.exe works])
580     cd $FIXPATH_DIR
581     $FIXPATH $CC $FIXPATH_SRC -Fe$FIXPATH_DIR/fixpath2.exe \
582         &gt; $FIXPATH_DIR/fixpath2.log 2&gt;&amp;1
<span class="line-modified">583     cd $CONFIGURE_START_DIR</span>
584     if test ! -x $FIXPATH_DIR/fixpath2.exe; then
585       AC_MSG_RESULT([no])
586       cat $FIXPATH_DIR/fixpath2.log
587       AC_MSG_ERROR([fixpath did not work!])
588     fi
589     AC_MSG_RESULT([yes])
590 
591     FIXPATH_DETACH_FLAG=&quot;--detach&quot;
592   fi
593 
594   AC_SUBST(FIXPATH)
595   AC_SUBST(FIXPATH_DETACH_FLAG)
596 ])
</pre>
</td>
</tr>
</table>
<center><a href="basics.m4.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="boot-jdk.m4.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>