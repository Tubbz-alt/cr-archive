<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old make/autoconf/toolchain_windows.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 #
  2 # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ################################################################################
 27 # The order of these defines the priority by which we try to find them.
 28 VALID_VS_VERSIONS=&quot;2017 2013 2015 2012 2010&quot;
 29 
 30 VS_DESCRIPTION_2010=&quot;Microsoft Visual Studio 2010&quot;
 31 VS_VERSION_INTERNAL_2010=100
 32 VS_MSVCR_2010=msvcr100.dll
 33 # We don&#39;t use msvcp on Visual Studio 2010
 34 #VS_MSVCP_2010=msvcp100.dll
 35 VS_ENVVAR_2010=&quot;VS100COMNTOOLS&quot;
 36 VS_VS_INSTALLDIR_2010=&quot;Microsoft Visual Studio 10.0&quot;
 37 VS_SDK_INSTALLDIR_2010=&quot;Microsoft SDKs/Windows/v7.1&quot;
 38 VS_VS_PLATFORM_NAME_2010=&quot;v100&quot;
 39 VS_SDK_PLATFORM_NAME_2010=&quot;Windows7.1SDK&quot;
 40 VS_SUPPORTED_2010=false
 41 
 42 VS_DESCRIPTION_2012=&quot;Microsoft Visual Studio 2012&quot;
 43 VS_VERSION_INTERNAL_2012=110
 44 VS_MSVCR_2012=msvcr110.dll
 45 VS_MSVCP_2012=msvcp110.dll
 46 VS_ENVVAR_2012=&quot;VS110COMNTOOLS&quot;
 47 VS_VS_INSTALLDIR_2012=&quot;Microsoft Visual Studio 11.0&quot;
 48 VS_SDK_INSTALLDIR_2012=
 49 VS_VS_PLATFORM_NAME_2012=&quot;v110&quot;
 50 VS_SDK_PLATFORM_NAME_2012=
 51 VS_SUPPORTED_2012=false
 52 
 53 VS_DESCRIPTION_2013=&quot;Microsoft Visual Studio 2013&quot;
 54 VS_VERSION_INTERNAL_2013=120
 55 VS_MSVCR_2013=msvcr120.dll
 56 VS_MSVCP_2013=msvcp120.dll
 57 VS_ENVVAR_2013=&quot;VS120COMNTOOLS&quot;
 58 VS_VS_INSTALLDIR_2013=&quot;Microsoft Visual Studio 12.0&quot;
 59 VS_SDK_INSTALLDIR_2013=
 60 VS_VS_PLATFORM_NAME_2013=&quot;v120&quot;
 61 VS_SDK_PLATFORM_NAME_2013=
 62 VS_SUPPORTED_2013=false
 63 
 64 VS_DESCRIPTION_2015=&quot;Microsoft Visual Studio 2015&quot;
 65 VS_VERSION_INTERNAL_2015=140
 66 VS_MSVCR_2015=vcruntime140.dll
 67 VS_MSVCP_2015=msvcp140.dll
 68 VS_ENVVAR_2015=&quot;VS140COMNTOOLS&quot;
 69 VS_VS_INSTALLDIR_2015=&quot;Microsoft Visual Studio 14.0&quot;
 70 VS_SDK_INSTALLDIR_2015=
 71 VS_VS_PLATFORM_NAME_2015=&quot;v140&quot;
 72 VS_SDK_PLATFORM_NAME_2015=
 73 # The vcvars of 2015 breaks if 2017 is also installed. Work around this by
 74 # explicitly specifying Windows Kit 8.1 to be used.
 75 VS_ENV_ARGS_2015=&quot;8.1&quot;
 76 VS_SUPPORTED_2015=false
 77 
 78 VS_DESCRIPTION_2017=&quot;Microsoft Visual Studio 2017&quot;
 79 VS_VERSION_INTERNAL_2017=141
 80 VS_MSVCR_2017=vcruntime140.dll
 81 VS_MSVCP_2017=msvcp140.dll
 82 VS_ENVVAR_2017=&quot;VS150COMNTOOLS&quot;
 83 VS_USE_UCRT_2017=&quot;true&quot;
 84 VS_VS_INSTALLDIR_2017=&quot;Microsoft Visual Studio/2017&quot;
 85 VS_EDITIONS_2017=&quot;BuildTools Community Professional Enterprise&quot;
 86 VS_SDK_INSTALLDIR_2017=
 87 VS_VS_PLATFORM_NAME_2017=&quot;v141&quot;
 88 VS_SDK_PLATFORM_NAME_2017=
 89 VS_SUPPORTED_2017=true
 90 
 91 ################################################################################
 92 
 93 AC_DEFUN([TOOLCHAIN_CHECK_POSSIBLE_VISUAL_STUDIO_ROOT],
 94 [
 95   if test &quot;x$VS_ENV_CMD&quot; = x; then
 96     VS_VERSION=&quot;$1&quot;
 97     VS_BASE=&quot;$2&quot;
 98     METHOD=&quot;$3&quot;
 99 
100     BASIC_WINDOWS_REWRITE_AS_UNIX_PATH(VS_BASE)
101     # In VS 2017, the default installation is in a subdir named after the edition.
102     # Find the first one present and use that.
103     if test &quot;x$VS_EDITIONS&quot; != x; then
104       for edition in $VS_EDITIONS; do
105         if test -d &quot;$VS_BASE/$edition&quot;; then
106           VS_BASE=&quot;$VS_BASE/$edition&quot;
107           break
108         fi
109       done
110     fi
111 
112     if test -d &quot;$VS_BASE&quot;; then
113       AC_MSG_NOTICE([Found Visual Studio installation at $VS_BASE using $METHOD])
114       if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x32; then
115         VCVARSFILES=&quot;vc/bin/vcvars32.bat vc/auxiliary/build/vcvars32.bat&quot;
116       else
117         VCVARSFILES=&quot;vc/bin/amd64/vcvars64.bat vc/bin/x86_amd64/vcvarsx86_amd64.bat \
118             VC/Auxiliary/Build/vcvarsx86_amd64.bat VC/Auxiliary/Build/vcvars64.bat&quot;
119       fi
120 
121       for VCVARSFILE in $VCVARSFILES; do
122         if test -f &quot;$VS_BASE/$VCVARSFILE&quot;; then
123           VS_ENV_CMD=&quot;$VS_BASE/$VCVARSFILE&quot;
124           break
125         fi
126       done
127 
128       if test &quot;x$VS_ENV_CMD&quot; = x; then
129         AC_MSG_NOTICE([Warning: None of $VCVARSFILES were found, Visual Studio installation not recognized. Ignoring])
130       else
131         # PLATFORM_TOOLSET is used during the compilation of the freetype sources
132         # (see &#39;LIB_BUILD_FREETYPE&#39; in libraries.m4) and must be one of &#39;v100&#39;,
133         # &#39;v110&#39; or &#39;v120&#39; for VS 2010, 2012 or VS2013
134         eval PLATFORM_TOOLSET=&quot;\${VS_VS_PLATFORM_NAME_${VS_VERSION}}&quot;
135       fi
136     fi
137   fi
138 ])
139 
140 ################################################################################
141 
142 AC_DEFUN([TOOLCHAIN_CHECK_POSSIBLE_WIN_SDK_ROOT],
143 [
144   if test &quot;x$VS_ENV_CMD&quot; = x; then
145     VS_VERSION=&quot;$1&quot;
146     WIN_SDK_BASE=&quot;$2&quot;
147     METHOD=&quot;$3&quot;
148     BASIC_WINDOWS_REWRITE_AS_UNIX_PATH(WIN_SDK_BASE)
149     if test -d &quot;$WIN_SDK_BASE&quot;; then
150       # There have been cases of partial or broken SDK installations. A missing
151       # lib dir is not going to work.
152       if test ! -d &quot;$WIN_SDK_BASE/lib&quot;; then
153         AC_MSG_NOTICE([Found Windows SDK installation at $WIN_SDK_BASE using $METHOD])
154         AC_MSG_NOTICE([Warning: Installation is broken, lib dir is missing. Ignoring])
155       elif test -f &quot;$WIN_SDK_BASE/Bin/SetEnv.Cmd&quot;; then
156         AC_MSG_NOTICE([Found Windows SDK installation at $WIN_SDK_BASE using $METHOD])
157         VS_ENV_CMD=&quot;$WIN_SDK_BASE/Bin/SetEnv.Cmd&quot;
158         if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x32; then
159           VS_ENV_ARGS=&quot;/x86&quot;
160         else
161           VS_ENV_ARGS=&quot;/x64&quot;
162         fi
163         # PLATFORM_TOOLSET is used during the compilation of the freetype sources (see
164         # &#39;LIB_BUILD_FREETYPE&#39; in libraries.m4) and must be &#39;Windows7.1SDK&#39; for Windows7.1SDK
165         # TODO: improve detection for other versions of SDK
166         eval PLATFORM_TOOLSET=&quot;\${VS_SDK_PLATFORM_NAME_${VS_VERSION}}&quot;
167       else
168         AC_MSG_NOTICE([Found Windows SDK installation at $WIN_SDK_BASE using $METHOD])
169         AC_MSG_NOTICE([Warning: Installation is broken, SetEnv.Cmd is missing. Ignoring])
170       fi
171     fi
172   fi
173 ])
174 
175 ################################################################################
176 # Finds the bat or cmd file in Visual Studio or the SDK that sets up a proper
177 # build environment and assigns it to VS_ENV_CMD
178 AC_DEFUN([TOOLCHAIN_FIND_VISUAL_STUDIO_BAT_FILE],
179 [
180   VS_VERSION=&quot;$1&quot;
181   eval VS_COMNTOOLS_VAR=&quot;\${VS_ENVVAR_${VS_VERSION}}&quot;
182   eval VS_COMNTOOLS=&quot;\$${VS_COMNTOOLS_VAR}&quot;
183   eval VS_INSTALL_DIR=&quot;\${VS_VS_INSTALLDIR_${VS_VERSION}}&quot;
184   eval VS_EDITIONS=&quot;\${VS_EDITIONS_${VS_VERSION}}&quot;
185   eval SDK_INSTALL_DIR=&quot;\${VS_SDK_INSTALLDIR_${VS_VERSION}}&quot;
186   eval VS_ENV_ARGS=&quot;\${VS_ENV_ARGS_${VS_VERSION}}&quot;
187 
188   # When using --with-tools-dir, assume it points to the correct and default
189   # version of Visual Studio or that --with-toolchain-version was also set.
190   if test &quot;x$with_tools_dir&quot; != x; then
191     TOOLCHAIN_CHECK_POSSIBLE_VISUAL_STUDIO_ROOT([${VS_VERSION}],
192         [$with_tools_dir/../..], [--with-tools-dir])
193     TOOLCHAIN_CHECK_POSSIBLE_VISUAL_STUDIO_ROOT([${VS_VERSION}],
194         [$with_tools_dir/../../..], [--with-tools-dir])
195     if test &quot;x$VS_ENV_CMD&quot; = x; then
196       # Having specified an argument which is incorrect will produce an instant failure;
197       # we should not go on looking
198       AC_MSG_NOTICE([The path given by --with-tools-dir does not contain a valid])
199       AC_MSG_NOTICE([Visual Studio installation. Please point to the VC/bin or VC/bin/amd64])
200       AC_MSG_NOTICE([directory within the Visual Studio installation])
201       AC_MSG_ERROR([Cannot locate a valid Visual Studio installation])
202     fi
203   fi
204 
205   VS_ENV_CMD=&quot;&quot;
206 
207   if test &quot;x$VS_COMNTOOLS&quot; != x; then
208     TOOLCHAIN_CHECK_POSSIBLE_VISUAL_STUDIO_ROOT([${VS_VERSION}],
209         [$VS_COMNTOOLS/../..], [$VS_COMNTOOLS_VAR variable])
210   fi
211   if test &quot;x$PROGRAMFILES&quot; != x; then
212     TOOLCHAIN_CHECK_POSSIBLE_VISUAL_STUDIO_ROOT([${VS_VERSION}],
213         [$PROGRAMFILES/$VS_INSTALL_DIR], [well-known name])
214   fi
215   # Work around the insanely named ProgramFiles(x86) env variable
216   PROGRAMFILES_X86=&quot;`env | $SED -n &#39;s/^ProgramFiles(x86)=//p&#39;`&quot;
217   if test &quot;x$PROGRAMFILES_X86&quot; != x; then
218     TOOLCHAIN_CHECK_POSSIBLE_VISUAL_STUDIO_ROOT([${VS_VERSION}],
219         [$PROGRAMFILES_X86/$VS_INSTALL_DIR], [well-known name])
220   fi
221   TOOLCHAIN_CHECK_POSSIBLE_VISUAL_STUDIO_ROOT([${VS_VERSION}],
222       [C:/Program Files/$VS_INSTALL_DIR], [well-known name])
223   TOOLCHAIN_CHECK_POSSIBLE_VISUAL_STUDIO_ROOT([${VS_VERSION}],
224       [C:/Program Files (x86)/$VS_INSTALL_DIR], [well-known name])
225   if test &quot;x$SDK_INSTALL_DIR&quot; != x; then
226     if test &quot;x$ProgramW6432&quot; != x; then
227       TOOLCHAIN_CHECK_POSSIBLE_WIN_SDK_ROOT([${VS_VERSION}],
228           [$ProgramW6432/$SDK_INSTALL_DIR], [well-known name])
229     fi
230     if test &quot;x$PROGRAMW6432&quot; != x; then
231       TOOLCHAIN_CHECK_POSSIBLE_WIN_SDK_ROOT([${VS_VERSION}],
232           [$PROGRAMW6432/$SDK_INSTALL_DIR], [well-known name])
233     fi
234     if test &quot;x$PROGRAMFILES&quot; != x; then
235       TOOLCHAIN_CHECK_POSSIBLE_WIN_SDK_ROOT([${VS_VERSION}],
236           [$PROGRAMFILES/$SDK_INSTALL_DIR], [well-known name])
237     fi
238     TOOLCHAIN_CHECK_POSSIBLE_WIN_SDK_ROOT([${VS_VERSION}],
239         [C:/Program Files/$SDK_INSTALL_DIR], [well-known name])
240     TOOLCHAIN_CHECK_POSSIBLE_WIN_SDK_ROOT([${VS_VERSION}],
241         [C:/Program Files (x86)/$SDK_INSTALL_DIR], [well-known name])
242   fi
243 ])
244 
245 ################################################################################
246 
247 AC_DEFUN([TOOLCHAIN_FIND_VISUAL_STUDIO],
248 [
249   AC_ARG_WITH(toolchain-version, [AS_HELP_STRING([--with-toolchain-version],
250       [the version of the toolchain to look for, use &#39;--help&#39; to show possible values @&lt;:@platform dependent@:&gt;@])])
251 
252   if test &quot;x$with_toolchain_version&quot; = xlist; then
253     # List all toolchains
254     AC_MSG_NOTICE([The following toolchain versions are valid on this platform:])
255     for version in $VALID_VS_VERSIONS; do
256       eval VS_DESCRIPTION=\${VS_DESCRIPTION_$version}
257       $PRINTF &quot;  %-10s  %s\n&quot; $version &quot;$VS_DESCRIPTION&quot;
258     done
259 
260     exit 0
261   elif test &quot;x$DEVKIT_VS_VERSION&quot; != x; then
262     VS_VERSION=$DEVKIT_VS_VERSION
263     TOOLCHAIN_VERSION=$VS_VERSION
264     # If the devkit has a name, use that as description
265     VS_DESCRIPTION=&quot;$DEVKIT_NAME&quot;
266     if test &quot;x$VS_DESCRIPTION&quot; = x; then
267       eval VS_DESCRIPTION=&quot;\${VS_DESCRIPTION_${VS_VERSION}}&quot;
268     fi
269     eval VS_VERSION_INTERNAL=&quot;\${VS_VERSION_INTERNAL_${VS_VERSION}}&quot;
270     eval MSVCR_NAME=&quot;\${VS_MSVCR_${VS_VERSION}}&quot;
271     eval MSVCP_NAME=&quot;\${VS_MSVCP_${VS_VERSION}}&quot;
272     eval USE_UCRT=&quot;\${VS_USE_UCRT_${VS_VERSION}}&quot;
273     eval VS_SUPPORTED=&quot;\${VS_SUPPORTED_${VS_VERSION}}&quot;
274     eval PLATFORM_TOOLSET=&quot;\${VS_VS_PLATFORM_NAME_${VS_VERSION}}&quot;
275 
276     # The TOOLCHAIN_PATH from a devkit is in Unix format. In WSL we need a
277     # windows version of the complete VS_PATH as VS_PATH_WINDOWS
278     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
279       # Convert the toolchain path
280       OLDIFS=&quot;$IFS&quot;
281       IFS=&quot;:&quot;
282       VS_PATH_WINDOWS=&quot;&quot;
283       for i in $TOOLCHAIN_PATH; do
284         path=$i
285         BASIC_WINDOWS_REWRITE_AS_WINDOWS_MIXED_PATH([path])
286         VS_PATH_WINDOWS=&quot;$VS_PATH_WINDOWS;$path&quot;
287       done
288       IFS=&quot;$OLDIFS&quot;
289       # Append the current path from Windows env
290       WINDOWS_PATH=&quot;`$CMD /c echo %PATH%`&quot;
291       VS_PATH_WINDOWS=&quot;$VS_PATH_WINDOWS;$WINDOWS_PATH&quot;
292     else
293       VS_PATH=&quot;$TOOLCHAIN_PATH:$PATH&quot;
294     fi
295 
296     # Convert DEVKIT_VS_INCLUDE into windows style VS_INCLUDE so that it
297     # can still be exported as INCLUDE for compiler invocations without
298     # SYSROOT_CFLAGS
299     OLDIFS=&quot;$IFS&quot;
300     IFS=&quot;;&quot;
301     for i in $DEVKIT_VS_INCLUDE; do
302       ipath=$i
303       BASIC_WINDOWS_REWRITE_AS_WINDOWS_MIXED_PATH([ipath])
304       VS_INCLUDE=&quot;$VS_INCLUDE;$ipath&quot;
305     done
306     # Convert DEVKIT_VS_LIB into VS_LIB so that it can still be exported
307     # as LIB for compiler invocations without SYSROOT_LDFLAGS
308     for i in $DEVKIT_VS_LIB; do
309       libpath=$i
310       BASIC_WINDOWS_REWRITE_AS_WINDOWS_MIXED_PATH([libpath])
311       VS_LIB=&quot;$VS_LIB;$libpath&quot;
312     done
313     IFS=&quot;$OLDIFS&quot;
314 
315     AC_MSG_NOTICE([Found devkit $VS_DESCRIPTION])
316 
317   elif test &quot;x$with_toolchain_version&quot; != x; then
318     # User override; check that it is valid
319     if test &quot;x${VALID_VS_VERSIONS/$with_toolchain_version/}&quot; = &quot;x${VALID_VS_VERSIONS}&quot;; then
320       AC_MSG_NOTICE([Visual Studio version $with_toolchain_version is not valid.])
321       AC_MSG_NOTICE([Valid Visual Studio versions: $VALID_VS_VERSIONS.])
322       AC_MSG_ERROR([Cannot continue.])
323     fi
324     VS_VERSIONS_PROBE_LIST=&quot;$with_toolchain_version&quot;
325   else
326     # No flag given, use default
327     VS_VERSIONS_PROBE_LIST=&quot;$VALID_VS_VERSIONS&quot;
328   fi
329 
330   for VS_VERSION in $VS_VERSIONS_PROBE_LIST; do
331     TOOLCHAIN_FIND_VISUAL_STUDIO_BAT_FILE([$VS_VERSION])
332     if test &quot;x$VS_ENV_CMD&quot; != x; then
333       TOOLCHAIN_VERSION=$VS_VERSION
334       eval VS_DESCRIPTION=&quot;\${VS_DESCRIPTION_${VS_VERSION}}&quot;
335       eval VS_VERSION_INTERNAL=&quot;\${VS_VERSION_INTERNAL_${VS_VERSION}}&quot;
336       eval MSVCR_NAME=&quot;\${VS_MSVCR_${VS_VERSION}}&quot;
337       eval MSVCP_NAME=&quot;\${VS_MSVCP_${VS_VERSION}}&quot;
338       eval USE_UCRT=&quot;\${VS_USE_UCRT_${VS_VERSION}}&quot;
339       eval VS_SUPPORTED=&quot;\${VS_SUPPORTED_${VS_VERSION}}&quot;
340       # The rest of the variables are already evaled while probing
341       AC_MSG_NOTICE([Found $VS_DESCRIPTION])
342       break
343     fi
344   done
345 
346   TOOLCHAIN_DESCRIPTION=&quot;$VS_DESCRIPTION&quot;
347   if test &quot;x$VS_SUPPORTED&quot; = &quot;xfalse&quot;; then
348     UNSUPPORTED_TOOLCHAIN_VERSION=yes
349   fi
350 ])
351 
352 ################################################################################
353 # Check if the VS env variables were setup prior to running configure.
354 # If not, then find vcvarsall.bat and run it automatically, and integrate
355 # the set env variables into the spec file.
356 AC_DEFUN([TOOLCHAIN_SETUP_VISUAL_STUDIO_ENV],
357 [
358   # Store path to cygwin link.exe to help excluding it when searching for
359   # VS linker. This must be done before changing the PATH when looking for VS.
360   AC_PATH_PROG(CYGWIN_LINK, link.exe)
361   if test &quot;x$CYGWIN_LINK&quot; != x; then
362     AC_MSG_CHECKING([if the first found link.exe is actually the Cygwin link tool])
363     &quot;$CYGWIN_LINK&quot; --version &gt; /dev/null
364     if test $? -eq 0 ; then
365       AC_MSG_RESULT([yes])
366     else
367       AC_MSG_RESULT([no])
368       # This might be the VS linker. Don&#39;t exclude it later on.
369       CYGWIN_LINK=&quot;&quot;
370     fi
371   fi
372 
373   # First-hand choice is to locate and run the vsvars bat file.
374   TOOLCHAIN_FIND_VISUAL_STUDIO
375 
376   # If we have a devkit, skip all of the below.
377   if test &quot;x$DEVKIT_VS_VERSION&quot; = x; then
378     if test &quot;x$VS_ENV_CMD&quot; != x; then
379       # We have found a Visual Studio environment on disk, let&#39;s extract variables from the vsvars bat file.
380       BASIC_FIXUP_EXECUTABLE(VS_ENV_CMD)
381 
382       # Lets extract the variables that are set by vcvarsall.bat/vsvars32.bat/vsvars64.bat
383       AC_MSG_NOTICE([Trying to extract Visual Studio environment variables])
384 
385       # We need to create a couple of temporary files.
386       VS_ENV_TMP_DIR=&quot;$CONFIGURESUPPORT_OUTPUTDIR/vs-env&quot;
387       $MKDIR -p $VS_ENV_TMP_DIR
388 
389       # Cannot use the VS10 setup script directly (since it only updates the DOS subshell environment).
390       # Instead create a shell script which will set the relevant variables when run.
391       WINPATH_VS_ENV_CMD=&quot;$VS_ENV_CMD&quot;
392       BASIC_WINDOWS_REWRITE_AS_WINDOWS_MIXED_PATH([WINPATH_VS_ENV_CMD])
393 
394       if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
395         WINPATH_BASH=&quot;bash&quot;
396       else
397         WINPATH_BASH=&quot;$BASH&quot;
398         BASIC_WINDOWS_REWRITE_AS_WINDOWS_MIXED_PATH([WINPATH_BASH])
399       fi
400 
401       # Generate a DOS batch file which runs $VS_ENV_CMD, and then creates a shell
402       # script (executable by bash) that will setup the important variables.
403       EXTRACT_VC_ENV_BAT_FILE=&quot;$VS_ENV_TMP_DIR/extract-vs-env.bat&quot;
404       $ECHO &quot;@echo off&quot; &gt;  $EXTRACT_VC_ENV_BAT_FILE
405       # This will end up something like:
406       # call C:/progra~2/micros~2.0/vc/bin/amd64/vcvars64.bat
407       $ECHO &quot;call \&quot;$WINPATH_VS_ENV_CMD\&quot; $VS_ENV_ARGS&quot; &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
408       # In some cases, the VS_ENV_CMD will change directory, change back so
409       # the set-vs-env.sh ends up in the right place.
410       $ECHO &#39;cd %~dp0&#39; &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
411       if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
412         # These will end up something like:
413         # echo VS_PATH=\&quot;$PATH\&quot; &gt; set-vs-env.sh
414         # The trailing space for everyone except PATH is no typo, but is needed due
415         # to trailing \ in the Windows paths. These will be stripped later.
416         # Trying pure CMD extract. This results in windows paths that need to
417         # be converted post extraction, but a simpler script.
418         $ECHO &#39;echo VS_PATH=&quot;%PATH%&quot; &gt; set-vs-env.sh&#39; \
419             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
420         $ECHO &#39;echo VS_INCLUDE=&quot;%INCLUDE% &quot; &gt;&gt; set-vs-env.sh&#39; \
421             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
422         $ECHO &#39;echo VS_LIB=&quot;%LIB% &quot; &gt;&gt; set-vs-env.sh&#39; \
423             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
424         $ECHO &#39;echo VCINSTALLDIR=&quot;%VCINSTALLDIR% &quot; &gt;&gt; set-vs-env.sh&#39; \
425             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
426         $ECHO &#39;echo WindowsSdkDir=&quot;%WindowsSdkDir% &quot; &gt;&gt; set-vs-env.sh&#39; \
427             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
428         $ECHO &#39;echo WINDOWSSDKDIR=&quot;%WINDOWSSDKDIR% &quot; &gt;&gt; set-vs-env.sh&#39; \
429             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
430       else
431         # These will end up something like:
432         # C:/CygWin/bin/bash -c &#39;echo VS_PATH=\&quot;$PATH\&quot; &gt; localdevenv.sh
433         # The trailing space for everyone except PATH is no typo, but is needed due
434         # to trailing \ in the Windows paths. These will be stripped later.
435         $ECHO &quot;$WINPATH_BASH -c &#39;echo VS_PATH=&quot;&#39;\&quot;$PATH\&quot; &gt; set-vs-env.sh&#39; \
436             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
437         $ECHO &quot;$WINPATH_BASH -c &#39;echo VS_INCLUDE=&quot;&#39;\&quot;$INCLUDE\;$include \&quot; &gt;&gt; set-vs-env.sh&#39; \
438             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
439         $ECHO &quot;$WINPATH_BASH -c &#39;echo VS_LIB=&quot;&#39;\&quot;$LIB\;$lib \&quot; &gt;&gt; set-vs-env.sh&#39; \
440             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
441         $ECHO &quot;$WINPATH_BASH -c &#39;echo VCINSTALLDIR=&quot;&#39;\&quot;$VCINSTALLDIR \&quot; &gt;&gt; set-vs-env.sh&#39; \
442             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
443         $ECHO &quot;$WINPATH_BASH -c &#39;echo WindowsSdkDir=&quot;&#39;\&quot;$WindowsSdkDir \&quot; &gt;&gt; set-vs-env.sh&#39; \
444             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
445         $ECHO &quot;$WINPATH_BASH -c &#39;echo WINDOWSSDKDIR=&quot;&#39;\&quot;$WINDOWSSDKDIR \&quot; &gt;&gt; set-vs-env.sh&#39; \
446             &gt;&gt; $EXTRACT_VC_ENV_BAT_FILE
447       fi
448 
449       # Now execute the newly created bat file.
450       # The | cat is to stop SetEnv.Cmd to mess with system colors on msys.
451       # Change directory so we don&#39;t need to mess with Windows paths in redirects.
452       cd $VS_ENV_TMP_DIR
453       $CMD /c extract-vs-env.bat | $CAT
454       cd $CURDIR
455 
456       if test ! -s $VS_ENV_TMP_DIR/set-vs-env.sh; then
457         AC_MSG_NOTICE([Could not succesfully extract the environment variables needed for the VS setup.])
458         AC_MSG_NOTICE([Try setting --with-tools-dir to the VC/bin directory within the VS installation])
459         AC_MSG_NOTICE([or run &quot;bash.exe -l&quot; from a VS command prompt and then run configure from there.])
460         AC_MSG_ERROR([Cannot continue])
461       fi
462 
463       # Remove windows line endings
464       $SED -i -e &#39;s|\r||g&#39; $VS_ENV_TMP_DIR/set-vs-env.sh
465 
466       # Now set all paths and other env variables. This will allow the rest of
467       # the configure script to find and run the compiler in the proper way.
468       AC_MSG_NOTICE([Setting extracted environment variables])
469       . $VS_ENV_TMP_DIR/set-vs-env.sh
470       # Now we have VS_PATH, VS_INCLUDE, VS_LIB. For further checking, we
471       # also define VCINSTALLDIR, WindowsSdkDir and WINDOWSSDKDIR.
472 
473       # In WSL, the extracted VS_PATH is Windows style. This needs to be
474       # rewritten as Unix style and the Windows style version is saved
475       # in VS_PATH_WINDOWS.
476       if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.wsl&quot;; then
477         OLDIFS=&quot;$IFS&quot;
478         IFS=&quot;;&quot;
479         # Convert VS_PATH to unix style
480         VS_PATH_WINDOWS=&quot;$VS_PATH&quot;
481         VS_PATH=&quot;&quot;
482         for i in $VS_PATH_WINDOWS; do
483           path=$i
484           # Only process non-empty elements
485           if test &quot;x$path&quot; != x; then
486             IFS=&quot;$OLDIFS&quot;
487             # Check that directory exists before calling fixup_path
488             testpath=$path
489             BASIC_WINDOWS_REWRITE_AS_UNIX_PATH([testpath])
490             if test -d &quot;$testpath&quot;; then
491               BASIC_FIXUP_PATH([path])
492               BASIC_APPEND_TO_PATH(VS_PATH, $path)
493             fi
494             IFS=&quot;;&quot;
495           fi
496         done
497         IFS=&quot;$OLDIFS&quot;
498       fi
499 
500     else
501       # We did not find a vsvars bat file, let&#39;s hope we are run from a VS command prompt.
502       AC_MSG_NOTICE([Cannot locate a valid Visual Studio installation, checking current environment])
503     fi
504   fi
505 
506   # At this point, we should have correct variables in the environment, or we can&#39;t continue.
507   AC_MSG_CHECKING([for Visual Studio variables])
508 
509   if test &quot;x$VCINSTALLDIR&quot; != x || test &quot;x$WindowsSDKDir&quot; != x \
510       || test &quot;x$WINDOWSSDKDIR&quot; != x || test &quot;x$DEVKIT_NAME&quot; != x; then
511     if test &quot;x$VS_INCLUDE&quot; = x || test &quot;x$VS_LIB&quot; = x; then
512       AC_MSG_RESULT([present but broken])
513       AC_MSG_ERROR([Your VC command prompt seems broken, INCLUDE and/or LIB is missing.])
514     else
515       AC_MSG_RESULT([ok])
516       # Remove any trailing &quot;\&quot; &quot;;&quot; and &quot; &quot; from the variables.
517       VS_INCLUDE=`$ECHO &quot;$VS_INCLUDE&quot; | $SED -e &#39;s/\\\\*;* *$//&#39;`
518       VS_LIB=`$ECHO &quot;$VS_LIB&quot; | $SED &#39;s/\\\\*;* *$//&#39;`
519       VCINSTALLDIR=`$ECHO &quot;$VCINSTALLDIR&quot; | $SED &#39;s/\\\\* *$//&#39;`
520       WindowsSdkDir=`$ECHO &quot;$WindowsSdkDir&quot; | $SED &#39;s/\\\\* *$//&#39;`
521       WINDOWSSDKDIR=`$ECHO &quot;$WINDOWSSDKDIR&quot; | $SED &#39;s/\\\\* *$//&#39;`
522       if test -z &quot;$WINDOWSSDKDIR&quot;; then
523         WINDOWSSDKDIR=&quot;$WindowsSdkDir&quot;
524       fi
525       # Remove any paths containing # (typically F#) as that messes up make. This
526       # is needed if visual studio was installed with F# support.
527       VS_PATH=`$ECHO &quot;$VS_PATH&quot; | $SED &#39;s/[[^:#]]*#[^:]*://g&#39;`
528 
529       AC_SUBST(VS_PATH)
530       AC_SUBST(VS_INCLUDE)
531       AC_SUBST(VS_LIB)
532 
533       # Convert VS_INCLUDE into SYSROOT_CFLAGS
534       OLDIFS=&quot;$IFS&quot;
535       IFS=&quot;;&quot;
536       for i in $VS_INCLUDE; do
537         ipath=$i
538         # Only process non-empty elements
539         if test &quot;x$ipath&quot; != x; then
540           IFS=&quot;$OLDIFS&quot;
541           # Check that directory exists before calling fixup_path
542           testpath=$ipath
543           BASIC_WINDOWS_REWRITE_AS_UNIX_PATH([testpath])
544           if test -d &quot;$testpath&quot;; then
545             BASIC_FIXUP_PATH([ipath])
546             SYSROOT_CFLAGS=&quot;$SYSROOT_CFLAGS -I$ipath&quot;
547           fi
548           IFS=&quot;;&quot;
549         fi
550       done
551       # Convert VS_LIB into SYSROOT_LDFLAGS
552       for i in $VS_LIB; do
553         libpath=$i
554         # Only process non-empty elements
555         if test &quot;x$libpath&quot; != x; then
556           IFS=&quot;$OLDIFS&quot;
557           # Check that directory exists before calling fixup_path
558           testpath=$libpath
559           BASIC_WINDOWS_REWRITE_AS_UNIX_PATH([testpath])
560           if test -d &quot;$testpath&quot;; then
561             BASIC_FIXUP_PATH([libpath])
562             SYSROOT_LDFLAGS=&quot;$SYSROOT_LDFLAGS -libpath:$libpath&quot;
563           fi
564           IFS=&quot;;&quot;
565         fi
566       done
567       IFS=&quot;$OLDIFS&quot;
568 
569       AC_SUBST(VS_PATH_WINDOWS)
570     fi
571   else
572     AC_MSG_RESULT([not found])
573 
574     if test &quot;x$VS_ENV_CMD&quot; = x; then
575       AC_MSG_NOTICE([Cannot locate a valid Visual Studio or Windows SDK installation on disk,])
576       AC_MSG_NOTICE([nor is this script run from a Visual Studio command prompt.])
577     else
578       AC_MSG_NOTICE([Running the extraction script failed.])
579     fi
580     AC_MSG_NOTICE([Try setting --with-tools-dir to the VC/bin directory within the VS installation])
581     AC_MSG_NOTICE([or run &quot;bash.exe -l&quot; from a VS command prompt and then run configure from there.])
582     AC_MSG_ERROR([Cannot continue])
583   fi
584 ])
585 
586 AC_DEFUN([TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL],
587 [
588   DLL_NAME=&quot;$1&quot;
589   POSSIBLE_MSVC_DLL=&quot;$2&quot;
590   METHOD=&quot;$3&quot;
591   if test -n &quot;$POSSIBLE_MSVC_DLL&quot; -a -e &quot;$POSSIBLE_MSVC_DLL&quot;; then
592     AC_MSG_NOTICE([Found $DLL_NAME at $POSSIBLE_MSVC_DLL using $METHOD])
593 
594     # Need to check if the found msvcr is correct architecture
595     AC_MSG_CHECKING([found $DLL_NAME architecture])
596     MSVC_DLL_FILETYPE=`$FILE -b &quot;$POSSIBLE_MSVC_DLL&quot;`
597     if test &quot;x$OPENJDK_BUILD_OS_ENV&quot; = &quot;xwindows.msys&quot;; then
598       # The MSYS &#39;file&#39; command returns &quot;PE32 executable for MS Windows (DLL) (GUI) Intel 80386 32-bit&quot;
599       # on x32 and &quot;PE32+ executable for MS Windows (DLL) (GUI) Mono/.Net assembly&quot; on x64 systems.
600       if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x32; then
601         CORRECT_MSVCR_ARCH=&quot;PE32 executable&quot;
602       else
603         CORRECT_MSVCR_ARCH=&quot;PE32+ executable&quot;
604       fi
605     else
606       if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x32; then
607         CORRECT_MSVCR_ARCH=386
608       else
609         CORRECT_MSVCR_ARCH=x86-64
610       fi
611     fi
612     if $ECHO &quot;$MSVC_DLL_FILETYPE&quot; | $GREP &quot;$CORRECT_MSVCR_ARCH&quot; 2&gt;&amp;1 &gt; /dev/null; then
613       AC_MSG_RESULT([ok])
614       MSVC_DLL=&quot;$POSSIBLE_MSVC_DLL&quot;
615       AC_MSG_CHECKING([for $DLL_NAME])
616       AC_MSG_RESULT([$MSVC_DLL])
617     else
618       AC_MSG_RESULT([incorrect, ignoring])
619       AC_MSG_NOTICE([The file type of the located $DLL_NAME is $MSVC_DLL_FILETYPE])
620     fi
621   fi
622 ])
623 
624 AC_DEFUN([TOOLCHAIN_SETUP_MSVC_DLL],
625 [
626   DLL_NAME=&quot;$1&quot;
627   MSVC_DLL=
628 
629   if test &quot;x$MSVC_DLL&quot; = x; then
630     if test &quot;x$VCINSTALLDIR&quot; != x; then
631       CYGWIN_VC_INSTALL_DIR=&quot;$VCINSTALLDIR&quot;
632       BASIC_FIXUP_PATH(CYGWIN_VC_INSTALL_DIR)
633       if test &quot;$VS_VERSION&quot; -lt 2017; then
634         # Probe: Using well-known location from Visual Studio 12.0 and older
635         if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x64; then
636           POSSIBLE_MSVC_DLL=&quot;$CYGWIN_VC_INSTALL_DIR/redist/x64/Microsoft.VC${VS_VERSION_INTERNAL}.CRT/$DLL_NAME&quot;
637         else
638           POSSIBLE_MSVC_DLL=&quot;$CYGWIN_VC_INSTALL_DIR/redist/x86/Microsoft.VC${VS_VERSION_INTERNAL}.CRT/$DLL_NAME&quot;
639         fi
640       else
641         # Probe: Using well-known location from VS 2017
642         if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x64; then
643           POSSIBLE_MSVC_DLL=&quot;`ls $CYGWIN_VC_INSTALL_DIR/Redist/MSVC/*/x64/Microsoft.VC${VS_VERSION_INTERNAL}.CRT/$DLL_NAME`&quot;
644         else
645           POSSIBLE_MSVC_DLL=&quot;`ls $CYGWIN_VC_INSTALL_DIR/Redist/MSVC/*/x86/Microsoft.VC${VS_VERSION_INTERNAL}.CRT/$DLL_NAME`&quot;
646         fi
647       fi
648       # In case any of the above finds more than one file, loop over them.
649       for possible_msvc_dll in $POSSIBLE_MSVC_DLL; do
650         $ECHO &quot;POSSIBLE_MSVC_DLL $possible_msvc_dll&quot;
651         TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL([$DLL_NAME], [$possible_msvc_dll],
652             [well-known location in VCINSTALLDIR])
653       done
654     fi
655   fi
656 
657   if test &quot;x$MSVC_DLL&quot; = x; then
658     # Probe: Check in the Boot JDK directory.
659     POSSIBLE_MSVC_DLL=&quot;$BOOT_JDK/bin/$DLL_NAME&quot;
660     TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL([$DLL_NAME], [$POSSIBLE_MSVC_DLL],
661         [well-known location in Boot JDK])
662   fi
663 
664   if test &quot;x$MSVC_DLL&quot; = x; then
665     # Probe: Look in the Windows system32 directory
666     CYGWIN_SYSTEMROOT=&quot;$SYSTEMROOT&quot;
667     BASIC_WINDOWS_REWRITE_AS_UNIX_PATH(CYGWIN_SYSTEMROOT)
668     POSSIBLE_MSVC_DLL=&quot;$CYGWIN_SYSTEMROOT/system32/$DLL_NAME&quot;
669     TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL([$DLL_NAME], [$POSSIBLE_MSVC_DLL],
670         [well-known location in SYSTEMROOT])
671   fi
672 
673   if test &quot;x$MSVC_DLL&quot; = x; then
674     # Probe: If Visual Studio Express is installed, there is usually one with the debugger
675     if test &quot;x$VS100COMNTOOLS&quot; != x; then
676       CYGWIN_VS_TOOLS_DIR=&quot;$VS100COMNTOOLS/..&quot;
677       BASIC_WINDOWS_REWRITE_AS_UNIX_PATH(CYGWIN_VS_TOOLS_DIR)
678       if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x64; then
679         POSSIBLE_MSVC_DLL=`$FIND &quot;$CYGWIN_VS_TOOLS_DIR&quot; -name $DLL_NAME \
680         | $GREP -i /x64/ | $HEAD --lines 1`
681       else
682         POSSIBLE_MSVC_DLL=`$FIND &quot;$CYGWIN_VS_TOOLS_DIR&quot; -name $DLL_NAME \
683         | $GREP -i /x86/ | $HEAD --lines 1`
684       fi
685       TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL([$DLL_NAME], [$POSSIBLE_MSVC_DLL],
686           [search of VS100COMNTOOLS])
687     fi
688   fi
689 
690   if test &quot;x$MSVC_DLL&quot; = x; then
691     # Probe: Search wildly in the VCINSTALLDIR. We&#39;ve probably lost by now.
692     # (This was the original behaviour; kept since it might turn something up)
693     if test &quot;x$CYGWIN_VC_INSTALL_DIR&quot; != x; then
694       if test &quot;x$OPENJDK_TARGET_CPU_BITS&quot; = x64; then
695         POSSIBLE_MSVC_DLL=`$FIND &quot;$CYGWIN_VC_INSTALL_DIR&quot; -name $DLL_NAME \
696         | $GREP x64 | $HEAD --lines 1`
697       else
698         POSSIBLE_MSVC_DLL=`$FIND &quot;$CYGWIN_VC_INSTALL_DIR&quot; -name $DLL_NAME \
699         | $GREP x86 | $GREP -v ia64 | $GREP -v x64 | $HEAD --lines 1`
700         if test &quot;x$POSSIBLE_MSVC_DLL&quot; = x; then
701           # We&#39;re grasping at straws now...
702           POSSIBLE_MSVC_DLL=`$FIND &quot;$CYGWIN_VC_INSTALL_DIR&quot; -name $DLL_NAME \
703           | $HEAD --lines 1`
704         fi
705       fi
706 
707       TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL([$DLL_NAME], [$POSSIBLE_MSVC_DLL],
708           [search of VCINSTALLDIR])
709     fi
710   fi
711 
712   if test &quot;x$MSVC_DLL&quot; = x; then
713     AC_MSG_CHECKING([for $DLL_NAME])
714     AC_MSG_RESULT([no])
715     AC_MSG_ERROR([Could not find $DLL_NAME. Please specify using --with-msvcr-dll.])
716   fi
717 ])
718 
719 AC_DEFUN([TOOLCHAIN_SETUP_VS_RUNTIME_DLLS],
720 [
721   AC_ARG_WITH(msvcr-dll, [AS_HELP_STRING([--with-msvcr-dll],
722       [path to microsoft C runtime dll (msvcr*.dll) (Windows only) @&lt;:@probed@:&gt;@])])
723 
724   if test &quot;x$with_msvcr_dll&quot; != x; then
725     # If given explicitly by user, do not probe. If not present, fail directly.
726     TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL($MSVCR_NAME, [$with_msvcr_dll], [--with-msvcr-dll])
727     if test &quot;x$MSVC_DLL&quot; = x; then
728       AC_MSG_ERROR([Could not find a proper $MSVCR_NAME as specified by --with-msvcr-dll])
729     fi
730     MSVCR_DLL=&quot;$MSVC_DLL&quot;
731   elif test &quot;x$DEVKIT_MSVCR_DLL&quot; != x; then
732     TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL($MSVCR_NAME, [$DEVKIT_MSVCR_DLL], [devkit])
733     if test &quot;x$MSVC_DLL&quot; = x; then
734       AC_MSG_ERROR([Could not find a proper $MSVCR_NAME as specified by devkit])
735     fi
736     MSVCR_DLL=&quot;$MSVC_DLL&quot;
737   else
738     TOOLCHAIN_SETUP_MSVC_DLL([${MSVCR_NAME}])
739     MSVCR_DLL=&quot;$MSVC_DLL&quot;
740   fi
741   AC_SUBST(MSVCR_DLL)
742 
743   AC_ARG_WITH(msvcp-dll, [AS_HELP_STRING([--with-msvcp-dll],
744       [path to microsoft C++ runtime dll (msvcp*.dll) (Windows only) @&lt;:@probed@:&gt;@])])
745 
746   if test &quot;x$MSVCP_NAME&quot; != &quot;x&quot;; then
747     if test &quot;x$with_msvcp_dll&quot; != x; then
748       # If given explicitly by user, do not probe. If not present, fail directly.
749       TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL($MSVCP_NAME, [$with_msvcp_dll], [--with-msvcp-dll])
750       if test &quot;x$MSVC_DLL&quot; = x; then
751         AC_MSG_ERROR([Could not find a proper $MSVCP_NAME as specified by --with-msvcp-dll])
752       fi
753       MSVCP_DLL=&quot;$MSVC_DLL&quot;
754     elif test &quot;x$DEVKIT_MSVCP_DLL&quot; != x; then
755       TOOLCHAIN_CHECK_POSSIBLE_MSVC_DLL($MSVCP_NAME, [$DEVKIT_MSVCP_DLL], [devkit])
756       if test &quot;x$MSVC_DLL&quot; = x; then
757         AC_MSG_ERROR([Could not find a proper $MSVCP_NAME as specified by devkit])
758       fi
759       MSVCP_DLL=&quot;$MSVC_DLL&quot;
760     else
761       TOOLCHAIN_SETUP_MSVC_DLL([${MSVCP_NAME}])
762       MSVCP_DLL=&quot;$MSVC_DLL&quot;
763     fi
764     AC_SUBST(MSVCP_DLL)
765   fi
766 
767   AC_ARG_WITH(ucrt-dll-dir, [AS_HELP_STRING([--with-ucrt-dll-dir],
768       [path to Microsoft Windows Kit UCRT DLL dir (Windows only) @&lt;:@probed@:&gt;@])])
769 
770   if test &quot;x$USE_UCRT&quot; = &quot;xtrue&quot;; then
771     AC_MSG_CHECKING([for UCRT DLL dir])
772     if test &quot;x$with_ucrt_dll_dir&quot; != x; then
773       if test -z &quot;$(ls -d $with_ucrt_dll_dir/*.dll 2&gt; /dev/null)&quot;; then
774         AC_MSG_RESULT([no])
775         AC_MSG_ERROR([Could not find any dlls in $with_ucrt_dll_dir])
776       else
777         AC_MSG_RESULT([$with_ucrt_dll_dir])
778         UCRT_DLL_DIR=&quot;$with_ucrt_dll_dir&quot;
779         BASIC_FIXUP_PATH([UCRT_DLL_DIR])
780       fi
781     elif test &quot;x$DEVKIT_UCRT_DLL_DIR&quot; != &quot;x&quot;; then
782       UCRT_DLL_DIR=&quot;$DEVKIT_UCRT_DLL_DIR&quot;
783       AC_MSG_RESULT($UCRT_DLL_DIR)
784     else
785       CYGWIN_WINDOWSSDKDIR=&quot;${WINDOWSSDKDIR}&quot;
786       BASIC_FIXUP_PATH([CYGWIN_WINDOWSSDKDIR])
787       dll_subdir=$OPENJDK_TARGET_CPU
788       if test &quot;x$dll_subdir&quot; = &quot;xx86_64&quot;; then
789         dll_subdir=&quot;x64&quot;
790       fi
791       UCRT_DLL_DIR=&quot;$CYGWIN_WINDOWSSDKDIR/Redist/ucrt/DLLs/$dll_subdir&quot;
792       if test -z &quot;$(ls -d &quot;$UCRT_DLL_DIR/&quot;*.dll 2&gt; /dev/null)&quot;; then
793         # Try with version subdir
794         UCRT_DLL_DIR=&quot;`ls -d $CYGWIN_WINDOWSSDKDIR/Redist/*/ucrt/DLLs/$dll_subdir \
795             2&gt; /dev/null | $SORT -d | $HEAD -n1`&quot;
796         if test -z &quot;$UCRT_DLL_DIR&quot; \
797             || test -z &quot;$(ls -d &quot;$UCRT_DLL_DIR/&quot;*.dll 2&gt; /dev/null)&quot;; then
798           AC_MSG_RESULT([no])
799           AC_MSG_ERROR([Could not find any dlls in $UCRT_DLL_DIR])
800         else
801           AC_MSG_RESULT($UCRT_DLL_DIR)
802         fi
803       else
804         AC_MSG_RESULT($UCRT_DLL_DIR)
805       fi
806     fi
807   else
808     UCRT_DLL_DIR=
809   fi
810   AC_SUBST(UCRT_DLL_DIR)
811 ])
    </pre>
  </body>
</html>