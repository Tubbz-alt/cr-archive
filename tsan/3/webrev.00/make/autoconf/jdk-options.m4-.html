<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old make/autoconf/jdk-options.m4</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 #
  2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ###############################################################################
 27 # Check which variant of the JDK that we want to build.
 28 # Currently we have:
 29 #    normal:   standard edition
 30 # but the custom make system may add other variants
 31 #
 32 # Effectively the JDK variant gives a name to a specific set of
 33 # modules to compile into the JDK.
 34 AC_DEFUN_ONCE([JDKOPT_SETUP_JDK_VARIANT],
 35 [
 36   # Deprecated in JDK 12
 37   BASIC_DEPRECATED_ARG_WITH([jdk-variant])
 38 ])
 39 
 40 ###############################################################################
 41 # Set the debug level
 42 #    release: no debug information, all optimizations, no asserts.
 43 #    optimized: no debug information, all optimizations, no asserts, HotSpot target is &#39;optimized&#39;.
 44 #    fastdebug: debug information (-g), all optimizations, all asserts
 45 #    slowdebug: debug information (-g), no optimizations, all asserts
 46 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_LEVEL],
 47 [
 48   DEBUG_LEVEL=&quot;release&quot;
 49   AC_MSG_CHECKING([which debug level to use])
 50   AC_ARG_ENABLE([debug], [AS_HELP_STRING([--enable-debug],
 51       [set the debug level to fastdebug (shorthand for --with-debug-level=fastdebug) @&lt;:@disabled@:&gt;@])],
 52       [
 53         ENABLE_DEBUG=&quot;${enableval}&quot;
 54         DEBUG_LEVEL=&quot;fastdebug&quot;
 55       ], [ENABLE_DEBUG=&quot;no&quot;])
 56 
 57   AC_ARG_WITH([debug-level], [AS_HELP_STRING([--with-debug-level],
 58       [set the debug level (release, fastdebug, slowdebug, optimized) @&lt;:@release@:&gt;@])],
 59       [
 60         DEBUG_LEVEL=&quot;${withval}&quot;
 61         if test &quot;x$ENABLE_DEBUG&quot; = xyes; then
 62           AC_MSG_ERROR([You cannot use both --enable-debug and --with-debug-level at the same time.])
 63         fi
 64       ])
 65   AC_MSG_RESULT([$DEBUG_LEVEL])
 66 
 67   if test &quot;x$DEBUG_LEVEL&quot; != xrelease &amp;&amp; \
 68       test &quot;x$DEBUG_LEVEL&quot; != xoptimized &amp;&amp; \
 69       test &quot;x$DEBUG_LEVEL&quot; != xfastdebug &amp;&amp; \
 70       test &quot;x$DEBUG_LEVEL&quot; != xslowdebug; then
 71     AC_MSG_ERROR([Allowed debug levels are: release, fastdebug, slowdebug and optimized])
 72   fi
 73 
 74   # Translate DEBUG_LEVEL to debug level used by Hotspot
 75   HOTSPOT_DEBUG_LEVEL=&quot;$DEBUG_LEVEL&quot;
 76   if test &quot;x$DEBUG_LEVEL&quot; = xrelease; then
 77     HOTSPOT_DEBUG_LEVEL=&quot;product&quot;
 78   elif test &quot;x$DEBUG_LEVEL&quot; = xslowdebug; then
 79     HOTSPOT_DEBUG_LEVEL=&quot;debug&quot;
 80   fi
 81 
 82   if test &quot;x$DEBUG_LEVEL&quot; = xoptimized; then
 83     # The debug level &#39;optimized&#39; is a little special because it is currently only
 84     # applicable to the HotSpot build where it means to build a completely
 85     # optimized version of the VM without any debugging code (like for the
 86     # &#39;release&#39; debug level which is called &#39;product&#39; in the HotSpot build) but
 87     # with the exception that it can contain additional code which is otherwise
 88     # protected by &#39;#ifndef PRODUCT&#39; macros. These &#39;optimized&#39; builds are used to
 89     # test new and/or experimental features which are not intended for customer
 90     # shipment. Because these new features need to be tested and benchmarked in
 91     # real world scenarios, we want to build the containing JDK at the &#39;release&#39;
 92     # debug level.
 93     DEBUG_LEVEL=&quot;release&quot;
 94   fi
 95 
 96   AC_SUBST(HOTSPOT_DEBUG_LEVEL)
 97   AC_SUBST(DEBUG_LEVEL)
 98 ])
 99 
100 ###############################################################################
101 #
102 # Should we build only OpenJDK even if closed sources are present?
103 #
104 AC_DEFUN_ONCE([JDKOPT_SETUP_OPEN_OR_CUSTOM],
105 [
106   AC_ARG_ENABLE([openjdk-only], [AS_HELP_STRING([--enable-openjdk-only],
107       [suppress building custom source even if present @&lt;:@disabled@:&gt;@])],,[enable_openjdk_only=&quot;no&quot;])
108 
109   AC_MSG_CHECKING([if custom source is suppressed (openjdk-only)])
110   AC_MSG_RESULT([$enable_openjdk_only])
111   if test &quot;x$enable_openjdk_only&quot; = &quot;xyes&quot;; then
112     SUPPRESS_CUSTOM_EXTENSIONS=&quot;true&quot;
113   elif test &quot;x$enable_openjdk_only&quot; = &quot;xno&quot;; then
114     SUPPRESS_CUSTOM_EXTENSIONS=&quot;false&quot;
115   else
116     AC_MSG_ERROR([Invalid value for --enable-openjdk-only: $enable_openjdk_only])
117   fi
118 ])
119 
120 AC_DEFUN_ONCE([JDKOPT_SETUP_JDK_OPTIONS],
121 [
122   # Should we build a JDK without a graphical UI?
123   AC_MSG_CHECKING([headless only])
124   AC_ARG_ENABLE([headless-only], [AS_HELP_STRING([--enable-headless-only],
125       [only build headless (no GUI) support @&lt;:@disabled@:&gt;@])])
126 
127   if test &quot;x$enable_headless_only&quot; = &quot;xyes&quot;; then
128     ENABLE_HEADLESS_ONLY=&quot;true&quot;
129     AC_MSG_RESULT([yes])
130   elif test &quot;x$enable_headless_only&quot; = &quot;xno&quot;; then
131     ENABLE_HEADLESS_ONLY=&quot;false&quot;
132     AC_MSG_RESULT([no])
133   elif test &quot;x$enable_headless_only&quot; = &quot;x&quot;; then
134     ENABLE_HEADLESS_ONLY=&quot;false&quot;
135     AC_MSG_RESULT([no])
136   else
137     AC_MSG_ERROR([--enable-headless-only can only take yes or no])
138   fi
139 
140   AC_SUBST(ENABLE_HEADLESS_ONLY)
141 
142   # Should we build the complete docs, or just a lightweight version?
143   AC_ARG_ENABLE([full-docs], [AS_HELP_STRING([--enable-full-docs],
144       [build complete documentation @&lt;:@enabled if all tools found@:&gt;@])])
145 
146   # Verify dependencies
147   AC_MSG_CHECKING([for graphviz dot])
148   if test &quot;x$DOT&quot; != &quot;x&quot;; then
149     AC_MSG_RESULT([yes])
150   else
151     AC_MSG_RESULT([no, cannot generate full docs])
152     FULL_DOCS_DEP_MISSING=true
153   fi
154 
155   AC_MSG_CHECKING([for pandoc])
156   if test &quot;x$PANDOC&quot; != &quot;x&quot;; then
157     AC_MSG_RESULT([yes])
158   else
159     AC_MSG_RESULT([no, cannot generate full docs])
160     FULL_DOCS_DEP_MISSING=true
161   fi
162 
163   AC_MSG_CHECKING([full docs])
164   if test &quot;x$enable_full_docs&quot; = xyes; then
165     if test &quot;x$FULL_DOCS_DEP_MISSING&quot; = &quot;xtrue&quot;; then
166       AC_MSG_RESULT([no, missing dependencies])
167       HELP_MSG_MISSING_DEPENDENCY([dot])
168       AC_MSG_ERROR([Cannot enable full docs with missing dependencies. See above. $HELP_MSG])
169     else
170       ENABLE_FULL_DOCS=true
171       AC_MSG_RESULT([yes, forced])
172     fi
173   elif test &quot;x$enable_full_docs&quot; = xno; then
174     ENABLE_FULL_DOCS=false
175     AC_MSG_RESULT([no, forced])
176   elif test &quot;x$enable_full_docs&quot; = x; then
177     # Check for prerequisites
178     if test &quot;x$FULL_DOCS_DEP_MISSING&quot; = xtrue; then
179       ENABLE_FULL_DOCS=false
180       AC_MSG_RESULT([no, missing dependencies])
181     else
182       ENABLE_FULL_DOCS=true
183       AC_MSG_RESULT([yes, dependencies present])
184     fi
185   else
186     AC_MSG_ERROR([--enable-full-docs can only take yes or no])
187   fi
188 
189   AC_SUBST(ENABLE_FULL_DOCS)
190 
191   # Choose cacerts source file
192   AC_ARG_WITH(cacerts-file, [AS_HELP_STRING([--with-cacerts-file],
193       [specify alternative cacerts file])])
194   AC_MSG_CHECKING([for cacerts file])
195   if test &quot;x$with_cacerts_file&quot; == x; then
196     AC_MSG_RESULT([default])
197   else
198     CACERTS_FILE=$with_cacerts_file
199     if test ! -f &quot;$CACERTS_FILE&quot;; then
200       AC_MSG_RESULT([fail])
201       AC_MSG_ERROR([Specified cacerts file &quot;$CACERTS_FILE&quot; does not exist])
202     fi
203     AC_MSG_RESULT([$CACERTS_FILE])
204   fi
205   AC_SUBST(CACERTS_FILE)
206 
207   # Enable or disable unlimited crypto
208   AC_ARG_ENABLE(unlimited-crypto, [AS_HELP_STRING([--disable-unlimited-crypto],
209       [Disable unlimited crypto policy @&lt;:@enabled@:&gt;@])],,
210       [enable_unlimited_crypto=yes])
211   if test &quot;x$enable_unlimited_crypto&quot; = &quot;xyes&quot;; then
212     UNLIMITED_CRYPTO=true
213   else
214     UNLIMITED_CRYPTO=false
215   fi
216   AC_SUBST(UNLIMITED_CRYPTO)
217 
218   # Should we build the serviceability agent (SA)?
219   INCLUDE_SA=true
220   if HOTSPOT_CHECK_JVM_VARIANT(zero); then
221     INCLUDE_SA=false
222   fi
223   if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix ; then
224     INCLUDE_SA=false
225   fi
226   if test &quot;x$OPENJDK_TARGET_CPU&quot; = xs390x ; then
227     INCLUDE_SA=false
228   fi
229   AC_SUBST(INCLUDE_SA)
230 
231   # Compress jars
232   COMPRESS_JARS=false
233 
234   AC_SUBST(COMPRESS_JARS)
235 
236   # Setup default copyright year. Mostly overridden when building close to a new year.
237   AC_ARG_WITH(copyright-year, [AS_HELP_STRING([--with-copyright-year],
238       [Set copyright year value for build @&lt;:@current year@:&gt;@])])
239   if test &quot;x$with_copyright_year&quot; = xyes; then
240     AC_MSG_ERROR([Copyright year must have a value])
241   elif test &quot;x$with_copyright_year&quot; != x; then
242     COPYRIGHT_YEAR=&quot;$with_copyright_year&quot;
243   else
244     COPYRIGHT_YEAR=`$DATE +&#39;%Y&#39;`
245   fi
246   AC_SUBST(COPYRIGHT_YEAR)
247 
248   # Override default library path
249   AC_ARG_WITH([jni-libpath], [AS_HELP_STRING([--with-jni-libpath],
250       [override default JNI library search path])])
251   AC_MSG_CHECKING([for jni library path])
252   if test &quot;x${with_jni_libpath}&quot; = &quot;x&quot; || test &quot;x${with_jni_libpath}&quot; = &quot;xno&quot;; then
253     AC_MSG_RESULT([default])
254   elif test &quot;x${with_jni_libpath}&quot; = &quot;xyes&quot;; then
255     AC_MSG_RESULT([invalid])
256     AC_MSG_ERROR([The --with-jni-libpath option requires an argument.])
257   else
258     HOTSPOT_OVERRIDE_LIBPATH=${with_jni_libpath}
259     if test &quot;x$OPENJDK_TARGET_OS&quot; != &quot;xlinux&quot; &amp;&amp;
260          test &quot;x$OPENJDK_TARGET_OS&quot; != &quot;xbsd&quot; &amp;&amp;
261          test &quot;x$OPENJDK_TARGET_OS&quot; != &quot;xaix&quot;; then
262       AC_MSG_RESULT([fail])
263       AC_MSG_ERROR([Overriding JNI library path is supported only on Linux, BSD and AIX.])
264     fi
265     AC_MSG_RESULT(${HOTSPOT_OVERRIDE_LIBPATH})
266   fi
267   AC_SUBST(HOTSPOT_OVERRIDE_LIBPATH)
268 
269 ])
270 
271 ###############################################################################
272 #
273 # Enable or disable the elliptic curve crypto implementation
274 #
275 AC_DEFUN_ONCE([JDKOPT_DETECT_INTREE_EC],
276 [
277   AC_MSG_CHECKING([if elliptic curve crypto implementation is present])
278 
279   if test -d &quot;${TOPDIR}/src/jdk.crypto.ec/share/native/libsunec/impl&quot;; then
280     ENABLE_INTREE_EC=true
281     AC_MSG_RESULT([yes])
282   else
283     ENABLE_INTREE_EC=false
284     AC_MSG_RESULT([no])
285   fi
286 
287   AC_SUBST(ENABLE_INTREE_EC)
288 ])
289 
290 AC_DEFUN_ONCE([JDKOPT_SETUP_DEBUG_SYMBOLS],
291 [
292   #
293   # NATIVE_DEBUG_SYMBOLS
294   # This must be done after the toolchain is setup, since we&#39;re looking at objcopy.
295   #
296   AC_MSG_CHECKING([what type of native debug symbols to use])
297   AC_ARG_WITH([native-debug-symbols],
298       [AS_HELP_STRING([--with-native-debug-symbols],
299       [set the native debug symbol configuration (none, internal, external, zipped) @&lt;:@varying@:&gt;@])],
300       [
301         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
302           if test &quot;x$withval&quot; = xexternal || test &quot;x$withval&quot; = xzipped; then
303             AC_MSG_ERROR([AIX only supports the parameters &#39;none&#39; and &#39;internal&#39; for --with-native-debug-symbols])
304           fi
305         fi
306       ],
307       [
308         if test &quot;x$OPENJDK_TARGET_OS&quot; = xaix; then
309           # AIX doesn&#39;t support &#39;external&#39; so use &#39;internal&#39; as default
310           with_native_debug_symbols=&quot;internal&quot;
311         else
312           if test &quot;x$STATIC_BUILD&quot; = xtrue; then
313             with_native_debug_symbols=&quot;none&quot;
314           else
315             with_native_debug_symbols=&quot;external&quot;
316           fi
317         fi
318       ])
319   NATIVE_DEBUG_SYMBOLS=$with_native_debug_symbols
320   AC_MSG_RESULT([$NATIVE_DEBUG_SYMBOLS])
321 
322   if test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xzipped; then
323 
324     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
325       if test &quot;x$OBJCOPY&quot; = x; then
326         # enabling of enable-debug-symbols and can&#39;t find objcopy
327         # this is an error
328         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
329       fi
330     fi
331 
332     COMPILE_WITH_DEBUG_SYMBOLS=true
333     COPY_DEBUG_SYMBOLS=true
334     ZIP_EXTERNAL_DEBUG_SYMBOLS=true
335   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xnone; then
336     COMPILE_WITH_DEBUG_SYMBOLS=false
337     COPY_DEBUG_SYMBOLS=false
338     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
339   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xinternal; then
340     COMPILE_WITH_DEBUG_SYMBOLS=true
341     COPY_DEBUG_SYMBOLS=false
342     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
343   elif test &quot;x$NATIVE_DEBUG_SYMBOLS&quot; = xexternal; then
344 
345     if test &quot;x$OPENJDK_TARGET_OS&quot; = xsolaris || test &quot;x$OPENJDK_TARGET_OS&quot; = xlinux; then
346       if test &quot;x$OBJCOPY&quot; = x; then
347         # enabling of enable-debug-symbols and can&#39;t find objcopy
348         # this is an error
349         AC_MSG_ERROR([Unable to find objcopy, cannot enable native debug symbols])
350       fi
351     fi
352 
353     COMPILE_WITH_DEBUG_SYMBOLS=true
354     COPY_DEBUG_SYMBOLS=true
355     ZIP_EXTERNAL_DEBUG_SYMBOLS=false
356   else
357     AC_MSG_ERROR([Allowed native debug symbols are: none, internal, external, zipped])
358   fi
359 
360   AC_SUBST(COMPILE_WITH_DEBUG_SYMBOLS)
361   AC_SUBST(COPY_DEBUG_SYMBOLS)
362   AC_SUBST(ZIP_EXTERNAL_DEBUG_SYMBOLS)
363 ])
364 
365 ################################################################################
366 #
367 # Native and Java code coverage
368 #
369 AC_DEFUN_ONCE([JDKOPT_SETUP_CODE_COVERAGE],
370 [
371   AC_ARG_ENABLE(native-coverage, [AS_HELP_STRING([--enable-native-coverage],
372       [enable native compilation with code coverage data@&lt;:@disabled@:&gt;@])])
373   GCOV_ENABLED=&quot;false&quot;
374   if test &quot;x$enable_native_coverage&quot; = &quot;xyes&quot;; then
375     case $TOOLCHAIN_TYPE in
376       gcc | clang)
377         AC_MSG_CHECKING([if native coverage is enabled])
378         AC_MSG_RESULT([yes])
379         GCOV_CFLAGS=&quot;-fprofile-arcs -ftest-coverage -fno-inline&quot;
380         GCOV_LDFLAGS=&quot;-fprofile-arcs&quot;
381         JVM_CFLAGS=&quot;$JVM_CFLAGS $GCOV_CFLAGS&quot;
382         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $GCOV_LDFLAGS&quot;
383         CFLAGS_JDKLIB=&quot;$CFLAGS_JDKLIB $GCOV_CFLAGS&quot;
384         CFLAGS_JDKEXE=&quot;$CFLAGS_JDKEXE $GCOV_CFLAGS&quot;
385         CXXFLAGS_JDKLIB=&quot;$CXXFLAGS_JDKLIB $GCOV_CFLAGS&quot;
386         CXXFLAGS_JDKEXE=&quot;$CXXFLAGS_JDKEXE $GCOV_CFLAGS&quot;
387         LDFLAGS_JDKLIB=&quot;$LDFLAGS_JDKLIB $GCOV_LDFLAGS&quot;
388         LDFLAGS_JDKEXE=&quot;$LDFLAGS_JDKEXE $GCOV_LDFLAGS&quot;
389         GCOV_ENABLED=&quot;true&quot;
390         ;;
391       *)
392         AC_MSG_ERROR([--enable-native-coverage only works with toolchain type gcc or clang])
393         ;;
394     esac
395   elif test &quot;x$enable_native_coverage&quot; = &quot;xno&quot;; then
396     AC_MSG_CHECKING([if native coverage is enabled])
397     AC_MSG_RESULT([no])
398   elif test &quot;x$enable_native_coverage&quot; != &quot;x&quot;; then
399     AC_MSG_ERROR([--enable-native-coverage can only be assigned &quot;yes&quot; or &quot;no&quot;])
400   fi
401   AC_SUBST(GCOV_ENABLED)
402 
403   AC_ARG_WITH(jcov, [AS_HELP_STRING([--with-jcov],
404       [jcov library location])])
405   AC_ARG_WITH(jcov-input-jdk, [AS_HELP_STRING([--with-jcov-input-jdk],
406       [jdk image to instrument])])
407   JCOV_HOME=
408   JCOV_INPUT_JDK=
409   JCOV_ENABLED=
410   if test &quot;x$with_jcov&quot; = &quot;x&quot; ; then
411     JCOV_ENABLED=&quot;false&quot;
412   else
413     JCOV_HOME=&quot;$with_jcov&quot;
414     if test ! -f &quot;$JCOV_HOME/lib/jcov.jar&quot;; then
415       AC_MSG_RESULT([fail])
416       AC_MSG_ERROR([Invalid JCov bundle: &quot;$JCOV_HOME/lib/jcov.jar&quot; does not exist])
417     fi
418     JCOV_ENABLED=&quot;true&quot;
419     BASIC_FIXUP_PATH(JCOV_HOME)
420     if test &quot;x$with_jcov_input_jdk&quot; != &quot;x&quot; ; then
421       JCOV_INPUT_JDK=&quot;$with_jcov_input_jdk&quot;
422       if test ! -f &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot;; then
423         AC_MSG_RESULT([fail])
424         AC_MSG_ERROR([Invalid JDK bundle: &quot;$JCOV_INPUT_JDK/bin/java$EXE_SUFFIX&quot; does not exist])
425       fi
426       BASIC_FIXUP_PATH(JCOV_INPUT_JDK)
427     fi
428   fi
429   AC_SUBST(JCOV_ENABLED)
430   AC_SUBST(JCOV_HOME)
431   AC_SUBST(JCOV_INPUT_JDK)
432 ])
433 
434 ###############################################################################
435 #
436 # AddressSanitizer
437 #
438 AC_DEFUN_ONCE([JDKOPT_SETUP_ADDRESS_SANITIZER],
439 [
440   AC_ARG_ENABLE(asan, [AS_HELP_STRING([--enable-asan],
441       [enable AddressSanitizer if possible @&lt;:@disabled@:&gt;@])])
442   ASAN_ENABLED=&quot;no&quot;
443   if test &quot;x$enable_asan&quot; = &quot;xyes&quot;; then
444     case $TOOLCHAIN_TYPE in
445       gcc | clang)
446         AC_MSG_CHECKING([if asan is enabled])
447         AC_MSG_RESULT([yes])
448         ASAN_CFLAGS=&quot;-fsanitize=address -fno-omit-frame-pointer&quot;
449         ASAN_LDFLAGS=&quot;-fsanitize=address&quot;
450         JVM_CFLAGS=&quot;$JVM_CFLAGS $ASAN_CFLAGS&quot;
451         JVM_LDFLAGS=&quot;$JVM_LDFLAGS $ASAN_LDFLAGS&quot;
452         CFLAGS_JDKLIB=&quot;$CFLAGS_JDKLIB $ASAN_CFLAGS&quot;
453         CFLAGS_JDKEXE=&quot;$CFLAGS_JDKEXE $ASAN_CFLAGS&quot;
454         CXXFLAGS_JDKLIB=&quot;$CXXFLAGS_JDKLIB $ASAN_CFLAGS&quot;
455         CXXFLAGS_JDKEXE=&quot;$CXXFLAGS_JDKEXE $ASAN_CFLAGS&quot;
456         LDFLAGS_JDKLIB=&quot;$LDFLAGS_JDKLIB $ASAN_LDFLAGS&quot;
457         LDFLAGS_JDKEXE=&quot;$LDFLAGS_JDKEXE $ASAN_LDFLAGS&quot;
458         ASAN_ENABLED=&quot;yes&quot;
459         ;;
460       *)
461         AC_MSG_ERROR([--enable-asan only works with toolchain type gcc or clang])
462         ;;
463     esac
464   elif test &quot;x$enable_asan&quot; = &quot;xno&quot;; then
465     AC_MSG_CHECKING([if asan is enabled])
466     AC_MSG_RESULT([no])
467   elif test &quot;x$enable_asan&quot; != &quot;x&quot;; then
468     AC_MSG_ERROR([--enable-asan can only be assigned &quot;yes&quot; or &quot;no&quot;])
469   fi
470 
471   AC_SUBST(ASAN_ENABLED)
472 ])
473 
474 ################################################################################
475 #
476 # Static build support.  When enabled will generate static
477 # libraries instead of shared libraries for all JDK libs.
478 #
479 AC_DEFUN_ONCE([JDKOPT_SETUP_STATIC_BUILD],
480 [
481   AC_ARG_ENABLE([static-build], [AS_HELP_STRING([--enable-static-build],
482     [enable static library build @&lt;:@disabled@:&gt;@])])
483   STATIC_BUILD=false
484   if test &quot;x$enable_static_build&quot; = &quot;xyes&quot;; then
485     AC_MSG_CHECKING([if static build is enabled])
486     AC_MSG_RESULT([yes])
487     if test &quot;x$OPENJDK_TARGET_OS&quot; != &quot;xmacosx&quot;; then
488       AC_MSG_ERROR([--enable-static-build is only supported for macosx builds])
489     fi
490     STATIC_BUILD_CFLAGS=&quot;-DSTATIC_BUILD=1&quot;
491     CFLAGS_JDKLIB_EXTRA=&quot;$CFLAGS_JDKLIB_EXTRA $STATIC_BUILD_CFLAGS&quot;
492     CXXFLAGS_JDKLIB_EXTRA=&quot;$CXXFLAGS_JDKLIB_EXTRA $STATIC_BUILD_CFLAGS&quot;
493     STATIC_BUILD=true
494   elif test &quot;x$enable_static_build&quot; = &quot;xno&quot;; then
495     AC_MSG_CHECKING([if static build is enabled])
496     AC_MSG_RESULT([no])
497   elif test &quot;x$enable_static_build&quot; != &quot;x&quot;; then
498     AC_MSG_ERROR([--enable-static-build can only be assigned &quot;yes&quot; or &quot;no&quot;])
499   fi
500 
501   AC_SUBST(STATIC_BUILD)
502 ])
503 
504 ################################################################################
505 #
506 # jlink options.
507 # We always keep packaged modules in JDK image.
508 #
509 AC_DEFUN_ONCE([JDKOPT_SETUP_JLINK_OPTIONS],
510 [
511   AC_ARG_ENABLE([keep-packaged-modules], [AS_HELP_STRING([--disable-keep-packaged-modules],
512     [Do not keep packaged modules in jdk image @&lt;:@enable@:&gt;@])])
513 
514   AC_MSG_CHECKING([if packaged modules are kept])
515   if test &quot;x$enable_keep_packaged_modules&quot; = &quot;xyes&quot;; then
516     AC_MSG_RESULT([yes])
517     JLINK_KEEP_PACKAGED_MODULES=true
518   elif test &quot;x$enable_keep_packaged_modules&quot; = &quot;xno&quot;; then
519     AC_MSG_RESULT([no])
520     JLINK_KEEP_PACKAGED_MODULES=false
521   elif test &quot;x$enable_keep_packaged_modules&quot; = &quot;x&quot;; then
522     AC_MSG_RESULT([yes (default)])
523     JLINK_KEEP_PACKAGED_MODULES=true
524   else
525     AC_MSG_RESULT([error])
526     AC_MSG_ERROR([--enable-keep-packaged-modules accepts no argument])
527   fi
528 
529   AC_SUBST(JLINK_KEEP_PACKAGED_MODULES)
530 ])
531 
532 ################################################################################
533 #
534 # Check if building of the jtreg failure handler should be enabled.
535 #
536 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_FAILURE_HANDLER],
537 [
538   AC_ARG_ENABLE([jtreg-failure-handler], [AS_HELP_STRING([--enable-jtreg-failure-handler],
539     [forces build of the jtreg failure handler to be enabled, missing dependencies
540      become fatal errors. Default is auto, where the failure handler is built if all
541      dependencies are present and otherwise just disabled.])])
542 
543   AC_MSG_CHECKING([if jtreg failure handler should be built])
544 
545   if test &quot;x$enable_jtreg_failure_handler&quot; = &quot;xyes&quot;; then
546     if test &quot;x$JT_HOME&quot; = &quot;x&quot;; then
547       AC_MSG_ERROR([Cannot enable jtreg failure handler without jtreg.])
548     else
549       BUILD_FAILURE_HANDLER=true
550       AC_MSG_RESULT([yes, forced])
551     fi
552   elif test &quot;x$enable_jtreg_failure_handler&quot; = &quot;xno&quot;; then
553     BUILD_FAILURE_HANDLER=false
554     AC_MSG_RESULT([no, forced])
555   elif test &quot;x$enable_jtreg_failure_handler&quot; = &quot;xauto&quot; \
556       || test &quot;x$enable_jtreg_failure_handler&quot; = &quot;x&quot;; then
557     if test &quot;x$JT_HOME&quot; = &quot;x&quot;; then
558       BUILD_FAILURE_HANDLER=false
559       AC_MSG_RESULT([no, missing jtreg])
560     else
561       BUILD_FAILURE_HANDLER=true
562       AC_MSG_RESULT([yes, jtreg present])
563     fi
564   else
565     AC_MSG_ERROR([Invalid value for --enable-jtreg-failure-handler: $enable_jtreg_failure_handler])
566   fi
567 
568   AC_SUBST(BUILD_FAILURE_HANDLER)
569 ])
570 
571 ################################################################################
572 #
573 # Enable or disable generation of the classlist at build time
574 #
575 AC_DEFUN_ONCE([JDKOPT_ENABLE_DISABLE_GENERATE_CLASSLIST],
576 [
577   AC_ARG_ENABLE([generate-classlist], [AS_HELP_STRING([--disable-generate-classlist],
578       [forces enabling or disabling of the generation of a CDS classlist at build time.
579       Default is to generate it when either the server or client JVMs are built and
580       enable-cds is true.])])
581 
582   # Check if it&#39;s likely that it&#39;s possible to generate the classlist. Depending
583   # on exact jvm configuration it could be possible anyway.
584   if test &quot;x$ENABLE_CDS&quot; = &quot;xtrue&quot; &amp;&amp; (HOTSPOT_CHECK_JVM_VARIANT(server) || HOTSPOT_CHECK_JVM_VARIANT(client) || HOTSPOT_CHECK_JVM_FEATURE(cds)); then
585     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;true&quot;
586   else
587     ENABLE_GENERATE_CLASSLIST_POSSIBLE=&quot;false&quot;
588   fi
589 
590   AC_MSG_CHECKING([if the CDS classlist generation should be enabled])
591   if test &quot;x$enable_generate_classlist&quot; = &quot;xyes&quot;; then
592     AC_MSG_RESULT([yes, forced])
593     ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
594     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xfalse&quot;; then
595       AC_MSG_WARN([Generation of classlist might not be possible with JVM Variants $JVM_VARIANTS and enable-cds=$ENABLE_CDS])
596     fi
597   elif test &quot;x$enable_generate_classlist&quot; = &quot;xno&quot;; then
598     AC_MSG_RESULT([no, forced])
599     ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
600   elif test &quot;x$enable_generate_classlist&quot; = &quot;x&quot;; then
601     if test &quot;x$ENABLE_GENERATE_CLASSLIST_POSSIBLE&quot; = &quot;xtrue&quot;; then
602       AC_MSG_RESULT([yes])
603       ENABLE_GENERATE_CLASSLIST=&quot;true&quot;
604     else
605       AC_MSG_RESULT([no])
606       ENABLE_GENERATE_CLASSLIST=&quot;false&quot;
607     fi
608   else
609     AC_MSG_ERROR([Invalid value for --enable-generate-classlist: $enable_generate_classlist])
610   fi
611 
612   AC_SUBST(ENABLE_GENERATE_CLASSLIST)
613 ])
614 
615 ################################################################################
616 #
617 # Optionally filter resource translations
618 #
619 AC_DEFUN([JDKOPT_EXCLUDE_TRANSLATIONS],
620 [
621   AC_ARG_WITH([exclude-translations], [AS_HELP_STRING([--with-exclude-translations],
622       [a comma separated list of locales to exclude translations for. Default is
623       to include all translations present in the source.])])
624 
625   EXCLUDE_TRANSLATIONS=&quot;&quot;
626   AC_MSG_CHECKING([if any translations should be excluded])
627   if test &quot;x$with_exclude_translations&quot; != &quot;x&quot;; then
628     EXCLUDE_TRANSLATIONS=&quot;${with_exclude_translations//,/ }&quot;
629     AC_MSG_RESULT([yes: $EXCLUDE_TRANSLATIONS])
630   else
631     AC_MSG_RESULT([no])
632   fi
633 
634   AC_SUBST(EXCLUDE_TRANSLATIONS)
635 ])
636 
637 ################################################################################
638 #
639 # Optionally disable man pages
640 #
641 AC_DEFUN([JDKOPT_ENABLE_DISABLE_MANPAGES],
642 [
643   AC_ARG_ENABLE([manpages], [AS_HELP_STRING([--disable-manpages],
644       [Set to disable copy of static man pages @&lt;:@enabled@:&gt;@])])
645 
646   BUILD_MANPAGES=&quot;true&quot;
647   AC_MSG_CHECKING([if static man pages should be copied])
648   if test &quot;x$enable_manpages&quot; = &quot;x&quot;; then
649     AC_MSG_RESULT([yes])
650   elif test &quot;x$enable_manpages&quot; = &quot;xyes&quot;; then
651     AC_MSG_RESULT([yes, forced])
652   elif test &quot;x$enable_manpages&quot; = &quot;xno&quot;; then
653     AC_MSG_RESULT([no, forced])
654     BUILD_MANPAGES=&quot;false&quot;
655   else
656     AC_MSG_RESULT([no])
657     AC_MSG_ERROR([--enable-manpages can only yes/no or empty])
658   fi
659 
660   AC_SUBST(BUILD_MANPAGES)
661 ])
662 
663 ################################################################################
664 #
665 # Disable the default CDS archive generation
666 #   cross compilation - disabled
667 #
668 AC_DEFUN([JDKOPT_ENABLE_DISABLE_CDS_ARCHIVE],
669 [
670   AC_ARG_ENABLE([cds-archive], [AS_HELP_STRING([--disable-cds-archive],
671       [Set to disable generation of a default CDS archive in the product image @&lt;:@enabled@:&gt;@])])
672 
673   AC_MSG_CHECKING([if a default CDS archive should be generated])
674   if test &quot;x$ENABLE_CDS&quot; = &quot;xfalse&quot;; then
675     AC_MSG_RESULT([no, because CDS is disabled])
676     BUILD_CDS_ARCHIVE=&quot;false&quot;
677   elif test &quot;x$COMPILE_TYPE&quot; = &quot;xcross&quot;; then
678     AC_MSG_RESULT([no, not possible with cross compilation])
679     BUILD_CDS_ARCHIVE=&quot;false&quot;
680   elif test &quot;x$enable_cds_archive&quot; = &quot;xyes&quot;; then
681     AC_MSG_RESULT([yes, forced])
682     BUILD_CDS_ARCHIVE=&quot;true&quot;
683   elif test &quot;x$enable_cds_archive&quot; = &quot;x&quot;; then
684     AC_MSG_RESULT([yes])
685     BUILD_CDS_ARCHIVE=&quot;true&quot;
686   elif test &quot;x$enable_cds_archive&quot; = &quot;xno&quot;; then
687     AC_MSG_RESULT([no, forced])
688     BUILD_CDS_ARCHIVE=&quot;false&quot;
689   else
690     AC_MSG_RESULT([no])
691     AC_MSG_ERROR([--enable-cds_archive can only be yes/no or empty])
692   fi
693 
694   AC_SUBST(BUILD_CDS_ARCHIVE)
695 ])
    </pre>
  </body>
</html>