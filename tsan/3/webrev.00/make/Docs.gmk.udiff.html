<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/Docs.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="CreateJmods.gmk.udiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="ExplodedImageOptimize.gmk.udiff.html" target="_top">next &gt;</a></center>    <h2>make/Docs.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -30,10 +30,11 @@</span>
  include Modules.gmk
  include ModuleTools.gmk
  include ProcessMarkdown.gmk
  include ToolsJdk.gmk
  include ZipArchive.gmk
<span class="udiff-line-added">+ include TextFileProcessing.gmk</span>
  
  # This is needed to properly setup DOCS_MODULES.
  $(eval $(call ReadImportMetaData))
  
  ################################################################################
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -62,11 +63,11 @@</span>
      $(SUPPORT_OUTPUTDIR)/rmic/* $(TOPDIR)/src/*/share/doc/stub)
  
  # URLs
  JAVADOC_BASE_URL := https://docs.oracle.com/pls/topic/lookup?ctx=javase$(VERSION_NUMBER)&amp;amp;id=homepage
  BUG_SUBMIT_URL := https://bugreport.java.com/bugreport/
<span class="udiff-line-modified-removed">- COPYRIGHT_URL := {@docroot}/../legal/copyright.html</span>
<span class="udiff-line-modified-added">+ COPYRIGHT_URL := legal/copyright.html</span>
  LICENSE_URL := https://www.oracle.com/technetwork/java/javase/terms/license/java$(VERSION_NUMBER)speclicense.html
  REDISTRIBUTION_URL := https://www.oracle.com/technetwork/java/redist-137594.html
  
  # In order to get a specific ordering it&#39;s necessary to specify the total
  # ordering of tags as the tags are otherwise ordered in order of definition.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -82,19 +83,21 @@</span>
      -tag &#39;implSpec:a:Implementation Requirements:&#39; \
      -tag &#39;implNote:a:Implementation Note:&#39; \
      -tag param \
      -tag return \
      -tag throws \
<span class="udiff-line-added">+     -taglet build.tools.taglet.JSpec\$$JLS \</span>
<span class="udiff-line-added">+     -taglet build.tools.taglet.JSpec\$$JVMS \</span>
      -taglet build.tools.taglet.ModuleGraph \
<span class="udiff-line-added">+     -taglet build.tools.taglet.ToolGuide \</span>
      -tag since \
      -tag serialData \
      -tag factory \
      -tag see \
<span class="udiff-line-removed">-     -tag &#39;jvms:a:See &lt;cite&gt;The Java&amp;trade; Virtual Machine Specification&lt;/cite&gt;:&#39; \</span>
<span class="udiff-line-removed">-     -tag &#39;jls:a:See &lt;cite&gt;The Java&amp;trade; Language Specification&lt;/cite&gt;:&#39; \</span>
      -taglet build.tools.taglet.ExtLink \
      -taglet build.tools.taglet.Incubating \
<span class="udiff-line-added">+     -taglet build.tools.taglet.Preview \</span>
      -tagletpath $(BUILDTOOLS_OUTPUTDIR)/jdk_tools_classes \
      $(CUSTOM_JAVADOC_TAGS) \
      #
  
  # The reference tags must stay stable to allow for comparisons across the
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -133,38 +136,42 @@</span>
  JAVA_PLATFORM := Java Platform
  
  ifeq ($(IS_DRAFT), true)
    DRAFT_MARKER_STR := &lt;br&gt;&lt;strong&gt;DRAFT $(VERSION_STRING)&lt;/strong&gt;
    ifeq ($(VERSION_BUILD), 0)
<span class="udiff-line-modified-removed">-     DRAFT_MARKER_TITLE := [ad-hoc build]</span>
<span class="udiff-line-modified-added">+     DRAFT_MARKER_TITLE := $(SPACE)[ad-hoc build]</span>
    else
<span class="udiff-line-modified-removed">-     DRAFT_MARKER_TITLE := [build $(VERSION_BUILD)]</span>
<span class="udiff-line-modified-added">+     DRAFT_MARKER_TITLE := $(SPACE)[build $(VERSION_BUILD)]</span>
    endif
    DRAFT_TEXT := This specification is not final and is subject to change. \
        Use is subject to &lt;a href=&quot;$(LICENSE_URL)&quot;&gt;license terms&lt;/a&gt;.
  
    # Workaround stylesheet bug
    HEADER_STYLE := style=&quot;margin-top: 9px;&quot;
  else
    HEADER_STYLE := style=&quot;margin-top: 14px;&quot;
  endif
  
<span class="udiff-line-added">+ # $1 - Relative prefix to COPYRIGHT_URL</span>
<span class="udiff-line-added">+ COPYRIGHT_BOTTOM = \</span>
<span class="udiff-line-added">+     &lt;a href=&quot;$(strip $1)$(COPYRIGHT_URL)&quot;&gt;Copyright&lt;/a&gt; \</span>
<span class="udiff-line-added">+     &amp;copy; 1993, $(COPYRIGHT_YEAR), $(FULL_COMPANY_NAME), \</span>
<span class="udiff-line-added">+     $(COMPANY_ADDRESS).&lt;br&gt;All rights reserved. \</span>
<span class="udiff-line-added">+     Use is subject to &lt;a href=&quot;$(LICENSE_URL)&quot;&gt;license terms&lt;/a&gt; and the \</span>
<span class="udiff-line-added">+     &lt;a href=&quot;$(REDISTRIBUTION_URL)&quot;&gt;documentation redistribution policy&lt;/a&gt;. \</span>
<span class="udiff-line-added">+     $(DRAFT_MARKER_STR) &lt;!-- Version $(VERSION_STRING) --&gt;</span>
<span class="udiff-line-added">+ </span>
  JAVADOC_BOTTOM := \
      &lt;a href=&quot;$(BUG_SUBMIT_URL)&quot;&gt;Report a bug or suggest an enhancement&lt;/a&gt;&lt;br&gt; \
      For further API reference and developer documentation see the \
      &lt;a href=&quot;$(JAVADOC_BASE_URL)&quot; target=&quot;_blank&quot;&gt;Java SE \
      Documentation&lt;/a&gt;, which contains more detailed, \
      developer-targeted descriptions with conceptual overviews, definitions \
      of terms, workarounds, and working code examples.&lt;br&gt; \
      Java is a trademark or registered trademark of $(FULL_COMPANY_NAME) in \
      the US and other countries.&lt;br&gt; \
<span class="udiff-line-modified-removed">-     &lt;a href=&quot;$(COPYRIGHT_URL)&quot;&gt;Copyright&lt;/a&gt; \</span>
<span class="udiff-line-removed">-     &amp;copy; 1993, $(COPYRIGHT_YEAR), $(FULL_COMPANY_NAME), \</span>
<span class="udiff-line-removed">-     $(COMPANY_ADDRESS).&lt;br&gt;All rights reserved. \</span>
<span class="udiff-line-removed">-     Use is subject to &lt;a href=&quot;$(LICENSE_URL)&quot;&gt;license terms&lt;/a&gt; and the \</span>
<span class="udiff-line-removed">-     &lt;a href=&quot;$(REDISTRIBUTION_URL)&quot;&gt;documentation redistribution policy&lt;/a&gt;. \</span>
<span class="udiff-line-removed">-     $(DRAFT_MARKER_STR) &lt;!-- Version $(VERSION_STRING) --&gt;</span>
<span class="udiff-line-modified-added">+     $(call COPYRIGHT_BOTTOM, {@docroot}/../)</span>
  
  JAVADOC_TOP := \
      &lt;div style=&quot;padding: 6px; text-align: center; font-size: 80%; \
      font-family: DejaVu Sans, Arial, Helvetica, sans-serif; \
      font-weight: normal;&quot;&gt;$(DRAFT_TEXT)&lt;/div&gt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -183,30 +190,30 @@</span>
  JAVASE_LONG_NAME := Java&lt;sup&gt;&amp;reg;&lt;/sup&gt; Platform, Standard Edition
  
  ################################################################################
  # Functions
  
<span class="udiff-line-modified-removed">- # Helper function for creating a png file from a dot file generated by the</span>
<span class="udiff-line-modified-added">+ # Helper function for creating a svg file from a dot file generated by the</span>
  # GenGraphs tool.
  # param 1: SetupJavadocGeneration namespace ($1)
  # param 2: module name
  #
<span class="udiff-line-modified-removed">- define setup_gengraph_dot_to_png</span>
<span class="udiff-line-modified-added">+ define setup_gengraph_dot_to_svg</span>
    $1_$2_DOT_SRC :=  $$($1_GENGRAPHS_DIR)/$2.dot
<span class="udiff-line-modified-removed">-   $1_$2_PNG_TARGET := $$($1_TARGET_DIR)/$2/module-graph.png</span>
<span class="udiff-line-modified-added">+   $1_$2_SVG_TARGET := $$($1_TARGET_DIR)/$2/module-graph.svg</span>
  
<span class="udiff-line-modified-removed">-     # For each module needing a graph, create a png file from the dot file</span>
<span class="udiff-line-modified-added">+     # For each module needing a graph, create a svg file from the dot file</span>
      # generated by the GenGraphs tool and store it in the target dir.
<span class="udiff-line-modified-removed">-     $$(eval $$(call SetupExecute, gengraphs_png_$1_$2, \</span>
<span class="udiff-line-modified-added">+     $$(eval $$(call SetupExecute, gengraphs_svg_$1_$2, \</span>
          INFO := Running dot for module graphs for $2, \
          DEPS := $$(gengraphs_$1_TARGET), \
<span class="udiff-line-modified-removed">-         OUTPUT_FILE := $$($1_$2_PNG_TARGET), \</span>
<span class="udiff-line-modified-added">+         OUTPUT_FILE := $$($1_$2_SVG_TARGET), \</span>
          SUPPORT_DIR := $$($1_GENGRAPHS_DIR), \
<span class="udiff-line-modified-removed">-         COMMAND := $$(DOT) -Tpng -o $$($1_$2_PNG_TARGET) $$($1_$2_DOT_SRC), \</span>
<span class="udiff-line-modified-added">+         COMMAND := $$(DOT) -Tsvg -o $$($1_$2_SVG_TARGET) $$($1_$2_DOT_SRC), \</span>
      ))
  
<span class="udiff-line-modified-removed">-   $1_MODULEGRAPH_TARGETS += $$($1_$2_PNG_TARGET)</span>
<span class="udiff-line-modified-added">+   $1_MODULEGRAPH_TARGETS += $$($1_$2_SVG_TARGET)</span>
  endef
  
  # Helper function to create the overview.html file to use with the -overview
  # javadoc option.
  # Returns the filename as $1_OVERVIEW.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -268,15 +275,16 @@</span>
    # Figure out all modules, both specified and transitive indirect exports, that
    # will be processed by javadoc.
    $1_INDIRECT_EXPORTS := $$(call FindTransitiveIndirectDepsForModules, $$($1_MODULES))
    $1_ALL_MODULES := $$(sort $$($1_MODULES) $$($1_INDIRECT_EXPORTS))
  
<span class="udiff-line-modified-removed">-   $1_JAVA_ARGS := -Dextlink.spec.version=$$(VERSION_SPECIFICATION)</span>
<span class="udiff-line-modified-added">+   $1_JAVA_ARGS := -Dextlink.spec.version=$$(VERSION_SPECIFICATION) \</span>
<span class="udiff-line-added">+ 	-Djspec.version=$$(VERSION_SPECIFICATION)</span>
  
    ifeq ($$(ENABLE_FULL_DOCS), true)
      # Tell the ModuleGraph taglet to generate html links to soon-to-be-created
<span class="udiff-line-modified-removed">-     # png files with module graphs.</span>
<span class="udiff-line-modified-added">+     # svg files with module graphs.</span>
      $1_JAVA_ARGS += -DenableModuleGraph=true
    endif
  
    # Start with basic options and tags
    ifeq ($$($1_OPTIONS), )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -294,11 +302,11 @@</span>
    $1_OPTIONS += -Xdoclint:all,$$(call CommaList, $$(addprefix -, \
        $$(JAVADOC_DISABLED_DOCLINT)))
  
    $1_DOC_TITLE := $$($1_LONG_NAME)&lt;br&gt;Version $$(VERSION_SPECIFICATION) API \
        Specification
<span class="udiff-line-modified-removed">-   $1_WINDOW_TITLE := $$(subst &amp;amp;,&amp;,$$($1_SHORT_NAME)) $$(DRAFT_MARKER_TITLE)</span>
<span class="udiff-line-modified-added">+   $1_WINDOW_TITLE := $$(subst &amp;amp;,&amp;,$$($1_SHORT_NAME))$$(DRAFT_MARKER_TITLE)</span>
    $1_HEADER_TITLE := &lt;div $$(HEADER_STYLE)&gt;&lt;strong&gt;$$($1_SHORT_NAME)&lt;/strong&gt; \
        $$(DRAFT_MARKER_STR)&lt;/div&gt;
  
    $1_OPTIONS += -doctitle &#39;$$($1_DOC_TITLE)&#39;
    $1_OPTIONS += -windowtitle &#39;$$($1_WINDOW_TITLE)&#39;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -335,11 +343,11 @@</span>
        $$($1_ALL_MODULES) $$($1_JAVADOC_CMD)
    $1_VARDEPS_FILE := $$(call DependOnVariable, $1_VARDEPS, \
        $$(SUPPORT_OUTPUTDIR)/docs/$1.vardeps)
  
    # Get a list of all files in all the source dirs for all included modules
<span class="udiff-line-modified-removed">-   $1_SOURCE_DEPS := $$(call CacheFind, $$(wildcard $$(foreach module, \</span>
<span class="udiff-line-modified-added">+   $1_SOURCE_DEPS := $$(call FindFiles, $$(wildcard $$(foreach module, \</span>
        $$($1_ALL_MODULES), $$(call FindModuleSrcDirs, $$(module)))))
  
    $$(eval $$(call SetupExecute, javadoc_$1, \
        WARN := Generating $1 javadoc for $$(words $$($1_ALL_MODULES)) modules, \
        INFO := Javadoc modules: $$($1_ALL_MODULES), \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -352,12 +360,12 @@</span>
    ))
  
    $1_JAVADOC_TARGETS := $$(javadoc_$1_TARGET)
  
    ifeq ($$(ENABLE_FULL_DOCS), true)
<span class="udiff-line-modified-removed">-     # We have asked ModuleGraph to generate links to png files. Now we must</span>
<span class="udiff-line-modified-removed">-     # produce the png files.</span>
<span class="udiff-line-modified-added">+     # We have asked ModuleGraph to generate links to svg files. Now we must</span>
<span class="udiff-line-modified-added">+     # produce the svg files.</span>
  
      # Locate which modules has the @moduleGraph tag in their module-info.java
      $1_MODULES_NEEDING_GRAPH := $$(strip $$(foreach m, $$($1_ALL_MODULES), \
        $$(if $$(shell $$(GREP) -e @moduleGraph \
            $$(wildcard $$(addsuffix /module-info.java, \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -378,15 +386,15 @@</span>
          OUTPUT_DIR := $$($1_GENGRAPHS_DIR), \
          COMMAND := $$(TOOL_GENGRAPHS) --spec --output $$($1_GENGRAPHS_DIR) \
              --dot-attributes $$(GENGRAPHS_PROPS), \
      ))
  
<span class="udiff-line-modified-removed">-     # For each module needing a graph, create a png file from the dot file</span>
<span class="udiff-line-modified-added">+     # For each module needing a graph, create a svg file from the dot file</span>
      # generated by the GenGraphs tool and store it in the target dir.
      # They will depend on gengraphs_$1_TARGET, and will be added to $1.
      $$(foreach m, $$($1_MODULES_NEEDING_GRAPH), \
<span class="udiff-line-modified-removed">-       $$(eval $$(call setup_gengraph_dot_to_png,$1,$$m)) \</span>
<span class="udiff-line-modified-added">+       $$(eval $$(call setup_gengraph_dot_to_svg,$1,$$m)) \</span>
      )
    endif
  endef
  
  ################################################################################
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -478,68 +486,124 @@</span>
  # Targets generated are returned in REFERENCE_API_JAVADOC_TARGETS and
  # REFERENCE_API_MODULEGRAPH_TARGETS.
  
  ################################################################################
  
<span class="udiff-line-added">+ # Use this variable to control which spec files are included in the output.</span>
<span class="udiff-line-added">+ # Format: space-delimited list of names, including at most one &#39;%&#39; as a</span>
<span class="udiff-line-added">+ # wildcard. Spec source files match if their filename or any enclosing folder</span>
<span class="udiff-line-added">+ # name matches one of the items in SPEC_FILTER.</span>
<span class="udiff-line-added">+ SPEC_FILTER := %</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ApplySpecFilter = \</span>
<span class="udiff-line-added">+     $(strip $(foreach file, $(1), \</span>
<span class="udiff-line-added">+         $(eval searchkeys := $(subst /, ,$(subst $(WORKSPACE_ROOT),,$(file)))) \</span>
<span class="udiff-line-added">+         $(if $(filter $(SPEC_FILTER), $(searchkeys)), \</span>
<span class="udiff-line-added">+             $(file) \</span>
<span class="udiff-line-added">+         ) \</span>
<span class="udiff-line-added">+     ))</span>
<span class="udiff-line-added">+ </span>
  # Copy the global resources, including the top-level redirect index.html
<span class="udiff-line-modified-removed">- GLOBAL_SPECS_RESOURCES_DIR := $(TOPDIR)/make/data/docs-resources/</span>
<span class="udiff-line-modified-added">+ GLOBAL_SPECS_RESOURCES_DIR := $(TOPDIR)/make/data/docs-resources</span>
  $(eval $(call SetupCopyFiles, COPY_GLOBAL_RESOURCES, \
      SRC := $(GLOBAL_SPECS_RESOURCES_DIR), \
<span class="udiff-line-modified-removed">-     FILES := $(call CacheFind, $(GLOBAL_SPECS_RESOURCES_DIR)), \</span>
<span class="udiff-line-modified-added">+     FILES := $(call ApplySpecFilter, $(call FindFiles, $(GLOBAL_SPECS_RESOURCES_DIR))), \</span>
      DEST := $(DOCS_OUTPUTDIR), \
  ))
  JDK_INDEX_TARGETS += $(COPY_GLOBAL_RESOURCES)
  
  # Copy the legal notices distributed with the docs bundle
  $(eval $(call SetupCopyFiles, COPY_DOCS_LEGAL_NOTICES, \
      SRC := $(TOPDIR)/src/jdk.javadoc/share/legal, \
<span class="udiff-line-modified-removed">-     FILES := $(wildcard $(TOPDIR)/src/jdk.javadoc/share/legal/*), \</span>
<span class="udiff-line-modified-added">+     FILES := $(call ApplySpecFilter, $(wildcard $(TOPDIR)/src/jdk.javadoc/share/legal/*)), \</span>
      DEST := $(DOCS_OUTPUTDIR)/legal, \
  ))
  JDK_INDEX_TARGETS += $(COPY_DOCS_LEGAL_NOTICES)
  
  ################################################################################
  # Copy JDK specs files
  
<span class="udiff-line-modified-removed">- # For all html documentation in $module/share/specs directories, copy it</span>
<span class="udiff-line-modified-added">+ # For all non html/md files in $module/share/specs directories, copy them</span>
  # unmodified
  
  ALL_MODULES := $(call FindAllModules)
<span class="udiff-line-modified-removed">- COPY_SPEC_FILTER := %.html %.gif %.jpg %.mib %.css</span>
<span class="udiff-line-modified-added">+ COPY_SPEC_FILTER := %.gif %.jpg %.mib %.css</span>
  
  $(foreach m, $(ALL_MODULES), \
    $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \
    $(foreach d, $(SPECS_$m), \
<span class="udiff-line-modified-removed">-     $(if $(filter $(COPY_SPEC_FILTER), $(call CacheFind, $d)), \</span>
<span class="udiff-line-modified-added">+     $(if $(call ApplySpecFilter, $(filter $(COPY_SPEC_FILTER), $(call FindFiles, $d))), \</span>
        $(eval $(call SetupCopyFiles, COPY_$m, \
            SRC := $d, \
<span class="udiff-line-modified-removed">-           FILES := $(filter $(COPY_SPEC_FILTER), $(call CacheFind, $d)), \</span>
<span class="udiff-line-modified-added">+           FILES := $(call ApplySpecFilter, $(filter $(COPY_SPEC_FILTER), $(call FindFiles, $d))), \</span>
            DEST := $(DOCS_OUTPUTDIR)/specs/, \
        )) \
        $(eval JDK_SPECS_TARGETS += $(COPY_$m)) \
      ) \
    ) \
  )
  
<span class="udiff-line-added">+ # Create copyright footer variables. We need different variables for different</span>
<span class="udiff-line-added">+ # relative paths to the copyright.html file. The number 0-2 below represent how</span>
<span class="udiff-line-added">+ # many extra directory levels down below the specs dir the specs html file is</span>
<span class="udiff-line-added">+ # located.</span>
<span class="udiff-line-added">+ SPECS_BOTTOM = &lt;footer class=&quot;legal-footer&quot;&gt;&lt;hr/&gt;$(COPYRIGHT_BOTTOM)&lt;/footer&gt;</span>
<span class="udiff-line-added">+ # The legal dir is one ../ below the specs dir, so start with one ../.</span>
<span class="udiff-line-added">+ specs_bottom_rel_path := ../</span>
<span class="udiff-line-added">+ $(foreach n, 0 1 2, \</span>
<span class="udiff-line-added">+   $(eval SPECS_BOTTOM_$n := $(call SPECS_BOTTOM,$(specs_bottom_rel_path))) \</span>
<span class="udiff-line-added">+   $(eval specs_bottom_rel_path := $(specs_bottom_rel_path)../) \</span>
<span class="udiff-line-added">+ )</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ SPECS_TOP := $(if $(filter true, $(IS_DRAFT)), &lt;header class=&quot;draft-header&quot;&gt;$(DRAFT_TEXT)&lt;/header&gt;)</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ # For all html files in $module/share/specs directories, copy and add the</span>
<span class="udiff-line-added">+ # copyright footer.</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ $(foreach m, $(ALL_MODULES), \</span>
<span class="udiff-line-added">+   $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \</span>
<span class="udiff-line-added">+   $(foreach d, $(SPECS_$m), \</span>
<span class="udiff-line-added">+     $(foreach f, $(call ApplySpecFilter, $(filter %.html, $(call FindFiles, $d))), \</span>
<span class="udiff-line-added">+       $(eval $m_$f_NOF_SUBDIRS := $(words $(subst /, $(SPACE), $(subst $d, , $(dir $f))))) \</span>
<span class="udiff-line-added">+       $(eval $m_$f_NAME := PROCESS_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \</span>
<span class="udiff-line-added">+       $(eval $(call SetupTextFileProcessing, $($m_$f_NAME), \</span>
<span class="udiff-line-added">+           SOURCE_FILES := $f, \</span>
<span class="udiff-line-added">+           SOURCE_BASE_DIR := $d, \</span>
<span class="udiff-line-added">+           OUTPUT_DIR := $(DOCS_OUTPUTDIR)/specs/, \</span>
<span class="udiff-line-added">+           REPLACEMENTS := \</span>
<span class="udiff-line-added">+               &lt;body&gt; =&gt; &lt;body&gt;$(SPECS_TOP) ; \</span>
<span class="udiff-line-added">+               &lt;/body&gt; =&gt; $(SPECS_BOTTOM_$($m_$f_NOF_SUBDIRS))&lt;/body&gt;, \</span>
<span class="udiff-line-added">+       )) \</span>
<span class="udiff-line-added">+       $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \</span>
<span class="udiff-line-added">+     ) \</span>
<span class="udiff-line-added">+   ) \</span>
<span class="udiff-line-added">+ )</span>
<span class="udiff-line-added">+ </span>
  ifeq ($(ENABLE_PANDOC), true)
    # For all markdown files in $module/share/specs directories, convert them to
    # html, if we have pandoc (otherwise we&#39;ll just skip this).
  
    GLOBAL_SPECS_DEFAULT_CSS_FILE := $(DOCS_OUTPUTDIR)/resources/jdk-default.css
  
    $(foreach m, $(ALL_MODULES), \
      $(eval SPECS_$m := $(call FindModuleSpecsDirs, $m)) \
      $(foreach d, $(SPECS_$m), \
<span class="udiff-line-modified-removed">-       $(if $(filter %.md, $(call CacheFind, $d)), \</span>
<span class="udiff-line-modified-removed">-         $(eval $m_$d_NAME := SPECS_TO_HTML_$m_$(strip $(call RelativePath, $d, $(TOPDIR)))) \</span>
<span class="udiff-line-modified-removed">-         $(eval $(call SetupProcessMarkdown, $($m_$d_NAME), \</span>
<span class="udiff-line-modified-added">+       $(foreach f, $(call ApplySpecFilter, $(filter %.md, $(call FindFiles, $d))), \</span>
<span class="udiff-line-modified-added">+         $(eval $m_$f_NOF_SUBDIRS := $(words $(subst /, $(SPACE), $(subst $d, , $(dir $f))))) \</span>
<span class="udiff-line-modified-added">+         $(eval $m_$f_NAME := SPECS_TO_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \</span>
<span class="udiff-line-added">+         $(eval $(call SetupProcessMarkdown, $($m_$f_NAME), \</span>
              SRC := $d, \
<span class="udiff-line-modified-removed">-             FILES := $(filter %.md, $(call CacheFind, $d)), \</span>
<span class="udiff-line-modified-added">+             FILES := $f, \</span>
              DEST := $(DOCS_OUTPUTDIR)/specs/, \
              CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \
<span class="udiff-line-added">+             OPTIONS := -V include-before=&#39;$(SPECS_TOP)&#39; -V include-after=&#39;$(SPECS_BOTTOM_$($m_$f_NOF_SUBDIRS))&#39;, \</span>
<span class="udiff-line-added">+             REPLACEMENTS := \</span>
<span class="udiff-line-added">+ 		@@VERSION_SPECIFICATION@@ =&gt; $(VERSION_SPECIFICATION) ; \</span>
<span class="udiff-line-added">+ 		@@VERSION_STRING@@ =&gt; $(VERSION_STRING), \</span>
<span class="udiff-line-added">+             POST_PROCESS := $(TOOL_FIXUPPANDOC), \</span>
          )) \
<span class="udiff-line-modified-removed">-         $(eval JDK_SPECS_TARGETS += $($($m_$d_NAME))) \</span>
<span class="udiff-line-modified-added">+         $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \</span>
        ) \
      ) \
    )
  
    # For all markdown files in $module/share/man directories, convert them to
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -554,23 +618,28 @@</span>
        $(TOPDIR)/make/scripts/pandoc-html-manpage-filter.js
  
    $(foreach m, $(ALL_MODULES), \
      $(eval MAN_$m := $(call FindModuleManDirs, $m)) \
      $(foreach d, $(MAN_$m), \
<span class="udiff-line-modified-removed">-       $(if $(filter %.md, $(call CacheFind, $d)), \</span>
<span class="udiff-line-modified-removed">-         $(eval $m_$d_NAME := MAN_TO_HTML_$m_$(strip $(call RelativePath, $d, $(TOPDIR)))) \</span>
<span class="udiff-line-modified-removed">-         $(eval $(call SetupProcessMarkdown, $($m_$d_NAME), \</span>
<span class="udiff-line-modified-added">+       $(foreach f, $(call ApplySpecFilter, $(filter %.md, $(call FindFiles, $d))), \</span>
<span class="udiff-line-modified-added">+         $(eval $m_$f_NAME := MAN_TO_HTML_$m_$(strip $(call RelativePath, $f, $(TOPDIR)))) \</span>
<span class="udiff-line-modified-added">+         $(eval $(call SetupProcessMarkdown, $($m_$f_NAME), \</span>
              SRC := $d, \
<span class="udiff-line-modified-removed">-             FILES := $(filter %.md, $(call CacheFind, $d)), \</span>
<span class="udiff-line-modified-added">+             FILES := $f, \</span>
              DEST := $(DOCS_OUTPUTDIR)/specs/man, \
              FILTER := $(PANDOC_HTML_MANPAGE_FILTER), \
              CSS := $(GLOBAL_SPECS_DEFAULT_CSS_FILE), \
<span class="udiff-line-modified-removed">-             REPLACEMENTS := @@VERSION_SHORT@@ =&gt; $(VERSION_SHORT), \</span>
<span class="udiff-line-modified-added">+             REPLACEMENTS := \</span>
<span class="udiff-line-added">+ 		@@COPYRIGHT_YEAR@@ =&gt; $(COPYRIGHT_YEAR) ; \</span>
<span class="udiff-line-added">+ 		@@VERSION_SHORT@@ =&gt; $(VERSION_SHORT) ; \</span>
<span class="udiff-line-added">+ 		@@VERSION_SPECIFICATION@@ =&gt; $(VERSION_SPECIFICATION), \</span>
<span class="udiff-line-added">+             OPTIONS := --toc -V include-before=&#39;$(SPECS_TOP)&#39; -V include-after=&#39;$(SPECS_BOTTOM_1)&#39;, \</span>
<span class="udiff-line-added">+             POST_PROCESS := $(TOOL_FIXUPPANDOC), \</span>
              EXTRA_DEPS := $(PANDOC_HTML_MANPAGE_FILTER) \
                  $(PANDOC_HTML_MANPAGE_FILTER_JAVASCRIPT), \
          )) \
<span class="udiff-line-modified-removed">-         $(eval JDK_SPECS_TARGETS += $($($m_$d_NAME))) \</span>
<span class="udiff-line-modified-added">+         $(eval JDK_SPECS_TARGETS += $($($m_$f_NAME))) \</span>
        ) \
      ) \
    )
  
    # The html generated from markdown also needs the css file
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -578,23 +647,33 @@</span>
  endif
  
  # Special treatment for generated documentation
  
  JDWP_PROTOCOL := $(SUPPORT_OUTPUTDIR)/gensrc/jdk.jdi/jdwp-protocol.html
<span class="udiff-line-modified-removed">- $(eval $(call SetupCopyFiles, COPY_JDWP_PROTOCOL, \</span>
<span class="udiff-line-modified-removed">-     FILES := $(JDWP_PROTOCOL), \</span>
<span class="udiff-line-modified-removed">-     DEST := $(DOCS_OUTPUTDIR)/specs/jdwp, \</span>
<span class="udiff-line-modified-removed">- ))</span>
<span class="udiff-line-modified-removed">- JDK_SPECS_TARGETS += $(COPY_JDWP_PROTOCOL)</span>
<span class="udiff-line-modified-added">+ ifneq ($(call ApplySpecFilter, $(JDWP_PROTOCOL)), )</span>
<span class="udiff-line-modified-added">+   $(eval $(call SetupTextFileProcessing, PROCESS_JDWP_PROTOCOL, \</span>
<span class="udiff-line-modified-added">+       SOURCE_FILES := $(JDWP_PROTOCOL), \</span>
<span class="udiff-line-modified-added">+       OUTPUT_DIR := $(DOCS_OUTPUTDIR)/specs/jdwp, \</span>
<span class="udiff-line-modified-added">+       REPLACEMENTS := \</span>
<span class="udiff-line-added">+           &lt;body&gt; =&gt; &lt;body&gt;$(SPECS_TOP) ; \</span>
<span class="udiff-line-added">+           &lt;/body&gt; =&gt; $(SPECS_BOTTOM_1)&lt;/body&gt;, \</span>
<span class="udiff-line-added">+   ))</span>
<span class="udiff-line-added">+   JDK_SPECS_TARGETS += $(PROCESS_JDWP_PROTOCOL)</span>
<span class="udiff-line-added">+ endif</span>
  
  # Get jvmti.html from the main jvm variant (all variants&#39; jvmti.html are identical).
  JVMTI_HTML ?= $(HOTSPOT_OUTPUTDIR)/variant-$(JVM_VARIANT_MAIN)/gensrc/jvmtifiles/jvmti.html
<span class="udiff-line-modified-removed">- $(eval $(call SetupCopyFiles, COPY_JVMTI_HTML, \</span>
<span class="udiff-line-modified-removed">-     FILES := $(JVMTI_HTML), \</span>
<span class="udiff-line-modified-removed">-     DEST := $(DOCS_OUTPUTDIR)/specs, \</span>
<span class="udiff-line-modified-removed">- ))</span>
<span class="udiff-line-modified-removed">- JDK_SPECS_TARGETS += $(COPY_JVMTI_HTML)</span>
<span class="udiff-line-modified-added">+ ifneq ($(call ApplySpecFilter, $(JVMTI_HTML)), )</span>
<span class="udiff-line-modified-added">+   $(eval $(call SetupTextFileProcessing, PROCESS_JVMTI_HTML, \</span>
<span class="udiff-line-modified-added">+       SOURCE_FILES := $(JVMTI_HTML), \</span>
<span class="udiff-line-modified-added">+       OUTPUT_DIR := $(DOCS_OUTPUTDIR)/specs/, \</span>
<span class="udiff-line-modified-added">+       REPLACEMENTS := \</span>
<span class="udiff-line-added">+           &lt;body&gt; =&gt; &lt;body&gt;$(SPECS_TOP) ; \</span>
<span class="udiff-line-added">+           &lt;/body&gt; =&gt; $(SPECS_BOTTOM_0)&lt;/body&gt;, \</span>
<span class="udiff-line-added">+   ))</span>
<span class="udiff-line-added">+   JDK_SPECS_TARGETS += $(PROCESS_JVMTI_HTML)</span>
<span class="udiff-line-added">+ endif</span>
  
  ################################################################################
  # Optional target which bundles all generated javadocs into a zip archive.
  
  JAVADOC_ZIP_NAME := jdk-$(VERSION_STRING)-docs.zip
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -607,10 +686,28 @@</span>
          $(JDK_SPECS_TARGETS), \
  ))
  
  ZIP_TARGETS += $(BUILD_JAVADOC_ZIP)
  
<span class="udiff-line-added">+ ################################################################################</span>
<span class="udiff-line-added">+ # Hook to include the corresponding custom file, if present.</span>
<span class="udiff-line-added">+ $(eval $(call IncludeCustomExtension, Docs-post.gmk))</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ################################################################################</span>
<span class="udiff-line-added">+ # Bundles all generated specs into a zip archive, skipping javadocs.</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ SPECS_ZIP_NAME := jdk-$(VERSION_STRING)-specs.zip</span>
<span class="udiff-line-added">+ SPECS_ZIP_FILE := $(OUTPUTDIR)/bundles/$(SPECS_ZIP_NAME)</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ $(eval $(call SetupZipArchive, BUILD_SPECS_ZIP, \</span>
<span class="udiff-line-added">+     SRC := $(DOCS_OUTPUTDIR), \</span>
<span class="udiff-line-added">+     ZIP := $(SPECS_ZIP_FILE), \</span>
<span class="udiff-line-added">+     EXTRA_DEPS := $(JDK_SPECS_TARGETS), \</span>
<span class="udiff-line-added">+ ))</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ SPECS_ZIP_TARGETS += $(BUILD_SPECS_ZIP)</span>
<span class="udiff-line-added">+ </span>
  ################################################################################
  
  docs-jdk-api-javadoc: $(JDK_API_JAVADOC_TARGETS) $(JDK_API_CUSTOM_TARGETS)
  
  docs-jdk-api-modulegraph: $(JDK_API_MODULEGRAPH_TARGETS)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -627,13 +724,16 @@</span>
  
  docs-jdk-index: $(JDK_INDEX_TARGETS)
  
  docs-zip: $(ZIP_TARGETS)
  
<span class="udiff-line-added">+ docs-specs-zip: $(SPECS_ZIP_TARGETS)</span>
<span class="udiff-line-added">+ </span>
  all: docs-jdk-api-javadoc docs-jdk-api-modulegraph docs-javase-api-javadoc \
      docs-javase-api-modulegraph docs-reference-api-javadoc \
<span class="udiff-line-modified-removed">-     docs-reference-api-modulegraph docs-jdk-specs docs-jdk-index docs-zip</span>
<span class="udiff-line-modified-added">+     docs-reference-api-modulegraph docs-jdk-specs docs-jdk-index docs-zip \</span>
<span class="udiff-line-added">+     docs-specs-zip</span>
  
  .PHONY: default all docs-jdk-api-javadoc docs-jdk-api-modulegraph \
      docs-javase-api-javadoc docs-javase-api-modulegraph \
      docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \
<span class="udiff-line-modified-removed">-     docs-jdk-index docs-zip</span>
<span class="udiff-line-modified-added">+     docs-jdk-index docs-zip docs-specs-zip</span>
</pre>
<center><a href="CreateJmods.gmk.udiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="ExplodedImageOptimize.gmk.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>