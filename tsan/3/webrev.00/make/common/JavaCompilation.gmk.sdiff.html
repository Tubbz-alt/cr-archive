<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/common/JavaCompilation.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="JarArchive.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="JdkNativeCompilation.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/common/JavaCompilation.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
105 # 6. Remove leading and trailing white space. Note that tabs must be explicit
106 #    as sed on macosx does not understand &#39;\t&#39;.
107 # 7. Replace the first \= with just =.
108 # 8. Finally it&#39;s all sorted to create a stable output.
109 #
110 # It is assumed that = is the character used for separating names and values.
111 define add_file_to_clean
112   # param 1 = BUILD_MYPACKAGE
113   # parma 2 = The source file to copy and clean.
114   $2_TARGET:=$2
115   # Remove the source prefix.
116   $$(foreach i,$$($1_SRC),$$(eval $$(call remove_string,$$i,$2_TARGET)))
117   # Now we can setup the depency that will trigger the copying.
118   # To allow for automatic overrides, do not create a rule for a target file that
119   # already has one
120   ifneq ($$($1_CLEAN_$$($2_TARGET)), 1)
121     $1_CLEAN_$$($2_TARGET) := 1
122     $$($1_BIN)$$($1_MODULE_SUBDIR)$$($2_TARGET) : $2
123 	$$(call LogInfo, Cleaning $$(patsubst $(OUTPUTDIR)/%,%, $$@))
124 	$$(call MakeTargetDir)
<span class="line-modified">125 	export LC_ALL=C ; ( $(CAT) $$&lt; &amp;&amp; $(ECHO) &quot;&quot; ) \</span>
126 	    | $(SED) -e &#39;s/\([^\\]\):/\1\\:/g&#39; -e &#39;s/\([^\\]\)=/\1\\=/g&#39; \
127 	        -e &#39;s/\([^\\]\)!/\1\\!/g&#39; -e &#39;s/^[ 	]*#.*/#/g&#39; \
128 	    | $(SED) -f &quot;$(TOPDIR)/make/common/support/unicode2x.sed&quot; \
129 	    | $(SED) -e &#39;/^#/d&#39; -e &#39;/^$$$$/d&#39; \
130 	        -e :a -e &#39;/\\$$$$/N; s/\\\n//; ta&#39; \
131 	        -e &#39;s/^[ 	]*//;s/[ 	]*$$$$//&#39; \
132 	        -e &#39;s/\\=/=/&#39; \
133 	    | $(SORT) &gt; $$@
134 	$(CHMOD) -f ug+w $$@
135 
136     # And do not forget this target
137     $1_ALL_COPY_CLEAN_TARGETS += $$($1_BIN)$$($1_MODULE_SUBDIR)$$($2_TARGET)
138   endif
139 endef
140 
141 define remove_string
142   $2 := $$(subst $1,,$$($2))
143 endef
144 
145 # Setup make rules for compiling Java source code to class files and/or a
</pre>
<hr />
<pre>
205     $$(error The Java compilation $1 refers to a non-existant java compiler setup $$($1_SETUP))
206   endif
207   $1_SJAVAC_PORTFILE := $$($$($1_SETUP)_SJAVAC_PORTFILE)
208   $1_SERVER_JVM := $$($$($1_SETUP)_SERVER_JVM)
209   $1_DISABLE_SJAVAC := $$($$($1_SETUP)_DISABLE_SJAVAC)
210 
211   ifneq ($$($1_MODULE), )
212     $1_MODULE_SUBDIR := /$$($1_MODULE)
213   endif
214 
215   # Make sure the dirs exist, or that one of the EXTRA_FILES, that may not
216   # exist yet, is in it.
217   $$(foreach d, $$($1_SRC), \
218     $$(if $$(wildcard $$d), , \
219       $$(if $$(filter $$d%, $$($1_EXTRA_FILES)), , \
220         $$(error SRC specified to SetupJavaCompilation $1 contains missing directory &gt;$$d&lt;) \
221       ) \
222     ) \
223   )
224   $$(call MakeDir,$$($1_BIN))
<span class="line-modified">225   # Add all source roots to the find cache since we are likely going to run find</span>
<span class="line-modified">226   # on these more than once. The cache will only be updated if necessary.</span>
<span class="line-modified">227   $$(eval $$(call FillCacheFind, $$($1_SRC)))</span>
<span class="line-modified">228   # Find all files in the source trees. Preserve order of source roots so that</span>
<span class="line-modified">229   # the first version in case of multiple instances of the same file is selected.</span>
<span class="line-modified">230   # CacheFind does not preserve order so need to call it for each root.</span>
<span class="line-removed">231   $1_ALL_SRCS += $$($1_EXTRA_FILES) $$(foreach s, $$($1_SRC), $$(call CacheFind, $$s))</span>
232   # Extract the java files.
233   $1_SRCS := $$(filter %.java, $$($1_ALL_SRCS))
234 
235   # Translate include/exclude into patterns
236   ifneq ($$($1_EXCLUDE_FILES), )
237     $1_EXCLUDE_PATTERN := $$(addprefix %, $$($1_EXCLUDE_FILES))
238   endif
239   ifneq ($$($1_INCLUDE_FILES), )
240     $1_INCLUDE_PATTERN := $$(foreach i, $$($1_SRC), $$(addprefix $$i/, $$($1_INCLUDE_FILES)))
241   endif
242   ifneq ($$($1_EXCLUDES), )
243     $1_EXCLUDE_PATTERN += $$(foreach i, $$($1_SRC), $$(addprefix $$i/, $$(addsuffix /%, $$($1_EXCLUDES))))
244   endif
245   ifneq ($$($1_INCLUDES), )
246     $1_INCLUDE_PATTERN += $$(foreach i, $$($1_SRC), $$(addprefix $$i/, $$(addsuffix /%, $$($1_INCLUDES))))
247   endif
248 
249   # Apply include/exclude patterns to java sources
250   ifneq ($$($1_EXCLUDE_PATTERN), )
251     $1_SRCS := $$(filter-out $$($1_EXCLUDE_PATTERN), $$($1_SRCS))
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
105 # 6. Remove leading and trailing white space. Note that tabs must be explicit
106 #    as sed on macosx does not understand &#39;\t&#39;.
107 # 7. Replace the first \= with just =.
108 # 8. Finally it&#39;s all sorted to create a stable output.
109 #
110 # It is assumed that = is the character used for separating names and values.
111 define add_file_to_clean
112   # param 1 = BUILD_MYPACKAGE
113   # parma 2 = The source file to copy and clean.
114   $2_TARGET:=$2
115   # Remove the source prefix.
116   $$(foreach i,$$($1_SRC),$$(eval $$(call remove_string,$$i,$2_TARGET)))
117   # Now we can setup the depency that will trigger the copying.
118   # To allow for automatic overrides, do not create a rule for a target file that
119   # already has one
120   ifneq ($$($1_CLEAN_$$($2_TARGET)), 1)
121     $1_CLEAN_$$($2_TARGET) := 1
122     $$($1_BIN)$$($1_MODULE_SUBDIR)$$($2_TARGET) : $2
123 	$$(call LogInfo, Cleaning $$(patsubst $(OUTPUTDIR)/%,%, $$@))
124 	$$(call MakeTargetDir)
<span class="line-modified">125 	( $(CAT) $$&lt; &amp;&amp; $(ECHO) &quot;&quot; ) \</span>
126 	    | $(SED) -e &#39;s/\([^\\]\):/\1\\:/g&#39; -e &#39;s/\([^\\]\)=/\1\\=/g&#39; \
127 	        -e &#39;s/\([^\\]\)!/\1\\!/g&#39; -e &#39;s/^[ 	]*#.*/#/g&#39; \
128 	    | $(SED) -f &quot;$(TOPDIR)/make/common/support/unicode2x.sed&quot; \
129 	    | $(SED) -e &#39;/^#/d&#39; -e &#39;/^$$$$/d&#39; \
130 	        -e :a -e &#39;/\\$$$$/N; s/\\\n//; ta&#39; \
131 	        -e &#39;s/^[ 	]*//;s/[ 	]*$$$$//&#39; \
132 	        -e &#39;s/\\=/=/&#39; \
133 	    | $(SORT) &gt; $$@
134 	$(CHMOD) -f ug+w $$@
135 
136     # And do not forget this target
137     $1_ALL_COPY_CLEAN_TARGETS += $$($1_BIN)$$($1_MODULE_SUBDIR)$$($2_TARGET)
138   endif
139 endef
140 
141 define remove_string
142   $2 := $$(subst $1,,$$($2))
143 endef
144 
145 # Setup make rules for compiling Java source code to class files and/or a
</pre>
<hr />
<pre>
205     $$(error The Java compilation $1 refers to a non-existant java compiler setup $$($1_SETUP))
206   endif
207   $1_SJAVAC_PORTFILE := $$($$($1_SETUP)_SJAVAC_PORTFILE)
208   $1_SERVER_JVM := $$($$($1_SETUP)_SERVER_JVM)
209   $1_DISABLE_SJAVAC := $$($$($1_SETUP)_DISABLE_SJAVAC)
210 
211   ifneq ($$($1_MODULE), )
212     $1_MODULE_SUBDIR := /$$($1_MODULE)
213   endif
214 
215   # Make sure the dirs exist, or that one of the EXTRA_FILES, that may not
216   # exist yet, is in it.
217   $$(foreach d, $$($1_SRC), \
218     $$(if $$(wildcard $$d), , \
219       $$(if $$(filter $$d%, $$($1_EXTRA_FILES)), , \
220         $$(error SRC specified to SetupJavaCompilation $1 contains missing directory &gt;$$d&lt;) \
221       ) \
222     ) \
223   )
224   $$(call MakeDir,$$($1_BIN))
<span class="line-modified">225   # Order src files according to the order of the src dirs. Correct ordering is</span>
<span class="line-modified">226   # needed for correct overriding between different source roots.</span>
<span class="line-modified">227   $1_ALL_SRC_RAW := $$(call FindFiles, $$($1_SRC))</span>
<span class="line-modified">228   $1_ALL_SRCS := $$($1_EXTRA_FILES) \</span>
<span class="line-modified">229       $$(foreach d, $$($1_SRC), $$(filter $$d%, $$($1_ALL_SRC_RAW)))</span>
<span class="line-modified">230 </span>

231   # Extract the java files.
232   $1_SRCS := $$(filter %.java, $$($1_ALL_SRCS))
233 
234   # Translate include/exclude into patterns
235   ifneq ($$($1_EXCLUDE_FILES), )
236     $1_EXCLUDE_PATTERN := $$(addprefix %, $$($1_EXCLUDE_FILES))
237   endif
238   ifneq ($$($1_INCLUDE_FILES), )
239     $1_INCLUDE_PATTERN := $$(foreach i, $$($1_SRC), $$(addprefix $$i/, $$($1_INCLUDE_FILES)))
240   endif
241   ifneq ($$($1_EXCLUDES), )
242     $1_EXCLUDE_PATTERN += $$(foreach i, $$($1_SRC), $$(addprefix $$i/, $$(addsuffix /%, $$($1_EXCLUDES))))
243   endif
244   ifneq ($$($1_INCLUDES), )
245     $1_INCLUDE_PATTERN += $$(foreach i, $$($1_SRC), $$(addprefix $$i/, $$(addsuffix /%, $$($1_INCLUDES))))
246   endif
247 
248   # Apply include/exclude patterns to java sources
249   ifneq ($$($1_EXCLUDE_PATTERN), )
250     $1_SRCS := $$(filter-out $$($1_EXCLUDE_PATTERN), $$($1_SRCS))
</pre>
</td>
</tr>
</table>
<center><a href="JarArchive.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="JdkNativeCompilation.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>