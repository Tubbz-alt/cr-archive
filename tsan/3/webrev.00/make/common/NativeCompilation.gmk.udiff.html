<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/common/NativeCompilation.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="Modules.gmk.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="ProcessMarkdown.gmk.udiff.html" target="_top">next &gt;</a></center>    <h2>make/common/NativeCompilation.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  #
<span class="udiff-line-modified-removed">- # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+ # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -229,17 +229,19 @@</span>
        $$(OUTPUTDIR)/,,$$($1_OBJ))).json
    $$($1_BASE)_ALL_OBJS_JSON += $$($1_OBJ_JSON)
  
    # Only continue if this object file hasn&#39;t been processed already. This lets
    # the first found source file override any other with the same name.
<span class="udiff-line-modified-removed">-   ifeq ($$(findstring $$($1_OBJ), $$($$($1_BASE)_OBJS_SO_FAR)), )</span>
<span class="udiff-line-modified-removed">-     $$($1_BASE)_OBJS_SO_FAR += $$($1_OBJ)</span>
<span class="udiff-line-modified-added">+   ifeq ($$($1_OBJ_PROCESSED), )</span>
<span class="udiff-line-modified-added">+     $1_OBJ_PROCESSED := true</span>
      # This is the definite source file to use for $1_FILENAME.
      $1_SRC_FILE := $$($1_FILE)
  
<span class="udiff-line-modified-removed">-     ifneq ($$($1_DISABLE_THIS_FILE_DEFINE), true)</span>
<span class="udiff-line-modified-removed">-       $1_THIS_FILE = -DTHIS_FILE=&#39;&quot;$$($1_FILENAME)&quot;&#39;</span>
<span class="udiff-line-modified-added">+     ifneq ($$($1_DEFINE_THIS_FILE), false)</span>
<span class="udiff-line-modified-added">+       ifneq ($$($$($1_BASE)_DEFINE_THIS_FILE), false)</span>
<span class="udiff-line-added">+         $1_THIS_FILE = -DTHIS_FILE=&#39;&quot;$$($1_FILENAME)&quot;&#39;</span>
<span class="udiff-line-added">+       endif</span>
      endif
  
      ifeq ($$($1_OPTIMIZATION), )
        $1_OPT_CFLAGS := $$($$($1_BASE)_OPT_CFLAGS)
        $1_OPT_CXXFLAGS := $$($$($1_BASE)_OPT_CXXFLAGS)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -306,18 +308,22 @@</span>
        $$(error Internal error in NativeCompilation.gmk: no compiler for file $$($1_FILENAME))
      endif
  
      ifeq ($$(filter %.s %.S, $$($1_FILENAME)), )
        # And this is the dependency file for this obj file.
<span class="udiff-line-modified-removed">-       $1_DEP := $$(patsubst %$(OBJ_SUFFIX),%.d,$$($1_OBJ))</span>
<span class="udiff-line-modified-added">+       $1_DEPS_FILE := $$(patsubst %$(OBJ_SUFFIX),%.d,$$($1_OBJ))</span>
        # The dependency target file lists all dependencies as empty targets to
        # avoid make error &quot;No rule to make target&quot; for removed files
<span class="udiff-line-modified-removed">-       $1_DEP_TARGETS := $$(patsubst %$(OBJ_SUFFIX),%.d.targets,$$($1_OBJ))</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-       # Include previously generated dependency information. (if it exists)</span>
<span class="udiff-line-modified-removed">-       -include $$($1_DEP)</span>
<span class="udiff-line-modified-removed">-       -include $$($1_DEP_TARGETS)</span>
<span class="udiff-line-modified-added">+       $1_DEPS_TARGETS_FILE := $$(patsubst %$(OBJ_SUFFIX),%.d.targets,$$($1_OBJ))</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+       # Only try to load individual dependency information files if the global</span>
<span class="udiff-line-modified-added">+       # file hasn&#39;t been loaded (could happen if make was interrupted).</span>
<span class="udiff-line-modified-added">+       ifneq ($$($$($1_BASE)_DEPS_FILE_LOADED), true)</span>
<span class="udiff-line-added">+         # Include previously generated dependency information. (if it exists)</span>
<span class="udiff-line-added">+         -include $$($1_DEPS_FILE)</span>
<span class="udiff-line-added">+         -include $$($1_DEPS_TARGETS_FILE)</span>
<span class="udiff-line-added">+       endif</span>
      endif
  
      ifneq ($$(strip $$($1_CFLAGS) $$($1_CXXFLAGS) $$($1_OPTIMIZATION)), )
        $1_VARDEPS := $$($1_CFLAGS) $$($1_CXXFLAGS) $$($1_OPTIMIZATION)
        $1_VARDEPS_FILE := $$(call DependOnVariable, $1_VARDEPS, $$($1_OBJ).vardeps)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -338,20 +344,20 @@</span>
            ifeq ($(TOOLCHAIN_TYPE)$$(filter %.s, $$($1_FILENAME)), solstudio)
              # The Solaris studio compiler doesn&#39;t output the full path to the
              # object file in the generated deps files. Fixing it with sed. If
              # compiling assembly, don&#39;t try this.
  	    $$(call ExecuteWithLog, $$@, \
<span class="udiff-line-modified-removed">- 	        $$($1_COMPILER) $$($1_DEP_FLAG) $$($1_DEP).tmp $$($1_COMPILE_OPTIONS))</span>
<span class="udiff-line-modified-removed">- 	    $(SED) &#39;s|^$$(@F):|$$@:|&#39; $$($1_DEP).tmp &gt; $$($1_DEP)</span>
<span class="udiff-line-modified-added">+ 	        $$($1_COMPILER) $$($1_DEP_FLAG) $$($1_DEPS_FILE).tmp $$($1_COMPILE_OPTIONS))</span>
<span class="udiff-line-modified-added">+ 	    $(SED) &#39;s|^$$(@F):|$$@:|&#39; $$($1_DEPS_FILE).tmp &gt; $$($1_DEPS_FILE)</span>
            else
  	    $$(call ExecuteWithLog, $$@, \
<span class="udiff-line-modified-removed">- 	        $$($1_COMPILER) $$($1_DEP_FLAG) $$($1_DEP) $$($1_COMPILE_OPTIONS))</span>
<span class="udiff-line-modified-added">+ 	        $$($1_COMPILER) $$($1_DEP_FLAG) $$($1_DEPS_FILE) $$($1_COMPILE_OPTIONS))</span>
            endif
            # Create a dependency target file from the dependency file.
            # Solution suggested by http://make.mad-scientist.net/papers/advanced-auto-dependency-generation/
<span class="udiff-line-modified-removed">-           ifneq ($$($1_DEP), )</span>
<span class="udiff-line-modified-removed">- 	    $(SED) $(DEPENDENCY_TARGET_SED_PATTERN) $$($1_DEP) &gt; $$($1_DEP_TARGETS)</span>
<span class="udiff-line-modified-added">+           ifneq ($$($1_DEPS_FILE), )</span>
<span class="udiff-line-modified-added">+ 	    $(SED) $(DEPENDENCY_TARGET_SED_PATTERN) $$($1_DEPS_FILE) &gt; $$($1_DEPS_TARGETS_FILE)</span>
            endif
          else
            # The Visual Studio compiler lacks a feature for generating make
            # dependencies, but by setting -showIncludes, all included files are
            # printed. These are filtered out and parsed into make dependences.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -361,14 +367,15 @@</span>
            # pipefail is always active on Windows.
  	  $$(call ExecuteWithLog, $$@, \
  	      $$($1_COMPILER) -showIncludes $$($1_COMPILE_OPTIONS)) \
  	      | $(TR) -d &#39;\r&#39; | $(GREP) -v -e &quot;^Note: including file:&quot; \
  	          -e &quot;^$$($1_FILENAME)$$$$&quot; || test &quot;$$$$?&quot; = &quot;1&quot; ; \
<span class="udiff-line-modified-removed">- 	  $(ECHO) $$@: \\ &gt; $$($1_DEP) ; \</span>
<span class="udiff-line-modified-added">+ 	  $(ECHO) $$@: \\ &gt; $$($1_DEPS_FILE) ; \</span>
  	  $(SED) $(WINDOWS_SHOWINCLUDE_SED_PATTERN) $$($1_OBJ).log \
<span class="udiff-line-modified-removed">- 	      | $(SORT) -u &gt;&gt; $$($1_DEP) ; \</span>
<span class="udiff-line-modified-removed">- 	  $(SED) $(DEPENDENCY_TARGET_SED_PATTERN) $$($1_DEP) &gt; $$($1_DEP_TARGETS)</span>
<span class="udiff-line-modified-added">+ 	      | $(SORT) -u &gt;&gt; $$($1_DEPS_FILE) ; \</span>
<span class="udiff-line-modified-added">+ 	  $(ECHO) &gt;&gt; $$($1_DEPS_FILE) ; \</span>
<span class="udiff-line-added">+ 	  $(SED) $(DEPENDENCY_TARGET_SED_PATTERN) $$($1_DEPS_FILE) &gt; $$($1_DEPS_TARGETS_FILE)</span>
          endif
    endif
  endef
  
  # Setup make rules for creating a native binary (a shared library or an
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -388,10 +395,11 @@</span>
  #   LDFLAGS the linker flags to be used, used both for C and C++.
  #   LIBS the libraries to link to
  #   ARFLAGS the archiver flags to be used
  #   OBJECT_DIR the directory where we store the object files
  #   OUTPUT_DIR the directory where the resulting binary is put
<span class="udiff-line-added">+ #   SYMBOLS_DIR the directory where the debug symbols are put, defaults to OUTPUT_DIR</span>
  #   INCLUDES only pick source from these directories
  #   EXCLUDES do not pick source from these directories
  #   INCLUDE_FILES only compile exactly these files!
  #   EXCLUDE_FILES with these names
  #   EXCLUDE_PATTERN exclude files matching any of these substrings
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -420,10 +428,11 @@</span>
  #   ZIP_EXTERNAL_DEBUG_SYMBOLS Set to false to override global setting of debug symbol
  #       zipping
  #   STRIPFLAGS Optionally change the flags given to the strip command
  #   PRECOMPILED_HEADER Header file to use as precompiled header
  #   PRECOMPILED_HEADER_EXCLUDE List of source files that should not use PCH
<span class="udiff-line-added">+ #   DEFINE_THIS_FILE Set to false to not set the THIS_FILE preprocessor macro</span>
  #
  # After being called, some variables are exported from this macro, all prefixed
  # with parameter 1 followed by a &#39;_&#39;:
  #   TARGET The library or executable created by the macro
  #   TARGET_DEPS All prerequisites for the target calculated by the macro
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -443,10 +452,32 @@</span>
      ifeq ($$($1_TYPE), LIBRARY)
        $1_TYPE := STATIC_LIBRARY
      endif
    endif
  
<span class="udiff-line-added">+   $$(call SetIfEmpty, $1_COMPILE_WITH_DEBUG_SYMBOLS, $$(COMPILE_WITH_DEBUG_SYMBOLS))</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   # STATIC_LIBS is set from Main.gmk when building static versions of certain</span>
<span class="udiff-line-added">+   # native libraries.</span>
<span class="udiff-line-added">+   ifeq ($(STATIC_LIBS), true)</span>
<span class="udiff-line-added">+     $1_TYPE := STATIC_LIBRARY</span>
<span class="udiff-line-added">+     # The static versions need to be redirected to different output dirs, both</span>
<span class="udiff-line-added">+     # to not interfere with the main build as well as to not end up inside the</span>
<span class="udiff-line-added">+     # jmods.</span>
<span class="udiff-line-added">+     $1_OBJECT_DIR := $$($1_OBJECT_DIR)/static</span>
<span class="udiff-line-added">+     $1_OUTPUT_DIR := $$($1_OBJECT_DIR)</span>
<span class="udiff-line-added">+     # For release builds where debug symbols are configured to be moved to</span>
<span class="udiff-line-added">+     # separate debuginfo files, disable debug symbols for static libs instead.</span>
<span class="udiff-line-added">+     # We don&#39;t currently support this configuration and we don&#39;t want symbol</span>
<span class="udiff-line-added">+     # information in release builds unless explicitly asked to provide it.</span>
<span class="udiff-line-added">+     ifeq ($(DEBUG_LEVEL), release)</span>
<span class="udiff-line-added">+       ifeq ($(COPY_DEBUG_SYMBOLS), true)</span>
<span class="udiff-line-added">+         $1_COMPILE_WITH_DEBUG_SYMBOLS := false</span>
<span class="udiff-line-added">+       endif</span>
<span class="udiff-line-added">+     endif</span>
<span class="udiff-line-added">+   endif</span>
<span class="udiff-line-added">+ </span>
    ifeq ($$($1_TYPE), EXECUTABLE)
      $1_PREFIX :=
      ifeq ($$($1_SUFFIX), )
        $1_SUFFIX := $(EXE_SUFFIX)
      endif
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -484,10 +515,13 @@</span>
    $1_BASENAME := $$($1_PREFIX)$$($1_NAME)$$($1_SUFFIX)
    $1_TARGET := $$($1_OUTPUT_DIR)/$$($1_BASENAME)
    $1_NOSUFFIX := $$($1_PREFIX)$$($1_NAME)
    $1_SAFE_NAME := $$(strip $$(subst /,_, $1))
  
<span class="udiff-line-added">+ # Need to make sure TARGET is first on list</span>
<span class="udiff-line-added">+   $1 := $$($1_TARGET)</span>
<span class="udiff-line-added">+ </span>
    # Setup the toolchain to be used
    $$(call SetIfEmpty, $1_TOOLCHAIN, TOOLCHAIN_DEFAULT)
    $$(call SetIfEmpty, $1_CC, $$($$($1_TOOLCHAIN)_CC))
    $$(call SetIfEmpty, $1_CXX, $$($$($1_TOOLCHAIN)_CXX))
    $$(call SetIfEmpty, $1_LD, $$($$($1_TOOLCHAIN)_LD))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -498,16 +532,14 @@</span>
    $$(call SetIfEmpty, $1_OBJCOPY, $$($$($1_TOOLCHAIN)_OBJCOPY))
    $$(call SetIfEmpty, $1_STRIP, $$($$($1_TOOLCHAIN)_STRIP))
    $$(call SetIfEmpty, $1_SYSROOT_CFLAGS, $$($$($1_TOOLCHAIN)_SYSROOT_CFLAGS))
    $$(call SetIfEmpty, $1_SYSROOT_LDFLAGS, $$($$($1_TOOLCHAIN)_SYSROOT_LDFLAGS))
  
<span class="udiff-line-removed">-   # Make sure the dirs exist.</span>
<span class="udiff-line-removed">-   $$(call MakeDir, $$($1_OBJECT_DIR) $$($1_OUTPUT_DIR))</span>
    $$(foreach d, $$($1_SRC), $$(if $$(wildcard $$d), , \
        $$(error SRC specified to SetupNativeCompilation $1 contains missing directory $$d)))
  
<span class="udiff-line-modified-removed">-   $1_SRCS_RAW = $$(call CacheFind, $$($1_SRC))</span>
<span class="udiff-line-modified-added">+   $1_SRCS_RAW := $$(call FindFiles, $$($1_SRC))</span>
    # Order src files according to the order of the src dirs
    $1_SRCS := $$(foreach d, $$($1_SRC), $$(filter $$d%, $$($1_SRCS_RAW)))
    $1_SRCS := $$(filter $$(NATIVE_SOURCE_EXTENSIONS), $$($1_SRCS))
    # Extract the C/C++ files.
    ifneq ($$($1_EXCLUDE_PATTERNS), )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -579,10 +611,13 @@</span>
      $1_EXTRA_CFLAGS += $$($1_CFLAGS_release)
      $1_EXTRA_CFLAGS += $$($1_CFLAGS_$(OPENJDK_TARGET_OS_TYPE)_release)
      $1_EXTRA_CFLAGS += $$($1_CFLAGS_$(OPENJDK_TARGET_OS)_release)
      $1_EXTRA_CFLAGS += $$($1_CFLAGS_$(OPENJDK_TARGET_OS)_$(OPENJDK_TARGET_CPU)_release)
    endif
<span class="udiff-line-added">+   ifeq ($(STATIC_LIBS), true)</span>
<span class="udiff-line-added">+     $1_EXTRA_CFLAGS += $$(STATIC_LIBS_CFLAGS)</span>
<span class="udiff-line-added">+   endif</span>
  
    # Pickup extra OPENJDK_TARGET_OS_TYPE and/or OPENJDK_TARGET_OS dependent variables for CXXFLAGS.
    $1_EXTRA_CXXFLAGS := $$($1_CXXFLAGS_$(OPENJDK_TARGET_OS_TYPE)) $$($1_CXXFLAGS_$(OPENJDK_TARGET_OS))
    ifneq ($(DEBUG_LEVEL), release)
      # Pickup extra debug dependent variables for CXXFLAGS
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -592,10 +627,13 @@</span>
    else
      $1_EXTRA_CXXFLAGS += $$($1_CXXFLAGS_release)
      $1_EXTRA_CXXFLAGS += $$($1_CXXFLAGS_$(OPENJDK_TARGET_OS_TYPE)_release)
      $1_EXTRA_CXXFLAGS += $$($1_CXXFLAGS_$(OPENJDK_TARGET_OS)_release)
    endif
<span class="udiff-line-added">+   ifeq ($(STATIC_LIBS), true)</span>
<span class="udiff-line-added">+     $1_EXTRA_CXXFLAGS += $$(STATIC_LIB_CFLAGS)</span>
<span class="udiff-line-added">+   endif</span>
  
    # If no C++ flags are explicitly set, default to using the C flags.
    # After that, we can set additional C++ flags that should not interfere
    # with the mechanism for copying the C flags by default.
    ifeq ($$($1_CXXFLAGS), )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -603,11 +641,11 @@</span>
    endif
    ifeq ($$(strip $$($1_EXTRA_CXXFLAGS)), )
      $1_EXTRA_CXXFLAGS := $$($1_EXTRA_CFLAGS)
    endif
  
<span class="udiff-line-modified-removed">-   ifeq ($(COMPILE_WITH_DEBUG_SYMBOLS), true)</span>
<span class="udiff-line-modified-added">+   ifeq ($$($1_COMPILE_WITH_DEBUG_SYMBOLS), true)</span>
      $1_EXTRA_CFLAGS += $$(CFLAGS_DEBUG_SYMBOLS)
      $1_EXTRA_CXXFLAGS += $$(CFLAGS_DEBUG_SYMBOLS)
      $1_EXTRA_ASFLAGS += $$(ASFLAGS_DEBUG_SYMBOLS)
    endif
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -694,11 +732,11 @@</span>
  
          $$(eval $$(call SetupCompileNativeFile, $1_$$(notdir $$($1_GENERATED_PCH_SRC)), \
              FILE := $$($1_GENERATED_PCH_SRC), \
              BASE := $1, \
              EXTRA_CXXFLAGS := -Fp$$($1_PCH_FILE) -Yc$$(notdir $$($1_PRECOMPILED_HEADER)), \
<span class="udiff-line-modified-removed">-             DISABLE_THIS_FILE_DEFINE := true, \</span>
<span class="udiff-line-modified-added">+             DEFINE_THIS_FILE := false, \</span>
          ))
  
          $1_USE_PCH_FLAGS := \
              -Fp$$($1_PCH_FILE) -Yu$$(notdir $$($1_PRECOMPILED_HEADER))
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -717,24 +755,25 @@</span>
            $1_USE_PCH_FLAGS := -I$$($1_OBJECT_DIR)/precompiled
          else ifeq ($(TOOLCHAIN_TYPE), clang)
            $1_PCH_FILE := $$($1_OBJECT_DIR)/precompiled/$$(notdir $$($1_PRECOMPILED_HEADER)).pch
            $1_USE_PCH_FLAGS := -include-pch $$($1_PCH_FILE)
          endif
<span class="udiff-line-modified-removed">-         $1_PCH_DEP := $$($1_PCH_FILE).d</span>
<span class="udiff-line-modified-removed">-         $1_PCH_DEP_TARGETS := $$($1_PCH_FILE).d.targets</span>
<span class="udiff-line-modified-added">+         $1_PCH_DEPS_FILE := $$($1_PCH_FILE).d</span>
<span class="udiff-line-modified-added">+         $1_PCH_DEPS_TARGETS_FILE := $$($1_PCH_FILE).d.targets</span>
  
<span class="udiff-line-modified-removed">-         -include $$($1_PCH_DEP)</span>
<span class="udiff-line-modified-removed">-         -include $$($1_PCH_DEP_TARGETS)</span>
<span class="udiff-line-modified-added">+         -include $$($1_PCH_DEPS_FILE)</span>
<span class="udiff-line-modified-added">+         -include $$($1_PCH_DEPS_TARGETS_FILE)</span>
  
          $1_PCH_COMMAND := $$($1_CC) $$($1_CFLAGS) $$($1_EXTRA_CFLAGS) $$($1_SYSROOT_CFLAGS) \
<span class="udiff-line-modified-removed">-             $$($1_OPT_CFLAGS) -x c++-header -c $(C_FLAG_DEPS) $$($1_PCH_DEP)</span>
<span class="udiff-line-modified-added">+             $$($1_OPT_CFLAGS) -x c++-header -c $(C_FLAG_DEPS) $$($1_PCH_DEPS_FILE)</span>
  
          $$($1_PCH_FILE): $$($1_PRECOMPILED_HEADER) $$($1_COMPILE_VARDEPS_FILE)
  		$$(call LogInfo, Generating precompiled header)
  		$$(call MakeDir, $$(@D))
  		$$(call ExecuteWithLog, $$@, $$($1_PCH_COMMAND) $$&lt; -o $$@)
<span class="udiff-line-modified-removed">- 		$(SED) $(DEPENDENCY_TARGET_SED_PATTERN) $$($1_PCH_DEP) &gt; $$($1_PCH_DEP_TARGETS)</span>
<span class="udiff-line-modified-added">+ 		$(SED) $(DEPENDENCY_TARGET_SED_PATTERN) $$($1_PCH_DEPS_FILE) \</span>
<span class="udiff-line-added">+ 		    &gt; $$($1_PCH_DEPS_TARGETS_FILE)</span>
  
          $$($1_ALL_OBJS): $$($1_PCH_FILE)
  
          # Generate the corresponding compile_commands.json fragment.
          $1_PCH_FILE_JSON := $$(MAKESUPPORT_OUTPUTDIR)/compile-commands/$$(subst /,_,$$(subst \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -758,28 +797,28 @@</span>
  
    # Setup rule for printing progress info when compiling source files.
    # This is a rough heuristic and may not always print accurate information.
    $$($1_BUILD_INFO): $$($1_SRCS) $$($1_COMPILE_VARDEPS_FILE)
          ifeq ($$(wildcard $$($1_TARGET)), )
<span class="udiff-line-modified-removed">- 	  $(ECHO) &#39;Creating $$(subst $$(OUTPUTDIR)/,,$$($1_TARGET)) from $$(words \</span>
<span class="udiff-line-modified-removed">- 	      $$(filter-out %.vardeps, $$?)) file(s)&#39;</span>
<span class="udiff-line-modified-added">+ 	  $$(call LogWarn, Creating $$(subst $$(OUTPUTDIR)/,,$$($1_TARGET)) from $$(words \</span>
<span class="udiff-line-modified-added">+ 	      $$(filter-out %.vardeps, $$?)) file(s))</span>
          else
<span class="udiff-line-modified-removed">- 	  $(ECHO) $$(strip &#39;Updating $$(subst $$(OUTPUTDIR)/,,$$($1_TARGET))&#39; \</span>
<span class="udiff-line-modified-added">+ 	  $$(call LogWarn, $$(strip Updating $$(subst $$(OUTPUTDIR)/,,$$($1_TARGET)) \</span>
  	      $$(if $$(filter-out %.vardeps, $$?), \
<span class="udiff-line-modified-removed">- 	        &#39;due to $$(words $$(filter-out %.vardeps, $$?)) file(s)&#39;, \</span>
<span class="udiff-line-modified-removed">- 	      $$(if $$(filter %.vardeps, $$?), &#39;due to makefile changes&#39;)))</span>
<span class="udiff-line-modified-added">+ 	        due to $$(words $$(filter-out %.vardeps, $$?)) file(s), \</span>
<span class="udiff-line-modified-added">+ 	      $$(if $$(filter %.vardeps, $$?), due to makefile changes))))</span>
          endif
  	$(TOUCH) $$@
  
    # On windows we need to create a resource file
    ifeq ($(call isTargetOs, windows), true)
      ifneq ($$($1_VERSIONINFO_RESOURCE), )
        $1_RES := $$($1_OBJECT_DIR)/$$($1_BASENAME).res
<span class="udiff-line-modified-removed">-       $1_RES_DEP := $$($1_RES).d</span>
<span class="udiff-line-modified-removed">-       $1_RES_DEP_TARGETS := $$($1_RES).d.targets</span>
<span class="udiff-line-modified-removed">-       -include $$($1_RES_DEP)</span>
<span class="udiff-line-modified-removed">-       -include $$($1_RES_DEP_TARGETS)</span>
<span class="udiff-line-modified-added">+       $1_RES_DEPS_FILE := $$($1_RES).d</span>
<span class="udiff-line-modified-added">+       $1_RES_DEPS_TARGETS_FILE := $$($1_RES).d.targets</span>
<span class="udiff-line-modified-added">+       -include $$($1_RES_DEPS_FILE)</span>
<span class="udiff-line-modified-added">+       -include $$($1_RES_DEPS_TARGETS_FILE)</span>
  
        $1_RES_VARDEPS := $$($1_RC) $$($1_RC_FLAGS)
        $1_RES_VARDEPS_FILE := $$(call DependOnVariable, $1_RES_VARDEPS, \
            $$($1_RES).vardeps)
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -792,23 +831,54 @@</span>
                  # Windows RC compiler does not support -showIncludes, so we mis-use CL
                  # for this. Filter out RC specific arguments that are unknown to CL.
                  # For some unknown reason, in this case CL actually outputs the show
                  # includes to stderr so need to redirect it to hide the output from the
                  # main log.
<span class="udiff-line-modified-removed">- 		$$(call ExecuteWithLog, $$($1_RES_DEP).obj, \</span>
<span class="udiff-line-modified-added">+ 		$$(call ExecuteWithLog, $$($1_RES_DEPS_FILE).obj, \</span>
  		    $$($1_CC) $$(filter-out -l%, $$($1_RC_FLAGS)) \
  		        $$($1_SYSROOT_CFLAGS) -showIncludes -nologo -TC \
<span class="udiff-line-modified-removed">- 		        $(CC_OUT_OPTION)$$($1_RES_DEP).obj -P -Fi$$($1_RES_DEP).pp \</span>
<span class="udiff-line-modified-added">+ 		        $(CC_OUT_OPTION)$$($1_RES_DEPS_FILE).obj -P -Fi$$($1_RES_DEPS_FILE).pp \</span>
  		        $$($1_VERSIONINFO_RESOURCE)) 2&gt;&amp;1 \
  		    | $(TR) -d &#39;\r&#39; | $(GREP) -v -e &quot;^Note: including file:&quot; \
  		        -e &quot;^$$(notdir $$($1_VERSIONINFO_RESOURCE))$$$$&quot; || test &quot;$$$$?&quot; = &quot;1&quot; ; \
<span class="udiff-line-modified-removed">- 		$(ECHO) $$($1_RES): \\ &gt; $$($1_RES_DEP) ; \</span>
<span class="udiff-line-modified-removed">- 		$(SED) $(WINDOWS_SHOWINCLUDE_SED_PATTERN) $$($1_RES_DEP).obj.log &gt;&gt; $$($1_RES_DEP) ; \</span>
<span class="udiff-line-modified-removed">- 		$(SED) $(DEPENDENCY_TARGET_SED_PATTERN) $$($1_RES_DEP) &gt; $$($1_RES_DEP_TARGETS)</span>
<span class="udiff-line-modified-added">+ 		$(ECHO) $$($1_RES): \\ &gt; $$($1_RES_DEPS_FILE) ; \</span>
<span class="udiff-line-modified-added">+ 		$(SED) $(WINDOWS_SHOWINCLUDE_SED_PATTERN) $$($1_RES_DEPS_FILE).obj.log \</span>
<span class="udiff-line-modified-added">+ 		    &gt;&gt; $$($1_RES_DEPS_FILE) ; \</span>
<span class="udiff-line-added">+ 		$(ECHO) &gt;&gt; $$($1_RES_DEPS_FILE) ;\</span>
<span class="udiff-line-added">+ 		$(SED) $(DEPENDENCY_TARGET_SED_PATTERN) $$($1_RES_DEPS_FILE) \</span>
<span class="udiff-line-added">+ 		    &gt; $$($1_RES_DEPS_TARGETS_FILE)</span>
      endif
    endif
  
<span class="udiff-line-added">+   # Create a rule to collect all the individual make dependency files into a</span>
<span class="udiff-line-added">+   # single makefile.</span>
<span class="udiff-line-added">+   $1_DEPS_FILE := $$($1_OBJECT_DIR)/$1.d</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   $$($1_DEPS_FILE): $$($1_ALL_OBJS) $$($1_RES)</span>
<span class="udiff-line-added">+ 	$(RM) $$@</span>
<span class="udiff-line-added">+         # CD into dir to reduce risk of hitting command length limits, which</span>
<span class="udiff-line-added">+         # could otherwise happen if TOPDIR is a very long path.</span>
<span class="udiff-line-added">+ 	$(CD) $$($1_OBJECT_DIR) &amp;&amp; $(CAT) *.d &gt; $$@.tmp</span>
<span class="udiff-line-added">+ 	$(CD) $$($1_OBJECT_DIR) &amp;&amp; $(CAT) *.d.targets | $(SORT) -u &gt;&gt; $$@.tmp</span>
<span class="udiff-line-added">+         # After generating the file, which happens after all objects have been</span>
<span class="udiff-line-added">+         # compiled, copy it to .old extension. On the next make invocation, this</span>
<span class="udiff-line-added">+         # .old file will be included by make.</span>
<span class="udiff-line-added">+ 	$(CP) $$@.tmp $$@.old</span>
<span class="udiff-line-added">+ 	$(MV) $$@.tmp $$@</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   $1 += $$($1_DEPS_FILE)</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   # The include must be on the .old file, which represents the state from the</span>
<span class="udiff-line-added">+   # previous invocation of make. The file being included must not have a rule</span>
<span class="udiff-line-added">+   # defined for it as otherwise make will think it has to run the rule before</span>
<span class="udiff-line-added">+   # being able to include the file, which would be wrong since we specifically</span>
<span class="udiff-line-added">+   # need the file as it was generated by a previous make invocation.</span>
<span class="udiff-line-added">+   ifneq ($$(wildcard $$($1_DEPS_FILE).old), )</span>
<span class="udiff-line-added">+     $1_DEPS_FILE_LOADED := true</span>
<span class="udiff-line-added">+     -include $$($1_DEPS_FILE).old</span>
<span class="udiff-line-added">+   endif</span>
<span class="udiff-line-added">+ </span>
    ifneq ($(DISABLE_MAPFILES), true)
      $1_REAL_MAPFILE := $$($1_MAPFILE)
      ifeq ($(call isTargetOs, windows), false)
        ifneq ($$($1_REORDER), )
          $1_REAL_MAPFILE := $$($1_OBJECT_DIR)/mapfile
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -828,47 +898,45 @@</span>
    $1_EXTRA_LIBS += $$($1_LIBS_$(OPENJDK_TARGET_OS_TYPE)) $$($1_LIBS_$(OPENJDK_TARGET_OS))
    ifneq ($$($1_REAL_MAPFILE), )
      $1_EXTRA_LDFLAGS += $(call SET_SHARED_LIBRARY_MAPFILE,$$($1_REAL_MAPFILE))
    endif
  
<span class="udiff-line-removed">-   # Need to make sure TARGET is first on list</span>
<span class="udiff-line-removed">-   $1 := $$($1_TARGET)</span>
<span class="udiff-line-removed">- </span>
    ifneq ($$($1_COPY_DEBUG_SYMBOLS), false)
      $1_COPY_DEBUG_SYMBOLS := $(COPY_DEBUG_SYMBOLS)
    endif
  
    ifneq ($$($1_ZIP_EXTERNAL_DEBUG_SYMBOLS), false)
      $1_ZIP_EXTERNAL_DEBUG_SYMBOLS := $(ZIP_EXTERNAL_DEBUG_SYMBOLS)
    endif
  
    ifeq ($$($1_COPY_DEBUG_SYMBOLS), true)
      ifneq ($$($1_DEBUG_SYMBOLS), false)
<span class="udiff-line-added">+       $$(call SetIfEmpty, $1_SYMBOLS_DIR, $$($1_OUTPUT_DIR))</span>
        # Only copy debug symbols for dynamic libraries and programs.
        ifneq ($$($1_TYPE), STATIC_LIBRARY)
          # Generate debuginfo files.
          ifeq ($(call isTargetOs, windows), true)
<span class="udiff-line-modified-removed">-           $1_EXTRA_LDFLAGS += -debug &quot;-pdb:$$($1_OUTPUT_DIR)/$$($1_NOSUFFIX).pdb&quot; \</span>
<span class="udiff-line-modified-removed">-               &quot;-map:$$($1_OUTPUT_DIR)/$$($1_NOSUFFIX).map&quot;</span>
<span class="udiff-line-modified-removed">-           $1_DEBUGINFO_FILES := $$($1_OUTPUT_DIR)/$$($1_NOSUFFIX).pdb \</span>
<span class="udiff-line-modified-removed">-               $$($1_OUTPUT_DIR)/$$($1_NOSUFFIX).map</span>
<span class="udiff-line-modified-added">+           $1_EXTRA_LDFLAGS += -debug &quot;-pdb:$$($1_SYMBOLS_DIR)/$$($1_NOSUFFIX).pdb&quot; \</span>
<span class="udiff-line-modified-added">+               &quot;-map:$$($1_SYMBOLS_DIR)/$$($1_NOSUFFIX).map&quot;</span>
<span class="udiff-line-modified-added">+           $1_DEBUGINFO_FILES := $$($1_SYMBOLS_DIR)/$$($1_NOSUFFIX).pdb \</span>
<span class="udiff-line-modified-added">+               $$($1_SYMBOLS_DIR)/$$($1_NOSUFFIX).map</span>
  
          else ifeq ($(call isTargetOs, linux solaris), true)
<span class="udiff-line-modified-removed">-           $1_DEBUGINFO_FILES := $$($1_OUTPUT_DIR)/$$($1_NOSUFFIX).debuginfo</span>
<span class="udiff-line-modified-added">+           $1_DEBUGINFO_FILES := $$($1_SYMBOLS_DIR)/$$($1_NOSUFFIX).debuginfo</span>
            # Setup the command line creating debuginfo files, to be run after linking.
            # It cannot be run separately since it updates the original target file
            $1_CREATE_DEBUGINFO_CMDS := \
                $$($1_OBJCOPY) --only-keep-debug $$($1_TARGET) $$($1_DEBUGINFO_FILES) $$(NEWLINE) \
<span class="udiff-line-modified-removed">-               $(CD) $$($1_OUTPUT_DIR) &amp;&amp; \</span>
<span class="udiff-line-modified-added">+               $(CD) $$($1_SYMBOLS_DIR) &amp;&amp; \</span>
                    $$($1_OBJCOPY) --add-gnu-debuglink=$$($1_DEBUGINFO_FILES) $$($1_TARGET)
  
          else ifeq ($(call isTargetOs, macosx), true)
            $1_DEBUGINFO_FILES := \
<span class="udiff-line-modified-removed">-               $$($1_OUTPUT_DIR)/$$($1_BASENAME).dSYM/Contents/Info.plist \</span>
<span class="udiff-line-modified-removed">-               $$($1_OUTPUT_DIR)/$$($1_BASENAME).dSYM/Contents/Resources/DWARF/$$($1_BASENAME)</span>
<span class="udiff-line-modified-added">+               $$($1_SYMBOLS_DIR)/$$($1_BASENAME).dSYM/Contents/Info.plist \</span>
<span class="udiff-line-modified-added">+               $$($1_SYMBOLS_DIR)/$$($1_BASENAME).dSYM/Contents/Resources/DWARF/$$($1_BASENAME)</span>
            $1_CREATE_DEBUGINFO_CMDS := \
<span class="udiff-line-modified-removed">-               $(DSYMUTIL) --out $$($1_OUTPUT_DIR)/$$($1_BASENAME).dSYM $$($1_TARGET)</span>
<span class="udiff-line-modified-added">+               $(DSYMUTIL) --out $$($1_SYMBOLS_DIR)/$$($1_BASENAME).dSYM $$($1_TARGET)</span>
          endif
  
          # Since the link rule creates more than one file that we want to track,
          # we have to use some tricks to get make to cooperate. To properly
          # trigger downstream dependants of $$($1_DEBUGINFO_FILES), we must have
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -886,18 +954,18 @@</span>
  		$(TOUCH) $$@
  
          $1 += $$($1_DEBUGINFO_FILES)
  
          ifeq ($$($1_ZIP_EXTERNAL_DEBUG_SYMBOLS), true)
<span class="udiff-line-modified-removed">-           $1_DEBUGINFO_ZIP := $$($1_OUTPUT_DIR)/$$($1_NOSUFFIX).diz</span>
<span class="udiff-line-modified-added">+           $1_DEBUGINFO_ZIP := $$($1_SYMBOLS_DIR)/$$($1_NOSUFFIX).diz</span>
            $1 += $$($1_DEBUGINFO_ZIP)
  
            # The dependency on TARGET is needed for debuginfo files
            # to be rebuilt properly.
            $$($1_DEBUGINFO_ZIP): $$($1_DEBUGINFO_FILES) $$($1_TARGET)
<span class="udiff-line-modified-removed">- 		$(CD) $$($1_OUTPUT_DIR) &amp;&amp; \</span>
<span class="udiff-line-modified-removed">- 		    $(ZIPEXE) -q -r $$@ $$(subst $$($1_OUTPUT_DIR)/,, $$($1_DEBUGINFO_FILES))</span>
<span class="udiff-line-modified-added">+ 		$(CD) $$($1_SYMBOLS_DIR) &amp;&amp; \</span>
<span class="udiff-line-modified-added">+ 		    $(ZIPEXE) -q -r $$@ $$(subst $$($1_SYMBOLS_DIR)/,, $$($1_DEBUGINFO_FILES))</span>
  
          endif
         endif # !STATIC_LIBRARY
      endif # $1_DEBUG_SYMBOLS != false
    endif # COPY_DEBUG_SYMBOLS
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -929,10 +997,11 @@</span>
  
      $1_TARGET_DEPS := $$($1_ALL_OBJS) $$($1_RES) $$($1_VARDEPS_FILE) $$(STATIC_MAPFILE_DEP)
  
      $$($1_TARGET): $$($1_TARGET_DEPS)
  	$$(call LogInfo, Building static library $$($1_BASENAME))
<span class="udiff-line-added">+ 	$$(call MakeDir, $$($1_OUTPUT_DIR) $$($1_SYMBOLS_DIR))</span>
  	$$(call ExecuteWithLog, $$($1_OBJECT_DIR)/$$($1_SAFE_NAME)_link, \
  	    $$($1_AR) $$($1_ARFLAGS) $(AR_OUT_OPTION)$$($1_TARGET) $$($1_ALL_OBJS) \
  	        $$($1_RES))
          ifeq ($(STATIC_BUILD), true)
            ifeq ($$($1_USE_MAPFILE_FOR_SYMBOLS), true)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -977,11 +1046,11 @@</span>
        endif
      endif
  
      $1_VARDEPS := $$($1_LD) $$($1_SYSROOT_LDFLAGS) $$($1_LDFLAGS) $$($1_EXTRA_LDFLAGS) \
          $$(GLOBAL_LIBS) $$($1_LIBS) $$($1_EXTRA_LIBS) $$($1_MT) \
<span class="udiff-line-modified-removed">-         $$($1_CODESIGN) $$($1_CREATE_DEBUGINFO_CMDS) $$($1_MANIFEST_VERSION) \</span>
<span class="udiff-line-modified-added">+         $$($1_CREATE_DEBUGINFO_CMDS) $$($1_MANIFEST_VERSION) \</span>
          $$($1_STRIP_CMD)
      $1_VARDEPS_FILE := $$(call DependOnVariable, $1_VARDEPS, \
          $$($1_OBJECT_DIR)/$$($1_NOSUFFIX).vardeps)
  
      $1_LD_OBJ_ARG := $$($1_ALL_OBJS)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1030,11 +1099,13 @@</span>
                    endif
                  endif
                  # Keep as much as possible on one execution line for best performance
                  # on Windows
  		$$(call LogInfo, Linking $$($1_BASENAME))
<span class="udiff-line-added">+ 		$$(call MakeDir, $$($1_OUTPUT_DIR) $$($1_SYMBOLS_DIR))</span>
                  ifeq ($(call isTargetOs, windows), true)
<span class="udiff-line-added">+ </span>
  		  $$(call ExecuteWithLog, $$($1_OBJECT_DIR)/$$($1_SAFE_NAME)_link, \
  		      $$($1_LD) $$($1_LDFLAGS) $$($1_EXTRA_LDFLAGS) $$($1_SYSROOT_LDFLAGS) \
  		          $(LD_OUT_OPTION)$$($1_TARGET) $$($1_LD_OBJ_ARG) $$($1_RES) $$(GLOBAL_LIBS) \
  		          $$($1_LIBS) $$($1_EXTRA_LIBS)) \
  		      | $(GREP) -v &quot;^   Creating library .*\.lib and object .*\.exp&quot; || \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1056,13 +1127,12 @@</span>
                    endif
                  endif
                  # This only works if the openjdk_codesign identity is present on the system. Let
                  # silently fail otherwise.
                  ifneq ($(CODESIGN), )
<span class="udiff-line-modified-removed">-                   ifneq ($$($1_CODESIGN), )</span>
<span class="udiff-line-modified-removed">- 		    $(CODESIGN) -s openjdk_codesign $$@</span>
<span class="udiff-line-removed">-                   endif</span>
<span class="udiff-line-modified-added">+ 		  $(CODESIGN) -s &quot;$(MACOSX_CODESIGN_IDENTITY)&quot; --timestamp --options runtime \</span>
<span class="udiff-line-modified-added">+ 		  --entitlements $(TOPDIR)/make/data/macosxsigning/entitlements.plist $$@</span>
                  endif
    endif
  
    ifeq ($(GENERATE_COMPILE_COMMANDS_ONLY), true)
      $1 := $$($1_ALL_OBJS_JSON)
</pre>
<center><a href="Modules.gmk.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="ProcessMarkdown.gmk.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>