<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/common/JdkNativeCompilation.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="JavaCompilation.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="MakeBase.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/common/JdkNativeCompilation.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 30   $(error You must include MakeBase.gmk prior to including JdkNativeCompilation.gmk)
 31 endif
 32 
 33 include NativeCompilation.gmk
 34 
 35 # Hook to include the corresponding custom file, if present.
 36 $(eval $(call IncludeCustomExtension, common/JdkNativeCompilation.gmk))
 37 
 38 FindSrcDirsForLib += \
 39   $(call uniq, $(wildcard \
 40       $(TOPDIR)/src/$(strip $1)/$(OPENJDK_TARGET_OS)/native/lib$(strip $2) \
 41       $(TOPDIR)/src/$(strip $1)/$(OPENJDK_TARGET_OS_TYPE)/native/lib$(strip $2) \
 42       $(TOPDIR)/src/$(strip $1)/share/native/lib$(strip $2)))
 43 
 44 FindSrcDirsForComponent += \
 45   $(call uniq, $(wildcard \
 46       $(TOPDIR)/src/$(strip $1)/$(OPENJDK_TARGET_OS)/native/$(strip $2) \
 47       $(TOPDIR)/src/$(strip $1)/$(OPENJDK_TARGET_OS_TYPE)/native/$(strip $2) \
 48       $(TOPDIR)/src/$(strip $1)/share/native/$(strip $2)))
 49 
<span class="line-modified"> 50 # Find a library</span>

 51 # Param 1 - module name
 52 # Param 2 - library name
 53 # Param 3 - optional subdir for library
 54 FindLib = \
 55     $(call FindLibDirForModule, \
 56         $(strip $1))$(strip $3)/$(LIBRARY_PREFIX)$(strip $2)$(SHARED_LIBRARY_SUFFIX)
 57 
 58 # Find a static library
 59 # Param 1 - module name
 60 # Param 2 - library name
 61 # Param 3 - optional subdir for library
 62 FindStaticLib = \
 63     $(addprefix $(SUPPORT_OUTPUTDIR)/native/, \
 64         $(strip $1)$(strip $3)/$(LIBRARY_PREFIX)$(strip $2)$(STATIC_LIBRARY_SUFFIX))
 65 
 66 # If only generating compile_commands.json, make these return empty to avoid
 67 # declaring dependencies.
 68 ifeq ($(GENERATE_COMPILE_COMMANDS_ONLY), true)
 69   FindLib =
 70   FindStaticLib =
 71 endif






 72 
 73 GetJavaHeaderDir = \
 74   $(wildcard $(SUPPORT_OUTPUTDIR)/headers/$(strip $1))
 75 
 76 # Process a dir description such as &quot;java.base:headers&quot; into a set of proper absolute paths.
 77 ProcessDir = \
 78   $(if $(findstring :, $1), \
 79     $(call FindSrcDirsForComponent, $(firstword $(subst :, , $1)), $(lastword $(subst :, , $1))) \
 80   , \
 81     $(if $(filter /%, $1), \
 82       $1 \
 83     , \
 84       $(call FindSrcDirsForComponent, $(MODULE), $1) \
 85     ) \
 86   )
 87 
 88 # Setup make rules for creating a native shared library with suitable defaults
 89 # for the OpenJDK project.
 90 #
 91 # Parameter 1 is the name of the rule. This name is used as variable prefix,
</pre>
<hr />
<pre>
105 SetupJdkLibrary = $(NamedParamsMacroTemplate)
106 define SetupJdkLibraryBody
107   ifeq ($$($1_OUTPUT_DIR), )
108     $1_OUTPUT_DIR := $$(call FindLibDirForModule, $$(MODULE))
109   endif
110 
111   ifeq ($$($1_OBJECT_DIR), )
112     $1_OBJECT_DIR := $$(SUPPORT_OUTPUTDIR)/native/$$(MODULE)/lib$$($1_NAME)
113   endif
114 
115   ifeq ($$($1_SRC), )
116     $1_SRC := $$(call FindSrcDirsForLib, $$(MODULE), $$($1_NAME))
117   else
118     $1_SRC := $$(foreach dir, $$($1_SRC), $$(call ProcessDir, $$(dir)))
119   endif
120   ifneq ($$($1_EXTRA_SRC), )
121     $1_SRC += $$(foreach dir, $$($1_EXTRA_SRC), $$(call ProcessDir, $$(dir)))
122   endif
123 
124   ifneq ($$($1_EXCLUDE_SRC_PATTERNS), )
<span class="line-modified">125     $1_EXCLUDE_SRC := $$(call containing, $$($1_EXCLUDE_SRC_PATTERNS), $$($1_SRC))</span>


126     $1_SRC := $$(filter-out $$($1_EXCLUDE_SRC), $$($1_SRC))
127   endif
128 
129   ifeq ($$($1_VERSIONINFO_RESOURCE), )
130     $1_VERSIONINFO_RESOURCE := $$(GLOBAL_VERSION_INFO_RESOURCE)
131   else ifeq ($$($1_VERSIONINFO_RESOURCE), DISABLE)
132     $1_VERSIONINFO_RESOURCE :=
133   endif
134 
135   ifeq ($$($1_RC_FLAGS), )
136     $1_RC_FLAGS :=  $(RC_FLAGS) \
137         -D &quot;JDK_FNAME=$$($1_NAME).dll&quot; \
138         -D &quot;JDK_INTERNAL_NAME=$$($1_NAME)&quot; \
139         -D &quot;JDK_FTYPE=0x2L&quot;
140   else ifeq ($$($1_RC_FLAGS), DISABLE)
141     $1_RC_FLAGS :=
142   endif
143 
144   ifneq ($$($1_HEADERS_FROM_SRC), false)
145     $1_SRC_HEADER_FLAGS := $$(addprefix -I, $$(wildcard $$($1_SRC)))
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 30   $(error You must include MakeBase.gmk prior to including JdkNativeCompilation.gmk)
 31 endif
 32 
 33 include NativeCompilation.gmk
 34 
 35 # Hook to include the corresponding custom file, if present.
 36 $(eval $(call IncludeCustomExtension, common/JdkNativeCompilation.gmk))
 37 
 38 FindSrcDirsForLib += \
 39   $(call uniq, $(wildcard \
 40       $(TOPDIR)/src/$(strip $1)/$(OPENJDK_TARGET_OS)/native/lib$(strip $2) \
 41       $(TOPDIR)/src/$(strip $1)/$(OPENJDK_TARGET_OS_TYPE)/native/lib$(strip $2) \
 42       $(TOPDIR)/src/$(strip $1)/share/native/lib$(strip $2)))
 43 
 44 FindSrcDirsForComponent += \
 45   $(call uniq, $(wildcard \
 46       $(TOPDIR)/src/$(strip $1)/$(OPENJDK_TARGET_OS)/native/$(strip $2) \
 47       $(TOPDIR)/src/$(strip $1)/$(OPENJDK_TARGET_OS_TYPE)/native/$(strip $2) \
 48       $(TOPDIR)/src/$(strip $1)/share/native/$(strip $2)))
 49 
<span class="line-modified"> 50 # Find a library. Used for declaring dependencies on libraries in different</span>
<span class="line-added"> 51 # modules.</span>
 52 # Param 1 - module name
 53 # Param 2 - library name
 54 # Param 3 - optional subdir for library
 55 FindLib = \
 56     $(call FindLibDirForModule, \
 57         $(strip $1))$(strip $3)/$(LIBRARY_PREFIX)$(strip $2)$(SHARED_LIBRARY_SUFFIX)
 58 
 59 # Find a static library
 60 # Param 1 - module name
 61 # Param 2 - library name
 62 # Param 3 - optional subdir for library
 63 FindStaticLib = \
 64     $(addprefix $(SUPPORT_OUTPUTDIR)/native/, \
 65         $(strip $1)$(strip $3)/$(LIBRARY_PREFIX)$(strip $2)$(STATIC_LIBRARY_SUFFIX))
 66 
 67 # If only generating compile_commands.json, make these return empty to avoid
 68 # declaring dependencies.
 69 ifeq ($(GENERATE_COMPILE_COMMANDS_ONLY), true)
 70   FindLib =
 71   FindStaticLib =
 72 endif
<span class="line-added"> 73 # If building static versions of libraries, make these return empty to avoid</span>
<span class="line-added"> 74 # declaring dependencies.</span>
<span class="line-added"> 75 ifeq ($(STATIC_LIBS), true)</span>
<span class="line-added"> 76   FindLib =</span>
<span class="line-added"> 77   FindStaticLib =</span>
<span class="line-added"> 78 endif</span>
 79 
 80 GetJavaHeaderDir = \
 81   $(wildcard $(SUPPORT_OUTPUTDIR)/headers/$(strip $1))
 82 
 83 # Process a dir description such as &quot;java.base:headers&quot; into a set of proper absolute paths.
 84 ProcessDir = \
 85   $(if $(findstring :, $1), \
 86     $(call FindSrcDirsForComponent, $(firstword $(subst :, , $1)), $(lastword $(subst :, , $1))) \
 87   , \
 88     $(if $(filter /%, $1), \
 89       $1 \
 90     , \
 91       $(call FindSrcDirsForComponent, $(MODULE), $1) \
 92     ) \
 93   )
 94 
 95 # Setup make rules for creating a native shared library with suitable defaults
 96 # for the OpenJDK project.
 97 #
 98 # Parameter 1 is the name of the rule. This name is used as variable prefix,
</pre>
<hr />
<pre>
112 SetupJdkLibrary = $(NamedParamsMacroTemplate)
113 define SetupJdkLibraryBody
114   ifeq ($$($1_OUTPUT_DIR), )
115     $1_OUTPUT_DIR := $$(call FindLibDirForModule, $$(MODULE))
116   endif
117 
118   ifeq ($$($1_OBJECT_DIR), )
119     $1_OBJECT_DIR := $$(SUPPORT_OUTPUTDIR)/native/$$(MODULE)/lib$$($1_NAME)
120   endif
121 
122   ifeq ($$($1_SRC), )
123     $1_SRC := $$(call FindSrcDirsForLib, $$(MODULE), $$($1_NAME))
124   else
125     $1_SRC := $$(foreach dir, $$($1_SRC), $$(call ProcessDir, $$(dir)))
126   endif
127   ifneq ($$($1_EXTRA_SRC), )
128     $1_SRC += $$(foreach dir, $$($1_EXTRA_SRC), $$(call ProcessDir, $$(dir)))
129   endif
130 
131   ifneq ($$($1_EXCLUDE_SRC_PATTERNS), )
<span class="line-modified">132     $1_SRC_WITHOUT_WORKSPACE_ROOT := $$(patsubst $$(WORKSPACE_ROOT)/%, %, $$($1_SRC))</span>
<span class="line-added">133     $1_EXCLUDE_SRC := $$(addprefix %, $$(call containing, $$($1_EXCLUDE_SRC_PATTERNS), \</span>
<span class="line-added">134         $$($1_SRC_WITHOUT_WORKSPACE_ROOT)))</span>
135     $1_SRC := $$(filter-out $$($1_EXCLUDE_SRC), $$($1_SRC))
136   endif
137 
138   ifeq ($$($1_VERSIONINFO_RESOURCE), )
139     $1_VERSIONINFO_RESOURCE := $$(GLOBAL_VERSION_INFO_RESOURCE)
140   else ifeq ($$($1_VERSIONINFO_RESOURCE), DISABLE)
141     $1_VERSIONINFO_RESOURCE :=
142   endif
143 
144   ifeq ($$($1_RC_FLAGS), )
145     $1_RC_FLAGS :=  $(RC_FLAGS) \
146         -D &quot;JDK_FNAME=$$($1_NAME).dll&quot; \
147         -D &quot;JDK_INTERNAL_NAME=$$($1_NAME)&quot; \
148         -D &quot;JDK_FTYPE=0x2L&quot;
149   else ifeq ($$($1_RC_FLAGS), DISABLE)
150     $1_RC_FLAGS :=
151   endif
152 
153   ifneq ($$($1_HEADERS_FROM_SRC), false)
154     $1_SRC_HEADER_FLAGS := $$(addprefix -I, $$(wildcard $$($1_SRC)))
</pre>
</td>
</tr>
</table>
<center><a href="JavaCompilation.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="MakeBase.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>