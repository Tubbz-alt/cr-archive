<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/common/TextFileProcessing.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="TestFilesCompilation.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Utils.gmk.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/common/TextFileProcessing.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  #
<span class="line-modified">! # Copyright (c) 2013, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  #
<span class="line-modified">! # Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 56,11 ***</span>
  #   SOURCE_DIRS one or more directory roots to search for files to process
  #   SOURCE_FILES complete paths to one or more files to process
  #   OUTPUT_DIR the directory where we store the processed files.
  #   OUTPUT_FILE the name of the resulting file. Only allowed if processing a
  #       single file.
<span class="line-modified">! #   SOURCE_BASE_DIR a common root to all SOURCE_DIRS.</span>
  #       If specified, files will keep the path relative to the base in the
  #       OUTPUT_DIR. Otherwise, the hierarchy will be flattened into the OUTPUT_DIR.
  #   INCLUDE_FILES only include files matching these patterns (used only with
  #       SOURCE_DIRS)
  #   EXCLUDE_FILES exclude files matching these patterns (used only with
<span class="line-new-header">--- 56,11 ---</span>
  #   SOURCE_DIRS one or more directory roots to search for files to process
  #   SOURCE_FILES complete paths to one or more files to process
  #   OUTPUT_DIR the directory where we store the processed files.
  #   OUTPUT_FILE the name of the resulting file. Only allowed if processing a
  #       single file.
<span class="line-modified">! #   SOURCE_BASE_DIR a common root to all SOURCE_DIRS or SOURCE_FILES.</span>
  #       If specified, files will keep the path relative to the base in the
  #       OUTPUT_DIR. Otherwise, the hierarchy will be flattened into the OUTPUT_DIR.
  #   INCLUDE_FILES only include files matching these patterns (used only with
  #       SOURCE_DIRS)
  #   EXCLUDE_FILES exclude files matching these patterns (used only with
</pre>
<hr />
<pre>
<span class="line-old-header">*** 82,13 ***</span>
  
    ifneq ($$($1_SOURCE_FILES),)
      ifneq ($$($1_SOURCE_DIRS),)
        $$(error Cannot use both SOURCE_FILES and SOURCE_DIRS (in $1))
      endif
<span class="line-removed">-     ifneq ($$($1_SOURCE_BASE_DIR),)</span>
<span class="line-removed">-       $$(error Cannot use SOURCE_BASE_DIR without SOURCE_DIRS (in $1))</span>
<span class="line-removed">-     endif</span>
      ifneq ($$($1_EXCLUDE_FILES)$$($1_INCLUDE_FILES),)
        $$(error Cannot INCLUDE/EXCLUDE_FILES with SOURCE_FILES (in $1))
      endif
    else
      ifeq ($$($1_SOURCE_DIRS),)
<span class="line-new-header">--- 82,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 101,11 ***</span>
        $$(foreach src, $$($1_SOURCE_DIRS), \
            $$(if $$(findstring $$($1_SOURCE_BASE_DIR), $$(src)), , \
            $$(error SOURCE_DIRS contains directory $$(src) outside \
                SOURCE_BASE_DIR $$($1_SOURCE_BASE_DIR) (in $1))))
      endif
<span class="line-modified">!     $1_SOURCE_FILES := $$(sort $$(call CacheFind,$$($1_SOURCE_DIRS)))</span>
      $1_EXCLUDE_FILES:=$$(foreach i,$$($1_SOURCE_DIRS),$$(addprefix $$i/,$$($1_EXCLUDE_FILES)))
      $1_INCLUDE_FILES:=$$(foreach i,$$($1_SOURCE_DIRS),$$(addprefix $$i/,$$($1_INCLUDE_FILES)))
      $1_SOURCE_FILES := $$(filter-out $$($1_EXCLUDE_FILES),$$($1_SOURCE_FILES))
      ifneq (,$$(strip $$($1_INCLUDE_FILES)))
        $1_SOURCE_FILES := $$(filter $$($1_INCLUDE_FILES),$$($1_SOURCE_FILES))
<span class="line-new-header">--- 98,11 ---</span>
        $$(foreach src, $$($1_SOURCE_DIRS), \
            $$(if $$(findstring $$($1_SOURCE_BASE_DIR), $$(src)), , \
            $$(error SOURCE_DIRS contains directory $$(src) outside \
                SOURCE_BASE_DIR $$($1_SOURCE_BASE_DIR) (in $1))))
      endif
<span class="line-modified">!     $1_SOURCE_FILES := $$(sort $$(call FindFiles,$$($1_SOURCE_DIRS)))</span>
      $1_EXCLUDE_FILES:=$$(foreach i,$$($1_SOURCE_DIRS),$$(addprefix $$i/,$$($1_EXCLUDE_FILES)))
      $1_INCLUDE_FILES:=$$(foreach i,$$($1_SOURCE_DIRS),$$(addprefix $$i/,$$($1_INCLUDE_FILES)))
      $1_SOURCE_FILES := $$(filter-out $$($1_EXCLUDE_FILES),$$($1_SOURCE_FILES))
      ifneq (,$$(strip $$($1_INCLUDE_FILES)))
        $1_SOURCE_FILES := $$(filter $$($1_INCLUDE_FILES),$$($1_SOURCE_FILES))
</pre>
<hr />
<pre>
<span class="line-old-header">*** 153,13 ***</span>
      endif
  
      # Convert the REPLACEMENTS syntax ( A =&gt; B ; C =&gt; D ; ...) to a sed command
      # line (-e &quot;s/A/B/g&quot; -e &quot;s/C/D/g&quot; ...), basically by replacing &#39;=&gt;&#39; with &#39;/&#39;
      # and &#39;;&#39; with &#39;/g&quot; -e &quot;s/&#39;, and adjusting for edge cases.
      $1_REPLACEMENTS_COMMAND_LINE := $(SED) -e &#39;s$$($1_SEP)$$(subst $$(SPACE);$$(SPACE),$$($1_SEP)g&#39; \
          -e &#39;s$$($1_SEP),$$(subst $$(SPACE)=&gt;$$(SPACE),$$($1_SEP),$$(subst $$(SPACE)=&gt;$$(SPACE);$$(SPACE),$$($1_SEP)$$($1_SEP)g&#39; \
<span class="line-modified">!         -e &#39;s$$($1_SEP),$$(strip $$($1_REPLACEMENTS)))))$$($1_SEP)g&#39;</span>
    else
      # We don&#39;t have any replacements, just pipe the file through cat.
      $1_REPLACEMENTS_COMMAND_LINE := $(CAT)
    endif
  
<span class="line-new-header">--- 150,14 ---</span>
      endif
  
      # Convert the REPLACEMENTS syntax ( A =&gt; B ; C =&gt; D ; ...) to a sed command
      # line (-e &quot;s/A/B/g&quot; -e &quot;s/C/D/g&quot; ...), basically by replacing &#39;=&gt;&#39; with &#39;/&#39;
      # and &#39;;&#39; with &#39;/g&quot; -e &quot;s/&#39;, and adjusting for edge cases.
<span class="line-added">+     # &#39;&amp;&#39; has special meaning in sed so needs to be escaped.</span>
      $1_REPLACEMENTS_COMMAND_LINE := $(SED) -e &#39;s$$($1_SEP)$$(subst $$(SPACE);$$(SPACE),$$($1_SEP)g&#39; \
          -e &#39;s$$($1_SEP),$$(subst $$(SPACE)=&gt;$$(SPACE),$$($1_SEP),$$(subst $$(SPACE)=&gt;$$(SPACE);$$(SPACE),$$($1_SEP)$$($1_SEP)g&#39; \
<span class="line-modified">!         -e &#39;s$$($1_SEP),$$(subst &amp;,\&amp;,$$(strip $$($1_REPLACEMENTS))))))$$($1_SEP)g&#39;</span>
    else
      # We don&#39;t have any replacements, just pipe the file through cat.
      $1_REPLACEMENTS_COMMAND_LINE := $(CAT)
    endif
  
</pre>
<center><a href="TestFilesCompilation.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Utils.gmk.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>