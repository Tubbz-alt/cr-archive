<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/Init.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Images.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="InitSupport.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/Init.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 30 ################################################################################
 31 
 32 # This must be the first rule
 33 default:
 34 .PHONY: default
 35 
 36 # Inclusion of this pseudo-target will cause make to execute this file
 37 # serially, regardless of -j.
 38 .NOTPARALLEL:
 39 
 40 ifeq ($(HAS_SPEC),)
 41   ##############################################################################
 42   # This is the default mode. We have not been recursively called with a SPEC.
 43   ##############################################################################
 44 
 45   # Include our helper functions.
 46   include $(topdir)/make/InitSupport.gmk
 47 
 48   # Here are &quot;global&quot; targets, i.e. targets that can be executed without having
 49   # a configuration. This will define ALL_GLOBAL_TARGETS.
<span class="line-modified"> 50   include $(topdir)/make/Help.gmk</span>
 51 
 52   # Targets provided by Init.gmk.
 53   ALL_INIT_TARGETS := print-modules print-targets print-configuration \
 54       print-tests reconfigure pre-compare-build post-compare-build
 55 
 56   # CALLED_TARGETS is the list of targets that the user provided,
 57   # or &quot;default&quot; if unspecified.
 58   CALLED_TARGETS := $(if $(MAKECMDGOALS), $(MAKECMDGOALS), default)
 59 
 60   # Extract non-global targets that require a spec file.
 61   CALLED_SPEC_TARGETS := $(filter-out $(ALL_GLOBAL_TARGETS), $(CALLED_TARGETS))
 62 
 63   # If we have only global targets, or if we are called with -qp (assuming an
 64   # external part, e.g. bash completion, is trying to understand our targets),
 65   # we will skip SPEC location and the sanity checks.
 66   ifeq ($(CALLED_SPEC_TARGETS), )
 67     ONLY_GLOBAL_TARGETS := true
 68   endif
 69   ifeq ($(findstring p, $(MAKEFLAGS))$(findstring q, $(MAKEFLAGS)), pq)
 70     ONLY_GLOBAL_TARGETS := true
</pre>
<hr />
<pre>
221   include $(SPEC)
222 
223   # Our helper functions.
224   include $(TOPDIR)/make/InitSupport.gmk
225 
226   # Parse COMPARE_BUILD (for makefile development)
227   $(eval $(call ParseCompareBuild))
228 
229   # If no LOG= was given on command line, but we have a non-standard default
230   # value, use that instead and re-parse log level.
231   ifeq ($(LOG), )
232     ifneq ($(DEFAULT_LOG), )
233       override LOG := $(DEFAULT_LOG)
234       $(eval $(call ParseLogLevel))
235     endif
236   endif
237 
238   ifeq ($(LOG_NOFILE), true)
239     # Disable build log if LOG=[level,]nofile was given
240     override BUILD_LOG_PIPE :=

241   endif
242 
243   ifeq ($(filter dist-clean, $(SEQUENTIAL_TARGETS)), dist-clean)
244     # We can&#39;t have a log file if we&#39;re about to remove it.
245     override BUILD_LOG_PIPE :=

246   endif
247 
248   ifeq ($(OUTPUT_SYNC_SUPPORTED), true)
249     OUTPUT_SYNC_FLAG := -O$(OUTPUT_SYNC)
250   endif
251 
252   ##############################################################################
253   # Init targets
254   ##############################################################################
255 
256   print-modules:
257 	( cd $(TOPDIR) &amp;&amp; \
258 	    $(MAKE) $(MAKE_ARGS) -j 1 -f make/Main.gmk $(USER_MAKE_VARS) \
259 	    NO_RECIPES=true print-modules )
260 
261   print-targets:
262 	( cd $(TOPDIR) &amp;&amp; \
263 	    $(MAKE) $(MAKE_ARGS) -j 1 -f make/Main.gmk $(USER_MAKE_VARS) \
264 	    NO_RECIPES=true print-targets )
265 
266   print-tests:
267 	( cd $(TOPDIR) &amp;&amp; \
268 	    $(MAKE) $(MAKE_ARGS) -j 1 -f make/Main.gmk $(USER_MAKE_VARS) \
269 	    NO_RECIPES=true print-tests )
270 
271   print-configuration:
272 	  $(ECHO) $(CONFIGURE_COMMAND_LINE)
273 
274   reconfigure:
275         ifneq ($(CONFIGURE_COMMAND_LINE), )
276 	  $(ECHO) &quot;Re-running configure using arguments &#39;$(CONFIGURE_COMMAND_LINE)&#39;&quot;
277         else
278 	  $(ECHO) &quot;Re-running configure using default settings&quot;
279         endif
<span class="line-modified">280 	( cd $(OUTPUTDIR) &amp;&amp; PATH=&quot;$(ORIGINAL_PATH)&quot; AUTOCONF=&quot;$(AUTOCONF)&quot; \</span>
281 	    CUSTOM_ROOT=&quot;$(CUSTOM_ROOT)&quot; \
282 	    CUSTOM_CONFIG_DIR=&quot;$(CUSTOM_CONFIG_DIR)&quot; \
283 	    $(BASH) $(TOPDIR)/configure $(CONFIGURE_COMMAND_LINE) )
284 
285   ##############################################################################
286   # The main target, for delegating into Main.gmk
287   ##############################################################################
288 
289   MAIN_TARGETS := $(SEQUENTIAL_TARGETS) $(PARALLEL_TARGETS) $(COMPARE_BUILD_MAKE)
290   # If building the default target, add what they are to the description.
291   DESCRIPTION_TARGETS := $(strip $(MAIN_TARGETS))
292   ifeq ($(DESCRIPTION_TARGETS), default)
293     DESCRIPTION_TARGETS += ($(DEFAULT_MAKE_TARGET))
294   endif
295   TARGET_DESCRIPTION := target$(if $(word 2, $(MAIN_TARGETS)),s) \
296       &#39;$(strip $(DESCRIPTION_TARGETS))&#39; in configuration &#39;$(CONF_NAME)&#39;
297 
298   # MAKEOVERRIDES is automatically set and propagated by Make to sub-Make calls.
299   # We need to clear it of the init-specific variables. The user-specified
300   # variables are explicitly propagated using $(USER_MAKE_VARS).
301   main: MAKEOVERRIDES :=
302 
303   main: $(INIT_TARGETS)
304         ifneq ($(SEQUENTIAL_TARGETS)$(PARALLEL_TARGETS), )
305 	  $(call RotateLogFiles)
<span class="line-modified">306 	  $(PRINTF) &quot;Building $(TARGET_DESCRIPTION)\n&quot; $(BUILD_LOG_PIPE)</span>
307           ifneq ($(SEQUENTIAL_TARGETS), )
308             # Don&#39;t touch build output dir since we might be cleaning. That
309             # means no log pipe.
310 	    ( cd $(TOPDIR) &amp;&amp; \
311 	        $(MAKE) $(MAKE_ARGS) -j 1 -f make/Main.gmk $(USER_MAKE_VARS) \
312 	        $(SEQUENTIAL_TARGETS) )
313           endif
314           ifneq ($(PARALLEL_TARGETS), )
315 	    $(call PrepareFailureLogs)
316 	    $(call StartGlobalTimer)
317 	    $(call PrepareSmartJavac)
318             # JOBS will only be empty for a bootcycle-images recursive call
319             # or if specified via a make argument directly. In those cases
320             # treat it as NOT using jobs at all.
321 	    ( cd $(TOPDIR) &amp;&amp; \
322 	        $(NICE) $(MAKE) $(MAKE_ARGS) $(OUTPUT_SYNC_FLAG) \
323                     $(if $(JOBS), -j $(JOBS)) \
324 	            -f make/Main.gmk $(USER_MAKE_VARS) \
325 	            $(PARALLEL_TARGETS) $(COMPARE_BUILD_MAKE) $(BUILD_LOG_PIPE) || \
326 	        ( exitcode=$$? &amp;&amp; \
327 	        $(PRINTF) &quot;\nERROR: Build failed for $(TARGET_DESCRIPTION) (exit code $$exitcode) \n&quot; \
<span class="line-modified">328 	            $(BUILD_LOG_PIPE) &amp;&amp; \</span>
329 	        cd $(TOPDIR) &amp;&amp; $(MAKE) $(MAKE_ARGS) -j 1 -f make/Init.gmk \
330 	            HAS_SPEC=true on-failure ; \
331 	        exit $$exitcode ) )
332 	    $(call CleanupSmartJavac)
333 	    $(call StopGlobalTimer)
334 	    $(call ReportBuildTimes)
335           endif
336 	  if test -f $(MAKESUPPORT_OUTPUTDIR)/exit-with-error ; then \
337 	    exit 1 ; \
338 	  fi
<span class="line-modified">339 	  $(PRINTF) &quot;Finished building $(TARGET_DESCRIPTION)\n&quot; $(BUILD_LOG_PIPE)</span>
340 	  $(call ReportProfileTimes)
341         endif
342 
343     on-failure:
344 	$(call CleanupSmartJavac)
345 	$(call StopGlobalTimer)
346 	$(call ReportBuildTimes)
347 	$(call PrintFailureReports)
348 	$(call PrintBuildLogFailures)
349 	$(call ReportProfileTimes)
350 	$(PRINTF) &quot;Hint: See doc/building.html#troubleshooting for assistance.\n\n&quot;
351         ifneq ($(COMPARE_BUILD), )
352 	  $(call CleanupCompareBuild)
353         endif
354 
355     # Support targets for COMPARE_BUILD, used for makefile development
356     pre-compare-build:
357 	$(call WaitForSmartJavacFinish)
358 	$(call PrepareCompareBuild)
359 
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 30 ################################################################################
 31 
 32 # This must be the first rule
 33 default:
 34 .PHONY: default
 35 
 36 # Inclusion of this pseudo-target will cause make to execute this file
 37 # serially, regardless of -j.
 38 .NOTPARALLEL:
 39 
 40 ifeq ($(HAS_SPEC),)
 41   ##############################################################################
 42   # This is the default mode. We have not been recursively called with a SPEC.
 43   ##############################################################################
 44 
 45   # Include our helper functions.
 46   include $(topdir)/make/InitSupport.gmk
 47 
 48   # Here are &quot;global&quot; targets, i.e. targets that can be executed without having
 49   # a configuration. This will define ALL_GLOBAL_TARGETS.
<span class="line-modified"> 50   include $(topdir)/make/Global.gmk</span>
 51 
 52   # Targets provided by Init.gmk.
 53   ALL_INIT_TARGETS := print-modules print-targets print-configuration \
 54       print-tests reconfigure pre-compare-build post-compare-build
 55 
 56   # CALLED_TARGETS is the list of targets that the user provided,
 57   # or &quot;default&quot; if unspecified.
 58   CALLED_TARGETS := $(if $(MAKECMDGOALS), $(MAKECMDGOALS), default)
 59 
 60   # Extract non-global targets that require a spec file.
 61   CALLED_SPEC_TARGETS := $(filter-out $(ALL_GLOBAL_TARGETS), $(CALLED_TARGETS))
 62 
 63   # If we have only global targets, or if we are called with -qp (assuming an
 64   # external part, e.g. bash completion, is trying to understand our targets),
 65   # we will skip SPEC location and the sanity checks.
 66   ifeq ($(CALLED_SPEC_TARGETS), )
 67     ONLY_GLOBAL_TARGETS := true
 68   endif
 69   ifeq ($(findstring p, $(MAKEFLAGS))$(findstring q, $(MAKEFLAGS)), pq)
 70     ONLY_GLOBAL_TARGETS := true
</pre>
<hr />
<pre>
221   include $(SPEC)
222 
223   # Our helper functions.
224   include $(TOPDIR)/make/InitSupport.gmk
225 
226   # Parse COMPARE_BUILD (for makefile development)
227   $(eval $(call ParseCompareBuild))
228 
229   # If no LOG= was given on command line, but we have a non-standard default
230   # value, use that instead and re-parse log level.
231   ifeq ($(LOG), )
232     ifneq ($(DEFAULT_LOG), )
233       override LOG := $(DEFAULT_LOG)
234       $(eval $(call ParseLogLevel))
235     endif
236   endif
237 
238   ifeq ($(LOG_NOFILE), true)
239     # Disable build log if LOG=[level,]nofile was given
240     override BUILD_LOG_PIPE :=
<span class="line-added">241     override BUILD_LOG_PIPE_SIMPLE :=</span>
242   endif
243 
244   ifeq ($(filter dist-clean, $(SEQUENTIAL_TARGETS)), dist-clean)
245     # We can&#39;t have a log file if we&#39;re about to remove it.
246     override BUILD_LOG_PIPE :=
<span class="line-added">247     override BUILD_LOG_PIPE_SIMPLE :=</span>
248   endif
249 
250   ifeq ($(OUTPUT_SYNC_SUPPORTED), true)
251     OUTPUT_SYNC_FLAG := -O$(OUTPUT_SYNC)
252   endif
253 
254   ##############################################################################
255   # Init targets
256   ##############################################################################
257 
258   print-modules:
259 	( cd $(TOPDIR) &amp;&amp; \
260 	    $(MAKE) $(MAKE_ARGS) -j 1 -f make/Main.gmk $(USER_MAKE_VARS) \
261 	    NO_RECIPES=true print-modules )
262 
263   print-targets:
264 	( cd $(TOPDIR) &amp;&amp; \
265 	    $(MAKE) $(MAKE_ARGS) -j 1 -f make/Main.gmk $(USER_MAKE_VARS) \
266 	    NO_RECIPES=true print-targets )
267 
268   print-tests:
269 	( cd $(TOPDIR) &amp;&amp; \
270 	    $(MAKE) $(MAKE_ARGS) -j 1 -f make/Main.gmk $(USER_MAKE_VARS) \
271 	    NO_RECIPES=true print-tests )
272 
273   print-configuration:
274 	  $(ECHO) $(CONFIGURE_COMMAND_LINE)
275 
276   reconfigure:
277         ifneq ($(CONFIGURE_COMMAND_LINE), )
278 	  $(ECHO) &quot;Re-running configure using arguments &#39;$(CONFIGURE_COMMAND_LINE)&#39;&quot;
279         else
280 	  $(ECHO) &quot;Re-running configure using default settings&quot;
281         endif
<span class="line-modified">282 	( cd $(CONFIGURE_START_DIR) &amp;&amp; PATH=&quot;$(ORIGINAL_PATH)&quot; AUTOCONF=&quot;$(AUTOCONF)&quot; \</span>
283 	    CUSTOM_ROOT=&quot;$(CUSTOM_ROOT)&quot; \
284 	    CUSTOM_CONFIG_DIR=&quot;$(CUSTOM_CONFIG_DIR)&quot; \
285 	    $(BASH) $(TOPDIR)/configure $(CONFIGURE_COMMAND_LINE) )
286 
287   ##############################################################################
288   # The main target, for delegating into Main.gmk
289   ##############################################################################
290 
291   MAIN_TARGETS := $(SEQUENTIAL_TARGETS) $(PARALLEL_TARGETS) $(COMPARE_BUILD_MAKE)
292   # If building the default target, add what they are to the description.
293   DESCRIPTION_TARGETS := $(strip $(MAIN_TARGETS))
294   ifeq ($(DESCRIPTION_TARGETS), default)
295     DESCRIPTION_TARGETS += ($(DEFAULT_MAKE_TARGET))
296   endif
297   TARGET_DESCRIPTION := target$(if $(word 2, $(MAIN_TARGETS)),s) \
298       &#39;$(strip $(DESCRIPTION_TARGETS))&#39; in configuration &#39;$(CONF_NAME)&#39;
299 
300   # MAKEOVERRIDES is automatically set and propagated by Make to sub-Make calls.
301   # We need to clear it of the init-specific variables. The user-specified
302   # variables are explicitly propagated using $(USER_MAKE_VARS).
303   main: MAKEOVERRIDES :=
304 
305   main: $(INIT_TARGETS)
306         ifneq ($(SEQUENTIAL_TARGETS)$(PARALLEL_TARGETS), )
307 	  $(call RotateLogFiles)
<span class="line-modified">308 	  $(PRINTF) &quot;Building $(TARGET_DESCRIPTION)\n&quot; $(BUILD_LOG_PIPE_SIMPLE)</span>
309           ifneq ($(SEQUENTIAL_TARGETS), )
310             # Don&#39;t touch build output dir since we might be cleaning. That
311             # means no log pipe.
312 	    ( cd $(TOPDIR) &amp;&amp; \
313 	        $(MAKE) $(MAKE_ARGS) -j 1 -f make/Main.gmk $(USER_MAKE_VARS) \
314 	        $(SEQUENTIAL_TARGETS) )
315           endif
316           ifneq ($(PARALLEL_TARGETS), )
317 	    $(call PrepareFailureLogs)
318 	    $(call StartGlobalTimer)
319 	    $(call PrepareSmartJavac)
320             # JOBS will only be empty for a bootcycle-images recursive call
321             # or if specified via a make argument directly. In those cases
322             # treat it as NOT using jobs at all.
323 	    ( cd $(TOPDIR) &amp;&amp; \
324 	        $(NICE) $(MAKE) $(MAKE_ARGS) $(OUTPUT_SYNC_FLAG) \
325                     $(if $(JOBS), -j $(JOBS)) \
326 	            -f make/Main.gmk $(USER_MAKE_VARS) \
327 	            $(PARALLEL_TARGETS) $(COMPARE_BUILD_MAKE) $(BUILD_LOG_PIPE) || \
328 	        ( exitcode=$$? &amp;&amp; \
329 	        $(PRINTF) &quot;\nERROR: Build failed for $(TARGET_DESCRIPTION) (exit code $$exitcode) \n&quot; \
<span class="line-modified">330 	            $(BUILD_LOG_PIPE_SIMPLE) &amp;&amp; \</span>
331 	        cd $(TOPDIR) &amp;&amp; $(MAKE) $(MAKE_ARGS) -j 1 -f make/Init.gmk \
332 	            HAS_SPEC=true on-failure ; \
333 	        exit $$exitcode ) )
334 	    $(call CleanupSmartJavac)
335 	    $(call StopGlobalTimer)
336 	    $(call ReportBuildTimes)
337           endif
338 	  if test -f $(MAKESUPPORT_OUTPUTDIR)/exit-with-error ; then \
339 	    exit 1 ; \
340 	  fi
<span class="line-modified">341 	  $(PRINTF) &quot;Finished building $(TARGET_DESCRIPTION)\n&quot; $(BUILD_LOG_PIPE_SIMPLE)</span>
342 	  $(call ReportProfileTimes)
343         endif
344 
345     on-failure:
346 	$(call CleanupSmartJavac)
347 	$(call StopGlobalTimer)
348 	$(call ReportBuildTimes)
349 	$(call PrintFailureReports)
350 	$(call PrintBuildLogFailures)
351 	$(call ReportProfileTimes)
352 	$(PRINTF) &quot;Hint: See doc/building.html#troubleshooting for assistance.\n\n&quot;
353         ifneq ($(COMPARE_BUILD), )
354 	  $(call CleanupCompareBuild)
355         endif
356 
357     # Support targets for COMPARE_BUILD, used for makefile development
358     pre-compare-build:
359 	$(call WaitForSmartJavacFinish)
360 	$(call PrepareCompareBuild)
361 
</pre>
</td>
</tr>
</table>
<center><a href="Images.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="InitSupport.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>