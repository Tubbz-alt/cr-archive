<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/RunTests.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="ModuleWrapper.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTestsPrebuilt.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/RunTests.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  81 $(eval $(call IncludeCustomExtension, RunTests.gmk))
  82 ################################################################################
  83 
  84 # This is the JDK that we will test
  85 JDK_UNDER_TEST := $(JDK_IMAGE_DIR)
  86 
  87 TEST_RESULTS_DIR := $(OUTPUTDIR)/test-results
  88 TEST_SUPPORT_DIR := $(OUTPUTDIR)/test-support
  89 TEST_SUMMARY := $(TEST_RESULTS_DIR)/test-summary.txt
  90 TEST_LAST_IDS := $(TEST_SUPPORT_DIR)/test-last-ids.txt
  91 
  92 ifeq ($(CUSTOM_ROOT), )
  93   JTREG_TOPDIR := $(TOPDIR)
  94 else
  95   JTREG_TOPDIR := $(CUSTOM_ROOT)
  96 endif
  97 
  98 JTREG_FAILURE_HANDLER_DIR := $(TEST_IMAGE_DIR)/failure_handler
  99 JTREG_FAILURE_HANDLER := $(JTREG_FAILURE_HANDLER_DIR)/jtregFailureHandler.jar
 100 


 101 ifneq ($(wildcard $(JTREG_FAILURE_HANDLER)), )
 102   JTREG_FAILURE_HANDLER_OPTIONS := \
 103       -timeoutHandlerDir:$(JTREG_FAILURE_HANDLER) \
 104       -observerDir:$(JTREG_FAILURE_HANDLER) \
 105       -timeoutHandler:jdk.test.failurehandler.jtreg.GatherProcessInfoTimeoutHandler \
 106       -observer:jdk.test.failurehandler.jtreg.GatherDiagnosticInfoObserver \
<span class="line-modified"> 107       -timeoutHandlerTimeout:0</span>
 108 endif
 109 
 110 GTEST_LAUNCHER_DIRS := $(patsubst %/gtestLauncher, %, \
 111     $(wildcard $(TEST_IMAGE_DIR)/hotspot/gtest/*/gtestLauncher))
 112 GTEST_VARIANTS := $(strip $(patsubst $(TEST_IMAGE_DIR)/hotspot/gtest/%, %, \
 113     $(GTEST_LAUNCHER_DIRS)))
 114 
 115 COV_ENVIRONMENT :=
 116 JTREG_COV_OPTIONS :=
 117 
 118 ifeq ($(TEST_OPTS_JCOV), true)
 119   JCOV_OUTPUT_DIR := $(TEST_RESULTS_DIR)/jcov-output
 120   JCOV_GRABBER_LOG := $(JCOV_OUTPUT_DIR)/grabber.log
 121   JCOV_RESULT_FILE := $(JCOV_OUTPUT_DIR)/result.xml
 122   JCOV_REPORT := $(JCOV_OUTPUT_DIR)/report
 123   JCOV_MEM_OPTIONS := -Xms64m -Xmx4g
 124 
 125   # Replace our normal test JDK with the JCov image.
 126   JDK_UNDER_TEST := $(JCOV_IMAGE_DIR)
 127 
</pre>
<hr />
<pre>
 166       -J-Xmx4g --info \
 167       $$(addprefix -J, $$(filter-out -Xcomp %TieredCompilation, $$($1_VM_OPTIONS))) \
 168       $$(addprefix --compile-commands$(SPACE), $$($1_AOT_CCLIST)) \
 169       --linker-path $$(LD_JAOTC) \
 170       #
 171 
 172   ifneq ($$(filter -ea, $$($1_VM_OPTIONS)), )
 173     $1_JAOTC_OPTS += --compile-with-assertions
 174   endif
 175 
 176   $$($1_AOT_LIB): $$(JDK_UNDER_TEST)/release \
 177       $$(call DependOnVariable, $1_JAOTC_OPTS) \
 178       $$(call DependOnVariable, JDK_UNDER_TEST)
 179 	$$(call LogWarn, Generating $$(patsubst $$(OUTPUTDIR)/%, %, $$@))
 180 	$$(call MakeTargetDir)
 181 	$$(call ExecuteWithLog, $$@, \
 182 	    $((COV_ENVIRONMENT) \
 183 	    $$(FIXPATH) $$(JDK_UNDER_TEST)/bin/jaotc \
 184 	        $$($1_JAOTC_OPTS) --output $$@ --module $$($1_MODULE) \
 185 	)
<span class="line-modified"> 186 	$$(call ExecuteWithLog, $$@.check, \</span>
 187 	    $$(FIXPATH) $$(JDK_UNDER_TEST)/bin/java \
<span class="line-modified"> 188 	        $$($1_VM_OPTIONS) -XX:+UnlockDiagnosticVMOptions \</span>
 189 	        -XX:+PrintAOT -XX:+UseAOTStrictLoading \
 190 	        -XX:AOTLibrary=$$@ -version \
 191 	         &gt; $$@.verify-aot \
<span class="line-modified"> 192 	)</span>
 193 

 194   $1_AOT_OPTIONS += -XX:AOTLibrary=$$($1_AOT_LIB)
 195   $1_AOT_TARGETS += $$($1_AOT_LIB)
 196 endef
 197 
 198 # Parameter 1 is the name of the rule.
 199 #
 200 # Remaining parameters are named arguments.
 201 #   MODULES     The modules to generate a library for
 202 #   VM_OPTIONS  List of JVM arguments to use when creating libraries
 203 #
 204 # After calling this, the following variables are defined
 205 #   $1_AOT_OPTIONS List of all java options needed to use the AOT libraries
 206 #   $1_AOT_TARGETS List of all targets that the test rule will need to depend on
 207 #
 208 SetupAot = $(NamedParamsMacroTemplate)
 209 define SetupAotBody
 210   $$(info Running with AOTd libraries for $$($1_MODULES))
 211   # Put aot libraries in a separate directory so they are not deleted between
 212   # test runs and may be reused between make invocations.
 213   $$(foreach m, $$($1_MODULES), \
</pre>
<hr />
<pre>
 227 
 228 # Each factor variable comes in 3 variants. The first one is reserved for users
 229 # to use on command line. The other two are for predifined configurations in JDL
 230 # and for machine specific configurations respectively.
 231 TEST_JOBS_FACTOR ?= 1
 232 TEST_JOBS_FACTOR_JDL ?= 1
 233 TEST_JOBS_FACTOR_MACHINE ?= 1
 234 
 235 ifeq ($(TEST_JOBS), 0)
 236   CORES_DIVIDER := 2
 237   ifeq ($(call isTargetCpuArch, sparc), true)
 238     # For smaller SPARC machines we see reasonable scaling of throughput up to
 239     # cpus/4 without affecting test reliability. On the bigger machines, cpus/4
 240     # causes intermittent timeouts.
 241     ifeq ($(shell $(EXPR) $(NUM_CORES) \&gt; 16), 1)
 242       CORES_DIVIDER := 5
 243     else
 244       CORES_DIVIDER := 4
 245     endif
 246   endif













 247   MEMORY_DIVIDER := 2048
 248   TEST_JOBS := $(shell $(AWK) \
 249     &#39;BEGIN { \
 250       c = $(NUM_CORES) / $(CORES_DIVIDER); \
 251       m = $(MEMORY_SIZE) / $(MEMORY_DIVIDER); \





 252       if (c &gt; m) c = m; \
 253       c = c * $(TEST_JOBS_FACTOR); \
 254       c = c * $(TEST_JOBS_FACTOR_JDL); \
 255       c = c * $(TEST_JOBS_FACTOR_MACHINE); \
 256       if (c &lt; 1) c = 1; \
 257       printf &quot;%.0f&quot;, c; \
 258     }&#39;)
 259 endif
 260 
 261 ################################################################################
 262 # Parse control variables
 263 ################################################################################
 264 
 265 ifneq ($(TEST_OPTS), )
 266   # Inform the user
 267   $(info Running tests using TEST_OPTS control variable &#39;$(TEST_OPTS)&#39;)
 268 endif
 269 
 270 ### Jtreg
 271 
 272 $(eval $(call SetTestOpt,VM_OPTIONS,JTREG))
 273 $(eval $(call SetTestOpt,JAVA_OPTIONS,JTREG))
 274 $(eval $(call SetTestOpt,AOT_MODULES,JTREG))
 275 
 276 $(eval $(call SetTestOpt,JOBS,JTREG))
 277 $(eval $(call SetTestOpt,TIMEOUT_FACTOR,JTREG))

 278 
 279 $(eval $(call ParseKeywordVariable, JTREG, \
<span class="line-modified"> 280     SINGLE_KEYWORDS := JOBS TIMEOUT_FACTOR TEST_MODE ASSERT VERBOSE RETAIN \</span>
<span class="line-modified"> 281         MAX_MEM, \</span>

 282     STRING_KEYWORDS := OPTIONS JAVA_OPTIONS VM_OPTIONS KEYWORDS \
 283         EXTRA_PROBLEM_LISTS AOT_MODULES, \
 284 ))
 285 
 286 ifneq ($(JTREG), )
 287   # Inform the user
 288   $(info Running tests using JTREG control variable &#39;$(JTREG)&#39;)
 289 endif
 290 
 291 ### Gtest
 292 
 293 $(eval $(call SetTestOpt,VM_OPTIONS,GTEST))
 294 $(eval $(call SetTestOpt,JAVA_OPTIONS,GTEST))
 295 $(eval $(call SetTestOpt,AOT_MODULES,GTEST))
 296 
 297 $(eval $(call ParseKeywordVariable, GTEST, \
 298     SINGLE_KEYWORDS := REPEAT, \
 299     STRING_KEYWORDS := OPTIONS VM_OPTIONS JAVA_OPTIONS AOT_MODULES, \
 300 ))
 301 
</pre>
<hr />
<pre>
 572       $$(patsubst gtest:%, %, $$($1_TEST))))
 573   ifneq ($$($1_TEST_NAME), all)
 574     $1_GTEST_FILTER := --gtest_filter=$$($1_TEST_NAME)*
 575   endif
 576 
 577   ifneq ($$(GTEST_REPEAT), )
 578     $1_GTEST_REPEAT :=--gtest_repeat=$$(GTEST_REPEAT)
 579   endif
 580 
 581   ifneq ($$(GTEST_AOT_MODULES), )
 582     $$(eval $$(call SetupAot, $1, \
 583         MODULES := $$(GTEST_AOT_MODULES), \
 584         VM_OPTIONS := $$(GTEST_VM_OPTIONS) $$(GTEST_JAVA_OPTIONS), \
 585     ))
 586   endif
 587 
 588   run-test-$1: pre-run-test $$($1_AOT_TARGETS)
 589 	$$(call LogWarn)
 590 	$$(call LogWarn, Running test &#39;$$($1_TEST)&#39;)
 591 	$$(call MakeDir, $$($1_TEST_RESULTS_DIR) $$($1_TEST_SUPPORT_DIR))
<span class="line-modified"> 592 	$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)/gtest, \</span>
 593 	    $$(FIXPATH) $$(TEST_IMAGE_DIR)/hotspot/gtest/$$($1_VARIANT)/gtestLauncher \
 594 	        -jdk $(JDK_UNDER_TEST) $$($1_GTEST_FILTER) \
 595 	        --gtest_output=xml:$$($1_TEST_RESULTS_DIR)/gtest.xml \
 596 	        $$($1_GTEST_REPEAT) $$(GTEST_OPTIONS) $$(GTEST_VM_OPTIONS) \
 597 	        $$(GTEST_JAVA_OPTIONS) $$($1_AOT_OPTIONS) \
 598 	        &gt; &gt;($(TEE) $$($1_TEST_RESULTS_DIR)/gtest.txt) \
 599 	    &amp;&amp; $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
 600 	    || $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
<span class="line-modified"> 601 	)</span>
 602 
 603   $1_RESULT_FILE := $$($1_TEST_RESULTS_DIR)/gtest.txt
 604 
 605   parse-test-$1: run-test-$1
 606 	$$(call LogWarn, Finished running test &#39;$$($1_TEST)&#39;)
 607 	$$(call LogWarn, Test report is stored in $$(strip \
 608 	    $$(subst $$(TOPDIR)/, , $$($1_TEST_RESULTS_DIR))))
 609 	$$(if $$(wildcard $$($1_RESULT_FILE)), \
 610 	  $$(eval $1_TOTAL := $$(shell $$(AWK) &#39;/==========.* tests? from .* \
 611 	      test cases? ran/ { print $$$$2 }&#39; $$($1_RESULT_FILE))) \
 612 	  $$(if $$($1_TOTAL), , $$(eval $1_TOTAL := 0)) \
 613 	  $$(eval $1_PASSED := $$(shell $$(AWK) &#39;/\[  PASSED  \] .* tests?./ \
 614 	      { print $$$$4 }&#39; $$($1_RESULT_FILE))) \
 615 	  $$(if $$($1_PASSED), , $$(eval $1_PASSED := 0)) \
 616 	  $$(eval $1_FAILED := $$(shell $$(AWK) &#39;/\[  FAILED  \] .* tests?, \
 617 	      listed below/ { print $$$$4 }&#39; $$($1_RESULT_FILE))) \
 618 	  $$(if $$($1_FAILED), , $$(eval $1_FAILED := 0)) \
 619 	  $$(eval $1_ERROR := $$(shell \
 620 	      $$(EXPR) $$($1_TOTAL) - $$($1_PASSED) - $$($1_FAILED))) \
 621 	, \
</pre>
<hr />
<pre>
 661   $1_EXITCODE := $$($1_TEST_RESULTS_DIR)/exitcode.txt
 662 
 663   $1_TEST_NAME := $$(strip $$(patsubst micro:%, %, $$($1_TEST)))
 664 
 665   $$(eval $$(call SetMicroValue,$1,MICRO_BENCHMARKS_JAR,$$(TEST_IMAGE_DIR)/micro/benchmarks.jar))
 666   $$(eval $$(call SetMicroValue,$1,MICRO_TEST_JDK,$$(JDK_UNDER_TEST)))
 667   $$(eval $$(call SetMicroValue,$1,MICRO_JAVA_OPTIONS))
 668 
 669   # Current tests needs to open java.io
 670   $1_MICRO_JAVA_OPTIONS += --add-opens=java.base/java.io=ALL-UNNAMED
 671   # Set library path for native dependencies
 672   $1_MICRO_JAVA_OPTIONS += -Djava.library.path=$$(TEST_IMAGE_DIR)/micro/native
 673 
 674   # Save output as JSON or CSV file
 675   ifneq ($$(MICRO_RESULTS_FORMAT), )
 676     $1_MICRO_BASIC_OPTIONS += -rf $$(MICRO_RESULTS_FORMAT)
 677     $1_MICRO_BASIC_OPTIONS += -rff $$($1_TEST_RESULTS_DIR)/jmh-result.$(MICRO_RESULTS_FORMAT)
 678   endif
 679 
 680   ifneq ($$(MICRO_VM_OPTIONS)$$(MICRO_JAVA_OPTIONS), )
<span class="line-modified"> 681     $1_MICRO_VM_OPTIONS := -jvmArgs $$(MICRO_VM_OPTIONS) $$(MICRO_JAVA_OPTIONS)</span>

 682   endif
 683 
 684   ifneq ($$(MICRO_ITER), )
 685     $1_MICRO_ITER := -i $$(MICRO_ITER)
 686   endif
 687   ifneq ($$(MICRO_FORK), )
 688     $1_MICRO_FORK := -f $$(MICRO_FORK)
 689   endif
 690   ifneq ($$(MICRO_TIME), )
 691     $1_MICRO_TIME := -r $$(MICRO_TIME)
 692   endif
 693   ifneq ($$(MICRO_WARMUP_ITER), )
 694     $1_MICRO_WARMUP_ITER := -wi $$(MICRO_WARMUP_ITER)
 695   endif
 696   ifneq ($$(MICRO_WARMUP_TIME), )
 697     $1_MICRO_WARMUP_TIME := -w $$(MICRO_WARMUP_TIME)
 698   endif
 699 
 700   run-test-$1: pre-run-test
 701 	$$(call LogWarn)
 702 	$$(call LogWarn, Running test &#39;$$($1_TEST)&#39;)
 703 	$$(call MakeDir, $$($1_TEST_RESULTS_DIR) $$($1_TEST_SUPPORT_DIR))
<span class="line-modified"> 704 	$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)/micro, \</span>
 705 	    $$(FIXPATH) $$($1_MICRO_TEST_JDK)/bin/java $$($1_MICRO_JAVA_OPTIONS) \
 706 	        -jar $$($1_MICRO_BENCHMARKS_JAR) \
 707 	        $$($1_MICRO_ITER) $$($1_MICRO_FORK) $$($1_MICRO_TIME) \
 708 	        $$($1_MICRO_WARMUP_ITER) $$($1_MICRO_WARMUP_TIME) \
 709 	        $$($1_MICRO_VM_OPTIONS) $$($1_MICRO_BASIC_OPTIONS) $$(MICRO_OPTIONS) \
 710 	        $$($1_TEST_NAME) \
 711 	        &gt; &gt;($(TEE) $$($1_TEST_RESULTS_DIR)/micro.txt) \
 712 	    &amp;&amp; $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
 713 	    || $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
<span class="line-modified"> 714 	)</span>
 715 
 716   $1_RESULT_FILE := $$($1_TEST_RESULTS_DIR)/micro.txt
 717 
 718   parse-test-$1: run-test-$1
 719 	$$(call LogWarn, Finished running test &#39;$$($1_TEST)&#39;)
 720 	$$(call LogWarn, Test report is stored in $$(strip \
 721 	    $$(subst $$(TOPDIR)/, , $$($1_TEST_RESULTS_DIR))))
 722 	$$(if $$(wildcard $$($1_EXITCODE)), \
 723 	  $$(eval $1_EXIT_CODE := $$(shell $$(CAT) $$($1_EXITCODE))) \
 724 	  $$(if $$(filter 0, $$($1_EXIT_CODE)), \
 725 	    $$(eval $1_PASSED := 1) \
 726 	    $$(eval $1_ERROR := 0) \
 727 	  , \
 728 	    $$(eval $1_PASSED := 0) \
 729 	    $$(eval $1_ERROR := 1) \
 730 	  ) \
 731 	  $$(eval $1_FAILED := 0) \
 732 	  $$(eval $1_TOTAL := $$(shell \
 733 	      $$(EXPR) $$($1_PASSED) + $$($1_ERROR))) \
 734 	, \
</pre>
<hr />
<pre>
 811   $1_JTREG_PROBLEM_LIST := $$(filter $$($1_TEST_ROOT)%, $$($1_JTREG_PROBLEM_LIST))
 812 
 813   ifneq ($(TEST_JOBS), 0)
 814     $$(eval $$(call SetJtregValue,$1,JTREG_JOBS,$$(TEST_JOBS)))
 815   else
 816     $$(eval $$(call SetJtregValue,$1,JTREG_JOBS,$$(JOBS)))
 817   endif
 818 
 819   # Make sure MaxRAMPercentage is high enough to not cause OOM or swapping since
 820   # we may end up with a lot of JVM&#39;s
 821   $1_JTREG_MAX_RAM_PERCENTAGE := $$(shell $$(EXPR) 25 / $$($1_JTREG_JOBS))
 822 
 823   # SPARC is in general slower per core so need to scale up timeouts a bit.
 824   ifeq ($(call isTargetCpuArch, sparc), true)
 825     JTREG_TIMEOUT_FACTOR ?= 8
 826   else
 827     JTREG_TIMEOUT_FACTOR ?= 4
 828   endif
 829   JTREG_VERBOSE ?= fail,error,summary
 830   JTREG_RETAIN ?= fail,error


 831 
 832   ifneq ($$($1_JTREG_MAX_MEM), 0)
 833     $1_JTREG_BASIC_OPTIONS += -vmoption:-Xmx$$($1_JTREG_MAX_MEM)
 834     $1_JTREG_LAUNCHER_OPTIONS += -Xmx$$($1_JTREG_MAX_MEM)
 835   endif
 836 
 837   $1_JTREG_BASIC_OPTIONS += -$$($1_JTREG_TEST_MODE) \
 838       -verbose:$$(JTREG_VERBOSE) -retain:$$(JTREG_RETAIN) \
 839       -concurrency:$$($1_JTREG_JOBS) -timeoutFactor:$$(JTREG_TIMEOUT_FACTOR) \
 840       -vmoption:-XX:MaxRAMPercentage=$$($1_JTREG_MAX_RAM_PERCENTAGE)
 841 
 842   $1_JTREG_BASIC_OPTIONS += -automatic -ignore:quiet
 843 
 844   # Make it possible to specify the JIB_DATA_DIR for tests using the
 845   # JIB Artifact resolver
 846   $1_JTREG_BASIC_OPTIONS += -e:JIB_DATA_DIR
 847   # Some tests needs to find a boot JDK using the JDK8_HOME variable.
 848   $1_JTREG_BASIC_OPTIONS += -e:JDK8_HOME=$$(BOOT_JDK)
 849   # If running on Windows, propagate the _NT_SYMBOL_PATH to enable
 850   # symbol lookup in hserr files
 851   ifeq ($$(call isTargetOs, windows), true)
 852     $1_JTREG_BASIC_OPTIONS += -e:_NT_SYMBOL_PATH
 853   endif
 854 
 855   $1_JTREG_BASIC_OPTIONS += \
 856       $$(addprefix -javaoption:, $$(JTREG_JAVA_OPTIONS)) \
 857       $$(addprefix -vmoption:, $$(JTREG_VM_OPTIONS)) \
 858       #
 859 
 860   ifeq ($$($1_JTREG_ASSERT), true)
 861     $1_JTREG_BASIC_OPTIONS += -ea -esa
 862   endif
 863 
 864   ifneq ($$($1_JTREG_NATIVEPATH), )
 865     $1_JTREG_BASIC_OPTIONS += -nativepath:$$($1_JTREG_NATIVEPATH)
 866   endif
 867 






 868   ifneq ($$($1_JTREG_PROBLEM_LIST), )
<span class="line-modified"> 869     $1_JTREG_BASIC_OPTIONS += $$(addprefix -exclude:, $$($1_JTREG_PROBLEM_LIST))</span>
 870   endif
 871 
 872   ifneq ($$(JTREG_EXTRA_PROBLEM_LISTS), )
 873     # Accept both absolute paths as well as relative to the current test root.
<span class="line-modified"> 874     $1_JTREG_BASIC_OPTIONS += $$(addprefix -exclude:, $$(wildcard \</span>
 875         $$(JTREG_EXTRA_PROBLEM_LISTS) \
 876         $$(addprefix $$($1_TEST_ROOT)/, $$(JTREG_EXTRA_PROBLEM_LISTS)) \
 877     ))
 878   endif
 879 
 880   ifneq ($$(JIB_HOME), )
 881     $1_JTREG_BASIC_OPTIONS += -e:JIB_HOME=$$(JIB_HOME)
 882   endif
 883 
<span class="line-modified"> 884   $1_JTREG_BASIC_OPTIONS += -e:TEST_IMAGE_GRAAL_DIR=${TEST_IMAGE_DIR}/hotspot/jtreg/graal</span>

 885 
 886   ifneq ($$(JTREG_FAILURE_HANDLER_OPTIONS), )
 887     $1_JTREG_LAUNCHER_OPTIONS += -Djava.library.path=&quot;$(JTREG_FAILURE_HANDLER_DIR)&quot;
 888   endif
 889 
 890   ifneq ($$(JTREG_KEYWORDS), )
 891     # The keywords string may contain problematic characters and may be quoted
 892     # already when it arrives here. Remove any existing quotes and replace them
 893     # with one set of single quotes.
 894     $1_JTREG_KEYWORDS := \
 895         $$(strip $$(subst $$(SQUOTE),,$$(subst $$(DQUOTE),,$$(JTREG_KEYWORDS))))
 896     ifneq ($$($1_JTREG_KEYWORDS), )
 897       $1_JTREG_BASIC_OPTIONS += -k:&#39;$$($1_JTREG_KEYWORDS)&#39;
 898     endif
 899   endif
 900 
 901   ifneq ($$(JTREG_AOT_MODULES), )
 902     $$(eval $$(call SetupAot, $1, \
 903         MODULES := $$(JTREG_AOT_MODULES), \
 904         VM_OPTIONS := $$(JTREG_VM_OPTIONS) $$(JTREG_JAVA_OPTIONS), \
 905     ))
 906   endif
 907 
 908   ifneq ($$($1_AOT_OPTIONS), )
 909     $1_JTREG_BASIC_OPTIONS += -vmoptions:&quot;$$($1_AOT_OPTIONS)&quot;
 910   endif
 911 
 912   clean-workdir-$1:
 913 	$$(RM) -r $$($1_TEST_SUPPORT_DIR)
 914 































 915   run-test-$1: pre-run-test clean-workdir-$1 $$($1_AOT_TARGETS)
 916 	$$(call LogWarn)
 917 	$$(call LogWarn, Running test &#39;$$($1_TEST)&#39;)
 918 	$$(call MakeDir, $$($1_TEST_RESULTS_DIR) $$($1_TEST_SUPPORT_DIR))
<span class="line-modified"> 919 	$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)/jtreg, \</span>
<span class="line-modified"> 920 	    $$(COV_ENVIRONMENT) \</span>
<span class="line-modified"> 921 	    $$(JAVA) $$($1_JTREG_LAUNCHER_OPTIONS) \</span>
<span class="line-removed"> 922 	        -Dprogram=jtreg -jar $$(JT_HOME)/lib/jtreg.jar \</span>
<span class="line-removed"> 923 	        $$($1_JTREG_BASIC_OPTIONS) \</span>
<span class="line-removed"> 924 	        -testjdk:$$(JDK_UNDER_TEST) \</span>
<span class="line-removed"> 925 	        -dir:$$(JTREG_TOPDIR) \</span>
<span class="line-removed"> 926 	        -reportDir:$$($1_TEST_RESULTS_DIR) \</span>
<span class="line-removed"> 927 	        -workDir:$$($1_TEST_SUPPORT_DIR) \</span>
<span class="line-removed"> 928 	        $$(JTREG_OPTIONS) \</span>
<span class="line-removed"> 929 	        $$(JTREG_FAILURE_HANDLER_OPTIONS) \</span>
<span class="line-removed"> 930 	        $$(JTREG_COV_OPTIONS) \</span>
<span class="line-removed"> 931 	        $$($1_TEST_NAME) \</span>
<span class="line-removed"> 932 	    &amp;&amp; $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \</span>
<span class="line-removed"> 933 	    || $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \</span>
<span class="line-removed"> 934 	)</span>
 935 
 936   $1_RESULT_FILE := $$($1_TEST_RESULTS_DIR)/text/stats.txt
 937 
 938   parse-test-$1: run-test-$1
 939 	$$(call LogWarn, Finished running test &#39;$$($1_TEST)&#39;)
 940 	$$(call LogWarn, Test report is stored in $$(strip \
 941 	    $$(subst $$(TOPDIR)/, , $$($1_TEST_RESULTS_DIR))))
 942 	$$(if $$(wildcard $$($1_RESULT_FILE)), \
 943 	  $$(eval $1_PASSED := $$(shell $$(AWK) &#39;{ gsub(/[,;]/, &quot;&quot;); \
 944 	      for (i=1; i&lt;=NF; i++) { if ($$$$i == &quot;passed:&quot;) \
 945 	      print $$$$(i+1) } }&#39; $$($1_RESULT_FILE))) \
 946 	  $$(if $$($1_PASSED), , $$(eval $1_PASSED := 0)) \
 947 	  $$(eval $1_FAILED := $$(shell $$(AWK) &#39;{gsub(/[,;]/, &quot;&quot;); \
 948 	      for (i=1; i&lt;=NF; i++) { if ($$$$i == &quot;failed:&quot;) \
 949 	      print $$$$(i+1) } }&#39; $$($1_RESULT_FILE))) \
 950 	  $$(if $$($1_FAILED), , $$(eval $1_FAILED := 0)) \
 951 	  $$(eval $1_ERROR := $$(shell $$(AWK) &#39;{gsub(/[,;]/, &quot;&quot;); \
 952 	      for (i=1; i&lt;=NF; i++) { if ($$$$i == &quot;error:&quot;) \
 953 	      print $$$$(i+1) } }&#39; $$($1_RESULT_FILE))) \
 954 	  $$(if $$($1_ERROR), , $$(eval $1_ERROR := 0)) \
</pre>
<hr />
<pre>
 990   ifeq ($$($1_TEST_NAME), failure-handler)
 991     ifeq ($(BUILD_FAILURE_HANDLER), true)
 992       $1_TEST_COMMAND_LINE := \
 993           ($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f \
 994           BuildFailureHandler.gmk test)
 995     else
 996       $$(error Cannot test failure handler if it is not built)
 997     endif
 998   else ifeq ($$($1_TEST_NAME), make)
 999     $1_TEST_COMMAND_LINE := \
1000         ($(CD) $(TOPDIR)/test/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f \
1001         TestMake.gmk $$($1_TEST_ARGS))
1002   else
1003     $$(error Invalid special test specification: $$($1_TEST_NAME))
1004   endif
1005 
1006   run-test-$1: pre-run-test
1007 	$$(call LogWarn)
1008 	$$(call LogWarn, Running test &#39;$$($1_TEST)&#39;)
1009 	$$(call MakeDir, $$($1_TEST_RESULTS_DIR) $$($1_TEST_SUPPORT_DIR))
<span class="line-modified">1010 	$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)/test-execution, \</span>
1011 	    $$($1_TEST_COMMAND_LINE) \
1012 	        &gt; &gt;($(TEE) $$($1_TEST_RESULTS_DIR)/test-output.txt) \
1013 	    &amp;&amp; $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
1014 	    || $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
<span class="line-modified">1015 	)</span>
1016 
1017   $1_RESULT_FILE := $$($1_TEST_RESULTS_DIR)/gtest.txt
1018 
1019   # We can not parse the various &quot;special&quot; tests.
1020   parse-test-$1: run-test-$1
1021 	$$(call LogWarn, Finished running test &#39;$$($1_TEST)&#39;)
1022 	$$(call LogWarn, Test report is stored in $$(strip \
1023 	    $$(subst $$(TOPDIR)/, , $$($1_TEST_RESULTS_DIR))))
1024 	$$(call LogWarn, Warning: Special test results are not properly parsed!)
<span class="line-modified">1025 	$$(eval $1_PASSED := 0)</span>
<span class="line-modified">1026 	$$(eval $1_FAILED := 0)</span>




1027 	$$(eval $1_ERROR := 0)
<span class="line-modified">1028 	$$(eval $1_TOTAL := 0)</span>
1029 
1030   $1: run-test-$1 parse-test-$1
1031 
1032   TARGETS += $1 run-test-$1 parse-test-$1
1033   TEST_TARGETS += parse-test-$1
1034 
1035 endef
1036 
1037 ################################################################################
1038 # Setup and execute make rules for all selected tests
1039 ################################################################################
1040 
1041 # Helper function to determine which handler to use for the given test
1042 UseGtestTestHandler = \
1043   $(if $(filter gtest:%, $1), true)
1044 
1045 UseMicroTestHandler = \
1046   $(if $(filter micro:%, $1), true)
1047 
1048 UseJtregTestHandler = \
</pre>
<hr />
<pre>
1177 
1178 ifeq ($(TEST_OPTS_JCOV), true)
1179 
1180   jcov-do-start-grabber:
1181 	$(call MakeDir, $(JCOV_OUTPUT_DIR))
1182 	if $(JAVA) -jar $(JCOV_HOME)/lib/jcov.jar GrabberManager -status 1&gt;/dev/null 2&gt;&amp;1 ; then \
1183 	  $(JAVA) -jar $(JCOV_HOME)/lib/jcov.jar GrabberManager -stop -stoptimeout 3600 ; \
1184 	fi
1185 	$(JAVA) -Xmx4g -jar $(JCOV_HOME)/lib/jcov.jar Grabber -v -t \
1186 	    $(JCOV_IMAGE_DIR)/template.xml -o $(JCOV_RESULT_FILE) \
1187 	    1&gt;$(JCOV_GRABBER_LOG) 2&gt;&amp;1 &amp;
1188 
1189   jcov-start-grabber: jcov-do-start-grabber
1190 	$(call LogWarn, Starting JCov Grabber...)
1191 	$(JAVA) -jar $(JCOV_HOME)/lib/jcov.jar GrabberManager -t 600 -wait
1192 
1193   jcov-stop-grabber:
1194 	$(call LogWarn, Stopping JCov Grabber...)
1195 	$(JAVA) -jar $(JCOV_HOME)/lib/jcov.jar GrabberManager -stop -stoptimeout 3600
1196 






1197   jcov-gen-report: jcov-stop-grabber
1198 	$(call LogWarn, Generating JCov report ...)
1199 	$(JAVA) -Xmx4g -jar $(JCOV_HOME)/lib/jcov.jar RepGen -sourcepath \
1200 	    `$(ECHO) $(TOPDIR)/src/*/share/classes/ | $(TR) &#39; &#39; &#39;:&#39;` -fmt html \


1201 	    -o $(JCOV_REPORT) $(JCOV_RESULT_FILE)
1202 
1203   TARGETS += jcov-do-start-grabber jcov-start-grabber jcov-stop-grabber \
1204       jcov-gen-report
1205 
1206   # Hook this into the framework at appropriate places
1207   pre-run-test: jcov-start-grabber
1208 
1209   post-run-test: jcov-gen-report
1210 
1211   jcov-gen-report: run-all-tests
1212 
1213 endif
1214 
1215 ################################################################################
1216 
1217 all: run-test
1218 
1219 .PHONY: default all $(TARGETS)
</pre>
</td>
<td>
<hr />
<pre>
  81 $(eval $(call IncludeCustomExtension, RunTests.gmk))
  82 ################################################################################
  83 
  84 # This is the JDK that we will test
  85 JDK_UNDER_TEST := $(JDK_IMAGE_DIR)
  86 
  87 TEST_RESULTS_DIR := $(OUTPUTDIR)/test-results
  88 TEST_SUPPORT_DIR := $(OUTPUTDIR)/test-support
  89 TEST_SUMMARY := $(TEST_RESULTS_DIR)/test-summary.txt
  90 TEST_LAST_IDS := $(TEST_SUPPORT_DIR)/test-last-ids.txt
  91 
  92 ifeq ($(CUSTOM_ROOT), )
  93   JTREG_TOPDIR := $(TOPDIR)
  94 else
  95   JTREG_TOPDIR := $(CUSTOM_ROOT)
  96 endif
  97 
  98 JTREG_FAILURE_HANDLER_DIR := $(TEST_IMAGE_DIR)/failure_handler
  99 JTREG_FAILURE_HANDLER := $(JTREG_FAILURE_HANDLER_DIR)/jtregFailureHandler.jar
 100 
<span class="line-added"> 101 JTREG_FAILURE_HANDLER_TIMEOUT ?= 0</span>
<span class="line-added"> 102 </span>
 103 ifneq ($(wildcard $(JTREG_FAILURE_HANDLER)), )
 104   JTREG_FAILURE_HANDLER_OPTIONS := \
 105       -timeoutHandlerDir:$(JTREG_FAILURE_HANDLER) \
 106       -observerDir:$(JTREG_FAILURE_HANDLER) \
 107       -timeoutHandler:jdk.test.failurehandler.jtreg.GatherProcessInfoTimeoutHandler \
 108       -observer:jdk.test.failurehandler.jtreg.GatherDiagnosticInfoObserver \
<span class="line-modified"> 109       -timeoutHandlerTimeout:$(JTREG_FAILURE_HANDLER_TIMEOUT)</span>
 110 endif
 111 
 112 GTEST_LAUNCHER_DIRS := $(patsubst %/gtestLauncher, %, \
 113     $(wildcard $(TEST_IMAGE_DIR)/hotspot/gtest/*/gtestLauncher))
 114 GTEST_VARIANTS := $(strip $(patsubst $(TEST_IMAGE_DIR)/hotspot/gtest/%, %, \
 115     $(GTEST_LAUNCHER_DIRS)))
 116 
 117 COV_ENVIRONMENT :=
 118 JTREG_COV_OPTIONS :=
 119 
 120 ifeq ($(TEST_OPTS_JCOV), true)
 121   JCOV_OUTPUT_DIR := $(TEST_RESULTS_DIR)/jcov-output
 122   JCOV_GRABBER_LOG := $(JCOV_OUTPUT_DIR)/grabber.log
 123   JCOV_RESULT_FILE := $(JCOV_OUTPUT_DIR)/result.xml
 124   JCOV_REPORT := $(JCOV_OUTPUT_DIR)/report
 125   JCOV_MEM_OPTIONS := -Xms64m -Xmx4g
 126 
 127   # Replace our normal test JDK with the JCov image.
 128   JDK_UNDER_TEST := $(JCOV_IMAGE_DIR)
 129 
</pre>
<hr />
<pre>
 168       -J-Xmx4g --info \
 169       $$(addprefix -J, $$(filter-out -Xcomp %TieredCompilation, $$($1_VM_OPTIONS))) \
 170       $$(addprefix --compile-commands$(SPACE), $$($1_AOT_CCLIST)) \
 171       --linker-path $$(LD_JAOTC) \
 172       #
 173 
 174   ifneq ($$(filter -ea, $$($1_VM_OPTIONS)), )
 175     $1_JAOTC_OPTS += --compile-with-assertions
 176   endif
 177 
 178   $$($1_AOT_LIB): $$(JDK_UNDER_TEST)/release \
 179       $$(call DependOnVariable, $1_JAOTC_OPTS) \
 180       $$(call DependOnVariable, JDK_UNDER_TEST)
 181 	$$(call LogWarn, Generating $$(patsubst $$(OUTPUTDIR)/%, %, $$@))
 182 	$$(call MakeTargetDir)
 183 	$$(call ExecuteWithLog, $$@, \
 184 	    $((COV_ENVIRONMENT) \
 185 	    $$(FIXPATH) $$(JDK_UNDER_TEST)/bin/jaotc \
 186 	        $$($1_JAOTC_OPTS) --output $$@ --module $$($1_MODULE) \
 187 	)
<span class="line-modified"> 188 	$$(call ExecuteWithLog, $$@.check, ( \</span>
 189 	    $$(FIXPATH) $$(JDK_UNDER_TEST)/bin/java \
<span class="line-modified"> 190 	        $$($1_VM_OPTIONS) -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions \</span>
 191 	        -XX:+PrintAOT -XX:+UseAOTStrictLoading \
 192 	        -XX:AOTLibrary=$$@ -version \
 193 	         &gt; $$@.verify-aot \
<span class="line-modified"> 194 	))</span>
 195 
<span class="line-added"> 196   $1_AOT_OPTIONS += -XX:+UnlockExperimentalVMOptions</span>
 197   $1_AOT_OPTIONS += -XX:AOTLibrary=$$($1_AOT_LIB)
 198   $1_AOT_TARGETS += $$($1_AOT_LIB)
 199 endef
 200 
 201 # Parameter 1 is the name of the rule.
 202 #
 203 # Remaining parameters are named arguments.
 204 #   MODULES     The modules to generate a library for
 205 #   VM_OPTIONS  List of JVM arguments to use when creating libraries
 206 #
 207 # After calling this, the following variables are defined
 208 #   $1_AOT_OPTIONS List of all java options needed to use the AOT libraries
 209 #   $1_AOT_TARGETS List of all targets that the test rule will need to depend on
 210 #
 211 SetupAot = $(NamedParamsMacroTemplate)
 212 define SetupAotBody
 213   $$(info Running with AOTd libraries for $$($1_MODULES))
 214   # Put aot libraries in a separate directory so they are not deleted between
 215   # test runs and may be reused between make invocations.
 216   $$(foreach m, $$($1_MODULES), \
</pre>
<hr />
<pre>
 230 
 231 # Each factor variable comes in 3 variants. The first one is reserved for users
 232 # to use on command line. The other two are for predifined configurations in JDL
 233 # and for machine specific configurations respectively.
 234 TEST_JOBS_FACTOR ?= 1
 235 TEST_JOBS_FACTOR_JDL ?= 1
 236 TEST_JOBS_FACTOR_MACHINE ?= 1
 237 
 238 ifeq ($(TEST_JOBS), 0)
 239   CORES_DIVIDER := 2
 240   ifeq ($(call isTargetCpuArch, sparc), true)
 241     # For smaller SPARC machines we see reasonable scaling of throughput up to
 242     # cpus/4 without affecting test reliability. On the bigger machines, cpus/4
 243     # causes intermittent timeouts.
 244     ifeq ($(shell $(EXPR) $(NUM_CORES) \&gt; 16), 1)
 245       CORES_DIVIDER := 5
 246     else
 247       CORES_DIVIDER := 4
 248     endif
 249   endif
<span class="line-added"> 250   # For some big multi-core machines with low ulimit -u setting we hit the max</span>
<span class="line-added"> 251   # threads/process limit. In such a setup the memory/cores-only-guided</span>
<span class="line-added"> 252   # TEST_JOBS config is insufficient. From experience a concurrency setting of</span>
<span class="line-added"> 253   # 14 works reasonably well for low ulimit values (&lt;= 4096). Thus, use</span>
<span class="line-added"> 254   # divider 4096/14. For high ulimit -u values this shouldn&#39;t make a difference.</span>
<span class="line-added"> 255   ULIMIT_DIVIDER := (4096/14)</span>
<span class="line-added"> 256   PROC_ULIMIT := -1</span>
<span class="line-added"> 257   ifneq ($(OPENJDK_TARGET_OS), windows)</span>
<span class="line-added"> 258     PROC_ULIMIT := $(shell $(ULIMIT) -u)</span>
<span class="line-added"> 259     ifeq ($(PROC_ULIMIT), unlimited)</span>
<span class="line-added"> 260       PROC_ULIMIT := -1</span>
<span class="line-added"> 261     endif</span>
<span class="line-added"> 262   endif</span>
 263   MEMORY_DIVIDER := 2048
 264   TEST_JOBS := $(shell $(AWK) \
 265     &#39;BEGIN { \
 266       c = $(NUM_CORES) / $(CORES_DIVIDER); \
 267       m = $(MEMORY_SIZE) / $(MEMORY_DIVIDER); \
<span class="line-added"> 268       u = $(PROC_ULIMIT); \</span>
<span class="line-added"> 269       if (u &gt; -1) { \</span>
<span class="line-added"> 270         u = u / $(ULIMIT_DIVIDER); \</span>
<span class="line-added"> 271         if (u &lt; c) c = u; \</span>
<span class="line-added"> 272       } \</span>
 273       if (c &gt; m) c = m; \
 274       c = c * $(TEST_JOBS_FACTOR); \
 275       c = c * $(TEST_JOBS_FACTOR_JDL); \
 276       c = c * $(TEST_JOBS_FACTOR_MACHINE); \
 277       if (c &lt; 1) c = 1; \
 278       printf &quot;%.0f&quot;, c; \
 279     }&#39;)
 280 endif
 281 
 282 ################################################################################
 283 # Parse control variables
 284 ################################################################################
 285 
 286 ifneq ($(TEST_OPTS), )
 287   # Inform the user
 288   $(info Running tests using TEST_OPTS control variable &#39;$(TEST_OPTS)&#39;)
 289 endif
 290 
 291 ### Jtreg
 292 
 293 $(eval $(call SetTestOpt,VM_OPTIONS,JTREG))
 294 $(eval $(call SetTestOpt,JAVA_OPTIONS,JTREG))
 295 $(eval $(call SetTestOpt,AOT_MODULES,JTREG))
 296 
 297 $(eval $(call SetTestOpt,JOBS,JTREG))
 298 $(eval $(call SetTestOpt,TIMEOUT_FACTOR,JTREG))
<span class="line-added"> 299 $(eval $(call SetTestOpt,FAILURE_HANDLER_TIMEOUT,JTREG))</span>
 300 
 301 $(eval $(call ParseKeywordVariable, JTREG, \
<span class="line-modified"> 302     SINGLE_KEYWORDS := JOBS TIMEOUT_FACTOR FAILURE_HANDLER_TIMEOUT \</span>
<span class="line-modified"> 303         TEST_MODE ASSERT VERBOSE RETAIN MAX_MEM RUN_PROBLEM_LISTS \</span>
<span class="line-added"> 304         RETRY_COUNT, \</span>
 305     STRING_KEYWORDS := OPTIONS JAVA_OPTIONS VM_OPTIONS KEYWORDS \
 306         EXTRA_PROBLEM_LISTS AOT_MODULES, \
 307 ))
 308 
 309 ifneq ($(JTREG), )
 310   # Inform the user
 311   $(info Running tests using JTREG control variable &#39;$(JTREG)&#39;)
 312 endif
 313 
 314 ### Gtest
 315 
 316 $(eval $(call SetTestOpt,VM_OPTIONS,GTEST))
 317 $(eval $(call SetTestOpt,JAVA_OPTIONS,GTEST))
 318 $(eval $(call SetTestOpt,AOT_MODULES,GTEST))
 319 
 320 $(eval $(call ParseKeywordVariable, GTEST, \
 321     SINGLE_KEYWORDS := REPEAT, \
 322     STRING_KEYWORDS := OPTIONS VM_OPTIONS JAVA_OPTIONS AOT_MODULES, \
 323 ))
 324 
</pre>
<hr />
<pre>
 595       $$(patsubst gtest:%, %, $$($1_TEST))))
 596   ifneq ($$($1_TEST_NAME), all)
 597     $1_GTEST_FILTER := --gtest_filter=$$($1_TEST_NAME)*
 598   endif
 599 
 600   ifneq ($$(GTEST_REPEAT), )
 601     $1_GTEST_REPEAT :=--gtest_repeat=$$(GTEST_REPEAT)
 602   endif
 603 
 604   ifneq ($$(GTEST_AOT_MODULES), )
 605     $$(eval $$(call SetupAot, $1, \
 606         MODULES := $$(GTEST_AOT_MODULES), \
 607         VM_OPTIONS := $$(GTEST_VM_OPTIONS) $$(GTEST_JAVA_OPTIONS), \
 608     ))
 609   endif
 610 
 611   run-test-$1: pre-run-test $$($1_AOT_TARGETS)
 612 	$$(call LogWarn)
 613 	$$(call LogWarn, Running test &#39;$$($1_TEST)&#39;)
 614 	$$(call MakeDir, $$($1_TEST_RESULTS_DIR) $$($1_TEST_SUPPORT_DIR))
<span class="line-modified"> 615 	$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)/gtest, ( \</span>
 616 	    $$(FIXPATH) $$(TEST_IMAGE_DIR)/hotspot/gtest/$$($1_VARIANT)/gtestLauncher \
 617 	        -jdk $(JDK_UNDER_TEST) $$($1_GTEST_FILTER) \
 618 	        --gtest_output=xml:$$($1_TEST_RESULTS_DIR)/gtest.xml \
 619 	        $$($1_GTEST_REPEAT) $$(GTEST_OPTIONS) $$(GTEST_VM_OPTIONS) \
 620 	        $$(GTEST_JAVA_OPTIONS) $$($1_AOT_OPTIONS) \
 621 	        &gt; &gt;($(TEE) $$($1_TEST_RESULTS_DIR)/gtest.txt) \
 622 	    &amp;&amp; $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
 623 	    || $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
<span class="line-modified"> 624 	))</span>
 625 
 626   $1_RESULT_FILE := $$($1_TEST_RESULTS_DIR)/gtest.txt
 627 
 628   parse-test-$1: run-test-$1
 629 	$$(call LogWarn, Finished running test &#39;$$($1_TEST)&#39;)
 630 	$$(call LogWarn, Test report is stored in $$(strip \
 631 	    $$(subst $$(TOPDIR)/, , $$($1_TEST_RESULTS_DIR))))
 632 	$$(if $$(wildcard $$($1_RESULT_FILE)), \
 633 	  $$(eval $1_TOTAL := $$(shell $$(AWK) &#39;/==========.* tests? from .* \
 634 	      test cases? ran/ { print $$$$2 }&#39; $$($1_RESULT_FILE))) \
 635 	  $$(if $$($1_TOTAL), , $$(eval $1_TOTAL := 0)) \
 636 	  $$(eval $1_PASSED := $$(shell $$(AWK) &#39;/\[  PASSED  \] .* tests?./ \
 637 	      { print $$$$4 }&#39; $$($1_RESULT_FILE))) \
 638 	  $$(if $$($1_PASSED), , $$(eval $1_PASSED := 0)) \
 639 	  $$(eval $1_FAILED := $$(shell $$(AWK) &#39;/\[  FAILED  \] .* tests?, \
 640 	      listed below/ { print $$$$4 }&#39; $$($1_RESULT_FILE))) \
 641 	  $$(if $$($1_FAILED), , $$(eval $1_FAILED := 0)) \
 642 	  $$(eval $1_ERROR := $$(shell \
 643 	      $$(EXPR) $$($1_TOTAL) - $$($1_PASSED) - $$($1_FAILED))) \
 644 	, \
</pre>
<hr />
<pre>
 684   $1_EXITCODE := $$($1_TEST_RESULTS_DIR)/exitcode.txt
 685 
 686   $1_TEST_NAME := $$(strip $$(patsubst micro:%, %, $$($1_TEST)))
 687 
 688   $$(eval $$(call SetMicroValue,$1,MICRO_BENCHMARKS_JAR,$$(TEST_IMAGE_DIR)/micro/benchmarks.jar))
 689   $$(eval $$(call SetMicroValue,$1,MICRO_TEST_JDK,$$(JDK_UNDER_TEST)))
 690   $$(eval $$(call SetMicroValue,$1,MICRO_JAVA_OPTIONS))
 691 
 692   # Current tests needs to open java.io
 693   $1_MICRO_JAVA_OPTIONS += --add-opens=java.base/java.io=ALL-UNNAMED
 694   # Set library path for native dependencies
 695   $1_MICRO_JAVA_OPTIONS += -Djava.library.path=$$(TEST_IMAGE_DIR)/micro/native
 696 
 697   # Save output as JSON or CSV file
 698   ifneq ($$(MICRO_RESULTS_FORMAT), )
 699     $1_MICRO_BASIC_OPTIONS += -rf $$(MICRO_RESULTS_FORMAT)
 700     $1_MICRO_BASIC_OPTIONS += -rff $$($1_TEST_RESULTS_DIR)/jmh-result.$(MICRO_RESULTS_FORMAT)
 701   endif
 702 
 703   ifneq ($$(MICRO_VM_OPTIONS)$$(MICRO_JAVA_OPTIONS), )
<span class="line-modified"> 704     JMH_JVM_ARGS := $$(MICRO_VM_OPTIONS) $$(MICRO_JAVA_OPTIONS)</span>
<span class="line-added"> 705     $1_MICRO_VM_OPTIONS := -jvmArgs $(call ShellQuote,$$(JMH_JVM_ARGS))</span>
 706   endif
 707 
 708   ifneq ($$(MICRO_ITER), )
 709     $1_MICRO_ITER := -i $$(MICRO_ITER)
 710   endif
 711   ifneq ($$(MICRO_FORK), )
 712     $1_MICRO_FORK := -f $$(MICRO_FORK)
 713   endif
 714   ifneq ($$(MICRO_TIME), )
 715     $1_MICRO_TIME := -r $$(MICRO_TIME)
 716   endif
 717   ifneq ($$(MICRO_WARMUP_ITER), )
 718     $1_MICRO_WARMUP_ITER := -wi $$(MICRO_WARMUP_ITER)
 719   endif
 720   ifneq ($$(MICRO_WARMUP_TIME), )
 721     $1_MICRO_WARMUP_TIME := -w $$(MICRO_WARMUP_TIME)
 722   endif
 723 
 724   run-test-$1: pre-run-test
 725 	$$(call LogWarn)
 726 	$$(call LogWarn, Running test &#39;$$($1_TEST)&#39;)
 727 	$$(call MakeDir, $$($1_TEST_RESULTS_DIR) $$($1_TEST_SUPPORT_DIR))
<span class="line-modified"> 728 	$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)/micro, ( \</span>
 729 	    $$(FIXPATH) $$($1_MICRO_TEST_JDK)/bin/java $$($1_MICRO_JAVA_OPTIONS) \
 730 	        -jar $$($1_MICRO_BENCHMARKS_JAR) \
 731 	        $$($1_MICRO_ITER) $$($1_MICRO_FORK) $$($1_MICRO_TIME) \
 732 	        $$($1_MICRO_WARMUP_ITER) $$($1_MICRO_WARMUP_TIME) \
 733 	        $$($1_MICRO_VM_OPTIONS) $$($1_MICRO_BASIC_OPTIONS) $$(MICRO_OPTIONS) \
 734 	        $$($1_TEST_NAME) \
 735 	        &gt; &gt;($(TEE) $$($1_TEST_RESULTS_DIR)/micro.txt) \
 736 	    &amp;&amp; $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
 737 	    || $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
<span class="line-modified"> 738 	))</span>
 739 
 740   $1_RESULT_FILE := $$($1_TEST_RESULTS_DIR)/micro.txt
 741 
 742   parse-test-$1: run-test-$1
 743 	$$(call LogWarn, Finished running test &#39;$$($1_TEST)&#39;)
 744 	$$(call LogWarn, Test report is stored in $$(strip \
 745 	    $$(subst $$(TOPDIR)/, , $$($1_TEST_RESULTS_DIR))))
 746 	$$(if $$(wildcard $$($1_EXITCODE)), \
 747 	  $$(eval $1_EXIT_CODE := $$(shell $$(CAT) $$($1_EXITCODE))) \
 748 	  $$(if $$(filter 0, $$($1_EXIT_CODE)), \
 749 	    $$(eval $1_PASSED := 1) \
 750 	    $$(eval $1_ERROR := 0) \
 751 	  , \
 752 	    $$(eval $1_PASSED := 0) \
 753 	    $$(eval $1_ERROR := 1) \
 754 	  ) \
 755 	  $$(eval $1_FAILED := 0) \
 756 	  $$(eval $1_TOTAL := $$(shell \
 757 	      $$(EXPR) $$($1_PASSED) + $$($1_ERROR))) \
 758 	, \
</pre>
<hr />
<pre>
 835   $1_JTREG_PROBLEM_LIST := $$(filter $$($1_TEST_ROOT)%, $$($1_JTREG_PROBLEM_LIST))
 836 
 837   ifneq ($(TEST_JOBS), 0)
 838     $$(eval $$(call SetJtregValue,$1,JTREG_JOBS,$$(TEST_JOBS)))
 839   else
 840     $$(eval $$(call SetJtregValue,$1,JTREG_JOBS,$$(JOBS)))
 841   endif
 842 
 843   # Make sure MaxRAMPercentage is high enough to not cause OOM or swapping since
 844   # we may end up with a lot of JVM&#39;s
 845   $1_JTREG_MAX_RAM_PERCENTAGE := $$(shell $$(EXPR) 25 / $$($1_JTREG_JOBS))
 846 
 847   # SPARC is in general slower per core so need to scale up timeouts a bit.
 848   ifeq ($(call isTargetCpuArch, sparc), true)
 849     JTREG_TIMEOUT_FACTOR ?= 8
 850   else
 851     JTREG_TIMEOUT_FACTOR ?= 4
 852   endif
 853   JTREG_VERBOSE ?= fail,error,summary
 854   JTREG_RETAIN ?= fail,error
<span class="line-added"> 855   JTREG_RUN_PROBLEM_LISTS ?= false</span>
<span class="line-added"> 856   JTREG_RETRY_COUNT ?= 0</span>
 857 
 858   ifneq ($$($1_JTREG_MAX_MEM), 0)
 859     $1_JTREG_BASIC_OPTIONS += -vmoption:-Xmx$$($1_JTREG_MAX_MEM)
 860     $1_JTREG_LAUNCHER_OPTIONS += -Xmx$$($1_JTREG_MAX_MEM)
 861   endif
 862 
 863   $1_JTREG_BASIC_OPTIONS += -$$($1_JTREG_TEST_MODE) \
 864       -verbose:$$(JTREG_VERBOSE) -retain:$$(JTREG_RETAIN) \
 865       -concurrency:$$($1_JTREG_JOBS) -timeoutFactor:$$(JTREG_TIMEOUT_FACTOR) \
 866       -vmoption:-XX:MaxRAMPercentage=$$($1_JTREG_MAX_RAM_PERCENTAGE)
 867 
 868   $1_JTREG_BASIC_OPTIONS += -automatic -ignore:quiet
 869 
 870   # Make it possible to specify the JIB_DATA_DIR for tests using the
 871   # JIB Artifact resolver
 872   $1_JTREG_BASIC_OPTIONS += -e:JIB_DATA_DIR
 873   # Some tests needs to find a boot JDK using the JDK8_HOME variable.
 874   $1_JTREG_BASIC_OPTIONS += -e:JDK8_HOME=$$(BOOT_JDK)
 875   # If running on Windows, propagate the _NT_SYMBOL_PATH to enable
 876   # symbol lookup in hserr files
 877   ifeq ($$(call isTargetOs, windows), true)
 878     $1_JTREG_BASIC_OPTIONS += -e:_NT_SYMBOL_PATH
 879   endif
 880 
 881   $1_JTREG_BASIC_OPTIONS += \
 882       $$(addprefix -javaoption:, $$(JTREG_JAVA_OPTIONS)) \
 883       $$(addprefix -vmoption:, $$(JTREG_VM_OPTIONS)) \
 884       #
 885 
 886   ifeq ($$($1_JTREG_ASSERT), true)
 887     $1_JTREG_BASIC_OPTIONS += -ea -esa
 888   endif
 889 
 890   ifneq ($$($1_JTREG_NATIVEPATH), )
 891     $1_JTREG_BASIC_OPTIONS += -nativepath:$$($1_JTREG_NATIVEPATH)
 892   endif
 893 
<span class="line-added"> 894   ifeq ($$(JTREG_RUN_PROBLEM_LISTS), true)</span>
<span class="line-added"> 895     JTREG_PROBLEM_LIST_PREFIX := -match:</span>
<span class="line-added"> 896   else</span>
<span class="line-added"> 897     JTREG_PROBLEM_LIST_PREFIX := -exclude:</span>
<span class="line-added"> 898   endif</span>
<span class="line-added"> 899 </span>
 900   ifneq ($$($1_JTREG_PROBLEM_LIST), )
<span class="line-modified"> 901     $1_JTREG_BASIC_OPTIONS += $$(addprefix $$(JTREG_PROBLEM_LIST_PREFIX), $$($1_JTREG_PROBLEM_LIST))</span>
 902   endif
 903 
 904   ifneq ($$(JTREG_EXTRA_PROBLEM_LISTS), )
 905     # Accept both absolute paths as well as relative to the current test root.
<span class="line-modified"> 906     $1_JTREG_BASIC_OPTIONS += $$(addprefix $$(JTREG_PROBLEM_LIST_PREFIX), $$(wildcard \</span>
 907         $$(JTREG_EXTRA_PROBLEM_LISTS) \
 908         $$(addprefix $$($1_TEST_ROOT)/, $$(JTREG_EXTRA_PROBLEM_LISTS)) \
 909     ))
 910   endif
 911 
 912   ifneq ($$(JIB_HOME), )
 913     $1_JTREG_BASIC_OPTIONS += -e:JIB_HOME=$$(JIB_HOME)
 914   endif
 915 
<span class="line-modified"> 916   $1_JTREG_BASIC_OPTIONS += -e:TEST_IMAGE_DIR=$(TEST_IMAGE_DIR)</span>
<span class="line-added"> 917   $1_JTREG_BASIC_OPTIONS += -e:TEST_IMAGE_GRAAL_DIR=$(TEST_IMAGE_DIR)/hotspot/jtreg/graal</span>
 918 
 919   ifneq ($$(JTREG_FAILURE_HANDLER_OPTIONS), )
 920     $1_JTREG_LAUNCHER_OPTIONS += -Djava.library.path=&quot;$(JTREG_FAILURE_HANDLER_DIR)&quot;
 921   endif
 922 
 923   ifneq ($$(JTREG_KEYWORDS), )
 924     # The keywords string may contain problematic characters and may be quoted
 925     # already when it arrives here. Remove any existing quotes and replace them
 926     # with one set of single quotes.
 927     $1_JTREG_KEYWORDS := \
 928         $$(strip $$(subst $$(SQUOTE),,$$(subst $$(DQUOTE),,$$(JTREG_KEYWORDS))))
 929     ifneq ($$($1_JTREG_KEYWORDS), )
 930       $1_JTREG_BASIC_OPTIONS += -k:&#39;$$($1_JTREG_KEYWORDS)&#39;
 931     endif
 932   endif
 933 
 934   ifneq ($$(JTREG_AOT_MODULES), )
 935     $$(eval $$(call SetupAot, $1, \
 936         MODULES := $$(JTREG_AOT_MODULES), \
 937         VM_OPTIONS := $$(JTREG_VM_OPTIONS) $$(JTREG_JAVA_OPTIONS), \
 938     ))
 939   endif
 940 
 941   ifneq ($$($1_AOT_OPTIONS), )
 942     $1_JTREG_BASIC_OPTIONS += -vmoptions:&quot;$$($1_AOT_OPTIONS)&quot;
 943   endif
 944 
 945   clean-workdir-$1:
 946 	$$(RM) -r $$($1_TEST_SUPPORT_DIR)
 947 
<span class="line-added"> 948   $1_COMMAND_LINE := \</span>
<span class="line-added"> 949       $$(JAVA) $$($1_JTREG_LAUNCHER_OPTIONS) \</span>
<span class="line-added"> 950           -Dprogram=jtreg -jar $$(JT_HOME)/lib/jtreg.jar \</span>
<span class="line-added"> 951           $$($1_JTREG_BASIC_OPTIONS) \</span>
<span class="line-added"> 952           -testjdk:$$(JDK_UNDER_TEST) \</span>
<span class="line-added"> 953           -dir:$$(JTREG_TOPDIR) \</span>
<span class="line-added"> 954           -reportDir:$$($1_TEST_RESULTS_DIR) \</span>
<span class="line-added"> 955           -workDir:$$($1_TEST_SUPPORT_DIR) \</span>
<span class="line-added"> 956           -status:$$$${JTREG_STATUS} \</span>
<span class="line-added"> 957           $$(JTREG_OPTIONS) \</span>
<span class="line-added"> 958           $$(JTREG_FAILURE_HANDLER_OPTIONS) \</span>
<span class="line-added"> 959           $$(JTREG_COV_OPTIONS) \</span>
<span class="line-added"> 960           $$($1_TEST_NAME) \</span>
<span class="line-added"> 961       &amp;&amp; $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \</span>
<span class="line-added"> 962       || $$(ECHO) $$$$? &gt; $$($1_EXITCODE)</span>
<span class="line-added"> 963 </span>
<span class="line-added"> 964 </span>
<span class="line-added"> 965   ifneq ($$(JTREG_RETRY_COUNT), 0)</span>
<span class="line-added"> 966     $1_COMMAND_LINE := \</span>
<span class="line-added"> 967         for i in {0..$$(JTREG_RETRY_COUNT)}; do \</span>
<span class="line-added"> 968           if [ &quot;$$$$i&quot; != 0 ]; then \</span>
<span class="line-added"> 969             $$(PRINTF) &quot;\nRetrying Jtreg run. Attempt: $$$$i\n&quot;; \</span>
<span class="line-added"> 970           fi; \</span>
<span class="line-added"> 971           $$($1_COMMAND_LINE); \</span>
<span class="line-added"> 972           if [ &quot;`$$(CAT) $$($1_EXITCODE)`&quot; = &quot;0&quot; ]; then \</span>
<span class="line-added"> 973             break; \</span>
<span class="line-added"> 974           fi; \</span>
<span class="line-added"> 975           export JTREG_STATUS=&quot;-status:error,fail&quot;; \</span>
<span class="line-added"> 976         done</span>
<span class="line-added"> 977   endif</span>
<span class="line-added"> 978 </span>
 979   run-test-$1: pre-run-test clean-workdir-$1 $$($1_AOT_TARGETS)
 980 	$$(call LogWarn)
 981 	$$(call LogWarn, Running test &#39;$$($1_TEST)&#39;)
 982 	$$(call MakeDir, $$($1_TEST_RESULTS_DIR) $$($1_TEST_SUPPORT_DIR))
<span class="line-modified"> 983 	$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)/jtreg, ( \</span>
<span class="line-modified"> 984             $$(COV_ENVIRONMENT) $$($1_COMMAND_LINE) \</span>
<span class="line-modified"> 985 	))</span>













 986 
 987   $1_RESULT_FILE := $$($1_TEST_RESULTS_DIR)/text/stats.txt
 988 
 989   parse-test-$1: run-test-$1
 990 	$$(call LogWarn, Finished running test &#39;$$($1_TEST)&#39;)
 991 	$$(call LogWarn, Test report is stored in $$(strip \
 992 	    $$(subst $$(TOPDIR)/, , $$($1_TEST_RESULTS_DIR))))
 993 	$$(if $$(wildcard $$($1_RESULT_FILE)), \
 994 	  $$(eval $1_PASSED := $$(shell $$(AWK) &#39;{ gsub(/[,;]/, &quot;&quot;); \
 995 	      for (i=1; i&lt;=NF; i++) { if ($$$$i == &quot;passed:&quot;) \
 996 	      print $$$$(i+1) } }&#39; $$($1_RESULT_FILE))) \
 997 	  $$(if $$($1_PASSED), , $$(eval $1_PASSED := 0)) \
 998 	  $$(eval $1_FAILED := $$(shell $$(AWK) &#39;{gsub(/[,;]/, &quot;&quot;); \
 999 	      for (i=1; i&lt;=NF; i++) { if ($$$$i == &quot;failed:&quot;) \
1000 	      print $$$$(i+1) } }&#39; $$($1_RESULT_FILE))) \
1001 	  $$(if $$($1_FAILED), , $$(eval $1_FAILED := 0)) \
1002 	  $$(eval $1_ERROR := $$(shell $$(AWK) &#39;{gsub(/[,;]/, &quot;&quot;); \
1003 	      for (i=1; i&lt;=NF; i++) { if ($$$$i == &quot;error:&quot;) \
1004 	      print $$$$(i+1) } }&#39; $$($1_RESULT_FILE))) \
1005 	  $$(if $$($1_ERROR), , $$(eval $1_ERROR := 0)) \
</pre>
<hr />
<pre>
1041   ifeq ($$($1_TEST_NAME), failure-handler)
1042     ifeq ($(BUILD_FAILURE_HANDLER), true)
1043       $1_TEST_COMMAND_LINE := \
1044           ($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f \
1045           BuildFailureHandler.gmk test)
1046     else
1047       $$(error Cannot test failure handler if it is not built)
1048     endif
1049   else ifeq ($$($1_TEST_NAME), make)
1050     $1_TEST_COMMAND_LINE := \
1051         ($(CD) $(TOPDIR)/test/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f \
1052         TestMake.gmk $$($1_TEST_ARGS))
1053   else
1054     $$(error Invalid special test specification: $$($1_TEST_NAME))
1055   endif
1056 
1057   run-test-$1: pre-run-test
1058 	$$(call LogWarn)
1059 	$$(call LogWarn, Running test &#39;$$($1_TEST)&#39;)
1060 	$$(call MakeDir, $$($1_TEST_RESULTS_DIR) $$($1_TEST_SUPPORT_DIR))
<span class="line-modified">1061 	$$(call ExecuteWithLog, $$($1_TEST_SUPPORT_DIR)/test-execution, ( \</span>
1062 	    $$($1_TEST_COMMAND_LINE) \
1063 	        &gt; &gt;($(TEE) $$($1_TEST_RESULTS_DIR)/test-output.txt) \
1064 	    &amp;&amp; $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
1065 	    || $$(ECHO) $$$$? &gt; $$($1_EXITCODE) \
<span class="line-modified">1066 	))</span>
1067 
1068   $1_RESULT_FILE := $$($1_TEST_RESULTS_DIR)/gtest.txt
1069 
1070   # We can not parse the various &quot;special&quot; tests.
1071   parse-test-$1: run-test-$1
1072 	$$(call LogWarn, Finished running test &#39;$$($1_TEST)&#39;)
1073 	$$(call LogWarn, Test report is stored in $$(strip \
1074 	    $$(subst $$(TOPDIR)/, , $$($1_TEST_RESULTS_DIR))))
1075 	$$(call LogWarn, Warning: Special test results are not properly parsed!)
<span class="line-modified">1076 	$$(eval $1_PASSED := $$(shell \</span>
<span class="line-modified">1077 	  if [ `$(CAT) $$($1_EXITCODE)` = &quot;0&quot; ]; then $(ECHO) 1; else $(ECHO) 0; fi \</span>
<span class="line-added">1078 	))</span>
<span class="line-added">1079 	$$(eval $1_FAILED := $$(shell \</span>
<span class="line-added">1080 	  if [ `$(CAT) $$($1_EXITCODE)` = &quot;0&quot; ]; then $(ECHO) 0; else $(ECHO) 1; fi \</span>
<span class="line-added">1081 	))</span>
1082 	$$(eval $1_ERROR := 0)
<span class="line-modified">1083 	$$(eval $1_TOTAL := 1)</span>
1084 
1085   $1: run-test-$1 parse-test-$1
1086 
1087   TARGETS += $1 run-test-$1 parse-test-$1
1088   TEST_TARGETS += parse-test-$1
1089 
1090 endef
1091 
1092 ################################################################################
1093 # Setup and execute make rules for all selected tests
1094 ################################################################################
1095 
1096 # Helper function to determine which handler to use for the given test
1097 UseGtestTestHandler = \
1098   $(if $(filter gtest:%, $1), true)
1099 
1100 UseMicroTestHandler = \
1101   $(if $(filter micro:%, $1), true)
1102 
1103 UseJtregTestHandler = \
</pre>
<hr />
<pre>
1232 
1233 ifeq ($(TEST_OPTS_JCOV), true)
1234 
1235   jcov-do-start-grabber:
1236 	$(call MakeDir, $(JCOV_OUTPUT_DIR))
1237 	if $(JAVA) -jar $(JCOV_HOME)/lib/jcov.jar GrabberManager -status 1&gt;/dev/null 2&gt;&amp;1 ; then \
1238 	  $(JAVA) -jar $(JCOV_HOME)/lib/jcov.jar GrabberManager -stop -stoptimeout 3600 ; \
1239 	fi
1240 	$(JAVA) -Xmx4g -jar $(JCOV_HOME)/lib/jcov.jar Grabber -v -t \
1241 	    $(JCOV_IMAGE_DIR)/template.xml -o $(JCOV_RESULT_FILE) \
1242 	    1&gt;$(JCOV_GRABBER_LOG) 2&gt;&amp;1 &amp;
1243 
1244   jcov-start-grabber: jcov-do-start-grabber
1245 	$(call LogWarn, Starting JCov Grabber...)
1246 	$(JAVA) -jar $(JCOV_HOME)/lib/jcov.jar GrabberManager -t 600 -wait
1247 
1248   jcov-stop-grabber:
1249 	$(call LogWarn, Stopping JCov Grabber...)
1250 	$(JAVA) -jar $(JCOV_HOME)/lib/jcov.jar GrabberManager -stop -stoptimeout 3600
1251 
<span class="line-added">1252   JCOV_REPORT_TITLE := JDK code coverage report&lt;br/&gt;</span>
<span class="line-added">1253   ifneq ($(JCOV_FILTERS), )</span>
<span class="line-added">1254     JCOV_REPORT_TITLE += Code filters: $(JCOV_FILTERS)&lt;br&gt;</span>
<span class="line-added">1255   endif</span>
<span class="line-added">1256   JCOV_REPORT_TITLE += Tests: $(TEST)</span>
<span class="line-added">1257 </span>
1258   jcov-gen-report: jcov-stop-grabber
1259 	$(call LogWarn, Generating JCov report ...)
1260 	$(JAVA) -Xmx4g -jar $(JCOV_HOME)/lib/jcov.jar RepGen -sourcepath \
1261 	    `$(ECHO) $(TOPDIR)/src/*/share/classes/ | $(TR) &#39; &#39; &#39;:&#39;` -fmt html \
<span class="line-added">1262 	    $(JCOV_FILTERS) \</span>
<span class="line-added">1263 	    -mainReportTitle &quot;$(JCOV_REPORT_TITLE)&quot; \</span>
1264 	    -o $(JCOV_REPORT) $(JCOV_RESULT_FILE)
1265 
1266   TARGETS += jcov-do-start-grabber jcov-start-grabber jcov-stop-grabber \
1267       jcov-gen-report
1268 
1269   # Hook this into the framework at appropriate places
1270   pre-run-test: jcov-start-grabber
1271 
1272   post-run-test: jcov-gen-report
1273 
1274   jcov-gen-report: run-all-tests
1275 
1276 endif
1277 
1278 ################################################################################
1279 
1280 all: run-test
1281 
1282 .PHONY: default all $(TARGETS)
</pre>
</td>
</tr>
</table>
<center><a href="ModuleWrapper.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="RunTestsPrebuilt.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>