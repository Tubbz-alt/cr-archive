<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/test/JtregGraalUnit.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="BuildMicrobenchmark.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="JtregNativeHotspot.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/test/JtregGraalUnit.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 48     LIB_OUTPUTDIR := $(TEST_IMAGE_DIR)/hotspot/jtreg/graal
 49 
 50     # This evaluation is expensive and should only be done if this target was
 51     # explicitly called.
 52     ifneq ($(filter build-test-hotspot-jtreg-graal, $(MAKECMDGOALS)), )
 53 
 54       TEST_COMPILE_CP := \
 55           $(JDK_OUTPUTDIR)/modules/jdk.internal.vm.compiler \
 56           $(JDK_OUTPUTDIR)/modules/jdk.internal.vm.ci \
 57           $(LIB_OUTPUTDIR)/junit-4.12.jar \
 58           $(LIB_OUTPUTDIR)/asm-5.0.4.jar \
 59           $(LIB_OUTPUTDIR)/asm-tree-5.0.4.jar \
 60           $(LIB_OUTPUTDIR)/java-allocation-instrumenter.jar \
 61           $(LIB_OUTPUTDIR)/hamcrest-core-1.3.jar
 62 
 63       TEST_JAVAC_FLAGS := \
 64           -Xlint:none \
 65           -processorpath $(BUILDTOOLS_OUTPUTDIR)/jdk.vm.compiler.replacements.verifier.jar \
 66           --add-exports jdk.unsupported/sun.misc=ALL-UNNAMED \
 67           --add-exports java.base/jdk.internal.misc=ALL-UNNAMED \

 68 
 69       ### Copy 3rd party libs
 70       $(eval $(call SetupCopyFiles, COPY_GRAALUNIT_LIBS, \
 71           FILES := $(wildcard $(GRAALUNIT_LIB)/*.jar), \
 72           DEST := $(LIB_OUTPUTDIR), \
 73       ))
 74 
 75       TARGETS_EXTRA_LIB += $(COPY_GRAALUNIT_LIBS)
 76 
 77       ### Compile graalunit tests
 78       $(eval $(call SetupJavaCompilation, BUILD_VM_COMPILER_TESTS, \
 79           SETUP := GENERATE_USINGJDKBYTECODE, \
 80           SRC := \
 81               $(SRC_DIR)/jdk.internal.vm.compiler.collections.test/src \
 82               $(SRC_DIR)/org.graalvm.compiler.api.directives.test/src \
 83               $(SRC_DIR)/org.graalvm.compiler.api.test/src \
 84               $(SRC_DIR)/org.graalvm.compiler.asm.aarch64.test/src \
 85               $(SRC_DIR)/org.graalvm.compiler.asm.amd64.test/src \
 86               $(SRC_DIR)/org.graalvm.compiler.asm.sparc.test/src \
 87               $(SRC_DIR)/org.graalvm.compiler.asm.test/src \
 88               $(SRC_DIR)/org.graalvm.compiler.core.aarch64.test/src \
 89               $(SRC_DIR)/org.graalvm.compiler.core.amd64.test/src \
 90               $(SRC_DIR)/org.graalvm.compiler.core.jdk9.test/src \
 91               $(SRC_DIR)/org.graalvm.compiler.core.test/src \
 92               $(SRC_DIR)/org.graalvm.compiler.debug.test/src \
 93               $(SRC_DIR)/org.graalvm.compiler.graph.test/src \

 94               $(SRC_DIR)/org.graalvm.compiler.hotspot.amd64.test/src \
 95               $(SRC_DIR)/org.graalvm.compiler.hotspot.jdk9.test/src \
 96               $(SRC_DIR)/org.graalvm.compiler.hotspot.lir.test/src \
 97               $(SRC_DIR)/org.graalvm.compiler.hotspot.sparc.test/src \
 98               $(SRC_DIR)/org.graalvm.compiler.hotspot.test/src \
 99               $(SRC_DIR)/org.graalvm.compiler.jtt/src \
100               $(SRC_DIR)/org.graalvm.compiler.lir.jtt/src \
101               $(SRC_DIR)/org.graalvm.compiler.lir.test/src \
102               $(SRC_DIR)/org.graalvm.compiler.loop.test/src \
103               $(SRC_DIR)/org.graalvm.compiler.nodes.test/src \
104               $(SRC_DIR)/org.graalvm.compiler.options.test/src \
105               $(SRC_DIR)/org.graalvm.compiler.phases.common.test/src \
106               $(SRC_DIR)/org.graalvm.compiler.replacements.jdk12.test/src \
107               $(SRC_DIR)/org.graalvm.compiler.replacements.jdk9.test/src \
108               $(SRC_DIR)/org.graalvm.compiler.replacements.test/src \
109               $(SRC_DIR)/org.graalvm.compiler.test/src \
110               $(SRC_DIR)/org.graalvm.util.test/src \
111               , \
112           EXCLUDE_FILES := org/graalvm/compiler/core/test/VerifyDebugUsageTest.java, \
113           BIN := $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests, \
114           CLASSPATH := $(TEST_COMPILE_CP), \
115           ADD_JAVAC_FLAGS := $(TEST_JAVAC_FLAGS), \

116       ))
117 
118       TARGETS_BUILD += $(BUILD_VM_COMPILER_TESTS)
119 
120       ### Compile graalunit tests which require -XDstringConcat=inline
121       $(eval $(call SetupJavaCompilation, BUILD_VM_COMPILER_TESTS_SET2, \
122           SETUP := GENERATE_USINGJDKBYTECODE, \
123           DEPENDS := $(BUILD_VM_COMPILER_TESTS), \
124           SRC := $(SRC_DIR)/org.graalvm.compiler.core.test/src, \
125           INCLUDE_FILES := org/graalvm/compiler/core/test/VerifyDebugUsageTest.java, \
126           BIN := $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests, \
127           CLASSPATH := \
128               $(TEST_COMPILE_CP) \
129               $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests \
130               , \
131           ADD_JAVAC_FLAGS := \
132               $(TEST_JAVAC_FLAGS) \
133               -XDstringConcat=inline \
134               , \
135       ))
136 
137       TARGETS_BUILD += $(BUILD_VM_COMPILER_TESTS_SET2)
138 
139       ### Generate jdk.vm.compiler.tests.jar
140       $(eval $(call SetupJarArchive, BUILD_VM_COMPILER_TESTS_JAR, \
141           DEPENDENCIES := $(BUILD_VM_COMPILER_TESTS) $(BUILD_VM_COMPILER_TESTS_SET2), \
142           SRCS := $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests, \

143           JAR := $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests.jar, \
144       ))
145 
146       TARGETS_BUILD += $(BUILD_VM_COMPILER_TESTS_JAR)
147 
148       ### Compile and build mxtool
149       $(eval $(call SetupJavaCompilation, BUILD_MXTOOL, \
150           SETUP := GENERATE_USINGJDKBYTECODE, \
151           SRC := $(TEST_DIR)/com.oracle.mxtool.junit, \
152           BIN := $(COMPILE_OUTPUTDIR)/com.oracle.mxtool.junit, \
153           JAR := $(COMPILE_OUTPUTDIR)/com.oracle.mxtool.junit.jar, \
154           CLASSPATH := $(LIB_OUTPUTDIR)/junit-4.12.jar, \
155       ))
156 
157       TARGETS_BUILD += $(BUILD_MXTOOL)
158 
159       $(TARGETS_BUILD): $(TARGETS_EXTRA_LIB)
160 
161     endif # build-test-hotspot-jtreg-graal
162 
163     ################################################################################
164     # Targets for building test-image.
165     ################################################################################
166 
167     # Copy to hotspot jtreg test image
168     $(eval $(call SetupCopyFiles, COPY_HOTSPOT_JTREG_GRAAL, \
169         SRC := $(COMPILE_OUTPUTDIR), \
170         DEST := $(LIB_OUTPUTDIR), \
171         FILES := jdk.vm.compiler.tests.jar com.oracle.mxtool.junit.jar, \
172     ))
173 
174     TARGETS_IMAGE += $(COPY_HOTSPOT_JTREG_GRAAL)
<span class="line-removed">175   else</span>
<span class="line-removed">176     $(info Skip building of Graal unit tests because 3rd party libraries directory is not specified)</span>
177   endif
178 endif
179 
180 build-test-hotspot-jtreg-graal: $(TARGETS_BUILD)
181 test-image-hotspot-jtreg-graal: $(TARGETS_IMAGE)
182 
183 all: build-test-hotspot-jtreg-graal
184 test-image: test-image-hotspot-jtreg-graal
185 
186 .PHONY: default all build-test-hotspot-jtreg-graal test-image-hotspot-jtreg-graal test-image
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2018, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 48     LIB_OUTPUTDIR := $(TEST_IMAGE_DIR)/hotspot/jtreg/graal
 49 
 50     # This evaluation is expensive and should only be done if this target was
 51     # explicitly called.
 52     ifneq ($(filter build-test-hotspot-jtreg-graal, $(MAKECMDGOALS)), )
 53 
 54       TEST_COMPILE_CP := \
 55           $(JDK_OUTPUTDIR)/modules/jdk.internal.vm.compiler \
 56           $(JDK_OUTPUTDIR)/modules/jdk.internal.vm.ci \
 57           $(LIB_OUTPUTDIR)/junit-4.12.jar \
 58           $(LIB_OUTPUTDIR)/asm-5.0.4.jar \
 59           $(LIB_OUTPUTDIR)/asm-tree-5.0.4.jar \
 60           $(LIB_OUTPUTDIR)/java-allocation-instrumenter.jar \
 61           $(LIB_OUTPUTDIR)/hamcrest-core-1.3.jar
 62 
 63       TEST_JAVAC_FLAGS := \
 64           -Xlint:none \
 65           -processorpath $(BUILDTOOLS_OUTPUTDIR)/jdk.vm.compiler.replacements.verifier.jar \
 66           --add-exports jdk.unsupported/sun.misc=ALL-UNNAMED \
 67           --add-exports java.base/jdk.internal.misc=ALL-UNNAMED \
<span class="line-added"> 68           --add-exports java.base/jdk.internal.module=ALL-UNNAMED \</span>
 69 
 70       ### Copy 3rd party libs
 71       $(eval $(call SetupCopyFiles, COPY_GRAALUNIT_LIBS, \
 72           FILES := $(wildcard $(GRAALUNIT_LIB)/*.jar), \
 73           DEST := $(LIB_OUTPUTDIR), \
 74       ))
 75 
 76       TARGETS_EXTRA_LIB += $(COPY_GRAALUNIT_LIBS)
 77 
 78       ### Compile graalunit tests
 79       $(eval $(call SetupJavaCompilation, BUILD_VM_COMPILER_TESTS, \
 80           SETUP := GENERATE_USINGJDKBYTECODE, \
 81           SRC := \
 82               $(SRC_DIR)/jdk.internal.vm.compiler.collections.test/src \
 83               $(SRC_DIR)/org.graalvm.compiler.api.directives.test/src \
 84               $(SRC_DIR)/org.graalvm.compiler.api.test/src \
 85               $(SRC_DIR)/org.graalvm.compiler.asm.aarch64.test/src \
 86               $(SRC_DIR)/org.graalvm.compiler.asm.amd64.test/src \
 87               $(SRC_DIR)/org.graalvm.compiler.asm.sparc.test/src \
 88               $(SRC_DIR)/org.graalvm.compiler.asm.test/src \
 89               $(SRC_DIR)/org.graalvm.compiler.core.aarch64.test/src \
 90               $(SRC_DIR)/org.graalvm.compiler.core.amd64.test/src \
 91               $(SRC_DIR)/org.graalvm.compiler.core.jdk9.test/src \
 92               $(SRC_DIR)/org.graalvm.compiler.core.test/src \
 93               $(SRC_DIR)/org.graalvm.compiler.debug.test/src \
 94               $(SRC_DIR)/org.graalvm.compiler.graph.test/src \
<span class="line-added"> 95               $(SRC_DIR)/org.graalvm.compiler.hotspot.aarch64.test/src \</span>
 96               $(SRC_DIR)/org.graalvm.compiler.hotspot.amd64.test/src \
 97               $(SRC_DIR)/org.graalvm.compiler.hotspot.jdk9.test/src \
 98               $(SRC_DIR)/org.graalvm.compiler.hotspot.lir.test/src \
 99               $(SRC_DIR)/org.graalvm.compiler.hotspot.sparc.test/src \
100               $(SRC_DIR)/org.graalvm.compiler.hotspot.test/src \
101               $(SRC_DIR)/org.graalvm.compiler.jtt/src \
102               $(SRC_DIR)/org.graalvm.compiler.lir.jtt/src \
103               $(SRC_DIR)/org.graalvm.compiler.lir.test/src \
104               $(SRC_DIR)/org.graalvm.compiler.loop.test/src \
105               $(SRC_DIR)/org.graalvm.compiler.nodes.test/src \
106               $(SRC_DIR)/org.graalvm.compiler.options.test/src \
107               $(SRC_DIR)/org.graalvm.compiler.phases.common.test/src \
108               $(SRC_DIR)/org.graalvm.compiler.replacements.jdk12.test/src \
109               $(SRC_DIR)/org.graalvm.compiler.replacements.jdk9.test/src \
110               $(SRC_DIR)/org.graalvm.compiler.replacements.test/src \
111               $(SRC_DIR)/org.graalvm.compiler.test/src \
112               $(SRC_DIR)/org.graalvm.util.test/src \
113               , \
114           EXCLUDE_FILES := org/graalvm/compiler/core/test/VerifyDebugUsageTest.java, \
115           BIN := $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests, \
116           CLASSPATH := $(TEST_COMPILE_CP), \
117           ADD_JAVAC_FLAGS := $(TEST_JAVAC_FLAGS), \
<span class="line-added">118           COPY := .input, \</span>
119       ))
120 
121       TARGETS_BUILD += $(BUILD_VM_COMPILER_TESTS)
122 
123       ### Compile graalunit tests which require -XDstringConcat=inline
124       $(eval $(call SetupJavaCompilation, BUILD_VM_COMPILER_TESTS_SET2, \
125           SETUP := GENERATE_USINGJDKBYTECODE, \
126           DEPENDS := $(BUILD_VM_COMPILER_TESTS), \
127           SRC := $(SRC_DIR)/org.graalvm.compiler.core.test/src, \
128           INCLUDE_FILES := org/graalvm/compiler/core/test/VerifyDebugUsageTest.java, \
129           BIN := $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests, \
130           CLASSPATH := \
131               $(TEST_COMPILE_CP) \
132               $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests \
133               , \
134           ADD_JAVAC_FLAGS := \
135               $(TEST_JAVAC_FLAGS) \
136               -XDstringConcat=inline \
137               , \
138       ))
139 
140       TARGETS_BUILD += $(BUILD_VM_COMPILER_TESTS_SET2)
141 
142       ### Generate jdk.vm.compiler.tests.jar
143       $(eval $(call SetupJarArchive, BUILD_VM_COMPILER_TESTS_JAR, \
144           DEPENDENCIES := $(BUILD_VM_COMPILER_TESTS) $(BUILD_VM_COMPILER_TESTS_SET2), \
145           SRCS := $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests, \
<span class="line-added">146           SUFFIXES:=.class .input, \</span>
147           JAR := $(COMPILE_OUTPUTDIR)/jdk.vm.compiler.tests.jar, \
148       ))
149 
150       TARGETS_BUILD += $(BUILD_VM_COMPILER_TESTS_JAR)
151 
152       ### Compile and build mxtool
153       $(eval $(call SetupJavaCompilation, BUILD_MXTOOL, \
154           SETUP := GENERATE_USINGJDKBYTECODE, \
155           SRC := $(TEST_DIR)/com.oracle.mxtool.junit, \
156           BIN := $(COMPILE_OUTPUTDIR)/com.oracle.mxtool.junit, \
157           JAR := $(COMPILE_OUTPUTDIR)/com.oracle.mxtool.junit.jar, \
158           CLASSPATH := $(LIB_OUTPUTDIR)/junit-4.12.jar, \
159       ))
160 
161       TARGETS_BUILD += $(BUILD_MXTOOL)
162 
163       $(TARGETS_BUILD): $(TARGETS_EXTRA_LIB)
164 
165     endif # build-test-hotspot-jtreg-graal
166 
167     ################################################################################
168     # Targets for building test-image.
169     ################################################################################
170 
171     # Copy to hotspot jtreg test image
172     $(eval $(call SetupCopyFiles, COPY_HOTSPOT_JTREG_GRAAL, \
173         SRC := $(COMPILE_OUTPUTDIR), \
174         DEST := $(LIB_OUTPUTDIR), \
175         FILES := jdk.vm.compiler.tests.jar com.oracle.mxtool.junit.jar, \
176     ))
177 
178     TARGETS_IMAGE += $(COPY_HOTSPOT_JTREG_GRAAL)


179   endif
180 endif
181 
182 build-test-hotspot-jtreg-graal: $(TARGETS_BUILD)
183 test-image-hotspot-jtreg-graal: $(TARGETS_IMAGE)
184 
185 all: build-test-hotspot-jtreg-graal
186 test-image: test-image-hotspot-jtreg-graal
187 
188 .PHONY: default all build-test-hotspot-jtreg-graal test-image-hotspot-jtreg-graal test-image
</pre>
</td>
</tr>
</table>
<center><a href="BuildMicrobenchmark.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="JtregNativeHotspot.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>