<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/src/classes/build/tools/jfr/GenerateJfrFiles.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../scripts/genExceptions.sh.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../test/BuildFailureHandler.gmk.udiff.html" target="_top">next &gt;</a></center>    <h2>make/src/classes/build/tools/jfr/GenerateJfrFiles.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -152,10 +152,11 @@</span>
          boolean thread;
          boolean stackTrace;
          boolean startTime;
          boolean periodic;
          boolean cutoff;
<span class="udiff-line-added">+         String commitState;</span>
      }
  
      static class FieldElement {
          final Metadata metadata;
          TypeElement type;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -217,18 +218,19 @@</span>
              case &quot;Type&quot;:
                  currentType = new TypeElement();
                  currentType.name = attributes.getValue(&quot;name&quot;);
                  break;
              case &quot;Event&quot;:
<span class="udiff-line-modified-removed">-                 EventElement eventtType = new EventElement();</span>
<span class="udiff-line-modified-removed">-                 eventtType.name = attributes.getValue(&quot;name&quot;);</span>
<span class="udiff-line-modified-removed">-                 eventtType.thread = getBoolean(attributes, &quot;thread&quot;, false);</span>
<span class="udiff-line-modified-removed">-                 eventtType.stackTrace = getBoolean(attributes, &quot;stackTrace&quot;, false);</span>
<span class="udiff-line-modified-removed">-                 eventtType.startTime = getBoolean(attributes, &quot;startTime&quot;, true);</span>
<span class="udiff-line-modified-removed">-                 eventtType.periodic = attributes.getValue(&quot;period&quot;) != null;</span>
<span class="udiff-line-modified-removed">-                 eventtType.cutoff = getBoolean(attributes, &quot;cutoff&quot;, false);</span>
<span class="udiff-line-modified-removed">-                 currentType = eventtType;</span>
<span class="udiff-line-modified-added">+                 EventElement eventType = new EventElement();</span>
<span class="udiff-line-modified-added">+                 eventType.name = attributes.getValue(&quot;name&quot;);</span>
<span class="udiff-line-modified-added">+                 eventType.thread = getBoolean(attributes, &quot;thread&quot;, false);</span>
<span class="udiff-line-modified-added">+                 eventType.stackTrace = getBoolean(attributes, &quot;stackTrace&quot;, false);</span>
<span class="udiff-line-modified-added">+                 eventType.startTime = getBoolean(attributes, &quot;startTime&quot;, true);</span>
<span class="udiff-line-modified-added">+                 eventType.periodic = attributes.getValue(&quot;period&quot;) != null;</span>
<span class="udiff-line-modified-added">+                 eventType.cutoff = getBoolean(attributes, &quot;cutoff&quot;, false);</span>
<span class="udiff-line-modified-added">+                 eventType.commitState = attributes.getValue(&quot;commitState&quot;);</span>
<span class="udiff-line-added">+                 currentType = eventType;</span>
                  break;
              case &quot;Field&quot;:
                  currentField = new FieldElement(metadata);
                  currentField.struct = getBoolean(attributes, &quot;struct&quot;, false);
                  currentField.name = attributes.getValue(&quot;name&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -457,10 +459,11 @@</span>
              out.write(&quot;#include \&quot;jfr/utilities/jfrTypes.hpp\&quot;&quot;);
              out.write(&quot;#include \&quot;utilities/macros.hpp\&quot;&quot;);
              out.write(&quot;#include \&quot;utilities/ticks.hpp\&quot;&quot;);
              out.write(&quot;#if INCLUDE_JFR&quot;);
              out.write(&quot;#include \&quot;jfr/recorder/service/jfrEvent.hpp\&quot;&quot;);
<span class="udiff-line-added">+             out.write(&quot;#include \&quot;jfr/support/jfrEpochSynchronization.hpp\&quot;&quot;);</span>
              out.write(&quot;/*&quot;);
              out.write(&quot; * Each event class has an assert member function verify() which is invoked&quot;);
              out.write(&quot; * just before the engine writes the event and its fields to the data stream.&quot;);
              out.write(&quot; * The purpose of verify() is to ensure that all fields in the event are initialized&quot;);
              out.write(&quot; * and set before attempting to commit.&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -521,11 +524,11 @@</span>
          for (FieldElement f : t.fields) {
             printTypeSetter(out, f, empty);
          }
          out.write(&quot;&quot;);
          if (!empty) {
<span class="udiff-line-modified-removed">-           printWriteData(out, t.fields);</span>
<span class="udiff-line-modified-added">+           printWriteData(out, t.fields, null);</span>
          }
          out.write(&quot;};&quot;);
          out.write(&quot;&quot;);
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -564,11 +567,11 @@</span>
              }
              out.write(&quot;  }&quot;);
          }
          out.write(&quot;&quot;);
          if (!empty) {
<span class="udiff-line-modified-removed">-           printWriteData(out, event.fields);</span>
<span class="udiff-line-modified-added">+           printWriteData(out, event.fields, event.commitState);</span>
            out.write(&quot;&quot;);
          }
          out.write(&quot;  using JfrEvent&lt;Event&quot; + event.name + &quot;&gt;::commit; // else commit() is hidden by overloaded versions in this class&quot;);
          printConstructor2(out, event, empty);
          printCommitMethod(out, event, empty);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -576,13 +579,17 @@</span>
            printVerify(out, event.fields);
          }
          out.write(&quot;};&quot;);
      }
  
<span class="udiff-line-modified-removed">-     private static void printWriteData(Printer out, List&lt;FieldElement&gt; fields) {</span>
<span class="udiff-line-modified-added">+     private static void printWriteData(Printer out, List&lt;FieldElement&gt; fields, String commitState) {</span>
          out.write(&quot;  template &lt;typename Writer&gt;&quot;);
          out.write(&quot;  void writeData(Writer&amp; w) {&quot;);
<span class="udiff-line-added">+         if ((&quot;_thread_in_native&quot;).equals(commitState)) {</span>
<span class="udiff-line-added">+             out.write(&quot;    // explicit epoch synchronization check&quot;);</span>
<span class="udiff-line-added">+             out.write(&quot;    JfrEpochSynchronization sync;&quot;);</span>
<span class="udiff-line-added">+         }</span>
          for (FieldElement field : fields) {
              if (field.struct) {
                  out.write(&quot;    _&quot; + field.name + &quot;.writeData(w);&quot;);
              } else {
                  out.write(&quot;    w.write(_&quot; + field.name + &quot;);&quot;);
</pre>
<center><a href="../../../../../scripts/genExceptions.sh.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../test/BuildFailureHandler.gmk.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>