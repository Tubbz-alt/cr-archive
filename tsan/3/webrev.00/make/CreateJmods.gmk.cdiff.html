<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/CreateJmods.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Coverage.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="Docs.gmk.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/CreateJmods.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 51,53 ***</span>
  INCLUDE_HEADERS_DIR ?= $(firstword $(wildcard $(addsuffix /$(MODULE), \
      $(SUPPORT_OUTPUTDIR)/modules_include $(IMPORT_MODULES_INCLUDE_HEADERS))))
  MAN_DIR ?= $(firstword $(wildcard $(addsuffix /$(MODULE), \
      $(SUPPORT_OUTPUTDIR)/modules_man $(IMPORT_MODULES_MAN))))
  
<span class="line-modified">! $(eval $(call FillCacheFind, \</span>
      $(LIBS_DIR) $(CMDS_DIR) $(CONF_DIR) $(CLASSES_DIR) \
<span class="line-modified">! ))</span>
  
  ifneq ($(LIBS_DIR), )
    JMOD_FLAGS += --libs $(LIBS_DIR)
<span class="line-modified">!   DEPS += $(call CacheFind, $(LIBS_DIR))</span>
  endif
  ifneq ($(CMDS_DIR), )
    JMOD_FLAGS += --cmds $(CMDS_DIR)
<span class="line-modified">!   DEPS += $(call CacheFind, $(CMDS_DIR))</span>
  endif
  ifneq ($(CONF_DIR), )
    JMOD_FLAGS += --config $(CONF_DIR)
<span class="line-modified">!   DEPS += $(call CacheFind, $(CONF_DIR))</span>
  endif
  ifneq ($(CLASSES_DIR), )
    JMOD_FLAGS += --class-path $(CLASSES_DIR)
<span class="line-modified">!   DEPS += $(call CacheFind, $(CLASSES_DIR))</span>
  endif
  ifneq ($(INCLUDE_HEADERS_DIR), )
    JMOD_FLAGS += --header-files $(INCLUDE_HEADERS_DIR)
<span class="line-modified">!   DEPS += $(call CacheFind, $(INCLUDE_HEADERS_DIR))</span>
  endif
  ifneq ($(MAN_DIR), )
    JMOD_FLAGS += --man-pages $(MAN_DIR)
<span class="line-modified">!   DEPS += $(call CacheFind, $(MAN_DIR))</span>
  endif
  
  # If a specific modules_legal dir exists for this module, only pick up files
  # from there. These files were explicitly filtered or modified in &lt;module&gt;-copy
  # targets. For the rest, just pick up everything from the source legal dirs.
  LEGAL_NOTICES := \
<span class="line-modified">!     $(SUPPORT_OUTPUTDIR)/modules_legal/common \</span>
      $(if $(wildcard $(SUPPORT_OUTPUTDIR)/modules_legal/$(MODULE)), \
        $(wildcard $(SUPPORT_OUTPUTDIR)/modules_legal/$(MODULE)), \
        $(call FindModuleLegalSrcDirs, $(MODULE)) \
      )
  
<span class="line-modified">! LEGAL_NOTICES_PATH := $(call PathList, $(LEGAL_NOTICES))</span>
<span class="line-modified">! DEPS += $(call CacheFind, $(LEGAL_NOTICES))</span>
  
<span class="line-modified">! JMOD_FLAGS += --legal-notices $(LEGAL_NOTICES_PATH)</span>
  
  ifeq ($(filter-out jdk.incubator.%, $(MODULE)), )
    JMOD_FLAGS += --do-not-resolve-by-default
    JMOD_FLAGS += --warn-if-resolved=incubating
  endif
<span class="line-new-header">--- 51,55 ---</span>
  INCLUDE_HEADERS_DIR ?= $(firstword $(wildcard $(addsuffix /$(MODULE), \
      $(SUPPORT_OUTPUTDIR)/modules_include $(IMPORT_MODULES_INCLUDE_HEADERS))))
  MAN_DIR ?= $(firstword $(wildcard $(addsuffix /$(MODULE), \
      $(SUPPORT_OUTPUTDIR)/modules_man $(IMPORT_MODULES_MAN))))
  
<span class="line-modified">! $(call FillFindCache, \</span>
      $(LIBS_DIR) $(CMDS_DIR) $(CONF_DIR) $(CLASSES_DIR) \
<span class="line-modified">! )</span>
  
  ifneq ($(LIBS_DIR), )
    JMOD_FLAGS += --libs $(LIBS_DIR)
<span class="line-modified">!   DEPS += $(call FindFiles, $(LIBS_DIR))</span>
  endif
  ifneq ($(CMDS_DIR), )
    JMOD_FLAGS += --cmds $(CMDS_DIR)
<span class="line-modified">!   DEPS += $(call FindFiles, $(CMDS_DIR))</span>
  endif
  ifneq ($(CONF_DIR), )
    JMOD_FLAGS += --config $(CONF_DIR)
<span class="line-modified">!   DEPS += $(call FindFiles, $(CONF_DIR))</span>
  endif
  ifneq ($(CLASSES_DIR), )
    JMOD_FLAGS += --class-path $(CLASSES_DIR)
<span class="line-modified">!   DEPS += $(call FindFiles, $(CLASSES_DIR))</span>
  endif
  ifneq ($(INCLUDE_HEADERS_DIR), )
    JMOD_FLAGS += --header-files $(INCLUDE_HEADERS_DIR)
<span class="line-modified">!   DEPS += $(call FindFiles, $(INCLUDE_HEADERS_DIR))</span>
  endif
  ifneq ($(MAN_DIR), )
    JMOD_FLAGS += --man-pages $(MAN_DIR)
<span class="line-modified">!   DEPS += $(call FindFiles, $(MAN_DIR))</span>
  endif
  
  # If a specific modules_legal dir exists for this module, only pick up files
  # from there. These files were explicitly filtered or modified in &lt;module&gt;-copy
  # targets. For the rest, just pick up everything from the source legal dirs.
  LEGAL_NOTICES := \
<span class="line-modified">!     $(wildcard $(SUPPORT_OUTPUTDIR)/modules_legal/common) \</span>
      $(if $(wildcard $(SUPPORT_OUTPUTDIR)/modules_legal/$(MODULE)), \
        $(wildcard $(SUPPORT_OUTPUTDIR)/modules_legal/$(MODULE)), \
        $(call FindModuleLegalSrcDirs, $(MODULE)) \
      )
  
<span class="line-modified">! ifneq ($(strip $(LEGAL_NOTICES)), )</span>
<span class="line-modified">!   LEGAL_NOTICES_PATH := $(call PathList, $(LEGAL_NOTICES))</span>
<span class="line-added">+   DEPS += $(call FindFiles, $(LEGAL_NOTICES))</span>
  
<span class="line-modified">!   JMOD_FLAGS += --legal-notices $(LEGAL_NOTICES_PATH)</span>
<span class="line-added">+ endif</span>
  
  ifeq ($(filter-out jdk.incubator.%, $(MODULE)), )
    JMOD_FLAGS += --do-not-resolve-by-default
    JMOD_FLAGS += --warn-if-resolved=incubating
  endif
</pre>
<hr />
<pre>
<span class="line-old-header">*** 145,11 ***</span>
  # Changes to the jmod tool itself should also trigger a rebuild of all jmods.
  # The variable JMOD_CMD could contain an environment variable assignment before
  # the actual command. Filter that out using wildcard before adding to DEPS.
  DEPS += $(wildcard $(JMOD_CMD))
  ifeq ($(EXTERNAL_BUILDJDK), false)
<span class="line-modified">!   DEPS += $(call CacheFind, $(JDK_OUTPUTDIR)/modules/jdk.jlink/jdk/tools/jmod)</span>
  endif
  
  # If creating interim versions of jmods, certain files need to be filtered out
  # to avoid false incremental rebuilds.
  ifeq ($(INTERIM_JMOD), true)
<span class="line-new-header">--- 147,11 ---</span>
  # Changes to the jmod tool itself should also trigger a rebuild of all jmods.
  # The variable JMOD_CMD could contain an environment variable assignment before
  # the actual command. Filter that out using wildcard before adding to DEPS.
  DEPS += $(wildcard $(JMOD_CMD))
  ifeq ($(EXTERNAL_BUILDJDK), false)
<span class="line-modified">!   DEPS += $(call FindFiles, $(JDK_OUTPUTDIR)/modules/jdk.jlink/jdk/tools/jmod)</span>
  endif
  
  # If creating interim versions of jmods, certain files need to be filtered out
  # to avoid false incremental rebuilds.
  ifeq ($(INTERIM_JMOD), true)
</pre>
<center><a href="Coverage.gmk.cdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="Docs.gmk.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>