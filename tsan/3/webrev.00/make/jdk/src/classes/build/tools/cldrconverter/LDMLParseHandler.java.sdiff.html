<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/jdk/src/classes/build/tools/cldrconverter/LDMLParseHandler.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="CLDRConverter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ResourceBundleGenerator.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/jdk/src/classes/build/tools/cldrconverter/LDMLParseHandler.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package build.tools.cldrconverter;
  27 
  28 import java.io.File;
  29 import java.io.IOException;
  30 import java.text.DateFormatSymbols;
  31 import java.util.ArrayList;

  32 import java.util.HashMap;
  33 import java.util.HashSet;
  34 import java.util.List;
  35 import java.util.Locale;
  36 import java.util.Map;
  37 import java.util.Set;
  38 import org.xml.sax.Attributes;
  39 import org.xml.sax.InputSource;
  40 import org.xml.sax.SAXException;
  41 
  42 /**
  43  * Handles parsing of files in Locale Data Markup Language and produces a map
  44  * that uses the keys and values of JRE locale data.
  45  */
  46 class LDMLParseHandler extends AbstractLDMLHandler&lt;Object&gt; {
  47     private String defaultNumberingSystem;
  48     private String currentNumberingSystem = &quot;&quot;;
  49     private CalendarType currentCalendarType;
  50     private String zoneNameStyle; // &quot;long&quot; or &quot;short&quot; for time zone names
  51     private String zonePrefix;
  52     private final String id;
  53     private String currentContext = &quot;&quot;; // &quot;format&quot;/&quot;stand-alone&quot;
  54     private String currentWidth = &quot;&quot;; // &quot;wide&quot;/&quot;narrow&quot;/&quot;abbreviated&quot;
  55     private String currentStyle = &quot;&quot;; // short, long for decimalFormat
<span class="line-removed">  56     private String compactCount = &quot;&quot;; // one or other for decimalFormat</span>
  57 
  58     LDMLParseHandler(String id) {
  59         this.id = id;
  60     }
  61 
  62     @Override
  63     public InputSource resolveEntity(String publicID, String systemID) throws IOException, SAXException {
  64         // avoid HTTP traffic to unicode.org
  65         if (systemID.startsWith(CLDRConverter.LDML_DTD_SYSTEM_ID)) {
  66             return new InputSource((new File(CLDRConverter.LOCAL_LDML_DTD)).toURI().toString());
  67         }
  68         return null;
  69     }
  70 
  71     @Override
  72     public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
  73         switch (qName) {
  74         //
  75         // Generic information
  76         //
</pre>
<hr />
<pre>
 491         case &quot;short&quot;:
 492             zoneNameStyle = &quot;short&quot;;
 493             pushContainer(qName, attributes);
 494             break;
 495         case &quot;generic&quot;:  // generic name
 496         case &quot;standard&quot;: // standard time name
 497         case &quot;daylight&quot;: // daylight saving (summer) time name
 498             pushStringEntry(qName, attributes, CLDRConverter.ZONE_NAME_PREFIX + qName + &quot;.&quot; + zoneNameStyle);
 499             break;
 500         case &quot;exemplarCity&quot;:
 501             pushStringEntry(qName, attributes, CLDRConverter.EXEMPLAR_CITY_PREFIX);
 502             break;
 503 
 504         //
 505         // Number format information
 506         //
 507         case &quot;decimalFormatLength&quot;:
 508             String type = attributes.getValue(&quot;type&quot;);
 509             if (null == type) {
 510                 // format data for decimal number format
<span class="line-modified"> 511                 pushStringEntry(qName, attributes, &quot;NumberPatterns/decimal&quot;);</span>

 512                 currentStyle = type;
 513             } else {
 514                 switch (type) {
 515                     case &quot;short&quot;:
 516                     case &quot;long&quot;:
 517                         // considering &quot;short&quot; and long for
 518                         // compact number formatting patterns
 519                         pushKeyContainer(qName, attributes, type);
 520                         currentStyle = type;
 521                         break;
 522                     default:
 523                         pushIgnoredContainer(qName);
 524                         break;
 525                 }
 526             }
 527             break;
 528         case &quot;decimalFormat&quot;:
 529             if(currentStyle == null) {
 530                 pushContainer(qName, attributes);
 531             } else {
 532                 switch (currentStyle) {
 533                     case &quot;short&quot;:
<span class="line-removed"> 534                         pushStringListEntry(qName, attributes,</span>
<span class="line-removed"> 535                                 currentStyle+&quot;.CompactNumberPatterns&quot;);</span>
<span class="line-removed"> 536                         break;</span>
 537                     case &quot;long&quot;:
 538                         pushStringListEntry(qName, attributes,
 539                                 currentStyle+&quot;.CompactNumberPatterns&quot;);
 540                         break;
 541                     default:
 542                         pushIgnoredContainer(qName);
 543                         break;
 544                 }
 545             }
 546             break;





 547         case &quot;pattern&quot;:
 548             String containerName = currentContainer.getqName();
<span class="line-modified"> 549             if (containerName.equals(&quot;decimalFormat&quot;)) {</span>
<span class="line-modified"> 550                 if (currentStyle == null) {</span>
<span class="line-modified"> 551                     pushContainer(qName, attributes);</span>
<span class="line-modified"> 552                 } else {</span>
<span class="line-modified"> 553                     // The compact number patterns parsing assumes that the order</span>
<span class="line-modified"> 554                     // of patterns are always in the increasing order of their</span>
<span class="line-modified"> 555                     // type attribute i.e. type = 1000...</span>
<span class="line-modified"> 556                     // Between the inflectional forms for a type (e.g.</span>
<span class="line-modified"> 557                     // count = &quot;one&quot; and count = &quot;other&quot; for type = 1000), it is</span>
<span class="line-modified"> 558                     // assumed that the count = &quot;one&quot; always appears before</span>
<span class="line-modified"> 559                     // count = &quot;other&quot;</span>
<span class="line-modified"> 560                     switch (currentStyle) {</span>
<span class="line-modified"> 561                         case &quot;short&quot;:</span>
<span class="line-modified"> 562                         case &quot;long&quot;:</span>
<span class="line-modified"> 563                             String count = attributes.getValue(&quot;count&quot;);</span>
<span class="line-modified"> 564                             // first pattern of count = &quot;one&quot; or count = &quot;other&quot;</span>
<span class="line-modified"> 565                             if ((count.equals(&quot;one&quot;) || count.equals(&quot;other&quot;))</span>
<span class="line-modified"> 566                                     &amp;&amp; compactCount.equals(&quot;&quot;)) {</span>
<span class="line-modified"> 567                                 compactCount = count;</span>
<span class="line-modified"> 568                                 pushStringListElement(qName, attributes,</span>
<span class="line-modified"> 569                                         (int) Math.log10(Double.parseDouble(attributes.getValue(&quot;type&quot;))));</span>
<span class="line-modified"> 570                             } else if ((count.equals(&quot;one&quot;) || count.equals(&quot;other&quot;))</span>
<span class="line-modified"> 571                                     &amp;&amp; compactCount.equals(count)) {</span>
<span class="line-modified"> 572                                 // extract patterns with similar &quot;count&quot;</span>
<span class="line-modified"> 573                                 // attribute value</span>





 574                                 pushStringListElement(qName, attributes,
<span class="line-modified"> 575                                         (int) Math.log10(Double.parseDouble(attributes.getValue(&quot;type&quot;))));</span>
<span class="line-modified"> 576                             } else {</span>


 577                                 pushIgnoredContainer(qName);
<span class="line-modified"> 578                             }</span>
<span class="line-modified"> 579                             break;</span>
<span class="line-removed"> 580                         default:</span>
<span class="line-removed"> 581                             pushIgnoredContainer(qName);</span>
<span class="line-removed"> 582                             break;</span>
 583                     }














 584                 }
<span class="line-removed"> 585             } else {</span>
 586                 pushContainer(qName, attributes);
 587             }
 588             break;
 589         case &quot;currencyFormatLength&quot;:
 590             if (attributes.getValue(&quot;type&quot;) == null) {
 591                 // skipping type=&quot;short&quot; data
 592                 // for FormatData
 593                 pushContainer(qName, attributes);
 594             } else {
 595                 pushIgnoredContainer(qName);
 596             }
 597             break;
<span class="line-removed"> 598         case &quot;currencyFormat&quot;:</span>
<span class="line-removed"> 599             // for FormatData</span>
<span class="line-removed"> 600             // copy string for later assembly into NumberPatterns</span>
<span class="line-removed"> 601             if (attributes.getValue(&quot;type&quot;).equals(&quot;standard&quot;)) {</span>
<span class="line-removed"> 602             pushStringEntry(qName, attributes, &quot;NumberPatterns/currency&quot;);</span>
<span class="line-removed"> 603             } else {</span>
<span class="line-removed"> 604                 pushIgnoredContainer(qName);</span>
<span class="line-removed"> 605             }</span>
<span class="line-removed"> 606             break;</span>
<span class="line-removed"> 607         case &quot;percentFormat&quot;:</span>
<span class="line-removed"> 608             // for FormatData</span>
<span class="line-removed"> 609             // copy string for later assembly into NumberPatterns</span>
<span class="line-removed"> 610             if (attributes.getValue(&quot;type&quot;).equals(&quot;standard&quot;)) {</span>
<span class="line-removed"> 611             pushStringEntry(qName, attributes, &quot;NumberPatterns/percent&quot;);</span>
<span class="line-removed"> 612             } else {</span>
<span class="line-removed"> 613                 pushIgnoredContainer(qName);</span>
<span class="line-removed"> 614             }</span>
<span class="line-removed"> 615             break;</span>
 616         case &quot;defaultNumberingSystem&quot;:
 617             // default numbering system if multiple numbering systems are used.
 618             pushStringEntry(qName, attributes, &quot;DefaultNumberingSystem&quot;);
 619             break;
 620         case &quot;symbols&quot;:
 621             // for FormatData
 622             // look up numberingSystems
 623             symbols: {
 624                 String script = attributes.getValue(&quot;numberSystem&quot;);
 625                 if (script == null) {
 626                     // Has no script. Just ignore.
 627                     pushIgnoredContainer(qName);
 628                     break;
 629                 }
 630 
 631                 // Use keys as &lt;script&gt;.&quot;NumberElements/&lt;symbol&gt;&quot;
 632                 currentNumberingSystem = script + &quot;.&quot;;
 633                 String digits = CLDRConverter.handlerNumbering.get(script);
 634                 if (digits == null) {
 635                     pushIgnoredContainer(qName);
 636                     break;
 637                 }
 638 
<span class="line-modified"> 639                 @SuppressWarnings(&quot;unchecked&quot;)</span>
<span class="line-removed"> 640                 List&lt;String&gt; numberingScripts = (List&lt;String&gt;) get(&quot;numberingScripts&quot;);</span>
<span class="line-removed"> 641                 if (numberingScripts == null) {</span>
<span class="line-removed"> 642                     numberingScripts = new ArrayList&lt;&gt;();</span>
<span class="line-removed"> 643                     put(&quot;numberingScripts&quot;, numberingScripts);</span>
<span class="line-removed"> 644                 }</span>
<span class="line-removed"> 645                 numberingScripts.add(script);</span>
 646                 put(currentNumberingSystem + &quot;NumberElements/zero&quot;, digits.substring(0, 1));
 647                 pushContainer(qName, attributes);
 648             }
 649             break;
 650         case &quot;decimal&quot;:
<span class="line-removed"> 651             // for FormatData</span>
<span class="line-removed"> 652             // copy string for later assembly into NumberElements</span>
<span class="line-removed"> 653             if (currentContainer.getqName().equals(&quot;symbols&quot;)) {</span>
<span class="line-removed"> 654                 pushStringEntry(qName, attributes, currentNumberingSystem + &quot;NumberElements/decimal&quot;);</span>
<span class="line-removed"> 655             } else {</span>
<span class="line-removed"> 656                 pushIgnoredContainer(qName);</span>
<span class="line-removed"> 657             }</span>
<span class="line-removed"> 658             break;</span>
 659         case &quot;group&quot;:


 660             // for FormatData
 661             // copy string for later assembly into NumberElements
 662             if (currentContainer.getqName().equals(&quot;symbols&quot;)) {
<span class="line-modified"> 663                 pushStringEntry(qName, attributes, currentNumberingSystem + &quot;NumberElements/group&quot;);</span>
 664             } else {
 665                 pushIgnoredContainer(qName);
 666             }
 667             break;
 668         case &quot;list&quot;:
 669             // for FormatData
 670             // copy string for later assembly into NumberElements
 671             pushStringEntry(qName, attributes, currentNumberingSystem + &quot;NumberElements/list&quot;);
 672             break;
 673         case &quot;percentSign&quot;:
 674             // for FormatData
 675             // copy string for later assembly into NumberElements
 676             pushStringEntry(qName, attributes, currentNumberingSystem + &quot;NumberElements/percent&quot;);
 677             break;
 678         case &quot;nativeZeroDigit&quot;:
 679             // for FormatData
 680             // copy string for later assembly into NumberElements
 681             pushStringEntry(qName, attributes, currentNumberingSystem + &quot;NumberElements/zero&quot;);
 682             break;
 683         case &quot;patternDigit&quot;:
</pre>
<hr />
<pre>
 735                 // for FormatData
 736                 // copy string for later assembly into DateTimePatterns
 737                 String prefix = (currentCalendarType == null) ? &quot;&quot; : currentCalendarType.keyElementName();
 738                 pushStringEntry(qName, attributes, prefix + &quot;DateTimePatterns/&quot; + attributes.getValue(&quot;type&quot;) + &quot;-dateTime&quot;);
 739             }
 740             break;
 741         case &quot;localizedPatternChars&quot;:
 742             {
 743                 // for FormatData
 744                 // copy string for later adaptation to JRE use
 745                 String prefix = (currentCalendarType == null) ? &quot;&quot; : currentCalendarType.keyElementName();
 746                 pushStringEntry(qName, attributes, prefix + &quot;DateTimePatternChars&quot;);
 747             }
 748             break;
 749 
 750         // &quot;alias&quot; for root
 751         case &quot;alias&quot;:
 752             {
 753                 if (id.equals(&quot;root&quot;) &amp;&amp; !isIgnored(attributes)
 754                         &amp;&amp; ((currentContainer.getqName().equals(&quot;decimalFormatLength&quot;))


 755                         || (currentCalendarType != null &amp;&amp; !currentCalendarType.lname().startsWith(&quot;islamic-&quot;)))) { // ignore islamic variants
 756                     pushAliasEntry(qName, attributes, attributes.getValue(&quot;path&quot;));
 757                 } else {
 758                     pushIgnoredContainer(qName);
 759                 }
 760             }
 761             break;
 762 
 763         default:
 764             // treat anything else as a container
 765             pushContainer(qName, attributes);
 766             break;
 767         }
 768     }
 769 
 770     private static final String[] CONTEXTS = {&quot;stand-alone&quot;, &quot;format&quot;};
 771     private static final String[] WIDTHS = {&quot;wide&quot;, &quot;narrow&quot;, &quot;abbreviated&quot;};
 772     private static final String[] LENGTHS = {&quot;full&quot;, &quot;long&quot;, &quot;medium&quot;, &quot;short&quot;};
 773 
 774     private void populateWidthAlias(String type, Set&lt;String&gt; keys) {
</pre>
<hr />
<pre>
 890         case &quot;eraNames&quot;:
 891             keyName = &quot;long.Eras&quot;;
 892             break;
 893         case &quot;eraAbbr&quot;:
 894             keyName = &quot;Eras&quot;;
 895             break;
 896         case &quot;eraNarrow&quot;:
 897             keyName = &quot;narrow.Eras&quot;;
 898             break;
 899         case &quot;dateFormats&quot;:
 900         case &quot;timeFormats&quot;:
 901         case &quot;days&quot;:
 902         case &quot;months&quot;:
 903         case &quot;quarters&quot;:
 904         case &quot;dayPeriods&quot;:
 905         case &quot;eras&quot;:
 906             break;
 907         case &quot;decimalFormatLength&quot;: // used for compact number formatting patterns
 908             keyName = type + &quot;.CompactNumberPatterns&quot;;
 909             break;






 910         default:
 911             keyName = &quot;&quot;;
 912             break;
 913         }
 914 
 915         return keyName;
 916     }
 917 
 918     private String getTarget(String path, String calType, String context, String width) {
 919         // Target qName
 920         int lastSlash = path.lastIndexOf(&#39;/&#39;);
 921         String qName = path.substring(lastSlash+1);
 922         int bracket = qName.indexOf(&#39;[&#39;);
 923         if (bracket != -1) {
 924             qName = qName.substring(0, bracket);
 925         }
 926 
 927         // calType
 928         String typeKey = &quot;/calendar[@type=&#39;&quot;;
 929         int start = path.indexOf(typeKey);
</pre>
<hr />
<pre>
 936         start = path.indexOf(typeKey);
 937         if (start != -1) {
 938             context = (path.substring(start+typeKey.length(), path.indexOf(&quot;&#39;]&quot;, start)));
 939         }
 940 
 941         // width
 942         typeKey = &quot;Width[@type=&#39;&quot;;
 943         start = path.indexOf(typeKey);
 944         if (start != -1) {
 945             width = path.substring(start+typeKey.length(), path.indexOf(&quot;&#39;]&quot;, start));
 946         }
 947 
 948         // used for compact number formatting patterns aliases
 949         typeKey = &quot;decimalFormatLength[@type=&#39;&quot;;
 950         start = path.indexOf(typeKey);
 951         if (start != -1) {
 952             String style = path.substring(start + typeKey.length(), path.indexOf(&quot;&#39;]&quot;, start));
 953             return toJDKKey(qName, &quot;&quot;, style);
 954         }
 955 
















 956         return calType + &quot;.&quot; + toJDKKey(qName, context, width);
 957     }
 958 
 959     @Override
 960     public void endElement(String uri, String localName, String qName) throws SAXException {
 961         assert qName.equals(currentContainer.getqName()) : &quot;current=&quot; + currentContainer.getqName() + &quot;, param=&quot; + qName;
 962         switch (qName) {
 963         case &quot;calendar&quot;:
 964             assert !(currentContainer instanceof Entry);
 965             currentCalendarType = null;
 966             break;
 967 
 968         case &quot;defaultNumberingSystem&quot;:
 969             if (currentContainer instanceof StringEntry) {
<span class="line-modified"> 970                 defaultNumberingSystem = ((StringEntry) currentContainer).getValue();</span>
<span class="line-removed"> 971                 assert defaultNumberingSystem != null;</span>
<span class="line-removed"> 972                 put(((StringEntry) currentContainer).getKey(), defaultNumberingSystem);</span>
 973             } else {
 974                 defaultNumberingSystem = null;
 975             }
 976             break;
 977 
 978         case &quot;timeZoneNames&quot;:
 979             zonePrefix = null;
 980             break;
 981 
 982         case &quot;generic&quot;:
 983         case &quot;standard&quot;:
 984         case &quot;daylight&quot;:
 985         case &quot;exemplarCity&quot;:
 986             if (zonePrefix != null &amp;&amp; (currentContainer instanceof Entry)) {
 987                 @SuppressWarnings(&quot;unchecked&quot;)
 988                 Map&lt;String, String&gt; valmap = (Map&lt;String, String&gt;) get(zonePrefix + getContainerKey());
 989                 Entry&lt;?&gt; entry = (Entry&lt;?&gt;) currentContainer;
 990                 if (qName.equals(&quot;exemplarCity&quot;)) {
 991                     put(CLDRConverter.EXEMPLAR_CITY_PREFIX + getContainerKey(), (String) entry.getValue());
 992                 } else {
</pre>
<hr />
<pre>
 995             }
 996             break;
 997 
 998         case &quot;monthWidth&quot;:
 999         case &quot;dayWidth&quot;:
1000         case &quot;dayPeriodWidth&quot;:
1001         case &quot;quarterWidth&quot;:
1002             currentWidth = &quot;&quot;;
1003             putIfEntry();
1004             break;
1005 
1006         case &quot;monthContext&quot;:
1007         case &quot;dayContext&quot;:
1008         case &quot;dayPeriodContext&quot;:
1009         case &quot;quarterContext&quot;:
1010             currentContext = &quot;&quot;;
1011             putIfEntry();
1012             break;
1013         case &quot;decimalFormatLength&quot;:
1014             currentStyle = &quot;&quot;;
<span class="line-modified">1015             compactCount = &quot;&quot;;</span>






1016             putIfEntry();
1017             break;
1018         default:
1019             putIfEntry();
1020         }
1021         currentContainer = currentContainer.getParent();
1022     }
1023 
<span class="line-modified">1024     private void putIfEntry() {</span>
1025         if (currentContainer instanceof AliasEntry) {
1026             Entry&lt;?&gt; entry = (Entry&lt;?&gt;) currentContainer;
1027             String containerqName = entry.getParent().getqName();
1028             if (containerqName.equals(&quot;decimalFormatLength&quot;)) {
1029                 String srcKey = toJDKKey(containerqName, &quot;&quot;, currentStyle);
1030                 String targetKey = getTarget(entry.getKey(), &quot;&quot;, &quot;&quot;, &quot;&quot;);
1031                 CLDRConverter.aliases.put(srcKey, targetKey);







1032             } else {
1033                 Set&lt;String&gt; keyNames = populateAliasKeys(containerqName, currentContext, currentWidth);
1034                 if (!keyNames.isEmpty()) {
1035                     for (String keyName : keyNames) {
1036                         String[] tmp = keyName.split(&quot;,&quot;, 3);
1037                         String calType = currentCalendarType.lname();
1038                         String src = calType+&quot;.&quot;+tmp[0];
1039                         String target = getTarget(
1040                                     entry.getKey(),
1041                                     calType,
1042                                     tmp[1].length()&gt;0 ? tmp[1] : currentContext,
1043                                     tmp[2].length()&gt;0 ? tmp[2] : currentWidth);
1044                         if (target.substring(target.lastIndexOf(&#39;.&#39;)+1).equals(containerqName)) {
1045                             target = target.substring(0, target.indexOf(&#39;.&#39;))+&quot;.&quot;+tmp[0];
1046                         }
1047                         CLDRConverter.aliases.put(src.replaceFirst(&quot;^gregorian.&quot;, &quot;&quot;),
1048                                                   target.replaceFirst(&quot;^gregorian.&quot;, &quot;&quot;));
1049                     }
1050                 }
1051             }
1052         } else if (currentContainer instanceof Entry) {
1053             Entry&lt;?&gt; entry = (Entry&lt;?&gt;) currentContainer;
1054             Object value = entry.getValue();
1055             if (value != null) {
1056                 String key = entry.getKey();
1057                 // Tweak for MonthNames for the root locale, Needed for
1058                 // SimpleDateFormat.format()/parse() roundtrip.
1059                 if (id.equals(&quot;root&quot;) &amp;&amp; key.startsWith(&quot;MonthNames&quot;)) {
1060                     value = new DateFormatSymbols(Locale.US).getShortMonths();
1061                 }
<span class="line-modified">1062                 put(entry.getKey(), value);</span>
1063             }
1064         }

1065     }
1066 
1067     public String convertOldKeyName(String key) {
1068         // Explicitly obtained from &quot;alias&quot; attribute in each &quot;key&quot; element.
1069         switch (key) {
1070             case &quot;calendar&quot;:
1071                 return &quot;ca&quot;;
1072             case &quot;currency&quot;:
1073                 return &quot;cu&quot;;
1074             case &quot;collation&quot;:
1075                 return &quot;co&quot;;
1076             case &quot;numbers&quot;:
1077                 return &quot;nu&quot;;
1078             case &quot;timezone&quot;:
1079                 return &quot;tz&quot;;
1080             default:
1081                 return key;
1082         }
1083     }












1084 }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2012, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package build.tools.cldrconverter;
  27 
  28 import java.io.File;
  29 import java.io.IOException;
  30 import java.text.DateFormatSymbols;
  31 import java.util.ArrayList;
<span class="line-added">  32 import java.util.Arrays;</span>
  33 import java.util.HashMap;
  34 import java.util.HashSet;
  35 import java.util.List;
  36 import java.util.Locale;
  37 import java.util.Map;
  38 import java.util.Set;
  39 import org.xml.sax.Attributes;
  40 import org.xml.sax.InputSource;
  41 import org.xml.sax.SAXException;
  42 
  43 /**
  44  * Handles parsing of files in Locale Data Markup Language and produces a map
  45  * that uses the keys and values of JRE locale data.
  46  */
  47 class LDMLParseHandler extends AbstractLDMLHandler&lt;Object&gt; {
  48     private String defaultNumberingSystem;
  49     private String currentNumberingSystem = &quot;&quot;;
  50     private CalendarType currentCalendarType;
  51     private String zoneNameStyle; // &quot;long&quot; or &quot;short&quot; for time zone names
  52     private String zonePrefix;
  53     private final String id;
  54     private String currentContext = &quot;&quot;; // &quot;format&quot;/&quot;stand-alone&quot;
  55     private String currentWidth = &quot;&quot;; // &quot;wide&quot;/&quot;narrow&quot;/&quot;abbreviated&quot;
  56     private String currentStyle = &quot;&quot;; // short, long for decimalFormat

  57 
  58     LDMLParseHandler(String id) {
  59         this.id = id;
  60     }
  61 
  62     @Override
  63     public InputSource resolveEntity(String publicID, String systemID) throws IOException, SAXException {
  64         // avoid HTTP traffic to unicode.org
  65         if (systemID.startsWith(CLDRConverter.LDML_DTD_SYSTEM_ID)) {
  66             return new InputSource((new File(CLDRConverter.LOCAL_LDML_DTD)).toURI().toString());
  67         }
  68         return null;
  69     }
  70 
  71     @Override
  72     public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
  73         switch (qName) {
  74         //
  75         // Generic information
  76         //
</pre>
<hr />
<pre>
 491         case &quot;short&quot;:
 492             zoneNameStyle = &quot;short&quot;;
 493             pushContainer(qName, attributes);
 494             break;
 495         case &quot;generic&quot;:  // generic name
 496         case &quot;standard&quot;: // standard time name
 497         case &quot;daylight&quot;: // daylight saving (summer) time name
 498             pushStringEntry(qName, attributes, CLDRConverter.ZONE_NAME_PREFIX + qName + &quot;.&quot; + zoneNameStyle);
 499             break;
 500         case &quot;exemplarCity&quot;:
 501             pushStringEntry(qName, attributes, CLDRConverter.EXEMPLAR_CITY_PREFIX);
 502             break;
 503 
 504         //
 505         // Number format information
 506         //
 507         case &quot;decimalFormatLength&quot;:
 508             String type = attributes.getValue(&quot;type&quot;);
 509             if (null == type) {
 510                 // format data for decimal number format
<span class="line-modified"> 511                 pushStringEntry(qName, attributes,</span>
<span class="line-added"> 512                     currentNumberingSystem + &quot;NumberPatterns/decimal&quot;);</span>
 513                 currentStyle = type;
 514             } else {
 515                 switch (type) {
 516                     case &quot;short&quot;:
 517                     case &quot;long&quot;:
 518                         // considering &quot;short&quot; and long for
 519                         // compact number formatting patterns
 520                         pushKeyContainer(qName, attributes, type);
 521                         currentStyle = type;
 522                         break;
 523                     default:
 524                         pushIgnoredContainer(qName);
 525                         break;
 526                 }
 527             }
 528             break;
 529         case &quot;decimalFormat&quot;:
 530             if(currentStyle == null) {
 531                 pushContainer(qName, attributes);
 532             } else {
 533                 switch (currentStyle) {
 534                     case &quot;short&quot;:



 535                     case &quot;long&quot;:
 536                         pushStringListEntry(qName, attributes,
 537                                 currentStyle+&quot;.CompactNumberPatterns&quot;);
 538                         break;
 539                     default:
 540                         pushIgnoredContainer(qName);
 541                         break;
 542                 }
 543             }
 544             break;
<span class="line-added"> 545         case &quot;currencyFormat&quot;:</span>
<span class="line-added"> 546         case &quot;percentFormat&quot;:</span>
<span class="line-added"> 547             pushKeyContainer(qName, attributes, attributes.getValue(&quot;type&quot;));</span>
<span class="line-added"> 548             break;</span>
<span class="line-added"> 549 </span>
 550         case &quot;pattern&quot;:
 551             String containerName = currentContainer.getqName();
<span class="line-modified"> 552             switch (containerName) {</span>
<span class="line-modified"> 553                 case &quot;currencyFormat&quot;:</span>
<span class="line-modified"> 554                 case &quot;percentFormat&quot;:</span>
<span class="line-modified"> 555                 {</span>
<span class="line-modified"> 556                     // for FormatData</span>
<span class="line-modified"> 557                     // copy string for later assembly into NumberPatterns</span>
<span class="line-modified"> 558                     if (currentContainer instanceof KeyContainer) {</span>
<span class="line-modified"> 559                         String fStyle = ((KeyContainer)currentContainer).getKey();</span>
<span class="line-modified"> 560                         if (fStyle.equals(&quot;standard&quot;)) {</span>
<span class="line-modified"> 561                             pushStringEntry(qName, attributes,</span>
<span class="line-modified"> 562                                     currentNumberingSystem + &quot;NumberPatterns/&quot; + containerName.replaceFirst(&quot;Format&quot;, &quot;&quot;));</span>
<span class="line-modified"> 563                         } else if (fStyle.equals(&quot;accounting&quot;) &amp;&amp; containerName.equals(&quot;currencyFormat&quot;)) {</span>
<span class="line-modified"> 564                             pushStringEntry(qName, attributes,</span>
<span class="line-modified"> 565                                     currentNumberingSystem + &quot;NumberPatterns/accounting&quot;);</span>
<span class="line-modified"> 566                         } else {</span>
<span class="line-modified"> 567                             pushIgnoredContainer(qName);</span>
<span class="line-modified"> 568                         }</span>
<span class="line-modified"> 569                     } else {</span>
<span class="line-modified"> 570                         pushIgnoredContainer(qName);</span>
<span class="line-modified"> 571                     }</span>
<span class="line-modified"> 572                 }</span>
<span class="line-modified"> 573                 break;</span>
<span class="line-modified"> 574 </span>
<span class="line-modified"> 575                 case &quot;decimalFormat&quot;:</span>
<span class="line-modified"> 576                     if (currentStyle == null) {</span>
<span class="line-added"> 577                         pushContainer(qName, attributes);</span>
<span class="line-added"> 578                     } else {</span>
<span class="line-added"> 579                         switch (currentStyle) {</span>
<span class="line-added"> 580                             case &quot;short&quot;:</span>
<span class="line-added"> 581                             case &quot;long&quot;:</span>
 582                                 pushStringListElement(qName, attributes,
<span class="line-modified"> 583                                     (int) Math.log10(Double.parseDouble(attributes.getValue(&quot;type&quot;))),</span>
<span class="line-modified"> 584                                     attributes.getValue(&quot;count&quot;));</span>
<span class="line-added"> 585                                 break;</span>
<span class="line-added"> 586                             default:</span>
 587                                 pushIgnoredContainer(qName);
<span class="line-modified"> 588                                 break;</span>
<span class="line-modified"> 589                         }</span>



 590                     }
<span class="line-added"> 591                     break;</span>
<span class="line-added"> 592                 default:</span>
<span class="line-added"> 593                     pushContainer(qName, attributes);</span>
<span class="line-added"> 594                     break;</span>
<span class="line-added"> 595             }</span>
<span class="line-added"> 596             break;</span>
<span class="line-added"> 597         case &quot;currencyFormats&quot;:</span>
<span class="line-added"> 598         case &quot;decimalFormats&quot;:</span>
<span class="line-added"> 599         case &quot;percentFormats&quot;:</span>
<span class="line-added"> 600             {</span>
<span class="line-added"> 601                 String script = attributes.getValue(&quot;numberSystem&quot;);</span>
<span class="line-added"> 602                 if (script != null) {</span>
<span class="line-added"> 603                     addNumberingScript(script);</span>
<span class="line-added"> 604                     currentNumberingSystem = script + &quot;.&quot;;</span>
 605                 }

 606                 pushContainer(qName, attributes);
 607             }
 608             break;
 609         case &quot;currencyFormatLength&quot;:
 610             if (attributes.getValue(&quot;type&quot;) == null) {
 611                 // skipping type=&quot;short&quot; data
 612                 // for FormatData
 613                 pushContainer(qName, attributes);
 614             } else {
 615                 pushIgnoredContainer(qName);
 616             }
 617             break;


















 618         case &quot;defaultNumberingSystem&quot;:
 619             // default numbering system if multiple numbering systems are used.
 620             pushStringEntry(qName, attributes, &quot;DefaultNumberingSystem&quot;);
 621             break;
 622         case &quot;symbols&quot;:
 623             // for FormatData
 624             // look up numberingSystems
 625             symbols: {
 626                 String script = attributes.getValue(&quot;numberSystem&quot;);
 627                 if (script == null) {
 628                     // Has no script. Just ignore.
 629                     pushIgnoredContainer(qName);
 630                     break;
 631                 }
 632 
 633                 // Use keys as &lt;script&gt;.&quot;NumberElements/&lt;symbol&gt;&quot;
 634                 currentNumberingSystem = script + &quot;.&quot;;
 635                 String digits = CLDRConverter.handlerNumbering.get(script);
 636                 if (digits == null) {
 637                     pushIgnoredContainer(qName);
 638                     break;
 639                 }
 640 
<span class="line-modified"> 641                 addNumberingScript(script);</span>






 642                 put(currentNumberingSystem + &quot;NumberElements/zero&quot;, digits.substring(0, 1));
 643                 pushContainer(qName, attributes);
 644             }
 645             break;
 646         case &quot;decimal&quot;:








 647         case &quot;group&quot;:
<span class="line-added"> 648         case &quot;currencyDecimal&quot;:</span>
<span class="line-added"> 649         case &quot;currencyGroup&quot;:</span>
 650             // for FormatData
 651             // copy string for later assembly into NumberElements
 652             if (currentContainer.getqName().equals(&quot;symbols&quot;)) {
<span class="line-modified"> 653                 pushStringEntry(qName, attributes, currentNumberingSystem + &quot;NumberElements/&quot; + qName);</span>
 654             } else {
 655                 pushIgnoredContainer(qName);
 656             }
 657             break;
 658         case &quot;list&quot;:
 659             // for FormatData
 660             // copy string for later assembly into NumberElements
 661             pushStringEntry(qName, attributes, currentNumberingSystem + &quot;NumberElements/list&quot;);
 662             break;
 663         case &quot;percentSign&quot;:
 664             // for FormatData
 665             // copy string for later assembly into NumberElements
 666             pushStringEntry(qName, attributes, currentNumberingSystem + &quot;NumberElements/percent&quot;);
 667             break;
 668         case &quot;nativeZeroDigit&quot;:
 669             // for FormatData
 670             // copy string for later assembly into NumberElements
 671             pushStringEntry(qName, attributes, currentNumberingSystem + &quot;NumberElements/zero&quot;);
 672             break;
 673         case &quot;patternDigit&quot;:
</pre>
<hr />
<pre>
 725                 // for FormatData
 726                 // copy string for later assembly into DateTimePatterns
 727                 String prefix = (currentCalendarType == null) ? &quot;&quot; : currentCalendarType.keyElementName();
 728                 pushStringEntry(qName, attributes, prefix + &quot;DateTimePatterns/&quot; + attributes.getValue(&quot;type&quot;) + &quot;-dateTime&quot;);
 729             }
 730             break;
 731         case &quot;localizedPatternChars&quot;:
 732             {
 733                 // for FormatData
 734                 // copy string for later adaptation to JRE use
 735                 String prefix = (currentCalendarType == null) ? &quot;&quot; : currentCalendarType.keyElementName();
 736                 pushStringEntry(qName, attributes, prefix + &quot;DateTimePatternChars&quot;);
 737             }
 738             break;
 739 
 740         // &quot;alias&quot; for root
 741         case &quot;alias&quot;:
 742             {
 743                 if (id.equals(&quot;root&quot;) &amp;&amp; !isIgnored(attributes)
 744                         &amp;&amp; ((currentContainer.getqName().equals(&quot;decimalFormatLength&quot;))
<span class="line-added"> 745                         || (currentContainer.getqName().equals(&quot;currencyFormat&quot;))</span>
<span class="line-added"> 746                         || (currentContainer.getqName().equals(&quot;percentFormat&quot;))</span>
 747                         || (currentCalendarType != null &amp;&amp; !currentCalendarType.lname().startsWith(&quot;islamic-&quot;)))) { // ignore islamic variants
 748                     pushAliasEntry(qName, attributes, attributes.getValue(&quot;path&quot;));
 749                 } else {
 750                     pushIgnoredContainer(qName);
 751                 }
 752             }
 753             break;
 754 
 755         default:
 756             // treat anything else as a container
 757             pushContainer(qName, attributes);
 758             break;
 759         }
 760     }
 761 
 762     private static final String[] CONTEXTS = {&quot;stand-alone&quot;, &quot;format&quot;};
 763     private static final String[] WIDTHS = {&quot;wide&quot;, &quot;narrow&quot;, &quot;abbreviated&quot;};
 764     private static final String[] LENGTHS = {&quot;full&quot;, &quot;long&quot;, &quot;medium&quot;, &quot;short&quot;};
 765 
 766     private void populateWidthAlias(String type, Set&lt;String&gt; keys) {
</pre>
<hr />
<pre>
 882         case &quot;eraNames&quot;:
 883             keyName = &quot;long.Eras&quot;;
 884             break;
 885         case &quot;eraAbbr&quot;:
 886             keyName = &quot;Eras&quot;;
 887             break;
 888         case &quot;eraNarrow&quot;:
 889             keyName = &quot;narrow.Eras&quot;;
 890             break;
 891         case &quot;dateFormats&quot;:
 892         case &quot;timeFormats&quot;:
 893         case &quot;days&quot;:
 894         case &quot;months&quot;:
 895         case &quot;quarters&quot;:
 896         case &quot;dayPeriods&quot;:
 897         case &quot;eras&quot;:
 898             break;
 899         case &quot;decimalFormatLength&quot;: // used for compact number formatting patterns
 900             keyName = type + &quot;.CompactNumberPatterns&quot;;
 901             break;
<span class="line-added"> 902         case &quot;currencyFormat&quot;:</span>
<span class="line-added"> 903         case &quot;percentFormat&quot;:</span>
<span class="line-added"> 904             keyName = currentNumberingSystem +</span>
<span class="line-added"> 905                     &quot;NumberPatterns/&quot; +</span>
<span class="line-added"> 906                     (type.equals(&quot;standard&quot;) ? containerqName.replaceFirst(&quot;Format&quot;, &quot;&quot;) : type);</span>
<span class="line-added"> 907             break;</span>
 908         default:
 909             keyName = &quot;&quot;;
 910             break;
 911         }
 912 
 913         return keyName;
 914     }
 915 
 916     private String getTarget(String path, String calType, String context, String width) {
 917         // Target qName
 918         int lastSlash = path.lastIndexOf(&#39;/&#39;);
 919         String qName = path.substring(lastSlash+1);
 920         int bracket = qName.indexOf(&#39;[&#39;);
 921         if (bracket != -1) {
 922             qName = qName.substring(0, bracket);
 923         }
 924 
 925         // calType
 926         String typeKey = &quot;/calendar[@type=&#39;&quot;;
 927         int start = path.indexOf(typeKey);
</pre>
<hr />
<pre>
 934         start = path.indexOf(typeKey);
 935         if (start != -1) {
 936             context = (path.substring(start+typeKey.length(), path.indexOf(&quot;&#39;]&quot;, start)));
 937         }
 938 
 939         // width
 940         typeKey = &quot;Width[@type=&#39;&quot;;
 941         start = path.indexOf(typeKey);
 942         if (start != -1) {
 943             width = path.substring(start+typeKey.length(), path.indexOf(&quot;&#39;]&quot;, start));
 944         }
 945 
 946         // used for compact number formatting patterns aliases
 947         typeKey = &quot;decimalFormatLength[@type=&#39;&quot;;
 948         start = path.indexOf(typeKey);
 949         if (start != -1) {
 950             String style = path.substring(start + typeKey.length(), path.indexOf(&quot;&#39;]&quot;, start));
 951             return toJDKKey(qName, &quot;&quot;, style);
 952         }
 953 
<span class="line-added"> 954         // currencyFormat</span>
<span class="line-added"> 955         typeKey = &quot;currencyFormat[@type=&#39;&quot;;</span>
<span class="line-added"> 956         start = path.indexOf(typeKey);</span>
<span class="line-added"> 957         if (start != -1) {</span>
<span class="line-added"> 958             String style = path.substring(start + typeKey.length(), path.indexOf(&quot;&#39;]&quot;, start));</span>
<span class="line-added"> 959             return toJDKKey(qName, &quot;&quot;, style);</span>
<span class="line-added"> 960         }</span>
<span class="line-added"> 961 </span>
<span class="line-added"> 962         // percentFormat</span>
<span class="line-added"> 963         typeKey = &quot;percentFormat[@type=&#39;&quot;;</span>
<span class="line-added"> 964         start = path.indexOf(typeKey);</span>
<span class="line-added"> 965         if (start != -1) {</span>
<span class="line-added"> 966             String style = path.substring(start + typeKey.length(), path.indexOf(&quot;&#39;]&quot;, start));</span>
<span class="line-added"> 967             return toJDKKey(qName, &quot;&quot;, style);</span>
<span class="line-added"> 968         }</span>
<span class="line-added"> 969 </span>
 970         return calType + &quot;.&quot; + toJDKKey(qName, context, width);
 971     }
 972 
 973     @Override
 974     public void endElement(String uri, String localName, String qName) throws SAXException {
 975         assert qName.equals(currentContainer.getqName()) : &quot;current=&quot; + currentContainer.getqName() + &quot;, param=&quot; + qName;
 976         switch (qName) {
 977         case &quot;calendar&quot;:
 978             assert !(currentContainer instanceof Entry);
 979             currentCalendarType = null;
 980             break;
 981 
 982         case &quot;defaultNumberingSystem&quot;:
 983             if (currentContainer instanceof StringEntry) {
<span class="line-modified"> 984                 defaultNumberingSystem = (String) putIfEntry();</span>


 985             } else {
 986                 defaultNumberingSystem = null;
 987             }
 988             break;
 989 
 990         case &quot;timeZoneNames&quot;:
 991             zonePrefix = null;
 992             break;
 993 
 994         case &quot;generic&quot;:
 995         case &quot;standard&quot;:
 996         case &quot;daylight&quot;:
 997         case &quot;exemplarCity&quot;:
 998             if (zonePrefix != null &amp;&amp; (currentContainer instanceof Entry)) {
 999                 @SuppressWarnings(&quot;unchecked&quot;)
1000                 Map&lt;String, String&gt; valmap = (Map&lt;String, String&gt;) get(zonePrefix + getContainerKey());
1001                 Entry&lt;?&gt; entry = (Entry&lt;?&gt;) currentContainer;
1002                 if (qName.equals(&quot;exemplarCity&quot;)) {
1003                     put(CLDRConverter.EXEMPLAR_CITY_PREFIX + getContainerKey(), (String) entry.getValue());
1004                 } else {
</pre>
<hr />
<pre>
1007             }
1008             break;
1009 
1010         case &quot;monthWidth&quot;:
1011         case &quot;dayWidth&quot;:
1012         case &quot;dayPeriodWidth&quot;:
1013         case &quot;quarterWidth&quot;:
1014             currentWidth = &quot;&quot;;
1015             putIfEntry();
1016             break;
1017 
1018         case &quot;monthContext&quot;:
1019         case &quot;dayContext&quot;:
1020         case &quot;dayPeriodContext&quot;:
1021         case &quot;quarterContext&quot;:
1022             currentContext = &quot;&quot;;
1023             putIfEntry();
1024             break;
1025         case &quot;decimalFormatLength&quot;:
1026             currentStyle = &quot;&quot;;
<span class="line-modified">1027             putIfEntry();</span>
<span class="line-added">1028             break;</span>
<span class="line-added">1029         case &quot;currencyFormats&quot;:</span>
<span class="line-added">1030         case &quot;decimalFormats&quot;:</span>
<span class="line-added">1031         case &quot;percentFormats&quot;:</span>
<span class="line-added">1032         case &quot;symbols&quot;:</span>
<span class="line-added">1033             currentNumberingSystem = &quot;&quot;;</span>
1034             putIfEntry();
1035             break;
1036         default:
1037             putIfEntry();
1038         }
1039         currentContainer = currentContainer.getParent();
1040     }
1041 
<span class="line-modified">1042     private Object putIfEntry() {</span>
1043         if (currentContainer instanceof AliasEntry) {
1044             Entry&lt;?&gt; entry = (Entry&lt;?&gt;) currentContainer;
1045             String containerqName = entry.getParent().getqName();
1046             if (containerqName.equals(&quot;decimalFormatLength&quot;)) {
1047                 String srcKey = toJDKKey(containerqName, &quot;&quot;, currentStyle);
1048                 String targetKey = getTarget(entry.getKey(), &quot;&quot;, &quot;&quot;, &quot;&quot;);
1049                 CLDRConverter.aliases.put(srcKey, targetKey);
<span class="line-added">1050             } else if (containerqName.equals(&quot;currencyFormat&quot;) ||</span>
<span class="line-added">1051                         containerqName.equals(&quot;percentFormat&quot;)) {</span>
<span class="line-added">1052                 KeyContainer kc = (KeyContainer)entry.getParent();</span>
<span class="line-added">1053                 CLDRConverter.aliases.put(</span>
<span class="line-added">1054                         toJDKKey(containerqName, &quot;&quot;, kc.getKey()),</span>
<span class="line-added">1055                         getTarget(entry.getKey(), &quot;&quot;, &quot;&quot;, &quot;&quot;)</span>
<span class="line-added">1056                 );</span>
1057             } else {
1058                 Set&lt;String&gt; keyNames = populateAliasKeys(containerqName, currentContext, currentWidth);
1059                 if (!keyNames.isEmpty()) {
1060                     for (String keyName : keyNames) {
1061                         String[] tmp = keyName.split(&quot;,&quot;, 3);
1062                         String calType = currentCalendarType.lname();
1063                         String src = calType+&quot;.&quot;+tmp[0];
1064                         String target = getTarget(
1065                                     entry.getKey(),
1066                                     calType,
1067                                     tmp[1].length()&gt;0 ? tmp[1] : currentContext,
1068                                     tmp[2].length()&gt;0 ? tmp[2] : currentWidth);
1069                         if (target.substring(target.lastIndexOf(&#39;.&#39;)+1).equals(containerqName)) {
1070                             target = target.substring(0, target.indexOf(&#39;.&#39;))+&quot;.&quot;+tmp[0];
1071                         }
1072                         CLDRConverter.aliases.put(src.replaceFirst(&quot;^gregorian.&quot;, &quot;&quot;),
1073                                                   target.replaceFirst(&quot;^gregorian.&quot;, &quot;&quot;));
1074                     }
1075                 }
1076             }
1077         } else if (currentContainer instanceof Entry) {
1078             Entry&lt;?&gt; entry = (Entry&lt;?&gt;) currentContainer;
1079             Object value = entry.getValue();
1080             if (value != null) {
1081                 String key = entry.getKey();
1082                 // Tweak for MonthNames for the root locale, Needed for
1083                 // SimpleDateFormat.format()/parse() roundtrip.
1084                 if (id.equals(&quot;root&quot;) &amp;&amp; key.startsWith(&quot;MonthNames&quot;)) {
1085                     value = new DateFormatSymbols(Locale.US).getShortMonths();
1086                 }
<span class="line-modified">1087                 return put(entry.getKey(), value);</span>
1088             }
1089         }
<span class="line-added">1090         return null;</span>
1091     }
1092 
1093     public String convertOldKeyName(String key) {
1094         // Explicitly obtained from &quot;alias&quot; attribute in each &quot;key&quot; element.
1095         switch (key) {
1096             case &quot;calendar&quot;:
1097                 return &quot;ca&quot;;
1098             case &quot;currency&quot;:
1099                 return &quot;cu&quot;;
1100             case &quot;collation&quot;:
1101                 return &quot;co&quot;;
1102             case &quot;numbers&quot;:
1103                 return &quot;nu&quot;;
1104             case &quot;timezone&quot;:
1105                 return &quot;tz&quot;;
1106             default:
1107                 return key;
1108         }
1109     }
<span class="line-added">1110 </span>
<span class="line-added">1111     private void addNumberingScript(String script) {</span>
<span class="line-added">1112         @SuppressWarnings(&quot;unchecked&quot;)</span>
<span class="line-added">1113         List&lt;String&gt; numberingScripts = (List&lt;String&gt;) get(&quot;numberingScripts&quot;);</span>
<span class="line-added">1114         if (numberingScripts == null) {</span>
<span class="line-added">1115             numberingScripts = new ArrayList&lt;&gt;();</span>
<span class="line-added">1116             put(&quot;numberingScripts&quot;, numberingScripts);</span>
<span class="line-added">1117         }</span>
<span class="line-added">1118         if (!numberingScripts.contains(script)) {</span>
<span class="line-added">1119             numberingScripts.add(script);</span>
<span class="line-added">1120         }</span>
<span class="line-added">1121     }</span>
1122 }
</pre>
</td>
</tr>
</table>
<center><a href="CLDRConverter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ResourceBundleGenerator.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>