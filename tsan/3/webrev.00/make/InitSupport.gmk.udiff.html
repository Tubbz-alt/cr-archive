<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/InitSupport.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Init.gmk.udiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="MacBundles.gmk.udiff.html" target="_top">next &gt;</a></center>    <h2>make/InitSupport.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  #
<span class="udiff-line-modified-removed">- # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+ # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -51,11 +51,11 @@</span>
    # Make control variables, handled by Init.gmk
    INIT_CONTROL_VARIABLES += LOG CONF CONF_NAME SPEC JOBS TEST_JOBS CONF_CHECK \
        COMPARE_BUILD JTREG GTEST MICRO TEST_OPTS TEST_VM_OPTS
  
    # All known make control variables
<span class="udiff-line-modified-removed">-   MAKE_CONTROL_VARIABLES := $(INIT_CONTROL_VARIABLES) TEST JDK_FILTER</span>
<span class="udiff-line-modified-added">+   MAKE_CONTROL_VARIABLES := $(INIT_CONTROL_VARIABLES) TEST JDK_FILTER SPEC_FILTER</span>
  
    # Define a simple reverse function.
    # Should maybe move to MakeBase.gmk, but we can&#39;t include that file now.
    reverse = \
        $(if $(strip $(1)), $(call reverse, $(wordlist 2, $(words $(1)), $(1)))) \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -262,17 +262,13 @@</span>
        ifeq ($(strip $1), FORCE)
          $$(shell rm -f $$(main_targets_file))
        endif
      endif
  
<span class="udiff-line-removed">-     # The --no-print-directory is needed to make the call from</span>
<span class="udiff-line-removed">-     # FindTest.gmk to Test.gmk work with LOG=debug/trace. See</span>
<span class="udiff-line-removed">-     # JDK-8213736</span>
      $$(main_targets_file):
  	@( cd $$(topdir) &amp;&amp; \
<span class="udiff-line-modified-removed">- 	$$(MAKE) $$(MAKE_LOG_FLAGS) -r -R --no-print-directory \</span>
<span class="udiff-line-removed">- 	    -f $$(topdir)/make/Main.gmk \</span>
<span class="udiff-line-modified-added">+ 	$$(MAKE) $$(MAKE_LOG_FLAGS) -r -R -f $$(topdir)/make/Main.gmk \</span>
  	    -I $$(topdir)/make/common SPEC=$(strip $2) NO_RECIPES=true \
  	    $$(MAKE_LOG_VARS) \
  	    create-main-targets-include )
  
      # Now include main-targets.gmk. This will define ALL_MAIN_TARGETS.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -298,10 +294,13 @@</span>
    # Define basic logging setup
    BUILD_LOG := $(OUTPUTDIR)/build.log
    BUILD_PROFILE_LOG := $(OUTPUTDIR)/build-profile.log
  
    BUILD_LOG_PIPE := &gt; &gt;($(TEE) -a $(BUILD_LOG)) 2&gt; &gt;($(TEE) -a $(BUILD_LOG) &gt;&amp;2) &amp;&amp; wait
<span class="udiff-line-added">+   # Use this for simple echo/printf commands that are never expected to print</span>
<span class="udiff-line-added">+   # to stderr.</span>
<span class="udiff-line-added">+   BUILD_LOG_PIPE_SIMPLE := | $(TEE) -a $(BUILD_LOG)</span>
  
    ifneq ($(CUSTOM_ROOT), )
      topdir=$(CUSTOM_ROOT)
    else
      topdir=$(TOPDIR)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -386,11 +385,11 @@</span>
  	else \
  	  $(MKDIR) -p $(OUTPUTDIR); \
  	fi
          # Re-run configure with the same arguments (and possibly some additional),
          # must be done after patching.
<span class="udiff-line-modified-removed">- 	( cd $(OUTPUTDIR) &amp;&amp; PATH=&quot;$(ORIGINAL_PATH)&quot; \</span>
<span class="udiff-line-modified-added">+ 	( cd $(CONFIGURE_START_DIR) &amp;&amp; PATH=&quot;$(ORIGINAL_PATH)&quot; \</span>
  	    $(BASH) $(topdir)/configure $(CONFIGURE_COMMAND_LINE) $(COMPARE_BUILD_CONF))
    endef
  
    # Cleanup after a compare build
    define CleanupCompareBuild
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -423,12 +422,12 @@</span>
  	    $(foreach logfile, $(sort $(wildcard $(MAKESUPPORT_OUTPUTDIR)/failure-logs/*.log)), \
  	        $(PRINTF) &quot;* For target $(notdir $(basename $(logfile))):\n&quot; $(NEWLINE) \
  	        $(if $(filter all, $(LOG_REPORT)), \
  	          $(GREP) -v -e &quot;^Note: including file:&quot; &lt;  $(logfile) || true $(NEWLINE) \
  	        , \
<span class="udiff-line-modified-removed">- 	          ($(GREP) -v -e &quot;^Note: including file:&quot; &lt;  $(logfile) || true) | $(HEAD) -n 12 $(NEWLINE) \</span>
<span class="udiff-line-modified-removed">- 	          if test `$(WC) -l &lt; $(logfile)` -gt 12; then \</span>
<span class="udiff-line-modified-added">+ 	          ($(GREP) -v -e &quot;^Note: including file:&quot; &lt;  $(logfile) || true) | $(HEAD) -n 15 $(NEWLINE) \</span>
<span class="udiff-line-modified-added">+ 	          if test `$(WC) -l &lt; $(logfile)` -gt 15; then \</span>
  	            $(ECHO) &quot;   ... (rest of output omitted)&quot; ; \
  	          fi $(NEWLINE) \
  	        ) \
  	    ) \
  	    $(PRINTF) &quot;\n* All command lines available in $(MAKESUPPORT_OUTPUTDIR)/failure-logs.\n&quot; $(NEWLINE) \
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -516,21 +515,21 @@</span>
  	    &quot;`$(CAT) $(BUILDTIMESDIR)/build_time_start_TOTAL_human_readable`&quot; \
  	    &quot;`$(CAT) $(BUILDTIMESDIR)/build_time_end_TOTAL_human_readable`&quot; \
  	    &quot;`$(LS) $(BUILDTIMESDIR)/build_time_diff_* | $(GREP) -v _TOTAL | \
  	    $(XARGS) $(CAT) | $(SORT) -k 2`&quot; \
  	    &quot;`$(CAT) $(BUILDTIMESDIR)/build_time_diff_TOTAL`&quot; \
<span class="udiff-line-modified-removed">- 	    $(BUILD_LOG_PIPE)</span>
<span class="udiff-line-modified-added">+ 	    $(BUILD_LOG_PIPE_SIMPLE)</span>
    endef
  
    define ReportProfileTimes
      $(if $(findstring true, $(LOG_PROFILE_TIMES_LOG)), \
        [ ! -f $(BUILD_PROFILE_LOG) ] || \
        { $(ECHO) Begin $(notdir $(BUILD_PROFILE_LOG)) &amp;&amp; \
          $(CAT) $(BUILD_PROFILE_LOG) &amp;&amp; \
          $(ECHO) End $(notdir $(BUILD_PROFILE_LOG)); \
        } \
<span class="udiff-line-modified-removed">-       $(BUILD_LOG_PIPE)</span>
<span class="udiff-line-modified-added">+       $(BUILD_LOG_PIPE_SIMPLE)</span>
      )
    endef
  
  endif # HAS_SPEC
  
</pre>
<center><a href="Init.gmk.udiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="MacBundles.gmk.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>