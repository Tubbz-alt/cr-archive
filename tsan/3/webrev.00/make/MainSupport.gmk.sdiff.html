<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/MainSupport.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="Main.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="ModuleWrapper.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/MainSupport.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
116 
117 PHASE_MAKEDIRS := $(TOPDIR)/make
118 
119 # Helper macro for DeclareRecipesForPhase
120 # Declare a recipe for calling the module and phase specific makefile.
121 # If there are multiple makefiles to call, create a rule for each topdir
122 # that contains a makefile with the target $module-$suffix-$repodir,
123 # (i.e: java.base-gensrc-src)
124 # Normally there is only one makefile, and the target will just be
125 # $module-$suffix
126 # Param 1: Name of list to add targets to
127 # Param 2: Module name
128 define DeclareRecipeForModuleMakefile
129   $2-$$($1_TARGET_SUFFIX):
130         ifeq ($$($1_USE_WRAPPER), true)
131 	  +($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
132 	      -f ModuleWrapper.gmk \
133 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \
134 	          $$(addsuffix /$$($1_MAKE_SUBDIR), $$(PHASE_MAKEDIRS)) \
135 	      ) \
<span class="line-modified">136 	      MODULE=$2 MAKEFILE_PREFIX=$$($1_FILE_PREFIX))</span>
137         else
138 	  +($(CD) $$(dir $$(firstword $$(wildcard $$(addsuffix \
139 	      /$$($1_MAKE_SUBDIR)/$$($1_FILE_PREFIX)-$2.gmk, $$(PHASE_MAKEDIRS))))) \
140 	  &amp;&amp; $(MAKE) $(MAKE_ARGS) \
141 	      -f $$($1_FILE_PREFIX)-$2.gmk \
142 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \
143 	          $$(addsuffix /$$($1_MAKE_SUBDIR), $$(PHASE_MAKEDIRS)) \
144 	      ) \
<span class="line-modified">145 	      MODULE=$2 \</span>
146 	  )
147         endif
148 
149 endef
150 
151 # Helper macro for DeclareRecipesForPhase
152 # Param 1: Name of list to add targets to
153 # Param 2: Module name
154 define DeclareRecipesForPhaseAndModule
155   $1_$2_MAKEFILES := $$(strip $$(wildcard \
156       $$(addsuffix /$$($1_MAKE_SUBDIR)/$$($1_FILE_PREFIX)-$2.gmk, $$(PHASE_MAKEDIRS))))
157 
158   # Only declare recipes if there are makefiles to call
159   ifneq ($$($1_$2_MAKEFILES), )
160     # Add the top dir specific target to target list regardless of if recipe
161     # generation is disabled.
162     ifeq ($$($1_MULTIPLE_MAKEFILES), true)
163       $$(foreach d, $$($1_$2_TOPDIRS), \
164         $$(eval $1 += $2-$$($1_TARGET_SUFFIX)-$$(notdir $$d)))
165     endif
166     ifeq ($(NO_RECIPES),)
167       $$(eval $$(call DeclareRecipeForModuleMakefile,$1,$2))
168     endif
169     $1 += $2-$$($1_TARGET_SUFFIX)
170     $1_MODULES += $2
171   endif
172 endef
173 
174 # Declare recipes for a specific module and build phase if there are makefiles
175 # present for the specific combination.
176 # Param 1: Name of list to add targets to
177 # Named params:
178 # TARGET_SUFFIX : Suffix of target to create for recipe
179 # MAKE_SUBDIR : Subdir for this build phase
180 # FILE_PREFIX : File prefix for this build phase
181 # USE_WRAPPER : Set to true to use ModuleWrapper.gmk
182 # CHECK_MODULES : List of modules to try
183 # MULTIPLE_MAKEFILES : Set to true to handle makefiles for the same module and
184 #                      phase in multiple repos

185 # Exported variables:
186 # $1_MODULES : All modules that had rules generated
187 # $1_TARGETS : All targets generated
188 define DeclareRecipesForPhase
<span class="line-modified">189   $(foreach i,2 3 4 5 6 7, $(if $(strip $($i)),$(strip $1)_$(strip $($i)))$(NEWLINE))</span>
<span class="line-modified">190   $(if $(8),$(error Internal makefile error: Too many arguments to \</span>
191       DeclareRecipesForPhase, please update MakeHelper.gmk))
192 
193   $$(foreach m, $$($(strip $1)_CHECK_MODULES), \
194       $$(eval $$(call DeclareRecipesForPhaseAndModule,$(strip $1),$$m)))
195 
196   $(strip $1)_TARGETS := $$($(strip $1))
197 endef
198 
199 ################################################################################
200 
201 endif # _MAINSUPPORT_GMK
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
116 
117 PHASE_MAKEDIRS := $(TOPDIR)/make
118 
119 # Helper macro for DeclareRecipesForPhase
120 # Declare a recipe for calling the module and phase specific makefile.
121 # If there are multiple makefiles to call, create a rule for each topdir
122 # that contains a makefile with the target $module-$suffix-$repodir,
123 # (i.e: java.base-gensrc-src)
124 # Normally there is only one makefile, and the target will just be
125 # $module-$suffix
126 # Param 1: Name of list to add targets to
127 # Param 2: Module name
128 define DeclareRecipeForModuleMakefile
129   $2-$$($1_TARGET_SUFFIX):
130         ifeq ($$($1_USE_WRAPPER), true)
131 	  +($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
132 	      -f ModuleWrapper.gmk \
133 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \
134 	          $$(addsuffix /$$($1_MAKE_SUBDIR), $$(PHASE_MAKEDIRS)) \
135 	      ) \
<span class="line-modified">136 	      MODULE=$2 MAKEFILE_PREFIX=$$($1_FILE_PREFIX) $$($1_EXTRA_ARGS))</span>
137         else
138 	  +($(CD) $$(dir $$(firstword $$(wildcard $$(addsuffix \
139 	      /$$($1_MAKE_SUBDIR)/$$($1_FILE_PREFIX)-$2.gmk, $$(PHASE_MAKEDIRS))))) \
140 	  &amp;&amp; $(MAKE) $(MAKE_ARGS) \
141 	      -f $$($1_FILE_PREFIX)-$2.gmk \
142 	      $$(addprefix -I, $$(PHASE_MAKEDIRS) \
143 	          $$(addsuffix /$$($1_MAKE_SUBDIR), $$(PHASE_MAKEDIRS)) \
144 	      ) \
<span class="line-modified">145 	      MODULE=$2 $$($1_EXTRA_ARGS) \</span>
146 	  )
147         endif
148 
149 endef
150 
151 # Helper macro for DeclareRecipesForPhase
152 # Param 1: Name of list to add targets to
153 # Param 2: Module name
154 define DeclareRecipesForPhaseAndModule
155   $1_$2_MAKEFILES := $$(strip $$(wildcard \
156       $$(addsuffix /$$($1_MAKE_SUBDIR)/$$($1_FILE_PREFIX)-$2.gmk, $$(PHASE_MAKEDIRS))))
157 
158   # Only declare recipes if there are makefiles to call
159   ifneq ($$($1_$2_MAKEFILES), )
160     # Add the top dir specific target to target list regardless of if recipe
161     # generation is disabled.
162     ifeq ($$($1_MULTIPLE_MAKEFILES), true)
163       $$(foreach d, $$($1_$2_TOPDIRS), \
164         $$(eval $1 += $2-$$($1_TARGET_SUFFIX)-$$(notdir $$d)))
165     endif
166     ifeq ($(NO_RECIPES),)
167       $$(eval $$(call DeclareRecipeForModuleMakefile,$1,$2))
168     endif
169     $1 += $2-$$($1_TARGET_SUFFIX)
170     $1_MODULES += $2
171   endif
172 endef
173 
174 # Declare recipes for a specific module and build phase if there are makefiles
175 # present for the specific combination.
176 # Param 1: Name of list to add targets to
177 # Named params:
178 # TARGET_SUFFIX : Suffix of target to create for recipe
179 # MAKE_SUBDIR : Subdir for this build phase
180 # FILE_PREFIX : File prefix for this build phase
181 # USE_WRAPPER : Set to true to use ModuleWrapper.gmk
182 # CHECK_MODULES : List of modules to try
183 # MULTIPLE_MAKEFILES : Set to true to handle makefiles for the same module and
184 #                      phase in multiple repos
<span class="line-added">185 # EXTRA_ARGS : Add extra make args to each makefile call</span>
186 # Exported variables:
187 # $1_MODULES : All modules that had rules generated
188 # $1_TARGETS : All targets generated
189 define DeclareRecipesForPhase
<span class="line-modified">190   $(foreach i,2 3 4 5 6 7 8, $(if $(strip $($i)),$(strip $1)_$(strip $($i)))$(NEWLINE))</span>
<span class="line-modified">191   $(if $(9),$(error Internal makefile error: Too many arguments to \</span>
192       DeclareRecipesForPhase, please update MakeHelper.gmk))
193 
194   $$(foreach m, $$($(strip $1)_CHECK_MODULES), \
195       $$(eval $$(call DeclareRecipesForPhaseAndModule,$(strip $1),$$m)))
196 
197   $(strip $1)_TARGETS := $$($(strip $1))
198 endef
199 
200 ################################################################################
201 
202 endif # _MAINSUPPORT_GMK
</pre>
</td>
</tr>
</table>
<center><a href="Main.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="ModuleWrapper.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>