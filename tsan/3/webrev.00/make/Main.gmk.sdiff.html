<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/Main.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="MacBundles.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="MainSupport.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/Main.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 #
<span class="line-modified">   2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  49 # valid top level targets. It&#39;s used to declare them all as PHONY and to
  50 # generate the -only targets.
  51 ALL_TARGETS :=
  52 
  53 # Hook to include the corresponding custom file, if present.
  54 $(eval $(call IncludeCustomExtension, Main.gmk))
  55 
  56 # All modules for the current target platform.
  57 ALL_MODULES := $(call FindAllModules)
  58 
  59 ################################################################################
  60 ################################################################################
  61 #
  62 # Recipes for all targets. Only recipes, dependencies are declared later.
  63 #
  64 ################################################################################
  65 
  66 ################################################################################
  67 # Interim/build tools targets, compiling tools used during the build
  68 
<span class="line-modified">  69 # When creating a BUILDJDK, the buildtools and interim targets have already</span>
<span class="line-removed">  70 # been built and should not be built again.</span>
<span class="line-removed">  71 ifneq ($(CREATING_BUILDJDK), true)</span>
<span class="line-removed">  72   buildtools-langtools:</span>
  73 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ToolsLangtools.gmk)
  74 
<span class="line-modified">  75   interim-langtools:</span>
  76 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimLangtools.gmk)
  77 
<span class="line-modified">  78   interim-rmic:</span>
  79 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimRmic.gmk)
  80 
<span class="line-modified">  81   interim-cldrconverter:</span>
<span class="line-modified">  82 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CopyInterimCLDRConverter.gmk)</span>
  83 
<span class="line-modified">  84   buildtools-jdk:</span>

  85 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsJdk.gmk)
  86 
<span class="line-modified">  87   buildtools-modules:</span>
  88 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileModuleTools.gmk)
  89 
<span class="line-modified">  90   buildtools-hotspot:</span>
  91 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsHotspot.gmk)
<span class="line-removed">  92 endif</span>
  93 
  94 ALL_TARGETS += buildtools-langtools interim-langtools \
<span class="line-modified">  95     interim-rmic interim-cldrconverter buildtools-jdk buildtools-modules \</span>
  96     buildtools-hotspot
  97 
  98 ################################################################################
  99 # Special targets for certain modules
 100 
 101 generate-exported-symbols:
 102 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildStatic.gmk)
 103 
 104 ALL_TARGETS += generate-exported-symbols
 105 
 106 ################################################################################
 107 # Gensrc targets, generating source before java compilation can be done
 108 #
<span class="line-modified"> 109 # When creating a BUILDJDK, the java targets have already been built and copied</span>
<span class="line-modified"> 110 # into the buildjdk so no need to generate sources.</span>
<span class="line-modified"> 111 ifneq ($(CREATING_BUILDJDK), true)</span>
<span class="line-modified"> 112   $(eval $(call DeclareRecipesForPhase, GENSRC, \</span>
<span class="line-modified"> 113       TARGET_SUFFIX := gensrc-src, \</span>
<span class="line-modified"> 114       FILE_PREFIX := Gensrc, \</span>
<span class="line-modified"> 115       MAKE_SUBDIR := gensrc, \</span>
<span class="line-modified"> 116       CHECK_MODULES := $(ALL_MODULES), \</span>
<span class="line-modified"> 117   ))</span>
<span class="line-modified"> 118 </span>
<span class="line-modified"> 119   $(foreach m, $(GENSRC_MODULES), $(eval $m-gensrc: $m-gensrc-src))</span>
<span class="line-modified"> 120 </span>
<span class="line-modified"> 121   LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, $(LANGTOOLS_MODULES)), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 122   INTERIM_LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, \</span>
<span class="line-modified"> 123       $(INTERIM_LANGTOOLS_BASE_MODULES)), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 124   HOTSPOT_GENSRC_TARGETS := $(filter $(addsuffix -%, $(HOTSPOT_MODULES)), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 125   JDK_GENSRC_TARGETS := $(filter-out $(LANGTOOLS_GENSRC_TARGETS) \</span>
<span class="line-modified"> 126       $(HOTSPOT_GENSRC_TARGETS), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 127 </span>
<span class="line-modified"> 128   GENSRC_MODULEINFO_MODULES := $(ALL_MODULES)</span>
<span class="line-modified"> 129   GENSRC_MODULEINFO_TARGETS := $(addsuffix -gensrc-moduleinfo, \</span>
<span class="line-modified"> 130       $(GENSRC_MODULEINFO_MODULES))</span>
<span class="line-modified"> 131 </span>
<span class="line-modified"> 132   GENSRC_MODULES := $(GENSRC_MODULEINFO_MODULES)</span>
<span class="line-modified"> 133   GENSRC_TARGETS += $(sort $(GENSRC_MODULEINFO_TARGETS) \</span>
<span class="line-modified"> 134       $(addsuffix -gensrc, $(GENSRC_MODULES)))</span>
<span class="line-removed"> 135 </span>
<span class="line-removed"> 136   define DeclareModuleInfoRecipe</span>
<span class="line-removed"> 137     $1-gensrc-moduleinfo:</span>
 138 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
<span class="line-modified"> 139 	    -f GensrcModuleInfo.gmk MODULE=$1)</span>
 140 
<span class="line-modified"> 141     $1-gensrc: $1-gensrc-moduleinfo</span>
<span class="line-modified"> 142   endef</span>
 143 
<span class="line-modified"> 144   $(foreach m, $(GENSRC_MODULEINFO_MODULES), $(eval $(call DeclareModuleInfoRecipe,$m)))</span>
<span class="line-removed"> 145 endif</span>
 146 
 147 ALL_TARGETS += $(GENSRC_TARGETS)
 148 
 149 ################################################################################
 150 # Generate data targets
 151 $(eval $(call DeclareRecipesForPhase, GENDATA, \
 152     TARGET_SUFFIX := gendata, \
 153     FILE_PREFIX := Gendata, \
 154     MAKE_SUBDIR := gendata, \
 155     CHECK_MODULES := $(ALL_MODULES), \
 156     USE_WRAPPER := true))
 157 
 158 ALL_TARGETS += $(GENDATA_TARGETS)
 159 
 160 ################################################################################
 161 # Copy files targets
 162 $(eval $(call DeclareRecipesForPhase, COPY, \
 163     TARGET_SUFFIX := copy, \
 164     FILE_PREFIX := Copy, \
 165     MAKE_SUBDIR := copy, \
</pre>
<hr />
<pre>
 204 # Targets for running rmic.
 205 $(eval $(call DeclareRecipesForPhase, RMIC, \
 206     TARGET_SUFFIX := rmic, \
 207     FILE_PREFIX := Rmic, \
 208     MAKE_SUBDIR := rmic, \
 209     CHECK_MODULES := $(ALL_MODULES)))
 210 
 211 ALL_TARGETS += $(RMIC_TARGETS)
 212 
 213 ################################################################################
 214 # Targets for compiling native libraries
 215 $(eval $(call DeclareRecipesForPhase, LIBS, \
 216     TARGET_SUFFIX := libs, \
 217     FILE_PREFIX := Lib, \
 218     MAKE_SUBDIR := lib, \
 219     CHECK_MODULES := $(ALL_MODULES), \
 220     USE_WRAPPER := true))
 221 
 222 ALL_TARGETS += $(LIBS_TARGETS)
 223 















 224 ################################################################################
 225 # Targets for compiling native executables
 226 $(eval $(call DeclareRecipesForPhase, LAUNCHER, \
 227     TARGET_SUFFIX := launchers, \
 228     FILE_PREFIX := Launcher, \
 229     MAKE_SUBDIR := launcher, \
 230     CHECK_MODULES := $(ALL_MODULES), \
 231     USE_WRAPPER := true))
 232 
 233 ALL_TARGETS += $(LAUNCHER_TARGETS)
 234 
 235 ################################################################################
 236 # Build hotspot target
 237 
 238 HOTSPOT_VARIANT_TARGETS := $(addprefix hotspot-, $(JVM_VARIANTS))
 239 HOTSPOT_VARIANT_GENSRC_TARGETS := $(addsuffix -gensrc, $(HOTSPOT_VARIANT_TARGETS))
 240 HOTSPOT_VARIANT_LIBS_TARGETS := $(addsuffix -libs, $(HOTSPOT_VARIANT_TARGETS))
 241 
 242 define DeclareHotspotGensrcRecipe
 243   hotspot-$1-gensrc:
</pre>
<hr />
<pre>
 270 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk $1-only \
 271 	    GENERATE_COMPILE_COMMANDS_ONLY=true)
 272 
 273   COMPILE_COMMANDS_TARGETS_$2 += $1-compile-commands
 274 endef
 275 
 276 $(foreach t, $(HOTSPOT_VARIANT_LIBS_TARGETS), \
 277   $(eval $(call DeclareCompileCommandsRecipe,$t,HOTSPOT)) \
 278 )
 279 
 280 $(foreach t, $(LIBS_TARGETS) $(LAUNCHER_TARGETS), \
 281   $(eval $(call DeclareCompileCommandsRecipe,$t,JDK)) \
 282 )
 283 
 284 compile-commands compile-commands-hotspot:
 285 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileCommands.gmk)
 286 
 287 ALL_TARGETS += $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
 288 ALL_TARGETS += compile-commands compile-commands-hotspot
 289 





















 290 ################################################################################
 291 # Build demos targets
 292 
 293 demos-jdk:
 294 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk)
 295 
 296 test-image-demos-jdk:
 297 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk images)
 298 
 299 ALL_TARGETS += demos-jdk test-image-demos-jdk
 300 
 301 ################################################################################
 302 # Jigsaw specific data and analysis targets.
 303 
 304 generate-summary:
 305 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateModuleSummary.gmk)
 306 
 307 ALL_TARGETS += generate-summary
 308 
 309 ################################################################################
</pre>
<hr />
<pre>
 318 	    MODULE=$1)
 319 endef
 320 
 321 $(foreach m, $(JMOD_MODULES), $(eval $(call DeclareJmodRecipe,$m)))
 322 
 323 ALL_TARGETS += $(JMOD_TARGETS)
 324 
 325 ################################################################################
 326 # Images targets
 327 
 328 store-source-revision:
 329 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk store-source-revision)
 330 
 331 create-source-revision-tracker:
 332 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk create-source-revision-tracker)
 333 
 334 BOOTCYCLE_TARGET := product-images
 335 bootcycle-images:
 336         ifneq ($(COMPILE_TYPE), cross)
 337 	  $(call LogWarn, Boot cycle build step 2: Building a new JDK image using previously built image)

 338 	  +$(MAKE) $(MAKE_ARGS) -f $(TOPDIR)/make/Init.gmk PARALLEL_TARGETS=$(BOOTCYCLE_TARGET) \
<span class="line-modified"> 339 	      JOBS= SPEC=$(dir $(SPEC))bootcycle-spec.gmk main</span>
 340         else
 341 	  $(call LogWarn, Boot cycle build disabled when cross compiling)
 342         endif
 343 
 344 zip-security:
 345 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSecurity.gmk)
 346 
 347 zip-source:
 348 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSource.gmk)
 349 
 350 jrtfs-jar:
 351 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JrtfsJar.gmk)
 352 
 353 jdk-image:
 354 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jdk)
 355 
 356 legacy-jre-image:
 357 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jre)
 358 
 359 symbols-image:
 360 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk symbols)
 361 



 362 mac-jdk-bundle:
 363 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jdk-bundle)
 364 
 365 mac-legacy-jre-bundle:
 366 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jre-bundle)
 367 
 368 release-file:
 369 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ReleaseFile.gmk)
 370 
 371 exploded-image-optimize:
 372 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ExplodedImageOptimize.gmk)
 373 



 374 ifeq ($(JCOV_ENABLED), true)
 375   jcov-image:
 376 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Coverage.gmk jcov-image)
 377 endif
 378 
 379 ALL_TARGETS += store-source-revision create-source-revision-tracker bootcycle-images zip-security \
 380     zip-source jrtfs-jar jdk-image legacy-jre-image \
<span class="line-modified"> 381     symbols-image mac-jdk-bundle mac-legacy-jre-bundle \</span>
<span class="line-modified"> 382     release-file exploded-image-optimize jcov-image</span>
 383 
 384 ################################################################################
 385 # Docs targets
 386 
 387 # If building full docs, to complete docs-*-api we need both the javadoc and
 388 # modulegraph targets.
 389 docs-jdk-api-javadoc:
 390 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-javadoc)
 391 
 392 docs-jdk-api-modulegraph:
 393 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-modulegraph)
 394 
 395 docs-javase-api-javadoc:
 396 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-javadoc)
 397 
 398 docs-javase-api-modulegraph:
 399 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-modulegraph)
 400 
 401 docs-reference-api-javadoc:
 402 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-javadoc)
 403 
 404 docs-reference-api-modulegraph:
 405 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-modulegraph)
 406 
 407 docs-jdk-specs:
 408 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-specs)
 409 
 410 docs-jdk-index:
 411 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-index)
 412 
 413 docs-zip:
 414 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-zip)
 415 



 416 update-build-docs:
 417 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateBuildDocs.gmk)
 418 
 419 update-x11wrappers:
 420 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateX11Wrappers.gmk)
 421 
 422 ALL_TARGETS += docs-jdk-api-javadoc docs-jdk-api-modulegraph \
 423     docs-javase-api-javadoc docs-javase-api-modulegraph \
 424     docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \
<span class="line-modified"> 425     docs-jdk-index docs-zip update-build-docs update-x11wrappers</span>
 426 
 427 ################################################################################
 428 # Cross compilation support
 429 
 430 ifeq ($(CREATING_BUILDJDK), true)
 431   # This target is only called by the recursive call below.
 432   create-buildjdk-interim-image-helper: interim-image jdk.jlink-launchers \
 433       java.base-copy jdk.jdeps-launchers
 434 endif
 435 
<span class="line-modified"> 436 create-buildjdk-copy:</span>
<span class="line-modified"> 437 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateBuildJdkCopy.gmk)</span>
 438 
 439 create-buildjdk-interim-image:
 440 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk \
 441 	    $@-helper \
 442 	    SPEC=$(dir $(SPEC))buildjdk-spec.gmk \
 443 	    HOTSPOT_SPEC=$(dir $(SPEC))buildjdk-spec.gmk \
<span class="line-modified"> 444 	    CREATING_BUILDJDK=true)</span>



 445 
 446 ALL_TARGETS += create-buildjdk-copy create-buildjdk-interim-image
 447 
 448 ################################################################################
 449 # The interim-image is a small jlinked image that is used to generate artifacts
 450 # at build time for use when linking the real images.
 451 
 452 INTERIM_JMOD_TARGETS := $(addsuffix -interim-jmod, $(INTERIM_IMAGE_MODULES))
 453 
 454 define DeclareInterimJmodRecipe
 455   $1-interim-jmod:
 456 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 457 	    MODULE=$1 \
 458 	    JMODS_DIR=$(INTERIM_JMODS_DIR) \
 459 	    JMODS_SUPPORT_DIR=$(INTERIM_JMODS_DIR)/support \
 460 	    INTERIM_JMOD=true \
 461 	)
 462 endef
 463 
 464 $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $(call DeclareInterimJmodRecipe,$m)))
</pre>
<hr />
<pre>
 564 test:
 565 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 566 	    TEST=&quot;$(TEST)&quot;)
 567 
 568 exploded-test:
 569 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 570 	    TEST=&quot;$(TEST)&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))
 571 
 572 jcov-test:
 573 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 574 	    TEST=&quot;$(TEST)&quot; TEST_OPTS_JCOV=true)
 575 
 576 ALL_TARGETS += test exploded-test jcov-test
 577 
 578 ################################################################################
 579 # Bundles
 580 
 581 product-bundles:
 582 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk product-bundles)
 583 



 584 test-bundles:
 585 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk test-bundles)
 586 
 587 docs-bundles:
 588 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk docs-bundles)
 589 



 590 ifeq ($(JCOV_ENABLED), true)
 591   jcov-bundles:
 592 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk jcov-bundles)
 593 endif
 594 
<span class="line-modified"> 595 ALL_TARGETS += product-bundles test-bundles docs-bundles jcov-bundles</span>

 596 
 597 ################################################################################
 598 # Install targets
 599 
 600 install:
 601 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Install.gmk)
 602 
 603 ALL_TARGETS += install
 604 
 605 ################################################################################
 606 #
 607 # Dependency declarations between targets.
 608 #
 609 # These are declared in two groups. First all dependencies between targets that
 610 # have recipes above as these dependencies may be disabled. Then the aggregator
 611 # targets that do not have recipes of their own, which will never have their
 612 # dependencies disabled.
 613 #
 614 ################################################################################
 615 # Targets with recipes above
 616 
 617 # If running an *-only target, parallel execution and dependencies between
 618 # recipe targets are disabled. This makes it possible to run a select set of
 619 # recipe targets in order. It&#39;s the responsibility of the user to make sure
 620 # all prerequisites are fulfilled.
 621 ifneq ($(findstring -only, $(MAKECMDGOALS)), )
 622   .NOTPARALLEL:
 623 else
 624   $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
 625 
 626   interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
 627 
<span class="line-modified"> 628   buildtools-jdk: interim-langtools interim-cldrconverter</span>
 629 
 630   buildtools-hotspot: interim-langtools
 631 
 632   buildtools-modules: exploded-image-base
 633 
 634   $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
 635 
 636   $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
 637 
 638   $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
 639 
 640   $(GENDATA_TARGETS): interim-langtools buildtools-jdk
 641 
 642   interim-rmic: interim-langtools
 643 
 644   $(RMIC_TARGETS): interim-langtools interim-rmic
 645 
 646   $(JAVA_TARGETS): interim-langtools
 647 
 648   # Declare dependencies between hotspot-&lt;variant&gt;* targets
 649   $(foreach v, $(JVM_VARIANTS), \
<span class="line-removed"> 650       $(eval hotspot-$v: hotspot-$v-gensrc hotspot-$v-libs) \</span>
 651       $(eval hotspot-$v-gensrc: java.base-copy) \
 652       $(eval hotspot-$v-libs: hotspot-$v-gensrc java.base-copy) \
 653   )
 654 
 655   hotspot-ide-project: hotspot exploded-image
 656 
 657   generate-exported-symbols: java.base-libs jdk.jdwp.agent-libs
 658 
 659   # If not already set, set the JVM variant target so that the JVM will be built.
 660   JVM_MAIN_LIB_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-libs
 661 
 662   # Building one JVM variant is enough to start building the other libs
 663   $(LIBS_TARGETS): $(JVM_MAIN_LIB_TARGETS)
 664 
 665   $(LAUNCHER_TARGETS): java.base-libs
 666 
 667   ifeq ($(STATIC_BUILD), true)
 668     $(LAUNCHER_TARGETS): generate-exported-symbols
 669   endif
 670 
 671   # The demos are currently linking to libjvm and libjava, just like all other
 672   # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they
 673   # aren&#39;t built until after libjava and libjvm are available to link to.
<span class="line-modified"> 674   demos-jdk: java.base-libs exploded-image-optimize</span>
 675   test-image-demos-jdk: demos-jdk
 676 
 677   # Declare dependency from &lt;module&gt;-java to &lt;module&gt;-gensrc
 678   $(foreach m, $(GENSRC_MODULES), $(eval $m-java: $m-gensrc))
 679 
 680   # Declare dependencies between java modules
 681   $(foreach m, $(JAVA_MODULES), \
 682       $(eval $m-java: $(addsuffix -java, $(filter $(JAVA_MODULES), \
 683       $(call FindDepsForModule,$m)))))


 684 
 685   # Declare dependencies between &lt;module&gt;-rmic to &lt;module&gt;-java
 686   $(foreach m, $(RMIC_MODULES), $(eval $m-rmic: $m-java))
 687 
 688   # Declare dependencies from &lt;module&gt;-lib to &lt;module&gt;-java
 689   # Skip modules that do not have java source.
<span class="line-modified"> 690   # When creating a BUILDJDK, the java compilation has already been done by the</span>
<span class="line-removed"> 691   # normal build and copied in.</span>
<span class="line-removed"> 692   ifneq ($(CREATING_BUILDJDK), true)</span>
<span class="line-removed"> 693     $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs: $m-java))</span>
<span class="line-removed"> 694   endif</span>
 695 
 696   # Declare dependencies from all other &lt;module&gt;-lib to java.base-lib
 697   $(foreach t, $(filter-out java.base-libs, $(LIBS_TARGETS)), \
 698       $(eval $t: java.base-libs))
 699 
 700   # jdk.accessibility depends on java.desktop
 701   jdk.accessibility-libs: java.desktop-libs
 702 
 703   # This dependency needs to be explicitly declared. jdk.jdi-gensrc generates a
 704   # header file used by jdk.jdwp.agent-libs. The jdk.jdwp.agent-gensrc is a
 705   # virtual target.
 706   jdk.jdwp.agent-libs: jdk.jdwp.agent-gensrc
 707 
 708   # The swing beans need to have java base properly generated to avoid errors
 709   # in javadoc. The X11 wrappers need the java.base include files to have been
 710   # copied and processed.
 711   java.desktop-gensrc-src: java.base-gensrc java.base-copy
 712 
 713   # The annotation processing for jdk.internal.vm.compiler
 714   # and jdk.internal.vm.compiler.management needs classes from the current JDK.
 715   jdk.internal.vm.compiler-gensrc-src: $(addsuffix -java, \
 716       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler))
 717   jdk.internal.vm.compiler.management-gensrc-src: $(addsuffix -java, \
 718       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler.management))
 719 
 720   # For these modules, the gensrc step is generating a module-info.java.extra
 721   # file to be processed by the gensrc-moduleinfo target.
 722   jdk.internal.vm.compiler-gensrc-moduleinfo: jdk.internal.vm.compiler-gensrc-src
 723   jdk.internal.vm.compiler.management-gensrc-moduleinfo: jdk.internal.vm.compiler.management-gensrc-src
 724 
 725   jdk.jdeps-gendata: java rmic
 726 
 727   # The ct.sym generation uses all the moduleinfos as input
 728   jdk.compiler-gendata: $(GENSRC_MODULEINFO_TARGETS)
 729 
 730   # Declare dependencies between jmod targets.
 731   # java.base jmod needs jrt-fs.jar and access to the other jmods to be built.
<span class="line-modified"> 732   # When creating a BUILDJDK, we don&#39;t need to add hashes to java.base, thus</span>
 733   # we don&#39;t need to depend on all other jmods
 734   ifneq ($(CREATING_BUILDJDK), true)
 735     java.base-jmod: jrtfs-jar $(filter-out java.base-jmod, $(JMOD_TARGETS))
 736   endif
 737 
 738   # If not already set, set the JVM target so that the JVM will be built.
 739   JVM_MAIN_TARGETS ?= hotspot
 740 
 741   # Building java.base-jmod requires all of VM (ie hotspot) to be built.
 742   java.base-jmod: $(JVM_MAIN_TARGETS)
 743 
 744   # Declare dependencies from &lt;module&gt;-jmod to all other module targets
<span class="line-modified"> 745   # When creating a BUILDJDK, the java compilation has already been done by the</span>
<span class="line-removed"> 746   # normal build and copied in.</span>
<span class="line-removed"> 747   ifneq ($(CREATING_BUILDJDK), true)</span>
<span class="line-removed"> 748     $(foreach m, $(JAVA_MODULES), $(eval $m_JMOD_DEPS += $m-java))</span>
<span class="line-removed"> 749   endif</span>
 750   $(foreach m, $(GENDATA_MODULES), $(eval $m_JMOD_DEPS += $m-gendata))
 751   $(foreach m, $(RMIC_MODULES), $(eval $m_JMOD_DEPS += $m-rmic))
 752   $(foreach m, $(LIBS_MODULES), $(eval $m_JMOD_DEPS += $m-libs))
 753   $(foreach m, $(LAUNCHER_MODULES), $(eval $m_JMOD_DEPS += $m-launchers))
 754   $(foreach m, $(COPY_MODULES), $(eval $m_JMOD_DEPS += $m-copy))
 755   $(foreach m, $(ALL_MODULES), $(eval $m-jmod: $($(m)_JMOD_DEPS)))
 756   $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $m-interim-jmod: $($(m)_JMOD_DEPS)))
 757 
 758   # Setup the minimal set of generated native source dependencies for hotspot
 759   $(foreach v, $(JVM_VARIANTS), \
 760     $(eval hotspot-$v-libs-compile-commands: hotspot-$v-gensrc) \
 761     $(foreach m, $(filter java.desktop jdk.hotspot.agent, $(GENSRC_MODULES)), \
 762       $(eval hotspot-$v-libs-compile-commands: $m-gensrc)) \
 763   )
 764 
 765   # For the full JDK compile commands, create all possible generated sources
 766   $(foreach m, $(GENSRC_MODULES), $(eval $m-libs-compile-commands: $m-gensrc))
 767   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs-compile-commands: $m-java))
 768 
 769   $(COMPILE_COMMANDS_TARGETS_HOTSPOT): clean-compile-commands
 770   $(COMPILE_COMMANDS_TARGETS_JDK): clean-compile-commands
 771   compile-commands-hotspot: $(COMPILE_COMMANDS_TARGETS_HOTSPOT)
 772   compile-commands: $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
 773 









 774   # Jmods cannot be created until we have the jmod tool ready to run. During
 775   # a normal build we run it from the exploded image, but when cross compiling
 776   # it&#39;s run from the buildjdk, which is either created at build time or user
 777   # supplied.
<span class="line-removed"> 778   #</span>
<span class="line-removed"> 779   # For the exploded image to be runnable, all java modules and</span>
<span class="line-removed"> 780   # jdk.jlink-launchers need to be built. We also need to copy jvm.cfg (done</span>
<span class="line-removed"> 781   # in java.base-copy) and tzdb.dat (done in java.base-gendata) to the</span>
<span class="line-removed"> 782   # appropriate location otherwise jimage, jlink and jmod won&#39;t start. This</span>
<span class="line-removed"> 783   # also applies when creating the buildjdk.</span>
<span class="line-removed"> 784   DEFAULT_JMOD_DEPS += java.base-libs java.base-copy java.base-gendata \</span>
<span class="line-removed"> 785       jdk.jlink-launchers</span>
<span class="line-removed"> 786   # When cross compiling and buildjdk is to be created, depend on creating the</span>
<span class="line-removed"> 787   # buildjdk instead of the default dependencies.</span>
 788   ifeq ($(CREATE_BUILDJDK), true)
<span class="line-removed"> 789     # Avoid calling create-buildjdk from within a create-buildjdk call.</span>
 790     ifneq ($(CREATING_BUILDJDK), true)


 791       $(JMOD_TARGETS): create-buildjdk
 792       buildtools-modules: create-buildjdk
 793     else
<span class="line-modified"> 794       # While actually creating the buildjdk, the default deps applies.</span>
<span class="line-modified"> 795       $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): $(DEFAULT_JMOD_DEPS)</span>








 796     endif
 797   else
<span class="line-modified"> 798     # The normal non cross compilation case uses the default deps.</span>
<span class="line-modified"> 799     # To avoid races with the optimize target, that also needs to happen first.</span>
<span class="line-modified"> 800     $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): $(DEFAULT_JMOD_DEPS) \</span>
<span class="line-removed"> 801         exploded-image-optimize</span>
 802   endif
 803 
 804   # All modules include the main license files from java.base.
 805   $(JMOD_TARGETS): java.base-copy
 806 
 807   zip-security: java.base-java java.security.jgss-java java.security.jgss-libs \
 808       $(filter jdk.crypto%, $(JAVA_TARGETS))
 809 
 810   zip-source: gensrc rmic
 811 
 812   jrtfs-jar: interim-langtools
 813 
 814   build-microbenchmark: interim-langtools exploded-image
 815 
 816   ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
 817     ifeq ($(CREATE_BUILDJDK), true)
 818       # If creating a buildjdk, the interim image needs to be based on that.
 819       generate-link-opt-data: create-buildjdk
 820     else ifeq ($(EXTERNAL_BUILDJDK), false)
 821       # If an external buildjdk has been provided, we skip generating an
 822       # interim-image and just use the external buildjdk for generating
 823       # classlist.
 824       generate-link-opt-data: interim-image
 825     endif
 826     generate-link-opt-data: buildtools-jdk
 827 
 828     # The generated classlist needs to go into java.base-jmod.
 829     java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
 830   endif
 831 
 832   release-file: create-source-revision-tracker
 833 
 834   jdk-image: jmods zip-source demos release-file
 835   legacy-jre-image: jmods release-file
 836   symbols-image: $(LIBS_TARGETS) $(LAUNCHER_TARGETS)
 837 




 838   mac-jdk-bundle: jdk-image
 839   mac-legacy-jre-bundle: legacy-jre-image
 840 
 841   ifeq ($(JCOV_INPUT_JDK), )
 842     jcov-image: jdk-image
 843   endif
 844 
 845   # The optimize target can run as soon as the modules dir has been completely
 846   # populated (java, copy and gendata targets) and the basic libs and launchers
 847   # have been built.
 848   exploded-image-optimize: java copy gendata java.base-libs java.base-launchers \
 849       buildtools-modules
 850 
 851   bootcycle-images: jdk-image
 852 
 853   docs-jdk-api-javadoc: $(GENSRC_TARGETS) rmic
 854 
 855   docs-javase-api-javadoc: $(GENSRC_TARGETS) rmic
 856 
 857   docs-reference-api-javadoc: $(GENSRC_TARGETS) rmic
 858 
 859   docs-jdk-api-modulegraph: exploded-image buildtools-modules
 860 
 861   docs-javase-api-modulegraph: exploded-image buildtools-modules
 862 
 863   docs-reference-api-modulegraph: exploded-image buildtools-modules
 864 
 865   # If not already set, then set the JVM specific docs targets
 866   JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
 867 
 868   # The gensrc steps for hotspot and jdk.jdi create html spec files.
<span class="line-modified"> 869   docs-jdk-specs: $(JVM_DOCS_TARGETS) jdk.jdi-gensrc \</span>
 870       docs-jdk-index
 871 
 872   docs-zip: docs-jdk
 873 


 874   # Tests
 875   test: jdk-image test-image
 876 
 877   exploded-test: exploded-image test-image
 878 
 879   jcov-test: jcov-image test-image
 880 
 881   test-make: clean-test-make compile-commands
 882 
 883   test-make-compile-commands: compile-commands
 884 
 885   # Declare dependency for all generated test targets
 886   $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image))
 887   $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image))
 888 
<span class="line-removed"> 889   create-buildjdk-copy: jdk.jlink-java java.base-gendata \</span>
<span class="line-removed"> 890       $(addsuffix -java, $(INTERIM_IMAGE_MODULES))</span>
<span class="line-removed"> 891 </span>
<span class="line-removed"> 892   create-buildjdk-interim-image: create-buildjdk-copy</span>
<span class="line-removed"> 893 </span>
 894   interim-image: $(INTERIM_JMOD_TARGETS)
 895 
<span class="line-modified"> 896   build-test-lib: exploded-image-optimize</span>
 897 
 898   build-test-failure-handler: interim-langtools
 899 
 900   test-image-failure-handler: build-test-failure-handler
 901 
 902   build-test-hotspot-jtreg-native: buildtools-jdk \
 903       hotspot-$(JVM_VARIANT_MAIN)-libs
 904 
 905   build-test-jdk-jtreg-native: buildtools-jdk java.base-libs
 906 
<span class="line-modified"> 907   build-test-hotspot-jtreg-graal: exploded-image-optimize</span>
 908 
 909   test-image-hotspot-jtreg-native: build-test-hotspot-jtreg-native
 910 
 911   test-image-jdk-jtreg-native: build-test-jdk-jtreg-native
 912 
 913   test-image-hotspot-jtreg-graal: build-test-hotspot-jtreg-graal
 914 
 915   test-image-hotspot-gtest: hotspot
 916 
 917   install: product-images
 918 
 919   product-bundles: product-images
 920 


 921   test-bundles: test-image
 922 
 923   docs-bundles: docs-image
 924 
 925   jcov-bundles: jcov-image
 926 


 927   generate-summary: jmods buildtools-modules
 928 
 929   update-x11wrappers: java.base-copy buildtools-jdk
 930 
 931 endif
 932 
 933 ################################################################################
 934 # Virtual targets without recipes
 935 
 936 # If not already set, set the JVM specific tools targets
 937 JVM_TOOLS_TARGETS ?= buildtools-hotspot
 938 buildtools: buildtools-langtools interim-langtools interim-rmic \
 939     buildtools-jdk $(JVM_TOOLS_TARGETS)
 940 




 941 hotspot: $(HOTSPOT_VARIANT_TARGETS)
 942 
 943 # Create targets hotspot-libs and hotspot-gensrc.
 944 $(foreach v, $(JVM_VARIANTS), \
 945   $(eval hotspot-libs: hotspot-$v-libs) \
 946   $(eval hotspot-gensrc: hotspot-$v-gensrc) \
 947 )
 948 
 949 gensrc: $(GENSRC_TARGETS)
 950 
 951 gendata: $(GENDATA_TARGETS)
 952 
 953 copy: $(ALL_COPY_TARGETS)
 954 
 955 java: $(JAVA_TARGETS)
 956 
 957 rmic: $(RMIC_TARGETS)
 958 
 959 libs: $(LIBS_TARGETS)
 960 


 961 launchers: $(LAUNCHER_TARGETS)
 962 
 963 jmods: $(JMOD_TARGETS)
 964 
 965 # Explicitly declare dependency for virtual target jdk.jdwp.agent-gensrc which
 966 # is actually handled by jdk.jdi-gensrc
 967 jdk.jdwp.agent-gensrc: jdk.jdi-gensrc
 968 
 969 # Declare dependencies from &lt;module&gt; to all the individual targets specific
 970 # to that module &lt;module&gt;-*, that are needed for the exploded image.
 971 $(foreach m, $(GENSRC_MODULES), $(eval $m: $m-gensrc))
 972 $(foreach m, $(JAVA_MODULES), $(eval $m: $m-java))
 973 $(foreach m, $(GENDATA_MODULES), $(eval $m: $m-gendata))
 974 $(foreach m, $(RMIC_MODULES), $(eval $m: $m-rmic))
 975 $(foreach m, $(LIBS_MODULES), $(eval $m: $m-libs))
 976 $(foreach m, $(LAUNCHER_MODULES), $(eval $m: $m-launchers))
 977 $(foreach m, $(ALL_COPY_MODULES), $(eval $m: $m-copy))
 978 
 979 # Building java.base includes building all of hotspot.
 980 java.base: $(JVM_MAIN_TARGETS)
 981 
 982 demos: demos-jdk
 983 
 984 # The &quot;exploded image&quot; is a locally runnable JDK in $(OUTPUTDIR)/jdk.
 985 exploded-image-base: $(ALL_MODULES)
 986 exploded-image: exploded-image-base release-file
 987 # When cross compiling, no need to optimize the exploded image since it won&#39;t
 988 # be runnable on the host platform anyway.
 989 ifneq ($(COMPILE_TYPE), cross)
 990   exploded-image: exploded-image-optimize
 991 endif
 992 
<span class="line-modified"> 993 create-buildjdk: create-buildjdk-copy create-buildjdk-interim-image</span>
 994 
 995 docs-jdk-api: docs-jdk-api-javadoc
 996 docs-javase-api: docs-javase-api-javadoc
 997 docs-reference-api: docs-reference-api-javadoc
 998 
 999 # If we&#39;re building full docs, we must also generate the module graphs to
1000 # get non-broken api documentation.
1001 ifeq ($(ENABLE_FULL_DOCS), true)
1002   docs-jdk-api: docs-jdk-api-modulegraph
1003   docs-javase-api: docs-javase-api-modulegraph
1004   docs-reference-api: docs-reference-api-modulegraph
1005 endif
1006 
1007 docs-jdk: docs-jdk-api docs-jdk-specs docs-jdk-index
1008 docs-javase: docs-javase-api
1009 docs-reference: docs-reference-api
1010 
1011 # alias for backwards compatibility
1012 docs-javadoc: docs-jdk-api
1013 
1014 mac-bundles: mac-jdk-bundle
1015 
1016 # The $(OUTPUTDIR)/images directory contain the resulting deliverables,
1017 # and in line with this, our targets for creating these are named *-image[s].
1018 
1019 # This target builds the product images, e.g. the JDK image
1020 # (and possibly other, more specific versions)
1021 product-images: jdk-image symbols-image exploded-image
1022 



1023 # zip-security is actually a bundle, but for now it needs to be considered
1024 # an image until this can be cleaned up properly.
1025 product-images: zip-security
1026 
1027 # The module summary cannot be run when:
1028 # * Cross compiling and building a partial BUILDJDK for the build host
1029 # * An external buildjdk has been supplied since it may not match the
1030 #   module selection of the target jdk
1031 ifneq ($(CREATE_BUILDJDK), true)
1032   ifeq ($(EXTERNAL_BUILDJDK), false)
1033     product-images: generate-summary
1034   endif
1035 endif
1036 
1037 ifeq ($(call isTargetOs, macosx), true)
1038   product-images: mac-jdk-bundle


1039 endif
1040 
1041 # This target builds the documentation image
1042 docs-image: docs-jdk
1043 
1044 # If not already set, set the JVM specific targets to build the test image
1045 JVM_TEST_IMAGE_TARGETS ?= test-image-hotspot-jtreg-native test-image-hotspot-gtest
1046 
1047 ifeq ($(INCLUDE_GRAAL), true)
1048   JVM_TEST_IMAGE_TARGETS += test-image-hotspot-jtreg-graal
1049 endif
1050 
1051 # This target builds the test image
1052 test-image: prepare-test-image \
1053     test-image-jdk-jtreg-native test-image-failure-handler \
1054     test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
1055 
1056 ifneq ($(JMH_CORE_JAR), )
1057   test-image: build-microbenchmark
1058 endif
1059 
1060 ################################################################################
1061 
1062 # all-images builds all our deliverables as images.
1063 all-images: product-images test-image docs-image
1064 
1065 # all-bundles packages all our deliverables as tar.gz bundles.
<span class="line-modified">1066 all-bundles: product-bundles test-bundles docs-bundles</span>
1067 
1068 ALL_TARGETS += buildtools hotspot hotspot-libs hotspot-gensrc gensrc gendata \
<span class="line-modified">1069     copy java rmic libs launchers jmods \</span>
1070     jdk.jdwp.agent-gensrc $(ALL_MODULES) demos \
1071     exploded-image-base exploded-image \
1072     create-buildjdk docs-jdk-api docs-javase-api docs-reference-api docs-jdk \
<span class="line-modified">1073     docs-javase docs-reference docs-javadoc mac-bundles product-images \</span>
1074     docs-image test-image all-images \
1075     all-bundles
1076 
1077 ################################################################################
1078 
1079 # Traditional targets typically run by users.
1080 # These can be considered aliases for the targets now named by a more
1081 # &quot;modern&quot; naming scheme.
1082 default: $(DEFAULT_MAKE_TARGET)
1083 jdk: exploded-image
1084 images: product-images
1085 docs: docs-image
1086 bundles: all-bundles
1087 all: all-images
1088 
1089 ALL_TARGETS += default jdk images docs bundles all
1090 
1091 # Aliases used for running tests.
1092 
1093 # Let &quot;run-test&quot; be an alias for &quot;test&quot;
</pre>
</td>
<td>
<hr />
<pre>
   1 #
<span class="line-modified">   2 # Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  49 # valid top level targets. It&#39;s used to declare them all as PHONY and to
  50 # generate the -only targets.
  51 ALL_TARGETS :=
  52 
  53 # Hook to include the corresponding custom file, if present.
  54 $(eval $(call IncludeCustomExtension, Main.gmk))
  55 
  56 # All modules for the current target platform.
  57 ALL_MODULES := $(call FindAllModules)
  58 
  59 ################################################################################
  60 ################################################################################
  61 #
  62 # Recipes for all targets. Only recipes, dependencies are declared later.
  63 #
  64 ################################################################################
  65 
  66 ################################################################################
  67 # Interim/build tools targets, compiling tools used during the build
  68 
<span class="line-modified">  69 buildtools-langtools:</span>



  70 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ToolsLangtools.gmk)
  71 
<span class="line-modified">  72 interim-langtools:</span>
  73 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimLangtools.gmk)
  74 
<span class="line-modified">  75 interim-rmic:</span>
  76 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimRmic.gmk)
  77 
<span class="line-modified">  78 interim-tzdb:</span>
<span class="line-modified">  79 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CopyInterimTZDB.gmk)</span>
  80 
<span class="line-modified">  81 </span>
<span class="line-added">  82 buildtools-jdk:</span>
  83 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsJdk.gmk)
  84 
<span class="line-modified">  85 buildtools-modules:</span>
  86 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileModuleTools.gmk)
  87 
<span class="line-modified">  88 buildtools-hotspot:</span>
  89 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsHotspot.gmk)

  90 
  91 ALL_TARGETS += buildtools-langtools interim-langtools \
<span class="line-modified">  92     interim-rmic interim-tzdb buildtools-jdk buildtools-modules \</span>
  93     buildtools-hotspot
  94 
  95 ################################################################################
  96 # Special targets for certain modules
  97 
  98 generate-exported-symbols:
  99 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildStatic.gmk)
 100 
 101 ALL_TARGETS += generate-exported-symbols
 102 
 103 ################################################################################
 104 # Gensrc targets, generating source before java compilation can be done
 105 #
<span class="line-modified"> 106 $(eval $(call DeclareRecipesForPhase, GENSRC, \</span>
<span class="line-modified"> 107     TARGET_SUFFIX := gensrc-src, \</span>
<span class="line-modified"> 108     FILE_PREFIX := Gensrc, \</span>
<span class="line-modified"> 109     MAKE_SUBDIR := gensrc, \</span>
<span class="line-modified"> 110     CHECK_MODULES := $(ALL_MODULES), \</span>
<span class="line-modified"> 111 ))</span>
<span class="line-modified"> 112 </span>
<span class="line-modified"> 113 $(foreach m, $(GENSRC_MODULES), $(eval $m-gensrc: $m-gensrc-src))</span>
<span class="line-modified"> 114 </span>
<span class="line-modified"> 115 LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, $(LANGTOOLS_MODULES)), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 116 INTERIM_LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, \</span>
<span class="line-modified"> 117     $(INTERIM_LANGTOOLS_BASE_MODULES)), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 118 HOTSPOT_GENSRC_TARGETS := $(filter $(addsuffix -%, $(HOTSPOT_MODULES)), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 119 JDK_GENSRC_TARGETS := $(filter-out $(LANGTOOLS_GENSRC_TARGETS) \</span>
<span class="line-modified"> 120     $(HOTSPOT_GENSRC_TARGETS), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 121 </span>
<span class="line-modified"> 122 GENSRC_MODULEINFO_MODULES := $(ALL_MODULES)</span>
<span class="line-modified"> 123 GENSRC_MODULEINFO_TARGETS := $(addsuffix -gensrc-moduleinfo, \</span>
<span class="line-modified"> 124     $(GENSRC_MODULEINFO_MODULES))</span>
<span class="line-modified"> 125 </span>
<span class="line-modified"> 126 GENSRC_MODULES := $(GENSRC_MODULEINFO_MODULES)</span>
<span class="line-modified"> 127 GENSRC_TARGETS += $(sort $(GENSRC_MODULEINFO_TARGETS) \</span>
<span class="line-modified"> 128     $(addsuffix -gensrc, $(GENSRC_MODULES)))</span>
<span class="line-modified"> 129 </span>
<span class="line-modified"> 130 define DeclareModuleInfoRecipe</span>
<span class="line-modified"> 131   $1-gensrc-moduleinfo:</span>



 132 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
<span class="line-modified"> 133 	    -f gensrc/GensrcModuleInfo.gmk MODULE=$1)</span>
 134 
<span class="line-modified"> 135   $1-gensrc: $1-gensrc-moduleinfo</span>
<span class="line-modified"> 136 endef</span>
 137 
<span class="line-modified"> 138 $(foreach m, $(GENSRC_MODULEINFO_MODULES), $(eval $(call DeclareModuleInfoRecipe,$m)))</span>

 139 
 140 ALL_TARGETS += $(GENSRC_TARGETS)
 141 
 142 ################################################################################
 143 # Generate data targets
 144 $(eval $(call DeclareRecipesForPhase, GENDATA, \
 145     TARGET_SUFFIX := gendata, \
 146     FILE_PREFIX := Gendata, \
 147     MAKE_SUBDIR := gendata, \
 148     CHECK_MODULES := $(ALL_MODULES), \
 149     USE_WRAPPER := true))
 150 
 151 ALL_TARGETS += $(GENDATA_TARGETS)
 152 
 153 ################################################################################
 154 # Copy files targets
 155 $(eval $(call DeclareRecipesForPhase, COPY, \
 156     TARGET_SUFFIX := copy, \
 157     FILE_PREFIX := Copy, \
 158     MAKE_SUBDIR := copy, \
</pre>
<hr />
<pre>
 197 # Targets for running rmic.
 198 $(eval $(call DeclareRecipesForPhase, RMIC, \
 199     TARGET_SUFFIX := rmic, \
 200     FILE_PREFIX := Rmic, \
 201     MAKE_SUBDIR := rmic, \
 202     CHECK_MODULES := $(ALL_MODULES)))
 203 
 204 ALL_TARGETS += $(RMIC_TARGETS)
 205 
 206 ################################################################################
 207 # Targets for compiling native libraries
 208 $(eval $(call DeclareRecipesForPhase, LIBS, \
 209     TARGET_SUFFIX := libs, \
 210     FILE_PREFIX := Lib, \
 211     MAKE_SUBDIR := lib, \
 212     CHECK_MODULES := $(ALL_MODULES), \
 213     USE_WRAPPER := true))
 214 
 215 ALL_TARGETS += $(LIBS_TARGETS)
 216 
<span class="line-added"> 217 ################################################################################</span>
<span class="line-added"> 218 # Targets for compiling static versions of certain native libraries. These do</span>
<span class="line-added"> 219 # not end up in the jmods or the normal JDK image, but are instead bundled into</span>
<span class="line-added"> 220 # a special deliverable.</span>
<span class="line-added"> 221 $(eval $(call DeclareRecipesForPhase, STATIC_LIBS, \</span>
<span class="line-added"> 222     TARGET_SUFFIX := static-libs, \</span>
<span class="line-added"> 223     FILE_PREFIX := Lib, \</span>
<span class="line-added"> 224     MAKE_SUBDIR := lib, \</span>
<span class="line-added"> 225     CHECK_MODULES := $(STATIC_LIBS_MODULES), \</span>
<span class="line-added"> 226     USE_WRAPPER := true, \</span>
<span class="line-added"> 227     EXTRA_ARGS := STATIC_LIBS=true, \</span>
<span class="line-added"> 228 ))</span>
<span class="line-added"> 229 </span>
<span class="line-added"> 230 ALL_TARGETS += $(STATIC_LIBS_TARGETS)</span>
<span class="line-added"> 231 </span>
 232 ################################################################################
 233 # Targets for compiling native executables
 234 $(eval $(call DeclareRecipesForPhase, LAUNCHER, \
 235     TARGET_SUFFIX := launchers, \
 236     FILE_PREFIX := Launcher, \
 237     MAKE_SUBDIR := launcher, \
 238     CHECK_MODULES := $(ALL_MODULES), \
 239     USE_WRAPPER := true))
 240 
 241 ALL_TARGETS += $(LAUNCHER_TARGETS)
 242 
 243 ################################################################################
 244 # Build hotspot target
 245 
 246 HOTSPOT_VARIANT_TARGETS := $(addprefix hotspot-, $(JVM_VARIANTS))
 247 HOTSPOT_VARIANT_GENSRC_TARGETS := $(addsuffix -gensrc, $(HOTSPOT_VARIANT_TARGETS))
 248 HOTSPOT_VARIANT_LIBS_TARGETS := $(addsuffix -libs, $(HOTSPOT_VARIANT_TARGETS))
 249 
 250 define DeclareHotspotGensrcRecipe
 251   hotspot-$1-gensrc:
</pre>
<hr />
<pre>
 278 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk $1-only \
 279 	    GENERATE_COMPILE_COMMANDS_ONLY=true)
 280 
 281   COMPILE_COMMANDS_TARGETS_$2 += $1-compile-commands
 282 endef
 283 
 284 $(foreach t, $(HOTSPOT_VARIANT_LIBS_TARGETS), \
 285   $(eval $(call DeclareCompileCommandsRecipe,$t,HOTSPOT)) \
 286 )
 287 
 288 $(foreach t, $(LIBS_TARGETS) $(LAUNCHER_TARGETS), \
 289   $(eval $(call DeclareCompileCommandsRecipe,$t,JDK)) \
 290 )
 291 
 292 compile-commands compile-commands-hotspot:
 293 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileCommands.gmk)
 294 
 295 ALL_TARGETS += $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
 296 ALL_TARGETS += compile-commands compile-commands-hotspot
 297 
<span class="line-added"> 298 ################################################################################</span>
<span class="line-added"> 299 # VS Code projects</span>
<span class="line-added"> 300 vscode-project:</span>
<span class="line-added"> 301 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-added"> 302       VSCODE_INDEXER=cpptools)</span>
<span class="line-added"> 303 </span>
<span class="line-added"> 304 vscode-project-clangd:</span>
<span class="line-added"> 305 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-added"> 306       VSCODE_INDEXER=clangd)</span>
<span class="line-added"> 307 </span>
<span class="line-added"> 308 vscode-project-rtags:</span>
<span class="line-added"> 309 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-added"> 310       VSCODE_INDEXER=rtags)</span>
<span class="line-added"> 311 </span>
<span class="line-added"> 312 vscode-project-ccls:</span>
<span class="line-added"> 313 	+($(CD) $(TOPDIR)/make/vscode &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateVSCodeProject.gmk \</span>
<span class="line-added"> 314       VSCODE_INDEXER=ccls)</span>
<span class="line-added"> 315 </span>
<span class="line-added"> 316 ALL_TARGETS += vscode-project vscode-project-clangd vscode-project-rtags \</span>
<span class="line-added"> 317   vscode-project-ccls</span>
<span class="line-added"> 318 </span>
 319 ################################################################################
 320 # Build demos targets
 321 
 322 demos-jdk:
 323 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk)
 324 
 325 test-image-demos-jdk:
 326 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk images)
 327 
 328 ALL_TARGETS += demos-jdk test-image-demos-jdk
 329 
 330 ################################################################################
 331 # Jigsaw specific data and analysis targets.
 332 
 333 generate-summary:
 334 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateModuleSummary.gmk)
 335 
 336 ALL_TARGETS += generate-summary
 337 
 338 ################################################################################
</pre>
<hr />
<pre>
 347 	    MODULE=$1)
 348 endef
 349 
 350 $(foreach m, $(JMOD_MODULES), $(eval $(call DeclareJmodRecipe,$m)))
 351 
 352 ALL_TARGETS += $(JMOD_TARGETS)
 353 
 354 ################################################################################
 355 # Images targets
 356 
 357 store-source-revision:
 358 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk store-source-revision)
 359 
 360 create-source-revision-tracker:
 361 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk create-source-revision-tracker)
 362 
 363 BOOTCYCLE_TARGET := product-images
 364 bootcycle-images:
 365         ifneq ($(COMPILE_TYPE), cross)
 366 	  $(call LogWarn, Boot cycle build step 2: Building a new JDK image using previously built image)
<span class="line-added"> 367 	  $(call MakeDir, $(OUTPUTDIR)/bootcycle-build)</span>
 368 	  +$(MAKE) $(MAKE_ARGS) -f $(TOPDIR)/make/Init.gmk PARALLEL_TARGETS=$(BOOTCYCLE_TARGET) \
<span class="line-modified"> 369 	      LOG_PREFIX=&quot;[bootcycle] &quot; JOBS= SPEC=$(dir $(SPEC))bootcycle-spec.gmk main</span>
 370         else
 371 	  $(call LogWarn, Boot cycle build disabled when cross compiling)
 372         endif
 373 
 374 zip-security:
 375 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSecurity.gmk)
 376 
 377 zip-source:
 378 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSource.gmk)
 379 
 380 jrtfs-jar:
 381 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JrtfsJar.gmk)
 382 
 383 jdk-image:
 384 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jdk)
 385 
 386 legacy-jre-image:
 387 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jre)
 388 
 389 symbols-image:
 390 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk symbols)
 391 
<span class="line-added"> 392 static-libs-image:</span>
<span class="line-added"> 393 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f StaticLibsImage.gmk)</span>
<span class="line-added"> 394 </span>
 395 mac-jdk-bundle:
 396 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jdk-bundle)
 397 
 398 mac-legacy-jre-bundle:
 399 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jre-bundle)
 400 
 401 release-file:
 402 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ReleaseFile.gmk)
 403 
 404 exploded-image-optimize:
 405 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ExplodedImageOptimize.gmk)
 406 
<span class="line-added"> 407 graal-builder-image:</span>
<span class="line-added"> 408 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GraalBuilderImage.gmk)</span>
<span class="line-added"> 409 </span>
 410 ifeq ($(JCOV_ENABLED), true)
 411   jcov-image:
 412 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Coverage.gmk jcov-image)
 413 endif
 414 
 415 ALL_TARGETS += store-source-revision create-source-revision-tracker bootcycle-images zip-security \
 416     zip-source jrtfs-jar jdk-image legacy-jre-image \
<span class="line-modified"> 417     symbols-image static-libs-image mac-jdk-bundle mac-legacy-jre-bundle \</span>
<span class="line-modified"> 418     release-file exploded-image-optimize graal-builder-image jcov-image</span>
 419 
 420 ################################################################################
 421 # Docs targets
 422 
 423 # If building full docs, to complete docs-*-api we need both the javadoc and
 424 # modulegraph targets.
 425 docs-jdk-api-javadoc:
 426 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-javadoc)
 427 
 428 docs-jdk-api-modulegraph:
 429 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-modulegraph)
 430 
 431 docs-javase-api-javadoc:
 432 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-javadoc)
 433 
 434 docs-javase-api-modulegraph:
 435 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-modulegraph)
 436 
 437 docs-reference-api-javadoc:
 438 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-javadoc)
 439 
 440 docs-reference-api-modulegraph:
 441 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-modulegraph)
 442 
 443 docs-jdk-specs:
 444 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-specs)
 445 
 446 docs-jdk-index:
 447 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-index)
 448 
 449 docs-zip:
 450 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-zip)
 451 
<span class="line-added"> 452 docs-specs-zip:</span>
<span class="line-added"> 453 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-specs-zip)</span>
<span class="line-added"> 454 </span>
 455 update-build-docs:
 456 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateBuildDocs.gmk)
 457 
 458 update-x11wrappers:
 459 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateX11Wrappers.gmk)
 460 
 461 ALL_TARGETS += docs-jdk-api-javadoc docs-jdk-api-modulegraph \
 462     docs-javase-api-javadoc docs-javase-api-modulegraph \
 463     docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \
<span class="line-modified"> 464     docs-jdk-index docs-zip docs-specs-zip update-build-docs update-x11wrappers</span>
 465 
 466 ################################################################################
 467 # Cross compilation support
 468 
 469 ifeq ($(CREATING_BUILDJDK), true)
 470   # This target is only called by the recursive call below.
 471   create-buildjdk-interim-image-helper: interim-image jdk.jlink-launchers \
 472       java.base-copy jdk.jdeps-launchers
 473 endif
 474 
<span class="line-modified"> 475 BUILDJDK_MODULES := $(sort $(foreach m, jdk.jlink $(INTERIM_IMAGE_MODULES), \</span>
<span class="line-modified"> 476     $(call FindTransitiveDepsForModule, $m) $m))</span>
 477 
 478 create-buildjdk-interim-image:
 479 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk \
 480 	    $@-helper \
 481 	    SPEC=$(dir $(SPEC))buildjdk-spec.gmk \
 482 	    HOTSPOT_SPEC=$(dir $(SPEC))buildjdk-spec.gmk \
<span class="line-modified"> 483 	    CREATING_BUILDJDK=true \</span>
<span class="line-added"> 484 	    LOG_PREFIX=&quot;[buildjdk] &quot; \</span>
<span class="line-added"> 485 	    JAVA_MODULES=&quot;$(BUILDJDK_MODULES)&quot; \</span>
<span class="line-added"> 486 	)</span>
 487 
 488 ALL_TARGETS += create-buildjdk-copy create-buildjdk-interim-image
 489 
 490 ################################################################################
 491 # The interim-image is a small jlinked image that is used to generate artifacts
 492 # at build time for use when linking the real images.
 493 
 494 INTERIM_JMOD_TARGETS := $(addsuffix -interim-jmod, $(INTERIM_IMAGE_MODULES))
 495 
 496 define DeclareInterimJmodRecipe
 497   $1-interim-jmod:
 498 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 499 	    MODULE=$1 \
 500 	    JMODS_DIR=$(INTERIM_JMODS_DIR) \
 501 	    JMODS_SUPPORT_DIR=$(INTERIM_JMODS_DIR)/support \
 502 	    INTERIM_JMOD=true \
 503 	)
 504 endef
 505 
 506 $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $(call DeclareInterimJmodRecipe,$m)))
</pre>
<hr />
<pre>
 606 test:
 607 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 608 	    TEST=&quot;$(TEST)&quot;)
 609 
 610 exploded-test:
 611 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 612 	    TEST=&quot;$(TEST)&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))
 613 
 614 jcov-test:
 615 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 616 	    TEST=&quot;$(TEST)&quot; TEST_OPTS_JCOV=true)
 617 
 618 ALL_TARGETS += test exploded-test jcov-test
 619 
 620 ################################################################################
 621 # Bundles
 622 
 623 product-bundles:
 624 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk product-bundles)
 625 
<span class="line-added"> 626 legacy-bundles:</span>
<span class="line-added"> 627 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk legacy-bundles)</span>
<span class="line-added"> 628 </span>
 629 test-bundles:
 630 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk test-bundles)
 631 
 632 docs-bundles:
 633 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk docs-bundles)
 634 
<span class="line-added"> 635 static-libs-bundles:</span>
<span class="line-added"> 636 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk static-libs-bundles)</span>
<span class="line-added"> 637 </span>
 638 ifeq ($(JCOV_ENABLED), true)
 639   jcov-bundles:
 640 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk jcov-bundles)
 641 endif
 642 
<span class="line-modified"> 643 ALL_TARGETS += product-bundles legacy-bundles test-bundles docs-bundles \</span>
<span class="line-added"> 644     static-libs-bundles jcov-bundles</span>
 645 
 646 ################################################################################
 647 # Install targets
 648 
 649 install:
 650 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Install.gmk)
 651 
 652 ALL_TARGETS += install
 653 
 654 ################################################################################
 655 #
 656 # Dependency declarations between targets.
 657 #
 658 # These are declared in two groups. First all dependencies between targets that
 659 # have recipes above as these dependencies may be disabled. Then the aggregator
 660 # targets that do not have recipes of their own, which will never have their
 661 # dependencies disabled.
 662 #
 663 ################################################################################
 664 # Targets with recipes above
 665 
 666 # If running an *-only target, parallel execution and dependencies between
 667 # recipe targets are disabled. This makes it possible to run a select set of
 668 # recipe targets in order. It&#39;s the responsibility of the user to make sure
 669 # all prerequisites are fulfilled.
 670 ifneq ($(findstring -only, $(MAKECMDGOALS)), )
 671   .NOTPARALLEL:
 672 else
 673   $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
 674 
 675   interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
 676 
<span class="line-modified"> 677   buildtools-jdk: interim-langtools interim-tzdb</span>
 678 
 679   buildtools-hotspot: interim-langtools
 680 
 681   buildtools-modules: exploded-image-base
 682 
 683   $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
 684 
 685   $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
 686 
 687   $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
 688 
 689   $(GENDATA_TARGETS): interim-langtools buildtools-jdk
 690 
 691   interim-rmic: interim-langtools
 692 
 693   $(RMIC_TARGETS): interim-langtools interim-rmic
 694 
 695   $(JAVA_TARGETS): interim-langtools
 696 
 697   # Declare dependencies between hotspot-&lt;variant&gt;* targets
 698   $(foreach v, $(JVM_VARIANTS), \

 699       $(eval hotspot-$v-gensrc: java.base-copy) \
 700       $(eval hotspot-$v-libs: hotspot-$v-gensrc java.base-copy) \
 701   )
 702 
 703   hotspot-ide-project: hotspot exploded-image
 704 
 705   generate-exported-symbols: java.base-libs jdk.jdwp.agent-libs
 706 
 707   # If not already set, set the JVM variant target so that the JVM will be built.
 708   JVM_MAIN_LIB_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-libs
 709 
 710   # Building one JVM variant is enough to start building the other libs
 711   $(LIBS_TARGETS): $(JVM_MAIN_LIB_TARGETS)
 712 
 713   $(LAUNCHER_TARGETS): java.base-libs
 714 
 715   ifeq ($(STATIC_BUILD), true)
 716     $(LAUNCHER_TARGETS): generate-exported-symbols
 717   endif
 718 
 719   # The demos are currently linking to libjvm and libjava, just like all other
 720   # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they
 721   # aren&#39;t built until after libjava and libjvm are available to link to.
<span class="line-modified"> 722   demos-jdk: java.base-libs exploded-image</span>
 723   test-image-demos-jdk: demos-jdk
 724 
 725   # Declare dependency from &lt;module&gt;-java to &lt;module&gt;-gensrc
 726   $(foreach m, $(GENSRC_MODULES), $(eval $m-java: $m-gensrc))
 727 
 728   # Declare dependencies between java modules
 729   $(foreach m, $(JAVA_MODULES), \
 730       $(eval $m-java: $(addsuffix -java, $(filter $(JAVA_MODULES), \
 731       $(call FindDepsForModule,$m)))))
<span class="line-added"> 732   # Declare dependencies between the module meta targets</span>
<span class="line-added"> 733   $(foreach m, $(ALL_MODULES), $(eval $m: $(call FindDepsForModule,$m)))</span>
 734 
 735   # Declare dependencies between &lt;module&gt;-rmic to &lt;module&gt;-java
 736   $(foreach m, $(RMIC_MODULES), $(eval $m-rmic: $m-java))
 737 
 738   # Declare dependencies from &lt;module&gt;-lib to &lt;module&gt;-java
 739   # Skip modules that do not have java source.
<span class="line-modified"> 740   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs: $m-java))</span>




 741 
 742   # Declare dependencies from all other &lt;module&gt;-lib to java.base-lib
 743   $(foreach t, $(filter-out java.base-libs, $(LIBS_TARGETS)), \
 744       $(eval $t: java.base-libs))
 745 
 746   # jdk.accessibility depends on java.desktop
 747   jdk.accessibility-libs: java.desktop-libs
 748 
 749   # This dependency needs to be explicitly declared. jdk.jdi-gensrc generates a
 750   # header file used by jdk.jdwp.agent-libs. The jdk.jdwp.agent-gensrc is a
 751   # virtual target.
 752   jdk.jdwp.agent-libs: jdk.jdwp.agent-gensrc
 753 
 754   # The swing beans need to have java base properly generated to avoid errors
 755   # in javadoc. The X11 wrappers need the java.base include files to have been
 756   # copied and processed.
 757   java.desktop-gensrc-src: java.base-gensrc java.base-copy
 758 
 759   # The annotation processing for jdk.internal.vm.compiler
 760   # and jdk.internal.vm.compiler.management needs classes from the current JDK.
 761   jdk.internal.vm.compiler-gensrc-src: $(addsuffix -java, \
 762       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler))
 763   jdk.internal.vm.compiler.management-gensrc-src: $(addsuffix -java, \
 764       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler.management))
 765 
 766   # For these modules, the gensrc step is generating a module-info.java.extra
 767   # file to be processed by the gensrc-moduleinfo target.
 768   jdk.internal.vm.compiler-gensrc-moduleinfo: jdk.internal.vm.compiler-gensrc-src
 769   jdk.internal.vm.compiler.management-gensrc-moduleinfo: jdk.internal.vm.compiler.management-gensrc-src
 770 
 771   jdk.jdeps-gendata: java rmic
 772 
 773   # The ct.sym generation uses all the moduleinfos as input
 774   jdk.compiler-gendata: $(GENSRC_MODULEINFO_TARGETS)
 775 
 776   # Declare dependencies between jmod targets.
 777   # java.base jmod needs jrt-fs.jar and access to the other jmods to be built.
<span class="line-modified"> 778   # When creating the BUILDJDK, we don&#39;t need to add hashes to java.base, thus</span>
 779   # we don&#39;t need to depend on all other jmods
 780   ifneq ($(CREATING_BUILDJDK), true)
 781     java.base-jmod: jrtfs-jar $(filter-out java.base-jmod, $(JMOD_TARGETS))
 782   endif
 783 
 784   # If not already set, set the JVM target so that the JVM will be built.
 785   JVM_MAIN_TARGETS ?= hotspot
 786 
 787   # Building java.base-jmod requires all of VM (ie hotspot) to be built.
 788   java.base-jmod: $(JVM_MAIN_TARGETS)
 789 
 790   # Declare dependencies from &lt;module&gt;-jmod to all other module targets
<span class="line-modified"> 791   $(foreach m, $(JAVA_MODULES), $(eval $m_JMOD_DEPS += $m-java))</span>




 792   $(foreach m, $(GENDATA_MODULES), $(eval $m_JMOD_DEPS += $m-gendata))
 793   $(foreach m, $(RMIC_MODULES), $(eval $m_JMOD_DEPS += $m-rmic))
 794   $(foreach m, $(LIBS_MODULES), $(eval $m_JMOD_DEPS += $m-libs))
 795   $(foreach m, $(LAUNCHER_MODULES), $(eval $m_JMOD_DEPS += $m-launchers))
 796   $(foreach m, $(COPY_MODULES), $(eval $m_JMOD_DEPS += $m-copy))
 797   $(foreach m, $(ALL_MODULES), $(eval $m-jmod: $($(m)_JMOD_DEPS)))
 798   $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $m-interim-jmod: $($(m)_JMOD_DEPS)))
 799 
 800   # Setup the minimal set of generated native source dependencies for hotspot
 801   $(foreach v, $(JVM_VARIANTS), \
 802     $(eval hotspot-$v-libs-compile-commands: hotspot-$v-gensrc) \
 803     $(foreach m, $(filter java.desktop jdk.hotspot.agent, $(GENSRC_MODULES)), \
 804       $(eval hotspot-$v-libs-compile-commands: $m-gensrc)) \
 805   )
 806 
 807   # For the full JDK compile commands, create all possible generated sources
 808   $(foreach m, $(GENSRC_MODULES), $(eval $m-libs-compile-commands: $m-gensrc))
 809   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs-compile-commands: $m-java))
 810 
 811   $(COMPILE_COMMANDS_TARGETS_HOTSPOT): clean-compile-commands
 812   $(COMPILE_COMMANDS_TARGETS_JDK): clean-compile-commands
 813   compile-commands-hotspot: $(COMPILE_COMMANDS_TARGETS_HOTSPOT)
 814   compile-commands: $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
 815 
<span class="line-added"> 816   vscode-project: compile-commands</span>
<span class="line-added"> 817   vscode-project-clangd: compile-commands</span>
<span class="line-added"> 818   vscode-project-rtags: compile-commands</span>
<span class="line-added"> 819   vscode-project-ccls: compile-commands</span>
<span class="line-added"> 820 </span>
<span class="line-added"> 821   # The -static-libs targets depend on -java as well as java.base-copy.</span>
<span class="line-added"> 822   $(foreach m, $(filter $(JAVA_MODULES), $(STATIC_LIBS_MODULES)), \</span>
<span class="line-added"> 823     $(eval $m-static-libs: $m-java java.base-copy))</span>
<span class="line-added"> 824 </span>
 825   # Jmods cannot be created until we have the jmod tool ready to run. During
 826   # a normal build we run it from the exploded image, but when cross compiling
 827   # it&#39;s run from the buildjdk, which is either created at build time or user
 828   # supplied.










 829   ifeq ($(CREATE_BUILDJDK), true)

 830     ifneq ($(CREATING_BUILDJDK), true)
<span class="line-added"> 831       # When cross compiling and buildjdk is to be created, simply depend on</span>
<span class="line-added"> 832       # creating the buildjdk.</span>
 833       $(JMOD_TARGETS): create-buildjdk
 834       buildtools-modules: create-buildjdk
 835     else
<span class="line-modified"> 836       # While actually creating the buildjdk, we need to list the bare</span>
<span class="line-modified"> 837       # minimum dependencies needed before running jmod, to avoid building</span>
<span class="line-added"> 838       # more than necessary. This includes:</span>
<span class="line-added"> 839       # * all java modules</span>
<span class="line-added"> 840       # * jdk.jlink-launchers</span>
<span class="line-added"> 841       # * copy jvm.cfg (done in java.base-copy)</span>
<span class="line-added"> 842       # * tzdb.dat (done in java.base-gendata)</span>
<span class="line-added"> 843       # Without all of these jimage, jlink and jmod won&#39;t start.</span>
<span class="line-added"> 844       $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): java.base-libs java.base-copy \</span>
<span class="line-added"> 845           java.base-gendata jdk.jlink-launchers java</span>
 846     endif
 847   else
<span class="line-modified"> 848     # The normal non cross compilation case uses needs to wait for the full</span>
<span class="line-modified"> 849     # exploded-image to avoid a race with the optimize target.</span>
<span class="line-modified"> 850     $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): exploded-image</span>

 851   endif
 852 
 853   # All modules include the main license files from java.base.
 854   $(JMOD_TARGETS): java.base-copy
 855 
 856   zip-security: java.base-java java.security.jgss-java java.security.jgss-libs \
 857       $(filter jdk.crypto%, $(JAVA_TARGETS))
 858 
 859   zip-source: gensrc rmic
 860 
 861   jrtfs-jar: interim-langtools
 862 
 863   build-microbenchmark: interim-langtools exploded-image
 864 
 865   ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
 866     ifeq ($(CREATE_BUILDJDK), true)
 867       # If creating a buildjdk, the interim image needs to be based on that.
 868       generate-link-opt-data: create-buildjdk
 869     else ifeq ($(EXTERNAL_BUILDJDK), false)
 870       # If an external buildjdk has been provided, we skip generating an
 871       # interim-image and just use the external buildjdk for generating
 872       # classlist.
 873       generate-link-opt-data: interim-image
 874     endif
 875     generate-link-opt-data: buildtools-jdk
 876 
 877     # The generated classlist needs to go into java.base-jmod.
 878     java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
 879   endif
 880 
 881   release-file: create-source-revision-tracker
 882 
 883   jdk-image: jmods zip-source demos release-file
 884   legacy-jre-image: jmods release-file
 885   symbols-image: $(LIBS_TARGETS) $(LAUNCHER_TARGETS)
 886 
<span class="line-added"> 887   static-libs-image: $(STATIC_LIBS_TARGETS)</span>
<span class="line-added"> 888 </span>
<span class="line-added"> 889   graal-builder-image: jdk-image static-libs-image</span>
<span class="line-added"> 890 </span>
 891   mac-jdk-bundle: jdk-image
 892   mac-legacy-jre-bundle: legacy-jre-image
 893 
 894   ifeq ($(JCOV_INPUT_JDK), )
 895     jcov-image: jdk-image
 896   endif
 897 
 898   # The optimize target can run as soon as the modules dir has been completely
 899   # populated (java, copy and gendata targets) and the basic libs and launchers
 900   # have been built.
 901   exploded-image-optimize: java copy gendata java.base-libs java.base-launchers \
 902       buildtools-modules
 903 
 904   bootcycle-images: jdk-image
 905 
 906   docs-jdk-api-javadoc: $(GENSRC_TARGETS) rmic
 907 
 908   docs-javase-api-javadoc: $(GENSRC_TARGETS) rmic
 909 
 910   docs-reference-api-javadoc: $(GENSRC_TARGETS) rmic
 911 
 912   docs-jdk-api-modulegraph: exploded-image buildtools-modules
 913 
 914   docs-javase-api-modulegraph: exploded-image buildtools-modules
 915 
 916   docs-reference-api-modulegraph: exploded-image buildtools-modules
 917 
 918   # If not already set, then set the JVM specific docs targets
 919   JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
 920 
 921   # The gensrc steps for hotspot and jdk.jdi create html spec files.
<span class="line-modified"> 922   docs-jdk-specs: buildtools-jdk $(JVM_DOCS_TARGETS) jdk.jdi-gensrc \</span>
 923       docs-jdk-index
 924 
 925   docs-zip: docs-jdk
 926 
<span class="line-added"> 927   docs-specs-zip: docs-jdk-specs</span>
<span class="line-added"> 928 </span>
 929   # Tests
 930   test: jdk-image test-image
 931 
 932   exploded-test: exploded-image test-image
 933 
 934   jcov-test: jcov-image test-image
 935 
 936   test-make: clean-test-make compile-commands
 937 
 938   test-make-compile-commands: compile-commands
 939 
 940   # Declare dependency for all generated test targets
 941   $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image))
 942   $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image))
 943 





 944   interim-image: $(INTERIM_JMOD_TARGETS)
 945 
<span class="line-modified"> 946   build-test-lib: exploded-image</span>
 947 
 948   build-test-failure-handler: interim-langtools
 949 
 950   test-image-failure-handler: build-test-failure-handler
 951 
 952   build-test-hotspot-jtreg-native: buildtools-jdk \
 953       hotspot-$(JVM_VARIANT_MAIN)-libs
 954 
 955   build-test-jdk-jtreg-native: buildtools-jdk java.base-libs
 956 
<span class="line-modified"> 957   build-test-hotspot-jtreg-graal: exploded-image</span>
 958 
 959   test-image-hotspot-jtreg-native: build-test-hotspot-jtreg-native
 960 
 961   test-image-jdk-jtreg-native: build-test-jdk-jtreg-native
 962 
 963   test-image-hotspot-jtreg-graal: build-test-hotspot-jtreg-graal
 964 
 965   test-image-hotspot-gtest: hotspot
 966 
 967   install: product-images
 968 
 969   product-bundles: product-images
 970 
<span class="line-added"> 971   legacy-bundles: legacy-images</span>
<span class="line-added"> 972 </span>
 973   test-bundles: test-image
 974 
 975   docs-bundles: docs-image
 976 
 977   jcov-bundles: jcov-image
 978 
<span class="line-added"> 979   static-libs-bundles: static-libs-image</span>
<span class="line-added"> 980 </span>
 981   generate-summary: jmods buildtools-modules
 982 
 983   update-x11wrappers: java.base-copy buildtools-jdk
 984 
 985 endif
 986 
 987 ################################################################################
 988 # Virtual targets without recipes
 989 
 990 # If not already set, set the JVM specific tools targets
 991 JVM_TOOLS_TARGETS ?= buildtools-hotspot
 992 buildtools: buildtools-langtools interim-langtools interim-rmic \
 993     buildtools-jdk $(JVM_TOOLS_TARGETS)
 994 
<span class="line-added"> 995 # Declare dependencies from hotspot-&lt;variant&gt; targets</span>
<span class="line-added"> 996 $(foreach v, $(JVM_VARIANTS), \</span>
<span class="line-added"> 997   $(eval hotspot-$v: hotspot-$v-gensrc hotspot-$v-libs) \</span>
<span class="line-added"> 998 )</span>
 999 hotspot: $(HOTSPOT_VARIANT_TARGETS)
1000 
1001 # Create targets hotspot-libs and hotspot-gensrc.
1002 $(foreach v, $(JVM_VARIANTS), \
1003   $(eval hotspot-libs: hotspot-$v-libs) \
1004   $(eval hotspot-gensrc: hotspot-$v-gensrc) \
1005 )
1006 
1007 gensrc: $(GENSRC_TARGETS)
1008 
1009 gendata: $(GENDATA_TARGETS)
1010 
1011 copy: $(ALL_COPY_TARGETS)
1012 
1013 java: $(JAVA_TARGETS)
1014 
1015 rmic: $(RMIC_TARGETS)
1016 
1017 libs: $(LIBS_TARGETS)
1018 
<span class="line-added">1019 static-libs: $(STATIC_LIBS_TARGETS)</span>
<span class="line-added">1020 </span>
1021 launchers: $(LAUNCHER_TARGETS)
1022 
1023 jmods: $(JMOD_TARGETS)
1024 
1025 # Explicitly declare dependency for virtual target jdk.jdwp.agent-gensrc which
1026 # is actually handled by jdk.jdi-gensrc
1027 jdk.jdwp.agent-gensrc: jdk.jdi-gensrc
1028 
1029 # Declare dependencies from &lt;module&gt; to all the individual targets specific
1030 # to that module &lt;module&gt;-*, that are needed for the exploded image.
1031 $(foreach m, $(GENSRC_MODULES), $(eval $m: $m-gensrc))
1032 $(foreach m, $(JAVA_MODULES), $(eval $m: $m-java))
1033 $(foreach m, $(GENDATA_MODULES), $(eval $m: $m-gendata))
1034 $(foreach m, $(RMIC_MODULES), $(eval $m: $m-rmic))
1035 $(foreach m, $(LIBS_MODULES), $(eval $m: $m-libs))
1036 $(foreach m, $(LAUNCHER_MODULES), $(eval $m: $m-launchers))
1037 $(foreach m, $(ALL_COPY_MODULES), $(eval $m: $m-copy))
1038 
1039 # Building java.base includes building all of hotspot.
1040 java.base: $(JVM_MAIN_TARGETS)
1041 
1042 demos: demos-jdk
1043 
1044 # The &quot;exploded image&quot; is a locally runnable JDK in $(OUTPUTDIR)/jdk.
1045 exploded-image-base: $(ALL_MODULES)
1046 exploded-image: exploded-image-base release-file
1047 # When cross compiling, no need to optimize the exploded image since it won&#39;t
1048 # be runnable on the host platform anyway.
1049 ifneq ($(COMPILE_TYPE), cross)
1050   exploded-image: exploded-image-optimize
1051 endif
1052 
<span class="line-modified">1053 create-buildjdk: create-buildjdk-interim-image</span>
1054 
1055 docs-jdk-api: docs-jdk-api-javadoc
1056 docs-javase-api: docs-javase-api-javadoc
1057 docs-reference-api: docs-reference-api-javadoc
1058 
1059 # If we&#39;re building full docs, we must also generate the module graphs to
1060 # get non-broken api documentation.
1061 ifeq ($(ENABLE_FULL_DOCS), true)
1062   docs-jdk-api: docs-jdk-api-modulegraph
1063   docs-javase-api: docs-javase-api-modulegraph
1064   docs-reference-api: docs-reference-api-modulegraph
1065 endif
1066 
1067 docs-jdk: docs-jdk-api docs-jdk-specs docs-jdk-index
1068 docs-javase: docs-javase-api
1069 docs-reference: docs-reference-api
1070 
1071 # alias for backwards compatibility
1072 docs-javadoc: docs-jdk-api
1073 
1074 mac-bundles: mac-jdk-bundle
1075 
1076 # The $(OUTPUTDIR)/images directory contain the resulting deliverables,
1077 # and in line with this, our targets for creating these are named *-image[s].
1078 
1079 # This target builds the product images, e.g. the JDK image
1080 # (and possibly other, more specific versions)
1081 product-images: jdk-image symbols-image exploded-image
1082 
<span class="line-added">1083 # This target builds the legacy images, e.g. the legacy JRE image</span>
<span class="line-added">1084 legacy-images: legacy-jre-image</span>
<span class="line-added">1085 </span>
1086 # zip-security is actually a bundle, but for now it needs to be considered
1087 # an image until this can be cleaned up properly.
1088 product-images: zip-security
1089 
1090 # The module summary cannot be run when:
1091 # * Cross compiling and building a partial BUILDJDK for the build host
1092 # * An external buildjdk has been supplied since it may not match the
1093 #   module selection of the target jdk
1094 ifneq ($(CREATE_BUILDJDK), true)
1095   ifeq ($(EXTERNAL_BUILDJDK), false)
1096     product-images: generate-summary
1097   endif
1098 endif
1099 
1100 ifeq ($(call isTargetOs, macosx), true)
1101   product-images: mac-jdk-bundle
<span class="line-added">1102 </span>
<span class="line-added">1103   legacy-images: mac-legacy-jre-bundle</span>
1104 endif
1105 
1106 # This target builds the documentation image
1107 docs-image: docs-jdk
1108 
1109 # If not already set, set the JVM specific targets to build the test image
1110 JVM_TEST_IMAGE_TARGETS ?= test-image-hotspot-jtreg-native test-image-hotspot-gtest
1111 
1112 ifeq ($(INCLUDE_GRAAL), true)
1113   JVM_TEST_IMAGE_TARGETS += test-image-hotspot-jtreg-graal
1114 endif
1115 
1116 # This target builds the test image
1117 test-image: prepare-test-image \
1118     test-image-jdk-jtreg-native test-image-failure-handler \
1119     test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
1120 
1121 ifneq ($(JMH_CORE_JAR), )
1122   test-image: build-microbenchmark
1123 endif
1124 
1125 ################################################################################
1126 
1127 # all-images builds all our deliverables as images.
1128 all-images: product-images test-image docs-image
1129 
1130 # all-bundles packages all our deliverables as tar.gz bundles.
<span class="line-modified">1131 all-bundles: product-bundles test-bundles docs-bundles static-libs-bundles</span>
1132 
1133 ALL_TARGETS += buildtools hotspot hotspot-libs hotspot-gensrc gensrc gendata \
<span class="line-modified">1134     copy java rmic libs static-libs launchers jmods \</span>
1135     jdk.jdwp.agent-gensrc $(ALL_MODULES) demos \
1136     exploded-image-base exploded-image \
1137     create-buildjdk docs-jdk-api docs-javase-api docs-reference-api docs-jdk \
<span class="line-modified">1138     docs-javase docs-reference docs-javadoc mac-bundles product-images legacy-images \</span>
1139     docs-image test-image all-images \
1140     all-bundles
1141 
1142 ################################################################################
1143 
1144 # Traditional targets typically run by users.
1145 # These can be considered aliases for the targets now named by a more
1146 # &quot;modern&quot; naming scheme.
1147 default: $(DEFAULT_MAKE_TARGET)
1148 jdk: exploded-image
1149 images: product-images
1150 docs: docs-image
1151 bundles: all-bundles
1152 all: all-images
1153 
1154 ALL_TARGETS += default jdk images docs bundles all
1155 
1156 # Aliases used for running tests.
1157 
1158 # Let &quot;run-test&quot; be an alias for &quot;test&quot;
</pre>
</td>
</tr>
</table>
<center><a href="MacBundles.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="MainSupport.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>