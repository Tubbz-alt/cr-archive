<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/devkit/Tools.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="Makefile.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="createWindowsDevkit2017.sh.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/devkit/Tools.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2013, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 34 # if you configure after you&#39;ve once build the BUILD-&gt;BUILD
 35 # compiler THAT one will be picked up as the compiler for itself.
 36 # This is not so great, especially if you did a partial delete
 37 # of the target tree.
 38 #
 39 # Fix this...
 40 #
 41 
 42 $(info TARGET=$(TARGET))
 43 $(info HOST=$(HOST))
 44 $(info BUILD=$(BUILD))
 45 
 46 ARCH := $(word 1,$(subst -, ,$(TARGET)))
 47 
 48 ifeq ($(TARGET), arm-linux-gnueabihf)
 49   ARCH=armhfp
 50 endif
 51 
 52 $(info ARCH=$(ARCH))
 53 
<span class="line-modified"> 54 ifeq ($(BASE_OS), OEL6)</span>
<span class="line-modified"> 55   BASE_URL := http://yum.oracle.com/repo/OracleLinux/OL6/4/base/$(ARCH)/</span>
<span class="line-modified"> 56   LINUX_VERSION := OEL6.4</span>








 57 else ifeq ($(BASE_OS), Fedora)
 58   DEFAULT_OS_VERSION := 27
 59   ifeq ($(BASE_OS_VERSION), )
 60     BASE_OS_VERSION := $(DEFAULT_OS_VERSION)
 61   endif
 62   ifeq ($(filter x86_64 armhfp, $(ARCH)), )
 63     FEDORA_TYPE := fedora-secondary
 64   else
 65     FEDORA_TYPE := fedora/linux
 66   endif
 67   ARCHIVED := $(shell [ $(BASE_OS_VERSION) -lt $(DEFAULT_OS_VERSION) ] &amp;&amp; echo true)
 68   ifeq ($(ARCHIVED),true)
 69     BASE_URL := https://archives.fedoraproject.org/pub/archive/$(FEDORA_TYPE)/releases/$(BASE_OS_VERSION)/Everything/$(ARCH)/os/Packages/
 70   else
 71     BASE_URL := https://dl.fedoraproject.org/pub/$(FEDORA_TYPE)/releases/$(BASE_OS_VERSION)/Everything/$(ARCH)/os/Packages/
 72   endif
 73   LINUX_VERSION := Fedora_$(BASE_OS_VERSION)
 74 else
 75   $(error Unknown base OS $(BASE_OS))
 76 endif
 77 
 78 ##########################################################################################
 79 # Define external dependencies
 80 
 81 # Latest that could be made to work.
<span class="line-modified"> 82 GCC_VER := 7.3.0</span>
<span class="line-modified"> 83 ifeq ($(GCC_VER), 7.3.0)</span>








 84   gcc_ver := gcc-7.3.0
 85   binutils_ver := binutils-2.30
<span class="line-modified"> 86   ccache_ver := ccache-3.3.6</span>
 87   mpfr_ver := mpfr-3.1.5
 88   gmp_ver := gmp-6.1.2
 89   mpc_ver := mpc-1.0.3
 90   gdb_ver := gdb-8.1
 91 else ifeq ($(GCC_VER), 4.9.2)
 92   gcc_ver := gcc-4.9.2
 93   binutils_ver := binutils-2.25
<span class="line-modified"> 94   ccache_ver := ccache-3.2.1</span>
 95   mpfr_ver := mpfr-3.0.1
 96   gmp_ver := gmp-4.3.2
 97   mpc_ver := mpc-1.0.1
 98   gdb_ver := gdb-7.12.1
 99 else
100   $(error Unsupported GCC version)
101 endif
102 
103 GCC := http://ftp.gnu.org/pub/gnu/gcc/$(gcc_ver)/$(gcc_ver).tar.xz
104 BINUTILS := http://ftp.gnu.org/pub/gnu/binutils/$(binutils_ver).tar.xz
<span class="line-modified">105 CCACHE := https://samba.org/ftp/ccache/$(ccache_ver).tar.xz</span>
106 MPFR := https://www.mpfr.org/${mpfr_ver}/${mpfr_ver}.tar.bz2
107 GMP := http://ftp.gnu.org/pub/gnu/gmp/${gmp_ver}.tar.bz2
108 MPC := http://ftp.gnu.org/pub/gnu/mpc/${mpc_ver}.tar.gz
109 GDB := http://ftp.gnu.org/gnu/gdb/${gdb_ver}.tar.xz
110 
111 # RPMs used by all BASE_OS
112 RPM_LIST := \
<span class="line-modified">113     kernel-headers \</span>
114     glibc glibc-headers glibc-devel \
115     cups-libs cups-devel \
116     libX11 libX11-devel \
117     xorg-x11-proto-devel \
118     alsa-lib alsa-lib-devel \
119     libXext libXext-devel \
120     libXtst libXtst-devel \
121     libXrender libXrender-devel \
122     libXrandr libXrandr-devel \
123     freetype freetype-devel \
124     libXt libXt-devel \
125     libSM libSM-devel \
126     libICE libICE-devel \
127     libXi libXi-devel \
128     libXdmcp libXdmcp-devel \
129     libXau libXau-devel \
130     libgcc \
131     zlib zlib-devel \
132     libffi libffi-devel \
133     fontconfig fontconfig-devel \
</pre>
<hr />
<pre>
157 rpms := $(SYSROOT)/rpms_unpacked
158 
159 # Need to patch libs that are linker scripts to use non-absolute paths
160 libs := $(SYSROOT)/libs_patched
161 
162 ################################################################################
163 # Download RPMs
164 download-rpms:
165 	mkdir -p $(DOWNLOAD_RPMS)
166         # Only run this if rpm dir is empty.
167         ifeq ($(wildcard $(DOWNLOAD_RPMS)/*.rpm), )
168 	  cd $(DOWNLOAD_RPMS) &amp;&amp; \
169 	      wget -r -np -nd $(patsubst %, -A &quot;*%*.rpm&quot;, $(RPM_LIST)) $(BASE_URL)
170         endif
171 
172 ##########################################################################################
173 # Unpack source packages
174 
175 # Generate downloading + unpacking of sources.
176 define Download
<span class="line-modified">177   $(1)_DIR = $(abspath $(SRCDIR)/$(basename $(basename $(notdir $($(1))))))</span>


178   $(1)_CFG = $$($(1)_DIR)/configure
179   $(1)_FILE = $(DOWNLOAD)/$(notdir $($(1)))
180 
181   $$($(1)_CFG) : $$($(1)_FILE)
182 	mkdir -p $$(SRCDIR)
183 	tar -C $$(SRCDIR) -xf $$&lt;
<span class="line-modified">184 	$$(foreach p,$$(abspath $$(wildcard $$(notdir $$($(1)_DIR)).patch)), \</span>
185 	  echo PATCHING $$(p) ; \
186 	  patch -d $$($(1)_DIR) -p1 -i $$(p) ; \
187 	)
188 	touch $$@
189 
190   $$($(1)_FILE) :
191 	wget -P $(DOWNLOAD) $$($(1))
192 endef
193 
194 # Download and unpack all source packages
195 $(foreach p,GCC BINUTILS CCACHE MPFR GMP MPC GDB,$(eval $(call Download,$(p))))
196 
197 ##########################################################################################
198 # Unpack RPMS
199 
200 RPM_ARCHS := $(ARCH) noarch
201 ifeq ($(ARCH),x86_64)
202   ifeq ($(BUILD),$(HOST))
203     ifeq ($(TARGET),$(HOST))
204       # When building the native compiler for x86_64, enable mixed mode.
</pre>
<hr />
<pre>
353 # we build just the libs again for TARGET, then with whatever the arch
354 # wants.
355 $(BUILDDIR)/$(binutils_ver)/Makefile : CONFIG += --enable-64-bit-bfd --libdir=$(PREFIX)/$(word 1,$(LIBDIRS))
356 
357 # Makefile creation. Simply run configure in build dir.
358 # Setting CFLAGS to -O2 generates a much faster ld.
359 $(bfdmakes) \
360 $(BUILDDIR)/$(binutils_ver)/Makefile \
361     : $(BINUTILS_CFG)
362 	$(info Configuring $@. Log in $(@D)/log.config)
363 	@mkdir -p $(@D)
364 	( \
365 	  cd $(@D) ; \
366 	  $(PATHPRE) $(ENVS) CFLAGS=&quot;-O2 $(CFLAGS)&quot; \
367 	      $(BINUTILS_CFG) \
368 	      $(CONFIG) \
369 	      --with-sysroot=$(SYSROOT) \
370 	      --disable-nls \
371 	      --program-prefix=$(TARGET)- \
372 	      --enable-multilib \
<span class="line-modified">373 	      --enable-gold \</span>
374 	      --enable-threads \
375 	      --enable-plugins \
376 	) &gt; $(@D)/log.config 2&gt;&amp;1
377 	@echo &#39;done&#39;
378 
379 $(BUILDDIR)/$(mpfr_ver)/Makefile \
380     : $(MPFR_CFG)
381 	$(info Configuring $@. Log in $(@D)/log.config)
382 	@mkdir -p $(@D)
383 	( \
384 	  cd $(@D) ; \
385 	  $(PATHPRE) $(ENVS) CFLAGS=&quot;$(CFLAGS)&quot; \
386 	      $(MPFR_CFG) \
387 	      $(CONFIG) \
388 	      --program-prefix=$(TARGET)- \
389 	      --enable-shared=no \
390 	      --with-gmp=$(PREFIX) \
391 	) &gt; $(@D)/log.config 2&gt;&amp;1
392 	@echo &#39;done&#39;
393 
</pre>
</td>
<td>
<hr />
<pre>
  1 #
<span class="line-modified">  2 # Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 34 # if you configure after you&#39;ve once build the BUILD-&gt;BUILD
 35 # compiler THAT one will be picked up as the compiler for itself.
 36 # This is not so great, especially if you did a partial delete
 37 # of the target tree.
 38 #
 39 # Fix this...
 40 #
 41 
 42 $(info TARGET=$(TARGET))
 43 $(info HOST=$(HOST))
 44 $(info BUILD=$(BUILD))
 45 
 46 ARCH := $(word 1,$(subst -, ,$(TARGET)))
 47 
 48 ifeq ($(TARGET), arm-linux-gnueabihf)
 49   ARCH=armhfp
 50 endif
 51 
 52 $(info ARCH=$(ARCH))
 53 
<span class="line-modified"> 54 KERNEL_HEADERS_RPM := kernel-headers</span>
<span class="line-modified"> 55 </span>
<span class="line-modified"> 56 ifeq ($(BASE_OS), OL)</span>
<span class="line-added"> 57   ifeq ($(ARCH), aarch64)</span>
<span class="line-added"> 58     BASE_URL := http://yum.oracle.com/repo/OracleLinux/OL7/6/base/$(ARCH)/</span>
<span class="line-added"> 59     LINUX_VERSION := OL7.6</span>
<span class="line-added"> 60     KERNEL_HEADERS_RPM := kernel-uek-headers</span>
<span class="line-added"> 61   else</span>
<span class="line-added"> 62     BASE_URL := http://yum.oracle.com/repo/OracleLinux/OL6/4/base/$(ARCH)/</span>
<span class="line-added"> 63     LINUX_VERSION := OL6.4</span>
<span class="line-added"> 64   endif</span>
 65 else ifeq ($(BASE_OS), Fedora)
 66   DEFAULT_OS_VERSION := 27
 67   ifeq ($(BASE_OS_VERSION), )
 68     BASE_OS_VERSION := $(DEFAULT_OS_VERSION)
 69   endif
 70   ifeq ($(filter x86_64 armhfp, $(ARCH)), )
 71     FEDORA_TYPE := fedora-secondary
 72   else
 73     FEDORA_TYPE := fedora/linux
 74   endif
 75   ARCHIVED := $(shell [ $(BASE_OS_VERSION) -lt $(DEFAULT_OS_VERSION) ] &amp;&amp; echo true)
 76   ifeq ($(ARCHIVED),true)
 77     BASE_URL := https://archives.fedoraproject.org/pub/archive/$(FEDORA_TYPE)/releases/$(BASE_OS_VERSION)/Everything/$(ARCH)/os/Packages/
 78   else
 79     BASE_URL := https://dl.fedoraproject.org/pub/$(FEDORA_TYPE)/releases/$(BASE_OS_VERSION)/Everything/$(ARCH)/os/Packages/
 80   endif
 81   LINUX_VERSION := Fedora_$(BASE_OS_VERSION)
 82 else
 83   $(error Unknown base OS $(BASE_OS))
 84 endif
 85 
 86 ##########################################################################################
 87 # Define external dependencies
 88 
 89 # Latest that could be made to work.
<span class="line-modified"> 90 GCC_VER := 8.3.0</span>
<span class="line-modified"> 91 ifeq ($(GCC_VER), 8.3.0)</span>
<span class="line-added"> 92   gcc_ver := gcc-8.3.0</span>
<span class="line-added"> 93   binutils_ver := binutils-2.32</span>
<span class="line-added"> 94   ccache_ver := 3.7.3</span>
<span class="line-added"> 95   mpfr_ver := mpfr-3.1.5</span>
<span class="line-added"> 96   gmp_ver := gmp-6.1.2</span>
<span class="line-added"> 97   mpc_ver := mpc-1.0.3</span>
<span class="line-added"> 98   gdb_ver := gdb-8.3</span>
<span class="line-added"> 99 else ifeq ($(GCC_VER), 7.3.0)</span>
100   gcc_ver := gcc-7.3.0
101   binutils_ver := binutils-2.30
<span class="line-modified">102   ccache_ver := 3.3.6</span>
103   mpfr_ver := mpfr-3.1.5
104   gmp_ver := gmp-6.1.2
105   mpc_ver := mpc-1.0.3
106   gdb_ver := gdb-8.1
107 else ifeq ($(GCC_VER), 4.9.2)
108   gcc_ver := gcc-4.9.2
109   binutils_ver := binutils-2.25
<span class="line-modified">110   ccache_ver := 3.2.1</span>
111   mpfr_ver := mpfr-3.0.1
112   gmp_ver := gmp-4.3.2
113   mpc_ver := mpc-1.0.1
114   gdb_ver := gdb-7.12.1
115 else
116   $(error Unsupported GCC version)
117 endif
118 
119 GCC := http://ftp.gnu.org/pub/gnu/gcc/$(gcc_ver)/$(gcc_ver).tar.xz
120 BINUTILS := http://ftp.gnu.org/pub/gnu/binutils/$(binutils_ver).tar.xz
<span class="line-modified">121 CCACHE := https://github.com/ccache/ccache/releases/download/v$(ccache_ver)/ccache-$(ccache_ver).tar.xz</span>
122 MPFR := https://www.mpfr.org/${mpfr_ver}/${mpfr_ver}.tar.bz2
123 GMP := http://ftp.gnu.org/pub/gnu/gmp/${gmp_ver}.tar.bz2
124 MPC := http://ftp.gnu.org/pub/gnu/mpc/${mpc_ver}.tar.gz
125 GDB := http://ftp.gnu.org/gnu/gdb/${gdb_ver}.tar.xz
126 
127 # RPMs used by all BASE_OS
128 RPM_LIST := \
<span class="line-modified">129     $(KERNEL_HEADERS_RPM) \</span>
130     glibc glibc-headers glibc-devel \
131     cups-libs cups-devel \
132     libX11 libX11-devel \
133     xorg-x11-proto-devel \
134     alsa-lib alsa-lib-devel \
135     libXext libXext-devel \
136     libXtst libXtst-devel \
137     libXrender libXrender-devel \
138     libXrandr libXrandr-devel \
139     freetype freetype-devel \
140     libXt libXt-devel \
141     libSM libSM-devel \
142     libICE libICE-devel \
143     libXi libXi-devel \
144     libXdmcp libXdmcp-devel \
145     libXau libXau-devel \
146     libgcc \
147     zlib zlib-devel \
148     libffi libffi-devel \
149     fontconfig fontconfig-devel \
</pre>
<hr />
<pre>
173 rpms := $(SYSROOT)/rpms_unpacked
174 
175 # Need to patch libs that are linker scripts to use non-absolute paths
176 libs := $(SYSROOT)/libs_patched
177 
178 ################################################################################
179 # Download RPMs
180 download-rpms:
181 	mkdir -p $(DOWNLOAD_RPMS)
182         # Only run this if rpm dir is empty.
183         ifeq ($(wildcard $(DOWNLOAD_RPMS)/*.rpm), )
184 	  cd $(DOWNLOAD_RPMS) &amp;&amp; \
185 	      wget -r -np -nd $(patsubst %, -A &quot;*%*.rpm&quot;, $(RPM_LIST)) $(BASE_URL)
186         endif
187 
188 ##########################################################################################
189 # Unpack source packages
190 
191 # Generate downloading + unpacking of sources.
192 define Download
<span class="line-modified">193   # Allow override</span>
<span class="line-added">194   $(1)_DIRNAME ?= $(basename $(basename $(notdir $($(1)))))</span>
<span class="line-added">195   $(1)_DIR = $(abspath $(SRCDIR)/$$($(1)_DIRNAME))</span>
196   $(1)_CFG = $$($(1)_DIR)/configure
197   $(1)_FILE = $(DOWNLOAD)/$(notdir $($(1)))
198 
199   $$($(1)_CFG) : $$($(1)_FILE)
200 	mkdir -p $$(SRCDIR)
201 	tar -C $$(SRCDIR) -xf $$&lt;
<span class="line-modified">202 	$$(foreach p,$$(abspath $$(wildcard patches/$$(notdir $$($(1)_DIR)).patch)), \</span>
203 	  echo PATCHING $$(p) ; \
204 	  patch -d $$($(1)_DIR) -p1 -i $$(p) ; \
205 	)
206 	touch $$@
207 
208   $$($(1)_FILE) :
209 	wget -P $(DOWNLOAD) $$($(1))
210 endef
211 
212 # Download and unpack all source packages
213 $(foreach p,GCC BINUTILS CCACHE MPFR GMP MPC GDB,$(eval $(call Download,$(p))))
214 
215 ##########################################################################################
216 # Unpack RPMS
217 
218 RPM_ARCHS := $(ARCH) noarch
219 ifeq ($(ARCH),x86_64)
220   ifeq ($(BUILD),$(HOST))
221     ifeq ($(TARGET),$(HOST))
222       # When building the native compiler for x86_64, enable mixed mode.
</pre>
<hr />
<pre>
371 # we build just the libs again for TARGET, then with whatever the arch
372 # wants.
373 $(BUILDDIR)/$(binutils_ver)/Makefile : CONFIG += --enable-64-bit-bfd --libdir=$(PREFIX)/$(word 1,$(LIBDIRS))
374 
375 # Makefile creation. Simply run configure in build dir.
376 # Setting CFLAGS to -O2 generates a much faster ld.
377 $(bfdmakes) \
378 $(BUILDDIR)/$(binutils_ver)/Makefile \
379     : $(BINUTILS_CFG)
380 	$(info Configuring $@. Log in $(@D)/log.config)
381 	@mkdir -p $(@D)
382 	( \
383 	  cd $(@D) ; \
384 	  $(PATHPRE) $(ENVS) CFLAGS=&quot;-O2 $(CFLAGS)&quot; \
385 	      $(BINUTILS_CFG) \
386 	      $(CONFIG) \
387 	      --with-sysroot=$(SYSROOT) \
388 	      --disable-nls \
389 	      --program-prefix=$(TARGET)- \
390 	      --enable-multilib \
<span class="line-modified">391 	      --enable-gold=default \</span>
392 	      --enable-threads \
393 	      --enable-plugins \
394 	) &gt; $(@D)/log.config 2&gt;&amp;1
395 	@echo &#39;done&#39;
396 
397 $(BUILDDIR)/$(mpfr_ver)/Makefile \
398     : $(MPFR_CFG)
399 	$(info Configuring $@. Log in $(@D)/log.config)
400 	@mkdir -p $(@D)
401 	( \
402 	  cd $(@D) ; \
403 	  $(PATHPRE) $(ENVS) CFLAGS=&quot;$(CFLAGS)&quot; \
404 	      $(MPFR_CFG) \
405 	      $(CONFIG) \
406 	      --program-prefix=$(TARGET)- \
407 	      --enable-shared=no \
408 	      --with-gmp=$(PREFIX) \
409 	) &gt; $(@D)/log.config 2&gt;&amp;1
410 	@echo &#39;done&#39;
411 
</pre>
</td>
</tr>
</table>
<center><a href="Makefile.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="createWindowsDevkit2017.sh.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>