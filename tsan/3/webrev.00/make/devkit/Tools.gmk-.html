<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old make/devkit/Tools.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 #
  2 # Copyright (c) 2013, 2018, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ##########################################################################################
 27 #
 28 # Workhorse makefile for creating ONE cross compiler
 29 # Needs either to be from BUILD -&gt; BUILD OR have
 30 # BUILD -&gt; HOST prebuilt
 31 #
 32 # NOTE: There is a bug here. We don&#39;t limit the
 33 # PATH when building BUILD -&gt; BUILD, which means that
 34 # if you configure after you&#39;ve once build the BUILD-&gt;BUILD
 35 # compiler THAT one will be picked up as the compiler for itself.
 36 # This is not so great, especially if you did a partial delete
 37 # of the target tree.
 38 #
 39 # Fix this...
 40 #
 41 
 42 $(info TARGET=$(TARGET))
 43 $(info HOST=$(HOST))
 44 $(info BUILD=$(BUILD))
 45 
 46 ARCH := $(word 1,$(subst -, ,$(TARGET)))
 47 
 48 ifeq ($(TARGET), arm-linux-gnueabihf)
 49   ARCH=armhfp
 50 endif
 51 
 52 $(info ARCH=$(ARCH))
 53 
 54 ifeq ($(BASE_OS), OEL6)
 55   BASE_URL := http://yum.oracle.com/repo/OracleLinux/OL6/4/base/$(ARCH)/
 56   LINUX_VERSION := OEL6.4
 57 else ifeq ($(BASE_OS), Fedora)
 58   DEFAULT_OS_VERSION := 27
 59   ifeq ($(BASE_OS_VERSION), )
 60     BASE_OS_VERSION := $(DEFAULT_OS_VERSION)
 61   endif
 62   ifeq ($(filter x86_64 armhfp, $(ARCH)), )
 63     FEDORA_TYPE := fedora-secondary
 64   else
 65     FEDORA_TYPE := fedora/linux
 66   endif
 67   ARCHIVED := $(shell [ $(BASE_OS_VERSION) -lt $(DEFAULT_OS_VERSION) ] &amp;&amp; echo true)
 68   ifeq ($(ARCHIVED),true)
 69     BASE_URL := https://archives.fedoraproject.org/pub/archive/$(FEDORA_TYPE)/releases/$(BASE_OS_VERSION)/Everything/$(ARCH)/os/Packages/
 70   else
 71     BASE_URL := https://dl.fedoraproject.org/pub/$(FEDORA_TYPE)/releases/$(BASE_OS_VERSION)/Everything/$(ARCH)/os/Packages/
 72   endif
 73   LINUX_VERSION := Fedora_$(BASE_OS_VERSION)
 74 else
 75   $(error Unknown base OS $(BASE_OS))
 76 endif
 77 
 78 ##########################################################################################
 79 # Define external dependencies
 80 
 81 # Latest that could be made to work.
 82 GCC_VER := 7.3.0
 83 ifeq ($(GCC_VER), 7.3.0)
 84   gcc_ver := gcc-7.3.0
 85   binutils_ver := binutils-2.30
 86   ccache_ver := ccache-3.3.6
 87   mpfr_ver := mpfr-3.1.5
 88   gmp_ver := gmp-6.1.2
 89   mpc_ver := mpc-1.0.3
 90   gdb_ver := gdb-8.1
 91 else ifeq ($(GCC_VER), 4.9.2)
 92   gcc_ver := gcc-4.9.2
 93   binutils_ver := binutils-2.25
 94   ccache_ver := ccache-3.2.1
 95   mpfr_ver := mpfr-3.0.1
 96   gmp_ver := gmp-4.3.2
 97   mpc_ver := mpc-1.0.1
 98   gdb_ver := gdb-7.12.1
 99 else
100   $(error Unsupported GCC version)
101 endif
102 
103 GCC := http://ftp.gnu.org/pub/gnu/gcc/$(gcc_ver)/$(gcc_ver).tar.xz
104 BINUTILS := http://ftp.gnu.org/pub/gnu/binutils/$(binutils_ver).tar.xz
105 CCACHE := https://samba.org/ftp/ccache/$(ccache_ver).tar.xz
106 MPFR := https://www.mpfr.org/${mpfr_ver}/${mpfr_ver}.tar.bz2
107 GMP := http://ftp.gnu.org/pub/gnu/gmp/${gmp_ver}.tar.bz2
108 MPC := http://ftp.gnu.org/pub/gnu/mpc/${mpc_ver}.tar.gz
109 GDB := http://ftp.gnu.org/gnu/gdb/${gdb_ver}.tar.xz
110 
111 # RPMs used by all BASE_OS
112 RPM_LIST := \
113     kernel-headers \
114     glibc glibc-headers glibc-devel \
115     cups-libs cups-devel \
116     libX11 libX11-devel \
117     xorg-x11-proto-devel \
118     alsa-lib alsa-lib-devel \
119     libXext libXext-devel \
120     libXtst libXtst-devel \
121     libXrender libXrender-devel \
122     libXrandr libXrandr-devel \
123     freetype freetype-devel \
124     libXt libXt-devel \
125     libSM libSM-devel \
126     libICE libICE-devel \
127     libXi libXi-devel \
128     libXdmcp libXdmcp-devel \
129     libXau libXau-devel \
130     libgcc \
131     zlib zlib-devel \
132     libffi libffi-devel \
133     fontconfig fontconfig-devel \
134     systemtap-sdt-devel \
135     #
136 
137 ##########################################################################################
138 # Define common directories and files
139 
140 # Ensure we have 32-bit libs also for x64. We enable mixed-mode.
141 ifeq (x86_64,$(ARCH))
142   LIBDIRS := lib64 lib
143   CFLAGS_lib := -m32
144 else
145   LIBDIRS := lib
146 endif
147 
148 # Define directories
149 BUILDDIR := $(OUTPUT_ROOT)/$(HOST)/$(TARGET)
150 TARGETDIR := $(PREFIX)/$(TARGET)
151 SYSROOT := $(TARGETDIR)/sysroot
152 DOWNLOAD := $(OUTPUT_ROOT)/download
153 DOWNLOAD_RPMS := $(DOWNLOAD)/rpms/$(TARGET)-$(LINUX_VERSION)
154 SRCDIR := $(OUTPUT_ROOT)/src
155 
156 # Marker file for unpacking rpms
157 rpms := $(SYSROOT)/rpms_unpacked
158 
159 # Need to patch libs that are linker scripts to use non-absolute paths
160 libs := $(SYSROOT)/libs_patched
161 
162 ################################################################################
163 # Download RPMs
164 download-rpms:
165 	mkdir -p $(DOWNLOAD_RPMS)
166         # Only run this if rpm dir is empty.
167         ifeq ($(wildcard $(DOWNLOAD_RPMS)/*.rpm), )
168 	  cd $(DOWNLOAD_RPMS) &amp;&amp; \
169 	      wget -r -np -nd $(patsubst %, -A &quot;*%*.rpm&quot;, $(RPM_LIST)) $(BASE_URL)
170         endif
171 
172 ##########################################################################################
173 # Unpack source packages
174 
175 # Generate downloading + unpacking of sources.
176 define Download
177   $(1)_DIR = $(abspath $(SRCDIR)/$(basename $(basename $(notdir $($(1))))))
178   $(1)_CFG = $$($(1)_DIR)/configure
179   $(1)_FILE = $(DOWNLOAD)/$(notdir $($(1)))
180 
181   $$($(1)_CFG) : $$($(1)_FILE)
182 	mkdir -p $$(SRCDIR)
183 	tar -C $$(SRCDIR) -xf $$&lt;
184 	$$(foreach p,$$(abspath $$(wildcard $$(notdir $$($(1)_DIR)).patch)), \
185 	  echo PATCHING $$(p) ; \
186 	  patch -d $$($(1)_DIR) -p1 -i $$(p) ; \
187 	)
188 	touch $$@
189 
190   $$($(1)_FILE) :
191 	wget -P $(DOWNLOAD) $$($(1))
192 endef
193 
194 # Download and unpack all source packages
195 $(foreach p,GCC BINUTILS CCACHE MPFR GMP MPC GDB,$(eval $(call Download,$(p))))
196 
197 ##########################################################################################
198 # Unpack RPMS
199 
200 RPM_ARCHS := $(ARCH) noarch
201 ifeq ($(ARCH),x86_64)
202   ifeq ($(BUILD),$(HOST))
203     ifeq ($(TARGET),$(HOST))
204       # When building the native compiler for x86_64, enable mixed mode.
205       RPM_ARCHS += i386 i686
206     endif
207   endif
208 else ifeq ($(ARCH),i686)
209   RPM_ARCHS += i386
210 else ifeq ($(ARCH), armhfp)
211   RPM_ARCHS += armv7hl
212 endif
213 
214 RPM_FILE_LIST := $(sort $(foreach a, $(RPM_ARCHS), \
215   $(wildcard $(patsubst %,$(DOWNLOAD_RPMS)/%*$a.rpm,$(RPM_LIST))) \
216 ))
217 
218 # Note. For building linux you should install rpm2cpio.
219 define unrpm
220   $(SYSROOT)/$(notdir $(1)).unpacked : $(1)
221   $$(rpms) : $(SYSROOT)/$(notdir $(1)).unpacked
222 endef
223 
224 %.unpacked :
225 	$(info Unpacking target rpms and libraries from $&lt;)
226 	@(mkdir -p $(@D); \
227 	cd $(@D); \
228 	rpm2cpio $&lt; | \
229 	    cpio --extract --make-directories \
230 	        -f \
231 	        &quot;./usr/share/doc/*&quot; \
232 	        &quot;./usr/share/man/*&quot; \
233 	        &quot;./usr/X11R6/man/*&quot; \
234 	        &quot;*/X11/locale/*&quot; \
235 	    || die ; )
236 	touch $@
237 
238 $(foreach p,$(RPM_FILE_LIST),$(eval $(call unrpm,$(p))))
239 
240 ##########################################################################################
241 
242 # Note: MUST create a &lt;sysroot&gt;/usr/lib even if not really needed.
243 # gcc will use a path relative to it to resolve lib64. (x86_64).
244 # we&#39;re creating multi-lib compiler with 32bit libc as well, so we should
245 # have it anyway, but just to make sure...
246 # Patch libc.so and libpthread.so to force linking against libraries in sysroot
247 # and not the ones installed on the build machine.
248 $(libs) : $(rpms)
249 	@echo Patching libc and pthreads
250 	@(for f in `find $(SYSROOT) -name libc.so -o -name libpthread.so`; do \
251 	  (cat $$f | sed -e &#39;s|/usr/lib64/||g&#39; \
252 	      -e &#39;s|/usr/lib/||g&#39; \
253 	      -e &#39;s|/lib64/||g&#39; \
254 	      -e &#39;s|/lib/||g&#39; ) &gt; $$f.tmp ; \
255 	  mv $$f.tmp $$f ; \
256 	done)
257 	@mkdir -p $(SYSROOT)/usr/lib
258 	@touch $@
259 
260 ##########################################################################################
261 # Create links for ffi header files so that they become visible by default when using the
262 # devkit.
263 ifeq ($(ARCH), x86_64)
264   $(SYSROOT)/usr/include/ffi.h: $(rpms)
265 	cd $(@D) &amp;&amp; rm -f $(@F) &amp;&amp; ln -s ../lib/libffi-*/include/$(@F) .
266 
267   $(SYSROOT)/usr/include/ffitarget.h: $(rpms)
268 	cd $(@D) &amp;&amp; rm -f $(@F) &amp;&amp; ln -s ../lib/libffi-*/include/$(@F) .
269 
270   SYSROOT_LINKS += $(SYSROOT)/usr/include/ffi.h $(SYSROOT)/usr/include/ffitarget.h
271 endif
272 
273 ##########################################################################################
274 
275 # Define marker files for each source package to be compiled
276 $(foreach t,binutils mpfr gmp mpc gcc ccache gdb,$(eval $(t) = $(TARGETDIR)/$($(t)_ver).done))
277 
278 ##########################################################################################
279 
280 # Default base config
281 CONFIG = --target=$(TARGET) \
282     --host=$(HOST) --build=$(BUILD) \
283     --prefix=$(PREFIX)
284 
285 PATHEXT = $(PREFIX)/bin:
286 
287 PATHPRE = PATH=$(PATHEXT)$(PATH)
288 NUM_CORES := $(shell cat /proc/cpuinfo | grep -c processor)
289 BUILDPAR = -j$(NUM_CORES)
290 
291 # Default commands to when making
292 MAKECMD =
293 INSTALLCMD = install
294 
295 
296 declare_tools = CC$(1)=$(2)gcc LD$(1)=$(2)ld AR$(1)=$(2)ar AS$(1)=$(2)as RANLIB$(1)=$(2)ranlib CXX$(1)=$(2)g++ OBJDUMP$(1)=$(2)objdump
297 
298 ifeq ($(HOST),$(BUILD))
299   ifeq ($(HOST),$(TARGET))
300     TOOLS = $(call declare_tools,_FOR_TARGET,)
301   endif
302 endif
303 
304 TOOLS ?= $(call declare_tools,_FOR_TARGET,$(TARGET)-)
305 
306 ##########################################################################################
307 
308 # Create a TARGET bfd + libiberty only.
309 # Configure one or two times depending on mulitlib arch.
310 # If multilib, the second should be 32-bit, and we resolve
311 # CFLAG_&lt;name&gt; to most likely -m32.
312 define mk_bfd
313   $$(info Libs for $(1))
314   $$(BUILDDIR)/$$(binutils_ver)-$(subst /,-,$(1))/Makefile \
315       : CFLAGS += $$(CFLAGS_$(1))
316   $$(BUILDDIR)/$$(binutils_ver)-$(subst /,-,$(1))/Makefile \
317       : LIBDIRS = --libdir=$(TARGETDIR)/$(1)
318 
319   bfdlib += $$(TARGETDIR)/$$(binutils_ver)-$(subst /,-,$(1)).done
320   bfdmakes += $$(BUILDDIR)/$$(binutils_ver)-$(subst /,-,$(1))/Makefile
321 endef
322 
323 # Create one set of bfds etc for each multilib arch
324 $(foreach l,$(LIBDIRS),$(eval $(call mk_bfd,$(l))))
325 
326 # Only build these two libs.
327 $(bfdlib) : MAKECMD = all-libiberty all-bfd
328 $(bfdlib) : INSTALLCMD = install-libiberty install-bfd
329 
330 # Building targets libbfd + libiberty. HOST==TARGET, i.e not
331 # for a cross env.
332 $(bfdmakes) : CONFIG = --target=$(TARGET) \
333     --host=$(TARGET) --build=$(BUILD) \
334     --prefix=$(TARGETDIR) \
335     --with-sysroot=$(SYSROOT) \
336     $(LIBDIRS)
337 
338 $(bfdmakes) : TOOLS = $(call declare_tools,_FOR_TARGET,$(TARGET)-) $(call declare_tools,,$(TARGET)-)
339 
340 ##########################################################################################
341 
342 $(gcc) \
343     $(binutils) \
344     $(gmp) \
345     $(mpfr) \
346     $(mpc) \
347     $(bfdmakes) \
348     $(ccache) : ENVS += $(TOOLS)
349 
350 # libdir to work around hateful bfd stuff installing into wrong dirs...
351 # ensure we have 64 bit bfd support in the HOST library. I.e our
352 # compiler on i686 will know 64 bit symbols, BUT later
353 # we build just the libs again for TARGET, then with whatever the arch
354 # wants.
355 $(BUILDDIR)/$(binutils_ver)/Makefile : CONFIG += --enable-64-bit-bfd --libdir=$(PREFIX)/$(word 1,$(LIBDIRS))
356 
357 # Makefile creation. Simply run configure in build dir.
358 # Setting CFLAGS to -O2 generates a much faster ld.
359 $(bfdmakes) \
360 $(BUILDDIR)/$(binutils_ver)/Makefile \
361     : $(BINUTILS_CFG)
362 	$(info Configuring $@. Log in $(@D)/log.config)
363 	@mkdir -p $(@D)
364 	( \
365 	  cd $(@D) ; \
366 	  $(PATHPRE) $(ENVS) CFLAGS=&quot;-O2 $(CFLAGS)&quot; \
367 	      $(BINUTILS_CFG) \
368 	      $(CONFIG) \
369 	      --with-sysroot=$(SYSROOT) \
370 	      --disable-nls \
371 	      --program-prefix=$(TARGET)- \
372 	      --enable-multilib \
373 	      --enable-gold \
374 	      --enable-threads \
375 	      --enable-plugins \
376 	) &gt; $(@D)/log.config 2&gt;&amp;1
377 	@echo &#39;done&#39;
378 
379 $(BUILDDIR)/$(mpfr_ver)/Makefile \
380     : $(MPFR_CFG)
381 	$(info Configuring $@. Log in $(@D)/log.config)
382 	@mkdir -p $(@D)
383 	( \
384 	  cd $(@D) ; \
385 	  $(PATHPRE) $(ENVS) CFLAGS=&quot;$(CFLAGS)&quot; \
386 	      $(MPFR_CFG) \
387 	      $(CONFIG) \
388 	      --program-prefix=$(TARGET)- \
389 	      --enable-shared=no \
390 	      --with-gmp=$(PREFIX) \
391 	) &gt; $(@D)/log.config 2&gt;&amp;1
392 	@echo &#39;done&#39;
393 
394 $(BUILDDIR)/$(gmp_ver)/Makefile \
395     : $(GMP_CFG)
396 	$(info Configuring $@. Log in $(@D)/log.config)
397 	@mkdir -p $(@D)
398 	( \
399 	  cd $(@D) ; \
400 	  $(PATHPRE) $(ENVS) CFLAGS=&quot;$(CFLAGS)&quot; \
401 	      $(GMP_CFG) \
402 	      --host=$(HOST) --build=$(BUILD) \
403 	      --prefix=$(PREFIX) \
404 	      --disable-nls \
405 	      --program-prefix=$(TARGET)- \
406 	      --enable-shared=no \
407 	      --with-mpfr=$(PREFIX) \
408 	) &gt; $(@D)/log.config 2&gt;&amp;1
409 	@echo &#39;done&#39;
410 
411 $(BUILDDIR)/$(mpc_ver)/Makefile \
412     : $(MPC_CFG)
413 	$(info Configuring $@. Log in $(@D)/log.config)
414 	@mkdir -p $(@D)
415 	( \
416 	  cd $(@D) ; \
417 	  $(PATHPRE) $(ENVS) CFLAGS=&quot;$(CFLAGS)&quot; \
418 	      $(MPC_CFG) \
419 	      $(CONFIG) \
420 	      --program-prefix=$(TARGET)- \
421 	      --enable-shared=no \
422 	      --with-mpfr=$(PREFIX) \
423 	      --with-gmp=$(PREFIX) \
424 	) &gt; $(@D)/log.config 2&gt;&amp;1
425 	@echo &#39;done&#39;
426 
427 # Only valid if glibc target -&gt; linux
428 # proper destructor handling for c++
429 ifneq (,$(findstring linux,$(TARGET)))
430   $(BUILDDIR)/$(gcc_ver)/Makefile : CONFIG += --enable-__cxa_atexit
431 endif
432 
433 ifeq ($(ARCH), armhfp)
434   $(BUILDDIR)/$(gcc_ver)/Makefile : CONFIG +=  --with-float=hard
435 endif
436 
437 ifneq ($(filter ppc64 ppc64le s390x, $(ARCH)), )
438   # We only support 64-bit on these platforms anyway
439   CONFIG += --disable-multilib
440 endif
441 
442 # Want:
443 # c,c++
444 # shared libs
445 # multilib (-m32/-m64 on x64)
446 # skip native language.
447 # and link and assemble with the binutils we created
448 # earlier, so --with-gnu*
449 $(BUILDDIR)/$(gcc_ver)/Makefile \
450     : $(GCC_CFG)
451 	$(info Configuring $@. Log in $(@D)/log.config)
452 	mkdir -p $(@D)
453 	( \
454 	  cd $(@D) ; \
455 	  $(PATHPRE) $(ENVS) $(GCC_CFG) $(EXTRA_CFLAGS) \
456 	      $(CONFIG) \
457 	      --with-sysroot=$(SYSROOT) \
458 	      --enable-languages=c,c++ \
459 	      --enable-shared \
460 	      --disable-nls \
461 	      --with-gnu-as \
462 	      --with-gnu-ld \
463 	      --with-mpfr=$(PREFIX) \
464 	      --with-gmp=$(PREFIX) \
465 	      --with-mpc=$(PREFIX) \
466 	) &gt; $(@D)/log.config 2&gt;&amp;1
467 	@echo &#39;done&#39;
468 
469 # need binutils for gcc
470 $(gcc) : $(binutils)
471 
472 # as of 4.3 or so need these for doing config
473 $(BUILDDIR)/$(gcc_ver)/Makefile : $(gmp) $(mpfr) $(mpc)
474 $(mpfr) : $(gmp)
475 $(mpc) : $(gmp) $(mpfr)
476 
477 ################################################################################
478 # Build gdb but only where host and target match
479 ifeq ($(HOST), $(TARGET))
480   $(BUILDDIR)/$(gdb_ver)/Makefile: $(GDB_CFG)
481 	$(info Configuring $@. Log in $(@D)/log.config)
482 	mkdir -p $(@D)
483 	( \
484 	  cd $(@D) ; \
485 	  $(PATHPRE) $(ENVS) CFLAGS=&quot;$(CFLAGS)&quot; $(GDB_CFG) \
486 	      $(CONFIG) \
487 	      --with-sysroot=$(SYSROOT) \
488 	) &gt; $(@D)/log.config 2&gt;&amp;1
489 	@echo &#39;done&#39;
490 
491   $(gdb): $(gcc)
492 else
493   $(BUILDDIR)/$(gdb_ver)/Makefile:
494 	$(info Faking $@, not used when cross-compiling)
495 	mkdir -p $(@D)
496 	echo &quot;install:&quot; &gt; $@
497 	@echo &#39;done&#39;
498 endif
499 
500 ##########################################################################################
501 # very straightforward. just build a ccache. it is only for host.
502 $(BUILDDIR)/$(ccache_ver)/Makefile \
503     : $(CCACHE_CFG)
504 	$(info Configuring $@. Log in $(@D)/log.config)
505 	@mkdir -p $(@D)
506 	@( \
507 	  cd $(@D) ; \
508 	  $(PATHPRE) $(ENVS) $(CCACHE_CFG) \
509 	      $(CONFIG) \
510 	) &gt; $(@D)/log.config 2&gt;&amp;1
511 	@echo &#39;done&#39;
512 
513 gccpatch = $(TARGETDIR)/gcc-patched
514 
515 ##########################################################################################
516 # For some reason cpp is not created as a target-compiler
517 ifeq ($(HOST),$(TARGET))
518   $(gccpatch) : $(gcc) link_libs
519 	@echo -n &#39;Creating compiler symlinks...&#39;
520 	@for f in cpp; do \
521 	  if [ ! -e $(PREFIX)/bin/$(TARGET)-$$f ]; \
522 	  then \
523 	    cd $(PREFIX)/bin &amp;&amp; \
524 	    ln -fs $$f $(TARGET)-$$f ; \
525 	  fi \
526 	done
527 	@touch $@
528 	@echo &#39;done&#39;
529 
530   ##########################################################################################
531   # Ugly at best. Seems that when we compile host-&gt;host compiler, that are NOT
532   # the BUILD compiler, the result will not try searching for libs in package root.
533   # &quot;Solve&quot; this by create links from the target libdirs to where they are.
534   link_libs:
535 	@echo -n &#39;Creating library symlinks...&#39;
536 	@$(foreach l,$(LIBDIRS), \
537 	for f in `cd $(PREFIX)/$(l) &amp;&amp; ls`; do \
538 	  if [ ! -e $(TARGETDIR)/$(l)/$$f ]; then \
539 	    mkdir -p $(TARGETDIR)/$(l) &amp;&amp; \
540 	    cd $(TARGETDIR)/$(l)/ &amp;&amp; \
541 	    ln -fs $(if $(findstring /,$(l)),../,)../../$(l)/$$f $$f; \
542 	  fi \
543 	done;)
544 	@echo &#39;done&#39;
545 else
546   $(gccpatch) :
547 	@echo &#39;done&#39;
548 endif
549 
550 ##########################################################################################
551 # Build in two steps.
552 # make &lt;default&gt;
553 # make install.
554 # Use path to our build hosts cross tools
555 # Always need to build cross tools for build host self.
556 $(TARGETDIR)/%.done : $(BUILDDIR)/%/Makefile
557 	$(info Building $(basename $@). Log in $(&lt;D)/log.build)
558 	$(PATHPRE) $(ENVS) $(MAKE) $(BUILDPAR) -f $&lt; -C $(&lt;D) $(MAKECMD) $(MAKECMD.$(notdir $@)) &gt; $(&lt;D)/log.build 2&gt;&amp;1
559 	@echo -n &#39;installing...&#39;
560 	$(PATHPRE) $(MAKE) $(INSTALLPAR) -f $&lt; -C $(&lt;D) $(INSTALLCMD) $(MAKECMD.$(notdir $@)) &gt; $(&lt;D)/log.install 2&gt;&amp;1
561 	@mkdir -p $(@D)
562 	@touch $@
563 	@echo &#39;done&#39;
564 
565 ##########################################################################################
566 
567 $(PREFIX)/devkit.info:
568 	@echo &#39;Creating devkit.info in the root of the kit&#39;
569 	rm -f $@
570 	touch $@
571 	echo &#39;# This file describes to configure how to interpret the contents of this&#39; &gt;&gt; $@
572 	echo &#39;# devkit&#39; &gt;&gt; $@
573 	echo &#39;&#39; &gt;&gt; $@
574 	echo &#39;DEVKIT_NAME=&quot;$(gcc_ver) - $(LINUX_VERSION)&quot;&#39; &gt;&gt; $@
575 	echo &#39;DEVKIT_TOOLCHAIN_PATH=&quot;$$DEVKIT_ROOT/bin&quot;&#39; &gt;&gt; $@
576 	echo &#39;DEVKIT_SYSROOT=&quot;$$DEVKIT_ROOT/$(TARGET)/sysroot&quot;&#39; &gt;&gt; $@
577 	echo &#39;DEVKIT_EXTRA_PATH=&quot;$$DEVKIT_ROOT/bin&quot;&#39; &gt;&gt; $@
578 
579 ##########################################################################################
580 # Copy these makefiles into the root of the kit
581 $(PREFIX)/Makefile: ./Makefile
582 	rm -rf $@
583 	cp $&lt; $@
584 
585 $(PREFIX)/Tools.gmk: ./Tools.gmk
586 	rm -rf $@
587 	cp $&lt; $@
588 
589 THESE_MAKEFILES := $(PREFIX)/Makefile $(PREFIX)/Tools.gmk
590 
591 ##########################################################################################
592 
593 ifeq ($(TARGET), $(HOST))
594   # To build with dtrace support, the build needs access to the dtrace executable from the
595   # sysroot. Generally we don&#39;t want to add binaries in the sysroot to the path, but
596   # luckily this seems to execute well enough on a different host Linux distro, so symlink
597   # it into the main bin dir.
598   $(PREFIX)/bin/dtrace:
599 	@echo &#39;Creating dtrace soft link&#39;
600 	ln -s ../$(HOST)/sysroot/usr/bin/dtrace $@
601 
602   $(PREFIX)/bin/%:
603 	@echo &#39;Creating missing $* soft link&#39;
604 	ln -s $(TARGET)-$* $@
605 
606   missing-links := $(addprefix $(PREFIX)/bin/, \
607       addr2line ar as c++ c++filt dwp elfedit g++ gcc gcc-$(GCC_VER) gprof ld ld.bfd \
608       ld.gold nm objcopy objdump ranlib readelf size strings strip)
609 endif
610 
611 ##########################################################################################
612 
613 bfdlib : $(bfdlib)
614 binutils : $(binutils)
615 rpms : $(rpms)
616 libs : $(libs)
617 sysroot : rpms libs
618 gcc : sysroot $(gcc) $(gccpatch)
619 gdb : $(gdb)
620 all : binutils gcc bfdlib $(PREFIX)/devkit.info $(missing-links) $(SYSROOT_LINKS) \
621     $(THESE_MAKEFILES) gdb
622 
623 # this is only built for host. so separate.
624 ccache : $(ccache)
625 
626 .PHONY : gcc all binutils bfdlib link_libs rpms libs sysroot
    </pre>
  </body>
</html>