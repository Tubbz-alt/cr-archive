<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff make/devkit/Makefile</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../data/unicodedata/VERSION.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Tools.gmk.udiff.html" target="_top">next &gt;</a></center>    <h2>make/devkit/Makefile</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -27,18 +27,14 @@</span>
  #
  # This Makefile, together with Tools.gmk, can be used to compile a set of
  # gcc based cross compilation, portable, self contained packages, capable
  # of building OpenJDK.
  #
<span class="udiff-line-removed">- # In addition to the makefiles, access to Oracle Linux installation</span>
<span class="udiff-line-removed">- # media is required. This has been tested against Oracle Enterprise Linux</span>
<span class="udiff-line-removed">- # 6.4.</span>
<span class="udiff-line-removed">- #</span>
  # By default this Makefile will build a native toolchain for the current
  # platform if called with something like this:
  #
<span class="udiff-line-modified-removed">- # make tars BASE_OS=OEL6</span>
<span class="udiff-line-modified-added">+ # make tars BASE_OS=OL</span>
  #
  # To build the full set of crosstools for additional platforms, use a command
  # line looking like this:
  #
  # make TARGETS=&quot;aarch64-linux-gnu&quot; BASE_OS=Fedora
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -46,13 +42,23 @@</span>
  # make TARGETS=&quot;arm-linux-gnueabihf ppc64-linux-gnu&quot; BASE_OS=Fedora BASE_OS_VERSION=17
  #
  # to build several devkits for a specific OS version at once.
  # You can find the final results under ../../build/devkit/result/&lt;host&gt;-to-&lt;target&gt;
  #
<span class="udiff-line-added">+ # You may want the native toolchain to be used when compiling the cross</span>
<span class="udiff-line-added">+ # compilation toolchains. To achieve this, first build the native toolchain,</span>
<span class="udiff-line-added">+ # then add the bin directory from this build to the path when invoking this</span>
<span class="udiff-line-added">+ # makefile again for cross compilation. Ex:</span>
<span class="udiff-line-added">+ #</span>
<span class="udiff-line-added">+ # PATH=$PWD/../../build/devkit/result/x86_64-linux-gnu-to-x86_64-linux-gnu/bin:$PATH \</span>
<span class="udiff-line-added">+ #    make TARGETS=&quot;arm-linux-gnueabihf,ppc64-linux-gnu&quot; BASE_OS=Fedora</span>
<span class="udiff-line-added">+ #</span>
  # This is the makefile which iterates over all host and target platforms.
  #
  
<span class="udiff-line-added">+ COMMA := ,</span>
<span class="udiff-line-added">+ </span>
  os := $(shell uname -o)
  cpu := $(shell uname -p)
  
  # Figure out what platform this is building on.
  me := $(cpu)-$(if $(findstring Linux,$(os)),linux-gnu)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -64,11 +70,11 @@</span>
  #
  ifeq ($(TARGETS), )
    platforms := $(me)
    host_platforms := $(platforms)
  else
<span class="udiff-line-modified-removed">-   platforms := $(TARGETS)</span>
<span class="udiff-line-modified-added">+   platforms := $(subst $(COMMA), , $(TARGETS))</span>
    host_platforms := $(me)
  endif
  target_platforms := $(platforms)
  $(info host_platforms $(host_platforms))
  $(info target_platforms $(target_platforms))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -91,31 +97,28 @@</span>
  	  $(MAKE) -f Tools.gmk download-rpms $(submakevars) \
                TARGET=$$p PREFIX=$(RESULT)/$@-to-$$p &amp;&amp; \
  	  $(MAKE) -f Tools.gmk all $(submakevars) \
                TARGET=$$p PREFIX=$(RESULT)/$@-to-$$p &amp;&amp; \
  	  $(MAKE) -f Tools.gmk ccache $(submakevars) \
<span class="udiff-line-modified-removed">-               TARGET=$@ PREFIX=$(RESULT)/$@-to-$$p BUILDDIR=$(OUTPUT_ROOT)/$@/$$p || exit 1 ; \</span>
<span class="udiff-line-modified-added">+               TARGET=$@ PREFIX=$(RESULT)/$@-to-$$p || exit 1 ; \</span>
  	done
  	@echo &#39;All done&quot;&#39;
  
  today := $(shell date +%Y%m%d)
  
  define Mktar
    $(1)-to-$(2)_tar = $$(RESULT)/sdk-$(1)-to-$(2)-$$(today).tar.gz
    $$($(1)-to-$(2)_tar) : PLATFORM = $(1)-to-$(2)
    TARFILES += $$($(1)-to-$(2)_tar)
<span class="udiff-line-removed">-   $$($(1)-to-$(2)_tar) : $$(shell find $$(RESULT)/$(1)-to-$(2) -type f)</span>
  endef
  
  $(foreach p,$(host_platforms),$(foreach t,$(target_platforms),$(eval $(call Mktar,$(p),$(t)))))
  
  tars : all $(TARFILES)
  onlytars : $(TARFILES)
  %.tar.gz :
<span class="udiff-line-modified-removed">- 	@echo &#39;Creating compiler package $@&#39;</span>
<span class="udiff-line-removed">- 	cd $(RESULT) &amp;&amp; tar -czf $@ $(PLATFORM)/*</span>
<span class="udiff-line-removed">- 	touch $@</span>
<span class="udiff-line-modified-added">+ 	$(MAKE) -r -f Tars.gmk SRC_DIR=$(RESULT)/$(PLATFORM) TAR_FILE=$@</span>
  
  clean :
  	rm -rf $(addprefix ../../build/devkit/, result $(host_platforms))
  dist-clean: clean
  	rm -rf $(addprefix ../../build/devkit/, src download)
</pre>
<center><a href="../data/unicodedata/VERSION.udiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Tools.gmk.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>