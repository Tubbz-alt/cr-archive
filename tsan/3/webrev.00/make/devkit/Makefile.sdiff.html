<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/devkit/Makefile</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../data/unicodedata/VERSION.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Tools.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/devkit/Makefile</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ################################################################################
 27 #
 28 # This Makefile, together with Tools.gmk, can be used to compile a set of
 29 # gcc based cross compilation, portable, self contained packages, capable
 30 # of building OpenJDK.
 31 #
<span class="line-removed"> 32 # In addition to the makefiles, access to Oracle Linux installation</span>
<span class="line-removed"> 33 # media is required. This has been tested against Oracle Enterprise Linux</span>
<span class="line-removed"> 34 # 6.4.</span>
<span class="line-removed"> 35 #</span>
 36 # By default this Makefile will build a native toolchain for the current
 37 # platform if called with something like this:
 38 #
<span class="line-modified"> 39 # make tars BASE_OS=OEL6</span>
 40 #
 41 # To build the full set of crosstools for additional platforms, use a command
 42 # line looking like this:
 43 #
 44 # make TARGETS=&quot;aarch64-linux-gnu&quot; BASE_OS=Fedora
 45 # or
 46 # make TARGETS=&quot;arm-linux-gnueabihf ppc64-linux-gnu&quot; BASE_OS=Fedora BASE_OS_VERSION=17
 47 #
 48 # to build several devkits for a specific OS version at once.
 49 # You can find the final results under ../../build/devkit/result/&lt;host&gt;-to-&lt;target&gt;
 50 #








 51 # This is the makefile which iterates over all host and target platforms.
 52 #
 53 


 54 os := $(shell uname -o)
 55 cpu := $(shell uname -p)
 56 
 57 # Figure out what platform this is building on.
 58 me := $(cpu)-$(if $(findstring Linux,$(os)),linux-gnu)
 59 
 60 $(info Building on platform $(me))
 61 
 62 #
 63 # By default just build for the current platform, which is assumed to be Linux
 64 #
 65 ifeq ($(TARGETS), )
 66   platforms := $(me)
 67   host_platforms := $(platforms)
 68 else
<span class="line-modified"> 69   platforms := $(TARGETS)</span>
 70   host_platforms := $(me)
 71 endif
 72 target_platforms := $(platforms)
 73 $(info host_platforms $(host_platforms))
 74 $(info target_platforms $(target_platforms))
 75 
 76 all compile : $(platforms)
 77 
 78 ifeq (,$(SKIP_ME))
 79   $(foreach p,$(filter-out $(me),$(platforms)),$(eval $(p) : $$(me)))
 80 endif
 81 
 82 OUTPUT_ROOT = $(abspath ../../build/devkit)
 83 RESULT = $(OUTPUT_ROOT)/result
 84 
 85 submakevars = HOST=$@ BUILD=$(me) RESULT=$(RESULT) OUTPUT_ROOT=$(OUTPUT_ROOT)
 86 
 87 $(host_platforms) :
 88 	@echo &#39;Building compilers for $@&#39;
 89 	@echo &#39;Targets: $(target_platforms)&#39;
 90 	for p in $(filter $@, $(target_platforms)) $(filter-out $@, $(target_platforms)); do \
 91 	  $(MAKE) -f Tools.gmk download-rpms $(submakevars) \
 92               TARGET=$$p PREFIX=$(RESULT)/$@-to-$$p &amp;&amp; \
 93 	  $(MAKE) -f Tools.gmk all $(submakevars) \
 94               TARGET=$$p PREFIX=$(RESULT)/$@-to-$$p &amp;&amp; \
 95 	  $(MAKE) -f Tools.gmk ccache $(submakevars) \
<span class="line-modified"> 96               TARGET=$@ PREFIX=$(RESULT)/$@-to-$$p BUILDDIR=$(OUTPUT_ROOT)/$@/$$p || exit 1 ; \</span>
 97 	done
 98 	@echo &#39;All done&quot;&#39;
 99 
100 today := $(shell date +%Y%m%d)
101 
102 define Mktar
103   $(1)-to-$(2)_tar = $$(RESULT)/sdk-$(1)-to-$(2)-$$(today).tar.gz
104   $$($(1)-to-$(2)_tar) : PLATFORM = $(1)-to-$(2)
105   TARFILES += $$($(1)-to-$(2)_tar)
<span class="line-removed">106   $$($(1)-to-$(2)_tar) : $$(shell find $$(RESULT)/$(1)-to-$(2) -type f)</span>
107 endef
108 
109 $(foreach p,$(host_platforms),$(foreach t,$(target_platforms),$(eval $(call Mktar,$(p),$(t)))))
110 
111 tars : all $(TARFILES)
112 onlytars : $(TARFILES)
113 %.tar.gz :
<span class="line-modified">114 	@echo &#39;Creating compiler package $@&#39;</span>
<span class="line-removed">115 	cd $(RESULT) &amp;&amp; tar -czf $@ $(PLATFORM)/*</span>
<span class="line-removed">116 	touch $@</span>
117 
118 clean :
119 	rm -rf $(addprefix ../../build/devkit/, result $(host_platforms))
120 dist-clean: clean
121 	rm -rf $(addprefix ../../build/devkit/, src download)
122 
123 FORCE :
124 .PHONY : all compile tars $(configs) $(host_platforms) clean dist-clean
</pre>
</td>
<td>
<hr />
<pre>
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ################################################################################
 27 #
 28 # This Makefile, together with Tools.gmk, can be used to compile a set of
 29 # gcc based cross compilation, portable, self contained packages, capable
 30 # of building OpenJDK.
 31 #




 32 # By default this Makefile will build a native toolchain for the current
 33 # platform if called with something like this:
 34 #
<span class="line-modified"> 35 # make tars BASE_OS=OL</span>
 36 #
 37 # To build the full set of crosstools for additional platforms, use a command
 38 # line looking like this:
 39 #
 40 # make TARGETS=&quot;aarch64-linux-gnu&quot; BASE_OS=Fedora
 41 # or
 42 # make TARGETS=&quot;arm-linux-gnueabihf ppc64-linux-gnu&quot; BASE_OS=Fedora BASE_OS_VERSION=17
 43 #
 44 # to build several devkits for a specific OS version at once.
 45 # You can find the final results under ../../build/devkit/result/&lt;host&gt;-to-&lt;target&gt;
 46 #
<span class="line-added"> 47 # You may want the native toolchain to be used when compiling the cross</span>
<span class="line-added"> 48 # compilation toolchains. To achieve this, first build the native toolchain,</span>
<span class="line-added"> 49 # then add the bin directory from this build to the path when invoking this</span>
<span class="line-added"> 50 # makefile again for cross compilation. Ex:</span>
<span class="line-added"> 51 #</span>
<span class="line-added"> 52 # PATH=$PWD/../../build/devkit/result/x86_64-linux-gnu-to-x86_64-linux-gnu/bin:$PATH \</span>
<span class="line-added"> 53 #    make TARGETS=&quot;arm-linux-gnueabihf,ppc64-linux-gnu&quot; BASE_OS=Fedora</span>
<span class="line-added"> 54 #</span>
 55 # This is the makefile which iterates over all host and target platforms.
 56 #
 57 
<span class="line-added"> 58 COMMA := ,</span>
<span class="line-added"> 59 </span>
 60 os := $(shell uname -o)
 61 cpu := $(shell uname -p)
 62 
 63 # Figure out what platform this is building on.
 64 me := $(cpu)-$(if $(findstring Linux,$(os)),linux-gnu)
 65 
 66 $(info Building on platform $(me))
 67 
 68 #
 69 # By default just build for the current platform, which is assumed to be Linux
 70 #
 71 ifeq ($(TARGETS), )
 72   platforms := $(me)
 73   host_platforms := $(platforms)
 74 else
<span class="line-modified"> 75   platforms := $(subst $(COMMA), , $(TARGETS))</span>
 76   host_platforms := $(me)
 77 endif
 78 target_platforms := $(platforms)
 79 $(info host_platforms $(host_platforms))
 80 $(info target_platforms $(target_platforms))
 81 
 82 all compile : $(platforms)
 83 
 84 ifeq (,$(SKIP_ME))
 85   $(foreach p,$(filter-out $(me),$(platforms)),$(eval $(p) : $$(me)))
 86 endif
 87 
 88 OUTPUT_ROOT = $(abspath ../../build/devkit)
 89 RESULT = $(OUTPUT_ROOT)/result
 90 
 91 submakevars = HOST=$@ BUILD=$(me) RESULT=$(RESULT) OUTPUT_ROOT=$(OUTPUT_ROOT)
 92 
 93 $(host_platforms) :
 94 	@echo &#39;Building compilers for $@&#39;
 95 	@echo &#39;Targets: $(target_platforms)&#39;
 96 	for p in $(filter $@, $(target_platforms)) $(filter-out $@, $(target_platforms)); do \
 97 	  $(MAKE) -f Tools.gmk download-rpms $(submakevars) \
 98               TARGET=$$p PREFIX=$(RESULT)/$@-to-$$p &amp;&amp; \
 99 	  $(MAKE) -f Tools.gmk all $(submakevars) \
100               TARGET=$$p PREFIX=$(RESULT)/$@-to-$$p &amp;&amp; \
101 	  $(MAKE) -f Tools.gmk ccache $(submakevars) \
<span class="line-modified">102               TARGET=$@ PREFIX=$(RESULT)/$@-to-$$p || exit 1 ; \</span>
103 	done
104 	@echo &#39;All done&quot;&#39;
105 
106 today := $(shell date +%Y%m%d)
107 
108 define Mktar
109   $(1)-to-$(2)_tar = $$(RESULT)/sdk-$(1)-to-$(2)-$$(today).tar.gz
110   $$($(1)-to-$(2)_tar) : PLATFORM = $(1)-to-$(2)
111   TARFILES += $$($(1)-to-$(2)_tar)

112 endef
113 
114 $(foreach p,$(host_platforms),$(foreach t,$(target_platforms),$(eval $(call Mktar,$(p),$(t)))))
115 
116 tars : all $(TARFILES)
117 onlytars : $(TARFILES)
118 %.tar.gz :
<span class="line-modified">119 	$(MAKE) -r -f Tars.gmk SRC_DIR=$(RESULT)/$(PLATFORM) TAR_FILE=$@</span>


120 
121 clean :
122 	rm -rf $(addprefix ../../build/devkit/, result $(host_platforms))
123 dist-clean: clean
124 	rm -rf $(addprefix ../../build/devkit/, src download)
125 
126 FORCE :
127 .PHONY : all compile tars $(configs) $(host_platforms) clean dist-clean
</pre>
</td>
</tr>
</table>
<center><a href="../data/unicodedata/VERSION.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="Tools.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>