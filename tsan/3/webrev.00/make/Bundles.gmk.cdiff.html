<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff make/Bundles.gmk</title>
    <link rel="stylesheet" href="../style.css" />
  </head>
<body>
<center><a href="../doc/testing.md.cdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="CompileDemos.gmk.cdiff.html" target="_top">next &gt;</a></center>    <h2>make/Bundles.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  #
<span class="line-modified">! # Copyright (c) 2016, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  #
<span class="line-modified">! # Copyright (c) 2016, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  #
  # This code is free software; you can redistribute it and/or modify it
  # under the terms of the GNU General Public License version 2 only, as
  # published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 27,10 ***</span>
<span class="line-new-header">--- 27,11 ---</span>
  
  include $(SPEC)
  include MakeBase.gmk
  
  PRODUCT_TARGETS :=
<span class="line-added">+ LEGACY_TARGETS :=</span>
  TEST_TARGETS :=
  DOCS_TARGETS :=
  
  # On Windows tar frequently complains that &quot;file changed as we read it&quot; for
  # some random source files. This seems to be cause by anti virus scanners and
</pre>
<hr />
<pre>
<span class="line-old-header">*** 47,10 ***</span>
<span class="line-new-header">--- 48,11 ---</span>
  # SPECIAL_INCLUDES : List of directories inside BASE_DIRS to look for additional
  #     files in. These files will not get proper dependency handling. Use when
  #     files or directories may contain spaces.
  # BASE_DIRS : Base directories for the root dir in the bundle.
  # SUBDIR : Optional name of root dir in bundle.
<span class="line-added">+ # OUTPUTDIR : Optionally override output dir</span>
  SetupBundleFile = $(NamedParamsMacroTemplate)
  define SetupBundleFileBody
  
    $$(foreach d, $$($1_BASE_DIRS), \
      $$(eval $1_$$d_RELATIVE_FILES := $$$$(patsubst $$d/%, %, \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 67,13 ***</span>
      $$(error Unknown bundle type $$($1_BUNDLE_NAME))
    endif
  
    $$(call SetIfEmpty, $1_UNZIP_DEBUGINFO, false)
  
<span class="line-modified">!   $(BUNDLES_OUTPUTDIR)/$$($1_BUNDLE_NAME): $$($1_FILES)</span>
  	$$(call MakeTargetDir)
<span class="line-modified">!         # If any of the files contain a space in the file name, CacheFind</span>
          # will have replaced it with ?. Tar does not accept that so need to
          # switch it back.
  	$$(foreach d, $$($1_BASE_DIRS), \
  	  $$(eval $$(call ListPathsSafely, \
  	      $1_$$d_RELATIVE_FILES, $$($1_$$d_LIST_FILE))) \
<span class="line-new-header">--- 69,16 ---</span>
      $$(error Unknown bundle type $$($1_BUNDLE_NAME))
    endif
  
    $$(call SetIfEmpty, $1_UNZIP_DEBUGINFO, false)
  
<span class="line-modified">!   $$(call SetIfEmpty, $1_OUTPUTDIR, $$(BUNDLES_OUTPUTDIR))</span>
<span class="line-added">+ </span>
<span class="line-added">+   $$($1_OUTPUTDIR)/$$($1_BUNDLE_NAME): $$($1_FILES)</span>
  	$$(call MakeTargetDir)
<span class="line-modified">! 	$$(call LogWarn, Creating $$($1_BUNDLE_NAME))</span>
<span class="line-added">+         # If any of the files contain a space in the file name, FindFiles</span>
          # will have replaced it with ?. Tar does not accept that so need to
          # switch it back.
  	$$(foreach d, $$($1_BASE_DIRS), \
  	  $$(eval $$(call ListPathsSafely, \
  	      $1_$$d_RELATIVE_FILES, $$($1_$$d_LIST_FILE))) \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 134,45 ***</span>
            else ifeq ($$($1_TYPE), zip)
  	    $(CD) $(SUPPORT_OUTPUTDIR)/bundles/$1 &amp;&amp; $(ZIPEXE) -qr $$@ .
            endif
          endif
  
<span class="line-modified">!   $1 += $(BUNDLES_OUTPUTDIR)/$$($1_BUNDLE_NAME)</span>
  
  endef
  
  ################################################################################
  
  # On Macosx, we bundle up the macosx specific images which already have the
  # correct base directories.
  ifeq ($(call isTargetOs, macosx)+$(DEBUG_LEVEL), true+release)
    JDK_IMAGE_DIR := $(JDK_MACOSX_BUNDLE_DIR)
    JDK_IMAGE_HOMEDIR := $(JDK_MACOSX_CONTENTS_DIR)/Home
    JDK_BUNDLE_SUBDIR :=
  else
    JDK_IMAGE_HOMEDIR := $(JDK_IMAGE_DIR)
    JDK_BUNDLE_SUBDIR := jdk-$(VERSION_NUMBER)
    ifneq ($(DEBUG_LEVEL), release)
      JDK_BUNDLE_SUBDIR := $(JDK_BUNDLE_SUBDIR)/$(DEBUG_LEVEL)
    endif
  endif
  
  ################################################################################
  
<span class="line-modified">! ifneq ($(filter product-bundles, $(MAKECMDGOALS)), )</span>
<span class="line-removed">-   $(eval $(call FillCacheFind, $(IMAGES_OUTPUTDIR)))</span>
  
    SYMBOLS_EXCLUDE_PATTERN := %.debuginfo %.diz %.pdb %.map
  
<span class="line-modified">!   ALL_JDK_FILES := $(call CacheFind, $(JDK_IMAGE_DIR))</span>
  
    # Create special filter rules when dealing with unzipped .dSYM directories on
    # macosx
    ifeq ($(call isTargetOs, macosx), true)
      ifeq ($(ZIP_EXTERNAL_DEBUG_SYMBOLS), false)
        JDK_SYMBOLS_EXCLUDE_PATTERN := $(addprefix %, \
<span class="line-modified">!           $(call containing, .dSYM/, $(patsubst $(JDK_IMAGE_DIR)/%, %, $(ALL_JDK_FILES))))</span>
      endif
    endif
  
    JDK_BUNDLE_FILES := \
        $(filter-out \
<span class="line-new-header">--- 139,75 ---</span>
            else ifeq ($$($1_TYPE), zip)
  	    $(CD) $(SUPPORT_OUTPUTDIR)/bundles/$1 &amp;&amp; $(ZIPEXE) -qr $$@ .
            endif
          endif
  
<span class="line-modified">!   $1 += $$($1_OUTPUTDIR)/$$($1_BUNDLE_NAME)</span>
  
  endef
  
  ################################################################################
  
  # On Macosx, we bundle up the macosx specific images which already have the
  # correct base directories.
  ifeq ($(call isTargetOs, macosx)+$(DEBUG_LEVEL), true+release)
    JDK_IMAGE_DIR := $(JDK_MACOSX_BUNDLE_DIR)
<span class="line-added">+   JRE_IMAGE_DIR := $(JRE_MACOSX_BUNDLE_DIR)</span>
    JDK_IMAGE_HOMEDIR := $(JDK_MACOSX_CONTENTS_DIR)/Home
<span class="line-added">+   JRE_IMAGE_HOMEDIR := $(JRE_MACOSX_CONTENTS_DIR)/Home</span>
    JDK_BUNDLE_SUBDIR :=
<span class="line-added">+   JRE_BUNDLE_SUBDIR :=</span>
<span class="line-added">+   # In certain situations, the JDK_IMAGE_DIR points to an image without the</span>
<span class="line-added">+   # the symbols and demos. If so, the symobls and demos can be found in a</span>
<span class="line-added">+   # separate image. These variables allow for overriding from a custom makefile.</span>
<span class="line-added">+   JDK_SYMBOLS_IMAGE_DIR ?= $(JDK_IMAGE_DIR)</span>
<span class="line-added">+   JDK_DEMOS_IMAGE_DIR ?= $(JDK_IMAGE_DIR)</span>
<span class="line-added">+   JDK_DEMOS_IMAGE_HOMEDIR ?= $(JDK_DEMOS_IMAGE_DIR)/$(JDK_MACOSX_CONTENTS_SUBDIR)/Home</span>
  else
    JDK_IMAGE_HOMEDIR := $(JDK_IMAGE_DIR)
<span class="line-added">+   JRE_IMAGE_HOMEDIR := $(JRE_IMAGE_DIR)</span>
    JDK_BUNDLE_SUBDIR := jdk-$(VERSION_NUMBER)
<span class="line-added">+   JRE_BUNDLE_SUBDIR := jre-$(VERSION_NUMBER)</span>
    ifneq ($(DEBUG_LEVEL), release)
      JDK_BUNDLE_SUBDIR := $(JDK_BUNDLE_SUBDIR)/$(DEBUG_LEVEL)
<span class="line-added">+     JRE_BUNDLE_SUBDIR := $(JRE_BUNDLE_SUBDIR)/$(DEBUG_LEVEL)</span>
    endif
<span class="line-added">+   # In certain situations, the JDK_IMAGE_DIR points to an image without the</span>
<span class="line-added">+   # the symbols and demos. If so, the symobls and demos can be found in a</span>
<span class="line-added">+   # separate image. These variables allow for overriding from a custom makefile.</span>
<span class="line-added">+   JDK_SYMBOLS_IMAGE_DIR ?= $(JDK_IMAGE_DIR)</span>
<span class="line-added">+   JDK_DEMOS_IMAGE_DIR ?= $(JDK_IMAGE_DIR)</span>
<span class="line-added">+   JDK_DEMOS_IMAGE_HOMEDIR ?= $(JDK_DEMOS_IMAGE_DIR)</span>
  endif
  
  ################################################################################
  
<span class="line-modified">! ifneq ($(filter product-bundles% legacy-bundles, $(MAKECMDGOALS)), )</span>
  
    SYMBOLS_EXCLUDE_PATTERN := %.debuginfo %.diz %.pdb %.map
  
<span class="line-modified">!   # There may be files with spaces in the names, so use ShellFindFiles</span>
<span class="line-added">+   # explicitly.</span>
<span class="line-added">+   ALL_JDK_FILES := $(call ShellFindFiles, $(JDK_IMAGE_DIR))</span>
<span class="line-added">+   ifneq ($(JDK_IMAGE_DIR), $(JDK_SYMBOLS_IMAGE_DIR))</span>
<span class="line-added">+     ALL_JDK_SYMBOLS_FILES := $(call ShellFindFiles, $(JDK_SYMBOLS_IMAGE_DIR))</span>
<span class="line-added">+   else</span>
<span class="line-added">+     ALL_JDK_SYMBOLS_FILES := $(ALL_JDK_FILES)</span>
<span class="line-added">+   endif</span>
<span class="line-added">+   ifneq ($(JDK_IMAGE_DIR), $(JDK_DEMOS_IMAGE_DIR))</span>
<span class="line-added">+     ALL_JDK_DEMOS_FILES := $(call ShellFindFiles, $(JDK_DEMOS_IMAGE_DIR))</span>
<span class="line-added">+   else</span>
<span class="line-added">+     ALL_JDK_DEMOS_FILES := $(ALL_JDK_FILES)</span>
<span class="line-added">+   endif</span>
  
    # Create special filter rules when dealing with unzipped .dSYM directories on
    # macosx
    ifeq ($(call isTargetOs, macosx), true)
      ifeq ($(ZIP_EXTERNAL_DEBUG_SYMBOLS), false)
        JDK_SYMBOLS_EXCLUDE_PATTERN := $(addprefix %, \
<span class="line-modified">!           $(call containing, .dSYM/, $(patsubst $(JDK_IMAGE_DIR)/%, %, \</span>
<span class="line-added">+           $(ALL_JDK_SYMBOLS_FILES))))</span>
      endif
    endif
  
    JDK_BUNDLE_FILES := \
        $(filter-out \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 189,54 ***</span>
            $(SYMBOLS_EXCLUDE_PATTERN) \
            , \
            $(filter-out \
                $(JDK_IMAGE_HOMEDIR)/demo/% \
                , \
<span class="line-modified">!               $(ALL_JDK_FILES) \</span>
            ) \
        ) \
<span class="line-modified">!       $(call CacheFind, $(SYMBOLS_IMAGE_DIR))</span>
  
<span class="line-modified">!   TEST_DEMOS_BUNDLE_FILES := $(filter $(JDK_IMAGE_HOMEDIR)/demo/%, $(ALL_JDK_FILES))</span>
  
<span class="line-modified">!   $(eval $(call SetupBundleFile, BUILD_JDK_BUNDLE, \</span>
<span class="line-removed">-       BUNDLE_NAME := $(JDK_BUNDLE_NAME), \</span>
<span class="line-removed">-       FILES := $(JDK_BUNDLE_FILES), \</span>
<span class="line-removed">-       SPECIAL_INCLUDES := $(JDK_SPECIAL_INCLUDES), \</span>
<span class="line-removed">-       BASE_DIRS := $(JDK_IMAGE_DIR), \</span>
<span class="line-removed">-       SUBDIR := $(JDK_BUNDLE_SUBDIR), \</span>
<span class="line-removed">-   ))</span>
  
<span class="line-modified">!   PRODUCT_TARGETS += $(BUILD_JDK_BUNDLE)</span>
  
<span class="line-modified">!   $(eval $(call SetupBundleFile, BUILD_JDK_SYMBOLS_BUNDLE, \</span>
<span class="line-modified">!       BUNDLE_NAME := $(JDK_SYMBOLS_BUNDLE_NAME), \</span>
<span class="line-modified">!       FILES := $(JDK_SYMBOLS_BUNDLE_FILES), \</span>
<span class="line-modified">!       BASE_DIRS := $(JDK_IMAGE_DIR) $(wildcard $(SYMBOLS_IMAGE_DIR)), \</span>
<span class="line-modified">!       SUBDIR := $(JDK_BUNDLE_SUBDIR), \</span>
<span class="line-modified">!       UNZIP_DEBUGINFO := true, \</span>
<span class="line-modified">!   ))</span>
  
<span class="line-modified">!   PRODUCT_TARGETS += $(BUILD_JDK_SYMBOLS_BUNDLE)</span>
  
    # The demo bundle is only created to support client tests. Ideally it should
    # be built with the main test bundle, but since the prerequisites match
    # better with the product build, it makes more sense to keep it there for now.
    $(eval $(call SetupBundleFile, BUILD_TEST_DEMOS_BUNDLE, \
        BUNDLE_NAME := $(TEST_DEMOS_BUNDLE_NAME), \
        FILES := $(TEST_DEMOS_BUNDLE_FILES), \
<span class="line-modified">!       BASE_DIRS := $(JDK_IMAGE_DIR), \</span>
        SUBDIR := $(JDK_BUNDLE_SUBDIR), \
    ))
  
    PRODUCT_TARGETS += $(BUILD_TEST_DEMOS_BUNDLE)
  endif
  
  ################################################################################
  
  ifneq ($(filter test-bundles, $(MAKECMDGOALS)), )
<span class="line-modified">!   TEST_BUNDLE_FILES := $(call CacheFind, $(TEST_IMAGE_DIR))</span>
  
    $(eval $(call SetupBundleFile, BUILD_TEST_BUNDLE, \
        BUNDLE_NAME := $(TEST_BUNDLE_NAME), \
        FILES := $(TEST_BUNDLE_FILES), \
        BASE_DIRS := $(TEST_IMAGE_DIR), \
<span class="line-new-header">--- 224,154 ---</span>
            $(SYMBOLS_EXCLUDE_PATTERN) \
            , \
            $(filter-out \
                $(JDK_IMAGE_HOMEDIR)/demo/% \
                , \
<span class="line-modified">!               $(ALL_JDK_SYMBOLS_FILES) \</span>
            ) \
        ) \
<span class="line-modified">!       $(call FindFiles, $(SYMBOLS_IMAGE_DIR))</span>
  
<span class="line-modified">!   TEST_DEMOS_BUNDLE_FILES := $(filter $(JDK_DEMOS_IMAGE_HOMEDIR)/demo/%, \</span>
<span class="line-added">+       $(ALL_JDK_DEMOS_FILES))</span>
  
<span class="line-modified">!   ALL_JRE_FILES := $(call ShellFindFiles, $(JRE_IMAGE_DIR))</span>
  
<span class="line-modified">!   # Create special filter rules when dealing with unzipped .dSYM directories on</span>
<span class="line-added">+   # macosx</span>
<span class="line-added">+   ifeq ($(OPENJDK_TARGET_OS), macosx)</span>
<span class="line-added">+     ifeq ($(ZIP_EXTERNAL_DEBUG_SYMBOLS), false)</span>
<span class="line-added">+       JRE_SYMBOLS_EXCLUDE_PATTERN := $(addprefix %, \</span>
<span class="line-added">+           $(call containing, .dSYM/, $(patsubst $(JRE_IMAGE_DIR)/%, %, $(ALL_JRE_FILES))))</span>
<span class="line-added">+     endif</span>
<span class="line-added">+   endif</span>
  
<span class="line-modified">!   JRE_BUNDLE_FILES := $(filter-out \</span>
<span class="line-modified">!       $(JRE_SYMBOLS_EXCLUDE_PATTERN) \</span>
<span class="line-modified">!       $(SYMBOLS_EXCLUDE_PATTERN), \</span>
<span class="line-modified">!       $(ALL_JRE_FILES))</span>
<span class="line-modified">! </span>
<span class="line-modified">!   # On Macosx release builds, when there is a code signing certificate available,</span>
<span class="line-modified">!   # the final bundle layout can be signed.</span>
<span class="line-added">+   SIGN_BUNDLE := false</span>
<span class="line-added">+   ifeq ($(call isTargetOs, macosx)+$(DEBUG_LEVEL), true+release)</span>
<span class="line-added">+     ifneq ($(CODESIGN), )</span>
<span class="line-added">+       SIGN_BUNDLE := true</span>
<span class="line-added">+     endif</span>
<span class="line-added">+   endif</span>
  
<span class="line-modified">!   ifeq ($(SIGN_BUNDLE), true)</span>
<span class="line-added">+     # Macosx release build and code signing available.</span>
<span class="line-added">+ </span>
<span class="line-added">+     ################################################################################</span>
<span class="line-added">+     # JDK bundle</span>
<span class="line-added">+     $(eval $(call SetupCopyFiles, CREATE_JDK_BUNDLE_DIR_SIGNED, \</span>
<span class="line-added">+         SRC := $(JDK_IMAGE_DIR), \</span>
<span class="line-added">+         FILES := $(JDK_BUNDLE_FILES), \</span>
<span class="line-added">+         DEST := $(JDK_MACOSX_BUNDLE_DIR_SIGNED), \</span>
<span class="line-added">+     ))</span>
<span class="line-added">+ </span>
<span class="line-added">+     JDK_SIGNED_CODE_RESOURCES := \</span>
<span class="line-added">+         $(JDK_MACOSX_BUNDLE_DIR_SIGNED)/$(JDK_MACOSX_CONTENTS_SUBDIR)/_CodeSignature/CodeResources</span>
<span class="line-added">+ </span>
<span class="line-added">+     $(JDK_SIGNED_CODE_RESOURCES): $(CREATE_JDK_BUNDLE_DIR_SIGNED)</span>
<span class="line-added">+ 	$(call LogWarn, Signing $(JDK_BUNDLE_NAME))</span>
<span class="line-added">+ 	$(CODESIGN) -s &quot;$(MACOSX_CODESIGN_IDENTITY)&quot; \</span>
<span class="line-added">+ 	    --timestamp --options runtime --deep --force \</span>
<span class="line-added">+ 	    $(JDK_MACOSX_BUNDLE_DIR_SIGNED)/$(JDK_MACOSX_BUNDLE_TOP_DIR) $(LOG_DEBUG)</span>
<span class="line-added">+ 	$(TOUCH) $@</span>
<span class="line-added">+ </span>
<span class="line-added">+     $(eval $(call SetupBundleFile, BUILD_JDK_BUNDLE, \</span>
<span class="line-added">+         BUNDLE_NAME := $(JDK_BUNDLE_NAME), \</span>
<span class="line-added">+         FILES := \</span>
<span class="line-added">+             $(CREATE_JDK_BUNDLE_DIR_SIGNED) \</span>
<span class="line-added">+             $(JDK_SIGNED_CODE_RESOURCES), \</span>
<span class="line-added">+         BASE_DIRS := $(JDK_MACOSX_BUNDLE_DIR_SIGNED), \</span>
<span class="line-added">+         SUBDIR := $(JDK_BUNDLE_SUBDIR), \</span>
<span class="line-added">+     ))</span>
<span class="line-added">+ </span>
<span class="line-added">+     PRODUCT_TARGETS += $(BUILD_JDK_BUNDLE)</span>
<span class="line-added">+ </span>
<span class="line-added">+     ################################################################################</span>
<span class="line-added">+     # JRE bundle</span>
<span class="line-added">+     $(eval $(call SetupCopyFiles, CREATE_JRE_BUNDLE_DIR_SIGNED, \</span>
<span class="line-added">+         SRC := $(JRE_IMAGE_DIR), \</span>
<span class="line-added">+         FILES := $(JRE_BUNDLE_FILES), \</span>
<span class="line-added">+         DEST := $(JRE_MACOSX_BUNDLE_DIR_SIGNED), \</span>
<span class="line-added">+     ))</span>
<span class="line-added">+ </span>
<span class="line-added">+     JRE_SIGNED_CODE_RESOURCES := \</span>
<span class="line-added">+         $(JRE_MACOSX_BUNDLE_DIR_SIGNED)/$(JRE_MACOSX_CONTENTS_SUBDIR)/_CodeSignature/CodeResources</span>
<span class="line-added">+ </span>
<span class="line-added">+     $(JRE_SIGNED_CODE_RESOURCES): $(CREATE_JRE_BUNDLE_DIR_SIGNED)</span>
<span class="line-added">+ 	$(call LogWarn, Signing $(JRE_BUNDLE_NAME))</span>
<span class="line-added">+ 	$(CODESIGN) -s &quot;$(MACOSX_CODESIGN_IDENTITY)&quot; \</span>
<span class="line-added">+ 	    --timestamp --options runtime --deep --force \</span>
<span class="line-added">+ 	    $(JRE_MACOSX_BUNDLE_DIR_SIGNED)/$(JRE_MACOSX_BUNDLE_TOP_DIR) $(LOG_DEBUG)</span>
<span class="line-added">+ 	$(TOUCH) $@</span>
<span class="line-added">+ </span>
<span class="line-added">+     $(eval $(call SetupBundleFile, BUILD_JRE_BUNDLE, \</span>
<span class="line-added">+         BUNDLE_NAME := $(JRE_BUNDLE_NAME), \</span>
<span class="line-added">+         FILES := \</span>
<span class="line-added">+             $(CREATE_JRE_BUNDLE_DIR_SIGNED) \</span>
<span class="line-added">+             $(JRE_SIGNED_CODE_RESOURCES), \</span>
<span class="line-added">+         BASE_DIRS := $(JRE_MACOSX_BUNDLE_DIR_SIGNED), \</span>
<span class="line-added">+         SUBDIR := $(JRE_BUNDLE_SUBDIR), \</span>
<span class="line-added">+     ))</span>
<span class="line-added">+ </span>
<span class="line-added">+     LEGACY_TARGETS += $(BUILD_JRE_BUNDLE)</span>
<span class="line-added">+   else</span>
<span class="line-added">+     # Not a Macosx release build or code signing not available.</span>
<span class="line-added">+     $(eval $(call SetupBundleFile, BUILD_JDK_BUNDLE, \</span>
<span class="line-added">+         BUNDLE_NAME := $(JDK_BUNDLE_NAME), \</span>
<span class="line-added">+         FILES := $(JDK_BUNDLE_FILES), \</span>
<span class="line-added">+         SPECIAL_INCLUDES := $(JDK_SPECIAL_INCLUDES), \</span>
<span class="line-added">+         BASE_DIRS := $(JDK_IMAGE_DIR), \</span>
<span class="line-added">+         SUBDIR := $(JDK_BUNDLE_SUBDIR), \</span>
<span class="line-added">+     ))</span>
<span class="line-added">+ </span>
<span class="line-added">+     PRODUCT_TARGETS += $(BUILD_JDK_BUNDLE)</span>
<span class="line-added">+ </span>
<span class="line-added">+     $(eval $(call SetupBundleFile, BUILD_JRE_BUNDLE, \</span>
<span class="line-added">+         BUNDLE_NAME := $(JRE_BUNDLE_NAME), \</span>
<span class="line-added">+         FILES := $(JRE_BUNDLE_FILES), \</span>
<span class="line-added">+         BASE_DIRS := $(JRE_IMAGE_DIR), \</span>
<span class="line-added">+         SUBDIR := $(JRE_BUNDLE_SUBDIR), \</span>
<span class="line-added">+     ))</span>
<span class="line-added">+ </span>
<span class="line-added">+     LEGACY_TARGETS += $(BUILD_JRE_BUNDLE)</span>
<span class="line-added">+   endif</span>
<span class="line-added">+ </span>
<span class="line-added">+   ifeq ($(COPY_DEBUG_SYMBOLS), true)</span>
<span class="line-added">+     $(eval $(call SetupBundleFile, BUILD_JDK_SYMBOLS_BUNDLE, \</span>
<span class="line-added">+         BUNDLE_NAME := $(JDK_SYMBOLS_BUNDLE_NAME), \</span>
<span class="line-added">+         FILES := $(JDK_SYMBOLS_BUNDLE_FILES), \</span>
<span class="line-added">+         BASE_DIRS := $(JDK_SYMBOLS_IMAGE_DIR) $(wildcard $(SYMBOLS_IMAGE_DIR)), \</span>
<span class="line-added">+         SUBDIR := $(JDK_BUNDLE_SUBDIR), \</span>
<span class="line-added">+         UNZIP_DEBUGINFO := true, \</span>
<span class="line-added">+     ))</span>
<span class="line-added">+ </span>
<span class="line-added">+     PRODUCT_TARGETS += $(BUILD_JDK_SYMBOLS_BUNDLE)</span>
<span class="line-added">+   endif</span>
  
    # The demo bundle is only created to support client tests. Ideally it should
    # be built with the main test bundle, but since the prerequisites match
    # better with the product build, it makes more sense to keep it there for now.
    $(eval $(call SetupBundleFile, BUILD_TEST_DEMOS_BUNDLE, \
        BUNDLE_NAME := $(TEST_DEMOS_BUNDLE_NAME), \
        FILES := $(TEST_DEMOS_BUNDLE_FILES), \
<span class="line-modified">!       BASE_DIRS := $(JDK_DEMOS_IMAGE_DIR), \</span>
        SUBDIR := $(JDK_BUNDLE_SUBDIR), \
    ))
  
    PRODUCT_TARGETS += $(BUILD_TEST_DEMOS_BUNDLE)
  endif
  
  ################################################################################
  
  ifneq ($(filter test-bundles, $(MAKECMDGOALS)), )
<span class="line-modified">!   TEST_BUNDLE_FILES := $(call FindFiles, $(TEST_IMAGE_DIR))</span>
  
    $(eval $(call SetupBundleFile, BUILD_TEST_BUNDLE, \
        BUNDLE_NAME := $(TEST_BUNDLE_NAME), \
        FILES := $(TEST_BUNDLE_FILES), \
        BASE_DIRS := $(TEST_IMAGE_DIR), \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 246,11 ***</span>
  endif
  
  ################################################################################
  
  ifneq ($(filter docs-bundles, $(MAKECMDGOALS)), )
<span class="line-modified">!   DOCS_BUNDLE_FILES := $(call CacheFind, $(DOCS_IMAGE_DIR))</span>
  
    $(eval $(call SetupBundleFile, BUILD_DOCS_BUNDLE, \
        BUNDLE_NAME := $(DOCS_BUNDLE_NAME), \
        FILES := $(DOCS_BUNDLE_FILES), \
        BASE_DIRS := $(DOCS_IMAGE_DIR), \
<span class="line-new-header">--- 381,11 ---</span>
  endif
  
  ################################################################################
  
  ifneq ($(filter docs-bundles, $(MAKECMDGOALS)), )
<span class="line-modified">!   DOCS_BUNDLE_FILES := $(call FindFiles, $(DOCS_IMAGE_DIR))</span>
  
    $(eval $(call SetupBundleFile, BUILD_DOCS_BUNDLE, \
        BUNDLE_NAME := $(DOCS_BUNDLE_NAME), \
        FILES := $(DOCS_BUNDLE_FILES), \
        BASE_DIRS := $(DOCS_IMAGE_DIR), \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 261,11 ***</span>
  endif
  
  ################################################################################
  
  ifneq ($(filter jcov-bundles, $(MAKECMDGOALS)), )
<span class="line-modified">!   JCOV_BUNDLE_FILES := $(call CacheFind, $(JCOV_IMAGE_DIR))</span>
  
    $(eval $(call SetupBundleFile, BUILD_JCOV_BUNDLE, \
        BUNDLE_NAME := $(JCOV_BUNDLE_NAME), \
        FILES := $(JCOV_BUNDLE_FILES), \
        BASE_DIRS := $(JCOV_IMAGE_DIR), \
<span class="line-new-header">--- 396,11 ---</span>
  endif
  
  ################################################################################
  
  ifneq ($(filter jcov-bundles, $(MAKECMDGOALS)), )
<span class="line-modified">!   JCOV_BUNDLE_FILES := $(call FindFiles, $(JCOV_IMAGE_DIR))</span>
  
    $(eval $(call SetupBundleFile, BUILD_JCOV_BUNDLE, \
        BUNDLE_NAME := $(JCOV_BUNDLE_NAME), \
        FILES := $(JCOV_BUNDLE_FILES), \
        BASE_DIRS := $(JCOV_IMAGE_DIR), \
</pre>
<hr />
<pre>
<span class="line-old-header">*** 275,16 ***</span>
    JCOV_TARGETS += $(BUILD_JCOV_BUNDLE)
  endif
  
  ################################################################################
  
  # Hook to include the corresponding custom file, if present.
  $(eval $(call IncludeCustomExtension, Bundles.gmk))
  
  ################################################################################
  
  product-bundles: $(PRODUCT_TARGETS)
  test-bundles: $(TEST_TARGETS)
  docs-bundles: $(DOCS_TARGETS)
  jcov-bundles: $(JCOV_TARGETS)
  
<span class="line-modified">! .PHONY: all default product-bundles test-bundles docs-bundles jcov-bundles</span>
<span class="line-new-header">--- 410,40 ---</span>
    JCOV_TARGETS += $(BUILD_JCOV_BUNDLE)
  endif
  
  ################################################################################
  
<span class="line-added">+ ifneq ($(filter static-libs-bundles, $(MAKECMDGOALS)), )</span>
<span class="line-added">+   STATIC_LIBS_BUNDLE_FILES := $(call FindFiles, $(STATIC_LIBS_IMAGE_DIR))</span>
<span class="line-added">+ </span>
<span class="line-added">+   ifeq ($(OPENJDK_TARGET_OS)-$(DEBUG_LEVEL), macosx-release)</span>
<span class="line-added">+     STATIC_LIBS_BUNDLE_SUBDIR := $(JDK_MACOSX_CONTENTS_SUBDIR)/Home</span>
<span class="line-added">+   else</span>
<span class="line-added">+     STATIC_LIBS_BUNDLE_SUBDIR := $(JDK_BUNDLE_SUBDIR)</span>
<span class="line-added">+   endif</span>
<span class="line-added">+ </span>
<span class="line-added">+   $(eval $(call SetupBundleFile, BUILD_STATIC_LIBS_BUNDLE, \</span>
<span class="line-added">+       BUNDLE_NAME := $(STATIC_LIBS_BUNDLE_NAME), \</span>
<span class="line-added">+       FILES := $(STATIC_LIBS_BUNDLE_FILES), \</span>
<span class="line-added">+       BASE_DIRS := $(STATIC_LIBS_IMAGE_DIR), \</span>
<span class="line-added">+       SUBDIR := $(STATIC_LIBS_BUNDLE_SUBDIR), \</span>
<span class="line-added">+   ))</span>
<span class="line-added">+ </span>
<span class="line-added">+   STATIC_LIBS_TARGETS += $(BUILD_STATIC_LIBS_BUNDLE)</span>
<span class="line-added">+ endif</span>
<span class="line-added">+ </span>
<span class="line-added">+ ################################################################################</span>
<span class="line-added">+ </span>
  # Hook to include the corresponding custom file, if present.
  $(eval $(call IncludeCustomExtension, Bundles.gmk))
  
  ################################################################################
  
  product-bundles: $(PRODUCT_TARGETS)
<span class="line-added">+ legacy-bundles: $(LEGACY_TARGETS)</span>
  test-bundles: $(TEST_TARGETS)
  docs-bundles: $(DOCS_TARGETS)
<span class="line-added">+ static-libs-bundles: $(STATIC_LIBS_TARGETS)</span>
  jcov-bundles: $(JCOV_TARGETS)
  
<span class="line-modified">! .PHONY: all default product-bundles test-bundles docs-bundles \</span>
<span class="line-added">+     static-libs-bundles jcov-bundles</span>
</pre>
<center><a href="../doc/testing.md.cdiff.html" target="_top">&lt; prev</a> <a href="../index.html" target="_top">index</a> <a href="CompileDemos.gmk.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>