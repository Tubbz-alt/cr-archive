<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff make/lib/Awt2dLibraries.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
<body>
<center><a href="../launcher/LauncherCommon.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="CoreLibraries.gmk.sdiff.html" target="_top">next &gt;</a></center>    <h2>make/lib/Awt2dLibraries.gmk</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 $(eval $(call IncludeCustomExtension, lib/Awt2dLibraries-pre.gmk))
 27 
 28 WIN_AWT_LIB := $(SUPPORT_OUTPUTDIR)/native/$(MODULE)/libawt/awt.lib
 29 
 30 LIBAWT_DEFAULT_HEADER_DIRS := \
 31     libawt/awt/image \
 32     libawt/awt/image/cvutils \
 33     libawt/java2d \
 34     libawt/java2d/loops \
 35     libawt/java2d/pipe \
 36     #
 37 
 38 ################################################################################
 39 
 40 # We must not include java.desktop/unix/native/libmlib_image, which is only
 41 # for usage by solaris-sparc in libmlib_image_v.
<span class="line-modified"> 42 BUILD_LIBMLIB_EXCLUDE_SRC_PATTERNS := unix</span>
 43 
 44 BUILD_LIBMLIB_CFLAGS := -D__USE_J2D_NAMES -D__MEDIALIB_OLD_NAMES -DMLIB_NO_LIBSUNMATH
 45 
 46 ifeq ($(call isTargetCpuBits, 64), true)
 47   BUILD_LIBMLIB_CFLAGS += -DMLIB_OS64BIT
 48 endif
 49 
 50 $(eval $(call SetupJdkLibrary, BUILD_LIBMLIB_IMAGE, \
 51     NAME := mlib_image, \
 52     EXTRA_SRC := common/awt/medialib, \
 53     EXCLUDE_FILES := mlib_c_ImageBlendTable.c, \
 54     EXCLUDE_SRC_PATTERNS := $(BUILD_LIBMLIB_EXCLUDE_SRC_PATTERNS), \
 55     OPTIMIZATION := HIGHEST, \
 56     CFLAGS := $(CFLAGS_JDKLIB) \
 57         $(BUILD_LIBMLIB_CFLAGS), \
 58     DISABLED_WARNINGS_gcc := unused-function, \
 59     LDFLAGS := $(LDFLAGS_JDKLIB) \
 60         $(call SET_SHARED_LIBRARY_ORIGIN), \
 61     LIBS := $(JDKLIB_LIBS), \
 62     LIBS_unix := $(LIBM) $(LIBDL), \
</pre>
<hr />
<pre>
212 # about initializing a declared &#39;extern&#39; cannot be turned off individually. Only
213 # applies to debug builds.
214 ifeq ($(TOOLCHAIN_TYPE), gcc)
215   BUILD_LIBAWT_debug_mem.c_CFLAGS := -w
216   # This option improves performance of MaskFill in Java2D by 20% for some gcc
217   LIBAWT_CFLAGS += -fgcse-after-reload
218 endif
219 
220 $(eval $(call SetupJdkLibrary, BUILD_LIBAWT, \
221     NAME := awt, \
222     EXTRA_SRC := $(LIBAWT_EXTRA_SRC), \
223     EXCLUDES := $(LIBAWT_EXCLUDES), \
224     EXCLUDE_FILES := $(LIBAWT_EXFILES), \
225     OPTIMIZATION := LOW, \
226     CFLAGS := $(CFLAGS_JDKLIB) $(LIBAWT_CFLAGS), \
227     EXTRA_HEADER_DIRS := $(LIBAWT_EXTRA_HEADER_DIRS), \
228     DISABLED_WARNINGS_gcc := sign-compare unused-result maybe-uninitialized \
229         format-nonliteral parentheses unused-value unused-function, \
230     DISABLED_WARNINGS_clang := logical-op-parentheses extern-initializer \
231         sign-compare format-nonliteral, \
<span class="line-removed">232     DISABLED_WARNINGS_solstudio := E_DECLARATION_IN_CODE, \</span>
233     DISABLED_WARNINGS_microsoft := 4244 4267 4996, \
234     ASFLAGS := $(LIBAWT_ASFLAGS), \
235     LDFLAGS := $(LDFLAGS_JDKLIB) $(call SET_SHARED_LIBRARY_ORIGIN), \
236     LDFLAGS_macosx := -L$(INSTALL_LIBRARIES_HERE), \
237     LDFLAGS_windows := -delayload:user32.dll -delayload:gdi32.dll \
238         -delayload:shell32.dll -delayload:winmm.dll \
239         -delayload:winspool.drv -delayload:imm32.dll \
240         -delayload:ole32.dll -delayload:comdlg32.dll \
241         -delayload:comctl32.dll -delayload:shlwapi.dll, \
242     LIBS_unix := -ljvm -ljava $(LIBM), \
243     LIBS_linux :=  $(LIBDL), \
244     LIBS_solaris := $(LIBDL), \
245     LIBS_aix := $(LIBDL),\
246     LIBS_macosx := -lmlib_image \
247         -framework Cocoa \
248         -framework OpenGL \
249         -framework JavaNativeFoundation \
250         -framework JavaRuntimeSupport \
251         -framework ApplicationServices \
252         -framework AudioToolbox, \
</pre>
<hr />
<pre>
322       BUILD_LIBAWT_XAWT_awt_Font.c_CFLAGS := -w
323       # initializing a declared &#39;extern&#39;
324       BUILD_LIBAWT_XAWT_debug_mem.c_CFLAGS := -w
325     endif
326 
327     $(eval $(call SetupJdkLibrary, BUILD_LIBAWT_XAWT, \
328         NAME := awt_xawt, \
329         EXTRA_SRC := $(LIBAWT_XAWT_EXTRA_SRC), \
330         EXTRA_HEADER_DIRS := $(LIBAWT_XAWT_EXTRA_HEADER_DIRS), \
331         EXCLUDES := $(LIBAWT_XAWT_EXCLUDES), \
332         OPTIMIZATION := LOW, \
333         CFLAGS := $(CFLAGS_JDKLIB) $(LIBAWT_XAWT_CFLAGS) \
334             $(X_CFLAGS), \
335         WARNINGS_AS_ERRORS_xlc := false, \
336         DISABLED_WARNINGS_gcc := type-limits pointer-to-int-cast \
337             unused-result maybe-uninitialized format \
338             format-security int-to-pointer-cast parentheses \
339             implicit-fallthrough undef unused-function, \
340         DISABLED_WARNINGS_clang := parentheses format undef \
341             logical-op-parentheses format-nonliteral int-conversion, \
<span class="line-modified">342         DISABLED_WARNINGS_solstudio := E_DECLARATION_IN_CODE \</span>
<span class="line-modified">343             E_ASSIGNMENT_TYPE_MISMATCH E_NON_CONST_INIT, \</span>
344         LDFLAGS := $(LDFLAGS_JDKLIB) \
345             $(call SET_SHARED_LIBRARY_ORIGIN) \
346             -L$(INSTALL_LIBRARIES_HERE), \
347         LIBS :=  $(X_LIBS) $(LIBAWT_XAWT_LIBS), \
348     ))
349 
350     $(BUILD_LIBAWT_XAWT): $(call FindLib, java.base, java)
351 
352     $(BUILD_LIBAWT_XAWT): $(BUILD_LIBAWT)
353 
354     TARGETS += $(BUILD_LIBAWT_XAWT)
355 
356   endif
357 endif
358 
359 ################################################################################
360 
361 # The fast floor code loses precision.
362 LCMS_CFLAGS=-DCMS_DONT_USE_FAST_FLOOR
363 
364 ifeq ($(USE_EXTERNAL_LCMS), true)
365   # If we&#39;re using an external library, we&#39;ll just need the wrapper part.
366   # By including it explicitly, all other files will be excluded.
367   BUILD_LIBLCMS_INCLUDE_FILES := LCMS.c
368   # If we&#39;re using an external library, we can&#39;t include our own SRC path
369   # as includes, instead the system headers should be used.
370   LIBLCMS_HEADERS_FROM_SRC := false
371 else
372   BUILD_LIBLCMS_INCLUDE_FILES :=
373 endif
374 
375 $(eval $(call SetupJdkLibrary, BUILD_LIBLCMS, \
376     NAME := lcms, \
377     INCLUDE_FILES := $(BUILD_LIBLCMS_INCLUDE_FILES), \
378     OPTIMIZATION := HIGHEST, \
379     CFLAGS := $(CFLAGS_JDKLIB) \
380         $(LCMS_CFLAGS), \
<span class="line-removed">381     CFLAGS_solaris := -xc99=no_lib, \</span>
382     CFLAGS_windows := -DCMS_IS_WINDOWS_, \
383     EXTRA_HEADER_DIRS := \
384         common/awt/debug \
385         libawt/java2d, \
386     HEADERS_FROM_SRC := $(LIBLCMS_HEADERS_FROM_SRC), \
387     DISABLED_WARNINGS_gcc := format-nonliteral type-limits \
<span class="line-modified">388         misleading-indentation undef unused-function, \</span>
389     DISABLED_WARNINGS_clang := tautological-compare format-nonliteral undef, \
390     DISABLED_WARNINGS_solstudio := E_STATEMENT_NOT_REACHED, \
391     DISABLED_WARNINGS_microsoft := 4819, \
392     LDFLAGS := $(LDFLAGS_JDKLIB) \
393         $(call SET_SHARED_LIBRARY_ORIGIN), \
394     LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
395     LIBS_unix := -lawt -ljvm -ljava $(LCMS_LIBS) $(LIBM), \
396     LIBS_windows := $(WIN_AWT_LIB) $(WIN_JAVA_LIB), \
397 ))
398 
399 TARGETS += $(BUILD_LIBLCMS)
400 
401 $(BUILD_LIBLCMS): $(BUILD_LIBAWT)
402 
403 ################################################################################
404 
405 # &quot;DISABLED_WARNINGS_gcc := clobbered&quot; rationale:
406 # Suppress gcc warnings like &quot;variable might be clobbered by &#39;longjmp&#39;
407 # or &#39;vfork&#39;&quot;: this warning indicates that some variable is placed to
408 # a register by optimized compiler and it&#39;s value might be lost on longjmp().
</pre>
<hr />
<pre>
455 
456   LIBAWT_HEADLESS_EXTRA_HEADER_DIRS := \
457       $(LIBAWT_DEFAULT_HEADER_DIRS) \
458       common/awt/debug \
459       common/font \
460       common/java2d/opengl \
461       #
462 
463   LIBAWT_HEADLESS_CFLAGS := $(CUPS_CFLAGS) $(FONTCONFIG_CFLAGS) $(X_CFLAGS) \
464       -DHEADLESS=true
465 
466   $(eval $(call SetupJdkLibrary, BUILD_LIBAWT_HEADLESS, \
467       NAME := awt_headless, \
468       EXTRA_SRC := $(LIBAWT_HEADLESS_EXTRA_SRC), \
469       EXCLUDES := $(LIBAWT_HEADLESS_EXCLUDES), \
470       OPTIMIZATION := LOW, \
471       CFLAGS := $(CFLAGS_JDKLIB) \
472           $(LIBAWT_HEADLESS_CFLAGS), \
473       EXTRA_HEADER_DIRS := $(LIBAWT_HEADLESS_EXTRA_HEADER_DIRS), \
474       DISABLED_WARNINGS_gcc := unused-function, \
<span class="line-removed">475       DISABLED_WARNINGS_xlc := 1506-356, \</span>
476       DISABLED_WARNINGS_solstudio := E_EMPTY_TRANSLATION_UNIT, \
477       LDFLAGS := $(LDFLAGS_JDKLIB) \
478           $(call SET_SHARED_LIBRARY_ORIGIN), \
479       LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
480       LIBS_unix := -lawt -ljvm -ljava, \
481       LIBS_linux := $(LIBM) $(LIBDL), \
482       LIBS_solaris := $(LIBM) $(LIBDL) $(LIBCXX), \
483   ))
484 
<span class="line-removed">485   # AIX warning explanation:</span>
<span class="line-removed">486   # 1506-356 : (W) Compilation unit is empty.</span>
<span class="line-removed">487   #            This happens during the headless build</span>
<span class="line-removed">488 </span>
489   $(BUILD_LIBAWT_HEADLESS): $(BUILD_LIBAWT)
490 
491   TARGETS += $(BUILD_LIBAWT_HEADLESS)
492 
493 endif
494 
495 ################################################################################
496 
497 ifeq ($(FREETYPE_TO_USE), system)
498   # For use by libfontmanager:
499   LIBFREETYPE_CFLAGS := $(FREETYPE_CFLAGS)
500   LIBFREETYPE_LIBS := $(FREETYPE_LIBS)
501 else
502   BUILD_LIBFREETYPE_HEADER_DIRS := $(TOPDIR)/src/$(MODULE)/share/native/libfreetype/include
503   BUILD_LIBFREETYPE_CFLAGS := -DFT2_BUILD_LIBRARY $(EXPORT_ALL_SYMBOLS)
504 
505   # For use by libfontmanager:
506   LIBFREETYPE_CFLAGS := -I$(BUILD_LIBFREETYPE_HEADER_DIRS)
507   ifeq ($(call isTargetOs, windows), true)
508     LIBFREETYPE_LIBS := $(SUPPORT_OUTPUTDIR)/native/$(MODULE)/libfreetype/freetype.lib


509   else
510     LIBFREETYPE_LIBS := -lfreetype
511   endif
512 
513   $(eval $(call SetupJdkLibrary, BUILD_LIBFREETYPE, \
514       NAME := freetype, \
515       OPTIMIZATION := HIGHEST, \
516       CFLAGS := $(CFLAGS_JDKLIB) \
517           $(BUILD_LIBFREETYPE_CFLAGS), \
518       EXTRA_HEADER_DIRS := $(BUILD_LIBFREETYPE_HEADER_DIRS), \
519       DISABLED_WARNINGS_solstudio := \
520          E_STATEMENT_NOT_REACHED \
521          E_END_OF_LOOP_CODE_NOT_REACHED, \
<span class="line-modified">522       DISABLED_WARNINGS_microsoft := 4267 4244 4312 4819, \</span>
<span class="line-modified">523       DISABLED_WARNINGS_gcc := implicit-fallthrough, \</span>
524       LDFLAGS := $(LDFLAGS_JDKLIB) \
525           $(call SET_SHARED_LIBRARY_ORIGIN), \
526   ))
527 
528   TARGETS += $(BUILD_LIBFREETYPE)
529 endif
530 
531 ###########################################################################
532 
533 #### Begin harfbuzz configuration
534 
535 HARFBUZZ_CFLAGS := -DHAVE_OT -DHAVE_FALLBACK -DHAVE_UCDN -DHAVE_ROUND
536 
537 ifeq ($(call isTargetOs, windows), false)
538   HARFBUZZ_CFLAGS += -DGETPAGESIZE -DHAVE_MPROTECT -DHAVE_PTHREAD \
<span class="line-modified">539                       -DHAVE_SYSCONF -DHAVE_SYS_MMAN_H -DHAVE_UNISTD_H</span>

540 endif
541 ifeq ($(call isTargetOs, linux macosx), true)
542   HARFBUZZ_CFLAGS += -DHAVE_INTEL_ATOMIC_PRIMITIVES
543 endif
544 ifeq ($(call isTargetOs, solaris), true)
545   HARFBUZZ_CFLAGS += -DHAVE_SOLARIS_ATOMIC_OPS
546 endif
547 ifeq ($(call isTargetOs, macosx), true)
548   HARFBUZZ_CFLAGS += -DHAVE_CORETEXT
549 endif
550 ifeq ($(call isTargetOs, macosx), false)
551   LIBFONTMANAGER_EXCLUDE_FILES += harfbuzz/hb-coretext.cc
552 endif
553 # hb-ft.cc is not presently needed, and requires freetype 2.4.2 or later.
554 LIBFONTMANAGER_EXCLUDE_FILES += harfbuzz/hb-ft.cc
555 
556 LIBFONTMANAGER_CFLAGS += $(HARFBUZZ_CFLAGS)
557 
558 #### End harfbuzz configuration
559 
</pre>
<hr />
<pre>
596 
597 # LDFLAGS clarification:
598 #   Filter relevant linker flags disallowing unresolved symbols as we cannot
599 #   build-time decide to which library to link against (libawt_headless or
600 #   libawt_xawt). See JDK-8196516 for details.
601 $(eval $(call SetupJdkLibrary, BUILD_LIBFONTMANAGER, \
602     NAME := fontmanager, \
603     EXCLUDE_FILES := $(LIBFONTMANAGER_EXCLUDE_FILES) \
604         AccelGlyphCache.c, \
605     TOOLCHAIN := TOOLCHAIN_LINK_CXX, \
606     CFLAGS := $(CFLAGS_JDKLIB) $(LIBFONTMANAGER_CFLAGS), \
607     CXXFLAGS := $(CXXFLAGS_JDKLIB) $(LIBFONTMANAGER_CFLAGS), \
608     OPTIMIZATION := $(LIBFONTMANAGER_OPTIMIZATION), \
609     CFLAGS_windows = -DCC_NOEX, \
610     EXTRA_HEADER_DIRS := $(LIBFONTMANAGER_EXTRA_HEADER_DIRS), \
611     WARNINGS_AS_ERRORS_xlc := false, \
612     DISABLED_WARNINGS_gcc := sign-compare int-to-pointer-cast \
613         type-limits missing-field-initializers implicit-fallthrough \
614         strict-aliasing undef unused-function, \
615     DISABLED_WARNINGS_CXX_gcc := reorder delete-non-virtual-dtor strict-overflow \
<span class="line-modified">616         maybe-uninitialized \</span>
<span class="line-removed">617         missing-attributes class-memaccess, \</span>
618     DISABLED_WARNINGS_clang := unused-value incompatible-pointer-types \
619         tautological-constant-out-of-range-compare int-to-pointer-cast \
620         sign-compare undef missing-field-initializers, \
621     DISABLED_WARNINGS_C_solstudio = \
622         E_INTEGER_OVERFLOW_DETECTED \
623         E_ARG_INCOMPATIBLE_WITH_ARG_L \
624         E_ENUM_VAL_OVERFLOWS_INT_MAX, \
625     DISABLED_WARNINGS_CXX_solstudio := \
626         truncwarn wvarhidenmem wvarhidemem wbadlkginit identexpected \
<span class="line-modified">627         hidevf w_novirtualdescr arrowrtn2, \</span>
<span class="line-modified">628     DISABLED_WARNINGS_microsoft := 4267 4244 4018 4090 4996 4146 4334 4819 4101, \</span>

629     LDFLAGS := $(subst -Xlinker -z -Xlinker defs,, \
630         $(subst -Wl$(COMMA)-z$(COMMA)defs,,$(LDFLAGS_JDKLIB))) $(LDFLAGS_CXX_JDK) \
631         $(call SET_SHARED_LIBRARY_ORIGIN), \
632     LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
633     LDFLAGS_aix := -Wl$(COMMA)-berok, \
634     LIBS := $(BUILD_LIBFONTMANAGER_FONTLIB), \
635     LIBS_unix := -lawt -ljava -ljvm $(LIBM) $(LIBCXX), \
636     LIBS_macosx := -lawt_lwawt -framework CoreText -framework CoreFoundation \
637         -framework CoreGraphics, \
638     LIBS_windows := $(WIN_JAVA_LIB) advapi32.lib user32.lib gdi32.lib \
639         $(WIN_AWT_LIB), \
640 ))
641 
642 $(BUILD_LIBFONTMANAGER): $(BUILD_LIBAWT)
643 
644 ifeq ($(call isTargetOs, macosx), true)
645   $(BUILD_LIBFONTMANAGER): $(call FindLib, $(MODULE), awt_lwawt)
646 endif
647 
648 ifeq ($(FREETYPE_TO_USE), bundled)
</pre>
<hr />
<pre>
680       EXTRA_HEADER_DIRS := $(LIBJAWT_EXTRA_HEADER_DIRS), \
681       LDFLAGS := $(LDFLAGS_JDKLIB) $(LDFLAGS_CXX_JDK), \
682       LIBS := $(JDKLIB_LIBS) $(KERNEL32_LIB) advapi32.lib $(WIN_AWT_LIB), \
683   ))
684 
685   $(BUILD_LIBJAWT): $(BUILD_LIBAWT)
686 
687   $(eval $(call SetupCopyFiles, COPY_JAWT_LIB, \
688       FILES := $(BUILD_LIBJAWT_IMPORT_LIBRARY), \
689       DEST := $(SUPPORT_OUTPUTDIR)/modules_libs/$(MODULE), \
690   ))
691 
692   $(COPY_JAWT_LIB): $(BUILD_LIBJAWT)
693 
694   TARGETS += $(COPY_JAWT_LIB)
695 
696 else # not windows
697 
698   ifeq ($(call isTargetOs, macosx), true)
699     # libjawt on macosx do not use the unix code
<span class="line-modified">700     LIBJAWT_EXCLUDE_SRC_PATTERNS := unix</span>
701   endif
702 
703   ifeq ($(call isTargetOs, macosx), true)
704     JAWT_LIBS := -lawt_lwawt
705   else
706     JAWT_LIBS :=
707     ifeq ($(call isTargetOs, solaris), false)
708       JAWT_LIBS += -lawt
709     endif
710     ifeq ($(ENABLE_HEADLESS_ONLY), false)
711       JAWT_LIBS += -lawt_xawt
712     else
713       JAWT_LIBS += -lawt_headless
714       ifeq ($(call isTargetOs, linux), true)
715         JAWT_CFLAGS += -DHEADLESS
716       endif
717     endif
718   endif
719 
720   $(eval $(call SetupJdkLibrary, BUILD_LIBJAWT, \
</pre>
<hr />
<pre>
770     # While the following ought to work, it will currently pull in the closed
771     # additions to this library, and this was not done previously in the build.
772     # LIBSPLASHSCREEN_EXTRA_SRC += libjavajpeg
773     LIBSPLASHSCREEN_EXTRA_SRC += $(TOPDIR)/src/java.desktop/share/native/libjavajpeg
774   else
775     LIBJPEG_LIBS := -ljpeg
776   endif
777 
778   ifeq ($(USE_EXTERNAL_LIBPNG), false)
779     LIBSPLASHSCREEN_HEADER_DIRS += libsplashscreen/libpng
780   else
781     LIBSPLASHSCREEN_EXCLUDES += libpng
782   endif
783 
784   ifeq ($(USE_EXTERNAL_LIBZ), false)
785     LIBSPLASHSCREEN_EXTRA_SRC += java.base:libzip/zlib
786   endif
787 
788   ifeq ($(call isTargetOs, macosx), true)
789     # libsplashscreen on macosx do not use the unix code
<span class="line-modified">790     LIBSPLASHSCREEN_EXCLUDE_SRC_PATTERNS := unix</span>
791   endif
792 
<span class="line-modified">793   LIBSPLASHSCREEN_CFLAGS += -DSPLASHSCREEN -DPNG_NO_MMX_CODE -DPNG_ARM_NEON_OPT=0</span>

794 
795   ifeq ($(call isTargetOs, linux), true)
796     ifeq ($(call isTargetCpuArch, ppc), true)
797       LIBSPLASHSCREEN_CFLAGS += -DPNG_POWERPC_VSX_OPT=0
798     endif
799   endif
800 
801   ifeq ($(call isTargetOs, macosx), true)
802     LIBSPLASHSCREEN_CFLAGS += -DWITH_MACOSX
803 
804     BUILD_LIBSPLASHSCREEN_java_awt_SplashScreen.c_CFLAGS := -x objective-c -O0
805     BUILD_LIBSPLASHSCREEN_splashscreen_gfx_impl.c_CFLAGS := -x objective-c -O0
806     BUILD_LIBSPLASHSCREEN_splashscreen_gif.c_CFLAGS := -x objective-c -O0
807     BUILD_LIBSPLASHSCREEN_splashscreen_impl.c_CFLAGS := -x objective-c -O0
808     BUILD_LIBSPLASHSCREEN_splashscreen_jpeg.c_CFLAGS := -x objective-c -O0
809     BUILD_LIBSPLASHSCREEN_splashscreen_png.c_CFLAGS := -x objective-c -O0
810     BUILD_LIBSPLASHSCREEN_splashscreen_sys.m_CFLAGS := -O0
811 
812   else ifeq ($(call isTargetOs, windows), true)
813     LIBSPLASHSCREEN_CFLAGS += -DWITH_WIN32
814   else
815     LIBSPLASHSCREEN_CFLAGS += -DWITH_X11 $(X_CFLAGS)
816   endif
817 
818   LIBSPLASHSCREEN_LIBS :=
819 
820   ifeq ($(call isTargetOs, macosx), true)
821     LIBSPLASHSCREEN_LIBS += \
822         $(LIBM) -lpthread -liconv -losxapp \
823         -framework ApplicationServices \
824         -framework Foundation \

825         -framework Cocoa \
826         -framework JavaNativeFoundation
827   else ifeq ($(call isTargetOs, windows), true)
828     LIBSPLASHSCREEN_LIBS += kernel32.lib user32.lib gdi32.lib delayimp.lib $(WIN_JAVA_LIB) jvm.lib
829   else
830     LIBSPLASHSCREEN_LIBS += $(X_LIBS) -lX11 -lXext $(LIBM) -lpthread -ldl
831   endif
832 
833   LIBSPLASHSCREEN_HEADER_DIRS += \
834       libosxapp \
835       java.base:include \
836       java.base:libjava \
837       #
838 
839   $(eval $(call SetupJdkLibrary, BUILD_LIBSPLASHSCREEN, \
840       NAME := splashscreen, \
841       EXTRA_SRC := $(LIBSPLASHSCREEN_EXTRA_SRC), \
842       EXCLUDE_SRC_PATTERNS := $(LIBSPLASHSCREEN_EXCLUDE_SRC_PATTERNS), \
843       EXCLUDE_FILES := imageioJPEG.c jpegdecoder.c pngtest.c, \
844       EXCLUDES := $(LIBSPLASHSCREEN_EXCLUDES), \
845       OPTIMIZATION := LOW, \
846       CFLAGS := $(CFLAGS_JDKLIB) $(LIBSPLASHSCREEN_CFLAGS) \
847           $(GIFLIB_CFLAGS) $(LIBJPEG_CFLAGS) $(PNG_CFLAGS) $(LIBZ_CFLAGS), \
848       EXTRA_HEADER_DIRS := $(LIBSPLASHSCREEN_HEADER_DIRS), \
849       DISABLED_WARNINGS_gcc := sign-compare type-limits unused-result \
850           maybe-uninitialized shift-negative-value implicit-fallthrough \
851           unused-function, \
852       DISABLED_WARNINGS_clang := incompatible-pointer-types sign-compare, \
<span class="line-modified">853       DISABLED_WARNINGS_solstudio := E_NEWLINE_NOT_LAST E_DECLARATION_IN_CODE \</span>
<span class="line-removed">854           E_STATEMENT_NOT_REACHED, \</span>
855       DISABLED_WARNINGS_microsoft := 4018 4244 4267, \
856       LDFLAGS := $(LDFLAGS_JDKLIB) \
857           $(call SET_SHARED_LIBRARY_ORIGIN), \
858       LDFLAGS_macosx := -L$(INSTALL_LIBRARIES_HERE), \
859       LDFLAGS_windows := -delayload:user32.dll, \
860       LIBS := $(JDKLIB_LIBS) $(LIBSPLASHSCREEN_LIBS) $(LIBZ_LIBS) \
861           $(GIFLIB_LIBS) $(LIBJPEG_LIBS) $(PNG_LIBS), \
862       LIBS_aix := -liconv, \
863   ))
864 
865   TARGETS += $(BUILD_LIBSPLASHSCREEN)
866 
867   ifeq ($(call isTargetOs, macosx), true)
868     $(BUILD_LIBSPLASHSCREEN): $(call FindLib, $(MODULE), osxapp)
869   endif
870 
871 endif
872 
873 ################################################################################
874 
</pre>
</td>
<td>
<hr />
<pre>
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 $(eval $(call IncludeCustomExtension, lib/Awt2dLibraries-pre.gmk))
 27 
 28 WIN_AWT_LIB := $(SUPPORT_OUTPUTDIR)/native/$(MODULE)/libawt/awt.lib
 29 
 30 LIBAWT_DEFAULT_HEADER_DIRS := \
 31     libawt/awt/image \
 32     libawt/awt/image/cvutils \
 33     libawt/java2d \
 34     libawt/java2d/loops \
 35     libawt/java2d/pipe \
 36     #
 37 
 38 ################################################################################
 39 
 40 # We must not include java.desktop/unix/native/libmlib_image, which is only
 41 # for usage by solaris-sparc in libmlib_image_v.
<span class="line-modified"> 42 BUILD_LIBMLIB_EXCLUDE_SRC_PATTERNS := /unix/</span>
 43 
 44 BUILD_LIBMLIB_CFLAGS := -D__USE_J2D_NAMES -D__MEDIALIB_OLD_NAMES -DMLIB_NO_LIBSUNMATH
 45 
 46 ifeq ($(call isTargetCpuBits, 64), true)
 47   BUILD_LIBMLIB_CFLAGS += -DMLIB_OS64BIT
 48 endif
 49 
 50 $(eval $(call SetupJdkLibrary, BUILD_LIBMLIB_IMAGE, \
 51     NAME := mlib_image, \
 52     EXTRA_SRC := common/awt/medialib, \
 53     EXCLUDE_FILES := mlib_c_ImageBlendTable.c, \
 54     EXCLUDE_SRC_PATTERNS := $(BUILD_LIBMLIB_EXCLUDE_SRC_PATTERNS), \
 55     OPTIMIZATION := HIGHEST, \
 56     CFLAGS := $(CFLAGS_JDKLIB) \
 57         $(BUILD_LIBMLIB_CFLAGS), \
 58     DISABLED_WARNINGS_gcc := unused-function, \
 59     LDFLAGS := $(LDFLAGS_JDKLIB) \
 60         $(call SET_SHARED_LIBRARY_ORIGIN), \
 61     LIBS := $(JDKLIB_LIBS), \
 62     LIBS_unix := $(LIBM) $(LIBDL), \
</pre>
<hr />
<pre>
212 # about initializing a declared &#39;extern&#39; cannot be turned off individually. Only
213 # applies to debug builds.
214 ifeq ($(TOOLCHAIN_TYPE), gcc)
215   BUILD_LIBAWT_debug_mem.c_CFLAGS := -w
216   # This option improves performance of MaskFill in Java2D by 20% for some gcc
217   LIBAWT_CFLAGS += -fgcse-after-reload
218 endif
219 
220 $(eval $(call SetupJdkLibrary, BUILD_LIBAWT, \
221     NAME := awt, \
222     EXTRA_SRC := $(LIBAWT_EXTRA_SRC), \
223     EXCLUDES := $(LIBAWT_EXCLUDES), \
224     EXCLUDE_FILES := $(LIBAWT_EXFILES), \
225     OPTIMIZATION := LOW, \
226     CFLAGS := $(CFLAGS_JDKLIB) $(LIBAWT_CFLAGS), \
227     EXTRA_HEADER_DIRS := $(LIBAWT_EXTRA_HEADER_DIRS), \
228     DISABLED_WARNINGS_gcc := sign-compare unused-result maybe-uninitialized \
229         format-nonliteral parentheses unused-value unused-function, \
230     DISABLED_WARNINGS_clang := logical-op-parentheses extern-initializer \
231         sign-compare format-nonliteral, \

232     DISABLED_WARNINGS_microsoft := 4244 4267 4996, \
233     ASFLAGS := $(LIBAWT_ASFLAGS), \
234     LDFLAGS := $(LDFLAGS_JDKLIB) $(call SET_SHARED_LIBRARY_ORIGIN), \
235     LDFLAGS_macosx := -L$(INSTALL_LIBRARIES_HERE), \
236     LDFLAGS_windows := -delayload:user32.dll -delayload:gdi32.dll \
237         -delayload:shell32.dll -delayload:winmm.dll \
238         -delayload:winspool.drv -delayload:imm32.dll \
239         -delayload:ole32.dll -delayload:comdlg32.dll \
240         -delayload:comctl32.dll -delayload:shlwapi.dll, \
241     LIBS_unix := -ljvm -ljava $(LIBM), \
242     LIBS_linux :=  $(LIBDL), \
243     LIBS_solaris := $(LIBDL), \
244     LIBS_aix := $(LIBDL),\
245     LIBS_macosx := -lmlib_image \
246         -framework Cocoa \
247         -framework OpenGL \
248         -framework JavaNativeFoundation \
249         -framework JavaRuntimeSupport \
250         -framework ApplicationServices \
251         -framework AudioToolbox, \
</pre>
<hr />
<pre>
321       BUILD_LIBAWT_XAWT_awt_Font.c_CFLAGS := -w
322       # initializing a declared &#39;extern&#39;
323       BUILD_LIBAWT_XAWT_debug_mem.c_CFLAGS := -w
324     endif
325 
326     $(eval $(call SetupJdkLibrary, BUILD_LIBAWT_XAWT, \
327         NAME := awt_xawt, \
328         EXTRA_SRC := $(LIBAWT_XAWT_EXTRA_SRC), \
329         EXTRA_HEADER_DIRS := $(LIBAWT_XAWT_EXTRA_HEADER_DIRS), \
330         EXCLUDES := $(LIBAWT_XAWT_EXCLUDES), \
331         OPTIMIZATION := LOW, \
332         CFLAGS := $(CFLAGS_JDKLIB) $(LIBAWT_XAWT_CFLAGS) \
333             $(X_CFLAGS), \
334         WARNINGS_AS_ERRORS_xlc := false, \
335         DISABLED_WARNINGS_gcc := type-limits pointer-to-int-cast \
336             unused-result maybe-uninitialized format \
337             format-security int-to-pointer-cast parentheses \
338             implicit-fallthrough undef unused-function, \
339         DISABLED_WARNINGS_clang := parentheses format undef \
340             logical-op-parentheses format-nonliteral int-conversion, \
<span class="line-modified">341         DISABLED_WARNINGS_solstudio := E_ASSIGNMENT_TYPE_MISMATCH \</span>
<span class="line-modified">342              E_NON_CONST_INIT, \</span>
343         LDFLAGS := $(LDFLAGS_JDKLIB) \
344             $(call SET_SHARED_LIBRARY_ORIGIN) \
345             -L$(INSTALL_LIBRARIES_HERE), \
346         LIBS :=  $(X_LIBS) $(LIBAWT_XAWT_LIBS), \
347     ))
348 
349     $(BUILD_LIBAWT_XAWT): $(call FindLib, java.base, java)
350 
351     $(BUILD_LIBAWT_XAWT): $(BUILD_LIBAWT)
352 
353     TARGETS += $(BUILD_LIBAWT_XAWT)
354 
355   endif
356 endif
357 
358 ################################################################################
359 
360 # The fast floor code loses precision.
361 LCMS_CFLAGS=-DCMS_DONT_USE_FAST_FLOOR
362 
363 ifeq ($(USE_EXTERNAL_LCMS), true)
364   # If we&#39;re using an external library, we&#39;ll just need the wrapper part.
365   # By including it explicitly, all other files will be excluded.
366   BUILD_LIBLCMS_INCLUDE_FILES := LCMS.c
367   # If we&#39;re using an external library, we can&#39;t include our own SRC path
368   # as includes, instead the system headers should be used.
369   LIBLCMS_HEADERS_FROM_SRC := false
370 else
371   BUILD_LIBLCMS_INCLUDE_FILES :=
372 endif
373 
374 $(eval $(call SetupJdkLibrary, BUILD_LIBLCMS, \
375     NAME := lcms, \
376     INCLUDE_FILES := $(BUILD_LIBLCMS_INCLUDE_FILES), \
377     OPTIMIZATION := HIGHEST, \
378     CFLAGS := $(CFLAGS_JDKLIB) \
379         $(LCMS_CFLAGS), \

380     CFLAGS_windows := -DCMS_IS_WINDOWS_, \
381     EXTRA_HEADER_DIRS := \
382         common/awt/debug \
383         libawt/java2d, \
384     HEADERS_FROM_SRC := $(LIBLCMS_HEADERS_FROM_SRC), \
385     DISABLED_WARNINGS_gcc := format-nonliteral type-limits \
<span class="line-modified">386         misleading-indentation undef unused-function stringop-truncation, \</span>
387     DISABLED_WARNINGS_clang := tautological-compare format-nonliteral undef, \
388     DISABLED_WARNINGS_solstudio := E_STATEMENT_NOT_REACHED, \
389     DISABLED_WARNINGS_microsoft := 4819, \
390     LDFLAGS := $(LDFLAGS_JDKLIB) \
391         $(call SET_SHARED_LIBRARY_ORIGIN), \
392     LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
393     LIBS_unix := -lawt -ljvm -ljava $(LCMS_LIBS) $(LIBM), \
394     LIBS_windows := $(WIN_AWT_LIB) $(WIN_JAVA_LIB), \
395 ))
396 
397 TARGETS += $(BUILD_LIBLCMS)
398 
399 $(BUILD_LIBLCMS): $(BUILD_LIBAWT)
400 
401 ################################################################################
402 
403 # &quot;DISABLED_WARNINGS_gcc := clobbered&quot; rationale:
404 # Suppress gcc warnings like &quot;variable might be clobbered by &#39;longjmp&#39;
405 # or &#39;vfork&#39;&quot;: this warning indicates that some variable is placed to
406 # a register by optimized compiler and it&#39;s value might be lost on longjmp().
</pre>
<hr />
<pre>
453 
454   LIBAWT_HEADLESS_EXTRA_HEADER_DIRS := \
455       $(LIBAWT_DEFAULT_HEADER_DIRS) \
456       common/awt/debug \
457       common/font \
458       common/java2d/opengl \
459       #
460 
461   LIBAWT_HEADLESS_CFLAGS := $(CUPS_CFLAGS) $(FONTCONFIG_CFLAGS) $(X_CFLAGS) \
462       -DHEADLESS=true
463 
464   $(eval $(call SetupJdkLibrary, BUILD_LIBAWT_HEADLESS, \
465       NAME := awt_headless, \
466       EXTRA_SRC := $(LIBAWT_HEADLESS_EXTRA_SRC), \
467       EXCLUDES := $(LIBAWT_HEADLESS_EXCLUDES), \
468       OPTIMIZATION := LOW, \
469       CFLAGS := $(CFLAGS_JDKLIB) \
470           $(LIBAWT_HEADLESS_CFLAGS), \
471       EXTRA_HEADER_DIRS := $(LIBAWT_HEADLESS_EXTRA_HEADER_DIRS), \
472       DISABLED_WARNINGS_gcc := unused-function, \

473       DISABLED_WARNINGS_solstudio := E_EMPTY_TRANSLATION_UNIT, \
474       LDFLAGS := $(LDFLAGS_JDKLIB) \
475           $(call SET_SHARED_LIBRARY_ORIGIN), \
476       LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
477       LIBS_unix := -lawt -ljvm -ljava, \
478       LIBS_linux := $(LIBM) $(LIBDL), \
479       LIBS_solaris := $(LIBM) $(LIBDL) $(LIBCXX), \
480   ))
481 




482   $(BUILD_LIBAWT_HEADLESS): $(BUILD_LIBAWT)
483 
484   TARGETS += $(BUILD_LIBAWT_HEADLESS)
485 
486 endif
487 
488 ################################################################################
489 
490 ifeq ($(FREETYPE_TO_USE), system)
491   # For use by libfontmanager:
492   LIBFREETYPE_CFLAGS := $(FREETYPE_CFLAGS)
493   LIBFREETYPE_LIBS := $(FREETYPE_LIBS)
494 else
495   BUILD_LIBFREETYPE_HEADER_DIRS := $(TOPDIR)/src/$(MODULE)/share/native/libfreetype/include
496   BUILD_LIBFREETYPE_CFLAGS := -DFT2_BUILD_LIBRARY $(EXPORT_ALL_SYMBOLS)
497 
498   # For use by libfontmanager:
499   LIBFREETYPE_CFLAGS := -I$(BUILD_LIBFREETYPE_HEADER_DIRS)
500   ifeq ($(call isTargetOs, windows), true)
501     LIBFREETYPE_LIBS := $(SUPPORT_OUTPUTDIR)/native/$(MODULE)/libfreetype/freetype.lib
<span class="line-added">502     # freetype now requires you to manually define this (see ftconfig.h)</span>
<span class="line-added">503     BUILD_LIBFREETYPE_CFLAGS += -DDLL_EXPORT</span>
504   else
505     LIBFREETYPE_LIBS := -lfreetype
506   endif
507 
508   $(eval $(call SetupJdkLibrary, BUILD_LIBFREETYPE, \
509       NAME := freetype, \
510       OPTIMIZATION := HIGHEST, \
511       CFLAGS := $(CFLAGS_JDKLIB) \
512           $(BUILD_LIBFREETYPE_CFLAGS), \
513       EXTRA_HEADER_DIRS := $(BUILD_LIBFREETYPE_HEADER_DIRS), \
514       DISABLED_WARNINGS_solstudio := \
515          E_STATEMENT_NOT_REACHED \
516          E_END_OF_LOOP_CODE_NOT_REACHED, \
<span class="line-modified">517       DISABLED_WARNINGS_microsoft := 4018 4267 4244 4312 4819, \</span>
<span class="line-modified">518       DISABLED_WARNINGS_gcc := implicit-fallthrough cast-function-type bad-function-cast, \</span>
519       LDFLAGS := $(LDFLAGS_JDKLIB) \
520           $(call SET_SHARED_LIBRARY_ORIGIN), \
521   ))
522 
523   TARGETS += $(BUILD_LIBFREETYPE)
524 endif
525 
526 ###########################################################################
527 
528 #### Begin harfbuzz configuration
529 
530 HARFBUZZ_CFLAGS := -DHAVE_OT -DHAVE_FALLBACK -DHAVE_UCDN -DHAVE_ROUND
531 
532 ifeq ($(call isTargetOs, windows), false)
533   HARFBUZZ_CFLAGS += -DGETPAGESIZE -DHAVE_MPROTECT -DHAVE_PTHREAD \
<span class="line-modified">534                       -DHAVE_SYSCONF -DHAVE_SYS_MMAN_H -DHAVE_UNISTD_H \</span>
<span class="line-added">535                       -DHB_NO_PRAGMA_GCC_DIAGNOSTIC</span>
536 endif
537 ifeq ($(call isTargetOs, linux macosx), true)
538   HARFBUZZ_CFLAGS += -DHAVE_INTEL_ATOMIC_PRIMITIVES
539 endif
540 ifeq ($(call isTargetOs, solaris), true)
541   HARFBUZZ_CFLAGS += -DHAVE_SOLARIS_ATOMIC_OPS
542 endif
543 ifeq ($(call isTargetOs, macosx), true)
544   HARFBUZZ_CFLAGS += -DHAVE_CORETEXT
545 endif
546 ifeq ($(call isTargetOs, macosx), false)
547   LIBFONTMANAGER_EXCLUDE_FILES += harfbuzz/hb-coretext.cc
548 endif
549 # hb-ft.cc is not presently needed, and requires freetype 2.4.2 or later.
550 LIBFONTMANAGER_EXCLUDE_FILES += harfbuzz/hb-ft.cc
551 
552 LIBFONTMANAGER_CFLAGS += $(HARFBUZZ_CFLAGS)
553 
554 #### End harfbuzz configuration
555 
</pre>
<hr />
<pre>
592 
593 # LDFLAGS clarification:
594 #   Filter relevant linker flags disallowing unresolved symbols as we cannot
595 #   build-time decide to which library to link against (libawt_headless or
596 #   libawt_xawt). See JDK-8196516 for details.
597 $(eval $(call SetupJdkLibrary, BUILD_LIBFONTMANAGER, \
598     NAME := fontmanager, \
599     EXCLUDE_FILES := $(LIBFONTMANAGER_EXCLUDE_FILES) \
600         AccelGlyphCache.c, \
601     TOOLCHAIN := TOOLCHAIN_LINK_CXX, \
602     CFLAGS := $(CFLAGS_JDKLIB) $(LIBFONTMANAGER_CFLAGS), \
603     CXXFLAGS := $(CXXFLAGS_JDKLIB) $(LIBFONTMANAGER_CFLAGS), \
604     OPTIMIZATION := $(LIBFONTMANAGER_OPTIMIZATION), \
605     CFLAGS_windows = -DCC_NOEX, \
606     EXTRA_HEADER_DIRS := $(LIBFONTMANAGER_EXTRA_HEADER_DIRS), \
607     WARNINGS_AS_ERRORS_xlc := false, \
608     DISABLED_WARNINGS_gcc := sign-compare int-to-pointer-cast \
609         type-limits missing-field-initializers implicit-fallthrough \
610         strict-aliasing undef unused-function, \
611     DISABLED_WARNINGS_CXX_gcc := reorder delete-non-virtual-dtor strict-overflow \
<span class="line-modified">612         maybe-uninitialized class-memaccess, \</span>

613     DISABLED_WARNINGS_clang := unused-value incompatible-pointer-types \
614         tautological-constant-out-of-range-compare int-to-pointer-cast \
615         sign-compare undef missing-field-initializers, \
616     DISABLED_WARNINGS_C_solstudio = \
617         E_INTEGER_OVERFLOW_DETECTED \
618         E_ARG_INCOMPATIBLE_WITH_ARG_L \
619         E_ENUM_VAL_OVERFLOWS_INT_MAX, \
620     DISABLED_WARNINGS_CXX_solstudio := \
621         truncwarn wvarhidenmem wvarhidemem wbadlkginit identexpected \
<span class="line-modified">622         hidevf w_novirtualdescr arrowrtn2 refmemnoconstr_aggr unknownpragma \</span>
<span class="line-modified">623         doubunder wunreachable, \</span>
<span class="line-added">624     DISABLED_WARNINGS_microsoft := 4267 4244 4018 4090 4996 4146 4334 4819 4101 4068 4805 4138, \</span>
625     LDFLAGS := $(subst -Xlinker -z -Xlinker defs,, \
626         $(subst -Wl$(COMMA)-z$(COMMA)defs,,$(LDFLAGS_JDKLIB))) $(LDFLAGS_CXX_JDK) \
627         $(call SET_SHARED_LIBRARY_ORIGIN), \
628     LDFLAGS_unix := -L$(INSTALL_LIBRARIES_HERE), \
629     LDFLAGS_aix := -Wl$(COMMA)-berok, \
630     LIBS := $(BUILD_LIBFONTMANAGER_FONTLIB), \
631     LIBS_unix := -lawt -ljava -ljvm $(LIBM) $(LIBCXX), \
632     LIBS_macosx := -lawt_lwawt -framework CoreText -framework CoreFoundation \
633         -framework CoreGraphics, \
634     LIBS_windows := $(WIN_JAVA_LIB) advapi32.lib user32.lib gdi32.lib \
635         $(WIN_AWT_LIB), \
636 ))
637 
638 $(BUILD_LIBFONTMANAGER): $(BUILD_LIBAWT)
639 
640 ifeq ($(call isTargetOs, macosx), true)
641   $(BUILD_LIBFONTMANAGER): $(call FindLib, $(MODULE), awt_lwawt)
642 endif
643 
644 ifeq ($(FREETYPE_TO_USE), bundled)
</pre>
<hr />
<pre>
676       EXTRA_HEADER_DIRS := $(LIBJAWT_EXTRA_HEADER_DIRS), \
677       LDFLAGS := $(LDFLAGS_JDKLIB) $(LDFLAGS_CXX_JDK), \
678       LIBS := $(JDKLIB_LIBS) $(KERNEL32_LIB) advapi32.lib $(WIN_AWT_LIB), \
679   ))
680 
681   $(BUILD_LIBJAWT): $(BUILD_LIBAWT)
682 
683   $(eval $(call SetupCopyFiles, COPY_JAWT_LIB, \
684       FILES := $(BUILD_LIBJAWT_IMPORT_LIBRARY), \
685       DEST := $(SUPPORT_OUTPUTDIR)/modules_libs/$(MODULE), \
686   ))
687 
688   $(COPY_JAWT_LIB): $(BUILD_LIBJAWT)
689 
690   TARGETS += $(COPY_JAWT_LIB)
691 
692 else # not windows
693 
694   ifeq ($(call isTargetOs, macosx), true)
695     # libjawt on macosx do not use the unix code
<span class="line-modified">696     LIBJAWT_EXCLUDE_SRC_PATTERNS := /unix/</span>
697   endif
698 
699   ifeq ($(call isTargetOs, macosx), true)
700     JAWT_LIBS := -lawt_lwawt
701   else
702     JAWT_LIBS :=
703     ifeq ($(call isTargetOs, solaris), false)
704       JAWT_LIBS += -lawt
705     endif
706     ifeq ($(ENABLE_HEADLESS_ONLY), false)
707       JAWT_LIBS += -lawt_xawt
708     else
709       JAWT_LIBS += -lawt_headless
710       ifeq ($(call isTargetOs, linux), true)
711         JAWT_CFLAGS += -DHEADLESS
712       endif
713     endif
714   endif
715 
716   $(eval $(call SetupJdkLibrary, BUILD_LIBJAWT, \
</pre>
<hr />
<pre>
766     # While the following ought to work, it will currently pull in the closed
767     # additions to this library, and this was not done previously in the build.
768     # LIBSPLASHSCREEN_EXTRA_SRC += libjavajpeg
769     LIBSPLASHSCREEN_EXTRA_SRC += $(TOPDIR)/src/java.desktop/share/native/libjavajpeg
770   else
771     LIBJPEG_LIBS := -ljpeg
772   endif
773 
774   ifeq ($(USE_EXTERNAL_LIBPNG), false)
775     LIBSPLASHSCREEN_HEADER_DIRS += libsplashscreen/libpng
776   else
777     LIBSPLASHSCREEN_EXCLUDES += libpng
778   endif
779 
780   ifeq ($(USE_EXTERNAL_LIBZ), false)
781     LIBSPLASHSCREEN_EXTRA_SRC += java.base:libzip/zlib
782   endif
783 
784   ifeq ($(call isTargetOs, macosx), true)
785     # libsplashscreen on macosx do not use the unix code
<span class="line-modified">786     LIBSPLASHSCREEN_EXCLUDE_SRC_PATTERNS := /unix/</span>
787   endif
788 
<span class="line-modified">789   LIBSPLASHSCREEN_CFLAGS += -DSPLASHSCREEN -DPNG_NO_MMX_CODE \</span>
<span class="line-added">790                             -DPNG_ARM_NEON_OPT=0 -DPNG_ARM_NEON_IMPLEMENTATION=0</span>
791 
792   ifeq ($(call isTargetOs, linux), true)
793     ifeq ($(call isTargetCpuArch, ppc), true)
794       LIBSPLASHSCREEN_CFLAGS += -DPNG_POWERPC_VSX_OPT=0
795     endif
796   endif
797 
798   ifeq ($(call isTargetOs, macosx), true)
799     LIBSPLASHSCREEN_CFLAGS += -DWITH_MACOSX
800 
801     BUILD_LIBSPLASHSCREEN_java_awt_SplashScreen.c_CFLAGS := -x objective-c -O0
802     BUILD_LIBSPLASHSCREEN_splashscreen_gfx_impl.c_CFLAGS := -x objective-c -O0
803     BUILD_LIBSPLASHSCREEN_splashscreen_gif.c_CFLAGS := -x objective-c -O0
804     BUILD_LIBSPLASHSCREEN_splashscreen_impl.c_CFLAGS := -x objective-c -O0
805     BUILD_LIBSPLASHSCREEN_splashscreen_jpeg.c_CFLAGS := -x objective-c -O0
806     BUILD_LIBSPLASHSCREEN_splashscreen_png.c_CFLAGS := -x objective-c -O0
807     BUILD_LIBSPLASHSCREEN_splashscreen_sys.m_CFLAGS := -O0
808 
809   else ifeq ($(call isTargetOs, windows), true)
810     LIBSPLASHSCREEN_CFLAGS += -DWITH_WIN32
811   else
812     LIBSPLASHSCREEN_CFLAGS += -DWITH_X11 $(X_CFLAGS)
813   endif
814 
815   LIBSPLASHSCREEN_LIBS :=
816 
817   ifeq ($(call isTargetOs, macosx), true)
818     LIBSPLASHSCREEN_LIBS += \
819         $(LIBM) -lpthread -liconv -losxapp \
820         -framework ApplicationServices \
821         -framework Foundation \
<span class="line-added">822         -framework Security \</span>
823         -framework Cocoa \
824         -framework JavaNativeFoundation
825   else ifeq ($(call isTargetOs, windows), true)
826     LIBSPLASHSCREEN_LIBS += kernel32.lib user32.lib gdi32.lib delayimp.lib $(WIN_JAVA_LIB) jvm.lib
827   else
828     LIBSPLASHSCREEN_LIBS += $(X_LIBS) -lX11 -lXext $(LIBM) -lpthread -ldl
829   endif
830 
831   LIBSPLASHSCREEN_HEADER_DIRS += \
832       libosxapp \
833       java.base:include \
834       java.base:libjava \
835       #
836 
837   $(eval $(call SetupJdkLibrary, BUILD_LIBSPLASHSCREEN, \
838       NAME := splashscreen, \
839       EXTRA_SRC := $(LIBSPLASHSCREEN_EXTRA_SRC), \
840       EXCLUDE_SRC_PATTERNS := $(LIBSPLASHSCREEN_EXCLUDE_SRC_PATTERNS), \
841       EXCLUDE_FILES := imageioJPEG.c jpegdecoder.c pngtest.c, \
842       EXCLUDES := $(LIBSPLASHSCREEN_EXCLUDES), \
843       OPTIMIZATION := LOW, \
844       CFLAGS := $(CFLAGS_JDKLIB) $(LIBSPLASHSCREEN_CFLAGS) \
845           $(GIFLIB_CFLAGS) $(LIBJPEG_CFLAGS) $(PNG_CFLAGS) $(LIBZ_CFLAGS), \
846       EXTRA_HEADER_DIRS := $(LIBSPLASHSCREEN_HEADER_DIRS), \
847       DISABLED_WARNINGS_gcc := sign-compare type-limits unused-result \
848           maybe-uninitialized shift-negative-value implicit-fallthrough \
849           unused-function, \
850       DISABLED_WARNINGS_clang := incompatible-pointer-types sign-compare, \
<span class="line-modified">851       DISABLED_WARNINGS_solstudio := E_STATEMENT_NOT_REACHED, \</span>

852       DISABLED_WARNINGS_microsoft := 4018 4244 4267, \
853       LDFLAGS := $(LDFLAGS_JDKLIB) \
854           $(call SET_SHARED_LIBRARY_ORIGIN), \
855       LDFLAGS_macosx := -L$(INSTALL_LIBRARIES_HERE), \
856       LDFLAGS_windows := -delayload:user32.dll, \
857       LIBS := $(JDKLIB_LIBS) $(LIBSPLASHSCREEN_LIBS) $(LIBZ_LIBS) \
858           $(GIFLIB_LIBS) $(LIBJPEG_LIBS) $(PNG_LIBS), \
859       LIBS_aix := -liconv, \
860   ))
861 
862   TARGETS += $(BUILD_LIBSPLASHSCREEN)
863 
864   ifeq ($(call isTargetOs, macosx), true)
865     $(BUILD_LIBSPLASHSCREEN): $(call FindLib, $(MODULE), osxapp)
866   endif
867 
868 endif
869 
870 ################################################################################
871 
</pre>
</td>
</tr>
</table>
<center><a href="../launcher/LauncherCommon.gmk.sdiff.html" target="_top">&lt; prev</a> <a href="../../index.html" target="_top">index</a> <a href="CoreLibraries.gmk.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>