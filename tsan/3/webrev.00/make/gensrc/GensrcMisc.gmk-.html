<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old make/gensrc/GensrcMisc.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body>
    <pre>
  1 #
  2 # Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 ################################################################################
 27 # Install the launcher name, release version string, full version
 28 # string and the runtime name into the VersionProps.java file.
 29 
 30 $(eval $(call SetupTextFileProcessing, BUILD_VERSION_JAVA, \
 31     SOURCE_FILES := $(TOPDIR)/src/java.base/share/classes/java/lang/VersionProps.java.template, \
 32     OUTPUT_FILE := $(SUPPORT_OUTPUTDIR)/gensrc/java.base/java/lang/VersionProps.java, \
 33     REPLACEMENTS := \
 34         @@LAUNCHER_NAME@@ =&gt; $(LAUNCHER_NAME) ; \
 35         @@RUNTIME_NAME@@ =&gt; $(RUNTIME_NAME) ; \
 36         @@VERSION_SHORT@@ =&gt; $(VERSION_SHORT) ; \
 37         @@VERSION_STRING@@ =&gt; $(VERSION_STRING) ; \
 38         @@VERSION_NUMBER@@ =&gt; $(VERSION_NUMBER) ; \
 39         @@VERSION_PRE@@ =&gt; $(VERSION_PRE) ; \
 40         @@VERSION_BUILD@@ =&gt; $(VERSION_BUILD) ; \
 41         @@VERSION_OPT@@ =&gt; $(VERSION_OPT) ; \
 42         @@VERSION_DATE@@ =&gt; $(VERSION_DATE) ; \
 43         @@VERSION_CLASSFILE_MAJOR@@ =&gt; $(VERSION_CLASSFILE_MAJOR) ; \
 44         @@VERSION_CLASSFILE_MINOR@@ =&gt; $(VERSION_CLASSFILE_MINOR) ; \
 45         @@VERSION_SPECIFICATION@@ =&gt; $(VERSION_SPECIFICATION) ; \
 46         @@VENDOR_VERSION_STRING@@ =&gt; $(VENDOR_VERSION_STRING) ; \
 47         @@VENDOR@@ =&gt; $(COMPANY_NAME) ; \
 48         @@VENDOR_URL@@ =&gt; $(VENDOR_URL) ; \
 49         @@VENDOR_URL_BUG@@ =&gt; $(VENDOR_URL_BUG), \
 50 ))
 51 
 52 GENSRC_JAVA_BASE += $(BUILD_VERSION_JAVA)
 53 
 54 ################################################################################
 55 
 56 ifneq ($(filter $(TOOLCHAIN_TYPE), gcc clang), )
 57   # Need to specify language since the template file has a non standard
 58   # extension.
 59   CPP_FLAGS += -x c
 60 else ifeq ($(TOOLCHAIN_TYPE), microsoft)
 61   CPP_FLAGS += -nologo
 62 endif
 63 
 64 # Generate a java source file from a template through the C preprocessor for the
 65 # target system. First extract the copyright notice at the start of the file.
 66 # Run the preprocessor. Filter out the default compiler stderr output on
 67 # Windows. Filter out all the header files output. Remove all &quot;PREFIX_&quot; strings
 68 # that were added to variable references in the template files to avoid being
 69 # matched by the preprocessor. Remove any #line directives left by the
 70 # preprocessor.
 71 define generate-preproc-src
 72 	$(call MakeDir, $(@D))
 73 	( $(NAWK) &#39;/@@END_COPYRIGHT@@/{exit}1&#39; $&lt; &amp;&amp; \
 74 	  $(CPP) $(CPP_FLAGS) $(SYSROOT_CFLAGS) $(CFLAGS_JDKLIB) $&lt; \
 75 	      2&gt; &gt;($(GREP) -v &#39;^$(&lt;F)$$&#39; &gt;&amp;2) \
 76 	      | $(NAWK) &#39;/@@START_HERE@@/,0&#39; \
 77 	      |  $(SED) -e &#39;s/@@START_HERE@@/\/\/ AUTOMATICALLY GENERATED FILE - DO NOT EDIT/&#39; \
 78 	      -e &#39;s/PREFIX_//&#39; -e &#39;s/^#.*//&#39; \
 79 	) &gt; $@
 80 endef
 81 
 82 GENSRC_SOR_FILE += $(SUPPORT_OUTPUTDIR)/gensrc/java.base/sun/nio/ch/SocketOptionRegistry.java
 83 
 84 $(GENSRC_SOR_FILE): \
 85     $(TOPDIR)/src/java.base/share/classes/sun/nio/ch/SocketOptionRegistry.java.template
 86 	$(generate-preproc-src)
 87 
 88 GENSRC_JAVA_BASE += $(GENSRC_SOR_FILE)
 89 
 90 ################################################################################
 91 
 92 ifeq ($(call isTargetOs, windows), false)
 93 
 94   GENSRC_UC_FILE := $(SUPPORT_OUTPUTDIR)/gensrc/java.base/sun/nio/fs/UnixConstants.java
 95 
 96   $(GENSRC_UC_FILE): \
 97       $(TOPDIR)/src/java.base/unix/classes/sun/nio/fs/UnixConstants.java.template
 98 	$(generate-preproc-src)
 99 
100   GENSRC_JAVA_BASE += $(GENSRC_UC_FILE)
101 
102 endif
103 
104 ################################################################################
105 
106 ifeq ($(call isTargetOs, solaris), true)
107 
108   GENSRC_SC_FILE := $(SUPPORT_OUTPUTDIR)/gensrc/java.base/sun/nio/fs/SolarisConstants.java
109 
110   $(GENSRC_SC_FILE): \
111       $(TOPDIR)/src/java.base/solaris/classes/sun/nio/fs/SolarisConstants.java.template
112 	$(generate-preproc-src)
113 
114   GENSRC_JAVA_BASE += $(GENSRC_SC_FILE)
115 
116 endif
117 
118 ################################################################################
119 # Create the javax/crypto/JceSecurity.class, using the build default.
120 #
121 ifeq ($(UNLIMITED_CRYPTO), true)
122     JCE_DEFAULT_POLICY = unlimited
123 else
124     JCE_DEFAULT_POLICY = limited
125 endif
126 
127 ifneq ($(wildcard $(TOPDIR)/src/java.base/share/classes/javax/crypto/JceSecurity.java.template), )
128   $(eval $(call SetupTextFileProcessing, BUILD_JCESECURITY_JAVA, \
129       SOURCE_FILES := $(TOPDIR)/src/java.base/share/classes/javax/crypto/JceSecurity.java.template, \
130       OUTPUT_FILE := $(SUPPORT_OUTPUTDIR)/gensrc/java.base/javax/crypto/JceSecurity.java, \
131       REPLACEMENTS := \
132         @@JCE_DEFAULT_POLICY@@ =&gt; $(JCE_DEFAULT_POLICY), \
133   ))
134 
135   GENSRC_JAVA_BASE += $(BUILD_JCESECURITY_JAVA)
136 endif
    </pre>
  </body>
</html>