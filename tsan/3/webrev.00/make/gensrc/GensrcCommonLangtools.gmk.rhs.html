<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames make/gensrc/GensrcCommonLangtools.gmk</title>
    <link rel="stylesheet" href="../../style.css" />
    <script type="text/javascript" src="../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 #
<a name="1" id="anc1"></a><span class="line-modified">  2 # Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4 #
  5 # This code is free software; you can redistribute it and/or modify it
  6 # under the terms of the GNU General Public License version 2 only, as
  7 # published by the Free Software Foundation.  Oracle designates this
  8 # particular file as subject to the &quot;Classpath&quot; exception as provided
  9 # by Oracle in the LICENSE file that accompanied this code.
 10 #
 11 # This code is distributed in the hope that it will be useful, but WITHOUT
 12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14 # version 2 for more details (a copy is included in the LICENSE file that
 15 # accompanied this code).
 16 #
 17 # You should have received a copy of the GNU General Public License version
 18 # 2 along with this work; if not, write to the Free Software Foundation,
 19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20 #
 21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22 # or visit www.oracle.com if you need additional information or have any
 23 # questions.
 24 #
 25 
 26 # This must be the first rule
 27 default: all
 28 
 29 include $(SPEC)
 30 include MakeBase.gmk
 31 include JavaCompilation.gmk
 32 
 33 ################################################################################
 34 # The compileprops tools compiles a properties file into a resource bundle.
 35 TOOL_COMPILEPROPS_CMD := $(JAVA_SMALL) -cp $(BUILDTOOLS_OUTPUTDIR)/langtools_tools_classes \
 36     compileproperties.CompileProperties -quiet
 37 
 38 ################################################################################
 39 # The compileprops tools compiles a properties file into an enum-like class.
 40 TOOL_PARSEPROPS_CMD := $(JAVA_SMALL) -cp $(BUILDTOOLS_OUTPUTDIR)/langtools_tools_classes \
 41     propertiesparser.PropertiesParser
 42 
 43 
 44 ################################################################################
 45 # Sets up a rule that creates a version.properties file in the gensrc output
 46 # directory.
 47 # Param 1 - Variable to add generated file name to
 48 # Param 2 - Name of version.properties file including packages from the src
 49 #           root.
 50 define SetupVersionProperties
 51   $(SUPPORT_OUTPUTDIR)/gensrc/$(MODULE)/$$(strip $2):
 52 	$$(call MakeTargetDir)
 53 	$(PRINTF) &quot;jdk=$(VERSION_NUMBER)\nfull=$(VERSION_STRING)\nrelease=$(VERSION_SHORT)\n&quot; \
 54 	    &gt; $$@
 55 
 56   $$(strip $1) += $(SUPPORT_OUTPUTDIR)/gensrc/$(MODULE)/$$(strip $2)
 57 endef
 58 
 59 ################################################################################
 60 # Finds all properties files in the module source and creates a rule that runs
 61 # CompileProperties on them into the gensrc dir.
 62 # Param 1 - Variable to add targets to
 63 # Param 2 - Extra properties files to process
 64 define SetupCompileProperties
 65   # Lookup the properties that need to be compiled into resource bundles.
 66   PROPSOURCES := $2 \
<a name="2" id="anc2"></a><span class="line-modified"> 67       $$(call FindFiles, $(TOPDIR)/src/$(MODULE)/share/classes, *.properties)</span>
 68 
 69   # Filter out any excluded translations
 70   PROPSOURCES := $$(call FilterExcludedTranslations, $$(PROPSOURCES), .properties)
 71 
 72   # Convert .../src/&lt;module&gt;/share/classes/com/sun/tools/javac/resources/javac_zh_CN.properties
 73   # to .../langtools/gensrc/&lt;module&gt;/com/sun/tools/javac/resources/javac_zh_CN.java
 74   # Strip away prefix and suffix, leaving for example only:
 75   # &quot;&lt;module&gt;/share/classes/com/sun/tools/javac/resources/javac_zh_CN&quot;
 76   PROPJAVAS := $$(patsubst $(TOPDIR)/src/%, \
 77       $(SUPPORT_OUTPUTDIR)/gensrc/%, \
 78       $$(patsubst %.properties, %.java, \
 79       $$(subst /share/classes,, $$(PROPSOURCES))))
 80 
 81   # Generate the package dirs for the to be generated java files. Sort to remove
 82   # duplicates.
 83   PROPDIRS := $$(sort $$(dir $$(PROPJAVAS)))
 84 
 85   # Now generate a sequence of:
 86   # &quot;-compile ...javac_zh_CN.properties ...javac_zh_CN.java java.util.ListResourceBundle&quot;
 87   # suitable to be fed into the CompileProperties command.
 88   PROPCMDLINE := $$(subst _SPACE_, $(SPACE), \
 89       $$(join $$(addprefix -compile_SPACE_, $$(PROPSOURCES)), \
 90       $$(addsuffix _SPACE_java.util.ListResourceBundle, \
 91       $$(addprefix _SPACE_, $$(PROPJAVAS)))))
 92 
 93   # Now setup the rule for the generation of the resource bundles.
 94   $(SUPPORT_OUTPUTDIR)/gensrc/$(MODULE)/_the_props: $$(PROPSOURCES)
 95 	$$(call MakeDir, $$(@D) $$(PROPDIRS))
 96 	$(FIND) $$(@D) -name &quot;*.java&quot; -a ! -name &quot;*Properties.java&quot; $(FIND_DELETE)
 97 	$(ECHO) Compiling $$(words $$(PROPSOURCES)) properties into resource bundles for $(MODULE)
 98 	$(TOOL_COMPILEPROPS_CMD) $$(PROPCMDLINE)
 99 	$(TOUCH) $$@
100 
101   $$(strip $1) += $(SUPPORT_OUTPUTDIR)/gensrc/$(MODULE)/_the_props
102 endef
103 
104 ################################################################################
105 # Parse property files in given location and generate a Java-like enum in the gensrc folder.
106 # Param 1 - Variable to add targets to
107 # Param 2 - Extra properties files to process
108 define SetupParseProperties
109   # property files to process
110   PARSEPROPSOURCES := $$(addprefix $(TOPDIR)/src/$(MODULE)/share/classes/, $2)
111   PARSEPROPSOURCES := $$(call FilterExcludedTranslations, $$(PARSEPROPSOURCES), .properties)
112 
113   PARSEPROPALLDIRS := $$(patsubst $(TOPDIR)/src/$(MODULE)/share/classes/%, \
114       $(SUPPORT_OUTPUTDIR)/gensrc/$(MODULE)/%, \
115       $$(dir $$(PARSEPROPSOURCES)))
116 
117   PARSEPROPDIRS := $$(sort $$(PARSEPROPALLDIRS))
118 
119   PARSEPROPCMDLINE := $$(subst _SPACE_, $$(SPACE), \
120     $$(join $$(foreach var,$$(PARSEPROPSOURCES),$$(addprefix -compile_SPACE_,$$(var))), \
121     $$(addprefix _SPACE_, $$(PARSEPROPALLDIRS))))
122 
123   # Now setup the rule for the generation of the resource bundles.
124   $(SUPPORT_OUTPUTDIR)/gensrc/$(MODULE)/_the_parsed_props: $$(PARSEPROPSOURCES)
125 	$$(call MakeDir, $$(@D) $$(PARSEPROPDIRS))
126 	$(FIND) $$(@D) -name &quot;*Properties.java&quot; $(FIND_DELETE)
127 	$(ECHO) Parsing $$(words $$(PARSEPROPSOURCES)) properties into enum-like class for $(MODULE)
128 	$(TOOL_PARSEPROPS_CMD) $$(PARSEPROPCMDLINE)
129 	$(TOUCH) $$@
130 
131   $$(strip $1) += $(SUPPORT_OUTPUTDIR)/gensrc/$(MODULE)/_the_parsed_props
132 endef
133 
134 ################################################################################
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>