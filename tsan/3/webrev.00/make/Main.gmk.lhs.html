<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames make/Main.gmk</title>
    <link rel="stylesheet" href="../style.css" />
    <script type="text/javascript" src="../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 #
<a name="1" id="anc1"></a><span class="line-modified">   2 # Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3 # DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4 #
   5 # This code is free software; you can redistribute it and/or modify it
   6 # under the terms of the GNU General Public License version 2 only, as
   7 # published by the Free Software Foundation.  Oracle designates this
   8 # particular file as subject to the &quot;Classpath&quot; exception as provided
   9 # by Oracle in the LICENSE file that accompanied this code.
  10 #
  11 # This code is distributed in the hope that it will be useful, but WITHOUT
  12 # ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13 # FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14 # version 2 for more details (a copy is included in the LICENSE file that
  15 # accompanied this code).
  16 #
  17 # You should have received a copy of the GNU General Public License version
  18 # 2 along with this work; if not, write to the Free Software Foundation,
  19 # Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20 #
  21 # Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22 # or visit www.oracle.com if you need additional information or have any
  23 # questions.
  24 #
  25 
  26 ################################################################################
  27 # This is the main makefile containing most actual top level targets. It needs
  28 # to be called with a SPEC file defined.
  29 ################################################################################
  30 
  31 # Declare default target
  32 default:
  33 
  34 ifeq ($(wildcard $(SPEC)),)
  35   $(error Main.gmk needs SPEC set to a proper spec.gmk)
  36 endif
  37 
  38 # Now load the spec
  39 include $(SPEC)
  40 
  41 include $(TOPDIR)/make/MainSupport.gmk
  42 
  43 # Load the vital tools for all the makefiles.
  44 include $(TOPDIR)/make/common/MakeBase.gmk
  45 include $(TOPDIR)/make/common/Modules.gmk
  46 include $(TOPDIR)/make/common/FindTests.gmk
  47 
  48 # Declare ALL_TARGETS as an immediate variable. This variable is a list of all
  49 # valid top level targets. It&#39;s used to declare them all as PHONY and to
  50 # generate the -only targets.
  51 ALL_TARGETS :=
  52 
  53 # Hook to include the corresponding custom file, if present.
  54 $(eval $(call IncludeCustomExtension, Main.gmk))
  55 
  56 # All modules for the current target platform.
  57 ALL_MODULES := $(call FindAllModules)
  58 
  59 ################################################################################
  60 ################################################################################
  61 #
  62 # Recipes for all targets. Only recipes, dependencies are declared later.
  63 #
  64 ################################################################################
  65 
  66 ################################################################################
  67 # Interim/build tools targets, compiling tools used during the build
  68 
<a name="2" id="anc2"></a><span class="line-modified">  69 # When creating a BUILDJDK, the buildtools and interim targets have already</span>
<span class="line-removed">  70 # been built and should not be built again.</span>
<span class="line-removed">  71 ifneq ($(CREATING_BUILDJDK), true)</span>
<span class="line-removed">  72   buildtools-langtools:</span>
  73 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ToolsLangtools.gmk)
  74 
<a name="3" id="anc3"></a><span class="line-modified">  75   interim-langtools:</span>
  76 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimLangtools.gmk)
  77 
<a name="4" id="anc4"></a><span class="line-modified">  78   interim-rmic:</span>
  79 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileInterimRmic.gmk)
  80 
<a name="5" id="anc5"></a><span class="line-modified">  81   interim-cldrconverter:</span>
<span class="line-modified">  82 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CopyInterimCLDRConverter.gmk)</span>
  83 
<a name="6" id="anc6"></a><span class="line-modified">  84   buildtools-jdk:</span>

  85 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsJdk.gmk)
  86 
<a name="7" id="anc7"></a><span class="line-modified">  87   buildtools-modules:</span>
  88 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileModuleTools.gmk)
  89 
<a name="8" id="anc8"></a><span class="line-modified">  90   buildtools-hotspot:</span>
  91 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileToolsHotspot.gmk)
<a name="9" id="anc9"></a><span class="line-removed">  92 endif</span>
  93 
  94 ALL_TARGETS += buildtools-langtools interim-langtools \
<a name="10" id="anc10"></a><span class="line-modified">  95     interim-rmic interim-cldrconverter buildtools-jdk buildtools-modules \</span>
  96     buildtools-hotspot
  97 
  98 ################################################################################
  99 # Special targets for certain modules
 100 
 101 generate-exported-symbols:
 102 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildStatic.gmk)
 103 
 104 ALL_TARGETS += generate-exported-symbols
 105 
 106 ################################################################################
 107 # Gensrc targets, generating source before java compilation can be done
 108 #
<a name="11" id="anc11"></a><span class="line-modified"> 109 # When creating a BUILDJDK, the java targets have already been built and copied</span>
<span class="line-modified"> 110 # into the buildjdk so no need to generate sources.</span>
<span class="line-modified"> 111 ifneq ($(CREATING_BUILDJDK), true)</span>
<span class="line-modified"> 112   $(eval $(call DeclareRecipesForPhase, GENSRC, \</span>
<span class="line-modified"> 113       TARGET_SUFFIX := gensrc-src, \</span>
<span class="line-modified"> 114       FILE_PREFIX := Gensrc, \</span>
<span class="line-modified"> 115       MAKE_SUBDIR := gensrc, \</span>
<span class="line-modified"> 116       CHECK_MODULES := $(ALL_MODULES), \</span>
<span class="line-modified"> 117   ))</span>
<span class="line-modified"> 118 </span>
<span class="line-modified"> 119   $(foreach m, $(GENSRC_MODULES), $(eval $m-gensrc: $m-gensrc-src))</span>
<span class="line-modified"> 120 </span>
<span class="line-modified"> 121   LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, $(LANGTOOLS_MODULES)), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 122   INTERIM_LANGTOOLS_GENSRC_TARGETS := $(filter $(addsuffix -%, \</span>
<span class="line-modified"> 123       $(INTERIM_LANGTOOLS_BASE_MODULES)), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 124   HOTSPOT_GENSRC_TARGETS := $(filter $(addsuffix -%, $(HOTSPOT_MODULES)), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 125   JDK_GENSRC_TARGETS := $(filter-out $(LANGTOOLS_GENSRC_TARGETS) \</span>
<span class="line-modified"> 126       $(HOTSPOT_GENSRC_TARGETS), $(GENSRC_TARGETS))</span>
<span class="line-modified"> 127 </span>
<span class="line-modified"> 128   GENSRC_MODULEINFO_MODULES := $(ALL_MODULES)</span>
<span class="line-modified"> 129   GENSRC_MODULEINFO_TARGETS := $(addsuffix -gensrc-moduleinfo, \</span>
<span class="line-modified"> 130       $(GENSRC_MODULEINFO_MODULES))</span>
<span class="line-modified"> 131 </span>
<span class="line-modified"> 132   GENSRC_MODULES := $(GENSRC_MODULEINFO_MODULES)</span>
<span class="line-modified"> 133   GENSRC_TARGETS += $(sort $(GENSRC_MODULEINFO_TARGETS) \</span>
<span class="line-modified"> 134       $(addsuffix -gensrc, $(GENSRC_MODULES)))</span>
<span class="line-removed"> 135 </span>
<span class="line-removed"> 136   define DeclareModuleInfoRecipe</span>
<span class="line-removed"> 137     $1-gensrc-moduleinfo:</span>
 138 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
<a name="12" id="anc12"></a><span class="line-modified"> 139 	    -f GensrcModuleInfo.gmk MODULE=$1)</span>
 140 
<a name="13" id="anc13"></a><span class="line-modified"> 141     $1-gensrc: $1-gensrc-moduleinfo</span>
<span class="line-modified"> 142   endef</span>
 143 
<a name="14" id="anc14"></a><span class="line-modified"> 144   $(foreach m, $(GENSRC_MODULEINFO_MODULES), $(eval $(call DeclareModuleInfoRecipe,$m)))</span>
<span class="line-removed"> 145 endif</span>
 146 
 147 ALL_TARGETS += $(GENSRC_TARGETS)
 148 
 149 ################################################################################
 150 # Generate data targets
 151 $(eval $(call DeclareRecipesForPhase, GENDATA, \
 152     TARGET_SUFFIX := gendata, \
 153     FILE_PREFIX := Gendata, \
 154     MAKE_SUBDIR := gendata, \
 155     CHECK_MODULES := $(ALL_MODULES), \
 156     USE_WRAPPER := true))
 157 
 158 ALL_TARGETS += $(GENDATA_TARGETS)
 159 
 160 ################################################################################
 161 # Copy files targets
 162 $(eval $(call DeclareRecipesForPhase, COPY, \
 163     TARGET_SUFFIX := copy, \
 164     FILE_PREFIX := Copy, \
 165     MAKE_SUBDIR := copy, \
 166     CHECK_MODULES := $(ALL_MODULES), \
 167     USE_WRAPPER := true, \
 168 ))
 169 
 170 ALL_COPY_MODULES += $(COPY_MODULES)
 171 ALL_COPY_TARGETS += $(COPY_TARGETS)
 172 
 173 IMPORT_COPY_MODULES := $(call FindImportedModules)
 174 IMPORT_COPY_TARGETS := $(addsuffix -copy, $(IMPORT_COPY_MODULES))
 175 ALL_COPY_MODULES += $(IMPORT_COPY_MODULES)
 176 ALL_COPY_TARGETS += $(IMPORT_COPY_TARGETS)
 177 
 178 define DeclareImportCopyRecipe
 179   $1-copy:
 180 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
 181 	    -f CopyImportModules.gmk MODULE=$1)
 182 endef
 183 
 184 $(foreach m, $(IMPORT_COPY_MODULES), $(eval $(call DeclareImportCopyRecipe,$m)))
 185 
 186 ALL_TARGETS += $(ALL_COPY_TARGETS)
 187 
 188 ################################################################################
 189 # Targets for compiling all java modules.
 190 JAVA_MODULES := $(ALL_MODULES)
 191 JAVA_TARGETS := $(addsuffix -java, $(JAVA_MODULES))
 192 
 193 define DeclareCompileJavaRecipe
 194   $1-java:
 195 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) \
 196 	    -f CompileJavaModules.gmk MODULE=$1)
 197 endef
 198 
 199 $(foreach m, $(JAVA_MODULES), $(eval $(call DeclareCompileJavaRecipe,$m)))
 200 
 201 ALL_TARGETS += $(JAVA_TARGETS)
 202 
 203 ################################################################################
 204 # Targets for running rmic.
 205 $(eval $(call DeclareRecipesForPhase, RMIC, \
 206     TARGET_SUFFIX := rmic, \
 207     FILE_PREFIX := Rmic, \
 208     MAKE_SUBDIR := rmic, \
 209     CHECK_MODULES := $(ALL_MODULES)))
 210 
 211 ALL_TARGETS += $(RMIC_TARGETS)
 212 
 213 ################################################################################
 214 # Targets for compiling native libraries
 215 $(eval $(call DeclareRecipesForPhase, LIBS, \
 216     TARGET_SUFFIX := libs, \
 217     FILE_PREFIX := Lib, \
 218     MAKE_SUBDIR := lib, \
 219     CHECK_MODULES := $(ALL_MODULES), \
 220     USE_WRAPPER := true))
 221 
 222 ALL_TARGETS += $(LIBS_TARGETS)
 223 
<a name="15" id="anc15"></a>














 224 ################################################################################
 225 # Targets for compiling native executables
 226 $(eval $(call DeclareRecipesForPhase, LAUNCHER, \
 227     TARGET_SUFFIX := launchers, \
 228     FILE_PREFIX := Launcher, \
 229     MAKE_SUBDIR := launcher, \
 230     CHECK_MODULES := $(ALL_MODULES), \
 231     USE_WRAPPER := true))
 232 
 233 ALL_TARGETS += $(LAUNCHER_TARGETS)
 234 
 235 ################################################################################
 236 # Build hotspot target
 237 
 238 HOTSPOT_VARIANT_TARGETS := $(addprefix hotspot-, $(JVM_VARIANTS))
 239 HOTSPOT_VARIANT_GENSRC_TARGETS := $(addsuffix -gensrc, $(HOTSPOT_VARIANT_TARGETS))
 240 HOTSPOT_VARIANT_LIBS_TARGETS := $(addsuffix -libs, $(HOTSPOT_VARIANT_TARGETS))
 241 
 242 define DeclareHotspotGensrcRecipe
 243   hotspot-$1-gensrc:
 244 	$$(call LogInfo, Building JVM variant &#39;$1&#39; with features &#39;$(JVM_FEATURES_$1)&#39;)
 245 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f gensrc/GenerateSources.gmk \
 246 	    JVM_VARIANT=$1)
 247 endef
 248 
 249 $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotGensrcRecipe,$v)))
 250 
 251 define DeclareHotspotLibsRecipe
 252   hotspot-$1-libs:
 253 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f lib/CompileLibraries.gmk \
 254 	    JVM_VARIANT=$1)
 255 endef
 256 
 257 $(foreach v, $(JVM_VARIANTS), $(eval $(call DeclareHotspotLibsRecipe,$v)))
 258 
 259 hotspot-ide-project:
 260 	+($(CD) $(TOPDIR)/make/hotspot &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ide/CreateVSProject.gmk)
 261 
 262 ALL_TARGETS += $(HOTSPOT_VARIANT_TARGETS) $(HOTSPOT_VARIANT_GENSRC_TARGETS) \
 263     $(HOTSPOT_VARIANT_LIBS_TARGETS) hotspot-ide-project
 264 
 265 ################################################################################
 266 # Generate libs and launcher targets for creating compile_commands.json fragments
 267 define DeclareCompileCommandsRecipe
 268   $1-compile-commands:
 269 	$$(call LogInfo, Generating compile_commands.json fragments for $1)
 270 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk $1-only \
 271 	    GENERATE_COMPILE_COMMANDS_ONLY=true)
 272 
 273   COMPILE_COMMANDS_TARGETS_$2 += $1-compile-commands
 274 endef
 275 
 276 $(foreach t, $(HOTSPOT_VARIANT_LIBS_TARGETS), \
 277   $(eval $(call DeclareCompileCommandsRecipe,$t,HOTSPOT)) \
 278 )
 279 
 280 $(foreach t, $(LIBS_TARGETS) $(LAUNCHER_TARGETS), \
 281   $(eval $(call DeclareCompileCommandsRecipe,$t,JDK)) \
 282 )
 283 
 284 compile-commands compile-commands-hotspot:
 285 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileCommands.gmk)
 286 
 287 ALL_TARGETS += $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
 288 ALL_TARGETS += compile-commands compile-commands-hotspot
 289 
<a name="16" id="anc16"></a>




















 290 ################################################################################
 291 # Build demos targets
 292 
 293 demos-jdk:
 294 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk)
 295 
 296 test-image-demos-jdk:
 297 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CompileDemos.gmk images)
 298 
 299 ALL_TARGETS += demos-jdk test-image-demos-jdk
 300 
 301 ################################################################################
 302 # Jigsaw specific data and analysis targets.
 303 
 304 generate-summary:
 305 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateModuleSummary.gmk)
 306 
 307 ALL_TARGETS += generate-summary
 308 
 309 ################################################################################
 310 # Jmod targets
 311 
 312 JMOD_MODULES := $(ALL_MODULES)
 313 JMOD_TARGETS := $(addsuffix -jmod, $(JMOD_MODULES))
 314 
 315 define DeclareJmodRecipe
 316   $1-jmod:
 317 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 318 	    MODULE=$1)
 319 endef
 320 
 321 $(foreach m, $(JMOD_MODULES), $(eval $(call DeclareJmodRecipe,$m)))
 322 
 323 ALL_TARGETS += $(JMOD_TARGETS)
 324 
 325 ################################################################################
 326 # Images targets
 327 
 328 store-source-revision:
 329 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk store-source-revision)
 330 
 331 create-source-revision-tracker:
 332 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f SourceRevision.gmk create-source-revision-tracker)
 333 
 334 BOOTCYCLE_TARGET := product-images
 335 bootcycle-images:
 336         ifneq ($(COMPILE_TYPE), cross)
 337 	  $(call LogWarn, Boot cycle build step 2: Building a new JDK image using previously built image)
<a name="17" id="anc17"></a>
 338 	  +$(MAKE) $(MAKE_ARGS) -f $(TOPDIR)/make/Init.gmk PARALLEL_TARGETS=$(BOOTCYCLE_TARGET) \
<a name="18" id="anc18"></a><span class="line-modified"> 339 	      JOBS= SPEC=$(dir $(SPEC))bootcycle-spec.gmk main</span>
 340         else
 341 	  $(call LogWarn, Boot cycle build disabled when cross compiling)
 342         endif
 343 
 344 zip-security:
 345 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSecurity.gmk)
 346 
 347 zip-source:
 348 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ZipSource.gmk)
 349 
 350 jrtfs-jar:
 351 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JrtfsJar.gmk)
 352 
 353 jdk-image:
 354 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jdk)
 355 
 356 legacy-jre-image:
 357 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk jre)
 358 
 359 symbols-image:
 360 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Images.gmk symbols)
 361 
<a name="19" id="anc19"></a>


 362 mac-jdk-bundle:
 363 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jdk-bundle)
 364 
 365 mac-legacy-jre-bundle:
 366 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f MacBundles.gmk jre-bundle)
 367 
 368 release-file:
 369 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ReleaseFile.gmk)
 370 
 371 exploded-image-optimize:
 372 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f ExplodedImageOptimize.gmk)
 373 
<a name="20" id="anc20"></a>


 374 ifeq ($(JCOV_ENABLED), true)
 375   jcov-image:
 376 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Coverage.gmk jcov-image)
 377 endif
 378 
 379 ALL_TARGETS += store-source-revision create-source-revision-tracker bootcycle-images zip-security \
 380     zip-source jrtfs-jar jdk-image legacy-jre-image \
<a name="21" id="anc21"></a><span class="line-modified"> 381     symbols-image mac-jdk-bundle mac-legacy-jre-bundle \</span>
<span class="line-modified"> 382     release-file exploded-image-optimize jcov-image</span>
 383 
 384 ################################################################################
 385 # Docs targets
 386 
 387 # If building full docs, to complete docs-*-api we need both the javadoc and
 388 # modulegraph targets.
 389 docs-jdk-api-javadoc:
 390 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-javadoc)
 391 
 392 docs-jdk-api-modulegraph:
 393 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-api-modulegraph)
 394 
 395 docs-javase-api-javadoc:
 396 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-javadoc)
 397 
 398 docs-javase-api-modulegraph:
 399 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-javase-api-modulegraph)
 400 
 401 docs-reference-api-javadoc:
 402 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-javadoc)
 403 
 404 docs-reference-api-modulegraph:
 405 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-reference-api-modulegraph)
 406 
 407 docs-jdk-specs:
 408 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-specs)
 409 
 410 docs-jdk-index:
 411 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-jdk-index)
 412 
 413 docs-zip:
 414 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Docs.gmk docs-zip)
 415 
<a name="22" id="anc22"></a>


 416 update-build-docs:
 417 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateBuildDocs.gmk)
 418 
 419 update-x11wrappers:
 420 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f UpdateX11Wrappers.gmk)
 421 
 422 ALL_TARGETS += docs-jdk-api-javadoc docs-jdk-api-modulegraph \
 423     docs-javase-api-javadoc docs-javase-api-modulegraph \
 424     docs-reference-api-javadoc docs-reference-api-modulegraph docs-jdk-specs \
<a name="23" id="anc23"></a><span class="line-modified"> 425     docs-jdk-index docs-zip update-build-docs update-x11wrappers</span>
 426 
 427 ################################################################################
 428 # Cross compilation support
 429 
 430 ifeq ($(CREATING_BUILDJDK), true)
 431   # This target is only called by the recursive call below.
 432   create-buildjdk-interim-image-helper: interim-image jdk.jlink-launchers \
 433       java.base-copy jdk.jdeps-launchers
 434 endif
 435 
<a name="24" id="anc24"></a><span class="line-modified"> 436 create-buildjdk-copy:</span>
<span class="line-modified"> 437 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateBuildJdkCopy.gmk)</span>
 438 
 439 create-buildjdk-interim-image:
 440 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Main.gmk \
 441 	    $@-helper \
 442 	    SPEC=$(dir $(SPEC))buildjdk-spec.gmk \
 443 	    HOTSPOT_SPEC=$(dir $(SPEC))buildjdk-spec.gmk \
<a name="25" id="anc25"></a><span class="line-modified"> 444 	    CREATING_BUILDJDK=true)</span>



 445 
 446 ALL_TARGETS += create-buildjdk-copy create-buildjdk-interim-image
 447 
 448 ################################################################################
 449 # The interim-image is a small jlinked image that is used to generate artifacts
 450 # at build time for use when linking the real images.
 451 
 452 INTERIM_JMOD_TARGETS := $(addsuffix -interim-jmod, $(INTERIM_IMAGE_MODULES))
 453 
 454 define DeclareInterimJmodRecipe
 455   $1-interim-jmod:
 456 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f CreateJmods.gmk \
 457 	    MODULE=$1 \
 458 	    JMODS_DIR=$(INTERIM_JMODS_DIR) \
 459 	    JMODS_SUPPORT_DIR=$(INTERIM_JMODS_DIR)/support \
 460 	    INTERIM_JMOD=true \
 461 	)
 462 endef
 463 
 464 $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $(call DeclareInterimJmodRecipe,$m)))
 465 
 466 interim-image:
 467 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f InterimImage.gmk)
 468 
 469 ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
 470   generate-link-opt-data:
 471 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GenerateLinkOptData.gmk)
 472 endif
 473 
 474 ALL_TARGETS += $(INTERIM_JMOD_TARGETS) interim-image generate-link-opt-data
 475 
 476 ################################################################################
 477 # Generate test names for all JTReg test groups
 478 #
 479 
 480 define DeclareRunTestRecipe
 481   test-$1:
 482 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 483 	    TEST=&quot;$1&quot;)
 484 
 485   exploded-test-$1:
 486 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 487 	    TEST=&quot;$1&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))
 488 endef
 489 
 490 # ALL_NAMED_TESTS is defined in FindTests.gmk
 491 $(foreach t, $(ALL_NAMED_TESTS), $(eval $(call DeclareRunTestRecipe,$t)))
 492 ALL_TEST_TARGETS := $(addprefix test-, $(ALL_NAMED_TESTS))
 493 
 494 # We only support the &quot;exploded-test-gtest&quot; shortcut
 495 ALL_EXPLODED_TESTS := gtest
 496 ALL_EXPLODED_TEST_TARGETS := $(addprefix exploded-test-, $(ALL_EXPLODED_TESTS))
 497 
 498 ALL_TARGETS += $(ALL_TEST_TARGETS) $(ALL_EXPLODED_TEST_TARGETS)
 499 
 500 ################################################################################
 501 # Build tests and microbenchmarks
 502 #
 503 
 504 prepare-test-image:
 505 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f TestImage.gmk prepare-test-image)
 506 
 507 build-test-hotspot-jtreg-native:
 508 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeHotspot.gmk \
 509 	    build-test-hotspot-jtreg-native)
 510 
 511 test-image-hotspot-jtreg-native:
 512 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeHotspot.gmk \
 513 	    test-image-hotspot-jtreg-native)
 514 
 515 build-test-jdk-jtreg-native:
 516 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeJdk.gmk \
 517 	    build-test-jdk-jtreg-native)
 518 
 519 test-image-jdk-jtreg-native:
 520 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregNativeJdk.gmk \
 521 	    test-image-jdk-jtreg-native)
 522 
 523 build-test-hotspot-jtreg-graal:
 524 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregGraalUnit.gmk \
 525 	     build-test-hotspot-jtreg-graal)
 526 
 527 test-image-hotspot-jtreg-graal:
 528 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f JtregGraalUnit.gmk \
 529 	     test-image-hotspot-jtreg-graal)
 530 
 531 ifeq ($(BUILD_GTEST), true)
 532   test-image-hotspot-gtest:
 533 	+($(CD) $(TOPDIR)/make/hotspot/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f GtestImage.gmk)
 534 endif
 535 
 536 build-test-lib:
 537 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) -f BuildTestLib.gmk)
 538 
 539 ifeq ($(BUILD_FAILURE_HANDLER), true)
 540   # Builds the failure handler jtreg extension
 541   build-test-failure-handler:
 542 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) \
 543 	    -f BuildFailureHandler.gmk build)
 544 
 545   # Copies the failure handler jtreg extension into the test image
 546   test-image-failure-handler:
 547 	+($(CD) $(TOPDIR)/make/test &amp;&amp; $(MAKE) $(MAKE_ARGS) \
 548 	     -f BuildFailureHandler.gmk images)
 549 endif
 550 
 551 build-microbenchmark:
 552 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f test/BuildMicrobenchmark.gmk)
 553 
 554 ALL_TARGETS += prepare-test-image build-test-hotspot-jtreg-native \
 555     test-image-hotspot-jtreg-native build-test-jdk-jtreg-native \
 556     test-image-jdk-jtreg-native build-test-lib build-test-failure-handler \
 557     test-failure-handler test-image-failure-handler test-image-hotspot-gtest \
 558     test-image-hotspot-jtreg-graal build-test-hotspot-jtreg-graal \
 559     build-microbenchmark
 560 
 561 ################################################################################
 562 # Run tests
 563 
 564 test:
 565 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 566 	    TEST=&quot;$(TEST)&quot;)
 567 
 568 exploded-test:
 569 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 570 	    TEST=&quot;$(TEST)&quot; JDK_IMAGE_DIR=$(JDK_OUTPUTDIR))
 571 
 572 jcov-test:
 573 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f RunTests.gmk \
 574 	    TEST=&quot;$(TEST)&quot; TEST_OPTS_JCOV=true)
 575 
 576 ALL_TARGETS += test exploded-test jcov-test
 577 
 578 ################################################################################
 579 # Bundles
 580 
 581 product-bundles:
 582 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk product-bundles)
 583 
<a name="26" id="anc26"></a>


 584 test-bundles:
 585 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk test-bundles)
 586 
 587 docs-bundles:
 588 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk docs-bundles)
 589 
<a name="27" id="anc27"></a>


 590 ifeq ($(JCOV_ENABLED), true)
 591   jcov-bundles:
 592 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Bundles.gmk jcov-bundles)
 593 endif
 594 
<a name="28" id="anc28"></a><span class="line-modified"> 595 ALL_TARGETS += product-bundles test-bundles docs-bundles jcov-bundles</span>

 596 
 597 ################################################################################
 598 # Install targets
 599 
 600 install:
 601 	+($(CD) $(TOPDIR)/make &amp;&amp; $(MAKE) $(MAKE_ARGS) -f Install.gmk)
 602 
 603 ALL_TARGETS += install
 604 
 605 ################################################################################
 606 #
 607 # Dependency declarations between targets.
 608 #
 609 # These are declared in two groups. First all dependencies between targets that
 610 # have recipes above as these dependencies may be disabled. Then the aggregator
 611 # targets that do not have recipes of their own, which will never have their
 612 # dependencies disabled.
 613 #
 614 ################################################################################
 615 # Targets with recipes above
 616 
 617 # If running an *-only target, parallel execution and dependencies between
 618 # recipe targets are disabled. This makes it possible to run a select set of
 619 # recipe targets in order. It&#39;s the responsibility of the user to make sure
 620 # all prerequisites are fulfilled.
 621 ifneq ($(findstring -only, $(MAKECMDGOALS)), )
 622   .NOTPARALLEL:
 623 else
 624   $(LANGTOOLS_GENSRC_TARGETS): buildtools-langtools
 625 
 626   interim-langtools: $(INTERIM_LANGTOOLS_GENSRC_TARGETS)
 627 
<a name="29" id="anc29"></a><span class="line-modified"> 628   buildtools-jdk: interim-langtools interim-cldrconverter</span>
 629 
 630   buildtools-hotspot: interim-langtools
 631 
 632   buildtools-modules: exploded-image-base
 633 
 634   $(HOTSPOT_GENSRC_TARGETS): interim-langtools buildtools-hotspot
 635 
 636   $(JDK_GENSRC_TARGETS): interim-langtools buildtools-jdk
 637 
 638   $(GENSRC_MODULEINFO_TARGETS): buildtools-jdk
 639 
 640   $(GENDATA_TARGETS): interim-langtools buildtools-jdk
 641 
 642   interim-rmic: interim-langtools
 643 
 644   $(RMIC_TARGETS): interim-langtools interim-rmic
 645 
 646   $(JAVA_TARGETS): interim-langtools
 647 
 648   # Declare dependencies between hotspot-&lt;variant&gt;* targets
 649   $(foreach v, $(JVM_VARIANTS), \
<a name="30" id="anc30"></a><span class="line-removed"> 650       $(eval hotspot-$v: hotspot-$v-gensrc hotspot-$v-libs) \</span>
 651       $(eval hotspot-$v-gensrc: java.base-copy) \
 652       $(eval hotspot-$v-libs: hotspot-$v-gensrc java.base-copy) \
 653   )
 654 
 655   hotspot-ide-project: hotspot exploded-image
 656 
 657   generate-exported-symbols: java.base-libs jdk.jdwp.agent-libs
 658 
 659   # If not already set, set the JVM variant target so that the JVM will be built.
 660   JVM_MAIN_LIB_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-libs
 661 
 662   # Building one JVM variant is enough to start building the other libs
 663   $(LIBS_TARGETS): $(JVM_MAIN_LIB_TARGETS)
 664 
 665   $(LAUNCHER_TARGETS): java.base-libs
 666 
 667   ifeq ($(STATIC_BUILD), true)
 668     $(LAUNCHER_TARGETS): generate-exported-symbols
 669   endif
 670 
 671   # The demos are currently linking to libjvm and libjava, just like all other
 672   # jdk libs, even though they don&#39;t need to. To avoid warnings, make sure they
 673   # aren&#39;t built until after libjava and libjvm are available to link to.
<a name="31" id="anc31"></a><span class="line-modified"> 674   demos-jdk: java.base-libs exploded-image-optimize</span>
 675   test-image-demos-jdk: demos-jdk
 676 
 677   # Declare dependency from &lt;module&gt;-java to &lt;module&gt;-gensrc
 678   $(foreach m, $(GENSRC_MODULES), $(eval $m-java: $m-gensrc))
 679 
 680   # Declare dependencies between java modules
 681   $(foreach m, $(JAVA_MODULES), \
 682       $(eval $m-java: $(addsuffix -java, $(filter $(JAVA_MODULES), \
 683       $(call FindDepsForModule,$m)))))
<a name="32" id="anc32"></a>

 684 
 685   # Declare dependencies between &lt;module&gt;-rmic to &lt;module&gt;-java
 686   $(foreach m, $(RMIC_MODULES), $(eval $m-rmic: $m-java))
 687 
 688   # Declare dependencies from &lt;module&gt;-lib to &lt;module&gt;-java
 689   # Skip modules that do not have java source.
<a name="33" id="anc33"></a><span class="line-modified"> 690   # When creating a BUILDJDK, the java compilation has already been done by the</span>
<span class="line-removed"> 691   # normal build and copied in.</span>
<span class="line-removed"> 692   ifneq ($(CREATING_BUILDJDK), true)</span>
<span class="line-removed"> 693     $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs: $m-java))</span>
<span class="line-removed"> 694   endif</span>
 695 
 696   # Declare dependencies from all other &lt;module&gt;-lib to java.base-lib
 697   $(foreach t, $(filter-out java.base-libs, $(LIBS_TARGETS)), \
 698       $(eval $t: java.base-libs))
 699 
 700   # jdk.accessibility depends on java.desktop
 701   jdk.accessibility-libs: java.desktop-libs
 702 
 703   # This dependency needs to be explicitly declared. jdk.jdi-gensrc generates a
 704   # header file used by jdk.jdwp.agent-libs. The jdk.jdwp.agent-gensrc is a
 705   # virtual target.
 706   jdk.jdwp.agent-libs: jdk.jdwp.agent-gensrc
 707 
 708   # The swing beans need to have java base properly generated to avoid errors
 709   # in javadoc. The X11 wrappers need the java.base include files to have been
 710   # copied and processed.
 711   java.desktop-gensrc-src: java.base-gensrc java.base-copy
 712 
 713   # The annotation processing for jdk.internal.vm.compiler
 714   # and jdk.internal.vm.compiler.management needs classes from the current JDK.
 715   jdk.internal.vm.compiler-gensrc-src: $(addsuffix -java, \
 716       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler))
 717   jdk.internal.vm.compiler.management-gensrc-src: $(addsuffix -java, \
 718       $(call FindTransitiveDepsForModule, jdk.internal.vm.compiler.management))
 719 
 720   # For these modules, the gensrc step is generating a module-info.java.extra
 721   # file to be processed by the gensrc-moduleinfo target.
 722   jdk.internal.vm.compiler-gensrc-moduleinfo: jdk.internal.vm.compiler-gensrc-src
 723   jdk.internal.vm.compiler.management-gensrc-moduleinfo: jdk.internal.vm.compiler.management-gensrc-src
 724 
 725   jdk.jdeps-gendata: java rmic
 726 
 727   # The ct.sym generation uses all the moduleinfos as input
 728   jdk.compiler-gendata: $(GENSRC_MODULEINFO_TARGETS)
 729 
 730   # Declare dependencies between jmod targets.
 731   # java.base jmod needs jrt-fs.jar and access to the other jmods to be built.
<a name="34" id="anc34"></a><span class="line-modified"> 732   # When creating a BUILDJDK, we don&#39;t need to add hashes to java.base, thus</span>
 733   # we don&#39;t need to depend on all other jmods
 734   ifneq ($(CREATING_BUILDJDK), true)
 735     java.base-jmod: jrtfs-jar $(filter-out java.base-jmod, $(JMOD_TARGETS))
 736   endif
 737 
 738   # If not already set, set the JVM target so that the JVM will be built.
 739   JVM_MAIN_TARGETS ?= hotspot
 740 
 741   # Building java.base-jmod requires all of VM (ie hotspot) to be built.
 742   java.base-jmod: $(JVM_MAIN_TARGETS)
 743 
 744   # Declare dependencies from &lt;module&gt;-jmod to all other module targets
<a name="35" id="anc35"></a><span class="line-modified"> 745   # When creating a BUILDJDK, the java compilation has already been done by the</span>
<span class="line-removed"> 746   # normal build and copied in.</span>
<span class="line-removed"> 747   ifneq ($(CREATING_BUILDJDK), true)</span>
<span class="line-removed"> 748     $(foreach m, $(JAVA_MODULES), $(eval $m_JMOD_DEPS += $m-java))</span>
<span class="line-removed"> 749   endif</span>
 750   $(foreach m, $(GENDATA_MODULES), $(eval $m_JMOD_DEPS += $m-gendata))
 751   $(foreach m, $(RMIC_MODULES), $(eval $m_JMOD_DEPS += $m-rmic))
 752   $(foreach m, $(LIBS_MODULES), $(eval $m_JMOD_DEPS += $m-libs))
 753   $(foreach m, $(LAUNCHER_MODULES), $(eval $m_JMOD_DEPS += $m-launchers))
 754   $(foreach m, $(COPY_MODULES), $(eval $m_JMOD_DEPS += $m-copy))
 755   $(foreach m, $(ALL_MODULES), $(eval $m-jmod: $($(m)_JMOD_DEPS)))
 756   $(foreach m, $(INTERIM_IMAGE_MODULES), $(eval $m-interim-jmod: $($(m)_JMOD_DEPS)))
 757 
 758   # Setup the minimal set of generated native source dependencies for hotspot
 759   $(foreach v, $(JVM_VARIANTS), \
 760     $(eval hotspot-$v-libs-compile-commands: hotspot-$v-gensrc) \
 761     $(foreach m, $(filter java.desktop jdk.hotspot.agent, $(GENSRC_MODULES)), \
 762       $(eval hotspot-$v-libs-compile-commands: $m-gensrc)) \
 763   )
 764 
 765   # For the full JDK compile commands, create all possible generated sources
 766   $(foreach m, $(GENSRC_MODULES), $(eval $m-libs-compile-commands: $m-gensrc))
 767   $(foreach m, $(filter $(JAVA_MODULES), $(LIBS_MODULES)), $(eval $m-libs-compile-commands: $m-java))
 768 
 769   $(COMPILE_COMMANDS_TARGETS_HOTSPOT): clean-compile-commands
 770   $(COMPILE_COMMANDS_TARGETS_JDK): clean-compile-commands
 771   compile-commands-hotspot: $(COMPILE_COMMANDS_TARGETS_HOTSPOT)
 772   compile-commands: $(COMPILE_COMMANDS_TARGETS_HOTSPOT) $(COMPILE_COMMANDS_TARGETS_JDK)
 773 
<a name="36" id="anc36"></a>








 774   # Jmods cannot be created until we have the jmod tool ready to run. During
 775   # a normal build we run it from the exploded image, but when cross compiling
 776   # it&#39;s run from the buildjdk, which is either created at build time or user
 777   # supplied.
<a name="37" id="anc37"></a><span class="line-removed"> 778   #</span>
<span class="line-removed"> 779   # For the exploded image to be runnable, all java modules and</span>
<span class="line-removed"> 780   # jdk.jlink-launchers need to be built. We also need to copy jvm.cfg (done</span>
<span class="line-removed"> 781   # in java.base-copy) and tzdb.dat (done in java.base-gendata) to the</span>
<span class="line-removed"> 782   # appropriate location otherwise jimage, jlink and jmod won&#39;t start. This</span>
<span class="line-removed"> 783   # also applies when creating the buildjdk.</span>
<span class="line-removed"> 784   DEFAULT_JMOD_DEPS += java.base-libs java.base-copy java.base-gendata \</span>
<span class="line-removed"> 785       jdk.jlink-launchers</span>
<span class="line-removed"> 786   # When cross compiling and buildjdk is to be created, depend on creating the</span>
<span class="line-removed"> 787   # buildjdk instead of the default dependencies.</span>
 788   ifeq ($(CREATE_BUILDJDK), true)
<a name="38" id="anc38"></a><span class="line-removed"> 789     # Avoid calling create-buildjdk from within a create-buildjdk call.</span>
 790     ifneq ($(CREATING_BUILDJDK), true)
<a name="39" id="anc39"></a>

 791       $(JMOD_TARGETS): create-buildjdk
 792       buildtools-modules: create-buildjdk
 793     else
<a name="40" id="anc40"></a><span class="line-modified"> 794       # While actually creating the buildjdk, the default deps applies.</span>
<span class="line-modified"> 795       $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): $(DEFAULT_JMOD_DEPS)</span>








 796     endif
 797   else
<a name="41" id="anc41"></a><span class="line-modified"> 798     # The normal non cross compilation case uses the default deps.</span>
<span class="line-modified"> 799     # To avoid races with the optimize target, that also needs to happen first.</span>
<span class="line-modified"> 800     $(JMOD_TARGETS) $(INTERIM_JMOD_TARGETS): $(DEFAULT_JMOD_DEPS) \</span>
<span class="line-removed"> 801         exploded-image-optimize</span>
 802   endif
 803 
 804   # All modules include the main license files from java.base.
 805   $(JMOD_TARGETS): java.base-copy
 806 
 807   zip-security: java.base-java java.security.jgss-java java.security.jgss-libs \
 808       $(filter jdk.crypto%, $(JAVA_TARGETS))
 809 
 810   zip-source: gensrc rmic
 811 
 812   jrtfs-jar: interim-langtools
 813 
 814   build-microbenchmark: interim-langtools exploded-image
 815 
 816   ifeq ($(ENABLE_GENERATE_CLASSLIST), true)
 817     ifeq ($(CREATE_BUILDJDK), true)
 818       # If creating a buildjdk, the interim image needs to be based on that.
 819       generate-link-opt-data: create-buildjdk
 820     else ifeq ($(EXTERNAL_BUILDJDK), false)
 821       # If an external buildjdk has been provided, we skip generating an
 822       # interim-image and just use the external buildjdk for generating
 823       # classlist.
 824       generate-link-opt-data: interim-image
 825     endif
 826     generate-link-opt-data: buildtools-jdk
 827 
 828     # The generated classlist needs to go into java.base-jmod.
 829     java.base-jmod jdk.jlink-jmod jdk-image legacy-jre-image: generate-link-opt-data
 830   endif
 831 
 832   release-file: create-source-revision-tracker
 833 
 834   jdk-image: jmods zip-source demos release-file
 835   legacy-jre-image: jmods release-file
 836   symbols-image: $(LIBS_TARGETS) $(LAUNCHER_TARGETS)
 837 
<a name="42" id="anc42"></a>



 838   mac-jdk-bundle: jdk-image
 839   mac-legacy-jre-bundle: legacy-jre-image
 840 
 841   ifeq ($(JCOV_INPUT_JDK), )
 842     jcov-image: jdk-image
 843   endif
 844 
 845   # The optimize target can run as soon as the modules dir has been completely
 846   # populated (java, copy and gendata targets) and the basic libs and launchers
 847   # have been built.
 848   exploded-image-optimize: java copy gendata java.base-libs java.base-launchers \
 849       buildtools-modules
 850 
 851   bootcycle-images: jdk-image
 852 
 853   docs-jdk-api-javadoc: $(GENSRC_TARGETS) rmic
 854 
 855   docs-javase-api-javadoc: $(GENSRC_TARGETS) rmic
 856 
 857   docs-reference-api-javadoc: $(GENSRC_TARGETS) rmic
 858 
 859   docs-jdk-api-modulegraph: exploded-image buildtools-modules
 860 
 861   docs-javase-api-modulegraph: exploded-image buildtools-modules
 862 
 863   docs-reference-api-modulegraph: exploded-image buildtools-modules
 864 
 865   # If not already set, then set the JVM specific docs targets
 866   JVM_DOCS_TARGETS ?= hotspot-$(JVM_VARIANT_MAIN)-gensrc
 867 
 868   # The gensrc steps for hotspot and jdk.jdi create html spec files.
<a name="43" id="anc43"></a><span class="line-modified"> 869   docs-jdk-specs: $(JVM_DOCS_TARGETS) jdk.jdi-gensrc \</span>
 870       docs-jdk-index
 871 
 872   docs-zip: docs-jdk
 873 
<a name="44" id="anc44"></a>

 874   # Tests
 875   test: jdk-image test-image
 876 
 877   exploded-test: exploded-image test-image
 878 
 879   jcov-test: jcov-image test-image
 880 
 881   test-make: clean-test-make compile-commands
 882 
 883   test-make-compile-commands: compile-commands
 884 
 885   # Declare dependency for all generated test targets
 886   $(foreach t, $(filter-out test-make%, $(ALL_TEST_TARGETS)), $(eval $t: jdk-image test-image))
 887   $(foreach t, $(ALL_EXPLODED_TEST_TARGETS), $(eval $t: exploded-image test-image))
 888 
<a name="45" id="anc45"></a><span class="line-removed"> 889   create-buildjdk-copy: jdk.jlink-java java.base-gendata \</span>
<span class="line-removed"> 890       $(addsuffix -java, $(INTERIM_IMAGE_MODULES))</span>
<span class="line-removed"> 891 </span>
<span class="line-removed"> 892   create-buildjdk-interim-image: create-buildjdk-copy</span>
<span class="line-removed"> 893 </span>
 894   interim-image: $(INTERIM_JMOD_TARGETS)
 895 
<a name="46" id="anc46"></a><span class="line-modified"> 896   build-test-lib: exploded-image-optimize</span>
 897 
 898   build-test-failure-handler: interim-langtools
 899 
 900   test-image-failure-handler: build-test-failure-handler
 901 
 902   build-test-hotspot-jtreg-native: buildtools-jdk \
 903       hotspot-$(JVM_VARIANT_MAIN)-libs
 904 
 905   build-test-jdk-jtreg-native: buildtools-jdk java.base-libs
 906 
<a name="47" id="anc47"></a><span class="line-modified"> 907   build-test-hotspot-jtreg-graal: exploded-image-optimize</span>
 908 
 909   test-image-hotspot-jtreg-native: build-test-hotspot-jtreg-native
 910 
 911   test-image-jdk-jtreg-native: build-test-jdk-jtreg-native
 912 
 913   test-image-hotspot-jtreg-graal: build-test-hotspot-jtreg-graal
 914 
 915   test-image-hotspot-gtest: hotspot
 916 
 917   install: product-images
 918 
 919   product-bundles: product-images
 920 
<a name="48" id="anc48"></a>

 921   test-bundles: test-image
 922 
 923   docs-bundles: docs-image
 924 
 925   jcov-bundles: jcov-image
 926 
<a name="49" id="anc49"></a>

 927   generate-summary: jmods buildtools-modules
 928 
 929   update-x11wrappers: java.base-copy buildtools-jdk
 930 
 931 endif
 932 
 933 ################################################################################
 934 # Virtual targets without recipes
 935 
 936 # If not already set, set the JVM specific tools targets
 937 JVM_TOOLS_TARGETS ?= buildtools-hotspot
 938 buildtools: buildtools-langtools interim-langtools interim-rmic \
 939     buildtools-jdk $(JVM_TOOLS_TARGETS)
 940 
<a name="50" id="anc50"></a>



 941 hotspot: $(HOTSPOT_VARIANT_TARGETS)
 942 
 943 # Create targets hotspot-libs and hotspot-gensrc.
 944 $(foreach v, $(JVM_VARIANTS), \
 945   $(eval hotspot-libs: hotspot-$v-libs) \
 946   $(eval hotspot-gensrc: hotspot-$v-gensrc) \
 947 )
 948 
 949 gensrc: $(GENSRC_TARGETS)
 950 
 951 gendata: $(GENDATA_TARGETS)
 952 
 953 copy: $(ALL_COPY_TARGETS)
 954 
 955 java: $(JAVA_TARGETS)
 956 
 957 rmic: $(RMIC_TARGETS)
 958 
 959 libs: $(LIBS_TARGETS)
 960 
<a name="51" id="anc51"></a>

 961 launchers: $(LAUNCHER_TARGETS)
 962 
 963 jmods: $(JMOD_TARGETS)
 964 
 965 # Explicitly declare dependency for virtual target jdk.jdwp.agent-gensrc which
 966 # is actually handled by jdk.jdi-gensrc
 967 jdk.jdwp.agent-gensrc: jdk.jdi-gensrc
 968 
 969 # Declare dependencies from &lt;module&gt; to all the individual targets specific
 970 # to that module &lt;module&gt;-*, that are needed for the exploded image.
 971 $(foreach m, $(GENSRC_MODULES), $(eval $m: $m-gensrc))
 972 $(foreach m, $(JAVA_MODULES), $(eval $m: $m-java))
 973 $(foreach m, $(GENDATA_MODULES), $(eval $m: $m-gendata))
 974 $(foreach m, $(RMIC_MODULES), $(eval $m: $m-rmic))
 975 $(foreach m, $(LIBS_MODULES), $(eval $m: $m-libs))
 976 $(foreach m, $(LAUNCHER_MODULES), $(eval $m: $m-launchers))
 977 $(foreach m, $(ALL_COPY_MODULES), $(eval $m: $m-copy))
 978 
 979 # Building java.base includes building all of hotspot.
 980 java.base: $(JVM_MAIN_TARGETS)
 981 
 982 demos: demos-jdk
 983 
 984 # The &quot;exploded image&quot; is a locally runnable JDK in $(OUTPUTDIR)/jdk.
 985 exploded-image-base: $(ALL_MODULES)
 986 exploded-image: exploded-image-base release-file
 987 # When cross compiling, no need to optimize the exploded image since it won&#39;t
 988 # be runnable on the host platform anyway.
 989 ifneq ($(COMPILE_TYPE), cross)
 990   exploded-image: exploded-image-optimize
 991 endif
 992 
<a name="52" id="anc52"></a><span class="line-modified"> 993 create-buildjdk: create-buildjdk-copy create-buildjdk-interim-image</span>
 994 
 995 docs-jdk-api: docs-jdk-api-javadoc
 996 docs-javase-api: docs-javase-api-javadoc
 997 docs-reference-api: docs-reference-api-javadoc
 998 
 999 # If we&#39;re building full docs, we must also generate the module graphs to
1000 # get non-broken api documentation.
1001 ifeq ($(ENABLE_FULL_DOCS), true)
1002   docs-jdk-api: docs-jdk-api-modulegraph
1003   docs-javase-api: docs-javase-api-modulegraph
1004   docs-reference-api: docs-reference-api-modulegraph
1005 endif
1006 
1007 docs-jdk: docs-jdk-api docs-jdk-specs docs-jdk-index
1008 docs-javase: docs-javase-api
1009 docs-reference: docs-reference-api
1010 
1011 # alias for backwards compatibility
1012 docs-javadoc: docs-jdk-api
1013 
1014 mac-bundles: mac-jdk-bundle
1015 
1016 # The $(OUTPUTDIR)/images directory contain the resulting deliverables,
1017 # and in line with this, our targets for creating these are named *-image[s].
1018 
1019 # This target builds the product images, e.g. the JDK image
1020 # (and possibly other, more specific versions)
1021 product-images: jdk-image symbols-image exploded-image
1022 
<a name="53" id="anc53"></a>


1023 # zip-security is actually a bundle, but for now it needs to be considered
1024 # an image until this can be cleaned up properly.
1025 product-images: zip-security
1026 
1027 # The module summary cannot be run when:
1028 # * Cross compiling and building a partial BUILDJDK for the build host
1029 # * An external buildjdk has been supplied since it may not match the
1030 #   module selection of the target jdk
1031 ifneq ($(CREATE_BUILDJDK), true)
1032   ifeq ($(EXTERNAL_BUILDJDK), false)
1033     product-images: generate-summary
1034   endif
1035 endif
1036 
1037 ifeq ($(call isTargetOs, macosx), true)
1038   product-images: mac-jdk-bundle
<a name="54" id="anc54"></a>

1039 endif
1040 
1041 # This target builds the documentation image
1042 docs-image: docs-jdk
1043 
1044 # If not already set, set the JVM specific targets to build the test image
1045 JVM_TEST_IMAGE_TARGETS ?= test-image-hotspot-jtreg-native test-image-hotspot-gtest
1046 
1047 ifeq ($(INCLUDE_GRAAL), true)
1048   JVM_TEST_IMAGE_TARGETS += test-image-hotspot-jtreg-graal
1049 endif
1050 
1051 # This target builds the test image
1052 test-image: prepare-test-image \
1053     test-image-jdk-jtreg-native test-image-failure-handler \
1054     test-image-demos-jdk $(JVM_TEST_IMAGE_TARGETS)
1055 
1056 ifneq ($(JMH_CORE_JAR), )
1057   test-image: build-microbenchmark
1058 endif
1059 
1060 ################################################################################
1061 
1062 # all-images builds all our deliverables as images.
1063 all-images: product-images test-image docs-image
1064 
1065 # all-bundles packages all our deliverables as tar.gz bundles.
<a name="55" id="anc55"></a><span class="line-modified">1066 all-bundles: product-bundles test-bundles docs-bundles</span>
1067 
1068 ALL_TARGETS += buildtools hotspot hotspot-libs hotspot-gensrc gensrc gendata \
<a name="56" id="anc56"></a><span class="line-modified">1069     copy java rmic libs launchers jmods \</span>
1070     jdk.jdwp.agent-gensrc $(ALL_MODULES) demos \
1071     exploded-image-base exploded-image \
1072     create-buildjdk docs-jdk-api docs-javase-api docs-reference-api docs-jdk \
<a name="57" id="anc57"></a><span class="line-modified">1073     docs-javase docs-reference docs-javadoc mac-bundles product-images \</span>
1074     docs-image test-image all-images \
1075     all-bundles
1076 
1077 ################################################################################
1078 
1079 # Traditional targets typically run by users.
1080 # These can be considered aliases for the targets now named by a more
1081 # &quot;modern&quot; naming scheme.
1082 default: $(DEFAULT_MAKE_TARGET)
1083 jdk: exploded-image
1084 images: product-images
1085 docs: docs-image
1086 bundles: all-bundles
1087 all: all-images
1088 
1089 ALL_TARGETS += default jdk images docs bundles all
1090 
1091 # Aliases used for running tests.
1092 
1093 # Let &quot;run-test&quot; be an alias for &quot;test&quot;
1094 $(foreach t, $(ALL_NAMED_TESTS), $(eval run-test-$t: test-$t))
1095 RUN_TEST_TARGETS := $(addprefix run-test-, $(ALL_NAMED_TESTS))
1096 
1097 run-test: test
1098 exploded-run-test: exploded-test
1099 
1100 # &quot;make check&quot; is a common idiom for running basic testing
1101 check: test-tier1
1102 
1103 # Keep some old names as aliases
1104 test-hotspot-jtreg: test-hotspot_all
1105 test-hotspot-jtreg-native: test-hotspot_native_sanity
1106 test-hotspot-gtest: exploded-test-gtest
1107 test-jdk-jtreg-native: test-jdk_native_sanity
1108 
1109 ALL_TARGETS += $(RUN_TEST_TARGETS) run-test exploded-run-test check \
1110     test-hotspot-jtreg test-hotspot-jtreg-native test-hotspot-gtest \
1111     test-jdk-jtreg-native
1112 
1113 ################################################################################
1114 ################################################################################
1115 #
1116 # Clean targets
1117 #
1118 ################################################################################
1119 # Clean targets are automatically run serially by the Makefile calling this
1120 # file.
1121 
1122 CLEAN_DIRS += hotspot jdk bootcycle-build test buildtools support \
1123     images make-support test-make bundles buildjdk test-results test-support \
1124     support/images
1125 CLEAN_DIR_TARGETS := $(addprefix clean-, $(CLEAN_DIRS))
1126 CLEAN_SUPPORT_DIRS += demos
1127 CLEAN_SUPPORT_DIR_TARGETS := $(addprefix clean-, $(CLEAN_SUPPORT_DIRS))
1128 CLEAN_TESTS += hotspot-jtreg-native jdk-jtreg-native lib
1129 CLEAN_TEST_TARGETS += $(addprefix clean-test-, $(CLEAN_TESTS))
1130 CLEAN_PHASES := gensrc java native include
1131 CLEAN_PHASE_TARGETS := $(addprefix clean-, $(CLEAN_PHASES))
1132 CLEAN_MODULE_TARGETS := $(addprefix clean-, $(ALL_MODULES))
1133 # Construct targets of the form clean-$module-$phase
1134 CLEAN_MODULE_PHASE_TARGETS := $(addprefix clean-, $(foreach m, $(ALL_MODULES), \
1135     $(addprefix $m-, $(CLEAN_PHASES))))
1136 
1137 # Remove everything, except the output from configure.
1138 clean: $(CLEAN_DIR_TARGETS)
1139 	($(CD) $(OUTPUTDIR) &amp;&amp; $(RM) -r build*.log* compile_commands.json)
1140 	$(ECHO) Cleaned all build artifacts.
1141 
1142 clean-docs:
1143 	$(call CleanDocs)
1144 
1145 clean-compile-commands:
1146 	$(call CleanMakeSupportDir,compile-commands)
1147 
1148 $(CLEAN_DIR_TARGETS):
1149 	$(call CleanDir,$(patsubst clean-%, %, $@))
1150 
1151 $(CLEAN_SUPPORT_DIR_TARGETS):
1152 	$(call CleanSupportDir,$(patsubst clean-%, %, $@))
1153 
1154 $(CLEAN_TEST_TARGETS):
1155 	$(call CleanTest,$(patsubst clean-test-%, %, $@))
1156 
1157 $(CLEAN_PHASE_TARGETS):
1158 	$(call Clean-$(patsubst clean-%,%, $@))
1159 
1160 $(CLEAN_MODULE_TARGETS):
1161 	$(call CleanModule,$(patsubst clean-%, %, $@))
1162 
1163 $(CLEAN_MODULE_PHASE_TARGETS):
1164 	$(call Clean-$(word 3, $(subst -,$(SPACE),$@)), \
1165 	    $(word 2, $(subst -,$(SPACE),$@)))
1166 
1167 # When removing the support dir, we must also remove jdk. Building classes has
1168 # the side effect of generating native headers. The headers end up in support
1169 # while classes and touch files end up in jdk.
1170 clean-support: clean-jdk
1171 
1172 clean-test: clean-test-results clean-test-support
1173 
1174 # When cleaning images, also clean the support/images directory.
1175 clean-images: clean-support/images
1176 
1177 # Remove everything, including configure configuration. If the output
1178 # directory was created by configure and now becomes empty, remove it as well.
1179 dist-clean: clean
1180 	($(CD) $(OUTPUTDIR) &amp;&amp; \
1181 	    $(RM) -r *spec.gmk $(CONFIGURESUPPORT_OUTPUTDIR) Makefile compare.sh ide \
1182 	    configure.log* build.log*)
1183 	$(if $(filter $(CONF_NAME),$(notdir $(OUTPUTDIR))), \
1184 	  if test &quot;x`$(LS) $(OUTPUTDIR)`&quot; != x; then \
1185 	    $(ECHO) &quot;Warning: Not removing non-empty configuration directory for &#39;$(CONF_NAME)&#39;&quot; ; \
1186 	  else \
1187 	    ($(CD) $(TOPDIR) &amp;&amp; $(ECHO) &quot;Removing configuration directory for &#39;$(CONF_NAME)&#39;&quot; \
1188 	        &amp;&amp; $(RM) -r $(OUTPUTDIR)) \
1189 	  fi \
1190 	)
1191 	$(ECHO) Cleaned everything, you will have to re-run configure.
1192 
1193 ALL_TARGETS += clean clean-docs clean-compile-commands dist-clean $(CLEAN_DIR_TARGETS) \
1194     $(CLEAN_SUPPORT_DIR_TARGETS) $(CLEAN_TEST_TARGETS) $(CLEAN_PHASE_TARGETS) \
1195     $(CLEAN_MODULE_TARGETS) $(CLEAN_MODULE_PHASE_TARGETS)
1196 
1197 ################################################################################
1198 # Declare *-only targets for each normal target
1199 $(foreach t, $(ALL_TARGETS), $(eval $(t)-only: $(t)))
1200 
1201 ALL_TARGETS += $(addsuffix -only, $(filter-out dist-clean clean%, $(ALL_TARGETS)))
1202 
1203 ################################################################################
1204 
1205 # The following targets are intentionally not added to ALL_TARGETS since they
1206 # are internal only, to support Init.gmk.
1207 
1208 print-targets:
1209 	  @$(ECHO) $(sort $(ALL_TARGETS))
1210 
1211 print-modules:
1212 	  @$(ECHO) $(sort $(ALL_MODULES))
1213 
1214 print-tests:
1215 	  @$(ECHO) $(sort $(ALL_NAMED_TESTS))
1216 
1217 create-main-targets-include:
1218 	  $(call LogInfo, Generating main target list)
1219 	  @$(ECHO) ALL_MAIN_TARGETS := $(sort $(ALL_TARGETS)) &gt; \
1220 	      $(MAKESUPPORT_OUTPUTDIR)/main-targets.gmk
1221 
1222 ################################################################################
1223 # Hook to include the corresponding custom file, if present.
1224 $(eval $(call IncludeCustomExtension, Main-post.gmk))
1225 
1226 .PHONY: $(ALL_TARGETS)
1227 
1228 FRC: # Force target
<a name="58" id="anc58"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="58" type="hidden" />
</body>
</html>