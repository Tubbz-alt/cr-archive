<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.security.jgss/share/classes/com/sun/security/sasl/gsskerb/GssKrb5Server.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="GssKrb5Client.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../jdk.unsupported/share/classes/sun/misc/Unsafe.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.security.jgss/share/classes/com/sun/security/sasl/gsskerb/GssKrb5Server.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -28,10 +28,12 @@</span>
  import javax.security.sasl.*;
  import java.io.*;
  import java.util.Map;
  import java.util.logging.Level;
  
<span class="udiff-line-added">+ import static java.nio.charset.StandardCharsets.UTF_8;</span>
<span class="udiff-line-added">+ </span>
  // JAAS
  import javax.security.auth.callback.*;
  
  // JGSS
  import org.ietf.jgss.*;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -248,12 +250,14 @@</span>
  
      private byte[] doHandshake2(byte[] responseData) throws SaslException {
          try {
              // Expecting 4 octets from client selected protection
              // and client&#39;s receive buffer size
<span class="udiff-line-added">+             MessageProp msgProp = new MessageProp(false);</span>
              byte[] gssOutToken = secCtx.unwrap(responseData, 0,
<span class="udiff-line-modified-removed">-                 responseData.length, new MessageProp(0, false));</span>
<span class="udiff-line-modified-added">+                 responseData.length, msgProp);</span>
<span class="udiff-line-added">+             checkMessageProp(&quot;Handshake failure: &quot;, msgProp);</span>
  
              if (logger.isLoggable(Level.FINER)) {
                  traceOutput(MY_CLASS_NAME, &quot;doHandshake2&quot;,
                      &quot;KRB5SRV09:Response [after unwrap]&quot;, gssOutToken);
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -298,16 +302,12 @@</span>
                                    rawSendSize});
              }
  
              // Get authorization identity, if any
              if (gssOutToken.length &gt; 4) {
<span class="udiff-line-modified-removed">-                 try {</span>
<span class="udiff-line-modified-removed">-                     authzid = new String(gssOutToken, 4,</span>
<span class="udiff-line-removed">-                         gssOutToken.length - 4, &quot;UTF-8&quot;);</span>
<span class="udiff-line-removed">-                 } catch (UnsupportedEncodingException uee) {</span>
<span class="udiff-line-removed">-                     throw new SaslException (&quot;Cannot decode authzid&quot;, uee);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-modified-added">+                 authzid = new String(gssOutToken, 4,</span>
<span class="udiff-line-modified-added">+                         gssOutToken.length - 4, UTF_8);</span>
              } else {
                  authzid = peer;
              }
              logger.log(Level.FINE, &quot;KRB5SRV12:Authzid: {0}&quot;, authzid);
  
</pre>
<center><a href="GssKrb5Client.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../jdk.unsupported/share/classes/sun/misc/Unsafe.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>