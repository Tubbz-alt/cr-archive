<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.internal.le/share/classes/jdk/internal/org/jline/utils/DiffHelper.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2002-2016, the original author or authors.
  3  *
  4  * This software is distributable under the BSD license. See the terms of the
  5  * BSD license in the documentation provided with this software.
  6  *
<a name="1" id="anc1"></a><span class="line-modified">  7  * https://opensource.org/licenses/BSD-3-Clause</span>
  8  */
  9 package jdk.internal.org.jline.utils;
 10 
 11 import java.util.LinkedList;
 12 import java.util.List;
 13 
 14 /**
 15  * Class containing the diff method.
 16  * This diff is ANSI aware and will correctly handle text attributes
 17  * so that any text in a Diff object is a valid ansi string.
 18  */
 19 public class DiffHelper {
 20 
 21     /**
 22      * The data structure representing a diff is a Linked list of Diff objects:
 23      * {Diff(Operation.DELETE, &quot;Hello&quot;), Diff(Operation.INSERT, &quot;Goodbye&quot;),
 24      *  Diff(Operation.EQUAL, &quot; world.&quot;)}
 25      * which means: delete &quot;Hello&quot;, add &quot;Goodbye&quot; and keep &quot; world.&quot;
 26      */
 27     public enum Operation {
 28         DELETE, INSERT, EQUAL
 29     }
 30 
 31     /**
 32      * Class representing one diff operation.
 33      */
 34     public static class Diff {
 35         /**
 36          * One of: INSERT, DELETE or EQUAL.
 37          */
 38         public final Operation operation;
 39         /**
 40          * The text associated with this diff operation.
 41          */
 42         public final AttributedString text;
 43 
 44         /**
 45          * Constructor.  Initializes the diff with the provided values.
 46          * @param operation One of INSERT, DELETE or EQUAL.
 47          * @param text The text being applied.
 48          */
 49         public Diff(Operation operation, AttributedString text) {
 50             // Construct a diff with the specified operation and text.
 51             this.operation = operation;
 52             this.text = text;
 53         }
 54 
 55         /**
 56          * Display a human-readable version of this Diff.
 57          * @return text version.
 58          */
 59         public String toString() {
 60             return &quot;Diff(&quot; + this.operation + &quot;,\&quot;&quot; + this.text + &quot;\&quot;)&quot;;
 61         }
 62     }
 63 
 64     /**
 65      * Compute a list of difference between two lines.
 66      * The result will contain at most 4 Diff objects, as the method
 67      * aims to return the common prefix, inserted text, deleted text and
 68      * common suffix.
 69      * The computation is done on characters and their attributes expressed
 70      * as ansi sequences.
 71      *
 72      * @param text1 the old line
 73      * @param text2 the new line
 74      * @return a list of Diff
 75      */
 76     public static List&lt;Diff&gt; diff(AttributedString text1, AttributedString text2) {
 77         int l1 = text1.length();
 78         int l2 = text2.length();
 79         int n = Math.min(l1, l2);
 80         int commonStart = 0;
 81         // Given a run of contiguous &quot;hidden&quot; characters (which are
 82         // sequences of uninterrupted escape sequences) we always want to
 83         // print either the entire run or none of it - never a part of it.
 84         int startHiddenRange = -1;
 85         while (commonStart &lt; n
 86                 &amp;&amp; text1.charAt(commonStart) == text2.charAt(commonStart)
 87                 &amp;&amp; text1.styleAt(commonStart).equals(text2.styleAt(commonStart))) {
 88             if (text1.isHidden(commonStart)) {
 89                 if (startHiddenRange &lt; 0)
 90                     startHiddenRange = commonStart;
 91             } else
 92                 startHiddenRange = -1;
 93             commonStart++;
 94         }
 95         if (startHiddenRange &gt;= 0
 96             &amp;&amp; ((l1 &gt; commonStart &amp;&amp; text1.isHidden(commonStart))
 97                 || (l2 &gt; commonStart &amp;&amp; text2.isHidden(commonStart))))
 98             commonStart = startHiddenRange;
 99 
100         startHiddenRange = -1;
101         int commonEnd = 0;
102         while (commonEnd &lt; n - commonStart
103                 &amp;&amp; text1.charAt(l1 - commonEnd - 1) == text2.charAt(l2 - commonEnd - 1)
104                 &amp;&amp; text1.styleAt(l1 - commonEnd - 1).equals(text2.styleAt(l2 - commonEnd - 1))) {
105             if (text1.isHidden(l1 - commonEnd - 1)) {
106                 if (startHiddenRange &lt; 0)
107                     startHiddenRange = commonEnd;
108             } else
109                 startHiddenRange = -1;
110             commonEnd++;
111         }
112         if (startHiddenRange &gt;= 0)
113             commonEnd = startHiddenRange;
114         LinkedList&lt;Diff&gt; diffs = new LinkedList&lt;&gt;();
115         if (commonStart &gt; 0) {
116             diffs.add(new Diff(DiffHelper.Operation.EQUAL,
117                     text1.subSequence(0, commonStart)));
118         }
119         if (l2 &gt; commonStart + commonEnd) {
120             diffs.add(new Diff(DiffHelper.Operation.INSERT,
121                     text2.subSequence(commonStart, l2 - commonEnd)));
122         }
123         if (l1 &gt; commonStart + commonEnd) {
124             diffs.add(new Diff(DiffHelper.Operation.DELETE,
125                     text1.subSequence(commonStart, l1 - commonEnd)));
126         }
127         if (commonEnd &gt; 0) {
128             diffs.add(new Diff(DiffHelper.Operation.EQUAL,
129                     text1.subSequence(l1 - commonEnd, l1)));
130         }
131         return diffs;
132     }
133 
134 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>