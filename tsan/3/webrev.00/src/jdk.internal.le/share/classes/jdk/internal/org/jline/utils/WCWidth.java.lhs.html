<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.internal.le/share/classes/jdk/internal/org/jline/utils/WCWidth.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2002-2016, the original author or authors.
  3  *
  4  * This software is distributable under the BSD license. See the terms of the
  5  * BSD license in the documentation provided with this software.
  6  *
<a name="1" id="anc1"></a><span class="line-modified">  7  * http://www.opensource.org/licenses/bsd-license.php</span>
  8  */
  9 package jdk.internal.org.jline.utils;
 10 
 11 public final class WCWidth {
 12 
 13     private WCWidth() {
 14     }
 15 
 16     /* The following two functions define the column width of an ISO 10646
 17      * character as follows:
 18      *
 19      *    - The null character (U+0000) has a column width of 0.
 20      *
 21      *    - Other C0/C1 control characters and DEL will lead to a return
 22      *      value of -1.
 23      *
 24      *    - Non-spacing and enclosing combining characters (general
 25      *      category code Mn or Me in the Unicode database) have a
 26      *      column width of 0.
 27      *
 28      *    - SOFT HYPHEN (U+00AD) has a column width of 1.
 29      *
 30      *    - Other format characters (general category code Cf in the Unicode
 31      *      database) and ZERO WIDTH SPACE (U+200B) have a column width of 0.
 32      *
 33      *    - Hangul Jamo medial vowels and final consonants (U+1160-U+11FF)
 34      *      have a column width of 0.
 35      *
 36      *    - Spacing characters in the East Asian Wide (W) or East Asian
 37      *      Full-width (F) category as defined in Unicode Technical
 38      *      Report #11 have a column width of 2.
 39      *
 40      *    - All remaining characters (including all printable
 41      *      ISO 8859-1 and WGL4 characters, Unicode control characters,
 42      *      etc.) have a column width of 1.
 43      *
 44      * This implementation assumes that wchar_t characters are encoded
 45      * in ISO 10646.
 46      */
 47     public static int wcwidth(int ucs)
 48     {
 49 
 50         /* test for 8-bit control characters */
 51         if (ucs == 0)
 52             return 0;
 53         if (ucs &lt; 32 || (ucs &gt;= 0x7f &amp;&amp; ucs &lt; 0xa0))
 54             return -1;
 55 
 56         /* binary search in table of non-spacing characters */
 57         if (bisearch(ucs, combining, combining.length - 1))
 58             return 0;
 59 
 60         /* if we arrive here, ucs is not a combining or C0/C1 control character */
 61         return 1 +
 62                 ((ucs &gt;= 0x1100 &amp;&amp;
 63                         (ucs &lt;= 0x115f ||                           /* Hangul Jamo init. consonants */
 64                                 ucs == 0x2329 || ucs == 0x232a ||
 65                                 (ucs &gt;= 0x2e80 &amp;&amp; ucs &lt;= 0xa4cf &amp;&amp;
 66                                         ucs != 0x303f) ||           /* CJK ... Yi */
 67                                 (ucs &gt;= 0xac00 &amp;&amp; ucs &lt;= 0xd7a3) || /* Hangul Syllables */
 68                                 (ucs &gt;= 0xf900 &amp;&amp; ucs &lt;= 0xfaff) || /* CJK Compatibility Ideographs */
 69                                 (ucs &gt;= 0xfe10 &amp;&amp; ucs &lt;= 0xfe19) || /* Vertical forms */
 70                                 (ucs &gt;= 0xfe30 &amp;&amp; ucs &lt;= 0xfe6f) || /* CJK Compatibility Forms */
 71                                 (ucs &gt;= 0xff00 &amp;&amp; ucs &lt;= 0xff60) || /* Fullwidth Forms */
 72                                 (ucs &gt;= 0xffe0 &amp;&amp; ucs &lt;= 0xffe6) ||
 73                                 (ucs &gt;= 0x20000 &amp;&amp; ucs &lt;= 0x2fffd) ||
 74                                 (ucs &gt;= 0x30000 &amp;&amp; ucs &lt;= 0x3fffd))) ? 1 : 0);
 75     }
 76 
 77     /* sorted list of non-overlapping intervals of non-spacing characters */
 78     /* generated by &quot;uniset +cat=Me +cat=Mn +cat=Cf -00AD +1160-11FF +200B c&quot; */
 79     static Interval[] combining = {
 80             new Interval( 0x0300, 0x036F ), new Interval( 0x0483, 0x0486 ), new Interval( 0x0488, 0x0489 ),
 81             new Interval( 0x0591, 0x05BD ), new Interval( 0x05BF, 0x05BF ), new Interval( 0x05C1, 0x05C2 ),
 82             new Interval( 0x05C4, 0x05C5 ), new Interval( 0x05C7, 0x05C7 ), new Interval( 0x0600, 0x0603 ),
 83             new Interval( 0x0610, 0x0615 ), new Interval( 0x064B, 0x065E ), new Interval( 0x0670, 0x0670 ),
 84             new Interval( 0x06D6, 0x06E4 ), new Interval( 0x06E7, 0x06E8 ), new Interval( 0x06EA, 0x06ED ),
 85             new Interval( 0x070F, 0x070F ), new Interval( 0x0711, 0x0711 ), new Interval( 0x0730, 0x074A ),
 86             new Interval( 0x07A6, 0x07B0 ), new Interval( 0x07EB, 0x07F3 ), new Interval( 0x0901, 0x0902 ),
 87             new Interval( 0x093C, 0x093C ), new Interval( 0x0941, 0x0948 ), new Interval( 0x094D, 0x094D ),
 88             new Interval( 0x0951, 0x0954 ), new Interval( 0x0962, 0x0963 ), new Interval( 0x0981, 0x0981 ),
 89             new Interval( 0x09BC, 0x09BC ), new Interval( 0x09C1, 0x09C4 ), new Interval( 0x09CD, 0x09CD ),
 90             new Interval( 0x09E2, 0x09E3 ), new Interval( 0x0A01, 0x0A02 ), new Interval( 0x0A3C, 0x0A3C ),
 91             new Interval( 0x0A41, 0x0A42 ), new Interval( 0x0A47, 0x0A48 ), new Interval( 0x0A4B, 0x0A4D ),
 92             new Interval( 0x0A70, 0x0A71 ), new Interval( 0x0A81, 0x0A82 ), new Interval( 0x0ABC, 0x0ABC ),
 93             new Interval( 0x0AC1, 0x0AC5 ), new Interval( 0x0AC7, 0x0AC8 ), new Interval( 0x0ACD, 0x0ACD ),
 94             new Interval( 0x0AE2, 0x0AE3 ), new Interval( 0x0B01, 0x0B01 ), new Interval( 0x0B3C, 0x0B3C ),
 95             new Interval( 0x0B3F, 0x0B3F ), new Interval( 0x0B41, 0x0B43 ), new Interval( 0x0B4D, 0x0B4D ),
 96             new Interval( 0x0B56, 0x0B56 ), new Interval( 0x0B82, 0x0B82 ), new Interval( 0x0BC0, 0x0BC0 ),
 97             new Interval( 0x0BCD, 0x0BCD ), new Interval( 0x0C3E, 0x0C40 ), new Interval( 0x0C46, 0x0C48 ),
 98             new Interval( 0x0C4A, 0x0C4D ), new Interval( 0x0C55, 0x0C56 ), new Interval( 0x0CBC, 0x0CBC ),
 99             new Interval( 0x0CBF, 0x0CBF ), new Interval( 0x0CC6, 0x0CC6 ), new Interval( 0x0CCC, 0x0CCD ),
100             new Interval( 0x0CE2, 0x0CE3 ), new Interval( 0x0D41, 0x0D43 ), new Interval( 0x0D4D, 0x0D4D ),
101             new Interval( 0x0DCA, 0x0DCA ), new Interval( 0x0DD2, 0x0DD4 ), new Interval( 0x0DD6, 0x0DD6 ),
102             new Interval( 0x0E31, 0x0E31 ), new Interval( 0x0E34, 0x0E3A ), new Interval( 0x0E47, 0x0E4E ),
103             new Interval( 0x0EB1, 0x0EB1 ), new Interval( 0x0EB4, 0x0EB9 ), new Interval( 0x0EBB, 0x0EBC ),
104             new Interval( 0x0EC8, 0x0ECD ), new Interval( 0x0F18, 0x0F19 ), new Interval( 0x0F35, 0x0F35 ),
105             new Interval( 0x0F37, 0x0F37 ), new Interval( 0x0F39, 0x0F39 ), new Interval( 0x0F71, 0x0F7E ),
106             new Interval( 0x0F80, 0x0F84 ), new Interval( 0x0F86, 0x0F87 ), new Interval( 0x0F90, 0x0F97 ),
107             new Interval( 0x0F99, 0x0FBC ), new Interval( 0x0FC6, 0x0FC6 ), new Interval( 0x102D, 0x1030 ),
108             new Interval( 0x1032, 0x1032 ), new Interval( 0x1036, 0x1037 ), new Interval( 0x1039, 0x1039 ),
109             new Interval( 0x1058, 0x1059 ), new Interval( 0x1160, 0x11FF ), new Interval( 0x135F, 0x135F ),
110             new Interval( 0x1712, 0x1714 ), new Interval( 0x1732, 0x1734 ), new Interval( 0x1752, 0x1753 ),
111             new Interval( 0x1772, 0x1773 ), new Interval( 0x17B4, 0x17B5 ), new Interval( 0x17B7, 0x17BD ),
112             new Interval( 0x17C6, 0x17C6 ), new Interval( 0x17C9, 0x17D3 ), new Interval( 0x17DD, 0x17DD ),
113             new Interval( 0x180B, 0x180D ), new Interval( 0x18A9, 0x18A9 ), new Interval( 0x1920, 0x1922 ),
114             new Interval( 0x1927, 0x1928 ), new Interval( 0x1932, 0x1932 ), new Interval( 0x1939, 0x193B ),
115             new Interval( 0x1A17, 0x1A18 ), new Interval( 0x1B00, 0x1B03 ), new Interval( 0x1B34, 0x1B34 ),
116             new Interval( 0x1B36, 0x1B3A ), new Interval( 0x1B3C, 0x1B3C ), new Interval( 0x1B42, 0x1B42 ),
117             new Interval( 0x1B6B, 0x1B73 ), new Interval( 0x1DC0, 0x1DCA ), new Interval( 0x1DFE, 0x1DFF ),
118             new Interval( 0x200B, 0x200F ), new Interval( 0x202A, 0x202E ), new Interval( 0x2060, 0x2063 ),
119             new Interval( 0x206A, 0x206F ), new Interval( 0x20D0, 0x20EF ), new Interval( 0x302A, 0x302F ),
120             new Interval( 0x3099, 0x309A ), new Interval( 0xA806, 0xA806 ), new Interval( 0xA80B, 0xA80B ),
121             new Interval( 0xA825, 0xA826 ), new Interval( 0xFB1E, 0xFB1E ), new Interval( 0xFE00, 0xFE0F ),
122             new Interval( 0xFE20, 0xFE23 ), new Interval( 0xFEFF, 0xFEFF ), new Interval( 0xFFF9, 0xFFFB ),
123             new Interval( 0x10A01, 0x10A03 ), new Interval( 0x10A05, 0x10A06 ), new Interval( 0x10A0C, 0x10A0F ),
124             new Interval( 0x10A38, 0x10A3A ), new Interval( 0x10A3F, 0x10A3F ), new Interval( 0x1D167, 0x1D169 ),
125             new Interval( 0x1D173, 0x1D182 ), new Interval( 0x1D185, 0x1D18B ), new Interval( 0x1D1AA, 0x1D1AD ),
126             new Interval( 0x1D242, 0x1D244 ), new Interval( 0xE0001, 0xE0001 ), new Interval( 0xE0020, 0xE007F ),
127             new Interval( 0xE0100, 0xE01EF )
128     };
129 
130     private static class Interval {
131         public final int first;
132         public final int last;
133 
134         public Interval(int first, int last) {
135             this.first = first;
136             this.last = last;
137         }
138     }
139 
140     /* auxiliary function for binary search in interval table */
141     private static boolean bisearch(int ucs, Interval[] table, int max) {
142         int min = 0;
143         int mid;
144 
145         if (ucs &lt; table[0].first || ucs &gt; table[max].last)
146             return false;
147         while (max &gt;= min) {
148             mid = (min + max) / 2;
149             if (ucs &gt; table[mid].last)
150                 min = mid + 1;
151             else if (ucs &lt; table[mid].first)
152                 max = mid - 1;
153             else
154                 return true;
155         }
156 
157         return false;
158     }
159 
160 
161 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>