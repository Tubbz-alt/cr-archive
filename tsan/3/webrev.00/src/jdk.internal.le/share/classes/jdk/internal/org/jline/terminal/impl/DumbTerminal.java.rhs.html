<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.internal.le/share/classes/jdk/internal/org/jline/terminal/impl/DumbTerminal.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2002-2018, the original author or authors.
  3  *
  4  * This software is distributable under the BSD license. See the terms of the
  5  * BSD license in the documentation provided with this software.
  6  *
<a name="1" id="anc1"></a><span class="line-modified">  7  * https://opensource.org/licenses/BSD-3-Clause</span>
  8  */
  9 package jdk.internal.org.jline.terminal.impl;
 10 
 11 import java.io.IOException;
 12 import java.io.InputStream;
 13 import java.io.OutputStream;
 14 import java.io.OutputStreamWriter;
 15 import java.io.PrintWriter;
 16 import java.nio.charset.Charset;
 17 
 18 import jdk.internal.org.jline.terminal.Attributes;
 19 import jdk.internal.org.jline.terminal.Attributes.ControlChar;
 20 import jdk.internal.org.jline.terminal.Size;
 21 import jdk.internal.org.jline.utils.NonBlocking;
 22 import jdk.internal.org.jline.utils.NonBlockingInputStream;
 23 import jdk.internal.org.jline.utils.NonBlockingReader;
 24 
 25 public class DumbTerminal extends AbstractTerminal {
 26 
 27     private final NonBlockingInputStream input;
 28     private final OutputStream output;
 29     private final NonBlockingReader reader;
 30     private final PrintWriter writer;
 31     private final Attributes attributes;
 32     private final Size size;
 33 
 34     public DumbTerminal(InputStream in, OutputStream out) throws IOException {
 35         this(TYPE_DUMB, TYPE_DUMB, in, out, null);
 36     }
 37 
 38     public DumbTerminal(String name, String type, InputStream in, OutputStream out, Charset encoding) throws IOException {
 39         this(name, type, in, out, encoding, SignalHandler.SIG_DFL);
 40     }
 41 
 42     public DumbTerminal(String name, String type, InputStream in, OutputStream out, Charset encoding, SignalHandler signalHandler) throws IOException {
 43         super(name, type, encoding, signalHandler);
 44         NonBlockingInputStream nbis = NonBlocking.nonBlocking(getName(), in);
 45         this.input = new NonBlockingInputStream() {
 46             @Override
 47             public int read(long timeout, boolean isPeek) throws IOException {
 48                 for (;;) {
 49                     int c = nbis.read(timeout, isPeek);
 50                     if (attributes.getLocalFlag(Attributes.LocalFlag.ISIG)) {
 51                         if (c == attributes.getControlChar(ControlChar.VINTR)) {
 52                             raise(Signal.INT);
 53                             continue;
 54                         } else if (c == attributes.getControlChar(ControlChar.VQUIT)) {
 55                             raise(Signal.QUIT);
 56                             continue;
 57                         } else if (c == attributes.getControlChar(ControlChar.VSUSP)) {
 58                             raise(Signal.TSTP);
 59                             continue;
 60                         } else if (c == attributes.getControlChar(ControlChar.VSTATUS)) {
 61                             raise(Signal.INFO);
 62                             continue;
 63                         }
 64                     }
 65                     if (c == &#39;\r&#39;) {
 66                         if (attributes.getInputFlag(Attributes.InputFlag.IGNCR)) {
 67                             continue;
 68                         }
 69                         if (attributes.getInputFlag(Attributes.InputFlag.ICRNL)) {
 70                             c = &#39;\n&#39;;
 71                         }
 72                     } else if (c == &#39;\n&#39; &amp;&amp; attributes.getInputFlag(Attributes.InputFlag.INLCR)) {
 73                         c = &#39;\r&#39;;
 74                     }
 75                     return c;
 76                 }
 77             }
 78         };
 79         this.output = out;
 80         this.reader = NonBlocking.nonBlocking(getName(), input, encoding());
 81         this.writer = new PrintWriter(new OutputStreamWriter(output, encoding()));
 82         this.attributes = new Attributes();
 83         this.attributes.setControlChar(ControlChar.VERASE,  (char) 127);
 84         this.attributes.setControlChar(ControlChar.VWERASE, (char) 23);
 85         this.attributes.setControlChar(ControlChar.VKILL,   (char) 21);
 86         this.attributes.setControlChar(ControlChar.VLNEXT,  (char) 22);
 87         this.size = new Size();
 88         parseInfoCmp();
 89     }
 90 
 91     public NonBlockingReader reader() {
 92         return reader;
 93     }
 94 
 95     public PrintWriter writer() {
 96         return writer;
 97     }
 98 
 99     @Override
100     public InputStream input() {
101         return input;
102     }
103 
104     @Override
105     public OutputStream output() {
106         return output;
107     }
108 
109     public Attributes getAttributes() {
110         Attributes attr = new Attributes();
111         attr.copy(attributes);
112         return attr;
113     }
114 
115     public void setAttributes(Attributes attr) {
116         attributes.copy(attr);
117     }
118 
119     public Size getSize() {
120         Size sz = new Size();
121         sz.copy(size);
122         return sz;
123     }
124 
125     public void setSize(Size sz) {
126         size.copy(sz);
127     }
128 
129 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>