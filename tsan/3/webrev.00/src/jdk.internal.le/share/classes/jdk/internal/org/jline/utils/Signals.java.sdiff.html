<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.le/share/classes/jdk/internal/org/jline/utils/Signals.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ShutdownHooks.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Status.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.le/share/classes/jdk/internal/org/jline/utils/Signals.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
  2  * Copyright (c) 2002-2016, the original author or authors.
  3  *
  4  * This software is distributable under the BSD license. See the terms of the
  5  * BSD license in the documentation provided with this software.
  6  *
<span class="line-modified">  7  * http://www.opensource.org/licenses/bsd-license.php</span>
  8  */
  9 package jdk.internal.org.jline.utils;
 10 

 11 import java.lang.reflect.Proxy;
 12 import java.util.Objects;
 13 
 14 /**
 15  * Signals helpers.
 16  *
 17  * @author &lt;a href=&quot;mailto:gnodet@gmail.com&quot;&gt;Guillaume Nodet&lt;/a&gt;
 18  * @since 3.0
 19  */
 20 public final class Signals {
 21 
 22     private Signals() {
 23     }
 24 
 25     /**
 26      *
 27      * @param name the signal, CONT, STOP, etc...
 28      * @param handler the callback to run
 29      *
 30      * @return an object that needs to be passed to the {@link #unregister(String, Object)}
</pre>
<hr />
<pre>
 68             // Ignore this one too, if the above failed, the signal API is incompatible with what we&#39;re expecting
 69             Log.debug(&quot;Error registering default handler for signal &quot;, name, e);
 70             return null;
 71         }
 72     }
 73 
 74     public static void unregister(String name, Object previous) {
 75         try {
 76             // We should make sure the current signal is the one we registered
 77             if (previous != null) {
 78                 doRegister(name, previous);
 79             }
 80         } catch (Exception e) {
 81             // Ignore
 82             Log.debug(&quot;Error unregistering handler for signal &quot;, name, e);
 83         }
 84     }
 85 
 86     private static Object doRegister(String name, Object handler) throws Exception {
 87         Log.trace(() -&gt; &quot;Registering signal &quot; + name + &quot; with handler &quot; + toString(handler));
<span class="line-modified"> 88         if (&quot;QUIT&quot;.equals(name) || &quot;INFO&quot;.equals(name) &amp;&amp; &quot;9&quot;.equals(System.getProperty(&quot;java.specification.version&quot;))) {</span>





 89             Log.trace(() -&gt; &quot;Ignoring unsupported signal &quot; + name);
 90             return null;
 91         }
<span class="line-removed"> 92         Class&lt;?&gt; signalClass = Class.forName(&quot;sun.misc.Signal&quot;);</span>
 93         Class&lt;?&gt; signalHandlerClass = Class.forName(&quot;sun.misc.SignalHandler&quot;);
<span class="line-removed"> 94         Object signal = signalClass.getConstructor(String.class).newInstance(name);</span>
 95         return signalClass.getMethod(&quot;handle&quot;, signalClass, signalHandlerClass)
 96                 .invoke(null, signal, handler);
 97     }
 98 
 99     @SuppressWarnings(&quot;&quot;)
100     private static String toString(Object handler) {
101         try {
102             Class&lt;?&gt; signalHandlerClass = Class.forName(&quot;sun.misc.SignalHandler&quot;);
103             if (handler == signalHandlerClass.getField(&quot;SIG_DFL&quot;).get(null)) {
104                 return &quot;SIG_DFL&quot;;
105             }
106             if (handler == signalHandlerClass.getField(&quot;SIG_IGN&quot;).get(null)) {
107                 return &quot;SIG_IGN&quot;;
108             }
109         } catch (Throwable t) {
110             // ignore
111         }
112         return handler != null ? handler.toString() : &quot;null&quot;;
113     }
114 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
  2  * Copyright (c) 2002-2016, the original author or authors.
  3  *
  4  * This software is distributable under the BSD license. See the terms of the
  5  * BSD license in the documentation provided with this software.
  6  *
<span class="line-modified">  7  * https://opensource.org/licenses/BSD-3-Clause</span>
  8  */
  9 package jdk.internal.org.jline.utils;
 10 
<span class="line-added"> 11 import java.lang.reflect.Constructor;</span>
 12 import java.lang.reflect.Proxy;
 13 import java.util.Objects;
 14 
 15 /**
 16  * Signals helpers.
 17  *
 18  * @author &lt;a href=&quot;mailto:gnodet@gmail.com&quot;&gt;Guillaume Nodet&lt;/a&gt;
 19  * @since 3.0
 20  */
 21 public final class Signals {
 22 
 23     private Signals() {
 24     }
 25 
 26     /**
 27      *
 28      * @param name the signal, CONT, STOP, etc...
 29      * @param handler the callback to run
 30      *
 31      * @return an object that needs to be passed to the {@link #unregister(String, Object)}
</pre>
<hr />
<pre>
 69             // Ignore this one too, if the above failed, the signal API is incompatible with what we&#39;re expecting
 70             Log.debug(&quot;Error registering default handler for signal &quot;, name, e);
 71             return null;
 72         }
 73     }
 74 
 75     public static void unregister(String name, Object previous) {
 76         try {
 77             // We should make sure the current signal is the one we registered
 78             if (previous != null) {
 79                 doRegister(name, previous);
 80             }
 81         } catch (Exception e) {
 82             // Ignore
 83             Log.debug(&quot;Error unregistering handler for signal &quot;, name, e);
 84         }
 85     }
 86 
 87     private static Object doRegister(String name, Object handler) throws Exception {
 88         Log.trace(() -&gt; &quot;Registering signal &quot; + name + &quot; with handler &quot; + toString(handler));
<span class="line-modified"> 89         Class&lt;?&gt; signalClass = Class.forName(&quot;sun.misc.Signal&quot;);</span>
<span class="line-added"> 90         Constructor&lt;?&gt; constructor = signalClass.getConstructor(String.class);</span>
<span class="line-added"> 91         Object signal;</span>
<span class="line-added"> 92         try {</span>
<span class="line-added"> 93             signal = constructor.newInstance(name);</span>
<span class="line-added"> 94         } catch (IllegalArgumentException e) {</span>
 95             Log.trace(() -&gt; &quot;Ignoring unsupported signal &quot; + name);
 96             return null;
 97         }

 98         Class&lt;?&gt; signalHandlerClass = Class.forName(&quot;sun.misc.SignalHandler&quot;);

 99         return signalClass.getMethod(&quot;handle&quot;, signalClass, signalHandlerClass)
100                 .invoke(null, signal, handler);
101     }
102 
103     @SuppressWarnings(&quot;&quot;)
104     private static String toString(Object handler) {
105         try {
106             Class&lt;?&gt; signalHandlerClass = Class.forName(&quot;sun.misc.SignalHandler&quot;);
107             if (handler == signalHandlerClass.getField(&quot;SIG_DFL&quot;).get(null)) {
108                 return &quot;SIG_DFL&quot;;
109             }
110             if (handler == signalHandlerClass.getField(&quot;SIG_IGN&quot;).get(null)) {
111                 return &quot;SIG_IGN&quot;;
112             }
113         } catch (Throwable t) {
114             // ignore
115         }
116         return handler != null ? handler.toString() : &quot;null&quot;;
117     }
118 
</pre>
</td>
</tr>
</table>
<center><a href="ShutdownHooks.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Status.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>