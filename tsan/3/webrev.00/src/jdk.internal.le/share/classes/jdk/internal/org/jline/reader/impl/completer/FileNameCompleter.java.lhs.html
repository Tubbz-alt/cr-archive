<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.internal.le/share/classes/jdk/internal/org/jline/reader/impl/completer/FileNameCompleter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2002-2018, the original author or authors.
  3  *
  4  * This software is distributable under the BSD license. See the terms of the
  5  * BSD license in the documentation provided with this software.
  6  *
<a name="1" id="anc1"></a><span class="line-modified">  7  * http://www.opensource.org/licenses/bsd-license.php</span>
  8  */
  9 package jdk.internal.org.jline.reader.impl.completer;
 10 
 11 import java.io.IOException;
 12 import java.nio.file.Files;
 13 import java.nio.file.Path;
 14 import java.nio.file.Paths;
 15 import java.util.List;
 16 
 17 import jdk.internal.org.jline.reader.Candidate;
 18 import jdk.internal.org.jline.reader.Completer;
 19 import jdk.internal.org.jline.reader.LineReader;
 20 import jdk.internal.org.jline.reader.LineReader.Option;
 21 import jdk.internal.org.jline.reader.ParsedLine;
 22 import jdk.internal.org.jline.terminal.Terminal;
 23 import jdk.internal.org.jline.utils.AttributedStringBuilder;
 24 import jdk.internal.org.jline.utils.AttributedStyle;
 25 
 26 /**
 27  * A file name completer takes the buffer and issues a list of
 28  * potential completions.
 29  * &lt;p&gt;
 30  * This completer tries to behave as similar as possible to
 31  * &lt;i&gt;bash&lt;/i&gt;&#39;s file name completion (using GNU readline)
 32  * with the following exceptions:
 33  * &lt;ul&gt;
 34  * &lt;li&gt;Candidates that are directories will end with &quot;/&quot;&lt;/li&gt;
 35  * &lt;li&gt;Wildcard regular expressions are not evaluated or replaced&lt;/li&gt;
 36  * &lt;li&gt;The &quot;~&quot; character can be used to represent the user&#39;s home,
 37  * but it cannot complete to other users&#39; homes, since java does
 38  * not provide any way of determining that easily&lt;/li&gt;
 39  * &lt;/ul&gt;
 40  *
 41  * @author &lt;a href=&quot;mailto:mwp1@cornell.edu&quot;&gt;Marc Prud&#39;hommeaux&lt;/a&gt;
 42  * @author &lt;a href=&quot;mailto:jason@planet57.com&quot;&gt;Jason Dillon&lt;/a&gt;
 43  * @since 2.3
 44  * @deprecated use &lt;code&gt;org.jline.builtins.Completers$FileNameCompleter&lt;/code&gt; instead
 45  */
 46 @Deprecated
 47 public class FileNameCompleter implements Completer
 48 {
 49 
 50     public void complete(LineReader reader, ParsedLine commandLine, final List&lt;Candidate&gt; candidates) {
 51         assert commandLine != null;
 52         assert candidates != null;
 53 
 54         String buffer = commandLine.word().substring(0, commandLine.wordCursor());
 55 
 56         Path current;
 57         String curBuf;
 58         String sep = getUserDir().getFileSystem().getSeparator();
 59         int lastSep = buffer.lastIndexOf(sep);
 60         if (lastSep &gt;= 0) {
 61             curBuf = buffer.substring(0, lastSep + 1);
 62             if (curBuf.startsWith(&quot;~&quot;)) {
 63                 if (curBuf.startsWith(&quot;~&quot; + sep)) {
 64                     current = getUserHome().resolve(curBuf.substring(2));
 65                 } else {
 66                     current = getUserHome().getParent().resolve(curBuf.substring(1));
 67                 }
 68             } else {
 69                 current = getUserDir().resolve(curBuf);
 70             }
 71         } else {
 72             curBuf = &quot;&quot;;
 73             current = getUserDir();
 74         }
 75         try {
 76             Files.newDirectoryStream(current, this::accept).forEach(p -&gt; {
 77                 String value = curBuf + p.getFileName().toString();
 78                 if (Files.isDirectory(p)) {
 79                     candidates.add(new Candidate(
 80                             value + (reader.isSet(Option.AUTO_PARAM_SLASH) ? sep : &quot;&quot;),
 81                             getDisplay(reader.getTerminal(), p),
 82                             null, null,
 83                             reader.isSet(Option.AUTO_REMOVE_SLASH) ? sep : null,
 84                             null,
 85                             false));
 86                 } else {
 87                     candidates.add(new Candidate(value, getDisplay(reader.getTerminal(), p),
 88                             null, null, null, null, true));
 89                 }
 90             });
 91         } catch (IOException e) {
 92             // Ignore
 93         }
 94     }
 95 
 96     protected boolean accept(Path path) {
 97         try {
 98             return !Files.isHidden(path);
 99         } catch (IOException e) {
100             return false;
101         }
102     }
103 
104     protected Path getUserDir() {
105         return Paths.get(System.getProperty(&quot;user.dir&quot;));
106     }
107 
108     protected Path getUserHome() {
109         return Paths.get(System.getProperty(&quot;user.home&quot;));
110     }
111 
112     protected String getDisplay(Terminal terminal, Path p) {
113         // TODO: use $LS_COLORS for output
114         String name = p.getFileName().toString();
115         if (Files.isDirectory(p)) {
116             AttributedStringBuilder sb = new AttributedStringBuilder();
117             sb.styled(AttributedStyle.BOLD.foreground(AttributedStyle.RED), name);
118             sb.append(&quot;/&quot;);
119             name = sb.toAnsi(terminal);
120         } else if (Files.isSymbolicLink(p)) {
121             AttributedStringBuilder sb = new AttributedStringBuilder();
122             sb.styled(AttributedStyle.BOLD.foreground(AttributedStyle.RED), name);
123             sb.append(&quot;@&quot;);
124             name = sb.toAnsi(terminal);
125         }
126         return name;
127     }
128 
129 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>