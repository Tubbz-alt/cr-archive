<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.internal.le/share/classes/jdk/internal/org/jline/utils/Status.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre> 1 /*
 2  * Copyright (c) 2002-2018, the original author or authors.
 3  *
 4  * This software is distributable under the BSD license. See the terms of the
 5  * BSD license in the documentation provided with this software.
 6  *
<a name="1" id="anc1"></a><span class="line-modified"> 7  * http://www.opensource.org/licenses/bsd-license.php</span>
 8  */
 9 package jdk.internal.org.jline.utils;
10 
11 import java.util.Objects;
12 import java.util.Collections;
13 import java.util.ArrayList;
14 import java.util.List;
15 import jdk.internal.org.jline.terminal.Terminal;
16 import jdk.internal.org.jline.terminal.Terminal.Signal;
17 import jdk.internal.org.jline.terminal.Terminal.SignalHandler;
18 import jdk.internal.org.jline.terminal.impl.AbstractTerminal;
19 import jdk.internal.org.jline.utils.InfoCmp.Capability;
20 import jdk.internal.org.jline.terminal.Size;
21 
22 public class Status {
23 
24     protected final AbstractTerminal terminal;
25     protected final boolean supported;
26     protected List&lt;AttributedString&gt; oldLines = Collections.emptyList();
<a name="2" id="anc2"></a>
27     protected int rows;
28     protected int columns;
29     protected boolean force;
<a name="3" id="anc3"></a>
30 
31     public static Status getStatus(Terminal terminal) {
32         return getStatus(terminal, true);
33     }
34 
35     public static Status getStatus(Terminal terminal, boolean create) {
36         return terminal instanceof AbstractTerminal
37                 ? ((AbstractTerminal) terminal).getStatus(create)
38                 : null;
39     }
40 
41 
42     public Status(AbstractTerminal terminal) {
43         this.terminal = Objects.requireNonNull(terminal, &quot;terminal can not be null&quot;);
44         this.supported = terminal.getStringCapability(Capability.change_scroll_region) != null
45             &amp;&amp; terminal.getStringCapability(Capability.save_cursor) != null
46             &amp;&amp; terminal.getStringCapability(Capability.restore_cursor) != null
47             &amp;&amp; terminal.getStringCapability(Capability.cursor_address) != null;
48         if (supported) {
49             resize();
50         }
51     }
52 
53     public void resize() {
54         Size size = terminal.getSize();
55         this.rows = size.getRows();
56         this.columns = size.getColumns();
57         this.force = true;
58     }
59 
60     public void reset() {
61         this.force = true;
62     }
63 
<a name="4" id="anc4"></a>








64     public void redraw() {
<a name="5" id="anc5"></a>


65         update(oldLines);
66     }
67 
68     public void update(List&lt;AttributedString&gt; lines) {
<a name="6" id="anc6"></a>


69         if (lines == null) {
70             lines = Collections.emptyList();
71         }
<a name="7" id="anc7"></a><span class="line-modified">72         if (!supported || (oldLines.equals(lines) &amp;&amp; !force)) {</span>




73             return;
74         }
75         int nb = lines.size() - oldLines.size();
76         if (nb &gt; 0) {
77             for (int i = 0; i &lt; nb; i++) {
78                 terminal.puts(Capability.cursor_down);
79             }
80             for (int i = 0; i &lt; nb; i++) {
81                 terminal.puts(Capability.cursor_up);
82             }
83         }
84         terminal.puts(Capability.save_cursor);
<a name="8" id="anc8"></a>
85         terminal.puts(Capability.clr_eos);
86         for (int i = 0; i &lt; lines.size(); i++) {
87             terminal.puts(Capability.cursor_address, rows - lines.size() + i, 0);
<a name="9" id="anc9"></a><span class="line-modified">88             terminal.writer().write(lines.get(i).columnSubSequence(0, columns).toAnsi(terminal));</span>
89         }
90         terminal.puts(Capability.change_scroll_region, 0, rows - 1 - lines.size());
91         terminal.puts(Capability.restore_cursor);
92         terminal.flush();
93         oldLines = new ArrayList&lt;&gt;(lines);
94         force = false;
95     }
<a name="10" id="anc10"></a>






















96 }
<a name="11" id="anc11"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="11" type="hidden" />
</body>
</html>