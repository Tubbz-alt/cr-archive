<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.internal.le/share/classes/jdk/internal/org/jline/utils/ExecHelper.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre> 1 /*
 2  * Copyright (c) 2002-2016, the original author or authors.
 3  *
 4  * This software is distributable under the BSD license. See the terms of the
 5  * BSD license in the documentation provided with this software.
 6  *
<a name="1" id="anc1"></a><span class="line-modified"> 7  * http://www.opensource.org/licenses/bsd-license.php</span>
 8  */
 9 package jdk.internal.org.jline.utils;
10 
11 import java.io.ByteArrayOutputStream;
12 import java.io.Closeable;
13 import java.io.IOException;
14 import java.io.InputStream;
15 import java.io.InterruptedIOException;
16 import java.io.OutputStream;
17 import java.util.Objects;
18 
19 /**
20  * Helper methods for running unix commands.
21  */
22 public final class ExecHelper {
23 
24     private ExecHelper() {
25     }
26 
27     public static String exec(boolean redirectInput, final String... cmd) throws IOException {
28         Objects.requireNonNull(cmd);
29         try {
30             Log.trace(&quot;Running: &quot;, cmd);
31             ProcessBuilder pb = new ProcessBuilder(cmd);
32             if (redirectInput) {
33                 pb.redirectInput(ProcessBuilder.Redirect.INHERIT);
34             }
35             Process p = pb.start();
36             String result = waitAndCapture(p);
37             Log.trace(&quot;Result: &quot;, result);
38             if (p.exitValue() != 0) {
39                 if (result.endsWith(&quot;\n&quot;)) {
40                     result = result.substring(0, result.length() - 1);
41                 }
42                 throw new IOException(&quot;Error executing &#39;&quot; + String.join(&quot; &quot;, (CharSequence[]) cmd) + &quot;&#39;: &quot; + result);
43             }
44             return result;
45         } catch (InterruptedException e) {
46             throw (IOException) new InterruptedIOException(&quot;Command interrupted&quot;).initCause(e);
47         }
48     }
49 
50     public static String waitAndCapture(Process p) throws IOException, InterruptedException {
51         ByteArrayOutputStream bout = new ByteArrayOutputStream();
52         InputStream in = null;
53         InputStream err = null;
54         OutputStream out = null;
55         try {
56             int c;
57             in = p.getInputStream();
58             while ((c = in.read()) != -1) {
59                 bout.write(c);
60             }
61             err = p.getErrorStream();
62             while ((c = err.read()) != -1) {
63                 bout.write(c);
64             }
65             out = p.getOutputStream();
66             p.waitFor();
67         } finally {
68             close(in, out, err);
69         }
70 
71         return bout.toString();
72     }
73 
74     private static void close(final Closeable... closeables) {
75         for (Closeable c : closeables) {
76             if (c != null) {
77                 try {
78                     c.close();
79                 } catch (Exception e) {
80                     // Ignore
81                 }
82             }
83         }
84     }
85 }
86 
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>