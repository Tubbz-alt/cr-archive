<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.internal.le/share/classes/jdk/internal/org/jline/utils/Curses.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2002-2018, the original author or authors.
  3  *
  4  * This software is distributable under the BSD license. See the terms of the
  5  * BSD license in the documentation provided with this software.
  6  *
<a name="1" id="anc1"></a><span class="line-modified">  7  * http://www.opensource.org/licenses/bsd-license.php</span>
  8  */
  9 package jdk.internal.org.jline.utils;
 10 
 11 import java.io.Flushable;
 12 import java.io.IOError;
 13 import java.io.IOException;
 14 import java.io.StringWriter;
 15 import java.util.Stack;
 16 
 17 /**
 18  * Curses helper methods.
 19  *
 20  * @author &lt;a href=&quot;mailto:gnodet@gmail.com&quot;&gt;Guillaume Nodet&lt;/a&gt;
 21  */
 22 public final class Curses {
 23 
 24     private static Object[] sv = new Object[26];
 25     private static Object[] dv = new Object[26];
 26 
 27     private static final int IFTE_NONE = 0;
 28     private static final int IFTE_IF = 1;
 29     private static final int IFTE_THEN = 2;
 30     private static final int IFTE_ELSE = 3;
 31 
 32     private Curses() {
 33     }
 34 
 35     /**
 36      * Print the given terminal capabilities
 37      *
 38      * @param cap the capability to output
 39      * @param params optional parameters
 40      * @return the result string
 41      */
 42     public static String tputs(String cap, Object... params) {
 43         if (cap != null) {
 44             StringWriter sw = new StringWriter();
 45             tputs(sw, cap, params);
 46             return sw.toString();
 47         }
 48         return null;
 49     }
 50 
 51     /**
 52      * Print the given terminal capabilities
 53      *
 54      * @param out the output stream
 55      * @param str the capability to output
 56      * @param params optional parameters
 57      */
 58     public static void tputs(Appendable out, String str, Object... params) {
 59         try {
 60             doTputs(out, str, params);
 61         } catch (Exception e) {
 62             throw new IOError(e);
 63         }
 64     }
 65 
 66     private static void doTputs(Appendable out, String str, Object... params) throws IOException {
 67         int index = 0;
 68         int length = str.length();
 69         int ifte = IFTE_NONE;
 70         boolean exec = true;
 71         Stack&lt;Object&gt; stack = new Stack&lt;&gt;();
 72         while (index &lt; length) {
 73             char ch = str.charAt(index++);
 74             switch (ch) {
 75                 case &#39;\\&#39;:
 76                     ch = str.charAt(index++);
<a name="2" id="anc2"></a><span class="line-modified"> 77                     if (ch &gt;= &#39;0&#39; &amp;&amp; ch &lt;= &#39;9&#39;) {</span>
<span class="line-modified"> 78                         throw new UnsupportedOperationException(); // todo</span>








 79                     } else {
 80                         switch (ch) {
 81                             case &#39;e&#39;:
 82                             case &#39;E&#39;:
 83                                 if (exec) {
 84                                     out.append((char) 27); // escape
 85                                 }
 86                                 break;
 87                             case &#39;n&#39;:
 88                                 out.append(&#39;\n&#39;);
 89                                 break;
 90 //                        case &#39;l&#39;:
 91 //                            rawPrint(&#39;\l&#39;);
 92 //                            break;
 93                             case &#39;r&#39;:
 94                                 if (exec) {
 95                                     out.append(&#39;\r&#39;);
 96                                 }
 97                                 break;
 98                             case &#39;t&#39;:
 99                                 if (exec) {
100                                     out.append(&#39;\t&#39;);
101                                 }
102                                 break;
103                             case &#39;b&#39;:
104                                 if (exec) {
105                                     out.append(&#39;\b&#39;);
106                                 }
107                                 break;
108                             case &#39;f&#39;:
109                                 if (exec) {
110                                     out.append(&#39;\f&#39;);
111                                 }
112                                 break;
113                             case &#39;s&#39;:
114                                 if (exec) {
115                                     out.append(&#39; &#39;);
116                                 }
117                                 break;
118                             case &#39;:&#39;:
119                             case &#39;^&#39;:
120                             case &#39;\\&#39;:
121                                 if (exec) {
122                                     out.append(ch);
123                                 }
124                                 break;
125                             default:
126                                 throw new IllegalArgumentException();
127                         }
128                     }
129                     break;
130                 case &#39;^&#39;:
131                     ch = str.charAt(index++);
132                     if (exec) {
133                         out.append((char)(ch - &#39;@&#39;));
134                     }
135                     break;
136                 case &#39;%&#39;:
137                     ch = str.charAt(index++);
138                     switch (ch) {
139                         case &#39;%&#39;:
140                             if (exec) {
141                                 out.append(&#39;%&#39;);
142                             }
143                             break;
144                         case &#39;p&#39;:
145                             ch = str.charAt(index++);
146                             if (exec) {
147                                 stack.push(params[ch - &#39;1&#39;]);
148                             }
149                             break;
150                         case &#39;P&#39;:
151                             ch = str.charAt(index++);
152                             if (ch &gt;= &#39;a&#39; &amp;&amp; ch &lt;= &#39;z&#39;) {
153                                 if (exec) {
154                                     dv[ch - &#39;a&#39;] = stack.pop();
155                                 }
156                             } else if (ch &gt;= &#39;A&#39; &amp;&amp; ch &lt;= &#39;Z&#39;) {
157                                 if (exec) {
158                                     sv[ch - &#39;A&#39;] = stack.pop();
159                                 }
160                             } else {
161                                 throw new IllegalArgumentException();
162                             }
163                             break;
164                         case &#39;g&#39;:
165                             ch = str.charAt(index++);
166                             if (ch &gt;= &#39;a&#39; &amp;&amp; ch &lt;= &#39;z&#39;) {
167                                 if (exec) {
168                                     stack.push(dv[ch - &#39;a&#39;]);
169                                 }
170                             } else if (ch &gt;= &#39;A&#39; &amp;&amp; ch &lt;= &#39;Z&#39;) {
171                                 if (exec) {
172                                     stack.push(sv[ch - &#39;A&#39;]);
173                                 }
174                             } else {
175                                 throw new IllegalArgumentException();
176                             }
177                             break;
178                         case &#39;\&#39;&#39;:
179                             ch = str.charAt(index++);
180                             if (exec) {
181                                 stack.push((int) ch);
182                             }
183                             ch = str.charAt(index++);
184                             if (ch != &#39;\&#39;&#39;) {
185                                 throw new IllegalArgumentException();
186                             }
187                             break;
188                         case &#39;{&#39;:
189                             int start = index;
190                             while (str.charAt(index++) != &#39;}&#39;) ;
191                             if (exec) {
192                                 int v = Integer.valueOf(str.substring(start, index - 1));
193                                 stack.push(v);
194                             }
195                             break;
196                         case &#39;l&#39;:
197                             if (exec) {
198                                 stack.push(stack.pop().toString().length());
199                             }
200                             break;
201                         case &#39;+&#39;:
202                             if (exec) {
203                                 int v2 = toInteger(stack.pop());
204                                 int v1 = toInteger(stack.pop());
205                                 stack.push(v1 + v2);
206                             }
207                             break;
208                         case &#39;-&#39;:
209                             if (exec) {
210                                 int v2 = toInteger(stack.pop());
211                                 int v1 = toInteger(stack.pop());
212                                 stack.push(v1 - v2);
213                             }
214                             break;
215                         case &#39;*&#39;:
216                             if (exec) {
217                                 int v2 = toInteger(stack.pop());
218                                 int v1 = toInteger(stack.pop());
219                                 stack.push(v1 * v2);
220                             }
221                             break;
222                         case &#39;/&#39;:
223                             if (exec) {
224                                 int v2 = toInteger(stack.pop());
225                                 int v1 = toInteger(stack.pop());
226                                 stack.push(v1 / v2);
227                             }
228                             break;
229                         case &#39;m&#39;:
230                             if (exec) {
231                                 int v2 = toInteger(stack.pop());
232                                 int v1 = toInteger(stack.pop());
233                                 stack.push(v1 % v2);
234                             }
235                             break;
236                         case &#39;&amp;&#39;:
237                             if (exec) {
238                                 int v2 = toInteger(stack.pop());
239                                 int v1 = toInteger(stack.pop());
240                                 stack.push(v1 &amp; v2);
241                             }
242                             break;
243                         case &#39;|&#39;:
244                             if (exec) {
245                                 int v2 = toInteger(stack.pop());
246                                 int v1 = toInteger(stack.pop());
247                                 stack.push(v1 | v2);
248                             }
249                             break;
250                         case &#39;^&#39;:
251                             if (exec) {
252                                 int v2 = toInteger(stack.pop());
253                                 int v1 = toInteger(stack.pop());
254                                 stack.push(v1 ^ v2);
255                             }
256                             break;
257                         case &#39;=&#39;:
258                             if (exec) {
259                                 int v2 = toInteger(stack.pop());
260                                 int v1 = toInteger(stack.pop());
261                                 stack.push(v1 == v2);
262                             }
263                             break;
264                         case &#39;&gt;&#39;:
265                             if (exec) {
266                                 int v2 = toInteger(stack.pop());
267                                 int v1 = toInteger(stack.pop());
268                                 stack.push(v1 &gt; v2);
269                             }
270                             break;
271                         case &#39;&lt;&#39;:
272                             if (exec) {
273                                 int v2 = toInteger(stack.pop());
274                                 int v1 = toInteger(stack.pop());
275                                 stack.push(v1 &lt; v2);
276                             }
277                             break;
278                         case &#39;A&#39;:
279                             if (exec) {
280                                 int v2 = toInteger(stack.pop());
281                                 int v1 = toInteger(stack.pop());
282                                 stack.push(v1 != 0 &amp;&amp; v2 != 0);
283                             }
284                             break;
285                         case &#39;!&#39;:
286                             if (exec) {
287                                 int v1 = toInteger(stack.pop());
288                                 stack.push(v1 == 0);
289                             }
290                             break;
291                         case &#39;~&#39;:
292                             if (exec) {
293                                 int v1 = toInteger(stack.pop());
294                                 stack.push(~v1);
295                             }
296                             break;
297                         case &#39;O&#39;:
298                             if (exec) {
299                                 int v2 = toInteger(stack.pop());
300                                 int v1 = toInteger(stack.pop());
301                                 stack.push(v1 != 0 || v2 != 0);
302                             }
303                             break;
304                         case &#39;?&#39;:
305                             if (ifte != IFTE_NONE) {
306                                 throw new IllegalArgumentException();
307                             } else {
308                                 ifte = IFTE_IF;
309                             }
310                             break;
311                         case &#39;t&#39;:
312                             if (ifte != IFTE_IF &amp;&amp; ifte != IFTE_ELSE) {
313                                 throw new IllegalArgumentException();
314                             } else {
315                                 ifte = IFTE_THEN;
316                             }
317                             exec = toInteger(stack.pop()) != 0;
318                             break;
319                         case &#39;e&#39;:
320                             if (ifte != IFTE_THEN) {
321                                 throw new IllegalArgumentException();
322                             } else {
323                                 ifte = IFTE_ELSE;
324                             }
325                             exec = !exec;
326                             break;
327                         case &#39;;&#39;:
328                             if (ifte == IFTE_NONE || ifte == IFTE_IF) {
329                                 throw new IllegalArgumentException();
330                             } else {
331                                 ifte = IFTE_NONE;
332                             }
333                             exec = true;
334                             break;
335                         case &#39;i&#39;:
336                             if (params.length &gt;= 1) {
337                                 params[0] = toInteger(params[0]) + 1;
338                             }
339                             if (params.length &gt;= 2) {
340                                 params[1] = toInteger(params[1]) + 1;
341                             }
342                             break;
343                         case &#39;d&#39;:
344                             out.append(Integer.toString(toInteger(stack.pop())));
345                             break;
346                         default:
347                             throw new UnsupportedOperationException();
348                     }
349                     break;
350                 case &#39;$&#39;:
351                     if (str.charAt(index) == &#39;&lt;&#39;) {
352                         // We don&#39;t honour delays, just skip
353                         int nb = 0;
354                         while ((ch = str.charAt(++index)) != &#39;&gt;&#39;) {
355                             if (ch &gt;= &#39;0&#39; &amp;&amp; ch &lt;= &#39;9&#39;) {
356                                 nb = nb * 10 + (ch - &#39;0&#39;);
357                             } else if (ch == &#39;*&#39;) {
358                                 // ignore
359                             } else if (ch == &#39;/&#39;) {
360                                 // ignore
361                             } else {
362                                 // illegal, but ...
363                             }
364                         }
365                         index++;
366                         try {
367                             if (out instanceof Flushable) {
368                                 ((Flushable) out).flush();
369                             }
370                             Thread.sleep(nb);
371                         } catch (InterruptedException e) {
372                         }
373                     } else {
374                         if (exec) {
375                             out.append(ch);
376                         }
377                     }
378                     break;
379                 default:
380                     if (exec) {
381                         out.append(ch);
382                     }
383                     break;
384             }
385         }
386     }
387 
388     private static int toInteger(Object pop) {
389         if (pop instanceof Number) {
390             return ((Number) pop).intValue();
391         } else if (pop instanceof Boolean) {
392             return (Boolean) pop ? 1 : 0;
393         } else {
394             return Integer.valueOf(pop.toString());
395         }
396     }
397 
398 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>