<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.crypto.cryptoki/share/classes/sun/security/pkcs11/wrapper/PKCS11.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Functions.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PKCS11Constants.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.crypto.cryptoki/share/classes/sun/security/pkcs11/wrapper/PKCS11.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   */
  
  /* Copyright  (c) 2002 Graz University of Technology. All rights reserved.
   *
   * Redistribution and use in  source and binary forms, with or without
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -95,10 +95,16 @@</span>
          // dummy method that can be called to make sure the native
          // portion has been loaded. actual loading happens in the
          // static initializer, hence this method is empty.
      }
  
<span class="udiff-line-added">+     /* *****************************************************************************</span>
<span class="udiff-line-added">+      * Utility, Resource Clean up</span>
<span class="udiff-line-added">+      ******************************************************************************/</span>
<span class="udiff-line-added">+     // always return 0L</span>
<span class="udiff-line-added">+     public static native long freeMechanism(long hMechanism);</span>
<span class="udiff-line-added">+ </span>
      /**
       * The PKCS#11 module to connect to. This is the PKCS#11 driver of the token;
       * e.g. pk2priv.dll.
       */
      private final String pkcs11ModulePath;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -727,37 +733,52 @@</span>
       * C_Encrypt encrypts single-part data.
       * (Encryption and decryption)
       *
       * @param hSession the session&#39;s handle
       *         (PKCS#11 param: CK_SESSION_HANDLE hSession)
<span class="udiff-line-modified-removed">-      * @param pData the data to get encrypted and the data&#39;s length</span>
<span class="udiff-line-modified-added">+      * @param directIn the address of the to-be-encrypted data</span>
<span class="udiff-line-added">+      * @param in buffer containing the to-be-encrypted data</span>
<span class="udiff-line-added">+      * @param inOfs buffer offset of the to-be-encrypted data</span>
<span class="udiff-line-added">+      * @param inLen length of the to-be-encrypted data</span>
       *         (PKCS#11 param: CK_BYTE_PTR pData, CK_ULONG ulDataLen)
<span class="udiff-line-modified-removed">-      * @return the encrypted data and the encrypted data&#39;s length</span>
<span class="udiff-line-modified-added">+      * @param directOut the address for the encrypted data</span>
<span class="udiff-line-added">+      * @param out buffer for the encrypted data</span>
<span class="udiff-line-added">+      * @param outOfs buffer offset for the encrypted data</span>
<span class="udiff-line-added">+      * @param outLen buffer size for the encrypted data</span>
<span class="udiff-line-added">+      * @return the length of encrypted data</span>
       *         (PKCS#11 param: CK_BYTE_PTR pEncryptedData,
       *                         CK_ULONG_PTR pulEncryptedDataLen)
       * @exception PKCS11Exception If function returns other value than CKR_OK.
<span class="udiff-line-modified-removed">-      * @preconditions (pData &lt;&gt; null)</span>
<span class="udiff-line-modified-removed">-      * @postconditions (result &lt;&gt; null)</span>
<span class="udiff-line-modified-added">+      * @preconditions</span>
<span class="udiff-line-modified-added">+      * @postconditions</span>
       */
<span class="udiff-line-modified-removed">-     public native int C_Encrypt(long hSession, byte[] in, int inOfs, int inLen,</span>
<span class="udiff-line-modified-removed">-             byte[] out, int outOfs, int outLen) throws PKCS11Exception;</span>
<span class="udiff-line-modified-added">+     public native int C_Encrypt(long hSession, long directIn, byte[] in,</span>
<span class="udiff-line-modified-added">+             int inOfs, int inLen, long directOut, byte[] out, int outOfs,</span>
<span class="udiff-line-added">+             int outLen) throws PKCS11Exception;</span>
  
  
      /**
       * C_EncryptUpdate continues a multiple-part encryption
       * operation.
       * (Encryption and decryption)
       *
       * @param hSession the session&#39;s handle
       *         (PKCS#11 param: CK_SESSION_HANDLE hSession)
<span class="udiff-line-modified-removed">-      * @param pPart the data part to get encrypted and the data part&#39;s length</span>
<span class="udiff-line-modified-added">+      * @param directIn the address of the to-be-encrypted data</span>
<span class="udiff-line-added">+      * @param in buffer containing the to-be-encrypted data</span>
<span class="udiff-line-added">+      * @param inOfs buffer offset of the to-be-encrypted data</span>
<span class="udiff-line-added">+      * @param inLen length of the to-be-encrypted data</span>
       *         (PKCS#11 param: CK_BYTE_PTR pPart, CK_ULONG ulPartLen)
<span class="udiff-line-modified-removed">-      * @return the encrypted data part and the encrypted data part&#39;s length</span>
<span class="udiff-line-modified-added">+      * @param directOut the address for the encrypted data</span>
<span class="udiff-line-added">+      * @param out buffer for the encrypted data</span>
<span class="udiff-line-added">+      * @param outOfs buffer offset for the encrypted data</span>
<span class="udiff-line-added">+      * @param outLen buffer size for the encrypted data</span>
<span class="udiff-line-added">+      * @return the length of encrypted data for this update</span>
       *         (PKCS#11 param: CK_BYTE_PTR pEncryptedPart,
                               CK_ULONG_PTR pulEncryptedPartLen)
       * @exception PKCS11Exception If function returns other value than CKR_OK.
<span class="udiff-line-modified-removed">-      * @preconditions (pPart &lt;&gt; null)</span>
<span class="udiff-line-modified-added">+      * @preconditions</span>
       * @postconditions
       */
      public native int C_EncryptUpdate(long hSession, long directIn, byte[] in,
              int inOfs, int inLen, long directOut, byte[] out, int outOfs,
              int outLen) throws PKCS11Exception;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -768,16 +789,20 @@</span>
       * operation.
       * (Encryption and decryption)
       *
       * @param hSession the session&#39;s handle
       *         (PKCS#11 param: CK_SESSION_HANDLE hSession)
<span class="udiff-line-modified-removed">-      * @return the last encrypted data part and the last data part&#39;s length</span>
<span class="udiff-line-modified-added">+      * @param directOut the address for the encrypted data</span>
<span class="udiff-line-added">+      * @param out buffer for the encrypted data</span>
<span class="udiff-line-added">+      * @param outOfs buffer offset for the encrypted data</span>
<span class="udiff-line-added">+      * @param outLen buffer size for the encrypted data</span>
<span class="udiff-line-added">+      * @return the length of the last part of the encrypted data</span>
       *         (PKCS#11 param: CK_BYTE_PTR pLastEncryptedPart,
                               CK_ULONG_PTR pulLastEncryptedPartLen)
       * @exception PKCS11Exception If function returns other value than CKR_OK.
       * @preconditions
<span class="udiff-line-modified-removed">-      * @postconditions (result &lt;&gt; null)</span>
<span class="udiff-line-modified-added">+      * @postconditions</span>
       */
      public native int C_EncryptFinal(long hSession, long directOut, byte[] out,
              int outOfs, int outLen) throws PKCS11Exception;
  
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -803,39 +828,52 @@</span>
       * C_Decrypt decrypts encrypted data in a single part.
       * (Encryption and decryption)
       *
       * @param hSession the session&#39;s handle
       *         (PKCS#11 param: CK_SESSION_HANDLE hSession)
<span class="udiff-line-modified-removed">-      * @param pEncryptedData the encrypted data to get decrypted and the</span>
<span class="udiff-line-modified-removed">-      *         encrypted data&#39;s length</span>
<span class="udiff-line-modified-removed">-      *         (PKCS#11 param: CK_BYTE_PTR pEncryptedData,</span>
<span class="udiff-line-modified-removed">-      *                         CK_ULONG ulEncryptedDataLen)</span>
<span class="udiff-line-modified-removed">-      * @return the decrypted data and the data&#39;s length</span>
<span class="udiff-line-modified-added">+      * @param directIn the address of the to-be-decrypted data</span>
<span class="udiff-line-modified-added">+      * @param in buffer containing the to-be-decrypted data</span>
<span class="udiff-line-modified-added">+      * @param inOfs buffer offset of the to-be-decrypted data</span>
<span class="udiff-line-modified-added">+      * @param inLen length of the to-be-decrypted data</span>
<span class="udiff-line-modified-added">+      *         (PKCS#11 param: CK_BYTE_PTR pDecryptedData,</span>
<span class="udiff-line-added">+      *                         CK_ULONG ulDecryptedDataLen)</span>
<span class="udiff-line-added">+      * @param directOut the address for the decrypted data</span>
<span class="udiff-line-added">+      * @param out buffer for the decrypted data</span>
<span class="udiff-line-added">+      * @param outOfs buffer offset for the decrypted data</span>
<span class="udiff-line-added">+      * @param outLen buffer size for the decrypted data</span>
<span class="udiff-line-added">+      * @return the length of decrypted data</span>
       *         (PKCS#11 param: CK_BYTE_PTR pData, CK_ULONG_PTR pulDataLen)
       * @exception PKCS11Exception If function returns other value than CKR_OK.
<span class="udiff-line-modified-removed">-      * @preconditions (pEncryptedPart &lt;&gt; null)</span>
<span class="udiff-line-modified-removed">-      * @postconditions (result &lt;&gt; null)</span>
<span class="udiff-line-modified-added">+      * @preconditions</span>
<span class="udiff-line-modified-added">+      * @postconditions</span>
       */
<span class="udiff-line-modified-removed">-     public native int C_Decrypt(long hSession, byte[] in, int inOfs, int inLen,</span>
<span class="udiff-line-modified-removed">-             byte[] out, int outOfs, int outLen) throws PKCS11Exception;</span>
<span class="udiff-line-modified-added">+     public native int C_Decrypt(long hSession, long directIn, byte[] in,</span>
<span class="udiff-line-modified-added">+             int inOfs, int inLen, long directOut, byte[] out, int outOfs,</span>
<span class="udiff-line-added">+             int outLen) throws PKCS11Exception;</span>
  
  
      /**
       * C_DecryptUpdate continues a multiple-part decryption
       * operation.
       * (Encryption and decryption)
       *
       * @param hSession the session&#39;s handle
       *         (PKCS#11 param: CK_SESSION_HANDLE hSession)
<span class="udiff-line-modified-removed">-      * @param pEncryptedPart the encrypted data part to get decrypted and the</span>
<span class="udiff-line-modified-removed">-      *         encrypted data part&#39;s length</span>
<span class="udiff-line-modified-removed">-      *         (PKCS#11 param: CK_BYTE_PTR pEncryptedPart,</span>
<span class="udiff-line-modified-removed">-      *                         CK_ULONG ulEncryptedPartLen)</span>
<span class="udiff-line-modified-removed">-      * @return the decrypted data part and the data part&#39;s length</span>
<span class="udiff-line-modified-added">+      * @param directIn the address of the to-be-decrypted data</span>
<span class="udiff-line-modified-added">+      * @param in buffer containing the to-be-decrypted data</span>
<span class="udiff-line-modified-added">+      * @param inOfs buffer offset of the to-be-decrypted data</span>
<span class="udiff-line-modified-added">+      * @param inLen length of the to-be-decrypted data</span>
<span class="udiff-line-modified-added">+      *         (PKCS#11 param: CK_BYTE_PTR pDecryptedPart,</span>
<span class="udiff-line-added">+      *                         CK_ULONG ulDecryptedPartLen)</span>
<span class="udiff-line-added">+      * @param directOut the address for the decrypted data</span>
<span class="udiff-line-added">+      * @param out buffer for the decrypted data</span>
<span class="udiff-line-added">+      * @param outOfs buffer offset for the decrypted data</span>
<span class="udiff-line-added">+      * @param outLen buffer size for the decrypted data</span>
<span class="udiff-line-added">+      * @return the length of decrypted data for this update</span>
       *         (PKCS#11 param: CK_BYTE_PTR pPart, CK_ULONG_PTR pulPartLen)
       * @exception PKCS11Exception If function returns other value than CKR_OK.
<span class="udiff-line-modified-removed">-      * @preconditions (pEncryptedPart &lt;&gt; null)</span>
<span class="udiff-line-modified-added">+      * @preconditions</span>
       * @postconditions
       */
      public native int C_DecryptUpdate(long hSession, long directIn, byte[] in,
              int inOfs, int inLen, long directOut, byte[] out, int outOfs,
              int outLen) throws PKCS11Exception;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -846,16 +884,20 @@</span>
       * operation.
       * (Encryption and decryption)
       *
       * @param hSession the session&#39;s handle
       *         (PKCS#11 param: CK_SESSION_HANDLE hSession)
<span class="udiff-line-modified-removed">-      * @return the last decrypted data part and the last data part&#39;s length</span>
<span class="udiff-line-modified-added">+      * @param directOut the address for the decrypted data</span>
<span class="udiff-line-added">+      * @param out buffer for the decrypted data</span>
<span class="udiff-line-added">+      * @param outOfs buffer offset for the decrypted data</span>
<span class="udiff-line-added">+      * @param outLen buffer size for the decrypted data</span>
<span class="udiff-line-added">+      * @return the length of this last part of decrypted data</span>
       *         (PKCS#11 param: CK_BYTE_PTR pLastPart,
       *                         CK_ULONG_PTR pulLastPartLen)
       * @exception PKCS11Exception If function returns other value than CKR_OK.
       * @preconditions
<span class="udiff-line-modified-removed">-      * @postconditions (result &lt;&gt; null)</span>
<span class="udiff-line-modified-added">+      * @postconditions</span>
       */
      public native int C_DecryptFinal(long hSession, long directOut, byte[] out,
              int outOfs, int outLen) throws PKCS11Exception;
  
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1025,10 +1067,11 @@</span>
       * returning the signature.
       * (Signing and MACing)
       *
       * @param hSession the session&#39;s handle
       *         (PKCS#11 param: CK_SESSION_HANDLE hSession)
<span class="udiff-line-added">+      * @param expectedLen expected signature length, can be 0 if unknown</span>
       * @return the signature and the signature&#39;s length
       *         (PKCS#11 param: CK_BYTE_PTR pSignature,
       *                         CK_ULONG_PTR pulSignatureLen)
       * @exception PKCS11Exception If function returns other value than CKR_OK.
       * @preconditions
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1283,11 +1326,10 @@</span>
       */
  //    public native byte[] C_DecryptVerifyUpdate(long hSession,
  //            byte[] pEncryptedPart) throws PKCS11Exception;
  
  
<span class="udiff-line-removed">- </span>
  /* *****************************************************************************
   * Key management
   ******************************************************************************/
  
      /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1690,14 +1732,15 @@</span>
      public synchronized void C_EncryptInit(long hSession,
              CK_MECHANISM pMechanism, long hKey) throws PKCS11Exception {
          super.C_EncryptInit(hSession, pMechanism, hKey);
      }
  
<span class="udiff-line-modified-removed">-     public synchronized int C_Encrypt(long hSession, byte[] in, int inOfs,</span>
<span class="udiff-line-modified-removed">-             int inLen, byte[] out, int outOfs, int outLen)</span>
<span class="udiff-line-modified-added">+     public synchronized int C_Encrypt(long hSession, long directIn, byte[] in,</span>
<span class="udiff-line-modified-added">+             int inOfs, int inLen, long directOut, byte[] out, int outOfs, int outLen)</span>
              throws PKCS11Exception {
<span class="udiff-line-modified-removed">-         return super.C_Encrypt(hSession, in, inOfs, inLen, out, outOfs, outLen);</span>
<span class="udiff-line-modified-added">+         return super.C_Encrypt(hSession, directIn, in, inOfs, inLen,</span>
<span class="udiff-line-added">+                 directOut, out, outOfs, outLen);</span>
      }
  
      public synchronized int C_EncryptUpdate(long hSession, long directIn,
              byte[] in, int inOfs, int inLen, long directOut, byte[] out,
              int outOfs, int outLen) throws PKCS11Exception {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1713,14 +1756,15 @@</span>
      public synchronized void C_DecryptInit(long hSession,
              CK_MECHANISM pMechanism, long hKey) throws PKCS11Exception {
          super.C_DecryptInit(hSession, pMechanism, hKey);
      }
  
<span class="udiff-line-modified-removed">-     public synchronized int C_Decrypt(long hSession, byte[] in, int inOfs,</span>
<span class="udiff-line-modified-removed">-             int inLen, byte[] out, int outOfs, int outLen)</span>
<span class="udiff-line-modified-removed">-             throws PKCS11Exception {</span>
<span class="udiff-line-modified-removed">-         return super.C_Decrypt(hSession, in, inOfs, inLen, out, outOfs, outLen);</span>
<span class="udiff-line-modified-added">+     public synchronized int C_Decrypt(long hSession, long directIn,</span>
<span class="udiff-line-modified-added">+             byte[] in, int inOfs, int inLen, long directOut, byte[] out,</span>
<span class="udiff-line-modified-added">+             int outOfs, int outLen) throws PKCS11Exception {</span>
<span class="udiff-line-modified-added">+         return super.C_Decrypt(hSession, directIn, in, inOfs, inLen,</span>
<span class="udiff-line-added">+                 directOut, out, outOfs, outLen);</span>
      }
  
      public synchronized int C_DecryptUpdate(long hSession, long directIn,
              byte[] in, int inOfs, int inLen, long directOut, byte[] out,
              int outOfs, int outLen) throws PKCS11Exception {
</pre>
<center><a href="Functions.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="PKCS11Constants.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>