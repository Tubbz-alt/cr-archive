<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.crypto.cryptoki/share/classes/sun/security/pkcs11/wrapper/CK_MECHANISM.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 
  5 /* Copyright  (c) 2002 Graz University of Technology. All rights reserved.
  6  *
  7  * Redistribution and use in  source and binary forms, with or without
  8  * modification, are permitted  provided that the following conditions are met:
  9  *
 10  * 1. Redistributions of  source code must retain the above copyright notice,
 11  *    this list of conditions and the following disclaimer.
 12  *
 13  * 2. Redistributions in  binary form must reproduce the above copyright notice,
 14  *    this list of conditions and the following disclaimer in the documentation
 15  *    and/or other materials provided with the distribution.
 16  *
 17  * 3. The end-user documentation included with the redistribution, if any, must
 18  *    include the following acknowledgment:
 19  *
 20  *    &quot;This product includes software developed by IAIK of Graz University of
 21  *     Technology.&quot;
 22  *
 23  *    Alternately, this acknowledgment may appear in the software itself, if
 24  *    and wherever such third-party acknowledgments normally appear.
 25  *
 26  * 4. The names &quot;Graz University of Technology&quot; and &quot;IAIK of Graz University of
 27  *    Technology&quot; must not be used to endorse or promote products derived from
 28  *    this software without prior written permission.
 29  *
 30  * 5. Products derived from this software may not be called
 31  *    &quot;IAIK PKCS Wrapper&quot;, nor may &quot;IAIK&quot; appear in their name, without prior
 32  *    written permission of Graz University of Technology.
 33  *
 34  *  THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESSED OR IMPLIED
 35  *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 36  *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 37  *  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE LICENSOR BE
 38  *  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
 39  *  OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 40  *  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
 41  *  OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 42  *  ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 43  *  OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 44  *  OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 45  *  POSSIBILITY  OF SUCH DAMAGE.
 46  */
 47 
 48 package sun.security.pkcs11.wrapper;
 49 
 50 import java.math.BigInteger;
 51 import static sun.security.pkcs11.wrapper.PKCS11Constants.*;
 52 
 53 /**
 54  * class CK_MECHANISM specifies a particular mechanism and any parameters it
 55  * requires.&lt;p&gt;
 56  * &lt;B&gt;PKCS#11 structure:&lt;/B&gt;
 57  * &lt;PRE&gt;
 58  *  typedef struct CK_MECHANISM {&amp;nbsp;&amp;nbsp;
 59  *    CK_MECHANISM_TYPE mechanism;&amp;nbsp;&amp;nbsp;
 60  *    CK_VOID_PTR pParameter;&amp;nbsp;&amp;nbsp;
 61  *    CK_ULONG ulParameterLen;&amp;nbsp;&amp;nbsp;
 62  *  } CK_MECHANISM;
 63  * &lt;/PRE&gt;
 64  *
 65  * @author Karl Scheibelhofer &lt;Karl.Scheibelhofer@iaik.at&gt;
 66  * @author Martin Schlaeffer &lt;schlaeff@sbox.tugraz.at&gt;
 67  */
 68 public class CK_MECHANISM {
 69 
 70     /**
 71      * &lt;B&gt;PKCS#11:&lt;/B&gt;
 72      * &lt;PRE&gt;
 73      *   CK_MECHANISM_TYPE mechanism;
 74      * &lt;/PRE&gt;
 75      */
 76     public long mechanism;
 77 
 78     /**
 79      * &lt;B&gt;PKCS#11:&lt;/B&gt;
 80      * &lt;PRE&gt;
 81      *   CK_VOID_PTR pParameter;
 82      *   CK_ULONG ulParameterLen;
 83      * &lt;/PRE&gt;
 84      */
<a name="2" id="anc2"></a><span class="line-modified"> 85     public Object pParameter = null;</span>
 86 
<a name="3" id="anc3"></a><span class="line-modified"> 87     // pointer to native CK_MECHANISM structure</span>
<span class="line-modified"> 88     // For mechanisms which have only mechanism id, the native structure</span>
<span class="line-modified"> 89     // can be freed right after init and this field will not be used. However,</span>
<span class="line-added"> 90     // for mechanisms which have both mechanism id and parameters, it can</span>
<span class="line-added"> 91     // only be freed after operation is finished. Thus, the native pointer</span>
<span class="line-added"> 92     // will be stored here and then be explicitly freed by caller.</span>
<span class="line-added"> 93     private long pHandle = 0L;</span>
 94 
 95     public CK_MECHANISM(long mechanism) {
 96         this.mechanism = mechanism;
 97     }
 98 
 99     // We don&#39;t have a (long,Object) constructor to force type checking.
100     // This makes sure we don&#39;t accidentally pass a class that the native
101     // code cannot handle.
<a name="4" id="anc4"></a>
102     public CK_MECHANISM(long mechanism, byte[] pParameter) {
103         init(mechanism, pParameter);
104     }
105 
106     public CK_MECHANISM(long mechanism, BigInteger b) {
107         init(mechanism, sun.security.pkcs11.P11Util.getMagnitude(b));
108     }
109 
110     public CK_MECHANISM(long mechanism, CK_VERSION version) {
111         init(mechanism, version);
112     }
113 
114     public CK_MECHANISM(long mechanism, CK_SSL3_MASTER_KEY_DERIVE_PARAMS params) {
115         init(mechanism, params);
116     }
117 
118     public CK_MECHANISM(long mechanism, CK_TLS12_MASTER_KEY_DERIVE_PARAMS params) {
119         init(mechanism, params);
120     }
121 
122     public CK_MECHANISM(long mechanism, CK_SSL3_KEY_MAT_PARAMS params) {
123         init(mechanism, params);
124     }
125 
126     public CK_MECHANISM(long mechanism, CK_TLS12_KEY_MAT_PARAMS params) {
127         init(mechanism, params);
128     }
129 
130     public CK_MECHANISM(long mechanism, CK_TLS_PRF_PARAMS params) {
131         init(mechanism, params);
132     }
133 
134     public CK_MECHANISM(long mechanism, CK_TLS_MAC_PARAMS params) {
135         init(mechanism, params);
136     }
137 
138     public CK_MECHANISM(long mechanism, CK_ECDH1_DERIVE_PARAMS params) {
139         init(mechanism, params);
140     }
141 
142     public CK_MECHANISM(long mechanism, Long params) {
143         init(mechanism, params);
144     }
145 
146     public CK_MECHANISM(long mechanism, CK_AES_CTR_PARAMS params) {
147         init(mechanism, params);
148     }
149 
<a name="5" id="anc5"></a><span class="line-added">150     public CK_MECHANISM(long mechanism, CK_GCM_PARAMS params) {</span>
<span class="line-added">151         init(mechanism, params);</span>
<span class="line-added">152     }</span>
<span class="line-added">153 </span>
<span class="line-added">154     public CK_MECHANISM(long mechanism, CK_CCM_PARAMS params) {</span>
<span class="line-added">155         init(mechanism, params);</span>
<span class="line-added">156     }</span>
<span class="line-added">157 </span>
<span class="line-added">158     // For PSS. the parameter may be set multiple times, use the</span>
<span class="line-added">159     // CK_MECHANISM(long) constructor and setParameter(CK_RSA_PKCS_PSS_PARAMS)</span>
<span class="line-added">160     // methods instead of creating yet another constructor</span>
<span class="line-added">161     public void setParameter(CK_RSA_PKCS_PSS_PARAMS params) {</span>
<span class="line-added">162         assert(this.mechanism == CKM_RSA_PKCS_PSS);</span>
<span class="line-added">163         assert(params != null);</span>
<span class="line-added">164         if (this.pParameter != null &amp;&amp; this.pParameter.equals(params)) {</span>
<span class="line-added">165             return;</span>
<span class="line-added">166         }</span>
<span class="line-added">167         freeHandle();</span>
<span class="line-added">168         this.pParameter = params;</span>
<span class="line-added">169     }</span>
<span class="line-added">170 </span>
<span class="line-added">171     public void freeHandle() {</span>
<span class="line-added">172         if (this.pHandle != 0L) {</span>
<span class="line-added">173             this.pHandle = PKCS11.freeMechanism(pHandle);</span>
<span class="line-added">174         }</span>
<span class="line-added">175     }</span>
<span class="line-added">176 </span>
177     private void init(long mechanism, Object pParameter) {
178         this.mechanism = mechanism;
179         this.pParameter = pParameter;
180     }
181 
182     /**
183      * Returns the string representation of CK_MECHANISM.
184      *
185      * @return the string representation of CK_MECHANISM
186      */
187     public String toString() {
188         StringBuilder sb = new StringBuilder();
189 
190         sb.append(Constants.INDENT);
191         sb.append(&quot;mechanism: &quot;);
192         sb.append(mechanism);
193         sb.append(Constants.NEWLINE);
194 
195         sb.append(Constants.INDENT);
196         sb.append(&quot;pParameter: &quot;);
197         sb.append(pParameter.toString());
198         sb.append(Constants.NEWLINE);
199 
<a name="6" id="anc6"></a><span class="line-added">200         /*</span>
201         sb.append(Constants.INDENT);
202         sb.append(&quot;ulParameterLen: ??&quot;);
<a name="7" id="anc7"></a><span class="line-modified">203         sb.append(Constants.NEWLINE);</span>
<span class="line-modified">204         */</span>
<span class="line-modified">205         if (pHandle != 0L) {</span>
<span class="line-added">206             sb.append(Constants.INDENT);</span>
<span class="line-added">207             sb.append(&quot;pHandle: &quot;);</span>
<span class="line-added">208             sb.append(pHandle);</span>
<span class="line-added">209             sb.append(Constants.NEWLINE);</span>
<span class="line-added">210         }</span>
211         return sb.toString() ;
212     }
<a name="8" id="anc8"></a>
213 }
<a name="9" id="anc9"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="9" type="hidden" />
</body>
</html>