<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.crypto.cryptoki/share/classes/sun/security/pkcs11/wrapper/CK_MECHANISM.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../SunPKCS11.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CK_RSA_PKCS_PSS_PARAMS.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.crypto.cryptoki/share/classes/sun/security/pkcs11/wrapper/CK_MECHANISM.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 
  5 /* Copyright  (c) 2002 Graz University of Technology. All rights reserved.
  6  *
  7  * Redistribution and use in  source and binary forms, with or without
  8  * modification, are permitted  provided that the following conditions are met:
  9  *
 10  * 1. Redistributions of  source code must retain the above copyright notice,
 11  *    this list of conditions and the following disclaimer.
 12  *
 13  * 2. Redistributions in  binary form must reproduce the above copyright notice,
 14  *    this list of conditions and the following disclaimer in the documentation
 15  *    and/or other materials provided with the distribution.
 16  *
 17  * 3. The end-user documentation included with the redistribution, if any, must
 18  *    include the following acknowledgment:
 19  *
 20  *    &quot;This product includes software developed by IAIK of Graz University of
 21  *     Technology.&quot;
 22  *
</pre>
<hr />
<pre>
 65  * @author Karl Scheibelhofer &lt;Karl.Scheibelhofer@iaik.at&gt;
 66  * @author Martin Schlaeffer &lt;schlaeff@sbox.tugraz.at&gt;
 67  */
 68 public class CK_MECHANISM {
 69 
 70     /**
 71      * &lt;B&gt;PKCS#11:&lt;/B&gt;
 72      * &lt;PRE&gt;
 73      *   CK_MECHANISM_TYPE mechanism;
 74      * &lt;/PRE&gt;
 75      */
 76     public long mechanism;
 77 
 78     /**
 79      * &lt;B&gt;PKCS#11:&lt;/B&gt;
 80      * &lt;PRE&gt;
 81      *   CK_VOID_PTR pParameter;
 82      *   CK_ULONG ulParameterLen;
 83      * &lt;/PRE&gt;
 84      */
<span class="line-modified"> 85     public Object pParameter;</span>
 86 
<span class="line-modified"> 87     public CK_MECHANISM() {</span>
<span class="line-modified"> 88         // empty</span>
<span class="line-modified"> 89     }</span>




 90 
 91     public CK_MECHANISM(long mechanism) {
 92         this.mechanism = mechanism;
 93     }
 94 
 95     // We don&#39;t have a (long,Object) constructor to force type checking.
 96     // This makes sure we don&#39;t accidentally pass a class that the native
 97     // code cannot handle.
<span class="line-removed"> 98 </span>
 99     public CK_MECHANISM(long mechanism, byte[] pParameter) {
100         init(mechanism, pParameter);
101     }
102 
103     public CK_MECHANISM(long mechanism, BigInteger b) {
104         init(mechanism, sun.security.pkcs11.P11Util.getMagnitude(b));
105     }
106 
107     public CK_MECHANISM(long mechanism, CK_VERSION version) {
108         init(mechanism, version);
109     }
110 
111     public CK_MECHANISM(long mechanism, CK_SSL3_MASTER_KEY_DERIVE_PARAMS params) {
112         init(mechanism, params);
113     }
114 
115     public CK_MECHANISM(long mechanism, CK_TLS12_MASTER_KEY_DERIVE_PARAMS params) {
116         init(mechanism, params);
117     }
118 
</pre>
<hr />
<pre>
127     public CK_MECHANISM(long mechanism, CK_TLS_PRF_PARAMS params) {
128         init(mechanism, params);
129     }
130 
131     public CK_MECHANISM(long mechanism, CK_TLS_MAC_PARAMS params) {
132         init(mechanism, params);
133     }
134 
135     public CK_MECHANISM(long mechanism, CK_ECDH1_DERIVE_PARAMS params) {
136         init(mechanism, params);
137     }
138 
139     public CK_MECHANISM(long mechanism, Long params) {
140         init(mechanism, params);
141     }
142 
143     public CK_MECHANISM(long mechanism, CK_AES_CTR_PARAMS params) {
144         init(mechanism, params);
145     }
146 



























147     private void init(long mechanism, Object pParameter) {
148         this.mechanism = mechanism;
149         this.pParameter = pParameter;
150     }
151 
152     /**
153      * Returns the string representation of CK_MECHANISM.
154      *
155      * @return the string representation of CK_MECHANISM
156      */
157     public String toString() {
158         StringBuilder sb = new StringBuilder();
159 
160         sb.append(Constants.INDENT);
161         sb.append(&quot;mechanism: &quot;);
162         sb.append(mechanism);
163         sb.append(Constants.NEWLINE);
164 
165         sb.append(Constants.INDENT);
166         sb.append(&quot;pParameter: &quot;);
167         sb.append(pParameter.toString());
168         sb.append(Constants.NEWLINE);
169 

170         sb.append(Constants.INDENT);
171         sb.append(&quot;ulParameterLen: ??&quot;);
<span class="line-modified">172         //buffer.append(pParameter.length);</span>
<span class="line-modified">173         //buffer.append(Constants.NEWLINE);</span>
<span class="line-modified">174 </span>





175         return sb.toString() ;
176     }
<span class="line-removed">177 </span>
178 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 
  5 /* Copyright  (c) 2002 Graz University of Technology. All rights reserved.
  6  *
  7  * Redistribution and use in  source and binary forms, with or without
  8  * modification, are permitted  provided that the following conditions are met:
  9  *
 10  * 1. Redistributions of  source code must retain the above copyright notice,
 11  *    this list of conditions and the following disclaimer.
 12  *
 13  * 2. Redistributions in  binary form must reproduce the above copyright notice,
 14  *    this list of conditions and the following disclaimer in the documentation
 15  *    and/or other materials provided with the distribution.
 16  *
 17  * 3. The end-user documentation included with the redistribution, if any, must
 18  *    include the following acknowledgment:
 19  *
 20  *    &quot;This product includes software developed by IAIK of Graz University of
 21  *     Technology.&quot;
 22  *
</pre>
<hr />
<pre>
 65  * @author Karl Scheibelhofer &lt;Karl.Scheibelhofer@iaik.at&gt;
 66  * @author Martin Schlaeffer &lt;schlaeff@sbox.tugraz.at&gt;
 67  */
 68 public class CK_MECHANISM {
 69 
 70     /**
 71      * &lt;B&gt;PKCS#11:&lt;/B&gt;
 72      * &lt;PRE&gt;
 73      *   CK_MECHANISM_TYPE mechanism;
 74      * &lt;/PRE&gt;
 75      */
 76     public long mechanism;
 77 
 78     /**
 79      * &lt;B&gt;PKCS#11:&lt;/B&gt;
 80      * &lt;PRE&gt;
 81      *   CK_VOID_PTR pParameter;
 82      *   CK_ULONG ulParameterLen;
 83      * &lt;/PRE&gt;
 84      */
<span class="line-modified"> 85     public Object pParameter = null;</span>
 86 
<span class="line-modified"> 87     // pointer to native CK_MECHANISM structure</span>
<span class="line-modified"> 88     // For mechanisms which have only mechanism id, the native structure</span>
<span class="line-modified"> 89     // can be freed right after init and this field will not be used. However,</span>
<span class="line-added"> 90     // for mechanisms which have both mechanism id and parameters, it can</span>
<span class="line-added"> 91     // only be freed after operation is finished. Thus, the native pointer</span>
<span class="line-added"> 92     // will be stored here and then be explicitly freed by caller.</span>
<span class="line-added"> 93     private long pHandle = 0L;</span>
 94 
 95     public CK_MECHANISM(long mechanism) {
 96         this.mechanism = mechanism;
 97     }
 98 
 99     // We don&#39;t have a (long,Object) constructor to force type checking.
100     // This makes sure we don&#39;t accidentally pass a class that the native
101     // code cannot handle.

102     public CK_MECHANISM(long mechanism, byte[] pParameter) {
103         init(mechanism, pParameter);
104     }
105 
106     public CK_MECHANISM(long mechanism, BigInteger b) {
107         init(mechanism, sun.security.pkcs11.P11Util.getMagnitude(b));
108     }
109 
110     public CK_MECHANISM(long mechanism, CK_VERSION version) {
111         init(mechanism, version);
112     }
113 
114     public CK_MECHANISM(long mechanism, CK_SSL3_MASTER_KEY_DERIVE_PARAMS params) {
115         init(mechanism, params);
116     }
117 
118     public CK_MECHANISM(long mechanism, CK_TLS12_MASTER_KEY_DERIVE_PARAMS params) {
119         init(mechanism, params);
120     }
121 
</pre>
<hr />
<pre>
130     public CK_MECHANISM(long mechanism, CK_TLS_PRF_PARAMS params) {
131         init(mechanism, params);
132     }
133 
134     public CK_MECHANISM(long mechanism, CK_TLS_MAC_PARAMS params) {
135         init(mechanism, params);
136     }
137 
138     public CK_MECHANISM(long mechanism, CK_ECDH1_DERIVE_PARAMS params) {
139         init(mechanism, params);
140     }
141 
142     public CK_MECHANISM(long mechanism, Long params) {
143         init(mechanism, params);
144     }
145 
146     public CK_MECHANISM(long mechanism, CK_AES_CTR_PARAMS params) {
147         init(mechanism, params);
148     }
149 
<span class="line-added">150     public CK_MECHANISM(long mechanism, CK_GCM_PARAMS params) {</span>
<span class="line-added">151         init(mechanism, params);</span>
<span class="line-added">152     }</span>
<span class="line-added">153 </span>
<span class="line-added">154     public CK_MECHANISM(long mechanism, CK_CCM_PARAMS params) {</span>
<span class="line-added">155         init(mechanism, params);</span>
<span class="line-added">156     }</span>
<span class="line-added">157 </span>
<span class="line-added">158     // For PSS. the parameter may be set multiple times, use the</span>
<span class="line-added">159     // CK_MECHANISM(long) constructor and setParameter(CK_RSA_PKCS_PSS_PARAMS)</span>
<span class="line-added">160     // methods instead of creating yet another constructor</span>
<span class="line-added">161     public void setParameter(CK_RSA_PKCS_PSS_PARAMS params) {</span>
<span class="line-added">162         assert(this.mechanism == CKM_RSA_PKCS_PSS);</span>
<span class="line-added">163         assert(params != null);</span>
<span class="line-added">164         if (this.pParameter != null &amp;&amp; this.pParameter.equals(params)) {</span>
<span class="line-added">165             return;</span>
<span class="line-added">166         }</span>
<span class="line-added">167         freeHandle();</span>
<span class="line-added">168         this.pParameter = params;</span>
<span class="line-added">169     }</span>
<span class="line-added">170 </span>
<span class="line-added">171     public void freeHandle() {</span>
<span class="line-added">172         if (this.pHandle != 0L) {</span>
<span class="line-added">173             this.pHandle = PKCS11.freeMechanism(pHandle);</span>
<span class="line-added">174         }</span>
<span class="line-added">175     }</span>
<span class="line-added">176 </span>
177     private void init(long mechanism, Object pParameter) {
178         this.mechanism = mechanism;
179         this.pParameter = pParameter;
180     }
181 
182     /**
183      * Returns the string representation of CK_MECHANISM.
184      *
185      * @return the string representation of CK_MECHANISM
186      */
187     public String toString() {
188         StringBuilder sb = new StringBuilder();
189 
190         sb.append(Constants.INDENT);
191         sb.append(&quot;mechanism: &quot;);
192         sb.append(mechanism);
193         sb.append(Constants.NEWLINE);
194 
195         sb.append(Constants.INDENT);
196         sb.append(&quot;pParameter: &quot;);
197         sb.append(pParameter.toString());
198         sb.append(Constants.NEWLINE);
199 
<span class="line-added">200         /*</span>
201         sb.append(Constants.INDENT);
202         sb.append(&quot;ulParameterLen: ??&quot;);
<span class="line-modified">203         sb.append(Constants.NEWLINE);</span>
<span class="line-modified">204         */</span>
<span class="line-modified">205         if (pHandle != 0L) {</span>
<span class="line-added">206             sb.append(Constants.INDENT);</span>
<span class="line-added">207             sb.append(&quot;pHandle: &quot;);</span>
<span class="line-added">208             sb.append(pHandle);</span>
<span class="line-added">209             sb.append(Constants.NEWLINE);</span>
<span class="line-added">210         }</span>
211         return sb.toString() ;
212     }

213 }
</pre>
</td>
</tr>
</table>
<center><a href="../SunPKCS11.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="CK_RSA_PKCS_PSS_PARAMS.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>