<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.crypto.cryptoki/share/classes/sun/security/pkcs11/SunPKCS11.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="P11Util.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="wrapper/CK_MECHANISM.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.crypto.cryptoki/share/classes/sun/security/pkcs11/SunPKCS11.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 60,11 ***</span>
  public final class SunPKCS11 extends AuthProvider {
  
      private static final long serialVersionUID = -1354835039035306505L;
  
      static final Debug debug = Debug.getInstance(&quot;sunpkcs11&quot;);
<span class="line-removed">- </span>
      // the PKCS11 object through which we make the native calls
      final PKCS11 p11;
  
      // configuration information
      final Config config;
<span class="line-new-header">--- 60,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 514,11 ***</span>
<span class="line-new-header">--- 513,13 ---</span>
          String P11DHKeyFactory     = &quot;sun.security.pkcs11.P11DHKeyFactory&quot;;
          String P11KeyAgreement     = &quot;sun.security.pkcs11.P11KeyAgreement&quot;;
          String P11SecretKeyFactory = &quot;sun.security.pkcs11.P11SecretKeyFactory&quot;;
          String P11Cipher           = &quot;sun.security.pkcs11.P11Cipher&quot;;
          String P11RSACipher        = &quot;sun.security.pkcs11.P11RSACipher&quot;;
<span class="line-added">+         String P11AEADCipher       = &quot;sun.security.pkcs11.P11AEADCipher&quot;;</span>
          String P11Signature        = &quot;sun.security.pkcs11.P11Signature&quot;;
<span class="line-added">+         String P11PSSSignature     = &quot;sun.security.pkcs11.P11PSSSignature&quot;;</span>
  
          // XXX register all aliases
  
          d(MD, &quot;MD2&quot;,            P11Digest,
                  m(CKM_MD2));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 538,10 ***</span>
<span class="line-new-header">--- 539,16 ---</span>
                  s(&quot;2.16.840.1.101.3.4.2.2&quot;, &quot;OID.2.16.840.1.101.3.4.2.2&quot;),
                  m(CKM_SHA384));
          d(MD, &quot;SHA-512&quot;,        P11Digest,
                  s(&quot;2.16.840.1.101.3.4.2.3&quot;, &quot;OID.2.16.840.1.101.3.4.2.3&quot;),
                  m(CKM_SHA512));
<span class="line-added">+         d(MD, &quot;SHA-512/224&quot;,        P11Digest,</span>
<span class="line-added">+                 s(&quot;2.16.840.1.101.3.4.2.5&quot;, &quot;OID.2.16.840.1.101.3.4.2.5&quot;),</span>
<span class="line-added">+                 m(CKM_SHA512_224));</span>
<span class="line-added">+         d(MD, &quot;SHA-512/256&quot;,        P11Digest,</span>
<span class="line-added">+                 s(&quot;2.16.840.1.101.3.4.2.6&quot;, &quot;OID.2.16.840.1.101.3.4.2.6&quot;),</span>
<span class="line-added">+                 m(CKM_SHA512_256));</span>
  
          d(MAC, &quot;HmacMD5&quot;,       P11MAC,
                  m(CKM_MD5_HMAC));
          d(MAC, &quot;HmacSHA1&quot;,      P11MAC,
                  s(&quot;1.2.840.113549.2.7&quot;, &quot;OID.1.2.840.113549.2.7&quot;),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 556,17 ***</span>
<span class="line-new-header">--- 563,26 ---</span>
                  s(&quot;1.2.840.113549.2.10&quot;, &quot;OID.1.2.840.113549.2.10&quot;),
                  m(CKM_SHA384_HMAC));
          d(MAC, &quot;HmacSHA512&quot;,    P11MAC,
                  s(&quot;1.2.840.113549.2.11&quot;, &quot;OID.1.2.840.113549.2.11&quot;),
                  m(CKM_SHA512_HMAC));
<span class="line-added">+         d(MAC, &quot;HmacSHA512/224&quot;,    P11MAC,</span>
<span class="line-added">+                 s(&quot;1.2.840.113549.2.12&quot;, &quot;OID.1.2.840.113549.2.12&quot;),</span>
<span class="line-added">+                 m(CKM_SHA512_224_HMAC));</span>
<span class="line-added">+         d(MAC, &quot;HmacSHA512/256&quot;,    P11MAC,</span>
<span class="line-added">+                 s(&quot;1.2.840.113549.2.13&quot;, &quot;OID.1.2.840.113549.2.13&quot;),</span>
<span class="line-added">+                 m(CKM_SHA512_256_HMAC));</span>
<span class="line-added">+ </span>
          d(MAC, &quot;SslMacMD5&quot;,     P11MAC,
                  m(CKM_SSL3_MD5_MAC));
          d(MAC, &quot;SslMacSHA1&quot;,    P11MAC,
                  m(CKM_SSL3_SHA1_MAC));
  
          d(KPG, &quot;RSA&quot;,           P11KeyPairGenerator,
<span class="line-added">+                 s(&quot;1.2.840.113549.1.1&quot;, &quot;OID.1.2.840.113549.1.1&quot;),</span>
                  m(CKM_RSA_PKCS_KEY_PAIR_GEN));
<span class="line-added">+ </span>
          d(KPG, &quot;DSA&quot;,           P11KeyPairGenerator,
                  s(&quot;1.3.14.3.2.12&quot;, &quot;1.2.840.10040.4.1&quot;, &quot;OID.1.2.840.10040.4.1&quot;),
                  m(CKM_DSA_KEY_PAIR_GEN));
          d(KPG, &quot;DH&quot;,            P11KeyPairGenerator,    s(&quot;DiffieHellman&quot;),
                  m(CKM_DH_PKCS_KEY_PAIR_GEN));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 585,10 ***</span>
<span class="line-new-header">--- 601,11 ---</span>
                  m(CKM_BLOWFISH_KEY_GEN));
  
          // register (Secret)KeyFactories if there are any mechanisms
          // for a particular algorithm that we support
          d(KF, &quot;RSA&quot;,            P11RSAKeyFactory,
<span class="line-added">+                 s(&quot;1.2.840.113549.1.1&quot;, &quot;OID.1.2.840.113549.1.1&quot;),</span>
                  m(CKM_RSA_PKCS_KEY_PAIR_GEN, CKM_RSA_PKCS, CKM_RSA_X_509));
          d(KF, &quot;DSA&quot;,            P11DSAKeyFactory,
                  s(&quot;1.3.14.3.2.12&quot;, &quot;1.2.840.10040.4.1&quot;, &quot;OID.1.2.840.10040.4.1&quot;),
                  m(CKM_DSA_KEY_PAIR_GEN, CKM_DSA, CKM_DSA_SHA1));
          d(KF, &quot;DH&quot;,             P11DHKeyFactory,        s(&quot;DiffieHellman&quot;),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 598,14 ***</span>
                      CKM_ECDSA, CKM_ECDSA_SHA1));
  
          // AlgorithmParameters for EC.
          // Only needed until we have an EC implementation in the SUN provider.
          d(AGP, &quot;EC&quot;,            &quot;sun.security.util.ECParameters&quot;,
<span class="line-modified">!                                                 s(&quot;1.2.840.10045.2.1&quot;),</span>
                  m(CKM_EC_KEY_PAIR_GEN, CKM_ECDH1_DERIVE,
                      CKM_ECDSA, CKM_ECDSA_SHA1));
  
          d(KA, &quot;DH&quot;,             P11KeyAgreement,        s(&quot;DiffieHellman&quot;),
                  m(CKM_DH_PKCS_DERIVE));
          d(KA, &quot;ECDH&quot;,           &quot;sun.security.pkcs11.P11ECDHKeyAgreement&quot;,
                  m(CKM_ECDH1_DERIVE));
  
<span class="line-new-header">--- 615,18 ---</span>
                      CKM_ECDSA, CKM_ECDSA_SHA1));
  
          // AlgorithmParameters for EC.
          // Only needed until we have an EC implementation in the SUN provider.
          d(AGP, &quot;EC&quot;,            &quot;sun.security.util.ECParameters&quot;,
<span class="line-modified">!                 s(&quot;1.2.840.10045.2.1&quot;),</span>
                  m(CKM_EC_KEY_PAIR_GEN, CKM_ECDH1_DERIVE,
                      CKM_ECDSA, CKM_ECDSA_SHA1));
  
<span class="line-added">+ </span>
<span class="line-added">+         d(AGP, &quot;GCM&quot;,            &quot;sun.security.util.GCMParameters&quot;,</span>
<span class="line-added">+                 m(CKM_AES_GCM));</span>
<span class="line-added">+ </span>
          d(KA, &quot;DH&quot;,             P11KeyAgreement,        s(&quot;DiffieHellman&quot;),
                  m(CKM_DH_PKCS_DERIVE));
          d(KA, &quot;ECDH&quot;,           &quot;sun.security.pkcs11.P11ECDHKeyAgreement&quot;,
                  m(CKM_ECDH1_DERIVE));
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 667,16 ***</span>
                  m(CKM_AES_ECB));
          d(CIP, &quot;AES/ECB/PKCS5Padding&quot;,          P11Cipher,      s(&quot;AES&quot;),
                  m(CKM_AES_ECB));
          d(CIP, &quot;AES/CTR/NoPadding&quot;,             P11Cipher,
                  m(CKM_AES_CTR));
          d(CIP, &quot;Blowfish/CBC/NoPadding&quot;,        P11Cipher,
                  m(CKM_BLOWFISH_CBC));
          d(CIP, &quot;Blowfish/CBC/PKCS5Padding&quot;,     P11Cipher,
                  m(CKM_BLOWFISH_CBC));
  
<span class="line-removed">-         // XXX RSA_X_509, RSA_OAEP not yet supported</span>
          d(CIP, &quot;RSA/ECB/PKCS1Padding&quot;,          P11RSACipher,   s(&quot;RSA&quot;),
                  m(CKM_RSA_PKCS));
          d(CIP, &quot;RSA/ECB/NoPadding&quot;,             P11RSACipher,
                  m(CKM_RSA_X_509));
  
<span class="line-new-header">--- 688,28 ---</span>
                  m(CKM_AES_ECB));
          d(CIP, &quot;AES/ECB/PKCS5Padding&quot;,          P11Cipher,      s(&quot;AES&quot;),
                  m(CKM_AES_ECB));
          d(CIP, &quot;AES/CTR/NoPadding&quot;,             P11Cipher,
                  m(CKM_AES_CTR));
<span class="line-added">+ </span>
<span class="line-added">+         d(CIP, &quot;AES/GCM/NoPadding&quot;,             P11AEADCipher,</span>
<span class="line-added">+                 m(CKM_AES_GCM));</span>
<span class="line-added">+         d(CIP, &quot;AES_128/GCM/NoPadding&quot;,          P11AEADCipher,</span>
<span class="line-added">+                 s(&quot;2.16.840.1.101.3.4.1.6&quot;, &quot;OID.2.16.840.1.101.3.4.1.6&quot;),</span>
<span class="line-added">+                 m(CKM_AES_GCM));</span>
<span class="line-added">+         d(CIP, &quot;AES_192/GCM/NoPadding&quot;,          P11AEADCipher,</span>
<span class="line-added">+                 s(&quot;2.16.840.1.101.3.4.1.26&quot;, &quot;OID.2.16.840.1.101.3.4.1.26&quot;),</span>
<span class="line-added">+                 m(CKM_AES_GCM));</span>
<span class="line-added">+         d(CIP, &quot;AES_256/GCM/NoPadding&quot;,          P11AEADCipher,</span>
<span class="line-added">+                 s(&quot;2.16.840.1.101.3.4.1.46&quot;, &quot;OID.2.16.840.1.101.3.4.1.46&quot;),</span>
<span class="line-added">+                 m(CKM_AES_GCM));</span>
<span class="line-added">+ </span>
          d(CIP, &quot;Blowfish/CBC/NoPadding&quot;,        P11Cipher,
                  m(CKM_BLOWFISH_CBC));
          d(CIP, &quot;Blowfish/CBC/PKCS5Padding&quot;,     P11Cipher,
                  m(CKM_BLOWFISH_CBC));
  
          d(CIP, &quot;RSA/ECB/PKCS1Padding&quot;,          P11RSACipher,   s(&quot;RSA&quot;),
                  m(CKM_RSA_PKCS));
          d(CIP, &quot;RSA/ECB/NoPadding&quot;,             P11RSACipher,
                  m(CKM_RSA_X_509));
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 684,16 ***</span>
<span class="line-new-header">--- 717,29 ---</span>
                  m(CKM_DSA));
          d(SIG, &quot;DSA&quot;,           P11Signature,
                  s(&quot;SHA1withDSA&quot;, &quot;1.3.14.3.2.13&quot;, &quot;1.3.14.3.2.27&quot;,
                    &quot;1.2.840.10040.4.3&quot;, &quot;OID.1.2.840.10040.4.3&quot;),
                  m(CKM_DSA_SHA1, CKM_DSA));
<span class="line-added">+         d(SIG, &quot;SHA224withDSA&quot;, P11Signature,</span>
<span class="line-added">+                 s(&quot;2.16.840.1.101.3.4.3.1&quot;, &quot;OID.2.16.840.1.101.3.4.3.1&quot;),</span>
<span class="line-added">+                 m(CKM_DSA_SHA224));</span>
<span class="line-added">+         d(SIG, &quot;SHA256withDSA&quot;, P11Signature,</span>
<span class="line-added">+                 s(&quot;2.16.840.1.101.3.4.3.2&quot;, &quot;OID.2.16.840.1.101.3.4.3.2&quot;),</span>
<span class="line-added">+                 m(CKM_DSA_SHA256));</span>
<span class="line-added">+         d(SIG, &quot;SHA384withDSA&quot;, P11Signature,</span>
<span class="line-added">+                 s(&quot;2.16.840.1.101.3.4.3.3&quot;, &quot;OID.2.16.840.1.101.3.4.3.3&quot;),</span>
<span class="line-added">+                 m(CKM_DSA_SHA384));</span>
<span class="line-added">+         d(SIG, &quot;SHA512withDSA&quot;, P11Signature,</span>
<span class="line-added">+                 s(&quot;2.16.840.1.101.3.4.3.4&quot;, &quot;OID.2.16.840.1.101.3.4.3.4&quot;),</span>
<span class="line-added">+                 m(CKM_DSA_SHA512));</span>
          d(SIG, &quot;RawDSAinP1363Format&quot;,   P11Signature,
                  s(&quot;NONEwithDSAinP1363Format&quot;),
                  m(CKM_DSA));
          d(SIG, &quot;DSAinP1363Format&quot;,      P11Signature,
                  s(&quot;SHA1withDSAinP1363Format&quot;),
                  m(CKM_DSA_SHA1, CKM_DSA));
<span class="line-added">+ </span>
          d(SIG, &quot;NONEwithECDSA&quot;, P11Signature,
                  m(CKM_ECDSA));
          d(SIG, &quot;SHA1withECDSA&quot;, P11Signature,
                  s(&quot;ECDSA&quot;, &quot;1.2.840.10045.4.1&quot;, &quot;OID.1.2.840.10045.4.1&quot;),
                  m(CKM_ECDSA_SHA1, CKM_ECDSA));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 741,10 ***</span>
<span class="line-new-header">--- 787,23 ---</span>
                  s(&quot;1.2.840.113549.1.1.12&quot;, &quot;OID.1.2.840.113549.1.1.12&quot;),
                  m(CKM_SHA384_RSA_PKCS, CKM_RSA_PKCS, CKM_RSA_X_509));
          d(SIG, &quot;SHA512withRSA&quot;, P11Signature,
                  s(&quot;1.2.840.113549.1.1.13&quot;, &quot;OID.1.2.840.113549.1.1.13&quot;),
                  m(CKM_SHA512_RSA_PKCS, CKM_RSA_PKCS, CKM_RSA_X_509));
<span class="line-added">+         d(SIG, &quot;RSASSA-PSS&quot;, P11PSSSignature,</span>
<span class="line-added">+                 s(&quot;1.2.840.113549.1.1.10&quot;, &quot;OID.1.2.840.113549.1.1.10&quot;),</span>
<span class="line-added">+                 m(CKM_RSA_PKCS_PSS));</span>
<span class="line-added">+         d(SIG, &quot;SHA1withRSASSA-PSS&quot;, P11PSSSignature,</span>
<span class="line-added">+                 m(CKM_SHA1_RSA_PKCS_PSS));</span>
<span class="line-added">+         d(SIG, &quot;SHA224withRSASSA-PSS&quot;, P11PSSSignature,</span>
<span class="line-added">+                 m(CKM_SHA224_RSA_PKCS_PSS));</span>
<span class="line-added">+         d(SIG, &quot;SHA256withRSASSA-PSS&quot;, P11PSSSignature,</span>
<span class="line-added">+                 m(CKM_SHA256_RSA_PKCS_PSS));</span>
<span class="line-added">+         d(SIG, &quot;SHA384withRSASSA-PSS&quot;, P11PSSSignature,</span>
<span class="line-added">+                 m(CKM_SHA384_RSA_PKCS_PSS));</span>
<span class="line-added">+         d(SIG, &quot;SHA512withRSASSA-PSS&quot;, P11PSSSignature,</span>
<span class="line-added">+                 m(CKM_SHA512_RSA_PKCS_PSS));</span>
  
          d(KG, &quot;SunTlsRsaPremasterSecret&quot;,
                      &quot;sun.security.pkcs11.P11TlsRsaPremasterSecretGenerator&quot;,
                      s(&quot;SunTls12RsaPremasterSecret&quot;),
                  m(CKM_SSL3_PRE_MASTER_KEY_GEN, CKM_TLS_PRE_MASTER_KEY_GEN));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 851,10 ***</span>
<span class="line-new-header">--- 910,29 ---</span>
              }
          });
          createPoller();
      }
  
<span class="line-added">+     private static boolean isLegacy(CK_MECHANISM_INFO mechInfo)</span>
<span class="line-added">+             throws PKCS11Exception {</span>
<span class="line-added">+         // assume full support if no mech info available</span>
<span class="line-added">+         // For vendor-specific mechanisms, often no mech info is provided</span>
<span class="line-added">+         boolean partialSupport = false;</span>
<span class="line-added">+ </span>
<span class="line-added">+         if (mechInfo != null) {</span>
<span class="line-added">+             if ((mechInfo.flags &amp; CKF_DECRYPT) != 0) {</span>
<span class="line-added">+                 // non-legacy cipher mechs should support encryption</span>
<span class="line-added">+                 partialSupport |= ((mechInfo.flags &amp; CKF_ENCRYPT) == 0);</span>
<span class="line-added">+             }</span>
<span class="line-added">+             if ((mechInfo.flags &amp; CKF_VERIFY) != 0) {</span>
<span class="line-added">+                 // non-legacy signature mechs should support signing</span>
<span class="line-added">+                 partialSupport |= ((mechInfo.flags &amp; CKF_SIGN) == 0);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+         return partialSupport;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      // test if a token is present and initialize this provider for it if so.
      // does nothing if no token is found
      // called from constructor and by poller
      private void initToken(CK_SLOT_INFO slotInfo) throws PKCS11Exception {
          if (slotInfo == null) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 884,28 ***</span>
          // could be mapped to CKM_DES_CBC_PAD or CKM_DES_CBC.  Prefer
          // the earliest entry.  When asked for &quot;DES/CBC/PKCS5Padding&quot;, we
          // return a CKM_DES_CBC_PAD.
          final Map&lt;Descriptor,Integer&gt; supportedAlgs =
                                          new HashMap&lt;Descriptor,Integer&gt;();
          for (int i = 0; i &lt; supportedMechanisms.length; i++) {
              long longMech = supportedMechanisms[i];
<span class="line-modified">!             boolean isEnabled = config.isEnabled(longMech);</span>
              if (showInfo) {
<span class="line-removed">-                 CK_MECHANISM_INFO mechInfo =</span>
<span class="line-removed">-                         p11.C_GetMechanismInfo(slotID, longMech);</span>
                  System.out.println(&quot;Mechanism &quot; +
<span class="line-modified">!                         Functions.getMechanismName(longMech) + &quot;:&quot;);</span>
<span class="line-modified">!                 if (isEnabled == false) {</span>
                      System.out.println(&quot;DISABLED in configuration&quot;);
                  }
<span class="line-modified">!                 System.out.println(mechInfo);</span>
              }
<span class="line-modified">!             if (isEnabled == false) {</span>
                  continue;
              }
              // we do not know of mechs with the upper 32 bits set
              if (longMech &gt;&gt;&gt; 32 != 0) {
                  continue;
              }
              int mech = (int)longMech;
              Integer integerMech = Integer.valueOf(mech);
              List&lt;Descriptor&gt; ds = descriptors.get(integerMech);
<span class="line-new-header">--- 962,39 ---</span>
          // could be mapped to CKM_DES_CBC_PAD or CKM_DES_CBC.  Prefer
          // the earliest entry.  When asked for &quot;DES/CBC/PKCS5Padding&quot;, we
          // return a CKM_DES_CBC_PAD.
          final Map&lt;Descriptor,Integer&gt; supportedAlgs =
                                          new HashMap&lt;Descriptor,Integer&gt;();
<span class="line-added">+ </span>
          for (int i = 0; i &lt; supportedMechanisms.length; i++) {
              long longMech = supportedMechanisms[i];
<span class="line-modified">!             CK_MECHANISM_INFO mechInfo = token.getMechanismInfo(longMech);</span>
              if (showInfo) {
                  System.out.println(&quot;Mechanism &quot; +
<span class="line-modified">!                     Functions.getMechanismName(longMech) + &quot;:&quot;);</span>
<span class="line-modified">!                 System.out.println(mechInfo == null?</span>
<span class="line-added">+                     (Constants.INDENT + &quot;info n/a&quot;) :</span>
<span class="line-added">+                     mechInfo);</span>
<span class="line-added">+             }</span>
<span class="line-added">+             if (!config.isEnabled(longMech)) {</span>
<span class="line-added">+                 if (showInfo) {</span>
                      System.out.println(&quot;DISABLED in configuration&quot;);
                  }
<span class="line-modified">!                 continue;</span>
              }
<span class="line-modified">!             if (isLegacy(mechInfo)) {</span>
<span class="line-added">+                 if (showInfo) {</span>
<span class="line-added">+                     System.out.println(&quot;DISABLED due to legacy&quot;);</span>
<span class="line-added">+                 }</span>
                  continue;
              }
<span class="line-added">+ </span>
              // we do not know of mechs with the upper 32 bits set
              if (longMech &gt;&gt;&gt; 32 != 0) {
<span class="line-added">+                 if (showInfo) {</span>
<span class="line-added">+                     System.out.println(&quot;DISABLED due to unknown mech value&quot;);</span>
<span class="line-added">+                 }</span>
                  continue;
              }
              int mech = (int)longMech;
              Integer integerMech = Integer.valueOf(mech);
              List&lt;Descriptor&gt; ds = descriptors.get(integerMech);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1006,15 ***</span>
              if (type == MD) {
                  return new P11Digest(token, algorithm, mechanism);
              } else if (type == CIP) {
                  if (algorithm.startsWith(&quot;RSA&quot;)) {
                      return new P11RSACipher(token, algorithm, mechanism);
                  } else {
                      return new P11Cipher(token, algorithm, mechanism);
                  }
              } else if (type == SIG) {
<span class="line-modified">!                 return new P11Signature(token, algorithm, mechanism);</span>
              } else if (type == MAC) {
                  return new P11Mac(token, algorithm, mechanism);
              } else if (type == KPG) {
                  return new P11KeyPairGenerator(token, algorithm, mechanism);
              } else if (type == KA) {
<span class="line-new-header">--- 1095,21 ---</span>
              if (type == MD) {
                  return new P11Digest(token, algorithm, mechanism);
              } else if (type == CIP) {
                  if (algorithm.startsWith(&quot;RSA&quot;)) {
                      return new P11RSACipher(token, algorithm, mechanism);
<span class="line-added">+                 } else if (algorithm.endsWith(&quot;GCM/NoPadding&quot;)) {</span>
<span class="line-added">+                     return new P11AEADCipher(token, algorithm, mechanism);</span>
                  } else {
                      return new P11Cipher(token, algorithm, mechanism);
                  }
              } else if (type == SIG) {
<span class="line-modified">!                 if (algorithm.indexOf(&quot;RSASSA-PSS&quot;) != -1) {</span>
<span class="line-added">+                     return new P11PSSSignature(token, algorithm, mechanism);</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     return new P11Signature(token, algorithm, mechanism);</span>
<span class="line-added">+                 }</span>
              } else if (type == MAC) {
                  return new P11Mac(token, algorithm, mechanism);
              } else if (type == KPG) {
                  return new P11KeyPairGenerator(token, algorithm, mechanism);
              } else if (type == KA) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1049,11 ***</span>
              } else if (type == SR) {
                  return token.getRandom();
              } else if (type == KS) {
                  return token.getKeyStore();
              } else if (type == AGP) {
<span class="line-modified">!                 return new sun.security.util.ECParameters();</span>
              } else {
                  throw new NoSuchAlgorithmException(&quot;Unknown type: &quot; + type);
              }
          }
  
<span class="line-new-header">--- 1144,18 ---</span>
              } else if (type == SR) {
                  return token.getRandom();
              } else if (type == KS) {
                  return token.getKeyStore();
              } else if (type == AGP) {
<span class="line-modified">!                 if (algorithm == &quot;EC&quot;) {</span>
<span class="line-added">+                     return new sun.security.util.ECParameters();</span>
<span class="line-added">+                 } else if (algorithm == &quot;GCM&quot;) {</span>
<span class="line-added">+                     return new sun.security.util.GCMParameters();</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     throw new NoSuchAlgorithmException(&quot;Unsupported algorithm: &quot;</span>
<span class="line-added">+                             + algorithm);</span>
<span class="line-added">+                 }</span>
              } else {
                  throw new NoSuchAlgorithmException(&quot;Unknown type: &quot; + type);
              }
          }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1068,11 ***</span>
              String type = getType();
              Key key = (Key)param;
              String keyAlgorithm = key.getAlgorithm();
              // RSA signatures and cipher
              if (((type == CIP) &amp;&amp; algorithm.startsWith(&quot;RSA&quot;))
<span class="line-modified">!                     || (type == SIG) &amp;&amp; algorithm.endsWith(&quot;RSA&quot;)) {</span>
                  if (keyAlgorithm.equals(&quot;RSA&quot;) == false) {
                      return false;
                  }
                  return isLocalKey(key)
                          || (key instanceof RSAPrivateKey)
<span class="line-new-header">--- 1170,11 ---</span>
              String type = getType();
              Key key = (Key)param;
              String keyAlgorithm = key.getAlgorithm();
              // RSA signatures and cipher
              if (((type == CIP) &amp;&amp; algorithm.startsWith(&quot;RSA&quot;))
<span class="line-modified">!                     || (type == SIG) &amp;&amp; (algorithm.indexOf(&quot;RSA&quot;) != -1)) {</span>
                  if (keyAlgorithm.equals(&quot;RSA&quot;) == false) {
                      return false;
                  }
                  return isLocalKey(key)
                          || (key instanceof RSAPrivateKey)
</pre>
<center><a href="P11Util.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="wrapper/CK_MECHANISM.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>