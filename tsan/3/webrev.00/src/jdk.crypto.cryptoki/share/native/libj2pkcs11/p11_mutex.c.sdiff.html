<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.crypto.cryptoki/share/native/libj2pkcs11/p11_mutex.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="p11_keymgmt.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="p11_objmgmt.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.crypto.cryptoki/share/native/libj2pkcs11/p11_mutex.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 
  5 /* Copyright  (c) 2002 Graz University of Technology. All rights reserved.
  6  *
  7  * Redistribution and use in  source and binary forms, with or without
  8  * modification, are permitted  provided that the following conditions are met:
  9  *
 10  * 1. Redistributions of  source code must retain the above copyright notice,
 11  *    this list of conditions and the following disclaimer.
 12  *
 13  * 2. Redistributions in  binary form must reproduce the above copyright notice,
 14  *    this list of conditions and the following disclaimer in the documentation
 15  *    and/or other materials provided with the distribution.
 16  *
 17  * 3. The end-user documentation included with the redistribution, if any, must
 18  *    include the following acknowledgment:
 19  *
 20  *    &quot;This product includes software developed by IAIK of Graz University of
 21  *     Technology.&quot;
 22  *
</pre>
<hr />
<pre>
164 #endif /* NO_CALLBACKS */
165 
166     /* convert and set the flags field */
167     fieldID = (*env)-&gt;GetFieldID(env, jInitArgsClass, &quot;flags&quot;, &quot;J&quot;);
168     if (fieldID == NULL) {
169         free(ckpInitArgs);
170         return NULL;
171     }
172     jFlags = (*env)-&gt;GetLongField(env, jInitArgs, fieldID);
173     ckpInitArgs-&gt;flags = jLongToCKULong(jFlags);
174 
175     /* pReserved should be NULL_PTR in this version */
176     fieldID = (*env)-&gt;GetFieldID(env, jInitArgsClass, &quot;pReserved&quot;, &quot;Ljava/lang/Object;&quot;);
177     if (fieldID == NULL) {
178         free(ckpInitArgs);
179         return NULL;
180     }
181     jReserved = (*env)-&gt;GetObjectField(env, jInitArgs, fieldID);
182 
183     /* we try to convert the reserved parameter also */
<span class="line-modified">184     jObjectToPrimitiveCKObjectPtrPtr(env, jReserved, &amp;(ckpInitArgs-&gt;pReserved), &amp;ckReservedLength);</span>
185 
186     return ckpInitArgs ;
187 }
188 
189 #ifndef NO_CALLBACKS
190 
191 /*
192  * is the function that gets called by PKCS#11 to create a mutex and calls the Java
193  * CreateMutex function
194  *
195  * @param env - used to call JNI funktions to get the Java classes, objects, methods and fields
196  * @param ppMutex - the new created mutex
197  * @return - should return CKR_OK if the mutex creation was ok
198  */
199 CK_RV callJCreateMutex(CK_VOID_PTR_PTR ppMutex)
200 {
201     extern JavaVM *jvm;
202     JNIEnv *env;
203     jint returnValue;
204     jthrowable pkcs11Exception;
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 
  5 /* Copyright  (c) 2002 Graz University of Technology. All rights reserved.
  6  *
  7  * Redistribution and use in  source and binary forms, with or without
  8  * modification, are permitted  provided that the following conditions are met:
  9  *
 10  * 1. Redistributions of  source code must retain the above copyright notice,
 11  *    this list of conditions and the following disclaimer.
 12  *
 13  * 2. Redistributions in  binary form must reproduce the above copyright notice,
 14  *    this list of conditions and the following disclaimer in the documentation
 15  *    and/or other materials provided with the distribution.
 16  *
 17  * 3. The end-user documentation included with the redistribution, if any, must
 18  *    include the following acknowledgment:
 19  *
 20  *    &quot;This product includes software developed by IAIK of Graz University of
 21  *     Technology.&quot;
 22  *
</pre>
<hr />
<pre>
164 #endif /* NO_CALLBACKS */
165 
166     /* convert and set the flags field */
167     fieldID = (*env)-&gt;GetFieldID(env, jInitArgsClass, &quot;flags&quot;, &quot;J&quot;);
168     if (fieldID == NULL) {
169         free(ckpInitArgs);
170         return NULL;
171     }
172     jFlags = (*env)-&gt;GetLongField(env, jInitArgs, fieldID);
173     ckpInitArgs-&gt;flags = jLongToCKULong(jFlags);
174 
175     /* pReserved should be NULL_PTR in this version */
176     fieldID = (*env)-&gt;GetFieldID(env, jInitArgsClass, &quot;pReserved&quot;, &quot;Ljava/lang/Object;&quot;);
177     if (fieldID == NULL) {
178         free(ckpInitArgs);
179         return NULL;
180     }
181     jReserved = (*env)-&gt;GetObjectField(env, jInitArgs, fieldID);
182 
183     /* we try to convert the reserved parameter also */
<span class="line-modified">184     ckpInitArgs-&gt;pReserved = jObjectToPrimitiveCKObjectPtr(env, jReserved, &amp;ckReservedLength);</span>
185 
186     return ckpInitArgs ;
187 }
188 
189 #ifndef NO_CALLBACKS
190 
191 /*
192  * is the function that gets called by PKCS#11 to create a mutex and calls the Java
193  * CreateMutex function
194  *
195  * @param env - used to call JNI funktions to get the Java classes, objects, methods and fields
196  * @param ppMutex - the new created mutex
197  * @return - should return CKR_OK if the mutex creation was ok
198  */
199 CK_RV callJCreateMutex(CK_VOID_PTR_PTR ppMutex)
200 {
201     extern JavaVM *jvm;
202     JNIEnv *env;
203     jint returnValue;
204     jthrowable pkcs11Exception;
</pre>
</td>
</tr>
</table>
<center><a href="p11_keymgmt.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="p11_objmgmt.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>