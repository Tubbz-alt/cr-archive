<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.crypto.cryptoki/unix/native/libj2pkcs11/p11_md.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../share/native/libj2pkcs11/pkcs11wrapper.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="p11_md.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.crypto.cryptoki/unix/native/libj2pkcs11/p11_md.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 92         return;
 93     }
 94     TRACE1(&quot;DEBUG: connect to PKCS#11 module: %s ... &quot;, libraryNameStr);
 95 
 96 
 97     /*
 98      * Load the PKCS #11 DLL
 99      */
100     dlerror(); /* clear any old error message not fetched */
101 #ifdef DEBUG
102     hModule = dlopen(libraryNameStr, RTLD_NOW);
103 #else
104     hModule = dlopen(libraryNameStr, RTLD_LAZY);
105 #endif /* DEBUG */
106 
107     if (hModule == NULL) {
108         systemErrorMessage = dlerror();
109         exceptionMessage = (char *) malloc(sizeof(char) * (strlen(systemErrorMessage) + strlen(libraryNameStr) + 1));
110         if (exceptionMessage == NULL) {
111             throwOutOfMemoryError(env, 0);

112             return;
113         }
114         strcpy(exceptionMessage, systemErrorMessage);
115         strcat(exceptionMessage, libraryNameStr);
116         throwIOException(env, exceptionMessage);
117         (*env)-&gt;ReleaseStringUTFChars(env, jPkcs11ModulePath, libraryNameStr);
118         free(exceptionMessage);
119         return;
120     }
121 
122     /*
123      * Get function pointer to C_GetFunctionList
124      */
125     dlerror(); /* clear any old error message not fetched */
126     // with the old JAR file jGetFunctionList is null, temporarily check for that
127     if (jGetFunctionList != NULL) {
128         getFunctionListStr = (*env)-&gt;GetStringUTFChars(env, jGetFunctionList, 0);
129         if (getFunctionListStr == NULL) {
130             return;
131         }
</pre>
</td>
<td>
<hr />
<pre>
 92         return;
 93     }
 94     TRACE1(&quot;DEBUG: connect to PKCS#11 module: %s ... &quot;, libraryNameStr);
 95 
 96 
 97     /*
 98      * Load the PKCS #11 DLL
 99      */
100     dlerror(); /* clear any old error message not fetched */
101 #ifdef DEBUG
102     hModule = dlopen(libraryNameStr, RTLD_NOW);
103 #else
104     hModule = dlopen(libraryNameStr, RTLD_LAZY);
105 #endif /* DEBUG */
106 
107     if (hModule == NULL) {
108         systemErrorMessage = dlerror();
109         exceptionMessage = (char *) malloc(sizeof(char) * (strlen(systemErrorMessage) + strlen(libraryNameStr) + 1));
110         if (exceptionMessage == NULL) {
111             throwOutOfMemoryError(env, 0);
<span class="line-added">112             (*env)-&gt;ReleaseStringUTFChars(env, jPkcs11ModulePath, libraryNameStr);</span>
113             return;
114         }
115         strcpy(exceptionMessage, systemErrorMessage);
116         strcat(exceptionMessage, libraryNameStr);
117         throwIOException(env, exceptionMessage);
118         (*env)-&gt;ReleaseStringUTFChars(env, jPkcs11ModulePath, libraryNameStr);
119         free(exceptionMessage);
120         return;
121     }
122 
123     /*
124      * Get function pointer to C_GetFunctionList
125      */
126     dlerror(); /* clear any old error message not fetched */
127     // with the old JAR file jGetFunctionList is null, temporarily check for that
128     if (jGetFunctionList != NULL) {
129         getFunctionListStr = (*env)-&gt;GetStringUTFChars(env, jGetFunctionList, 0);
130         if (getFunctionListStr == NULL) {
131             return;
132         }
</pre>
</td>
</tr>
</table>
<center><a href="../../../share/native/libj2pkcs11/pkcs11wrapper.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="p11_md.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>