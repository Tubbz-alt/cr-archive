<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.jshell/share/classes/jdk/jshell/OuterWrap.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jshell;
 27 
 28 import java.util.Locale;
 29 import javax.tools.Diagnostic;
 30 import javax.tools.JavaFileObject;
 31 import static jdk.jshell.Util.PARSED_LOCALE;
 32 import static jdk.jshell.Util.REPL_CLASS_PREFIX;
 33 import static jdk.jshell.Util.REPL_DOESNOTMATTER_CLASS_NAME;
 34 import static jdk.jshell.Util.REPL_PACKAGE;
 35 import static jdk.jshell.Util.expunge;
 36 
 37 /**
 38  *
 39  * @author Robert Field
 40  */
 41 class OuterWrap implements GeneralWrap {
 42 
 43     protected final Wrap w;
 44 
 45     OuterWrap(Wrap wrap) {
 46         this.w = wrap;
 47     }
 48 
 49     @Override
 50     public final String wrapped() {
 51         return w.wrapped();
 52     }
 53 
 54     @Override
 55     public int snippetIndexToWrapIndex(int ui) {
 56         return w.snippetIndexToWrapIndex(ui);
 57     }
 58 
 59     @Override
 60     public int wrapIndexToSnippetIndex(int si) {
 61         return w.wrapIndexToSnippetIndex(si);
 62     }
 63 
 64     @Override
 65     public int firstSnippetIndex() {
 66         return w.firstSnippetIndex();
 67     }
 68 
 69     @Override
 70     public int lastSnippetIndex() {
 71         return w.lastSnippetIndex();
 72     }
 73 
 74     @Override
 75     public int snippetLineToWrapLine(int snline) {
 76         return w.snippetLineToWrapLine(snline);
 77     }
 78 
 79     @Override
 80     public int wrapLineToSnippetLine(int wline) {
 81         return w.wrapLineToSnippetLine(wline);
 82     }
 83 
 84     @Override
 85     public int firstSnippetLine() {
 86         return w.firstSnippetLine();
 87     }
 88 
 89     @Override
 90     public int lastSnippetLine() {
 91         return w.lastSnippetLine();
 92     }
 93 
 94     public String className() {
 95         return REPL_DOESNOTMATTER_CLASS_NAME;
 96     }
 97 
 98     public String classFullName() {
 99         return REPL_PACKAGE + &quot;.&quot; + className();
100     }
101 
102     @Override
103     public int hashCode() {
104         return className().hashCode();
105     }
106 
107     @Override
108     public boolean equals(Object o) {
109         return (o instanceof OuterWrap)
110                 ? className().equals(((OuterWrap) o).className())
111                 : false;
112     }
113 
114     @Override
115     public String toString() {
116         return &quot;OW(&quot; + w + &quot;)&quot;;
117     }
118 
119     Diag wrapDiag(Diagnostic&lt;? extends JavaFileObject&gt; d) {
120         return new WrappedDiagnostic(d);
121     }
122 
123     class WrappedDiagnostic extends Diag {
124 
125         final Diagnostic&lt;? extends JavaFileObject&gt; diag;
126 
127         WrappedDiagnostic(Diagnostic&lt;? extends JavaFileObject&gt; diag) {
128             this.diag = diag;
129         }
130 
131         @Override
132         public boolean isError() {
133             return diag.getKind() == Diagnostic.Kind.ERROR;
134         }
135 
136         @Override
137         public long getPosition() {
138             return wrapIndexToSnippetIndex(diag.getPosition());
139         }
140 
141         @Override
142         public long getStartPosition() {
143             return wrapIndexToSnippetIndex(diag.getStartPosition());
144         }
145 
146         @Override
147         public long getEndPosition() {
148             return wrapIndexToSnippetIndex(diag.getEndPosition());
149         }
150 
151         @Override
152         public String getCode() {
153             return diag.getCode();
154         }
155 
156         @Override
157         public String getMessage(Locale locale) {
158             return expunge(diag.getMessage(locale));
159         }
160 
161         @Override
162         boolean isResolutionError() {
163             if (!super.isResolutionError()) {
164                 return false;
165             }
166             for (String line : diag.getMessage(PARSED_LOCALE).split(&quot;\\r?\\n&quot;)) {
167                 if (line.trim().startsWith(&quot;location:&quot;)) {
168                     if (!line.contains(REPL_CLASS_PREFIX)) {
169                         // Resolution error must occur within a REPL class or it is not resolvable
170                         return false;
171                     }
172                 }
173             }
174             return true;
175         }
176 
177         @Override
178         public String toString() {
179             return &quot;WrappedDiagnostic(&quot; + getMessage(null) + &quot;:&quot; + getPosition() + &quot;)&quot;;
180         }
181     }
182 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>