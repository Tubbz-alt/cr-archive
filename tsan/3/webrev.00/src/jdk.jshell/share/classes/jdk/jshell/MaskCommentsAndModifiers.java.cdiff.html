<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.jshell/share/classes/jdk/jshell/MaskCommentsAndModifiers.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="ImportSnippet.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="MethodSnippet.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jshell/share/classes/jdk/jshell/MaskCommentsAndModifiers.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 137,55 ***</span>
          for (int cp : s.chars().toArray()) {
              writeMask(cp);
          }
      }
  
      private void next() {
          switch (c) {
<span class="line-removed">-             case &#39;\&#39;&#39;:</span>
              case &#39;&quot;&#39;: {
                  maskModifiers = false;
<span class="line-modified">!                 write(c);</span>
<span class="line-modified">!                 int match = c;</span>
<span class="line-modified">!                 while (read() &gt;= 0 &amp;&amp; c != match &amp;&amp; c != &#39;\n&#39; &amp;&amp; c != &#39;\r&#39;) {</span>
                      write(c);
<span class="line-modified">!                     if (c == &#39;\\&#39;) {</span>
                          write(read());
                      }
                  }
<span class="line-removed">-                 write(c); // write match // line-end</span>
<span class="line-removed">-                 break;</span>
              }
<span class="line-modified">!             case &#39;`&#39;: { // RawString</span>
                  maskModifiers = false;
<span class="line-modified">!                 int backtickCount = 0;</span>
<span class="line-modified">!                 do {</span>
                      write(c);
<span class="line-modified">!                     ++backtickCount;</span>
<span class="line-modified">!                     read();</span>
<span class="line-removed">-                 } while (c == &#39;`&#39;);</span>
<span class="line-removed">-                 while (true) {</span>
<span class="line-removed">-                     if (c == &#39;`&#39;) {</span>
<span class="line-removed">-                         int cnt = 0;</span>
<span class="line-removed">-                         do {</span>
<span class="line-removed">-                             write(c);</span>
<span class="line-removed">-                             ++cnt;</span>
<span class="line-removed">-                             read();</span>
<span class="line-removed">-                         } while (c == &#39;`&#39;);</span>
<span class="line-removed">-                         if (cnt == backtickCount) {</span>
<span class="line-removed">-                             unread();</span>
<span class="line-removed">-                             break;</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                     } else {</span>
<span class="line-removed">-                         write(c);</span>
<span class="line-removed">-                         if (c &lt; 0) {</span>
<span class="line-removed">-                             openToken = true;</span>
<span class="line-removed">-                             break;</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                         read();</span>
                      }
                  }
                  break;
              }
              case &#39;/&#39;:
                  read();
                  switch (c) {
<span class="line-new-header">--- 137,50 ---</span>
          for (int cp : s.chars().toArray()) {
              writeMask(cp);
          }
      }
  
<span class="line-added">+     @SuppressWarnings(&quot;fallthrough&quot;)</span>
      private void next() {
          switch (c) {
              case &#39;&quot;&#39;: {
<span class="line-added">+                 int pos = next - 1;</span>
                  maskModifiers = false;
<span class="line-modified">!                 if (str.startsWith(&quot;\&quot;\&quot;\&quot;&quot;, next - 1)) {</span>
<span class="line-modified">!                     //text block/multi-line string literal:</span>
<span class="line-modified">!                     int searchPoint = next + 2;</span>
<span class="line-added">+                     int end;</span>
<span class="line-added">+                     while ((end = str.indexOf(&quot;\&quot;\&quot;\&quot;&quot;, searchPoint)) != (-1)) {</span>
<span class="line-added">+                         if (str.charAt(end - 1) != &#39;\\&#39;)</span>
<span class="line-added">+                             break;</span>
<span class="line-added">+                         searchPoint = end + 1;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                     if (end == (-1)) {</span>
<span class="line-added">+                         openToken = true;</span>
<span class="line-added">+                         end = str.length();</span>
<span class="line-added">+                     } else {</span>
<span class="line-added">+                         end += 3;</span>
<span class="line-added">+                     }</span>
                      write(c);
<span class="line-modified">!                     while (next &lt; end) {</span>
                          write(read());
                      }
<span class="line-added">+                     break;</span>
                  }
              }
<span class="line-modified">!             //intentional fall-through:</span>
<span class="line-added">+             case &#39;\&#39;&#39;: {</span>
                  maskModifiers = false;
<span class="line-modified">!                 write(c);</span>
<span class="line-modified">!                 int match = c;</span>
<span class="line-added">+                 while (read() &gt;= 0 &amp;&amp; c != match &amp;&amp; c != &#39;\n&#39; &amp;&amp; c != &#39;\r&#39;) {</span>
                      write(c);
<span class="line-modified">!                     if (c == &#39;\\&#39;) {</span>
<span class="line-modified">!                         write(read());</span>
                      }
                  }
<span class="line-added">+                 write(c); // write match // line-end</span>
                  break;
              }
              case &#39;/&#39;:
                  read();
                  switch (c) {
</pre>
<center><a href="ImportSnippet.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="MethodSnippet.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>