<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jshell/share/classes/jdk/jshell/MaskCommentsAndModifiers.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="ImportSnippet.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="MethodSnippet.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jshell/share/classes/jdk/jshell/MaskCommentsAndModifiers.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
122 
123     private void writeMask(int ch) {
124         if (ch != -1) {
125             writeTo(sbMask, ch);
126             writeTo(sbCleared, Character.isWhitespace(ch) ? ch : &#39; &#39;);
127         }
128     }
129 
130     private void write(CharSequence s) {
131         for (int cp : s.chars().toArray()) {
132             write(cp);
133         }
134     }
135 
136     private void writeMask(CharSequence s) {
137         for (int cp : s.chars().toArray()) {
138             writeMask(cp);
139         }
140     }
141 

142     private void next() {
143         switch (c) {
<span class="line-removed">144             case &#39;\&#39;&#39;:</span>
145             case &#39;&quot;&#39;: {

146                 maskModifiers = false;
<span class="line-modified">147                 write(c);</span>
<span class="line-modified">148                 int match = c;</span>
<span class="line-modified">149                 while (read() &gt;= 0 &amp;&amp; c != match &amp;&amp; c != &#39;\n&#39; &amp;&amp; c != &#39;\r&#39;) {</span>












150                     write(c);
<span class="line-modified">151                     if (c == &#39;\\&#39;) {</span>
152                         write(read());
153                     }

154                 }
<span class="line-removed">155                 write(c); // write match // line-end</span>
<span class="line-removed">156                 break;</span>
157             }
<span class="line-modified">158             case &#39;`&#39;: { // RawString</span>

159                 maskModifiers = false;
<span class="line-modified">160                 int backtickCount = 0;</span>
<span class="line-modified">161                 do {</span>

162                     write(c);
<span class="line-modified">163                     ++backtickCount;</span>
<span class="line-modified">164                     read();</span>
<span class="line-removed">165                 } while (c == &#39;`&#39;);</span>
<span class="line-removed">166                 while (true) {</span>
<span class="line-removed">167                     if (c == &#39;`&#39;) {</span>
<span class="line-removed">168                         int cnt = 0;</span>
<span class="line-removed">169                         do {</span>
<span class="line-removed">170                             write(c);</span>
<span class="line-removed">171                             ++cnt;</span>
<span class="line-removed">172                             read();</span>
<span class="line-removed">173                         } while (c == &#39;`&#39;);</span>
<span class="line-removed">174                         if (cnt == backtickCount) {</span>
<span class="line-removed">175                             unread();</span>
<span class="line-removed">176                             break;</span>
<span class="line-removed">177                         }</span>
<span class="line-removed">178                     } else {</span>
<span class="line-removed">179                         write(c);</span>
<span class="line-removed">180                         if (c &lt; 0) {</span>
<span class="line-removed">181                             openToken = true;</span>
<span class="line-removed">182                             break;</span>
<span class="line-removed">183                         }</span>
<span class="line-removed">184                         read();</span>
185                     }
186                 }

187                 break;
188             }
189             case &#39;/&#39;:
190                 read();
191                 switch (c) {
192                     case &#39;*&#39;:
193                         writeMask(&#39;/&#39;);
194                         writeMask(c);
195                         int prevc = 0;
196                         while (read() &gt;= 0 &amp;&amp; (c != &#39;/&#39; || prevc != &#39;*&#39;)) {
197                             writeMask(c);
198                             prevc = c;
199                         }
200                         writeMask(c);
201                         openToken = c &lt; 0;
202                         break;
203                     case &#39;/&#39;:
204                         writeMask(&#39;/&#39;);
205                         writeMask(c);
206                         while (read() &gt;= 0 &amp;&amp; c != &#39;\n&#39; &amp;&amp; c != &#39;\r&#39;) {
</pre>
</td>
<td>
<hr />
<pre>
122 
123     private void writeMask(int ch) {
124         if (ch != -1) {
125             writeTo(sbMask, ch);
126             writeTo(sbCleared, Character.isWhitespace(ch) ? ch : &#39; &#39;);
127         }
128     }
129 
130     private void write(CharSequence s) {
131         for (int cp : s.chars().toArray()) {
132             write(cp);
133         }
134     }
135 
136     private void writeMask(CharSequence s) {
137         for (int cp : s.chars().toArray()) {
138             writeMask(cp);
139         }
140     }
141 
<span class="line-added">142     @SuppressWarnings(&quot;fallthrough&quot;)</span>
143     private void next() {
144         switch (c) {

145             case &#39;&quot;&#39;: {
<span class="line-added">146                 int pos = next - 1;</span>
147                 maskModifiers = false;
<span class="line-modified">148                 if (str.startsWith(&quot;\&quot;\&quot;\&quot;&quot;, next - 1)) {</span>
<span class="line-modified">149                     //text block/multi-line string literal:</span>
<span class="line-modified">150                     int searchPoint = next + 2;</span>
<span class="line-added">151                     int end;</span>
<span class="line-added">152                     while ((end = str.indexOf(&quot;\&quot;\&quot;\&quot;&quot;, searchPoint)) != (-1)) {</span>
<span class="line-added">153                         if (str.charAt(end - 1) != &#39;\\&#39;)</span>
<span class="line-added">154                             break;</span>
<span class="line-added">155                         searchPoint = end + 1;</span>
<span class="line-added">156                     }</span>
<span class="line-added">157                     if (end == (-1)) {</span>
<span class="line-added">158                         openToken = true;</span>
<span class="line-added">159                         end = str.length();</span>
<span class="line-added">160                     } else {</span>
<span class="line-added">161                         end += 3;</span>
<span class="line-added">162                     }</span>
163                     write(c);
<span class="line-modified">164                     while (next &lt; end) {</span>
165                         write(read());
166                     }
<span class="line-added">167                     break;</span>
168                 }


169             }
<span class="line-modified">170             //intentional fall-through:</span>
<span class="line-added">171             case &#39;\&#39;&#39;: {</span>
172                 maskModifiers = false;
<span class="line-modified">173                 write(c);</span>
<span class="line-modified">174                 int match = c;</span>
<span class="line-added">175                 while (read() &gt;= 0 &amp;&amp; c != match &amp;&amp; c != &#39;\n&#39; &amp;&amp; c != &#39;\r&#39;) {</span>
176                     write(c);
<span class="line-modified">177                     if (c == &#39;\\&#39;) {</span>
<span class="line-modified">178                         write(read());</span>




















179                     }
180                 }
<span class="line-added">181                 write(c); // write match // line-end</span>
182                 break;
183             }
184             case &#39;/&#39;:
185                 read();
186                 switch (c) {
187                     case &#39;*&#39;:
188                         writeMask(&#39;/&#39;);
189                         writeMask(c);
190                         int prevc = 0;
191                         while (read() &gt;= 0 &amp;&amp; (c != &#39;/&#39; || prevc != &#39;*&#39;)) {
192                             writeMask(c);
193                             prevc = c;
194                         }
195                         writeMask(c);
196                         openToken = c &lt; 0;
197                         break;
198                     case &#39;/&#39;:
199                         writeMask(&#39;/&#39;);
200                         writeMask(c);
201                         while (read() &gt;= 0 &amp;&amp; c != &#39;\n&#39; &amp;&amp; c != &#39;\r&#39;) {
</pre>
</td>
</tr>
</table>
<center><a href="ImportSnippet.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="MethodSnippet.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>