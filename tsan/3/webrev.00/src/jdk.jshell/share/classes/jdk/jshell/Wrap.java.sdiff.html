<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jshell/share/classes/jdk/jshell/Wrap.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="VarSnippet.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../module-info.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jshell/share/classes/jdk/jshell/Wrap.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jshell;
 27 
 28 import java.util.ArrayList;
 29 import java.util.Arrays;
 30 import java.util.List;
 31 import static java.util.stream.Collectors.joining;
 32 import static jdk.jshell.Util.DOIT_METHOD_NAME;
 33 
 34 /**
 35  * Wrapping of source into Java methods, fields, etc.  All but outer layer
 36  * wrapping with imports and class.
<span class="line-removed"> 37  *</span>
<span class="line-removed"> 38  * @author Robert Field</span>
 39  */
 40 abstract class Wrap implements GeneralWrap {
 41 
 42     private static Wrap methodWrap(String prefix, String source, String suffix) {
 43         Wrap wunit = new NoWrap(source);
 44         return new DoitMethodWrap(new CompoundWrap(prefix, wunit, suffix));
 45     }
 46 
 47     public static Wrap methodWrap(String source) {
 48         return methodWrap(&quot;&quot;, source, semi(source) + &quot;        return null;\n&quot;);
 49     }
 50 
 51     public static Wrap methodReturnWrap(String source) {
 52         return methodWrap(&quot;return &quot;, source, semi(source));
 53     }
 54 
 55     public static Wrap methodUnreachableSemiWrap(String source) {
 56         return methodWrap(&quot;&quot;, source, semi(source));
 57     }
 58 
</pre>
<hr />
<pre>
167         return new CompoundWrap(&quot;    public static\n    &quot;, w);
168     }
169 
170     private static int countLines(String s) {
171         return countLines(s, 0, s.length());
172     }
173 
174     private static int countLines(String s, int from, int toEx) {
175         int cnt = 0;
176         int idx = from;
177         while ((idx = s.indexOf(&#39;\n&#39;, idx)) &gt; 0) {
178             if (idx &gt;= toEx) break;
179             ++cnt;
180             ++idx;
181         }
182         return cnt;
183     }
184 
185     public static final class Range {
186         final int begin;
<span class="line-modified">187         final int end;</span>
188 
189         Range(int begin, int end) {
190             this.begin = begin;
191             this.end = end;
192         }
193 
194         Range(String s) {
195             this.begin = 0;
196             this.end = s.length();
197         }
198 
199         String part(String s) {
200             return s.substring(begin, end);
201         }
202 
203         int length() {
204             return end - begin;
205         }
206 
207         boolean isEmpty() {
208             return end == begin;
209         }
210 
211         void verify(String s) {
212             if (begin &lt; 0 || end &lt;= begin || end &gt; s.length()) {
213                 throw new InternalError(&quot;Bad Range: &quot; + s + &quot;[&quot; + begin + &quot;,&quot; + end + &quot;]&quot;);
214             }
215         }
216 
217         @Override
218         public String toString() {
<span class="line-modified">219             return &quot;Range[&quot; + begin + &quot;,&quot; + end + &quot;]&quot;;</span>
220         }
221     }
222 
223     public static class CompoundWrap extends Wrap {
224 
225         final Object[] os;
226         final String wrapped;
227         final int snidxFirst;
228         final int snidxLast;
229         final int snlineFirst;
230         final int snlineLast;
231 
232         CompoundWrap(Object... os) {
233             this.os = os;
234             int sniFirst = Integer.MAX_VALUE;
235             int sniLast = Integer.MIN_VALUE;
236             int snlnFirst = Integer.MAX_VALUE;
237             int snlnLast = Integer.MIN_VALUE;
238             StringBuilder sb = new StringBuilder();
239             for (Object o : os) {
</pre>
<hr />
<pre>
263             this.snidxFirst = sniFirst;
264             this.snidxLast = sniLast;
265             this.snlineFirst = snlnFirst;
266             this.snlineLast = snlnLast;
267         }
268 
269         @Override
270         public String wrapped() {
271             return wrapped;
272         }
273 
274         @Override
275         public int snippetIndexToWrapIndex(int sni) {
276             int before = 0;
277             for (Object o : os) {
278                 if (o instanceof String) {
279                     String s = (String) o;
280                     before += s.length();
281                 } else if (o instanceof Wrap) {
282                     Wrap w = (Wrap) o;
<span class="line-modified">283                     if (sni &gt;= w.firstSnippetIndex() &amp;&amp; sni &lt;= w.lastSnippetIndex()) {</span>
<span class="line-modified">284                         return w.snippetIndexToWrapIndex(sni) + before;</span>




285                     }
286                     before += w.wrapped().length();
287                 }
288             }
289             return 0;
290         }
291 
292         Wrap wrapIndexToWrap(long wi) {
293             int before = 0;
294             Wrap w = null;
295             for (Object o : os) {
296                 if (o instanceof String) {
297                     String s = (String) o;
298                     before += s.length();
299                 } else if (o instanceof Wrap) {
300                     w = (Wrap) o;
301                     int len = w.wrapped().length();
302                     if ((wi - before) &lt;= len) {
<span class="line-modified">303                         //System.err.printf(&quot;Defer to wrap %s - wi: %d. before; %d   -- %s  &gt;&gt;&gt; %s\n&quot;,</span>
<span class="line-modified">304                         //        w, wi, before, w.debugPos(wi - before), w.wrapped());</span>
305                         return w;
306                     }
307                     before += len;
308                 }
309             }
310             return w;
311         }
312 
313         @Override
314         public int wrapIndexToSnippetIndex(int wi) {
315             int before = 0;
316             for (Object o : os) {
317                 if (o instanceof String) {
318                     String s = (String) o;
319                     before += s.length();
320                 } else if (o instanceof Wrap) {
321                     Wrap w = (Wrap) o;
322                     int len = w.wrapped().length();
323                     if ((wi - before) &lt;= len) {
<span class="line-modified">324                         //System.err.printf(&quot;Defer to wrap %s - wi: %d. before; %d   -- %s  &gt;&gt;&gt; %s\n&quot;,</span>
<span class="line-modified">325                         //        w, wi, before, w.debugPos(wi - before), w.wrapped());</span>
<span class="line-modified">326                         return w.wrapIndexToSnippetIndex(wi - before);</span>

327                     }
328                     before += len;
329                 }
330             }
331             return lastSnippetIndex();
332         }
333 
334         @Override
335         public int firstSnippetIndex() {
336             return snidxFirst;
337         }
338 
339         @Override
340         public int lastSnippetIndex() {
341             return snidxLast;
342         }
343 
344         @Override
345         public int snippetLineToWrapLine(int snline) {
346             int before = 0;
</pre>
<hr />
<pre>
352                     Wrap w = (Wrap) o;
353                     if (snline &gt;= w.firstSnippetLine() &amp;&amp; snline &lt;= w.lastSnippetLine()) {
354                         return w.snippetLineToWrapLine(snline) + before;
355                     }
356                     before += countLines(w.wrapped());
357                 }
358             }
359             return 0;
360         }
361 
362         Wrap wrapLineToWrap(int wline) {
363             int before = 0;
364             Wrap w = null;
365             for (Object o : os) {
366                 if (o instanceof String) {
367                     String s = (String) o;
368                     before += countLines(s);
369                 } else if (o instanceof Wrap) {
370                     w = (Wrap) o;
371                     int lns = countLines(w.wrapped());
<span class="line-modified">372                     if ((wline - before) &lt; lns) {</span>
373                         return w;
374                     }
375                     before += lns;
376                 }
377             }
378             return w;
379         }
380 
381         @Override
382         public int wrapLineToSnippetLine(int wline) {
383             int before = 0;
384             for (Object o : os) {
385                 if (o instanceof String) {
386                     String s = (String) o;
387                     before += countLines(s);
388                 } else if (o instanceof Wrap) {
389                     Wrap w = (Wrap) o;
390                     int lns = countLines(w.wrapped());
<span class="line-modified">391                     if ((wline - before) &lt; lns) {</span>
392                         return w.wrapLineToSnippetLine(wline - before);
393                     }
394                     before += lns;
395                 }
396             }
397             return 0;
398         }
399 
400         @Override
401         public int firstSnippetLine() {
402             return snlineFirst;
403         }
404 
405         @Override
406         public int lastSnippetLine() {
407             return snlineLast;
408         }
409 
410         @Override
411         public String toString() {
<span class="line-modified">412             return &quot;CompoundWrap(&quot; + Arrays.stream(os).map(Object::toString).collect(joining(&quot;,&quot;)) + &quot;)&quot;;</span>





413         }
414     }
415 
<span class="line-modified">416     private static class RangeWrap extends Wrap {</span>
417 
418         final Range range;
<span class="line-modified">419         final String wrapped;</span>
<span class="line-modified">420         final int firstSnline;</span>
<span class="line-modified">421         final int lastSnline;</span>
422 
423         RangeWrap(String snippetSource, Range usedWithinSnippet) {
424             this.range = usedWithinSnippet;
425             this.wrapped = usedWithinSnippet.part(snippetSource);
426             usedWithinSnippet.verify(snippetSource);
427             this.firstSnline = countLines(snippetSource, 0, range.begin);
428             this.lastSnline = firstSnline + countLines(snippetSource, range.begin, range.end);
429         }
430 
431         @Override
432         public String wrapped() {
433             return wrapped;
434         }
435 
436         @Override
437         public int snippetIndexToWrapIndex(int sni) {
438             if (sni &lt; range.begin) {


439                 return 0;
440             }
441             if (sni &gt; range.end) {


442                 return range.length();
443             }
<span class="line-modified">444             return sni - range.begin;</span>




445         }
446 
447         @Override
448         public int wrapIndexToSnippetIndex(int wi) {
449             if (wi &lt; 0) {


450                 return 0; // bad index
451             }
452             int max = range.length();
453             if (wi &gt; max) {
<span class="line-modified">454                 wi = max;</span>


455             }
<span class="line-modified">456             return wi + range.begin;</span>



457         }
458 
459         @Override
460         public int firstSnippetIndex() {
461             return range.begin;
462         }
463 
464         @Override
465         public int lastSnippetIndex() {
466             return range.end;
467         }
468 
469         @Override
470         public int snippetLineToWrapLine(int snline) {
471             if (snline &lt; firstSnline) {
472                 return 0;
473             }
474             if (snline &gt;= lastSnline) {
475                 return lastSnline - firstSnline;
476             }
</pre>
<hr />
<pre>
518 
519     private static String semi(String s) {
520         return ((s.endsWith(&quot;;&quot;)) ? &quot;\n&quot; : ((s.endsWith(&quot;;\n&quot;)) ? &quot;&quot; : &quot;;\n&quot;));
521     }
522 
523     private static class DoitMethodWrap extends CompoundWrap {
524 
525         DoitMethodWrap(Wrap w) {
526             super(&quot;    public static Object &quot; + DOIT_METHOD_NAME + &quot;() throws Throwable {\n&quot;
527                     + &quot;        &quot;, w,
528                     &quot;    }\n&quot;);
529         }
530     }
531 
532     private static class VarDeclareWrap extends CompoundWrap {
533 
534         VarDeclareWrap(Wrap wtype, String brackets, Wrap wname) {
535             super(&quot;    public static &quot;, wtype, brackets + &quot; &quot;, wname, semi(wname));
536         }
537     }





538 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jshell;
 27 
 28 import java.util.ArrayList;
 29 import java.util.Arrays;
 30 import java.util.List;
 31 import static java.util.stream.Collectors.joining;
 32 import static jdk.jshell.Util.DOIT_METHOD_NAME;
 33 
 34 /**
 35  * Wrapping of source into Java methods, fields, etc.  All but outer layer
 36  * wrapping with imports and class.


 37  */
 38 abstract class Wrap implements GeneralWrap {
 39 
 40     private static Wrap methodWrap(String prefix, String source, String suffix) {
 41         Wrap wunit = new NoWrap(source);
 42         return new DoitMethodWrap(new CompoundWrap(prefix, wunit, suffix));
 43     }
 44 
 45     public static Wrap methodWrap(String source) {
 46         return methodWrap(&quot;&quot;, source, semi(source) + &quot;        return null;\n&quot;);
 47     }
 48 
 49     public static Wrap methodReturnWrap(String source) {
 50         return methodWrap(&quot;return &quot;, source, semi(source));
 51     }
 52 
 53     public static Wrap methodUnreachableSemiWrap(String source) {
 54         return methodWrap(&quot;&quot;, source, semi(source));
 55     }
 56 
</pre>
<hr />
<pre>
165         return new CompoundWrap(&quot;    public static\n    &quot;, w);
166     }
167 
168     private static int countLines(String s) {
169         return countLines(s, 0, s.length());
170     }
171 
172     private static int countLines(String s, int from, int toEx) {
173         int cnt = 0;
174         int idx = from;
175         while ((idx = s.indexOf(&#39;\n&#39;, idx)) &gt; 0) {
176             if (idx &gt;= toEx) break;
177             ++cnt;
178             ++idx;
179         }
180         return cnt;
181     }
182 
183     public static final class Range {
184         final int begin;
<span class="line-modified">185         final int end; // exclusive</span>
186 
187         Range(int begin, int end) {
188             this.begin = begin;
189             this.end = end;
190         }
191 
192         Range(String s) {
193             this.begin = 0;
194             this.end = s.length();
195         }
196 
197         String part(String s) {
198             return s.substring(begin, end);
199         }
200 
201         int length() {
202             return end - begin;
203         }
204 
205         boolean isEmpty() {
206             return end == begin;
207         }
208 
209         void verify(String s) {
210             if (begin &lt; 0 || end &lt;= begin || end &gt; s.length()) {
211                 throw new InternalError(&quot;Bad Range: &quot; + s + &quot;[&quot; + begin + &quot;,&quot; + end + &quot;]&quot;);
212             }
213         }
214 
215         @Override
216         public String toString() {
<span class="line-modified">217             return &quot;Range[&quot; + begin + &quot;,&quot; + end + &quot;)&quot;;</span>
218         }
219     }
220 
221     public static class CompoundWrap extends Wrap {
222 
223         final Object[] os;
224         final String wrapped;
225         final int snidxFirst;
226         final int snidxLast;
227         final int snlineFirst;
228         final int snlineLast;
229 
230         CompoundWrap(Object... os) {
231             this.os = os;
232             int sniFirst = Integer.MAX_VALUE;
233             int sniLast = Integer.MIN_VALUE;
234             int snlnFirst = Integer.MAX_VALUE;
235             int snlnLast = Integer.MIN_VALUE;
236             StringBuilder sb = new StringBuilder();
237             for (Object o : os) {
</pre>
<hr />
<pre>
261             this.snidxFirst = sniFirst;
262             this.snidxLast = sniLast;
263             this.snlineFirst = snlnFirst;
264             this.snlineLast = snlnLast;
265         }
266 
267         @Override
268         public String wrapped() {
269             return wrapped;
270         }
271 
272         @Override
273         public int snippetIndexToWrapIndex(int sni) {
274             int before = 0;
275             for (Object o : os) {
276                 if (o instanceof String) {
277                     String s = (String) o;
278                     before += s.length();
279                 } else if (o instanceof Wrap) {
280                     Wrap w = (Wrap) o;
<span class="line-modified">281                     if (sni &gt;= w.firstSnippetIndex() &amp;&amp; sni &lt; w.lastSnippetIndex()) {</span>
<span class="line-modified">282                         int wwi = w.snippetIndexToWrapIndex(sni);</span>
<span class="line-added">283                         debugWrap(&quot;\nCommoundWrap.snippetIndexToWrapIndex: SnippetIndex(%d) -&gt; WrapIndex(%d + %d = %d)&quot;</span>
<span class="line-added">284                                         + &quot;\n   === %s&quot;,</span>
<span class="line-added">285                                 sni, wwi, before, wwi + before, wrapped());</span>
<span class="line-added">286                         return wwi + before;</span>
287                     }
288                     before += w.wrapped().length();
289                 }
290             }
291             return 0;
292         }
293 
294         Wrap wrapIndexToWrap(long wi) {
295             int before = 0;
296             Wrap w = null;
297             for (Object o : os) {
298                 if (o instanceof String) {
299                     String s = (String) o;
300                     before += s.length();
301                 } else if (o instanceof Wrap) {
302                     w = (Wrap) o;
303                     int len = w.wrapped().length();
304                     if ((wi - before) &lt;= len) {
<span class="line-modified">305                         debugWrap(&quot;CommoundWrap.wrapIndexToWrap: Defer to wrap %s - wi: %d. before; %d   &gt;&gt;&gt; %s\n&quot;,</span>
<span class="line-modified">306                                 w, wi, before, w.wrapped());</span>
307                         return w;
308                     }
309                     before += len;
310                 }
311             }
312             return w;
313         }
314 
315         @Override
316         public int wrapIndexToSnippetIndex(int wi) {
317             int before = 0;
318             for (Object o : os) {
319                 if (o instanceof String) {
320                     String s = (String) o;
321                     before += s.length();
322                 } else if (o instanceof Wrap) {
323                     Wrap w = (Wrap) o;
324                     int len = w.wrapped().length();
325                     if ((wi - before) &lt;= len) {
<span class="line-modified">326                         int si = w.wrapIndexToSnippetIndex(wi - before);</span>
<span class="line-modified">327                         debugWrap(&quot;\nCommoundWrap.wrapIndexToSnippetIndex: WrapIndex(%d) -&gt; SnippetIndex(%d)\n&quot;,</span>
<span class="line-modified">328                                 wi, si);</span>
<span class="line-added">329                         return si;</span>
330                     }
331                     before += len;
332                 }
333             }
334             return lastSnippetIndex();
335         }
336 
337         @Override
338         public int firstSnippetIndex() {
339             return snidxFirst;
340         }
341 
342         @Override
343         public int lastSnippetIndex() {
344             return snidxLast;
345         }
346 
347         @Override
348         public int snippetLineToWrapLine(int snline) {
349             int before = 0;
</pre>
<hr />
<pre>
355                     Wrap w = (Wrap) o;
356                     if (snline &gt;= w.firstSnippetLine() &amp;&amp; snline &lt;= w.lastSnippetLine()) {
357                         return w.snippetLineToWrapLine(snline) + before;
358                     }
359                     before += countLines(w.wrapped());
360                 }
361             }
362             return 0;
363         }
364 
365         Wrap wrapLineToWrap(int wline) {
366             int before = 0;
367             Wrap w = null;
368             for (Object o : os) {
369                 if (o instanceof String) {
370                     String s = (String) o;
371                     before += countLines(s);
372                 } else if (o instanceof Wrap) {
373                     w = (Wrap) o;
374                     int lns = countLines(w.wrapped());
<span class="line-modified">375                     if ((wline - before) &lt;= lns) {</span>
376                         return w;
377                     }
378                     before += lns;
379                 }
380             }
381             return w;
382         }
383 
384         @Override
385         public int wrapLineToSnippetLine(int wline) {
386             int before = 0;
387             for (Object o : os) {
388                 if (o instanceof String) {
389                     String s = (String) o;
390                     before += countLines(s);
391                 } else if (o instanceof Wrap) {
392                     Wrap w = (Wrap) o;
393                     int lns = countLines(w.wrapped());
<span class="line-modified">394                     if ((wline - before) &lt;= lns) {</span>
395                         return w.wrapLineToSnippetLine(wline - before);
396                     }
397                     before += lns;
398                 }
399             }
400             return 0;
401         }
402 
403         @Override
404         public int firstSnippetLine() {
405             return snlineFirst;
406         }
407 
408         @Override
409         public int lastSnippetLine() {
410             return snlineLast;
411         }
412 
413         @Override
414         public String toString() {
<span class="line-modified">415             return &quot;CompoundWrap(&quot; + Arrays.stream(os)</span>
<span class="line-added">416                     .map(o -&gt; (o instanceof String)</span>
<span class="line-added">417                             ? &quot;\&quot;&quot; + o + &quot;\&quot;&quot;</span>
<span class="line-added">418                             : o.toString())</span>
<span class="line-added">419                     .collect(joining(&quot;,&quot;))</span>
<span class="line-added">420                     + &quot;)&quot;;</span>
421         }
422     }
423 
<span class="line-modified">424     static class RangeWrap extends Wrap {</span>
425 
426         final Range range;
<span class="line-modified">427         final String wrapped;   // The snippet portion of the source</span>
<span class="line-modified">428         final int firstSnline;  // Line count to start of snippet portion</span>
<span class="line-modified">429         final int lastSnline;   // Line count to end of snippet portion</span>
430 
431         RangeWrap(String snippetSource, Range usedWithinSnippet) {
432             this.range = usedWithinSnippet;
433             this.wrapped = usedWithinSnippet.part(snippetSource);
434             usedWithinSnippet.verify(snippetSource);
435             this.firstSnline = countLines(snippetSource, 0, range.begin);
436             this.lastSnline = firstSnline + countLines(snippetSource, range.begin, range.end);
437         }
438 
439         @Override
440         public String wrapped() {
441             return wrapped;
442         }
443 
444         @Override
445         public int snippetIndexToWrapIndex(int sni) {
446             if (sni &lt; range.begin) {
<span class="line-added">447                 debugWrap(&quot;\nRangeWrap.snippetIndexToWrapIndex: ERR before SnippetIndex(%d) -&gt; WrapIndex(%d + %d = %d)\n&quot;,</span>
<span class="line-added">448                         sni, 0);</span>
449                 return 0;
450             }
451             if (sni &gt; range.end) {
<span class="line-added">452                 debugWrap(&quot;\nRangeWrap.snippetIndexToWrapIndex: ERR after SnippetIndex(%d) -&gt; WrapIndex(%d + %d = %d)\n&quot;,</span>
<span class="line-added">453                         sni, range.length());</span>
454                 return range.length();
455             }
<span class="line-modified">456             int wi = sni - range.begin;</span>
<span class="line-added">457             debugWrap(&quot;\nRangeWrap.snippetIndexToWrapIndex: SnippetIndex(%d) -&gt; WrapIndex(%d + %d = %d)&quot;</span>
<span class="line-added">458                             + &quot;\n   === %s&quot;,</span>
<span class="line-added">459                     sni, sni, range.begin, sni - range.begin, wrapped());</span>
<span class="line-added">460             return wi;</span>
461         }
462 
463         @Override
464         public int wrapIndexToSnippetIndex(int wi) {
465             if (wi &lt; 0) {
<span class="line-added">466                 debugWrap(&quot;\nRangeWrap.wrapIndexToSnippetIndex: ERR before WrapIndex(%d) -&gt; SnippetIndex(%d)\n&quot;,</span>
<span class="line-added">467                         wi, 0);</span>
468                 return 0; // bad index
469             }
470             int max = range.length();
471             if (wi &gt; max) {
<span class="line-modified">472                 debugWrap(&quot;\nRangeWrap.wrapIndexToSnippetIndex: ERR after WrapIndex(%d) -&gt; SnippetIndex(%d)\n&quot;,</span>
<span class="line-added">473                         wi, max + range.begin);</span>
<span class="line-added">474                 return max + range.begin;</span>
475             }
<span class="line-modified">476             int sni = wi + range.begin;</span>
<span class="line-added">477             debugWrap(&quot;\nRangeWrap.wrapIndexToSnippetIndex: WrapIndex(%d) -&gt; SnippetIndex(%d)\n&quot;,</span>
<span class="line-added">478                     wi, sni);</span>
<span class="line-added">479             return sni;</span>
480         }
481 
482         @Override
483         public int firstSnippetIndex() {
484             return range.begin;
485         }
486 
487         @Override
488         public int lastSnippetIndex() {
489             return range.end;
490         }
491 
492         @Override
493         public int snippetLineToWrapLine(int snline) {
494             if (snline &lt; firstSnline) {
495                 return 0;
496             }
497             if (snline &gt;= lastSnline) {
498                 return lastSnline - firstSnline;
499             }
</pre>
<hr />
<pre>
541 
542     private static String semi(String s) {
543         return ((s.endsWith(&quot;;&quot;)) ? &quot;\n&quot; : ((s.endsWith(&quot;;\n&quot;)) ? &quot;&quot; : &quot;;\n&quot;));
544     }
545 
546     private static class DoitMethodWrap extends CompoundWrap {
547 
548         DoitMethodWrap(Wrap w) {
549             super(&quot;    public static Object &quot; + DOIT_METHOD_NAME + &quot;() throws Throwable {\n&quot;
550                     + &quot;        &quot;, w,
551                     &quot;    }\n&quot;);
552         }
553     }
554 
555     private static class VarDeclareWrap extends CompoundWrap {
556 
557         VarDeclareWrap(Wrap wtype, String brackets, Wrap wname) {
558             super(&quot;    public static &quot;, wtype, brackets + &quot; &quot;, wname, semi(wname));
559         }
560     }
<span class="line-added">561 </span>
<span class="line-added">562     void debugWrap(String format, Object... args) {</span>
<span class="line-added">563         //System.err.printf(format, args);</span>
<span class="line-added">564         //state.debug(this, InternalDebugControl.DBG_WRAP, format, args);</span>
<span class="line-added">565     }</span>
566 }
</pre>
</td>
</tr>
</table>
<center><a href="VarSnippet.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../module-info.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>