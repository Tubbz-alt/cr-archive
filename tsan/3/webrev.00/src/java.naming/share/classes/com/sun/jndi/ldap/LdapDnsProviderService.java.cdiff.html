<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.naming/share/classes/com/sun/jndi/ldap/LdapDnsProviderService.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LdapCtx.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="LdapRequest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.naming/share/classes/com/sun/jndi/ldap/LdapDnsProviderService.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 35,10 ***</span>
<span class="line-new-header">--- 35,12 ---</span>
  
  /**
   * The {@code LdapDnsProviderService} is responsible for creating and providing
   * access to the registered {@code LdapDnsProvider}s. The {@link ServiceLoader}
   * is used to find and register any implementations of {@link LdapDnsProvider}.
<span class="line-added">+  *</span>
<span class="line-added">+  * &lt;p&gt; Instances of this class are safe for use by multiple threads.</span>
   */
  final class LdapDnsProviderService {
  
      private static volatile LdapDnsProviderService service;
      private static final Object LOCK = new int[0];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 66,41 ***</span>
                  SecurityConstants.GET_CLASSLOADER_PERMISSION);
          }
      }
  
      /**
<span class="line-modified">!      * Retrieve the singleton static instance of LdapDnsProviderService.</span>
       */
      static LdapDnsProviderService getInstance() {
          if (service != null) return service;
<span class="line-modified">!         synchronized(LOCK) {</span>
              if (service != null) return service;
              service = new LdapDnsProviderService();
          }
          return service;
      }
  
      /**
<span class="line-modified">!      * Retrieve result from the first provider that successfully resolves</span>
       * the endpoints. If no results are found when calling installed
       * subclasses of {@code LdapDnsProvider} then this method will fall back
       * to the {@code DefaultLdapDnsProvider}.
       *
       * @throws NamingException if the {@code url} in not valid or an error
       *                         occurred while performing the lookup.
       */
      LdapDnsProviderResult lookupEndpoints(String url, Hashtable&lt;?,?&gt; env)
          throws NamingException
      {
<span class="line-removed">-         Iterator&lt;LdapDnsProvider&gt; iterator = providers.iterator();</span>
<span class="line-removed">-         Hashtable&lt;?, ?&gt; envCopy = new Hashtable&lt;&gt;(env);</span>
          LdapDnsProviderResult result = null;
<span class="line-modified">! </span>
<span class="line-modified">!         while (result == null &amp;&amp; iterator.hasNext()) {</span>
<span class="line-modified">!             result = iterator.next().lookupEndpoints(url, envCopy)</span>
<span class="line-modified">!                     .filter(r -&gt; r.getEndpoints().size() &gt; 0)</span>
<span class="line-modified">!                     .orElse(null);</span>
          }
  
          if (result == null) {
              return new DefaultLdapDnsProvider().lookupEndpoints(url, env)
                  .orElse(new LdapDnsProviderResult(&quot;&quot;, List.of()));
<span class="line-new-header">--- 68,42 ---</span>
                  SecurityConstants.GET_CLASSLOADER_PERMISSION);
          }
      }
  
      /**
<span class="line-modified">!      * Retrieves the singleton instance of LdapDnsProviderService.</span>
       */
      static LdapDnsProviderService getInstance() {
          if (service != null) return service;
<span class="line-modified">!         synchronized (LOCK) {</span>
              if (service != null) return service;
              service = new LdapDnsProviderService();
          }
          return service;
      }
  
      /**
<span class="line-modified">!      * Retrieves result from the first provider that successfully resolves</span>
       * the endpoints. If no results are found when calling installed
       * subclasses of {@code LdapDnsProvider} then this method will fall back
       * to the {@code DefaultLdapDnsProvider}.
       *
       * @throws NamingException if the {@code url} in not valid or an error
       *                         occurred while performing the lookup.
       */
      LdapDnsProviderResult lookupEndpoints(String url, Hashtable&lt;?,?&gt; env)
          throws NamingException
      {
          LdapDnsProviderResult result = null;
<span class="line-modified">!         Hashtable&lt;?, ?&gt; envCopy = new Hashtable&lt;&gt;(env);</span>
<span class="line-modified">!         synchronized (LOCK) {</span>
<span class="line-modified">!             Iterator&lt;LdapDnsProvider&gt; iterator = providers.iterator();</span>
<span class="line-modified">!             while (result == null &amp;&amp; iterator.hasNext()) {</span>
<span class="line-modified">!                 result = iterator.next().lookupEndpoints(url, envCopy)</span>
<span class="line-added">+                         .filter(r -&gt; !r.getEndpoints().isEmpty())</span>
<span class="line-added">+                         .orElse(null);</span>
<span class="line-added">+             }</span>
          }
  
          if (result == null) {
              return new DefaultLdapDnsProvider().lookupEndpoints(url, env)
                  .orElse(new LdapDnsProviderResult(&quot;&quot;, List.of()));
</pre>
<center><a href="LdapCtx.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="LdapRequest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>