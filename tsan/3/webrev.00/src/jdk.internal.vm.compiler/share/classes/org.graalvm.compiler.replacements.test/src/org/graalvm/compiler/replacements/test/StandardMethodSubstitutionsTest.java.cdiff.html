<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.replacements.test/src/org/graalvm/compiler/replacements/test/StandardMethodSubstitutionsTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SnippetsTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="StringCompareToTest.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.replacements.test/src/org/graalvm/compiler/replacements/test/StandardMethodSubstitutionsTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 29,10 ***</span>
<span class="line-new-header">--- 29,12 ---</span>
  import org.graalvm.compiler.api.replacements.MethodSubstitution;
  import org.graalvm.compiler.nodes.IfNode;
  import org.graalvm.compiler.nodes.StructuredGraph;
  import org.graalvm.compiler.nodes.calc.AbsNode;
  import org.graalvm.compiler.nodes.calc.ReinterpretNode;
<span class="line-added">+ import org.graalvm.compiler.replacements.amd64.AMD64CountLeadingZerosNode;</span>
<span class="line-added">+ import org.graalvm.compiler.replacements.amd64.AMD64CountTrailingZerosNode;</span>
  import org.graalvm.compiler.replacements.nodes.BitCountNode;
  import org.graalvm.compiler.replacements.nodes.BitScanForwardNode;
  import org.graalvm.compiler.replacements.nodes.BitScanReverseNode;
  import org.graalvm.compiler.replacements.nodes.ReverseBytesNode;
  import org.junit.Test;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 130,19 ***</span>
  
      public static double mathAll(double value) {
          return Math.sqrt(value) + Math.log(value) + Math.log10(value) + Math.sin(value) + Math.cos(value) + Math.tan(value);
      }
  
<span class="line-modified">!     public void testSubstitution(String testMethodName, Class&lt;?&gt; intrinsicClass, Class&lt;?&gt; holder, String methodName, boolean optional, Object... args) {</span>
          ResolvedJavaMethod realJavaMethod = getResolvedJavaMethod(holder, methodName);
          ResolvedJavaMethod testJavaMethod = getResolvedJavaMethod(testMethodName);
          StructuredGraph graph = testGraph(testMethodName);
  
          // Check to see if the resulting graph contains the expected node
<span class="line-modified">!         StructuredGraph replacement = getReplacements().getSubstitution(realJavaMethod, -1, false, null);</span>
          if (replacement == null &amp;&amp; !optional) {
<span class="line-modified">!             assertInGraph(graph, intrinsicClass);</span>
          }
  
          for (Object l : args) {
              // Force compilation
              InstalledCode code = getCode(testJavaMethod);
<span class="line-new-header">--- 132,19 ---</span>
  
      public static double mathAll(double value) {
          return Math.sqrt(value) + Math.log(value) + Math.log10(value) + Math.sin(value) + Math.cos(value) + Math.tan(value);
      }
  
<span class="line-modified">!     public void testSubstitution(String testMethodName, Class&lt;?&gt; holder, String methodName, boolean optional, Object[] args, Class&lt;?&gt;... intrinsicClasses) {</span>
          ResolvedJavaMethod realJavaMethod = getResolvedJavaMethod(holder, methodName);
          ResolvedJavaMethod testJavaMethod = getResolvedJavaMethod(testMethodName);
          StructuredGraph graph = testGraph(testMethodName);
  
          // Check to see if the resulting graph contains the expected node
<span class="line-modified">!         StructuredGraph replacement = getReplacements().getSubstitution(realJavaMethod, -1, false, null, graph.getOptions());</span>
          if (replacement == null &amp;&amp; !optional) {
<span class="line-modified">!             assertInGraph(graph, intrinsicClasses);</span>
          }
  
          for (Object l : args) {
              // Force compilation
              InstalledCode code = getCode(testJavaMethod);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 157,11 ***</span>
  
      @Test
      public void testCharSubstitutions() {
          Object[] args = new Character[]{Character.MIN_VALUE, (char) -1, (char) 0, (char) 1, Character.MAX_VALUE};
  
<span class="line-modified">!         testSubstitution(&quot;charReverseBytes&quot;, ReverseBytesNode.class, Character.class, &quot;reverseBytes&quot;, false, args);</span>
      }
  
      public static char charReverseBytes(char value) {
          return Character.reverseBytes(value);
      }
<span class="line-new-header">--- 159,11 ---</span>
  
      @Test
      public void testCharSubstitutions() {
          Object[] args = new Character[]{Character.MIN_VALUE, (char) -1, (char) 0, (char) 1, Character.MAX_VALUE};
  
<span class="line-modified">!         testSubstitution(&quot;charReverseBytes&quot;, Character.class, &quot;reverseBytes&quot;, false, args, ReverseBytesNode.class);</span>
      }
  
      public static char charReverseBytes(char value) {
          return Character.reverseBytes(value);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 181,11 ***</span>
  
      @Test
      public void testShortSubstitutions() {
          Object[] args = new Short[]{Short.MIN_VALUE, -1, 0, 1, Short.MAX_VALUE};
  
<span class="line-modified">!         testSubstitution(&quot;shortReverseBytes&quot;, ReverseBytesNode.class, Short.class, &quot;reverseBytes&quot;, false, args);</span>
      }
  
      public static short shortReverseBytes(short value) {
          return Short.reverseBytes(value);
      }
<span class="line-new-header">--- 183,11 ---</span>
  
      @Test
      public void testShortSubstitutions() {
          Object[] args = new Short[]{Short.MIN_VALUE, -1, 0, 1, Short.MAX_VALUE};
  
<span class="line-modified">!         testSubstitution(&quot;shortReverseBytes&quot;, Short.class, &quot;reverseBytes&quot;, false, args, ReverseBytesNode.class);</span>
      }
  
      public static short shortReverseBytes(short value) {
          return Short.reverseBytes(value);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 205,14 ***</span>
  
      @Test
      public void testIntegerSubstitutions() {
          Object[] args = new Object[]{Integer.MIN_VALUE, -1, 0, 1, Integer.MAX_VALUE};
  
<span class="line-modified">!         testSubstitution(&quot;integerReverseBytes&quot;, ReverseBytesNode.class, Integer.class, &quot;reverseBytes&quot;, false, args);</span>
<span class="line-modified">!         testSubstitution(&quot;integerNumberOfLeadingZeros&quot;, BitScanReverseNode.class, Integer.class, &quot;numberOfLeadingZeros&quot;, true, args);</span>
<span class="line-modified">!         testSubstitution(&quot;integerNumberOfTrailingZeros&quot;, BitScanForwardNode.class, Integer.class, &quot;numberOfTrailingZeros&quot;, false, args);</span>
<span class="line-modified">!         testSubstitution(&quot;integerBitCount&quot;, BitCountNode.class, Integer.class, &quot;bitCount&quot;, true, args);</span>
      }
  
      public static int integerReverseBytes(int value) {
          return Integer.reverseBytes(value);
      }
<span class="line-new-header">--- 207,14 ---</span>
  
      @Test
      public void testIntegerSubstitutions() {
          Object[] args = new Object[]{Integer.MIN_VALUE, -1, 0, 1, Integer.MAX_VALUE};
  
<span class="line-modified">!         testSubstitution(&quot;integerReverseBytes&quot;, Integer.class, &quot;reverseBytes&quot;, false, args, ReverseBytesNode.class);</span>
<span class="line-modified">!         testSubstitution(&quot;integerNumberOfLeadingZeros&quot;, Integer.class, &quot;numberOfLeadingZeros&quot;, true, args, BitScanReverseNode.class, AMD64CountLeadingZerosNode.class);</span>
<span class="line-modified">!         testSubstitution(&quot;integerNumberOfTrailingZeros&quot;, Integer.class, &quot;numberOfTrailingZeros&quot;, false, args, BitScanForwardNode.class, AMD64CountTrailingZerosNode.class);</span>
<span class="line-modified">!         testSubstitution(&quot;integerBitCount&quot;, Integer.class, &quot;bitCount&quot;, true, args, BitCountNode.class);</span>
      }
  
      public static int integerReverseBytes(int value) {
          return Integer.reverseBytes(value);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 231,14 ***</span>
  
      @Test
      public void testLongSubstitutions() {
          Object[] args = new Object[]{Long.MIN_VALUE, -1L, 0L, 1L, Long.MAX_VALUE};
  
<span class="line-modified">!         testSubstitution(&quot;longReverseBytes&quot;, ReverseBytesNode.class, Long.class, &quot;reverseBytes&quot;, false, args);</span>
<span class="line-modified">!         testSubstitution(&quot;longNumberOfLeadingZeros&quot;, BitScanReverseNode.class, Long.class, &quot;numberOfLeadingZeros&quot;, true, args);</span>
<span class="line-modified">!         testSubstitution(&quot;longNumberOfTrailingZeros&quot;, BitScanForwardNode.class, Long.class, &quot;numberOfTrailingZeros&quot;, false, args);</span>
<span class="line-modified">!         testSubstitution(&quot;longBitCount&quot;, BitCountNode.class, Long.class, &quot;bitCount&quot;, true, args);</span>
      }
  
      public static long longReverseBytes(long value) {
          return Long.reverseBytes(value);
      }
<span class="line-new-header">--- 233,14 ---</span>
  
      @Test
      public void testLongSubstitutions() {
          Object[] args = new Object[]{Long.MIN_VALUE, -1L, 0L, 1L, Long.MAX_VALUE};
  
<span class="line-modified">!         testSubstitution(&quot;longReverseBytes&quot;, Long.class, &quot;reverseBytes&quot;, false, args, ReverseBytesNode.class);</span>
<span class="line-modified">!         testSubstitution(&quot;longNumberOfLeadingZeros&quot;, Long.class, &quot;numberOfLeadingZeros&quot;, true, args, BitScanReverseNode.class, AMD64CountLeadingZerosNode.class);</span>
<span class="line-modified">!         testSubstitution(&quot;longNumberOfTrailingZeros&quot;, Long.class, &quot;numberOfTrailingZeros&quot;, false, args, BitScanForwardNode.class, AMD64CountTrailingZerosNode.class);</span>
<span class="line-modified">!         testSubstitution(&quot;longBitCount&quot;, Long.class, &quot;bitCount&quot;, true, args, BitCountNode.class);</span>
      }
  
      public static long longReverseBytes(long value) {
          return Long.reverseBytes(value);
      }
</pre>
<center><a href="SnippetsTest.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="StringCompareToTest.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>