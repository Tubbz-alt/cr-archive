<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.replacements.test/src/org/graalvm/compiler/replacements/test/IndexOobBytecodeExceptionTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FoldTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="IntegerExactExceptionTest.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.replacements.test/src/org/graalvm/compiler/replacements/test/IndexOobBytecodeExceptionTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,51 +25,23 @@</span>
  package org.graalvm.compiler.replacements.test;
  
  import java.util.ArrayList;
  import java.util.Collection;
  
<span class="udiff-line-added">+ import org.graalvm.compiler.api.directives.GraalDirectives;</span>
  import org.junit.Test;
  import org.junit.runner.RunWith;
  import org.junit.runners.Parameterized;
  import org.junit.runners.Parameterized.Parameter;
  import org.junit.runners.Parameterized.Parameters;
  
<span class="udiff-line-removed">- import org.graalvm.compiler.api.directives.GraalDirectives;</span>
<span class="udiff-line-removed">- import org.graalvm.compiler.nodes.ValueNode;</span>
<span class="udiff-line-removed">- import org.graalvm.compiler.nodes.extended.BytecodeExceptionNode.BytecodeExceptionKind;</span>
<span class="udiff-line-removed">- import org.graalvm.compiler.nodes.graphbuilderconf.GraphBuilderContext;</span>
<span class="udiff-line-removed">- import org.graalvm.compiler.nodes.graphbuilderconf.InvocationPlugin;</span>
<span class="udiff-line-removed">- import org.graalvm.compiler.nodes.graphbuilderconf.InvocationPlugins;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- import jdk.vm.ci.meta.ResolvedJavaMethod;</span>
<span class="udiff-line-removed">- </span>
  @RunWith(Parameterized.class)
  public class IndexOobBytecodeExceptionTest extends BytecodeExceptionTest {
  
<span class="udiff-line-modified-removed">-     private static class Exceptions {</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         private static Object[] empty = new Object[0];</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         public static void throwOutOfBounds(int idx, int length) {</span>
<span class="udiff-line-removed">-             GraalDirectives.blackhole(empty[idx]);</span>
<span class="udiff-line-removed">-             GraalDirectives.blackhole(length);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     @Override</span>
<span class="udiff-line-removed">-     protected void registerInvocationPlugins(InvocationPlugins invocationPlugins) {</span>
<span class="udiff-line-removed">-         invocationPlugins.register(new InvocationPlugin() {</span>
<span class="udiff-line-removed">-             @Override</span>
<span class="udiff-line-removed">-             public boolean apply(GraphBuilderContext b, ResolvedJavaMethod targetMethod, Receiver receiver, ValueNode idx, ValueNode length) {</span>
<span class="udiff-line-removed">-                 return throwBytecodeException(b, BytecodeExceptionKind.OUT_OF_BOUNDS, idx, length);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }, Exceptions.class, &quot;throwOutOfBounds&quot;, int.class, int.class);</span>
<span class="udiff-line-removed">-         super.registerInvocationPlugins(invocationPlugins);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     public static void oobSnippet(int idx, int length) {</span>
<span class="udiff-line-removed">-         Exceptions.throwOutOfBounds(idx, length);</span>
<span class="udiff-line-modified-added">+     public static void oobSnippet(Object[] empty, int idx, int length) {</span>
<span class="udiff-line-modified-added">+         GraalDirectives.blackhole(empty[idx]);</span>
<span class="udiff-line-modified-added">+         GraalDirectives.blackhole(length);</span>
      }
  
      @Parameter public int index;
  
      @Parameters(name = &quot;{0}&quot;)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -83,8 +55,9 @@</span>
          return ret;
      }
  
      @Test
      public void testOutOfBoundsException() {
<span class="udiff-line-modified-removed">-         test(&quot;oobSnippet&quot;, index, Exceptions.empty.length);</span>
<span class="udiff-line-modified-added">+         Object[] empty = new Object[0];</span>
<span class="udiff-line-added">+         test(&quot;oobSnippet&quot;, empty, index, empty.length);</span>
      }
  }
</pre>
<center><a href="FoldTest.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="IntegerExactExceptionTest.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>