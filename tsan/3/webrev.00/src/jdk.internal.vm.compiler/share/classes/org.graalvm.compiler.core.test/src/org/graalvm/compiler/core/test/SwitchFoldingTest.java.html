<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.test/src/org/graalvm/compiler/core/test/SwitchFoldingTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 
 25 
 26 package org.graalvm.compiler.core.test;
 27 
 28 import org.graalvm.compiler.debug.DebugContext;
 29 import org.graalvm.compiler.nodes.StructuredGraph;
 30 import org.junit.Test;
 31 
 32 public class SwitchFoldingTest extends GraalCompilerTest {
 33 
 34     private static final String REFERENCE_SNIPPET = &quot;referenceSnippet&quot;;
 35     private static final String REFERENCE_SNIPPET_2 = &quot;reference2Snippet&quot;;
 36     private static final String REFERENCE_SNIPPET_3 = &quot;reference3Snippet&quot;;
 37     private static final String REFERENCE_SNIPPET_4 = &quot;reference4Snippet&quot;;
 38     private static final String REFERENCE_SNIPPET_5 = &quot;reference5Snippet&quot;;
 39 
 40     public static int referenceSnippet(int a) {
 41         switch (a) {
 42             case 0:
 43                 return 10;
 44             case 1:
 45                 return 5;
 46             case 2:
 47                 return 3;
 48             case 3:
 49                 return 11;
 50             case 4:
 51                 return 14;
 52             case 5:
 53                 return 2;
 54             case 6:
 55                 return 1;
 56             case 7:
 57                 return 0;
 58             case 8:
 59                 return 7;
 60             default:
 61                 return 6;
 62         }
 63     }
 64 
 65     public static int reference2Snippet(int a) {
 66         switch (a) {
 67             case 0:
 68                 return 4;
 69             case 1:
 70             case 2:
 71                 return 1;
 72             case 3:
 73                 return 6;
 74             default:
 75                 return 7;
 76         }
 77     }
 78 
 79     public static int reference3Snippet(int a) {
 80         switch (a) {
 81             case 0:
 82                 return 4;
 83             case 1:
 84             case 2:
 85             case 4:
 86                 return 6;
 87             case 6:
 88             case 7:
 89             default:
 90                 return 7;
 91         }
 92     }
 93 
 94     public static int test1Snippet(int a) {
 95         if (a == 0) {
 96             return 10;
 97         } else if (a == 1) {
 98             return 5;
 99         } else if (a == 2) {
100             return 3;
101         } else if (a == 3) {
102             return 11;
103         } else if (a == 4) {
104             return 14;
105         } else if (a == 5) {
106             return 2;
107         } else if (a == 6) {
108             return 1;
109         } else if (a == 7) {
110             return 0;
111         } else if (a == 8) {
112             return 7;
113         } else {
114             return 6;
115         }
116     }
117 
118     @Test
119     public void test1() {
120         test1(&quot;test1Snippet&quot;);
121     }
122 
123     public static int test2Snippet(int a) {
124         switch (a) {
125             case 0:
126                 return 10;
127             case 1:
128                 return 5;
129             case 2:
130                 return 3;
131             case 3:
132                 return 11;
133             case 4:
134                 return 14;
135             default:
136                 switch (a) {
137                     case 5:
138                         return 2;
139                     case 6:
140                         return 1;
141                     case 7:
142                         return 0;
143                     case 8:
144                         return 7;
145                     default:
146                         return 6;
147                 }
148         }
149     }
150 
151     @Test
152     public void test2() {
153         test1(&quot;test2Snippet&quot;);
154     }
155 
156     public static int test3Snippet(int a) {
157         switch (a) {
158             case 0:
159                 return 10;
160             default:
161                 switch (a) {
162                     case 1:
163                         return 5;
164                     default:
165                         switch (a) {
166                             case 2:
167                                 return 3;
168                             default:
169                                 switch (a) {
170                                     case 3:
171                                         return 11;
172                                     default:
173                                         switch (a) {
174                                             case 4:
175                                                 return 14;
176                                             default:
177                                                 switch (a) {
178                                                     case 5:
179                                                         return 2;
180                                                     default:
181                                                         switch (a) {
182                                                             case 6:
183                                                                 return 1;
184                                                             default:
185                                                                 switch (a) {
186                                                                     case 7:
187                                                                         return 0;
188                                                                     default:
189                                                                         switch (a) {
190                                                                             case 8:
191                                                                                 return 7;
192                                                                             default:
193                                                                                 return 6;
194                                                                         }
195                                                                 }
196                                                         }
197                                                 }
198                                         }
199                                 }
200                         }
201                 }
202         }
203     }
204 
205     @Test
206     public void test3() {
207         test1(&quot;test3Snippet&quot;);
208     }
209 
210     public static int test4Snippet(int a) {
211         switch (a) {
212             case 0:
213                 return 10;
214             case 1:
215                 return 5;
216             case 2:
217                 return 3;
218             case 3:
219                 return 11;
220             case 4:
221                 return 14;
222             case 5:
223                 return 2;
224             case 6:
225                 return 1;
226             default:
227                 if (a == 7) {
228                     return 0;
229                 } else if (a == 8) {
230                     return 7;
231                 } else {
232                     return 6;
233                 }
234         }
235     }
236 
237     @Test
238     public void test4() {
239         test1(&quot;test4Snippet&quot;);
240     }
241 
242     public static int test5Snippet(int a) {
243         switch (a) {
244             case 0:
245                 return 10;
246             default:
247                 switch (a) {
248                     case 1:
249                         return 5;
250                     default:
251                         switch (a) {
252                             case 2:
253                                 return 3;
254                             default:
255                                 switch (a) {
256                                     case 3:
257                                         return 11;
258                                     default:
259                                         switch (a) {
260                                             case 4:
261                                                 return 14;
262                                             default:
263                                                 switch (a) {
264                                                     case 5:
265                                                         return 2;
266                                                     default:
267                                                         switch (a) {
268                                                             case 6:
269                                                                 return 1;
270                                                             default:
271                                                                 if (a == 7) {
272                                                                     return 0;
273                                                                 } else if (a == 8) {
274                                                                     return 7;
275                                                                 } else {
276                                                                     return 6;
277                                                                 }
278                                                         }
279                                                 }
280                                         }
281                                 }
282                         }
283                 }
284         }
285     }
286 
287     @Test
288     public void test5() {
289         test1(&quot;test5Snippet&quot;);
290     }
291 
292     public static int test6Snippet(int a) {
293         if (a == 0) {
294             return 10;
295         } else {
296             switch (a) {
297                 case 1:
298                     return 5;
299                 default:
300                     if (a == 2) {
301                         return 3;
302                     } else if (a == 3) {
303                         return 11;
304                     } else {
305                         switch (a) {
306                             case 4:
307                                 return 14;
308                             case 5:
309                                 return 2;
310                             case 6:
311                                 return 1;
312                             default:
313                                 if (a == 7) {
314                                     return 0;
315                                 } else if (a == 8) {
316                                     return 7;
317                                 } else {
318                                     return 6;
319                                 }
320                         }
321                     }
322 
323             }
324         }
325     }
326 
327     @Test
328     public void test6() {
329         test1(&quot;test6Snippet&quot;);
330     }
331 
332     public static int test7Snippet(int a) {
333         if (a == 0) {
334             return 4;
335         } else {
336             switch (a) {
337                 case 1:
338                 case 2:
339                     return 1;
340                 case 3:
341                     return 6;
342                 default:
343                     return 7;
344             }
345         }
346     }
347 
348     @Test
349     public void test7() {
350         test2(&quot;test7Snippet&quot;);
351     }
352 
353     public static int test8Snippet(int a) {
354         switch (a) {
355             case 0:
356                 return 4;
357             case 1:
358             case 2:
359             case 7:
360             default:
361                 switch (a) {
362                     case 2:
363                     case 6:
364                     default:
365                         switch (a) {
366                             case 1:
367                             case 2:
368                             case 4:
369                                 return 6;
370                             default:
371                                 return 7;
372                         }
373                 }
374         }
375     }
376 
377     @Test
378     public void test8() {
379         test3(&quot;test8Snippet&quot;);
380     }
381 
382     public static int reference4Snippet(int a) {
383         switch (a) {
384             case 0:
385                 return 4;
386             case 1:
387             case 2:
388             case 4:
389                 return 6;
390             case 6:
391                 return 7;
392             case 7:
393                 return 7;
394             default:
395                 return 7;
396         }
397     }
398 
399     public static int test9Snippet(int a) {
400         switch (a) {
401             case 0:
402                 return 4;
403             case 1:
404             case 2:
405             case 4:
406                 return 6;
407             case 6:
408             case 7:
409             default:
410                 if (a == 6) {
411                     return 7;
412                 } else if (a == 7) {
413                     return 7;
414                 } else {
415                     return 7;
416                 }
417         }
418     }
419 
420     @Test
421     public void test9() {
422         test4(&quot;test9Snippet&quot;);
423     }
424 
425     public static int reference5Snippet(int a) {
426         switch (a) {
427             case 0:
428                 return 4;
429             case 1:
430                 return 1;
431             case 2:
432                 return 1;
433             case 3:
434                 return 6;
435             default:
436                 return 7;
437         }
438     }
439 
440     public static int test10Snippet(int a) {
441         if (a == 0) {
442             return 4;
443         } else {
444             if (a == 1 || a == 2) {
445                 return 1;
446             } else {
447                 switch (a) {
448                     case 3:
449                         return 6;
450                     default:
451                         return 7;
452                 }
453             }
454         }
455     }
456 
457     @Test
458     public void test10() {
459         test5(&quot;test10Snippet&quot;);
460     }
461 
462     private void test1(String snippet) {
463         test(snippet, REFERENCE_SNIPPET);
464     }
465 
466     private void test2(String snippet) {
467         test(snippet, REFERENCE_SNIPPET_2);
468     }
469 
470     private void test3(String snippet) {
471         test(snippet, REFERENCE_SNIPPET_3);
472     }
473 
474     private void test4(String snippet) {
475         test(snippet, REFERENCE_SNIPPET_4);
476     }
477 
478     private void test5(String snippet) {
479         test(snippet, REFERENCE_SNIPPET_5);
480     }
481 
482     private void test(String snippet, String ref) {
483         StructuredGraph graph = parseEager(snippet, StructuredGraph.AllowAssumptions.YES);
484         DebugContext debug = graph.getDebug();
485         debug.dump(DebugContext.BASIC_LEVEL, graph, &quot;Graph&quot;);
486         createCanonicalizerPhase().apply(graph, getProviders());
487         StructuredGraph referenceGraph = parseEager(ref, StructuredGraph.AllowAssumptions.YES);
488         assertEquals(referenceGraph, graph);
489     }
490 }
    </pre>
  </body>
</html>