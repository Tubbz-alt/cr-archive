<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.test/src/org/graalvm/compiler/core/test/IntegerEqualsCanonicalizerTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ImplicitNullCheckTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="InterfaceMethodHandleTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.test/src/org/graalvm/compiler/core/test/IntegerEqualsCanonicalizerTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 
 25 package org.graalvm.compiler.core.test;
 26 
<span class="line-removed"> 27 import org.junit.Test;</span>
<span class="line-removed"> 28 </span>
 29 import org.graalvm.compiler.nodes.FrameState;
 30 import org.graalvm.compiler.nodes.StructuredGraph;
 31 import org.graalvm.compiler.nodes.StructuredGraph.AllowAssumptions;
<span class="line-modified"> 32 import org.graalvm.compiler.phases.common.CanonicalizerPhase;</span>
<span class="line-removed"> 33 import org.graalvm.compiler.phases.tiers.PhaseContext;</span>
 34 
 35 public class IntegerEqualsCanonicalizerTest extends GraalCompilerTest {
 36 
 37     @Test
 38     public void testSubtractEqualsZero() {
 39         test(&quot;testSubtractEqualsZeroSnippet&quot;, &quot;testSubtractEqualsZeroReference&quot;);
 40     }
 41 
 42     public static int testSubtractEqualsZeroReference(int a, int b) {
 43         if (a == b) {
 44             return 1;
 45         }
 46         return 0;
 47     }
 48 
 49     public static int testSubtractEqualsZeroSnippet(int a, int b) {
 50         if (a - b == 0) {
 51             return 1;
 52         }
 53         return 0;
</pre>
<hr />
<pre>
151         return (a &amp; 8) != 0;
152     }
153 
154     public static boolean testAlternateIntegerTest(int a) {
155         return (a &amp; 8) == 8;
156     }
157 
158     @Test
159     public void testIntegerTest() {
160         test(&quot;testNormalIntegerTest&quot;, &quot;testAlternateIntegerTest&quot;);
161     }
162 
163     private void test(String snippet, String referenceSnippet) {
164         StructuredGraph graph = getCanonicalizedGraph(snippet);
165         StructuredGraph referenceGraph = getCanonicalizedGraph(referenceSnippet);
166         assertEquals(referenceGraph, graph);
167     }
168 
169     private StructuredGraph getCanonicalizedGraph(String snippet) {
170         StructuredGraph graph = parseEager(snippet, AllowAssumptions.YES);
<span class="line-modified">171         new CanonicalizerPhase().apply(graph, new PhaseContext(getProviders()));</span>
172         for (FrameState state : graph.getNodes(FrameState.TYPE).snapshot()) {
173             state.replaceAtUsages(null);
174             state.safeDelete();
175         }
176         return graph;
177     }
178 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 
 24 
 25 package org.graalvm.compiler.core.test;
 26 


 27 import org.graalvm.compiler.nodes.FrameState;
 28 import org.graalvm.compiler.nodes.StructuredGraph;
 29 import org.graalvm.compiler.nodes.StructuredGraph.AllowAssumptions;
<span class="line-modified"> 30 import org.junit.Test;</span>

 31 
 32 public class IntegerEqualsCanonicalizerTest extends GraalCompilerTest {
 33 
 34     @Test
 35     public void testSubtractEqualsZero() {
 36         test(&quot;testSubtractEqualsZeroSnippet&quot;, &quot;testSubtractEqualsZeroReference&quot;);
 37     }
 38 
 39     public static int testSubtractEqualsZeroReference(int a, int b) {
 40         if (a == b) {
 41             return 1;
 42         }
 43         return 0;
 44     }
 45 
 46     public static int testSubtractEqualsZeroSnippet(int a, int b) {
 47         if (a - b == 0) {
 48             return 1;
 49         }
 50         return 0;
</pre>
<hr />
<pre>
148         return (a &amp; 8) != 0;
149     }
150 
151     public static boolean testAlternateIntegerTest(int a) {
152         return (a &amp; 8) == 8;
153     }
154 
155     @Test
156     public void testIntegerTest() {
157         test(&quot;testNormalIntegerTest&quot;, &quot;testAlternateIntegerTest&quot;);
158     }
159 
160     private void test(String snippet, String referenceSnippet) {
161         StructuredGraph graph = getCanonicalizedGraph(snippet);
162         StructuredGraph referenceGraph = getCanonicalizedGraph(referenceSnippet);
163         assertEquals(referenceGraph, graph);
164     }
165 
166     private StructuredGraph getCanonicalizedGraph(String snippet) {
167         StructuredGraph graph = parseEager(snippet, AllowAssumptions.YES);
<span class="line-modified">168         createCanonicalizerPhase().apply(graph, getProviders());</span>
169         for (FrameState state : graph.getNodes(FrameState.TYPE).snapshot()) {
170             state.replaceAtUsages(null);
171             state.safeDelete();
172         }
173         return graph;
174     }
175 }
</pre>
</td>
</tr>
</table>
<center><a href="ImplicitNullCheckTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="InterfaceMethodHandleTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>