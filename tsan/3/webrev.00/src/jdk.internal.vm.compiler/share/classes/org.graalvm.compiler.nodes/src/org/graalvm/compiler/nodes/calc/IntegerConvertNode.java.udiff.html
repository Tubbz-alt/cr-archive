<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/calc/IntegerConvertNode.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FloatEqualsNode.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="IntegerDivRemNode.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/calc/IntegerConvertNode.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2014, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2014, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -22,12 +22,11 @@</span>
   */
  
  
  package org.graalvm.compiler.nodes.calc;
  
<span class="udiff-line-modified-removed">- import java.io.Serializable;</span>
<span class="udiff-line-removed">- import java.util.function.Function;</span>
<span class="udiff-line-modified-added">+ import static org.graalvm.compiler.nodes.calc.BinaryArithmeticNode.getArithmeticOpTable;</span>
  
  import org.graalvm.compiler.core.common.type.ArithmeticOpTable;
  import org.graalvm.compiler.core.common.type.ArithmeticOpTable.IntegerConvertOp;
  import org.graalvm.compiler.core.common.type.IntegerStamp;
  import org.graalvm.compiler.core.common.type.PrimitiveStamp;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -51,54 +50,45 @@</span>
   */
  @NodeInfo
  public abstract class IntegerConvertNode&lt;OP, REV&gt; extends UnaryNode implements ArithmeticOperation, ConvertNode, ArithmeticLIRLowerable, StampInverter {
      @SuppressWarnings(&quot;rawtypes&quot;) public static final NodeClass&lt;IntegerConvertNode&gt; TYPE = NodeClass.create(IntegerConvertNode.class);
  
<span class="udiff-line-removed">-     protected final SerializableIntegerConvertFunction&lt;OP&gt; getOp;</span>
<span class="udiff-line-removed">-     protected final SerializableIntegerConvertFunction&lt;REV&gt; getReverseOp;</span>
<span class="udiff-line-removed">- </span>
      protected final int inputBits;
      protected final int resultBits;
  
<span class="udiff-line-modified-removed">-     protected interface SerializableIntegerConvertFunction&lt;T&gt; extends Function&lt;ArithmeticOpTable, IntegerConvertOp&lt;T&gt;&gt;, Serializable {</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     protected IntegerConvertNode(NodeClass&lt;? extends IntegerConvertNode&lt;OP, REV&gt;&gt; c, SerializableIntegerConvertFunction&lt;OP&gt; getOp, SerializableIntegerConvertFunction&lt;REV&gt; getReverseOp, int inputBits,</span>
<span class="udiff-line-removed">-                     int resultBits, ValueNode input) {</span>
<span class="udiff-line-removed">-         super(c, getOp.apply(ArithmeticOpTable.forStamp(input.stamp(NodeView.DEFAULT))).foldStamp(inputBits, resultBits, input.stamp(NodeView.DEFAULT)), input);</span>
<span class="udiff-line-removed">-         this.getOp = getOp;</span>
<span class="udiff-line-removed">-         this.getReverseOp = getReverseOp;</span>
<span class="udiff-line-modified-added">+     protected IntegerConvertNode(NodeClass&lt;? extends IntegerConvertNode&lt;OP, REV&gt;&gt; c, IntegerConvertOp&lt;OP&gt; opForStampComputation, int inputBits, int resultBits, ValueNode input) {</span>
<span class="udiff-line-modified-added">+         super(c, opForStampComputation.foldStamp(inputBits, resultBits, input.stamp(NodeView.DEFAULT)), input);</span>
          this.inputBits = inputBits;
          this.resultBits = resultBits;
<span class="udiff-line-modified-removed">-         assert ((PrimitiveStamp) input.stamp(NodeView.DEFAULT)).getBits() == inputBits;</span>
<span class="udiff-line-modified-added">+         assert PrimitiveStamp.getBits(input.stamp(NodeView.DEFAULT)) == 0 || PrimitiveStamp.getBits(input.stamp(NodeView.DEFAULT)) == inputBits;</span>
      }
  
      public int getInputBits() {
          return inputBits;
      }
  
      public int getResultBits() {
          return resultBits;
      }
  
<span class="udiff-line-modified-removed">-     protected final IntegerConvertOp&lt;OP&gt; getOp(ValueNode forValue) {</span>
<span class="udiff-line-modified-removed">-         return getOp.apply(ArithmeticOpTable.forStamp(forValue.stamp(NodeView.DEFAULT)));</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+     protected abstract IntegerConvertOp&lt;OP&gt; getOp(ArithmeticOpTable table);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     protected abstract IntegerConvertOp&lt;REV&gt; getReverseOp(ArithmeticOpTable table);</span>
  
      @Override
      public final IntegerConvertOp&lt;OP&gt; getArithmeticOp() {
<span class="udiff-line-modified-removed">-         return getOp(getValue());</span>
<span class="udiff-line-modified-added">+         return getOp(getArithmeticOpTable(getValue()));</span>
      }
  
      @Override
      public Constant convert(Constant c, ConstantReflectionProvider constantReflection) {
          return getArithmeticOp().foldConstant(getInputBits(), getResultBits(), c);
      }
  
      @Override
      public Constant reverse(Constant c, ConstantReflectionProvider constantReflection) {
<span class="udiff-line-modified-removed">-         IntegerConvertOp&lt;REV&gt; reverse = getReverseOp.apply(ArithmeticOpTable.forStamp(stamp(NodeView.DEFAULT)));</span>
<span class="udiff-line-modified-added">+         IntegerConvertOp&lt;REV&gt; reverse = getReverseOp(ArithmeticOpTable.forStamp(stamp(NodeView.DEFAULT)));</span>
          return reverse.foldConstant(getResultBits(), getInputBits(), c);
      }
  
      @Override
      public Stamp foldStamp(Stamp newStamp) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -106,11 +96,11 @@</span>
          return getArithmeticOp().foldStamp(inputBits, resultBits, newStamp);
      }
  
      @Override
      public ValueNode canonical(CanonicalizerTool tool, ValueNode forValue) {
<span class="udiff-line-modified-removed">-         ValueNode synonym = findSynonym(getOp(forValue), forValue, inputBits, resultBits, stamp(NodeView.DEFAULT));</span>
<span class="udiff-line-modified-added">+         ValueNode synonym = findSynonym(getOp(getArithmeticOpTable(forValue)), forValue, inputBits, resultBits, stamp(NodeView.DEFAULT));</span>
          if (synonym != null) {
              return synonym;
          }
          return this;
      }
</pre>
<center><a href="FloatEqualsNode.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="IntegerDivRemNode.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>