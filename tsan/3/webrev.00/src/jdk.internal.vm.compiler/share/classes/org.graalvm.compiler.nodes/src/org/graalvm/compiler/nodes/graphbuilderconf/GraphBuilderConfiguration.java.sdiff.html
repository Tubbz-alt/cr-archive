<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/graphbuilderconf/GraphBuilderConfiguration.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="GeneratedInvocationPlugin.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="GraphBuilderContext.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/graphbuilderconf/GraphBuilderConfiguration.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
184         }
185 
186         public StampPair getOverridingStamp(GraphBuilderTool b, JavaType type, boolean nonNull) {
187             for (TypePlugin plugin : getTypePlugins()) {
188                 StampPair stamp = plugin.interceptType(b, type, nonNull);
189                 if (stamp != null) {
190                     return stamp;
191                 }
192             }
193             return null;
194         }
195     }
196 
197     private final boolean eagerResolving;
198     private final boolean unresolvedIsError;
199     private final BytecodeExceptionMode bytecodeExceptionMode;
200     private final boolean omitAssertions;
201     private final List&lt;ResolvedJavaType&gt; skippedExceptionTypes;
202     private final boolean insertFullInfopoints;
203     private final boolean trackNodeSourcePosition;

204     private final Plugins plugins;

205 
206     public enum BytecodeExceptionMode {
207         /**
208          * This mode always explicitly checks for exceptions.
209          */
210         CheckAll,
211         /**
212          * This mode omits all explicit exception edges.
213          */
214         OmitAll,
215         /**
216          * This mode omits exception edges at invokes, but not for implicit null checks or bounds
217          * checks.
218          */
219         ExplicitOnly,
220         /**
221          * This mode uses profiling information to decide whether to use explicit exception edges.
222          */
223         Profile
224     }
225 
226     private GraphBuilderConfiguration(boolean eagerResolving,
227                     boolean unresolvedIsError,
228                     BytecodeExceptionMode bytecodeExceptionMode,
229                     boolean omitAssertions,
230                     boolean insertFullInfopoints,
231                     boolean trackNodeSourcePosition,


232                     List&lt;ResolvedJavaType&gt; skippedExceptionTypes,
233                     Plugins plugins) {
234         this.eagerResolving = eagerResolving;
235         this.unresolvedIsError = unresolvedIsError;
236         this.bytecodeExceptionMode = bytecodeExceptionMode;
237         this.omitAssertions = omitAssertions;
238         this.insertFullInfopoints = insertFullInfopoints;
239         this.trackNodeSourcePosition = trackNodeSourcePosition;


240         this.skippedExceptionTypes = skippedExceptionTypes;
241         this.plugins = plugins;
242     }
243 
244     /**
245      * Creates a copy of this configuration with all its plugins. The {@link InvocationPlugins} in
246      * this configuration become the {@linkplain InvocationPlugins#getParent() parent} of the
247      * {@link InvocationPlugins} in the copy.
248      */
249     public GraphBuilderConfiguration copy() {
250         Plugins newPlugins = new Plugins(plugins);
251         GraphBuilderConfiguration result = new GraphBuilderConfiguration(
252                         eagerResolving,
253                         unresolvedIsError,
254                         bytecodeExceptionMode,
255                         omitAssertions,
256                         insertFullInfopoints,
257                         trackNodeSourcePosition,


258                         skippedExceptionTypes,
259                         newPlugins);
260         return result;
261     }
262 
263     /**
264      * Set the {@link #unresolvedIsError} flag. This flag can be set independently from
265      * {@link #eagerResolving}, i.e., even if eager resolving fails execution is assumed to be
266      * valid. This allows us for example to process unresolved types/methods/fields even when
267      * eagerly resolving elements.
268      */
269     public GraphBuilderConfiguration withUnresolvedIsError(boolean newUnresolvedIsError) {
270         return new GraphBuilderConfiguration(
271                         eagerResolving,
272                         newUnresolvedIsError,
273                         bytecodeExceptionMode,
274                         omitAssertions,
275                         insertFullInfopoints,
276                         trackNodeSourcePosition,


277                         skippedExceptionTypes,
278                         plugins);
279     }
280 
281     public GraphBuilderConfiguration withEagerResolving(boolean newEagerResolving) {
282         return new GraphBuilderConfiguration(
283                         newEagerResolving,
284                         unresolvedIsError,
285                         bytecodeExceptionMode,
286                         omitAssertions,
287                         insertFullInfopoints,
288                         trackNodeSourcePosition,


289                         skippedExceptionTypes,
290                         plugins);
291     }
292 
293     public GraphBuilderConfiguration withSkippedExceptionTypes(ResolvedJavaType[] newSkippedExceptionTypes) {
294         return new GraphBuilderConfiguration(
295                         eagerResolving,
296                         unresolvedIsError,
297                         bytecodeExceptionMode,
298                         omitAssertions,
299                         insertFullInfopoints,
300                         trackNodeSourcePosition,


301                         Collections.unmodifiableList(Arrays.asList(newSkippedExceptionTypes)),
302                         plugins);
303     }
304 
305     public GraphBuilderConfiguration withBytecodeExceptionMode(BytecodeExceptionMode newBytecodeExceptionMode) {
306         return new GraphBuilderConfiguration(eagerResolving,
307                         unresolvedIsError,
308                         newBytecodeExceptionMode,
309                         omitAssertions,
310                         insertFullInfopoints,
311                         trackNodeSourcePosition,


312                         skippedExceptionTypes,
313                         plugins);
314     }
315 
316     public GraphBuilderConfiguration withOmitAssertions(boolean newOmitAssertions) {
317         return new GraphBuilderConfiguration(
318                         eagerResolving,
319                         unresolvedIsError,
320                         bytecodeExceptionMode,
321                         newOmitAssertions,
322                         insertFullInfopoints,
323                         trackNodeSourcePosition,


324                         skippedExceptionTypes,
325                         plugins);
326     }
327 
328     public GraphBuilderConfiguration withFullInfopoints(boolean newInsertFullInfopoints) {
329         return new GraphBuilderConfiguration(
330                         eagerResolving,
331                         unresolvedIsError,
332                         bytecodeExceptionMode,
333                         omitAssertions,
334                         newInsertFullInfopoints,
335                         trackNodeSourcePosition,


336                         skippedExceptionTypes,
337                         plugins);
338     }
339 
340     public GraphBuilderConfiguration withNodeSourcePosition(boolean newTrackNodeSourcePosition) {
341         return new GraphBuilderConfiguration(
342                         eagerResolving,
343                         unresolvedIsError,
344                         bytecodeExceptionMode,
345                         omitAssertions,
346                         insertFullInfopoints,
347                         newTrackNodeSourcePosition,






























348                         skippedExceptionTypes,
349                         plugins);
350     }
351 
352     public List&lt;ResolvedJavaType&gt; getSkippedExceptionTypes() {
353         return skippedExceptionTypes;
354     }
355 
356     public boolean eagerResolving() {
357         return eagerResolving;
358     }
359 
360     public BytecodeExceptionMode getBytecodeExceptionMode() {
361         return bytecodeExceptionMode;
362     }
363 
364     public boolean omitAssertions() {
365         return omitAssertions;
366     }
367 
368     public boolean trackNodeSourcePosition() {
369         return trackNodeSourcePosition;
370     }
371 




372     public boolean insertFullInfopoints() {
373         return insertFullInfopoints;
374     }
375 




376     public static GraphBuilderConfiguration getDefault(Plugins plugins) {
377         return new GraphBuilderConfiguration(
378                         /* eagerResolving: */ false,
379                         /* unresolvedIsError: */ false,
380                         BytecodeExceptionMode.Profile,
381                         /* omitAssertions: */ false,
382                         /* insertFullInfopoints: */ false,
383                         /* trackNodeSourcePosition: */ false,


384                         Collections.emptyList(),
385                         plugins);
386     }
387 
388     public static GraphBuilderConfiguration getSnippetDefault(Plugins plugins) {
389         return new GraphBuilderConfiguration(
390                         /* eagerResolving: */ true,
391                         /* unresolvedIsError: */ true,
392                         BytecodeExceptionMode.OmitAll,
393                         /* omitAssertions: */ false,
394                         /* insertFullInfopoints: */ false,
395                         /* trackNodeSourcePosition: */ false,


396                         Collections.emptyList(),
397                         plugins);
398     }
399 
400     /** Returns {@code true} if it is an error for a class/field/method resolution to fail. */
401     public boolean unresolvedIsError() {
402         return unresolvedIsError;
403     }
404 
405     public Plugins getPlugins() {
406         return plugins;
407     }
408 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
</pre>
<hr />
<pre>
184         }
185 
186         public StampPair getOverridingStamp(GraphBuilderTool b, JavaType type, boolean nonNull) {
187             for (TypePlugin plugin : getTypePlugins()) {
188                 StampPair stamp = plugin.interceptType(b, type, nonNull);
189                 if (stamp != null) {
190                     return stamp;
191                 }
192             }
193             return null;
194         }
195     }
196 
197     private final boolean eagerResolving;
198     private final boolean unresolvedIsError;
199     private final BytecodeExceptionMode bytecodeExceptionMode;
200     private final boolean omitAssertions;
201     private final List&lt;ResolvedJavaType&gt; skippedExceptionTypes;
202     private final boolean insertFullInfopoints;
203     private final boolean trackNodeSourcePosition;
<span class="line-added">204     private final boolean retainLocalVariables;</span>
205     private final Plugins plugins;
<span class="line-added">206     private final boolean replaceLocalsWithConstants;</span>
207 
208     public enum BytecodeExceptionMode {
209         /**
210          * This mode always explicitly checks for exceptions.
211          */
212         CheckAll,
213         /**
214          * This mode omits all explicit exception edges.
215          */
216         OmitAll,
217         /**
218          * This mode omits exception edges at invokes, but not for implicit null checks or bounds
219          * checks.
220          */
221         ExplicitOnly,
222         /**
223          * This mode uses profiling information to decide whether to use explicit exception edges.
224          */
225         Profile
226     }
227 
228     private GraphBuilderConfiguration(boolean eagerResolving,
229                     boolean unresolvedIsError,
230                     BytecodeExceptionMode bytecodeExceptionMode,
231                     boolean omitAssertions,
232                     boolean insertFullInfopoints,
233                     boolean trackNodeSourcePosition,
<span class="line-added">234                     boolean retainLocalVariables,</span>
<span class="line-added">235                     boolean replaceLocalsWithConstants,</span>
236                     List&lt;ResolvedJavaType&gt; skippedExceptionTypes,
237                     Plugins plugins) {
238         this.eagerResolving = eagerResolving;
239         this.unresolvedIsError = unresolvedIsError;
240         this.bytecodeExceptionMode = bytecodeExceptionMode;
241         this.omitAssertions = omitAssertions;
242         this.insertFullInfopoints = insertFullInfopoints;
243         this.trackNodeSourcePosition = trackNodeSourcePosition;
<span class="line-added">244         this.retainLocalVariables = retainLocalVariables;</span>
<span class="line-added">245         this.replaceLocalsWithConstants = replaceLocalsWithConstants;</span>
246         this.skippedExceptionTypes = skippedExceptionTypes;
247         this.plugins = plugins;
248     }
249 
250     /**
251      * Creates a copy of this configuration with all its plugins. The {@link InvocationPlugins} in
252      * this configuration become the {@linkplain InvocationPlugins#getParent() parent} of the
253      * {@link InvocationPlugins} in the copy.
254      */
255     public GraphBuilderConfiguration copy() {
256         Plugins newPlugins = new Plugins(plugins);
257         GraphBuilderConfiguration result = new GraphBuilderConfiguration(
258                         eagerResolving,
259                         unresolvedIsError,
260                         bytecodeExceptionMode,
261                         omitAssertions,
262                         insertFullInfopoints,
263                         trackNodeSourcePosition,
<span class="line-added">264                         retainLocalVariables,</span>
<span class="line-added">265                         replaceLocalsWithConstants,</span>
266                         skippedExceptionTypes,
267                         newPlugins);
268         return result;
269     }
270 
271     /**
272      * Set the {@link #unresolvedIsError} flag. This flag can be set independently from
273      * {@link #eagerResolving}, i.e., even if eager resolving fails execution is assumed to be
274      * valid. This allows us for example to process unresolved types/methods/fields even when
275      * eagerly resolving elements.
276      */
277     public GraphBuilderConfiguration withUnresolvedIsError(boolean newUnresolvedIsError) {
278         return new GraphBuilderConfiguration(
279                         eagerResolving,
280                         newUnresolvedIsError,
281                         bytecodeExceptionMode,
282                         omitAssertions,
283                         insertFullInfopoints,
284                         trackNodeSourcePosition,
<span class="line-added">285                         retainLocalVariables,</span>
<span class="line-added">286                         replaceLocalsWithConstants,</span>
287                         skippedExceptionTypes,
288                         plugins);
289     }
290 
291     public GraphBuilderConfiguration withEagerResolving(boolean newEagerResolving) {
292         return new GraphBuilderConfiguration(
293                         newEagerResolving,
294                         unresolvedIsError,
295                         bytecodeExceptionMode,
296                         omitAssertions,
297                         insertFullInfopoints,
298                         trackNodeSourcePosition,
<span class="line-added">299                         retainLocalVariables,</span>
<span class="line-added">300                         replaceLocalsWithConstants,</span>
301                         skippedExceptionTypes,
302                         plugins);
303     }
304 
305     public GraphBuilderConfiguration withSkippedExceptionTypes(ResolvedJavaType[] newSkippedExceptionTypes) {
306         return new GraphBuilderConfiguration(
307                         eagerResolving,
308                         unresolvedIsError,
309                         bytecodeExceptionMode,
310                         omitAssertions,
311                         insertFullInfopoints,
312                         trackNodeSourcePosition,
<span class="line-added">313                         retainLocalVariables,</span>
<span class="line-added">314                         replaceLocalsWithConstants,</span>
315                         Collections.unmodifiableList(Arrays.asList(newSkippedExceptionTypes)),
316                         plugins);
317     }
318 
319     public GraphBuilderConfiguration withBytecodeExceptionMode(BytecodeExceptionMode newBytecodeExceptionMode) {
320         return new GraphBuilderConfiguration(eagerResolving,
321                         unresolvedIsError,
322                         newBytecodeExceptionMode,
323                         omitAssertions,
324                         insertFullInfopoints,
325                         trackNodeSourcePosition,
<span class="line-added">326                         retainLocalVariables,</span>
<span class="line-added">327                         replaceLocalsWithConstants,</span>
328                         skippedExceptionTypes,
329                         plugins);
330     }
331 
332     public GraphBuilderConfiguration withOmitAssertions(boolean newOmitAssertions) {
333         return new GraphBuilderConfiguration(
334                         eagerResolving,
335                         unresolvedIsError,
336                         bytecodeExceptionMode,
337                         newOmitAssertions,
338                         insertFullInfopoints,
339                         trackNodeSourcePosition,
<span class="line-added">340                         retainLocalVariables,</span>
<span class="line-added">341                         replaceLocalsWithConstants,</span>
342                         skippedExceptionTypes,
343                         plugins);
344     }
345 
346     public GraphBuilderConfiguration withFullInfopoints(boolean newInsertFullInfopoints) {
347         return new GraphBuilderConfiguration(
348                         eagerResolving,
349                         unresolvedIsError,
350                         bytecodeExceptionMode,
351                         omitAssertions,
352                         newInsertFullInfopoints,
353                         trackNodeSourcePosition,
<span class="line-added">354                         retainLocalVariables,</span>
<span class="line-added">355                         replaceLocalsWithConstants,</span>
356                         skippedExceptionTypes,
357                         plugins);
358     }
359 
360     public GraphBuilderConfiguration withNodeSourcePosition(boolean newTrackNodeSourcePosition) {
361         return new GraphBuilderConfiguration(
362                         eagerResolving,
363                         unresolvedIsError,
364                         bytecodeExceptionMode,
365                         omitAssertions,
366                         insertFullInfopoints,
367                         newTrackNodeSourcePosition,
<span class="line-added">368                         retainLocalVariables,</span>
<span class="line-added">369                         replaceLocalsWithConstants,</span>
<span class="line-added">370                         skippedExceptionTypes,</span>
<span class="line-added">371                         plugins);</span>
<span class="line-added">372     }</span>
<span class="line-added">373 </span>
<span class="line-added">374     public GraphBuilderConfiguration withRetainLocalVariables(boolean newRetainLocalVariables) {</span>
<span class="line-added">375         return new GraphBuilderConfiguration(</span>
<span class="line-added">376                         eagerResolving,</span>
<span class="line-added">377                         unresolvedIsError,</span>
<span class="line-added">378                         bytecodeExceptionMode,</span>
<span class="line-added">379                         omitAssertions,</span>
<span class="line-added">380                         insertFullInfopoints,</span>
<span class="line-added">381                         trackNodeSourcePosition,</span>
<span class="line-added">382                         newRetainLocalVariables,</span>
<span class="line-added">383                         replaceLocalsWithConstants,</span>
<span class="line-added">384                         skippedExceptionTypes,</span>
<span class="line-added">385                         plugins);</span>
<span class="line-added">386     }</span>
<span class="line-added">387 </span>
<span class="line-added">388     public GraphBuilderConfiguration withReplaceLocalsWithConstants(boolean newReplaceLocalsWithConstants) {</span>
<span class="line-added">389         return new GraphBuilderConfiguration(</span>
<span class="line-added">390                         eagerResolving,</span>
<span class="line-added">391                         unresolvedIsError,</span>
<span class="line-added">392                         bytecodeExceptionMode,</span>
<span class="line-added">393                         omitAssertions,</span>
<span class="line-added">394                         insertFullInfopoints,</span>
<span class="line-added">395                         trackNodeSourcePosition,</span>
<span class="line-added">396                         retainLocalVariables,</span>
<span class="line-added">397                         newReplaceLocalsWithConstants,</span>
398                         skippedExceptionTypes,
399                         plugins);
400     }
401 
402     public List&lt;ResolvedJavaType&gt; getSkippedExceptionTypes() {
403         return skippedExceptionTypes;
404     }
405 
406     public boolean eagerResolving() {
407         return eagerResolving;
408     }
409 
410     public BytecodeExceptionMode getBytecodeExceptionMode() {
411         return bytecodeExceptionMode;
412     }
413 
414     public boolean omitAssertions() {
415         return omitAssertions;
416     }
417 
418     public boolean trackNodeSourcePosition() {
419         return trackNodeSourcePosition;
420     }
421 
<span class="line-added">422     public boolean retainLocalVariables() {</span>
<span class="line-added">423         return retainLocalVariables;</span>
<span class="line-added">424     }</span>
<span class="line-added">425 </span>
426     public boolean insertFullInfopoints() {
427         return insertFullInfopoints;
428     }
429 
<span class="line-added">430     public boolean replaceLocalsWithConstants() {</span>
<span class="line-added">431         return this.replaceLocalsWithConstants;</span>
<span class="line-added">432     }</span>
<span class="line-added">433 </span>
434     public static GraphBuilderConfiguration getDefault(Plugins plugins) {
435         return new GraphBuilderConfiguration(
436                         /* eagerResolving: */ false,
437                         /* unresolvedIsError: */ false,
438                         BytecodeExceptionMode.Profile,
439                         /* omitAssertions: */ false,
440                         /* insertFullInfopoints: */ false,
441                         /* trackNodeSourcePosition: */ false,
<span class="line-added">442                         /* retainLocalVariables */ false,</span>
<span class="line-added">443                         /* replaceLocalsWithConstants */ false,</span>
444                         Collections.emptyList(),
445                         plugins);
446     }
447 
448     public static GraphBuilderConfiguration getSnippetDefault(Plugins plugins) {
449         return new GraphBuilderConfiguration(
450                         /* eagerResolving: */ true,
451                         /* unresolvedIsError: */ true,
452                         BytecodeExceptionMode.OmitAll,
453                         /* omitAssertions: */ false,
454                         /* insertFullInfopoints: */ false,
455                         /* trackNodeSourcePosition: */ false,
<span class="line-added">456                         /* retainLocalVariables */ false,</span>
<span class="line-added">457                         /* replaceLocalsWithConstants */ false,</span>
458                         Collections.emptyList(),
459                         plugins);
460     }
461 
462     /** Returns {@code true} if it is an error for a class/field/method resolution to fail. */
463     public boolean unresolvedIsError() {
464         return unresolvedIsError;
465     }
466 
467     public Plugins getPlugins() {
468         return plugins;
469     }
470 }
</pre>
</td>
</tr>
</table>
<center><a href="GeneratedInvocationPlugin.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="GraphBuilderContext.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>