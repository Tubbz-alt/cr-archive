<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/calc/SignedRemNode.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SignedDivNode.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="SqrtNode.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/calc/SignedRemNode.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 82,11 ***</span>
              long constY = forY.asJavaConstant().asLong();
              IntegerStamp xStamp = (IntegerStamp) forX.stamp(view);
              IntegerStamp yStamp = (IntegerStamp) forY.stamp(view);
              if (constY &lt; 0 &amp;&amp; constY != CodeUtil.minValue(yStamp.getBits())) {
                  Stamp newStamp = IntegerStamp.OPS.getRem().foldStamp(forX.stamp(view), forY.stamp(view));
<span class="line-modified">!                 return canonical(null, forX, ConstantNode.forIntegerStamp(yStamp, -constY), zeroCheck, newStamp, view, tool);</span>
              }
  
              if (constY == 1) {
                  return ConstantNode.forIntegerStamp(stamp, 0);
              } else if (CodeUtil.isPowerOf2(constY) &amp;&amp; tool != null &amp;&amp; tool.allUsagesAvailable()) {
<span class="line-new-header">--- 82,11 ---</span>
              long constY = forY.asJavaConstant().asLong();
              IntegerStamp xStamp = (IntegerStamp) forX.stamp(view);
              IntegerStamp yStamp = (IntegerStamp) forY.stamp(view);
              if (constY &lt; 0 &amp;&amp; constY != CodeUtil.minValue(yStamp.getBits())) {
                  Stamp newStamp = IntegerStamp.OPS.getRem().foldStamp(forX.stamp(view), forY.stamp(view));
<span class="line-modified">!                 return canonical(self, forX, ConstantNode.forIntegerStamp(yStamp, -constY), zeroCheck, newStamp, view, tool);</span>
              }
  
              if (constY == 1) {
                  return ConstantNode.forIntegerStamp(stamp, 0);
              } else if (CodeUtil.isPowerOf2(constY) &amp;&amp; tool != null &amp;&amp; tool.allUsagesAvailable()) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 102,34 ***</span>
                          return new NegateNode(new AndNode(new NegateNode(forX), ConstantNode.forIntegerStamp(stamp, constY - 1)));
                      }
                  }
              }
          }
<span class="line-modified">!         return self != null ? self : new SignedRemNode(forX, forY, zeroCheck);</span>
      }
  
      private static boolean allUsagesCompareAgainstZero(SignedRemNode self) {
<span class="line-modified">!         int compareAgainstZero = 0;</span>
<span class="line-modified">!         int usageCount = self.getUsageCount();</span>
<span class="line-modified">!         for (int i = 0; i &lt; usageCount; i++) {</span>
<span class="line-modified">!             Node usage = self.getUsageAt(i);</span>
              if (usage instanceof IntegerEqualsNode) {
                  IntegerEqualsNode equalsNode = (IntegerEqualsNode) usage;
                  ValueNode node = equalsNode.getY();
                  if (node == self) {
                      node = equalsNode.getX();
                  }
                  if (node instanceof ConstantNode) {
                      ConstantNode constantNode = (ConstantNode) node;
                      Constant constant = constantNode.asConstant();
                      if (constant instanceof PrimitiveConstant &amp;&amp; ((PrimitiveConstant) constant).asLong() == 0) {
<span class="line-modified">!                         compareAgainstZero++;</span>
                      }
                  }
              }
          }
<span class="line-modified">!         return compareAgainstZero == usageCount;</span>
      }
  
      @Override
      public void generate(NodeLIRBuilderTool gen) {
          gen.setResult(this, gen.getLIRGeneratorTool().getArithmetic().emitRem(gen.operand(getX()), gen.operand(getY()), gen.state(this)));
<span class="line-new-header">--- 102,41 ---</span>
                          return new NegateNode(new AndNode(new NegateNode(forX), ConstantNode.forIntegerStamp(stamp, constY - 1)));
                      }
                  }
              }
          }
<span class="line-modified">!         if (self != null &amp;&amp; self.x == forX &amp;&amp; self.y == forY) {</span>
<span class="line-added">+             return self;</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             return new SignedRemNode(forX, forY, zeroCheck);</span>
<span class="line-added">+         }</span>
      }
  
      private static boolean allUsagesCompareAgainstZero(SignedRemNode self) {
<span class="line-modified">!         if (self == null) {</span>
<span class="line-modified">!             // If the node was not yet created, then we do not know its usages yet.</span>
<span class="line-modified">!             return false;</span>
<span class="line-modified">!         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (Node usage : self.usages()) {</span>
              if (usage instanceof IntegerEqualsNode) {
                  IntegerEqualsNode equalsNode = (IntegerEqualsNode) usage;
                  ValueNode node = equalsNode.getY();
                  if (node == self) {
                      node = equalsNode.getX();
                  }
                  if (node instanceof ConstantNode) {
                      ConstantNode constantNode = (ConstantNode) node;
                      Constant constant = constantNode.asConstant();
                      if (constant instanceof PrimitiveConstant &amp;&amp; ((PrimitiveConstant) constant).asLong() == 0) {
<span class="line-modified">!                         continue;</span>
                      }
                  }
              }
<span class="line-added">+             return false;</span>
          }
<span class="line-modified">!         return true;</span>
      }
  
      @Override
      public void generate(NodeLIRBuilderTool gen) {
          gen.setResult(this, gen.getLIRGeneratorTool().getArithmetic().emitRem(gen.operand(getX()), gen.operand(getY()), gen.state(this)));
</pre>
<center><a href="SignedDivNode.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="SqrtNode.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>