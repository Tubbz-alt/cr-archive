<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/InstanceOfSnippets.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="IdentityHashCodeNode.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="MonitorSnippets.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/InstanceOfSnippets.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -28,10 +28,11 @@</span>
  import static jdk.vm.ci.meta.DeoptimizationReason.OptimizedTypeCheckViolated;
  import static org.graalvm.compiler.core.common.GraalOptions.GeneratePIC;
  import static org.graalvm.compiler.hotspot.replacements.HotSpotReplacementsUtil.PRIMARY_SUPERS_LOCATION;
  import static org.graalvm.compiler.hotspot.replacements.HotSpotReplacementsUtil.SECONDARY_SUPER_CACHE_LOCATION;
  import static org.graalvm.compiler.hotspot.replacements.HotSpotReplacementsUtil.loadHubIntrinsic;
<span class="udiff-line-added">+ import static org.graalvm.compiler.hotspot.replacements.HotSpotReplacementsUtil.loadHubOrNullIntrinsic;</span>
  import static org.graalvm.compiler.hotspot.replacements.HotspotSnippetsOptions.TypeCheckMaxHints;
  import static org.graalvm.compiler.hotspot.replacements.HotspotSnippetsOptions.TypeCheckMinProfileHitProbability;
  import static org.graalvm.compiler.hotspot.replacements.TypeCheckSnippetUtils.checkSecondarySubType;
  import static org.graalvm.compiler.hotspot.replacements.TypeCheckSnippetUtils.checkUnknownSubType;
  import static org.graalvm.compiler.hotspot.replacements.TypeCheckSnippetUtils.createHints;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -134,16 +135,11 @@</span>
      /**
       * A test against a final type.
       */
      @Snippet
      public static Object instanceofExact(Object object, KlassPointer exactHub, Object trueValue, Object falseValue, @ConstantParameter Counters counters) {
<span class="udiff-line-modified-removed">-         if (probability(NOT_FREQUENT_PROBABILITY, object == null)) {</span>
<span class="udiff-line-removed">-             counters.isNull.inc();</span>
<span class="udiff-line-removed">-             return falseValue;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         GuardingNode anchorNode = SnippetAnchorNode.anchor();</span>
<span class="udiff-line-removed">-         KlassPointer objectHub = loadHubIntrinsic(PiNode.piCastNonNull(object, anchorNode));</span>
<span class="udiff-line-modified-added">+         KlassPointer objectHub = loadHubOrNullIntrinsic(object);</span>
          if (probability(LIKELY_PROBABILITY, objectHub.notEqual(exactHub))) {
              counters.exactMiss.inc();
              return falseValue;
          }
          counters.exactHit.inc();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -222,11 +218,11 @@</span>
          return falseValue;
      }
  
      @Snippet
      public static Object isAssignableFrom(@NonNullParameter Class&lt;?&gt; thisClassNonNull, Class&lt;?&gt; otherClass, Object trueValue, Object falseValue, @ConstantParameter Counters counters) {
<span class="udiff-line-modified-removed">-         if (otherClass == null) {</span>
<span class="udiff-line-modified-added">+         if (BranchProbabilityNode.probability(BranchProbabilityNode.DEOPT_PROBABILITY, otherClass == null)) {</span>
              DeoptimizeNode.deopt(DeoptimizationAction.InvalidateReprofile, DeoptimizationReason.NullCheckException);
              return false;
          }
          GuardingNode anchorNode = SnippetAnchorNode.anchor();
          Class&lt;?&gt; otherClassNonNull = PiNode.piCastNonNullClass(otherClass, anchorNode);
</pre>
<center><a href="IdentityHashCodeNode.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="MonitorSnippets.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>