<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.aarch64/src/org/graalvm/compiler/core/aarch64/AArch64ReadNode.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AArch64NodeMatchRules.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AArch64ReadReplacementPhase.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.aarch64/src/org/graalvm/compiler/core/aarch64/AArch64ReadNode.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * Copyright (c) 2017, Red Hat Inc. All rights reserved.
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * This code is free software; you can redistribute it and/or modify it
  7  * under the terms of the GNU General Public License version 2 only, as
  8  * published by the Free Software Foundation.
  9  *
 10  * This code is distributed in the hope that it will be useful, but WITHOUT
 11  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 12  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 13  * version 2 for more details (a copy is included in the LICENSE file that
 14  * accompanied this code).
 15  *
 16  * You should have received a copy of the GNU General Public License version
 17  * 2 along with this work; if not, write to the Free Software Foundation,
 18  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19  *
 20  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21  * or visit www.oracle.com if you need additional information or have any
 22  * questions.
</pre>
<hr />
<pre>
 55     public static final NodeClass&lt;AArch64ReadNode&gt; TYPE = NodeClass.create(AArch64ReadNode.class);
 56     private final IntegerStamp accessStamp;
 57     private final boolean isSigned;
 58 
 59     public AArch64ReadNode(AddressNode address, LocationIdentity location, Stamp stamp, GuardingNode guard, BarrierType barrierType, boolean nullCheck,
 60                     FrameState stateBefore, IntegerStamp accessStamp, boolean isSigned) {
 61         super(TYPE, address, location, stamp, guard, barrierType, nullCheck, stateBefore);
 62         this.accessStamp = accessStamp;
 63         this.isSigned = isSigned;
 64     }
 65 
 66     @Override
 67     public void generate(NodeLIRBuilderTool gen) {
 68         AArch64LIRGenerator lirgen = (AArch64LIRGenerator) gen.getLIRGeneratorTool();
 69         AArch64ArithmeticLIRGenerator arithgen = (AArch64ArithmeticLIRGenerator) lirgen.getArithmetic();
 70         AArch64Kind readKind = (AArch64Kind) lirgen.getLIRKind(accessStamp).getPlatformKind();
 71         int resultBits = ((IntegerStamp) stamp(NodeView.DEFAULT)).getBits();
 72         gen.setResult(this, arithgen.emitExtendMemory(isSigned, readKind, resultBits, (AArch64AddressValue) gen.operand(getAddress()), gen.state(this)));
 73     }
 74 





 75     /**
 76      * replace a ReadNode with an AArch64-specific variant which knows how to merge a downstream
 77      * zero or sign extend into the read operation.
 78      *
 79      * @param readNode
 80      */
 81     public static void replace(ReadNode readNode) {
 82         assert readNode.getUsageCount() == 1;
<span class="line-modified"> 83         assert readNode.getUsageAt(0) instanceof ZeroExtendNode || readNode.getUsageAt(0) instanceof SignExtendNode;</span>
 84 
<span class="line-modified"> 85         ValueNode usage = (ValueNode) readNode.getUsageAt(0);</span>
 86         boolean isSigned = usage instanceof SignExtendNode;
 87         IntegerStamp accessStamp = ((IntegerStamp) readNode.getAccessStamp());
 88 
 89         AddressNode address = readNode.getAddress();
 90         LocationIdentity location = readNode.getLocationIdentity();
 91         Stamp stamp = usage.stamp(NodeView.DEFAULT);
 92         GuardingNode guard = readNode.getGuard();
 93         BarrierType barrierType = readNode.getBarrierType();
 94         boolean nullCheck = readNode.getNullCheck();
 95         FrameState stateBefore = readNode.stateBefore();
 96         AArch64ReadNode clone = new AArch64ReadNode(address, location, stamp, guard, barrierType, nullCheck, stateBefore, accessStamp, isSigned);
 97         StructuredGraph graph = readNode.graph();
 98         graph.add(clone);
 99         // splice out the extend node
100         usage.replaceAtUsagesAndDelete(readNode);
101         // swap the clone for the read
102         graph.replaceFixedWithFixed(readNode, clone);
103     }
104 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * Copyright (c) 2017, Red Hat Inc. All rights reserved.
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * This code is free software; you can redistribute it and/or modify it
  7  * under the terms of the GNU General Public License version 2 only, as
  8  * published by the Free Software Foundation.
  9  *
 10  * This code is distributed in the hope that it will be useful, but WITHOUT
 11  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 12  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 13  * version 2 for more details (a copy is included in the LICENSE file that
 14  * accompanied this code).
 15  *
 16  * You should have received a copy of the GNU General Public License version
 17  * 2 along with this work; if not, write to the Free Software Foundation,
 18  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 19  *
 20  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 21  * or visit www.oracle.com if you need additional information or have any
 22  * questions.
</pre>
<hr />
<pre>
 55     public static final NodeClass&lt;AArch64ReadNode&gt; TYPE = NodeClass.create(AArch64ReadNode.class);
 56     private final IntegerStamp accessStamp;
 57     private final boolean isSigned;
 58 
 59     public AArch64ReadNode(AddressNode address, LocationIdentity location, Stamp stamp, GuardingNode guard, BarrierType barrierType, boolean nullCheck,
 60                     FrameState stateBefore, IntegerStamp accessStamp, boolean isSigned) {
 61         super(TYPE, address, location, stamp, guard, barrierType, nullCheck, stateBefore);
 62         this.accessStamp = accessStamp;
 63         this.isSigned = isSigned;
 64     }
 65 
 66     @Override
 67     public void generate(NodeLIRBuilderTool gen) {
 68         AArch64LIRGenerator lirgen = (AArch64LIRGenerator) gen.getLIRGeneratorTool();
 69         AArch64ArithmeticLIRGenerator arithgen = (AArch64ArithmeticLIRGenerator) lirgen.getArithmetic();
 70         AArch64Kind readKind = (AArch64Kind) lirgen.getLIRKind(accessStamp).getPlatformKind();
 71         int resultBits = ((IntegerStamp) stamp(NodeView.DEFAULT)).getBits();
 72         gen.setResult(this, arithgen.emitExtendMemory(isSigned, readKind, resultBits, (AArch64AddressValue) gen.operand(getAddress()), gen.state(this)));
 73     }
 74 
<span class="line-added"> 75     @Override</span>
<span class="line-added"> 76     public Stamp getAccessStamp() {</span>
<span class="line-added"> 77         return accessStamp;</span>
<span class="line-added"> 78     }</span>
<span class="line-added"> 79 </span>
 80     /**
 81      * replace a ReadNode with an AArch64-specific variant which knows how to merge a downstream
 82      * zero or sign extend into the read operation.
 83      *
 84      * @param readNode
 85      */
 86     public static void replace(ReadNode readNode) {
 87         assert readNode.getUsageCount() == 1;
<span class="line-modified"> 88         assert readNode.usages().first() instanceof ZeroExtendNode || readNode.usages().first() instanceof SignExtendNode;</span>
 89 
<span class="line-modified"> 90         ValueNode usage = (ValueNode) readNode.usages().first();</span>
 91         boolean isSigned = usage instanceof SignExtendNode;
 92         IntegerStamp accessStamp = ((IntegerStamp) readNode.getAccessStamp());
 93 
 94         AddressNode address = readNode.getAddress();
 95         LocationIdentity location = readNode.getLocationIdentity();
 96         Stamp stamp = usage.stamp(NodeView.DEFAULT);
 97         GuardingNode guard = readNode.getGuard();
 98         BarrierType barrierType = readNode.getBarrierType();
 99         boolean nullCheck = readNode.getNullCheck();
100         FrameState stateBefore = readNode.stateBefore();
101         AArch64ReadNode clone = new AArch64ReadNode(address, location, stamp, guard, barrierType, nullCheck, stateBefore, accessStamp, isSigned);
102         StructuredGraph graph = readNode.graph();
103         graph.add(clone);
104         // splice out the extend node
105         usage.replaceAtUsagesAndDelete(readNode);
106         // swap the clone for the read
107         graph.replaceFixedWithFixed(readNode, clone);
108     }
109 }
</pre>
</td>
</tr>
</table>
<center><a href="AArch64NodeMatchRules.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AArch64ReadReplacementPhase.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>