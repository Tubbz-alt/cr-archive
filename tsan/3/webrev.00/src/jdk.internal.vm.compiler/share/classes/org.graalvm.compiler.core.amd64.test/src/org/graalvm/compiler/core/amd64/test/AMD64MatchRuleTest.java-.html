<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.internal.vm.compiler/share/classes/org.graalvm.compiler.core.amd64.test/src/org/graalvm/compiler/core/amd64/test/AMD64MatchRuleTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  *
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.
 8  *
 9  * This code is distributed in the hope that it will be useful, but WITHOUT
10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
12  * version 2 for more details (a copy is included in the LICENSE file that
13  * accompanied this code).
14  *
15  * You should have received a copy of the GNU General Public License version
16  * 2 along with this work; if not, write to the Free Software Foundation,
17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
18  *
19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
20  * or visit www.oracle.com if you need additional information or have any
21  * questions.
22  */
23 
24 
25 package org.graalvm.compiler.core.amd64.test;
26 
27 import static org.junit.Assume.assumeTrue;
28 
29 import org.graalvm.compiler.core.test.MatchRuleTest;
30 import org.graalvm.compiler.lir.LIR;
31 import org.graalvm.compiler.lir.LIRInstruction;
32 import org.graalvm.compiler.lir.amd64.AMD64BinaryConsumer.MemoryConstOp;
33 import org.junit.Before;
34 import org.junit.Test;
35 
36 import jdk.vm.ci.amd64.AMD64;
37 
38 public class AMD64MatchRuleTest extends MatchRuleTest {
39     @Before
40     public void checkAMD64() {
41         assumeTrue(&quot;skipping AMD64 specific test&quot;, getTarget().arch instanceof AMD64);
42     }
43 
44     public static int test1Snippet(TestClass o, TestClass b, TestClass c) {
45         if (o.x == 42) {
46             return b.z;
47         } else {
48             return c.y;
49         }
50     }
51 
52     /**
53      * Verifies, if the match rules in AMD64NodeMatchRules do work on the graphs by compiling and
54      * checking if the expected LIR instruction show up.
55      */
56     @Test
57     public void test1() {
58         compile(getResolvedJavaMethod(&quot;test1Snippet&quot;), null);
59         LIR lir = getLIR();
60         boolean found = false;
61         for (LIRInstruction ins : lir.getLIRforBlock(lir.codeEmittingOrder()[0])) {
62             if (ins instanceof MemoryConstOp &amp;&amp; ((MemoryConstOp) ins).getOpcode().toString().equals(&quot;CMP&quot;)) {
63                 assertFalse(&quot;MemoryConstOp expected only once in first block&quot;, found);
64                 found = true;
65             }
66         }
67         assertTrue(&quot;Memory compare must be in the LIR&quot;, found);
68     }
69 
70     public static class TestClass {
71         public int x;
72         public int y;
73         public int z;
74 
75         public TestClass(int x) {
76             super();
77             this.x = x;
78         }
79     }
80 }
    </pre>
  </body>
</html>