<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/java.sql.rowset/share/classes/javax/sql/rowset/spi/SyncProvider.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package javax.sql.rowset.spi;
 27 
 28 import javax.sql.*;
 29 
 30 /**
 31  * The synchronization mechanism that provides reader/writer capabilities for
 32  * disconnected &lt;code&gt;RowSet&lt;/code&gt; objects.
 33  * A &lt;code&gt;SyncProvider&lt;/code&gt; implementation is a class that extends the
 34  * &lt;code&gt;SyncProvider&lt;/code&gt; abstract class.
 35  * &lt;P&gt;
 36  * A &lt;code&gt;SyncProvider&lt;/code&gt; implementation is
 37  * identified by a unique ID, which is its fully qualified class name.
 38  * This name must be registered with the
 39  * &lt;code&gt;SyncFactory&lt;/code&gt; SPI, thus making the implementation available to
 40  * all &lt;code&gt;RowSet&lt;/code&gt; implementations.
 41  * The factory mechanism in the reference implementation uses this name to instantiate
 42  * the implementation, which can then provide a &lt;code&gt;RowSet&lt;/code&gt; object with its
 43  * reader (a &lt;code&gt;javax.sql.RowSetReader&lt;/code&gt; object) and its writer (a
 44  * &lt;code&gt;javax.sql.RowSetWriter&lt;/code&gt; object).
 45  * &lt;P&gt;
 46  * The Jdbc &lt;code&gt;RowSet&lt;/code&gt; Implementations specification provides two
 47  * reference implementations of the &lt;code&gt;SyncProvider&lt;/code&gt; abstract class:
 48  * &lt;code&gt;RIOptimisticProvider&lt;/code&gt; and &lt;code&gt;RIXMLProvider&lt;/code&gt;.
 49  * The &lt;code&gt;RIOptimisticProvider&lt;/code&gt; can set any &lt;code&gt;RowSet&lt;/code&gt;
 50  * implementation with a &lt;code&gt;RowSetReader&lt;/code&gt; object and a
 51  * &lt;code&gt;RowSetWriter&lt;/code&gt; object.  However, only the &lt;code&gt;RIXMLProvider&lt;/code&gt;
 52  * implementation can set an &lt;code&gt;XmlReader&lt;/code&gt; object and an
 53  * &lt;code&gt;XmlWriter&lt;/code&gt; object. A &lt;code&gt;WebRowSet&lt;/code&gt; object uses the
 54  * &lt;code&gt;XmlReader&lt;/code&gt; object to read data in XML format to populate itself with that
 55  * data.  It uses the &lt;code&gt;XmlWriter&lt;/code&gt; object to write itself to a stream or
 56  * &lt;code&gt;java.io.Writer&lt;/code&gt; object in XML format.
 57  *
 58  * &lt;h2&gt;1.0 Naming Convention for Implementations&lt;/h2&gt;
 59  * As a guide  to naming &lt;code&gt;SyncProvider&lt;/code&gt;
 60  * implementations, the following should be noted:
 61  * &lt;UL&gt;
 62  * &lt;li&gt;The name for a &lt;code&gt;SyncProvider&lt;/code&gt; implementation
 63  * is its fully qualified class name.
 64  * &lt;li&gt;It is recommended that vendors supply a
 65  * &lt;code&gt;SyncProvider&lt;/code&gt; implementation in a package named &lt;code&gt;providers&lt;/code&gt;.
 66  * &lt;/UL&gt;
 67  * &lt;p&gt;
 68  * For instance, if a vendor named Fred, Inc. offered a
 69  * &lt;code&gt;SyncProvider&lt;/code&gt; implementation, you could have the following:
 70  * &lt;PRE&gt;
 71  *     Vendor name:  Fred, Inc.
 72  *     Domain name of vendor:  com.fred
 73  *     Package name:  com.fred.providers
 74  *     SyncProvider implementation class name:  HighAvailabilityProvider
 75  *
 76  *     Fully qualified class name of SyncProvider implementation:
 77  *                        com.fred.providers.HighAvailabilityProvider
 78  * &lt;/PRE&gt;
 79  * &lt;P&gt;
 80  * The following line of code uses the fully qualified name to register
 81  * this implementation with the &lt;code&gt;SyncFactory&lt;/code&gt; static instance.
 82  * &lt;PRE&gt;
 83  *     SyncFactory.registerProvider(
 84  *                          &quot;com.fred.providers.HighAvailabilityProvider&quot;);
 85  * &lt;/PRE&gt;
 86  * &lt;P&gt;
 87  * The default &lt;code&gt;SyncProvider&lt;/code&gt; object provided with the reference
 88  * implementation uses the following name:
 89  * &lt;pre&gt;
 90  *     com.sun.rowset.providers.RIOptimisticProvider
 91  * &lt;/pre&gt;
 92  * &lt;p&gt;
 93  * Vendors should refer to the reference implementation synchronization
 94  * providers for additional guidance on how to implement a new
 95  * &lt;code&gt;SyncProvider&lt;/code&gt; implementation.
 96  *
 97  * &lt;h2&gt;2.0 How a &lt;code&gt;RowSet&lt;/code&gt; Object Gets Its Provider&lt;/h2&gt;
 98  *
 99  * A disconnected &lt;code&gt;Rowset&lt;/code&gt; object may get access to a
100  * &lt;code&gt;SyncProvider&lt;/code&gt; object in one of the following two ways:
101  * &lt;UL&gt;
102  *  &lt;LI&gt;Using a constructor&lt;BR&gt;
103  *      &lt;PRE&gt;
104  *       CachedRowSet crs = new CachedRowSet(
105  *                  &quot;com.fred.providers.HighAvailabilitySyncProvider&quot;);
106  *      &lt;/PRE&gt;
107  *  &lt;LI&gt;Using the &lt;code&gt;setSyncProvider&lt;/code&gt; method
108  *      &lt;PRE&gt;
109  *       CachedRowSet crs = new CachedRowSet();
110  *       crs.setSyncProvider(&quot;com.fred.providers.HighAvailabilitySyncProvider&quot;);
111  *      &lt;/PRE&gt;
112 
113  * &lt;/UL&gt;
114  * &lt;p&gt;
115  * By default, the reference implementations of the &lt;code&gt;RowSet&lt;/code&gt; synchronization
116  * providers are always available to the Java platform.
117  * If no other pluggable synchronization providers have been correctly
118  * registered, the &lt;code&gt;SyncFactory&lt;/code&gt; will automatically generate
119  * an instance of the default &lt;code&gt;SyncProvider&lt;/code&gt; reference implementation.
120  * Thus, in the preceding code fragment, if no implementation named
121  * &lt;code&gt;com.fred.providers.HighAvailabilitySyncProvider&lt;/code&gt; has been
122  * registered with the &lt;code&gt;SyncFactory&lt;/code&gt; instance, &lt;i&gt;crs&lt;/i&gt; will be
123  * assigned the default provider in the reference implementation, which is
124  * &lt;code&gt;com.sun.rowset.providers.RIOptimisticProvider&lt;/code&gt;.
125  *
126  * &lt;h2&gt;3.0 Violations and Synchronization Issues&lt;/h2&gt;
127  * If an update between a disconnected &lt;code&gt;RowSet&lt;/code&gt; object
128  * and a data source violates
129  * the original query or the underlying data source constraints, this will
130  * result in undefined behavior for all disconnected &lt;code&gt;RowSet&lt;/code&gt; implementations
131  * and their designated &lt;code&gt;SyncProvider&lt;/code&gt; implementations.
132  * Not defining the behavior when such violations occur offers greater flexibility
133  * for a &lt;code&gt;SyncProvider&lt;/code&gt;
134  * implementation to determine its own best course of action.
135  * &lt;p&gt;
136  * A &lt;code&gt;SyncProvider&lt;/code&gt; implementation
137  * may choose to implement a specific handler to
138  * handle a subset of query violations.
139  * However if an original query violation or a more general data source constraint
140  * violation is not handled by the &lt;code&gt;SyncProvider&lt;/code&gt; implementation,
141  * all &lt;code&gt;SyncProvider&lt;/code&gt;
142  * objects must throw a &lt;code&gt;SyncProviderException&lt;/code&gt;.
143  *
144  * &lt;h2&gt;4.0 Updatable SQL VIEWs&lt;/h2&gt;
145  * It is possible for any disconnected or connected &lt;code&gt;RowSet&lt;/code&gt; object to be populated
146  * from an SQL query that is formulated originally from an SQL &lt;code&gt;VIEW&lt;/code&gt;.
147  * While in many cases it is possible for an update to be performed to an
148  * underlying view, such an update requires additional metadata, which may vary.
149  * The &lt;code&gt;SyncProvider&lt;/code&gt; class provides two constants to indicate whether
150  * an implementation supports updating an SQL &lt;code&gt;VIEW&lt;/code&gt;.
151  * &lt;ul&gt;
152  * &lt;li&gt;&lt;code&gt;&lt;b&gt;NONUPDATABLE_VIEW_SYNC&lt;/b&gt;&lt;/code&gt; - Indicates that a &lt;code&gt;SyncProvider&lt;/code&gt;
153  * implementation does not support synchronization with an SQL &lt;code&gt;VIEW&lt;/code&gt; as the
154  * underlying source of data for the &lt;code&gt;RowSet&lt;/code&gt; object.
155  * &lt;li&gt;&lt;code&gt;&lt;b&gt;UPDATABLE_VIEW_SYNC&lt;/b&gt;&lt;/code&gt; - Indicates that a
156  * &lt;code&gt;SyncProvider&lt;/code&gt; implementation
157  * supports synchronization with an SQL &lt;code&gt;VIEW&lt;/code&gt; as the underlying source
158  * of data.
159  * &lt;/ul&gt;
160  * &lt;P&gt;
161  * The default is for a &lt;code&gt;RowSet&lt;/code&gt; object not to be updatable if it was
162  * populated with data from an SQL &lt;code&gt;VIEW&lt;/code&gt;.
163  *
164  * &lt;h2&gt;5.0 &lt;code&gt;SyncProvider&lt;/code&gt; Constants&lt;/h2&gt;
165  * The &lt;code&gt;SyncProvider&lt;/code&gt; class provides three sets of constants that
166  * are used as return values or parameters for &lt;code&gt;SyncProvider&lt;/code&gt; methods.
167  * &lt;code&gt;SyncProvider&lt;/code&gt; objects may be implemented to perform synchronization
168  * between a &lt;code&gt;RowSet&lt;/code&gt; object and its underlying data source with varying
169  * degrees of care. The first group of constants indicate how synchronization
170  * is handled. For example, &lt;code&gt;GRADE_NONE&lt;/code&gt; indicates that a
171  * &lt;code&gt;SyncProvider&lt;/code&gt; object will not take any care to see what data is
172  * valid and will simply write the &lt;code&gt;RowSet&lt;/code&gt; data to the data source.
173  * &lt;code&gt;GRADE_MODIFIED_AT_COMMIT&lt;/code&gt; indicates that the provider will check
174  * only modified data for validity.  Other grades check all data for validity
175  * or set locks when data is modified or loaded.
176  * &lt;OL&gt;
177  *  &lt;LI&gt;Constants to indicate the synchronization grade of a
178  *     &lt;code&gt;SyncProvider&lt;/code&gt; object
179  *   &lt;UL&gt;
180  *    &lt;LI&gt;SyncProvider.GRADE_NONE
181  *    &lt;LI&gt;SyncProvider.GRADE_MODIFIED_AT_COMMIT
182  *    &lt;LI&gt;SyncProvider.GRADE_CHECK_ALL_AT_COMMIT
183  *    &lt;LI&gt;SyncProvider.GRADE_LOCK_WHEN_MODIFIED
184  *    &lt;LI&gt;SyncProvider.GRADE_LOCK_WHEN_LOADED
185  *   &lt;/UL&gt;
186  *  &lt;LI&gt;Constants to indicate what locks are set on the data source
187  *   &lt;UL&gt;
188  *     &lt;LI&gt;SyncProvider.DATASOURCE_NO_LOCK
189  *     &lt;LI&gt;SyncProvider.DATASOURCE_ROW_LOCK
190  *     &lt;LI&gt;SyncProvider.DATASOURCE_TABLE_LOCK
191  *     &lt;LI&gt;SyncProvider.DATASOURCE_DB_LOCK
192  *   &lt;/UL&gt;
193  *  &lt;LI&gt;Constants to indicate whether a &lt;code&gt;SyncProvider&lt;/code&gt; object can
194  *       perform updates to an SQL &lt;code&gt;VIEW&lt;/code&gt; &lt;BR&gt;
195  *       These constants are explained in the preceding section (4.0).
196  *   &lt;UL&gt;
197  *     &lt;LI&gt;SyncProvider.UPDATABLE_VIEW_SYNC
198  *     &lt;LI&gt;SyncProvider.NONUPDATABLE_VIEW_SYNC
199  *   &lt;/UL&gt;
200  * &lt;/OL&gt;
201  *
202  * @author Jonathan Bruce
203  * @see javax.sql.rowset.spi.SyncFactory
204  * @see javax.sql.rowset.spi.SyncFactoryException
205  * @since 1.5
206  */
207 public abstract class SyncProvider {
208 
209    /**
210     * Creates a default &lt;code&gt;SyncProvider&lt;/code&gt; object.
211     */
212     public SyncProvider() {
213     }
214 
215     /**
216      * Returns the unique identifier for this &lt;code&gt;SyncProvider&lt;/code&gt; object.
217      *
218      * @return a &lt;code&gt;String&lt;/code&gt; object with the fully qualified class name of
219      *         this &lt;code&gt;SyncProvider&lt;/code&gt; object
220      */
221     public abstract String getProviderID();
222 
223     /**
224      * Returns a &lt;code&gt;javax.sql.RowSetReader&lt;/code&gt; object, which can be used to
225      * populate a &lt;code&gt;RowSet&lt;/code&gt; object with data.
226      *
227      * @return a &lt;code&gt;javax.sql.RowSetReader&lt;/code&gt; object
228      */
229     public abstract RowSetReader getRowSetReader();
230 
231     /**
232      * Returns a &lt;code&gt;javax.sql.RowSetWriter&lt;/code&gt; object, which can be
233      * used to write a &lt;code&gt;RowSet&lt;/code&gt; object&#39;s data back to the
234      * underlying data source.
235      *
236      * @return a &lt;code&gt;javax.sql.RowSetWriter&lt;/code&gt; object
237      */
238     public abstract RowSetWriter getRowSetWriter();
239 
240     /**
241      * Returns a constant indicating the
242      * grade of synchronization a &lt;code&gt;RowSet&lt;/code&gt; object can expect from
243      * this &lt;code&gt;SyncProvider&lt;/code&gt; object.
244      *
245      * @return an int that is one of the following constants:
246      *           SyncProvider.GRADE_NONE,
247      *           SyncProvider.GRADE_CHECK_MODIFIED_AT_COMMIT,
248      *           SyncProvider.GRADE_CHECK_ALL_AT_COMMIT,
249      *           SyncProvider.GRADE_LOCK_WHEN_MODIFIED,
250      *           SyncProvider.GRADE_LOCK_WHEN_LOADED
251      */
252     public abstract int getProviderGrade();
253 
254 
255     /**
256      * Sets a lock on the underlying data source at the level indicated by
257      * &lt;i&gt;datasource_lock&lt;/i&gt;. This should cause the
258      * &lt;code&gt;SyncProvider&lt;/code&gt; to adjust its behavior by increasing or
259      * decreasing the level of optimism it provides for a successful
260      * synchronization.
261      *
262      * @param datasource_lock one of the following constants indicating the severity
263      *           level of data source lock required:
264      * &lt;pre&gt;
265      *           SyncProvider.DATASOURCE_NO_LOCK,
266      *           SyncProvider.DATASOURCE_ROW_LOCK,
267      *           SyncProvider.DATASOURCE_TABLE_LOCK,
268      *           SyncProvider.DATASOURCE_DB_LOCK,
269      * &lt;/pre&gt;
270      * @throws SyncProviderException if an unsupported data source locking level
271      *           is set.
272      * @see #getDataSourceLock
273      */
274     public abstract void setDataSourceLock(int datasource_lock)
275         throws SyncProviderException;
276 
277     /**
278      * Returns the current data source lock severity level active in this
279      * &lt;code&gt;SyncProvider&lt;/code&gt; implementation.
280      *
281      * @return a constant indicating the current level of data source lock
282      *        active in this &lt;code&gt;SyncProvider&lt;/code&gt; object;
283      *         one of the following:
284      * &lt;pre&gt;
285      *           SyncProvider.DATASOURCE_NO_LOCK,
286      *           SyncProvider.DATASOURCE_ROW_LOCK,
287      *           SyncProvider.DATASOURCE_TABLE_LOCK,
288      *           SyncProvider.DATASOURCE_DB_LOCK
289      * &lt;/pre&gt;
290      * @throws SyncProviderException if an error occurs determining the data
291      *        source locking level.
292      * @see #setDataSourceLock
293 
294      */
295     public abstract int getDataSourceLock()
296         throws SyncProviderException;
297 
298     /**
299      * Returns whether this &lt;code&gt;SyncProvider&lt;/code&gt; implementation
300      * can perform synchronization between a &lt;code&gt;RowSet&lt;/code&gt; object
301      * and the SQL &lt;code&gt;VIEW&lt;/code&gt; in the data source from which
302      * the &lt;code&gt;RowSet&lt;/code&gt; object got its data.
303      *
304      * @return an &lt;code&gt;int&lt;/code&gt; saying whether this &lt;code&gt;SyncProvider&lt;/code&gt;
305      *         object supports updating an SQL &lt;code&gt;VIEW&lt;/code&gt;; one of the
306      *         following:
307      *            SyncProvider.UPDATABLE_VIEW_SYNC,
308      *            SyncProvider.NONUPDATABLE_VIEW_SYNC
309      */
310     public abstract int supportsUpdatableView();
311 
312     /**
313      * Returns the release version of this &lt;code&gt;SyncProvider&lt;/code&gt; instance.
314      *
315      * @return a &lt;code&gt;String&lt;/code&gt; detailing the release version of the
316      *     &lt;code&gt;SyncProvider&lt;/code&gt; implementation
317      */
318     public abstract String getVersion();
319 
320     /**
321      * Returns the vendor name of this &lt;code&gt;SyncProvider&lt;/code&gt; instance
322      *
323      * @return a &lt;code&gt;String&lt;/code&gt; detailing the vendor name of this
324      *     &lt;code&gt;SyncProvider&lt;/code&gt; implementation
325      */
326     public abstract String getVendor();
327 
328     /*
329      * Standard description of synchronization grades that a SyncProvider
330      * could provide.
331      */
332 
333     /**
334      * Indicates that no synchronization with the originating data source is
335      * provided. A &lt;code&gt;SyncProvider&lt;/code&gt;
336      * implementation returning this grade will simply attempt to write
337      * updates in the &lt;code&gt;RowSet&lt;/code&gt; object to the underlying data
338      * source without checking the validity of any data.
339      *
340      */
341     public static final int GRADE_NONE = 1;
342 
343     /**
344      * Indicates a low level optimistic synchronization grade with
345      * respect to the originating data source.
346      *
347      * A &lt;code&gt;SyncProvider&lt;/code&gt; implementation
348      * returning this grade will check only rows that have changed.
349      *
350      */
351     public static final int GRADE_CHECK_MODIFIED_AT_COMMIT = 2;
352 
353     /**
354      * Indicates a high level optimistic synchronization grade with
355      * respect to the originating data source.
356      *
357      * A &lt;code&gt;SyncProvider&lt;/code&gt; implementation
358      * returning this grade will check all rows, including rows that have not
359      * changed.
360      */
361     public static final int GRADE_CHECK_ALL_AT_COMMIT = 3;
362 
363     /**
364      * Indicates a pessimistic synchronization grade with
365      * respect to the originating data source.
366      *
367      * A &lt;code&gt;SyncProvider&lt;/code&gt;
368      * implementation returning this grade will lock the row in the originating
369      * data source.
370      */
371     public static final int GRADE_LOCK_WHEN_MODIFIED = 4;
372 
373     /**
374      * Indicates the most pessimistic synchronization grade with
375      * respect to the originating
376      * data source. A &lt;code&gt;SyncProvider&lt;/code&gt;
377      * implementation returning this grade will lock the entire view and/or
378      * table affected by the original statement used to populate a
379      * &lt;code&gt;RowSet&lt;/code&gt; object.
380      */
381     public static final int GRADE_LOCK_WHEN_LOADED = 5;
382 
383     /**
384      * Indicates that no locks remain on the originating data source. This is the default
385      * lock setting for all &lt;code&gt;SyncProvider&lt;/code&gt; implementations unless
386      * otherwise directed by a &lt;code&gt;RowSet&lt;/code&gt; object.
387      */
388     public static final int DATASOURCE_NO_LOCK = 1;
389 
390     /**
391      * Indicates that a lock is placed on the rows that are touched by the original
392      * SQL statement used to populate the &lt;code&gt;RowSet&lt;/code&gt; object
393      * that is using this &lt;code&gt;SyncProvider&lt;/code&gt; object.
394      */
395     public static final int DATASOURCE_ROW_LOCK = 2;
396 
397     /**
398      * Indicates that a lock is placed on all tables that are touched by the original
399      * SQL statement used to populate the &lt;code&gt;RowSet&lt;/code&gt; object
400      * that is using this &lt;code&gt;SyncProvider&lt;/code&gt; object.
401      */
402     public static final int DATASOURCE_TABLE_LOCK = 3;
403 
404     /**
405      * Indicates that a lock is placed on the entire data source that is the source of
406      * data for the &lt;code&gt;RowSet&lt;/code&gt; object
407      * that is using this &lt;code&gt;SyncProvider&lt;/code&gt; object.
408      */
409     public static final int DATASOURCE_DB_LOCK = 4;
410 
411     /**
412      * Indicates that a &lt;code&gt;SyncProvider&lt;/code&gt; implementation
413      * supports synchronization between a &lt;code&gt;RowSet&lt;/code&gt; object and
414      * the SQL &lt;code&gt;VIEW&lt;/code&gt; used to populate it.
415      */
416     public static final int UPDATABLE_VIEW_SYNC = 5;
417 
418     /**
419      * Indicates that a &lt;code&gt;SyncProvider&lt;/code&gt; implementation
420      * does &lt;B&gt;not&lt;/B&gt; support synchronization between a &lt;code&gt;RowSet&lt;/code&gt;
421      * object and the SQL &lt;code&gt;VIEW&lt;/code&gt; used to populate it.
422      */
423     public static final int NONUPDATABLE_VIEW_SYNC = 6;
424 }
    </pre>
  </body>
</html>