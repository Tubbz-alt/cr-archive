<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/jdk/internal/reflect/Reflection.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../platform/Metrics.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ReflectionFactory.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/jdk/internal/reflect/Reflection.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2001, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2001, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -120,10 +120,13 @@</span>
      public static boolean verifyMemberAccess(Class&lt;?&gt; currentClass,
                                               Class&lt;?&gt; memberClass,
                                               Class&lt;?&gt; targetClass,
                                               int modifiers)
      {
<span class="udiff-line-added">+         Objects.requireNonNull(currentClass);</span>
<span class="udiff-line-added">+         Objects.requireNonNull(memberClass);</span>
<span class="udiff-line-added">+ </span>
          if (currentClass == memberClass) {
              // Always succeeds
              return true;
          }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -199,10 +202,26 @@</span>
          }
  
          return true;
      }
  
<span class="udiff-line-added">+     /*</span>
<span class="udiff-line-added">+      * Verify if a member is public and memberClass is a public type</span>
<span class="udiff-line-added">+      * in a package that is unconditionally exported and</span>
<span class="udiff-line-added">+      * return {@code true}if it is granted.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param memberClass the declaring class of the member being accessed</span>
<span class="udiff-line-added">+      * @param modifiers the member&#39;s access modifiers</span>
<span class="udiff-line-added">+      * @return {@code true} if the member is public and in a publicly accessible type</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     public static boolean verifyPublicMemberAccess(Class&lt;?&gt; memberClass, int modifiers) {</span>
<span class="udiff-line-added">+         Module m = memberClass.getModule();</span>
<span class="udiff-line-added">+         return Modifier.isPublic(modifiers)</span>
<span class="udiff-line-added">+             &amp;&amp; m.isExported(memberClass.getPackageName())</span>
<span class="udiff-line-added">+             &amp;&amp; Modifier.isPublic(Reflection.getClassAccessFlags(memberClass));</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * Returns {@code true} if memberClass&#39;s module exports memberClass&#39;s
       * package to currentModule.
       */
      public static boolean verifyModuleAccess(Module currentModule, Class&lt;?&gt; memberClass) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -323,12 +342,14 @@</span>
       */
      public static IllegalAccessException newIllegalAccessException(Class&lt;?&gt; currentClass,
                                                                     Class&lt;?&gt; memberClass,
                                                                     Class&lt;?&gt; targetClass,
                                                                     int modifiers)
<span class="udiff-line-removed">-         throws IllegalAccessException</span>
      {
<span class="udiff-line-added">+         if (currentClass == null)</span>
<span class="udiff-line-added">+             return newIllegalAccessException(memberClass, modifiers);</span>
<span class="udiff-line-added">+ </span>
          String currentSuffix = &quot;&quot;;
          String memberSuffix = &quot;&quot;;
          Module m1 = currentClass.getModule();
          if (m1.isNamed())
              currentSuffix = &quot; (in &quot; + m1 + &quot;)&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -353,10 +374,40 @@</span>
          }
  
          return new IllegalAccessException(msg);
      }
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Returns an IllegalAccessException with an exception message where</span>
<span class="udiff-line-added">+      * there is no caller frame.</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     private static IllegalAccessException newIllegalAccessException(Class&lt;?&gt; memberClass,</span>
<span class="udiff-line-added">+                                                                     int modifiers)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         String memberSuffix = &quot;&quot;;</span>
<span class="udiff-line-added">+         Module m2 = memberClass.getModule();</span>
<span class="udiff-line-added">+         if (m2.isNamed())</span>
<span class="udiff-line-added">+             memberSuffix = &quot; (in &quot; + m2 + &quot;)&quot;;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         String memberPackageName = memberClass.getPackageName();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         String msg = &quot;JNI attached native thread (null caller frame) cannot access &quot;;</span>
<span class="udiff-line-added">+         if (m2.isExported(memberPackageName)) {</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // module access okay so include the modifiers in the message</span>
<span class="udiff-line-added">+             msg += &quot;a member of &quot; + memberClass + memberSuffix +</span>
<span class="udiff-line-added">+                 &quot; with modifiers \&quot;&quot; + Modifier.toString(modifiers) + &quot;\&quot;&quot;;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             // module access failed</span>
<span class="udiff-line-added">+             msg += memberClass + memberSuffix+ &quot; because &quot;</span>
<span class="udiff-line-added">+                 + m2 + &quot; does not export &quot; + memberPackageName;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         return new IllegalAccessException(msg);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * Returns true if {@code currentClass} and {@code memberClass}
       * are nestmates - that is, if they have the same nesthost as
       * determined by the VM.
       */
</pre>
<center><a href="../platform/Metrics.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ReflectionFactory.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>