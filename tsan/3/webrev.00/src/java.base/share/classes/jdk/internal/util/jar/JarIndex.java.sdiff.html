<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/jdk/internal/util/jar/JarIndex.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InvalidJarIndexError.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../xml/XMLStreamException.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/jdk/internal/util/jar/JarIndex.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1999, 2012, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.internal.util.jar;
 27 


 28 import java.io.*;
 29 import java.util.*;
 30 import java.util.jar.*;
 31 import java.util.zip.*;

 32 import static sun.security.action.GetPropertyAction.privilegedGetProperty;
 33 
 34 /**
 35  * This class is used to maintain mappings from packages, classes
 36  * and resources to their enclosing JAR files. Mappings are kept
 37  * at the package level except for class or resource files that
 38  * are located at the root directory. URLClassLoader uses the mapping
 39  * information to determine where to fetch an extension class or
 40  * resource from.
 41  *
 42  * @author  Zhenghua Li
 43  * @since   1.3
 44  */
 45 
 46 public class JarIndex {
 47 
 48     /**
 49      * The hash map that maintains mappings from
 50      * package/classe/resource to jar file list(s)
 51      */
</pre>
<hr />
<pre>
233                         // Add files under META-INF explicitly so that certain
234                         // services, like ServiceLoader, etc, can be located
235                         // with greater accuracy. Directories can be skipped
236                         // since each file will be added explicitly.
237                         addMapping(fileName, currentJar);
238                 }
239             }
240 
241             zrf.close();
242         }
243     }
244 
245     /**
246      * Writes the index to the specified OutputStream
247      *
248      * @param out the output stream
249      * @exception IOException if an I/O error has occurred
250      */
251     public void write(OutputStream out) throws IOException {
252         BufferedWriter bw = new BufferedWriter
<span class="line-modified">253             (new OutputStreamWriter(out, &quot;UTF8&quot;));</span>
254         bw.write(&quot;JarIndex-Version: 1.0\n\n&quot;);
255 
256         if (jarFiles != null) {
257             for (int i = 0; i &lt; jarFiles.length; i++) {
258                 /* print out the jar file name */
259                 String jar = jarFiles[i];
260                 bw.write(jar + &quot;\n&quot;);
261                 LinkedList&lt;String&gt; jarlist = jarMap.get(jar);
262                 if (jarlist != null) {
263                     Iterator&lt;String&gt; listitr = jarlist.iterator();
264                     while(listitr.hasNext()) {
265                         bw.write(listitr.next() + &quot;\n&quot;);
266                     }
267                 }
268                 bw.write(&quot;\n&quot;);
269             }
270             bw.flush();
271         }
272     }
273 
274 
275     /**
276      * Reads the index from the specified InputStream.
277      *
278      * @param is the input stream
279      * @exception IOException if an I/O error has occurred
280      */
281     public void read(InputStream is) throws IOException {
282         BufferedReader br = new BufferedReader
<span class="line-modified">283             (new InputStreamReader(is, &quot;UTF8&quot;));</span>
284         String line = null;
285         String currentJar = null;
286 
287         /* an ordered list of jar file names */
288         Vector&lt;String&gt; jars = new Vector&lt;&gt;();
289 
290         /* read until we see a .jar line */
291         while((line = br.readLine()) != null &amp;&amp; !line.endsWith(&quot;.jar&quot;));
292 
293         for(;line != null; line = br.readLine()) {
294             if (line.isEmpty())
295                 continue;
296 
297             if (line.endsWith(&quot;.jar&quot;)) {
298                 currentJar = line;
299                 jars.add(currentJar);
300             } else {
301                 String name = line;
302                 addMapping(name, currentJar);
303             }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1999, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.internal.util.jar;
 27 
<span class="line-added"> 28 import sun.nio.cs.UTF_8;</span>
<span class="line-added"> 29 </span>
 30 import java.io.*;
 31 import java.util.*;
 32 import java.util.jar.*;
 33 import java.util.zip.*;
<span class="line-added"> 34 </span>
 35 import static sun.security.action.GetPropertyAction.privilegedGetProperty;
 36 
 37 /**
 38  * This class is used to maintain mappings from packages, classes
 39  * and resources to their enclosing JAR files. Mappings are kept
 40  * at the package level except for class or resource files that
 41  * are located at the root directory. URLClassLoader uses the mapping
 42  * information to determine where to fetch an extension class or
 43  * resource from.
 44  *
 45  * @author  Zhenghua Li
 46  * @since   1.3
 47  */
 48 
 49 public class JarIndex {
 50 
 51     /**
 52      * The hash map that maintains mappings from
 53      * package/classe/resource to jar file list(s)
 54      */
</pre>
<hr />
<pre>
236                         // Add files under META-INF explicitly so that certain
237                         // services, like ServiceLoader, etc, can be located
238                         // with greater accuracy. Directories can be skipped
239                         // since each file will be added explicitly.
240                         addMapping(fileName, currentJar);
241                 }
242             }
243 
244             zrf.close();
245         }
246     }
247 
248     /**
249      * Writes the index to the specified OutputStream
250      *
251      * @param out the output stream
252      * @exception IOException if an I/O error has occurred
253      */
254     public void write(OutputStream out) throws IOException {
255         BufferedWriter bw = new BufferedWriter
<span class="line-modified">256             (new OutputStreamWriter(out, UTF_8.INSTANCE));</span>
257         bw.write(&quot;JarIndex-Version: 1.0\n\n&quot;);
258 
259         if (jarFiles != null) {
260             for (int i = 0; i &lt; jarFiles.length; i++) {
261                 /* print out the jar file name */
262                 String jar = jarFiles[i];
263                 bw.write(jar + &quot;\n&quot;);
264                 LinkedList&lt;String&gt; jarlist = jarMap.get(jar);
265                 if (jarlist != null) {
266                     Iterator&lt;String&gt; listitr = jarlist.iterator();
267                     while(listitr.hasNext()) {
268                         bw.write(listitr.next() + &quot;\n&quot;);
269                     }
270                 }
271                 bw.write(&quot;\n&quot;);
272             }
273             bw.flush();
274         }
275     }
276 
277 
278     /**
279      * Reads the index from the specified InputStream.
280      *
281      * @param is the input stream
282      * @exception IOException if an I/O error has occurred
283      */
284     public void read(InputStream is) throws IOException {
285         BufferedReader br = new BufferedReader
<span class="line-modified">286             (new InputStreamReader(is, UTF_8.INSTANCE));</span>
287         String line = null;
288         String currentJar = null;
289 
290         /* an ordered list of jar file names */
291         Vector&lt;String&gt; jars = new Vector&lt;&gt;();
292 
293         /* read until we see a .jar line */
294         while((line = br.readLine()) != null &amp;&amp; !line.endsWith(&quot;.jar&quot;));
295 
296         for(;line != null; line = br.readLine()) {
297             if (line.isEmpty())
298                 continue;
299 
300             if (line.endsWith(&quot;.jar&quot;)) {
301                 currentJar = line;
302                 jars.add(currentJar);
303             } else {
304                 String name = line;
305                 addMapping(name, currentJar);
306             }
</pre>
</td>
</tr>
</table>
<center><a href="InvalidJarIndexError.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../xml/XMLStreamException.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>