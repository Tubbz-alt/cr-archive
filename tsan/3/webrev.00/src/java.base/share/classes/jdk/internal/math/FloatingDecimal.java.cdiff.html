<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/jdk/internal/math/FloatingDecimal.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="FDBigInteger.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../misc/Unsafe.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/jdk/internal/math/FloatingDecimal.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 129,59 ***</span>
      public interface BinaryToASCIIConverter {
          /**
           * Converts a floating point value into an ASCII &lt;code&gt;String&lt;/code&gt;.
           * @return The value converted to a &lt;code&gt;String&lt;/code&gt;.
           */
<span class="line-modified">!         public String toJavaFormatString();</span>
  
          /**
           * Appends a floating point value to an &lt;code&gt;Appendable&lt;/code&gt;.
           * @param buf The &lt;code&gt;Appendable&lt;/code&gt; to receive the value.
           */
<span class="line-modified">!         public void appendTo(Appendable buf);</span>
  
          /**
           * Retrieves the decimal exponent most closely corresponding to this value.
           * @return The decimal exponent.
           */
<span class="line-modified">!         public int getDecimalExponent();</span>
  
          /**
           * Retrieves the value as an array of digits.
           * @param digits The digit array.
           * @return The number of valid digits copied into the array.
           */
<span class="line-modified">!         public int getDigits(char[] digits);</span>
  
          /**
           * Indicates the sign of the value.
           * @return {@code value &lt; 0.0}.
           */
<span class="line-modified">!         public boolean isNegative();</span>
  
          /**
           * Indicates whether the value is either infinite or not a number.
           *
           * @return &lt;code&gt;true&lt;/code&gt; if and only if the value is &lt;code&gt;NaN&lt;/code&gt;
           * or infinite.
           */
<span class="line-modified">!         public boolean isExceptional();</span>
  
          /**
           * Indicates whether the value was rounded up during the binary to ASCII
           * conversion.
           *
           * @return &lt;code&gt;true&lt;/code&gt; if and only if the value was rounded up.
           */
<span class="line-modified">!         public boolean digitsRoundedUp();</span>
  
          /**
           * Indicates whether the binary to ASCII conversion was exact.
           *
           * @return &lt;code&gt;true&lt;/code&gt; if any only if the conversion was exact.
           */
<span class="line-modified">!         public boolean decimalDigitsExact();</span>
      }
  
      /**
       * A &lt;code&gt;BinaryToASCIIConverter&lt;/code&gt; which represents &lt;code&gt;NaN&lt;/code&gt;
       * and infinite values.
<span class="line-new-header">--- 129,59 ---</span>
      public interface BinaryToASCIIConverter {
          /**
           * Converts a floating point value into an ASCII &lt;code&gt;String&lt;/code&gt;.
           * @return The value converted to a &lt;code&gt;String&lt;/code&gt;.
           */
<span class="line-modified">!         String toJavaFormatString();</span>
  
          /**
           * Appends a floating point value to an &lt;code&gt;Appendable&lt;/code&gt;.
           * @param buf The &lt;code&gt;Appendable&lt;/code&gt; to receive the value.
           */
<span class="line-modified">!         void appendTo(Appendable buf);</span>
  
          /**
           * Retrieves the decimal exponent most closely corresponding to this value.
           * @return The decimal exponent.
           */
<span class="line-modified">!         int getDecimalExponent();</span>
  
          /**
           * Retrieves the value as an array of digits.
           * @param digits The digit array.
           * @return The number of valid digits copied into the array.
           */
<span class="line-modified">!         int getDigits(char[] digits);</span>
  
          /**
           * Indicates the sign of the value.
           * @return {@code value &lt; 0.0}.
           */
<span class="line-modified">!         boolean isNegative();</span>
  
          /**
           * Indicates whether the value is either infinite or not a number.
           *
           * @return &lt;code&gt;true&lt;/code&gt; if and only if the value is &lt;code&gt;NaN&lt;/code&gt;
           * or infinite.
           */
<span class="line-modified">!         boolean isExceptional();</span>
  
          /**
           * Indicates whether the value was rounded up during the binary to ASCII
           * conversion.
           *
           * @return &lt;code&gt;true&lt;/code&gt; if and only if the value was rounded up.
           */
<span class="line-modified">!         boolean digitsRoundedUp();</span>
  
          /**
           * Indicates whether the binary to ASCII conversion was exact.
           *
           * @return &lt;code&gt;true&lt;/code&gt; if any only if the conversion was exact.
           */
<span class="line-modified">!         boolean decimalDigitsExact();</span>
      }
  
      /**
       * A &lt;code&gt;BinaryToASCIIConverter&lt;/code&gt; which represents &lt;code&gt;NaN&lt;/code&gt;
       * and infinite values.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 319,11 ***</span>
              return decExponent;
          }
  
          @Override
          public int getDigits(char[] digits) {
<span class="line-modified">!             System.arraycopy(this.digits,firstDigitIndex,digits,0,this.nDigits);</span>
              return this.nDigits;
          }
  
          @Override
          public boolean isNegative() {
<span class="line-new-header">--- 319,11 ---</span>
              return decExponent;
          }
  
          @Override
          public int getDigits(char[] digits) {
<span class="line-modified">!             System.arraycopy(this.digits, firstDigitIndex, digits, 0, this.nDigits);</span>
              return this.nDigits;
          }
  
          @Override
          public boolean isNegative() {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 847,11 ***</span>
           * &lt;pre&gt;
           * insignificantDigitsForPow2(v) == insignificantDigits(1L&lt;&lt;v)
           * &lt;/pre&gt;
           */
          private static int insignificantDigitsForPow2(int p2) {
<span class="line-modified">!             if(p2&gt;1 &amp;&amp; p2 &lt; insignificantDigitsNumber.length) {</span>
                  return insignificantDigitsNumber[p2];
              }
              return 0;
          }
  
<span class="line-new-header">--- 847,11 ---</span>
           * &lt;pre&gt;
           * insignificantDigitsForPow2(v) == insignificantDigits(1L&lt;&lt;v)
           * &lt;/pre&gt;
           */
          private static int insignificantDigitsForPow2(int p2) {
<span class="line-modified">!             if (p2 &gt; 1 &amp;&amp; p2 &lt; insignificantDigitsNumber.length) {</span>
                  return insignificantDigitsNumber[p2];
              }
              return 0;
          }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 860,11 ***</span>
           *  i = insignificantDigitsNumber[idx] is the same as:
           *  int i;
           *  for ( i = 0; insignificant &gt;= 10L; i++ )
           *         insignificant /= 10L;
           */
<span class="line-modified">!         private static int[] insignificantDigitsNumber = {</span>
              0, 0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 3, 3,
              4, 4, 4, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7,
              8, 8, 8, 9, 9, 9, 9, 10, 10, 10, 11, 11, 11,
              12, 12, 12, 12, 13, 13, 13, 14, 14, 14,
              15, 15, 15, 15, 16, 16, 16, 17, 17, 17,
<span class="line-new-header">--- 860,11 ---</span>
           *  i = insignificantDigitsNumber[idx] is the same as:
           *  int i;
           *  for ( i = 0; insignificant &gt;= 10L; i++ )
           *         insignificant /= 10L;
           */
<span class="line-modified">!         private static final int[] insignificantDigitsNumber = {</span>
              0, 0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 3, 3,
              4, 4, 4, 5, 5, 5, 6, 6, 6, 6, 7, 7, 7,
              8, 8, 8, 9, 9, 9, 9, 10, 10, 10, 11, 11, 11,
              12, 12, 12, 12, 13, 13, 13, 14, 14, 14,
              15, 15, 15, 15, 16, 16, 16, 17, 17, 17,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1871,15 ***</span>
                      }
                  }
              }  // look for and process decimal floating-point string
  
              char[] digits = new char[ len ];
<span class="line-removed">-             int    nDigits= 0;</span>
              boolean decSeen = false;
              int decPt = 0;
              int nLeadZero = 0;
<span class="line-modified">!             int nTrailZero= 0;</span>
  
          skipLeadingZerosLoop:
              while (i &lt; len) {
                  c = in.charAt(i);
                  if (c == &#39;0&#39;) {
<span class="line-new-header">--- 1871,15 ---</span>
                      }
                  }
              }  // look for and process decimal floating-point string
  
              char[] digits = new char[ len ];
              boolean decSeen = false;
<span class="line-added">+             int nDigits = 0;</span>
              int decPt = 0;
              int nLeadZero = 0;
<span class="line-modified">!             int nTrailZero = 0;</span>
  
          skipLeadingZerosLoop:
              while (i &lt; len) {
                  c = in.charAt(i);
                  if (c == &#39;0&#39;) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2135,13 ***</span>
                  //
                  // If the significand is exactly zero, return a properly
                  // signed zero.
                  //
  
<span class="line-modified">!                 String significandString = null;</span>
<span class="line-modified">!                 int signifLength = 0;</span>
<span class="line-modified">!                 int exponentAdjust = 0;</span>
                  {
                      int leftDigits = 0; // number of meaningful digits to
                      // left of &quot;decimal&quot; point
                      // (leading zeros stripped)
                      int rightDigits = 0; // number of digits to right of
<span class="line-new-header">--- 2135,13 ---</span>
                  //
                  // If the significand is exactly zero, return a properly
                  // signed zero.
                  //
  
<span class="line-modified">!                 String significandString;</span>
<span class="line-modified">!                 int signifLength;</span>
<span class="line-modified">!                 int exponentAdjust;</span>
                  {
                      int leftDigits = 0; // number of meaningful digits to
                      // left of &quot;decimal&quot; point
                      // (leading zeros stripped)
                      int rightDigits = 0; // number of digits to right of
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2244,11 ***</span>
                  // a long; copy explicit bit too; this will be masked
                  // later for normal values.
  
                  boolean round = false;
                  boolean sticky = false;
<span class="line-modified">!                 int nextShift = 0;</span>
                  long significand = 0L;
                  // First iteration is different, since we only copy
                  // from the leading significand bit; one more exponent
                  // adjust will be needed...
  
<span class="line-new-header">--- 2244,11 ---</span>
                  // a long; copy explicit bit too; this will be masked
                  // later for normal values.
  
                  boolean round = false;
                  boolean sticky = false;
<span class="line-modified">!                 int nextShift;</span>
                  long significand = 0L;
                  // First iteration is different, since we only copy
                  // from the leading significand bit; one more exponent
                  // adjust will be needed...
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2523,11 ***</span>
  
      /**
       * Returns &lt;code&gt;s&lt;/code&gt; with any leading zeros removed.
       */
      static String stripLeadingZeros(String s) {
<span class="line-removed">- //        return  s.replaceFirst(&quot;^0+&quot;, &quot;&quot;);</span>
          if(!s.isEmpty() &amp;&amp; s.charAt(0)==&#39;0&#39;) {
              for(int i=1; i&lt;s.length(); i++) {
                  if(s.charAt(i)!=&#39;0&#39;) {
                      return s.substring(i);
                  }
<span class="line-new-header">--- 2523,10 ---</span>
</pre>
<center><a href="FDBigInteger.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../misc/Unsafe.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>