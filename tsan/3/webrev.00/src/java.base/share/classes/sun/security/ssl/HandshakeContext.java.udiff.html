<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/sun/security/ssl/HandshakeContext.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="Finished.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="HelloCookieManager.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/HandshakeContext.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -44,13 +44,12 @@</span>
  import java.util.Queue;
  import javax.crypto.SecretKey;
  import javax.net.ssl.SNIServerName;
  import javax.net.ssl.SSLHandshakeException;
  import javax.security.auth.x500.X500Principal;
<span class="udiff-line-modified-removed">- import sun.security.ssl.SupportedGroupsExtension.NamedGroup;</span>
<span class="udiff-line-modified-removed">- import sun.security.ssl.SupportedGroupsExtension.NamedGroupType;</span>
<span class="udiff-line-removed">- import static sun.security.ssl.SupportedGroupsExtension.NamedGroupType.*;</span>
<span class="udiff-line-modified-added">+ import sun.security.ssl.NamedGroup.NamedGroupSpec;</span>
<span class="udiff-line-modified-added">+ import static sun.security.ssl.NamedGroup.NamedGroupSpec.*;</span>
  import sun.security.ssl.SupportedGroupsExtension.SupportedGroups;
  
  abstract class HandshakeContext implements ConnectionContext {
      // System properties
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -100,10 +99,12 @@</span>
      boolean                                 kickstartMessageDelivered;
  
      // Resumption
      boolean                                 isResumption;
      SSLSessionImpl                          resumingSession;
<span class="udiff-line-added">+     // Session is using stateless resumption</span>
<span class="udiff-line-added">+     boolean                                 statelessResumption = false;</span>
  
      final Queue&lt;Map.Entry&lt;Byte, ByteBuffer&gt;&gt; delegatedActions;
      volatile boolean                        taskDelegated = false;
      volatile Exception                      delegatedThrown = null;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -280,12 +281,12 @@</span>
                  // Ignore disabled protocol.
                  continue;
              }
  
              boolean found = false;
<span class="udiff-line-modified-removed">-             Map&lt;NamedGroupType, Boolean&gt; cachedStatus =</span>
<span class="udiff-line-modified-removed">-                     new EnumMap&lt;&gt;(NamedGroupType.class);</span>
<span class="udiff-line-modified-added">+             Map&lt;NamedGroupSpec, Boolean&gt; cachedStatus =</span>
<span class="udiff-line-modified-added">+                     new EnumMap&lt;&gt;(NamedGroupSpec.class);</span>
              for (CipherSuite suite : enabledCipherSuites) {
                  if (suite.isAvailable() &amp;&amp; suite.supports(protocol)) {
                      if (isActivatable(suite,
                              algorithmConstraints, cachedStatus)) {
                          protocols.add(protocol);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -320,12 +321,12 @@</span>
              List&lt;CipherSuite&gt; enabledCipherSuites,
              AlgorithmConstraints algorithmConstraints) {
  
          List&lt;CipherSuite&gt; suites = new LinkedList&lt;&gt;();
          if (enabledProtocols != null &amp;&amp; !enabledProtocols.isEmpty()) {
<span class="udiff-line-modified-removed">-             Map&lt;NamedGroupType, Boolean&gt; cachedStatus =</span>
<span class="udiff-line-modified-removed">-                     new EnumMap&lt;&gt;(NamedGroupType.class);</span>
<span class="udiff-line-modified-added">+             Map&lt;NamedGroupSpec, Boolean&gt; cachedStatus =</span>
<span class="udiff-line-modified-added">+                     new EnumMap&lt;&gt;(NamedGroupSpec.class);</span>
              for (CipherSuite suite : enabledCipherSuites) {
                  if (!suite.isAvailable()) {
                      continue;
                  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -506,54 +507,61 @@</span>
          this.conContext.protocolVersion = protocolVersion;
      }
  
      private static boolean isActivatable(CipherSuite suite,
              AlgorithmConstraints algorithmConstraints,
<span class="udiff-line-modified-removed">-             Map&lt;NamedGroupType, Boolean&gt; cachedStatus) {</span>
<span class="udiff-line-modified-added">+             Map&lt;NamedGroupSpec, Boolean&gt; cachedStatus) {</span>
  
          if (algorithmConstraints.permits(
                  EnumSet.of(CryptoPrimitive.KEY_AGREEMENT), suite.name, null)) {
              if (suite.keyExchange == null) {
                  // TLS 1.3, no definition of key exchange in cipher suite.
                  return true;
              }
  
<span class="udiff-line-modified-removed">-             boolean available;</span>
<span class="udiff-line-modified-removed">-             NamedGroupType groupType = suite.keyExchange.groupType;</span>
<span class="udiff-line-modified-removed">-             if (groupType != NAMED_GROUP_NONE) {</span>
<span class="udiff-line-modified-removed">-                 Boolean checkedStatus = cachedStatus.get(groupType);</span>
<span class="udiff-line-modified-removed">-                 if (checkedStatus == null) {</span>
<span class="udiff-line-modified-removed">-                     available = SupportedGroups.isActivatable(</span>
<span class="udiff-line-modified-removed">-                             algorithmConstraints, groupType);</span>
<span class="udiff-line-modified-removed">-                     cachedStatus.put(groupType, available);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                     if (!available &amp;&amp;</span>
<span class="udiff-line-modified-removed">-                             SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;verbose&quot;)) {</span>
<span class="udiff-line-modified-removed">-                         SSLLogger.fine(&quot;No activated named group&quot;);</span>
<span class="udiff-line-modified-added">+             // Is at least one of the group types available?</span>
<span class="udiff-line-modified-added">+             boolean groupAvailable, retval = false;</span>
<span class="udiff-line-modified-added">+             NamedGroupSpec[] groupTypes = suite.keyExchange.groupTypes;</span>
<span class="udiff-line-modified-added">+             for (NamedGroupSpec groupType : groupTypes) {</span>
<span class="udiff-line-modified-added">+                 if (groupType != NAMED_GROUP_NONE) {</span>
<span class="udiff-line-modified-added">+                     Boolean checkedStatus = cachedStatus.get(groupType);</span>
<span class="udiff-line-modified-added">+                     if (checkedStatus == null) {</span>
<span class="udiff-line-modified-added">+                         groupAvailable = SupportedGroups.isActivatable(</span>
<span class="udiff-line-modified-added">+                                 algorithmConstraints, groupType);</span>
<span class="udiff-line-modified-added">+                         cachedStatus.put(groupType, groupAvailable);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+                         if (!groupAvailable &amp;&amp;</span>
<span class="udiff-line-added">+                                 SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;verbose&quot;)) {</span>
<span class="udiff-line-added">+                             SSLLogger.fine(</span>
<span class="udiff-line-added">+                                     &quot;No activated named group in &quot; + groupType);</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                     } else {</span>
<span class="udiff-line-added">+                         groupAvailable = checkedStatus;</span>
                      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                     retval |= groupAvailable;</span>
                  } else {
<span class="udiff-line-modified-removed">-                     available = checkedStatus;</span>
<span class="udiff-line-modified-added">+                     retval |= true;</span>
                  }
<span class="udiff-line-added">+             }</span>
  
<span class="udiff-line-modified-removed">-                 if (!available &amp;&amp; SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;verbose&quot;)) {</span>
<span class="udiff-line-modified-removed">-                     SSLLogger.fine(</span>
<span class="udiff-line-removed">-                         &quot;No active named group, ignore &quot; + suite);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 return available;</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 return true;</span>
<span class="udiff-line-modified-added">+             if (!retval &amp;&amp; SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;verbose&quot;)) {</span>
<span class="udiff-line-modified-added">+                 SSLLogger.fine(&quot;No active named group(s), ignore &quot; + suite);</span>
              }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             return retval;</span>
<span class="udiff-line-added">+ </span>
          } else if (SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;verbose&quot;)) {
              SSLLogger.fine(&quot;Ignore disabled cipher suite: &quot; + suite);
          }
  
          return false;
      }
  
      List&lt;SNIServerName&gt; getRequestedServerNames() {
          if (requestedServerNames == null) {
<span class="udiff-line-modified-removed">-             return Collections.&lt;SNIServerName&gt;emptyList();</span>
<span class="udiff-line-modified-added">+             return Collections.emptyList();</span>
          }
          return requestedServerNames;
      }
  }
  
</pre>
<center><a href="Finished.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="HelloCookieManager.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>