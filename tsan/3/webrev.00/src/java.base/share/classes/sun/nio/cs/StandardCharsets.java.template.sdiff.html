<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/nio/cs/StandardCharsets.java.template</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SingleByte.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="StreamDecoder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/nio/cs/StandardCharsets.java.template</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  *
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * This code is free software; you can redistribute it and/or modify it
  7  * under the terms of the GNU General Public License version 2 only, as
  8  * published by the Free Software Foundation.  Oracle designates this
  9  * particular file as subject to the &quot;Classpath&quot; exception as provided
 10  * by Oracle in the LICENSE file that accompanied this code.
 11  *
 12  * This code is distributed in the hope that it will be useful, but WITHOUT
 13  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 14  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 15  * version 2 for more details (a copy is included in the LICENSE file that
 16  * accompanied this code).
 17  *
 18  * You should have received a copy of the GNU General Public License version
 19  * 2 along with this work; if not, write to the Free Software Foundation,
 20  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 21  *
 22  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 23  * or visit www.oracle.com if you need additional information or have any
 24  * questions.
 25  *
 26  */
 27 
 28 // -- This file was mechanically generated: Do not edit! -- //
 29 
 30 package sun.nio.cs;
 31 
 32 import java.nio.charset.Charset;
 33 import java.nio.charset.spi.CharsetProvider;
 34 import java.util.Iterator;
 35 import java.util.Map;
 36 import java.util.Set;
 37 import jdk.internal.vm.annotation.Stable;
<span class="line-removed"> 38 import sun.security.action.GetPropertyAction;</span>
 39 
 40 public class StandardCharsets extends CharsetProvider {
 41 
 42     _INCLUDE_ALIASES_TABLES_
 43     _INCLUDE_ALIASES_MAP_
 44     _INCLUDE_CLASSES_MAP_
 45     _INCLUDE_CACHE_MAP_
 46 
 47     // Maps canonical names to class names
 48     private @Stable Map&lt;String,String&gt; classMap;
 49 
 50     // Maps alias names to canonical names
 51     private @Stable Map&lt;String,String&gt; aliasMap;
 52 
 53     // Maps canonical names to cached instances
 54     private @Stable Map&lt;String,Charset&gt; cache;
 55 
 56     private static final String packagePrefix = &quot;sun.nio.cs.&quot;;
 57 
 58     public StandardCharsets() {
</pre>
<hr />
<pre>
103             int c = s.charAt(i);
104             if (((c - &#39;A&#39;) | (&#39;Z&#39; - c)) &gt;= 0) {
105                 allLower = false;
106                 break;
107             }
108         }
109         if (allLower)
110             return s;
111         StringBuilder sb = new StringBuilder(n);
112         for (int i = 0; i &lt; n; i++) {
113             int c = s.charAt(i);
114             if (((c - &#39;A&#39;) | (&#39;Z&#39; - c)) &gt;= 0)
115                 sb.append((char)(c + 0x20));
116             else
117                 sb.append((char)c);
118         }
119         return sb.toString();
120     }
121 
122     private Charset lookup(String charsetName) {
<span class="line-removed">123         init();</span>
<span class="line-removed">124 </span>
125         // By checking these built-ins we can avoid initializing Aliases,
126         // Classes and Cache eagerly during bootstrap.
127         //
128         // Initialization of java.nio.charset.StandardCharsets should be
129         // avoided here to minimize time spent in System.initPhase1, as it
130         // may delay initialization of performance critical VM subsystems.
131         String csn;
132         if (charsetName.equals(&quot;UTF-8&quot;)) {
133             return UTF_8.INSTANCE;
134         } else if (charsetName.equals(&quot;US-ASCII&quot;)) {
135             return US_ASCII.INSTANCE;
136         } else if (charsetName.equals(&quot;ISO-8859-1&quot;)) {
137             return ISO_8859_1.INSTANCE;
138         } else {
139             csn = canonicalize(toLower(charsetName));
140         }
141 
142         // Check cache first
143         Charset cs = cache().get(csn);
144         if (cs != null)
</pre>
<hr />
<pre>
160                  IllegalAccessException |
161                  InstantiationException x) {
162             return null;
163         }
164     }
165 
166     private Charset cache(String csn, Charset cs) {
167         cache().put(csn, cs);
168         return cs;
169     }
170 
171     public final Charset charsetForName(String charsetName) {
172         synchronized (this) {
173             return lookup(charsetName);
174         }
175     }
176 
177     public final Iterator&lt;Charset&gt; charsets() {
178         Set&lt;String&gt; charsetNames;
179         synchronized (this) {
<span class="line-removed">180             init();</span>
181             // Ensure initialized in synchronized block
182             charsetNames = classMap().keySet();
183             aliasMap();
184             cache();
185         }
186         return new Iterator&lt;Charset&gt;() {
187 
188                 Iterator&lt;String&gt; i = charsetNames.iterator();
189 
190                 public boolean hasNext() {
191                     return i.hasNext();
192                 }
193 
194                 public Charset next() {
195                     String csn = i.next();
196                     return lookup(csn);
197                 }
198 
199                 public void remove() {
200                     throw new UnsupportedOperationException();
201                 }
202 
203             };
204     }
<span class="line-removed">205 </span>
<span class="line-removed">206     private boolean initialized = false;</span>
<span class="line-removed">207 </span>
<span class="line-removed">208     /*   provider the sun.nio.cs.map property fir sjis/ms932 mapping hack</span>
<span class="line-removed">209      */</span>
<span class="line-removed">210     private void init() {</span>
<span class="line-removed">211         if (initialized)</span>
<span class="line-removed">212             return;</span>
<span class="line-removed">213         if (!jdk.internal.misc.VM.isBooted())</span>
<span class="line-removed">214             return;</span>
<span class="line-removed">215         initialized = true;</span>
<span class="line-removed">216 </span>
<span class="line-removed">217         String map = GetPropertyAction.privilegedGetProperty(&quot;sun.nio.cs.map&quot;);</span>
<span class="line-removed">218         if (map != null) {</span>
<span class="line-removed">219             Map&lt;String,String&gt; aliasMap = aliasMap();</span>
<span class="line-removed">220             Map&lt;String,String&gt; classMap = classMap();</span>
<span class="line-removed">221             String[] maps = map.split(&quot;,&quot;);</span>
<span class="line-removed">222             for (int i = 0; i &lt; maps.length; i++) {</span>
<span class="line-removed">223                 if (maps[i].equalsIgnoreCase(&quot;Windows-31J/Shift_JIS&quot;)) {</span>
<span class="line-removed">224                     // if we dont have both sjis and ms932, do nothing</span>
<span class="line-removed">225                     if (classMap.get(&quot;shift_jis&quot;) == null ||</span>
<span class="line-removed">226                         classMap.get(&quot;windows-31j&quot;) == null) {</span>
<span class="line-removed">227                         break;</span>
<span class="line-removed">228                     }</span>
<span class="line-removed">229                     aliases_MS932 = new String[] {</span>
<span class="line-removed">230                         &quot;MS932&quot;,        // JDK historical</span>
<span class="line-removed">231                         &quot;windows-932&quot;,</span>
<span class="line-removed">232                         &quot;csWindows31J&quot;,</span>
<span class="line-removed">233                         &quot;shift-jis&quot;,</span>
<span class="line-removed">234                         &quot;ms_kanji&quot;,</span>
<span class="line-removed">235                         &quot;x-sjis&quot;,</span>
<span class="line-removed">236                         &quot;csShiftJIS&quot;,</span>
<span class="line-removed">237                         // This alias takes precedence over the actual</span>
<span class="line-removed">238                         // Shift_JIS charset itself since aliases are always</span>
<span class="line-removed">239                         // resolved first, before looking up canonical names.</span>
<span class="line-removed">240                         &quot;shift_jis&quot;</span>
<span class="line-removed">241                     };</span>
<span class="line-removed">242                     aliases_SJIS = new String[] { &quot;sjis&quot; };</span>
<span class="line-removed">243 </span>
<span class="line-removed">244                     for (String alias : aliases_MS932) {</span>
<span class="line-removed">245                         aliasMap.put(toLower(alias), &quot;windows-31j&quot;);</span>
<span class="line-removed">246                     }</span>
<span class="line-removed">247                     cache().put(&quot;shift_jis&quot;, null);</span>
<span class="line-removed">248                     break;</span>
<span class="line-removed">249                 }</span>
<span class="line-removed">250             }</span>
<span class="line-removed">251         }</span>
<span class="line-removed">252     }</span>
<span class="line-removed">253 </span>
254 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  *
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * This code is free software; you can redistribute it and/or modify it
  7  * under the terms of the GNU General Public License version 2 only, as
  8  * published by the Free Software Foundation.  Oracle designates this
  9  * particular file as subject to the &quot;Classpath&quot; exception as provided
 10  * by Oracle in the LICENSE file that accompanied this code.
 11  *
 12  * This code is distributed in the hope that it will be useful, but WITHOUT
 13  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 14  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 15  * version 2 for more details (a copy is included in the LICENSE file that
 16  * accompanied this code).
 17  *
 18  * You should have received a copy of the GNU General Public License version
 19  * 2 along with this work; if not, write to the Free Software Foundation,
 20  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 21  *
 22  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 23  * or visit www.oracle.com if you need additional information or have any
 24  * questions.
 25  *
 26  */
 27 
 28 // -- This file was mechanically generated: Do not edit! -- //
 29 
 30 package sun.nio.cs;
 31 
 32 import java.nio.charset.Charset;
 33 import java.nio.charset.spi.CharsetProvider;
 34 import java.util.Iterator;
 35 import java.util.Map;
 36 import java.util.Set;
 37 import jdk.internal.vm.annotation.Stable;

 38 
 39 public class StandardCharsets extends CharsetProvider {
 40 
 41     _INCLUDE_ALIASES_TABLES_
 42     _INCLUDE_ALIASES_MAP_
 43     _INCLUDE_CLASSES_MAP_
 44     _INCLUDE_CACHE_MAP_
 45 
 46     // Maps canonical names to class names
 47     private @Stable Map&lt;String,String&gt; classMap;
 48 
 49     // Maps alias names to canonical names
 50     private @Stable Map&lt;String,String&gt; aliasMap;
 51 
 52     // Maps canonical names to cached instances
 53     private @Stable Map&lt;String,Charset&gt; cache;
 54 
 55     private static final String packagePrefix = &quot;sun.nio.cs.&quot;;
 56 
 57     public StandardCharsets() {
</pre>
<hr />
<pre>
102             int c = s.charAt(i);
103             if (((c - &#39;A&#39;) | (&#39;Z&#39; - c)) &gt;= 0) {
104                 allLower = false;
105                 break;
106             }
107         }
108         if (allLower)
109             return s;
110         StringBuilder sb = new StringBuilder(n);
111         for (int i = 0; i &lt; n; i++) {
112             int c = s.charAt(i);
113             if (((c - &#39;A&#39;) | (&#39;Z&#39; - c)) &gt;= 0)
114                 sb.append((char)(c + 0x20));
115             else
116                 sb.append((char)c);
117         }
118         return sb.toString();
119     }
120 
121     private Charset lookup(String charsetName) {


122         // By checking these built-ins we can avoid initializing Aliases,
123         // Classes and Cache eagerly during bootstrap.
124         //
125         // Initialization of java.nio.charset.StandardCharsets should be
126         // avoided here to minimize time spent in System.initPhase1, as it
127         // may delay initialization of performance critical VM subsystems.
128         String csn;
129         if (charsetName.equals(&quot;UTF-8&quot;)) {
130             return UTF_8.INSTANCE;
131         } else if (charsetName.equals(&quot;US-ASCII&quot;)) {
132             return US_ASCII.INSTANCE;
133         } else if (charsetName.equals(&quot;ISO-8859-1&quot;)) {
134             return ISO_8859_1.INSTANCE;
135         } else {
136             csn = canonicalize(toLower(charsetName));
137         }
138 
139         // Check cache first
140         Charset cs = cache().get(csn);
141         if (cs != null)
</pre>
<hr />
<pre>
157                  IllegalAccessException |
158                  InstantiationException x) {
159             return null;
160         }
161     }
162 
163     private Charset cache(String csn, Charset cs) {
164         cache().put(csn, cs);
165         return cs;
166     }
167 
168     public final Charset charsetForName(String charsetName) {
169         synchronized (this) {
170             return lookup(charsetName);
171         }
172     }
173 
174     public final Iterator&lt;Charset&gt; charsets() {
175         Set&lt;String&gt; charsetNames;
176         synchronized (this) {

177             // Ensure initialized in synchronized block
178             charsetNames = classMap().keySet();
179             aliasMap();
180             cache();
181         }
182         return new Iterator&lt;Charset&gt;() {
183 
184                 Iterator&lt;String&gt; i = charsetNames.iterator();
185 
186                 public boolean hasNext() {
187                     return i.hasNext();
188                 }
189 
190                 public Charset next() {
191                     String csn = i.next();
192                     return lookup(csn);
193                 }
194 
195                 public void remove() {
196                     throw new UnsupportedOperationException();
197                 }
198 
199             };
200     }

















































201 }
</pre>
</td>
</tr>
</table>
<center><a href="SingleByte.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="StreamDecoder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>