<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/java.base/share/classes/sun/security/x509/AlgIdDSA.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 1996, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.x509;
 27 
 28 import java.io.IOException;
 29 import java.math.BigInteger;
 30 import java.security.*;
 31 import java.security.interfaces.DSAParams;
 32 
 33 import sun.security.util.*;
 34 
 35 
 36 /**
 37  * This class identifies DSS/DSA Algorithm variants, which are distinguished
 38  * by using different algorithm parameters &lt;em&gt;P, Q, G&lt;/em&gt;.  It uses the
 39  * NIST/IETF standard DER encoding.  These are used to implement the Digital
 40  * Signature Standard (DSS), FIPS 186.
 41  *
 42  * &lt;P&gt;&lt;em&gt;&lt;b&gt;NOTE:&lt;/b&gt;&lt;/em&gt;  DSS/DSA Algorithm IDs may be created without these
 43  * parameters.  Use of DSS/DSA in modes where parameters are
 44  * either implicit (e.g. a default applicable to a site or a larger scope),
 45  * or are derived from some Certificate Authority&#39;s DSS certificate, is
 46  * not supported directly.  The application is responsible for creating a key
 47  * containing the required parameters prior to using the key in cryptographic
 48  * operations.  The follwoing is an example of how this may be done assuming
 49  * that we have a certificate called &lt;code&gt;currentCert&lt;/code&gt; which doesn&#39;t
 50  * contain DSS/DSA parameters and we need to derive DSS/DSA parameters
 51  * from a CA&#39;s certificate called &lt;code&gt;caCert&lt;/code&gt;.
 52  *
 53  * &lt;pre&gt;{@code
 54  * // key containing parameters to use
 55  * DSAPublicKey cAKey = (DSAPublicKey)(caCert.getPublicKey());
 56  * // key without parameters
 57  * DSAPublicKey nullParamsKey = (DSAPublicKey)(currentCert.getPublicKey());
 58  *
 59  * DSAParams cAKeyParams = cAKey.getParams();
 60  * KeyFactory kf = KeyFactory.getInstance(&quot;DSA&quot;);
 61  * DSAPublicKeySpec ks = new DSAPublicKeySpec(nullParamsKey.getY(),
 62  *                                            cAKeyParams.getP(),
 63  *                                            cAKeyParams.getQ(),
 64  *                                            cAKeyParams.getG());
 65  * DSAPublicKey usableKey = kf.generatePublic(ks);
 66  * }&lt;/pre&gt;
 67  *
 68  * @see java.security.interfaces.DSAParams
 69  * @see java.security.interfaces.DSAPublicKey
 70  * @see java.security.KeyFactory
 71  * @see java.security.spec.DSAPublicKeySpec
 72  *
 73  * @author David Brownell
 74  */
 75 public final
 76 class AlgIdDSA extends AlgorithmId implements DSAParams
 77 {
 78 
 79     @java.io.Serial
 80     private static final long serialVersionUID = 3437177836797504046L;
 81 
 82     /*
 83      * The three unsigned integer parameters.
 84      */
 85     private BigInteger  p , q, g;
 86 
 87     /** Returns the DSS/DSA parameter &quot;P&quot; */
 88     public BigInteger   getP () { return p; }
 89 
 90     /** Returns the DSS/DSA parameter &quot;Q&quot; */
 91     public BigInteger   getQ () { return q; }
 92 
 93     /** Returns the DSS/DSA parameter &quot;G&quot; */
 94     public BigInteger   getG () { return g; }
 95 
 96     /**
 97      * Default constructor.  The OID and parameters must be
 98      * deserialized before this algorithm ID is used.
 99      */
100     @Deprecated
101     public AlgIdDSA () {}
102 
103     AlgIdDSA (DerValue val) throws IOException
104         { super(val.getOID()); }
105 
106     /**
107      * Construct an AlgIdDSA from an X.509 encoded byte array.
108      */
109     public AlgIdDSA (byte[] encodedAlg) throws IOException
110         { super (new DerValue(encodedAlg).getOID()); }
111 
112     /**
113      * Constructs a DSS/DSA Algorithm ID from unsigned integers that
114      * define the algorithm parameters.  Those integers are encoded
115      * as big-endian byte arrays.
116      *
117      * @param p the DSS/DSA parameter &quot;P&quot;
118      * @param q the DSS/DSA parameter &quot;Q&quot;
119      * @param g the DSS/DSA parameter &quot;G&quot;
120      */
121     public AlgIdDSA (byte[] p, byte[] q, byte[] g)
122     throws IOException
123     {
124         this (new BigInteger (1, p),
125             new BigInteger (1, q),
126             new BigInteger (1, g));
127     }
128 
129     /**
130      * Constructs a DSS/DSA Algorithm ID from numeric parameters.
131      * If all three are null, then the parameters portion of the algorithm id
132      * is set to null.  See note in header regarding use.
133      *
134      * @param p the DSS/DSA parameter &quot;P&quot;
135      * @param q the DSS/DSA parameter &quot;Q&quot;
136      * @param g the DSS/DSA parameter &quot;G&quot;
137      */
138     public AlgIdDSA (BigInteger p, BigInteger q, BigInteger g)
139     {
140         super (DSA_oid);
141 
142         if (p != null || q != null || g != null) {
143             if (p == null || q == null || g == null)
144                 throw new ProviderException(&quot;Invalid parameters for DSS/DSA&quot; +
145                                             &quot; Algorithm ID&quot;);
146             try {
147                 this.p = p;
148                 this.q = q;
149                 this.g = g;
150                 initializeParams ();
151 
152             } catch (IOException e) {
153                 /* this should not happen */
154                 throw new ProviderException (&quot;Construct DSS/DSA Algorithm ID&quot;);
155             }
156         }
157     }
158 
159     /**
160      * Returns &quot;DSA&quot;, indicating the Digital Signature Algorithm (DSA) as
161      * defined by the Digital Signature Standard (DSS), FIPS 186.
162      */
163     public String getName ()
164         { return &quot;DSA&quot;; }
165 
166 
167     /*
168      * For algorithm IDs which haven&#39;t been created from a DER encoded
169      * value, &quot;params&quot; must be created.
170      */
171     private void initializeParams ()
172     throws IOException
173     {
174         DerOutputStream out = new DerOutputStream ();
175 
176         out.putInteger(p);
177         out.putInteger(q);
178         out.putInteger(g);
179         params = new DerValue (DerValue.tag_Sequence,out.toByteArray ());
180     }
181 
182     /**
183      * Parses algorithm parameters P, Q, and G.  They&#39;re found
184      * in the &quot;params&quot; member, which never needs to be changed.
185      */
186     protected void decodeParams ()
187     throws IOException
188     {
189         if (params == null)
190             throw new IOException(&quot;DSA alg params are null&quot;);
191         if (params.tag != DerValue.tag_Sequence)
192             throw new  IOException(&quot;DSA alg parsing error&quot;);
193 
194         params.data.reset ();
195 
196         this.p = params.data.getBigInteger();
197         this.q = params.data.getBigInteger();
198         this.g = params.data.getBigInteger();
199 
200         if (params.data.available () != 0)
201             throw new IOException (&quot;AlgIdDSA params, extra=&quot;+
202                                    params.data.available ());
203     }
204 
205 
206     /*
207      * Returns a formatted string describing the parameters.
208      */
209     public String toString ()
210         { return paramsToString (); }
211 
212     /*
213      * Returns a string describing the parameters.
214      */
215     protected String paramsToString ()
216     {
217         if (params == null)
218             return &quot; null\n&quot;;
219         else
220             return
221                 &quot;\n    p:\n&quot; + Debug.toHexString(p) +
222                 &quot;\n    q:\n&quot; + Debug.toHexString(q) +
223                 &quot;\n    g:\n&quot; + Debug.toHexString(g) +
224                 &quot;\n&quot;;
225     }
226 }
    </pre>
  </body>
</html>