<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/util/locale/provider/CalendarNameProviderImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CalendarDataUtility.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HostLocaleProviderAdapter.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/util/locale/provider/CalendarNameProviderImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 67             String[] strings = javatime ? lr.getJavaTimeNames(key) : lr.getCalendarNames(key);
 68 
 69             // If standalone names are requested and no &quot;standalone.&quot; resources are found,
 70             // try the default ones instead.
 71             if (strings == null &amp;&amp; key.indexOf(&quot;standalone.&quot;) != -1) {
 72                 key = key.replaceFirst(&quot;standalone.&quot;, &quot;&quot;);
 73                 strings = javatime ? lr.getJavaTimeNames(key) : lr.getCalendarNames(key);
 74             }
 75 
 76             if (strings != null &amp;&amp; strings.length &gt; 0) {
 77                 if (field == DAY_OF_WEEK || field == YEAR) {
 78                     --value;
 79                 }
 80                 if (value &lt; 0) {
 81                     return null;
 82                 } else if (value &gt;= strings.length) {
 83                     if (field == ERA &amp;&amp; &quot;japanese&quot;.equals(calendarType)) {
 84                         Era[] jeras = CalendarSystem.forName(&quot;japanese&quot;).getEras();
 85                         if (value &lt;= jeras.length) {
 86                             // Localized era name could not be retrieved from this provider.
<span class="line-modified"> 87                             // This can occur either for NewEra or SupEra.</span>
 88                             //
 89                             // If it&#39;s CLDR provider, try COMPAT first, which is guaranteed to have
<span class="line-modified"> 90                             // the name for NewEra.</span>
 91                             if (type == LocaleProviderAdapter.Type.CLDR) {
 92                                 lr = LocaleProviderAdapter.forJRE().getLocaleResources(locale);
 93                                 key = getResourceKeyFor(LocaleProviderAdapter.Type.JRE,
 94                                                 calendarType, field, style, javatime);
 95                                 strings =
 96                                     javatime ? lr.getJavaTimeNames(key) : lr.getCalendarNames(key);
 97                             }
 98                             if (strings == null || value &gt;= strings.length) {
 99                                 // Get the default name for SupEra
100                                 Era supEra = jeras[value - 1]; // 0-based index
101                                 if (javatime) {
102                                     return getBaseStyle(style) == NARROW_FORMAT ?
103                                         supEra.getAbbreviation() :
104                                         supEra.getName();
105                                 } else {
106                                     return (style &amp; LONG) != 0 ?
107                                         supEra.getName() :
108                                         supEra.getAbbreviation();
109                                 }
110                             }
</pre>
<hr />
<pre>
240             case &quot;islamic&quot;:
241             case &quot;roc&quot;:
242                 break;
243             default:
244                 // Unknown calendar type
245                 return false;
246             }
247         }
248         if (langtags.contains(locale.toLanguageTag())) {
249             return true;
250         }
251         String oldname = locale.toString().replace(&#39;_&#39;, &#39;-&#39;);
252         return langtags.contains(oldname);
253     }
254 
255     @Override
256     public Set&lt;String&gt; getAvailableLanguageTags() {
257         return langtags;
258     }
259 


260     private boolean hasDuplicates(String[] strings) {
261         int len = strings.length;
262         for (int i = 0; i &lt; len - 1; i++) {
263             String a = strings[i];
<span class="line-modified">264             if (a != null) {</span>
265                 for (int j = i + 1; j &lt; len; j++) {
266                     if (a.equals(strings[j]))  {
267                         return true;
268                     }
269                 }
270             }
271         }
272         return false;
273     }
274 
275     private String getResourceKey(String type, int field, int style, boolean javatime) {
276         return getResourceKeyFor(this.type, type, field, style, javatime);
277     }
278 
279     private static String getResourceKeyFor(LocaleProviderAdapter.Type adapterType,
280                             String type, int field, int style, boolean javatime) {
281         int baseStyle = getBaseStyle(style);
282         boolean isStandalone = (style != baseStyle);
283 
284         if (&quot;gregory&quot;.equals(type)) {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 67             String[] strings = javatime ? lr.getJavaTimeNames(key) : lr.getCalendarNames(key);
 68 
 69             // If standalone names are requested and no &quot;standalone.&quot; resources are found,
 70             // try the default ones instead.
 71             if (strings == null &amp;&amp; key.indexOf(&quot;standalone.&quot;) != -1) {
 72                 key = key.replaceFirst(&quot;standalone.&quot;, &quot;&quot;);
 73                 strings = javatime ? lr.getJavaTimeNames(key) : lr.getCalendarNames(key);
 74             }
 75 
 76             if (strings != null &amp;&amp; strings.length &gt; 0) {
 77                 if (field == DAY_OF_WEEK || field == YEAR) {
 78                     --value;
 79                 }
 80                 if (value &lt; 0) {
 81                     return null;
 82                 } else if (value &gt;= strings.length) {
 83                     if (field == ERA &amp;&amp; &quot;japanese&quot;.equals(calendarType)) {
 84                         Era[] jeras = CalendarSystem.forName(&quot;japanese&quot;).getEras();
 85                         if (value &lt;= jeras.length) {
 86                             // Localized era name could not be retrieved from this provider.
<span class="line-modified"> 87                             // This can occur either for Reiwa or SupEra.</span>
 88                             //
 89                             // If it&#39;s CLDR provider, try COMPAT first, which is guaranteed to have
<span class="line-modified"> 90                             // the name for Reiwa.</span>
 91                             if (type == LocaleProviderAdapter.Type.CLDR) {
 92                                 lr = LocaleProviderAdapter.forJRE().getLocaleResources(locale);
 93                                 key = getResourceKeyFor(LocaleProviderAdapter.Type.JRE,
 94                                                 calendarType, field, style, javatime);
 95                                 strings =
 96                                     javatime ? lr.getJavaTimeNames(key) : lr.getCalendarNames(key);
 97                             }
 98                             if (strings == null || value &gt;= strings.length) {
 99                                 // Get the default name for SupEra
100                                 Era supEra = jeras[value - 1]; // 0-based index
101                                 if (javatime) {
102                                     return getBaseStyle(style) == NARROW_FORMAT ?
103                                         supEra.getAbbreviation() :
104                                         supEra.getName();
105                                 } else {
106                                     return (style &amp; LONG) != 0 ?
107                                         supEra.getName() :
108                                         supEra.getAbbreviation();
109                                 }
110                             }
</pre>
<hr />
<pre>
240             case &quot;islamic&quot;:
241             case &quot;roc&quot;:
242                 break;
243             default:
244                 // Unknown calendar type
245                 return false;
246             }
247         }
248         if (langtags.contains(locale.toLanguageTag())) {
249             return true;
250         }
251         String oldname = locale.toString().replace(&#39;_&#39;, &#39;-&#39;);
252         return langtags.contains(oldname);
253     }
254 
255     @Override
256     public Set&lt;String&gt; getAvailableLanguageTags() {
257         return langtags;
258     }
259 
<span class="line-added">260     // Check if each string is unique, except null or empty strings,</span>
<span class="line-added">261     // as these strings are used for keys in the name-to-value map.</span>
262     private boolean hasDuplicates(String[] strings) {
263         int len = strings.length;
264         for (int i = 0; i &lt; len - 1; i++) {
265             String a = strings[i];
<span class="line-modified">266             if (a != null &amp;&amp; !a.isEmpty()) {</span>
267                 for (int j = i + 1; j &lt; len; j++) {
268                     if (a.equals(strings[j]))  {
269                         return true;
270                     }
271                 }
272             }
273         }
274         return false;
275     }
276 
277     private String getResourceKey(String type, int field, int style, boolean javatime) {
278         return getResourceKeyFor(this.type, type, field, style, javatime);
279     }
280 
281     private static String getResourceKeyFor(LocaleProviderAdapter.Type adapterType,
282                             String type, int field, int style, boolean javatime) {
283         int baseStyle = getBaseStyle(style);
284         boolean isStandalone = (style != baseStyle);
285 
286         if (&quot;gregory&quot;.equals(type)) {
</pre>
</td>
</tr>
</table>
<center><a href="CalendarDataUtility.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HostLocaleProviderAdapter.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>