<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/nio/cs/StandardCharsets.java.template</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SingleByte.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="StreamDecoder.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/nio/cs/StandardCharsets.java.template</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   *
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   *
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
</pre>
<hr />
<pre>
<span class="line-old-header">*** 33,11 ***</span>
  import java.nio.charset.spi.CharsetProvider;
  import java.util.Iterator;
  import java.util.Map;
  import java.util.Set;
  import jdk.internal.vm.annotation.Stable;
<span class="line-removed">- import sun.security.action.GetPropertyAction;</span>
  
  public class StandardCharsets extends CharsetProvider {
  
      _INCLUDE_ALIASES_TABLES_
      _INCLUDE_ALIASES_MAP_
<span class="line-new-header">--- 33,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 118,12 ***</span>
          }
          return sb.toString();
      }
  
      private Charset lookup(String charsetName) {
<span class="line-removed">-         init();</span>
<span class="line-removed">- </span>
          // By checking these built-ins we can avoid initializing Aliases,
          // Classes and Cache eagerly during bootstrap.
          //
          // Initialization of java.nio.charset.StandardCharsets should be
          // avoided here to minimize time spent in System.initPhase1, as it
<span class="line-new-header">--- 117,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 175,11 ***</span>
      }
  
      public final Iterator&lt;Charset&gt; charsets() {
          Set&lt;String&gt; charsetNames;
          synchronized (this) {
<span class="line-removed">-             init();</span>
              // Ensure initialized in synchronized block
              charsetNames = classMap().keySet();
              aliasMap();
              cache();
          }
<span class="line-new-header">--- 172,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 200,55 ***</span>
                      throw new UnsupportedOperationException();
                  }
  
              };
      }
<span class="line-removed">- </span>
<span class="line-removed">-     private boolean initialized = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /*   provider the sun.nio.cs.map property fir sjis/ms932 mapping hack</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     private void init() {</span>
<span class="line-removed">-         if (initialized)</span>
<span class="line-removed">-             return;</span>
<span class="line-removed">-         if (!jdk.internal.misc.VM.isBooted())</span>
<span class="line-removed">-             return;</span>
<span class="line-removed">-         initialized = true;</span>
<span class="line-removed">- </span>
<span class="line-removed">-         String map = GetPropertyAction.privilegedGetProperty(&quot;sun.nio.cs.map&quot;);</span>
<span class="line-removed">-         if (map != null) {</span>
<span class="line-removed">-             Map&lt;String,String&gt; aliasMap = aliasMap();</span>
<span class="line-removed">-             Map&lt;String,String&gt; classMap = classMap();</span>
<span class="line-removed">-             String[] maps = map.split(&quot;,&quot;);</span>
<span class="line-removed">-             for (int i = 0; i &lt; maps.length; i++) {</span>
<span class="line-removed">-                 if (maps[i].equalsIgnoreCase(&quot;Windows-31J/Shift_JIS&quot;)) {</span>
<span class="line-removed">-                     // if we dont have both sjis and ms932, do nothing</span>
<span class="line-removed">-                     if (classMap.get(&quot;shift_jis&quot;) == null ||</span>
<span class="line-removed">-                         classMap.get(&quot;windows-31j&quot;) == null) {</span>
<span class="line-removed">-                         break;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     aliases_MS932 = new String[] {</span>
<span class="line-removed">-                         &quot;MS932&quot;,        // JDK historical</span>
<span class="line-removed">-                         &quot;windows-932&quot;,</span>
<span class="line-removed">-                         &quot;csWindows31J&quot;,</span>
<span class="line-removed">-                         &quot;shift-jis&quot;,</span>
<span class="line-removed">-                         &quot;ms_kanji&quot;,</span>
<span class="line-removed">-                         &quot;x-sjis&quot;,</span>
<span class="line-removed">-                         &quot;csShiftJIS&quot;,</span>
<span class="line-removed">-                         // This alias takes precedence over the actual</span>
<span class="line-removed">-                         // Shift_JIS charset itself since aliases are always</span>
<span class="line-removed">-                         // resolved first, before looking up canonical names.</span>
<span class="line-removed">-                         &quot;shift_jis&quot;</span>
<span class="line-removed">-                     };</span>
<span class="line-removed">-                     aliases_SJIS = new String[] { &quot;sjis&quot; };</span>
<span class="line-removed">- </span>
<span class="line-removed">-                     for (String alias : aliases_MS932) {</span>
<span class="line-removed">-                         aliasMap.put(toLower(alias), &quot;windows-31j&quot;);</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     cache().put(&quot;shift_jis&quot;, null);</span>
<span class="line-removed">-                     break;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
  }
<span class="line-new-header">--- 196,6 ---</span>
</pre>
<center><a href="SingleByte.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="StreamDecoder.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>