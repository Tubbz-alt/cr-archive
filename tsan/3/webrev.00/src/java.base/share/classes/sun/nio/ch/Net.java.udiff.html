<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/sun/nio/ch/Net.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="NativeDispatcher.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Reflect.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/nio/ch/Net.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -48,10 +48,11 @@</span>
  import java.security.AccessController;
  import java.security.PrivilegedAction;
  import java.util.Enumeration;
  
  import sun.net.ext.ExtendedSocketOptions;
<span class="udiff-line-added">+ import sun.net.util.IPAddressUtil;</span>
  import sun.security.action.GetPropertyAction;
  
  public class Net {
  
      private Net() { }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -103,10 +104,20 @@</span>
       */
      static boolean useExclusiveBind() {
          return exclusiveBind;
      }
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Tells whether both IPV6_XXX and IP_XXX socket options should be set on</span>
<span class="udiff-line-added">+      * IPv6 sockets. On some kernels, both IPV6_XXX and IP_XXX socket options</span>
<span class="udiff-line-added">+      * need to be set so that the settings are effective for IPv4 multicast</span>
<span class="udiff-line-added">+      * datagrams sent using the socket.</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     static boolean shouldSetBothIPv4AndIPv6Options() {</span>
<span class="udiff-line-added">+         return shouldSetBothIPv4AndIPv6Options0();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * Tells whether IPv6 sockets can join IPv4 multicast groups
       */
      static boolean canIPv6SocketJoinIPv4Group() {
          return canIPv6SocketJoinIPv4Group0();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -118,10 +129,18 @@</span>
       */
      static boolean canJoin6WithIPv4Group() {
          return canJoin6WithIPv4Group0();
      }
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Tells whether IPV6_XXX socket options should be used on an IPv6 socket</span>
<span class="udiff-line-added">+      * that is bound to an IPv4 address.</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     static boolean canUseIPv6OptionsWithIPv4LocalAddress() {</span>
<span class="udiff-line-added">+         return canUseIPv6OptionsWithIPv4LocalAddress0();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      public static InetSocketAddress checkAddress(SocketAddress sa) {
          if (sa == null)
              throw new NullPointerException();
          if (!(sa instanceof InetSocketAddress))
              throw new UnsupportedAddressTypeException(); // ## needs arg
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -308,10 +327,16 @@</span>
      // -- Socket options
  
      static final ExtendedSocketOptions extendedOptions =
              ExtendedSocketOptions.getInstance();
  
<span class="udiff-line-added">+     static void setSocketOption(FileDescriptor fd, SocketOption&lt;?&gt; name, Object value)</span>
<span class="udiff-line-added">+         throws IOException</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         setSocketOption(fd, Net.UNSPEC, name, value);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      static void setSocketOption(FileDescriptor fd, ProtocolFamily family,
                                  SocketOption&lt;?&gt; name, Object value)
          throws IOException
      {
          if (value == null)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -370,12 +395,17 @@</span>
          boolean mayNeedConversion = (family == UNSPEC);
          boolean isIPv6 = (family == StandardProtocolFamily.INET6);
          setIntOption0(fd, mayNeedConversion, key.level(), key.name(), arg, isIPv6);
      }
  
<span class="udiff-line-modified-removed">-     static Object getSocketOption(FileDescriptor fd, ProtocolFamily family,</span>
<span class="udiff-line-modified-removed">-                                   SocketOption&lt;?&gt; name)</span>
<span class="udiff-line-modified-added">+     static Object getSocketOption(FileDescriptor fd, SocketOption&lt;?&gt; name)</span>
<span class="udiff-line-modified-added">+         throws IOException</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         return getSocketOption(fd, Net.UNSPEC, name);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     static Object getSocketOption(FileDescriptor fd, ProtocolFamily family, SocketOption&lt;?&gt; name)</span>
          throws IOException
      {
          Class&lt;?&gt; type = name.type();
  
          if (extendedOptions.isOptionSupported(name)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -416,20 +446,23 @@</span>
      /*
       * Returns 1 for Windows and -1 for Solaris/Linux/Mac OS
       */
      private static native int isExclusiveBindAvailable();
  
<span class="udiff-line-added">+     private static native boolean shouldSetBothIPv4AndIPv6Options0();</span>
<span class="udiff-line-added">+ </span>
      private static native boolean canIPv6SocketJoinIPv4Group0();
  
      private static native boolean canJoin6WithIPv4Group0();
  
<span class="udiff-line-added">+     private static native boolean canUseIPv6OptionsWithIPv4LocalAddress0();</span>
<span class="udiff-line-added">+ </span>
      static FileDescriptor socket(boolean stream) throws IOException {
          return socket(UNSPEC, stream);
      }
  
<span class="udiff-line-modified-removed">-     static FileDescriptor socket(ProtocolFamily family, boolean stream)</span>
<span class="udiff-line-removed">-         throws IOException {</span>
<span class="udiff-line-modified-added">+     static FileDescriptor socket(ProtocolFamily family, boolean stream) throws IOException {</span>
          boolean preferIPv6 = isIPv6Available() &amp;&amp;
              (family != StandardProtocolFamily.INET);
          return IOUtil.newFD(socket0(preferIPv6, stream, false, fastLoopback));
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -450,10 +483,13 @@</span>
      static void bind(ProtocolFamily family, FileDescriptor fd,
                       InetAddress addr, int port) throws IOException
      {
          boolean preferIPv6 = isIPv6Available() &amp;&amp;
              (family != StandardProtocolFamily.INET);
<span class="udiff-line-added">+         if (addr.isLinkLocalAddress()) {</span>
<span class="udiff-line-added">+             addr = IPAddressUtil.toScopedAddress(addr);</span>
<span class="udiff-line-added">+         }</span>
          bind0(fd, preferIPv6, exclusiveBind, addr, port);
      }
  
      private static native void bind0(FileDescriptor fd, boolean preferIPv6,
                                       boolean useExclBind, InetAddress addr,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -469,10 +505,13 @@</span>
      }
  
      static int connect(ProtocolFamily family, FileDescriptor fd, InetAddress remote, int remotePort)
          throws IOException
      {
<span class="udiff-line-added">+         if (remote.isLinkLocalAddress()) {</span>
<span class="udiff-line-added">+             remote = IPAddressUtil.toScopedAddress(remote);</span>
<span class="udiff-line-added">+         }</span>
          boolean preferIPv6 = isIPv6Available() &amp;&amp;
              (family != StandardProtocolFamily.INET);
          return connect0(preferIPv6, fd, remote, remotePort);
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -480,10 +519,14 @@</span>
                                         FileDescriptor fd,
                                         InetAddress remote,
                                         int remotePort)
          throws IOException;
  
<span class="udiff-line-added">+     public static native int accept(FileDescriptor fd,</span>
<span class="udiff-line-added">+                                     FileDescriptor newfd,</span>
<span class="udiff-line-added">+                                     InetSocketAddress[] isaa)</span>
<span class="udiff-line-added">+         throws IOException;</span>
  
      public static final int SHUT_RD = 0;
      public static final int SHUT_WR = 1;
      public static final int SHUT_RDWR = 2;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -519,24 +562,47 @@</span>
  
      private static native void setIntOption0(FileDescriptor fd, boolean mayNeedConversion,
                                               int level, int opt, int arg, boolean isIPv6)
          throws IOException;
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Polls a file descriptor for events.</span>
<span class="udiff-line-added">+      * @param timeout the timeout to wait; 0 to not wait, -1 to wait indefinitely</span>
<span class="udiff-line-added">+      * @return the polled events or 0 if no events are polled</span>
<span class="udiff-line-added">+      */</span>
      static native int poll(FileDescriptor fd, int events, long timeout)
          throws IOException;
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Performs a non-blocking poll of a file descriptor.</span>
<span class="udiff-line-added">+      * @return the polled events or 0 if no events are polled</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     static int pollNow(FileDescriptor fd, int events) throws IOException {</span>
<span class="udiff-line-added">+         return poll(fd, events, 0);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * Polls a connecting socket to test if the connection has been established.
       *
       * @apiNote This method is public to allow it be used by code in jdk.sctp.
       *
       * @param timeout the timeout to wait; 0 to not wait, -1 to wait indefinitely
<span class="udiff-line-modified-removed">-      * @return 1 if connected, 0 if not connected, or IOS_INTERRUPTED</span>
<span class="udiff-line-modified-added">+      * @return true if connected</span>
       */
<span class="udiff-line-modified-removed">-     public static native int pollConnect(FileDescriptor fd, long timeout)</span>
<span class="udiff-line-modified-added">+     public static native boolean pollConnect(FileDescriptor fd, long timeout)</span>
          throws IOException;
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Performs a non-blocking poll of a connecting socket to test if the</span>
<span class="udiff-line-added">+      * connection has been established.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @return true if connected</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     static boolean pollConnectNow(FileDescriptor fd) throws IOException {</span>
<span class="udiff-line-added">+         return pollConnect(fd, 0);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * Return the number of bytes in the socket input buffer.
       */
      static native int available(FileDescriptor fd) throws IOException;
  
</pre>
<center><a href="NativeDispatcher.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Reflect.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>