<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/net/www/protocol/http/NegotiateAuthentication.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HttpURLConnection.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../https/DelegateHttpsURLConnection.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/net/www/protocol/http/NegotiateAuthentication.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2005, 2016, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 29,11 ***</span>
  import java.io.IOException;
  import java.net.Authenticator.RequestorType;
  import java.util.Base64;
  import java.util.HashMap;
  import sun.net.www.HeaderParser;
<span class="line-removed">- import sun.util.logging.PlatformLogger;</span>
  import static sun.net.www.protocol.http.AuthScheme.NEGOTIATE;
  import static sun.net.www.protocol.http.AuthScheme.KERBEROS;
  import sun.security.action.GetPropertyAction;
  
  /**
<span class="line-new-header">--- 29,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 43,13 ***</span>
   * @since 1.6
   */
  
  class NegotiateAuthentication extends AuthenticationInfo {
  
      private static final long serialVersionUID = 100L;
<span class="line-removed">-     private static final PlatformLogger logger = HttpURLConnection.getHttpLogger();</span>
  
      private final HttpCallerInfo hci;
  
      // These maps are used to manage the GSS availability for diffrent
      // hosts. The key for both maps is the host name.
      // &lt;code&gt;supported&lt;/code&gt; is set when isSupported is checked,
<span class="line-new-header">--- 42,14 ---</span>
   * @since 1.6
   */
  
  class NegotiateAuthentication extends AuthenticationInfo {
  
<span class="line-added">+     @java.io.Serial</span>
      private static final long serialVersionUID = 100L;
  
<span class="line-added">+     @SuppressWarnings(&quot;serial&quot;) // Not statically typed as Serializable</span>
      private final HttpCallerInfo hci;
  
      // These maps are used to manage the GSS availability for diffrent
      // hosts. The key for both maps is the host name.
      // &lt;code&gt;supported&lt;/code&gt; is set when isSupported is checked,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 64,10 ***</span>
<span class="line-new-header">--- 64,11 ---</span>
              GetPropertyAction.privilegedGetProperty(&quot;jdk.spnego.cache&quot;, &quot;true&quot;);
          cacheSPNEGO = Boolean.parseBoolean(spnegoCacheProp);
      }
  
      // The HTTP Negotiate Helper
<span class="line-added">+     @SuppressWarnings(&quot;serial&quot;) // Not statically typed as Serializable</span>
      private Negotiator negotiator = null;
  
     /**
      * Constructor used for both WWW and proxy entries.
      * @param hci a schemed object.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 87,35 ***</span>
      @Override
      public boolean supportsPreemptiveAuthorization() {
          return false;
      }
  
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Find out if the HttpCallerInfo supports Negotiate protocol.</span>
<span class="line-removed">-      * @return true if supported</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public static boolean isSupported(HttpCallerInfo hci) {</span>
<span class="line-removed">-         ClassLoader loader = null;</span>
<span class="line-removed">-         try {</span>
<span class="line-removed">-             loader = Thread.currentThread().getContextClassLoader();</span>
<span class="line-removed">-         } catch (SecurityException se) {</span>
<span class="line-removed">-             if (logger.isLoggable(PlatformLogger.Level.FINER)) {</span>
<span class="line-removed">-                 logger.finer(&quot;NegotiateAuthentication: &quot; +</span>
<span class="line-removed">-                     &quot;Attempt to get the context class loader failed - &quot; + se);</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         if (loader != null) {</span>
<span class="line-removed">-             // Lock on the class loader instance to avoid the deadlock engaging</span>
<span class="line-removed">-             // the lock in &quot;ClassLoader.loadClass(String, boolean)&quot; method.</span>
<span class="line-removed">-             synchronized (loader) {</span>
<span class="line-removed">-                 return isSupportedImpl(hci);</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         return isSupportedImpl(hci);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      /**
       * Find out if the HttpCallerInfo supports Negotiate protocol. In order to
       * find out yes or no, an initialization of a Negotiator object against it
       * is tried. The generated object will be cached under the name of ths
       * hostname at a success try.&lt;br&gt;
<span class="line-new-header">--- 88,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 123,11 ***</span>
       * If this method is called for the second time on an HttpCallerInfo with
       * the same hostname, the answer is retrieved from cache.
       *
       * @return true if supported
       */
<span class="line-modified">!     private static synchronized boolean isSupportedImpl(HttpCallerInfo hci) {</span>
          if (supported == null) {
              supported = new HashMap&lt;&gt;();
          }
          String hostname = hci.host;
          hostname = hostname.toLowerCase();
<span class="line-new-header">--- 99,11 ---</span>
       * If this method is called for the second time on an HttpCallerInfo with
       * the same hostname, the answer is retrieved from cache.
       *
       * @return true if supported
       */
<span class="line-modified">!     synchronized public static boolean isSupported(HttpCallerInfo hci) {</span>
          if (supported == null) {
              supported = new HashMap&lt;&gt;();
          }
          String hostname = hci.host;
          hostname = hostname.toLowerCase();
</pre>
<center><a href="HttpURLConnection.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../https/DelegateHttpsURLConnection.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>