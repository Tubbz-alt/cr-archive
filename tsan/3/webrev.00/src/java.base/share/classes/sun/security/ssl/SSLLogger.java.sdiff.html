<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/ssl/SSLLogger.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SSLKeyExchange.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SSLServerSocketImpl.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/SSLLogger.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 28 import java.io.ByteArrayInputStream;
 29 import java.io.ByteArrayOutputStream;
 30 import java.io.IOException;
 31 import java.io.PrintStream;
 32 import java.lang.System.Logger;
 33 import java.lang.System.Logger.Level;
 34 import java.nio.ByteBuffer;
 35 import java.security.cert.Certificate;
 36 import java.security.cert.Extension;
 37 import java.security.cert.X509Certificate;
 38 import java.text.MessageFormat;
 39 import java.text.SimpleDateFormat;
 40 import java.util.Date;
 41 import java.util.Locale;
 42 import java.util.Map;
 43 import java.util.ResourceBundle;
 44 import sun.security.action.GetPropertyAction;
 45 import sun.security.util.HexDumpEncoder;
 46 import sun.security.x509.*;
 47 


 48 /**
 49  * Implementation of SSL logger.
 50  *
 51  * If the system property &quot;javax.net.debug&quot; is not defined, the debug logging
 52  * is turned off.  If the system property &quot;javax.net.debug&quot; is defined as
 53  * empty, the debug logger is specified by System.getLogger(&quot;javax.net.ssl&quot;),
 54  * and applications can customize and configure the logger or use external
 55  * logging mechanisms.  If the system property &quot;javax.net.debug&quot; is defined
 56  * and non-empty, a private debug logger implemented in this class is used.
 57  */
 58 public final class SSLLogger {
 59     private static final System.Logger logger;
 60     private static final String property;
 61     public static final boolean isOn;
 62 
 63     static {
 64         String p = GetPropertyAction.privilegedGetProperty(&quot;javax.net.debug&quot;);
 65         if (p != null) {
 66             if (p.isEmpty()) {
 67                 property = &quot;&quot;;
</pre>
<hr />
<pre>
212             this.useCompactFormat = !options.contains(&quot;expand&quot;);
213         }
214 
215         @Override
216         public String getName() {
217             return loggerName;
218         }
219 
220         @Override
221         public boolean isLoggable(Level level) {
222             return (level != Level.OFF);
223         }
224 
225         @Override
226         public void log(Level level,
227                 ResourceBundle rb, String message, Throwable thrwbl) {
228             if (isLoggable(level)) {
229                 try {
230                     String formatted =
231                         SSLSimpleFormatter.format(this, level, message, thrwbl);
<span class="line-modified">232                     System.err.write(formatted.getBytes(&quot;UTF-8&quot;));</span>
233                 } catch (Exception exp) {
234                     // ignore it, just for debugging.
235                 }
236             }
237         }
238 
239         @Override
240         public void log(Level level,
241                 ResourceBundle rb, String message, Object... params) {
242             if (isLoggable(level)) {
243                 try {
244                     String formatted =
245                         SSLSimpleFormatter.format(this, level, message, params);
<span class="line-modified">246                     System.err.write(formatted.getBytes(&quot;UTF-8&quot;));</span>
247                 } catch (Exception exp) {
248                     // ignore it, just for debugging.
249                 }
250             }
251         }
252     }
253 
254     private static class SSLSimpleFormatter {
255         private static final ThreadLocal&lt;SimpleDateFormat&gt; dateFormat =
256             new ThreadLocal&lt;SimpleDateFormat&gt;() {
257                 @Override protected SimpleDateFormat initialValue() {
258                     return new SimpleDateFormat(
259                             &quot;yyyy-MM-dd kk:mm:ss.SSS z&quot;, Locale.ENGLISH);
260                 }
261             };
262 
263         private static final MessageFormat basicCertFormat = new MessageFormat(
264                 &quot;\&quot;version\&quot;            : \&quot;v{0}\&quot;,\n&quot; +
265                 &quot;\&quot;serial number\&quot;      : \&quot;{1}\&quot;,\n&quot; +
266                 &quot;\&quot;signature algorithm\&quot;: \&quot;{2}\&quot;,\n&quot; +
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 28 import java.io.ByteArrayInputStream;
 29 import java.io.ByteArrayOutputStream;
 30 import java.io.IOException;
 31 import java.io.PrintStream;
 32 import java.lang.System.Logger;
 33 import java.lang.System.Logger.Level;
 34 import java.nio.ByteBuffer;
 35 import java.security.cert.Certificate;
 36 import java.security.cert.Extension;
 37 import java.security.cert.X509Certificate;
 38 import java.text.MessageFormat;
 39 import java.text.SimpleDateFormat;
 40 import java.util.Date;
 41 import java.util.Locale;
 42 import java.util.Map;
 43 import java.util.ResourceBundle;
 44 import sun.security.action.GetPropertyAction;
 45 import sun.security.util.HexDumpEncoder;
 46 import sun.security.x509.*;
 47 
<span class="line-added"> 48 import static java.nio.charset.StandardCharsets.UTF_8;</span>
<span class="line-added"> 49 </span>
 50 /**
 51  * Implementation of SSL logger.
 52  *
 53  * If the system property &quot;javax.net.debug&quot; is not defined, the debug logging
 54  * is turned off.  If the system property &quot;javax.net.debug&quot; is defined as
 55  * empty, the debug logger is specified by System.getLogger(&quot;javax.net.ssl&quot;),
 56  * and applications can customize and configure the logger or use external
 57  * logging mechanisms.  If the system property &quot;javax.net.debug&quot; is defined
 58  * and non-empty, a private debug logger implemented in this class is used.
 59  */
 60 public final class SSLLogger {
 61     private static final System.Logger logger;
 62     private static final String property;
 63     public static final boolean isOn;
 64 
 65     static {
 66         String p = GetPropertyAction.privilegedGetProperty(&quot;javax.net.debug&quot;);
 67         if (p != null) {
 68             if (p.isEmpty()) {
 69                 property = &quot;&quot;;
</pre>
<hr />
<pre>
214             this.useCompactFormat = !options.contains(&quot;expand&quot;);
215         }
216 
217         @Override
218         public String getName() {
219             return loggerName;
220         }
221 
222         @Override
223         public boolean isLoggable(Level level) {
224             return (level != Level.OFF);
225         }
226 
227         @Override
228         public void log(Level level,
229                 ResourceBundle rb, String message, Throwable thrwbl) {
230             if (isLoggable(level)) {
231                 try {
232                     String formatted =
233                         SSLSimpleFormatter.format(this, level, message, thrwbl);
<span class="line-modified">234                     System.err.write(formatted.getBytes(UTF_8));</span>
235                 } catch (Exception exp) {
236                     // ignore it, just for debugging.
237                 }
238             }
239         }
240 
241         @Override
242         public void log(Level level,
243                 ResourceBundle rb, String message, Object... params) {
244             if (isLoggable(level)) {
245                 try {
246                     String formatted =
247                         SSLSimpleFormatter.format(this, level, message, params);
<span class="line-modified">248                     System.err.write(formatted.getBytes(UTF_8));</span>
249                 } catch (Exception exp) {
250                     // ignore it, just for debugging.
251                 }
252             }
253         }
254     }
255 
256     private static class SSLSimpleFormatter {
257         private static final ThreadLocal&lt;SimpleDateFormat&gt; dateFormat =
258             new ThreadLocal&lt;SimpleDateFormat&gt;() {
259                 @Override protected SimpleDateFormat initialValue() {
260                     return new SimpleDateFormat(
261                             &quot;yyyy-MM-dd kk:mm:ss.SSS z&quot;, Locale.ENGLISH);
262                 }
263             };
264 
265         private static final MessageFormat basicCertFormat = new MessageFormat(
266                 &quot;\&quot;version\&quot;            : \&quot;v{0}\&quot;,\n&quot; +
267                 &quot;\&quot;serial number\&quot;      : \&quot;{1}\&quot;,\n&quot; +
268                 &quot;\&quot;signature algorithm\&quot;: \&quot;{2}\&quot;,\n&quot; +
</pre>
</td>
</tr>
</table>
<center><a href="SSLKeyExchange.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SSLServerSocketImpl.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>