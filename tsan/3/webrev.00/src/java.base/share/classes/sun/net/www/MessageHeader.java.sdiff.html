<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/net/www/MessageHeader.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ApplicationLaunchException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ParseUtil.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/net/www/MessageHeader.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
271         }
272 
273         if (include != null) {
274                 for (Map.Entry&lt;String,List&lt;String&gt;&gt; entry: include.entrySet()) {
275                 List&lt;String&gt; l = m.get(entry.getKey());
276                 if (l == null) {
277                     l = new ArrayList&lt;&gt;();
278                     m.put(entry.getKey(), l);
279                 }
280                 l.addAll(entry.getValue());
281             }
282         }
283 
284         for (String key : m.keySet()) {
285             m.put(key, Collections.unmodifiableList(m.get(key)));
286         }
287 
288         return Collections.unmodifiableMap(m);
289     }
290 
























291     /** Prints the key-value pairs represented by this
<span class="line-modified">292         header.  Also prints the RFC required blank line</span>
<span class="line-modified">293         at the end. Omits pairs with a null key. */</span>

294     public synchronized void print(PrintStream p) {
295         for (int i = 0; i &lt; nkeys; i++)
296             if (keys[i] != null) {
<span class="line-modified">297                 p.print(keys[i] +</span>
<span class="line-modified">298                     (values[i] != null ? &quot;: &quot;+values[i]: &quot;&quot;) + &quot;\r\n&quot;);</span>





299             }
300         p.print(&quot;\r\n&quot;);
301         p.flush();
302     }
303 
304     /** Adds a key value pair to the end of the
305         header.  Duplicates are allowed */
306     public synchronized void add(String k, String v) {
307         grow();
308         keys[nkeys] = k;
309         values[nkeys] = v;
310         nkeys++;
311     }
312 
313     /** Prepends a key value pair to the beginning of the
314         header.  Duplicates are allowed */
315     public synchronized void prepend(String k, String v) {
316         grow();
317         for (int i = nkeys; i &gt; 0; i--) {
318             keys[i] = keys[i-1];
</pre>
</td>
<td>
<hr />
<pre>
271         }
272 
273         if (include != null) {
274                 for (Map.Entry&lt;String,List&lt;String&gt;&gt; entry: include.entrySet()) {
275                 List&lt;String&gt; l = m.get(entry.getKey());
276                 if (l == null) {
277                     l = new ArrayList&lt;&gt;();
278                     m.put(entry.getKey(), l);
279                 }
280                 l.addAll(entry.getValue());
281             }
282         }
283 
284         for (String key : m.keySet()) {
285             m.put(key, Collections.unmodifiableList(m.get(key)));
286         }
287 
288         return Collections.unmodifiableMap(m);
289     }
290 
<span class="line-added">291     /** Check if a line of message header looks like a request line.</span>
<span class="line-added">292      * This method does not perform a full validation but simply</span>
<span class="line-added">293      * returns false if the line does not end with &#39;HTTP/[1-9].[0-9]&#39;</span>
<span class="line-added">294      * @param line the line to check.</span>
<span class="line-added">295      * @return true if the line might be a request line.</span>
<span class="line-added">296      */</span>
<span class="line-added">297     private boolean isRequestline(String line) {</span>
<span class="line-added">298         String k = line.trim();</span>
<span class="line-added">299         int i = k.lastIndexOf(&#39; &#39;);</span>
<span class="line-added">300         if (i &lt;= 0) return false;</span>
<span class="line-added">301         int len = k.length();</span>
<span class="line-added">302         if (len - i &lt; 9) return false;</span>
<span class="line-added">303 </span>
<span class="line-added">304         char c1 = k.charAt(len-3);</span>
<span class="line-added">305         char c2 = k.charAt(len-2);</span>
<span class="line-added">306         char c3 = k.charAt(len-1);</span>
<span class="line-added">307         if (c1 &lt; &#39;1&#39; || c1 &gt; &#39;9&#39;) return false;</span>
<span class="line-added">308         if (c2 != &#39;.&#39;) return false;</span>
<span class="line-added">309         if (c3 &lt; &#39;0&#39; || c3 &gt; &#39;9&#39;) return false;</span>
<span class="line-added">310 </span>
<span class="line-added">311         return (k.substring(i+1, len-3).equalsIgnoreCase(&quot;HTTP/&quot;));</span>
<span class="line-added">312     }</span>
<span class="line-added">313 </span>
<span class="line-added">314 </span>
315     /** Prints the key-value pairs represented by this
<span class="line-modified">316         header. Also prints the RFC required blank line</span>
<span class="line-modified">317         at the end. Omits pairs with a null key. Omits</span>
<span class="line-added">318         colon if key-value pair is the requestline. */</span>
319     public synchronized void print(PrintStream p) {
320         for (int i = 0; i &lt; nkeys; i++)
321             if (keys[i] != null) {
<span class="line-modified">322                 StringBuilder sb = new StringBuilder(keys[i]);</span>
<span class="line-modified">323                 if (values[i] != null) {</span>
<span class="line-added">324                     sb.append(&quot;: &quot; + values[i]);</span>
<span class="line-added">325                 } else if (i != 0 || !isRequestline(keys[i])) {</span>
<span class="line-added">326                     sb.append(&quot;:&quot;);</span>
<span class="line-added">327                 }</span>
<span class="line-added">328                 p.print(sb.append(&quot;\r\n&quot;));</span>
329             }
330         p.print(&quot;\r\n&quot;);
331         p.flush();
332     }
333 
334     /** Adds a key value pair to the end of the
335         header.  Duplicates are allowed */
336     public synchronized void add(String k, String v) {
337         grow();
338         keys[nkeys] = k;
339         values[nkeys] = v;
340         nkeys++;
341     }
342 
343     /** Prepends a key value pair to the beginning of the
344         header.  Duplicates are allowed */
345     public synchronized void prepend(String k, String v) {
346         grow();
347         for (int i = nkeys; i &gt; 0; i--) {
348             keys[i] = keys[i-1];
</pre>
</td>
</tr>
</table>
<center><a href="ApplicationLaunchException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ParseUtil.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>