<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/net/www/MessageHeader.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ApplicationLaunchException.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ParseUtil.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/net/www/MessageHeader.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 286,18 ***</span>
          }
  
          return Collections.unmodifiableMap(m);
      }
  
      /** Prints the key-value pairs represented by this
<span class="line-modified">!         header.  Also prints the RFC required blank line</span>
<span class="line-modified">!         at the end. Omits pairs with a null key. */</span>
      public synchronized void print(PrintStream p) {
          for (int i = 0; i &lt; nkeys; i++)
              if (keys[i] != null) {
<span class="line-modified">!                 p.print(keys[i] +</span>
<span class="line-modified">!                     (values[i] != null ? &quot;: &quot;+values[i]: &quot;&quot;) + &quot;\r\n&quot;);</span>
              }
          p.print(&quot;\r\n&quot;);
          p.flush();
      }
  
<span class="line-new-header">--- 286,48 ---</span>
          }
  
          return Collections.unmodifiableMap(m);
      }
  
<span class="line-added">+     /** Check if a line of message header looks like a request line.</span>
<span class="line-added">+      * This method does not perform a full validation but simply</span>
<span class="line-added">+      * returns false if the line does not end with &#39;HTTP/[1-9].[0-9]&#39;</span>
<span class="line-added">+      * @param line the line to check.</span>
<span class="line-added">+      * @return true if the line might be a request line.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private boolean isRequestline(String line) {</span>
<span class="line-added">+         String k = line.trim();</span>
<span class="line-added">+         int i = k.lastIndexOf(&#39; &#39;);</span>
<span class="line-added">+         if (i &lt;= 0) return false;</span>
<span class="line-added">+         int len = k.length();</span>
<span class="line-added">+         if (len - i &lt; 9) return false;</span>
<span class="line-added">+ </span>
<span class="line-added">+         char c1 = k.charAt(len-3);</span>
<span class="line-added">+         char c2 = k.charAt(len-2);</span>
<span class="line-added">+         char c3 = k.charAt(len-1);</span>
<span class="line-added">+         if (c1 &lt; &#39;1&#39; || c1 &gt; &#39;9&#39;) return false;</span>
<span class="line-added">+         if (c2 != &#39;.&#39;) return false;</span>
<span class="line-added">+         if (c3 &lt; &#39;0&#39; || c3 &gt; &#39;9&#39;) return false;</span>
<span class="line-added">+ </span>
<span class="line-added">+         return (k.substring(i+1, len-3).equalsIgnoreCase(&quot;HTTP/&quot;));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
      /** Prints the key-value pairs represented by this
<span class="line-modified">!         header. Also prints the RFC required blank line</span>
<span class="line-modified">!         at the end. Omits pairs with a null key. Omits</span>
<span class="line-added">+         colon if key-value pair is the requestline. */</span>
      public synchronized void print(PrintStream p) {
          for (int i = 0; i &lt; nkeys; i++)
              if (keys[i] != null) {
<span class="line-modified">!                 StringBuilder sb = new StringBuilder(keys[i]);</span>
<span class="line-modified">!                 if (values[i] != null) {</span>
<span class="line-added">+                     sb.append(&quot;: &quot; + values[i]);</span>
<span class="line-added">+                 } else if (i != 0 || !isRequestline(keys[i])) {</span>
<span class="line-added">+                     sb.append(&quot;:&quot;);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 p.print(sb.append(&quot;\r\n&quot;));</span>
              }
          p.print(&quot;\r\n&quot;);
          p.flush();
      }
  
</pre>
<center><a href="ApplicationLaunchException.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ParseUtil.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>