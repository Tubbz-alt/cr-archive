<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/net/www/protocol/https/HttpsURLConnectionImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DelegateHttpsURLConnection.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../jar/Handler.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/net/www/protocol/https/HttpsURLConnectionImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.net.www.protocol.https;
 27 
 28 import java.net.URL;
 29 import java.net.Proxy;
 30 import java.net.ProtocolException;
 31 import java.net.MalformedURLException;
 32 import java.io.*;
 33 import java.net.Authenticator;
 34 import javax.net.ssl.*;
 35 import java.security.Permission;
 36 import java.security.Principal;
 37 import java.util.Map;
 38 import java.util.List;
 39 import java.util.Optional;

 40 import sun.net.www.http.HttpClient;
 41 
 42 /**
 43  * A class to represent an HTTP connection to a remote object.
 44  *
 45  * Ideally, this class should subclass and inherit the http handler
 46  * implementation, but it can&#39;t do so because that class have the
 47  * wrong Java Type.  Thus it uses the delegate (aka, the
 48  * Adapter/Wrapper design pattern) to reuse code from the http
 49  * handler.
 50  *
 51  * Since it would use a delegate to access
 52  * sun.net.www.protocol.http.HttpURLConnection functionalities, it
 53  * needs to implement all public methods in it&#39;s super class and all
 54  * the way to Object.
 55  *
 56  */
 57 public class HttpsURLConnectionImpl
 58         extends javax.net.ssl.HttpsURLConnection {
 59 
<span class="line-modified"> 60     // NOTE: made protected for plugin so that subclass can set it.</span>
<span class="line-removed"> 61     protected DelegateHttpsURLConnection delegate;</span>
 62 
 63     HttpsURLConnectionImpl(URL u, Handler handler) throws IOException {
 64         this(u, null, handler);
 65     }
 66 
 67     static URL checkURL(URL u) throws IOException {
 68         if (u != null) {
 69             if (u.toExternalForm().indexOf(&#39;\n&#39;) &gt; -1) {
 70                 throw new MalformedURLException(&quot;Illegal character in URL&quot;);
 71             }
 72         }




 73         return u;
 74     }
 75 
 76     HttpsURLConnectionImpl(URL u, Proxy p, Handler handler) throws IOException {
 77         super(checkURL(u));
 78         delegate = new DelegateHttpsURLConnection(url, p, handler, this);
 79     }
 80 
<span class="line-removed"> 81     // NOTE: introduced for plugin</span>
<span class="line-removed"> 82     // subclass needs to overwrite this to set delegate to</span>
<span class="line-removed"> 83     // the appropriate delegatee</span>
<span class="line-removed"> 84     protected HttpsURLConnectionImpl(URL u) throws IOException {</span>
<span class="line-removed"> 85         super(u);</span>
<span class="line-removed"> 86     }</span>
<span class="line-removed"> 87 </span>
 88     /**
 89      * Create a new HttpClient object, bypassing the cache of
 90      * HTTP client objects/connections.
 91      *
 92      * @param url       the URL being accessed
 93      */
 94     protected void setNewClient(URL url) throws IOException {
 95         delegate.setNewClient(url, false);
 96     }
 97 
 98     /**
 99      * Obtain a HttpClient object. Use the cached copy if specified.
100      *
101      * @param url       the URL being accessed
102      * @param useCache  whether the cached connection should be used
103      *                  if present
104      */
105     protected void setNewClient(URL url, boolean useCache)
106             throws IOException {
107         delegate.setNewClient(url, useCache);
</pre>
<hr />
<pre>
202     /**
203      * Returns the principal the client sent to the
204      * server, or null if the client did not authenticate.
205      */
206     public Principal getLocalPrincipal()
207     {
208         return delegate.getLocalPrincipal();
209     }
210 
211     /*
212      * Allowable input/output sequences:
213      * [interpreted as POST/PUT]
214      * - get output, [write output,] get input, [read input]
215      * - get output, [write output]
216      * [interpreted as GET]
217      * - get input, [read input]
218      * Disallowed:
219      * - get input, [read input,] get output, [write output]
220      */
221 
<span class="line-modified">222     public synchronized OutputStream getOutputStream() throws IOException {</span>
223         return delegate.getOutputStream();
224     }
225 
<span class="line-modified">226     public synchronized InputStream getInputStream() throws IOException {</span>
227         return delegate.getInputStream();
228     }
229 
230     public InputStream getErrorStream() {
231         return delegate.getErrorStream();
232     }
233 
234     /**
235      * Disconnect from the server.
236      */
237     public void disconnect() {
238         delegate.disconnect();
239     }
240 
241     public boolean usingProxy() {
242         return delegate.usingProxy();
243     }
244 
245     /**
246      * Returns an unmodifiable Map of the header fields.
</pre>
<hr />
<pre>
280         return delegate.getHeaderFieldKey(n);
281     }
282 
283     /**
284      * Sets request property. If a property with the key already
285      * exists, overwrite its value with the new value.
286      * @param value the value to be set
287      */
288     public void setRequestProperty(String key, String value) {
289         delegate.setRequestProperty(key, value);
290     }
291 
292     /**
293      * Adds a general request property specified by a
294      * key-value pair.  This method will not overwrite
295      * existing values associated with the same key.
296      *
297      * @param   key     the keyword by which the request is known
298      *                  (e.g., &quot;&lt;code&gt;accept&lt;/code&gt;&quot;).
299      * @param   value  the value associated with it.
<span class="line-modified">300      * @see #getRequestProperties(java.lang.String)</span>
301      * @since 1.4
302      */
303     public void addRequestProperty(String key, String value) {
304         delegate.addRequestProperty(key, value);
305     }
306 
307     /**
308      * Overwrite super class method
309      */
310     public int getResponseCode() throws IOException {
311         return delegate.getResponseCode();
312     }
313 
314     public String getRequestProperty(String key) {
315         return delegate.getRequestProperty(key);
316     }
317 
318     /**
319      * Returns an unmodifiable Map of general request
320      * properties for this connection. The Map keys
</pre>
<hr />
<pre>
447     public boolean getUseCaches() {
448         return delegate.getUseCaches();
449     }
450 
451     public void setIfModifiedSince(long ifmodifiedsince) {
452         delegate.setIfModifiedSince(ifmodifiedsince);
453     }
454 
455     public long getIfModifiedSince() {
456         return delegate.getIfModifiedSince();
457     }
458 
459     public boolean getDefaultUseCaches() {
460         return delegate.getDefaultUseCaches();
461     }
462 
463     public void setDefaultUseCaches(boolean defaultusecaches) {
464         delegate.setDefaultUseCaches(defaultusecaches);
465     }
466 
<span class="line-removed">467     /*</span>
<span class="line-removed">468      * finalize (dispose) the delegated object.  Otherwise</span>
<span class="line-removed">469      * sun.net.www.protocol.http.HttpURLConnection&#39;s finalize()</span>
<span class="line-removed">470      * would have to be made public.</span>
<span class="line-removed">471      */</span>
<span class="line-removed">472     @SuppressWarnings(&quot;deprecation&quot;)</span>
<span class="line-removed">473     protected void finalize() throws Throwable {</span>
<span class="line-removed">474         delegate.dispose();</span>
<span class="line-removed">475     }</span>
<span class="line-removed">476 </span>
477     public boolean equals(Object obj) {
478         return this == obj || ((obj instanceof HttpsURLConnectionImpl) &amp;&amp;
479             delegate.equals(((HttpsURLConnectionImpl)obj).delegate));
480     }
481 
482     public int hashCode() {
483         return delegate.hashCode();
484     }
485 
486     public void setConnectTimeout(int timeout) {
487         delegate.setConnectTimeout(timeout);
488     }
489 
490     public int getConnectTimeout() {
491         return delegate.getConnectTimeout();
492     }
493 
494     public void setReadTimeout(int timeout) {
495         delegate.setReadTimeout(timeout);
496     }
</pre>
</td>
<td>
<hr />
<pre>
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.net.www.protocol.https;
 27 
 28 import java.net.URL;
 29 import java.net.Proxy;
 30 import java.net.ProtocolException;
 31 import java.net.MalformedURLException;
 32 import java.io.*;
 33 import java.net.Authenticator;
 34 import javax.net.ssl.*;
 35 import java.security.Permission;
 36 import java.security.Principal;
 37 import java.util.Map;
 38 import java.util.List;
 39 import java.util.Optional;
<span class="line-added"> 40 import sun.net.util.IPAddressUtil;</span>
 41 import sun.net.www.http.HttpClient;
 42 
 43 /**
 44  * A class to represent an HTTP connection to a remote object.
 45  *
 46  * Ideally, this class should subclass and inherit the http handler
 47  * implementation, but it can&#39;t do so because that class have the
 48  * wrong Java Type.  Thus it uses the delegate (aka, the
 49  * Adapter/Wrapper design pattern) to reuse code from the http
 50  * handler.
 51  *
 52  * Since it would use a delegate to access
 53  * sun.net.www.protocol.http.HttpURLConnection functionalities, it
 54  * needs to implement all public methods in it&#39;s super class and all
 55  * the way to Object.
 56  *
 57  */
 58 public class HttpsURLConnectionImpl
 59         extends javax.net.ssl.HttpsURLConnection {
 60 
<span class="line-modified"> 61     private final DelegateHttpsURLConnection delegate;</span>

 62 
 63     HttpsURLConnectionImpl(URL u, Handler handler) throws IOException {
 64         this(u, null, handler);
 65     }
 66 
 67     static URL checkURL(URL u) throws IOException {
 68         if (u != null) {
 69             if (u.toExternalForm().indexOf(&#39;\n&#39;) &gt; -1) {
 70                 throw new MalformedURLException(&quot;Illegal character in URL&quot;);
 71             }
 72         }
<span class="line-added"> 73         String s = IPAddressUtil.checkAuthority(u);</span>
<span class="line-added"> 74         if (s != null) {</span>
<span class="line-added"> 75             throw new MalformedURLException(s);</span>
<span class="line-added"> 76         }</span>
 77         return u;
 78     }
 79 
 80     HttpsURLConnectionImpl(URL u, Proxy p, Handler handler) throws IOException {
 81         super(checkURL(u));
 82         delegate = new DelegateHttpsURLConnection(url, p, handler, this);
 83     }
 84 







 85     /**
 86      * Create a new HttpClient object, bypassing the cache of
 87      * HTTP client objects/connections.
 88      *
 89      * @param url       the URL being accessed
 90      */
 91     protected void setNewClient(URL url) throws IOException {
 92         delegate.setNewClient(url, false);
 93     }
 94 
 95     /**
 96      * Obtain a HttpClient object. Use the cached copy if specified.
 97      *
 98      * @param url       the URL being accessed
 99      * @param useCache  whether the cached connection should be used
100      *                  if present
101      */
102     protected void setNewClient(URL url, boolean useCache)
103             throws IOException {
104         delegate.setNewClient(url, useCache);
</pre>
<hr />
<pre>
199     /**
200      * Returns the principal the client sent to the
201      * server, or null if the client did not authenticate.
202      */
203     public Principal getLocalPrincipal()
204     {
205         return delegate.getLocalPrincipal();
206     }
207 
208     /*
209      * Allowable input/output sequences:
210      * [interpreted as POST/PUT]
211      * - get output, [write output,] get input, [read input]
212      * - get output, [write output]
213      * [interpreted as GET]
214      * - get input, [read input]
215      * Disallowed:
216      * - get input, [read input,] get output, [write output]
217      */
218 
<span class="line-modified">219     public OutputStream getOutputStream() throws IOException {</span>
220         return delegate.getOutputStream();
221     }
222 
<span class="line-modified">223     public InputStream getInputStream() throws IOException {</span>
224         return delegate.getInputStream();
225     }
226 
227     public InputStream getErrorStream() {
228         return delegate.getErrorStream();
229     }
230 
231     /**
232      * Disconnect from the server.
233      */
234     public void disconnect() {
235         delegate.disconnect();
236     }
237 
238     public boolean usingProxy() {
239         return delegate.usingProxy();
240     }
241 
242     /**
243      * Returns an unmodifiable Map of the header fields.
</pre>
<hr />
<pre>
277         return delegate.getHeaderFieldKey(n);
278     }
279 
280     /**
281      * Sets request property. If a property with the key already
282      * exists, overwrite its value with the new value.
283      * @param value the value to be set
284      */
285     public void setRequestProperty(String key, String value) {
286         delegate.setRequestProperty(key, value);
287     }
288 
289     /**
290      * Adds a general request property specified by a
291      * key-value pair.  This method will not overwrite
292      * existing values associated with the same key.
293      *
294      * @param   key     the keyword by which the request is known
295      *                  (e.g., &quot;&lt;code&gt;accept&lt;/code&gt;&quot;).
296      * @param   value  the value associated with it.
<span class="line-modified">297      * @see #getRequestProperty(java.lang.String)</span>
298      * @since 1.4
299      */
300     public void addRequestProperty(String key, String value) {
301         delegate.addRequestProperty(key, value);
302     }
303 
304     /**
305      * Overwrite super class method
306      */
307     public int getResponseCode() throws IOException {
308         return delegate.getResponseCode();
309     }
310 
311     public String getRequestProperty(String key) {
312         return delegate.getRequestProperty(key);
313     }
314 
315     /**
316      * Returns an unmodifiable Map of general request
317      * properties for this connection. The Map keys
</pre>
<hr />
<pre>
444     public boolean getUseCaches() {
445         return delegate.getUseCaches();
446     }
447 
448     public void setIfModifiedSince(long ifmodifiedsince) {
449         delegate.setIfModifiedSince(ifmodifiedsince);
450     }
451 
452     public long getIfModifiedSince() {
453         return delegate.getIfModifiedSince();
454     }
455 
456     public boolean getDefaultUseCaches() {
457         return delegate.getDefaultUseCaches();
458     }
459 
460     public void setDefaultUseCaches(boolean defaultusecaches) {
461         delegate.setDefaultUseCaches(defaultusecaches);
462     }
463 










464     public boolean equals(Object obj) {
465         return this == obj || ((obj instanceof HttpsURLConnectionImpl) &amp;&amp;
466             delegate.equals(((HttpsURLConnectionImpl)obj).delegate));
467     }
468 
469     public int hashCode() {
470         return delegate.hashCode();
471     }
472 
473     public void setConnectTimeout(int timeout) {
474         delegate.setConnectTimeout(timeout);
475     }
476 
477     public int getConnectTimeout() {
478         return delegate.getConnectTimeout();
479     }
480 
481     public void setReadTimeout(int timeout) {
482         delegate.setReadTimeout(timeout);
483     }
</pre>
</td>
</tr>
</table>
<center><a href="DelegateHttpsURLConnection.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../jar/Handler.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>