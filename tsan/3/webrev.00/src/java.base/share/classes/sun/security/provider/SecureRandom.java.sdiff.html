<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/provider/SecureRandom.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="PolicyParser.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SubjectCodeSource.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/provider/SecureRandom.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2014, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 38  * &lt;p&gt;Note that if a seed is not provided, we attempt to provide sufficient
 39  * seed bytes to completely randomize the internal state of the generator
 40  * (20 bytes).  However, our seed generation algorithm has not been thoroughly
 41  * studied or widely deployed.
 42  *
 43  * &lt;p&gt;Also note that when a random object is deserialized,
 44  * &lt;a href=&quot;#engineNextBytes(byte[])&quot;&gt;engineNextBytes&lt;/a&gt; invoked on the
 45  * restored random object will yield the exact same (random) bytes as the
 46  * original object.  If this behaviour is not desired, the restored random
 47  * object should be seeded, using
 48  * &lt;a href=&quot;#engineSetSeed(byte[])&quot;&gt;engineSetSeed&lt;/a&gt;.
 49  *
 50  * @author Benjamin Renaud
 51  * @author Josh Bloch
 52  * @author Gadi Guy
 53  */
 54 
 55 public final class SecureRandom extends SecureRandomSpi
 56 implements java.io.Serializable {
 57 

 58     private static final long serialVersionUID = 3581829991155417889L;
 59 
 60     private static final int DIGEST_SIZE = 20;
 61     private transient MessageDigest digest;
 62     private byte[] state;
 63     private byte[] remainder;
 64     private int remCount;
 65 
 66     /**
 67      * This empty constructor automatically seeds the generator.  We attempt
 68      * to provide sufficient seed bytes to completely randomize the internal
 69      * state of the generator (20 bytes).  Note, however, that our seed
 70      * generation algorithm has not been thoroughly studied or widely deployed.
 71      *
 72      * &lt;p&gt;The first time this constructor is called in a given Virtual Machine,
 73      * it may take several seconds of CPU time to seed the generator, depending
 74      * on the underlying hardware.  Successive calls run quickly because they
 75      * rely on the same (internal) pseudo-random number generator for their
 76      * seed bits.
 77      */
</pre>
<hr />
<pre>
254                 output[i] = 0;
255             }
256             remCount += todo;
257         }
258 
259         // Store remainder for next time
260         remainder = output;
261         remCount %= DIGEST_SIZE;
262     }
263 
264     /*
265      * readObject is called to restore the state of the random object from
266      * a stream.  We have to create a new instance of MessageDigest, because
267      * it is not included in the stream (it is marked &quot;transient&quot;).
268      *
269      * Note that the engineNextBytes() method invoked on the restored random
270      * object will yield the exact same (random) bytes as the original.
271      * If you do not want this behaviour, you should re-seed the restored
272      * random object, using engineSetSeed().
273      */

274     private void readObject(java.io.ObjectInputStream s)
275         throws IOException, ClassNotFoundException {
276 
277         s.defaultReadObject ();
278 
279         try {
280             /*
281              * Use the local SUN implementation to avoid native
282              * performance overhead.
283              */
284             digest = MessageDigest.getInstance(&quot;SHA&quot;, &quot;SUN&quot;);
285         } catch (NoSuchProviderException | NoSuchAlgorithmException e) {
286             // Fallback to any available.
287             try {
288                 digest = MessageDigest.getInstance(&quot;SHA&quot;);
289             } catch (NoSuchAlgorithmException exc) {
290                 throw new InternalError(
291                     &quot;internal error: SHA-1 not available.&quot;, exc);
292             }
293         }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 38  * &lt;p&gt;Note that if a seed is not provided, we attempt to provide sufficient
 39  * seed bytes to completely randomize the internal state of the generator
 40  * (20 bytes).  However, our seed generation algorithm has not been thoroughly
 41  * studied or widely deployed.
 42  *
 43  * &lt;p&gt;Also note that when a random object is deserialized,
 44  * &lt;a href=&quot;#engineNextBytes(byte[])&quot;&gt;engineNextBytes&lt;/a&gt; invoked on the
 45  * restored random object will yield the exact same (random) bytes as the
 46  * original object.  If this behaviour is not desired, the restored random
 47  * object should be seeded, using
 48  * &lt;a href=&quot;#engineSetSeed(byte[])&quot;&gt;engineSetSeed&lt;/a&gt;.
 49  *
 50  * @author Benjamin Renaud
 51  * @author Josh Bloch
 52  * @author Gadi Guy
 53  */
 54 
 55 public final class SecureRandom extends SecureRandomSpi
 56 implements java.io.Serializable {
 57 
<span class="line-added"> 58     @java.io.Serial</span>
 59     private static final long serialVersionUID = 3581829991155417889L;
 60 
 61     private static final int DIGEST_SIZE = 20;
 62     private transient MessageDigest digest;
 63     private byte[] state;
 64     private byte[] remainder;
 65     private int remCount;
 66 
 67     /**
 68      * This empty constructor automatically seeds the generator.  We attempt
 69      * to provide sufficient seed bytes to completely randomize the internal
 70      * state of the generator (20 bytes).  Note, however, that our seed
 71      * generation algorithm has not been thoroughly studied or widely deployed.
 72      *
 73      * &lt;p&gt;The first time this constructor is called in a given Virtual Machine,
 74      * it may take several seconds of CPU time to seed the generator, depending
 75      * on the underlying hardware.  Successive calls run quickly because they
 76      * rely on the same (internal) pseudo-random number generator for their
 77      * seed bits.
 78      */
</pre>
<hr />
<pre>
255                 output[i] = 0;
256             }
257             remCount += todo;
258         }
259 
260         // Store remainder for next time
261         remainder = output;
262         remCount %= DIGEST_SIZE;
263     }
264 
265     /*
266      * readObject is called to restore the state of the random object from
267      * a stream.  We have to create a new instance of MessageDigest, because
268      * it is not included in the stream (it is marked &quot;transient&quot;).
269      *
270      * Note that the engineNextBytes() method invoked on the restored random
271      * object will yield the exact same (random) bytes as the original.
272      * If you do not want this behaviour, you should re-seed the restored
273      * random object, using engineSetSeed().
274      */
<span class="line-added">275     @java.io.Serial</span>
276     private void readObject(java.io.ObjectInputStream s)
277         throws IOException, ClassNotFoundException {
278 
279         s.defaultReadObject ();
280 
281         try {
282             /*
283              * Use the local SUN implementation to avoid native
284              * performance overhead.
285              */
286             digest = MessageDigest.getInstance(&quot;SHA&quot;, &quot;SUN&quot;);
287         } catch (NoSuchProviderException | NoSuchAlgorithmException e) {
288             // Fallback to any available.
289             try {
290                 digest = MessageDigest.getInstance(&quot;SHA&quot;);
291             } catch (NoSuchAlgorithmException exc) {
292                 throw new InternalError(
293                     &quot;internal error: SHA-1 not available.&quot;, exc);
294             }
295         }
</pre>
</td>
</tr>
</table>
<center><a href="PolicyParser.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SubjectCodeSource.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>