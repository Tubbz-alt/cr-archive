<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/sun/net/www/protocol/http/BasicAuthentication.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AuthenticationInfo.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DigestAuthentication.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/net/www/protocol/http/BasicAuthentication.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1997, 2016, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -27,15 +27,21 @@</span>
  
  import java.net.URL;
  import java.net.URI;
  import java.net.URISyntaxException;
  import java.net.PasswordAuthentication;
<span class="udiff-line-added">+ import java.nio.ByteBuffer;</span>
<span class="udiff-line-added">+ import java.nio.CharBuffer;</span>
<span class="udiff-line-added">+ import java.nio.charset.Charset;</span>
  import java.io.IOException;
  import java.io.OutputStream;
<span class="udiff-line-added">+ import java.util.Arrays;</span>
  import java.util.Base64;
  import java.util.Objects;
  import sun.net.www.HeaderParser;
<span class="udiff-line-added">+ import sun.nio.cs.ISO_8859_1;</span>
<span class="udiff-line-added">+ import sun.nio.cs.UTF_8;</span>
  
  /**
   * BasicAuthentication: Encapsulate an http server authentication using
   * the &quot;basic&quot; scheme.
   *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -43,45 +49,27 @@</span>
   */
  
  
  class BasicAuthentication extends AuthenticationInfo {
  
<span class="udiff-line-added">+     @java.io.Serial</span>
      private static final long serialVersionUID = 100L;
  
      /** The authentication string for this host, port, and realm.  This is
          a simple BASE64 encoding of &quot;login:password&quot;.    */
<span class="udiff-line-modified-removed">-     String auth;</span>
<span class="udiff-line-modified-added">+     final String auth;</span>
  
      /**
       * Create a BasicAuthentication
       */
      public BasicAuthentication(boolean isProxy, String host, int port,
                                 String realm, PasswordAuthentication pw,
<span class="udiff-line-modified-removed">-                                String authenticatorKey) {</span>
<span class="udiff-line-modified-added">+                                boolean isUTF8, String authenticatorKey) {</span>
          super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
                AuthScheme.BASIC, host, port, realm,
                Objects.requireNonNull(authenticatorKey));
<span class="udiff-line-modified-removed">-         String plain = pw.getUserName() + &quot;:&quot;;</span>
<span class="udiff-line-removed">-         byte[] nameBytes = null;</span>
<span class="udiff-line-removed">-         try {</span>
<span class="udiff-line-removed">-             nameBytes = plain.getBytes(&quot;ISO-8859-1&quot;);</span>
<span class="udiff-line-removed">-         } catch (java.io.UnsupportedEncodingException uee) {</span>
<span class="udiff-line-removed">-             assert false;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         // get password bytes</span>
<span class="udiff-line-removed">-         char[] passwd = pw.getPassword();</span>
<span class="udiff-line-removed">-         byte[] passwdBytes = new byte[passwd.length];</span>
<span class="udiff-line-removed">-         for (int i=0; i&lt;passwd.length; i++)</span>
<span class="udiff-line-removed">-             passwdBytes[i] = (byte)passwd[i];</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         // concatenate user name and password bytes and encode them</span>
<span class="udiff-line-removed">-         byte[] concat = new byte[nameBytes.length + passwdBytes.length];</span>
<span class="udiff-line-removed">-         System.arraycopy(nameBytes, 0, concat, 0, nameBytes.length);</span>
<span class="udiff-line-removed">-         System.arraycopy(passwdBytes, 0, concat, nameBytes.length,</span>
<span class="udiff-line-removed">-                          passwdBytes.length);</span>
<span class="udiff-line-removed">-         this.auth = &quot;Basic &quot; + Base64.getEncoder().encodeToString(concat);</span>
<span class="udiff-line-modified-added">+         this.auth = authValueFrom(pw, isUTF8);</span>
          this.pw = pw;
      }
  
      /**
       * Create a BasicAuthentication
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,38 +85,35 @@</span>
  
      /**
       * Create a BasicAuthentication
       */
      public BasicAuthentication(boolean isProxy, URL url, String realm,
<span class="udiff-line-modified-removed">-                                PasswordAuthentication pw,</span>
<span class="udiff-line-modified-added">+                                PasswordAuthentication pw, boolean isUTF8,</span>
                                 String authenticatorKey) {
          super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
                AuthScheme.BASIC, url, realm,
                Objects.requireNonNull(authenticatorKey));
<span class="udiff-line-modified-removed">-         String plain = pw.getUserName() + &quot;:&quot;;</span>
<span class="udiff-line-removed">-         byte[] nameBytes = null;</span>
<span class="udiff-line-removed">-         try {</span>
<span class="udiff-line-removed">-             nameBytes = plain.getBytes(&quot;ISO-8859-1&quot;);</span>
<span class="udiff-line-removed">-         } catch (java.io.UnsupportedEncodingException uee) {</span>
<span class="udiff-line-removed">-             assert false;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         // get password bytes</span>
<span class="udiff-line-removed">-         char[] passwd = pw.getPassword();</span>
<span class="udiff-line-removed">-         byte[] passwdBytes = new byte[passwd.length];</span>
<span class="udiff-line-removed">-         for (int i=0; i&lt;passwd.length; i++)</span>
<span class="udiff-line-removed">-             passwdBytes[i] = (byte)passwd[i];</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         // concatenate user name and password bytes and encode them</span>
<span class="udiff-line-removed">-         byte[] concat = new byte[nameBytes.length + passwdBytes.length];</span>
<span class="udiff-line-removed">-         System.arraycopy(nameBytes, 0, concat, 0, nameBytes.length);</span>
<span class="udiff-line-removed">-         System.arraycopy(passwdBytes, 0, concat, nameBytes.length,</span>
<span class="udiff-line-removed">-                          passwdBytes.length);</span>
<span class="udiff-line-removed">-         this.auth = &quot;Basic &quot; + Base64.getEncoder().encodeToString(concat);</span>
<span class="udiff-line-modified-added">+         this.auth = authValueFrom(pw, isUTF8);</span>
          this.pw = pw;
      }
  
<span class="udiff-line-added">+     private static String authValueFrom(PasswordAuthentication pw, boolean isUTF8) {</span>
<span class="udiff-line-added">+         String plain = pw.getUserName() + &quot;:&quot;;</span>
<span class="udiff-line-added">+         char[] password = pw.getPassword();</span>
<span class="udiff-line-added">+         CharBuffer cbuf = CharBuffer.allocate(plain.length() + password.length);</span>
<span class="udiff-line-added">+         cbuf.put(plain).put(password).flip();</span>
<span class="udiff-line-added">+         Charset charset = isUTF8 ? UTF_8.INSTANCE : ISO_8859_1.INSTANCE;</span>
<span class="udiff-line-added">+         ByteBuffer buf = charset.encode(cbuf);</span>
<span class="udiff-line-added">+         ByteBuffer enc = Base64.getEncoder().encode(buf);</span>
<span class="udiff-line-added">+         String ret = &quot;Basic &quot; + new String(enc.array(), enc.position(), enc.remaining(),</span>
<span class="udiff-line-added">+                 ISO_8859_1.INSTANCE);</span>
<span class="udiff-line-added">+         Arrays.fill(buf.array(), (byte) 0);</span>
<span class="udiff-line-added">+         Arrays.fill(enc.array(), (byte) 0);</span>
<span class="udiff-line-added">+         Arrays.fill(cbuf.array(), (char) 0);</span>
<span class="udiff-line-added">+         return ret;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * Create a BasicAuthentication
       */
      public BasicAuthentication(boolean isProxy, URL url, String realm,
                                 String auth, String authenticatorKey) {
</pre>
<center><a href="AuthenticationInfo.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DigestAuthentication.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>