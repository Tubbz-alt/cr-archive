<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/util/locale/provider/LocaleResources.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JRELocaleProviderAdapter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="NumberFormatProviderImpl.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/util/locale/provider/LocaleResources.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 42,10 ***</span>
<span class="line-new-header">--- 42,11 ---</span>
  
  import java.lang.ref.ReferenceQueue;
  import java.lang.ref.SoftReference;
  import java.text.MessageFormat;
  import java.text.NumberFormat;
<span class="line-added">+ import java.util.Arrays;</span>
  import java.util.Calendar;
  import java.util.HashSet;
  import java.util.LinkedHashSet;
  import java.util.Locale;
  import java.util.Map;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 175,40 ***</span>
          if (data == null || ((dfsdata = (Object[]) data.get()) == null)) {
              // Note that only dfsdata[0] is prepared here in this method. Other
              // elements are provided by the caller, yet they are cached here.
              ResourceBundle rb = localeData.getNumberFormatData(locale);
              dfsdata = new Object[3];
  
<span class="line-modified">!             // NumberElements look up. First, try the Unicode extension</span>
<span class="line-modified">!             String numElemKey;</span>
<span class="line-modified">!             String numberType = locale.getUnicodeLocaleType(&quot;nu&quot;);</span>
<span class="line-removed">-             if (numberType != null) {</span>
<span class="line-removed">-                 numElemKey = numberType + &quot;.NumberElements&quot;;</span>
<span class="line-removed">-                 if (rb.containsKey(numElemKey)) {</span>
<span class="line-removed">-                     dfsdata[0] = rb.getStringArray(numElemKey);</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
  
<span class="line-modified">!             // Next, try DefaultNumberingSystem value</span>
<span class="line-modified">!             if (dfsdata[0] == null &amp;&amp; rb.containsKey(&quot;DefaultNumberingSystem&quot;)) {</span>
<span class="line-modified">!                 numElemKey = rb.getString(&quot;DefaultNumberingSystem&quot;) + &quot;.NumberElements&quot;;</span>
<span class="line-modified">!                 if (rb.containsKey(numElemKey)) {</span>
<span class="line-modified">!                     dfsdata[0] = rb.getStringArray(numElemKey);</span>
<span class="line-modified">!                 }</span>
              }
  
<span class="line-modified">!             // Last resort. No need to check the availability.</span>
<span class="line-modified">!             // Just let it throw MissingResourceException when needed.</span>
<span class="line-modified">!             if (dfsdata[0] == null) {</span>
<span class="line-modified">!                 dfsdata[0] = rb.getStringArray(&quot;NumberElements&quot;);</span>
              }
  
<span class="line-modified">!             cache.put(DECIMAL_FORMAT_SYMBOLS_DATA_CACHEKEY,</span>
<span class="line-modified">!                       new ResourceReference(DECIMAL_FORMAT_SYMBOLS_DATA_CACHEKEY, (Object) dfsdata, referenceQueue));</span>
          }
  
<span class="line-modified">!         return dfsdata;</span>
      }
  
      public String getCurrencyName(String key) {
          Object currencyName = null;
          String cacheKey = CURRENCY_NAMES + key;
<span class="line-new-header">--- 176,48 ---</span>
          if (data == null || ((dfsdata = (Object[]) data.get()) == null)) {
              // Note that only dfsdata[0] is prepared here in this method. Other
              // elements are provided by the caller, yet they are cached here.
              ResourceBundle rb = localeData.getNumberFormatData(locale);
              dfsdata = new Object[3];
<span class="line-added">+             dfsdata[0] = getNumberStrings(rb, &quot;NumberElements&quot;);</span>
  
<span class="line-modified">!             cache.put(DECIMAL_FORMAT_SYMBOLS_DATA_CACHEKEY,</span>
<span class="line-modified">!                       new ResourceReference(DECIMAL_FORMAT_SYMBOLS_DATA_CACHEKEY, (Object) dfsdata, referenceQueue));</span>
<span class="line-modified">!         }</span>
  
<span class="line-modified">!         return dfsdata;</span>
<span class="line-modified">!     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!     private String[] getNumberStrings(ResourceBundle rb, String type) {</span>
<span class="line-modified">!         String[] ret = null;</span>
<span class="line-modified">!         String key;</span>
<span class="line-added">+         String numSys;</span>
<span class="line-added">+ </span>
<span class="line-added">+         // Number strings look up. First, try the Unicode extension</span>
<span class="line-added">+         numSys = locale.getUnicodeLocaleType(&quot;nu&quot;);</span>
<span class="line-added">+         if (numSys != null) {</span>
<span class="line-added">+             key = numSys + &quot;.&quot; + type;</span>
<span class="line-added">+             if (rb.containsKey(key)) {</span>
<span class="line-added">+                 ret = rb.getStringArray(key);</span>
              }
<span class="line-added">+         }</span>
  
<span class="line-modified">!         // Next, try DefaultNumberingSystem value</span>
<span class="line-modified">!         if (ret == null &amp;&amp; rb.containsKey(&quot;DefaultNumberingSystem&quot;)) {</span>
<span class="line-modified">!             key = rb.getString(&quot;DefaultNumberingSystem&quot;) + &quot;.&quot; + type;</span>
<span class="line-modified">!             if (rb.containsKey(key)) {</span>
<span class="line-added">+                 ret = rb.getStringArray(key);</span>
              }
<span class="line-added">+         }</span>
  
<span class="line-modified">!         // Last resort. No need to check the availability.</span>
<span class="line-modified">!         // Just let it throw MissingResourceException when needed.</span>
<span class="line-added">+         if (ret == null) {</span>
<span class="line-added">+             ret = rb.getStringArray(type);</span>
          }
  
<span class="line-modified">!         return ret;</span>
      }
  
      public String getCurrencyName(String key) {
          Object currencyName = null;
          String cacheKey = CURRENCY_NAMES + key;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 323,11 ***</span>
      String[][] getZoneStrings() {
          TimeZoneNamesBundle rb = localeData.getTimeZoneNames(locale);
          Set&lt;String&gt; keyset = getZoneIDs();
          // Use a LinkedHashSet to preseve the order
          Set&lt;String[]&gt; value = new LinkedHashSet&lt;&gt;();
<span class="line-modified">!         Set&lt;String&gt; tzIds = new HashSet&lt;&gt;(Set.of(TimeZone.getAvailableIDs()));</span>
          for (String key : keyset) {
              if (!key.startsWith(TZNB_EXCITY_PREFIX)) {
                  value.add(rb.getStringArray(key));
                  tzIds.remove(key);
              }
<span class="line-new-header">--- 332,11 ---</span>
      String[][] getZoneStrings() {
          TimeZoneNamesBundle rb = localeData.getTimeZoneNames(locale);
          Set&lt;String&gt; keyset = getZoneIDs();
          // Use a LinkedHashSet to preseve the order
          Set&lt;String[]&gt; value = new LinkedHashSet&lt;&gt;();
<span class="line-modified">!         Set&lt;String&gt; tzIds = new HashSet&lt;&gt;(Arrays.asList(TimeZone.getAvailableIDs()));</span>
          for (String key : keyset) {
              if (!key.startsWith(TZNB_EXCITY_PREFIX)) {
                  value.add(rb.getStringArray(key));
                  tzIds.remove(key);
              }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 482,11 ***</span>
          removeEmptyReferences();
          ResourceReference data = cache.get(NUMBER_PATTERNS_CACHEKEY);
  
          if (data == null || ((numberPatterns = (String[]) data.get()) == null)) {
              ResourceBundle resource = localeData.getNumberFormatData(locale);
<span class="line-modified">!             numberPatterns = resource.getStringArray(&quot;NumberPatterns&quot;);</span>
              cache.put(NUMBER_PATTERNS_CACHEKEY,
                        new ResourceReference(NUMBER_PATTERNS_CACHEKEY, (Object) numberPatterns, referenceQueue));
          }
  
          return numberPatterns;
<span class="line-new-header">--- 491,11 ---</span>
          removeEmptyReferences();
          ResourceReference data = cache.get(NUMBER_PATTERNS_CACHEKEY);
  
          if (data == null || ((numberPatterns = (String[]) data.get()) == null)) {
              ResourceBundle resource = localeData.getNumberFormatData(locale);
<span class="line-modified">!             numberPatterns = getNumberStrings(resource, &quot;NumberPatterns&quot;);</span>
              cache.put(NUMBER_PATTERNS_CACHEKEY,
                        new ResourceReference(NUMBER_PATTERNS_CACHEKEY, (Object) numberPatterns, referenceQueue));
          }
  
          return numberPatterns;
</pre>
<center><a href="JRELocaleProviderAdapter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="NumberFormatProviderImpl.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>