<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/security/util/ConstraintsParameters.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="BitArray.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CurveDB.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/util/ConstraintsParameters.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 29,10 ***</span>
<span class="line-new-header">--- 29,13 ---</span>
  
  import java.security.AlgorithmParameters;
  import java.security.Key;
  import java.security.Timestamp;
  import java.security.cert.X509Certificate;
<span class="line-added">+ import java.security.interfaces.ECKey;</span>
<span class="line-added">+ import java.security.interfaces.XECKey;</span>
<span class="line-added">+ import java.security.spec.NamedParameterSpec;</span>
  import java.util.Date;
  
  /**
   * This class contains parameters for checking against constraints that extend
   * past the publicly available parameters in java.security.AlgorithmConstraints.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 47,12 ***</span>
       */
      // Algorithm string to be checked against constraints
      private final String algorithm;
      // AlgorithmParameters to the algorithm being checked
      private final AlgorithmParameters algParams;
<span class="line-modified">!     // Public Key being checked against constraints</span>
<span class="line-modified">!     private final Key publicKey;</span>
  
      /*
       * New values that are checked against constraints that the current public
       * API does not support.
       */
<span class="line-new-header">--- 50,12 ---</span>
       */
      // Algorithm string to be checked against constraints
      private final String algorithm;
      // AlgorithmParameters to the algorithm being checked
      private final AlgorithmParameters algParams;
<span class="line-modified">!     // Key being checked against constraints</span>
<span class="line-modified">!     private final Key key;</span>
  
      /*
       * New values that are checked against constraints that the current public
       * API does not support.
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 64,28 ***</span>
      // PKIXParameter date
      private final Date pkixDate;
      // Timestamp of the signed JAR file
      private final Timestamp jarTimestamp;
      private final String variant;
  
      public ConstraintsParameters(X509Certificate c, boolean match,
              Date pkixdate, Timestamp jarTime, String variant) {
          cert = c;
          trustedMatch = match;
          pkixDate = pkixdate;
          jarTimestamp = jarTime;
          this.variant = (variant == null ? Validator.VAR_GENERIC : variant);
          algorithm = null;
          algParams = null;
<span class="line-modified">!         publicKey = null;</span>
      }
  
      public ConstraintsParameters(String algorithm, AlgorithmParameters params,
              Key key, String variant) {
          this.algorithm = algorithm;
          algParams = params;
<span class="line-modified">!         this.publicKey = key;</span>
          cert = null;
          trustedMatch = false;
          pkixDate = null;
          jarTimestamp = null;
          this.variant = (variant == null ? Validator.VAR_GENERIC : variant);
<span class="line-new-header">--- 67,37 ---</span>
      // PKIXParameter date
      private final Date pkixDate;
      // Timestamp of the signed JAR file
      private final Timestamp jarTimestamp;
      private final String variant;
<span class="line-added">+     // Named Curve</span>
<span class="line-added">+     private final String[] curveStr;</span>
<span class="line-added">+     private static final String[] EMPTYLIST = new String[0];</span>
  
      public ConstraintsParameters(X509Certificate c, boolean match,
              Date pkixdate, Timestamp jarTime, String variant) {
          cert = c;
          trustedMatch = match;
          pkixDate = pkixdate;
          jarTimestamp = jarTime;
          this.variant = (variant == null ? Validator.VAR_GENERIC : variant);
          algorithm = null;
          algParams = null;
<span class="line-modified">!         key = null;</span>
<span class="line-added">+         if (c != null) {</span>
<span class="line-added">+             curveStr = getNamedCurveFromKey(c.getPublicKey());</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             curveStr = EMPTYLIST;</span>
<span class="line-added">+         }</span>
      }
  
      public ConstraintsParameters(String algorithm, AlgorithmParameters params,
              Key key, String variant) {
          this.algorithm = algorithm;
          algParams = params;
<span class="line-modified">!         this.key = key;</span>
<span class="line-added">+         curveStr = getNamedCurveFromKey(key);</span>
          cert = null;
          trustedMatch = false;
          pkixDate = null;
          jarTimestamp = null;
          this.variant = (variant == null ? Validator.VAR_GENERIC : variant);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 107,13 ***</span>
  
      public AlgorithmParameters getAlgParams() {
          return algParams;
      }
  
<span class="line-modified">!     public Key getPublicKey() {</span>
<span class="line-modified">!         return publicKey;</span>
      }
      // Returns if the trust anchor has a match if anchor checking is enabled.
      public boolean isTrustedMatch() {
          return trustedMatch;
      }
  
<span class="line-new-header">--- 119,14 ---</span>
  
      public AlgorithmParameters getAlgParams() {
          return algParams;
      }
  
<span class="line-modified">!     public Key getKey() {</span>
<span class="line-modified">!         return key;</span>
      }
<span class="line-added">+ </span>
      // Returns if the trust anchor has a match if anchor checking is enabled.
      public boolean isTrustedMatch() {
          return trustedMatch;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 130,6 ***</span>
<span class="line-new-header">--- 143,49 ---</span>
      }
  
      public String getVariant() {
          return variant;
      }
<span class="line-added">+ </span>
<span class="line-added">+     public String[] getNamedCurve() {</span>
<span class="line-added">+         return curveStr;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public static String[] getNamedCurveFromKey(Key key) {</span>
<span class="line-added">+         if (key instanceof ECKey) {</span>
<span class="line-added">+             NamedCurve nc = CurveDB.lookup(((ECKey)key).getParams());</span>
<span class="line-added">+             return (nc == null ? EMPTYLIST : CurveDB.getNamesByOID(nc.getObjectId()));</span>
<span class="line-added">+         } else if (key instanceof XECKey) {</span>
<span class="line-added">+             String[] s = {</span>
<span class="line-added">+                     ((NamedParameterSpec)((XECKey)key).getParams()).getName()</span>
<span class="line-added">+             };</span>
<span class="line-added">+             return s;</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             return EMPTYLIST;</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     public String toString() {</span>
<span class="line-added">+         StringBuilder s = new StringBuilder();</span>
<span class="line-added">+         s.append(&quot;Cert:       &quot;);</span>
<span class="line-added">+         if (cert != null) {</span>
<span class="line-added">+             s.append(cert.toString());</span>
<span class="line-added">+             s.append(&quot;\nSigAlgo:    &quot;);</span>
<span class="line-added">+             s.append(cert.getSigAlgName());</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             s.append(&quot;None&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         s.append(&quot;\nAlgParams:  &quot;);</span>
<span class="line-added">+         if (getAlgParams() != null) {</span>
<span class="line-added">+             getAlgParams().toString();</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             s.append(&quot;None&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         s.append(&quot;\nNamedCurves: &quot;);</span>
<span class="line-added">+         for (String c : getNamedCurve()) {</span>
<span class="line-added">+             s.append(c + &quot; &quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         s.append(&quot;\nVariant:    &quot; + getVariant());</span>
<span class="line-added">+         return s.toString();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
  }
</pre>
<center><a href="BitArray.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="CurveDB.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>