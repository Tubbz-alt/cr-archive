<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/util/DerOutputStream.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="DerInputStream.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="DerValue.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/util/DerOutputStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1996, 2010, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.util;
 27 
 28 import java.io.ByteArrayOutputStream;
 29 import java.io.OutputStream;
 30 import java.io.IOException;


 31 import java.text.SimpleDateFormat;
 32 import java.util.Date;
 33 import java.util.TimeZone;
 34 import java.util.Comparator;
 35 import java.util.Arrays;
<span class="line-removed"> 36 import java.math.BigInteger;</span>
 37 import java.util.Locale;
 38 

 39 
 40 /**
 41  * Output stream marshaling DER-encoded data.  This is eventually provided
 42  * in the form of a byte array; there is no advance limit on the size of
 43  * that byte array.
 44  *
 45  * &lt;P&gt;At this time, this class supports only a subset of the types of
 46  * DER data encodings which are defined.  That subset is sufficient for
 47  * generating most X.509 certificates.
 48  *
 49  *
 50  * @author David Brownell
 51  * @author Amit Kapoor
 52  * @author Hemma Prafullchandra
 53  */
 54 public class DerOutputStream
 55 extends ByteArrayOutputStream implements DerEncoder {
 56     /**
 57      * Construct an DER output stream.
 58      *
</pre>
<hr />
<pre>
381 
382         // order the element encodings
383         byte[][] bufs = new byte[streams.length][];
384         for (int i = 0; i &lt; streams.length; i++) {
385             bufs[i] = streams[i].toByteArray();
386         }
387         Arrays.&lt;byte[]&gt;sort(bufs, order);
388 
389         DerOutputStream bytes = new DerOutputStream();
390         for (int i = 0; i &lt; streams.length; i++) {
391             bytes.write(bufs[i]);
392         }
393         write(tag, bytes);
394 
395     }
396 
397     /**
398      * Marshals a string as a DER encoded UTF8String.
399      */
400     public void putUTF8String(String s) throws IOException {
<span class="line-modified">401         writeString(s, DerValue.tag_UTF8String, &quot;UTF8&quot;);</span>
402     }
403 
404     /**
405      * Marshals a string as a DER encoded PrintableString.
406      */
407     public void putPrintableString(String s) throws IOException {
<span class="line-modified">408         writeString(s, DerValue.tag_PrintableString, &quot;ASCII&quot;);</span>
409     }
410 
411     /**
412      * Marshals a string as a DER encoded T61String.
413      */
414     public void putT61String(String s) throws IOException {
415         /*
416          * Works for characters that are defined in both ASCII and
417          * T61.
418          */
<span class="line-modified">419         writeString(s, DerValue.tag_T61String, &quot;ISO-8859-1&quot;);</span>
420     }
421 
422     /**
423      * Marshals a string as a DER encoded IA5String.
424      */
425     public void putIA5String(String s) throws IOException {
<span class="line-modified">426         writeString(s, DerValue.tag_IA5String, &quot;ASCII&quot;);</span>
427     }
428 
429     /**
430      * Marshals a string as a DER encoded BMPString.
431      */
432     public void putBMPString(String s) throws IOException {
<span class="line-modified">433         writeString(s, DerValue.tag_BMPString, &quot;UnicodeBigUnmarked&quot;);</span>
434     }
435 
436     /**
437      * Marshals a string as a DER encoded GeneralString.
438      */
439     public void putGeneralString(String s) throws IOException {
<span class="line-modified">440         writeString(s, DerValue.tag_GeneralString, &quot;ASCII&quot;);</span>
441     }
442 
443     /**
444      * Private helper routine for writing DER encoded string values.
445      * @param s the string to write
446      * @param stringTag one of the DER string tags that indicate which
447      * encoding should be used to write the string out.
448      * @param enc the name of the encoder that should be used corresponding
449      * to the above tag.
450      */
<span class="line-modified">451     private void writeString(String s, byte stringTag, String enc)</span>
452         throws IOException {
453 
<span class="line-modified">454         byte[] data = s.getBytes(enc);</span>
455         write(stringTag);
456         putLength(data.length);
457         write(data);
458     }
459 
460     /**
461      * Marshals a DER UTC time/date value.
462      *
463      * &lt;P&gt;YYMMDDhhmmss{Z|+hhmm|-hhmm} ... emits only using Zulu time
464      * and with seconds (even if seconds=0) as per RFC 5280.
465      */
466     public void putUTCTime(Date d) throws IOException {
467         putTime(d, DerValue.tag_UtcTime);
468     }
469 
470     /**
471      * Marshals a DER Generalized Time/date value.
472      *
473      * &lt;P&gt;YYYYMMDDhhmmss{Z|+hhmm|-hhmm} ... emits only using Zulu time
474      * and with seconds (even if seconds=0) as per RFC 5280.
</pre>
<hr />
<pre>
485      * @param tag the tag for UTC Time or Generalized Time
486      */
487     private void putTime(Date d, byte tag) throws IOException {
488 
489         /*
490          * Format the date.
491          */
492 
493         TimeZone tz = TimeZone.getTimeZone(&quot;GMT&quot;);
494         String pattern = null;
495 
496         if (tag == DerValue.tag_UtcTime) {
497             pattern = &quot;yyMMddHHmmss&#39;Z&#39;&quot;;
498         } else {
499             tag = DerValue.tag_GeneralizedTime;
500             pattern = &quot;yyyyMMddHHmmss&#39;Z&#39;&quot;;
501         }
502 
503         SimpleDateFormat sdf = new SimpleDateFormat(pattern, Locale.US);
504         sdf.setTimeZone(tz);
<span class="line-modified">505         byte[] time = (sdf.format(d)).getBytes(&quot;ISO-8859-1&quot;);</span>
506 
507         /*
508          * Write the formatted date.
509          */
510 
511         write(tag);
512         putLength(time.length);
513         write(time);
514     }
515 
516     /**
517      * Put the encoding of the length in the stream.
518      *
519      * @param len the length of the attribute.
520      * @exception IOException on writing errors.
521      */
522     public void putLength(int len) throws IOException {
523         if (len &lt; 128) {
524             write((byte)len);
525 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1996, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.util;
 27 
 28 import java.io.ByteArrayOutputStream;
 29 import java.io.OutputStream;
 30 import java.io.IOException;
<span class="line-added"> 31 import java.math.BigInteger;</span>
<span class="line-added"> 32 import java.nio.charset.Charset;</span>
 33 import java.text.SimpleDateFormat;
 34 import java.util.Date;
 35 import java.util.TimeZone;
 36 import java.util.Comparator;
 37 import java.util.Arrays;

 38 import java.util.Locale;
 39 
<span class="line-added"> 40 import static java.nio.charset.StandardCharsets.*;</span>
 41 
 42 /**
 43  * Output stream marshaling DER-encoded data.  This is eventually provided
 44  * in the form of a byte array; there is no advance limit on the size of
 45  * that byte array.
 46  *
 47  * &lt;P&gt;At this time, this class supports only a subset of the types of
 48  * DER data encodings which are defined.  That subset is sufficient for
 49  * generating most X.509 certificates.
 50  *
 51  *
 52  * @author David Brownell
 53  * @author Amit Kapoor
 54  * @author Hemma Prafullchandra
 55  */
 56 public class DerOutputStream
 57 extends ByteArrayOutputStream implements DerEncoder {
 58     /**
 59      * Construct an DER output stream.
 60      *
</pre>
<hr />
<pre>
383 
384         // order the element encodings
385         byte[][] bufs = new byte[streams.length][];
386         for (int i = 0; i &lt; streams.length; i++) {
387             bufs[i] = streams[i].toByteArray();
388         }
389         Arrays.&lt;byte[]&gt;sort(bufs, order);
390 
391         DerOutputStream bytes = new DerOutputStream();
392         for (int i = 0; i &lt; streams.length; i++) {
393             bytes.write(bufs[i]);
394         }
395         write(tag, bytes);
396 
397     }
398 
399     /**
400      * Marshals a string as a DER encoded UTF8String.
401      */
402     public void putUTF8String(String s) throws IOException {
<span class="line-modified">403         writeString(s, DerValue.tag_UTF8String, UTF_8);</span>
404     }
405 
406     /**
407      * Marshals a string as a DER encoded PrintableString.
408      */
409     public void putPrintableString(String s) throws IOException {
<span class="line-modified">410         writeString(s, DerValue.tag_PrintableString, US_ASCII);</span>
411     }
412 
413     /**
414      * Marshals a string as a DER encoded T61String.
415      */
416     public void putT61String(String s) throws IOException {
417         /*
418          * Works for characters that are defined in both ASCII and
419          * T61.
420          */
<span class="line-modified">421         writeString(s, DerValue.tag_T61String, ISO_8859_1);</span>
422     }
423 
424     /**
425      * Marshals a string as a DER encoded IA5String.
426      */
427     public void putIA5String(String s) throws IOException {
<span class="line-modified">428         writeString(s, DerValue.tag_IA5String, US_ASCII);</span>
429     }
430 
431     /**
432      * Marshals a string as a DER encoded BMPString.
433      */
434     public void putBMPString(String s) throws IOException {
<span class="line-modified">435         writeString(s, DerValue.tag_BMPString, UTF_16BE);</span>
436     }
437 
438     /**
439      * Marshals a string as a DER encoded GeneralString.
440      */
441     public void putGeneralString(String s) throws IOException {
<span class="line-modified">442         writeString(s, DerValue.tag_GeneralString, US_ASCII);</span>
443     }
444 
445     /**
446      * Private helper routine for writing DER encoded string values.
447      * @param s the string to write
448      * @param stringTag one of the DER string tags that indicate which
449      * encoding should be used to write the string out.
450      * @param enc the name of the encoder that should be used corresponding
451      * to the above tag.
452      */
<span class="line-modified">453     private void writeString(String s, byte stringTag, Charset charset)</span>
454         throws IOException {
455 
<span class="line-modified">456         byte[] data = s.getBytes(charset);</span>
457         write(stringTag);
458         putLength(data.length);
459         write(data);
460     }
461 
462     /**
463      * Marshals a DER UTC time/date value.
464      *
465      * &lt;P&gt;YYMMDDhhmmss{Z|+hhmm|-hhmm} ... emits only using Zulu time
466      * and with seconds (even if seconds=0) as per RFC 5280.
467      */
468     public void putUTCTime(Date d) throws IOException {
469         putTime(d, DerValue.tag_UtcTime);
470     }
471 
472     /**
473      * Marshals a DER Generalized Time/date value.
474      *
475      * &lt;P&gt;YYYYMMDDhhmmss{Z|+hhmm|-hhmm} ... emits only using Zulu time
476      * and with seconds (even if seconds=0) as per RFC 5280.
</pre>
<hr />
<pre>
487      * @param tag the tag for UTC Time or Generalized Time
488      */
489     private void putTime(Date d, byte tag) throws IOException {
490 
491         /*
492          * Format the date.
493          */
494 
495         TimeZone tz = TimeZone.getTimeZone(&quot;GMT&quot;);
496         String pattern = null;
497 
498         if (tag == DerValue.tag_UtcTime) {
499             pattern = &quot;yyMMddHHmmss&#39;Z&#39;&quot;;
500         } else {
501             tag = DerValue.tag_GeneralizedTime;
502             pattern = &quot;yyyyMMddHHmmss&#39;Z&#39;&quot;;
503         }
504 
505         SimpleDateFormat sdf = new SimpleDateFormat(pattern, Locale.US);
506         sdf.setTimeZone(tz);
<span class="line-modified">507         byte[] time = (sdf.format(d)).getBytes(ISO_8859_1);</span>
508 
509         /*
510          * Write the formatted date.
511          */
512 
513         write(tag);
514         putLength(time.length);
515         write(time);
516     }
517 
518     /**
519      * Put the encoding of the length in the stream.
520      *
521      * @param len the length of the attribute.
522      * @exception IOException on writing errors.
523      */
524     public void putLength(int len) throws IOException {
525         if (len &lt; 128) {
526             write((byte)len);
527 
</pre>
</td>
</tr>
</table>
<center><a href="DerInputStream.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="DerValue.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>