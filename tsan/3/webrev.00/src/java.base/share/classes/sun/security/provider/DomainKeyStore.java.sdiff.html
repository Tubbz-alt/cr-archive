<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/provider/DomainKeyStore.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="DSAPublicKeyImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="JavaKeyStore.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/provider/DomainKeyStore.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.provider;
 27 
 28 import java.io.*;
 29 import java.net.*;
 30 import java.security.*;
 31 import java.security.cert.Certificate;
 32 import java.security.cert.CertificateFactory;
 33 import java.security.cert.CertificateException;
 34 import java.util.*;
 35 


 36 import sun.security.pkcs.EncryptedPrivateKeyInfo;
 37 import sun.security.util.PolicyUtil;
 38 
 39 /**
 40  * This class provides the domain keystore type identified as &quot;DKS&quot;.
 41  * DKS presents a collection of separate keystores as a single logical keystore.
 42  * The collection of keystores is specified in a domain configuration file which
 43  * is passed to DKS in a {@link DomainLoadStoreParameter}.
 44  * &lt;p&gt;
 45  * The following properties are supported:
 46  * &lt;dl&gt;
 47  * &lt;dt&gt; {@code keystoreType=&quot;&lt;type&gt;&quot;} &lt;/dt&gt;
 48  *     &lt;dd&gt; The keystore type. &lt;/dd&gt;
 49  * &lt;dt&gt; {@code keystoreURI=&quot;&lt;url&gt;&quot;} &lt;/dt&gt;
 50  *     &lt;dd&gt; The keystore location. &lt;/dd&gt;
 51  * &lt;dt&gt; {@code keystoreProviderName=&quot;&lt;name&gt;&quot;} &lt;/dt&gt;
 52  *     &lt;dd&gt; The name of the keystore&#39;s JCE provider. &lt;/dd&gt;
 53  * &lt;dt&gt; {@code keystorePasswordEnv=&quot;&lt;environment-variable&gt;&quot;} &lt;/dt&gt;
 54  *     &lt;dd&gt; The environment variable that stores a keystore password.
 55  * &lt;dt&gt; {@code entryNameSeparator=&quot;&lt;separator&gt;&quot;} &lt;/dt&gt;
</pre>
<hr />
<pre>
751                 &quot;This keystore must be loaded using a &quot; +
752                 &quot;DomainLoadStoreParameter&quot;);
753         }
754     }
755 
756     /*
757      * Parse a keystore domain configuration file and associated collection
758      * of keystore passwords to create a collection of KeyStore.Builder.
759      */
760     private List&lt;KeyStoreBuilderComponents&gt; getBuilders(URI configuration,
761         Map&lt;String, KeyStore.ProtectionParameter&gt; passwords)
762             throws IOException {
763 
764         PolicyParser parser = new PolicyParser(true); // expand properties
765         Collection&lt;PolicyParser.DomainEntry&gt; domains = null;
766         List&lt;KeyStoreBuilderComponents&gt; builders = new ArrayList&lt;&gt;();
767         String uriDomain = configuration.getFragment();
768 
769         try (InputStreamReader configurationReader =
770             new InputStreamReader(
<span class="line-modified">771                 PolicyUtil.getInputStream(configuration.toURL()), &quot;UTF-8&quot;)) {</span>
772             parser.read(configurationReader);
773             domains = parser.getDomainEntries();
774 
775         } catch (MalformedURLException mue) {
776             throw new IOException(mue);
777 
778         } catch (PolicyParser.ParsingException pe) {
779             throw new IOException(pe);
780         }
781 
782         for (PolicyParser.DomainEntry domain : domains) {
783             Map&lt;String, String&gt; domainProperties = domain.getProperties();
784 
785             if (uriDomain != null &amp;&amp;
786                 (!uriDomain.equalsIgnoreCase(domain.getName()))) {
787                 continue; // skip this domain
788             }
789 
790             if (domainProperties.containsKey(ENTRY_NAME_SEPARATOR)) {
791                 this.entryNameSeparator =
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.provider;
 27 
 28 import java.io.*;
 29 import java.net.*;
 30 import java.security.*;
 31 import java.security.cert.Certificate;
 32 import java.security.cert.CertificateFactory;
 33 import java.security.cert.CertificateException;
 34 import java.util.*;
 35 
<span class="line-added"> 36 import static java.nio.charset.StandardCharsets.UTF_8;</span>
<span class="line-added"> 37 </span>
 38 import sun.security.pkcs.EncryptedPrivateKeyInfo;
 39 import sun.security.util.PolicyUtil;
 40 
 41 /**
 42  * This class provides the domain keystore type identified as &quot;DKS&quot;.
 43  * DKS presents a collection of separate keystores as a single logical keystore.
 44  * The collection of keystores is specified in a domain configuration file which
 45  * is passed to DKS in a {@link DomainLoadStoreParameter}.
 46  * &lt;p&gt;
 47  * The following properties are supported:
 48  * &lt;dl&gt;
 49  * &lt;dt&gt; {@code keystoreType=&quot;&lt;type&gt;&quot;} &lt;/dt&gt;
 50  *     &lt;dd&gt; The keystore type. &lt;/dd&gt;
 51  * &lt;dt&gt; {@code keystoreURI=&quot;&lt;url&gt;&quot;} &lt;/dt&gt;
 52  *     &lt;dd&gt; The keystore location. &lt;/dd&gt;
 53  * &lt;dt&gt; {@code keystoreProviderName=&quot;&lt;name&gt;&quot;} &lt;/dt&gt;
 54  *     &lt;dd&gt; The name of the keystore&#39;s JCE provider. &lt;/dd&gt;
 55  * &lt;dt&gt; {@code keystorePasswordEnv=&quot;&lt;environment-variable&gt;&quot;} &lt;/dt&gt;
 56  *     &lt;dd&gt; The environment variable that stores a keystore password.
 57  * &lt;dt&gt; {@code entryNameSeparator=&quot;&lt;separator&gt;&quot;} &lt;/dt&gt;
</pre>
<hr />
<pre>
753                 &quot;This keystore must be loaded using a &quot; +
754                 &quot;DomainLoadStoreParameter&quot;);
755         }
756     }
757 
758     /*
759      * Parse a keystore domain configuration file and associated collection
760      * of keystore passwords to create a collection of KeyStore.Builder.
761      */
762     private List&lt;KeyStoreBuilderComponents&gt; getBuilders(URI configuration,
763         Map&lt;String, KeyStore.ProtectionParameter&gt; passwords)
764             throws IOException {
765 
766         PolicyParser parser = new PolicyParser(true); // expand properties
767         Collection&lt;PolicyParser.DomainEntry&gt; domains = null;
768         List&lt;KeyStoreBuilderComponents&gt; builders = new ArrayList&lt;&gt;();
769         String uriDomain = configuration.getFragment();
770 
771         try (InputStreamReader configurationReader =
772             new InputStreamReader(
<span class="line-modified">773                 PolicyUtil.getInputStream(configuration.toURL()), UTF_8)) {</span>
774             parser.read(configurationReader);
775             domains = parser.getDomainEntries();
776 
777         } catch (MalformedURLException mue) {
778             throw new IOException(mue);
779 
780         } catch (PolicyParser.ParsingException pe) {
781             throw new IOException(pe);
782         }
783 
784         for (PolicyParser.DomainEntry domain : domains) {
785             Map&lt;String, String&gt; domainProperties = domain.getProperties();
786 
787             if (uriDomain != null &amp;&amp;
788                 (!uriDomain.equalsIgnoreCase(domain.getName()))) {
789                 continue; // skip this domain
790             }
791 
792             if (domainProperties.containsKey(ENTRY_NAME_SEPARATOR)) {
793                 this.entryNameSeparator =
</pre>
</td>
</tr>
</table>
<center><a href="DSAPublicKeyImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="JavaKeyStore.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>