<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/java.base/share/classes/sun/nio/cs/StandardCharsets.java.template</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.
  3  *
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * This code is free software; you can redistribute it and/or modify it
  7  * under the terms of the GNU General Public License version 2 only, as
  8  * published by the Free Software Foundation.  Oracle designates this
  9  * particular file as subject to the &quot;Classpath&quot; exception as provided
 10  * by Oracle in the LICENSE file that accompanied this code.
 11  *
 12  * This code is distributed in the hope that it will be useful, but WITHOUT
 13  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 14  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 15  * version 2 for more details (a copy is included in the LICENSE file that
 16  * accompanied this code).
 17  *
 18  * You should have received a copy of the GNU General Public License version
 19  * 2 along with this work; if not, write to the Free Software Foundation,
 20  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 21  *
 22  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 23  * or visit www.oracle.com if you need additional information or have any
 24  * questions.
 25  *
 26  */
 27 
 28 // -- This file was mechanically generated: Do not edit! -- //
 29 
 30 package sun.nio.cs;
 31 
 32 import java.nio.charset.Charset;
 33 import java.nio.charset.spi.CharsetProvider;
 34 import java.util.Iterator;
 35 import java.util.Map;
 36 import java.util.Set;
 37 import jdk.internal.vm.annotation.Stable;
 38 
 39 public class StandardCharsets extends CharsetProvider {
 40 
 41     _INCLUDE_ALIASES_TABLES_
 42     _INCLUDE_ALIASES_MAP_
 43     _INCLUDE_CLASSES_MAP_
 44     _INCLUDE_CACHE_MAP_
 45 
 46     // Maps canonical names to class names
 47     private @Stable Map&lt;String,String&gt; classMap;
 48 
 49     // Maps alias names to canonical names
 50     private @Stable Map&lt;String,String&gt; aliasMap;
 51 
 52     // Maps canonical names to cached instances
 53     private @Stable Map&lt;String,Charset&gt; cache;
 54 
 55     private static final String packagePrefix = &quot;sun.nio.cs.&quot;;
 56 
 57     public StandardCharsets() {
 58     }
 59 
 60     private String canonicalize(String csn) {
 61         String acn = aliasMap().get(csn);
 62         return (acn != null) ? acn : csn;
 63     }
 64 
 65     private Map&lt;String,String&gt; aliasMap() {
 66         Map&lt;String,String&gt; map = aliasMap;
 67         if (map == null) {
 68             aliasMap = map = new Aliases();
 69         }
 70         return map;
 71     }
 72 
 73     private Map&lt;String,String&gt; classMap() {
 74         Map&lt;String,String&gt; map = classMap;
 75         if (map == null) {
 76             classMap = map = new Classes();
 77         }
 78         return map;
 79     }
 80 
 81     private Map&lt;String,Charset&gt; cache() {
 82         Map&lt;String,Charset&gt; map = cache;
 83         if (map == null) {
 84             map = new Cache();
 85             map.put(&quot;utf-8&quot;, UTF_8.INSTANCE);
 86             map.put(&quot;iso-8859-1&quot;, ISO_8859_1.INSTANCE);
 87             map.put(&quot;us-ascii&quot;, US_ASCII.INSTANCE);
 88             map.put(&quot;utf-16&quot;, java.nio.charset.StandardCharsets.UTF_16);
 89             map.put(&quot;utf-16be&quot;, java.nio.charset.StandardCharsets.UTF_16BE);
 90             map.put(&quot;utf-16le&quot;, java.nio.charset.StandardCharsets.UTF_16LE);
 91             cache = map;
 92         }
 93         return map;
 94     }
 95 
 96     // Private ASCII-only version, optimized for interpretation during startup
 97     //
 98     private static String toLower(String s) {
 99         int n = s.length();
100         boolean allLower = true;
101         for (int i = 0; i &lt; n; i++) {
102             int c = s.charAt(i);
103             if (((c - &#39;A&#39;) | (&#39;Z&#39; - c)) &gt;= 0) {
104                 allLower = false;
105                 break;
106             }
107         }
108         if (allLower)
109             return s;
110         StringBuilder sb = new StringBuilder(n);
111         for (int i = 0; i &lt; n; i++) {
112             int c = s.charAt(i);
113             if (((c - &#39;A&#39;) | (&#39;Z&#39; - c)) &gt;= 0)
114                 sb.append((char)(c + 0x20));
115             else
116                 sb.append((char)c);
117         }
118         return sb.toString();
119     }
120 
121     private Charset lookup(String charsetName) {
122         // By checking these built-ins we can avoid initializing Aliases,
123         // Classes and Cache eagerly during bootstrap.
124         //
125         // Initialization of java.nio.charset.StandardCharsets should be
126         // avoided here to minimize time spent in System.initPhase1, as it
127         // may delay initialization of performance critical VM subsystems.
128         String csn;
129         if (charsetName.equals(&quot;UTF-8&quot;)) {
130             return UTF_8.INSTANCE;
131         } else if (charsetName.equals(&quot;US-ASCII&quot;)) {
132             return US_ASCII.INSTANCE;
133         } else if (charsetName.equals(&quot;ISO-8859-1&quot;)) {
134             return ISO_8859_1.INSTANCE;
135         } else {
136             csn = canonicalize(toLower(charsetName));
137         }
138 
139         // Check cache first
140         Charset cs = cache().get(csn);
141         if (cs != null)
142             return cs;
143 
144         // Do we even support this charset?
145         String cln = classMap().get(csn);
146         if (cln == null)
147             return null;
148 
149         // Instantiate the charset and cache it
150         try {
151             @SuppressWarnings(&quot;deprecation&quot;)
152             Object o = Class.forName(packagePrefix + cln,
153                                      true,
154                                      this.getClass().getClassLoader()).newInstance();
155             return cache(csn, (Charset)o);
156         } catch (ClassNotFoundException |
157                  IllegalAccessException |
158                  InstantiationException x) {
159             return null;
160         }
161     }
162 
163     private Charset cache(String csn, Charset cs) {
164         cache().put(csn, cs);
165         return cs;
166     }
167 
168     public final Charset charsetForName(String charsetName) {
169         synchronized (this) {
170             return lookup(charsetName);
171         }
172     }
173 
174     public final Iterator&lt;Charset&gt; charsets() {
175         Set&lt;String&gt; charsetNames;
176         synchronized (this) {
177             // Ensure initialized in synchronized block
178             charsetNames = classMap().keySet();
179             aliasMap();
180             cache();
181         }
182         return new Iterator&lt;Charset&gt;() {
183 
184                 Iterator&lt;String&gt; i = charsetNames.iterator();
185 
186                 public boolean hasNext() {
187                     return i.hasNext();
188                 }
189 
190                 public Charset next() {
191                     String csn = i.next();
192                     return lookup(csn);
193                 }
194 
195                 public void remove() {
196                     throw new UnsupportedOperationException();
197                 }
198 
199             };
200     }
201 }
    </pre>
  </body>
</html>