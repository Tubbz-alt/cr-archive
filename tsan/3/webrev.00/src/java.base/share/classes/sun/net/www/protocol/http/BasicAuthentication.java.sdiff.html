<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/net/www/protocol/http/BasicAuthentication.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AuthenticationInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DigestAuthentication.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/net/www/protocol/http/BasicAuthentication.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.net.www.protocol.http;
 27 
 28 import java.net.URL;
 29 import java.net.URI;
 30 import java.net.URISyntaxException;
 31 import java.net.PasswordAuthentication;



 32 import java.io.IOException;
 33 import java.io.OutputStream;

 34 import java.util.Base64;
 35 import java.util.Objects;
 36 import sun.net.www.HeaderParser;


 37 
 38 /**
 39  * BasicAuthentication: Encapsulate an http server authentication using
 40  * the &quot;basic&quot; scheme.
 41  *
 42  * @author Bill Foote
 43  */
 44 
 45 
 46 class BasicAuthentication extends AuthenticationInfo {
 47 

 48     private static final long serialVersionUID = 100L;
 49 
 50     /** The authentication string for this host, port, and realm.  This is
 51         a simple BASE64 encoding of &quot;login:password&quot;.    */
<span class="line-modified"> 52     String auth;</span>
 53 
 54     /**
 55      * Create a BasicAuthentication
 56      */
 57     public BasicAuthentication(boolean isProxy, String host, int port,
 58                                String realm, PasswordAuthentication pw,
<span class="line-modified"> 59                                String authenticatorKey) {</span>
 60         super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
 61               AuthScheme.BASIC, host, port, realm,
 62               Objects.requireNonNull(authenticatorKey));
<span class="line-modified"> 63         String plain = pw.getUserName() + &quot;:&quot;;</span>
<span class="line-removed"> 64         byte[] nameBytes = null;</span>
<span class="line-removed"> 65         try {</span>
<span class="line-removed"> 66             nameBytes = plain.getBytes(&quot;ISO-8859-1&quot;);</span>
<span class="line-removed"> 67         } catch (java.io.UnsupportedEncodingException uee) {</span>
<span class="line-removed"> 68             assert false;</span>
<span class="line-removed"> 69         }</span>
<span class="line-removed"> 70 </span>
<span class="line-removed"> 71         // get password bytes</span>
<span class="line-removed"> 72         char[] passwd = pw.getPassword();</span>
<span class="line-removed"> 73         byte[] passwdBytes = new byte[passwd.length];</span>
<span class="line-removed"> 74         for (int i=0; i&lt;passwd.length; i++)</span>
<span class="line-removed"> 75             passwdBytes[i] = (byte)passwd[i];</span>
<span class="line-removed"> 76 </span>
<span class="line-removed"> 77         // concatenate user name and password bytes and encode them</span>
<span class="line-removed"> 78         byte[] concat = new byte[nameBytes.length + passwdBytes.length];</span>
<span class="line-removed"> 79         System.arraycopy(nameBytes, 0, concat, 0, nameBytes.length);</span>
<span class="line-removed"> 80         System.arraycopy(passwdBytes, 0, concat, nameBytes.length,</span>
<span class="line-removed"> 81                          passwdBytes.length);</span>
<span class="line-removed"> 82         this.auth = &quot;Basic &quot; + Base64.getEncoder().encodeToString(concat);</span>
 83         this.pw = pw;
 84     }
 85 
 86     /**
 87      * Create a BasicAuthentication
 88      */
 89     public BasicAuthentication(boolean isProxy, String host, int port,
 90                                String realm, String auth,
 91                                String authenticatorKey) {
 92         super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
 93               AuthScheme.BASIC, host, port, realm,
 94               Objects.requireNonNull(authenticatorKey));
 95         this.auth = &quot;Basic &quot; + auth;
 96     }
 97 
 98     /**
 99      * Create a BasicAuthentication
100      */
101     public BasicAuthentication(boolean isProxy, URL url, String realm,
<span class="line-modified">102                                PasswordAuthentication pw,</span>
103                                String authenticatorKey) {
104         super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
105               AuthScheme.BASIC, url, realm,
106               Objects.requireNonNull(authenticatorKey));
<span class="line-modified">107         String plain = pw.getUserName() + &quot;:&quot;;</span>
<span class="line-removed">108         byte[] nameBytes = null;</span>
<span class="line-removed">109         try {</span>
<span class="line-removed">110             nameBytes = plain.getBytes(&quot;ISO-8859-1&quot;);</span>
<span class="line-removed">111         } catch (java.io.UnsupportedEncodingException uee) {</span>
<span class="line-removed">112             assert false;</span>
<span class="line-removed">113         }</span>
<span class="line-removed">114 </span>
<span class="line-removed">115         // get password bytes</span>
<span class="line-removed">116         char[] passwd = pw.getPassword();</span>
<span class="line-removed">117         byte[] passwdBytes = new byte[passwd.length];</span>
<span class="line-removed">118         for (int i=0; i&lt;passwd.length; i++)</span>
<span class="line-removed">119             passwdBytes[i] = (byte)passwd[i];</span>
<span class="line-removed">120 </span>
<span class="line-removed">121         // concatenate user name and password bytes and encode them</span>
<span class="line-removed">122         byte[] concat = new byte[nameBytes.length + passwdBytes.length];</span>
<span class="line-removed">123         System.arraycopy(nameBytes, 0, concat, 0, nameBytes.length);</span>
<span class="line-removed">124         System.arraycopy(passwdBytes, 0, concat, nameBytes.length,</span>
<span class="line-removed">125                          passwdBytes.length);</span>
<span class="line-removed">126         this.auth = &quot;Basic &quot; + Base64.getEncoder().encodeToString(concat);</span>
127         this.pw = pw;
128     }
129 
















130     /**
131      * Create a BasicAuthentication
132      */
133     public BasicAuthentication(boolean isProxy, URL url, String realm,
134                                String auth, String authenticatorKey) {
135         super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
136               AuthScheme.BASIC, url, realm,
137               Objects.requireNonNull(authenticatorKey));
138         this.auth = &quot;Basic &quot; + auth;
139     }
140 
141     /**
142      * @return true if this authentication supports preemptive authorization
143      */
144     @Override
145     public boolean supportsPreemptiveAuthorization() {
146         return true;
147     }
148 
149     /**
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.net.www.protocol.http;
 27 
 28 import java.net.URL;
 29 import java.net.URI;
 30 import java.net.URISyntaxException;
 31 import java.net.PasswordAuthentication;
<span class="line-added"> 32 import java.nio.ByteBuffer;</span>
<span class="line-added"> 33 import java.nio.CharBuffer;</span>
<span class="line-added"> 34 import java.nio.charset.Charset;</span>
 35 import java.io.IOException;
 36 import java.io.OutputStream;
<span class="line-added"> 37 import java.util.Arrays;</span>
 38 import java.util.Base64;
 39 import java.util.Objects;
 40 import sun.net.www.HeaderParser;
<span class="line-added"> 41 import sun.nio.cs.ISO_8859_1;</span>
<span class="line-added"> 42 import sun.nio.cs.UTF_8;</span>
 43 
 44 /**
 45  * BasicAuthentication: Encapsulate an http server authentication using
 46  * the &quot;basic&quot; scheme.
 47  *
 48  * @author Bill Foote
 49  */
 50 
 51 
 52 class BasicAuthentication extends AuthenticationInfo {
 53 
<span class="line-added"> 54     @java.io.Serial</span>
 55     private static final long serialVersionUID = 100L;
 56 
 57     /** The authentication string for this host, port, and realm.  This is
 58         a simple BASE64 encoding of &quot;login:password&quot;.    */
<span class="line-modified"> 59     final String auth;</span>
 60 
 61     /**
 62      * Create a BasicAuthentication
 63      */
 64     public BasicAuthentication(boolean isProxy, String host, int port,
 65                                String realm, PasswordAuthentication pw,
<span class="line-modified"> 66                                boolean isUTF8, String authenticatorKey) {</span>
 67         super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
 68               AuthScheme.BASIC, host, port, realm,
 69               Objects.requireNonNull(authenticatorKey));
<span class="line-modified"> 70         this.auth = authValueFrom(pw, isUTF8);</span>



















 71         this.pw = pw;
 72     }
 73 
 74     /**
 75      * Create a BasicAuthentication
 76      */
 77     public BasicAuthentication(boolean isProxy, String host, int port,
 78                                String realm, String auth,
 79                                String authenticatorKey) {
 80         super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
 81               AuthScheme.BASIC, host, port, realm,
 82               Objects.requireNonNull(authenticatorKey));
 83         this.auth = &quot;Basic &quot; + auth;
 84     }
 85 
 86     /**
 87      * Create a BasicAuthentication
 88      */
 89     public BasicAuthentication(boolean isProxy, URL url, String realm,
<span class="line-modified"> 90                                PasswordAuthentication pw, boolean isUTF8,</span>
 91                                String authenticatorKey) {
 92         super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
 93               AuthScheme.BASIC, url, realm,
 94               Objects.requireNonNull(authenticatorKey));
<span class="line-modified"> 95         this.auth = authValueFrom(pw, isUTF8);</span>



















 96         this.pw = pw;
 97     }
 98 
<span class="line-added"> 99     private static String authValueFrom(PasswordAuthentication pw, boolean isUTF8) {</span>
<span class="line-added">100         String plain = pw.getUserName() + &quot;:&quot;;</span>
<span class="line-added">101         char[] password = pw.getPassword();</span>
<span class="line-added">102         CharBuffer cbuf = CharBuffer.allocate(plain.length() + password.length);</span>
<span class="line-added">103         cbuf.put(plain).put(password).flip();</span>
<span class="line-added">104         Charset charset = isUTF8 ? UTF_8.INSTANCE : ISO_8859_1.INSTANCE;</span>
<span class="line-added">105         ByteBuffer buf = charset.encode(cbuf);</span>
<span class="line-added">106         ByteBuffer enc = Base64.getEncoder().encode(buf);</span>
<span class="line-added">107         String ret = &quot;Basic &quot; + new String(enc.array(), enc.position(), enc.remaining(),</span>
<span class="line-added">108                 ISO_8859_1.INSTANCE);</span>
<span class="line-added">109         Arrays.fill(buf.array(), (byte) 0);</span>
<span class="line-added">110         Arrays.fill(enc.array(), (byte) 0);</span>
<span class="line-added">111         Arrays.fill(cbuf.array(), (char) 0);</span>
<span class="line-added">112         return ret;</span>
<span class="line-added">113     }</span>
<span class="line-added">114 </span>
115     /**
116      * Create a BasicAuthentication
117      */
118     public BasicAuthentication(boolean isProxy, URL url, String realm,
119                                String auth, String authenticatorKey) {
120         super(isProxy ? PROXY_AUTHENTICATION : SERVER_AUTHENTICATION,
121               AuthScheme.BASIC, url, realm,
122               Objects.requireNonNull(authenticatorKey));
123         this.auth = &quot;Basic &quot; + auth;
124     }
125 
126     /**
127      * @return true if this authentication supports preemptive authorization
128      */
129     @Override
130     public boolean supportsPreemptiveAuthorization() {
131         return true;
132     }
133 
134     /**
</pre>
</td>
</tr>
</table>
<center><a href="AuthenticationInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DigestAuthentication.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>