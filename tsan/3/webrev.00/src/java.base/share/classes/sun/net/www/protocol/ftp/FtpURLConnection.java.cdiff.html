<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/sun/net/www/protocol/ftp/FtpURLConnection.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../http/KeepAliveCache.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Handler.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/net/www/protocol/ftp/FtpURLConnection.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1994, 2016, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1994, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 34,22 ***</span>
<span class="line-new-header">--- 34,25 ---</span>
  import java.io.OutputStream;
  import java.io.BufferedInputStream;
  import java.io.FilterInputStream;
  import java.io.FilterOutputStream;
  import java.io.FileNotFoundException;
<span class="line-added">+ import java.net.MalformedURLException;</span>
  import java.net.URL;
  import java.net.SocketPermission;
  import java.net.UnknownHostException;
  import java.net.InetSocketAddress;
  import java.net.URI;
  import java.net.Proxy;
  import java.net.ProxySelector;
<span class="line-added">+ import java.util.List;</span>
  import java.util.StringTokenizer;
  import java.util.Iterator;
  import java.security.Permission;
  import java.util.Properties;
  import sun.net.NetworkClient;
<span class="line-added">+ import sun.net.util.IPAddressUtil;</span>
  import sun.net.www.MessageHeader;
  import sun.net.www.MeteredStream;
  import sun.net.www.URLConnection;
  import sun.net.www.protocol.http.HttpURLConnection;
  import sun.net.ftp.FtpClient;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 155,10 ***</span>
<span class="line-new-header">--- 158,25 ---</span>
                  ftp.close();
              }
          }
      }
  
<span class="line-added">+     static URL checkURL(URL u) throws IllegalArgumentException {</span>
<span class="line-added">+         if (u != null) {</span>
<span class="line-added">+             if (u.toExternalForm().indexOf(&#39;\n&#39;) &gt; -1) {</span>
<span class="line-added">+                 Exception mfue = new MalformedURLException(&quot;Illegal character in URL&quot;);</span>
<span class="line-added">+                 throw new IllegalArgumentException(mfue.getMessage(), mfue);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+         String s = IPAddressUtil.checkAuthority(u);</span>
<span class="line-added">+         if (s != null) {</span>
<span class="line-added">+             Exception mfue = new MalformedURLException(s);</span>
<span class="line-added">+             throw new IllegalArgumentException(mfue.getMessage(), mfue);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         return u;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      /**
       * Creates an FtpURLConnection from a URL.
       *
       * @param   url     The {@code URL} to retrieve or store.
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 168,11 ***</span>
  
      /**
       * Same as FtpURLconnection(URL) with a per connection proxy specified
       */
      FtpURLConnection(URL url, Proxy p) {
<span class="line-modified">!         super(url);</span>
          instProxy = p;
          host = url.getHost();
          port = url.getPort();
          String userInfo = url.getUserInfo();
  
<span class="line-new-header">--- 186,11 ---</span>
  
      /**
       * Same as FtpURLconnection(URL) with a per connection proxy specified
       */
      FtpURLConnection(URL url, Proxy p) {
<span class="line-modified">!         super(checkURL(url));</span>
          instProxy = p;
          host = url.getHost();
          port = url.getPort();
          String userInfo = url.getUserInfo();
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 223,11 ***</span>
                              return ProxySelector.getDefault();
                          }
                      });
              if (sel != null) {
                  URI uri = sun.net.www.ParseUtil.toURI(url);
<span class="line-modified">!                 Iterator&lt;Proxy&gt; it = sel.select(uri).iterator();</span>
                  while (it.hasNext()) {
                      p = it.next();
                      if (p == null || p == Proxy.NO_PROXY ||
                          p.type() == Proxy.Type.SOCKS) {
                          break;
<span class="line-new-header">--- 241,17 ---</span>
                              return ProxySelector.getDefault();
                          }
                      });
              if (sel != null) {
                  URI uri = sun.net.www.ParseUtil.toURI(url);
<span class="line-modified">!                 final List&lt;Proxy&gt; proxies;</span>
<span class="line-added">+                 try {</span>
<span class="line-added">+                     proxies = sel.select(uri);</span>
<span class="line-added">+                 } catch (IllegalArgumentException iae) {</span>
<span class="line-added">+                     throw new IOException(&quot;Failed to select a proxy&quot;, iae);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 final Iterator&lt;Proxy&gt; it = proxies.iterator();</span>
                  while (it.hasNext()) {
                      p = it.next();
                      if (p == null || p == Proxy.NO_PROXY ||
                          p.type() == Proxy.Type.SOCKS) {
                          break;
</pre>
<center><a href="../../http/KeepAliveCache.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="Handler.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>