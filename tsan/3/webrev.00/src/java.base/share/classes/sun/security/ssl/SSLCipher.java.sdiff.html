<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/sun/security/ssl/SSLCipher.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="PreSharedKeyExtension.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SSLConfiguration.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/sun/security/ssl/SSLCipher.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package sun.security.ssl;
  27 
  28 import java.nio.ByteBuffer;
  29 import java.security.AccessController;
  30 import java.security.GeneralSecurityException;
  31 import java.security.InvalidAlgorithmParameterException;
  32 import java.security.InvalidKeyException;
  33 import java.security.Key;

  34 import java.security.PrivilegedAction;
  35 import java.security.SecureRandom;
  36 import java.security.Security;
  37 import java.security.spec.AlgorithmParameterSpec;
  38 import java.util.AbstractMap.SimpleImmutableEntry;
  39 import java.util.Arrays;
  40 import java.util.HashMap;
  41 import java.util.Map;
  42 import javax.crypto.BadPaddingException;
  43 import javax.crypto.Cipher;
  44 import javax.crypto.IllegalBlockSizeException;

  45 import javax.crypto.SecretKey;
  46 import javax.crypto.ShortBufferException;
  47 import javax.crypto.spec.GCMParameterSpec;
  48 import javax.crypto.spec.IvParameterSpec;
  49 import sun.security.ssl.Authenticator.MAC;
  50 import static sun.security.ssl.CipherType.*;
  51 import static sun.security.ssl.JsseJce.*;
  52 
  53 enum SSLCipher {
  54     // exportable ciphers
  55     @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
  56     B_NULL(&quot;NULL&quot;, NULL_CIPHER, 0, 0, 0, 0, true, true,
  57         (Map.Entry&lt;ReadCipherGenerator,
  58                 ProtocolVersion[]&gt;[])(new Map.Entry[] {
  59             new SimpleImmutableEntry&lt;ReadCipherGenerator, ProtocolVersion[]&gt;(
  60                 new NullReadCipherGenerator(),
  61                 ProtocolVersion.PROTOCOLS_OF_NONE
  62             ),
  63             new SimpleImmutableEntry&lt;ReadCipherGenerator, ProtocolVersion[]&gt;(
  64                 new NullReadCipherGenerator(),
</pre>
<hr />
<pre>
 474             int fixedIvSize, boolean allowed, boolean exportable,
 475             Map.Entry&lt;ReadCipherGenerator,
 476                     ProtocolVersion[]&gt;[] readCipherGenerators,
 477             Map.Entry&lt;WriteCipherGenerator,
 478                     ProtocolVersion[]&gt;[] writeCipherGenerators) {
 479         this.transformation = transformation;
 480         String[] splits = transformation.split(&quot;/&quot;);
 481         this.algorithm = splits[0];
 482         this.cipherType = cipherType;
 483         this.description = this.algorithm + &quot;/&quot; + (keySize &lt;&lt; 3);
 484         this.keySize = keySize;
 485         this.ivSize = ivSize;
 486         this.fixedIvSize = fixedIvSize;
 487         this.allowed = allowed;
 488 
 489         this.expandedKeySize = expandedKeySize;
 490         this.exportable = exportable;
 491 
 492         // availability of this bulk cipher
 493         //
<span class="line-modified"> 494         // We assume all supported ciphers are always available since they are</span>
<span class="line-modified"> 495         // shipped with the SunJCE  provider.  However, AES/256 is unavailable</span>
<span class="line-modified"> 496         // when the default JCE policy jurisdiction files are installed because</span>
<span class="line-modified"> 497         // of key length restrictions.</span>
<span class="line-removed"> 498         this.isAvailable = allowed &amp;&amp; isUnlimited(keySize, transformation);</span>
 499 
 500         this.readCipherGenerators = readCipherGenerators;
 501         this.writeCipherGenerators = writeCipherGenerators;
 502     }
 503 
















 504     SSLReadCipher createReadCipher(Authenticator authenticator,
 505             ProtocolVersion protocolVersion,
 506             SecretKey key, IvParameterSpec iv,
 507             SecureRandom random) throws GeneralSecurityException {
 508         if (readCipherGenerators.length == 0) {
 509             return null;
 510         }
 511 
 512         ReadCipherGenerator rcg = null;
 513         for (Map.Entry&lt;ReadCipherGenerator,
 514                 ProtocolVersion[]&gt; me : readCipherGenerators) {
 515             for (ProtocolVersion pv : me.getValue()) {
 516                 if (protocolVersion == pv) {
 517                     rcg = me.getKey();
 518                 }
 519             }
 520         }
 521 
 522         if (rcg != null) {
 523             return rcg.createCipher(this, authenticator,
</pre>
</td>
<td>
<hr />
<pre>
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package sun.security.ssl;
  27 
  28 import java.nio.ByteBuffer;
  29 import java.security.AccessController;
  30 import java.security.GeneralSecurityException;
  31 import java.security.InvalidAlgorithmParameterException;
  32 import java.security.InvalidKeyException;
  33 import java.security.Key;
<span class="line-added">  34 import java.security.NoSuchAlgorithmException;</span>
  35 import java.security.PrivilegedAction;
  36 import java.security.SecureRandom;
  37 import java.security.Security;
  38 import java.security.spec.AlgorithmParameterSpec;
  39 import java.util.AbstractMap.SimpleImmutableEntry;
  40 import java.util.Arrays;
  41 import java.util.HashMap;
  42 import java.util.Map;
  43 import javax.crypto.BadPaddingException;
  44 import javax.crypto.Cipher;
  45 import javax.crypto.IllegalBlockSizeException;
<span class="line-added">  46 import javax.crypto.NoSuchPaddingException;</span>
  47 import javax.crypto.SecretKey;
  48 import javax.crypto.ShortBufferException;
  49 import javax.crypto.spec.GCMParameterSpec;
  50 import javax.crypto.spec.IvParameterSpec;
  51 import sun.security.ssl.Authenticator.MAC;
  52 import static sun.security.ssl.CipherType.*;
  53 import static sun.security.ssl.JsseJce.*;
  54 
  55 enum SSLCipher {
  56     // exportable ciphers
  57     @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
  58     B_NULL(&quot;NULL&quot;, NULL_CIPHER, 0, 0, 0, 0, true, true,
  59         (Map.Entry&lt;ReadCipherGenerator,
  60                 ProtocolVersion[]&gt;[])(new Map.Entry[] {
  61             new SimpleImmutableEntry&lt;ReadCipherGenerator, ProtocolVersion[]&gt;(
  62                 new NullReadCipherGenerator(),
  63                 ProtocolVersion.PROTOCOLS_OF_NONE
  64             ),
  65             new SimpleImmutableEntry&lt;ReadCipherGenerator, ProtocolVersion[]&gt;(
  66                 new NullReadCipherGenerator(),
</pre>
<hr />
<pre>
 476             int fixedIvSize, boolean allowed, boolean exportable,
 477             Map.Entry&lt;ReadCipherGenerator,
 478                     ProtocolVersion[]&gt;[] readCipherGenerators,
 479             Map.Entry&lt;WriteCipherGenerator,
 480                     ProtocolVersion[]&gt;[] writeCipherGenerators) {
 481         this.transformation = transformation;
 482         String[] splits = transformation.split(&quot;/&quot;);
 483         this.algorithm = splits[0];
 484         this.cipherType = cipherType;
 485         this.description = this.algorithm + &quot;/&quot; + (keySize &lt;&lt; 3);
 486         this.keySize = keySize;
 487         this.ivSize = ivSize;
 488         this.fixedIvSize = fixedIvSize;
 489         this.allowed = allowed;
 490 
 491         this.expandedKeySize = expandedKeySize;
 492         this.exportable = exportable;
 493 
 494         // availability of this bulk cipher
 495         //
<span class="line-modified"> 496         // AES/256 is unavailable when the default JCE policy jurisdiction files</span>
<span class="line-modified"> 497         // are installed because of key length restrictions.</span>
<span class="line-modified"> 498         this.isAvailable = allowed &amp;&amp; isUnlimited(keySize, transformation) &amp;&amp;</span>
<span class="line-modified"> 499                 isTransformationAvailable(transformation);</span>

 500 
 501         this.readCipherGenerators = readCipherGenerators;
 502         this.writeCipherGenerators = writeCipherGenerators;
 503     }
 504 
<span class="line-added"> 505     private static boolean isTransformationAvailable(String transformation) {</span>
<span class="line-added"> 506         if (transformation.equals(&quot;NULL&quot;)) {</span>
<span class="line-added"> 507             return true;</span>
<span class="line-added"> 508         }</span>
<span class="line-added"> 509         try {</span>
<span class="line-added"> 510             Cipher.getInstance(transformation);</span>
<span class="line-added"> 511             return true;</span>
<span class="line-added"> 512         } catch (NoSuchAlgorithmException | NoSuchPaddingException e) {</span>
<span class="line-added"> 513             if (SSLLogger.isOn &amp;&amp; SSLLogger.isOn(&quot;ssl&quot;)) {</span>
<span class="line-added"> 514                 SSLLogger.fine(&quot;Transformation &quot; + transformation + &quot; is&quot; +</span>
<span class="line-added"> 515                         &quot; not available.&quot;);</span>
<span class="line-added"> 516             }</span>
<span class="line-added"> 517         }</span>
<span class="line-added"> 518         return false;</span>
<span class="line-added"> 519     }</span>
<span class="line-added"> 520 </span>
 521     SSLReadCipher createReadCipher(Authenticator authenticator,
 522             ProtocolVersion protocolVersion,
 523             SecretKey key, IvParameterSpec iv,
 524             SecureRandom random) throws GeneralSecurityException {
 525         if (readCipherGenerators.length == 0) {
 526             return null;
 527         }
 528 
 529         ReadCipherGenerator rcg = null;
 530         for (Map.Entry&lt;ReadCipherGenerator,
 531                 ProtocolVersion[]&gt; me : readCipherGenerators) {
 532             for (ProtocolVersion pv : me.getValue()) {
 533                 if (protocolVersion == pv) {
 534                     rcg = me.getKey();
 535                 }
 536             }
 537         }
 538 
 539         if (rcg != null) {
 540             return rcg.createCipher(this, authenticator,
</pre>
</td>
</tr>
</table>
<center><a href="PreSharedKeyExtension.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="SSLConfiguration.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>