<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/com/sun/crypto/provider/KeyProtector.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JceKeyStore.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="OAEPParameters.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/com/sun/crypto/provider/KeyProtector.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -46,10 +46,11 @@</span>
  import javax.crypto.spec.*;
  import javax.security.auth.DestroyFailedException;
  
  import sun.security.x509.AlgorithmId;
  import sun.security.util.ObjectIdentifier;
<span class="udiff-line-added">+ import sun.security.util.SecurityProperties;</span>
  
  /**
   * This class implements a protection mechanism for private keys. In JCE, we
   * use a stronger protection mechanism than in the JDK, because we can use
   * the &lt;code&gt;Cipher&lt;/code&gt; class.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -73,18 +74,43 @@</span>
      // JavaSoft proprietary key-protection algorithm (used to protect private
      // keys in the keystore implementation that comes with JDK 1.2)
      private static final String KEY_PROTECTOR_OID = &quot;1.3.6.1.4.1.42.2.17.1.1&quot;;
  
      private static final int MAX_ITERATION_COUNT = 5000000;
<span class="udiff-line-modified-removed">-     private static final int ITERATION_COUNT = 200000;</span>
<span class="udiff-line-modified-added">+     private static final int MIN_ITERATION_COUNT = 10000;</span>
<span class="udiff-line-added">+     private static final int DEFAULT_ITERATION_COUNT = 200000;</span>
      private static final int SALT_LEN = 20; // the salt length
      private static final int DIGEST_LEN = 20;
<span class="udiff-line-added">+     private static final int ITERATION_COUNT;</span>
  
      // the password used for protecting/recovering keys passed through this
      // key protector
      private char[] password;
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * {@systemProperty jdk.jceks.iterationCount} property indicating the</span>
<span class="udiff-line-added">+      * number of iterations for password-based encryption (PBE) in JCEKS</span>
<span class="udiff-line-added">+      * keystores. Values in the range 10000 to 5000000 are considered valid.</span>
<span class="udiff-line-added">+      * If the value is out of this range, or is not a number, or is</span>
<span class="udiff-line-added">+      * unspecified; a default of 200000 is used.</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     static {</span>
<span class="udiff-line-added">+         int iterationCount = DEFAULT_ITERATION_COUNT;</span>
<span class="udiff-line-added">+         String ic = SecurityProperties.privilegedGetOverridable(</span>
<span class="udiff-line-added">+                 &quot;jdk.jceks.iterationCount&quot;);</span>
<span class="udiff-line-added">+         if (ic != null &amp;&amp; !ic.isEmpty()) {</span>
<span class="udiff-line-added">+             try {</span>
<span class="udiff-line-added">+                 iterationCount = Integer.parseInt(ic);</span>
<span class="udiff-line-added">+                 if (iterationCount &lt; MIN_ITERATION_COUNT ||</span>
<span class="udiff-line-added">+                         iterationCount &gt; MAX_ITERATION_COUNT) {</span>
<span class="udiff-line-added">+                     iterationCount = DEFAULT_ITERATION_COUNT;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             } catch (NumberFormatException e) {}</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         ITERATION_COUNT = iterationCount;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      KeyProtector(char[] password) {
          if (password == null) {
             throw new IllegalArgumentException(&quot;password can&#39;t be null&quot;);
          }
          this.password = password;
</pre>
<center><a href="JceKeyStore.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="OAEPParameters.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>