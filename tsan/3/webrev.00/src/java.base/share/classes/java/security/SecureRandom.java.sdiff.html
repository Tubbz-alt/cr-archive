<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/security/SecureRandom.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="SecureClassLoader.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SecureRandomSpi.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/SecureRandom.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package java.security;
  27 
  28 import java.util.*;
  29 import java.util.regex.*;
  30 
  31 import java.security.Provider.Service;
  32 
  33 import sun.security.jca.*;
  34 import sun.security.jca.GetInstance.Instance;

  35 import sun.security.util.Debug;
  36 
  37 /**
  38  * This class provides a cryptographically strong random number
  39  * generator (RNG).
  40  *
  41  * &lt;p&gt;A cryptographically strong random number minimally complies with the
  42  * statistical random number generator tests specified in
  43  * &lt;a href=&quot;http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.140-2.pdf&quot;&gt;
  44  * &lt;i&gt;FIPS 140-2, Security Requirements for Cryptographic Modules&lt;/i&gt;&lt;/a&gt;,
  45  * section 4.9.1.
  46  * Additionally, {@code SecureRandom} must produce non-deterministic output.
  47  * Therefore any seed material passed to a {@code SecureRandom} object must be
  48  * unpredictable, and all {@code SecureRandom} output sequences must be
  49  * cryptographically strong, as described in
  50  * &lt;a href=&quot;http://tools.ietf.org/html/rfc4086&quot;&gt;
  51  * &lt;i&gt;RFC 4086: Randomness Requirements for Security&lt;/i&gt;&lt;/a&gt;.
  52  *
  53  * &lt;p&gt; Many {@code SecureRandom} implementations are in the form of a
  54  * pseudo-random number generator (PRNG, also known as deterministic random
</pre>
<hr />
<pre>
 858      */
 859     private static byte[] longToByteArray(long l) {
 860         byte[] retVal = new byte[8];
 861 
 862         for (int i = 0; i &lt; 8; i++) {
 863             retVal[i] = (byte) l;
 864             l &gt;&gt;= 8;
 865         }
 866 
 867         return retVal;
 868     }
 869 
 870     /**
 871      * Gets a default PRNG algorithm by looking through all registered
 872      * providers. Returns the first PRNG algorithm of the first provider that
 873      * has registered a {@code SecureRandom} implementation, or null if none of
 874      * the registered providers supplies a {@code SecureRandom} implementation.
 875      */
 876     private static String getPrngAlgorithm() {
 877         for (Provider p : Providers.getProviderList().providers()) {







 878             for (Service s : p.getServices()) {
 879                 if (s.getType().equals(&quot;SecureRandom&quot;)) {
 880                     return s.getAlgorithm();
 881                 }
 882             }
 883         }
 884         return null;
 885     }
 886 
 887     /*
 888      * Lazily initialize since Pattern.compile() is heavy.
 889      * Effective Java (2nd Edition), Item 71.
 890      */
 891     private static final class StrongPatternHolder {
 892         /*
 893          * Entries are alg:prov separated by ,
 894          * Allow for prepended/appended whitespace between entries.
 895          *
 896          * Capture groups:
 897          *     1 - alg
</pre>
<hr />
<pre>
1007      *         implementation has not overridden this method.
1008      * @throws IllegalArgumentException if {@code params} is {@code null},
1009      *         illegal or unsupported by this {@code SecureRandom}
1010      *
1011      * @since 9
1012      */
1013     public void reseed(SecureRandomParameters params) {
1014         if (params == null) {
1015             throw new IllegalArgumentException(&quot;params cannot be null&quot;);
1016         }
1017         if (threadSafe) {
1018             secureRandomSpi.engineReseed(params);
1019         } else {
1020             synchronized (this) {
1021                 secureRandomSpi.engineReseed(params);
1022             }
1023         }
1024     }
1025 
1026     // Declare serialVersionUID to be compatible with JDK1.1

1027     static final long serialVersionUID = 4940670005562187L;
1028 
1029     // Retain unused values serialized from JDK1.1
1030     /**
1031      * @serial
1032      */
1033     private byte[] state;
1034     /**
1035      * @serial
1036      */

1037     private MessageDigest digest = null;
1038     /**
1039      * @serial
1040      *
1041      * We know that the MessageDigest class does not implement
1042      * java.io.Serializable.  However, since this field is no longer
1043      * used, it will always be NULL and won&#39;t affect the serialization
1044      * of the {@code SecureRandom} class itself.
1045      */
1046     private byte[] randomBytes;
1047     /**
1048      * @serial
1049      */
1050     private int randomBytesUsed;
1051     /**
1052      * @serial
1053      */
1054     private long counter;
1055 }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1996, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package java.security;
  27 
  28 import java.util.*;
  29 import java.util.regex.*;
  30 
  31 import java.security.Provider.Service;
  32 
  33 import sun.security.jca.*;
  34 import sun.security.jca.GetInstance.Instance;
<span class="line-added">  35 import sun.security.provider.SunEntries;</span>
  36 import sun.security.util.Debug;
  37 
  38 /**
  39  * This class provides a cryptographically strong random number
  40  * generator (RNG).
  41  *
  42  * &lt;p&gt;A cryptographically strong random number minimally complies with the
  43  * statistical random number generator tests specified in
  44  * &lt;a href=&quot;http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.140-2.pdf&quot;&gt;
  45  * &lt;i&gt;FIPS 140-2, Security Requirements for Cryptographic Modules&lt;/i&gt;&lt;/a&gt;,
  46  * section 4.9.1.
  47  * Additionally, {@code SecureRandom} must produce non-deterministic output.
  48  * Therefore any seed material passed to a {@code SecureRandom} object must be
  49  * unpredictable, and all {@code SecureRandom} output sequences must be
  50  * cryptographically strong, as described in
  51  * &lt;a href=&quot;http://tools.ietf.org/html/rfc4086&quot;&gt;
  52  * &lt;i&gt;RFC 4086: Randomness Requirements for Security&lt;/i&gt;&lt;/a&gt;.
  53  *
  54  * &lt;p&gt; Many {@code SecureRandom} implementations are in the form of a
  55  * pseudo-random number generator (PRNG, also known as deterministic random
</pre>
<hr />
<pre>
 859      */
 860     private static byte[] longToByteArray(long l) {
 861         byte[] retVal = new byte[8];
 862 
 863         for (int i = 0; i &lt; 8; i++) {
 864             retVal[i] = (byte) l;
 865             l &gt;&gt;= 8;
 866         }
 867 
 868         return retVal;
 869     }
 870 
 871     /**
 872      * Gets a default PRNG algorithm by looking through all registered
 873      * providers. Returns the first PRNG algorithm of the first provider that
 874      * has registered a {@code SecureRandom} implementation, or null if none of
 875      * the registered providers supplies a {@code SecureRandom} implementation.
 876      */
 877     private static String getPrngAlgorithm() {
 878         for (Provider p : Providers.getProviderList().providers()) {
<span class="line-added"> 879             // For SUN provider, we use SunEntries.DEFF_SECURE_RANDOM_ALGO</span>
<span class="line-added"> 880             // as the default SecureRandom algorithm; for other providers,</span>
<span class="line-added"> 881             // we continue to iterate through to the 1st SecureRandom</span>
<span class="line-added"> 882             // service</span>
<span class="line-added"> 883             if (p.getName().equals(&quot;SUN&quot;)) {</span>
<span class="line-added"> 884                 return SunEntries.DEF_SECURE_RANDOM_ALGO;</span>
<span class="line-added"> 885             }</span>
 886             for (Service s : p.getServices()) {
 887                 if (s.getType().equals(&quot;SecureRandom&quot;)) {
 888                     return s.getAlgorithm();
 889                 }
 890             }
 891         }
 892         return null;
 893     }
 894 
 895     /*
 896      * Lazily initialize since Pattern.compile() is heavy.
 897      * Effective Java (2nd Edition), Item 71.
 898      */
 899     private static final class StrongPatternHolder {
 900         /*
 901          * Entries are alg:prov separated by ,
 902          * Allow for prepended/appended whitespace between entries.
 903          *
 904          * Capture groups:
 905          *     1 - alg
</pre>
<hr />
<pre>
1015      *         implementation has not overridden this method.
1016      * @throws IllegalArgumentException if {@code params} is {@code null},
1017      *         illegal or unsupported by this {@code SecureRandom}
1018      *
1019      * @since 9
1020      */
1021     public void reseed(SecureRandomParameters params) {
1022         if (params == null) {
1023             throw new IllegalArgumentException(&quot;params cannot be null&quot;);
1024         }
1025         if (threadSafe) {
1026             secureRandomSpi.engineReseed(params);
1027         } else {
1028             synchronized (this) {
1029                 secureRandomSpi.engineReseed(params);
1030             }
1031         }
1032     }
1033 
1034     // Declare serialVersionUID to be compatible with JDK1.1
<span class="line-added">1035     @java.io.Serial</span>
1036     static final long serialVersionUID = 4940670005562187L;
1037 
1038     // Retain unused values serialized from JDK1.1
1039     /**
1040      * @serial
1041      */
1042     private byte[] state;
1043     /**
1044      * @serial
1045      */
<span class="line-added">1046     @SuppressWarnings(&quot;serial&quot;) // Not statically typed as Serializable</span>
1047     private MessageDigest digest = null;
1048     /**
1049      * @serial
1050      *
1051      * We know that the MessageDigest class does not implement
1052      * java.io.Serializable.  However, since this field is no longer
1053      * used, it will always be NULL and won&#39;t affect the serialization
1054      * of the {@code SecureRandom} class itself.
1055      */
1056     private byte[] randomBytes;
1057     /**
1058      * @serial
1059      */
1060     private int randomBytesUsed;
1061     /**
1062      * @serial
1063      */
1064     private long counter;
1065 }
</pre>
</td>
</tr>
</table>
<center><a href="SecureClassLoader.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SecureRandomSpi.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>