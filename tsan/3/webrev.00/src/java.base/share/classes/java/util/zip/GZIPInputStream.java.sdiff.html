<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/util/zip/GZIPInputStream.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="DeflaterOutputStream.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="GZIPOutputStream.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/zip/GZIPInputStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1996, 2013, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 24  */
 25 
 26 package java.util.zip;
 27 
 28 import java.io.SequenceInputStream;
 29 import java.io.ByteArrayInputStream;
 30 import java.io.FilterInputStream;
 31 import java.io.InputStream;
 32 import java.io.IOException;
 33 import java.io.EOFException;
 34 
 35 /**
 36  * This class implements a stream filter for reading compressed data in
 37  * the GZIP file format.
 38  *
 39  * @see         InflaterInputStream
 40  * @author      David Connelly
 41  * @since 1.1
 42  *
 43  */
<span class="line-modified"> 44 public</span>
<span class="line-removed"> 45 class GZIPInputStream extends InflaterInputStream {</span>
 46     /**
 47      * CRC-32 for uncompressed data.
 48      */
 49     protected CRC32 crc = new CRC32();
 50 
 51     /**
 52      * Indicates end of input stream.
 53      */
 54     protected boolean eos;
 55 
 56     private boolean closed = false;
 57 
 58     /**
 59      * Check to make sure that this stream has not been closed
 60      */
 61     private void ensureOpen() throws IOException {
 62         if (closed) {
 63             throw new IOException(&quot;Stream closed&quot;);
 64         }
 65     }
 66 
 67     /**
 68      * Creates a new input stream with the specified buffer size.
 69      * @param in the input stream
 70      * @param size the input buffer size
 71      *
<span class="line-modified"> 72      * @exception ZipException if a GZIP format error has occurred or the</span>
 73      *                         compression method used is unsupported
<span class="line-modified"> 74      * @exception IOException if an I/O error has occurred</span>
<span class="line-modified"> 75      * @exception IllegalArgumentException if {@code size &lt;= 0}</span>
 76      */
 77     public GZIPInputStream(InputStream in, int size) throws IOException {
 78         super(in, new Inflater(true), size);
 79         usesDefaultInflater = true;
 80         readHeader(in);
 81     }
 82 
 83     /**
 84      * Creates a new input stream with a default buffer size.
 85      * @param in the input stream
 86      *
<span class="line-modified"> 87      * @exception ZipException if a GZIP format error has occurred or the</span>
 88      *                         compression method used is unsupported
<span class="line-modified"> 89      * @exception IOException if an I/O error has occurred</span>
 90      */
 91     public GZIPInputStream(InputStream in) throws IOException {
 92         this(in, 512);
 93     }
 94 
 95     /**
<span class="line-modified"> 96      * Reads uncompressed data into an array of bytes. If &lt;code&gt;len&lt;/code&gt; is not</span>
 97      * zero, the method will block until some input can be decompressed; otherwise,
<span class="line-modified"> 98      * no bytes are read and &lt;code&gt;0&lt;/code&gt; is returned.</span>
 99      * @param buf the buffer into which the data is read
<span class="line-modified">100      * @param off the start offset in the destination array &lt;code&gt;b&lt;/code&gt;</span>
101      * @param len the maximum number of bytes read
102      * @return  the actual number of bytes read, or -1 if the end of the
103      *          compressed input stream is reached
104      *
<span class="line-modified">105      * @exception  NullPointerException If &lt;code&gt;buf&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.</span>
<span class="line-modified">106      * @exception  IndexOutOfBoundsException If &lt;code&gt;off&lt;/code&gt; is negative,</span>
<span class="line-modified">107      * &lt;code&gt;len&lt;/code&gt; is negative, or &lt;code&gt;len&lt;/code&gt; is greater than</span>
<span class="line-modified">108      * &lt;code&gt;buf.length - off&lt;/code&gt;</span>
<span class="line-modified">109      * @exception ZipException if the compressed input data is corrupt.</span>
<span class="line-modified">110      * @exception IOException if an I/O error has occurred.</span>
111      *
112      */
113     public int read(byte[] buf, int off, int len) throws IOException {
114         ensureOpen();
115         if (eos) {
116             return -1;
117         }
118         int n = super.read(buf, off, len);
119         if (n == -1) {
120             if (readTrailer())
121                 eos = true;
122             else
123                 return this.read(buf, off, len);
124         } else {
125             crc.update(buf, off, n);
126         }
127         return n;
128     }
129 
130     /**
131      * Closes this input stream and releases any system resources associated
132      * with the stream.
<span class="line-modified">133      * @exception IOException if an I/O error has occurred</span>
134      */
135     public void close() throws IOException {
136         if (!closed) {
137             super.close();
138             eos = true;
139             closed = true;
140         }
141     }
142 
143     /**
144      * GZIP header magic number.
145      */
146     public static final int GZIP_MAGIC = 0x8b1f;
147 
148     /*
149      * File header flags.
150      */
151     private static final int FTEXT      = 1;    // Extra text
152     private static final int FHCRC      = 2;    // Header CRC
153     private static final int FEXTRA     = 4;    // Extra field
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1996, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 24  */
 25 
 26 package java.util.zip;
 27 
 28 import java.io.SequenceInputStream;
 29 import java.io.ByteArrayInputStream;
 30 import java.io.FilterInputStream;
 31 import java.io.InputStream;
 32 import java.io.IOException;
 33 import java.io.EOFException;
 34 
 35 /**
 36  * This class implements a stream filter for reading compressed data in
 37  * the GZIP file format.
 38  *
 39  * @see         InflaterInputStream
 40  * @author      David Connelly
 41  * @since 1.1
 42  *
 43  */
<span class="line-modified"> 44 public class GZIPInputStream extends InflaterInputStream {</span>

 45     /**
 46      * CRC-32 for uncompressed data.
 47      */
 48     protected CRC32 crc = new CRC32();
 49 
 50     /**
 51      * Indicates end of input stream.
 52      */
 53     protected boolean eos;
 54 
 55     private boolean closed = false;
 56 
 57     /**
 58      * Check to make sure that this stream has not been closed
 59      */
 60     private void ensureOpen() throws IOException {
 61         if (closed) {
 62             throw new IOException(&quot;Stream closed&quot;);
 63         }
 64     }
 65 
 66     /**
 67      * Creates a new input stream with the specified buffer size.
 68      * @param in the input stream
 69      * @param size the input buffer size
 70      *
<span class="line-modified"> 71      * @throws    ZipException if a GZIP format error has occurred or the</span>
 72      *                         compression method used is unsupported
<span class="line-modified"> 73      * @throws    IOException if an I/O error has occurred</span>
<span class="line-modified"> 74      * @throws    IllegalArgumentException if {@code size &lt;= 0}</span>
 75      */
 76     public GZIPInputStream(InputStream in, int size) throws IOException {
 77         super(in, new Inflater(true), size);
 78         usesDefaultInflater = true;
 79         readHeader(in);
 80     }
 81 
 82     /**
 83      * Creates a new input stream with a default buffer size.
 84      * @param in the input stream
 85      *
<span class="line-modified"> 86      * @throws    ZipException if a GZIP format error has occurred or the</span>
 87      *                         compression method used is unsupported
<span class="line-modified"> 88      * @throws    IOException if an I/O error has occurred</span>
 89      */
 90     public GZIPInputStream(InputStream in) throws IOException {
 91         this(in, 512);
 92     }
 93 
 94     /**
<span class="line-modified"> 95      * Reads uncompressed data into an array of bytes. If {@code len} is not</span>
 96      * zero, the method will block until some input can be decompressed; otherwise,
<span class="line-modified"> 97      * no bytes are read and {@code 0} is returned.</span>
 98      * @param buf the buffer into which the data is read
<span class="line-modified"> 99      * @param off the start offset in the destination array {@code b}</span>
100      * @param len the maximum number of bytes read
101      * @return  the actual number of bytes read, or -1 if the end of the
102      *          compressed input stream is reached
103      *
<span class="line-modified">104      * @throws     NullPointerException If {@code buf} is {@code null}.</span>
<span class="line-modified">105      * @throws     IndexOutOfBoundsException If {@code off} is negative,</span>
<span class="line-modified">106      * {@code len} is negative, or {@code len} is greater than</span>
<span class="line-modified">107      * {@code buf.length - off}</span>
<span class="line-modified">108      * @throws    ZipException if the compressed input data is corrupt.</span>
<span class="line-modified">109      * @throws    IOException if an I/O error has occurred.</span>
110      *
111      */
112     public int read(byte[] buf, int off, int len) throws IOException {
113         ensureOpen();
114         if (eos) {
115             return -1;
116         }
117         int n = super.read(buf, off, len);
118         if (n == -1) {
119             if (readTrailer())
120                 eos = true;
121             else
122                 return this.read(buf, off, len);
123         } else {
124             crc.update(buf, off, n);
125         }
126         return n;
127     }
128 
129     /**
130      * Closes this input stream and releases any system resources associated
131      * with the stream.
<span class="line-modified">132      * @throws    IOException if an I/O error has occurred</span>
133      */
134     public void close() throws IOException {
135         if (!closed) {
136             super.close();
137             eos = true;
138             closed = true;
139         }
140     }
141 
142     /**
143      * GZIP header magic number.
144      */
145     public static final int GZIP_MAGIC = 0x8b1f;
146 
147     /*
148      * File header flags.
149      */
150     private static final int FTEXT      = 1;    // Extra text
151     private static final int FHCRC      = 2;    // Header CRC
152     private static final int FEXTRA     = 4;    // Extra field
</pre>
</td>
</tr>
</table>
<center><a href="DeflaterOutputStream.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="GZIPOutputStream.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>