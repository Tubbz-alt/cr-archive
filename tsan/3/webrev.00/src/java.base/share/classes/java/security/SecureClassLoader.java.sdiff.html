<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/security/SecureClassLoader.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="PublicKey.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SecureRandom.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/SecureClassLoader.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 51      * ProtectionDomains; however during policy enforcement these URLs will be
 52      * canonicalized and resolved resulting in a consistent set of granted
 53      * permissions.
 54      */
 55     private final Map&lt;CodeSourceKey, ProtectionDomain&gt; pdcache
 56             = new ConcurrentHashMap&lt;&gt;(11);
 57 
 58     static {
 59         ClassLoader.registerAsParallelCapable();
 60     }
 61 
 62     /**
 63      * Creates a new SecureClassLoader using the specified parent
 64      * class loader for delegation.
 65      *
 66      * &lt;p&gt;If there is a security manager, this method first
 67      * calls the security manager&#39;s {@code checkCreateClassLoader}
 68      * method  to ensure creation of a class loader is allowed.
 69      *
 70      * @param parent the parent ClassLoader
<span class="line-modified"> 71      * @exception  SecurityException  if a security manager exists and its</span>
 72      *             {@code checkCreateClassLoader} method doesn&#39;t allow
 73      *             creation of a class loader.
 74      * @see SecurityManager#checkCreateClassLoader
 75      */
 76     protected SecureClassLoader(ClassLoader parent) {
 77         super(parent);
 78     }
 79 
 80     /**
 81      * Creates a new SecureClassLoader using the default parent class
 82      * loader for delegation.
 83      *
 84      * &lt;p&gt;If there is a security manager, this method first
 85      * calls the security manager&#39;s {@code checkCreateClassLoader}
 86      * method  to ensure creation of a class loader is allowed.
 87      *
<span class="line-modified"> 88      * @exception  SecurityException  if a security manager exists and its</span>
 89      *             {@code checkCreateClassLoader} method doesn&#39;t allow
 90      *             creation of a class loader.
 91      * @see SecurityManager#checkCreateClassLoader
 92      */
 93     protected SecureClassLoader() {
 94         super();
 95     }
 96 
 97     /**
 98      * Creates a new {@code SecureClassLoader} of the specified name and
 99      * using the specified parent class loader for delegation.
100      *
101      * @param name class loader name; or {@code null} if not named
102      * @param parent the parent class loader
103      *
104      * @throws IllegalArgumentException if the given name is empty.
105      *
106      * @throws SecurityException  if a security manager exists and its
107      *         {@link SecurityManager#checkCreateClassLoader()} method
108      *         doesn&#39;t allow creation of a class loader.
</pre>
<hr />
<pre>
117     /**
118      * Converts an array of bytes into an instance of class Class,
119      * with an optional CodeSource. Before the
120      * class can be used it must be resolved.
121      * &lt;p&gt;
122      * If a non-null CodeSource is supplied a ProtectionDomain is
123      * constructed and associated with the class being defined.
124      *
125      * @param      name the expected name of the class, or {@code null}
126      *                  if not known, using &#39;.&#39; and not &#39;/&#39; as the separator
127      *                  and without a trailing &quot;.class&quot; suffix.
128      * @param      b    the bytes that make up the class data. The bytes in
129      *             positions {@code off} through {@code off+len-1}
130      *             should have the format of a valid class file as defined by
131      *             &lt;cite&gt;The Java&amp;trade; Virtual Machine Specification&lt;/cite&gt;.
132      * @param      off  the start offset in {@code b} of the class data
133      * @param      len  the length of the class data
134      * @param      cs   the associated CodeSource, or {@code null} if none
135      * @return the {@code Class} object created from the data,
136      *         and optional CodeSource.
<span class="line-modified">137      * @exception  ClassFormatError if the data did not contain a valid class</span>
<span class="line-modified">138      * @exception  IndexOutOfBoundsException if either {@code off} or</span>
139      *             {@code len} is negative, or if
140      *             {@code off+len} is greater than {@code b.length}.
141      *
<span class="line-modified">142      * @exception  SecurityException if an attempt is made to add this class</span>
143      *             to a package that contains classes that were signed by
144      *             a different set of certificates than this class, or if
145      *             the class name begins with &quot;java.&quot;.
146      */
147     protected final Class&lt;?&gt; defineClass(String name,
148                                          byte[] b, int off, int len,
149                                          CodeSource cs)
150     {
151         return defineClass(name, b, off, len, getProtectionDomain(cs));
152     }
153 
154     /**
155      * Converts a {@link java.nio.ByteBuffer ByteBuffer}
156      * into an instance of class {@code Class}, with an optional CodeSource.
157      * Before the class can be used it must be resolved.
158      * &lt;p&gt;
159      * If a non-null CodeSource is supplied a ProtectionDomain is
160      * constructed and associated with the class being defined.
161      *
162      * @param      name the expected name of the class, or {@code null}
163      *                  if not known, using &#39;.&#39; and not &#39;/&#39; as the separator
164      *                  and without a trailing &quot;.class&quot; suffix.
165      * @param      b    the bytes that make up the class data.  The bytes from positions
166      *                  {@code b.position()} through {@code b.position() + b.limit() -1}
167      *                  should have the format of a valid class file as defined by
168      *                  &lt;cite&gt;The Java&amp;trade; Virtual Machine Specification&lt;/cite&gt;.
169      * @param      cs   the associated CodeSource, or {@code null} if none
170      * @return the {@code Class} object created from the data,
171      *         and optional CodeSource.
<span class="line-modified">172      * @exception  ClassFormatError if the data did not contain a valid class</span>
<span class="line-modified">173      * @exception  SecurityException if an attempt is made to add this class</span>
174      *             to a package that contains classes that were signed by
175      *             a different set of certificates than this class, or if
176      *             the class name begins with &quot;java.&quot;.
177      *
178      * @since  1.5
179      */
180     protected final Class&lt;?&gt; defineClass(String name, java.nio.ByteBuffer b,
181                                          CodeSource cs)
182     {
183         return defineClass(name, b, getProtectionDomain(cs));
184     }
185 
186     /**
187      * Returns the permissions for the given CodeSource object.
188      * &lt;p&gt;
189      * This method is invoked by the defineClass method which takes
190      * a CodeSource as an argument when it is constructing the
191      * ProtectionDomain for the class being defined.
192      *
193      * @param codesource the codesource.
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 51      * ProtectionDomains; however during policy enforcement these URLs will be
 52      * canonicalized and resolved resulting in a consistent set of granted
 53      * permissions.
 54      */
 55     private final Map&lt;CodeSourceKey, ProtectionDomain&gt; pdcache
 56             = new ConcurrentHashMap&lt;&gt;(11);
 57 
 58     static {
 59         ClassLoader.registerAsParallelCapable();
 60     }
 61 
 62     /**
 63      * Creates a new SecureClassLoader using the specified parent
 64      * class loader for delegation.
 65      *
 66      * &lt;p&gt;If there is a security manager, this method first
 67      * calls the security manager&#39;s {@code checkCreateClassLoader}
 68      * method  to ensure creation of a class loader is allowed.
 69      *
 70      * @param parent the parent ClassLoader
<span class="line-modified"> 71      * @throws     SecurityException  if a security manager exists and its</span>
 72      *             {@code checkCreateClassLoader} method doesn&#39;t allow
 73      *             creation of a class loader.
 74      * @see SecurityManager#checkCreateClassLoader
 75      */
 76     protected SecureClassLoader(ClassLoader parent) {
 77         super(parent);
 78     }
 79 
 80     /**
 81      * Creates a new SecureClassLoader using the default parent class
 82      * loader for delegation.
 83      *
 84      * &lt;p&gt;If there is a security manager, this method first
 85      * calls the security manager&#39;s {@code checkCreateClassLoader}
 86      * method  to ensure creation of a class loader is allowed.
 87      *
<span class="line-modified"> 88      * @throws     SecurityException  if a security manager exists and its</span>
 89      *             {@code checkCreateClassLoader} method doesn&#39;t allow
 90      *             creation of a class loader.
 91      * @see SecurityManager#checkCreateClassLoader
 92      */
 93     protected SecureClassLoader() {
 94         super();
 95     }
 96 
 97     /**
 98      * Creates a new {@code SecureClassLoader} of the specified name and
 99      * using the specified parent class loader for delegation.
100      *
101      * @param name class loader name; or {@code null} if not named
102      * @param parent the parent class loader
103      *
104      * @throws IllegalArgumentException if the given name is empty.
105      *
106      * @throws SecurityException  if a security manager exists and its
107      *         {@link SecurityManager#checkCreateClassLoader()} method
108      *         doesn&#39;t allow creation of a class loader.
</pre>
<hr />
<pre>
117     /**
118      * Converts an array of bytes into an instance of class Class,
119      * with an optional CodeSource. Before the
120      * class can be used it must be resolved.
121      * &lt;p&gt;
122      * If a non-null CodeSource is supplied a ProtectionDomain is
123      * constructed and associated with the class being defined.
124      *
125      * @param      name the expected name of the class, or {@code null}
126      *                  if not known, using &#39;.&#39; and not &#39;/&#39; as the separator
127      *                  and without a trailing &quot;.class&quot; suffix.
128      * @param      b    the bytes that make up the class data. The bytes in
129      *             positions {@code off} through {@code off+len-1}
130      *             should have the format of a valid class file as defined by
131      *             &lt;cite&gt;The Java&amp;trade; Virtual Machine Specification&lt;/cite&gt;.
132      * @param      off  the start offset in {@code b} of the class data
133      * @param      len  the length of the class data
134      * @param      cs   the associated CodeSource, or {@code null} if none
135      * @return the {@code Class} object created from the data,
136      *         and optional CodeSource.
<span class="line-modified">137      * @throws     ClassFormatError if the data did not contain a valid class</span>
<span class="line-modified">138      * @throws     IndexOutOfBoundsException if either {@code off} or</span>
139      *             {@code len} is negative, or if
140      *             {@code off+len} is greater than {@code b.length}.
141      *
<span class="line-modified">142      * @throws     SecurityException if an attempt is made to add this class</span>
143      *             to a package that contains classes that were signed by
144      *             a different set of certificates than this class, or if
145      *             the class name begins with &quot;java.&quot;.
146      */
147     protected final Class&lt;?&gt; defineClass(String name,
148                                          byte[] b, int off, int len,
149                                          CodeSource cs)
150     {
151         return defineClass(name, b, off, len, getProtectionDomain(cs));
152     }
153 
154     /**
155      * Converts a {@link java.nio.ByteBuffer ByteBuffer}
156      * into an instance of class {@code Class}, with an optional CodeSource.
157      * Before the class can be used it must be resolved.
158      * &lt;p&gt;
159      * If a non-null CodeSource is supplied a ProtectionDomain is
160      * constructed and associated with the class being defined.
161      *
162      * @param      name the expected name of the class, or {@code null}
163      *                  if not known, using &#39;.&#39; and not &#39;/&#39; as the separator
164      *                  and without a trailing &quot;.class&quot; suffix.
165      * @param      b    the bytes that make up the class data.  The bytes from positions
166      *                  {@code b.position()} through {@code b.position() + b.limit() -1}
167      *                  should have the format of a valid class file as defined by
168      *                  &lt;cite&gt;The Java&amp;trade; Virtual Machine Specification&lt;/cite&gt;.
169      * @param      cs   the associated CodeSource, or {@code null} if none
170      * @return the {@code Class} object created from the data,
171      *         and optional CodeSource.
<span class="line-modified">172      * @throws     ClassFormatError if the data did not contain a valid class</span>
<span class="line-modified">173      * @throws     SecurityException if an attempt is made to add this class</span>
174      *             to a package that contains classes that were signed by
175      *             a different set of certificates than this class, or if
176      *             the class name begins with &quot;java.&quot;.
177      *
178      * @since  1.5
179      */
180     protected final Class&lt;?&gt; defineClass(String name, java.nio.ByteBuffer b,
181                                          CodeSource cs)
182     {
183         return defineClass(name, b, getProtectionDomain(cs));
184     }
185 
186     /**
187      * Returns the permissions for the given CodeSource object.
188      * &lt;p&gt;
189      * This method is invoked by the defineClass method which takes
190      * a CodeSource as an argument when it is constructing the
191      * ProtectionDomain for the class being defined.
192      *
193      * @param codesource the codesource.
</pre>
</td>
</tr>
</table>
<center><a href="PublicKey.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SecureRandom.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>