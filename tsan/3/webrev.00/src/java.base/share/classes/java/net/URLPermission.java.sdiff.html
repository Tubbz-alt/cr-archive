<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/net/URLPermission.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="URLConnection.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="URLStreamHandler.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/net/URLPermission.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
134  * The second example specifies one request method and two headers. The third
135  * example specifies two request methods, and two headers.
136  * &lt;p&gt;
137  * The colon separator need not be present if the request headers list is empty.
138  * No white-space is permitted in the actions string. The action strings supplied to
139  * the URLPermission constructors are case-insensitive and are normalized by converting
140  * method names to upper-case and header names to the form defines in RFC2616 (lower case
141  * with initial letter of each word capitalized). Either list can contain a wild-card &#39;*&#39;
142  * character which signifies all request methods or headers respectively.
143  * &lt;p&gt;
144  * Note. Depending on the context of use, some request methods and headers may be permitted
145  * at all times, and others may not be permitted at any time. For example, the
146  * HTTP protocol handler might disallow certain headers such as Content-Length
147  * from being set by application code, regardless of whether the security policy
148  * in force, permits it.
149  *
150  * @since 1.8
151  */
152 public final class URLPermission extends Permission {
153 

154     private static final long serialVersionUID = -2702463814894478682L;
155 
156     private transient String scheme;
157     private transient String ssp;                 // scheme specific part
158     private transient String path;
159     private transient List&lt;String&gt; methods;
160     private transient List&lt;String&gt; requestHeaders;
161     private transient Authority authority;
162 
163     // serialized field
164     private String actions;
165 
166     /**
167      * Creates a new URLPermission from a url string and which permits the given
168      * request methods and user-settable request headers.
169      * The name of the permission is the url string it was created with. Only the scheme,
170      * authority and path components of the url are used internally. Any fragment or query
171      * components are ignored. The permissions action string is as specified above.
172      *
173      * @param url the url string
174      *
175      * @param actions the actions string
176      *
<span class="line-modified">177      * @exception IllegalArgumentException if url is invalid or if actions contains white-space.</span>
178      */
179     public URLPermission(String url, String actions) {
180         super(normalize(url));
181         init(actions);
182     }
183 
184     /**
185      * Remove any query or fragment from url string
186      */
187     private static String normalize(String url) {
188         int index = url.indexOf(&#39;?&#39;);
189         if (index &gt;= 0) {
190             url = url.substring(0, index);
191         } else {
192             index = url.indexOf(&#39;#&#39;);
193             if (index &gt;= 0) {
194                 url = url.substring(0, index);
195             }
196         }
197         return url;
</pre>
<hr />
<pre>
488         if (delim == -1) {
489             this.path = &quot;&quot;;
490             auth = authpath;
491         } else {
492             auth = authpath.substring(0, delim);
493             this.path = authpath.substring(delim);
494         }
495         this.authority = new Authority(scheme, auth.toLowerCase());
496     }
497 
498     private String actions() {
499         // The colon separator is optional when the request headers list is
500         // empty.This implementation chooses to include it even when the request
501         // headers list is empty.
502         return String.join(&quot;,&quot;, methods) + &quot;:&quot; + String.join(&quot;,&quot;, requestHeaders);
503     }
504 
505     /**
506      * restore the state of this object from stream
507      */

508     private void readObject(ObjectInputStream s)
509         throws IOException, ClassNotFoundException {
510         ObjectInputStream.GetField fields = s.readFields();
511         String actions = (String)fields.get(&quot;actions&quot;, null);
512 
513         init(actions);
514     }
515 
516     static class Authority {
517         HostPortrange p;
518 
519         Authority(String scheme, String authority) {
520             int at = authority.indexOf(&#39;@&#39;);
521             if (at == -1) {
522                     p = new HostPortrange(scheme, authority);
523             } else {
524                     p = new HostPortrange(scheme, authority.substring(at+1));
525             }
526         }
527 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
134  * The second example specifies one request method and two headers. The third
135  * example specifies two request methods, and two headers.
136  * &lt;p&gt;
137  * The colon separator need not be present if the request headers list is empty.
138  * No white-space is permitted in the actions string. The action strings supplied to
139  * the URLPermission constructors are case-insensitive and are normalized by converting
140  * method names to upper-case and header names to the form defines in RFC2616 (lower case
141  * with initial letter of each word capitalized). Either list can contain a wild-card &#39;*&#39;
142  * character which signifies all request methods or headers respectively.
143  * &lt;p&gt;
144  * Note. Depending on the context of use, some request methods and headers may be permitted
145  * at all times, and others may not be permitted at any time. For example, the
146  * HTTP protocol handler might disallow certain headers such as Content-Length
147  * from being set by application code, regardless of whether the security policy
148  * in force, permits it.
149  *
150  * @since 1.8
151  */
152 public final class URLPermission extends Permission {
153 
<span class="line-added">154     @java.io.Serial</span>
155     private static final long serialVersionUID = -2702463814894478682L;
156 
157     private transient String scheme;
158     private transient String ssp;                 // scheme specific part
159     private transient String path;
160     private transient List&lt;String&gt; methods;
161     private transient List&lt;String&gt; requestHeaders;
162     private transient Authority authority;
163 
164     // serialized field
165     private String actions;
166 
167     /**
168      * Creates a new URLPermission from a url string and which permits the given
169      * request methods and user-settable request headers.
170      * The name of the permission is the url string it was created with. Only the scheme,
171      * authority and path components of the url are used internally. Any fragment or query
172      * components are ignored. The permissions action string is as specified above.
173      *
174      * @param url the url string
175      *
176      * @param actions the actions string
177      *
<span class="line-modified">178      * @throws    IllegalArgumentException if url is invalid or if actions contains white-space.</span>
179      */
180     public URLPermission(String url, String actions) {
181         super(normalize(url));
182         init(actions);
183     }
184 
185     /**
186      * Remove any query or fragment from url string
187      */
188     private static String normalize(String url) {
189         int index = url.indexOf(&#39;?&#39;);
190         if (index &gt;= 0) {
191             url = url.substring(0, index);
192         } else {
193             index = url.indexOf(&#39;#&#39;);
194             if (index &gt;= 0) {
195                 url = url.substring(0, index);
196             }
197         }
198         return url;
</pre>
<hr />
<pre>
489         if (delim == -1) {
490             this.path = &quot;&quot;;
491             auth = authpath;
492         } else {
493             auth = authpath.substring(0, delim);
494             this.path = authpath.substring(delim);
495         }
496         this.authority = new Authority(scheme, auth.toLowerCase());
497     }
498 
499     private String actions() {
500         // The colon separator is optional when the request headers list is
501         // empty.This implementation chooses to include it even when the request
502         // headers list is empty.
503         return String.join(&quot;,&quot;, methods) + &quot;:&quot; + String.join(&quot;,&quot;, requestHeaders);
504     }
505 
506     /**
507      * restore the state of this object from stream
508      */
<span class="line-added">509     @java.io.Serial</span>
510     private void readObject(ObjectInputStream s)
511         throws IOException, ClassNotFoundException {
512         ObjectInputStream.GetField fields = s.readFields();
513         String actions = (String)fields.get(&quot;actions&quot;, null);
514 
515         init(actions);
516     }
517 
518     static class Authority {
519         HostPortrange p;
520 
521         Authority(String scheme, String authority) {
522             int at = authority.indexOf(&#39;@&#39;);
523             if (at == -1) {
524                     p = new HostPortrange(scheme, authority);
525             } else {
526                     p = new HostPortrange(scheme, authority.substring(at+1));
527             }
528         }
529 
</pre>
</td>
</tr>
</table>
<center><a href="URLConnection.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="URLStreamHandler.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>