<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/time/zone/Ser.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../temporal/WeekFields.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZoneOffsetTransitionRule.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/time/zone/Ser.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 51  * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 52  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 53  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 54  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 55  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 56  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 57  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 58  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 59  * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 60  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 61  */
 62 package java.time.zone;
 63 
 64 import java.io.DataInput;
 65 import java.io.DataOutput;
 66 import java.io.Externalizable;
 67 import java.io.IOException;
 68 import java.io.InvalidClassException;
 69 import java.io.ObjectInput;
 70 import java.io.ObjectOutput;

 71 import java.io.StreamCorruptedException;
 72 import java.time.ZoneOffset;
 73 
 74 /**
 75  * The shared serialization delegate for this package.
 76  *
 77  * @implNote
 78  * This class is mutable and should be created once per serialization.
 79  *
 80  * @serial include
 81  * @since 1.8
 82  */
 83 final class Ser implements Externalizable {
 84 
 85     /**
 86      * Serialization version.
 87      */
 88     private static final long serialVersionUID = -8885321777449118786L;
 89 
 90     /** Type for ZoneRules. */
 91     static final byte ZRULES = 1;
 92     /** Type for ZoneOffsetTransition. */
 93     static final byte ZOT = 2;
<span class="line-modified"> 94     /** Type for ZoneOffsetTransition. */</span>
 95     static final byte ZOTRULE = 3;
 96 
 97     /** The type being serialized. */
 98     private byte type;
 99     /** The object being serialized. */
<span class="line-modified">100     private Object object;</span>
101 
102     /**
103      * Constructor for deserialization.
104      */
105     public Ser() {
106     }
107 
108     /**
109      * Creates an instance for serialization.
110      *
111      * @param type  the type
112      * @param object  the object
113      */
<span class="line-modified">114     Ser(byte type, Object object) {</span>
115         this.type = type;
116         this.object = object;
117     }
118 
119     //-----------------------------------------------------------------------
120     /**
121      * Implements the {@code Externalizable} interface to write the object.
122      * @serialData
123      * Each serializable class is mapped to a type that is the first byte
124      * in the stream.  Refer to each class {@code writeReplace}
125      * serialized form for the value of the type and sequence of values for the type.
126      *
127      * &lt;ul&gt;
128      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneRules&quot;&gt;ZoneRules.writeReplace&lt;/a&gt;
129      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneOffsetTransition&quot;&gt;ZoneOffsetTransition.writeReplace&lt;/a&gt;
130      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneOffsetTransitionRule&quot;&gt;ZoneOffsetTransitionRule.writeReplace&lt;/a&gt;
131      * &lt;/ul&gt;
132      *
133      * @param out  the data stream to write to, not null
134      */
</pre>
<hr />
<pre>
166      * method are read and passed to the corresponding static factory for the type
167      * to create a new instance.  That instance is returned as the de-serialized
168      * {@code Ser} object.
169      *
170      * &lt;ul&gt;
171      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneRules&quot;&gt;ZoneRules&lt;/a&gt;
172      * - {@code ZoneRules.of(standardTransitions, standardOffsets, savingsInstantTransitions, wallOffsets, lastRules);}
173      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneOffsetTransition&quot;&gt;ZoneOffsetTransition&lt;/a&gt;
174      * - {@code ZoneOffsetTransition of(LocalDateTime.ofEpochSecond(epochSecond), offsetBefore, offsetAfter);}
175      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneOffsetTransitionRule&quot;&gt;ZoneOffsetTransitionRule&lt;/a&gt;
176      * - {@code ZoneOffsetTransitionRule.of(month, dom, dow, time, timeEndOfDay, timeDefinition, standardOffset, offsetBefore, offsetAfter);}
177      * &lt;/ul&gt;
178      * @param in  the data to read, not null
179      */
180     @Override
181     public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
182         type = in.readByte();
183         object = readInternal(type, in);
184     }
185 
<span class="line-modified">186     static Object read(DataInput in) throws IOException, ClassNotFoundException {</span>
187         byte type = in.readByte();
188         return readInternal(type, in);
189     }
190 
<span class="line-modified">191     private static Object readInternal(byte type, DataInput in) throws IOException, ClassNotFoundException {</span>

192         switch (type) {
193             case ZRULES:
194                 return ZoneRules.readExternal(in);
195             case ZOT:
196                 return ZoneOffsetTransition.readExternal(in);
197             case ZOTRULE:
198                 return ZoneOffsetTransitionRule.readExternal(in);
199             default:
200                 throw new StreamCorruptedException(&quot;Unknown serialized type&quot;);
201         }
202     }
203 
204     /**
205      * Returns the object that will replace this one.
206      *
207      * @return the read object, should never be null
208      */
209     private Object readResolve() {
210          return object;
211     }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 51  * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 52  * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 53  * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 54  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 55  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 56  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 57  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 58  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 59  * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 60  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 61  */
 62 package java.time.zone;
 63 
 64 import java.io.DataInput;
 65 import java.io.DataOutput;
 66 import java.io.Externalizable;
 67 import java.io.IOException;
 68 import java.io.InvalidClassException;
 69 import java.io.ObjectInput;
 70 import java.io.ObjectOutput;
<span class="line-added"> 71 import java.io.Serializable;</span>
 72 import java.io.StreamCorruptedException;
 73 import java.time.ZoneOffset;
 74 
 75 /**
 76  * The shared serialization delegate for this package.
 77  *
 78  * @implNote
 79  * This class is mutable and should be created once per serialization.
 80  *
 81  * @serial include
 82  * @since 1.8
 83  */
 84 final class Ser implements Externalizable {
 85 
 86     /**
 87      * Serialization version.
 88      */
 89     private static final long serialVersionUID = -8885321777449118786L;
 90 
 91     /** Type for ZoneRules. */
 92     static final byte ZRULES = 1;
 93     /** Type for ZoneOffsetTransition. */
 94     static final byte ZOT = 2;
<span class="line-modified"> 95     /** Type for ZoneOffsetTransitionRule. */</span>
 96     static final byte ZOTRULE = 3;
 97 
 98     /** The type being serialized. */
 99     private byte type;
100     /** The object being serialized. */
<span class="line-modified">101     private Serializable object;</span>
102 
103     /**
104      * Constructor for deserialization.
105      */
106     public Ser() {
107     }
108 
109     /**
110      * Creates an instance for serialization.
111      *
112      * @param type  the type
113      * @param object  the object
114      */
<span class="line-modified">115     Ser(byte type, Serializable object) {</span>
116         this.type = type;
117         this.object = object;
118     }
119 
120     //-----------------------------------------------------------------------
121     /**
122      * Implements the {@code Externalizable} interface to write the object.
123      * @serialData
124      * Each serializable class is mapped to a type that is the first byte
125      * in the stream.  Refer to each class {@code writeReplace}
126      * serialized form for the value of the type and sequence of values for the type.
127      *
128      * &lt;ul&gt;
129      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneRules&quot;&gt;ZoneRules.writeReplace&lt;/a&gt;
130      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneOffsetTransition&quot;&gt;ZoneOffsetTransition.writeReplace&lt;/a&gt;
131      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneOffsetTransitionRule&quot;&gt;ZoneOffsetTransitionRule.writeReplace&lt;/a&gt;
132      * &lt;/ul&gt;
133      *
134      * @param out  the data stream to write to, not null
135      */
</pre>
<hr />
<pre>
167      * method are read and passed to the corresponding static factory for the type
168      * to create a new instance.  That instance is returned as the de-serialized
169      * {@code Ser} object.
170      *
171      * &lt;ul&gt;
172      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneRules&quot;&gt;ZoneRules&lt;/a&gt;
173      * - {@code ZoneRules.of(standardTransitions, standardOffsets, savingsInstantTransitions, wallOffsets, lastRules);}
174      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneOffsetTransition&quot;&gt;ZoneOffsetTransition&lt;/a&gt;
175      * - {@code ZoneOffsetTransition of(LocalDateTime.ofEpochSecond(epochSecond), offsetBefore, offsetAfter);}
176      * &lt;li&gt;&lt;a href=&quot;{@docRoot}/serialized-form.html#java.time.zone.ZoneOffsetTransitionRule&quot;&gt;ZoneOffsetTransitionRule&lt;/a&gt;
177      * - {@code ZoneOffsetTransitionRule.of(month, dom, dow, time, timeEndOfDay, timeDefinition, standardOffset, offsetBefore, offsetAfter);}
178      * &lt;/ul&gt;
179      * @param in  the data to read, not null
180      */
181     @Override
182     public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
183         type = in.readByte();
184         object = readInternal(type, in);
185     }
186 
<span class="line-modified">187     static Serializable read(DataInput in) throws IOException, ClassNotFoundException {</span>
188         byte type = in.readByte();
189         return readInternal(type, in);
190     }
191 
<span class="line-modified">192     private static Serializable readInternal(byte type, DataInput in)</span>
<span class="line-added">193             throws IOException, ClassNotFoundException {</span>
194         switch (type) {
195             case ZRULES:
196                 return ZoneRules.readExternal(in);
197             case ZOT:
198                 return ZoneOffsetTransition.readExternal(in);
199             case ZOTRULE:
200                 return ZoneOffsetTransitionRule.readExternal(in);
201             default:
202                 throw new StreamCorruptedException(&quot;Unknown serialized type&quot;);
203         }
204     }
205 
206     /**
207      * Returns the object that will replace this one.
208      *
209      * @return the read object, should never be null
210      */
211     private Object readResolve() {
212          return object;
213     }
</pre>
</td>
</tr>
</table>
<center><a href="../temporal/WeekFields.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZoneOffsetTransitionRule.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>