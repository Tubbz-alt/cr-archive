<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/util/TimeZone.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="StringTokenizer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TooManyListenersException.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/TimeZone.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1996, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 31  * and owned by Taligent, Inc., a wholly-owned subsidiary of IBM. These
 32  * materials are provided under terms of a License Agreement between Taligent
 33  * and Sun. This technology is protected by multiple US and International
 34  * patents. This notice and attribution to Taligent may not be removed.
 35  *   Taligent is a registered trademark of Taligent, Inc.
 36  *
 37  */
 38 
 39 package java.util;
 40 
 41 import java.io.Serializable;
 42 import java.time.ZoneId;
 43 
 44 import jdk.internal.util.StaticProperty;
 45 import sun.security.action.GetPropertyAction;
 46 import sun.util.calendar.ZoneInfo;
 47 import sun.util.calendar.ZoneInfoFile;
 48 import sun.util.locale.provider.TimeZoneNameUtility;
 49 
 50 /**
<span class="line-modified"> 51  * &lt;code&gt;TimeZone&lt;/code&gt; represents a time zone offset, and also figures out daylight</span>
 52  * savings.
 53  *
 54  * &lt;p&gt;
<span class="line-modified"> 55  * Typically, you get a &lt;code&gt;TimeZone&lt;/code&gt; using &lt;code&gt;getDefault&lt;/code&gt;</span>
<span class="line-modified"> 56  * which creates a &lt;code&gt;TimeZone&lt;/code&gt; based on the time zone where the program</span>
<span class="line-modified"> 57  * is running. For example, for a program running in Japan, &lt;code&gt;getDefault&lt;/code&gt;</span>
<span class="line-modified"> 58  * creates a &lt;code&gt;TimeZone&lt;/code&gt; object based on Japanese Standard Time.</span>
 59  *
 60  * &lt;p&gt;
<span class="line-modified"> 61  * You can also get a &lt;code&gt;TimeZone&lt;/code&gt; using &lt;code&gt;getTimeZone&lt;/code&gt;</span>
 62  * along with a time zone ID. For instance, the time zone ID for the
 63  * U.S. Pacific Time zone is &quot;America/Los_Angeles&quot;. So, you can get a
<span class="line-modified"> 64  * U.S. Pacific Time &lt;code&gt;TimeZone&lt;/code&gt; object with:</span>
 65  * &lt;blockquote&gt;&lt;pre&gt;
 66  * TimeZone tz = TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;);
 67  * &lt;/pre&gt;&lt;/blockquote&gt;
<span class="line-modified"> 68  * You can use the &lt;code&gt;getAvailableIDs&lt;/code&gt; method to iterate through</span>
 69  * all the supported time zone IDs. You can then choose a
<span class="line-modified"> 70  * supported ID to get a &lt;code&gt;TimeZone&lt;/code&gt;.</span>
 71  * If the time zone you want is not represented by one of the
 72  * supported IDs, then a custom time zone ID can be specified to
 73  * produce a TimeZone. The syntax of a custom time zone ID is:
 74  *
 75  * &lt;blockquote&gt;&lt;pre&gt;
 76  * &lt;a id=&quot;CustomID&quot;&gt;&lt;i&gt;CustomID:&lt;/i&gt;&lt;/a&gt;
<span class="line-modified"> 77  *         &lt;code&gt;GMT&lt;/code&gt; &lt;i&gt;Sign&lt;/i&gt; &lt;i&gt;Hours&lt;/i&gt; &lt;code&gt;:&lt;/code&gt; &lt;i&gt;Minutes&lt;/i&gt;</span>
<span class="line-modified"> 78  *         &lt;code&gt;GMT&lt;/code&gt; &lt;i&gt;Sign&lt;/i&gt; &lt;i&gt;Hours&lt;/i&gt; &lt;i&gt;Minutes&lt;/i&gt;</span>
<span class="line-modified"> 79  *         &lt;code&gt;GMT&lt;/code&gt; &lt;i&gt;Sign&lt;/i&gt; &lt;i&gt;Hours&lt;/i&gt;</span>
 80  * &lt;i&gt;Sign:&lt;/i&gt; one of
<span class="line-modified"> 81  *         &lt;code&gt;+ -&lt;/code&gt;</span>
 82  * &lt;i&gt;Hours:&lt;/i&gt;
 83  *         &lt;i&gt;Digit&lt;/i&gt;
 84  *         &lt;i&gt;Digit&lt;/i&gt; &lt;i&gt;Digit&lt;/i&gt;
 85  * &lt;i&gt;Minutes:&lt;/i&gt;
 86  *         &lt;i&gt;Digit&lt;/i&gt; &lt;i&gt;Digit&lt;/i&gt;
 87  * &lt;i&gt;Digit:&lt;/i&gt; one of
<span class="line-modified"> 88  *         &lt;code&gt;0 1 2 3 4 5 6 7 8 9&lt;/code&gt;</span>
 89  * &lt;/pre&gt;&lt;/blockquote&gt;
 90  *
 91  * &lt;i&gt;Hours&lt;/i&gt; must be between 0 to 23 and &lt;i&gt;Minutes&lt;/i&gt; must be
 92  * between 00 to 59.  For example, &quot;GMT+10&quot; and &quot;GMT+0010&quot; mean ten
 93  * hours and ten minutes ahead of GMT, respectively.
 94  * &lt;p&gt;
 95  * The format is locale independent and digits must be taken from the
 96  * Basic Latin block of the Unicode standard. No daylight saving time
 97  * transition schedule can be specified with a custom time zone ID. If
<span class="line-modified"> 98  * the specified string doesn&#39;t match the syntax, &lt;code&gt;&quot;GMT&quot;&lt;/code&gt;</span>
 99  * is used.
100  * &lt;p&gt;
<span class="line-modified">101  * When creating a &lt;code&gt;TimeZone&lt;/code&gt;, the specified custom time</span>
102  * zone ID is normalized in the following syntax:
103  * &lt;blockquote&gt;&lt;pre&gt;
104  * &lt;a id=&quot;NormalizedCustomID&quot;&gt;&lt;i&gt;NormalizedCustomID:&lt;/i&gt;&lt;/a&gt;
<span class="line-modified">105  *         &lt;code&gt;GMT&lt;/code&gt; &lt;i&gt;Sign&lt;/i&gt; &lt;i&gt;TwoDigitHours&lt;/i&gt; &lt;code&gt;:&lt;/code&gt; &lt;i&gt;Minutes&lt;/i&gt;</span>
106  * &lt;i&gt;Sign:&lt;/i&gt; one of
<span class="line-modified">107  *         &lt;code&gt;+ -&lt;/code&gt;</span>
108  * &lt;i&gt;TwoDigitHours:&lt;/i&gt;
109  *         &lt;i&gt;Digit&lt;/i&gt; &lt;i&gt;Digit&lt;/i&gt;
110  * &lt;i&gt;Minutes:&lt;/i&gt;
111  *         &lt;i&gt;Digit&lt;/i&gt; &lt;i&gt;Digit&lt;/i&gt;
112  * &lt;i&gt;Digit:&lt;/i&gt; one of
<span class="line-modified">113  *         &lt;code&gt;0 1 2 3 4 5 6 7 8 9&lt;/code&gt;</span>
114  * &lt;/pre&gt;&lt;/blockquote&gt;
115  * For example, TimeZone.getTimeZone(&quot;GMT-8&quot;).getID() returns &quot;GMT-08:00&quot;.
116  *
<span class="line-modified">117  * &lt;h3&gt;Three-letter time zone IDs&lt;/h3&gt;</span>
118  *
119  * For compatibility with JDK 1.1.x, some other three-letter time zone IDs
120  * (such as &quot;PST&quot;, &quot;CTT&quot;, &quot;AST&quot;) are also supported. However, &lt;strong&gt;their
121  * use is deprecated&lt;/strong&gt; because the same abbreviation is often used
122  * for multiple time zones (for example, &quot;CST&quot; could be U.S. &quot;Central Standard
123  * Time&quot; and &quot;China Standard Time&quot;), and the Java platform can then only
124  * recognize one of them.
125  *
126  *
127  * @see          Calendar
128  * @see          GregorianCalendar
129  * @see          SimpleTimeZone
130  * @author       Mark Davis, David Goldsmith, Chen-Lieh Huang, Alan Liu
131  * @since        1.1
132  */
133 public abstract class TimeZone implements Serializable, Cloneable {
134     /**
135      * Sole constructor.  (For invocation by subclass constructors, typically
136      * implicit.)
137      */
138     public TimeZone() {
139     }
140 
141     /**
<span class="line-modified">142      * A style specifier for &lt;code&gt;getDisplayName()&lt;/code&gt; indicating</span>
143      * a short name, such as &quot;PST.&quot;
144      * @see #LONG
145      * @since 1.2
146      */
147     public static final int SHORT = 0;
148 
149     /**
<span class="line-modified">150      * A style specifier for &lt;code&gt;getDisplayName()&lt;/code&gt; indicating</span>
151      * a long name, such as &quot;Pacific Standard Time.&quot;
152      * @see #SHORT
153      * @since 1.2
154      */
155     public static final int LONG  = 1;
156 
157     // Constants used internally; unit is milliseconds
158     private static final int ONE_MINUTE = 60*1000;
159     private static final int ONE_HOUR   = 60*ONE_MINUTE;
160     private static final int ONE_DAY    = 24*ONE_HOUR;
161 
162     // Proclaim serialization compatibility with JDK 1.1

163     static final long serialVersionUID = 3581463369166924961L;
164 
165     /**
166      * Gets the time zone offset, for current date, modified in case of
167      * daylight savings. This is the offset to add to UTC to get local time.
168      * &lt;p&gt;
169      * This method returns a historically correct offset if an
<span class="line-modified">170      * underlying &lt;code&gt;TimeZone&lt;/code&gt; implementation subclass</span>
171      * supports historical Daylight Saving Time schedule and GMT
172      * offset changes.
173      *
174      * @param era the era of the given date.
175      * @param year the year in the given date.
176      * @param month the month in the given date.
177      * Month is 0-based. e.g., 0 for January.
178      * @param day the day-in-month of the given date.
179      * @param dayOfWeek the day-of-week of the given date.
180      * @param milliseconds the milliseconds in day in &lt;em&gt;standard&lt;/em&gt;
181      * local time.
182      *
183      * @return the offset in milliseconds to add to GMT to get local time.
184      *
185      * @see Calendar#ZONE_OFFSET
186      * @see Calendar#DST_OFFSET
187      */
188     public abstract int getOffset(int era, int year, int month, int day,
189                                   int dayOfWeek, int milliseconds);
190 
</pre>
<hr />
<pre>
228      * @see Calendar#ZONE_OFFSET
229      * @see Calendar#DST_OFFSET
230      */
231     int getOffsets(long date, int[] offsets) {
232         int rawoffset = getRawOffset();
233         int dstoffset = 0;
234         if (inDaylightTime(new Date(date))) {
235             dstoffset = getDSTSavings();
236         }
237         if (offsets != null) {
238             offsets[0] = rawoffset;
239             offsets[1] = dstoffset;
240         }
241         return rawoffset + dstoffset;
242     }
243 
244     /**
245      * Sets the base time zone offset to GMT.
246      * This is the offset to add to UTC to get local time.
247      * &lt;p&gt;
<span class="line-modified">248      * If an underlying &lt;code&gt;TimeZone&lt;/code&gt; implementation subclass</span>
249      * supports historical GMT offset changes, the specified GMT
250      * offset is set as the latest GMT offset and the difference from
251      * the known latest GMT offset value is used to adjust all
252      * historical GMT offset values.
253      *
254      * @param offsetMillis the given base time zone offset to GMT.
255      */
256     public abstract void setRawOffset(int offsetMillis);
257 
258     /**
259      * Returns the amount of time in milliseconds to add to UTC to get
260      * standard time in this time zone. Because this value is not
261      * affected by daylight saving time, it is called &lt;I&gt;raw
262      * offset&lt;/I&gt;.
263      * &lt;p&gt;
<span class="line-modified">264      * If an underlying &lt;code&gt;TimeZone&lt;/code&gt; implementation subclass</span>
265      * supports historical GMT offset changes, the method returns the
266      * raw offset value of the current date. In Honolulu, for example,
267      * its raw offset changed from GMT-10:30 to GMT-10:00 in 1947, and
268      * this method always returns -36000000 milliseconds (i.e., -10
269      * hours).
270      *
271      * @return the amount of raw offset time in milliseconds to add to UTC.
272      * @see Calendar#ZONE_OFFSET
273      */
274     public abstract int getRawOffset();
275 
276     /**
277      * Gets the ID of this time zone.
278      * @return the ID of this time zone.
279      */
280     public String getID()
281     {
282         return ID;
283     }
284 
</pre>
<hr />
<pre>
311      * @see #getDisplayName(boolean, int, Locale)
312      * @see Locale#getDefault(Locale.Category)
313      * @see Locale.Category
314      */
315     public final String getDisplayName() {
316         return getDisplayName(false, LONG,
317                               Locale.getDefault(Locale.Category.DISPLAY));
318     }
319 
320     /**
321      * Returns a long standard time name of this {@code TimeZone} suitable for
322      * presentation to the user in the specified {@code locale}.
323      *
324      * &lt;p&gt;This method is equivalent to:
325      * &lt;blockquote&gt;&lt;pre&gt;
326      * getDisplayName(false, {@link #LONG}, locale)
327      * &lt;/pre&gt;&lt;/blockquote&gt;
328      *
329      * @param locale the locale in which to supply the display name.
330      * @return the human-readable name of this time zone in the given locale.
<span class="line-modified">331      * @exception NullPointerException if {@code locale} is {@code null}.</span>
332      * @since 1.2
333      * @see #getDisplayName(boolean, int, Locale)
334      */
335     public final String getDisplayName(Locale locale) {
336         return getDisplayName(false, LONG, locale);
337     }
338 
339     /**
340      * Returns a name in the specified {@code style} of this {@code TimeZone}
341      * suitable for presentation to the user in the default locale. If the
342      * specified {@code daylight} is {@code true}, a Daylight Saving Time name
343      * is returned (even if this {@code TimeZone} doesn&#39;t observe Daylight Saving
344      * Time). Otherwise, a Standard Time name is returned.
345      *
346      * &lt;p&gt;This method is equivalent to:
347      * &lt;blockquote&gt;&lt;pre&gt;
348      * getDisplayName(daylight, style,
349      *                Locale.getDefault({@link Locale.Category#DISPLAY}))
350      * &lt;/pre&gt;&lt;/blockquote&gt;
351      *
352      * @param daylight {@code true} specifying a Daylight Saving Time name, or
353      *                 {@code false} specifying a Standard Time name
354      * @param style either {@link #LONG} or {@link #SHORT}
355      * @return the human-readable name of this time zone in the default locale.
<span class="line-modified">356      * @exception IllegalArgumentException if {@code style} is invalid.</span>
357      * @since 1.2
358      * @see #getDisplayName(boolean, int, Locale)
359      * @see Locale#getDefault(Locale.Category)
360      * @see Locale.Category
361      * @see java.text.DateFormatSymbols#getZoneStrings()
362      */
363     public final String getDisplayName(boolean daylight, int style) {
364         return getDisplayName(daylight, style,
365                               Locale.getDefault(Locale.Category.DISPLAY));
366     }
367 
368     /**
369      * Returns a name in the specified {@code style} of this {@code TimeZone}
370      * suitable for presentation to the user in the specified {@code
371      * locale}. If the specified {@code daylight} is {@code true}, a Daylight
372      * Saving Time name is returned (even if this {@code TimeZone} doesn&#39;t
373      * observe Daylight Saving Time). Otherwise, a Standard Time name is
374      * returned.
375      *
376      * &lt;p&gt;When looking up a time zone name, the {@linkplain
377      * ResourceBundle.Control#getCandidateLocales(String,Locale) default
<span class="line-modified">378      * &lt;code&gt;Locale&lt;/code&gt; search path of &lt;code&gt;ResourceBundle&lt;/code&gt;} derived</span>
379      * from the specified {@code locale} is used. (No {@linkplain
380      * ResourceBundle.Control#getFallbackLocale(String,Locale) fallback
<span class="line-modified">381      * &lt;code&gt;Locale&lt;/code&gt;} search is performed.) If a time zone name in any</span>
382      * {@code Locale} of the search path, including {@link Locale#ROOT}, is
383      * found, the name is returned. Otherwise, a string in the
384      * &lt;a href=&quot;#NormalizedCustomID&quot;&gt;normalized custom ID format&lt;/a&gt; is returned.
385      *
386      * @param daylight {@code true} specifying a Daylight Saving Time name, or
387      *                 {@code false} specifying a Standard Time name
388      * @param style either {@link #LONG} or {@link #SHORT}
389      * @param locale   the locale in which to supply the display name.
390      * @return the human-readable name of this time zone in the given locale.
<span class="line-modified">391      * @exception IllegalArgumentException if {@code style} is invalid.</span>
<span class="line-modified">392      * @exception NullPointerException if {@code locale} is {@code null}.</span>
393      * @since 1.2
394      * @see java.text.DateFormatSymbols#getZoneStrings()
395      */
396     public String getDisplayName(boolean daylight, int style, Locale locale) {
397         if (style != SHORT &amp;&amp; style != LONG) {
398             throw new IllegalArgumentException(&quot;Illegal style: &quot; + style);
399         }
400         String id = getID();
401         String name = TimeZoneNameUtility.retrieveDisplayName(id, daylight, style, locale);
402         if (name != null) {
403             return name;
404         }
405 
406         if (id.startsWith(&quot;GMT&quot;) &amp;&amp; id.length() &gt; 3) {
407             char sign = id.charAt(3);
408             if (sign == &#39;+&#39; || sign == &#39;-&#39;) {
409                 return id;
410             }
411         }
412         int offset = getRawOffset();
</pre>
<hr />
<pre>
486      * @since 1.7
487      * @see #useDaylightTime()
488      * @see #inDaylightTime(Date)
489      * @see Calendar#DST_OFFSET
490      */
491     public boolean observesDaylightTime() {
492         return useDaylightTime() || inDaylightTime(new Date());
493     }
494 
495     /**
496      * Queries if the given {@code date} is in Daylight Saving Time in
497      * this time zone.
498      *
499      * @param date the given Date.
500      * @return {@code true} if the given date is in Daylight Saving Time,
501      *         {@code false}, otherwise.
502      */
503     public abstract boolean inDaylightTime(Date date);
504 
505     /**
<span class="line-modified">506      * Gets the &lt;code&gt;TimeZone&lt;/code&gt; for the given ID.</span>
507      *
<span class="line-modified">508      * @param ID the ID for a &lt;code&gt;TimeZone&lt;/code&gt;, either an abbreviation</span>
509      * such as &quot;PST&quot;, a full name such as &quot;America/Los_Angeles&quot;, or a custom
510      * ID such as &quot;GMT-8:00&quot;. Note that the support of abbreviations is
511      * for JDK 1.1.x compatibility only and full names should be used.
512      *
<span class="line-modified">513      * @return the specified &lt;code&gt;TimeZone&lt;/code&gt;, or the GMT zone if the given ID</span>
514      * cannot be understood.
515      */
516     public static synchronized TimeZone getTimeZone(String ID) {
517         return getTimeZone(ID, true);
518     }
519 
520     /**
521      * Gets the {@code TimeZone} for the given {@code zoneId}.
522      *
523      * @param zoneId a {@link ZoneId} from which the time zone ID is obtained
524      * @return the specified {@code TimeZone}, or the GMT zone if the given ID
525      *         cannot be understood.
526      * @throws NullPointerException if {@code zoneId} is {@code null}
527      * @since 1.8
528      */
529     public static TimeZone getTimeZone(ZoneId zoneId) {
530         String tzid = zoneId.getId(); // throws an NPE if null
531         char c = tzid.charAt(0);
532         if (c == &#39;+&#39; || c == &#39;-&#39;) {
533             tzid = &quot;GMT&quot; + tzid;
</pre>
<hr />
<pre>
715      */
716     public static void setDefault(TimeZone zone)
717     {
718         SecurityManager sm = System.getSecurityManager();
719         if (sm != null) {
720             sm.checkPermission(new PropertyPermission
721                                (&quot;user.timezone&quot;, &quot;write&quot;));
722         }
723         // by saving a defensive clone and returning a clone in getDefault() too,
724         // the defaultTimeZone instance is isolated from user code which makes it
725         // effectively immutable. This is important to avoid races when the
726         // following is evaluated in ZoneId.systemDefault():
727         // TimeZone.getDefault().toZoneId().
728         defaultTimeZone = (zone == null) ? null : (TimeZone) zone.clone();
729     }
730 
731     /**
732      * Returns true if this zone has the same rule and offset as another zone.
733      * That is, if this zone differs only in ID, if at all.  Returns false
734      * if the other zone is null.
<span class="line-modified">735      * @param other the &lt;code&gt;TimeZone&lt;/code&gt; object to be compared with</span>
736      * @return true if the other zone is not null and is the same as this one,
737      * with the possible exception of the ID
738      * @since 1.2
739      */
740     public boolean hasSameRules(TimeZone other) {
741         return other != null &amp;&amp; getRawOffset() == other.getRawOffset() &amp;&amp;
742             useDaylightTime() == other.useDaylightTime();
743     }
744 
745     /**
<span class="line-modified">746      * Creates a copy of this &lt;code&gt;TimeZone&lt;/code&gt;.</span>
747      *
<span class="line-modified">748      * @return a clone of this &lt;code&gt;TimeZone&lt;/code&gt;</span>
749      */
750     public Object clone()
751     {
752         try {
753             return super.clone();
754         } catch (CloneNotSupportedException e) {
755             throw new InternalError(e);
756         }
757     }
758 
759     /**
760      * The null constant as a TimeZone.
761      */
762     static final TimeZone NO_TIMEZONE = null;
763 
764     // =======================privates===============================
765 
766     /**
<span class="line-modified">767      * The string identifier of this &lt;code&gt;TimeZone&lt;/code&gt;.  This is a</span>
<span class="line-modified">768      * programmatic identifier used internally to look up &lt;code&gt;TimeZone&lt;/code&gt;</span>
769      * objects from the system table and also to map them to their localized
<span class="line-modified">770      * display names.  &lt;code&gt;ID&lt;/code&gt; values are unique in the system</span>
771      * table but may not be for dynamically created zones.
772      * @serial
773      */
774     private String           ID;
775 
776     /**
777      * Cached {@link ZoneId} for this TimeZone
778      */
779     private transient ZoneId zoneId;
780 
781     private static volatile TimeZone defaultTimeZone;
782 
783     static final String         GMT_ID        = &quot;GMT&quot;;
784     private static final int    GMT_ID_LENGTH = 3;
785 
786     /**
787      * Parses a custom time zone identifier and returns a corresponding zone.
788      * This method doesn&#39;t support the RFC 822 time zone format. (e.g., +hhmm)
789      *
790      * @param id a string of the &lt;a href=&quot;#CustomID&quot;&gt;custom ID form&lt;/a&gt;.
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1996, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 31  * and owned by Taligent, Inc., a wholly-owned subsidiary of IBM. These
 32  * materials are provided under terms of a License Agreement between Taligent
 33  * and Sun. This technology is protected by multiple US and International
 34  * patents. This notice and attribution to Taligent may not be removed.
 35  *   Taligent is a registered trademark of Taligent, Inc.
 36  *
 37  */
 38 
 39 package java.util;
 40 
 41 import java.io.Serializable;
 42 import java.time.ZoneId;
 43 
 44 import jdk.internal.util.StaticProperty;
 45 import sun.security.action.GetPropertyAction;
 46 import sun.util.calendar.ZoneInfo;
 47 import sun.util.calendar.ZoneInfoFile;
 48 import sun.util.locale.provider.TimeZoneNameUtility;
 49 
 50 /**
<span class="line-modified"> 51  * {@code TimeZone} represents a time zone offset, and also figures out daylight</span>
 52  * savings.
 53  *
 54  * &lt;p&gt;
<span class="line-modified"> 55  * Typically, you get a {@code TimeZone} using {@code getDefault}</span>
<span class="line-modified"> 56  * which creates a {@code TimeZone} based on the time zone where the program</span>
<span class="line-modified"> 57  * is running. For example, for a program running in Japan, {@code getDefault}</span>
<span class="line-modified"> 58  * creates a {@code TimeZone} object based on Japanese Standard Time.</span>
 59  *
 60  * &lt;p&gt;
<span class="line-modified"> 61  * You can also get a {@code TimeZone} using {@code getTimeZone}</span>
 62  * along with a time zone ID. For instance, the time zone ID for the
 63  * U.S. Pacific Time zone is &quot;America/Los_Angeles&quot;. So, you can get a
<span class="line-modified"> 64  * U.S. Pacific Time {@code TimeZone} object with:</span>
 65  * &lt;blockquote&gt;&lt;pre&gt;
 66  * TimeZone tz = TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;);
 67  * &lt;/pre&gt;&lt;/blockquote&gt;
<span class="line-modified"> 68  * You can use the {@code getAvailableIDs} method to iterate through</span>
 69  * all the supported time zone IDs. You can then choose a
<span class="line-modified"> 70  * supported ID to get a {@code TimeZone}.</span>
 71  * If the time zone you want is not represented by one of the
 72  * supported IDs, then a custom time zone ID can be specified to
 73  * produce a TimeZone. The syntax of a custom time zone ID is:
 74  *
 75  * &lt;blockquote&gt;&lt;pre&gt;
 76  * &lt;a id=&quot;CustomID&quot;&gt;&lt;i&gt;CustomID:&lt;/i&gt;&lt;/a&gt;
<span class="line-modified"> 77  *         {@code GMT} &lt;i&gt;Sign&lt;/i&gt; &lt;i&gt;Hours&lt;/i&gt; {@code :} &lt;i&gt;Minutes&lt;/i&gt;</span>
<span class="line-modified"> 78  *         {@code GMT} &lt;i&gt;Sign&lt;/i&gt; &lt;i&gt;Hours&lt;/i&gt; &lt;i&gt;Minutes&lt;/i&gt;</span>
<span class="line-modified"> 79  *         {@code GMT} &lt;i&gt;Sign&lt;/i&gt; &lt;i&gt;Hours&lt;/i&gt;</span>
 80  * &lt;i&gt;Sign:&lt;/i&gt; one of
<span class="line-modified"> 81  *         {@code + -}</span>
 82  * &lt;i&gt;Hours:&lt;/i&gt;
 83  *         &lt;i&gt;Digit&lt;/i&gt;
 84  *         &lt;i&gt;Digit&lt;/i&gt; &lt;i&gt;Digit&lt;/i&gt;
 85  * &lt;i&gt;Minutes:&lt;/i&gt;
 86  *         &lt;i&gt;Digit&lt;/i&gt; &lt;i&gt;Digit&lt;/i&gt;
 87  * &lt;i&gt;Digit:&lt;/i&gt; one of
<span class="line-modified"> 88  *         {@code 0 1 2 3 4 5 6 7 8 9}</span>
 89  * &lt;/pre&gt;&lt;/blockquote&gt;
 90  *
 91  * &lt;i&gt;Hours&lt;/i&gt; must be between 0 to 23 and &lt;i&gt;Minutes&lt;/i&gt; must be
 92  * between 00 to 59.  For example, &quot;GMT+10&quot; and &quot;GMT+0010&quot; mean ten
 93  * hours and ten minutes ahead of GMT, respectively.
 94  * &lt;p&gt;
 95  * The format is locale independent and digits must be taken from the
 96  * Basic Latin block of the Unicode standard. No daylight saving time
 97  * transition schedule can be specified with a custom time zone ID. If
<span class="line-modified"> 98  * the specified string doesn&#39;t match the syntax, {@code &quot;GMT&quot;}</span>
 99  * is used.
100  * &lt;p&gt;
<span class="line-modified">101  * When creating a {@code TimeZone}, the specified custom time</span>
102  * zone ID is normalized in the following syntax:
103  * &lt;blockquote&gt;&lt;pre&gt;
104  * &lt;a id=&quot;NormalizedCustomID&quot;&gt;&lt;i&gt;NormalizedCustomID:&lt;/i&gt;&lt;/a&gt;
<span class="line-modified">105  *         {@code GMT} &lt;i&gt;Sign&lt;/i&gt; &lt;i&gt;TwoDigitHours&lt;/i&gt; {@code :} &lt;i&gt;Minutes&lt;/i&gt;</span>
106  * &lt;i&gt;Sign:&lt;/i&gt; one of
<span class="line-modified">107  *         {@code + -}</span>
108  * &lt;i&gt;TwoDigitHours:&lt;/i&gt;
109  *         &lt;i&gt;Digit&lt;/i&gt; &lt;i&gt;Digit&lt;/i&gt;
110  * &lt;i&gt;Minutes:&lt;/i&gt;
111  *         &lt;i&gt;Digit&lt;/i&gt; &lt;i&gt;Digit&lt;/i&gt;
112  * &lt;i&gt;Digit:&lt;/i&gt; one of
<span class="line-modified">113  *         {@code 0 1 2 3 4 5 6 7 8 9}</span>
114  * &lt;/pre&gt;&lt;/blockquote&gt;
115  * For example, TimeZone.getTimeZone(&quot;GMT-8&quot;).getID() returns &quot;GMT-08:00&quot;.
116  *
<span class="line-modified">117  * &lt;h2&gt;Three-letter time zone IDs&lt;/h2&gt;</span>
118  *
119  * For compatibility with JDK 1.1.x, some other three-letter time zone IDs
120  * (such as &quot;PST&quot;, &quot;CTT&quot;, &quot;AST&quot;) are also supported. However, &lt;strong&gt;their
121  * use is deprecated&lt;/strong&gt; because the same abbreviation is often used
122  * for multiple time zones (for example, &quot;CST&quot; could be U.S. &quot;Central Standard
123  * Time&quot; and &quot;China Standard Time&quot;), and the Java platform can then only
124  * recognize one of them.
125  *
126  *
127  * @see          Calendar
128  * @see          GregorianCalendar
129  * @see          SimpleTimeZone
130  * @author       Mark Davis, David Goldsmith, Chen-Lieh Huang, Alan Liu
131  * @since        1.1
132  */
133 public abstract class TimeZone implements Serializable, Cloneable {
134     /**
135      * Sole constructor.  (For invocation by subclass constructors, typically
136      * implicit.)
137      */
138     public TimeZone() {
139     }
140 
141     /**
<span class="line-modified">142      * A style specifier for {@code getDisplayName()} indicating</span>
143      * a short name, such as &quot;PST.&quot;
144      * @see #LONG
145      * @since 1.2
146      */
147     public static final int SHORT = 0;
148 
149     /**
<span class="line-modified">150      * A style specifier for {@code getDisplayName()} indicating</span>
151      * a long name, such as &quot;Pacific Standard Time.&quot;
152      * @see #SHORT
153      * @since 1.2
154      */
155     public static final int LONG  = 1;
156 
157     // Constants used internally; unit is milliseconds
158     private static final int ONE_MINUTE = 60*1000;
159     private static final int ONE_HOUR   = 60*ONE_MINUTE;
160     private static final int ONE_DAY    = 24*ONE_HOUR;
161 
162     // Proclaim serialization compatibility with JDK 1.1
<span class="line-added">163     @java.io.Serial</span>
164     static final long serialVersionUID = 3581463369166924961L;
165 
166     /**
167      * Gets the time zone offset, for current date, modified in case of
168      * daylight savings. This is the offset to add to UTC to get local time.
169      * &lt;p&gt;
170      * This method returns a historically correct offset if an
<span class="line-modified">171      * underlying {@code TimeZone} implementation subclass</span>
172      * supports historical Daylight Saving Time schedule and GMT
173      * offset changes.
174      *
175      * @param era the era of the given date.
176      * @param year the year in the given date.
177      * @param month the month in the given date.
178      * Month is 0-based. e.g., 0 for January.
179      * @param day the day-in-month of the given date.
180      * @param dayOfWeek the day-of-week of the given date.
181      * @param milliseconds the milliseconds in day in &lt;em&gt;standard&lt;/em&gt;
182      * local time.
183      *
184      * @return the offset in milliseconds to add to GMT to get local time.
185      *
186      * @see Calendar#ZONE_OFFSET
187      * @see Calendar#DST_OFFSET
188      */
189     public abstract int getOffset(int era, int year, int month, int day,
190                                   int dayOfWeek, int milliseconds);
191 
</pre>
<hr />
<pre>
229      * @see Calendar#ZONE_OFFSET
230      * @see Calendar#DST_OFFSET
231      */
232     int getOffsets(long date, int[] offsets) {
233         int rawoffset = getRawOffset();
234         int dstoffset = 0;
235         if (inDaylightTime(new Date(date))) {
236             dstoffset = getDSTSavings();
237         }
238         if (offsets != null) {
239             offsets[0] = rawoffset;
240             offsets[1] = dstoffset;
241         }
242         return rawoffset + dstoffset;
243     }
244 
245     /**
246      * Sets the base time zone offset to GMT.
247      * This is the offset to add to UTC to get local time.
248      * &lt;p&gt;
<span class="line-modified">249      * If an underlying {@code TimeZone} implementation subclass</span>
250      * supports historical GMT offset changes, the specified GMT
251      * offset is set as the latest GMT offset and the difference from
252      * the known latest GMT offset value is used to adjust all
253      * historical GMT offset values.
254      *
255      * @param offsetMillis the given base time zone offset to GMT.
256      */
257     public abstract void setRawOffset(int offsetMillis);
258 
259     /**
260      * Returns the amount of time in milliseconds to add to UTC to get
261      * standard time in this time zone. Because this value is not
262      * affected by daylight saving time, it is called &lt;I&gt;raw
263      * offset&lt;/I&gt;.
264      * &lt;p&gt;
<span class="line-modified">265      * If an underlying {@code TimeZone} implementation subclass</span>
266      * supports historical GMT offset changes, the method returns the
267      * raw offset value of the current date. In Honolulu, for example,
268      * its raw offset changed from GMT-10:30 to GMT-10:00 in 1947, and
269      * this method always returns -36000000 milliseconds (i.e., -10
270      * hours).
271      *
272      * @return the amount of raw offset time in milliseconds to add to UTC.
273      * @see Calendar#ZONE_OFFSET
274      */
275     public abstract int getRawOffset();
276 
277     /**
278      * Gets the ID of this time zone.
279      * @return the ID of this time zone.
280      */
281     public String getID()
282     {
283         return ID;
284     }
285 
</pre>
<hr />
<pre>
312      * @see #getDisplayName(boolean, int, Locale)
313      * @see Locale#getDefault(Locale.Category)
314      * @see Locale.Category
315      */
316     public final String getDisplayName() {
317         return getDisplayName(false, LONG,
318                               Locale.getDefault(Locale.Category.DISPLAY));
319     }
320 
321     /**
322      * Returns a long standard time name of this {@code TimeZone} suitable for
323      * presentation to the user in the specified {@code locale}.
324      *
325      * &lt;p&gt;This method is equivalent to:
326      * &lt;blockquote&gt;&lt;pre&gt;
327      * getDisplayName(false, {@link #LONG}, locale)
328      * &lt;/pre&gt;&lt;/blockquote&gt;
329      *
330      * @param locale the locale in which to supply the display name.
331      * @return the human-readable name of this time zone in the given locale.
<span class="line-modified">332      * @throws    NullPointerException if {@code locale} is {@code null}.</span>
333      * @since 1.2
334      * @see #getDisplayName(boolean, int, Locale)
335      */
336     public final String getDisplayName(Locale locale) {
337         return getDisplayName(false, LONG, locale);
338     }
339 
340     /**
341      * Returns a name in the specified {@code style} of this {@code TimeZone}
342      * suitable for presentation to the user in the default locale. If the
343      * specified {@code daylight} is {@code true}, a Daylight Saving Time name
344      * is returned (even if this {@code TimeZone} doesn&#39;t observe Daylight Saving
345      * Time). Otherwise, a Standard Time name is returned.
346      *
347      * &lt;p&gt;This method is equivalent to:
348      * &lt;blockquote&gt;&lt;pre&gt;
349      * getDisplayName(daylight, style,
350      *                Locale.getDefault({@link Locale.Category#DISPLAY}))
351      * &lt;/pre&gt;&lt;/blockquote&gt;
352      *
353      * @param daylight {@code true} specifying a Daylight Saving Time name, or
354      *                 {@code false} specifying a Standard Time name
355      * @param style either {@link #LONG} or {@link #SHORT}
356      * @return the human-readable name of this time zone in the default locale.
<span class="line-modified">357      * @throws    IllegalArgumentException if {@code style} is invalid.</span>
358      * @since 1.2
359      * @see #getDisplayName(boolean, int, Locale)
360      * @see Locale#getDefault(Locale.Category)
361      * @see Locale.Category
362      * @see java.text.DateFormatSymbols#getZoneStrings()
363      */
364     public final String getDisplayName(boolean daylight, int style) {
365         return getDisplayName(daylight, style,
366                               Locale.getDefault(Locale.Category.DISPLAY));
367     }
368 
369     /**
370      * Returns a name in the specified {@code style} of this {@code TimeZone}
371      * suitable for presentation to the user in the specified {@code
372      * locale}. If the specified {@code daylight} is {@code true}, a Daylight
373      * Saving Time name is returned (even if this {@code TimeZone} doesn&#39;t
374      * observe Daylight Saving Time). Otherwise, a Standard Time name is
375      * returned.
376      *
377      * &lt;p&gt;When looking up a time zone name, the {@linkplain
378      * ResourceBundle.Control#getCandidateLocales(String,Locale) default
<span class="line-modified">379      * {@code Locale} search path of {@code ResourceBundle}} derived</span>
380      * from the specified {@code locale} is used. (No {@linkplain
381      * ResourceBundle.Control#getFallbackLocale(String,Locale) fallback
<span class="line-modified">382      * {@code Locale}} search is performed.) If a time zone name in any</span>
383      * {@code Locale} of the search path, including {@link Locale#ROOT}, is
384      * found, the name is returned. Otherwise, a string in the
385      * &lt;a href=&quot;#NormalizedCustomID&quot;&gt;normalized custom ID format&lt;/a&gt; is returned.
386      *
387      * @param daylight {@code true} specifying a Daylight Saving Time name, or
388      *                 {@code false} specifying a Standard Time name
389      * @param style either {@link #LONG} or {@link #SHORT}
390      * @param locale   the locale in which to supply the display name.
391      * @return the human-readable name of this time zone in the given locale.
<span class="line-modified">392      * @throws    IllegalArgumentException if {@code style} is invalid.</span>
<span class="line-modified">393      * @throws    NullPointerException if {@code locale} is {@code null}.</span>
394      * @since 1.2
395      * @see java.text.DateFormatSymbols#getZoneStrings()
396      */
397     public String getDisplayName(boolean daylight, int style, Locale locale) {
398         if (style != SHORT &amp;&amp; style != LONG) {
399             throw new IllegalArgumentException(&quot;Illegal style: &quot; + style);
400         }
401         String id = getID();
402         String name = TimeZoneNameUtility.retrieveDisplayName(id, daylight, style, locale);
403         if (name != null) {
404             return name;
405         }
406 
407         if (id.startsWith(&quot;GMT&quot;) &amp;&amp; id.length() &gt; 3) {
408             char sign = id.charAt(3);
409             if (sign == &#39;+&#39; || sign == &#39;-&#39;) {
410                 return id;
411             }
412         }
413         int offset = getRawOffset();
</pre>
<hr />
<pre>
487      * @since 1.7
488      * @see #useDaylightTime()
489      * @see #inDaylightTime(Date)
490      * @see Calendar#DST_OFFSET
491      */
492     public boolean observesDaylightTime() {
493         return useDaylightTime() || inDaylightTime(new Date());
494     }
495 
496     /**
497      * Queries if the given {@code date} is in Daylight Saving Time in
498      * this time zone.
499      *
500      * @param date the given Date.
501      * @return {@code true} if the given date is in Daylight Saving Time,
502      *         {@code false}, otherwise.
503      */
504     public abstract boolean inDaylightTime(Date date);
505 
506     /**
<span class="line-modified">507      * Gets the {@code TimeZone} for the given ID.</span>
508      *
<span class="line-modified">509      * @param ID the ID for a {@code TimeZone}, either an abbreviation</span>
510      * such as &quot;PST&quot;, a full name such as &quot;America/Los_Angeles&quot;, or a custom
511      * ID such as &quot;GMT-8:00&quot;. Note that the support of abbreviations is
512      * for JDK 1.1.x compatibility only and full names should be used.
513      *
<span class="line-modified">514      * @return the specified {@code TimeZone}, or the GMT zone if the given ID</span>
515      * cannot be understood.
516      */
517     public static synchronized TimeZone getTimeZone(String ID) {
518         return getTimeZone(ID, true);
519     }
520 
521     /**
522      * Gets the {@code TimeZone} for the given {@code zoneId}.
523      *
524      * @param zoneId a {@link ZoneId} from which the time zone ID is obtained
525      * @return the specified {@code TimeZone}, or the GMT zone if the given ID
526      *         cannot be understood.
527      * @throws NullPointerException if {@code zoneId} is {@code null}
528      * @since 1.8
529      */
530     public static TimeZone getTimeZone(ZoneId zoneId) {
531         String tzid = zoneId.getId(); // throws an NPE if null
532         char c = tzid.charAt(0);
533         if (c == &#39;+&#39; || c == &#39;-&#39;) {
534             tzid = &quot;GMT&quot; + tzid;
</pre>
<hr />
<pre>
716      */
717     public static void setDefault(TimeZone zone)
718     {
719         SecurityManager sm = System.getSecurityManager();
720         if (sm != null) {
721             sm.checkPermission(new PropertyPermission
722                                (&quot;user.timezone&quot;, &quot;write&quot;));
723         }
724         // by saving a defensive clone and returning a clone in getDefault() too,
725         // the defaultTimeZone instance is isolated from user code which makes it
726         // effectively immutable. This is important to avoid races when the
727         // following is evaluated in ZoneId.systemDefault():
728         // TimeZone.getDefault().toZoneId().
729         defaultTimeZone = (zone == null) ? null : (TimeZone) zone.clone();
730     }
731 
732     /**
733      * Returns true if this zone has the same rule and offset as another zone.
734      * That is, if this zone differs only in ID, if at all.  Returns false
735      * if the other zone is null.
<span class="line-modified">736      * @param other the {@code TimeZone} object to be compared with</span>
737      * @return true if the other zone is not null and is the same as this one,
738      * with the possible exception of the ID
739      * @since 1.2
740      */
741     public boolean hasSameRules(TimeZone other) {
742         return other != null &amp;&amp; getRawOffset() == other.getRawOffset() &amp;&amp;
743             useDaylightTime() == other.useDaylightTime();
744     }
745 
746     /**
<span class="line-modified">747      * Creates a copy of this {@code TimeZone}.</span>
748      *
<span class="line-modified">749      * @return a clone of this {@code TimeZone}</span>
750      */
751     public Object clone()
752     {
753         try {
754             return super.clone();
755         } catch (CloneNotSupportedException e) {
756             throw new InternalError(e);
757         }
758     }
759 
760     /**
761      * The null constant as a TimeZone.
762      */
763     static final TimeZone NO_TIMEZONE = null;
764 
765     // =======================privates===============================
766 
767     /**
<span class="line-modified">768      * The string identifier of this {@code TimeZone}.  This is a</span>
<span class="line-modified">769      * programmatic identifier used internally to look up {@code TimeZone}</span>
770      * objects from the system table and also to map them to their localized
<span class="line-modified">771      * display names.  {@code ID} values are unique in the system</span>
772      * table but may not be for dynamically created zones.
773      * @serial
774      */
775     private String           ID;
776 
777     /**
778      * Cached {@link ZoneId} for this TimeZone
779      */
780     private transient ZoneId zoneId;
781 
782     private static volatile TimeZone defaultTimeZone;
783 
784     static final String         GMT_ID        = &quot;GMT&quot;;
785     private static final int    GMT_ID_LENGTH = 3;
786 
787     /**
788      * Parses a custom time zone identifier and returns a corresponding zone.
789      * This method doesn&#39;t support the RFC 822 time zone format. (e.g., +hhmm)
790      *
791      * @param id a string of the &lt;a href=&quot;#CustomID&quot;&gt;custom ID form&lt;/a&gt;.
</pre>
</td>
</tr>
</table>
<center><a href="StringTokenizer.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="TooManyListenersException.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>