<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/util/zip/ZipInputStream.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ZipFile.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipOutputStream.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/zip/ZipInputStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1996, 2015, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1996, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 28,11 ***</span>
  import java.io.InputStream;
  import java.io.IOException;
  import java.io.EOFException;
  import java.io.PushbackInputStream;
  import java.nio.charset.Charset;
<span class="line-modified">! import java.nio.charset.StandardCharsets;</span>
  import static java.util.zip.ZipConstants64.*;
  import static java.util.zip.ZipUtils.*;
  
  /**
   * This class implements an input stream filter for reading files in the
<span class="line-new-header">--- 28,13 ---</span>
  import java.io.InputStream;
  import java.io.IOException;
  import java.io.EOFException;
  import java.io.PushbackInputStream;
  import java.nio.charset.Charset;
<span class="line-modified">! </span>
<span class="line-added">+ import sun.nio.cs.UTF_8;</span>
<span class="line-added">+ </span>
  import static java.util.zip.ZipConstants64.*;
  import static java.util.zip.ZipUtils.*;
  
  /**
   * This class implements an input stream filter for reading files in the
</pre>
<hr />
<pre>
<span class="line-old-header">*** 40,12 ***</span>
   * entries.
   *
   * @author      David Connelly
   * @since 1.1
   */
<span class="line-modified">! public</span>
<span class="line-removed">- class ZipInputStream extends InflaterInputStream implements ZipConstants {</span>
      private ZipEntry entry;
      private int flag;
      private CRC32 crc = new CRC32();
      private long remaining;
      private byte[] tmpbuf = new byte[512];
<span class="line-new-header">--- 42,11 ---</span>
   * entries.
   *
   * @author      David Connelly
   * @since 1.1
   */
<span class="line-modified">! public class ZipInputStream extends InflaterInputStream implements ZipConstants {</span>
      private ZipEntry entry;
      private int flag;
      private CRC32 crc = new CRC32();
      private long remaining;
      private byte[] tmpbuf = new byte[512];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 76,11 ***</span>
       * decode the entry names.
       *
       * @param in the actual input stream
       */
      public ZipInputStream(InputStream in) {
<span class="line-modified">!         this(in, StandardCharsets.UTF_8);</span>
      }
  
      /**
       * Creates a new ZIP input stream.
       *
<span class="line-new-header">--- 77,11 ---</span>
       * decode the entry names.
       *
       * @param in the actual input stream
       */
      public ZipInputStream(InputStream in) {
<span class="line-modified">!         this(in, UTF_8.INSTANCE);</span>
      }
  
      /**
       * Creates a new ZIP input stream.
       *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 108,12 ***</span>
  
      /**
       * Reads the next ZIP file entry and positions the stream at the
       * beginning of the entry data.
       * @return the next ZIP file entry, or null if there are no more entries
<span class="line-modified">!      * @exception ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
       */
      public ZipEntry getNextEntry() throws IOException {
          ensureOpen();
          if (entry != null) {
              closeEntry();
<span class="line-new-header">--- 109,12 ---</span>
  
      /**
       * Reads the next ZIP file entry and positions the stream at the
       * beginning of the entry data.
       * @return the next ZIP file entry, or null if there are no more entries
<span class="line-modified">!      * @throws    ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
       */
      public ZipEntry getNextEntry() throws IOException {
          ensureOpen();
          if (entry != null) {
              closeEntry();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 131,12 ***</span>
      }
  
      /**
       * Closes the current ZIP entry and positions the stream for reading the
       * next entry.
<span class="line-modified">!      * @exception ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
       */
      public void closeEntry() throws IOException {
          ensureOpen();
          while (read(tmpbuf, 0, tmpbuf.length) != -1) ;
          entryEOF = true;
<span class="line-new-header">--- 132,12 ---</span>
      }
  
      /**
       * Closes the current ZIP entry and positions the stream for reading the
       * next entry.
<span class="line-modified">!      * @throws    ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
       */
      public void closeEntry() throws IOException {
          ensureOpen();
          while (read(tmpbuf, 0, tmpbuf.length) != -1) ;
          entryEOF = true;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 148,11 ***</span>
       * &lt;p&gt;
       * Programs should not count on this method to return the actual number
       * of bytes that could be read without blocking.
       *
       * @return     1 before EOF and 0 after EOF has reached for current entry.
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
       *
       */
      public int available() throws IOException {
          ensureOpen();
          if (entryEOF) {
<span class="line-new-header">--- 149,11 ---</span>
       * &lt;p&gt;
       * Programs should not count on this method to return the actual number
       * of bytes that could be read without blocking.
       *
       * @return     1 before EOF and 0 after EOF has reached for current entry.
<span class="line-modified">!      * @throws     IOException  if an I/O error occurs.</span>
       *
       */
      public int available() throws IOException {
          ensureOpen();
          if (entryEOF) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 162,24 ***</span>
          }
      }
  
      /**
       * Reads from the current ZIP entry into an array of bytes.
<span class="line-modified">!      * If &lt;code&gt;len&lt;/code&gt; is not zero, the method</span>
       * blocks until some input is available; otherwise, no
<span class="line-modified">!      * bytes are read and &lt;code&gt;0&lt;/code&gt; is returned.</span>
       * @param b the buffer into which the data is read
<span class="line-modified">!      * @param off the start offset in the destination array &lt;code&gt;b&lt;/code&gt;</span>
       * @param len the maximum number of bytes read
       * @return the actual number of bytes read, or -1 if the end of the
       *         entry is reached
<span class="line-modified">!      * @exception  NullPointerException if &lt;code&gt;b&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.</span>
<span class="line-modified">!      * @exception  IndexOutOfBoundsException if &lt;code&gt;off&lt;/code&gt; is negative,</span>
<span class="line-modified">!      * &lt;code&gt;len&lt;/code&gt; is negative, or &lt;code&gt;len&lt;/code&gt; is greater than</span>
<span class="line-modified">!      * &lt;code&gt;b.length - off&lt;/code&gt;</span>
<span class="line-modified">!      * @exception ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
       */
      public int read(byte[] b, int off, int len) throws IOException {
          ensureOpen();
          if (off &lt; 0 || len &lt; 0 || off &gt; b.length - len) {
              throw new IndexOutOfBoundsException();
<span class="line-new-header">--- 163,24 ---</span>
          }
      }
  
      /**
       * Reads from the current ZIP entry into an array of bytes.
<span class="line-modified">!      * If {@code len} is not zero, the method</span>
       * blocks until some input is available; otherwise, no
<span class="line-modified">!      * bytes are read and {@code 0} is returned.</span>
       * @param b the buffer into which the data is read
<span class="line-modified">!      * @param off the start offset in the destination array {@code b}</span>
       * @param len the maximum number of bytes read
       * @return the actual number of bytes read, or -1 if the end of the
       *         entry is reached
<span class="line-modified">!      * @throws     NullPointerException if {@code b} is {@code null}.</span>
<span class="line-modified">!      * @throws     IndexOutOfBoundsException if {@code off} is negative,</span>
<span class="line-modified">!      * {@code len} is negative, or {@code len} is greater than</span>
<span class="line-modified">!      * {@code b.length - off}</span>
<span class="line-modified">!      * @throws    ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
       */
      public int read(byte[] b, int off, int len) throws IOException {
          ensureOpen();
          if (off &lt; 0 || len &lt; 0 || off &gt; b.length - len) {
              throw new IndexOutOfBoundsException();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 229,13 ***</span>
  
      /**
       * Skips specified number of bytes in the current ZIP entry.
       * @param n the number of bytes to skip
       * @return the actual number of bytes skipped
<span class="line-modified">!      * @exception ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
<span class="line-modified">!      * @exception IllegalArgumentException if {@code n &lt; 0}</span>
       */
      public long skip(long n) throws IOException {
          if (n &lt; 0) {
              throw new IllegalArgumentException(&quot;negative skip length&quot;);
          }
<span class="line-new-header">--- 230,13 ---</span>
  
      /**
       * Skips specified number of bytes in the current ZIP entry.
       * @param n the number of bytes to skip
       * @return the actual number of bytes skipped
<span class="line-modified">!      * @throws    ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
<span class="line-modified">!      * @throws    IllegalArgumentException if {@code n &lt; 0}</span>
       */
      public long skip(long n) throws IOException {
          if (n &lt; 0) {
              throw new IllegalArgumentException(&quot;negative skip length&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 258,11 ***</span>
      }
  
      /**
       * Closes this input stream and releases any system resources associated
       * with the stream.
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
       */
      public void close() throws IOException {
          if (!closed) {
              super.close();
              closed = true;
<span class="line-new-header">--- 259,11 ---</span>
      }
  
      /**
       * Closes this input stream and releases any system resources associated
       * with the stream.
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
       */
      public void close() throws IOException {
          if (!closed) {
              super.close();
              closed = true;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 319,17 ***</span>
          len = get16(tmpbuf, LOCEXT);
          if (len &gt; 0) {
              byte[] extra = new byte[len];
              readFully(extra, 0, len);
              e.setExtra0(extra,
<span class="line-modified">!                         e.csize == ZIP64_MAGICVAL || e.size == ZIP64_MAGICVAL);</span>
          }
          return e;
      }
  
      /**
<span class="line-modified">!      * Creates a new &lt;code&gt;ZipEntry&lt;/code&gt; object for the specified</span>
       * entry name.
       *
       * @param name the ZIP file entry name
       * @return the ZipEntry just created
       */
<span class="line-new-header">--- 320,17 ---</span>
          len = get16(tmpbuf, LOCEXT);
          if (len &gt; 0) {
              byte[] extra = new byte[len];
              readFully(extra, 0, len);
              e.setExtra0(extra,
<span class="line-modified">!                         e.csize == ZIP64_MAGICVAL || e.size == ZIP64_MAGICVAL, true);</span>
          }
          return e;
      }
  
      /**
<span class="line-modified">!      * Creates a new {@code ZipEntry} object for the specified</span>
       * entry name.
       *
       * @param name the ZIP file entry name
       * @return the ZipEntry just created
       */
</pre>
<center><a href="ZipFile.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipOutputStream.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>