<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/util/SimpleTimeZone.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="Set.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Stack.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/SimpleTimeZone.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  31  * and owned by Taligent, Inc., a wholly-owned subsidiary of IBM. These
  32  * materials are provided under terms of a License Agreement between Taligent
  33  * and Sun. This technology is protected by multiple US and International
  34  * patents. This notice and attribution to Taligent may not be removed.
  35  *   Taligent is a registered trademark of Taligent, Inc.
  36  *
  37  */
  38 
  39 package java.util;
  40 
  41 import java.io.ObjectInputStream;
  42 import java.io.ObjectOutputStream;
  43 import java.io.IOException;
  44 import java.io.InvalidObjectException;
  45 import sun.util.calendar.CalendarSystem;
  46 import sun.util.calendar.CalendarUtils;
  47 import sun.util.calendar.BaseCalendar;
  48 import sun.util.calendar.Gregorian;
  49 
  50 /**
<span class="line-modified">  51  * &lt;code&gt;SimpleTimeZone&lt;/code&gt; is a concrete subclass of &lt;code&gt;TimeZone&lt;/code&gt;</span>
  52  * that represents a time zone for use with a Gregorian calendar.
  53  * The class holds an offset from GMT, called &lt;em&gt;raw offset&lt;/em&gt;, and start
  54  * and end rules for a daylight saving time schedule.  Since it only holds
  55  * single values for each, it cannot handle historical changes in the offset
  56  * from GMT and the daylight saving schedule, except that the {@link
  57  * #setStartYear setStartYear} method can specify the year when the daylight
  58  * saving time schedule starts in effect.
  59  * &lt;p&gt;
<span class="line-modified">  60  * To construct a &lt;code&gt;SimpleTimeZone&lt;/code&gt; with a daylight saving time</span>
  61  * schedule, the schedule can be described with a set of rules,
  62  * &lt;em&gt;start-rule&lt;/em&gt; and &lt;em&gt;end-rule&lt;/em&gt;. A day when daylight saving time
  63  * starts or ends is specified by a combination of &lt;em&gt;month&lt;/em&gt;,
  64  * &lt;em&gt;day-of-month&lt;/em&gt;, and &lt;em&gt;day-of-week&lt;/em&gt; values. The &lt;em&gt;month&lt;/em&gt;
  65  * value is represented by a Calendar {@link Calendar#MONTH MONTH} field
  66  * value, such as {@link Calendar#MARCH}. The &lt;em&gt;day-of-week&lt;/em&gt; value is
  67  * represented by a Calendar {@link Calendar#DAY_OF_WEEK DAY_OF_WEEK} value,
  68  * such as {@link Calendar#SUNDAY SUNDAY}. The meanings of value combinations
  69  * are as follows.
  70  *
  71  * &lt;ul&gt;
  72  * &lt;li&gt;&lt;b&gt;Exact day of month&lt;/b&gt;&lt;br&gt;
  73  * To specify an exact day of month, set the &lt;em&gt;month&lt;/em&gt; and
  74  * &lt;em&gt;day-of-month&lt;/em&gt; to an exact value, and &lt;em&gt;day-of-week&lt;/em&gt; to zero. For
  75  * example, to specify March 1, set the &lt;em&gt;month&lt;/em&gt; to {@link Calendar#MARCH
  76  * MARCH}, &lt;em&gt;day-of-month&lt;/em&gt; to 1, and &lt;em&gt;day-of-week&lt;/em&gt; to 0.&lt;/li&gt;
  77  *
  78  * &lt;li&gt;&lt;b&gt;Day of week on or after day of month&lt;/b&gt;&lt;br&gt;
  79  * To specify a day of week on or after an exact day of month, set the
  80  * &lt;em&gt;month&lt;/em&gt; to an exact month value, &lt;em&gt;day-of-month&lt;/em&gt; to the day on
  81  * or after which the rule is applied, and &lt;em&gt;day-of-week&lt;/em&gt; to a negative {@link
  82  * Calendar#DAY_OF_WEEK DAY_OF_WEEK} field value. For example, to specify the
  83  * second Sunday of April, set &lt;em&gt;month&lt;/em&gt; to {@link Calendar#APRIL APRIL},
<span class="line-modified">  84  * &lt;em&gt;day-of-month&lt;/em&gt; to 8, and &lt;em&gt;day-of-week&lt;/em&gt; to &lt;code&gt;-&lt;/code&gt;{@link</span>
  85  * Calendar#SUNDAY SUNDAY}.&lt;/li&gt;
  86  *
  87  * &lt;li&gt;&lt;b&gt;Day of week on or before day of month&lt;/b&gt;&lt;br&gt;
  88  * To specify a day of the week on or before an exact day of the month, set
  89  * &lt;em&gt;day-of-month&lt;/em&gt; and &lt;em&gt;day-of-week&lt;/em&gt; to a negative value. For
  90  * example, to specify the last Wednesday on or before the 21st of March, set
  91  * &lt;em&gt;month&lt;/em&gt; to {@link Calendar#MARCH MARCH}, &lt;em&gt;day-of-month&lt;/em&gt; is -21
<span class="line-modified">  92  * and &lt;em&gt;day-of-week&lt;/em&gt; is &lt;code&gt;-&lt;/code&gt;{@link Calendar#WEDNESDAY WEDNESDAY}. &lt;/li&gt;</span>
  93  *
  94  * &lt;li&gt;&lt;b&gt;Last day-of-week of month&lt;/b&gt;&lt;br&gt;
  95  * To specify, the last day-of-week of the month, set &lt;em&gt;day-of-week&lt;/em&gt; to a
  96  * {@link Calendar#DAY_OF_WEEK DAY_OF_WEEK} value and &lt;em&gt;day-of-month&lt;/em&gt; to
  97  * -1. For example, to specify the last Sunday of October, set &lt;em&gt;month&lt;/em&gt;
  98  * to {@link Calendar#OCTOBER OCTOBER}, &lt;em&gt;day-of-week&lt;/em&gt; to {@link
  99  * Calendar#SUNDAY SUNDAY} and &lt;em&gt;day-of-month&lt;/em&gt; to -1.  &lt;/li&gt;
 100  *
 101  * &lt;/ul&gt;
 102  * The time of the day at which daylight saving time starts or ends is
 103  * specified by a millisecond value within the day. There are three kinds of
 104  * &lt;em&gt;mode&lt;/em&gt;s to specify the time: {@link #WALL_TIME}, {@link
 105  * #STANDARD_TIME} and {@link #UTC_TIME}. For example, if daylight
 106  * saving time ends
 107  * at 2:00 am in the wall clock time, it can be specified by 7200000
 108  * milliseconds in the {@link #WALL_TIME} mode. In this case, the wall clock time
 109  * for an &lt;em&gt;end-rule&lt;/em&gt; means the same thing as the daylight time.
 110  * &lt;p&gt;
 111  * The following are examples of parameters for constructing time zone objects.
 112  * &lt;pre&gt;&lt;code&gt;
</pre>
<hr />
<pre>
 122  *                     7200000,
 123  *                     Calendar.OCTOBER, -1, Calendar.SUNDAY,
 124  *                     7200000,
 125  *                     3600000)
 126  *
 127  *      // Base GMT offset: +1:00
 128  *      // DST starts:      at 1:00am in UTC time
 129  *      //                  on the last Sunday in March
 130  *      // DST ends:        at 1:00am in UTC time
 131  *      //                  on the last Sunday in October
 132  *      // Save:            1 hour
 133  *      SimpleTimeZone(3600000,
 134  *                     &quot;Europe/Paris&quot;,
 135  *                     Calendar.MARCH, -1, Calendar.SUNDAY,
 136  *                     3600000, SimpleTimeZone.UTC_TIME,
 137  *                     Calendar.OCTOBER, -1, Calendar.SUNDAY,
 138  *                     3600000, SimpleTimeZone.UTC_TIME,
 139  *                     3600000)
 140  * &lt;/code&gt;&lt;/pre&gt;
 141  * These parameter rules are also applicable to the set rule methods, such as
<span class="line-modified"> 142  * &lt;code&gt;setStartRule&lt;/code&gt;.</span>
 143  *
 144  * @since 1.1
 145  * @see      Calendar
 146  * @see      GregorianCalendar
 147  * @see      TimeZone
 148  * @author   David Goldsmith, Mark Davis, Chen-Lieh Huang, Alan Liu
 149  */
 150 
 151 public class SimpleTimeZone extends TimeZone {
 152     /**
 153      * Constructs a SimpleTimeZone with the given base time zone offset from GMT
 154      * and time zone ID with no daylight saving time schedule.
 155      *
 156      * @param rawOffset  The base time zone offset in milliseconds to GMT.
 157      * @param ID         The time zone name that is given to this instance.
 158      */
 159     public SimpleTimeZone(int rawOffset, String ID)
 160     {
 161         this.rawOffset = rawOffset;
 162         setID (ID);
 163         dstSavings = millisPerHour; // In case user sets rules later
 164     }
 165 
 166     /**
 167      * Constructs a SimpleTimeZone with the given base time zone offset from
 168      * GMT, time zone ID, and rules for starting and ending the daylight
 169      * time.
<span class="line-modified"> 170      * Both &lt;code&gt;startTime&lt;/code&gt; and &lt;code&gt;endTime&lt;/code&gt; are specified to be</span>
 171      * represented in the wall clock time. The amount of daylight saving is
 172      * assumed to be 3600000 milliseconds (i.e., one hour). This constructor is
 173      * equivalent to:
 174      * &lt;pre&gt;&lt;code&gt;
 175      *     SimpleTimeZone(rawOffset,
 176      *                    ID,
 177      *                    startMonth,
 178      *                    startDay,
 179      *                    startDayOfWeek,
 180      *                    startTime,
 181      *                    SimpleTimeZone.{@link #WALL_TIME},
 182      *                    endMonth,
 183      *                    endDay,
 184      *                    endDayOfWeek,
 185      *                    endTime,
 186      *                    SimpleTimeZone.{@link #WALL_TIME},
 187      *                    3600000)
 188      * &lt;/code&gt;&lt;/pre&gt;
 189      *
 190      * @param rawOffset       The given base time zone offset from GMT.
</pre>
<hr />
<pre>
 192      * @param startMonth      The daylight saving time starting month. Month is
 193      *                        a {@link Calendar#MONTH MONTH} field value (0-based. e.g., 0
 194      *                        for January).
 195      * @param startDay        The day of the month on which the daylight saving time starts.
 196      *                        See the class description for the special cases of this parameter.
 197      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 198      *                        See the class description for the special cases of this parameter.
 199      * @param startTime       The daylight saving time starting time in local wall clock
 200      *                        time (in milliseconds within the day), which is local
 201      *                        standard time in this case.
 202      * @param endMonth        The daylight saving time ending month. Month is
 203      *                        a {@link Calendar#MONTH MONTH} field
 204      *                        value (0-based. e.g., 9 for October).
 205      * @param endDay          The day of the month on which the daylight saving time ends.
 206      *                        See the class description for the special cases of this parameter.
 207      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 208      *                        See the class description for the special cases of this parameter.
 209      * @param endTime         The daylight saving ending time in local wall clock time,
 210      *                        (in milliseconds within the day) which is local daylight
 211      *                        time in this case.
<span class="line-modified"> 212      * @exception IllegalArgumentException if the month, day, dayOfWeek, or time</span>
 213      * parameters are out of range for the start or end rule
 214      */
 215     public SimpleTimeZone(int rawOffset, String ID,
 216                           int startMonth, int startDay, int startDayOfWeek, int startTime,
 217                           int endMonth, int endDay, int endDayOfWeek, int endTime)
 218     {
 219         this(rawOffset, ID,
 220              startMonth, startDay, startDayOfWeek, startTime, WALL_TIME,
 221              endMonth, endDay, endDayOfWeek, endTime, WALL_TIME,
 222              millisPerHour);
 223     }
 224 
 225     /**
 226      * Constructs a SimpleTimeZone with the given base time zone offset from
 227      * GMT, time zone ID, and rules for starting and ending the daylight
 228      * time.
<span class="line-modified"> 229      * Both &lt;code&gt;startTime&lt;/code&gt; and &lt;code&gt;endTime&lt;/code&gt; are assumed to be</span>
 230      * represented in the wall clock time. This constructor is equivalent to:
 231      * &lt;pre&gt;&lt;code&gt;
 232      *     SimpleTimeZone(rawOffset,
 233      *                    ID,
 234      *                    startMonth,
 235      *                    startDay,
 236      *                    startDayOfWeek,
 237      *                    startTime,
 238      *                    SimpleTimeZone.{@link #WALL_TIME},
 239      *                    endMonth,
 240      *                    endDay,
 241      *                    endDayOfWeek,
 242      *                    endTime,
 243      *                    SimpleTimeZone.{@link #WALL_TIME},
 244      *                    dstSavings)
 245      * &lt;/code&gt;&lt;/pre&gt;
 246      *
 247      * @param rawOffset       The given base time zone offset from GMT.
 248      * @param ID              The time zone ID which is given to this object.
 249      * @param startMonth      The daylight saving time starting month. Month is
 250      *                        a {@link Calendar#MONTH MONTH} field
 251      *                        value (0-based. e.g., 0 for January).
 252      * @param startDay        The day of the month on which the daylight saving time starts.
 253      *                        See the class description for the special cases of this parameter.
 254      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 255      *                        See the class description for the special cases of this parameter.
 256      * @param startTime       The daylight saving time starting time in local wall clock
 257      *                        time, which is local standard time in this case.
 258      * @param endMonth        The daylight saving time ending month. Month is
 259      *                        a {@link Calendar#MONTH MONTH} field
 260      *                        value (0-based. e.g., 9 for October).
 261      * @param endDay          The day of the month on which the daylight saving time ends.
 262      *                        See the class description for the special cases of this parameter.
 263      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 264      *                        See the class description for the special cases of this parameter.
 265      * @param endTime         The daylight saving ending time in local wall clock time,
 266      *                        which is local daylight time in this case.
 267      * @param dstSavings      The amount of time in milliseconds saved during
 268      *                        daylight saving time.
<span class="line-modified"> 269      * @exception IllegalArgumentException if the month, day, dayOfWeek, or time</span>
 270      * parameters are out of range for the start or end rule
 271      * @since 1.2
 272      */
 273     public SimpleTimeZone(int rawOffset, String ID,
 274                           int startMonth, int startDay, int startDayOfWeek, int startTime,
 275                           int endMonth, int endDay, int endDayOfWeek, int endTime,
 276                           int dstSavings)
 277     {
 278         this(rawOffset, ID,
 279              startMonth, startDay, startDayOfWeek, startTime, WALL_TIME,
 280              endMonth, endDay, endDayOfWeek, endTime, WALL_TIME,
 281              dstSavings);
 282     }
 283 
 284     /**
 285      * Constructs a SimpleTimeZone with the given base time zone offset from
 286      * GMT, time zone ID, and rules for starting and ending the daylight
 287      * time.
 288      * This constructor takes the full set of the start and end rules
<span class="line-modified"> 289      * parameters, including modes of &lt;code&gt;startTime&lt;/code&gt; and</span>
<span class="line-modified"> 290      * &lt;code&gt;endTime&lt;/code&gt;. The mode specifies either {@link #WALL_TIME wall</span>
 291      * time} or {@link #STANDARD_TIME standard time} or {@link #UTC_TIME UTC
 292      * time}.
 293      *
 294      * @param rawOffset       The given base time zone offset from GMT.
 295      * @param ID              The time zone ID which is given to this object.
 296      * @param startMonth      The daylight saving time starting month. Month is
 297      *                        a {@link Calendar#MONTH MONTH} field
 298      *                        value (0-based. e.g., 0 for January).
 299      * @param startDay        The day of the month on which the daylight saving time starts.
 300      *                        See the class description for the special cases of this parameter.
 301      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 302      *                        See the class description for the special cases of this parameter.
 303      * @param startTime       The daylight saving time starting time in the time mode
<span class="line-modified"> 304      *                        specified by &lt;code&gt;startTimeMode&lt;/code&gt;.</span>
 305      * @param startTimeMode   The mode of the start time specified by startTime.
 306      * @param endMonth        The daylight saving time ending month. Month is
 307      *                        a {@link Calendar#MONTH MONTH} field
 308      *                        value (0-based. e.g., 9 for October).
 309      * @param endDay          The day of the month on which the daylight saving time ends.
 310      *                        See the class description for the special cases of this parameter.
 311      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 312      *                        See the class description for the special cases of this parameter.
 313      * @param endTime         The daylight saving ending time in time mode
<span class="line-modified"> 314      *                        specified by &lt;code&gt;endTimeMode&lt;/code&gt;.</span>
 315      * @param endTimeMode     The mode of the end time specified by endTime
 316      * @param dstSavings      The amount of time in milliseconds saved during
 317      *                        daylight saving time.
 318      *
<span class="line-modified"> 319      * @exception IllegalArgumentException if the month, day, dayOfWeek, time more, or</span>
 320      * time parameters are out of range for the start or end rule, or if a time mode
 321      * value is invalid.
 322      *
 323      * @see #WALL_TIME
 324      * @see #STANDARD_TIME
 325      * @see #UTC_TIME
 326      *
 327      * @since 1.4
 328      */
 329     public SimpleTimeZone(int rawOffset, String ID,
 330                           int startMonth, int startDay, int startDayOfWeek,
 331                           int startTime, int startTimeMode,
 332                           int endMonth, int endDay, int endDayOfWeek,
 333                           int endTime, int endTimeMode,
 334                           int dstSavings) {
 335 
 336         setID(ID);
 337         this.rawOffset      = rawOffset;
 338         this.startMonth     = startMonth;
 339         this.startDay       = startDay;
</pre>
<hr />
<pre>
 352         if (dstSavings &lt;= 0) {
 353             throw new IllegalArgumentException(&quot;Illegal daylight saving value: &quot; + dstSavings);
 354         }
 355     }
 356 
 357     /**
 358      * Sets the daylight saving time starting year.
 359      *
 360      * @param year  The daylight saving starting year.
 361      */
 362     public void setStartYear(int year)
 363     {
 364         startYear = year;
 365         invalidateCache();
 366     }
 367 
 368     /**
 369      * Sets the daylight saving time start rule. For example, if daylight saving
 370      * time starts on the first Sunday in April at 2 am in local wall clock
 371      * time, you can set the start rule by calling:
<span class="line-modified"> 372      * &lt;pre&gt;&lt;code&gt;setStartRule(Calendar.APRIL, 1, Calendar.SUNDAY, 2*60*60*1000);&lt;/code&gt;&lt;/pre&gt;</span>
 373      *
 374      * @param startMonth      The daylight saving time starting month. Month is
 375      *                        a {@link Calendar#MONTH MONTH} field
 376      *                        value (0-based. e.g., 0 for January).
 377      * @param startDay        The day of the month on which the daylight saving time starts.
 378      *                        See the class description for the special cases of this parameter.
 379      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 380      *                        See the class description for the special cases of this parameter.
 381      * @param startTime       The daylight saving time starting time in local wall clock
 382      *                        time, which is local standard time in this case.
<span class="line-modified"> 383      * @exception IllegalArgumentException if the &lt;code&gt;startMonth&lt;/code&gt;, &lt;code&gt;startDay&lt;/code&gt;,</span>
<span class="line-modified"> 384      * &lt;code&gt;startDayOfWeek&lt;/code&gt;, or &lt;code&gt;startTime&lt;/code&gt; parameters are out of range</span>
 385      */
 386     public void setStartRule(int startMonth, int startDay, int startDayOfWeek, int startTime)
 387     {
 388         this.startMonth = startMonth;
 389         this.startDay = startDay;
 390         this.startDayOfWeek = startDayOfWeek;
 391         this.startTime = startTime;
 392         startTimeMode = WALL_TIME;
 393         decodeStartRule();
 394         invalidateCache();
 395     }
 396 
 397     /**
 398      * Sets the daylight saving time start rule to a fixed date within a month.
 399      * This method is equivalent to:
<span class="line-modified"> 400      * &lt;pre&gt;&lt;code&gt;setStartRule(startMonth, startDay, 0, startTime)&lt;/code&gt;&lt;/pre&gt;</span>
 401      *
 402      * @param startMonth      The daylight saving time starting month. Month is
 403      *                        a {@link Calendar#MONTH MONTH} field
 404      *                        value (0-based. e.g., 0 for January).
 405      * @param startDay        The day of the month on which the daylight saving time starts.
 406      * @param startTime       The daylight saving time starting time in local wall clock
 407      *                        time, which is local standard time in this case.
 408      *                        See the class description for the special cases of this parameter.
<span class="line-modified"> 409      * @exception IllegalArgumentException if the &lt;code&gt;startMonth&lt;/code&gt;,</span>
<span class="line-modified"> 410      * &lt;code&gt;startDayOfMonth&lt;/code&gt;, or &lt;code&gt;startTime&lt;/code&gt; parameters are out of range</span>
 411      * @since 1.2
 412      */
 413     public void setStartRule(int startMonth, int startDay, int startTime) {
 414         setStartRule(startMonth, startDay, 0, startTime);
 415     }
 416 
 417     /**
 418      * Sets the daylight saving time start rule to a weekday before or after the given date within
 419      * a month, e.g., the first Monday on or after the 8th.
 420      *
 421      * @param startMonth      The daylight saving time starting month. Month is
 422      *                        a {@link Calendar#MONTH MONTH} field
 423      *                        value (0-based. e.g., 0 for January).
 424      * @param startDay        The day of the month on which the daylight saving time starts.
 425      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 426      * @param startTime       The daylight saving time starting time in local wall clock
 427      *                        time, which is local standard time in this case.
<span class="line-modified"> 428      * @param after           If true, this rule selects the first &lt;code&gt;dayOfWeek&lt;/code&gt; on or</span>
<span class="line-modified"> 429      *                        &lt;em&gt;after&lt;/em&gt; &lt;code&gt;dayOfMonth&lt;/code&gt;.  If false, this rule</span>
<span class="line-modified"> 430      *                        selects the last &lt;code&gt;dayOfWeek&lt;/code&gt; on or &lt;em&gt;before&lt;/em&gt;</span>
<span class="line-modified"> 431      *                        &lt;code&gt;dayOfMonth&lt;/code&gt;.</span>
<span class="line-modified"> 432      * @exception IllegalArgumentException if the &lt;code&gt;startMonth&lt;/code&gt;, &lt;code&gt;startDay&lt;/code&gt;,</span>
<span class="line-modified"> 433      * &lt;code&gt;startDayOfWeek&lt;/code&gt;, or &lt;code&gt;startTime&lt;/code&gt; parameters are out of range</span>
 434      * @since 1.2
 435      */
 436     public void setStartRule(int startMonth, int startDay, int startDayOfWeek,
 437                              int startTime, boolean after)
 438     {
 439         // TODO: this method doesn&#39;t check the initial values of dayOfMonth or dayOfWeek.
 440         if (after) {
 441             setStartRule(startMonth, startDay, -startDayOfWeek, startTime);
 442         } else {
 443             setStartRule(startMonth, -startDay, -startDayOfWeek, startTime);
 444         }
 445     }
 446 
 447     /**
 448      * Sets the daylight saving time end rule. For example, if daylight saving time
 449      * ends on the last Sunday in October at 2 am in wall clock time,
 450      * you can set the end rule by calling:
<span class="line-modified"> 451      * &lt;code&gt;setEndRule(Calendar.OCTOBER, -1, Calendar.SUNDAY, 2*60*60*1000);&lt;/code&gt;</span>
 452      *
 453      * @param endMonth        The daylight saving time ending month. Month is
 454      *                        a {@link Calendar#MONTH MONTH} field
 455      *                        value (0-based. e.g., 9 for October).
 456      * @param endDay          The day of the month on which the daylight saving time ends.
 457      *                        See the class description for the special cases of this parameter.
 458      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 459      *                        See the class description for the special cases of this parameter.
 460      * @param endTime         The daylight saving ending time in local wall clock time,
 461      *                        (in milliseconds within the day) which is local daylight
 462      *                        time in this case.
<span class="line-modified"> 463      * @exception IllegalArgumentException if the &lt;code&gt;endMonth&lt;/code&gt;, &lt;code&gt;endDay&lt;/code&gt;,</span>
<span class="line-modified"> 464      * &lt;code&gt;endDayOfWeek&lt;/code&gt;, or &lt;code&gt;endTime&lt;/code&gt; parameters are out of range</span>
 465      */
 466     public void setEndRule(int endMonth, int endDay, int endDayOfWeek,
 467                            int endTime)
 468     {
 469         this.endMonth = endMonth;
 470         this.endDay = endDay;
 471         this.endDayOfWeek = endDayOfWeek;
 472         this.endTime = endTime;
 473         this.endTimeMode = WALL_TIME;
 474         decodeEndRule();
 475         invalidateCache();
 476     }
 477 
 478     /**
 479      * Sets the daylight saving time end rule to a fixed date within a month.
 480      * This method is equivalent to:
<span class="line-modified"> 481      * &lt;pre&gt;&lt;code&gt;setEndRule(endMonth, endDay, 0, endTime)&lt;/code&gt;&lt;/pre&gt;</span>
 482      *
 483      * @param endMonth        The daylight saving time ending month. Month is
 484      *                        a {@link Calendar#MONTH MONTH} field
 485      *                        value (0-based. e.g., 9 for October).
 486      * @param endDay          The day of the month on which the daylight saving time ends.
 487      * @param endTime         The daylight saving ending time in local wall clock time,
 488      *                        (in milliseconds within the day) which is local daylight
 489      *                        time in this case.
<span class="line-modified"> 490      * @exception IllegalArgumentException the &lt;code&gt;endMonth&lt;/code&gt;, &lt;code&gt;endDay&lt;/code&gt;,</span>
<span class="line-modified"> 491      * or &lt;code&gt;endTime&lt;/code&gt; parameters are out of range</span>
 492      * @since 1.2
 493      */
 494     public void setEndRule(int endMonth, int endDay, int endTime)
 495     {
 496         setEndRule(endMonth, endDay, 0, endTime);
 497     }
 498 
 499     /**
 500      * Sets the daylight saving time end rule to a weekday before or after the given date within
 501      * a month, e.g., the first Monday on or after the 8th.
 502      *
 503      * @param endMonth        The daylight saving time ending month. Month is
 504      *                        a {@link Calendar#MONTH MONTH} field
 505      *                        value (0-based. e.g., 9 for October).
 506      * @param endDay          The day of the month on which the daylight saving time ends.
 507      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 508      * @param endTime         The daylight saving ending time in local wall clock time,
 509      *                        (in milliseconds within the day) which is local daylight
 510      *                        time in this case.
<span class="line-modified"> 511      * @param after           If true, this rule selects the first &lt;code&gt;endDayOfWeek&lt;/code&gt; on</span>
<span class="line-modified"> 512      *                        or &lt;em&gt;after&lt;/em&gt; &lt;code&gt;endDay&lt;/code&gt;.  If false, this rule</span>
<span class="line-modified"> 513      *                        selects the last &lt;code&gt;endDayOfWeek&lt;/code&gt; on or before</span>
<span class="line-modified"> 514      *                        &lt;code&gt;endDay&lt;/code&gt; of the month.</span>
<span class="line-modified"> 515      * @exception IllegalArgumentException the &lt;code&gt;endMonth&lt;/code&gt;, &lt;code&gt;endDay&lt;/code&gt;,</span>
<span class="line-modified"> 516      * &lt;code&gt;endDayOfWeek&lt;/code&gt;, or &lt;code&gt;endTime&lt;/code&gt; parameters are out of range</span>
 517      * @since 1.2
 518      */
 519     public void setEndRule(int endMonth, int endDay, int endDayOfWeek, int endTime, boolean after)
 520     {
 521         if (after) {
 522             setEndRule(endMonth, endDay, -endDayOfWeek, endTime);
 523         } else {
 524             setEndRule(endMonth, -endDay, -endDayOfWeek, endTime);
 525         }
 526     }
 527 
 528     /**
 529      * Returns the offset of this time zone from UTC at the given
 530      * time. If daylight saving time is in effect at the given time,
 531      * the offset value is adjusted with the amount of daylight
 532      * saving.
 533      *
 534      * @param date the time at which the time zone offset is found
 535      * @return the amount of time in milliseconds to add to UTC to get
 536      * local time.
</pre>
<hr />
<pre>
 566                 cdate.setTimeOfDay(0, 0, 0, 0);
 567                 offset = getOffset(cal, cdate, year, date);
 568             }
 569         }
 570 
 571         if (offsets != null) {
 572             offsets[0] = rawOffset;
 573             offsets[1] = offset - rawOffset;
 574         }
 575         return offset;
 576     }
 577 
 578    /**
 579      * Returns the difference in milliseconds between local time and
 580      * UTC, taking into account both the raw offset and the effect of
 581      * daylight saving, for the specified date and time.  This method
 582      * assumes that the start and end month are distinct.  It also
 583      * uses a default {@link GregorianCalendar} object as its
 584      * underlying calendar, such as for determining leap years.  Do
 585      * not use the result of this method with a calendar other than a
<span class="line-modified"> 586      * default &lt;code&gt;GregorianCalendar&lt;/code&gt;.</span>
 587      *
 588      * &lt;p&gt;&lt;em&gt;Note:  In general, clients should use
<span class="line-modified"> 589      * &lt;code&gt;Calendar.get(ZONE_OFFSET) + Calendar.get(DST_OFFSET)&lt;/code&gt;</span>
 590      * instead of calling this method.&lt;/em&gt;
 591      *
 592      * @param era       The era of the given date.
 593      * @param year      The year in the given date.
 594      * @param month     The month in the given date. Month is 0-based. e.g.,
 595      *                  0 for January.
 596      * @param day       The day-in-month of the given date.
 597      * @param dayOfWeek The day-of-week of the given date.
 598      * @param millis    The milliseconds in day in &lt;em&gt;standard&lt;/em&gt; local time.
 599      * @return          The milliseconds to add to UTC to get local time.
<span class="line-modified"> 600      * @exception       IllegalArgumentException the &lt;code&gt;era&lt;/code&gt;,</span>
<span class="line-modified"> 601      *                  &lt;code&gt;month&lt;/code&gt;, &lt;code&gt;day&lt;/code&gt;, &lt;code&gt;dayOfWeek&lt;/code&gt;,</span>
<span class="line-modified"> 602      *                  or &lt;code&gt;millis&lt;/code&gt; parameters are out of range</span>
 603      */
 604     public int getOffset(int era, int year, int month, int day, int dayOfWeek,
 605                          int millis)
 606     {
 607         if (era != GregorianCalendar.AD &amp;&amp; era != GregorianCalendar.BC) {
 608             throw new IllegalArgumentException(&quot;Illegal era &quot; + era);
 609         }
 610 
 611         int y = year;
 612         if (era == GregorianCalendar.BC) {
 613             // adjust y with the GregorianCalendar-style year numbering.
 614             y = 1 - y;
 615         }
 616 
 617         // If the year isn&#39;t representable with the 64-bit long
 618         // integer in milliseconds, convert the year to an
 619         // equivalent year. This is required to pass some JCK test cases
 620         // which are actually useless though because the specified years
 621         // can&#39;t be supported by the Java time system.
 622         if (y &gt;= 292278994) {
</pre>
<hr />
<pre>
 836      * @return {@code true} if this {@code SimpleTimeZone} observes
 837      * Daylight Saving Time; {@code false} otherwise.
 838      * @since 1.7
 839      */
 840     @Override
 841     public boolean observesDaylightTime() {
 842         return useDaylightTime();
 843     }
 844 
 845     /**
 846      * Queries if the given date is in daylight saving time.
 847      * @return true if daylight saving time is in effective at the
 848      * given date; false otherwise.
 849      */
 850     public boolean inDaylightTime(Date date)
 851     {
 852         return (getOffset(date.getTime()) != rawOffset);
 853     }
 854 
 855     /**
<span class="line-modified"> 856      * Returns a clone of this &lt;code&gt;SimpleTimeZone&lt;/code&gt; instance.</span>
 857      * @return a clone of this instance.
 858      */
 859     public Object clone()
 860     {
 861         return super.clone();
 862     }
 863 
 864     /**
 865      * Generates the hash code for the SimpleDateFormat object.
 866      * @return the hash code for this object
 867      */
 868     public int hashCode()
 869     {
 870         return startMonth ^ startDay ^ startDayOfWeek ^ startTime ^
 871             endMonth ^ endDay ^ endDayOfWeek ^ endTime ^ rawOffset;
 872     }
 873 
 874     /**
<span class="line-modified"> 875      * Compares the equality of two &lt;code&gt;SimpleTimeZone&lt;/code&gt; objects.</span>
 876      *
<span class="line-modified"> 877      * @param obj  The &lt;code&gt;SimpleTimeZone&lt;/code&gt; object to be compared with.</span>
<span class="line-modified"> 878      * @return     True if the given &lt;code&gt;obj&lt;/code&gt; is the same as this</span>
<span class="line-modified"> 879      *             &lt;code&gt;SimpleTimeZone&lt;/code&gt; object; false otherwise.</span>
 880      */
 881     public boolean equals(Object obj)
 882     {
 883         if (this == obj) {
 884             return true;
 885         }
 886         if (!(obj instanceof SimpleTimeZone)) {
 887             return false;
 888         }
 889 
 890         SimpleTimeZone that = (SimpleTimeZone) obj;
 891 
 892         return getID().equals(that.getID()) &amp;&amp;
 893             hasSameRules(that);
 894     }
 895 
 896     /**
<span class="line-modified"> 897      * Returns &lt;code&gt;true&lt;/code&gt; if this zone has the same rules and offset as another zone.</span>
 898      * @param other the TimeZone object to be compared with
<span class="line-modified"> 899      * @return &lt;code&gt;true&lt;/code&gt; if the given zone is a SimpleTimeZone and has the</span>
 900      * same rules and offset as this one
 901      * @since 1.2
 902      */
 903     public boolean hasSameRules(TimeZone other) {
 904         if (this == other) {
 905             return true;
 906         }
 907         if (!(other instanceof SimpleTimeZone)) {
 908             return false;
 909         }
 910         SimpleTimeZone that = (SimpleTimeZone) other;
 911         return rawOffset == that.rawOffset &amp;&amp;
 912             useDaylight == that.useDaylight &amp;&amp;
 913             (!useDaylight
 914              // Only check rules if using DST
 915              || (dstSavings == that.dstSavings &amp;&amp;
 916                  startMode == that.startMode &amp;&amp;
 917                  startMonth == that.startMonth &amp;&amp;
 918                  startDay == that.startDay &amp;&amp;
 919                  startDayOfWeek == that.startDayOfWeek &amp;&amp;
</pre>
<hr />
<pre>
 940             &quot;,useDaylight=&quot; + useDaylight +
 941             &quot;,startYear=&quot; + startYear +
 942             &quot;,startMode=&quot; + startMode +
 943             &quot;,startMonth=&quot; + startMonth +
 944             &quot;,startDay=&quot; + startDay +
 945             &quot;,startDayOfWeek=&quot; + startDayOfWeek +
 946             &quot;,startTime=&quot; + startTime +
 947             &quot;,startTimeMode=&quot; + startTimeMode +
 948             &quot;,endMode=&quot; + endMode +
 949             &quot;,endMonth=&quot; + endMonth +
 950             &quot;,endDay=&quot; + endDay +
 951             &quot;,endDayOfWeek=&quot; + endDayOfWeek +
 952             &quot;,endTime=&quot; + endTime +
 953             &quot;,endTimeMode=&quot; + endTimeMode + &#39;]&#39;;
 954     }
 955 
 956     // =======================privates===============================
 957 
 958     /**
 959      * The month in which daylight saving time starts.  This value must be
<span class="line-modified"> 960      * between &lt;code&gt;Calendar.JANUARY&lt;/code&gt; and</span>
<span class="line-modified"> 961      * &lt;code&gt;Calendar.DECEMBER&lt;/code&gt; inclusive.  This value must not equal</span>
<span class="line-modified"> 962      * &lt;code&gt;endMonth&lt;/code&gt;.</span>
<span class="line-modified"> 963      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
 964      * @serial
 965      */
 966     private int startMonth;
 967 
 968     /**
 969      * This field has two possible interpretations:
 970      * &lt;dl&gt;
<span class="line-modified"> 971      * &lt;dt&gt;&lt;code&gt;startMode == DOW_IN_MONTH&lt;/code&gt;&lt;/dt&gt;</span>
 972      * &lt;dd&gt;
<span class="line-modified"> 973      * &lt;code&gt;startDay&lt;/code&gt; indicates the day of the month of</span>
<span class="line-modified"> 974      * &lt;code&gt;startMonth&lt;/code&gt; on which daylight</span>
 975      * saving time starts, from 1 to 28, 30, or 31, depending on the
<span class="line-modified"> 976      * &lt;code&gt;startMonth&lt;/code&gt;.</span>
 977      * &lt;/dd&gt;
<span class="line-modified"> 978      * &lt;dt&gt;&lt;code&gt;startMode != DOW_IN_MONTH&lt;/code&gt;&lt;/dt&gt;</span>
 979      * &lt;dd&gt;
<span class="line-modified"> 980      * &lt;code&gt;startDay&lt;/code&gt; indicates which &lt;code&gt;startDayOfWeek&lt;/code&gt; in the</span>
<span class="line-modified"> 981      * month &lt;code&gt;startMonth&lt;/code&gt; daylight</span>
 982      * saving time starts on.  For example, a value of +1 and a
<span class="line-modified"> 983      * &lt;code&gt;startDayOfWeek&lt;/code&gt; of &lt;code&gt;Calendar.SUNDAY&lt;/code&gt; indicates the</span>
<span class="line-modified"> 984      * first Sunday of &lt;code&gt;startMonth&lt;/code&gt;.  Likewise, +2 would indicate the</span>
 985      * second Sunday, and -1 the last Sunday.  A value of 0 is illegal.
 986      * &lt;/dd&gt;
 987      * &lt;/dl&gt;
<span class="line-modified"> 988      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
 989      * @serial
 990      */
 991     private int startDay;
 992 
 993     /**
 994      * The day of the week on which daylight saving time starts.  This value
<span class="line-modified"> 995      * must be between &lt;code&gt;Calendar.SUNDAY&lt;/code&gt; and</span>
<span class="line-modified"> 996      * &lt;code&gt;Calendar.SATURDAY&lt;/code&gt; inclusive.</span>
<span class="line-modified"> 997      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false or</span>
<span class="line-modified"> 998      * &lt;code&gt;startMode == DAY_OF_MONTH&lt;/code&gt;, this value is ignored.</span>
 999      * @serial
1000      */
1001     private int startDayOfWeek;
1002 
1003     /**
1004      * The time in milliseconds after midnight at which daylight saving
1005      * time starts.  This value is expressed as wall time, standard time,
<span class="line-modified">1006      * or UTC time, depending on the setting of &lt;code&gt;startTimeMode&lt;/code&gt;.</span>
<span class="line-modified">1007      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
1008      * @serial
1009      */
1010     private int startTime;
1011 
1012     /**
1013      * The format of startTime, either WALL_TIME, STANDARD_TIME, or UTC_TIME.
1014      * @serial
1015      * @since 1.3
1016      */
1017     private int startTimeMode;
1018 
1019     /**
1020      * The month in which daylight saving time ends.  This value must be
<span class="line-modified">1021      * between &lt;code&gt;Calendar.JANUARY&lt;/code&gt; and</span>
<span class="line-modified">1022      * &lt;code&gt;Calendar.UNDECIMBER&lt;/code&gt;.  This value must not equal</span>
<span class="line-modified">1023      * &lt;code&gt;startMonth&lt;/code&gt;.</span>
<span class="line-modified">1024      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
1025      * @serial
1026      */
1027     private int endMonth;
1028 
1029     /**
1030      * This field has two possible interpretations:
1031      * &lt;dl&gt;
<span class="line-modified">1032      * &lt;dt&gt;&lt;code&gt;endMode == DOW_IN_MONTH&lt;/code&gt;&lt;/dt&gt;</span>
1033      * &lt;dd&gt;
<span class="line-modified">1034      * &lt;code&gt;endDay&lt;/code&gt; indicates the day of the month of</span>
<span class="line-modified">1035      * &lt;code&gt;endMonth&lt;/code&gt; on which daylight</span>
1036      * saving time ends, from 1 to 28, 30, or 31, depending on the
<span class="line-modified">1037      * &lt;code&gt;endMonth&lt;/code&gt;.</span>
1038      * &lt;/dd&gt;
<span class="line-modified">1039      * &lt;dt&gt;&lt;code&gt;endMode != DOW_IN_MONTH&lt;/code&gt;&lt;/dt&gt;</span>
1040      * &lt;dd&gt;
<span class="line-modified">1041      * &lt;code&gt;endDay&lt;/code&gt; indicates which &lt;code&gt;endDayOfWeek&lt;/code&gt; in th</span>
<span class="line-modified">1042      * month &lt;code&gt;endMonth&lt;/code&gt; daylight</span>
1043      * saving time ends on.  For example, a value of +1 and a
<span class="line-modified">1044      * &lt;code&gt;endDayOfWeek&lt;/code&gt; of &lt;code&gt;Calendar.SUNDAY&lt;/code&gt; indicates the</span>
<span class="line-modified">1045      * first Sunday of &lt;code&gt;endMonth&lt;/code&gt;.  Likewise, +2 would indicate the</span>
1046      * second Sunday, and -1 the last Sunday.  A value of 0 is illegal.
1047      * &lt;/dd&gt;
1048      * &lt;/dl&gt;
<span class="line-modified">1049      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
1050      * @serial
1051      */
1052     private int endDay;
1053 
1054     /**
1055      * The day of the week on which daylight saving time ends.  This value
<span class="line-modified">1056      * must be between &lt;code&gt;Calendar.SUNDAY&lt;/code&gt; and</span>
<span class="line-modified">1057      * &lt;code&gt;Calendar.SATURDAY&lt;/code&gt; inclusive.</span>
<span class="line-modified">1058      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false or</span>
<span class="line-modified">1059      * &lt;code&gt;endMode == DAY_OF_MONTH&lt;/code&gt;, this value is ignored.</span>
1060      * @serial
1061      */
1062     private int endDayOfWeek;
1063 
1064     /**
1065      * The time in milliseconds after midnight at which daylight saving
1066      * time ends.  This value is expressed as wall time, standard time,
<span class="line-modified">1067      * or UTC time, depending on the setting of &lt;code&gt;endTimeMode&lt;/code&gt;.</span>
<span class="line-modified">1068      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
1069      * @serial
1070      */
1071     private int endTime;
1072 
1073     /**
<span class="line-modified">1074      * The format of endTime, either &lt;code&gt;WALL_TIME&lt;/code&gt;,</span>
<span class="line-modified">1075      * &lt;code&gt;STANDARD_TIME&lt;/code&gt;, or &lt;code&gt;UTC_TIME&lt;/code&gt;.</span>
1076      * @serial
1077      * @since 1.3
1078      */
1079     private int endTimeMode;
1080 
1081     /**
1082      * The year in which daylight saving time is first observed.  This is an {@link GregorianCalendar#AD AD}
1083      * value.  If this value is less than 1 then daylight saving time is observed
<span class="line-modified">1084      * for all &lt;code&gt;AD&lt;/code&gt; years.</span>
<span class="line-modified">1085      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
1086      * @serial
1087      */
1088     private int startYear;
1089 
1090     /**
1091      * The offset in milliseconds between this zone and GMT.  Negative offsets
1092      * are to the west of Greenwich.  To obtain local &lt;em&gt;standard&lt;/em&gt; time,
1093      * add the offset to GMT time.  To obtain local wall time it may also be
<span class="line-modified">1094      * necessary to add &lt;code&gt;dstSavings&lt;/code&gt;.</span>
1095      * @serial
1096      */
1097     private int rawOffset;
1098 
1099     /**
1100      * A boolean value which is true if and only if this zone uses daylight
1101      * saving time.  If this value is false, several other fields are ignored.
1102      * @serial
1103      */
1104     private boolean useDaylight=false; // indicate if this time zone uses DST
1105 
1106     private static final int millisPerHour = 60*60*1000;
1107     private static final int millisPerDay  = 24*millisPerHour;
1108 
1109     /**
1110      * This field was serialized in JDK 1.1, so we have to keep it that way
1111      * to maintain serialization compatibility. However, there&#39;s no need to
1112      * recreate the array each time we create a new time zone.
1113      * @serial An array of bytes containing the values {31, 28, 31, 30, 31, 30,
1114      * 31, 31, 30, 31, 30, 31}.  This is ignored as of the Java 2 platform v1.2, however, it must
1115      * be streamed out for compatibility with JDK 1.1.
1116      */
1117     private final byte monthLength[] = staticMonthLength;
1118     private static final byte staticMonthLength[] = {31,28,31,30,31,30,31,31,30,31,30,31};
1119     private static final byte staticLeapMonthLength[] = {31,29,31,30,31,30,31,31,30,31,30,31};
1120 
1121     /**
1122      * Variables specifying the mode of the start rule.  Takes the following
1123      * values:
1124      * &lt;dl&gt;
<span class="line-modified">1125      * &lt;dt&gt;&lt;code&gt;DOM_MODE&lt;/code&gt;&lt;/dt&gt;</span>
1126      * &lt;dd&gt;
1127      * Exact day of week; e.g., March 1.
1128      * &lt;/dd&gt;
<span class="line-modified">1129      * &lt;dt&gt;&lt;code&gt;DOW_IN_MONTH_MODE&lt;/code&gt;&lt;/dt&gt;</span>
1130      * &lt;dd&gt;
1131      * Day of week in month; e.g., last Sunday in March.
1132      * &lt;/dd&gt;
<span class="line-modified">1133      * &lt;dt&gt;&lt;code&gt;DOW_GE_DOM_MODE&lt;/code&gt;&lt;/dt&gt;</span>
1134      * &lt;dd&gt;
1135      * Day of week after day of month; e.g., Sunday on or after March 15.
1136      * &lt;/dd&gt;
<span class="line-modified">1137      * &lt;dt&gt;&lt;code&gt;DOW_LE_DOM_MODE&lt;/code&gt;&lt;/dt&gt;</span>
1138      * &lt;dd&gt;
1139      * Day of week before day of month; e.g., Sunday on or before March 15.
1140      * &lt;/dd&gt;
1141      * &lt;/dl&gt;
1142      * The setting of this field affects the interpretation of the
<span class="line-modified">1143      * &lt;code&gt;startDay&lt;/code&gt; field.</span>
<span class="line-modified">1144      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
1145      * @serial
1146      * @since 1.1.4
1147      */
1148     private int startMode;
1149 
1150     /**
1151      * Variables specifying the mode of the end rule.  Takes the following
1152      * values:
1153      * &lt;dl&gt;
<span class="line-modified">1154      * &lt;dt&gt;&lt;code&gt;DOM_MODE&lt;/code&gt;&lt;/dt&gt;</span>
1155      * &lt;dd&gt;
1156      * Exact day of week; e.g., March 1.
1157      * &lt;/dd&gt;
<span class="line-modified">1158      * &lt;dt&gt;&lt;code&gt;DOW_IN_MONTH_MODE&lt;/code&gt;&lt;/dt&gt;</span>
1159      * &lt;dd&gt;
1160      * Day of week in month; e.g., last Sunday in March.
1161      * &lt;/dd&gt;
<span class="line-modified">1162      * &lt;dt&gt;&lt;code&gt;DOW_GE_DOM_MODE&lt;/code&gt;&lt;/dt&gt;</span>
1163      * &lt;dd&gt;
1164      * Day of week after day of month; e.g., Sunday on or after March 15.
1165      * &lt;/dd&gt;
<span class="line-modified">1166      * &lt;dt&gt;&lt;code&gt;DOW_LE_DOM_MODE&lt;/code&gt;&lt;/dt&gt;</span>
1167      * &lt;dd&gt;
1168      * Day of week before day of month; e.g., Sunday on or before March 15.
1169      * &lt;/dd&gt;
1170      * &lt;/dl&gt;
1171      * The setting of this field affects the interpretation of the
<span class="line-modified">1172      * &lt;code&gt;endDay&lt;/code&gt; field.</span>
<span class="line-modified">1173      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
1174      * @serial
1175      * @since 1.1.4
1176      */
1177     private int endMode;
1178 
1179     /**
1180      * A positive value indicating the amount of time saved during DST in
1181      * milliseconds.
1182      * Typically one hour (3600000); sometimes 30 minutes (1800000).
<span class="line-modified">1183      * &lt;p&gt;If &lt;code&gt;useDaylight&lt;/code&gt; is false, this value is ignored.</span>
1184      * @serial
1185      * @since 1.1.4
1186      */
1187     private int dstSavings;
1188 
1189     private static final Gregorian gcal = CalendarSystem.getGregorianCalendar();
1190 
1191     /**
1192      * Cache values representing a single period of daylight saving
1193      * time. Cache.start is the start time (inclusive) of daylight
1194      * saving time and Cache.end is the end time (exclusive).
1195      *
1196      * Cache.year has a year value if both Cache.start and Cache.end are
1197      * in the same year. Cache.year is set to startYear - 1 if
1198      * Cache.start and Cache.end are in different years.
1199      * Cache.year is a long to support Integer.MIN_VALUE - 1 (JCK requirement).
1200      */
1201     private static final class Cache {
1202         final long year;
1203         final long start;
</pre>
<hr />
<pre>
1225      * time.  Wall clock time is standard time for the onset rule, and
1226      * daylight time for the end rule.
1227      * @since 1.4
1228      */
1229     public static final int WALL_TIME = 0; // Zero for backward compatibility
1230 
1231     /**
1232      * Constant for a mode of start or end time specified as standard time.
1233      * @since 1.4
1234      */
1235     public static final int STANDARD_TIME = 1;
1236 
1237     /**
1238      * Constant for a mode of start or end time specified as UTC. European
1239      * Union rules are specified as UTC time, for example.
1240      * @since 1.4
1241      */
1242     public static final int UTC_TIME = 2;
1243 
1244     // Proclaim compatibility with 1.1

1245     static final long serialVersionUID = -403250971215465050L;
1246 
1247     // the internal serial version which says which version was written
1248     // - 0 (default) for version up to JDK 1.1.3
1249     // - 1 for version from JDK 1.1.4, which includes 3 new fields
1250     // - 2 for JDK 1.3, which includes 2 new fields
1251     static final int currentSerialVersion = 2;
1252 
1253     /**
1254      * The version of the serialized data on the stream.  Possible values:
1255      * &lt;dl&gt;
1256      * &lt;dt&gt;&lt;b&gt;0&lt;/b&gt; or not present on stream&lt;/dt&gt;
1257      * &lt;dd&gt;
1258      * JDK 1.1.3 or earlier.
1259      * &lt;/dd&gt;
1260      * &lt;dt&gt;&lt;b&gt;1&lt;/b&gt;&lt;/dt&gt;
1261      * &lt;dd&gt;
<span class="line-modified">1262      * JDK 1.1.4 or later.  Includes three new fields: &lt;code&gt;startMode&lt;/code&gt;,</span>
<span class="line-modified">1263      * &lt;code&gt;endMode&lt;/code&gt;, and &lt;code&gt;dstSavings&lt;/code&gt;.</span>
1264      * &lt;/dd&gt;
1265      * &lt;dt&gt;&lt;b&gt;2&lt;/b&gt;&lt;/dt&gt;
1266      * &lt;dd&gt;
<span class="line-modified">1267      * JDK 1.3 or later.  Includes two new fields: &lt;code&gt;startTimeMode&lt;/code&gt;</span>
<span class="line-modified">1268      * and &lt;code&gt;endTimeMode&lt;/code&gt;.</span>
1269      * &lt;/dd&gt;
1270      * &lt;/dl&gt;
1271      * When streaming out this class, the most recent format
<span class="line-modified">1272      * and the highest allowable &lt;code&gt;serialVersionOnStream&lt;/code&gt;</span>
1273      * is written.
1274      * @serial
1275      * @since 1.1.4
1276      */
1277     private int serialVersionOnStream = currentSerialVersion;
1278 
1279     // Maximum number of rules.
1280     private static final int MAX_RULE_NUM = 6;
1281 
1282     private void invalidateCache() {
1283         cache = null;
1284     }
1285 
1286     //----------------------------------------------------------------------
1287     // Rule representation
1288     //
1289     // We represent the following flavors of rules:
1290     //       5        the fifth of the month
1291     //       lastSun  the last Sunday in the month
1292     //       lastMon  the last Monday in the month
</pre>
<hr />
<pre>
1607     private int[] packTimes() {
1608         int[] times = new int[2];
1609         times[0] = startTime;
1610         times[1] = endTime;
1611         return times;
1612     }
1613 
1614     /**
1615      * Unpack the start and end times from an array of bytes.  This is required
1616      * as of serial version 2.
1617      */
1618     private void unpackTimes(int[] times) {
1619         startTime = times[0];
1620         endTime = times[1];
1621     }
1622 
1623     /**
1624      * Save the state of this object to a stream (i.e., serialize it).
1625      *
1626      * @serialData We write out two formats, a JDK 1.1 compatible format, using
<span class="line-modified">1627      * &lt;code&gt;DOW_IN_MONTH_MODE&lt;/code&gt; rules, in the required section, followed</span>
1628      * by the full rules, in packed format, in the optional section.  The
1629      * optional section will be ignored by JDK 1.1 code upon stream in.
1630      * &lt;p&gt; Contents of the optional section: The length of a byte array is
1631      * emitted (int); this is 4 as of this release. The byte array of the given
1632      * length is emitted. The contents of the byte array are the true values of
<span class="line-modified">1633      * the fields &lt;code&gt;startDay&lt;/code&gt;, &lt;code&gt;startDayOfWeek&lt;/code&gt;,</span>
<span class="line-modified">1634      * &lt;code&gt;endDay&lt;/code&gt;, and &lt;code&gt;endDayOfWeek&lt;/code&gt;.  The values of these</span>
1635      * fields in the required section are approximate values suited to the rule
<span class="line-modified">1636      * mode &lt;code&gt;DOW_IN_MONTH_MODE&lt;/code&gt;, which is the only mode recognized by</span>
1637      * JDK 1.1.
1638      */

1639     private void writeObject(ObjectOutputStream stream)
1640          throws IOException
1641     {
1642         // Construct a binary rule
1643         byte[] rules = packRules();
1644         int[] times = packTimes();
1645 
1646         // Convert to 1.1 FCS rules.  This step may cause us to lose information.
1647         makeRulesCompatible();
1648 
1649         // Write out the 1.1 FCS rules
1650         stream.defaultWriteObject();
1651 
1652         // Write out the binary rules in the optional data area of the stream.
1653         stream.writeInt(rules.length);
1654         stream.write(rules);
1655         stream.writeObject(times);
1656 
1657         // Recover the original rules.  This recovers the information lost
1658         // by makeRulesCompatible.
1659         unpackRules(rules);
1660         unpackTimes(times);
1661     }
1662 
1663     /**
1664      * Reconstitute this object from a stream (i.e., deserialize it).
1665      *
1666      * We handle both JDK 1.1
1667      * binary formats and full formats with a packed byte array.
1668      */

1669     private void readObject(ObjectInputStream stream)
1670          throws IOException, ClassNotFoundException
1671     {
1672         stream.defaultReadObject();
1673 
1674         if (serialVersionOnStream &lt; 1) {
1675             // Fix a bug in the 1.1 SimpleTimeZone code -- namely,
1676             // startDayOfWeek and endDayOfWeek were usually uninitialized.  We can&#39;t do
1677             // too much, so we assume SUNDAY, which actually works most of the time.
1678             if (startDayOfWeek == 0) {
1679                 startDayOfWeek = Calendar.SUNDAY;
1680             }
1681             if (endDayOfWeek == 0) {
1682                 endDayOfWeek = Calendar.SUNDAY;
1683             }
1684 
1685             // The variables dstSavings, startMode, and endMode are post-1.1, so they
1686             // won&#39;t be present if we&#39;re reading from a 1.1 stream.  Fix them up.
1687             startMode = endMode = DOW_IN_MONTH_MODE;
1688             dstSavings = millisPerHour;
</pre>
</td>
<td>
<hr />
<pre>
  31  * and owned by Taligent, Inc., a wholly-owned subsidiary of IBM. These
  32  * materials are provided under terms of a License Agreement between Taligent
  33  * and Sun. This technology is protected by multiple US and International
  34  * patents. This notice and attribution to Taligent may not be removed.
  35  *   Taligent is a registered trademark of Taligent, Inc.
  36  *
  37  */
  38 
  39 package java.util;
  40 
  41 import java.io.ObjectInputStream;
  42 import java.io.ObjectOutputStream;
  43 import java.io.IOException;
  44 import java.io.InvalidObjectException;
  45 import sun.util.calendar.CalendarSystem;
  46 import sun.util.calendar.CalendarUtils;
  47 import sun.util.calendar.BaseCalendar;
  48 import sun.util.calendar.Gregorian;
  49 
  50 /**
<span class="line-modified">  51  * {@code SimpleTimeZone} is a concrete subclass of {@code TimeZone}</span>
  52  * that represents a time zone for use with a Gregorian calendar.
  53  * The class holds an offset from GMT, called &lt;em&gt;raw offset&lt;/em&gt;, and start
  54  * and end rules for a daylight saving time schedule.  Since it only holds
  55  * single values for each, it cannot handle historical changes in the offset
  56  * from GMT and the daylight saving schedule, except that the {@link
  57  * #setStartYear setStartYear} method can specify the year when the daylight
  58  * saving time schedule starts in effect.
  59  * &lt;p&gt;
<span class="line-modified">  60  * To construct a {@code SimpleTimeZone} with a daylight saving time</span>
  61  * schedule, the schedule can be described with a set of rules,
  62  * &lt;em&gt;start-rule&lt;/em&gt; and &lt;em&gt;end-rule&lt;/em&gt;. A day when daylight saving time
  63  * starts or ends is specified by a combination of &lt;em&gt;month&lt;/em&gt;,
  64  * &lt;em&gt;day-of-month&lt;/em&gt;, and &lt;em&gt;day-of-week&lt;/em&gt; values. The &lt;em&gt;month&lt;/em&gt;
  65  * value is represented by a Calendar {@link Calendar#MONTH MONTH} field
  66  * value, such as {@link Calendar#MARCH}. The &lt;em&gt;day-of-week&lt;/em&gt; value is
  67  * represented by a Calendar {@link Calendar#DAY_OF_WEEK DAY_OF_WEEK} value,
  68  * such as {@link Calendar#SUNDAY SUNDAY}. The meanings of value combinations
  69  * are as follows.
  70  *
  71  * &lt;ul&gt;
  72  * &lt;li&gt;&lt;b&gt;Exact day of month&lt;/b&gt;&lt;br&gt;
  73  * To specify an exact day of month, set the &lt;em&gt;month&lt;/em&gt; and
  74  * &lt;em&gt;day-of-month&lt;/em&gt; to an exact value, and &lt;em&gt;day-of-week&lt;/em&gt; to zero. For
  75  * example, to specify March 1, set the &lt;em&gt;month&lt;/em&gt; to {@link Calendar#MARCH
  76  * MARCH}, &lt;em&gt;day-of-month&lt;/em&gt; to 1, and &lt;em&gt;day-of-week&lt;/em&gt; to 0.&lt;/li&gt;
  77  *
  78  * &lt;li&gt;&lt;b&gt;Day of week on or after day of month&lt;/b&gt;&lt;br&gt;
  79  * To specify a day of week on or after an exact day of month, set the
  80  * &lt;em&gt;month&lt;/em&gt; to an exact month value, &lt;em&gt;day-of-month&lt;/em&gt; to the day on
  81  * or after which the rule is applied, and &lt;em&gt;day-of-week&lt;/em&gt; to a negative {@link
  82  * Calendar#DAY_OF_WEEK DAY_OF_WEEK} field value. For example, to specify the
  83  * second Sunday of April, set &lt;em&gt;month&lt;/em&gt; to {@link Calendar#APRIL APRIL},
<span class="line-modified">  84  * &lt;em&gt;day-of-month&lt;/em&gt; to 8, and &lt;em&gt;day-of-week&lt;/em&gt; to {@code -}{@link</span>
  85  * Calendar#SUNDAY SUNDAY}.&lt;/li&gt;
  86  *
  87  * &lt;li&gt;&lt;b&gt;Day of week on or before day of month&lt;/b&gt;&lt;br&gt;
  88  * To specify a day of the week on or before an exact day of the month, set
  89  * &lt;em&gt;day-of-month&lt;/em&gt; and &lt;em&gt;day-of-week&lt;/em&gt; to a negative value. For
  90  * example, to specify the last Wednesday on or before the 21st of March, set
  91  * &lt;em&gt;month&lt;/em&gt; to {@link Calendar#MARCH MARCH}, &lt;em&gt;day-of-month&lt;/em&gt; is -21
<span class="line-modified">  92  * and &lt;em&gt;day-of-week&lt;/em&gt; is {@code -}{@link Calendar#WEDNESDAY WEDNESDAY}. &lt;/li&gt;</span>
  93  *
  94  * &lt;li&gt;&lt;b&gt;Last day-of-week of month&lt;/b&gt;&lt;br&gt;
  95  * To specify, the last day-of-week of the month, set &lt;em&gt;day-of-week&lt;/em&gt; to a
  96  * {@link Calendar#DAY_OF_WEEK DAY_OF_WEEK} value and &lt;em&gt;day-of-month&lt;/em&gt; to
  97  * -1. For example, to specify the last Sunday of October, set &lt;em&gt;month&lt;/em&gt;
  98  * to {@link Calendar#OCTOBER OCTOBER}, &lt;em&gt;day-of-week&lt;/em&gt; to {@link
  99  * Calendar#SUNDAY SUNDAY} and &lt;em&gt;day-of-month&lt;/em&gt; to -1.  &lt;/li&gt;
 100  *
 101  * &lt;/ul&gt;
 102  * The time of the day at which daylight saving time starts or ends is
 103  * specified by a millisecond value within the day. There are three kinds of
 104  * &lt;em&gt;mode&lt;/em&gt;s to specify the time: {@link #WALL_TIME}, {@link
 105  * #STANDARD_TIME} and {@link #UTC_TIME}. For example, if daylight
 106  * saving time ends
 107  * at 2:00 am in the wall clock time, it can be specified by 7200000
 108  * milliseconds in the {@link #WALL_TIME} mode. In this case, the wall clock time
 109  * for an &lt;em&gt;end-rule&lt;/em&gt; means the same thing as the daylight time.
 110  * &lt;p&gt;
 111  * The following are examples of parameters for constructing time zone objects.
 112  * &lt;pre&gt;&lt;code&gt;
</pre>
<hr />
<pre>
 122  *                     7200000,
 123  *                     Calendar.OCTOBER, -1, Calendar.SUNDAY,
 124  *                     7200000,
 125  *                     3600000)
 126  *
 127  *      // Base GMT offset: +1:00
 128  *      // DST starts:      at 1:00am in UTC time
 129  *      //                  on the last Sunday in March
 130  *      // DST ends:        at 1:00am in UTC time
 131  *      //                  on the last Sunday in October
 132  *      // Save:            1 hour
 133  *      SimpleTimeZone(3600000,
 134  *                     &quot;Europe/Paris&quot;,
 135  *                     Calendar.MARCH, -1, Calendar.SUNDAY,
 136  *                     3600000, SimpleTimeZone.UTC_TIME,
 137  *                     Calendar.OCTOBER, -1, Calendar.SUNDAY,
 138  *                     3600000, SimpleTimeZone.UTC_TIME,
 139  *                     3600000)
 140  * &lt;/code&gt;&lt;/pre&gt;
 141  * These parameter rules are also applicable to the set rule methods, such as
<span class="line-modified"> 142  * {@code setStartRule}.</span>
 143  *
 144  * @since 1.1
 145  * @see      Calendar
 146  * @see      GregorianCalendar
 147  * @see      TimeZone
 148  * @author   David Goldsmith, Mark Davis, Chen-Lieh Huang, Alan Liu
 149  */
 150 
 151 public class SimpleTimeZone extends TimeZone {
 152     /**
 153      * Constructs a SimpleTimeZone with the given base time zone offset from GMT
 154      * and time zone ID with no daylight saving time schedule.
 155      *
 156      * @param rawOffset  The base time zone offset in milliseconds to GMT.
 157      * @param ID         The time zone name that is given to this instance.
 158      */
 159     public SimpleTimeZone(int rawOffset, String ID)
 160     {
 161         this.rawOffset = rawOffset;
 162         setID (ID);
 163         dstSavings = millisPerHour; // In case user sets rules later
 164     }
 165 
 166     /**
 167      * Constructs a SimpleTimeZone with the given base time zone offset from
 168      * GMT, time zone ID, and rules for starting and ending the daylight
 169      * time.
<span class="line-modified"> 170      * Both {@code startTime} and {@code endTime} are specified to be</span>
 171      * represented in the wall clock time. The amount of daylight saving is
 172      * assumed to be 3600000 milliseconds (i.e., one hour). This constructor is
 173      * equivalent to:
 174      * &lt;pre&gt;&lt;code&gt;
 175      *     SimpleTimeZone(rawOffset,
 176      *                    ID,
 177      *                    startMonth,
 178      *                    startDay,
 179      *                    startDayOfWeek,
 180      *                    startTime,
 181      *                    SimpleTimeZone.{@link #WALL_TIME},
 182      *                    endMonth,
 183      *                    endDay,
 184      *                    endDayOfWeek,
 185      *                    endTime,
 186      *                    SimpleTimeZone.{@link #WALL_TIME},
 187      *                    3600000)
 188      * &lt;/code&gt;&lt;/pre&gt;
 189      *
 190      * @param rawOffset       The given base time zone offset from GMT.
</pre>
<hr />
<pre>
 192      * @param startMonth      The daylight saving time starting month. Month is
 193      *                        a {@link Calendar#MONTH MONTH} field value (0-based. e.g., 0
 194      *                        for January).
 195      * @param startDay        The day of the month on which the daylight saving time starts.
 196      *                        See the class description for the special cases of this parameter.
 197      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 198      *                        See the class description for the special cases of this parameter.
 199      * @param startTime       The daylight saving time starting time in local wall clock
 200      *                        time (in milliseconds within the day), which is local
 201      *                        standard time in this case.
 202      * @param endMonth        The daylight saving time ending month. Month is
 203      *                        a {@link Calendar#MONTH MONTH} field
 204      *                        value (0-based. e.g., 9 for October).
 205      * @param endDay          The day of the month on which the daylight saving time ends.
 206      *                        See the class description for the special cases of this parameter.
 207      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 208      *                        See the class description for the special cases of this parameter.
 209      * @param endTime         The daylight saving ending time in local wall clock time,
 210      *                        (in milliseconds within the day) which is local daylight
 211      *                        time in this case.
<span class="line-modified"> 212      * @throws    IllegalArgumentException if the month, day, dayOfWeek, or time</span>
 213      * parameters are out of range for the start or end rule
 214      */
 215     public SimpleTimeZone(int rawOffset, String ID,
 216                           int startMonth, int startDay, int startDayOfWeek, int startTime,
 217                           int endMonth, int endDay, int endDayOfWeek, int endTime)
 218     {
 219         this(rawOffset, ID,
 220              startMonth, startDay, startDayOfWeek, startTime, WALL_TIME,
 221              endMonth, endDay, endDayOfWeek, endTime, WALL_TIME,
 222              millisPerHour);
 223     }
 224 
 225     /**
 226      * Constructs a SimpleTimeZone with the given base time zone offset from
 227      * GMT, time zone ID, and rules for starting and ending the daylight
 228      * time.
<span class="line-modified"> 229      * Both {@code startTime} and {@code endTime} are assumed to be</span>
 230      * represented in the wall clock time. This constructor is equivalent to:
 231      * &lt;pre&gt;&lt;code&gt;
 232      *     SimpleTimeZone(rawOffset,
 233      *                    ID,
 234      *                    startMonth,
 235      *                    startDay,
 236      *                    startDayOfWeek,
 237      *                    startTime,
 238      *                    SimpleTimeZone.{@link #WALL_TIME},
 239      *                    endMonth,
 240      *                    endDay,
 241      *                    endDayOfWeek,
 242      *                    endTime,
 243      *                    SimpleTimeZone.{@link #WALL_TIME},
 244      *                    dstSavings)
 245      * &lt;/code&gt;&lt;/pre&gt;
 246      *
 247      * @param rawOffset       The given base time zone offset from GMT.
 248      * @param ID              The time zone ID which is given to this object.
 249      * @param startMonth      The daylight saving time starting month. Month is
 250      *                        a {@link Calendar#MONTH MONTH} field
 251      *                        value (0-based. e.g., 0 for January).
 252      * @param startDay        The day of the month on which the daylight saving time starts.
 253      *                        See the class description for the special cases of this parameter.
 254      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 255      *                        See the class description for the special cases of this parameter.
 256      * @param startTime       The daylight saving time starting time in local wall clock
 257      *                        time, which is local standard time in this case.
 258      * @param endMonth        The daylight saving time ending month. Month is
 259      *                        a {@link Calendar#MONTH MONTH} field
 260      *                        value (0-based. e.g., 9 for October).
 261      * @param endDay          The day of the month on which the daylight saving time ends.
 262      *                        See the class description for the special cases of this parameter.
 263      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 264      *                        See the class description for the special cases of this parameter.
 265      * @param endTime         The daylight saving ending time in local wall clock time,
 266      *                        which is local daylight time in this case.
 267      * @param dstSavings      The amount of time in milliseconds saved during
 268      *                        daylight saving time.
<span class="line-modified"> 269      * @throws    IllegalArgumentException if the month, day, dayOfWeek, or time</span>
 270      * parameters are out of range for the start or end rule
 271      * @since 1.2
 272      */
 273     public SimpleTimeZone(int rawOffset, String ID,
 274                           int startMonth, int startDay, int startDayOfWeek, int startTime,
 275                           int endMonth, int endDay, int endDayOfWeek, int endTime,
 276                           int dstSavings)
 277     {
 278         this(rawOffset, ID,
 279              startMonth, startDay, startDayOfWeek, startTime, WALL_TIME,
 280              endMonth, endDay, endDayOfWeek, endTime, WALL_TIME,
 281              dstSavings);
 282     }
 283 
 284     /**
 285      * Constructs a SimpleTimeZone with the given base time zone offset from
 286      * GMT, time zone ID, and rules for starting and ending the daylight
 287      * time.
 288      * This constructor takes the full set of the start and end rules
<span class="line-modified"> 289      * parameters, including modes of {@code startTime} and</span>
<span class="line-modified"> 290      * {@code endTime}. The mode specifies either {@link #WALL_TIME wall</span>
 291      * time} or {@link #STANDARD_TIME standard time} or {@link #UTC_TIME UTC
 292      * time}.
 293      *
 294      * @param rawOffset       The given base time zone offset from GMT.
 295      * @param ID              The time zone ID which is given to this object.
 296      * @param startMonth      The daylight saving time starting month. Month is
 297      *                        a {@link Calendar#MONTH MONTH} field
 298      *                        value (0-based. e.g., 0 for January).
 299      * @param startDay        The day of the month on which the daylight saving time starts.
 300      *                        See the class description for the special cases of this parameter.
 301      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 302      *                        See the class description for the special cases of this parameter.
 303      * @param startTime       The daylight saving time starting time in the time mode
<span class="line-modified"> 304      *                        specified by {@code startTimeMode}.</span>
 305      * @param startTimeMode   The mode of the start time specified by startTime.
 306      * @param endMonth        The daylight saving time ending month. Month is
 307      *                        a {@link Calendar#MONTH MONTH} field
 308      *                        value (0-based. e.g., 9 for October).
 309      * @param endDay          The day of the month on which the daylight saving time ends.
 310      *                        See the class description for the special cases of this parameter.
 311      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 312      *                        See the class description for the special cases of this parameter.
 313      * @param endTime         The daylight saving ending time in time mode
<span class="line-modified"> 314      *                        specified by {@code endTimeMode}.</span>
 315      * @param endTimeMode     The mode of the end time specified by endTime
 316      * @param dstSavings      The amount of time in milliseconds saved during
 317      *                        daylight saving time.
 318      *
<span class="line-modified"> 319      * @throws    IllegalArgumentException if the month, day, dayOfWeek, time more, or</span>
 320      * time parameters are out of range for the start or end rule, or if a time mode
 321      * value is invalid.
 322      *
 323      * @see #WALL_TIME
 324      * @see #STANDARD_TIME
 325      * @see #UTC_TIME
 326      *
 327      * @since 1.4
 328      */
 329     public SimpleTimeZone(int rawOffset, String ID,
 330                           int startMonth, int startDay, int startDayOfWeek,
 331                           int startTime, int startTimeMode,
 332                           int endMonth, int endDay, int endDayOfWeek,
 333                           int endTime, int endTimeMode,
 334                           int dstSavings) {
 335 
 336         setID(ID);
 337         this.rawOffset      = rawOffset;
 338         this.startMonth     = startMonth;
 339         this.startDay       = startDay;
</pre>
<hr />
<pre>
 352         if (dstSavings &lt;= 0) {
 353             throw new IllegalArgumentException(&quot;Illegal daylight saving value: &quot; + dstSavings);
 354         }
 355     }
 356 
 357     /**
 358      * Sets the daylight saving time starting year.
 359      *
 360      * @param year  The daylight saving starting year.
 361      */
 362     public void setStartYear(int year)
 363     {
 364         startYear = year;
 365         invalidateCache();
 366     }
 367 
 368     /**
 369      * Sets the daylight saving time start rule. For example, if daylight saving
 370      * time starts on the first Sunday in April at 2 am in local wall clock
 371      * time, you can set the start rule by calling:
<span class="line-modified"> 372      * &lt;pre&gt;{@code setStartRule(Calendar.APRIL, 1, Calendar.SUNDAY, 2*60*60*1000);}&lt;/pre&gt;</span>
 373      *
 374      * @param startMonth      The daylight saving time starting month. Month is
 375      *                        a {@link Calendar#MONTH MONTH} field
 376      *                        value (0-based. e.g., 0 for January).
 377      * @param startDay        The day of the month on which the daylight saving time starts.
 378      *                        See the class description for the special cases of this parameter.
 379      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 380      *                        See the class description for the special cases of this parameter.
 381      * @param startTime       The daylight saving time starting time in local wall clock
 382      *                        time, which is local standard time in this case.
<span class="line-modified"> 383      * @throws    IllegalArgumentException if the {@code startMonth}, {@code startDay},</span>
<span class="line-modified"> 384      * {@code startDayOfWeek}, or {@code startTime} parameters are out of range</span>
 385      */
 386     public void setStartRule(int startMonth, int startDay, int startDayOfWeek, int startTime)
 387     {
 388         this.startMonth = startMonth;
 389         this.startDay = startDay;
 390         this.startDayOfWeek = startDayOfWeek;
 391         this.startTime = startTime;
 392         startTimeMode = WALL_TIME;
 393         decodeStartRule();
 394         invalidateCache();
 395     }
 396 
 397     /**
 398      * Sets the daylight saving time start rule to a fixed date within a month.
 399      * This method is equivalent to:
<span class="line-modified"> 400      * &lt;pre&gt;{@code setStartRule(startMonth, startDay, 0, startTime)}&lt;/pre&gt;</span>
 401      *
 402      * @param startMonth      The daylight saving time starting month. Month is
 403      *                        a {@link Calendar#MONTH MONTH} field
 404      *                        value (0-based. e.g., 0 for January).
 405      * @param startDay        The day of the month on which the daylight saving time starts.
 406      * @param startTime       The daylight saving time starting time in local wall clock
 407      *                        time, which is local standard time in this case.
 408      *                        See the class description for the special cases of this parameter.
<span class="line-modified"> 409      * @throws    IllegalArgumentException if the {@code startMonth},</span>
<span class="line-modified"> 410      * {@code startDayOfMonth}, or {@code startTime} parameters are out of range</span>
 411      * @since 1.2
 412      */
 413     public void setStartRule(int startMonth, int startDay, int startTime) {
 414         setStartRule(startMonth, startDay, 0, startTime);
 415     }
 416 
 417     /**
 418      * Sets the daylight saving time start rule to a weekday before or after the given date within
 419      * a month, e.g., the first Monday on or after the 8th.
 420      *
 421      * @param startMonth      The daylight saving time starting month. Month is
 422      *                        a {@link Calendar#MONTH MONTH} field
 423      *                        value (0-based. e.g., 0 for January).
 424      * @param startDay        The day of the month on which the daylight saving time starts.
 425      * @param startDayOfWeek  The daylight saving time starting day-of-week.
 426      * @param startTime       The daylight saving time starting time in local wall clock
 427      *                        time, which is local standard time in this case.
<span class="line-modified"> 428      * @param after           If true, this rule selects the first {@code dayOfWeek} on or</span>
<span class="line-modified"> 429      *                        &lt;em&gt;after&lt;/em&gt; {@code dayOfMonth}.  If false, this rule</span>
<span class="line-modified"> 430      *                        selects the last {@code dayOfWeek} on or &lt;em&gt;before&lt;/em&gt;</span>
<span class="line-modified"> 431      *                        {@code dayOfMonth}.</span>
<span class="line-modified"> 432      * @throws    IllegalArgumentException if the {@code startMonth}, {@code startDay},</span>
<span class="line-modified"> 433      * {@code startDayOfWeek}, or {@code startTime} parameters are out of range</span>
 434      * @since 1.2
 435      */
 436     public void setStartRule(int startMonth, int startDay, int startDayOfWeek,
 437                              int startTime, boolean after)
 438     {
 439         // TODO: this method doesn&#39;t check the initial values of dayOfMonth or dayOfWeek.
 440         if (after) {
 441             setStartRule(startMonth, startDay, -startDayOfWeek, startTime);
 442         } else {
 443             setStartRule(startMonth, -startDay, -startDayOfWeek, startTime);
 444         }
 445     }
 446 
 447     /**
 448      * Sets the daylight saving time end rule. For example, if daylight saving time
 449      * ends on the last Sunday in October at 2 am in wall clock time,
 450      * you can set the end rule by calling:
<span class="line-modified"> 451      * {@code setEndRule(Calendar.OCTOBER, -1, Calendar.SUNDAY, 2*60*60*1000);}</span>
 452      *
 453      * @param endMonth        The daylight saving time ending month. Month is
 454      *                        a {@link Calendar#MONTH MONTH} field
 455      *                        value (0-based. e.g., 9 for October).
 456      * @param endDay          The day of the month on which the daylight saving time ends.
 457      *                        See the class description for the special cases of this parameter.
 458      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 459      *                        See the class description for the special cases of this parameter.
 460      * @param endTime         The daylight saving ending time in local wall clock time,
 461      *                        (in milliseconds within the day) which is local daylight
 462      *                        time in this case.
<span class="line-modified"> 463      * @throws    IllegalArgumentException if the {@code endMonth}, {@code endDay},</span>
<span class="line-modified"> 464      * {@code endDayOfWeek}, or {@code endTime} parameters are out of range</span>
 465      */
 466     public void setEndRule(int endMonth, int endDay, int endDayOfWeek,
 467                            int endTime)
 468     {
 469         this.endMonth = endMonth;
 470         this.endDay = endDay;
 471         this.endDayOfWeek = endDayOfWeek;
 472         this.endTime = endTime;
 473         this.endTimeMode = WALL_TIME;
 474         decodeEndRule();
 475         invalidateCache();
 476     }
 477 
 478     /**
 479      * Sets the daylight saving time end rule to a fixed date within a month.
 480      * This method is equivalent to:
<span class="line-modified"> 481      * &lt;pre&gt;{@code setEndRule(endMonth, endDay, 0, endTime)}&lt;/pre&gt;</span>
 482      *
 483      * @param endMonth        The daylight saving time ending month. Month is
 484      *                        a {@link Calendar#MONTH MONTH} field
 485      *                        value (0-based. e.g., 9 for October).
 486      * @param endDay          The day of the month on which the daylight saving time ends.
 487      * @param endTime         The daylight saving ending time in local wall clock time,
 488      *                        (in milliseconds within the day) which is local daylight
 489      *                        time in this case.
<span class="line-modified"> 490      * @throws    IllegalArgumentException the {@code endMonth}, {@code endDay},</span>
<span class="line-modified"> 491      * or {@code endTime} parameters are out of range</span>
 492      * @since 1.2
 493      */
 494     public void setEndRule(int endMonth, int endDay, int endTime)
 495     {
 496         setEndRule(endMonth, endDay, 0, endTime);
 497     }
 498 
 499     /**
 500      * Sets the daylight saving time end rule to a weekday before or after the given date within
 501      * a month, e.g., the first Monday on or after the 8th.
 502      *
 503      * @param endMonth        The daylight saving time ending month. Month is
 504      *                        a {@link Calendar#MONTH MONTH} field
 505      *                        value (0-based. e.g., 9 for October).
 506      * @param endDay          The day of the month on which the daylight saving time ends.
 507      * @param endDayOfWeek    The daylight saving time ending day-of-week.
 508      * @param endTime         The daylight saving ending time in local wall clock time,
 509      *                        (in milliseconds within the day) which is local daylight
 510      *                        time in this case.
<span class="line-modified"> 511      * @param after           If true, this rule selects the first {@code endDayOfWeek} on</span>
<span class="line-modified"> 512      *                        or &lt;em&gt;after&lt;/em&gt; {@code endDay}.  If false, this rule</span>
<span class="line-modified"> 513      *                        selects the last {@code endDayOfWeek} on or before</span>
<span class="line-modified"> 514      *                        {@code endDay} of the month.</span>
<span class="line-modified"> 515      * @throws    IllegalArgumentException the {@code endMonth}, {@code endDay},</span>
<span class="line-modified"> 516      * {@code endDayOfWeek}, or {@code endTime} parameters are out of range</span>
 517      * @since 1.2
 518      */
 519     public void setEndRule(int endMonth, int endDay, int endDayOfWeek, int endTime, boolean after)
 520     {
 521         if (after) {
 522             setEndRule(endMonth, endDay, -endDayOfWeek, endTime);
 523         } else {
 524             setEndRule(endMonth, -endDay, -endDayOfWeek, endTime);
 525         }
 526     }
 527 
 528     /**
 529      * Returns the offset of this time zone from UTC at the given
 530      * time. If daylight saving time is in effect at the given time,
 531      * the offset value is adjusted with the amount of daylight
 532      * saving.
 533      *
 534      * @param date the time at which the time zone offset is found
 535      * @return the amount of time in milliseconds to add to UTC to get
 536      * local time.
</pre>
<hr />
<pre>
 566                 cdate.setTimeOfDay(0, 0, 0, 0);
 567                 offset = getOffset(cal, cdate, year, date);
 568             }
 569         }
 570 
 571         if (offsets != null) {
 572             offsets[0] = rawOffset;
 573             offsets[1] = offset - rawOffset;
 574         }
 575         return offset;
 576     }
 577 
 578    /**
 579      * Returns the difference in milliseconds between local time and
 580      * UTC, taking into account both the raw offset and the effect of
 581      * daylight saving, for the specified date and time.  This method
 582      * assumes that the start and end month are distinct.  It also
 583      * uses a default {@link GregorianCalendar} object as its
 584      * underlying calendar, such as for determining leap years.  Do
 585      * not use the result of this method with a calendar other than a
<span class="line-modified"> 586      * default {@code GregorianCalendar}.</span>
 587      *
 588      * &lt;p&gt;&lt;em&gt;Note:  In general, clients should use
<span class="line-modified"> 589      * {@code Calendar.get(ZONE_OFFSET) + Calendar.get(DST_OFFSET)}</span>
 590      * instead of calling this method.&lt;/em&gt;
 591      *
 592      * @param era       The era of the given date.
 593      * @param year      The year in the given date.
 594      * @param month     The month in the given date. Month is 0-based. e.g.,
 595      *                  0 for January.
 596      * @param day       The day-in-month of the given date.
 597      * @param dayOfWeek The day-of-week of the given date.
 598      * @param millis    The milliseconds in day in &lt;em&gt;standard&lt;/em&gt; local time.
 599      * @return          The milliseconds to add to UTC to get local time.
<span class="line-modified"> 600      * @throws          IllegalArgumentException the {@code era},</span>
<span class="line-modified"> 601      *                  {@code month}, {@code day}, {@code dayOfWeek},</span>
<span class="line-modified"> 602      *                  or {@code millis} parameters are out of range</span>
 603      */
 604     public int getOffset(int era, int year, int month, int day, int dayOfWeek,
 605                          int millis)
 606     {
 607         if (era != GregorianCalendar.AD &amp;&amp; era != GregorianCalendar.BC) {
 608             throw new IllegalArgumentException(&quot;Illegal era &quot; + era);
 609         }
 610 
 611         int y = year;
 612         if (era == GregorianCalendar.BC) {
 613             // adjust y with the GregorianCalendar-style year numbering.
 614             y = 1 - y;
 615         }
 616 
 617         // If the year isn&#39;t representable with the 64-bit long
 618         // integer in milliseconds, convert the year to an
 619         // equivalent year. This is required to pass some JCK test cases
 620         // which are actually useless though because the specified years
 621         // can&#39;t be supported by the Java time system.
 622         if (y &gt;= 292278994) {
</pre>
<hr />
<pre>
 836      * @return {@code true} if this {@code SimpleTimeZone} observes
 837      * Daylight Saving Time; {@code false} otherwise.
 838      * @since 1.7
 839      */
 840     @Override
 841     public boolean observesDaylightTime() {
 842         return useDaylightTime();
 843     }
 844 
 845     /**
 846      * Queries if the given date is in daylight saving time.
 847      * @return true if daylight saving time is in effective at the
 848      * given date; false otherwise.
 849      */
 850     public boolean inDaylightTime(Date date)
 851     {
 852         return (getOffset(date.getTime()) != rawOffset);
 853     }
 854 
 855     /**
<span class="line-modified"> 856      * Returns a clone of this {@code SimpleTimeZone} instance.</span>
 857      * @return a clone of this instance.
 858      */
 859     public Object clone()
 860     {
 861         return super.clone();
 862     }
 863 
 864     /**
 865      * Generates the hash code for the SimpleDateFormat object.
 866      * @return the hash code for this object
 867      */
 868     public int hashCode()
 869     {
 870         return startMonth ^ startDay ^ startDayOfWeek ^ startTime ^
 871             endMonth ^ endDay ^ endDayOfWeek ^ endTime ^ rawOffset;
 872     }
 873 
 874     /**
<span class="line-modified"> 875      * Compares the equality of two {@code SimpleTimeZone} objects.</span>
 876      *
<span class="line-modified"> 877      * @param obj  The {@code SimpleTimeZone} object to be compared with.</span>
<span class="line-modified"> 878      * @return     True if the given {@code obj} is the same as this</span>
<span class="line-modified"> 879      *             {@code SimpleTimeZone} object; false otherwise.</span>
 880      */
 881     public boolean equals(Object obj)
 882     {
 883         if (this == obj) {
 884             return true;
 885         }
 886         if (!(obj instanceof SimpleTimeZone)) {
 887             return false;
 888         }
 889 
 890         SimpleTimeZone that = (SimpleTimeZone) obj;
 891 
 892         return getID().equals(that.getID()) &amp;&amp;
 893             hasSameRules(that);
 894     }
 895 
 896     /**
<span class="line-modified"> 897      * Returns {@code true} if this zone has the same rules and offset as another zone.</span>
 898      * @param other the TimeZone object to be compared with
<span class="line-modified"> 899      * @return {@code true} if the given zone is a SimpleTimeZone and has the</span>
 900      * same rules and offset as this one
 901      * @since 1.2
 902      */
 903     public boolean hasSameRules(TimeZone other) {
 904         if (this == other) {
 905             return true;
 906         }
 907         if (!(other instanceof SimpleTimeZone)) {
 908             return false;
 909         }
 910         SimpleTimeZone that = (SimpleTimeZone) other;
 911         return rawOffset == that.rawOffset &amp;&amp;
 912             useDaylight == that.useDaylight &amp;&amp;
 913             (!useDaylight
 914              // Only check rules if using DST
 915              || (dstSavings == that.dstSavings &amp;&amp;
 916                  startMode == that.startMode &amp;&amp;
 917                  startMonth == that.startMonth &amp;&amp;
 918                  startDay == that.startDay &amp;&amp;
 919                  startDayOfWeek == that.startDayOfWeek &amp;&amp;
</pre>
<hr />
<pre>
 940             &quot;,useDaylight=&quot; + useDaylight +
 941             &quot;,startYear=&quot; + startYear +
 942             &quot;,startMode=&quot; + startMode +
 943             &quot;,startMonth=&quot; + startMonth +
 944             &quot;,startDay=&quot; + startDay +
 945             &quot;,startDayOfWeek=&quot; + startDayOfWeek +
 946             &quot;,startTime=&quot; + startTime +
 947             &quot;,startTimeMode=&quot; + startTimeMode +
 948             &quot;,endMode=&quot; + endMode +
 949             &quot;,endMonth=&quot; + endMonth +
 950             &quot;,endDay=&quot; + endDay +
 951             &quot;,endDayOfWeek=&quot; + endDayOfWeek +
 952             &quot;,endTime=&quot; + endTime +
 953             &quot;,endTimeMode=&quot; + endTimeMode + &#39;]&#39;;
 954     }
 955 
 956     // =======================privates===============================
 957 
 958     /**
 959      * The month in which daylight saving time starts.  This value must be
<span class="line-modified"> 960      * between {@code Calendar.JANUARY} and</span>
<span class="line-modified"> 961      * {@code Calendar.DECEMBER} inclusive.  This value must not equal</span>
<span class="line-modified"> 962      * {@code endMonth}.</span>
<span class="line-modified"> 963      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
 964      * @serial
 965      */
 966     private int startMonth;
 967 
 968     /**
 969      * This field has two possible interpretations:
 970      * &lt;dl&gt;
<span class="line-modified"> 971      * &lt;dt&gt;{@code startMode == DOW_IN_MONTH}&lt;/dt&gt;</span>
 972      * &lt;dd&gt;
<span class="line-modified"> 973      * {@code startDay} indicates the day of the month of</span>
<span class="line-modified"> 974      * {@code startMonth} on which daylight</span>
 975      * saving time starts, from 1 to 28, 30, or 31, depending on the
<span class="line-modified"> 976      * {@code startMonth}.</span>
 977      * &lt;/dd&gt;
<span class="line-modified"> 978      * &lt;dt&gt;{@code startMode != DOW_IN_MONTH}&lt;/dt&gt;</span>
 979      * &lt;dd&gt;
<span class="line-modified"> 980      * {@code startDay} indicates which {@code startDayOfWeek} in the</span>
<span class="line-modified"> 981      * month {@code startMonth} daylight</span>
 982      * saving time starts on.  For example, a value of +1 and a
<span class="line-modified"> 983      * {@code startDayOfWeek} of {@code Calendar.SUNDAY} indicates the</span>
<span class="line-modified"> 984      * first Sunday of {@code startMonth}.  Likewise, +2 would indicate the</span>
 985      * second Sunday, and -1 the last Sunday.  A value of 0 is illegal.
 986      * &lt;/dd&gt;
 987      * &lt;/dl&gt;
<span class="line-modified"> 988      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
 989      * @serial
 990      */
 991     private int startDay;
 992 
 993     /**
 994      * The day of the week on which daylight saving time starts.  This value
<span class="line-modified"> 995      * must be between {@code Calendar.SUNDAY} and</span>
<span class="line-modified"> 996      * {@code Calendar.SATURDAY} inclusive.</span>
<span class="line-modified"> 997      * &lt;p&gt;If {@code useDaylight} is false or</span>
<span class="line-modified"> 998      * {@code startMode == DAY_OF_MONTH}, this value is ignored.</span>
 999      * @serial
1000      */
1001     private int startDayOfWeek;
1002 
1003     /**
1004      * The time in milliseconds after midnight at which daylight saving
1005      * time starts.  This value is expressed as wall time, standard time,
<span class="line-modified">1006      * or UTC time, depending on the setting of {@code startTimeMode}.</span>
<span class="line-modified">1007      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
1008      * @serial
1009      */
1010     private int startTime;
1011 
1012     /**
1013      * The format of startTime, either WALL_TIME, STANDARD_TIME, or UTC_TIME.
1014      * @serial
1015      * @since 1.3
1016      */
1017     private int startTimeMode;
1018 
1019     /**
1020      * The month in which daylight saving time ends.  This value must be
<span class="line-modified">1021      * between {@code Calendar.JANUARY} and</span>
<span class="line-modified">1022      * {@code Calendar.UNDECIMBER}.  This value must not equal</span>
<span class="line-modified">1023      * {@code startMonth}.</span>
<span class="line-modified">1024      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
1025      * @serial
1026      */
1027     private int endMonth;
1028 
1029     /**
1030      * This field has two possible interpretations:
1031      * &lt;dl&gt;
<span class="line-modified">1032      * &lt;dt&gt;{@code endMode == DOW_IN_MONTH}&lt;/dt&gt;</span>
1033      * &lt;dd&gt;
<span class="line-modified">1034      * {@code endDay} indicates the day of the month of</span>
<span class="line-modified">1035      * {@code endMonth} on which daylight</span>
1036      * saving time ends, from 1 to 28, 30, or 31, depending on the
<span class="line-modified">1037      * {@code endMonth}.</span>
1038      * &lt;/dd&gt;
<span class="line-modified">1039      * &lt;dt&gt;{@code endMode != DOW_IN_MONTH}&lt;/dt&gt;</span>
1040      * &lt;dd&gt;
<span class="line-modified">1041      * {@code endDay} indicates which {@code endDayOfWeek} in th</span>
<span class="line-modified">1042      * month {@code endMonth} daylight</span>
1043      * saving time ends on.  For example, a value of +1 and a
<span class="line-modified">1044      * {@code endDayOfWeek} of {@code Calendar.SUNDAY} indicates the</span>
<span class="line-modified">1045      * first Sunday of {@code endMonth}.  Likewise, +2 would indicate the</span>
1046      * second Sunday, and -1 the last Sunday.  A value of 0 is illegal.
1047      * &lt;/dd&gt;
1048      * &lt;/dl&gt;
<span class="line-modified">1049      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
1050      * @serial
1051      */
1052     private int endDay;
1053 
1054     /**
1055      * The day of the week on which daylight saving time ends.  This value
<span class="line-modified">1056      * must be between {@code Calendar.SUNDAY} and</span>
<span class="line-modified">1057      * {@code Calendar.SATURDAY} inclusive.</span>
<span class="line-modified">1058      * &lt;p&gt;If {@code useDaylight} is false or</span>
<span class="line-modified">1059      * {@code endMode == DAY_OF_MONTH}, this value is ignored.</span>
1060      * @serial
1061      */
1062     private int endDayOfWeek;
1063 
1064     /**
1065      * The time in milliseconds after midnight at which daylight saving
1066      * time ends.  This value is expressed as wall time, standard time,
<span class="line-modified">1067      * or UTC time, depending on the setting of {@code endTimeMode}.</span>
<span class="line-modified">1068      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
1069      * @serial
1070      */
1071     private int endTime;
1072 
1073     /**
<span class="line-modified">1074      * The format of endTime, either {@code WALL_TIME},</span>
<span class="line-modified">1075      * {@code STANDARD_TIME}, or {@code UTC_TIME}.</span>
1076      * @serial
1077      * @since 1.3
1078      */
1079     private int endTimeMode;
1080 
1081     /**
1082      * The year in which daylight saving time is first observed.  This is an {@link GregorianCalendar#AD AD}
1083      * value.  If this value is less than 1 then daylight saving time is observed
<span class="line-modified">1084      * for all {@code AD} years.</span>
<span class="line-modified">1085      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
1086      * @serial
1087      */
1088     private int startYear;
1089 
1090     /**
1091      * The offset in milliseconds between this zone and GMT.  Negative offsets
1092      * are to the west of Greenwich.  To obtain local &lt;em&gt;standard&lt;/em&gt; time,
1093      * add the offset to GMT time.  To obtain local wall time it may also be
<span class="line-modified">1094      * necessary to add {@code dstSavings}.</span>
1095      * @serial
1096      */
1097     private int rawOffset;
1098 
1099     /**
1100      * A boolean value which is true if and only if this zone uses daylight
1101      * saving time.  If this value is false, several other fields are ignored.
1102      * @serial
1103      */
1104     private boolean useDaylight=false; // indicate if this time zone uses DST
1105 
1106     private static final int millisPerHour = 60*60*1000;
1107     private static final int millisPerDay  = 24*millisPerHour;
1108 
1109     /**
1110      * This field was serialized in JDK 1.1, so we have to keep it that way
1111      * to maintain serialization compatibility. However, there&#39;s no need to
1112      * recreate the array each time we create a new time zone.
1113      * @serial An array of bytes containing the values {31, 28, 31, 30, 31, 30,
1114      * 31, 31, 30, 31, 30, 31}.  This is ignored as of the Java 2 platform v1.2, however, it must
1115      * be streamed out for compatibility with JDK 1.1.
1116      */
1117     private final byte monthLength[] = staticMonthLength;
1118     private static final byte staticMonthLength[] = {31,28,31,30,31,30,31,31,30,31,30,31};
1119     private static final byte staticLeapMonthLength[] = {31,29,31,30,31,30,31,31,30,31,30,31};
1120 
1121     /**
1122      * Variables specifying the mode of the start rule.  Takes the following
1123      * values:
1124      * &lt;dl&gt;
<span class="line-modified">1125      * &lt;dt&gt;{@code DOM_MODE}&lt;/dt&gt;</span>
1126      * &lt;dd&gt;
1127      * Exact day of week; e.g., March 1.
1128      * &lt;/dd&gt;
<span class="line-modified">1129      * &lt;dt&gt;{@code DOW_IN_MONTH_MODE}&lt;/dt&gt;</span>
1130      * &lt;dd&gt;
1131      * Day of week in month; e.g., last Sunday in March.
1132      * &lt;/dd&gt;
<span class="line-modified">1133      * &lt;dt&gt;{@code DOW_GE_DOM_MODE}&lt;/dt&gt;</span>
1134      * &lt;dd&gt;
1135      * Day of week after day of month; e.g., Sunday on or after March 15.
1136      * &lt;/dd&gt;
<span class="line-modified">1137      * &lt;dt&gt;{@code DOW_LE_DOM_MODE}&lt;/dt&gt;</span>
1138      * &lt;dd&gt;
1139      * Day of week before day of month; e.g., Sunday on or before March 15.
1140      * &lt;/dd&gt;
1141      * &lt;/dl&gt;
1142      * The setting of this field affects the interpretation of the
<span class="line-modified">1143      * {@code startDay} field.</span>
<span class="line-modified">1144      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
1145      * @serial
1146      * @since 1.1.4
1147      */
1148     private int startMode;
1149 
1150     /**
1151      * Variables specifying the mode of the end rule.  Takes the following
1152      * values:
1153      * &lt;dl&gt;
<span class="line-modified">1154      * &lt;dt&gt;{@code DOM_MODE}&lt;/dt&gt;</span>
1155      * &lt;dd&gt;
1156      * Exact day of week; e.g., March 1.
1157      * &lt;/dd&gt;
<span class="line-modified">1158      * &lt;dt&gt;{@code DOW_IN_MONTH_MODE}&lt;/dt&gt;</span>
1159      * &lt;dd&gt;
1160      * Day of week in month; e.g., last Sunday in March.
1161      * &lt;/dd&gt;
<span class="line-modified">1162      * &lt;dt&gt;{@code DOW_GE_DOM_MODE}&lt;/dt&gt;</span>
1163      * &lt;dd&gt;
1164      * Day of week after day of month; e.g., Sunday on or after March 15.
1165      * &lt;/dd&gt;
<span class="line-modified">1166      * &lt;dt&gt;{@code DOW_LE_DOM_MODE}&lt;/dt&gt;</span>
1167      * &lt;dd&gt;
1168      * Day of week before day of month; e.g., Sunday on or before March 15.
1169      * &lt;/dd&gt;
1170      * &lt;/dl&gt;
1171      * The setting of this field affects the interpretation of the
<span class="line-modified">1172      * {@code endDay} field.</span>
<span class="line-modified">1173      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
1174      * @serial
1175      * @since 1.1.4
1176      */
1177     private int endMode;
1178 
1179     /**
1180      * A positive value indicating the amount of time saved during DST in
1181      * milliseconds.
1182      * Typically one hour (3600000); sometimes 30 minutes (1800000).
<span class="line-modified">1183      * &lt;p&gt;If {@code useDaylight} is false, this value is ignored.</span>
1184      * @serial
1185      * @since 1.1.4
1186      */
1187     private int dstSavings;
1188 
1189     private static final Gregorian gcal = CalendarSystem.getGregorianCalendar();
1190 
1191     /**
1192      * Cache values representing a single period of daylight saving
1193      * time. Cache.start is the start time (inclusive) of daylight
1194      * saving time and Cache.end is the end time (exclusive).
1195      *
1196      * Cache.year has a year value if both Cache.start and Cache.end are
1197      * in the same year. Cache.year is set to startYear - 1 if
1198      * Cache.start and Cache.end are in different years.
1199      * Cache.year is a long to support Integer.MIN_VALUE - 1 (JCK requirement).
1200      */
1201     private static final class Cache {
1202         final long year;
1203         final long start;
</pre>
<hr />
<pre>
1225      * time.  Wall clock time is standard time for the onset rule, and
1226      * daylight time for the end rule.
1227      * @since 1.4
1228      */
1229     public static final int WALL_TIME = 0; // Zero for backward compatibility
1230 
1231     /**
1232      * Constant for a mode of start or end time specified as standard time.
1233      * @since 1.4
1234      */
1235     public static final int STANDARD_TIME = 1;
1236 
1237     /**
1238      * Constant for a mode of start or end time specified as UTC. European
1239      * Union rules are specified as UTC time, for example.
1240      * @since 1.4
1241      */
1242     public static final int UTC_TIME = 2;
1243 
1244     // Proclaim compatibility with 1.1
<span class="line-added">1245     @java.io.Serial</span>
1246     static final long serialVersionUID = -403250971215465050L;
1247 
1248     // the internal serial version which says which version was written
1249     // - 0 (default) for version up to JDK 1.1.3
1250     // - 1 for version from JDK 1.1.4, which includes 3 new fields
1251     // - 2 for JDK 1.3, which includes 2 new fields
1252     static final int currentSerialVersion = 2;
1253 
1254     /**
1255      * The version of the serialized data on the stream.  Possible values:
1256      * &lt;dl&gt;
1257      * &lt;dt&gt;&lt;b&gt;0&lt;/b&gt; or not present on stream&lt;/dt&gt;
1258      * &lt;dd&gt;
1259      * JDK 1.1.3 or earlier.
1260      * &lt;/dd&gt;
1261      * &lt;dt&gt;&lt;b&gt;1&lt;/b&gt;&lt;/dt&gt;
1262      * &lt;dd&gt;
<span class="line-modified">1263      * JDK 1.1.4 or later.  Includes three new fields: {@code startMode},</span>
<span class="line-modified">1264      * {@code endMode}, and {@code dstSavings}.</span>
1265      * &lt;/dd&gt;
1266      * &lt;dt&gt;&lt;b&gt;2&lt;/b&gt;&lt;/dt&gt;
1267      * &lt;dd&gt;
<span class="line-modified">1268      * JDK 1.3 or later.  Includes two new fields: {@code startTimeMode}</span>
<span class="line-modified">1269      * and {@code endTimeMode}.</span>
1270      * &lt;/dd&gt;
1271      * &lt;/dl&gt;
1272      * When streaming out this class, the most recent format
<span class="line-modified">1273      * and the highest allowable {@code serialVersionOnStream}</span>
1274      * is written.
1275      * @serial
1276      * @since 1.1.4
1277      */
1278     private int serialVersionOnStream = currentSerialVersion;
1279 
1280     // Maximum number of rules.
1281     private static final int MAX_RULE_NUM = 6;
1282 
1283     private void invalidateCache() {
1284         cache = null;
1285     }
1286 
1287     //----------------------------------------------------------------------
1288     // Rule representation
1289     //
1290     // We represent the following flavors of rules:
1291     //       5        the fifth of the month
1292     //       lastSun  the last Sunday in the month
1293     //       lastMon  the last Monday in the month
</pre>
<hr />
<pre>
1608     private int[] packTimes() {
1609         int[] times = new int[2];
1610         times[0] = startTime;
1611         times[1] = endTime;
1612         return times;
1613     }
1614 
1615     /**
1616      * Unpack the start and end times from an array of bytes.  This is required
1617      * as of serial version 2.
1618      */
1619     private void unpackTimes(int[] times) {
1620         startTime = times[0];
1621         endTime = times[1];
1622     }
1623 
1624     /**
1625      * Save the state of this object to a stream (i.e., serialize it).
1626      *
1627      * @serialData We write out two formats, a JDK 1.1 compatible format, using
<span class="line-modified">1628      * {@code DOW_IN_MONTH_MODE} rules, in the required section, followed</span>
1629      * by the full rules, in packed format, in the optional section.  The
1630      * optional section will be ignored by JDK 1.1 code upon stream in.
1631      * &lt;p&gt; Contents of the optional section: The length of a byte array is
1632      * emitted (int); this is 4 as of this release. The byte array of the given
1633      * length is emitted. The contents of the byte array are the true values of
<span class="line-modified">1634      * the fields {@code startDay}, {@code startDayOfWeek},</span>
<span class="line-modified">1635      * {@code endDay}, and {@code endDayOfWeek}.  The values of these</span>
1636      * fields in the required section are approximate values suited to the rule
<span class="line-modified">1637      * mode {@code DOW_IN_MONTH_MODE}, which is the only mode recognized by</span>
1638      * JDK 1.1.
1639      */
<span class="line-added">1640     @java.io.Serial</span>
1641     private void writeObject(ObjectOutputStream stream)
1642          throws IOException
1643     {
1644         // Construct a binary rule
1645         byte[] rules = packRules();
1646         int[] times = packTimes();
1647 
1648         // Convert to 1.1 FCS rules.  This step may cause us to lose information.
1649         makeRulesCompatible();
1650 
1651         // Write out the 1.1 FCS rules
1652         stream.defaultWriteObject();
1653 
1654         // Write out the binary rules in the optional data area of the stream.
1655         stream.writeInt(rules.length);
1656         stream.write(rules);
1657         stream.writeObject(times);
1658 
1659         // Recover the original rules.  This recovers the information lost
1660         // by makeRulesCompatible.
1661         unpackRules(rules);
1662         unpackTimes(times);
1663     }
1664 
1665     /**
1666      * Reconstitute this object from a stream (i.e., deserialize it).
1667      *
1668      * We handle both JDK 1.1
1669      * binary formats and full formats with a packed byte array.
1670      */
<span class="line-added">1671     @java.io.Serial</span>
1672     private void readObject(ObjectInputStream stream)
1673          throws IOException, ClassNotFoundException
1674     {
1675         stream.defaultReadObject();
1676 
1677         if (serialVersionOnStream &lt; 1) {
1678             // Fix a bug in the 1.1 SimpleTimeZone code -- namely,
1679             // startDayOfWeek and endDayOfWeek were usually uninitialized.  We can&#39;t do
1680             // too much, so we assume SUNDAY, which actually works most of the time.
1681             if (startDayOfWeek == 0) {
1682                 startDayOfWeek = Calendar.SUNDAY;
1683             }
1684             if (endDayOfWeek == 0) {
1685                 endDayOfWeek = Calendar.SUNDAY;
1686             }
1687 
1688             // The variables dstSavings, startMode, and endMode are post-1.1, so they
1689             // won&#39;t be present if we&#39;re reading from a 1.1 stream.  Fix them up.
1690             startMode = endMode = DOW_IN_MONTH_MODE;
1691             dstSavings = millisPerHour;
</pre>
</td>
</tr>
</table>
<center><a href="Set.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Stack.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>