<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/security/SignatureSpi.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="SignatureException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SignedObject.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/SignatureSpi.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 47  * @since 1.2
 48  *
 49  *
 50  * @see Signature
 51  */
 52 
 53 public abstract class SignatureSpi {
 54 
 55     /**
 56      * Application-specified source of randomness.
 57      */
 58     protected SecureRandom appRandom = null;
 59 
 60     /**
 61      * Initializes this signature object with the specified
 62      * public key for verification operations.
 63      *
 64      * @param publicKey the public key of the identity whose signature is
 65      * going to be verified.
 66      *
<span class="line-modified"> 67      * @exception InvalidKeyException if the key is improperly</span>
 68      * encoded, parameters are missing, and so on.
 69      */
 70     protected abstract void engineInitVerify(PublicKey publicKey)
 71         throws InvalidKeyException;
 72 



























 73     /**
 74      * Initializes this signature object with the specified
 75      * private key for signing operations.
 76      *
 77      * @param privateKey the private key of the identity whose signature
 78      * will be generated.
 79      *
<span class="line-modified"> 80      * @exception InvalidKeyException if the key is improperly</span>
 81      * encoded, parameters are missing, and so on.
 82      */
 83     protected abstract void engineInitSign(PrivateKey privateKey)
 84         throws InvalidKeyException;
 85 
 86     /**
 87      * Initializes this signature object with the specified
 88      * private key and source of randomness for signing operations.
 89      *
 90      * &lt;p&gt;This concrete method has been added to this previously-defined
 91      * abstract class. (For backwards compatibility, it cannot be abstract.)
 92      *
 93      * @param privateKey the private key of the identity whose signature
 94      * will be generated.
 95      * @param random the source of randomness
 96      *
<span class="line-modified"> 97      * @exception InvalidKeyException if the key is improperly</span>
 98      * encoded, parameters are missing, and so on.
 99      */
100     protected void engineInitSign(PrivateKey privateKey,
<span class="line-modified">101                                   SecureRandom random)</span>
<span class="line-modified">102         throws InvalidKeyException {</span>
<span class="line-modified">103             this.appRandom = random;</span>
<span class="line-modified">104             engineInitSign(privateKey);</span>































105     }
106 
107     /**
108      * Updates the data to be signed or verified
109      * using the specified byte.
110      *
111      * @param b the byte to use for the update.
112      *
<span class="line-modified">113      * @exception SignatureException if the engine is not initialized</span>
114      * properly.
115      */
116     protected abstract void engineUpdate(byte b) throws SignatureException;
117 
118     /**
119      * Updates the data to be signed or verified, using the
120      * specified array of bytes, starting at the specified offset.
121      *
122      * @param b the array of bytes
123      * @param off the offset to start from in the array of bytes
124      * @param len the number of bytes to use, starting at offset
125      *
<span class="line-modified">126      * @exception SignatureException if the engine is not initialized</span>
127      * properly
128      */
129     protected abstract void engineUpdate(byte[] b, int off, int len)
<span class="line-modified">130         throws SignatureException;</span>
131 
132     /**
133      * Updates the data to be signed or verified using the specified
134      * ByteBuffer. Processes the {@code data.remaining()} bytes
135      * starting at {@code data.position()}.
136      * Upon return, the buffer&#39;s position will be equal to its limit;
137      * its limit will not have changed.
138      *
139      * @param input the ByteBuffer
140      * @since 1.5
141      */
142     protected void engineUpdate(ByteBuffer input) {
143         if (input.hasRemaining() == false) {
144             return;
145         }
146         try {
147             if (input.hasArray()) {
148                 byte[] b = input.array();
149                 int ofs = input.arrayOffset();
150                 int pos = input.position();
</pre>
<hr />
<pre>
159                     input.get(b, 0, chunk);
160                     engineUpdate(b, 0, chunk);
161                     len -= chunk;
162                 }
163             }
164         } catch (SignatureException e) {
165             // is specified to only occur when the engine is not initialized
166             // this case should never occur as it is caught in Signature.java
167             throw new ProviderException(&quot;update() failed&quot;, e);
168         }
169     }
170 
171     /**
172      * Returns the signature bytes of all the data
173      * updated so far.
174      * The format of the signature depends on the underlying
175      * signature scheme.
176      *
177      * @return the signature bytes of the signing operation&#39;s result.
178      *
<span class="line-modified">179      * @exception SignatureException if the engine is not</span>
180      * initialized properly or if this signature algorithm is unable to
181      * process the input data provided.
182      */
183     protected abstract byte[] engineSign() throws SignatureException;
184 
185     /**
186      * Finishes this signature operation and stores the resulting signature
187      * bytes in the provided buffer {@code outbuf}, starting at
188      * {@code offset}.
189      * The format of the signature depends on the underlying
190      * signature scheme.
191      *
192      * &lt;p&gt;The signature implementation is reset to its initial state
193      * (the state it was in after a call to one of the
194      * {@code engineInitSign} methods)
195      * and can be reused to generate further signatures with the same private
196      * key.
197      *
198      * This method should be abstract, but we leave it concrete for
199      * binary compatibility.  Knowledgeable providers should override this
200      * method.
201      *
202      * @param outbuf buffer for the signature result.
203      *
204      * @param offset offset into {@code outbuf} where the signature is
205      * stored.
206      *
207      * @param len number of bytes within {@code outbuf} allotted for the
208      * signature.
209      * Both this default implementation and the SUN provider do not
210      * return partial digests. If the value of this parameter is less
211      * than the actual signature length, this method will throw a
212      * SignatureException.
213      * This parameter is ignored if its value is greater than or equal to
214      * the actual signature length.
215      *
216      * @return the number of bytes placed into {@code outbuf}
217      *
<span class="line-modified">218      * @exception SignatureException if the engine is not</span>
219      * initialized properly, if this signature algorithm is unable to
220      * process the input data provided, or if {@code len} is less
221      * than the actual signature length.
222      *
223      * @since 1.2
224      */
225     protected int engineSign(byte[] outbuf, int offset, int len)
<span class="line-modified">226                         throws SignatureException {</span>
227         byte[] sig = engineSign();
228         if (len &lt; sig.length) {
229                 throw new SignatureException
230                     (&quot;partial signatures not returned&quot;);
231         }
232         if (outbuf.length - offset &lt; sig.length) {
233                 throw new SignatureException
234                     (&quot;insufficient space in the output buffer to store the &quot;
235                      + &quot;signature&quot;);
236         }
237         System.arraycopy(sig, 0, outbuf, offset, sig.length);
238         return sig.length;
239     }
240 
241     /**
242      * Verifies the passed-in signature.
243      *
244      * @param sigBytes the signature bytes to be verified.
245      *
246      * @return true if the signature was verified, false if not.
247      *
<span class="line-modified">248      * @exception SignatureException if the engine is not</span>
249      * initialized properly, the passed-in signature is improperly
250      * encoded or of the wrong type, if this signature algorithm is unable to
251      * process the input data provided, etc.
252      */
253     protected abstract boolean engineVerify(byte[] sigBytes)
<span class="line-modified">254         throws SignatureException;</span>
255 
256     /**
257      * Verifies the passed-in signature in the specified array
258      * of bytes, starting at the specified offset.
259      *
260      * &lt;p&gt; Note: Subclasses should overwrite the default implementation.
261      *
262      *
263      * @param sigBytes the signature bytes to be verified.
264      * @param offset the offset to start from in the array of bytes.
265      * @param length the number of bytes to use, starting at offset.
266      *
267      * @return true if the signature was verified, false if not.
268      *
<span class="line-modified">269      * @exception SignatureException if the engine is not</span>
270      * initialized properly, the passed-in signature is improperly
271      * encoded or of the wrong type, if this signature algorithm is unable to
272      * process the input data provided, etc.
273      * @since 1.4
274      */
275     protected boolean engineVerify(byte[] sigBytes, int offset, int length)
<span class="line-modified">276         throws SignatureException {</span>
277         byte[] sigBytesCopy = new byte[length];
278         System.arraycopy(sigBytes, offset, sigBytesCopy, 0, length);
279         return engineVerify(sigBytesCopy);
280     }
281 
282     /**
283      * Sets the specified algorithm parameter to the specified
284      * value. This method supplies a general-purpose mechanism through
285      * which it is possible to set the various parameters of this object.
286      * A parameter may be any settable parameter for the algorithm, such as
287      * a parameter size, or a source of random bits for signature generation
288      * (if appropriate), or an indication of whether or not to perform
289      * a specific but optional computation. A uniform algorithm-specific
290      * naming scheme for each parameter is desirable but left unspecified
291      * at this time.
292      *
293      * @param param the string identifier of the parameter.
294      *
295      * @param value the parameter value.
296      *
<span class="line-modified">297      * @exception InvalidParameterException if {@code param} is an</span>
298      * invalid parameter for this signature algorithm engine,
299      * the parameter is already set
300      * and cannot be set again, a security exception occurs, and so on.
301      *
302      * @deprecated Replaced by {@link
303      * #engineSetParameter(java.security.spec.AlgorithmParameterSpec)
304      * engineSetParameter}.
305      */
306     @Deprecated
307     protected abstract void engineSetParameter(String param, Object value)
<span class="line-modified">308         throws InvalidParameterException;</span>
309 
310     /**
311      * &lt;p&gt;This method is overridden by providers to initialize
312      * this signature engine with the specified parameter set.
313      *
314      * @param params the parameters
315      *
<span class="line-modified">316      * @exception UnsupportedOperationException if this method is not</span>
317      * overridden by a provider
318      *
<span class="line-modified">319      * @exception InvalidAlgorithmParameterException if this method is</span>
320      * overridden by a provider and the given parameters
321      * are inappropriate for this signature engine
322      */
323     protected void engineSetParameter(AlgorithmParameterSpec params)
<span class="line-modified">324         throws InvalidAlgorithmParameterException {</span>
<span class="line-modified">325             throw new UnsupportedOperationException();</span>
326     }
327 
328     /**
329      * &lt;p&gt;This method is overridden by providers to return the parameters
330      * used with this signature engine.
331      *
332      * &lt;p&gt; If this signature engine has been previously initialized with
333      * parameters (by calling the {@code engineSetParameter} method), this
334      * method returns the same parameters. If this signature engine has not been
335      * initialized with parameters, this method may return a combination of
336      * default and randomly generated parameter values if the underlying
337      * signature implementation supports it and can successfully generate
338      * them. Otherwise, {@code null} is returned.
339      *
340      * @return the parameters used with this signature engine, or {@code null}
341      *
<span class="line-modified">342      * @exception UnsupportedOperationException if this method is</span>
343      * not overridden by a provider
344      * @since 1.4
345      */
346     protected AlgorithmParameters engineGetParameters() {
347         throw new UnsupportedOperationException();
348     }
349 
350     /**
351      * Gets the value of the specified algorithm parameter.
352      * This method supplies a general-purpose mechanism through which it
353      * is possible to get the various parameters of this object. A parameter
354      * may be any settable parameter for the algorithm, such as a parameter
355      * size, or  a source of random bits for signature generation (if
356      * appropriate), or an indication of whether or not to perform a
357      * specific but optional computation. A uniform algorithm-specific
358      * naming scheme for each parameter is desirable but left unspecified
359      * at this time.
360      *
361      * @param param the string name of the parameter.
362      *
363      * @return the object that represents the parameter value, or {@code null} if
364      * there is none.
365      *
<span class="line-modified">366      * @exception InvalidParameterException if {@code param} is an</span>
367      * invalid parameter for this engine, or another exception occurs while
368      * trying to get this parameter.
369      *
370      * @deprecated
371      */
372     @Deprecated
373     protected abstract Object engineGetParameter(String param)
374         throws InvalidParameterException;
375 
376     /**
377      * Returns a clone if the implementation is cloneable.
378      *
379      * @return a clone if the implementation is cloneable.
380      *
<span class="line-modified">381      * @exception CloneNotSupportedException if this is called</span>
382      * on an implementation that does not support {@code Cloneable}.
383      */
384     public Object clone() throws CloneNotSupportedException {
385         if (this instanceof Cloneable) {
386             return super.clone();
387         } else {
388             throw new CloneNotSupportedException();
389         }
390     }
391 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 47  * @since 1.2
 48  *
 49  *
 50  * @see Signature
 51  */
 52 
 53 public abstract class SignatureSpi {
 54 
 55     /**
 56      * Application-specified source of randomness.
 57      */
 58     protected SecureRandom appRandom = null;
 59 
 60     /**
 61      * Initializes this signature object with the specified
 62      * public key for verification operations.
 63      *
 64      * @param publicKey the public key of the identity whose signature is
 65      * going to be verified.
 66      *
<span class="line-modified"> 67      * @throws    InvalidKeyException if the key is improperly</span>
 68      * encoded, parameters are missing, and so on.
 69      */
 70     protected abstract void engineInitVerify(PublicKey publicKey)
 71         throws InvalidKeyException;
 72 
<span class="line-added"> 73     /**</span>
<span class="line-added"> 74      * Initializes this signature object with the specified</span>
<span class="line-added"> 75      * public key for verification operations.</span>
<span class="line-added"> 76      *</span>
<span class="line-added"> 77      * @param publicKey the public key of the identity whose signature is</span>
<span class="line-added"> 78      * going to be verified.</span>
<span class="line-added"> 79      * @param params the parameters for generating this signature</span>
<span class="line-added"> 80      *</span>
<span class="line-added"> 81      * @throws    InvalidKeyException if the key is improperly</span>
<span class="line-added"> 82      * encoded, does not work with the given parameters, and so on.</span>
<span class="line-added"> 83      * @throws    InvalidAlgorithmParameterException if the given parameters</span>
<span class="line-added"> 84      * is invalid.</span>
<span class="line-added"> 85      */</span>
<span class="line-added"> 86     void engineInitVerify(PublicKey publicKey,</span>
<span class="line-added"> 87             AlgorithmParameterSpec params)</span>
<span class="line-added"> 88             throws InvalidKeyException, InvalidAlgorithmParameterException {</span>
<span class="line-added"> 89         if (params != null) {</span>
<span class="line-added"> 90             try {</span>
<span class="line-added"> 91                 engineSetParameter(params);</span>
<span class="line-added"> 92             } catch (UnsupportedOperationException usoe) {</span>
<span class="line-added"> 93                 // error out if not overrridden</span>
<span class="line-added"> 94                 throw new InvalidAlgorithmParameterException(usoe);</span>
<span class="line-added"> 95             }</span>
<span class="line-added"> 96         }</span>
<span class="line-added"> 97         engineInitVerify(publicKey);</span>
<span class="line-added"> 98     }</span>
<span class="line-added"> 99 </span>
100     /**
101      * Initializes this signature object with the specified
102      * private key for signing operations.
103      *
104      * @param privateKey the private key of the identity whose signature
105      * will be generated.
106      *
<span class="line-modified">107      * @throws    InvalidKeyException if the key is improperly</span>
108      * encoded, parameters are missing, and so on.
109      */
110     protected abstract void engineInitSign(PrivateKey privateKey)
111         throws InvalidKeyException;
112 
113     /**
114      * Initializes this signature object with the specified
115      * private key and source of randomness for signing operations.
116      *
117      * &lt;p&gt;This concrete method has been added to this previously-defined
118      * abstract class. (For backwards compatibility, it cannot be abstract.)
119      *
120      * @param privateKey the private key of the identity whose signature
121      * will be generated.
122      * @param random the source of randomness
123      *
<span class="line-modified">124      * @throws    InvalidKeyException if the key is improperly</span>
125      * encoded, parameters are missing, and so on.
126      */
127     protected void engineInitSign(PrivateKey privateKey,
<span class="line-modified">128             SecureRandom random)</span>
<span class="line-modified">129             throws InvalidKeyException {</span>
<span class="line-modified">130         this.appRandom = random;</span>
<span class="line-modified">131         engineInitSign(privateKey);</span>
<span class="line-added">132     }</span>
<span class="line-added">133 </span>
<span class="line-added">134     /**</span>
<span class="line-added">135      * Initializes this signature object with the specified</span>
<span class="line-added">136      * private key and source of randomness for signing operations.</span>
<span class="line-added">137      *</span>
<span class="line-added">138      * &lt;p&gt;This concrete method has been added to this previously-defined</span>
<span class="line-added">139      * abstract class. (For backwards compatibility, it cannot be abstract.)</span>
<span class="line-added">140      *</span>
<span class="line-added">141      * @param privateKey the private key of the identity whose signature</span>
<span class="line-added">142      * will be generated.</span>
<span class="line-added">143      * @param params the parameters for generating this signature</span>
<span class="line-added">144      * @param random the source of randomness</span>
<span class="line-added">145      *</span>
<span class="line-added">146      * @throws    InvalidKeyException if the key is improperly</span>
<span class="line-added">147      * encoded, parameters are missing, and so on.</span>
<span class="line-added">148      * @throws    InvalidAlgorithmParameterException if the parameters is</span>
<span class="line-added">149      * invalid.</span>
<span class="line-added">150      */</span>
<span class="line-added">151     void engineInitSign(PrivateKey privateKey,</span>
<span class="line-added">152             AlgorithmParameterSpec params, SecureRandom random)</span>
<span class="line-added">153             throws InvalidKeyException, InvalidAlgorithmParameterException {</span>
<span class="line-added">154         if (params != null) {</span>
<span class="line-added">155             try {</span>
<span class="line-added">156                 engineSetParameter(params);</span>
<span class="line-added">157             } catch (UnsupportedOperationException usoe) {</span>
<span class="line-added">158                 // error out if not overrridden</span>
<span class="line-added">159                 throw new InvalidAlgorithmParameterException(usoe);</span>
<span class="line-added">160             }</span>
<span class="line-added">161         }</span>
<span class="line-added">162         engineInitSign(privateKey, random);</span>
163     }
164 
165     /**
166      * Updates the data to be signed or verified
167      * using the specified byte.
168      *
169      * @param b the byte to use for the update.
170      *
<span class="line-modified">171      * @throws    SignatureException if the engine is not initialized</span>
172      * properly.
173      */
174     protected abstract void engineUpdate(byte b) throws SignatureException;
175 
176     /**
177      * Updates the data to be signed or verified, using the
178      * specified array of bytes, starting at the specified offset.
179      *
180      * @param b the array of bytes
181      * @param off the offset to start from in the array of bytes
182      * @param len the number of bytes to use, starting at offset
183      *
<span class="line-modified">184      * @throws    SignatureException if the engine is not initialized</span>
185      * properly
186      */
187     protected abstract void engineUpdate(byte[] b, int off, int len)
<span class="line-modified">188             throws SignatureException;</span>
189 
190     /**
191      * Updates the data to be signed or verified using the specified
192      * ByteBuffer. Processes the {@code data.remaining()} bytes
193      * starting at {@code data.position()}.
194      * Upon return, the buffer&#39;s position will be equal to its limit;
195      * its limit will not have changed.
196      *
197      * @param input the ByteBuffer
198      * @since 1.5
199      */
200     protected void engineUpdate(ByteBuffer input) {
201         if (input.hasRemaining() == false) {
202             return;
203         }
204         try {
205             if (input.hasArray()) {
206                 byte[] b = input.array();
207                 int ofs = input.arrayOffset();
208                 int pos = input.position();
</pre>
<hr />
<pre>
217                     input.get(b, 0, chunk);
218                     engineUpdate(b, 0, chunk);
219                     len -= chunk;
220                 }
221             }
222         } catch (SignatureException e) {
223             // is specified to only occur when the engine is not initialized
224             // this case should never occur as it is caught in Signature.java
225             throw new ProviderException(&quot;update() failed&quot;, e);
226         }
227     }
228 
229     /**
230      * Returns the signature bytes of all the data
231      * updated so far.
232      * The format of the signature depends on the underlying
233      * signature scheme.
234      *
235      * @return the signature bytes of the signing operation&#39;s result.
236      *
<span class="line-modified">237      * @throws    SignatureException if the engine is not</span>
238      * initialized properly or if this signature algorithm is unable to
239      * process the input data provided.
240      */
241     protected abstract byte[] engineSign() throws SignatureException;
242 
243     /**
244      * Finishes this signature operation and stores the resulting signature
245      * bytes in the provided buffer {@code outbuf}, starting at
246      * {@code offset}.
247      * The format of the signature depends on the underlying
248      * signature scheme.
249      *
250      * &lt;p&gt;The signature implementation is reset to its initial state
251      * (the state it was in after a call to one of the
252      * {@code engineInitSign} methods)
253      * and can be reused to generate further signatures with the same private
254      * key.
255      *
256      * This method should be abstract, but we leave it concrete for
257      * binary compatibility.  Knowledgeable providers should override this
258      * method.
259      *
260      * @param outbuf buffer for the signature result.
261      *
262      * @param offset offset into {@code outbuf} where the signature is
263      * stored.
264      *
265      * @param len number of bytes within {@code outbuf} allotted for the
266      * signature.
267      * Both this default implementation and the SUN provider do not
268      * return partial digests. If the value of this parameter is less
269      * than the actual signature length, this method will throw a
270      * SignatureException.
271      * This parameter is ignored if its value is greater than or equal to
272      * the actual signature length.
273      *
274      * @return the number of bytes placed into {@code outbuf}
275      *
<span class="line-modified">276      * @throws    SignatureException if the engine is not</span>
277      * initialized properly, if this signature algorithm is unable to
278      * process the input data provided, or if {@code len} is less
279      * than the actual signature length.
280      *
281      * @since 1.2
282      */
283     protected int engineSign(byte[] outbuf, int offset, int len)
<span class="line-modified">284              throws SignatureException {</span>
285         byte[] sig = engineSign();
286         if (len &lt; sig.length) {
287                 throw new SignatureException
288                     (&quot;partial signatures not returned&quot;);
289         }
290         if (outbuf.length - offset &lt; sig.length) {
291                 throw new SignatureException
292                     (&quot;insufficient space in the output buffer to store the &quot;
293                      + &quot;signature&quot;);
294         }
295         System.arraycopy(sig, 0, outbuf, offset, sig.length);
296         return sig.length;
297     }
298 
299     /**
300      * Verifies the passed-in signature.
301      *
302      * @param sigBytes the signature bytes to be verified.
303      *
304      * @return true if the signature was verified, false if not.
305      *
<span class="line-modified">306      * @throws    SignatureException if the engine is not</span>
307      * initialized properly, the passed-in signature is improperly
308      * encoded or of the wrong type, if this signature algorithm is unable to
309      * process the input data provided, etc.
310      */
311     protected abstract boolean engineVerify(byte[] sigBytes)
<span class="line-modified">312             throws SignatureException;</span>
313 
314     /**
315      * Verifies the passed-in signature in the specified array
316      * of bytes, starting at the specified offset.
317      *
318      * &lt;p&gt; Note: Subclasses should overwrite the default implementation.
319      *
320      *
321      * @param sigBytes the signature bytes to be verified.
322      * @param offset the offset to start from in the array of bytes.
323      * @param length the number of bytes to use, starting at offset.
324      *
325      * @return true if the signature was verified, false if not.
326      *
<span class="line-modified">327      * @throws    SignatureException if the engine is not</span>
328      * initialized properly, the passed-in signature is improperly
329      * encoded or of the wrong type, if this signature algorithm is unable to
330      * process the input data provided, etc.
331      * @since 1.4
332      */
333     protected boolean engineVerify(byte[] sigBytes, int offset, int length)
<span class="line-modified">334             throws SignatureException {</span>
335         byte[] sigBytesCopy = new byte[length];
336         System.arraycopy(sigBytes, offset, sigBytesCopy, 0, length);
337         return engineVerify(sigBytesCopy);
338     }
339 
340     /**
341      * Sets the specified algorithm parameter to the specified
342      * value. This method supplies a general-purpose mechanism through
343      * which it is possible to set the various parameters of this object.
344      * A parameter may be any settable parameter for the algorithm, such as
345      * a parameter size, or a source of random bits for signature generation
346      * (if appropriate), or an indication of whether or not to perform
347      * a specific but optional computation. A uniform algorithm-specific
348      * naming scheme for each parameter is desirable but left unspecified
349      * at this time.
350      *
351      * @param param the string identifier of the parameter.
352      *
353      * @param value the parameter value.
354      *
<span class="line-modified">355      * @throws    InvalidParameterException if {@code param} is an</span>
356      * invalid parameter for this signature algorithm engine,
357      * the parameter is already set
358      * and cannot be set again, a security exception occurs, and so on.
359      *
360      * @deprecated Replaced by {@link
361      * #engineSetParameter(java.security.spec.AlgorithmParameterSpec)
362      * engineSetParameter}.
363      */
364     @Deprecated
365     protected abstract void engineSetParameter(String param, Object value)
<span class="line-modified">366             throws InvalidParameterException;</span>
367 
368     /**
369      * &lt;p&gt;This method is overridden by providers to initialize
370      * this signature engine with the specified parameter set.
371      *
372      * @param params the parameters
373      *
<span class="line-modified">374      * @throws    UnsupportedOperationException if this method is not</span>
375      * overridden by a provider
376      *
<span class="line-modified">377      * @throws    InvalidAlgorithmParameterException if this method is</span>
378      * overridden by a provider and the given parameters
379      * are inappropriate for this signature engine
380      */
381     protected void engineSetParameter(AlgorithmParameterSpec params)
<span class="line-modified">382             throws InvalidAlgorithmParameterException {</span>
<span class="line-modified">383         throw new UnsupportedOperationException();</span>
384     }
385 
386     /**
387      * &lt;p&gt;This method is overridden by providers to return the parameters
388      * used with this signature engine.
389      *
390      * &lt;p&gt; If this signature engine has been previously initialized with
391      * parameters (by calling the {@code engineSetParameter} method), this
392      * method returns the same parameters. If this signature engine has not been
393      * initialized with parameters, this method may return a combination of
394      * default and randomly generated parameter values if the underlying
395      * signature implementation supports it and can successfully generate
396      * them. Otherwise, {@code null} is returned.
397      *
398      * @return the parameters used with this signature engine, or {@code null}
399      *
<span class="line-modified">400      * @throws    UnsupportedOperationException if this method is</span>
401      * not overridden by a provider
402      * @since 1.4
403      */
404     protected AlgorithmParameters engineGetParameters() {
405         throw new UnsupportedOperationException();
406     }
407 
408     /**
409      * Gets the value of the specified algorithm parameter.
410      * This method supplies a general-purpose mechanism through which it
411      * is possible to get the various parameters of this object. A parameter
412      * may be any settable parameter for the algorithm, such as a parameter
413      * size, or  a source of random bits for signature generation (if
414      * appropriate), or an indication of whether or not to perform a
415      * specific but optional computation. A uniform algorithm-specific
416      * naming scheme for each parameter is desirable but left unspecified
417      * at this time.
418      *
419      * @param param the string name of the parameter.
420      *
421      * @return the object that represents the parameter value, or {@code null} if
422      * there is none.
423      *
<span class="line-modified">424      * @throws    InvalidParameterException if {@code param} is an</span>
425      * invalid parameter for this engine, or another exception occurs while
426      * trying to get this parameter.
427      *
428      * @deprecated
429      */
430     @Deprecated
431     protected abstract Object engineGetParameter(String param)
432         throws InvalidParameterException;
433 
434     /**
435      * Returns a clone if the implementation is cloneable.
436      *
437      * @return a clone if the implementation is cloneable.
438      *
<span class="line-modified">439      * @throws    CloneNotSupportedException if this is called</span>
440      * on an implementation that does not support {@code Cloneable}.
441      */
442     public Object clone() throws CloneNotSupportedException {
443         if (this instanceof Cloneable) {
444             return super.clone();
445         } else {
446             throw new CloneNotSupportedException();
447         }
448     }
449 }
</pre>
</td>
</tr>
</table>
<center><a href="SignatureException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SignedObject.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>