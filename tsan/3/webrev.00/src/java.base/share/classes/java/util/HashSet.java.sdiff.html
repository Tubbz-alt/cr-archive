<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/util/HashSet.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="HashMap.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Hashtable.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/HashSet.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 74  *
 75  * &lt;p&gt;This class is a member of the
 76  * &lt;a href=&quot;{@docRoot}/java.base/java/util/package-summary.html#CollectionsFramework&quot;&gt;
 77  * Java Collections Framework&lt;/a&gt;.
 78  *
 79  * @param &lt;E&gt; the type of elements maintained by this set
 80  *
 81  * @author  Josh Bloch
 82  * @author  Neal Gafter
 83  * @see     Collection
 84  * @see     Set
 85  * @see     TreeSet
 86  * @see     HashMap
 87  * @since   1.2
 88  */
 89 
 90 public class HashSet&lt;E&gt;
 91     extends AbstractSet&lt;E&gt;
 92     implements Set&lt;E&gt;, Cloneable, java.io.Serializable
 93 {

 94     static final long serialVersionUID = -5024744406713321676L;
 95 
 96     private transient HashMap&lt;E,Object&gt; map;
 97 
 98     // Dummy value to associate with an Object in the backing Map
 99     private static final Object PRESENT = new Object();
100 
101     /**
102      * Constructs a new, empty set; the backing {@code HashMap} instance has
103      * default initial capacity (16) and load factor (0.75).
104      */
105     public HashSet() {
106         map = new HashMap&lt;&gt;();
107     }
108 
109     /**
110      * Constructs a new set containing the elements in the specified
111      * collection.  The {@code HashMap} is created with default load factor
112      * (0.75) and an initial capacity sufficient to contain the elements in
113      * the specified collection.
</pre>
<hr />
<pre>
254     public Object clone() {
255         try {
256             HashSet&lt;E&gt; newSet = (HashSet&lt;E&gt;) super.clone();
257             newSet.map = (HashMap&lt;E, Object&gt;) map.clone();
258             return newSet;
259         } catch (CloneNotSupportedException e) {
260             throw new InternalError(e);
261         }
262     }
263 
264     /**
265      * Save the state of this {@code HashSet} instance to a stream (that is,
266      * serialize it).
267      *
268      * @serialData The capacity of the backing {@code HashMap} instance
269      *             (int), and its load factor (float) are emitted, followed by
270      *             the size of the set (the number of elements it contains)
271      *             (int), followed by all of its elements (each an Object) in
272      *             no particular order.
273      */

274     private void writeObject(java.io.ObjectOutputStream s)
275         throws java.io.IOException {
276         // Write out any hidden serialization magic
277         s.defaultWriteObject();
278 
279         // Write out HashMap capacity and load factor
280         s.writeInt(map.capacity());
281         s.writeFloat(map.loadFactor());
282 
283         // Write out size
284         s.writeInt(map.size());
285 
286         // Write out all elements in the proper order.
287         for (E e : map.keySet())
288             s.writeObject(e);
289     }
290 
291     /**
292      * Reconstitute the {@code HashSet} instance from a stream (that is,
293      * deserialize it).
294      */

295     private void readObject(java.io.ObjectInputStream s)
296         throws java.io.IOException, ClassNotFoundException {
297         // Read in any hidden serialization magic
298         s.defaultReadObject();
299 
300         // Read capacity and verify non-negative.
301         int capacity = s.readInt();
302         if (capacity &lt; 0) {
303             throw new InvalidObjectException(&quot;Illegal capacity: &quot; +
304                                              capacity);
305         }
306 
307         // Read load factor and verify positive and non NaN.
308         float loadFactor = s.readFloat();
309         if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) {
310             throw new InvalidObjectException(&quot;Illegal load factor: &quot; +
311                                              loadFactor);
312         }
313 
314         // Read size and verify non-negative.
</pre>
<hr />
<pre>
341                 E e = (E) s.readObject();
342             map.put(e, PRESENT);
343         }
344     }
345 
346     /**
347      * Creates a &lt;em&gt;&lt;a href=&quot;Spliterator.html#binding&quot;&gt;late-binding&lt;/a&gt;&lt;/em&gt;
348      * and &lt;em&gt;fail-fast&lt;/em&gt; {@link Spliterator} over the elements in this
349      * set.
350      *
351      * &lt;p&gt;The {@code Spliterator} reports {@link Spliterator#SIZED} and
352      * {@link Spliterator#DISTINCT}.  Overriding implementations should document
353      * the reporting of additional characteristic values.
354      *
355      * @return a {@code Spliterator} over the elements in this set
356      * @since 1.8
357      */
358     public Spliterator&lt;E&gt; spliterator() {
359         return new HashMap.KeySpliterator&lt;&gt;(map, 0, -1, 0, 0);
360     }










361 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 74  *
 75  * &lt;p&gt;This class is a member of the
 76  * &lt;a href=&quot;{@docRoot}/java.base/java/util/package-summary.html#CollectionsFramework&quot;&gt;
 77  * Java Collections Framework&lt;/a&gt;.
 78  *
 79  * @param &lt;E&gt; the type of elements maintained by this set
 80  *
 81  * @author  Josh Bloch
 82  * @author  Neal Gafter
 83  * @see     Collection
 84  * @see     Set
 85  * @see     TreeSet
 86  * @see     HashMap
 87  * @since   1.2
 88  */
 89 
 90 public class HashSet&lt;E&gt;
 91     extends AbstractSet&lt;E&gt;
 92     implements Set&lt;E&gt;, Cloneable, java.io.Serializable
 93 {
<span class="line-added"> 94     @java.io.Serial</span>
 95     static final long serialVersionUID = -5024744406713321676L;
 96 
 97     private transient HashMap&lt;E,Object&gt; map;
 98 
 99     // Dummy value to associate with an Object in the backing Map
100     private static final Object PRESENT = new Object();
101 
102     /**
103      * Constructs a new, empty set; the backing {@code HashMap} instance has
104      * default initial capacity (16) and load factor (0.75).
105      */
106     public HashSet() {
107         map = new HashMap&lt;&gt;();
108     }
109 
110     /**
111      * Constructs a new set containing the elements in the specified
112      * collection.  The {@code HashMap} is created with default load factor
113      * (0.75) and an initial capacity sufficient to contain the elements in
114      * the specified collection.
</pre>
<hr />
<pre>
255     public Object clone() {
256         try {
257             HashSet&lt;E&gt; newSet = (HashSet&lt;E&gt;) super.clone();
258             newSet.map = (HashMap&lt;E, Object&gt;) map.clone();
259             return newSet;
260         } catch (CloneNotSupportedException e) {
261             throw new InternalError(e);
262         }
263     }
264 
265     /**
266      * Save the state of this {@code HashSet} instance to a stream (that is,
267      * serialize it).
268      *
269      * @serialData The capacity of the backing {@code HashMap} instance
270      *             (int), and its load factor (float) are emitted, followed by
271      *             the size of the set (the number of elements it contains)
272      *             (int), followed by all of its elements (each an Object) in
273      *             no particular order.
274      */
<span class="line-added">275     @java.io.Serial</span>
276     private void writeObject(java.io.ObjectOutputStream s)
277         throws java.io.IOException {
278         // Write out any hidden serialization magic
279         s.defaultWriteObject();
280 
281         // Write out HashMap capacity and load factor
282         s.writeInt(map.capacity());
283         s.writeFloat(map.loadFactor());
284 
285         // Write out size
286         s.writeInt(map.size());
287 
288         // Write out all elements in the proper order.
289         for (E e : map.keySet())
290             s.writeObject(e);
291     }
292 
293     /**
294      * Reconstitute the {@code HashSet} instance from a stream (that is,
295      * deserialize it).
296      */
<span class="line-added">297     @java.io.Serial</span>
298     private void readObject(java.io.ObjectInputStream s)
299         throws java.io.IOException, ClassNotFoundException {
300         // Read in any hidden serialization magic
301         s.defaultReadObject();
302 
303         // Read capacity and verify non-negative.
304         int capacity = s.readInt();
305         if (capacity &lt; 0) {
306             throw new InvalidObjectException(&quot;Illegal capacity: &quot; +
307                                              capacity);
308         }
309 
310         // Read load factor and verify positive and non NaN.
311         float loadFactor = s.readFloat();
312         if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) {
313             throw new InvalidObjectException(&quot;Illegal load factor: &quot; +
314                                              loadFactor);
315         }
316 
317         // Read size and verify non-negative.
</pre>
<hr />
<pre>
344                 E e = (E) s.readObject();
345             map.put(e, PRESENT);
346         }
347     }
348 
349     /**
350      * Creates a &lt;em&gt;&lt;a href=&quot;Spliterator.html#binding&quot;&gt;late-binding&lt;/a&gt;&lt;/em&gt;
351      * and &lt;em&gt;fail-fast&lt;/em&gt; {@link Spliterator} over the elements in this
352      * set.
353      *
354      * &lt;p&gt;The {@code Spliterator} reports {@link Spliterator#SIZED} and
355      * {@link Spliterator#DISTINCT}.  Overriding implementations should document
356      * the reporting of additional characteristic values.
357      *
358      * @return a {@code Spliterator} over the elements in this set
359      * @since 1.8
360      */
361     public Spliterator&lt;E&gt; spliterator() {
362         return new HashMap.KeySpliterator&lt;&gt;(map, 0, -1, 0, 0);
363     }
<span class="line-added">364 </span>
<span class="line-added">365     @Override</span>
<span class="line-added">366     public Object[] toArray() {</span>
<span class="line-added">367         return map.keysToArray(new Object[map.size()]);</span>
<span class="line-added">368     }</span>
<span class="line-added">369 </span>
<span class="line-added">370     @Override</span>
<span class="line-added">371     public &lt;T&gt; T[] toArray(T[] a) {</span>
<span class="line-added">372         return map.keysToArray(map.prepareArray(a));</span>
<span class="line-added">373     }</span>
374 }
</pre>
</td>
</tr>
</table>
<center><a href="HashMap.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Hashtable.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>