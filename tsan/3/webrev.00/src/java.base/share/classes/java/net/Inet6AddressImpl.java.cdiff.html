<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/net/Inet6AddressImpl.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="Inet6Address.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="InetAddress.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/net/Inet6AddressImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2002, 2016, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 23,20 ***</span>
   * questions.
   */
  package java.net;
  
  import java.io.IOException;
  import static java.net.InetAddress.PREFER_IPV6_VALUE;
  import static java.net.InetAddress.PREFER_SYSTEM_VALUE;
  
  /*
   * Package private implementation of InetAddressImpl for dual
   * IPv4/IPv6 stack.
   * &lt;p&gt;
<span class="line-modified">!  * If InetAddress.preferIPv6Address is true then anyLocalAddress(),</span>
<span class="line-modified">!  * loopbackAddress(), and localHost() will return IPv6 addresses,</span>
<span class="line-modified">!  * otherwise IPv4 addresses.</span>
   *
   * @since 1.4
   */
  class Inet6AddressImpl implements InetAddressImpl {
  
<span class="line-new-header">--- 23,26 ---</span>
   * questions.
   */
  package java.net;
  
  import java.io.IOException;
<span class="line-added">+ </span>
<span class="line-added">+ import static java.net.InetAddress.IPv6;</span>
  import static java.net.InetAddress.PREFER_IPV6_VALUE;
  import static java.net.InetAddress.PREFER_SYSTEM_VALUE;
  
  /*
   * Package private implementation of InetAddressImpl for dual
   * IPv4/IPv6 stack.
   * &lt;p&gt;
<span class="line-modified">!  * If InetAddress.preferIPv6Address is true then anyLocalAddress()</span>
<span class="line-modified">!  * and localHost() will return IPv6 addresses, otherwise IPv4 addresses.</span>
<span class="line-modified">!  *</span>
<span class="line-added">+  * loopbackAddress() will return the first valid loopback address in</span>
<span class="line-added">+  * [IPv6 loopback, IPv4 loopback] if InetAddress.preferIPv6Address is true,</span>
<span class="line-added">+  * else [IPv4 loopback, IPv6 loopback].</span>
<span class="line-added">+  * If neither are valid it will fallback to the first address tried.</span>
   *
   * @since 1.4
   */
  class Inet6AddressImpl implements InetAddressImpl {
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 64,11 ***</span>
               * Which means same family as addr because at this point it could
               * be either an IPv6 address or an IPv4 address (case of a dual
               * stack system).
               */
              java.util.Enumeration&lt;InetAddress&gt; it = netif.getInetAddresses();
<span class="line-modified">!             InetAddress inetaddr = null;</span>
              while (it.hasMoreElements()) {
                  inetaddr = it.nextElement();
                  if (inetaddr.getClass().isInstance(addr)) {
                      ifaddr = inetaddr.getAddress();
                      if (inetaddr instanceof Inet6Address) {
<span class="line-new-header">--- 70,11 ---</span>
               * Which means same family as addr because at this point it could
               * be either an IPv6 address or an IPv4 address (case of a dual
               * stack system).
               */
              java.util.Enumeration&lt;InetAddress&gt; it = netif.getInetAddresses();
<span class="line-modified">!             InetAddress inetaddr;</span>
              while (it.hasMoreElements()) {
                  inetaddr = it.nextElement();
                  if (inetaddr.getClass().isInstance(addr)) {
                      ifaddr = inetaddr.getAddress();
                      if (inetaddr instanceof Inet6Address) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 101,19 ***</span>
          return anyLocalAddress;
      }
  
      public synchronized InetAddress loopbackAddress() {
          if (loopbackAddress == null) {
<span class="line-modified">!              if (InetAddress.preferIPv6Address == PREFER_IPV6_VALUE ||</span>
<span class="line-modified">!                  InetAddress.preferIPv6Address == PREFER_SYSTEM_VALUE) {</span>
<span class="line-modified">!                  byte[] loopback =</span>
<span class="line-modified">!                         {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span>
<span class="line-modified">!                          0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01};</span>
<span class="line-modified">!                  loopbackAddress = new Inet6Address(&quot;localhost&quot;, loopback);</span>
<span class="line-modified">!              } else {</span>
<span class="line-modified">!                 loopbackAddress = (new Inet4AddressImpl()).loopbackAddress();</span>
<span class="line-modified">!              }</span>
          }
          return loopbackAddress;
      }
  
      private InetAddress anyLocalAddress;
<span class="line-new-header">--- 107,38 ---</span>
          return anyLocalAddress;
      }
  
      public synchronized InetAddress loopbackAddress() {
          if (loopbackAddress == null) {
<span class="line-modified">!             boolean preferIPv6Address =</span>
<span class="line-modified">!                 InetAddress.preferIPv6Address == PREFER_IPV6_VALUE ||</span>
<span class="line-modified">!                 InetAddress.preferIPv6Address == PREFER_SYSTEM_VALUE;</span>
<span class="line-modified">! </span>
<span class="line-modified">!             for (int i = 0; i &lt; 2; i++) {</span>
<span class="line-modified">!                 InetAddress address;</span>
<span class="line-modified">!                 // Order the candidate addresses by preference.</span>
<span class="line-modified">!                 if (i == (preferIPv6Address ? 0 : 1)) {</span>
<span class="line-modified">!                     address = new Inet6Address(&quot;localhost&quot;,</span>
<span class="line-added">+                             new byte[]{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</span>
<span class="line-added">+                                         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01});</span>
<span class="line-added">+                 } else {</span>
<span class="line-added">+                     address = new Inet4Address(&quot;localhost&quot;, new byte[]{ 0x7f,0x00,0x00,0x01 });</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 if (i == 0) {</span>
<span class="line-added">+                     // In case of failure, default to the preferred address.</span>
<span class="line-added">+                     loopbackAddress = address;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 try {</span>
<span class="line-added">+                     if (!NetworkInterface.isBoundInetAddress(address)) {</span>
<span class="line-added">+                         continue;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                 } catch (SocketException e) {</span>
<span class="line-added">+                     continue;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 loopbackAddress = address;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             }</span>
          }
          return loopbackAddress;
      }
  
      private InetAddress anyLocalAddress;
</pre>
<center><a href="Inet6Address.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="InetAddress.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>