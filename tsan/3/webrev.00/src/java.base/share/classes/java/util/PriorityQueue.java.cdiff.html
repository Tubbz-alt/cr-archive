<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/util/PriorityQueue.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="Optional.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Properties.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/PriorityQueue.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 26,10 ***</span>
<span class="line-new-header">--- 26,11 ---</span>
  package java.util;
  
  import java.util.function.Consumer;
  import java.util.function.Predicate;
  import jdk.internal.access.SharedSecrets;
<span class="line-added">+ import jdk.internal.util.ArraysSupport;</span>
  
  /**
   * An unbounded priority {@linkplain Queue queue} based on a priority heap.
   * The elements of the priority queue are ordered according to their
   * {@linkplain Comparable natural ordering}, or by a {@link Comparator}
</pre>
<hr />
<pre>
<span class="line-old-header">*** 84,10 ***</span>
<span class="line-new-header">--- 85,11 ---</span>
   */
  @SuppressWarnings(&quot;unchecked&quot;)
  public class PriorityQueue&lt;E&gt; extends AbstractQueue&lt;E&gt;
      implements java.io.Serializable {
  
<span class="line-added">+     @java.io.Serial</span>
      private static final long serialVersionUID = -7720805057305804111L;
  
      private static final int DEFAULT_INITIAL_CAPACITY = 11;
  
      /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 107,10 ***</span>
<span class="line-new-header">--- 109,11 ---</span>
  
      /**
       * The comparator, or null if priority queue uses elements&#39;
       * natural ordering.
       */
<span class="line-added">+     @SuppressWarnings(&quot;serial&quot;) // Conditionally serializable</span>
      private final Comparator&lt;? super E&gt; comparator;
  
      /**
       * The number of times this priority queue has been
       * &lt;i&gt;structurally modified&lt;/i&gt;.  See AbstractList for gory details.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 279,43 ***</span>
      private void initFromCollection(Collection&lt;? extends E&gt; c) {
          initElementsFromCollection(c);
          heapify();
      }
  
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * The maximum size of array to allocate.</span>
<span class="line-removed">-      * Some VMs reserve some header words in an array.</span>
<span class="line-removed">-      * Attempts to allocate larger arrays may result in</span>
<span class="line-removed">-      * OutOfMemoryError: Requested array size exceeds VM limit</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;</span>
<span class="line-removed">- </span>
      /**
       * Increases the capacity of the array.
       *
       * @param minCapacity the desired minimum capacity
       */
      private void grow(int minCapacity) {
          int oldCapacity = queue.length;
          // Double size if small; else grow by 50%
<span class="line-modified">!         int newCapacity = oldCapacity + ((oldCapacity &lt; 64) ?</span>
<span class="line-modified">!                                          (oldCapacity + 2) :</span>
<span class="line-modified">!                                          (oldCapacity &gt;&gt; 1));</span>
<span class="line-modified">!         // overflow-conscious code</span>
<span class="line-removed">-         if (newCapacity - MAX_ARRAY_SIZE &gt; 0)</span>
<span class="line-removed">-             newCapacity = hugeCapacity(minCapacity);</span>
          queue = Arrays.copyOf(queue, newCapacity);
      }
  
<span class="line-removed">-     private static int hugeCapacity(int minCapacity) {</span>
<span class="line-removed">-         if (minCapacity &lt; 0) // overflow</span>
<span class="line-removed">-             throw new OutOfMemoryError();</span>
<span class="line-removed">-         return (minCapacity &gt; MAX_ARRAY_SIZE) ?</span>
<span class="line-removed">-             Integer.MAX_VALUE :</span>
<span class="line-removed">-             MAX_ARRAY_SIZE;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      /**
       * Inserts the specified element into this priority queue.
       *
       * @return {@code true} (as specified by {@link Collection#add})
       * @throws ClassCastException if the specified element cannot be
<span class="line-new-header">--- 282,25 ---</span>
      private void initFromCollection(Collection&lt;? extends E&gt; c) {
          initElementsFromCollection(c);
          heapify();
      }
  
      /**
       * Increases the capacity of the array.
       *
       * @param minCapacity the desired minimum capacity
       */
      private void grow(int minCapacity) {
          int oldCapacity = queue.length;
          // Double size if small; else grow by 50%
<span class="line-modified">!         int newCapacity = ArraysSupport.newLength(oldCapacity,</span>
<span class="line-modified">!                 minCapacity - oldCapacity, /* minimum growth */</span>
<span class="line-modified">!                 oldCapacity &lt; 64 ? oldCapacity + 2 : oldCapacity &gt;&gt; 1</span>
<span class="line-modified">!                                            /* preferred growth */);</span>
          queue = Arrays.copyOf(queue, newCapacity);
      }
  
      /**
       * Inserts the specified element into this priority queue.
       *
       * @return {@code true} (as specified by {@link Collection#add})
       * @throws ClassCastException if the specified element cannot be
</pre>
<hr />
<pre>
<span class="line-old-header">*** 770,10 ***</span>
<span class="line-new-header">--- 755,11 ---</span>
       * @throws java.io.IOException if an I/O error occurs
       * @serialData The length of the array backing the instance is
       *             emitted (int), followed by all of its elements
       *             (each an {@code Object}) in the proper order.
       */
<span class="line-added">+     @java.io.Serial</span>
      private void writeObject(java.io.ObjectOutputStream s)
          throws java.io.IOException {
          // Write out element count, and any hidden stuff
          s.defaultWriteObject();
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 793,10 ***</span>
<span class="line-new-header">--- 779,11 ---</span>
       * @param s the stream
       * @throws ClassNotFoundException if the class of a serialized object
       *         could not be found
       * @throws java.io.IOException if an I/O error occurs
       */
<span class="line-added">+     @java.io.Serial</span>
      private void readObject(java.io.ObjectInputStream s)
          throws java.io.IOException, ClassNotFoundException {
          // Read in size, and any hidden stuff
          s.defaultReadObject();
  
</pre>
<center><a href="Optional.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Properties.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>