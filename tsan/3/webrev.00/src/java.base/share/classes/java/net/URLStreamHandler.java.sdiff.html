<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/net/URLStreamHandler.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="URLPermission.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="UnknownHostException.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/net/URLStreamHandler.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1995, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.net;
 27 
 28 import java.io.IOException;
 29 import java.io.InputStream;
 30 import java.io.File;
 31 import java.io.OutputStream;
 32 import java.util.Hashtable;

 33 import sun.net.util.IPAddressUtil;
 34 import sun.net.www.ParseUtil;
 35 
 36 /**
 37  * The abstract class {@code URLStreamHandler} is the common
 38  * superclass for all stream protocol handlers. A stream protocol
 39  * handler knows how to make a connection for a particular protocol
 40  * type, such as {@code http} or {@code https}.
 41  * &lt;p&gt;
 42  * In most cases, an instance of a {@code URLStreamHandler}
 43  * subclass is not created directly by an application. Rather, the
 44  * first time a protocol name is encountered when constructing a
 45  * {@code URL}, the appropriate stream protocol handler is
 46  * automatically loaded.
 47  *
 48  * @author  James Gosling
 49  * @see     java.net.URL#URL(java.lang.String, java.lang.String, int, java.lang.String)
 50  * @since   1.0
 51  */
 52 public abstract class URLStreamHandler {
 53     /**
 54      * Opens a connection to the object referenced by the
 55      * {@code URL} argument.
 56      * This method should be overridden by a subclass.
 57      *
 58      * &lt;p&gt;If for the handler&#39;s protocol (such as HTTP or JAR), there
 59      * exists a public, specialized URLConnection subclass belonging
 60      * to one of the following packages or one of their subpackages:
 61      * java.lang, java.io, java.util, java.net, the connection
 62      * returned will be of that subclass. For example, for HTTP an
 63      * HttpURLConnection will be returned, and for JAR a
 64      * JarURLConnection will be returned.
 65      *
 66      * @param      u   the URL that this connects to.
 67      * @return     a {@code URLConnection} object for the {@code URL}.
<span class="line-modified"> 68      * @exception  IOException  if an I/O error occurs while opening the</span>
 69      *               connection.
 70      */
 71     protected abstract URLConnection openConnection(URL u) throws IOException;
 72 
 73     /**
 74      * Same as openConnection(URL), except that the connection will be
 75      * made through the specified proxy; Protocol handlers that do not
 76      * support proxying will ignore the proxy parameter and make a
 77      * normal connection.
 78      *
<span class="line-modified"> 79      * Calling this method preempts the system&#39;s default</span>
 80      * {@link java.net.ProxySelector ProxySelector} settings.
 81      *






 82      * @param      u   the URL that this connects to.
 83      * @param      p   the proxy through which the connection will be made.
 84      *                 If direct connection is desired, Proxy.NO_PROXY
 85      *                 should be specified.
 86      * @return     a {@code URLConnection} object for the {@code URL}.
<span class="line-modified"> 87      * @exception  IOException  if an I/O error occurs while opening the</span>
 88      *               connection.
<span class="line-modified"> 89      * @exception  IllegalArgumentException if either u or p is null,</span>
 90      *               or p has the wrong type.
<span class="line-modified"> 91      * @exception  UnsupportedOperationException if the subclass that</span>
 92      *               implements the protocol doesn&#39;t support this method.
 93      * @since      1.5
 94      */
 95     protected URLConnection openConnection(URL u, Proxy p) throws IOException {


 96         throw new UnsupportedOperationException(&quot;Method not implemented.&quot;);
 97     }
 98 
 99     /**
100      * Parses the string representation of a {@code URL} into a
101      * {@code URL} object.
102      * &lt;p&gt;
103      * If there is any inherited context, then it has already been
104      * copied into the {@code URL} argument.
105      * &lt;p&gt;
106      * The {@code parseURL} method of {@code URLStreamHandler}
107      * parses the string representation as if it were an
108      * {@code http} specification. Most URL protocol families have a
109      * similar parsing. A stream protocol handler for a protocol that has
110      * a different syntax must override this routine.
111      *
112      * @param   u       the {@code URL} to receive the result of parsing
113      *                  the spec.
114      * @param   spec    the {@code String} representing the URL that
115      *                  must be parsed.
</pre>
<hr />
<pre>
318      * @return the default port for a {@code URL} parsed by this handler.
319      * @since 1.3
320      */
321     protected int getDefaultPort() {
322         return -1;
323     }
324 
325     /**
326      * Provides the default equals calculation. May be overridden by handlers
327      * for other protocols that have different requirements for equals().
328      * This method requires that none of its arguments is null. This is
329      * guaranteed by the fact that it is only called by java.net.URL class.
330      * @param u1 a URL object
331      * @param u2 a URL object
332      * @return {@code true} if the two urls are
333      * considered equal, i.e. they refer to the same
334      * fragment in the same file.
335      * @since 1.3
336      */
337     protected boolean equals(URL u1, URL u2) {
<span class="line-modified">338         String ref1 = u1.getRef();</span>
<span class="line-removed">339         String ref2 = u2.getRef();</span>
<span class="line-removed">340         return (ref1 == ref2 || (ref1 != null &amp;&amp; ref1.equals(ref2))) &amp;&amp;</span>
<span class="line-removed">341                sameFile(u1, u2);</span>
342     }
343 
344     /**
345      * Provides the default hash calculation. May be overridden by handlers for
346      * other protocols that have different requirements for hashCode
347      * calculation.
348      * @param u a URL object
349      * @return an {@code int} suitable for hash table indexing
350      * @since 1.3
351      */
352     protected int hashCode(URL u) {
353         int h = 0;
354 
355         // Generate the protocol part.
356         String protocol = u.getProtocol();
357         if (protocol != null)
358             h += protocol.hashCode();
359 
360         // Generate the host part.
361         InetAddress addr = getHostAddress(u);
</pre>
<hr />
<pre>
487                ? &quot;//&quot; + s : &quot;&quot;)
488             + ((s = u.getPath()) != null ? s : &quot;&quot;)
489             + ((s = u.getQuery()) != null ? &#39;?&#39; + s : &quot;&quot;)
490             + ((s = u.getRef()) != null ? &#39;#&#39; + s : &quot;&quot;);
491     }
492 
493     /**
494      * Sets the fields of the {@code URL} argument to the indicated values.
495      * Only classes derived from URLStreamHandler are able
496      * to use this method to set the values of the URL fields.
497      *
498      * @param   u         the URL to modify.
499      * @param   protocol  the protocol name.
500      * @param   host      the remote host value for the URL.
501      * @param   port      the port on the remote machine.
502      * @param   authority the authority part for the URL.
503      * @param   userInfo the userInfo part of the URL.
504      * @param   path      the path component of the URL.
505      * @param   query     the query part for the URL.
506      * @param   ref       the reference.
<span class="line-modified">507      * @exception       SecurityException       if the protocol handler of the URL is</span>
508      *                                  different from this one
509      * @since 1.3
510      */
<span class="line-modified">511        protected void setURL(URL u, String protocol, String host, int port,</span>
512                              String authority, String userInfo, String path,
513                              String query, String ref) {
514         if (this != u.handler) {
515             throw new SecurityException(&quot;handler for url different from &quot; +
516                                         &quot;this handler&quot;);



517         }
518         // ensure that no one can reset the protocol on a given URL.
519         u.set(u.getProtocol(), host, port, authority, userInfo, path, query, ref);
520     }
521 
522     /**
523      * Sets the fields of the {@code URL} argument to the indicated values.
524      * Only classes derived from URLStreamHandler are able
525      * to use this method to set the values of the URL fields.
526      *
527      * @param   u         the URL to modify.
528      * @param   protocol  the protocol name. This value is ignored since 1.2.
529      * @param   host      the remote host value for the URL.
530      * @param   port      the port on the remote machine.
531      * @param   file      the file.
532      * @param   ref       the reference.
<span class="line-modified">533      * @exception       SecurityException       if the protocol handler of the URL is</span>
534      *                                  different from this one
535      * @deprecated Use setURL(URL, String, String, int, String, String, String,
536      *             String);
537      */
538     @Deprecated
539     protected void setURL(URL u, String protocol, String host, int port,
540                           String file, String ref) {
541         /*
542          * Only old URL handlers call this, so assume that the host
543          * field might contain &quot;user:passwd@host&quot;. Fix as necessary.
544          */
545         String authority = null;
546         String userInfo = null;
547         if (host != null &amp;&amp; !host.isEmpty()) {
548             authority = (port == -1) ? host : host + &quot;:&quot; + port;
549             int at = host.lastIndexOf(&#39;@&#39;);
550             if (at != -1) {
551                 userInfo = host.substring(0, at);
552                 host = host.substring(at+1);
553             }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1995, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.net;
 27 
 28 import java.io.IOException;
 29 import java.io.InputStream;
 30 import java.io.File;
 31 import java.io.OutputStream;
 32 import java.util.Hashtable;
<span class="line-added"> 33 import java.util.Objects;</span>
 34 import sun.net.util.IPAddressUtil;
 35 import sun.net.www.ParseUtil;
 36 
 37 /**
 38  * The abstract class {@code URLStreamHandler} is the common
 39  * superclass for all stream protocol handlers. A stream protocol
 40  * handler knows how to make a connection for a particular protocol
 41  * type, such as {@code http} or {@code https}.
 42  * &lt;p&gt;
 43  * In most cases, an instance of a {@code URLStreamHandler}
 44  * subclass is not created directly by an application. Rather, the
 45  * first time a protocol name is encountered when constructing a
 46  * {@code URL}, the appropriate stream protocol handler is
 47  * automatically loaded.
 48  *
 49  * @author  James Gosling
 50  * @see     java.net.URL#URL(java.lang.String, java.lang.String, int, java.lang.String)
 51  * @since   1.0
 52  */
 53 public abstract class URLStreamHandler {
 54     /**
 55      * Opens a connection to the object referenced by the
 56      * {@code URL} argument.
 57      * This method should be overridden by a subclass.
 58      *
 59      * &lt;p&gt;If for the handler&#39;s protocol (such as HTTP or JAR), there
 60      * exists a public, specialized URLConnection subclass belonging
 61      * to one of the following packages or one of their subpackages:
 62      * java.lang, java.io, java.util, java.net, the connection
 63      * returned will be of that subclass. For example, for HTTP an
 64      * HttpURLConnection will be returned, and for JAR a
 65      * JarURLConnection will be returned.
 66      *
 67      * @param      u   the URL that this connects to.
 68      * @return     a {@code URLConnection} object for the {@code URL}.
<span class="line-modified"> 69      * @throws     IOException  if an I/O error occurs while opening the</span>
 70      *               connection.
 71      */
 72     protected abstract URLConnection openConnection(URL u) throws IOException;
 73 
 74     /**
 75      * Same as openConnection(URL), except that the connection will be
 76      * made through the specified proxy; Protocol handlers that do not
 77      * support proxying will ignore the proxy parameter and make a
 78      * normal connection.
 79      *
<span class="line-modified"> 80      * &lt;p&gt; Calling this method preempts the system&#39;s default</span>
 81      * {@link java.net.ProxySelector ProxySelector} settings.
 82      *
<span class="line-added"> 83      * @implSpec</span>
<span class="line-added"> 84      * The default implementation of this method first checks that the given</span>
<span class="line-added"> 85      * {@code URL} and {@code Proxy} are not null, then throws {@code</span>
<span class="line-added"> 86      * UnsupportedOperationException}. Subclasses should override this method</span>
<span class="line-added"> 87      * with an appropriate implementation.</span>
<span class="line-added"> 88      *</span>
 89      * @param      u   the URL that this connects to.
 90      * @param      p   the proxy through which the connection will be made.
 91      *                 If direct connection is desired, Proxy.NO_PROXY
 92      *                 should be specified.
 93      * @return     a {@code URLConnection} object for the {@code URL}.
<span class="line-modified"> 94      * @throws     IOException  if an I/O error occurs while opening the</span>
 95      *               connection.
<span class="line-modified"> 96      * @throws     IllegalArgumentException if either u or p is null,</span>
 97      *               or p has the wrong type.
<span class="line-modified"> 98      * @throws     UnsupportedOperationException if the subclass that</span>
 99      *               implements the protocol doesn&#39;t support this method.
100      * @since      1.5
101      */
102     protected URLConnection openConnection(URL u, Proxy p) throws IOException {
<span class="line-added">103         if (u == null || p == null)</span>
<span class="line-added">104             throw new IllegalArgumentException(&quot;null &quot; + (u == null ? &quot;url&quot; : &quot;proxy&quot;));</span>
105         throw new UnsupportedOperationException(&quot;Method not implemented.&quot;);
106     }
107 
108     /**
109      * Parses the string representation of a {@code URL} into a
110      * {@code URL} object.
111      * &lt;p&gt;
112      * If there is any inherited context, then it has already been
113      * copied into the {@code URL} argument.
114      * &lt;p&gt;
115      * The {@code parseURL} method of {@code URLStreamHandler}
116      * parses the string representation as if it were an
117      * {@code http} specification. Most URL protocol families have a
118      * similar parsing. A stream protocol handler for a protocol that has
119      * a different syntax must override this routine.
120      *
121      * @param   u       the {@code URL} to receive the result of parsing
122      *                  the spec.
123      * @param   spec    the {@code String} representing the URL that
124      *                  must be parsed.
</pre>
<hr />
<pre>
327      * @return the default port for a {@code URL} parsed by this handler.
328      * @since 1.3
329      */
330     protected int getDefaultPort() {
331         return -1;
332     }
333 
334     /**
335      * Provides the default equals calculation. May be overridden by handlers
336      * for other protocols that have different requirements for equals().
337      * This method requires that none of its arguments is null. This is
338      * guaranteed by the fact that it is only called by java.net.URL class.
339      * @param u1 a URL object
340      * @param u2 a URL object
341      * @return {@code true} if the two urls are
342      * considered equal, i.e. they refer to the same
343      * fragment in the same file.
344      * @since 1.3
345      */
346     protected boolean equals(URL u1, URL u2) {
<span class="line-modified">347         return Objects.equals(u1.getRef(), u2.getRef()) &amp;&amp; sameFile(u1, u2);</span>



348     }
349 
350     /**
351      * Provides the default hash calculation. May be overridden by handlers for
352      * other protocols that have different requirements for hashCode
353      * calculation.
354      * @param u a URL object
355      * @return an {@code int} suitable for hash table indexing
356      * @since 1.3
357      */
358     protected int hashCode(URL u) {
359         int h = 0;
360 
361         // Generate the protocol part.
362         String protocol = u.getProtocol();
363         if (protocol != null)
364             h += protocol.hashCode();
365 
366         // Generate the host part.
367         InetAddress addr = getHostAddress(u);
</pre>
<hr />
<pre>
493                ? &quot;//&quot; + s : &quot;&quot;)
494             + ((s = u.getPath()) != null ? s : &quot;&quot;)
495             + ((s = u.getQuery()) != null ? &#39;?&#39; + s : &quot;&quot;)
496             + ((s = u.getRef()) != null ? &#39;#&#39; + s : &quot;&quot;);
497     }
498 
499     /**
500      * Sets the fields of the {@code URL} argument to the indicated values.
501      * Only classes derived from URLStreamHandler are able
502      * to use this method to set the values of the URL fields.
503      *
504      * @param   u         the URL to modify.
505      * @param   protocol  the protocol name.
506      * @param   host      the remote host value for the URL.
507      * @param   port      the port on the remote machine.
508      * @param   authority the authority part for the URL.
509      * @param   userInfo the userInfo part of the URL.
510      * @param   path      the path component of the URL.
511      * @param   query     the query part for the URL.
512      * @param   ref       the reference.
<span class="line-modified">513      * @throws          SecurityException       if the protocol handler of the URL is</span>
514      *                                  different from this one
515      * @since 1.3
516      */
<span class="line-modified">517     protected void setURL(URL u, String protocol, String host, int port,</span>
518                              String authority, String userInfo, String path,
519                              String query, String ref) {
520         if (this != u.handler) {
521             throw new SecurityException(&quot;handler for url different from &quot; +
522                                         &quot;this handler&quot;);
<span class="line-added">523         } else if (host != null &amp;&amp; u.isBuiltinStreamHandler(this)) {</span>
<span class="line-added">524             String s = IPAddressUtil.checkHostString(host);</span>
<span class="line-added">525             if (s != null) throw new IllegalArgumentException(s);</span>
526         }
527         // ensure that no one can reset the protocol on a given URL.
528         u.set(u.getProtocol(), host, port, authority, userInfo, path, query, ref);
529     }
530 
531     /**
532      * Sets the fields of the {@code URL} argument to the indicated values.
533      * Only classes derived from URLStreamHandler are able
534      * to use this method to set the values of the URL fields.
535      *
536      * @param   u         the URL to modify.
537      * @param   protocol  the protocol name. This value is ignored since 1.2.
538      * @param   host      the remote host value for the URL.
539      * @param   port      the port on the remote machine.
540      * @param   file      the file.
541      * @param   ref       the reference.
<span class="line-modified">542      * @throws          SecurityException       if the protocol handler of the URL is</span>
543      *                                  different from this one
544      * @deprecated Use setURL(URL, String, String, int, String, String, String,
545      *             String);
546      */
547     @Deprecated
548     protected void setURL(URL u, String protocol, String host, int port,
549                           String file, String ref) {
550         /*
551          * Only old URL handlers call this, so assume that the host
552          * field might contain &quot;user:passwd@host&quot;. Fix as necessary.
553          */
554         String authority = null;
555         String userInfo = null;
556         if (host != null &amp;&amp; !host.isEmpty()) {
557             authority = (port == -1) ? host : host + &quot;:&quot; + port;
558             int at = host.lastIndexOf(&#39;@&#39;);
559             if (at != -1) {
560                 userInfo = host.substring(0, at);
561                 host = host.substring(at+1);
562             }
</pre>
</td>
</tr>
</table>
<center><a href="URLPermission.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="UnknownHostException.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>