<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/util/concurrent/CopyOnWriteArrayList.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ConcurrentSkipListSet.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ExecutorService.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/concurrent/CopyOnWriteArrayList.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 396      * @throws IndexOutOfBoundsException {@inheritDoc}
 397      */
 398     public E get(int index) {
 399         return elementAt(getArray(), index);
 400     }
 401 
 402     /**
 403      * Replaces the element at the specified position in this list with the
 404      * specified element.
 405      *
 406      * @throws IndexOutOfBoundsException {@inheritDoc}
 407      */
 408     public E set(int index, E element) {
 409         synchronized (lock) {
 410             Object[] es = getArray();
 411             E oldValue = elementAt(es, index);
 412 
 413             if (oldValue != element) {
 414                 es = es.clone();
 415                 es[index] = element;
<span class="line-removed"> 416                 setArray(es);</span>
 417             }


 418             return oldValue;
 419         }
 420     }
 421 
 422     /**
 423      * Appends the specified element to the end of this list.
 424      *
 425      * @param e element to be appended to this list
 426      * @return {@code true} (as specified by {@link Collection#add})
 427      */
 428     public boolean add(E e) {
 429         synchronized (lock) {
 430             Object[] es = getArray();
 431             int len = es.length;
 432             es = Arrays.copyOf(es, len + 1);
 433             es[len] = e;
 434             setArray(es);
 435             return true;
 436         }
 437     }
</pre>
</td>
<td>
<hr />
<pre>
 396      * @throws IndexOutOfBoundsException {@inheritDoc}
 397      */
 398     public E get(int index) {
 399         return elementAt(getArray(), index);
 400     }
 401 
 402     /**
 403      * Replaces the element at the specified position in this list with the
 404      * specified element.
 405      *
 406      * @throws IndexOutOfBoundsException {@inheritDoc}
 407      */
 408     public E set(int index, E element) {
 409         synchronized (lock) {
 410             Object[] es = getArray();
 411             E oldValue = elementAt(es, index);
 412 
 413             if (oldValue != element) {
 414                 es = es.clone();
 415                 es[index] = element;

 416             }
<span class="line-added"> 417             // Ensure volatile write semantics even when oldvalue == element</span>
<span class="line-added"> 418             setArray(es);</span>
 419             return oldValue;
 420         }
 421     }
 422 
 423     /**
 424      * Appends the specified element to the end of this list.
 425      *
 426      * @param e element to be appended to this list
 427      * @return {@code true} (as specified by {@link Collection#add})
 428      */
 429     public boolean add(E e) {
 430         synchronized (lock) {
 431             Object[] es = getArray();
 432             int len = es.length;
 433             es = Arrays.copyOf(es, len + 1);
 434             es[len] = e;
 435             setArray(es);
 436             return true;
 437         }
 438     }
</pre>
</td>
</tr>
</table>
<center><a href="ConcurrentSkipListSet.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ExecutorService.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>