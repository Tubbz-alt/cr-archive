<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/security/AccessController.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="AccessControlException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="AlgorithmParameterGenerator.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/AccessController.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 281     private AccessController() { }
 282 
 283     /**
 284      * Performs the specified {@code PrivilegedAction} with privileges
 285      * enabled. The action is performed with &lt;i&gt;all&lt;/i&gt; of the permissions
 286      * possessed by the caller&#39;s protection domain.
 287      *
 288      * &lt;p&gt; If the action&#39;s {@code run} method throws an (unchecked)
 289      * exception, it will propagate through this method.
 290      *
 291      * &lt;p&gt; Note that any DomainCombiner associated with the current
 292      * AccessControlContext will be ignored while the action is performed.
 293      *
 294      * @param &lt;T&gt; the type of the value returned by the PrivilegedAction&#39;s
 295      *                  {@code run} method.
 296      *
 297      * @param action the action to be performed.
 298      *
 299      * @return the value returned by the action&#39;s {@code run} method.
 300      *
<span class="line-modified"> 301      * @exception NullPointerException if the action is {@code null}</span>
 302      *
 303      * @see #doPrivileged(PrivilegedAction,AccessControlContext)
 304      * @see #doPrivileged(PrivilegedExceptionAction)
 305      * @see #doPrivilegedWithCombiner(PrivilegedAction)
 306      * @see java.security.DomainCombiner
 307      */
 308 
 309     @CallerSensitive
 310     public static &lt;T&gt; T doPrivileged(PrivilegedAction&lt;T&gt; action)
 311     {
 312         return executePrivileged(action, null, Reflection.getCallerClass());
 313     }
 314 
 315     /**
 316      * Performs the specified {@code PrivilegedAction} with privileges
 317      * enabled. The action is performed with &lt;i&gt;all&lt;/i&gt; of the permissions
 318      * possessed by the caller&#39;s protection domain.
 319      *
 320      * &lt;p&gt; If the action&#39;s {@code run} method throws an (unchecked)
 321      * exception, it will propagate through this method.
 322      *
 323      * &lt;p&gt; This method preserves the current AccessControlContext&#39;s
 324      * DomainCombiner (which may be null) while the action is performed.
 325      *
 326      * @param &lt;T&gt; the type of the value returned by the PrivilegedAction&#39;s
 327      *                  {@code run} method.
 328      *
 329      * @param action the action to be performed.
 330      *
 331      * @return the value returned by the action&#39;s {@code run} method.
 332      *
<span class="line-modified"> 333      * @exception NullPointerException if the action is {@code null}</span>
 334      *
 335      * @see #doPrivileged(PrivilegedAction)
 336      * @see java.security.DomainCombiner
 337      *
 338      * @since 1.6
 339      */
 340     @CallerSensitive
 341     public static &lt;T&gt; T doPrivilegedWithCombiner(PrivilegedAction&lt;T&gt; action) {
 342         AccessControlContext acc = getStackAccessControlContext();
 343         if (acc == null) {
 344             return AccessController.doPrivileged(action);
 345         }
 346         DomainCombiner dc = acc.getAssignedCombiner();
 347         return AccessController.doPrivileged(action,
 348                                              preserveCombiner(dc, Reflection.getCallerClass()));
 349     }
 350 
 351 
 352     /**
 353      * Performs the specified {@code PrivilegedAction} with privileges
</pre>
<hr />
<pre>
 360      * it will propagate through this method.
 361      * &lt;p&gt;
 362      * If a security manager is installed and the specified
 363      * {@code AccessControlContext} was not created by system code and the
 364      * caller&#39;s {@code ProtectionDomain} has not been granted the
 365      * {@literal &quot;createAccessControlContext&quot;}
 366      * {@link java.security.SecurityPermission}, then the action is performed
 367      * with no permissions.
 368      *
 369      * @param &lt;T&gt; the type of the value returned by the PrivilegedAction&#39;s
 370      *                  {@code run} method.
 371      * @param action the action to be performed.
 372      * @param context an &lt;i&gt;access control context&lt;/i&gt;
 373      *                representing the restriction to be applied to the
 374      *                caller&#39;s domain&#39;s privileges before performing
 375      *                the specified action.  If the context is
 376      *                {@code null}, then no additional restriction is applied.
 377      *
 378      * @return the value returned by the action&#39;s {@code run} method.
 379      *
<span class="line-modified"> 380      * @exception NullPointerException if the action is {@code null}</span>
 381      *
 382      * @see #doPrivileged(PrivilegedAction)
 383      * @see #doPrivileged(PrivilegedExceptionAction,AccessControlContext)
 384      */
 385     @CallerSensitive
 386     public static &lt;T&gt; T doPrivileged(PrivilegedAction&lt;T&gt; action,
 387                                      AccessControlContext context)
 388     {
 389         Class&lt;?&gt; caller = Reflection.getCallerClass();
 390         context = checkContext(context, caller);
 391         return executePrivileged(action, context, caller);
 392     }
 393 
 394 
 395     /**
 396      * Performs the specified {@code PrivilegedAction} with privileges
 397      * enabled and restricted by the specified
 398      * {@code AccessControlContext} and with a privilege scope limited
 399      * by specified {@code Permission} arguments.
 400      *
</pre>
<hr />
<pre>
 428      *
 429      * @return the value returned by the action&#39;s {@code run} method.
 430      *
 431      * @throws NullPointerException if action or perms or any element of
 432      *         perms is {@code null}
 433      *
 434      * @see #doPrivileged(PrivilegedAction)
 435      * @see #doPrivileged(PrivilegedExceptionAction,AccessControlContext)
 436      *
 437      * @since 1.8
 438      */
 439     @CallerSensitive
 440     public static &lt;T&gt; T doPrivileged(PrivilegedAction&lt;T&gt; action,
 441         AccessControlContext context, Permission... perms) {
 442 
 443         AccessControlContext parent = getContext();
 444         if (perms == null) {
 445             throw new NullPointerException(&quot;null permissions parameter&quot;);
 446         }
 447         Class&lt;?&gt; caller = Reflection.getCallerClass();
<span class="line-modified"> 448         return AccessController.doPrivileged(action, createWrapper(null,</span>

 449             caller, parent, context, perms));
 450     }
 451 
 452 
 453     /**
 454      * Performs the specified {@code PrivilegedAction} with privileges
 455      * enabled and restricted by the specified
 456      * {@code AccessControlContext} and with a privilege scope limited
 457      * by specified {@code Permission} arguments.
 458      *
 459      * The action is performed with the intersection of the permissions
 460      * possessed by the caller&#39;s protection domain, and those possessed
 461      * by the domains represented by the specified
 462      * {@code AccessControlContext}.
 463      * &lt;p&gt;
 464      * If the action&#39;s {@code run} method throws an (unchecked) exception,
 465      * it will propagate through this method.
 466      *
 467      * &lt;p&gt; This method preserves the current AccessControlContext&#39;s
 468      * DomainCombiner (which may be null) while the action is performed.
</pre>
<hr />
<pre>
 516     }
 517 
 518     /**
 519      * Performs the specified {@code PrivilegedExceptionAction} with
 520      * privileges enabled.  The action is performed with &lt;i&gt;all&lt;/i&gt; of the
 521      * permissions possessed by the caller&#39;s protection domain.
 522      *
 523      * &lt;p&gt; If the action&#39;s {@code run} method throws an &lt;i&gt;unchecked&lt;/i&gt;
 524      * exception, it will propagate through this method.
 525      *
 526      * &lt;p&gt; Note that any DomainCombiner associated with the current
 527      * AccessControlContext will be ignored while the action is performed.
 528      *
 529      * @param &lt;T&gt; the type of the value returned by the
 530      *                  PrivilegedExceptionAction&#39;s {@code run} method.
 531      *
 532      * @param action the action to be performed
 533      *
 534      * @return the value returned by the action&#39;s {@code run} method
 535      *
<span class="line-modified"> 536      * @exception PrivilegedActionException if the specified action&#39;s</span>
 537      *         {@code run} method threw a &lt;i&gt;checked&lt;/i&gt; exception
<span class="line-modified"> 538      * @exception NullPointerException if the action is {@code null}</span>
 539      *
 540      * @see #doPrivileged(PrivilegedAction)
 541      * @see #doPrivileged(PrivilegedExceptionAction,AccessControlContext)
 542      * @see #doPrivilegedWithCombiner(PrivilegedExceptionAction)
 543      * @see java.security.DomainCombiner
 544      */
 545     @CallerSensitive
 546     public static &lt;T&gt; T
 547         doPrivileged(PrivilegedExceptionAction&lt;T&gt; action)
 548         throws PrivilegedActionException
 549     {
 550         AccessControlContext context = null;
 551         Class&lt;?&gt; caller = Reflection.getCallerClass();
 552         try {
 553             return executePrivileged(action, context, caller);
 554         } catch (RuntimeException e) {
 555             throw e;
 556         } catch (Exception e) {
 557             throw wrapException(e);
 558         }
 559     }
 560 
 561     /**
 562      * Performs the specified {@code PrivilegedExceptionAction} with
 563      * privileges enabled.  The action is performed with &lt;i&gt;all&lt;/i&gt; of the
 564      * permissions possessed by the caller&#39;s protection domain.
 565      *
 566      * &lt;p&gt; If the action&#39;s {@code run} method throws an &lt;i&gt;unchecked&lt;/i&gt;
 567      * exception, it will propagate through this method.
 568      *
 569      * &lt;p&gt; This method preserves the current AccessControlContext&#39;s
 570      * DomainCombiner (which may be null) while the action is performed.
 571      *
 572      * @param &lt;T&gt; the type of the value returned by the
 573      *                  PrivilegedExceptionAction&#39;s {@code run} method.
 574      *
 575      * @param action the action to be performed.
 576      *
 577      * @return the value returned by the action&#39;s {@code run} method
 578      *
<span class="line-modified"> 579      * @exception PrivilegedActionException if the specified action&#39;s</span>
 580      *         {@code run} method threw a &lt;i&gt;checked&lt;/i&gt; exception
<span class="line-modified"> 581      * @exception NullPointerException if the action is {@code null}</span>
 582      *
 583      * @see #doPrivileged(PrivilegedAction)
 584      * @see #doPrivileged(PrivilegedExceptionAction,AccessControlContext)
 585      * @see java.security.DomainCombiner
 586      *
 587      * @since 1.6
 588      */
 589     @CallerSensitive
 590     public static &lt;T&gt; T doPrivilegedWithCombiner(PrivilegedExceptionAction&lt;T&gt; action)
 591         throws PrivilegedActionException
 592     {
 593         AccessControlContext acc = getStackAccessControlContext();
 594         if (acc == null) {
 595             return AccessController.doPrivileged(action);
 596         }
 597         DomainCombiner dc = acc.getAssignedCombiner();
 598         return AccessController.doPrivileged(action,
 599                                              preserveCombiner(dc, Reflection.getCallerClass()));
 600     }
 601 
</pre>
<hr />
<pre>
 654      * exception, it will propagate through this method.
 655      * &lt;p&gt;
 656      * If a security manager is installed and the specified
 657      * {@code AccessControlContext} was not created by system code and the
 658      * caller&#39;s {@code ProtectionDomain} has not been granted the
 659      * {@literal &quot;createAccessControlContext&quot;}
 660      * {@link java.security.SecurityPermission}, then the action is performed
 661      * with no permissions.
 662      *
 663      * @param &lt;T&gt; the type of the value returned by the
 664      *                  PrivilegedExceptionAction&#39;s {@code run} method.
 665      * @param action the action to be performed
 666      * @param context an &lt;i&gt;access control context&lt;/i&gt;
 667      *                representing the restriction to be applied to the
 668      *                caller&#39;s domain&#39;s privileges before performing
 669      *                the specified action.  If the context is
 670      *                {@code null}, then no additional restriction is applied.
 671      *
 672      * @return the value returned by the action&#39;s {@code run} method
 673      *
<span class="line-modified"> 674      * @exception PrivilegedActionException if the specified action&#39;s</span>
 675      *         {@code run} method threw a &lt;i&gt;checked&lt;/i&gt; exception
<span class="line-modified"> 676      * @exception NullPointerException if the action is {@code null}</span>
 677      *
 678      * @see #doPrivileged(PrivilegedAction)
 679      * @see #doPrivileged(PrivilegedAction,AccessControlContext)
 680      */
 681     @CallerSensitive
 682     public static &lt;T&gt; T
 683         doPrivileged(PrivilegedExceptionAction&lt;T&gt; action,
 684                      AccessControlContext context)
 685         throws PrivilegedActionException
 686     {
 687         Class&lt;?&gt; caller = Reflection.getCallerClass();
 688         context = checkContext(context, caller);
 689         try {
 690             return executePrivileged(action, context, caller);
 691         } catch (RuntimeException e) {
 692             throw e;
 693         } catch (Exception e) {
 694             throw wrapException(e);
 695         }
 696     }
</pre>
<hr />
<pre>
 843      * @throws PrivilegedActionException if the specified action&#39;s
 844      *         {@code run} method threw a &lt;i&gt;checked&lt;/i&gt; exception
 845      * @throws NullPointerException if action or perms or any element of
 846      *         perms is {@code null}
 847      *
 848      * @see #doPrivileged(PrivilegedAction)
 849      * @see #doPrivileged(PrivilegedAction,AccessControlContext)
 850      *
 851      * @since 1.8
 852      */
 853     @CallerSensitive
 854     public static &lt;T&gt; T doPrivileged(PrivilegedExceptionAction&lt;T&gt; action,
 855                                      AccessControlContext context, Permission... perms)
 856         throws PrivilegedActionException
 857     {
 858         AccessControlContext parent = getContext();
 859         if (perms == null) {
 860             throw new NullPointerException(&quot;null permissions parameter&quot;);
 861         }
 862         Class&lt;?&gt; caller = Reflection.getCallerClass();
<span class="line-modified"> 863         return AccessController.doPrivileged(action, createWrapper(null, caller, parent, context, perms));</span>

 864     }
 865 
 866 
 867     /**
 868      * Performs the specified {@code PrivilegedExceptionAction} with
 869      * privileges enabled and restricted by the specified
 870      * {@code AccessControlContext} and with a privilege scope limited by
 871      * specified {@code Permission} arguments.
 872      *
 873      * The action is performed with the intersection of the permissions
 874      * possessed by the caller&#39;s protection domain, and those possessed
 875      * by the domains represented by the specified
 876      * {@code AccessControlContext}.
 877      * &lt;p&gt;
 878      * If the action&#39;s {@code run} method throws an (unchecked) exception,
 879      * it will propagate through this method.
 880      *
 881      * &lt;p&gt; This method preserves the current AccessControlContext&#39;s
 882      * DomainCombiner (which may be null) while the action is performed.
 883      * &lt;p&gt;
</pre>
<hr />
<pre>
 971         if (acc == null) {
 972             // all we had was privileged system code. We don&#39;t want
 973             // to return null though, so we construct a real ACC.
 974             return new AccessControlContext(null, true);
 975         } else {
 976             return acc.optimize();
 977         }
 978     }
 979 
 980     /**
 981      * Determines whether the access request indicated by the
 982      * specified permission should be allowed or denied, based on
 983      * the current AccessControlContext and security policy.
 984      * This method quietly returns if the access request
 985      * is permitted, or throws an AccessControlException otherwise. The
 986      * getPermission method of the AccessControlException returns the
 987      * {@code perm} Permission object instance.
 988      *
 989      * @param perm the requested permission.
 990      *
<span class="line-modified"> 991      * @exception AccessControlException if the specified permission</span>
 992      *            is not permitted, based on the current security policy.
<span class="line-modified"> 993      * @exception NullPointerException if the specified permission</span>
 994      *            is {@code null} and is checked based on the
 995      *            security policy currently in effect.
 996      */
 997 
 998     public static void checkPermission(Permission perm)
 999         throws AccessControlException
1000     {
1001         //System.err.println(&quot;checkPermission &quot;+perm);
1002         //Thread.currentThread().dumpStack();
1003 
1004         if (perm == null) {
1005             throw new NullPointerException(&quot;permission can&#39;t be null&quot;);
1006         }
1007 
1008         AccessControlContext stack = getStackAccessControlContext();
1009         // if context is null, we had privileged system code on the stack.
1010         if (stack == null) {
1011             Debug debug = AccessControlContext.getDebug();
1012             boolean dumpDebug = false;
1013             if (debug != null) {
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 281     private AccessController() { }
 282 
 283     /**
 284      * Performs the specified {@code PrivilegedAction} with privileges
 285      * enabled. The action is performed with &lt;i&gt;all&lt;/i&gt; of the permissions
 286      * possessed by the caller&#39;s protection domain.
 287      *
 288      * &lt;p&gt; If the action&#39;s {@code run} method throws an (unchecked)
 289      * exception, it will propagate through this method.
 290      *
 291      * &lt;p&gt; Note that any DomainCombiner associated with the current
 292      * AccessControlContext will be ignored while the action is performed.
 293      *
 294      * @param &lt;T&gt; the type of the value returned by the PrivilegedAction&#39;s
 295      *                  {@code run} method.
 296      *
 297      * @param action the action to be performed.
 298      *
 299      * @return the value returned by the action&#39;s {@code run} method.
 300      *
<span class="line-modified"> 301      * @throws    NullPointerException if the action is {@code null}</span>
 302      *
 303      * @see #doPrivileged(PrivilegedAction,AccessControlContext)
 304      * @see #doPrivileged(PrivilegedExceptionAction)
 305      * @see #doPrivilegedWithCombiner(PrivilegedAction)
 306      * @see java.security.DomainCombiner
 307      */
 308 
 309     @CallerSensitive
 310     public static &lt;T&gt; T doPrivileged(PrivilegedAction&lt;T&gt; action)
 311     {
 312         return executePrivileged(action, null, Reflection.getCallerClass());
 313     }
 314 
 315     /**
 316      * Performs the specified {@code PrivilegedAction} with privileges
 317      * enabled. The action is performed with &lt;i&gt;all&lt;/i&gt; of the permissions
 318      * possessed by the caller&#39;s protection domain.
 319      *
 320      * &lt;p&gt; If the action&#39;s {@code run} method throws an (unchecked)
 321      * exception, it will propagate through this method.
 322      *
 323      * &lt;p&gt; This method preserves the current AccessControlContext&#39;s
 324      * DomainCombiner (which may be null) while the action is performed.
 325      *
 326      * @param &lt;T&gt; the type of the value returned by the PrivilegedAction&#39;s
 327      *                  {@code run} method.
 328      *
 329      * @param action the action to be performed.
 330      *
 331      * @return the value returned by the action&#39;s {@code run} method.
 332      *
<span class="line-modified"> 333      * @throws    NullPointerException if the action is {@code null}</span>
 334      *
 335      * @see #doPrivileged(PrivilegedAction)
 336      * @see java.security.DomainCombiner
 337      *
 338      * @since 1.6
 339      */
 340     @CallerSensitive
 341     public static &lt;T&gt; T doPrivilegedWithCombiner(PrivilegedAction&lt;T&gt; action) {
 342         AccessControlContext acc = getStackAccessControlContext();
 343         if (acc == null) {
 344             return AccessController.doPrivileged(action);
 345         }
 346         DomainCombiner dc = acc.getAssignedCombiner();
 347         return AccessController.doPrivileged(action,
 348                                              preserveCombiner(dc, Reflection.getCallerClass()));
 349     }
 350 
 351 
 352     /**
 353      * Performs the specified {@code PrivilegedAction} with privileges
</pre>
<hr />
<pre>
 360      * it will propagate through this method.
 361      * &lt;p&gt;
 362      * If a security manager is installed and the specified
 363      * {@code AccessControlContext} was not created by system code and the
 364      * caller&#39;s {@code ProtectionDomain} has not been granted the
 365      * {@literal &quot;createAccessControlContext&quot;}
 366      * {@link java.security.SecurityPermission}, then the action is performed
 367      * with no permissions.
 368      *
 369      * @param &lt;T&gt; the type of the value returned by the PrivilegedAction&#39;s
 370      *                  {@code run} method.
 371      * @param action the action to be performed.
 372      * @param context an &lt;i&gt;access control context&lt;/i&gt;
 373      *                representing the restriction to be applied to the
 374      *                caller&#39;s domain&#39;s privileges before performing
 375      *                the specified action.  If the context is
 376      *                {@code null}, then no additional restriction is applied.
 377      *
 378      * @return the value returned by the action&#39;s {@code run} method.
 379      *
<span class="line-modified"> 380      * @throws    NullPointerException if the action is {@code null}</span>
 381      *
 382      * @see #doPrivileged(PrivilegedAction)
 383      * @see #doPrivileged(PrivilegedExceptionAction,AccessControlContext)
 384      */
 385     @CallerSensitive
 386     public static &lt;T&gt; T doPrivileged(PrivilegedAction&lt;T&gt; action,
 387                                      AccessControlContext context)
 388     {
 389         Class&lt;?&gt; caller = Reflection.getCallerClass();
 390         context = checkContext(context, caller);
 391         return executePrivileged(action, context, caller);
 392     }
 393 
 394 
 395     /**
 396      * Performs the specified {@code PrivilegedAction} with privileges
 397      * enabled and restricted by the specified
 398      * {@code AccessControlContext} and with a privilege scope limited
 399      * by specified {@code Permission} arguments.
 400      *
</pre>
<hr />
<pre>
 428      *
 429      * @return the value returned by the action&#39;s {@code run} method.
 430      *
 431      * @throws NullPointerException if action or perms or any element of
 432      *         perms is {@code null}
 433      *
 434      * @see #doPrivileged(PrivilegedAction)
 435      * @see #doPrivileged(PrivilegedExceptionAction,AccessControlContext)
 436      *
 437      * @since 1.8
 438      */
 439     @CallerSensitive
 440     public static &lt;T&gt; T doPrivileged(PrivilegedAction&lt;T&gt; action,
 441         AccessControlContext context, Permission... perms) {
 442 
 443         AccessControlContext parent = getContext();
 444         if (perms == null) {
 445             throw new NullPointerException(&quot;null permissions parameter&quot;);
 446         }
 447         Class&lt;?&gt; caller = Reflection.getCallerClass();
<span class="line-modified"> 448         DomainCombiner dc = (context == null) ? null : context.getCombiner();</span>
<span class="line-added"> 449         return AccessController.doPrivileged(action, createWrapper(dc,</span>
 450             caller, parent, context, perms));
 451     }
 452 
 453 
 454     /**
 455      * Performs the specified {@code PrivilegedAction} with privileges
 456      * enabled and restricted by the specified
 457      * {@code AccessControlContext} and with a privilege scope limited
 458      * by specified {@code Permission} arguments.
 459      *
 460      * The action is performed with the intersection of the permissions
 461      * possessed by the caller&#39;s protection domain, and those possessed
 462      * by the domains represented by the specified
 463      * {@code AccessControlContext}.
 464      * &lt;p&gt;
 465      * If the action&#39;s {@code run} method throws an (unchecked) exception,
 466      * it will propagate through this method.
 467      *
 468      * &lt;p&gt; This method preserves the current AccessControlContext&#39;s
 469      * DomainCombiner (which may be null) while the action is performed.
</pre>
<hr />
<pre>
 517     }
 518 
 519     /**
 520      * Performs the specified {@code PrivilegedExceptionAction} with
 521      * privileges enabled.  The action is performed with &lt;i&gt;all&lt;/i&gt; of the
 522      * permissions possessed by the caller&#39;s protection domain.
 523      *
 524      * &lt;p&gt; If the action&#39;s {@code run} method throws an &lt;i&gt;unchecked&lt;/i&gt;
 525      * exception, it will propagate through this method.
 526      *
 527      * &lt;p&gt; Note that any DomainCombiner associated with the current
 528      * AccessControlContext will be ignored while the action is performed.
 529      *
 530      * @param &lt;T&gt; the type of the value returned by the
 531      *                  PrivilegedExceptionAction&#39;s {@code run} method.
 532      *
 533      * @param action the action to be performed
 534      *
 535      * @return the value returned by the action&#39;s {@code run} method
 536      *
<span class="line-modified"> 537      * @throws    PrivilegedActionException if the specified action&#39;s</span>
 538      *         {@code run} method threw a &lt;i&gt;checked&lt;/i&gt; exception
<span class="line-modified"> 539      * @throws    NullPointerException if the action is {@code null}</span>
 540      *
 541      * @see #doPrivileged(PrivilegedAction)
 542      * @see #doPrivileged(PrivilegedExceptionAction,AccessControlContext)
 543      * @see #doPrivilegedWithCombiner(PrivilegedExceptionAction)
 544      * @see java.security.DomainCombiner
 545      */
 546     @CallerSensitive
 547     public static &lt;T&gt; T
 548         doPrivileged(PrivilegedExceptionAction&lt;T&gt; action)
 549         throws PrivilegedActionException
 550     {
 551         AccessControlContext context = null;
 552         Class&lt;?&gt; caller = Reflection.getCallerClass();
 553         try {
 554             return executePrivileged(action, context, caller);
 555         } catch (RuntimeException e) {
 556             throw e;
 557         } catch (Exception e) {
 558             throw wrapException(e);
 559         }
 560     }
 561 
 562     /**
 563      * Performs the specified {@code PrivilegedExceptionAction} with
 564      * privileges enabled.  The action is performed with &lt;i&gt;all&lt;/i&gt; of the
 565      * permissions possessed by the caller&#39;s protection domain.
 566      *
 567      * &lt;p&gt; If the action&#39;s {@code run} method throws an &lt;i&gt;unchecked&lt;/i&gt;
 568      * exception, it will propagate through this method.
 569      *
 570      * &lt;p&gt; This method preserves the current AccessControlContext&#39;s
 571      * DomainCombiner (which may be null) while the action is performed.
 572      *
 573      * @param &lt;T&gt; the type of the value returned by the
 574      *                  PrivilegedExceptionAction&#39;s {@code run} method.
 575      *
 576      * @param action the action to be performed.
 577      *
 578      * @return the value returned by the action&#39;s {@code run} method
 579      *
<span class="line-modified"> 580      * @throws    PrivilegedActionException if the specified action&#39;s</span>
 581      *         {@code run} method threw a &lt;i&gt;checked&lt;/i&gt; exception
<span class="line-modified"> 582      * @throws    NullPointerException if the action is {@code null}</span>
 583      *
 584      * @see #doPrivileged(PrivilegedAction)
 585      * @see #doPrivileged(PrivilegedExceptionAction,AccessControlContext)
 586      * @see java.security.DomainCombiner
 587      *
 588      * @since 1.6
 589      */
 590     @CallerSensitive
 591     public static &lt;T&gt; T doPrivilegedWithCombiner(PrivilegedExceptionAction&lt;T&gt; action)
 592         throws PrivilegedActionException
 593     {
 594         AccessControlContext acc = getStackAccessControlContext();
 595         if (acc == null) {
 596             return AccessController.doPrivileged(action);
 597         }
 598         DomainCombiner dc = acc.getAssignedCombiner();
 599         return AccessController.doPrivileged(action,
 600                                              preserveCombiner(dc, Reflection.getCallerClass()));
 601     }
 602 
</pre>
<hr />
<pre>
 655      * exception, it will propagate through this method.
 656      * &lt;p&gt;
 657      * If a security manager is installed and the specified
 658      * {@code AccessControlContext} was not created by system code and the
 659      * caller&#39;s {@code ProtectionDomain} has not been granted the
 660      * {@literal &quot;createAccessControlContext&quot;}
 661      * {@link java.security.SecurityPermission}, then the action is performed
 662      * with no permissions.
 663      *
 664      * @param &lt;T&gt; the type of the value returned by the
 665      *                  PrivilegedExceptionAction&#39;s {@code run} method.
 666      * @param action the action to be performed
 667      * @param context an &lt;i&gt;access control context&lt;/i&gt;
 668      *                representing the restriction to be applied to the
 669      *                caller&#39;s domain&#39;s privileges before performing
 670      *                the specified action.  If the context is
 671      *                {@code null}, then no additional restriction is applied.
 672      *
 673      * @return the value returned by the action&#39;s {@code run} method
 674      *
<span class="line-modified"> 675      * @throws    PrivilegedActionException if the specified action&#39;s</span>
 676      *         {@code run} method threw a &lt;i&gt;checked&lt;/i&gt; exception
<span class="line-modified"> 677      * @throws    NullPointerException if the action is {@code null}</span>
 678      *
 679      * @see #doPrivileged(PrivilegedAction)
 680      * @see #doPrivileged(PrivilegedAction,AccessControlContext)
 681      */
 682     @CallerSensitive
 683     public static &lt;T&gt; T
 684         doPrivileged(PrivilegedExceptionAction&lt;T&gt; action,
 685                      AccessControlContext context)
 686         throws PrivilegedActionException
 687     {
 688         Class&lt;?&gt; caller = Reflection.getCallerClass();
 689         context = checkContext(context, caller);
 690         try {
 691             return executePrivileged(action, context, caller);
 692         } catch (RuntimeException e) {
 693             throw e;
 694         } catch (Exception e) {
 695             throw wrapException(e);
 696         }
 697     }
</pre>
<hr />
<pre>
 844      * @throws PrivilegedActionException if the specified action&#39;s
 845      *         {@code run} method threw a &lt;i&gt;checked&lt;/i&gt; exception
 846      * @throws NullPointerException if action or perms or any element of
 847      *         perms is {@code null}
 848      *
 849      * @see #doPrivileged(PrivilegedAction)
 850      * @see #doPrivileged(PrivilegedAction,AccessControlContext)
 851      *
 852      * @since 1.8
 853      */
 854     @CallerSensitive
 855     public static &lt;T&gt; T doPrivileged(PrivilegedExceptionAction&lt;T&gt; action,
 856                                      AccessControlContext context, Permission... perms)
 857         throws PrivilegedActionException
 858     {
 859         AccessControlContext parent = getContext();
 860         if (perms == null) {
 861             throw new NullPointerException(&quot;null permissions parameter&quot;);
 862         }
 863         Class&lt;?&gt; caller = Reflection.getCallerClass();
<span class="line-modified"> 864         DomainCombiner dc = (context == null) ? null : context.getCombiner();</span>
<span class="line-added"> 865         return AccessController.doPrivileged(action, createWrapper(dc, caller, parent, context, perms));</span>
 866     }
 867 
 868 
 869     /**
 870      * Performs the specified {@code PrivilegedExceptionAction} with
 871      * privileges enabled and restricted by the specified
 872      * {@code AccessControlContext} and with a privilege scope limited by
 873      * specified {@code Permission} arguments.
 874      *
 875      * The action is performed with the intersection of the permissions
 876      * possessed by the caller&#39;s protection domain, and those possessed
 877      * by the domains represented by the specified
 878      * {@code AccessControlContext}.
 879      * &lt;p&gt;
 880      * If the action&#39;s {@code run} method throws an (unchecked) exception,
 881      * it will propagate through this method.
 882      *
 883      * &lt;p&gt; This method preserves the current AccessControlContext&#39;s
 884      * DomainCombiner (which may be null) while the action is performed.
 885      * &lt;p&gt;
</pre>
<hr />
<pre>
 973         if (acc == null) {
 974             // all we had was privileged system code. We don&#39;t want
 975             // to return null though, so we construct a real ACC.
 976             return new AccessControlContext(null, true);
 977         } else {
 978             return acc.optimize();
 979         }
 980     }
 981 
 982     /**
 983      * Determines whether the access request indicated by the
 984      * specified permission should be allowed or denied, based on
 985      * the current AccessControlContext and security policy.
 986      * This method quietly returns if the access request
 987      * is permitted, or throws an AccessControlException otherwise. The
 988      * getPermission method of the AccessControlException returns the
 989      * {@code perm} Permission object instance.
 990      *
 991      * @param perm the requested permission.
 992      *
<span class="line-modified"> 993      * @throws    AccessControlException if the specified permission</span>
 994      *            is not permitted, based on the current security policy.
<span class="line-modified"> 995      * @throws    NullPointerException if the specified permission</span>
 996      *            is {@code null} and is checked based on the
 997      *            security policy currently in effect.
 998      */
 999 
1000     public static void checkPermission(Permission perm)
1001         throws AccessControlException
1002     {
1003         //System.err.println(&quot;checkPermission &quot;+perm);
1004         //Thread.currentThread().dumpStack();
1005 
1006         if (perm == null) {
1007             throw new NullPointerException(&quot;permission can&#39;t be null&quot;);
1008         }
1009 
1010         AccessControlContext stack = getStackAccessControlContext();
1011         // if context is null, we had privileged system code on the stack.
1012         if (stack == null) {
1013             Debug debug = AccessControlContext.getDebug();
1014             boolean dumpDebug = false;
1015             if (debug != null) {
</pre>
</td>
</tr>
</table>
<center><a href="AccessControlException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="AlgorithmParameterGenerator.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>