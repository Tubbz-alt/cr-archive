<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/util/zip/ZipEntry.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ZipCoder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipError.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/zip/ZipEntry.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1995, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 24  */
 25 
 26 package java.util.zip;
 27 
 28 import static java.util.zip.ZipUtils.*;
 29 import java.nio.file.attribute.FileTime;
 30 import java.util.Objects;
 31 import java.util.concurrent.TimeUnit;
 32 import java.time.LocalDateTime;
 33 import java.time.ZonedDateTime;
 34 import java.time.ZoneId;
 35 
 36 import static java.util.zip.ZipConstants64.*;
 37 
 38 /**
 39  * This class is used to represent a ZIP file entry.
 40  *
 41  * @author      David Connelly
 42  * @since 1.1
 43  */
<span class="line-modified"> 44 public</span>
<span class="line-removed"> 45 class ZipEntry implements ZipConstants, Cloneable {</span>
 46 
 47     String name;        // entry name
 48     long xdostime = -1; // last modification time (in extended DOS time,
 49                         // where milliseconds lost in conversion might
 50                         // be encoded into the upper half)
 51     FileTime mtime;     // last modification time, from extra field data
 52     FileTime atime;     // last access time, from extra field data
 53     FileTime ctime;     // creation time, from extra field data
 54     long crc = -1;      // crc-32 of entry data
 55     long size = -1;     // uncompressed size of entry data
 56     long csize = -1;    // compressed size of entry data
 57     int method = -1;    // compression method
 58     int flag = 0;       // general purpose flag
 59     byte[] extra;       // optional extra field data for entry
 60     String comment;     // optional comment string for entry
 61 
 62     /**
 63      * Compression method for uncompressed entries.
 64      */
 65     public static final int STORED = 0;
</pre>
<hr />
<pre>
505 
506     /**
507      * Sets the optional extra field data for the entry.
508      *
509      * &lt;p&gt; Invoking this method may change this entry&#39;s last modification
510      * time, last access time and creation time, if the {@code extra} field
511      * data includes the extensible timestamp fields, such as {@code NTFS tag
512      * 0x0001} or {@code Info-ZIP Extended Timestamp}, as specified in
513      * &lt;a href=&quot;http://www.info-zip.org/doc/appnote-19970311-iz.zip&quot;&gt;Info-ZIP
514      * Application Note 970311&lt;/a&gt;.
515      *
516      * @param  extra
517      *         The extra field data bytes
518      *
519      * @throws IllegalArgumentException if the length of the specified
520      *         extra field data is greater than 0xFFFF bytes
521      *
522      * @see #getExtra()
523      */
524     public void setExtra(byte[] extra) {
<span class="line-modified">525         setExtra0(extra, false);</span>
526     }
527 
528     /**
529      * Sets the optional extra field data for the entry.
530      *
531      * @param extra
532      *        the extra field data bytes
533      * @param doZIP64
534      *        if true, set size and csize from ZIP64 fields if present



535      */
<span class="line-modified">536     void setExtra0(byte[] extra, boolean doZIP64) {</span>
537         if (extra != null) {
538             if (extra.length &gt; 0xFFFF) {
539                 throw new IllegalArgumentException(&quot;invalid extra field length&quot;);
540             }
541             // extra fields are in &quot;HeaderID(2)DataSize(2)Data... format
542             int off = 0;
543             int len = extra.length;
544             while (off + 4 &lt; len) {
545                 int tag = get16(extra, off);
546                 int sz = get16(extra, off + 2);
547                 off += 4;
548                 if (off + sz &gt; len)         // invalid data
549                     break;
550                 switch (tag) {
551                 case EXTID_ZIP64:
552                     if (doZIP64) {
<span class="line-modified">553                         // LOC extra zip64 entry MUST include BOTH original</span>
<span class="line-modified">554                         // and compressed file size fields.</span>
<span class="line-modified">555                         // If invalid zip64 extra fields, simply skip. Even</span>
<span class="line-modified">556                         // it&#39;s rare, it&#39;s possible the entry size happens to</span>
<span class="line-modified">557                         // be the magic value and it &quot;accidently&quot; has some</span>
<span class="line-modified">558                         // bytes in extra match the id.</span>
<span class="line-modified">559                         if (sz &gt;= 16) {</span>
<span class="line-modified">560                             size = get64(extra, off);</span>
<span class="line-modified">561                             csize = get64(extra, off + 8);</span>














562                         }
563                     }
564                     break;
565                 case EXTID_NTFS:
566                     if (sz &lt; 32) // reserved  4 bytes + tag 2 bytes + size 2 bytes
567                         break;   // m[a|c]time 24 bytes
568                     int pos = off + 4;               // reserved 4 bytes
569                     if (get16(extra, pos) !=  0x0001 || get16(extra, pos + 2) != 24)
570                         break;
571                     long wtime = get64(extra, pos + 4);
572                     if (wtime != WINDOWS_TIME_NOT_AVAILABLE) {
573                         mtime = winTimeToFileTime(wtime);
574                     }
575                     wtime = get64(extra, pos + 12);
576                     if (wtime != WINDOWS_TIME_NOT_AVAILABLE) {
577                         atime = winTimeToFileTime(wtime);
578                     }
579                     wtime = get64(extra, pos + 20);
580                     if (wtime != WINDOWS_TIME_NOT_AVAILABLE) {
581                         ctime = winTimeToFileTime(wtime);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1995, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 24  */
 25 
 26 package java.util.zip;
 27 
 28 import static java.util.zip.ZipUtils.*;
 29 import java.nio.file.attribute.FileTime;
 30 import java.util.Objects;
 31 import java.util.concurrent.TimeUnit;
 32 import java.time.LocalDateTime;
 33 import java.time.ZonedDateTime;
 34 import java.time.ZoneId;
 35 
 36 import static java.util.zip.ZipConstants64.*;
 37 
 38 /**
 39  * This class is used to represent a ZIP file entry.
 40  *
 41  * @author      David Connelly
 42  * @since 1.1
 43  */
<span class="line-modified"> 44 public class ZipEntry implements ZipConstants, Cloneable {</span>

 45 
 46     String name;        // entry name
 47     long xdostime = -1; // last modification time (in extended DOS time,
 48                         // where milliseconds lost in conversion might
 49                         // be encoded into the upper half)
 50     FileTime mtime;     // last modification time, from extra field data
 51     FileTime atime;     // last access time, from extra field data
 52     FileTime ctime;     // creation time, from extra field data
 53     long crc = -1;      // crc-32 of entry data
 54     long size = -1;     // uncompressed size of entry data
 55     long csize = -1;    // compressed size of entry data
 56     int method = -1;    // compression method
 57     int flag = 0;       // general purpose flag
 58     byte[] extra;       // optional extra field data for entry
 59     String comment;     // optional comment string for entry
 60 
 61     /**
 62      * Compression method for uncompressed entries.
 63      */
 64     public static final int STORED = 0;
</pre>
<hr />
<pre>
504 
505     /**
506      * Sets the optional extra field data for the entry.
507      *
508      * &lt;p&gt; Invoking this method may change this entry&#39;s last modification
509      * time, last access time and creation time, if the {@code extra} field
510      * data includes the extensible timestamp fields, such as {@code NTFS tag
511      * 0x0001} or {@code Info-ZIP Extended Timestamp}, as specified in
512      * &lt;a href=&quot;http://www.info-zip.org/doc/appnote-19970311-iz.zip&quot;&gt;Info-ZIP
513      * Application Note 970311&lt;/a&gt;.
514      *
515      * @param  extra
516      *         The extra field data bytes
517      *
518      * @throws IllegalArgumentException if the length of the specified
519      *         extra field data is greater than 0xFFFF bytes
520      *
521      * @see #getExtra()
522      */
523     public void setExtra(byte[] extra) {
<span class="line-modified">524         setExtra0(extra, false, true);</span>
525     }
526 
527     /**
528      * Sets the optional extra field data for the entry.
529      *
530      * @param extra
531      *        the extra field data bytes
532      * @param doZIP64
533      *        if true, set size and csize from ZIP64 fields if present
<span class="line-added">534      * @param isLOC</span>
<span class="line-added">535      *        true if setting the extra field for a LOC, false if for</span>
<span class="line-added">536      *        a CEN</span>
537      */
<span class="line-modified">538     void setExtra0(byte[] extra, boolean doZIP64, boolean isLOC) {</span>
539         if (extra != null) {
540             if (extra.length &gt; 0xFFFF) {
541                 throw new IllegalArgumentException(&quot;invalid extra field length&quot;);
542             }
543             // extra fields are in &quot;HeaderID(2)DataSize(2)Data... format
544             int off = 0;
545             int len = extra.length;
546             while (off + 4 &lt; len) {
547                 int tag = get16(extra, off);
548                 int sz = get16(extra, off + 2);
549                 off += 4;
550                 if (off + sz &gt; len)         // invalid data
551                     break;
552                 switch (tag) {
553                 case EXTID_ZIP64:
554                     if (doZIP64) {
<span class="line-modified">555                         if (isLOC) {</span>
<span class="line-modified">556                             // LOC extra zip64 entry MUST include BOTH original</span>
<span class="line-modified">557                             // and compressed file size fields.</span>
<span class="line-modified">558                             // If invalid zip64 extra fields, simply skip. Even</span>
<span class="line-modified">559                             // it&#39;s rare, it&#39;s possible the entry size happens to</span>
<span class="line-modified">560                             // be the magic value and it &quot;accidently&quot; has some</span>
<span class="line-modified">561                             // bytes in extra match the id.</span>
<span class="line-modified">562                             if (sz &gt;= 16) {</span>
<span class="line-modified">563                                 size = get64(extra, off);</span>
<span class="line-added">564                                 csize = get64(extra, off + 8);</span>
<span class="line-added">565                             }</span>
<span class="line-added">566                         } else {</span>
<span class="line-added">567                             // CEN extra zip64</span>
<span class="line-added">568                             if (size == ZIP64_MAGICVAL) {</span>
<span class="line-added">569                                 if (off + 8 &gt; len)  // invalid zip64 extra</span>
<span class="line-added">570                                     break;          // fields, just skip</span>
<span class="line-added">571                                 size = get64(extra, off);</span>
<span class="line-added">572                             }</span>
<span class="line-added">573                             if (csize == ZIP64_MAGICVAL) {</span>
<span class="line-added">574                                 if (off + 16 &gt; len)  // invalid zip64 extra</span>
<span class="line-added">575                                     break;           // fields, just skip</span>
<span class="line-added">576                                 csize = get64(extra, off + 8);</span>
<span class="line-added">577                             }</span>
578                         }
579                     }
580                     break;
581                 case EXTID_NTFS:
582                     if (sz &lt; 32) // reserved  4 bytes + tag 2 bytes + size 2 bytes
583                         break;   // m[a|c]time 24 bytes
584                     int pos = off + 4;               // reserved 4 bytes
585                     if (get16(extra, pos) !=  0x0001 || get16(extra, pos + 2) != 24)
586                         break;
587                     long wtime = get64(extra, pos + 4);
588                     if (wtime != WINDOWS_TIME_NOT_AVAILABLE) {
589                         mtime = winTimeToFileTime(wtime);
590                     }
591                     wtime = get64(extra, pos + 12);
592                     if (wtime != WINDOWS_TIME_NOT_AVAILABLE) {
593                         atime = winTimeToFileTime(wtime);
594                     }
595                     wtime = get64(extra, pos + 20);
596                     if (wtime != WINDOWS_TIME_NOT_AVAILABLE) {
597                         ctime = winTimeToFileTime(wtime);
</pre>
</td>
</tr>
</table>
<center><a href="ZipCoder.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="ZipError.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>