<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/share/classes/java/lang/reflect/AccessibleObject.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="../ref/Reference.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Array.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/lang/reflect/AccessibleObject.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -28,10 +28,11 @@</span>
  import java.lang.annotation.Annotation;
  import java.lang.invoke.MethodHandle;
  import java.lang.ref.WeakReference;
  import java.security.AccessController;
  
<span class="udiff-line-added">+ import jdk.internal.access.SharedSecrets;</span>
  import jdk.internal.misc.VM;
  import jdk.internal.module.IllegalAccessLogger;
  import jdk.internal.reflect.CallerSensitive;
  import jdk.internal.reflect.Reflection;
  import jdk.internal.reflect.ReflectionFactory;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -54,11 +55,14 @@</span>
   * exported} package and the user {@link Module#canRead reads} their module. By
   * default, Java language access control is enforced (with one variation) when
   * {@code Field}s, {@code Method}s, or {@code Constructor}s are used to get or
   * set fields, to invoke methods, or to create and initialize new instances of
   * classes, respectively. Every reflected object checks that the code using it
<span class="udiff-line-modified-removed">-  * is in an appropriate class, package, or module. &lt;/p&gt;</span>
<span class="udiff-line-modified-added">+  * is in an appropriate class, package, or module. The check when invoked by</span>
<span class="udiff-line-added">+  * &lt;a href=&quot;{@docRoot}/../specs/jni/index.html&quot;&gt;JNI code&lt;/a&gt; with no Java</span>
<span class="udiff-line-added">+  * class on the stack only succeeds if the member and the declaring class are</span>
<span class="udiff-line-added">+  * public, and the class is in a package that is exported to all modules. &lt;/p&gt;</span>
   *
   * &lt;p&gt; The one variation from Java language access control is that the checks
   * by reflected objects assume readability. That is, the module containing
   * the use of a reflected object is assumed to read the module in which
   * the underlying field, method, or constructor is declared. &lt;/p&gt;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -72,10 +76,14 @@</span>
   * @since 1.2
   * @revised 9
   * @spec JPMS
   */
  public class AccessibleObject implements AnnotatedElement {
<span class="udiff-line-added">+     static {</span>
<span class="udiff-line-added">+         // AccessibleObject is initialized early in initPhase1</span>
<span class="udiff-line-added">+         SharedSecrets.setJavaLangReflectAccess(new ReflectAccess());</span>
<span class="udiff-line-added">+     }</span>
  
      static void checkPermission() {
          SecurityManager sm = System.getSecurityManager();
          if (sm != null) {
              // SecurityConstants.ACCESS_PERMISSION is used to check
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -668,10 +676,17 @@</span>
  
      // Keep all this slow stuff out of line:
      private boolean slowVerifyAccess(Class&lt;?&gt; caller, Class&lt;?&gt; memberClass,
                                       Class&lt;?&gt; targetClass, int modifiers)
      {
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (caller == null) {</span>
<span class="udiff-line-added">+             // No caller frame when a native thread attaches to the VM</span>
<span class="udiff-line-added">+             // only allow access to a public accessible member</span>
<span class="udiff-line-added">+             return Reflection.verifyPublicMemberAccess(memberClass, modifiers);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
          if (!Reflection.verifyMemberAccess(caller, memberClass, targetClass, modifiers)) {
              // access denied
              return false;
          }
  
</pre>
<center><a href="../ref/Reference.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Array.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>