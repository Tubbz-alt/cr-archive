<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/lang/doc-files/threadPrimitiveDeprecation.html</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ValueBased.html.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../invoke/AbstractConstantGroup.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/lang/doc-files/threadPrimitiveDeprecation.html</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,8 ***</span>
  &lt;!doctype html&gt;
  &lt;!--
<span class="line-modified">!  Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  
   This code is free software; you can redistribute it and/or modify it
   under the terms of the GNU General Public License version 2 only, as
   published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,8 ---</span>
  &lt;!doctype html&gt;
  &lt;!--
<span class="line-modified">!  Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  
   This code is free software; you can redistribute it and/or modify it
   under the terms of the GNU General Public License version 2 only, as
   published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 27,13 ***</span>
  &lt;head&gt;
    &lt;title&gt;Java Thread Primitive Deprecation&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;../../../../stylesheet.css&quot; title=&quot;Style&quot;&gt;
  &lt;/head&gt;
  &lt;body&gt;
<span class="line-modified">! &lt;h2&gt;Java Thread Primitive Deprecation&lt;/h2&gt;</span>
  &lt;hr&gt;
<span class="line-modified">! &lt;h3&gt;Why is &lt;code&gt;Thread.stop&lt;/code&gt; deprecated?&lt;/h3&gt;</span>
  &lt;p&gt;Because it is inherently unsafe. Stopping a thread causes it to
  unlock all the monitors that it has locked. (The monitors are
  unlocked as the &lt;code&gt;ThreadDeath&lt;/code&gt; exception propagates up
  the stack.) If any of the objects previously protected by these
  monitors were in an inconsistent state, other threads may now view
<span class="line-new-header">--- 27,13 ---</span>
  &lt;head&gt;
    &lt;title&gt;Java Thread Primitive Deprecation&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;../../../../stylesheet.css&quot; title=&quot;Style&quot;&gt;
  &lt;/head&gt;
  &lt;body&gt;
<span class="line-modified">! &lt;h1&gt;Java Thread Primitive Deprecation&lt;/h1&gt;</span>
  &lt;hr&gt;
<span class="line-modified">! &lt;h2&gt;Why is &lt;code&gt;Thread.stop&lt;/code&gt; deprecated?&lt;/h2&gt;</span>
  &lt;p&gt;Because it is inherently unsafe. Stopping a thread causes it to
  unlock all the monitors that it has locked. (The monitors are
  unlocked as the &lt;code&gt;ThreadDeath&lt;/code&gt; exception propagates up
  the stack.) If any of the objects previously protected by these
  monitors were in an inconsistent state, other threads may now view
</pre>
<hr />
<pre>
<span class="line-old-header">*** 44,12 ***</span>
  &lt;code&gt;ThreadDeath&lt;/code&gt; kills threads silently; thus, the user has
  no warning that his program may be corrupted. The corruption can
  manifest itself at any time after the actual damage occurs, even
  hours or days in the future.&lt;/p&gt;
  &lt;hr&gt;
<span class="line-modified">! &lt;h3&gt;Couldn&#39;t I just catch the &lt;code&gt;ThreadDeath&lt;/code&gt; exception</span>
<span class="line-modified">! and fix the damaged object?&lt;/h3&gt;</span>
  &lt;p&gt;In theory, perhaps, but it would &lt;em&gt;vastly&lt;/em&gt; complicate the
  task of writing correct multithreaded code. The task would be
  nearly insurmountable for two reasons:&lt;/p&gt;
  &lt;ol&gt;
  &lt;li&gt;A thread can throw a &lt;code&gt;ThreadDeath&lt;/code&gt; exception
<span class="line-new-header">--- 44,12 ---</span>
  &lt;code&gt;ThreadDeath&lt;/code&gt; kills threads silently; thus, the user has
  no warning that his program may be corrupted. The corruption can
  manifest itself at any time after the actual damage occurs, even
  hours or days in the future.&lt;/p&gt;
  &lt;hr&gt;
<span class="line-modified">! &lt;h2&gt;Couldn&#39;t I just catch the &lt;code&gt;ThreadDeath&lt;/code&gt; exception</span>
<span class="line-modified">! and fix the damaged object?&lt;/h2&gt;</span>
  &lt;p&gt;In theory, perhaps, but it would &lt;em&gt;vastly&lt;/em&gt; complicate the
  task of writing correct multithreaded code. The task would be
  nearly insurmountable for two reasons:&lt;/p&gt;
  &lt;ol&gt;
  &lt;li&gt;A thread can throw a &lt;code&gt;ThreadDeath&lt;/code&gt; exception
</pre>
<hr />
<pre>
<span class="line-old-header">*** 60,11 ***</span>
  &lt;code&gt;finally&lt;/code&gt; clause). Cleanup would have to be repeated till
  it succeeded. The code to ensure this would be quite complex.&lt;/li&gt;
  &lt;/ol&gt;
  In sum, it just isn&#39;t practical.
  &lt;hr&gt;
<span class="line-modified">! &lt;h3&gt;What should I use instead of &lt;code&gt;Thread.stop&lt;/code&gt;?&lt;/h3&gt;</span>
  &lt;p&gt;Most uses of &lt;code&gt;stop&lt;/code&gt; should be replaced by code that
  simply modifies some variable to indicate that the target thread
  should stop running. The target thread should check this variable
  regularly, and return from its run method in an orderly fashion if
  the variable indicates that it is to stop running. To ensure prompt
<span class="line-new-header">--- 60,11 ---</span>
  &lt;code&gt;finally&lt;/code&gt; clause). Cleanup would have to be repeated till
  it succeeded. The code to ensure this would be quite complex.&lt;/li&gt;
  &lt;/ol&gt;
  In sum, it just isn&#39;t practical.
  &lt;hr&gt;
<span class="line-modified">! &lt;h2&gt;What should I use instead of &lt;code&gt;Thread.stop&lt;/code&gt;?&lt;/h2&gt;</span>
  &lt;p&gt;Most uses of &lt;code&gt;stop&lt;/code&gt; should be replaced by code that
  simply modifies some variable to indicate that the target thread
  should stop running. The target thread should check this variable
  regularly, and return from its run method in an orderly fashion if
  the variable indicates that it is to stop running. To ensure prompt
</pre>
<hr />
<pre>
<span class="line-old-header">*** 115,12 ***</span>
              repaint();
          }
      }
  &lt;/pre&gt;
  &lt;hr&gt;
<span class="line-modified">! &lt;h3&gt;How do I stop a thread that waits for long periods (e.g., for</span>
<span class="line-modified">! input)?&lt;/h3&gt;</span>
  &lt;p&gt;That&#39;s what the &lt;code&gt;Thread.interrupt&lt;/code&gt; method is for. The
  same &quot;state based&quot; signaling mechanism shown above can be used, but
  the state change (&lt;code&gt;blinker = null&lt;/code&gt;, in the previous
  example) can be followed by a call to
  &lt;code&gt;Thread.interrupt&lt;/code&gt;, to interrupt the wait:&lt;/p&gt;
<span class="line-new-header">--- 115,12 ---</span>
              repaint();
          }
      }
  &lt;/pre&gt;
  &lt;hr&gt;
<span class="line-modified">! &lt;h2&gt;How do I stop a thread that waits for long periods (e.g., for</span>
<span class="line-modified">! input)?&lt;/h2&gt;</span>
  &lt;p&gt;That&#39;s what the &lt;code&gt;Thread.interrupt&lt;/code&gt; method is for. The
  same &quot;state based&quot; signaling mechanism shown above can be used, but
  the state change (&lt;code&gt;blinker = null&lt;/code&gt;, in the previous
  example) can be followed by a call to
  &lt;code&gt;Thread.interrupt&lt;/code&gt;, to interrupt the wait:&lt;/p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 143,12 ***</span>
      Thread.currentThread().interrupt();
  &lt;/pre&gt;
  This ensures that the Thread will reraise the
  &lt;code&gt;InterruptedException&lt;/code&gt; as soon as it is able.
  &lt;hr&gt;
<span class="line-modified">! &lt;h3&gt;What if a thread doesn&#39;t respond to</span>
<span class="line-modified">! &lt;code&gt;Thread.interrupt&lt;/code&gt;?&lt;/h3&gt;</span>
  &lt;p&gt;In some cases, you can use application specific tricks. For
  example, if a thread is waiting on a known socket, you can close
  the socket to cause the thread to return immediately.
  Unfortunately, there really isn&#39;t any technique that works in
  general. &lt;em&gt;It should be noted that in all situations where a
<span class="line-new-header">--- 143,12 ---</span>
      Thread.currentThread().interrupt();
  &lt;/pre&gt;
  This ensures that the Thread will reraise the
  &lt;code&gt;InterruptedException&lt;/code&gt; as soon as it is able.
  &lt;hr&gt;
<span class="line-modified">! &lt;h2&gt;What if a thread doesn&#39;t respond to</span>
<span class="line-modified">! &lt;code&gt;Thread.interrupt&lt;/code&gt;?&lt;/h2&gt;</span>
  &lt;p&gt;In some cases, you can use application specific tricks. For
  example, if a thread is waiting on a known socket, you can close
  the socket to cause the thread to return immediately.
  Unfortunately, there really isn&#39;t any technique that works in
  general. &lt;em&gt;It should be noted that in all situations where a
</pre>
<hr />
<pre>
<span class="line-old-header">*** 156,22 ***</span>
  wouldn&#39;t respond to &lt;code&gt;Thread.stop&lt;/code&gt; either.&lt;/em&gt; Such
  cases include deliberate denial-of-service attacks, and I/O
  operations for which thread.stop and thread.interrupt do not work
  properly.&lt;/p&gt;
  &lt;hr&gt;
<span class="line-modified">! &lt;h3&gt;Why are &lt;code&gt;Thread.suspend&lt;/code&gt; and</span>
<span class="line-modified">! &lt;code&gt;Thread.resume&lt;/code&gt; deprecated?&lt;/h3&gt;</span>
  &lt;p&gt;&lt;code&gt;Thread.suspend&lt;/code&gt; is inherently deadlock-prone. If the
  target thread holds a lock on the monitor protecting a critical
  system resource when it is suspended, no thread can access this
  resource until the target thread is resumed. If the thread that
  would resume the target thread attempts to lock this monitor prior
  to calling &lt;code&gt;resume&lt;/code&gt;, deadlock results. Such deadlocks
  typically manifest themselves as &quot;frozen&quot; processes.&lt;/p&gt;
  &lt;hr&gt;
<span class="line-modified">! &lt;h3&gt;What should I use instead of &lt;code&gt;Thread.suspend&lt;/code&gt; and</span>
<span class="line-modified">! &lt;code&gt;Thread.resume&lt;/code&gt;?&lt;/h3&gt;</span>
  &lt;p&gt;As with &lt;code&gt;Thread.stop&lt;/code&gt;, the prudent approach is to
  have the &quot;target thread&quot; poll a variable indicating the desired
  state of the thread (active or suspended). When the desired state
  is suspended, the thread waits using &lt;code&gt;Object.wait&lt;/code&gt;. When
  the thread is resumed, the target thread is notified using
<span class="line-new-header">--- 156,22 ---</span>
  wouldn&#39;t respond to &lt;code&gt;Thread.stop&lt;/code&gt; either.&lt;/em&gt; Such
  cases include deliberate denial-of-service attacks, and I/O
  operations for which thread.stop and thread.interrupt do not work
  properly.&lt;/p&gt;
  &lt;hr&gt;
<span class="line-modified">! &lt;h2&gt;Why are &lt;code&gt;Thread.suspend&lt;/code&gt; and</span>
<span class="line-modified">! &lt;code&gt;Thread.resume&lt;/code&gt; deprecated?&lt;/h2&gt;</span>
  &lt;p&gt;&lt;code&gt;Thread.suspend&lt;/code&gt; is inherently deadlock-prone. If the
  target thread holds a lock on the monitor protecting a critical
  system resource when it is suspended, no thread can access this
  resource until the target thread is resumed. If the thread that
  would resume the target thread attempts to lock this monitor prior
  to calling &lt;code&gt;resume&lt;/code&gt;, deadlock results. Such deadlocks
  typically manifest themselves as &quot;frozen&quot; processes.&lt;/p&gt;
  &lt;hr&gt;
<span class="line-modified">! &lt;h2&gt;What should I use instead of &lt;code&gt;Thread.suspend&lt;/code&gt; and</span>
<span class="line-modified">! &lt;code&gt;Thread.resume&lt;/code&gt;?&lt;/h2&gt;</span>
  &lt;p&gt;As with &lt;code&gt;Thread.stop&lt;/code&gt;, the prudent approach is to
  have the &quot;target thread&quot; poll a variable indicating the desired
  state of the thread (active or suspended). When the desired state
  is suspended, the thread waits using &lt;code&gt;Object.wait&lt;/code&gt;. When
  the thread is resumed, the target thread is notified using
</pre>
<hr />
<pre>
<span class="line-old-header">*** 281,12 ***</span>
              repaint();
          }
      }
  &lt;/pre&gt;
  &lt;hr size=&quot;3&quot; noshade=&quot;noshade&quot; /&gt;
<span class="line-modified">! &lt;h3&gt;Can I combine the two techniques to produce a thread that may</span>
<span class="line-modified">! be safely &quot;stopped&quot; or &quot;suspended&quot;?&lt;/h3&gt;</span>
  Yes, it&#39;s reasonably straightforward. The one subtlety is that the
  target thread may already be suspended at the time that another
  thread tries to stop it. If the &lt;code&gt;stop&lt;/code&gt; method merely sets
  the state variable (&lt;code&gt;blinker&lt;/code&gt;) to null, the target thread
  will remain suspended (waiting on the monitor), rather than exiting
<span class="line-new-header">--- 281,12 ---</span>
              repaint();
          }
      }
  &lt;/pre&gt;
  &lt;hr size=&quot;3&quot; noshade=&quot;noshade&quot; /&gt;
<span class="line-modified">! &lt;h2&gt;Can I combine the two techniques to produce a thread that may</span>
<span class="line-modified">! be safely &quot;stopped&quot; or &quot;suspended&quot;?&lt;/h2&gt;</span>
  Yes, it&#39;s reasonably straightforward. The one subtlety is that the
  target thread may already be suspended at the time that another
  thread tries to stop it. If the &lt;code&gt;stop&lt;/code&gt; method merely sets
  the state variable (&lt;code&gt;blinker&lt;/code&gt;) to null, the target thread
  will remain suspended (waiting on the monitor), rather than exiting
</pre>
<center><a href="ValueBased.html.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../invoke/AbstractConstantGroup.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>