<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/security/cert/X509CRL.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="PolicyQualifierInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="X509CRLEntry.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/cert/X509CRL.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
153      *
154      * @return the hashcode value.
155      */
156     public int hashCode() {
157         int retval = 0;
158         try {
159             byte[] crlData = X509CRLImpl.getEncodedInternal(this);
160             for (int i = 1; i &lt; crlData.length; i++) {
161                  retval += crlData[i] * i;
162             }
163             return retval;
164         } catch (CRLException e) {
165             return retval;
166         }
167     }
168 
169     /**
170      * Returns the ASN.1 DER-encoded form of this CRL.
171      *
172      * @return the encoded form of this certificate
<span class="line-modified">173      * @exception CRLException if an encoding error occurs.</span>
174      */
175     public abstract byte[] getEncoded()
176         throws CRLException;
177 
178     /**
179      * Verifies that this CRL was signed using the
180      * private key that corresponds to the given public key.
181      *
182      * @param key the PublicKey used to carry out the verification.
183      *
<span class="line-modified">184      * @exception NoSuchAlgorithmException on unsupported signature</span>
185      * algorithms.
<span class="line-modified">186      * @exception InvalidKeyException on incorrect key.</span>
<span class="line-modified">187      * @exception NoSuchProviderException if there&#39;s no default provider.</span>
<span class="line-modified">188      * @exception SignatureException on signature errors.</span>
<span class="line-modified">189      * @exception CRLException on encoding errors.</span>
190      */
191     public abstract void verify(PublicKey key)
192         throws CRLException,  NoSuchAlgorithmException,
193         InvalidKeyException, NoSuchProviderException,
194         SignatureException;
195 
196     /**
197      * Verifies that this CRL was signed using the
198      * private key that corresponds to the given public key.
199      * This method uses the signature verification engine
200      * supplied by the given provider.
201      *
202      * @param key the PublicKey used to carry out the verification.
203      * @param sigProvider the name of the signature provider.
204      *
<span class="line-modified">205      * @exception NoSuchAlgorithmException on unsupported signature</span>
206      * algorithms.
<span class="line-modified">207      * @exception InvalidKeyException on incorrect key.</span>
<span class="line-modified">208      * @exception NoSuchProviderException on incorrect provider.</span>
<span class="line-modified">209      * @exception SignatureException on signature errors.</span>
<span class="line-modified">210      * @exception CRLException on encoding errors.</span>
211      */
212     public abstract void verify(PublicKey key, String sigProvider)
213         throws CRLException, NoSuchAlgorithmException,
214         InvalidKeyException, NoSuchProviderException,
215         SignatureException;
216 
217     /**
218      * Verifies that this CRL was signed using the
219      * private key that corresponds to the given public key.
220      * This method uses the signature verification engine
221      * supplied by the given provider. Note that the specified Provider object
222      * does not have to be registered in the provider list.
223      *
224      * This method was added to version 1.8 of the Java Platform Standard
225      * Edition. In order to maintain backwards compatibility with existing
226      * service providers, this method is not {@code abstract}
227      * and it provides a default implementation.
228      *
229      * @param key the PublicKey used to carry out the verification.
230      * @param sigProvider the signature provider.
231      *
<span class="line-modified">232      * @exception NoSuchAlgorithmException on unsupported signature</span>
233      * algorithms.
<span class="line-modified">234      * @exception InvalidKeyException on incorrect key.</span>
<span class="line-modified">235      * @exception SignatureException on signature errors.</span>
<span class="line-modified">236      * @exception CRLException on encoding errors.</span>
237      * @since 1.8
238      */
239     public void verify(PublicKey key, Provider sigProvider)
240         throws CRLException, NoSuchAlgorithmException,
241         InvalidKeyException, SignatureException {

242         Signature sig = (sigProvider == null)
<span class="line-modified">243             ? Signature.getInstance(getSigAlgName())</span>
<span class="line-modified">244             : Signature.getInstance(getSigAlgName(), sigProvider);</span>
245 
<span class="line-removed">246         sig.initVerify(key);</span>
<span class="line-removed">247 </span>
<span class="line-removed">248         // set parameters after Signature.initSign/initVerify call,</span>
<span class="line-removed">249         // so the deferred provider selections occur when key is set</span>
250         try {
<span class="line-modified">251             SignatureUtil.specialSetParameter(sig, getSigAlgParams());</span>


252         } catch (ProviderException e) {
253             throw new CRLException(e.getMessage(), e.getCause());
254         } catch (InvalidAlgorithmParameterException e) {
255             throw new CRLException(e);
256         }
257 
258         byte[] tbsCRL = getTBSCertList();
259         sig.update(tbsCRL, 0, tbsCRL.length);
260 
261         if (sig.verify(getSignature()) == false) {
262             throw new SignatureException(&quot;Signature does not match.&quot;);
263         }
264     }
265 
266     /**
267      * Gets the {@code version} (version number) value from the CRL.
268      * The ASN.1 definition for this is:
269      * &lt;pre&gt;
270      * version    Version OPTIONAL,
271      *             -- if present, must be v2
</pre>
<hr />
<pre>
367      * @return the entry with the given serial number, or null if no such entry
368      * exists in this CRL.
369      * @see X509CRLEntry
370      */
371     public abstract X509CRLEntry
372         getRevokedCertificate(BigInteger serialNumber);
373 
374     /**
375      * Get the CRL entry, if any, for the given certificate.
376      *
377      * &lt;p&gt;This method can be used to lookup CRL entries in indirect CRLs,
378      * that means CRLs that contain entries from issuers other than the CRL
379      * issuer. The default implementation will only return entries for
380      * certificates issued by the CRL issuer. Subclasses that wish to
381      * support indirect CRLs should override this method.
382      *
383      * @param certificate the certificate for which a CRL entry is to be looked
384      *   up
385      * @return the entry for the given certificate, or null if no such entry
386      *   exists in this CRL.
<span class="line-modified">387      * @exception NullPointerException if certificate is null</span>
388      *
389      * @since 1.5
390      */
391     public X509CRLEntry getRevokedCertificate(X509Certificate certificate) {
392         X500Principal certIssuer = certificate.getIssuerX500Principal();
393         X500Principal crlIssuer = getIssuerX500Principal();
394         if (certIssuer.equals(crlIssuer) == false) {
395             return null;
396         }
397         return getRevokedCertificate(certificate.getSerialNumber());
398     }
399 
400     /**
401      * Gets all the entries from this CRL.
402      * This returns a Set of X509CRLEntry objects.
403      *
404      * @return all the entries or null if there are none present.
405      * @see X509CRLEntry
406      */
407     public abstract Set&lt;? extends X509CRLEntry&gt; getRevokedCertificates();
408 
409     /**
410      * Gets the DER-encoded CRL information, the
411      * {@code tbsCertList} from this CRL.
412      * This can be used to verify the signature independently.
413      *
414      * @return the DER-encoded CRL information.
<span class="line-modified">415      * @exception CRLException if an encoding error occurs.</span>
416      */
417     public abstract byte[] getTBSCertList() throws CRLException;
418 
419     /**
420      * Gets the {@code signature} value (the raw signature bits) from
421      * the CRL.
422      * The ASN.1 definition for this is:
423      * &lt;pre&gt;
424      * signature     BIT STRING
425      * &lt;/pre&gt;
426      *
427      * @return the signature.
428      */
429     public abstract byte[] getSignature();
430 
431     /**
432      * Gets the signature algorithm name for the CRL
433      * signature algorithm. An example is the string &quot;SHA256withRSA&quot;.
434      * The ASN.1 definition for this is:
435      * &lt;pre&gt;
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
153      *
154      * @return the hashcode value.
155      */
156     public int hashCode() {
157         int retval = 0;
158         try {
159             byte[] crlData = X509CRLImpl.getEncodedInternal(this);
160             for (int i = 1; i &lt; crlData.length; i++) {
161                  retval += crlData[i] * i;
162             }
163             return retval;
164         } catch (CRLException e) {
165             return retval;
166         }
167     }
168 
169     /**
170      * Returns the ASN.1 DER-encoded form of this CRL.
171      *
172      * @return the encoded form of this certificate
<span class="line-modified">173      * @throws    CRLException if an encoding error occurs.</span>
174      */
175     public abstract byte[] getEncoded()
176         throws CRLException;
177 
178     /**
179      * Verifies that this CRL was signed using the
180      * private key that corresponds to the given public key.
181      *
182      * @param key the PublicKey used to carry out the verification.
183      *
<span class="line-modified">184      * @throws    NoSuchAlgorithmException on unsupported signature</span>
185      * algorithms.
<span class="line-modified">186      * @throws    InvalidKeyException on incorrect key.</span>
<span class="line-modified">187      * @throws    NoSuchProviderException if there&#39;s no default provider.</span>
<span class="line-modified">188      * @throws    SignatureException on signature errors.</span>
<span class="line-modified">189      * @throws    CRLException on encoding errors.</span>
190      */
191     public abstract void verify(PublicKey key)
192         throws CRLException,  NoSuchAlgorithmException,
193         InvalidKeyException, NoSuchProviderException,
194         SignatureException;
195 
196     /**
197      * Verifies that this CRL was signed using the
198      * private key that corresponds to the given public key.
199      * This method uses the signature verification engine
200      * supplied by the given provider.
201      *
202      * @param key the PublicKey used to carry out the verification.
203      * @param sigProvider the name of the signature provider.
204      *
<span class="line-modified">205      * @throws    NoSuchAlgorithmException on unsupported signature</span>
206      * algorithms.
<span class="line-modified">207      * @throws    InvalidKeyException on incorrect key.</span>
<span class="line-modified">208      * @throws    NoSuchProviderException on incorrect provider.</span>
<span class="line-modified">209      * @throws    SignatureException on signature errors.</span>
<span class="line-modified">210      * @throws    CRLException on encoding errors.</span>
211      */
212     public abstract void verify(PublicKey key, String sigProvider)
213         throws CRLException, NoSuchAlgorithmException,
214         InvalidKeyException, NoSuchProviderException,
215         SignatureException;
216 
217     /**
218      * Verifies that this CRL was signed using the
219      * private key that corresponds to the given public key.
220      * This method uses the signature verification engine
221      * supplied by the given provider. Note that the specified Provider object
222      * does not have to be registered in the provider list.
223      *
224      * This method was added to version 1.8 of the Java Platform Standard
225      * Edition. In order to maintain backwards compatibility with existing
226      * service providers, this method is not {@code abstract}
227      * and it provides a default implementation.
228      *
229      * @param key the PublicKey used to carry out the verification.
230      * @param sigProvider the signature provider.
231      *
<span class="line-modified">232      * @throws    NoSuchAlgorithmException on unsupported signature</span>
233      * algorithms.
<span class="line-modified">234      * @throws    InvalidKeyException on incorrect key.</span>
<span class="line-modified">235      * @throws    SignatureException on signature errors.</span>
<span class="line-modified">236      * @throws    CRLException on encoding errors.</span>
237      * @since 1.8
238      */
239     public void verify(PublicKey key, Provider sigProvider)
240         throws CRLException, NoSuchAlgorithmException,
241         InvalidKeyException, SignatureException {
<span class="line-added">242         String sigAlgName = getSigAlgName();</span>
243         Signature sig = (sigProvider == null)
<span class="line-modified">244             ? Signature.getInstance(sigAlgName)</span>
<span class="line-modified">245             : Signature.getInstance(sigAlgName, sigProvider);</span>
246 




247         try {
<span class="line-modified">248             byte[] paramBytes = getSigAlgParams();</span>
<span class="line-added">249             SignatureUtil.initVerifyWithParam(sig, key,</span>
<span class="line-added">250                 SignatureUtil.getParamSpec(sigAlgName, paramBytes));</span>
251         } catch (ProviderException e) {
252             throw new CRLException(e.getMessage(), e.getCause());
253         } catch (InvalidAlgorithmParameterException e) {
254             throw new CRLException(e);
255         }
256 
257         byte[] tbsCRL = getTBSCertList();
258         sig.update(tbsCRL, 0, tbsCRL.length);
259 
260         if (sig.verify(getSignature()) == false) {
261             throw new SignatureException(&quot;Signature does not match.&quot;);
262         }
263     }
264 
265     /**
266      * Gets the {@code version} (version number) value from the CRL.
267      * The ASN.1 definition for this is:
268      * &lt;pre&gt;
269      * version    Version OPTIONAL,
270      *             -- if present, must be v2
</pre>
<hr />
<pre>
366      * @return the entry with the given serial number, or null if no such entry
367      * exists in this CRL.
368      * @see X509CRLEntry
369      */
370     public abstract X509CRLEntry
371         getRevokedCertificate(BigInteger serialNumber);
372 
373     /**
374      * Get the CRL entry, if any, for the given certificate.
375      *
376      * &lt;p&gt;This method can be used to lookup CRL entries in indirect CRLs,
377      * that means CRLs that contain entries from issuers other than the CRL
378      * issuer. The default implementation will only return entries for
379      * certificates issued by the CRL issuer. Subclasses that wish to
380      * support indirect CRLs should override this method.
381      *
382      * @param certificate the certificate for which a CRL entry is to be looked
383      *   up
384      * @return the entry for the given certificate, or null if no such entry
385      *   exists in this CRL.
<span class="line-modified">386      * @throws    NullPointerException if certificate is null</span>
387      *
388      * @since 1.5
389      */
390     public X509CRLEntry getRevokedCertificate(X509Certificate certificate) {
391         X500Principal certIssuer = certificate.getIssuerX500Principal();
392         X500Principal crlIssuer = getIssuerX500Principal();
393         if (certIssuer.equals(crlIssuer) == false) {
394             return null;
395         }
396         return getRevokedCertificate(certificate.getSerialNumber());
397     }
398 
399     /**
400      * Gets all the entries from this CRL.
401      * This returns a Set of X509CRLEntry objects.
402      *
403      * @return all the entries or null if there are none present.
404      * @see X509CRLEntry
405      */
406     public abstract Set&lt;? extends X509CRLEntry&gt; getRevokedCertificates();
407 
408     /**
409      * Gets the DER-encoded CRL information, the
410      * {@code tbsCertList} from this CRL.
411      * This can be used to verify the signature independently.
412      *
413      * @return the DER-encoded CRL information.
<span class="line-modified">414      * @throws    CRLException if an encoding error occurs.</span>
415      */
416     public abstract byte[] getTBSCertList() throws CRLException;
417 
418     /**
419      * Gets the {@code signature} value (the raw signature bits) from
420      * the CRL.
421      * The ASN.1 definition for this is:
422      * &lt;pre&gt;
423      * signature     BIT STRING
424      * &lt;/pre&gt;
425      *
426      * @return the signature.
427      */
428     public abstract byte[] getSignature();
429 
430     /**
431      * Gets the signature algorithm name for the CRL
432      * signature algorithm. An example is the string &quot;SHA256withRSA&quot;.
433      * The ASN.1 definition for this is:
434      * &lt;pre&gt;
</pre>
</td>
</tr>
</table>
<center><a href="PolicyQualifierInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="X509CRLEntry.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>