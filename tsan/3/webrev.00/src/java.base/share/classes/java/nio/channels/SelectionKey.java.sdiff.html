<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/nio/channels/SelectionKey.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ScatteringByteChannel.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="spi/AbstractInterruptibleChannel.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/nio/channels/SelectionKey.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.nio.channels;
 27 
<span class="line-modified"> 28 import java.util.concurrent.atomic.AtomicReferenceFieldUpdater;</span>

 29 
 30 /**
 31  * A token representing the registration of a {@link SelectableChannel} with a
 32  * {@link Selector}.
 33  *
 34  * &lt;p&gt; A selection key is created each time a channel is registered with a
 35  * selector.  A key remains valid until it is &lt;i&gt;cancelled&lt;/i&gt; by invoking its
 36  * {@link #cancel cancel} method, by closing its channel, or by closing its
 37  * selector.  Cancelling a key does not immediately remove it from its
 38  * selector; it is instead added to the selector&#39;s &lt;a
 39  * href=&quot;Selector.html#ks&quot;&gt;&lt;i&gt;cancelled-key set&lt;/i&gt;&lt;/a&gt; for removal during the
 40  * next selection operation.  The validity of a key may be tested by invoking
 41  * its {@link #isValid isValid} method.
 42  *
 43  * &lt;a id=&quot;opsets&quot;&gt;&lt;/a&gt;
 44  *
 45  * &lt;p&gt; A selection key contains two &lt;i&gt;operation sets&lt;/i&gt; represented as
 46  * integer values.  Each bit of an operation set denotes a category of
 47  * selectable operations that are supported by the key&#39;s channel.
 48  *
</pre>
<hr />
<pre>
411      * &lt;blockquote&gt;&lt;pre&gt;{@code
412      * k.readyOps() &amp; OP_ACCEPT != 0
413      * }&lt;/pre&gt;&lt;/blockquote&gt;
414      *
415      * &lt;p&gt; If this key&#39;s channel does not support socket-accept operations then
416      * this method always returns {@code false}.  &lt;/p&gt;
417      *
418      * @return  {@code true} if, and only if,
419      *          {@code readyOps() &amp; OP_ACCEPT} is nonzero
420      *
421      * @throws  CancelledKeyException
422      *          If this key has been cancelled
423      */
424     public final boolean isAcceptable() {
425         return (readyOps() &amp; OP_ACCEPT) != 0;
426     }
427 
428 
429     // -- Attachments --
430 









431     private volatile Object attachment;
432 
<span class="line-removed">433     private static final AtomicReferenceFieldUpdater&lt;SelectionKey,Object&gt;</span>
<span class="line-removed">434         attachmentUpdater = AtomicReferenceFieldUpdater.newUpdater(</span>
<span class="line-removed">435             SelectionKey.class, Object.class, &quot;attachment&quot;</span>
<span class="line-removed">436         );</span>
<span class="line-removed">437 </span>
438     /**
439      * Attaches the given object to this key.
440      *
441      * &lt;p&gt; An attached object may later be retrieved via the {@link #attachment()
442      * attachment} method.  Only one object may be attached at a time; invoking
443      * this method causes any previous attachment to be discarded.  The current
444      * attachment may be discarded by attaching {@code null}.  &lt;/p&gt;
445      *
446      * @param  ob
447      *         The object to be attached; may be {@code null}
448      *
449      * @return  The previously-attached object, if any,
450      *          otherwise {@code null}
451      */
452     public final Object attach(Object ob) {
<span class="line-modified">453         return attachmentUpdater.getAndSet(this, ob);</span>
454     }
455 
456     /**
457      * Retrieves the current attachment.
458      *
459      * @return  The object currently attached to this key,
460      *          or {@code null} if there is no attachment
461      */
462     public final Object attachment() {
463         return attachment;
464     }
465 
466 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.nio.channels;
 27 
<span class="line-modified"> 28 import java.lang.invoke.MethodHandles;</span>
<span class="line-added"> 29 import java.lang.invoke.VarHandle;</span>
 30 
 31 /**
 32  * A token representing the registration of a {@link SelectableChannel} with a
 33  * {@link Selector}.
 34  *
 35  * &lt;p&gt; A selection key is created each time a channel is registered with a
 36  * selector.  A key remains valid until it is &lt;i&gt;cancelled&lt;/i&gt; by invoking its
 37  * {@link #cancel cancel} method, by closing its channel, or by closing its
 38  * selector.  Cancelling a key does not immediately remove it from its
 39  * selector; it is instead added to the selector&#39;s &lt;a
 40  * href=&quot;Selector.html#ks&quot;&gt;&lt;i&gt;cancelled-key set&lt;/i&gt;&lt;/a&gt; for removal during the
 41  * next selection operation.  The validity of a key may be tested by invoking
 42  * its {@link #isValid isValid} method.
 43  *
 44  * &lt;a id=&quot;opsets&quot;&gt;&lt;/a&gt;
 45  *
 46  * &lt;p&gt; A selection key contains two &lt;i&gt;operation sets&lt;/i&gt; represented as
 47  * integer values.  Each bit of an operation set denotes a category of
 48  * selectable operations that are supported by the key&#39;s channel.
 49  *
</pre>
<hr />
<pre>
412      * &lt;blockquote&gt;&lt;pre&gt;{@code
413      * k.readyOps() &amp; OP_ACCEPT != 0
414      * }&lt;/pre&gt;&lt;/blockquote&gt;
415      *
416      * &lt;p&gt; If this key&#39;s channel does not support socket-accept operations then
417      * this method always returns {@code false}.  &lt;/p&gt;
418      *
419      * @return  {@code true} if, and only if,
420      *          {@code readyOps() &amp; OP_ACCEPT} is nonzero
421      *
422      * @throws  CancelledKeyException
423      *          If this key has been cancelled
424      */
425     public final boolean isAcceptable() {
426         return (readyOps() &amp; OP_ACCEPT) != 0;
427     }
428 
429 
430     // -- Attachments --
431 
<span class="line-added">432     private static final VarHandle ATTACHMENT;</span>
<span class="line-added">433     static {</span>
<span class="line-added">434         try {</span>
<span class="line-added">435             MethodHandles.Lookup l = MethodHandles.lookup();</span>
<span class="line-added">436             ATTACHMENT = l.findVarHandle(SelectionKey.class, &quot;attachment&quot;, Object.class);</span>
<span class="line-added">437         } catch (Exception e) {</span>
<span class="line-added">438             throw new InternalError(e);</span>
<span class="line-added">439         }</span>
<span class="line-added">440     }</span>
441     private volatile Object attachment;
442 





443     /**
444      * Attaches the given object to this key.
445      *
446      * &lt;p&gt; An attached object may later be retrieved via the {@link #attachment()
447      * attachment} method.  Only one object may be attached at a time; invoking
448      * this method causes any previous attachment to be discarded.  The current
449      * attachment may be discarded by attaching {@code null}.  &lt;/p&gt;
450      *
451      * @param  ob
452      *         The object to be attached; may be {@code null}
453      *
454      * @return  The previously-attached object, if any,
455      *          otherwise {@code null}
456      */
457     public final Object attach(Object ob) {
<span class="line-modified">458         return ATTACHMENT.getAndSet(this, ob);</span>
459     }
460 
461     /**
462      * Retrieves the current attachment.
463      *
464      * @return  The object currently attached to this key,
465      *          or {@code null} if there is no attachment
466      */
467     public final Object attachment() {
468         return attachment;
469     }
470 
471 }
</pre>
</td>
</tr>
</table>
<center><a href="ScatteringByteChannel.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="spi/AbstractInterruptibleChannel.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>