<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/util/jar/JarInputStream.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="JarFile.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="JarOutputStream.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/jar/JarInputStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2011, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 29,50 ***</span>
  import java.io.*;
  import sun.security.util.ManifestEntryVerifier;
  import jdk.internal.util.jar.JarIndex;
  
  /**
<span class="line-modified">!  * The &lt;code&gt;JarInputStream&lt;/code&gt; class is used to read the contents of</span>
   * a JAR file from any input stream. It extends the class
<span class="line-modified">!  * &lt;code&gt;java.util.zip.ZipInputStream&lt;/code&gt; with support for reading</span>
<span class="line-modified">!  * an optional &lt;code&gt;Manifest&lt;/code&gt; entry. The &lt;code&gt;Manifest&lt;/code&gt;</span>
   * can be used to store meta-information about the JAR file and its entries.
   *
   * @author  David Connelly
   * @see     Manifest
   * @see     java.util.zip.ZipInputStream
   * @since   1.2
   */
<span class="line-modified">! public</span>
<span class="line-removed">- class JarInputStream extends ZipInputStream {</span>
      private Manifest man;
      private JarEntry first;
      private JarVerifier jv;
      private ManifestEntryVerifier mev;
      private final boolean doVerify;
      private boolean tryManifest;
  
      /**
<span class="line-modified">!      * Creates a new &lt;code&gt;JarInputStream&lt;/code&gt; and reads the optional</span>
       * manifest. If a manifest is present, also attempts to verify
       * the signatures if the JarInputStream is signed.
       * @param in the actual input stream
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
       */
      public JarInputStream(InputStream in) throws IOException {
          this(in, true);
      }
  
      /**
<span class="line-modified">!      * Creates a new &lt;code&gt;JarInputStream&lt;/code&gt; and reads the optional</span>
       * manifest. If a manifest is present and verify is true, also attempts
       * to verify the signatures if the JarInputStream is signed.
       *
       * @param in the actual input stream
       * @param verify whether or not to verify the JarInputStream if
       * it is signed.
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
       */
      public JarInputStream(InputStream in, boolean verify) throws IOException {
          super(in);
          this.doVerify = verify;
  
<span class="line-new-header">--- 29,49 ---</span>
  import java.io.*;
  import sun.security.util.ManifestEntryVerifier;
  import jdk.internal.util.jar.JarIndex;
  
  /**
<span class="line-modified">!  * The {@code JarInputStream} class is used to read the contents of</span>
   * a JAR file from any input stream. It extends the class
<span class="line-modified">!  * {@code java.util.zip.ZipInputStream} with support for reading</span>
<span class="line-modified">!  * an optional {@code Manifest} entry. The {@code Manifest}</span>
   * can be used to store meta-information about the JAR file and its entries.
   *
   * @author  David Connelly
   * @see     Manifest
   * @see     java.util.zip.ZipInputStream
   * @since   1.2
   */
<span class="line-modified">! public class JarInputStream extends ZipInputStream {</span>
      private Manifest man;
      private JarEntry first;
      private JarVerifier jv;
      private ManifestEntryVerifier mev;
      private final boolean doVerify;
      private boolean tryManifest;
  
      /**
<span class="line-modified">!      * Creates a new {@code JarInputStream} and reads the optional</span>
       * manifest. If a manifest is present, also attempts to verify
       * the signatures if the JarInputStream is signed.
       * @param in the actual input stream
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
       */
      public JarInputStream(InputStream in) throws IOException {
          this(in, true);
      }
  
      /**
<span class="line-modified">!      * Creates a new {@code JarInputStream} and reads the optional</span>
       * manifest. If a manifest is present and verify is true, also attempts
       * to verify the signatures if the JarInputStream is signed.
       *
       * @param in the actual input stream
       * @param verify whether or not to verify the JarInputStream if
       * it is signed.
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
       */
      public JarInputStream(InputStream in, boolean verify) throws IOException {
          super(in);
          this.doVerify = verify;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 114,28 ***</span>
          }
          return baos.toByteArray();
      }
  
      /**
<span class="line-modified">!      * Returns the &lt;code&gt;Manifest&lt;/code&gt; for this JAR file, or</span>
<span class="line-modified">!      * &lt;code&gt;null&lt;/code&gt; if none.</span>
       *
<span class="line-modified">!      * @return the &lt;code&gt;Manifest&lt;/code&gt; for this JAR file, or</span>
<span class="line-modified">!      *         &lt;code&gt;null&lt;/code&gt; if none.</span>
       */
      public Manifest getManifest() {
          return man;
      }
  
      /**
       * Reads the next ZIP file entry and positions the stream at the
       * beginning of the entry data. If verification has been enabled,
       * any invalid signature detected while positioning the stream for
       * the next entry will result in an exception.
<span class="line-modified">!      * @exception ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
<span class="line-modified">!      * @exception SecurityException if any of the jar file entries</span>
       *         are incorrectly signed.
       */
      public ZipEntry getNextEntry() throws IOException {
          JarEntry e;
          if (first == null) {
<span class="line-new-header">--- 113,28 ---</span>
          }
          return baos.toByteArray();
      }
  
      /**
<span class="line-modified">!      * Returns the {@code Manifest} for this JAR file, or</span>
<span class="line-modified">!      * {@code null} if none.</span>
       *
<span class="line-modified">!      * @return the {@code Manifest} for this JAR file, or</span>
<span class="line-modified">!      *         {@code null} if none.</span>
       */
      public Manifest getManifest() {
          return man;
      }
  
      /**
       * Reads the next ZIP file entry and positions the stream at the
       * beginning of the entry data. If verification has been enabled,
       * any invalid signature detected while positioning the stream for
       * the next entry will result in an exception.
<span class="line-modified">!      * @throws    ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
<span class="line-modified">!      * @throws    SecurityException if any of the jar file entries</span>
       *         are incorrectly signed.
       */
      public ZipEntry getNextEntry() throws IOException {
          JarEntry e;
          if (first == null) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 168,39 ***</span>
       * Reads the next JAR file entry and positions the stream at the
       * beginning of the entry data. If verification has been enabled,
       * any invalid signature detected while positioning the stream for
       * the next entry will result in an exception.
       * @return the next JAR file entry, or null if there are no more entries
<span class="line-modified">!      * @exception ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
<span class="line-modified">!      * @exception SecurityException if any of the jar file entries</span>
       *         are incorrectly signed.
       */
      public JarEntry getNextJarEntry() throws IOException {
          return (JarEntry)getNextEntry();
      }
  
      /**
       * Reads from the current JAR file entry into an array of bytes.
<span class="line-modified">!      * If &lt;code&gt;len&lt;/code&gt; is not zero, the method</span>
       * blocks until some input is available; otherwise, no
<span class="line-modified">!      * bytes are read and &lt;code&gt;0&lt;/code&gt; is returned.</span>
       * If verification has been enabled, any invalid signature
       * on the current entry will be reported at some point before the
       * end of the entry is reached.
       * @param b the buffer into which the data is read
<span class="line-modified">!      * @param off the start offset in the destination array &lt;code&gt;b&lt;/code&gt;</span>
       * @param len the maximum number of bytes to read
       * @return the actual number of bytes read, or -1 if the end of the
       *         entry is reached
<span class="line-modified">!      * @exception  NullPointerException If &lt;code&gt;b&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.</span>
<span class="line-modified">!      * @exception  IndexOutOfBoundsException If &lt;code&gt;off&lt;/code&gt; is negative,</span>
<span class="line-modified">!      * &lt;code&gt;len&lt;/code&gt; is negative, or &lt;code&gt;len&lt;/code&gt; is greater than</span>
<span class="line-modified">!      * &lt;code&gt;b.length - off&lt;/code&gt;</span>
<span class="line-modified">!      * @exception ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @exception IOException if an I/O error has occurred</span>
<span class="line-modified">!      * @exception SecurityException if any of the jar file entries</span>
       *         are incorrectly signed.
       */
      public int read(byte[] b, int off, int len) throws IOException {
          int n;
          if (first == null) {
<span class="line-new-header">--- 167,39 ---</span>
       * Reads the next JAR file entry and positions the stream at the
       * beginning of the entry data. If verification has been enabled,
       * any invalid signature detected while positioning the stream for
       * the next entry will result in an exception.
       * @return the next JAR file entry, or null if there are no more entries
<span class="line-modified">!      * @throws    ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
<span class="line-modified">!      * @throws    SecurityException if any of the jar file entries</span>
       *         are incorrectly signed.
       */
      public JarEntry getNextJarEntry() throws IOException {
          return (JarEntry)getNextEntry();
      }
  
      /**
       * Reads from the current JAR file entry into an array of bytes.
<span class="line-modified">!      * If {@code len} is not zero, the method</span>
       * blocks until some input is available; otherwise, no
<span class="line-modified">!      * bytes are read and {@code 0} is returned.</span>
       * If verification has been enabled, any invalid signature
       * on the current entry will be reported at some point before the
       * end of the entry is reached.
       * @param b the buffer into which the data is read
<span class="line-modified">!      * @param off the start offset in the destination array {@code b}</span>
       * @param len the maximum number of bytes to read
       * @return the actual number of bytes read, or -1 if the end of the
       *         entry is reached
<span class="line-modified">!      * @throws     NullPointerException If {@code b} is {@code null}.</span>
<span class="line-modified">!      * @throws     IndexOutOfBoundsException If {@code off} is negative,</span>
<span class="line-modified">!      * {@code len} is negative, or {@code len} is greater than</span>
<span class="line-modified">!      * {@code b.length - off}</span>
<span class="line-modified">!      * @throws    ZipException if a ZIP file error has occurred</span>
<span class="line-modified">!      * @throws    IOException if an I/O error has occurred</span>
<span class="line-modified">!      * @throws    SecurityException if any of the jar file entries</span>
       *         are incorrectly signed.
       */
      public int read(byte[] b, int off, int len) throws IOException {
          int n;
          if (first == null) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 213,17 ***</span>
          }
          return n;
      }
  
      /**
<span class="line-modified">!      * Creates a new &lt;code&gt;JarEntry&lt;/code&gt; (&lt;code&gt;ZipEntry&lt;/code&gt;) for the</span>
       * specified JAR file entry name. The manifest attributes of
       * the specified JAR file entry name will be copied to the new
       * &lt;CODE&gt;JarEntry&lt;/CODE&gt;.
       *
       * @param name the name of the JAR/ZIP file entry
<span class="line-modified">!      * @return the &lt;code&gt;JarEntry&lt;/code&gt; object just created</span>
       */
      protected ZipEntry createZipEntry(String name) {
          JarEntry e = new JarEntry(name);
          if (man != null) {
              e.attr = man.getAttributes(name);
<span class="line-new-header">--- 212,17 ---</span>
          }
          return n;
      }
  
      /**
<span class="line-modified">!      * Creates a new {@code JarEntry} ({@code ZipEntry}) for the</span>
       * specified JAR file entry name. The manifest attributes of
       * the specified JAR file entry name will be copied to the new
       * &lt;CODE&gt;JarEntry&lt;/CODE&gt;.
       *
       * @param name the name of the JAR/ZIP file entry
<span class="line-modified">!      * @return the {@code JarEntry} object just created</span>
       */
      protected ZipEntry createZipEntry(String name) {
          JarEntry e = new JarEntry(name);
          if (man != null) {
              e.attr = man.getAttributes(name);
</pre>
<center><a href="JarFile.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="JarOutputStream.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>