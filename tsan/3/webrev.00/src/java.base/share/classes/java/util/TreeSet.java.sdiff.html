<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/util/TreeSet.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="TreeMap.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="UUID.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/TreeSet.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
285     }
286 
287     /**
288      * Adds all of the elements in the specified collection to this set.
289      *
290      * @param c collection containing elements to be added to this set
291      * @return {@code true} if this set changed as a result of the call
292      * @throws ClassCastException if the elements provided cannot be compared
293      *         with the elements currently in the set
294      * @throws NullPointerException if the specified collection is null or
295      *         if any element is null and this set uses natural ordering, or
296      *         its comparator does not permit null elements
297      */
298     public  boolean addAll(Collection&lt;? extends E&gt; c) {
299         // Use linear-time version if applicable
300         if (m.size()==0 &amp;&amp; c.size() &gt; 0 &amp;&amp;
301             c instanceof SortedSet &amp;&amp;
302             m instanceof TreeMap) {
303             SortedSet&lt;? extends E&gt; set = (SortedSet&lt;? extends E&gt;) c;
304             TreeMap&lt;E,Object&gt; map = (TreeMap&lt;E, Object&gt;) m;
<span class="line-modified">305             Comparator&lt;?&gt; cc = set.comparator();</span>
<span class="line-removed">306             Comparator&lt;? super E&gt; mc = map.comparator();</span>
<span class="line-removed">307             if (cc==mc || (cc != null &amp;&amp; cc.equals(mc))) {</span>
308                 map.addAllForTreeSet(set, PRESENT);
309                 return true;
310             }
311         }
312         return super.addAll(c);
313     }
314 
315     /**
316      * @throws ClassCastException {@inheritDoc}
317      * @throws NullPointerException if {@code fromElement} or {@code toElement}
318      *         is null and this set uses natural ordering, or its comparator
319      *         does not permit null elements
320      * @throws IllegalArgumentException {@inheritDoc}
321      * @since 1.6
322      */
323     public NavigableSet&lt;E&gt; subSet(E fromElement, boolean fromInclusive,
324                                   E toElement,   boolean toInclusive) {
325         return new TreeSet&lt;&gt;(m.subMap(fromElement, fromInclusive,
326                                        toElement,   toInclusive));
327     }
</pre>
<hr />
<pre>
477         } catch (CloneNotSupportedException e) {
478             throw new InternalError(e);
479         }
480 
481         clone.m = new TreeMap&lt;&gt;(m);
482         return clone;
483     }
484 
485     /**
486      * Save the state of the {@code TreeSet} instance to a stream (that is,
487      * serialize it).
488      *
489      * @serialData Emits the comparator used to order this set, or
490      *             {@code null} if it obeys its elements&#39; natural ordering
491      *             (Object), followed by the size of the set (the number of
492      *             elements it contains) (int), followed by all of its
493      *             elements (each an Object) in order (as determined by the
494      *             set&#39;s Comparator, or by the elements&#39; natural ordering if
495      *             the set has no Comparator).
496      */

497     private void writeObject(java.io.ObjectOutputStream s)
498         throws java.io.IOException {
499         // Write out any hidden stuff
500         s.defaultWriteObject();
501 
502         // Write out Comparator
503         s.writeObject(m.comparator());
504 
505         // Write out size
506         s.writeInt(m.size());
507 
508         // Write out all elements in the proper order.
509         for (E e : m.keySet())
510             s.writeObject(e);
511     }
512 
513     /**
514      * Reconstitute the {@code TreeSet} instance from a stream (that is,
515      * deserialize it).
516      */

517     private void readObject(java.io.ObjectInputStream s)
518         throws java.io.IOException, ClassNotFoundException {
519         // Read in any hidden stuff
520         s.defaultReadObject();
521 
522         // Read in Comparator
523         @SuppressWarnings(&quot;unchecked&quot;)
524             Comparator&lt;? super E&gt; c = (Comparator&lt;? super E&gt;) s.readObject();
525 
526         // Create backing TreeMap
527         TreeMap&lt;E,Object&gt; tm = new TreeMap&lt;&gt;(c);
528         m = tm;
529 
530         // Read in size
531         int size = s.readInt();
532 
533         tm.readTreeSet(size, s, PRESENT);
534     }
535 
536     /**
</pre>
<hr />
<pre>
539      * set.
540      *
541      * &lt;p&gt;The {@code Spliterator} reports {@link Spliterator#SIZED},
542      * {@link Spliterator#DISTINCT}, {@link Spliterator#SORTED}, and
543      * {@link Spliterator#ORDERED}.  Overriding implementations should document
544      * the reporting of additional characteristic values.
545      *
546      * &lt;p&gt;The spliterator&#39;s comparator (see
547      * {@link java.util.Spliterator#getComparator()}) is {@code null} if
548      * the tree set&#39;s comparator (see {@link #comparator()}) is {@code null}.
549      * Otherwise, the spliterator&#39;s comparator is the same as or imposes the
550      * same total ordering as the tree set&#39;s comparator.
551      *
552      * @return a {@code Spliterator} over the elements in this set
553      * @since 1.8
554      */
555     public Spliterator&lt;E&gt; spliterator() {
556         return TreeMap.keySpliteratorFor(m);
557     }
558 

559     private static final long serialVersionUID = -2479143000061671589L;
560 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
285     }
286 
287     /**
288      * Adds all of the elements in the specified collection to this set.
289      *
290      * @param c collection containing elements to be added to this set
291      * @return {@code true} if this set changed as a result of the call
292      * @throws ClassCastException if the elements provided cannot be compared
293      *         with the elements currently in the set
294      * @throws NullPointerException if the specified collection is null or
295      *         if any element is null and this set uses natural ordering, or
296      *         its comparator does not permit null elements
297      */
298     public  boolean addAll(Collection&lt;? extends E&gt; c) {
299         // Use linear-time version if applicable
300         if (m.size()==0 &amp;&amp; c.size() &gt; 0 &amp;&amp;
301             c instanceof SortedSet &amp;&amp;
302             m instanceof TreeMap) {
303             SortedSet&lt;? extends E&gt; set = (SortedSet&lt;? extends E&gt;) c;
304             TreeMap&lt;E,Object&gt; map = (TreeMap&lt;E, Object&gt;) m;
<span class="line-modified">305             if (Objects.equals(set.comparator(), map.comparator())) {</span>


306                 map.addAllForTreeSet(set, PRESENT);
307                 return true;
308             }
309         }
310         return super.addAll(c);
311     }
312 
313     /**
314      * @throws ClassCastException {@inheritDoc}
315      * @throws NullPointerException if {@code fromElement} or {@code toElement}
316      *         is null and this set uses natural ordering, or its comparator
317      *         does not permit null elements
318      * @throws IllegalArgumentException {@inheritDoc}
319      * @since 1.6
320      */
321     public NavigableSet&lt;E&gt; subSet(E fromElement, boolean fromInclusive,
322                                   E toElement,   boolean toInclusive) {
323         return new TreeSet&lt;&gt;(m.subMap(fromElement, fromInclusive,
324                                        toElement,   toInclusive));
325     }
</pre>
<hr />
<pre>
475         } catch (CloneNotSupportedException e) {
476             throw new InternalError(e);
477         }
478 
479         clone.m = new TreeMap&lt;&gt;(m);
480         return clone;
481     }
482 
483     /**
484      * Save the state of the {@code TreeSet} instance to a stream (that is,
485      * serialize it).
486      *
487      * @serialData Emits the comparator used to order this set, or
488      *             {@code null} if it obeys its elements&#39; natural ordering
489      *             (Object), followed by the size of the set (the number of
490      *             elements it contains) (int), followed by all of its
491      *             elements (each an Object) in order (as determined by the
492      *             set&#39;s Comparator, or by the elements&#39; natural ordering if
493      *             the set has no Comparator).
494      */
<span class="line-added">495     @java.io.Serial</span>
496     private void writeObject(java.io.ObjectOutputStream s)
497         throws java.io.IOException {
498         // Write out any hidden stuff
499         s.defaultWriteObject();
500 
501         // Write out Comparator
502         s.writeObject(m.comparator());
503 
504         // Write out size
505         s.writeInt(m.size());
506 
507         // Write out all elements in the proper order.
508         for (E e : m.keySet())
509             s.writeObject(e);
510     }
511 
512     /**
513      * Reconstitute the {@code TreeSet} instance from a stream (that is,
514      * deserialize it).
515      */
<span class="line-added">516     @java.io.Serial</span>
517     private void readObject(java.io.ObjectInputStream s)
518         throws java.io.IOException, ClassNotFoundException {
519         // Read in any hidden stuff
520         s.defaultReadObject();
521 
522         // Read in Comparator
523         @SuppressWarnings(&quot;unchecked&quot;)
524             Comparator&lt;? super E&gt; c = (Comparator&lt;? super E&gt;) s.readObject();
525 
526         // Create backing TreeMap
527         TreeMap&lt;E,Object&gt; tm = new TreeMap&lt;&gt;(c);
528         m = tm;
529 
530         // Read in size
531         int size = s.readInt();
532 
533         tm.readTreeSet(size, s, PRESENT);
534     }
535 
536     /**
</pre>
<hr />
<pre>
539      * set.
540      *
541      * &lt;p&gt;The {@code Spliterator} reports {@link Spliterator#SIZED},
542      * {@link Spliterator#DISTINCT}, {@link Spliterator#SORTED}, and
543      * {@link Spliterator#ORDERED}.  Overriding implementations should document
544      * the reporting of additional characteristic values.
545      *
546      * &lt;p&gt;The spliterator&#39;s comparator (see
547      * {@link java.util.Spliterator#getComparator()}) is {@code null} if
548      * the tree set&#39;s comparator (see {@link #comparator()}) is {@code null}.
549      * Otherwise, the spliterator&#39;s comparator is the same as or imposes the
550      * same total ordering as the tree set&#39;s comparator.
551      *
552      * @return a {@code Spliterator} over the elements in this set
553      * @since 1.8
554      */
555     public Spliterator&lt;E&gt; spliterator() {
556         return TreeMap.keySpliteratorFor(m);
557     }
558 
<span class="line-added">559     @java.io.Serial</span>
560     private static final long serialVersionUID = -2479143000061671589L;
561 }
</pre>
</td>
</tr>
</table>
<center><a href="TreeMap.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="UUID.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>