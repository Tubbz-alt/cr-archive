<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/io/PipedInputStream.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="OutputStreamWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="PipedOutputStream.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/io/PipedInputStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1995, 2013, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1995, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 28,13 ***</span>
  /**
   * A piped input stream should be connected
   * to a piped output stream; the piped  input
   * stream then provides whatever data bytes
   * are written to the piped output  stream.
<span class="line-modified">!  * Typically, data is read from a &lt;code&gt;PipedInputStream&lt;/code&gt;</span>
   * object by one thread  and data is written
<span class="line-modified">!  * to the corresponding &lt;code&gt;PipedOutputStream&lt;/code&gt;</span>
   * by some  other thread. Attempting to use
   * both objects from a single thread is not
   * recommended, as it may deadlock the thread.
   * The piped input stream contains a buffer,
   * decoupling read operations from write operations,
<span class="line-new-header">--- 28,13 ---</span>
  /**
   * A piped input stream should be connected
   * to a piped output stream; the piped  input
   * stream then provides whatever data bytes
   * are written to the piped output  stream.
<span class="line-modified">!  * Typically, data is read from a {@code PipedInputStream}</span>
   * object by one thread  and data is written
<span class="line-modified">!  * to the corresponding {@code PipedOutputStream}</span>
   * by some  other thread. Attempting to use
   * both objects from a single thread is not
   * recommended, as it may deadlock the thread.
   * The piped input stream contains a buffer,
   * decoupling read operations from write operations,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 78,11 ***</span>
  
      /**
       * The index of the position in the circular buffer at which the
       * next byte of data will be stored when received from the connected
       * piped output stream. &lt;code&gt;in&amp;lt;0&lt;/code&gt; implies the buffer is empty,
<span class="line-modified">!      * &lt;code&gt;in==out&lt;/code&gt; implies the buffer is full</span>
       * @since   1.1
       */
      protected int in = -1;
  
      /**
<span class="line-new-header">--- 78,11 ---</span>
  
      /**
       * The index of the position in the circular buffer at which the
       * next byte of data will be stored when received from the connected
       * piped output stream. &lt;code&gt;in&amp;lt;0&lt;/code&gt; implies the buffer is empty,
<span class="line-modified">!      * {@code in==out} implies the buffer is full</span>
       * @since   1.1
       */
      protected int in = -1;
  
      /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 91,65 ***</span>
       * @since   1.1
       */
      protected int out = 0;
  
      /**
<span class="line-modified">!      * Creates a &lt;code&gt;PipedInputStream&lt;/code&gt; so</span>
       * that it is connected to the piped output
<span class="line-modified">!      * stream &lt;code&gt;src&lt;/code&gt;. Data bytes written</span>
<span class="line-modified">!      * to &lt;code&gt;src&lt;/code&gt; will then be  available</span>
       * as input from this stream.
       *
       * @param      src   the stream to connect to.
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
       */
      public PipedInputStream(PipedOutputStream src) throws IOException {
          this(src, DEFAULT_PIPE_SIZE);
      }
  
      /**
<span class="line-modified">!      * Creates a &lt;code&gt;PipedInputStream&lt;/code&gt; so that it is</span>
       * connected to the piped output stream
<span class="line-modified">!      * &lt;code&gt;src&lt;/code&gt; and uses the specified pipe size for</span>
       * the pipe&#39;s buffer.
<span class="line-modified">!      * Data bytes written to &lt;code&gt;src&lt;/code&gt; will then</span>
       * be available as input from this stream.
       *
       * @param      src   the stream to connect to.
       * @param      pipeSize the size of the pipe&#39;s buffer.
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
<span class="line-modified">!      * @exception  IllegalArgumentException if {@code pipeSize &lt;= 0}.</span>
       * @since      1.6
       */
      public PipedInputStream(PipedOutputStream src, int pipeSize)
              throws IOException {
           initPipe(pipeSize);
           connect(src);
      }
  
      /**
<span class="line-modified">!      * Creates a &lt;code&gt;PipedInputStream&lt;/code&gt; so</span>
       * that it is not yet {@linkplain #connect(java.io.PipedOutputStream)
       * connected}.
       * It must be {@linkplain java.io.PipedOutputStream#connect(
       * java.io.PipedInputStream) connected} to a
<span class="line-modified">!      * &lt;code&gt;PipedOutputStream&lt;/code&gt; before being used.</span>
       */
      public PipedInputStream() {
          initPipe(DEFAULT_PIPE_SIZE);
      }
  
      /**
<span class="line-modified">!      * Creates a &lt;code&gt;PipedInputStream&lt;/code&gt; so that it is not yet</span>
       * {@linkplain #connect(java.io.PipedOutputStream) connected} and
       * uses the specified pipe size for the pipe&#39;s buffer.
       * It must be {@linkplain java.io.PipedOutputStream#connect(
       * java.io.PipedInputStream)
<span class="line-modified">!      * connected} to a &lt;code&gt;PipedOutputStream&lt;/code&gt; before being used.</span>
       *
       * @param      pipeSize the size of the pipe&#39;s buffer.
<span class="line-modified">!      * @exception  IllegalArgumentException if {@code pipeSize &lt;= 0}.</span>
       * @since      1.6
       */
      public PipedInputStream(int pipeSize) {
          initPipe(pipeSize);
      }
<span class="line-new-header">--- 91,65 ---</span>
       * @since   1.1
       */
      protected int out = 0;
  
      /**
<span class="line-modified">!      * Creates a {@code PipedInputStream} so</span>
       * that it is connected to the piped output
<span class="line-modified">!      * stream {@code src}. Data bytes written</span>
<span class="line-modified">!      * to {@code src} will then be  available</span>
       * as input from this stream.
       *
       * @param      src   the stream to connect to.
<span class="line-modified">!      * @throws     IOException  if an I/O error occurs.</span>
       */
      public PipedInputStream(PipedOutputStream src) throws IOException {
          this(src, DEFAULT_PIPE_SIZE);
      }
  
      /**
<span class="line-modified">!      * Creates a {@code PipedInputStream} so that it is</span>
       * connected to the piped output stream
<span class="line-modified">!      * {@code src} and uses the specified pipe size for</span>
       * the pipe&#39;s buffer.
<span class="line-modified">!      * Data bytes written to {@code src} will then</span>
       * be available as input from this stream.
       *
       * @param      src   the stream to connect to.
       * @param      pipeSize the size of the pipe&#39;s buffer.
<span class="line-modified">!      * @throws     IOException  if an I/O error occurs.</span>
<span class="line-modified">!      * @throws     IllegalArgumentException if {@code pipeSize &lt;= 0}.</span>
       * @since      1.6
       */
      public PipedInputStream(PipedOutputStream src, int pipeSize)
              throws IOException {
           initPipe(pipeSize);
           connect(src);
      }
  
      /**
<span class="line-modified">!      * Creates a {@code PipedInputStream} so</span>
       * that it is not yet {@linkplain #connect(java.io.PipedOutputStream)
       * connected}.
       * It must be {@linkplain java.io.PipedOutputStream#connect(
       * java.io.PipedInputStream) connected} to a
<span class="line-modified">!      * {@code PipedOutputStream} before being used.</span>
       */
      public PipedInputStream() {
          initPipe(DEFAULT_PIPE_SIZE);
      }
  
      /**
<span class="line-modified">!      * Creates a {@code PipedInputStream} so that it is not yet</span>
       * {@linkplain #connect(java.io.PipedOutputStream) connected} and
       * uses the specified pipe size for the pipe&#39;s buffer.
       * It must be {@linkplain java.io.PipedOutputStream#connect(
       * java.io.PipedInputStream)
<span class="line-modified">!      * connected} to a {@code PipedOutputStream} before being used.</span>
       *
       * @param      pipeSize the size of the pipe&#39;s buffer.
<span class="line-modified">!      * @throws     IllegalArgumentException if {@code pipeSize &lt;= 0}.</span>
       * @since      1.6
       */
      public PipedInputStream(int pipeSize) {
          initPipe(pipeSize);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 161,43 ***</span>
           buffer = new byte[pipeSize];
      }
  
      /**
       * Causes this piped input stream to be connected
<span class="line-modified">!      * to the piped  output stream &lt;code&gt;src&lt;/code&gt;.</span>
       * If this object is already connected to some
<span class="line-modified">!      * other piped output  stream, an &lt;code&gt;IOException&lt;/code&gt;</span>
       * is thrown.
       * &lt;p&gt;
<span class="line-modified">!      * If &lt;code&gt;src&lt;/code&gt; is an</span>
<span class="line-modified">!      * unconnected piped output stream and &lt;code&gt;snk&lt;/code&gt;</span>
       * is an unconnected piped input stream, they
       * may be connected by either the call:
       *
<span class="line-modified">!      * &lt;pre&gt;&lt;code&gt;snk.connect(src)&lt;/code&gt; &lt;/pre&gt;</span>
       * &lt;p&gt;
       * or the call:
       *
<span class="line-modified">!      * &lt;pre&gt;&lt;code&gt;src.connect(snk)&lt;/code&gt; &lt;/pre&gt;</span>
       * &lt;p&gt;
       * The two calls have the same effect.
       *
       * @param      src   The piped output stream to connect to.
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
       */
      public void connect(PipedOutputStream src) throws IOException {
          src.connect(this);
      }
  
      /**
       * Receives a byte of data.  This method will block if no input is
       * available.
<span class="line-modified">!      * @param b the byte being received</span>
<span class="line-modified">!      * @exception IOException If the pipe is &lt;a href=&quot;#BROKEN&quot;&gt; &lt;code&gt;broken&lt;/code&gt;&lt;/a&gt;,</span>
       *          {@link #connect(java.io.PipedOutputStream) unconnected},
       *          closed, or if an I/O error occurs.
<span class="line-modified">!      * @since     1.1</span>
       */
      protected synchronized void receive(int b) throws IOException {
          checkStateForReceive();
          writeSide = Thread.currentThread();
          if (in == out)
<span class="line-new-header">--- 161,43 ---</span>
           buffer = new byte[pipeSize];
      }
  
      /**
       * Causes this piped input stream to be connected
<span class="line-modified">!      * to the piped  output stream {@code src}.</span>
       * If this object is already connected to some
<span class="line-modified">!      * other piped output  stream, an {@code IOException}</span>
       * is thrown.
       * &lt;p&gt;
<span class="line-modified">!      * If {@code src} is an</span>
<span class="line-modified">!      * unconnected piped output stream and {@code snk}</span>
       * is an unconnected piped input stream, they
       * may be connected by either the call:
       *
<span class="line-modified">!      * &lt;pre&gt;{@code snk.connect(src)} &lt;/pre&gt;</span>
       * &lt;p&gt;
       * or the call:
       *
<span class="line-modified">!      * &lt;pre&gt;{@code src.connect(snk)} &lt;/pre&gt;</span>
       * &lt;p&gt;
       * The two calls have the same effect.
       *
       * @param      src   The piped output stream to connect to.
<span class="line-modified">!      * @throws     IOException  if an I/O error occurs.</span>
       */
      public void connect(PipedOutputStream src) throws IOException {
          src.connect(this);
      }
  
      /**
       * Receives a byte of data.  This method will block if no input is
       * available.
<span class="line-modified">!      * @param   b the byte being received</span>
<span class="line-modified">!      * @throws  IOException If the pipe is &lt;a href=&quot;#BROKEN&quot;&gt; {@code broken}&lt;/a&gt;,</span>
       *          {@link #connect(java.io.PipedOutputStream) unconnected},
       *          closed, or if an I/O error occurs.
<span class="line-modified">!      * @since   1.1</span>
       */
      protected synchronized void receive(int b) throws IOException {
          checkStateForReceive();
          writeSide = Thread.currentThread();
          if (in == out)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 213,14 ***</span>
      }
  
      /**
       * Receives data into an array of bytes.  This method will
       * block until some input is available.
<span class="line-modified">!      * @param b the buffer into which the data is received</span>
<span class="line-modified">!      * @param off the start offset of the data</span>
<span class="line-modified">!      * @param len the maximum number of bytes received</span>
<span class="line-modified">!      * @exception IOException If the pipe is &lt;a href=&quot;#BROKEN&quot;&gt; broken&lt;/a&gt;,</span>
       *           {@link #connect(java.io.PipedOutputStream) unconnected},
       *           closed,or if an I/O error occurs.
       */
      synchronized void receive(byte b[], int off, int len)  throws IOException {
          checkStateForReceive();
<span class="line-new-header">--- 213,14 ---</span>
      }
  
      /**
       * Receives data into an array of bytes.  This method will
       * block until some input is available.
<span class="line-modified">!      * @param    b the buffer into which the data is received</span>
<span class="line-modified">!      * @param    off the start offset of the data</span>
<span class="line-modified">!      * @param    len the maximum number of bytes received</span>
<span class="line-modified">!      * @throws   IOException If the pipe is &lt;a href=&quot;#BROKEN&quot;&gt; broken&lt;/a&gt;,</span>
       *           {@link #connect(java.io.PipedOutputStream) unconnected},
       *           closed,or if an I/O error occurs.
       */
      synchronized void receive(byte b[], int off, int len)  throws IOException {
          checkStateForReceive();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 286,20 ***</span>
          notifyAll();
      }
  
      /**
       * Reads the next byte of data from this piped input stream. The
<span class="line-modified">!      * value byte is returned as an &lt;code&gt;int&lt;/code&gt; in the range</span>
<span class="line-modified">!      * &lt;code&gt;0&lt;/code&gt; to &lt;code&gt;255&lt;/code&gt;.</span>
       * This method blocks until input data is available, the end of the
       * stream is detected, or an exception is thrown.
       *
<span class="line-modified">!      * @return     the next byte of data, or &lt;code&gt;-1&lt;/code&gt; if the end of the</span>
<span class="line-modified">!      *             stream is reached.</span>
<span class="line-modified">!      * @exception  IOException  if the pipe is</span>
       *           {@link #connect(java.io.PipedOutputStream) unconnected},
<span class="line-modified">!      *           &lt;a href=&quot;#BROKEN&quot;&gt; &lt;code&gt;broken&lt;/code&gt;&lt;/a&gt;, closed,</span>
       *           or if an I/O error occurs.
       */
      public synchronized int read()  throws IOException {
          if (!connected) {
              throw new IOException(&quot;Pipe not connected&quot;);
<span class="line-new-header">--- 286,20 ---</span>
          notifyAll();
      }
  
      /**
       * Reads the next byte of data from this piped input stream. The
<span class="line-modified">!      * value byte is returned as an {@code int} in the range</span>
<span class="line-modified">!      * {@code 0} to {@code 255}.</span>
       * This method blocks until input data is available, the end of the
       * stream is detected, or an exception is thrown.
       *
<span class="line-modified">!      * @return   the next byte of data, or {@code -1} if the end of the</span>
<span class="line-modified">!      *           stream is reached.</span>
<span class="line-modified">!      * @throws   IOException  if the pipe is</span>
       *           {@link #connect(java.io.PipedOutputStream) unconnected},
<span class="line-modified">!      *           &lt;a href=&quot;#BROKEN&quot;&gt; {@code broken}&lt;/a&gt;, closed,</span>
       *           or if an I/O error occurs.
       */
      public synchronized int read()  throws IOException {
          if (!connected) {
              throw new IOException(&quot;Pipe not connected&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 339,30 ***</span>
  
          return ret;
      }
  
      /**
<span class="line-modified">!      * Reads up to &lt;code&gt;len&lt;/code&gt; bytes of data from this piped input</span>
<span class="line-modified">!      * stream into an array of bytes. Less than &lt;code&gt;len&lt;/code&gt; bytes</span>
       * will be read if the end of the data stream is reached or if
<span class="line-modified">!      * &lt;code&gt;len&lt;/code&gt; exceeds the pipe&#39;s buffer size.</span>
<span class="line-modified">!      * If &lt;code&gt;len &lt;/code&gt; is zero, then no bytes are read and 0 is returned;</span>
       * otherwise, the method blocks until at least 1 byte of input is
       * available, end of the stream has been detected, or an exception is
       * thrown.
       *
       * @param      b     the buffer into which the data is read.
<span class="line-modified">!      * @param      off   the start offset in the destination array &lt;code&gt;b&lt;/code&gt;</span>
       * @param      len   the maximum number of bytes read.
       * @return     the total number of bytes read into the buffer, or
<span class="line-modified">!      *             &lt;code&gt;-1&lt;/code&gt; if there is no more data because the end of</span>
       *             the stream has been reached.
<span class="line-modified">!      * @exception  NullPointerException If &lt;code&gt;b&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.</span>
<span class="line-modified">!      * @exception  IndexOutOfBoundsException If &lt;code&gt;off&lt;/code&gt; is negative,</span>
<span class="line-modified">!      * &lt;code&gt;len&lt;/code&gt; is negative, or &lt;code&gt;len&lt;/code&gt; is greater than</span>
<span class="line-modified">!      * &lt;code&gt;b.length - off&lt;/code&gt;</span>
<span class="line-modified">!      * @exception  IOException if the pipe is &lt;a href=&quot;#BROKEN&quot;&gt; &lt;code&gt;broken&lt;/code&gt;&lt;/a&gt;,</span>
       *           {@link #connect(java.io.PipedOutputStream) unconnected},
       *           closed, or if an I/O error occurs.
       */
      public synchronized int read(byte b[], int off, int len)  throws IOException {
          if (b == null) {
<span class="line-new-header">--- 339,30 ---</span>
  
          return ret;
      }
  
      /**
<span class="line-modified">!      * Reads up to {@code len} bytes of data from this piped input</span>
<span class="line-modified">!      * stream into an array of bytes. Less than {@code len} bytes</span>
       * will be read if the end of the data stream is reached or if
<span class="line-modified">!      * {@code len} exceeds the pipe&#39;s buffer size.</span>
<span class="line-modified">!      * If {@code len } is zero, then no bytes are read and 0 is returned;</span>
       * otherwise, the method blocks until at least 1 byte of input is
       * available, end of the stream has been detected, or an exception is
       * thrown.
       *
       * @param      b     the buffer into which the data is read.
<span class="line-modified">!      * @param      off   the start offset in the destination array {@code b}</span>
       * @param      len   the maximum number of bytes read.
       * @return     the total number of bytes read into the buffer, or
<span class="line-modified">!      *             {@code -1} if there is no more data because the end of</span>
       *             the stream has been reached.
<span class="line-modified">!      * @throws     NullPointerException If {@code b} is {@code null}.</span>
<span class="line-modified">!      * @throws     IndexOutOfBoundsException If {@code off} is negative,</span>
<span class="line-modified">!      *             {@code len} is negative, or {@code len} is greater than</span>
<span class="line-modified">!      *             {@code b.length - off}</span>
<span class="line-modified">!      * @throws     IOException if the pipe is &lt;a href=&quot;#BROKEN&quot;&gt; {@code broken}&lt;/a&gt;,</span>
       *           {@link #connect(java.io.PipedOutputStream) unconnected},
       *           closed, or if an I/O error occurs.
       */
      public synchronized int read(byte b[], int off, int len)  throws IOException {
          if (b == null) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 416,14 ***</span>
       *
       * @return the number of bytes that can be read from this input stream
       *         without blocking, or {@code 0} if this input stream has been
       *         closed by invoking its {@link #close()} method, or if the pipe
       *         is {@link #connect(java.io.PipedOutputStream) unconnected}, or
<span class="line-modified">!      *          &lt;a href=&quot;#BROKEN&quot;&gt; &lt;code&gt;broken&lt;/code&gt;&lt;/a&gt;.</span>
       *
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
<span class="line-modified">!      * @since   1.0.2</span>
       */
      public synchronized int available() throws IOException {
          if(in &lt; 0)
              return 0;
          else if(in == out)
<span class="line-new-header">--- 416,14 ---</span>
       *
       * @return the number of bytes that can be read from this input stream
       *         without blocking, or {@code 0} if this input stream has been
       *         closed by invoking its {@link #close()} method, or if the pipe
       *         is {@link #connect(java.io.PipedOutputStream) unconnected}, or
<span class="line-modified">!      *         &lt;a href=&quot;#BROKEN&quot;&gt; {@code broken}&lt;/a&gt;.</span>
       *
<span class="line-modified">!      * @throws IOException  if an I/O error occurs.</span>
<span class="line-modified">!      * @since  1.0.2</span>
       */
      public synchronized int available() throws IOException {
          if(in &lt; 0)
              return 0;
          else if(in == out)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 436,11 ***</span>
  
      /**
       * Closes this piped input stream and releases any system resources
       * associated with the stream.
       *
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
       */
      public void close()  throws IOException {
          closedByReader = true;
          synchronized (this) {
              in = -1;
<span class="line-new-header">--- 436,11 ---</span>
  
      /**
       * Closes this piped input stream and releases any system resources
       * associated with the stream.
       *
<span class="line-modified">!      * @throws     IOException  if an I/O error occurs.</span>
       */
      public void close()  throws IOException {
          closedByReader = true;
          synchronized (this) {
              in = -1;
</pre>
<center><a href="OutputStreamWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="PipedOutputStream.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>