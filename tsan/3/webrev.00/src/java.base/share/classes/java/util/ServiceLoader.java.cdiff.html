<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/util/ServiceLoader.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="ServiceConfigurationError.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Set.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/ServiceLoader.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 43,21 ***</span>
  import java.util.function.Consumer;
  import java.util.function.Supplier;
  import java.util.stream.Stream;
  import java.util.stream.StreamSupport;
  
  import jdk.internal.loader.BootLoader;
  import jdk.internal.loader.ClassLoaders;
  import jdk.internal.access.JavaLangAccess;
  import jdk.internal.access.SharedSecrets;
  import jdk.internal.misc.VM;
  import jdk.internal.module.ServicesCatalog;
  import jdk.internal.module.ServicesCatalog.ServiceProvider;
  import jdk.internal.reflect.CallerSensitive;
  import jdk.internal.reflect.Reflection;
  
<span class="line-removed">- </span>
  /**
   * A facility to load implementations of a service.
   *
   * &lt;p&gt; A &lt;i&gt;service&lt;/i&gt; is a well-known interface or class for which zero, one,
   * or many service providers exist. A &lt;i&gt;service provider&lt;/i&gt; (or just
<span class="line-new-header">--- 43,22 ---</span>
  import java.util.function.Consumer;
  import java.util.function.Supplier;
  import java.util.stream.Stream;
  import java.util.stream.StreamSupport;
  
<span class="line-added">+ import sun.nio.cs.UTF_8;</span>
<span class="line-added">+ </span>
  import jdk.internal.loader.BootLoader;
  import jdk.internal.loader.ClassLoaders;
  import jdk.internal.access.JavaLangAccess;
  import jdk.internal.access.SharedSecrets;
  import jdk.internal.misc.VM;
  import jdk.internal.module.ServicesCatalog;
  import jdk.internal.module.ServicesCatalog.ServiceProvider;
  import jdk.internal.reflect.CallerSensitive;
  import jdk.internal.reflect.Reflection;
  
  /**
   * A facility to load implementations of a service.
   *
   * &lt;p&gt; A &lt;i&gt;service&lt;/i&gt; is a well-known interface or class for which zero, one,
   * or many service providers exist. A &lt;i&gt;service provider&lt;/i&gt; (or just
</pre>
<hr />
<pre>
<span class="line-old-header">*** 67,11 ***</span>
   * application&#39;s choosing. Application code refers only to the service, not to
   * service providers, and is assumed to be capable of choosing between multiple
   * service providers (based on the functionality they expose through the service),
   * and handling the possibility that no service providers are located.
   *
<span class="line-modified">!  * &lt;h3&gt; Obtaining a service loader &lt;/h3&gt;</span>
   *
   * &lt;p&gt; An application obtains a service loader for a given service by invoking
   * one of the static {@code load} methods of {@code ServiceLoader}. If the
   * application is a module, then its module declaration must have a &lt;i&gt;uses&lt;/i&gt;
   * directive that specifies the service; this helps to locate providers and ensure
<span class="line-new-header">--- 68,11 ---</span>
   * application&#39;s choosing. Application code refers only to the service, not to
   * service providers, and is assumed to be capable of choosing between multiple
   * service providers (based on the functionality they expose through the service),
   * and handling the possibility that no service providers are located.
   *
<span class="line-modified">!  * &lt;h2&gt; Obtaining a service loader &lt;/h2&gt;</span>
   *
   * &lt;p&gt; An application obtains a service loader for a given service by invoking
   * one of the static {@code load} methods of {@code ServiceLoader}. If the
   * application is a module, then its module declaration must have a &lt;i&gt;uses&lt;/i&gt;
   * directive that specifies the service; this helps to locate providers and ensure
</pre>
<hr />
<pre>
<span class="line-old-header">*** 139,11 ***</span>
   *   &lt;li&gt; A stream of {@code Provider&lt;CodecFactory&gt;} objects &lt;/li&gt;
   *   &lt;li&gt; {@code p.type()} yields a {@code Class&lt;CodecFactory&gt;} &lt;/li&gt;
   *   &lt;li&gt; {@code get()} yields an instance of {@code CodecFactory} &lt;/li&gt;
   * &lt;/ol&gt;
   *
<span class="line-modified">!  * &lt;h3&gt; Designing services &lt;/h3&gt;</span>
   *
   * &lt;p&gt; A service is a single type, usually an interface or abstract class. A
   * concrete class can be used, but this is not recommended. The type may have
   * any accessibility. The methods of a service are highly domain-specific, so
   * this API specification cannot give concrete advice about their form or
<span class="line-new-header">--- 140,11 ---</span>
   *   &lt;li&gt; A stream of {@code Provider&lt;CodecFactory&gt;} objects &lt;/li&gt;
   *   &lt;li&gt; {@code p.type()} yields a {@code Class&lt;CodecFactory&gt;} &lt;/li&gt;
   *   &lt;li&gt; {@code get()} yields an instance of {@code CodecFactory} &lt;/li&gt;
   * &lt;/ol&gt;
   *
<span class="line-modified">!  * &lt;h2&gt; Designing services &lt;/h2&gt;</span>
   *
   * &lt;p&gt; A service is a single type, usually an interface or abstract class. A
   * concrete class can be used, but this is not recommended. The type may have
   * any accessibility. The methods of a service are highly domain-specific, so
   * this API specification cannot give concrete advice about their form or
</pre>
<hr />
<pre>
<span class="line-old-header">*** 165,11 ***</span>
   *   expresses through its name that its service providers are factories
   *   for codecs, rather than codecs themselves, because it may be expensive
   *   or complicated to produce certain codecs. &lt;/p&gt;&lt;/li&gt;
   * &lt;/ol&gt;
   *
<span class="line-modified">!  * &lt;h3&gt; &lt;a id=&quot;developing-service-providers&quot;&gt;Developing service providers&lt;/a&gt; &lt;/h3&gt;</span>
   *
   * &lt;p&gt; A service provider is a single type, usually a concrete class. An
   * interface or abstract class is permitted because it may declare a static
   * provider method, discussed later. The type must be public and must not be
   * an inner class.
<span class="line-new-header">--- 166,11 ---</span>
   *   expresses through its name that its service providers are factories
   *   for codecs, rather than codecs themselves, because it may be expensive
   *   or complicated to produce certain codecs. &lt;/p&gt;&lt;/li&gt;
   * &lt;/ol&gt;
   *
<span class="line-modified">!  * &lt;h2&gt; &lt;a id=&quot;developing-service-providers&quot;&gt;Developing service providers&lt;/a&gt; &lt;/h2&gt;</span>
   *
   * &lt;p&gt; A service provider is a single type, usually a concrete class. An
   * interface or abstract class is permitted because it may declare a static
   * provider method, discussed later. The type must be public and must not be
   * an inner class.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 186,11 ***</span>
   * packaged as JAR files. The application instantiates service providers via
   * the service loader&#39;s iterator, or via {@link Provider Provider} objects in
   * the service loader&#39;s stream, without knowledge of the service providers&#39;
   * locations.
   *
<span class="line-modified">!  * &lt;h3&gt; Deploying service providers as modules &lt;/h3&gt;</span>
   *
   * &lt;p&gt; A service provider that is developed in a module must be specified in a
   * &lt;i&gt;provides&lt;/i&gt; directive in the module declaration. The provides directive
   * specifies both the service and the service provider; this helps to locate the
   * provider when another module, with a &lt;i&gt;uses&lt;/i&gt; directive for the service,
<span class="line-new-header">--- 187,11 ---</span>
   * packaged as JAR files. The application instantiates service providers via
   * the service loader&#39;s iterator, or via {@link Provider Provider} objects in
   * the service loader&#39;s stream, without knowledge of the service providers&#39;
   * locations.
   *
<span class="line-modified">!  * &lt;h2&gt; Deploying service providers as modules &lt;/h2&gt;</span>
   *
   * &lt;p&gt; A service provider that is developed in a module must be specified in a
   * &lt;i&gt;provides&lt;/i&gt; directive in the module declaration. The provides directive
   * specifies both the service and the service provider; this helps to locate the
   * provider when another module, with a &lt;i&gt;uses&lt;/i&gt; directive for the service,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 251,11 ***</span>
   * its {@code provider} method. The requirement that the provider constructor or
   * provider method is public helps to document the intent that the class (that is,
   * the service provider) will be instantiated by an entity (that is, a service
   * loader) which is outside the class&#39;s package.
   *
<span class="line-modified">!  * &lt;h3&gt; Deploying service providers on the class path &lt;/h3&gt;</span>
   *
   * A service provider that is packaged as a JAR file for the class path is
   * identified by placing a &lt;i&gt;provider-configuration file&lt;/i&gt; in the resource
   * directory {@code META-INF/services}. The name of the provider-configuration
   * file is the fully qualified binary name of the service. The provider-configuration
<span class="line-new-header">--- 252,11 ---</span>
   * its {@code provider} method. The requirement that the provider constructor or
   * provider method is public helps to document the intent that the class (that is,
   * the service provider) will be instantiated by an entity (that is, a service
   * loader) which is outside the class&#39;s package.
   *
<span class="line-modified">!  * &lt;h2&gt; Deploying service providers on the class path &lt;/h2&gt;</span>
   *
   * A service provider that is packaged as a JAR file for the class path is
   * identified by placing a &lt;i&gt;provider-configuration file&lt;/i&gt; in the resource
   * directory {@code META-INF/services}. The name of the provider-configuration
   * file is the fully qualified binary name of the service. The provider-configuration
</pre>
<hr />
<pre>
<span class="line-old-header">*** 291,11 ***</span>
   * different JAR file. The service provider must be visible from the class loader
   * that is initially queried to locate the provider-configuration file; this is
   * not necessarily the class loader which ultimately locates the
   * provider-configuration file.
   *
<span class="line-modified">!  * &lt;h3&gt; Timing of provider discovery &lt;/h3&gt;</span>
   *
   * &lt;p&gt; Service providers are loaded and instantiated lazily, that is, on demand.
   * A service loader maintains a cache of the providers that have been loaded so
   * far. Each invocation of the {@code iterator} method returns an {@code Iterator}
   * that first yields all of the elements cached from previous iteration, in
<span class="line-new-header">--- 292,11 ---</span>
   * different JAR file. The service provider must be visible from the class loader
   * that is initially queried to locate the provider-configuration file; this is
   * not necessarily the class loader which ultimately locates the
   * provider-configuration file.
   *
<span class="line-modified">!  * &lt;h2&gt; Timing of provider discovery &lt;/h2&gt;</span>
   *
   * &lt;p&gt; Service providers are loaded and instantiated lazily, that is, on demand.
   * A service loader maintains a cache of the providers that have been loaded so
   * far. Each invocation of the {@code iterator} method returns an {@code Iterator}
   * that first yields all of the elements cached from previous iteration, in
</pre>
<hr />
<pre>
<span class="line-old-header">*** 304,11 ***</span>
   * of the stream method returns a {@code Stream} that first processes all
   * providers loaded by previous stream operations, in load order, and then lazily
   * locates any remaining providers. Caches are cleared via the {@link #reload
   * reload} method.
   *
<span class="line-modified">!  * &lt;h3&gt; &lt;a id=&quot;errors&quot;&gt;Errors&lt;/a&gt; &lt;/h3&gt;</span>
   *
   * &lt;p&gt; When using the service loader&#39;s {@code iterator}, the {@link
   * Iterator#hasNext() hasNext} and {@link Iterator#next() next} methods will
   * fail with {@link ServiceConfigurationError} if an error occurs locating,
   * loading or instantiating a service provider. When processing the service
<span class="line-new-header">--- 305,11 ---</span>
   * of the stream method returns a {@code Stream} that first processes all
   * providers loaded by previous stream operations, in load order, and then lazily
   * locates any remaining providers. Caches are cleared via the {@link #reload
   * reload} method.
   *
<span class="line-modified">!  * &lt;h2&gt; &lt;a id=&quot;errors&quot;&gt;Errors&lt;/a&gt; &lt;/h2&gt;</span>
   *
   * &lt;p&gt; When using the service loader&#39;s {@code iterator}, the {@link
   * Iterator#hasNext() hasNext} and {@link Iterator#next() next} methods will
   * fail with {@link ServiceConfigurationError} if an error occurs locating,
   * loading or instantiating a service provider. When processing the service
</pre>
<hr />
<pre>
<span class="line-old-header">*** 359,20 ***</span>
   *   class, or does not define a provider constructor, or cannot be
   *   instantiated. &lt;/li&gt;
   *
   * &lt;/ul&gt;
   *
<span class="line-modified">!  * &lt;h3&gt; Security &lt;/h3&gt;</span>
   *
   * &lt;p&gt; Service loaders always execute in the security context of the caller
   * of the iterator or stream methods and may also be restricted by the security
   * context of the caller that created the service loader.
   * Trusted system code should typically invoke the methods in this class, and
   * the methods of the iterators which they return, from within a privileged
   * security context.
   *
<span class="line-modified">!  * &lt;h3&gt; Concurrency &lt;/h3&gt;</span>
   *
   * &lt;p&gt; Instances of this class are not safe for use by multiple concurrent
   * threads.
   *
   * &lt;h3&gt; Null handling &lt;/h3&gt;
<span class="line-new-header">--- 360,20 ---</span>
   *   class, or does not define a provider constructor, or cannot be
   *   instantiated. &lt;/li&gt;
   *
   * &lt;/ul&gt;
   *
<span class="line-modified">!  * &lt;h2&gt; Security &lt;/h2&gt;</span>
   *
   * &lt;p&gt; Service loaders always execute in the security context of the caller
   * of the iterator or stream methods and may also be restricted by the security
   * context of the caller that created the service loader.
   * Trusted system code should typically invoke the methods in this class, and
   * the methods of the iterators which they return, from within a privileged
   * security context.
   *
<span class="line-modified">!  * &lt;h2&gt; Concurrency &lt;/h2&gt;</span>
   *
   * &lt;p&gt; Instances of this class are not safe for use by multiple concurrent
   * threads.
   *
   * &lt;h3&gt; Null handling &lt;/h3&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1162,11 ***</span>
              try {
                  URLConnection uc = u.openConnection();
                  uc.setUseCaches(false);
                  try (InputStream in = uc.getInputStream();
                       BufferedReader r
<span class="line-modified">!                          = new BufferedReader(new InputStreamReader(in, &quot;utf-8&quot;)))</span>
                  {
                      int lc = 1;
                      while ((lc = parseLine(u, r, lc, names)) &gt;= 0);
                  }
              } catch (IOException x) {
<span class="line-new-header">--- 1163,11 ---</span>
              try {
                  URLConnection uc = u.openConnection();
                  uc.setUseCaches(false);
                  try (InputStream in = uc.getInputStream();
                       BufferedReader r
<span class="line-modified">!                          = new BufferedReader(new InputStreamReader(in, UTF_8.INSTANCE)))</span>
                  {
                      int lc = 1;
                      while ((lc = parseLine(u, r, lc, names)) &gt;= 0);
                  }
              } catch (IOException x) {
</pre>
<center><a href="ServiceConfigurationError.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Set.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>