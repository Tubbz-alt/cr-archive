<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/security/SignatureSpi.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="SignatureException.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SignedObject.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/security/SignatureSpi.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 62,24 ***</span>
       * public key for verification operations.
       *
       * @param publicKey the public key of the identity whose signature is
       * going to be verified.
       *
<span class="line-modified">!      * @exception InvalidKeyException if the key is improperly</span>
       * encoded, parameters are missing, and so on.
       */
      protected abstract void engineInitVerify(PublicKey publicKey)
          throws InvalidKeyException;
  
      /**
       * Initializes this signature object with the specified
       * private key for signing operations.
       *
       * @param privateKey the private key of the identity whose signature
       * will be generated.
       *
<span class="line-modified">!      * @exception InvalidKeyException if the key is improperly</span>
       * encoded, parameters are missing, and so on.
       */
      protected abstract void engineInitSign(PrivateKey privateKey)
          throws InvalidKeyException;
  
<span class="line-new-header">--- 62,51 ---</span>
       * public key for verification operations.
       *
       * @param publicKey the public key of the identity whose signature is
       * going to be verified.
       *
<span class="line-modified">!      * @throws    InvalidKeyException if the key is improperly</span>
       * encoded, parameters are missing, and so on.
       */
      protected abstract void engineInitVerify(PublicKey publicKey)
          throws InvalidKeyException;
  
<span class="line-added">+     /**</span>
<span class="line-added">+      * Initializes this signature object with the specified</span>
<span class="line-added">+      * public key for verification operations.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @param publicKey the public key of the identity whose signature is</span>
<span class="line-added">+      * going to be verified.</span>
<span class="line-added">+      * @param params the parameters for generating this signature</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @throws    InvalidKeyException if the key is improperly</span>
<span class="line-added">+      * encoded, does not work with the given parameters, and so on.</span>
<span class="line-added">+      * @throws    InvalidAlgorithmParameterException if the given parameters</span>
<span class="line-added">+      * is invalid.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     void engineInitVerify(PublicKey publicKey,</span>
<span class="line-added">+             AlgorithmParameterSpec params)</span>
<span class="line-added">+             throws InvalidKeyException, InvalidAlgorithmParameterException {</span>
<span class="line-added">+         if (params != null) {</span>
<span class="line-added">+             try {</span>
<span class="line-added">+                 engineSetParameter(params);</span>
<span class="line-added">+             } catch (UnsupportedOperationException usoe) {</span>
<span class="line-added">+                 // error out if not overrridden</span>
<span class="line-added">+                 throw new InvalidAlgorithmParameterException(usoe);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+         engineInitVerify(publicKey);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      /**
       * Initializes this signature object with the specified
       * private key for signing operations.
       *
       * @param privateKey the private key of the identity whose signature
       * will be generated.
       *
<span class="line-modified">!      * @throws    InvalidKeyException if the key is improperly</span>
       * encoded, parameters are missing, and so on.
       */
      protected abstract void engineInitSign(PrivateKey privateKey)
          throws InvalidKeyException;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 92,27 ***</span>
       *
       * @param privateKey the private key of the identity whose signature
       * will be generated.
       * @param random the source of randomness
       *
<span class="line-modified">!      * @exception InvalidKeyException if the key is improperly</span>
       * encoded, parameters are missing, and so on.
       */
      protected void engineInitSign(PrivateKey privateKey,
<span class="line-modified">!                                   SecureRandom random)</span>
<span class="line-modified">!         throws InvalidKeyException {</span>
<span class="line-modified">!             this.appRandom = random;</span>
<span class="line-modified">!             engineInitSign(privateKey);</span>
      }
  
      /**
       * Updates the data to be signed or verified
       * using the specified byte.
       *
       * @param b the byte to use for the update.
       *
<span class="line-modified">!      * @exception SignatureException if the engine is not initialized</span>
       * properly.
       */
      protected abstract void engineUpdate(byte b) throws SignatureException;
  
      /**
<span class="line-new-header">--- 119,58 ---</span>
       *
       * @param privateKey the private key of the identity whose signature
       * will be generated.
       * @param random the source of randomness
       *
<span class="line-modified">!      * @throws    InvalidKeyException if the key is improperly</span>
       * encoded, parameters are missing, and so on.
       */
      protected void engineInitSign(PrivateKey privateKey,
<span class="line-modified">!             SecureRandom random)</span>
<span class="line-modified">!             throws InvalidKeyException {</span>
<span class="line-modified">!         this.appRandom = random;</span>
<span class="line-modified">!         engineInitSign(privateKey);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Initializes this signature object with the specified</span>
<span class="line-added">+      * private key and source of randomness for signing operations.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * &lt;p&gt;This concrete method has been added to this previously-defined</span>
<span class="line-added">+      * abstract class. (For backwards compatibility, it cannot be abstract.)</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @param privateKey the private key of the identity whose signature</span>
<span class="line-added">+      * will be generated.</span>
<span class="line-added">+      * @param params the parameters for generating this signature</span>
<span class="line-added">+      * @param random the source of randomness</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @throws    InvalidKeyException if the key is improperly</span>
<span class="line-added">+      * encoded, parameters are missing, and so on.</span>
<span class="line-added">+      * @throws    InvalidAlgorithmParameterException if the parameters is</span>
<span class="line-added">+      * invalid.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     void engineInitSign(PrivateKey privateKey,</span>
<span class="line-added">+             AlgorithmParameterSpec params, SecureRandom random)</span>
<span class="line-added">+             throws InvalidKeyException, InvalidAlgorithmParameterException {</span>
<span class="line-added">+         if (params != null) {</span>
<span class="line-added">+             try {</span>
<span class="line-added">+                 engineSetParameter(params);</span>
<span class="line-added">+             } catch (UnsupportedOperationException usoe) {</span>
<span class="line-added">+                 // error out if not overrridden</span>
<span class="line-added">+                 throw new InvalidAlgorithmParameterException(usoe);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+         engineInitSign(privateKey, random);</span>
      }
  
      /**
       * Updates the data to be signed or verified
       * using the specified byte.
       *
       * @param b the byte to use for the update.
       *
<span class="line-modified">!      * @throws    SignatureException if the engine is not initialized</span>
       * properly.
       */
      protected abstract void engineUpdate(byte b) throws SignatureException;
  
      /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 121,15 ***</span>
       *
       * @param b the array of bytes
       * @param off the offset to start from in the array of bytes
       * @param len the number of bytes to use, starting at offset
       *
<span class="line-modified">!      * @exception SignatureException if the engine is not initialized</span>
       * properly
       */
      protected abstract void engineUpdate(byte[] b, int off, int len)
<span class="line-modified">!         throws SignatureException;</span>
  
      /**
       * Updates the data to be signed or verified using the specified
       * ByteBuffer. Processes the {@code data.remaining()} bytes
       * starting at {@code data.position()}.
<span class="line-new-header">--- 179,15 ---</span>
       *
       * @param b the array of bytes
       * @param off the offset to start from in the array of bytes
       * @param len the number of bytes to use, starting at offset
       *
<span class="line-modified">!      * @throws    SignatureException if the engine is not initialized</span>
       * properly
       */
      protected abstract void engineUpdate(byte[] b, int off, int len)
<span class="line-modified">!             throws SignatureException;</span>
  
      /**
       * Updates the data to be signed or verified using the specified
       * ByteBuffer. Processes the {@code data.remaining()} bytes
       * starting at {@code data.position()}.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 174,11 ***</span>
       * The format of the signature depends on the underlying
       * signature scheme.
       *
       * @return the signature bytes of the signing operation&#39;s result.
       *
<span class="line-modified">!      * @exception SignatureException if the engine is not</span>
       * initialized properly or if this signature algorithm is unable to
       * process the input data provided.
       */
      protected abstract byte[] engineSign() throws SignatureException;
  
<span class="line-new-header">--- 232,11 ---</span>
       * The format of the signature depends on the underlying
       * signature scheme.
       *
       * @return the signature bytes of the signing operation&#39;s result.
       *
<span class="line-modified">!      * @throws    SignatureException if the engine is not</span>
       * initialized properly or if this signature algorithm is unable to
       * process the input data provided.
       */
      protected abstract byte[] engineSign() throws SignatureException;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 213,19 ***</span>
       * This parameter is ignored if its value is greater than or equal to
       * the actual signature length.
       *
       * @return the number of bytes placed into {@code outbuf}
       *
<span class="line-modified">!      * @exception SignatureException if the engine is not</span>
       * initialized properly, if this signature algorithm is unable to
       * process the input data provided, or if {@code len} is less
       * than the actual signature length.
       *
       * @since 1.2
       */
      protected int engineSign(byte[] outbuf, int offset, int len)
<span class="line-modified">!                         throws SignatureException {</span>
          byte[] sig = engineSign();
          if (len &lt; sig.length) {
                  throw new SignatureException
                      (&quot;partial signatures not returned&quot;);
          }
<span class="line-new-header">--- 271,19 ---</span>
       * This parameter is ignored if its value is greater than or equal to
       * the actual signature length.
       *
       * @return the number of bytes placed into {@code outbuf}
       *
<span class="line-modified">!      * @throws    SignatureException if the engine is not</span>
       * initialized properly, if this signature algorithm is unable to
       * process the input data provided, or if {@code len} is less
       * than the actual signature length.
       *
       * @since 1.2
       */
      protected int engineSign(byte[] outbuf, int offset, int len)
<span class="line-modified">!              throws SignatureException {</span>
          byte[] sig = engineSign();
          if (len &lt; sig.length) {
                  throw new SignatureException
                      (&quot;partial signatures not returned&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 243,17 ***</span>
       *
       * @param sigBytes the signature bytes to be verified.
       *
       * @return true if the signature was verified, false if not.
       *
<span class="line-modified">!      * @exception SignatureException if the engine is not</span>
       * initialized properly, the passed-in signature is improperly
       * encoded or of the wrong type, if this signature algorithm is unable to
       * process the input data provided, etc.
       */
      protected abstract boolean engineVerify(byte[] sigBytes)
<span class="line-modified">!         throws SignatureException;</span>
  
      /**
       * Verifies the passed-in signature in the specified array
       * of bytes, starting at the specified offset.
       *
<span class="line-new-header">--- 301,17 ---</span>
       *
       * @param sigBytes the signature bytes to be verified.
       *
       * @return true if the signature was verified, false if not.
       *
<span class="line-modified">!      * @throws    SignatureException if the engine is not</span>
       * initialized properly, the passed-in signature is improperly
       * encoded or of the wrong type, if this signature algorithm is unable to
       * process the input data provided, etc.
       */
      protected abstract boolean engineVerify(byte[] sigBytes)
<span class="line-modified">!             throws SignatureException;</span>
  
      /**
       * Verifies the passed-in signature in the specified array
       * of bytes, starting at the specified offset.
       *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 264,18 ***</span>
       * @param offset the offset to start from in the array of bytes.
       * @param length the number of bytes to use, starting at offset.
       *
       * @return true if the signature was verified, false if not.
       *
<span class="line-modified">!      * @exception SignatureException if the engine is not</span>
       * initialized properly, the passed-in signature is improperly
       * encoded or of the wrong type, if this signature algorithm is unable to
       * process the input data provided, etc.
       * @since 1.4
       */
      protected boolean engineVerify(byte[] sigBytes, int offset, int length)
<span class="line-modified">!         throws SignatureException {</span>
          byte[] sigBytesCopy = new byte[length];
          System.arraycopy(sigBytes, offset, sigBytesCopy, 0, length);
          return engineVerify(sigBytesCopy);
      }
  
<span class="line-new-header">--- 322,18 ---</span>
       * @param offset the offset to start from in the array of bytes.
       * @param length the number of bytes to use, starting at offset.
       *
       * @return true if the signature was verified, false if not.
       *
<span class="line-modified">!      * @throws    SignatureException if the engine is not</span>
       * initialized properly, the passed-in signature is improperly
       * encoded or of the wrong type, if this signature algorithm is unable to
       * process the input data provided, etc.
       * @since 1.4
       */
      protected boolean engineVerify(byte[] sigBytes, int offset, int length)
<span class="line-modified">!             throws SignatureException {</span>
          byte[] sigBytesCopy = new byte[length];
          System.arraycopy(sigBytes, offset, sigBytesCopy, 0, length);
          return engineVerify(sigBytesCopy);
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 292,39 ***</span>
       *
       * @param param the string identifier of the parameter.
       *
       * @param value the parameter value.
       *
<span class="line-modified">!      * @exception InvalidParameterException if {@code param} is an</span>
       * invalid parameter for this signature algorithm engine,
       * the parameter is already set
       * and cannot be set again, a security exception occurs, and so on.
       *
       * @deprecated Replaced by {@link
       * #engineSetParameter(java.security.spec.AlgorithmParameterSpec)
       * engineSetParameter}.
       */
      @Deprecated
      protected abstract void engineSetParameter(String param, Object value)
<span class="line-modified">!         throws InvalidParameterException;</span>
  
      /**
       * &lt;p&gt;This method is overridden by providers to initialize
       * this signature engine with the specified parameter set.
       *
       * @param params the parameters
       *
<span class="line-modified">!      * @exception UnsupportedOperationException if this method is not</span>
       * overridden by a provider
       *
<span class="line-modified">!      * @exception InvalidAlgorithmParameterException if this method is</span>
       * overridden by a provider and the given parameters
       * are inappropriate for this signature engine
       */
      protected void engineSetParameter(AlgorithmParameterSpec params)
<span class="line-modified">!         throws InvalidAlgorithmParameterException {</span>
<span class="line-modified">!             throw new UnsupportedOperationException();</span>
      }
  
      /**
       * &lt;p&gt;This method is overridden by providers to return the parameters
       * used with this signature engine.
<span class="line-new-header">--- 350,39 ---</span>
       *
       * @param param the string identifier of the parameter.
       *
       * @param value the parameter value.
       *
<span class="line-modified">!      * @throws    InvalidParameterException if {@code param} is an</span>
       * invalid parameter for this signature algorithm engine,
       * the parameter is already set
       * and cannot be set again, a security exception occurs, and so on.
       *
       * @deprecated Replaced by {@link
       * #engineSetParameter(java.security.spec.AlgorithmParameterSpec)
       * engineSetParameter}.
       */
      @Deprecated
      protected abstract void engineSetParameter(String param, Object value)
<span class="line-modified">!             throws InvalidParameterException;</span>
  
      /**
       * &lt;p&gt;This method is overridden by providers to initialize
       * this signature engine with the specified parameter set.
       *
       * @param params the parameters
       *
<span class="line-modified">!      * @throws    UnsupportedOperationException if this method is not</span>
       * overridden by a provider
       *
<span class="line-modified">!      * @throws    InvalidAlgorithmParameterException if this method is</span>
       * overridden by a provider and the given parameters
       * are inappropriate for this signature engine
       */
      protected void engineSetParameter(AlgorithmParameterSpec params)
<span class="line-modified">!             throws InvalidAlgorithmParameterException {</span>
<span class="line-modified">!         throw new UnsupportedOperationException();</span>
      }
  
      /**
       * &lt;p&gt;This method is overridden by providers to return the parameters
       * used with this signature engine.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 337,11 ***</span>
       * signature implementation supports it and can successfully generate
       * them. Otherwise, {@code null} is returned.
       *
       * @return the parameters used with this signature engine, or {@code null}
       *
<span class="line-modified">!      * @exception UnsupportedOperationException if this method is</span>
       * not overridden by a provider
       * @since 1.4
       */
      protected AlgorithmParameters engineGetParameters() {
          throw new UnsupportedOperationException();
<span class="line-new-header">--- 395,11 ---</span>
       * signature implementation supports it and can successfully generate
       * them. Otherwise, {@code null} is returned.
       *
       * @return the parameters used with this signature engine, or {@code null}
       *
<span class="line-modified">!      * @throws    UnsupportedOperationException if this method is</span>
       * not overridden by a provider
       * @since 1.4
       */
      protected AlgorithmParameters engineGetParameters() {
          throw new UnsupportedOperationException();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 361,11 ***</span>
       * @param param the string name of the parameter.
       *
       * @return the object that represents the parameter value, or {@code null} if
       * there is none.
       *
<span class="line-modified">!      * @exception InvalidParameterException if {@code param} is an</span>
       * invalid parameter for this engine, or another exception occurs while
       * trying to get this parameter.
       *
       * @deprecated
       */
<span class="line-new-header">--- 419,11 ---</span>
       * @param param the string name of the parameter.
       *
       * @return the object that represents the parameter value, or {@code null} if
       * there is none.
       *
<span class="line-modified">!      * @throws    InvalidParameterException if {@code param} is an</span>
       * invalid parameter for this engine, or another exception occurs while
       * trying to get this parameter.
       *
       * @deprecated
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 376,11 ***</span>
      /**
       * Returns a clone if the implementation is cloneable.
       *
       * @return a clone if the implementation is cloneable.
       *
<span class="line-modified">!      * @exception CloneNotSupportedException if this is called</span>
       * on an implementation that does not support {@code Cloneable}.
       */
      public Object clone() throws CloneNotSupportedException {
          if (this instanceof Cloneable) {
              return super.clone();
<span class="line-new-header">--- 434,11 ---</span>
      /**
       * Returns a clone if the implementation is cloneable.
       *
       * @return a clone if the implementation is cloneable.
       *
<span class="line-modified">!      * @throws    CloneNotSupportedException if this is called</span>
       * on an implementation that does not support {@code Cloneable}.
       */
      public Object clone() throws CloneNotSupportedException {
          if (this instanceof Cloneable) {
              return super.clone();
</pre>
<center><a href="SignatureException.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="SignedObject.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>