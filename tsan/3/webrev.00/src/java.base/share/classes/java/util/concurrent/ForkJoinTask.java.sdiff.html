<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/util/concurrent/ForkJoinTask.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ForkJoinPool.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="LinkedBlockingDeque.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/util/concurrent/ForkJoinTask.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1357      * equal to {@code expect} and was changed to {@code update}.
1358      * @since 1.8
1359      */
1360     public final boolean compareAndSetForkJoinTaskTag(short expect, short update) {
1361         for (int s;;) {
1362             if ((short)(s = status) != expect)
1363                 return false;
1364             if (STATUS.weakCompareAndSet(this, s,
1365                                          (s &amp; ~SMASK) | (update &amp; SMASK)))
1366                 return true;
1367         }
1368     }
1369 
1370     /**
1371      * Adapter for Runnables. This implements RunnableFuture
1372      * to be compliant with AbstractExecutorService constraints
1373      * when used in ForkJoinPool.
1374      */
1375     static final class AdaptedRunnable&lt;T&gt; extends ForkJoinTask&lt;T&gt;
1376         implements RunnableFuture&lt;T&gt; {

1377         final Runnable runnable;

1378         T result;
1379         AdaptedRunnable(Runnable runnable, T result) {
1380             if (runnable == null) throw new NullPointerException();
1381             this.runnable = runnable;
1382             this.result = result; // OK to set this even before completion
1383         }
1384         public final T getRawResult() { return result; }
1385         public final void setRawResult(T v) { result = v; }
1386         public final boolean exec() { runnable.run(); return true; }
1387         public final void run() { invoke(); }
1388         public String toString() {
1389             return super.toString() + &quot;[Wrapped task = &quot; + runnable + &quot;]&quot;;
1390         }
1391         private static final long serialVersionUID = 5232453952276885070L;
1392     }
1393 
1394     /**
1395      * Adapter for Runnables without results.
1396      */
1397     static final class AdaptedRunnableAction extends ForkJoinTask&lt;Void&gt;
1398         implements RunnableFuture&lt;Void&gt; {

1399         final Runnable runnable;
1400         AdaptedRunnableAction(Runnable runnable) {
1401             if (runnable == null) throw new NullPointerException();
1402             this.runnable = runnable;
1403         }
1404         public final Void getRawResult() { return null; }
1405         public final void setRawResult(Void v) { }
1406         public final boolean exec() { runnable.run(); return true; }
1407         public final void run() { invoke(); }
1408         public String toString() {
1409             return super.toString() + &quot;[Wrapped task = &quot; + runnable + &quot;]&quot;;
1410         }
1411         private static final long serialVersionUID = 5232453952276885070L;
1412     }
1413 
1414     /**
1415      * Adapter for Runnables in which failure forces worker exception.
1416      */
1417     static final class RunnableExecuteAction extends ForkJoinTask&lt;Void&gt; {

1418         final Runnable runnable;
1419         RunnableExecuteAction(Runnable runnable) {
1420             if (runnable == null) throw new NullPointerException();
1421             this.runnable = runnable;
1422         }
1423         public final Void getRawResult() { return null; }
1424         public final void setRawResult(Void v) { }
1425         public final boolean exec() { runnable.run(); return true; }
1426         void internalPropagateException(Throwable ex) {
1427             rethrow(ex); // rethrow outside exec() catches.
1428         }
1429         private static final long serialVersionUID = 5232453952276885070L;
1430     }
1431 
1432     /**
1433      * Adapter for Callables.
1434      */
1435     static final class AdaptedCallable&lt;T&gt; extends ForkJoinTask&lt;T&gt;
1436         implements RunnableFuture&lt;T&gt; {

1437         final Callable&lt;? extends T&gt; callable;

1438         T result;
1439         AdaptedCallable(Callable&lt;? extends T&gt; callable) {
1440             if (callable == null) throw new NullPointerException();
1441             this.callable = callable;
1442         }
1443         public final T getRawResult() { return result; }
1444         public final void setRawResult(T v) { result = v; }
1445         public final boolean exec() {
1446             try {
1447                 result = callable.call();
1448                 return true;
1449             } catch (RuntimeException rex) {
1450                 throw rex;
1451             } catch (Exception ex) {
1452                 throw new RuntimeException(ex);
1453             }
1454         }
1455         public final void run() { invoke(); }
1456         public String toString() {
1457             return super.toString() + &quot;[Wrapped task = &quot; + callable + &quot;]&quot;;
</pre>
</td>
<td>
<hr />
<pre>
1357      * equal to {@code expect} and was changed to {@code update}.
1358      * @since 1.8
1359      */
1360     public final boolean compareAndSetForkJoinTaskTag(short expect, short update) {
1361         for (int s;;) {
1362             if ((short)(s = status) != expect)
1363                 return false;
1364             if (STATUS.weakCompareAndSet(this, s,
1365                                          (s &amp; ~SMASK) | (update &amp; SMASK)))
1366                 return true;
1367         }
1368     }
1369 
1370     /**
1371      * Adapter for Runnables. This implements RunnableFuture
1372      * to be compliant with AbstractExecutorService constraints
1373      * when used in ForkJoinPool.
1374      */
1375     static final class AdaptedRunnable&lt;T&gt; extends ForkJoinTask&lt;T&gt;
1376         implements RunnableFuture&lt;T&gt; {
<span class="line-added">1377         @SuppressWarnings(&quot;serial&quot;) // Conditionally serializable</span>
1378         final Runnable runnable;
<span class="line-added">1379         @SuppressWarnings(&quot;serial&quot;) // Conditionally serializable</span>
1380         T result;
1381         AdaptedRunnable(Runnable runnable, T result) {
1382             if (runnable == null) throw new NullPointerException();
1383             this.runnable = runnable;
1384             this.result = result; // OK to set this even before completion
1385         }
1386         public final T getRawResult() { return result; }
1387         public final void setRawResult(T v) { result = v; }
1388         public final boolean exec() { runnable.run(); return true; }
1389         public final void run() { invoke(); }
1390         public String toString() {
1391             return super.toString() + &quot;[Wrapped task = &quot; + runnable + &quot;]&quot;;
1392         }
1393         private static final long serialVersionUID = 5232453952276885070L;
1394     }
1395 
1396     /**
1397      * Adapter for Runnables without results.
1398      */
1399     static final class AdaptedRunnableAction extends ForkJoinTask&lt;Void&gt;
1400         implements RunnableFuture&lt;Void&gt; {
<span class="line-added">1401         @SuppressWarnings(&quot;serial&quot;) // Conditionally serializable</span>
1402         final Runnable runnable;
1403         AdaptedRunnableAction(Runnable runnable) {
1404             if (runnable == null) throw new NullPointerException();
1405             this.runnable = runnable;
1406         }
1407         public final Void getRawResult() { return null; }
1408         public final void setRawResult(Void v) { }
1409         public final boolean exec() { runnable.run(); return true; }
1410         public final void run() { invoke(); }
1411         public String toString() {
1412             return super.toString() + &quot;[Wrapped task = &quot; + runnable + &quot;]&quot;;
1413         }
1414         private static final long serialVersionUID = 5232453952276885070L;
1415     }
1416 
1417     /**
1418      * Adapter for Runnables in which failure forces worker exception.
1419      */
1420     static final class RunnableExecuteAction extends ForkJoinTask&lt;Void&gt; {
<span class="line-added">1421         @SuppressWarnings(&quot;serial&quot;) // Conditionally serializable</span>
1422         final Runnable runnable;
1423         RunnableExecuteAction(Runnable runnable) {
1424             if (runnable == null) throw new NullPointerException();
1425             this.runnable = runnable;
1426         }
1427         public final Void getRawResult() { return null; }
1428         public final void setRawResult(Void v) { }
1429         public final boolean exec() { runnable.run(); return true; }
1430         void internalPropagateException(Throwable ex) {
1431             rethrow(ex); // rethrow outside exec() catches.
1432         }
1433         private static final long serialVersionUID = 5232453952276885070L;
1434     }
1435 
1436     /**
1437      * Adapter for Callables.
1438      */
1439     static final class AdaptedCallable&lt;T&gt; extends ForkJoinTask&lt;T&gt;
1440         implements RunnableFuture&lt;T&gt; {
<span class="line-added">1441         @SuppressWarnings(&quot;serial&quot;) // Conditionally serializable</span>
1442         final Callable&lt;? extends T&gt; callable;
<span class="line-added">1443         @SuppressWarnings(&quot;serial&quot;) // Conditionally serializable</span>
1444         T result;
1445         AdaptedCallable(Callable&lt;? extends T&gt; callable) {
1446             if (callable == null) throw new NullPointerException();
1447             this.callable = callable;
1448         }
1449         public final T getRawResult() { return result; }
1450         public final void setRawResult(T v) { result = v; }
1451         public final boolean exec() {
1452             try {
1453                 result = callable.call();
1454                 return true;
1455             } catch (RuntimeException rex) {
1456                 throw rex;
1457             } catch (Exception ex) {
1458                 throw new RuntimeException(ex);
1459             }
1460         }
1461         public final void run() { invoke(); }
1462         public String toString() {
1463             return super.toString() + &quot;[Wrapped task = &quot; + callable + &quot;]&quot;;
</pre>
</td>
</tr>
</table>
<center><a href="ForkJoinPool.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="LinkedBlockingDeque.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>