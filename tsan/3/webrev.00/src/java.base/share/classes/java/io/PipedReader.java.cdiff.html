<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/classes/java/io/PipedReader.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="PipedOutputStream.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="PipedWriter.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/io/PipedReader.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1996, 2013, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1996, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 57,73 ***</span>
  
      /**
       * The index of the position in the circular buffer at which the
       * next character of data will be stored when received from the connected
       * piped writer. &lt;code&gt;in&amp;lt;0&lt;/code&gt; implies the buffer is empty,
<span class="line-modified">!      * &lt;code&gt;in==out&lt;/code&gt; implies the buffer is full</span>
       */
      int in = -1;
  
      /**
       * The index of the position in the circular buffer at which the next
       * character of data will be read by this piped reader.
       */
      int out = 0;
  
      /**
<span class="line-modified">!      * Creates a &lt;code&gt;PipedReader&lt;/code&gt; so</span>
       * that it is connected to the piped writer
<span class="line-modified">!      * &lt;code&gt;src&lt;/code&gt;. Data written to &lt;code&gt;src&lt;/code&gt;</span>
       * will then be available as input from this stream.
       *
       * @param      src   the stream to connect to.
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
       */
      public PipedReader(PipedWriter src) throws IOException {
          this(src, DEFAULT_PIPE_SIZE);
      }
  
      /**
<span class="line-modified">!      * Creates a &lt;code&gt;PipedReader&lt;/code&gt; so that it is connected</span>
<span class="line-modified">!      * to the piped writer &lt;code&gt;src&lt;/code&gt; and uses the specified</span>
<span class="line-modified">!      * pipe size for the pipe&#39;s buffer. Data written to &lt;code&gt;src&lt;/code&gt;</span>
       * will then be  available as input from this stream.
  
       * @param      src       the stream to connect to.
       * @param      pipeSize  the size of the pipe&#39;s buffer.
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
<span class="line-modified">!      * @exception  IllegalArgumentException if {@code pipeSize &lt;= 0}.</span>
       * @since      1.6
       */
      public PipedReader(PipedWriter src, int pipeSize) throws IOException {
          initPipe(pipeSize);
          connect(src);
      }
  
  
      /**
<span class="line-modified">!      * Creates a &lt;code&gt;PipedReader&lt;/code&gt; so</span>
       * that it is not yet {@linkplain #connect(java.io.PipedWriter)
       * connected}. It must be {@linkplain java.io.PipedWriter#connect(
<span class="line-modified">!      * java.io.PipedReader) connected} to a &lt;code&gt;PipedWriter&lt;/code&gt;</span>
       * before being used.
       */
      public PipedReader() {
          initPipe(DEFAULT_PIPE_SIZE);
      }
  
      /**
<span class="line-modified">!      * Creates a &lt;code&gt;PipedReader&lt;/code&gt; so that it is not yet</span>
       * {@link #connect(java.io.PipedWriter) connected} and uses
       * the specified pipe size for the pipe&#39;s buffer.
       * It must be  {@linkplain java.io.PipedWriter#connect(
<span class="line-modified">!      * java.io.PipedReader) connected} to a &lt;code&gt;PipedWriter&lt;/code&gt;</span>
       * before being used.
       *
       * @param   pipeSize the size of the pipe&#39;s buffer.
<span class="line-modified">!      * @exception  IllegalArgumentException if {@code pipeSize &lt;= 0}.</span>
<span class="line-modified">!      * @since      1.6</span>
       */
      public PipedReader(int pipeSize) {
          initPipe(pipeSize);
      }
  
<span class="line-new-header">--- 57,73 ---</span>
  
      /**
       * The index of the position in the circular buffer at which the
       * next character of data will be stored when received from the connected
       * piped writer. &lt;code&gt;in&amp;lt;0&lt;/code&gt; implies the buffer is empty,
<span class="line-modified">!      * {@code in==out} implies the buffer is full</span>
       */
      int in = -1;
  
      /**
       * The index of the position in the circular buffer at which the next
       * character of data will be read by this piped reader.
       */
      int out = 0;
  
      /**
<span class="line-modified">!      * Creates a {@code PipedReader} so</span>
       * that it is connected to the piped writer
<span class="line-modified">!      * {@code src}. Data written to {@code src}</span>
       * will then be available as input from this stream.
       *
       * @param      src   the stream to connect to.
<span class="line-modified">!      * @throws     IOException  if an I/O error occurs.</span>
       */
      public PipedReader(PipedWriter src) throws IOException {
          this(src, DEFAULT_PIPE_SIZE);
      }
  
      /**
<span class="line-modified">!      * Creates a {@code PipedReader} so that it is connected</span>
<span class="line-modified">!      * to the piped writer {@code src} and uses the specified</span>
<span class="line-modified">!      * pipe size for the pipe&#39;s buffer. Data written to {@code src}</span>
       * will then be  available as input from this stream.
  
       * @param      src       the stream to connect to.
       * @param      pipeSize  the size of the pipe&#39;s buffer.
<span class="line-modified">!      * @throws     IOException  if an I/O error occurs.</span>
<span class="line-modified">!      * @throws     IllegalArgumentException if {@code pipeSize &lt;= 0}.</span>
       * @since      1.6
       */
      public PipedReader(PipedWriter src, int pipeSize) throws IOException {
          initPipe(pipeSize);
          connect(src);
      }
  
  
      /**
<span class="line-modified">!      * Creates a {@code PipedReader} so</span>
       * that it is not yet {@linkplain #connect(java.io.PipedWriter)
       * connected}. It must be {@linkplain java.io.PipedWriter#connect(
<span class="line-modified">!      * java.io.PipedReader) connected} to a {@code PipedWriter}</span>
       * before being used.
       */
      public PipedReader() {
          initPipe(DEFAULT_PIPE_SIZE);
      }
  
      /**
<span class="line-modified">!      * Creates a {@code PipedReader} so that it is not yet</span>
       * {@link #connect(java.io.PipedWriter) connected} and uses
       * the specified pipe size for the pipe&#39;s buffer.
       * It must be  {@linkplain java.io.PipedWriter#connect(
<span class="line-modified">!      * java.io.PipedReader) connected} to a {@code PipedWriter}</span>
       * before being used.
       *
       * @param   pipeSize the size of the pipe&#39;s buffer.
<span class="line-modified">!      * @throws  IllegalArgumentException if {@code pipeSize &lt;= 0}.</span>
<span class="line-modified">!      * @since   1.6</span>
       */
      public PipedReader(int pipeSize) {
          initPipe(pipeSize);
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 134,30 ***</span>
          buffer = new char[pipeSize];
      }
  
      /**
       * Causes this piped reader to be connected
<span class="line-modified">!      * to the piped  writer &lt;code&gt;src&lt;/code&gt;.</span>
       * If this object is already connected to some
<span class="line-modified">!      * other piped writer, an &lt;code&gt;IOException&lt;/code&gt;</span>
       * is thrown.
       * &lt;p&gt;
<span class="line-modified">!      * If &lt;code&gt;src&lt;/code&gt; is an</span>
<span class="line-modified">!      * unconnected piped writer and &lt;code&gt;snk&lt;/code&gt;</span>
       * is an unconnected piped reader, they
       * may be connected by either the call:
       *
<span class="line-modified">!      * &lt;pre&gt;&lt;code&gt;snk.connect(src)&lt;/code&gt; &lt;/pre&gt;</span>
       * &lt;p&gt;
       * or the call:
       *
<span class="line-modified">!      * &lt;pre&gt;&lt;code&gt;src.connect(snk)&lt;/code&gt; &lt;/pre&gt;</span>
       * &lt;p&gt;
       * The two calls have the same effect.
       *
       * @param      src   The piped writer to connect to.
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
       */
      public void connect(PipedWriter src) throws IOException {
          src.connect(this);
      }
  
<span class="line-new-header">--- 134,30 ---</span>
          buffer = new char[pipeSize];
      }
  
      /**
       * Causes this piped reader to be connected
<span class="line-modified">!      * to the piped  writer {@code src}.</span>
       * If this object is already connected to some
<span class="line-modified">!      * other piped writer, an {@code IOException}</span>
       * is thrown.
       * &lt;p&gt;
<span class="line-modified">!      * If {@code src} is an</span>
<span class="line-modified">!      * unconnected piped writer and {@code snk}</span>
       * is an unconnected piped reader, they
       * may be connected by either the call:
       *
<span class="line-modified">!      * &lt;pre&gt;{@code snk.connect(src)} &lt;/pre&gt;</span>
       * &lt;p&gt;
       * or the call:
       *
<span class="line-modified">!      * &lt;pre&gt;{@code src.connect(snk)} &lt;/pre&gt;</span>
       * &lt;p&gt;
       * The two calls have the same effect.
       *
       * @param      src   The piped writer to connect to.
<span class="line-modified">!      * @throws     IOException  if an I/O error occurs.</span>
       */
      public void connect(PipedWriter src) throws IOException {
          src.connect(this);
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 217,18 ***</span>
      }
  
      /**
       * Reads the next character of data from this piped stream.
       * If no character is available because the end of the stream
<span class="line-modified">!      * has been reached, the value &lt;code&gt;-1&lt;/code&gt; is returned.</span>
       * This method blocks until input data is available, the end of
       * the stream is detected, or an exception is thrown.
       *
<span class="line-modified">!      * @return     the next character of data, or &lt;code&gt;-1&lt;/code&gt; if the end of the</span>
<span class="line-modified">!      *             stream is reached.</span>
<span class="line-modified">!      * @exception  IOException  if the pipe is</span>
<span class="line-modified">!      *          &lt;a href=PipedInputStream.html#BROKEN&gt; &lt;code&gt;broken&lt;/code&gt;&lt;/a&gt;,</span>
       *          {@link #connect(java.io.PipedWriter) unconnected}, closed,
       *          or an I/O error occurs.
       */
      public synchronized int read()  throws IOException {
          if (!connected) {
<span class="line-new-header">--- 217,18 ---</span>
      }
  
      /**
       * Reads the next character of data from this piped stream.
       * If no character is available because the end of the stream
<span class="line-modified">!      * has been reached, the value {@code -1} is returned.</span>
       * This method blocks until input data is available, the end of
       * the stream is detected, or an exception is thrown.
       *
<span class="line-modified">!      * @return  the next character of data, or {@code -1} if the end of the</span>
<span class="line-modified">!      *          stream is reached.</span>
<span class="line-modified">!      * @throws  IOException  if the pipe is</span>
<span class="line-modified">!      *          &lt;a href=PipedInputStream.html#BROKEN&gt; {@code broken}&lt;/a&gt;,</span>
       *          {@link #connect(java.io.PipedWriter) unconnected}, closed,
       *          or an I/O error occurs.
       */
      public synchronized int read()  throws IOException {
          if (!connected) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 268,27 ***</span>
          }
          return ret;
      }
  
      /**
<span class="line-modified">!      * Reads up to &lt;code&gt;len&lt;/code&gt; characters of data from this piped</span>
<span class="line-modified">!      * stream into an array of characters. Less than &lt;code&gt;len&lt;/code&gt; characters</span>
       * will be read if the end of the data stream is reached or if
<span class="line-modified">!      * &lt;code&gt;len&lt;/code&gt; exceeds the pipe&#39;s buffer size. This method</span>
       * blocks until at least one character of input is available.
       *
       * @param      cbuf     the buffer into which the data is read.
       * @param      off   the start offset of the data.
       * @param      len   the maximum number of characters read.
       * @return     the total number of characters read into the buffer, or
<span class="line-modified">!      *             &lt;code&gt;-1&lt;/code&gt; if there is no more data because the end of</span>
       *             the stream has been reached.
<span class="line-modified">!      * @exception  IOException  if the pipe is</span>
<span class="line-modified">!      *                  &lt;a href=PipedInputStream.html#BROKEN&gt; &lt;code&gt;broken&lt;/code&gt;&lt;/a&gt;,</span>
<span class="line-modified">!      *                  {@link #connect(java.io.PipedWriter) unconnected}, closed,</span>
<span class="line-modified">!      *                  or an I/O error occurs.</span>
<span class="line-modified">!      * @exception  IndexOutOfBoundsException {@inheritDoc}</span>
       */
      public synchronized int read(char cbuf[], int off, int len)  throws IOException {
          if (!connected) {
              throw new IOException(&quot;Pipe not connected&quot;);
          } else if (closedByReader) {
<span class="line-new-header">--- 268,27 ---</span>
          }
          return ret;
      }
  
      /**
<span class="line-modified">!      * Reads up to {@code len} characters of data from this piped</span>
<span class="line-modified">!      * stream into an array of characters. Less than {@code len} characters</span>
       * will be read if the end of the data stream is reached or if
<span class="line-modified">!      * {@code len} exceeds the pipe&#39;s buffer size. This method</span>
       * blocks until at least one character of input is available.
       *
       * @param      cbuf     the buffer into which the data is read.
       * @param      off   the start offset of the data.
       * @param      len   the maximum number of characters read.
       * @return     the total number of characters read into the buffer, or
<span class="line-modified">!      *             {@code -1} if there is no more data because the end of</span>
       *             the stream has been reached.
<span class="line-modified">!      * @throws     IOException  if the pipe is</span>
<span class="line-modified">!      *             &lt;a href=PipedInputStream.html#BROKEN&gt; {@code broken}&lt;/a&gt;,</span>
<span class="line-modified">!      *             {@link #connect(java.io.PipedWriter) unconnected}, closed,</span>
<span class="line-modified">!      *             or an I/O error occurs.</span>
<span class="line-modified">!      * @throws     IndexOutOfBoundsException {@inheritDoc}</span>
       */
      public synchronized int read(char cbuf[], int off, int len)  throws IOException {
          if (!connected) {
              throw new IOException(&quot;Pipe not connected&quot;);
          } else if (closedByReader) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 328,13 ***</span>
  
      /**
       * Tell whether this stream is ready to be read.  A piped character
       * stream is ready if the circular buffer is not empty.
       *
<span class="line-modified">!      * @exception  IOException  if the pipe is</span>
<span class="line-modified">!      *                  &lt;a href=PipedInputStream.html#BROKEN&gt; &lt;code&gt;broken&lt;/code&gt;&lt;/a&gt;,</span>
<span class="line-modified">!      *                  {@link #connect(java.io.PipedWriter) unconnected}, or closed.</span>
       */
      public synchronized boolean ready() throws IOException {
          if (!connected) {
              throw new IOException(&quot;Pipe not connected&quot;);
          } else if (closedByReader) {
<span class="line-new-header">--- 328,13 ---</span>
  
      /**
       * Tell whether this stream is ready to be read.  A piped character
       * stream is ready if the circular buffer is not empty.
       *
<span class="line-modified">!      * @throws     IOException  if the pipe is</span>
<span class="line-modified">!      *             &lt;a href=PipedInputStream.html#BROKEN&gt; {@code broken}&lt;/a&gt;,</span>
<span class="line-modified">!      *             {@link #connect(java.io.PipedWriter) unconnected}, or closed.</span>
       */
      public synchronized boolean ready() throws IOException {
          if (!connected) {
              throw new IOException(&quot;Pipe not connected&quot;);
          } else if (closedByReader) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 352,11 ***</span>
  
      /**
       * Closes this piped stream and releases any system resources
       * associated with the stream.
       *
<span class="line-modified">!      * @exception  IOException  if an I/O error occurs.</span>
       */
      public void close()  throws IOException {
          in = -1;
          closedByReader = true;
      }
<span class="line-new-header">--- 352,11 ---</span>
  
      /**
       * Closes this piped stream and releases any system resources
       * associated with the stream.
       *
<span class="line-modified">!      * @throws     IOException  if an I/O error occurs.</span>
       */
      public void close()  throws IOException {
          in = -1;
          closedByReader = true;
      }
</pre>
<center><a href="PipedOutputStream.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="PipedWriter.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>