<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/javax/crypto/Cipher.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="BadPaddingException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="CipherSpi.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/javax/crypto/Cipher.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 130  *     cipher.init(..., s);
 131  *     ...
 132  *
 133  * &lt;/pre&gt;
 134  * The ChaCha20 and ChaCha20-Poly1305 algorithms have a similar requirement
 135  * for unique nonces with a given key.  After each encryption or decryption
 136  * operation, callers should re-initialize their ChaCha20 or ChaCha20-Poly1305
 137  * ciphers with parameters that specify a different nonce value.  Please
 138  * see &lt;a href=&quot;https://tools.ietf.org/html/rfc7539&quot;&gt;RFC 7539&lt;/a&gt; for more
 139  * information on the ChaCha20 and ChaCha20-Poly1305 algorithms.
 140  * &lt;p&gt;
 141  * Every implementation of the Java platform is required to support
 142  * the following standard {@code Cipher} transformations with the keysizes
 143  * in parentheses:
 144  * &lt;ul&gt;
 145  * &lt;li&gt;{@code AES/CBC/NoPadding} (128)&lt;/li&gt;
 146  * &lt;li&gt;{@code AES/CBC/PKCS5Padding} (128)&lt;/li&gt;
 147  * &lt;li&gt;{@code AES/ECB/NoPadding} (128)&lt;/li&gt;
 148  * &lt;li&gt;{@code AES/ECB/PKCS5Padding} (128)&lt;/li&gt;
 149  * &lt;li&gt;{@code AES/GCM/NoPadding} (128)&lt;/li&gt;
<span class="line-removed"> 150  * &lt;li&gt;{@code DES/CBC/NoPadding} (56)&lt;/li&gt;</span>
<span class="line-removed"> 151  * &lt;li&gt;{@code DES/CBC/PKCS5Padding} (56)&lt;/li&gt;</span>
<span class="line-removed"> 152  * &lt;li&gt;{@code DES/ECB/NoPadding} (56)&lt;/li&gt;</span>
<span class="line-removed"> 153  * &lt;li&gt;{@code DES/ECB/PKCS5Padding} (56)&lt;/li&gt;</span>
 154  * &lt;li&gt;{@code DESede/CBC/NoPadding} (168)&lt;/li&gt;
 155  * &lt;li&gt;{@code DESede/CBC/PKCS5Padding} (168)&lt;/li&gt;
 156  * &lt;li&gt;{@code DESede/ECB/NoPadding} (168)&lt;/li&gt;
 157  * &lt;li&gt;{@code DESede/ECB/PKCS5Padding} (168)&lt;/li&gt;
 158  * &lt;li&gt;{@code RSA/ECB/PKCS1Padding} (1024, 2048)&lt;/li&gt;
 159  * &lt;li&gt;{@code RSA/ECB/OAEPWithSHA-1AndMGF1Padding} (1024, 2048)&lt;/li&gt;
 160  * &lt;li&gt;{@code RSA/ECB/OAEPWithSHA-256AndMGF1Padding} (1024, 2048)&lt;/li&gt;
 161  * &lt;/ul&gt;
 162  * These transformations are described in the
 163  * &lt;a href=&quot;{@docRoot}/../specs/security/standard-names.html#cipher-algorithm-names&quot;&gt;
 164  * Cipher section&lt;/a&gt; of the
 165  * Java Security Standard Algorithm Names Specification.
 166  * Consult the release documentation for your implementation to see if any
 167  * other transformations are supported.
 168  *
 169  * @author Jan Luehe
 170  * @see KeyGenerator
 171  * @see SecretKey
 172  * @since 1.4
 173  */
</pre>
<hr />
<pre>
 251 
 252     // next service to try in provider selection
 253     // null once provider is selected
 254     private Service firstService;
 255 
 256     // remaining services to try in provider selection
 257     // null once provider is selected
 258     private Iterator&lt;Service&gt; serviceIterator;
 259 
 260     // list of transform Strings to lookup in the provider
 261     private List&lt;Transform&gt; transforms;
 262 
 263     private final Object lock;
 264 
 265     /**
 266      * Creates a Cipher object.
 267      *
 268      * @param cipherSpi the delegate
 269      * @param provider the provider
 270      * @param transformation the transformation



 271      */
 272     protected Cipher(CipherSpi cipherSpi,
 273                      Provider provider,
 274                      String transformation) {
 275         // See bug 4341369 &amp; 4334690 for more info.
 276         // If the caller is trusted, then okay.
<span class="line-modified"> 277         // Otherwise throw a NullPointerException.</span>
 278         if (!JceSecurityManager.INSTANCE.isCallerTrusted(provider)) {
<span class="line-modified"> 279             throw new NullPointerException();</span>
 280         }
 281         this.spi = cipherSpi;
 282         this.provider = provider;
 283         this.transformation = transformation;
 284         this.cryptoPerm = CryptoAllPermission.INSTANCE;
 285         this.lock = null;
 286     }
 287 
 288     /**
 289      * Creates a Cipher object. Called internally and by NullCipher.
 290      *
 291      * @param cipherSpi the delegate
 292      * @param transformation the transformation
 293      */
 294     Cipher(CipherSpi cipherSpi, String transformation) {
 295         this.spi = cipherSpi;
 296         this.transformation = transformation;
 297         this.cryptoPerm = CryptoAllPermission.INSTANCE;
 298         this.lock = null;
 299     }
</pre>
<hr />
<pre>
 542         List&lt;Service&gt; services = GetInstance.getServices(cipherServices);
 543         // make sure there is at least one service from a signed provider
 544         // and that it can use the specified mode and padding
 545         Iterator&lt;Service&gt; t = services.iterator();
 546         Exception failure = null;
 547         while (t.hasNext()) {
 548             Service s = t.next();
 549             if (JceSecurity.canUseProvider(s.getProvider()) == false) {
 550                 continue;
 551             }
 552             Transform tr = getTransform(s, transforms);
 553             if (tr == null) {
 554                 // should never happen
 555                 continue;
 556             }
 557             int canuse = tr.supportsModePadding(s);
 558             if (canuse == S_NO) {
 559                 // does not support mode or padding we need, ignore
 560                 continue;
 561             }
<span class="line-modified"> 562             if (canuse == S_YES) {</span>






 563                 return new Cipher(null, s, t, transformation, transforms);
<span class="line-modified"> 564             } else { // S_MAYBE, try out if it works</span>
<span class="line-modified"> 565                 try {</span>
<span class="line-removed"> 566                     CipherSpi spi = (CipherSpi)s.newInstance(null);</span>
<span class="line-removed"> 567                     tr.setModePadding(spi);</span>
<span class="line-removed"> 568                     return new Cipher(spi, s, t, transformation, transforms);</span>
<span class="line-removed"> 569                 } catch (Exception e) {</span>
<span class="line-removed"> 570                     failure = e;</span>
<span class="line-removed"> 571                 }</span>
 572             }
 573         }
 574         throw new NoSuchAlgorithmException
 575             (&quot;Cannot find any provider supporting &quot; + transformation, failure);
 576     }
 577 
 578     /**
 579      * Returns a {@code Cipher} object that implements the specified
 580      * transformation.
 581      *
 582      * &lt;p&gt; A new Cipher object encapsulating the
 583      * CipherSpi implementation from the specified provider
 584      * is returned.  The specified provider must be registered
 585      * in the security provider list.
 586      *
 587      * &lt;p&gt; Note that the list of registered providers may be retrieved via
 588      * the {@link Security#getProviders() Security.getProviders()} method.
 589      *
 590      * @apiNote
 591      * It is recommended to use a transformation that fully specifies the
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 130  *     cipher.init(..., s);
 131  *     ...
 132  *
 133  * &lt;/pre&gt;
 134  * The ChaCha20 and ChaCha20-Poly1305 algorithms have a similar requirement
 135  * for unique nonces with a given key.  After each encryption or decryption
 136  * operation, callers should re-initialize their ChaCha20 or ChaCha20-Poly1305
 137  * ciphers with parameters that specify a different nonce value.  Please
 138  * see &lt;a href=&quot;https://tools.ietf.org/html/rfc7539&quot;&gt;RFC 7539&lt;/a&gt; for more
 139  * information on the ChaCha20 and ChaCha20-Poly1305 algorithms.
 140  * &lt;p&gt;
 141  * Every implementation of the Java platform is required to support
 142  * the following standard {@code Cipher} transformations with the keysizes
 143  * in parentheses:
 144  * &lt;ul&gt;
 145  * &lt;li&gt;{@code AES/CBC/NoPadding} (128)&lt;/li&gt;
 146  * &lt;li&gt;{@code AES/CBC/PKCS5Padding} (128)&lt;/li&gt;
 147  * &lt;li&gt;{@code AES/ECB/NoPadding} (128)&lt;/li&gt;
 148  * &lt;li&gt;{@code AES/ECB/PKCS5Padding} (128)&lt;/li&gt;
 149  * &lt;li&gt;{@code AES/GCM/NoPadding} (128)&lt;/li&gt;




 150  * &lt;li&gt;{@code DESede/CBC/NoPadding} (168)&lt;/li&gt;
 151  * &lt;li&gt;{@code DESede/CBC/PKCS5Padding} (168)&lt;/li&gt;
 152  * &lt;li&gt;{@code DESede/ECB/NoPadding} (168)&lt;/li&gt;
 153  * &lt;li&gt;{@code DESede/ECB/PKCS5Padding} (168)&lt;/li&gt;
 154  * &lt;li&gt;{@code RSA/ECB/PKCS1Padding} (1024, 2048)&lt;/li&gt;
 155  * &lt;li&gt;{@code RSA/ECB/OAEPWithSHA-1AndMGF1Padding} (1024, 2048)&lt;/li&gt;
 156  * &lt;li&gt;{@code RSA/ECB/OAEPWithSHA-256AndMGF1Padding} (1024, 2048)&lt;/li&gt;
 157  * &lt;/ul&gt;
 158  * These transformations are described in the
 159  * &lt;a href=&quot;{@docRoot}/../specs/security/standard-names.html#cipher-algorithm-names&quot;&gt;
 160  * Cipher section&lt;/a&gt; of the
 161  * Java Security Standard Algorithm Names Specification.
 162  * Consult the release documentation for your implementation to see if any
 163  * other transformations are supported.
 164  *
 165  * @author Jan Luehe
 166  * @see KeyGenerator
 167  * @see SecretKey
 168  * @since 1.4
 169  */
</pre>
<hr />
<pre>
 247 
 248     // next service to try in provider selection
 249     // null once provider is selected
 250     private Service firstService;
 251 
 252     // remaining services to try in provider selection
 253     // null once provider is selected
 254     private Iterator&lt;Service&gt; serviceIterator;
 255 
 256     // list of transform Strings to lookup in the provider
 257     private List&lt;Transform&gt; transforms;
 258 
 259     private final Object lock;
 260 
 261     /**
 262      * Creates a Cipher object.
 263      *
 264      * @param cipherSpi the delegate
 265      * @param provider the provider
 266      * @param transformation the transformation
<span class="line-added"> 267      * @throws NullPointerException if {@code provider} is {@code null}</span>
<span class="line-added"> 268      * @throws IllegalArgumentException if the supplied arguments</span>
<span class="line-added"> 269      *         are deemed invalid for constructing the Cipher object</span>
 270      */
 271     protected Cipher(CipherSpi cipherSpi,
 272                      Provider provider,
 273                      String transformation) {
 274         // See bug 4341369 &amp; 4334690 for more info.
 275         // If the caller is trusted, then okay.
<span class="line-modified"> 276         // Otherwise throw an IllegalArgumentException.</span>
 277         if (!JceSecurityManager.INSTANCE.isCallerTrusted(provider)) {
<span class="line-modified"> 278             throw new IllegalArgumentException(&quot;Cannot construct cipher&quot;);</span>
 279         }
 280         this.spi = cipherSpi;
 281         this.provider = provider;
 282         this.transformation = transformation;
 283         this.cryptoPerm = CryptoAllPermission.INSTANCE;
 284         this.lock = null;
 285     }
 286 
 287     /**
 288      * Creates a Cipher object. Called internally and by NullCipher.
 289      *
 290      * @param cipherSpi the delegate
 291      * @param transformation the transformation
 292      */
 293     Cipher(CipherSpi cipherSpi, String transformation) {
 294         this.spi = cipherSpi;
 295         this.transformation = transformation;
 296         this.cryptoPerm = CryptoAllPermission.INSTANCE;
 297         this.lock = null;
 298     }
</pre>
<hr />
<pre>
 541         List&lt;Service&gt; services = GetInstance.getServices(cipherServices);
 542         // make sure there is at least one service from a signed provider
 543         // and that it can use the specified mode and padding
 544         Iterator&lt;Service&gt; t = services.iterator();
 545         Exception failure = null;
 546         while (t.hasNext()) {
 547             Service s = t.next();
 548             if (JceSecurity.canUseProvider(s.getProvider()) == false) {
 549                 continue;
 550             }
 551             Transform tr = getTransform(s, transforms);
 552             if (tr == null) {
 553                 // should never happen
 554                 continue;
 555             }
 556             int canuse = tr.supportsModePadding(s);
 557             if (canuse == S_NO) {
 558                 // does not support mode or padding we need, ignore
 559                 continue;
 560             }
<span class="line-modified"> 561             // S_YES, S_MAYBE</span>
<span class="line-added"> 562             // even when mode and padding are both supported, they</span>
<span class="line-added"> 563             // may not be used together, try out and see if it works</span>
<span class="line-added"> 564             try {</span>
<span class="line-added"> 565                 CipherSpi spi = (CipherSpi)s.newInstance(null);</span>
<span class="line-added"> 566                 tr.setModePadding(spi);</span>
<span class="line-added"> 567                 // specify null instead of spi for delayed provider selection</span>
 568                 return new Cipher(null, s, t, transformation, transforms);
<span class="line-modified"> 569             } catch (Exception e) {</span>
<span class="line-modified"> 570                 failure = e;</span>






 571             }
 572         }
 573         throw new NoSuchAlgorithmException
 574             (&quot;Cannot find any provider supporting &quot; + transformation, failure);
 575     }
 576 
 577     /**
 578      * Returns a {@code Cipher} object that implements the specified
 579      * transformation.
 580      *
 581      * &lt;p&gt; A new Cipher object encapsulating the
 582      * CipherSpi implementation from the specified provider
 583      * is returned.  The specified provider must be registered
 584      * in the security provider list.
 585      *
 586      * &lt;p&gt; Note that the list of registered providers may be retrieved via
 587      * the {@link Security#getProviders() Security.getProviders()} method.
 588      *
 589      * @apiNote
 590      * It is recommended to use a transformation that fully specifies the
</pre>
</td>
</tr>
</table>
<center><a href="BadPaddingException.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="CipherSpi.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>