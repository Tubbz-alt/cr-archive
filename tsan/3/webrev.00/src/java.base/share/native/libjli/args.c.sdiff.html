<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/native/libjli/args.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../libjava/jni_util.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="emessages.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/native/libjli/args.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
113 
114     // All arguments arrive here must be a launcher argument,
115     // ie. by now, all argfile expansions must have been performed.
116     if (*arg == &#39;-&#39;) {
117         expectingNoDashArg = JNI_FALSE;
118         if (IsWhiteSpaceOption(arg)) {
119             // expect an argument
120             expectingNoDashArg = JNI_TRUE;
121 
122             if (JLI_StrCmp(arg, &quot;-jar&quot;) == 0 ||
123                 JLI_StrCmp(arg, &quot;--module&quot;) == 0 ||
124                 JLI_StrCmp(arg, &quot;-m&quot;) == 0) {
125                 // This is tricky, we do expect NoDashArg
126                 // But that is considered main class to stop expansion
127                 expectingNoDashArg = JNI_FALSE;
128                 // We can not just update the idx here because if -jar @file
129                 // still need expansion of @file to get the argument for -jar
130             }
131         } else if (JLI_StrCmp(arg, &quot;--disable-@files&quot;) == 0) {
132             stopExpansion = JNI_TRUE;


133         }
134     } else {
135         if (!expectingNoDashArg) {
136             // this is main class, argsCount is index to next arg
137             idx = argsCount;
138         }
139         expectingNoDashArg = JNI_FALSE;
140     }
141     // only update on java mode and not yet found main class
142     if (firstAppArgIndex == NOT_FOUND &amp;&amp; idx != 0) {
143         firstAppArgIndex = (int) idx;
144     }
145 }
146 
147 /*
148        [\n\r]   +------------+                        +------------+ [\n\r]
149       +---------+ IN_COMMENT +&lt;------+                | IN_ESCAPE  +---------+
150       |         +------------+       |                +------------+         |
151       |    [#]       ^               |[#]                 ^     |            |
152       |   +----------+               |                [\\]|     |[^\n\r]     |
</pre>
<hr />
<pre>
320             return NULL;
321         }
322 
323         /* nextc is next character to read from the buffer
324          * eob is the end of input
325          * token is the copied token value, NULL if no a complete token
326          */
327         ctx.cptr = buf;
328         ctx.eob = buf + size;
329         token = nextToken(&amp;ctx);
330         while (token != NULL) {
331             checkArg(token);
332             JLI_List_add(rv, token);
333             token = nextToken(&amp;ctx);
334         }
335     }
336 
337     // remaining partial token
338     if (ctx.state == IN_TOKEN || ctx.state == IN_QUOTE) {
339         if (ctx.parts-&gt;size != 0) {
<span class="line-modified">340             JLI_List_add(rv, JLI_List_combine(ctx.parts));</span>


341         }
342     }
343     JLI_List_free(ctx.parts);
344 
345     return rv;
346 }
347 
348 /*
349  * if the arg represent a file, that is, prefix with a single &#39;@&#39;,
350  * return a list of arguments from the file.
351  * otherwise, return NULL.
352  */
353 static JLI_List expandArgFile(const char *arg) {
354     FILE *fptr;
355     struct stat st;
356     JLI_List rv;
357 
358     /* failed to access the file */
359     if (stat(arg, &amp;st) != 0) {
360         JLI_ReportMessage(CFG_ERROR6, arg);
</pre>
<hr />
<pre>
430         checkArg(arg);
431         return NULL;
432     }
433 
434     arg++;
435     if (arg[0] == &#39;@&#39;) {
436         // escaped @argument
437         rv = JLI_List_new(1);
438         checkArg(arg);
439         JLI_List_add(rv, JLI_StringDup(arg));
440     } else {
441         rv = expandArgFile(arg);
442     }
443     return rv;
444 }
445 
446 int isTerminalOpt(char *arg) {
447     return JLI_StrCmp(arg, &quot;-jar&quot;) == 0 ||
448            JLI_StrCmp(arg, &quot;-m&quot;) == 0 ||
449            JLI_StrCmp(arg, &quot;--module&quot;) == 0 ||

450            JLI_StrCmp(arg, &quot;--dry-run&quot;) == 0 ||
451            JLI_StrCmp(arg, &quot;-h&quot;) == 0 ||
452            JLI_StrCmp(arg, &quot;-?&quot;) == 0 ||
453            JLI_StrCmp(arg, &quot;-help&quot;) == 0 ||
454            JLI_StrCmp(arg, &quot;--help&quot;) == 0 ||
455            JLI_StrCmp(arg, &quot;-X&quot;) == 0 ||
456            JLI_StrCmp(arg, &quot;--help-extra&quot;) == 0 ||
457            JLI_StrCmp(arg, &quot;-version&quot;) == 0 ||
458            JLI_StrCmp(arg, &quot;--version&quot;) == 0 ||
459            JLI_StrCmp(arg, &quot;-fullversion&quot;) == 0 ||
460            JLI_StrCmp(arg, &quot;--full-version&quot;) == 0;
461 }
462 
463 JNIEXPORT jboolean JNICALL
464 JLI_AddArgsFromEnvVar(JLI_List args, const char *var_name) {
465     char *env = getenv(var_name);
466 
467     if (firstAppArgIndex == 0) {
468         // Not &#39;java&#39;, return
469         return JNI_FALSE;
</pre>
</td>
<td>
<hr />
<pre>
113 
114     // All arguments arrive here must be a launcher argument,
115     // ie. by now, all argfile expansions must have been performed.
116     if (*arg == &#39;-&#39;) {
117         expectingNoDashArg = JNI_FALSE;
118         if (IsWhiteSpaceOption(arg)) {
119             // expect an argument
120             expectingNoDashArg = JNI_TRUE;
121 
122             if (JLI_StrCmp(arg, &quot;-jar&quot;) == 0 ||
123                 JLI_StrCmp(arg, &quot;--module&quot;) == 0 ||
124                 JLI_StrCmp(arg, &quot;-m&quot;) == 0) {
125                 // This is tricky, we do expect NoDashArg
126                 // But that is considered main class to stop expansion
127                 expectingNoDashArg = JNI_FALSE;
128                 // We can not just update the idx here because if -jar @file
129                 // still need expansion of @file to get the argument for -jar
130             }
131         } else if (JLI_StrCmp(arg, &quot;--disable-@files&quot;) == 0) {
132             stopExpansion = JNI_TRUE;
<span class="line-added">133         } else if (JLI_StrCCmp(arg, &quot;--module=&quot;) == 0) {</span>
<span class="line-added">134             idx = argsCount;</span>
135         }
136     } else {
137         if (!expectingNoDashArg) {
138             // this is main class, argsCount is index to next arg
139             idx = argsCount;
140         }
141         expectingNoDashArg = JNI_FALSE;
142     }
143     // only update on java mode and not yet found main class
144     if (firstAppArgIndex == NOT_FOUND &amp;&amp; idx != 0) {
145         firstAppArgIndex = (int) idx;
146     }
147 }
148 
149 /*
150        [\n\r]   +------------+                        +------------+ [\n\r]
151       +---------+ IN_COMMENT +&lt;------+                | IN_ESCAPE  +---------+
152       |         +------------+       |                +------------+         |
153       |    [#]       ^               |[#]                 ^     |            |
154       |   +----------+               |                [\\]|     |[^\n\r]     |
</pre>
<hr />
<pre>
322             return NULL;
323         }
324 
325         /* nextc is next character to read from the buffer
326          * eob is the end of input
327          * token is the copied token value, NULL if no a complete token
328          */
329         ctx.cptr = buf;
330         ctx.eob = buf + size;
331         token = nextToken(&amp;ctx);
332         while (token != NULL) {
333             checkArg(token);
334             JLI_List_add(rv, token);
335             token = nextToken(&amp;ctx);
336         }
337     }
338 
339     // remaining partial token
340     if (ctx.state == IN_TOKEN || ctx.state == IN_QUOTE) {
341         if (ctx.parts-&gt;size != 0) {
<span class="line-modified">342             token = JLI_List_combine(ctx.parts);</span>
<span class="line-added">343             checkArg(token);</span>
<span class="line-added">344             JLI_List_add(rv, token);</span>
345         }
346     }
347     JLI_List_free(ctx.parts);
348 
349     return rv;
350 }
351 
352 /*
353  * if the arg represent a file, that is, prefix with a single &#39;@&#39;,
354  * return a list of arguments from the file.
355  * otherwise, return NULL.
356  */
357 static JLI_List expandArgFile(const char *arg) {
358     FILE *fptr;
359     struct stat st;
360     JLI_List rv;
361 
362     /* failed to access the file */
363     if (stat(arg, &amp;st) != 0) {
364         JLI_ReportMessage(CFG_ERROR6, arg);
</pre>
<hr />
<pre>
434         checkArg(arg);
435         return NULL;
436     }
437 
438     arg++;
439     if (arg[0] == &#39;@&#39;) {
440         // escaped @argument
441         rv = JLI_List_new(1);
442         checkArg(arg);
443         JLI_List_add(rv, JLI_StringDup(arg));
444     } else {
445         rv = expandArgFile(arg);
446     }
447     return rv;
448 }
449 
450 int isTerminalOpt(char *arg) {
451     return JLI_StrCmp(arg, &quot;-jar&quot;) == 0 ||
452            JLI_StrCmp(arg, &quot;-m&quot;) == 0 ||
453            JLI_StrCmp(arg, &quot;--module&quot;) == 0 ||
<span class="line-added">454            JLI_StrCCmp(arg, &quot;--module=&quot;) == 0 ||</span>
455            JLI_StrCmp(arg, &quot;--dry-run&quot;) == 0 ||
456            JLI_StrCmp(arg, &quot;-h&quot;) == 0 ||
457            JLI_StrCmp(arg, &quot;-?&quot;) == 0 ||
458            JLI_StrCmp(arg, &quot;-help&quot;) == 0 ||
459            JLI_StrCmp(arg, &quot;--help&quot;) == 0 ||
460            JLI_StrCmp(arg, &quot;-X&quot;) == 0 ||
461            JLI_StrCmp(arg, &quot;--help-extra&quot;) == 0 ||
462            JLI_StrCmp(arg, &quot;-version&quot;) == 0 ||
463            JLI_StrCmp(arg, &quot;--version&quot;) == 0 ||
464            JLI_StrCmp(arg, &quot;-fullversion&quot;) == 0 ||
465            JLI_StrCmp(arg, &quot;--full-version&quot;) == 0;
466 }
467 
468 JNIEXPORT jboolean JNICALL
469 JLI_AddArgsFromEnvVar(JLI_List args, const char *var_name) {
470     char *env = getenv(var_name);
471 
472     if (firstAppArgIndex == 0) {
473         // Not &#39;java&#39;, return
474         return JNI_FALSE;
</pre>
</td>
</tr>
</table>
<center><a href="../libjava/jni_util.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="emessages.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>