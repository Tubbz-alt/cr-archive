<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/share/native/libjava/ClassLoader.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="Class.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Object.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/native/libjava/ClassLoader.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 28,18 ***</span>
  
  #include &quot;jni.h&quot;
  #include &quot;jni_util.h&quot;
  #include &quot;jlong.h&quot;
  #include &quot;jvm.h&quot;
  #include &quot;java_lang_ClassLoader.h&quot;
  #include &quot;java_lang_ClassLoader_NativeLibrary.h&quot;
  #include &lt;string.h&gt;
  
<span class="line-removed">- /* defined in libverify.so/verify.dll (src file common/check_format.c) */</span>
<span class="line-removed">- extern jboolean VerifyClassname(char *utf_name, jboolean arrayAllowed);</span>
<span class="line-removed">- extern jboolean VerifyFixClassname(char *utf_name);</span>
<span class="line-removed">- </span>
  static JNINativeMethod methods[] = {
      {&quot;retrieveDirectives&quot;,  &quot;()Ljava/lang/AssertionStatusDirectives;&quot;, (void *)&amp;JVM_AssertionStatusDirectives}
  };
  
  JNIEXPORT void JNICALL
<span class="line-new-header">--- 28,15 ---</span>
  
  #include &quot;jni.h&quot;
  #include &quot;jni_util.h&quot;
  #include &quot;jlong.h&quot;
  #include &quot;jvm.h&quot;
<span class="line-added">+ #include &quot;check_classname.h&quot;</span>
  #include &quot;java_lang_ClassLoader.h&quot;
  #include &quot;java_lang_ClassLoader_NativeLibrary.h&quot;
  #include &lt;string.h&gt;
  
  static JNINativeMethod methods[] = {
      {&quot;retrieveDirectives&quot;,  &quot;()Ljava/lang/AssertionStatusDirectives;&quot;, (void *)&amp;JVM_AssertionStatusDirectives}
  };
  
  JNIEXPORT void JNICALL
</pre>
<hr />
<pre>
<span class="line-old-header">*** 118,11 ***</span>
      if (name != NULL) {
          utfName = getUTF(env, name, buf, sizeof(buf));
          if (utfName == NULL) {
              goto free_body;
          }
<span class="line-modified">!         VerifyFixClassname(utfName);</span>
      } else {
          utfName = NULL;
      }
  
      if (source != NULL) {
<span class="line-new-header">--- 115,11 ---</span>
      if (name != NULL) {
          utfName = getUTF(env, name, buf, sizeof(buf));
          if (utfName == NULL) {
              goto free_body;
          }
<span class="line-modified">!         fixClassname(utfName);</span>
      } else {
          utfName = NULL;
      }
  
      if (source != NULL) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 183,11 ***</span>
          utfName = getUTF(env, name, buf, sizeof(buf));
          if (utfName == NULL) {
              JNU_ThrowOutOfMemoryError(env, NULL);
              return result;
          }
<span class="line-modified">!         VerifyFixClassname(utfName);</span>
      } else {
          utfName = NULL;
      }
  
      if (source != NULL) {
<span class="line-new-header">--- 180,11 ---</span>
          utfName = getUTF(env, name, buf, sizeof(buf));
          if (utfName == NULL) {
              JNU_ThrowOutOfMemoryError(env, NULL);
              return result;
          }
<span class="line-modified">!         fixClassname(utfName);</span>
      } else {
          utfName = NULL;
      }
  
      if (source != NULL) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 229,13 ***</span>
      clname = getUTF(env, classname, buf, sizeof(buf));
      if (clname == NULL) {
          JNU_ThrowOutOfMemoryError(env, NULL);
          return NULL;
      }
<span class="line-modified">!     VerifyFixClassname(clname);</span>
  
<span class="line-modified">!     if (!VerifyClassname(clname, JNI_TRUE)) {  /* expects slashed name */</span>
          goto done;
      }
  
      cls = JVM_FindClassFromBootLoader(env, clname);
  
<span class="line-new-header">--- 226,13 ---</span>
      clname = getUTF(env, classname, buf, sizeof(buf));
      if (clname == NULL) {
          JNU_ThrowOutOfMemoryError(env, NULL);
          return NULL;
      }
<span class="line-modified">!     fixClassname(clname);</span>
  
<span class="line-modified">!     if (!verifyClassname(clname, JNI_TRUE)) {  /* expects slashed name */</span>
          goto done;
      }
  
      cls = JVM_FindClassFromBootLoader(env, clname);
  
</pre>
<center><a href="Class.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="Object.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>