<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/macosx/classes/sun/nio/ch/KQueueSelectorImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="DefaultSelectorProvider.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="KQueueSelectorProvider.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/macosx/classes/sun/nio/ch/KQueueSelectorImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
139         return processEvents(numEntries, action);
140     }
141 
142     /**
143      * Process changes to the interest ops.
144      */
145     private void processUpdateQueue() {
146         assert Thread.holdsLock(this);
147 
148         synchronized (updateLock) {
149             SelectionKeyImpl ski;
150             while ((ski = updateKeys.pollFirst()) != null) {
151                 if (ski.isValid()) {
152                     int fd = ski.getFDVal();
153                     // add to fdToKey if needed
154                     SelectionKeyImpl previous = fdToKey.putIfAbsent(fd, ski);
155                     assert (previous == null) || (previous == ski);
156 
157                     int newEvents = ski.translateInterestOps();
158                     int registeredEvents = ski.registeredEvents();







159                     if (newEvents != registeredEvents) {
160 
161                         // add or delete interest in read events
162                         if ((registeredEvents &amp; Net.POLLIN) != 0) {
163                             if ((newEvents &amp; Net.POLLIN) == 0) {
164                                 KQueue.register(kqfd, fd, EVFILT_READ, EV_DELETE);
165                             }
166                         } else if ((newEvents &amp; Net.POLLIN) != 0) {
167                             KQueue.register(kqfd, fd, EVFILT_READ, EV_ADD);
168                         }
169 
170                         // add or delete interest in write events
171                         if ((registeredEvents &amp; Net.POLLOUT) != 0) {
172                             if ((newEvents &amp; Net.POLLOUT) == 0) {
173                                 KQueue.register(kqfd, fd, EVFILT_WRITE, EV_DELETE);
174                             }
175                         } else if ((newEvents &amp; Net.POLLOUT) != 0) {
176                             KQueue.register(kqfd, fd, EVFILT_WRITE, EV_ADD);
177                         }
178 
</pre>
</td>
<td>
<hr />
<pre>
139         return processEvents(numEntries, action);
140     }
141 
142     /**
143      * Process changes to the interest ops.
144      */
145     private void processUpdateQueue() {
146         assert Thread.holdsLock(this);
147 
148         synchronized (updateLock) {
149             SelectionKeyImpl ski;
150             while ((ski = updateKeys.pollFirst()) != null) {
151                 if (ski.isValid()) {
152                     int fd = ski.getFDVal();
153                     // add to fdToKey if needed
154                     SelectionKeyImpl previous = fdToKey.putIfAbsent(fd, ski);
155                     assert (previous == null) || (previous == ski);
156 
157                     int newEvents = ski.translateInterestOps();
158                     int registeredEvents = ski.registeredEvents();
<span class="line-added">159 </span>
<span class="line-added">160                     // DatagramChannelImpl::disconnect has reset socket</span>
<span class="line-added">161                     if (ski.getAndClearReset() &amp;&amp; registeredEvents != 0) {</span>
<span class="line-added">162                         KQueue.register(kqfd, fd, EVFILT_READ, EV_DELETE);</span>
<span class="line-added">163                         registeredEvents = 0;</span>
<span class="line-added">164                     }</span>
<span class="line-added">165 </span>
166                     if (newEvents != registeredEvents) {
167 
168                         // add or delete interest in read events
169                         if ((registeredEvents &amp; Net.POLLIN) != 0) {
170                             if ((newEvents &amp; Net.POLLIN) == 0) {
171                                 KQueue.register(kqfd, fd, EVFILT_READ, EV_DELETE);
172                             }
173                         } else if ((newEvents &amp; Net.POLLIN) != 0) {
174                             KQueue.register(kqfd, fd, EVFILT_READ, EV_ADD);
175                         }
176 
177                         // add or delete interest in write events
178                         if ((registeredEvents &amp; Net.POLLOUT) != 0) {
179                             if ((newEvents &amp; Net.POLLOUT) == 0) {
180                                 KQueue.register(kqfd, fd, EVFILT_WRITE, EV_DELETE);
181                             }
182                         } else if ((newEvents &amp; Net.POLLOUT) != 0) {
183                             KQueue.register(kqfd, fd, EVFILT_WRITE, EV_ADD);
184                         }
185 
</pre>
</td>
</tr>
</table>
<center><a href="DefaultSelectorProvider.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="KQueueSelectorProvider.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>