<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/macosx/classes/sun/util/locale/provider/HostLocaleProviderAdapterImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../nio/fs/UTIFileTypeDetector.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../native/libjava/HostLocaleProviderAdapter_md.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/macosx/classes/sun/util/locale/provider/HostLocaleProviderAdapterImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.util.locale.provider;
 27 
 28 import java.lang.ref.SoftReference;
 29 import java.text.*;
 30 import java.text.spi.DateFormatProvider;
 31 import java.text.spi.DateFormatSymbolsProvider;
 32 import java.text.spi.DecimalFormatSymbolsProvider;
 33 import java.text.spi.NumberFormatProvider;
 34 import java.util.Collections;
 35 import java.util.Calendar;

 36 import java.util.HashSet;
 37 import java.util.Locale;
 38 import java.util.Map;
 39 import java.util.ResourceBundle.Control;
 40 import java.util.Set;
 41 import java.util.TimeZone;
 42 import java.util.concurrent.ConcurrentHashMap;
 43 import java.util.concurrent.ConcurrentMap;
 44 import java.util.concurrent.atomic.AtomicReferenceArray;
 45 import java.util.spi.CalendarDataProvider;
 46 import java.util.spi.CalendarNameProvider;
 47 import java.util.spi.CurrencyNameProvider;
 48 import java.util.spi.LocaleNameProvider;
 49 import java.util.spi.TimeZoneNameProvider;
 50 import sun.text.spi.JavaTimeDateTimePatternProvider;
 51 import sun.util.spi.CalendarProvider;
 52 
 53 /**
 54  * LocaleProviderAdapter implementation for the Mac OS X locale data
 55  *
</pre>
<hr />
<pre>
411         return new NumberFormatProvider() {
412             @Override
413             public Locale[] getAvailableLocales() {
414                 return supportedLocale;
415             }
416 
417             @Override
418             public boolean isSupportedLocale(Locale locale) {
419                 // Ignore the extensions for now
420                 return supportedLocaleSet.contains(locale.stripExtensions());
421             }
422 
423             @Override
424             public NumberFormat getCurrencyInstance(Locale locale) {
425                 return new DecimalFormat(getNumberPattern(NF_CURRENCY, locale),
426                     DecimalFormatSymbols.getInstance(locale));
427             }
428 
429             @Override
430             public NumberFormat getIntegerInstance(Locale locale) {
<span class="line-modified">431                 return new DecimalFormat(getNumberPattern(NF_INTEGER, locale),</span>
432                     DecimalFormatSymbols.getInstance(locale));

433             }
434 
435             @Override
436             public NumberFormat getNumberInstance(Locale locale) {
437                 return new DecimalFormat(getNumberPattern(NF_NUMBER, locale),
438                     DecimalFormatSymbols.getInstance(locale));
439             }
440 
441             @Override
442             public NumberFormat getPercentInstance(Locale locale) {
443                 return new DecimalFormat(getNumberPattern(NF_PERCENT, locale),
444                     DecimalFormatSymbols.getInstance(locale));
445             }
446 
447             private String getNumberPattern(int style, Locale locale) {
448                 AtomicReferenceArray&lt;String&gt; numberFormatPatterns;
449                 SoftReference&lt;AtomicReferenceArray&lt;String&gt;&gt; ref = numberFormatPatternsMap.get(locale);
450 
451                 if (ref == null || (numberFormatPatterns = ref.get()) == null) {
452                     numberFormatPatterns = new AtomicReferenceArray&lt;&gt;(4);
</pre>
<hr />
<pre>
533             @Override
534             public int getMinimalDaysInFirstWeek(Locale locale) {
535                 return getCalendarInt(locale.toLanguageTag(), CD_MINIMALDAYSINFIRSTWEEK);
536             }
537         };
538     }
539 
540     public static CalendarNameProvider getCalendarNameProvider() {
541         return new CalendarNameProvider() {
542             @Override
543             public Locale[] getAvailableLocales() {
544                 return getSupportedCalendarLocales();
545             }
546 
547             @Override
548             public boolean isSupportedLocale(Locale locale) {
549                 return isSupportedCalendarLocale(locale);
550             }
551 
552             @Override
<span class="line-modified">553             public String getDisplayName(String calType, int field, int value,</span>
<span class="line-modified">554                                          int style, Locale locale) {</span>
<span class="line-modified">555                 return null;</span>






556             }
557 
558             @Override
<span class="line-modified">559             public Map&lt;String, Integer&gt; getDisplayNames(String calType,</span>
<span class="line-modified">560                                          int field, int style, Locale locale) {</span>
<span class="line-modified">561                 return null;</span>












562             }
563         };
564     }
565 
566     public static CalendarProvider getCalendarProvider() {
567         return new CalendarProvider() {
568             @Override
569             public Locale[] getAvailableLocales() {
570                 return getSupportedCalendarLocales();
571             }
572 
573             @Override
574             public boolean isSupportedLocale(Locale locale) {
575                 return isSupportedCalendarLocale(locale);
576             }
577 
578             @Override
579             public Calendar getInstance(TimeZone zone, Locale locale) {
580                 return new Calendar.Builder()
581                              .setLocale(locale)
</pre>
<hr />
<pre>
884     private static native String[] getWeekdays(String langTag, String[] wdays);
885     private static native String[] getShortWeekdays(String langTag, String[] swdays);
886 
887     // For DecimalFormatSymbolsProvider
888     private static native String getCurrencySymbol(String langTag, String currencySymbol);
889     private static native char getDecimalSeparator(String langTag, char decimalSeparator);
890     private static native char getGroupingSeparator(String langTag, char groupingSeparator);
891     private static native String getInfinity(String langTag, String infinity);
892     private static native String getInternationalCurrencySymbol(String langTag, String internationalCurrencySymbol);
893     private static native char getMinusSign(String langTag, char minusSign);
894     private static native char getMonetaryDecimalSeparator(String langTag, char monetaryDecimalSeparator);
895     private static native String getNaN(String langTag, String nan);
896     private static native char getPercent(String langTag, char percent);
897     private static native char getPerMill(String langTag, char perMill);
898     private static native char getZeroDigit(String langTag, char zeroDigit);
899     private static native String getExponentSeparator(String langTag, String exponent);
900 
901     // For CalendarDataProvider
902     private static native int getCalendarInt(String langTag, int type);
903 



904     // For Locale/CurrencyNameProvider
905     private static native String getDisplayString(String langTag, int key, String value);
906 
907     // For TimeZoneNameProvider
908     private static native String getTimeZoneDisplayString(String langTag, int style, String value);
909 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.util.locale.provider;
 27 
 28 import java.lang.ref.SoftReference;
 29 import java.text.*;
 30 import java.text.spi.DateFormatProvider;
 31 import java.text.spi.DateFormatSymbolsProvider;
 32 import java.text.spi.DecimalFormatSymbolsProvider;
 33 import java.text.spi.NumberFormatProvider;
 34 import java.util.Collections;
 35 import java.util.Calendar;
<span class="line-added"> 36 import java.util.HashMap;</span>
 37 import java.util.HashSet;
 38 import java.util.Locale;
 39 import java.util.Map;
 40 import java.util.ResourceBundle.Control;
 41 import java.util.Set;
 42 import java.util.TimeZone;
 43 import java.util.concurrent.ConcurrentHashMap;
 44 import java.util.concurrent.ConcurrentMap;
 45 import java.util.concurrent.atomic.AtomicReferenceArray;
 46 import java.util.spi.CalendarDataProvider;
 47 import java.util.spi.CalendarNameProvider;
 48 import java.util.spi.CurrencyNameProvider;
 49 import java.util.spi.LocaleNameProvider;
 50 import java.util.spi.TimeZoneNameProvider;
 51 import sun.text.spi.JavaTimeDateTimePatternProvider;
 52 import sun.util.spi.CalendarProvider;
 53 
 54 /**
 55  * LocaleProviderAdapter implementation for the Mac OS X locale data
 56  *
</pre>
<hr />
<pre>
412         return new NumberFormatProvider() {
413             @Override
414             public Locale[] getAvailableLocales() {
415                 return supportedLocale;
416             }
417 
418             @Override
419             public boolean isSupportedLocale(Locale locale) {
420                 // Ignore the extensions for now
421                 return supportedLocaleSet.contains(locale.stripExtensions());
422             }
423 
424             @Override
425             public NumberFormat getCurrencyInstance(Locale locale) {
426                 return new DecimalFormat(getNumberPattern(NF_CURRENCY, locale),
427                     DecimalFormatSymbols.getInstance(locale));
428             }
429 
430             @Override
431             public NumberFormat getIntegerInstance(Locale locale) {
<span class="line-modified">432                 DecimalFormat format = new DecimalFormat(getNumberPattern(NF_INTEGER, locale),</span>
433                     DecimalFormatSymbols.getInstance(locale));
<span class="line-added">434                 return HostLocaleProviderAdapter.makeIntegerFormatter(format);</span>
435             }
436 
437             @Override
438             public NumberFormat getNumberInstance(Locale locale) {
439                 return new DecimalFormat(getNumberPattern(NF_NUMBER, locale),
440                     DecimalFormatSymbols.getInstance(locale));
441             }
442 
443             @Override
444             public NumberFormat getPercentInstance(Locale locale) {
445                 return new DecimalFormat(getNumberPattern(NF_PERCENT, locale),
446                     DecimalFormatSymbols.getInstance(locale));
447             }
448 
449             private String getNumberPattern(int style, Locale locale) {
450                 AtomicReferenceArray&lt;String&gt; numberFormatPatterns;
451                 SoftReference&lt;AtomicReferenceArray&lt;String&gt;&gt; ref = numberFormatPatternsMap.get(locale);
452 
453                 if (ref == null || (numberFormatPatterns = ref.get()) == null) {
454                     numberFormatPatterns = new AtomicReferenceArray&lt;&gt;(4);
</pre>
<hr />
<pre>
535             @Override
536             public int getMinimalDaysInFirstWeek(Locale locale) {
537                 return getCalendarInt(locale.toLanguageTag(), CD_MINIMALDAYSINFIRSTWEEK);
538             }
539         };
540     }
541 
542     public static CalendarNameProvider getCalendarNameProvider() {
543         return new CalendarNameProvider() {
544             @Override
545             public Locale[] getAvailableLocales() {
546                 return getSupportedCalendarLocales();
547             }
548 
549             @Override
550             public boolean isSupportedLocale(Locale locale) {
551                 return isSupportedCalendarLocale(locale);
552             }
553 
554             @Override
<span class="line-modified">555             public String getDisplayName(String calendarType, int field,</span>
<span class="line-modified">556                                          int value, int style, Locale locale) {</span>
<span class="line-modified">557                 String[] names = getCalendarDisplayStrings(locale.toLanguageTag(),</span>
<span class="line-added">558                         field, style);</span>
<span class="line-added">559                 if (names != null &amp;&amp; value &gt;= 0 &amp;&amp; value &lt; names.length) {</span>
<span class="line-added">560                     return names[value];</span>
<span class="line-added">561                 } else {</span>
<span class="line-added">562                     return null;</span>
<span class="line-added">563                 }</span>
564             }
565 
566             @Override
<span class="line-modified">567             public Map&lt;String, Integer&gt; getDisplayNames(String calendarType,</span>
<span class="line-modified">568                                                         int field, int style, Locale locale) {</span>
<span class="line-modified">569                 Map&lt;String, Integer&gt; map = null;</span>
<span class="line-added">570                 String[] names = getCalendarDisplayStrings(locale.toLanguageTag(),</span>
<span class="line-added">571                         field, style);</span>
<span class="line-added">572                 if (names != null) {</span>
<span class="line-added">573                     map = new HashMap&lt;&gt;((int)Math.ceil(names.length / 0.75));</span>
<span class="line-added">574                     for (int value = 0; value &lt; names.length; value++) {</span>
<span class="line-added">575                         if (names[value] != null) {</span>
<span class="line-added">576                             map.put(names[value], value);</span>
<span class="line-added">577                         }</span>
<span class="line-added">578                     }</span>
<span class="line-added">579                     map = map.isEmpty() ? null : map;</span>
<span class="line-added">580                 }</span>
<span class="line-added">581                 return map;</span>
582             }
583         };
584     }
585 
586     public static CalendarProvider getCalendarProvider() {
587         return new CalendarProvider() {
588             @Override
589             public Locale[] getAvailableLocales() {
590                 return getSupportedCalendarLocales();
591             }
592 
593             @Override
594             public boolean isSupportedLocale(Locale locale) {
595                 return isSupportedCalendarLocale(locale);
596             }
597 
598             @Override
599             public Calendar getInstance(TimeZone zone, Locale locale) {
600                 return new Calendar.Builder()
601                              .setLocale(locale)
</pre>
<hr />
<pre>
904     private static native String[] getWeekdays(String langTag, String[] wdays);
905     private static native String[] getShortWeekdays(String langTag, String[] swdays);
906 
907     // For DecimalFormatSymbolsProvider
908     private static native String getCurrencySymbol(String langTag, String currencySymbol);
909     private static native char getDecimalSeparator(String langTag, char decimalSeparator);
910     private static native char getGroupingSeparator(String langTag, char groupingSeparator);
911     private static native String getInfinity(String langTag, String infinity);
912     private static native String getInternationalCurrencySymbol(String langTag, String internationalCurrencySymbol);
913     private static native char getMinusSign(String langTag, char minusSign);
914     private static native char getMonetaryDecimalSeparator(String langTag, char monetaryDecimalSeparator);
915     private static native String getNaN(String langTag, String nan);
916     private static native char getPercent(String langTag, char percent);
917     private static native char getPerMill(String langTag, char perMill);
918     private static native char getZeroDigit(String langTag, char zeroDigit);
919     private static native String getExponentSeparator(String langTag, String exponent);
920 
921     // For CalendarDataProvider
922     private static native int getCalendarInt(String langTag, int type);
923 
<span class="line-added">924     // For CalendarNameProvider</span>
<span class="line-added">925     private static native String[] getCalendarDisplayStrings(String langTag, int field, int style);</span>
<span class="line-added">926 </span>
927     // For Locale/CurrencyNameProvider
928     private static native String getDisplayString(String langTag, int key, String value);
929 
930     // For TimeZoneNameProvider
931     private static native String getTimeZoneDisplayString(String langTag, int style, String value);
932 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../nio/fs/UTIFileTypeDetector.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../native/libjava/HostLocaleProviderAdapter_md.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>