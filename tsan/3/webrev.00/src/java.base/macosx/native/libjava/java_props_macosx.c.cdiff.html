<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/macosx/native/libjava/java_props_macosx.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="HostLocaleProviderAdapter_md.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="java_props_macosx.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/macosx/native/libjava/java_props_macosx.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 26,11 ***</span>
  #include &lt;sys/socket.h&gt;
  #include &lt;netinet/in.h&gt;
  #include &lt;arpa/inet.h&gt;
  #include &lt;objc/objc-runtime.h&gt;
  
<span class="line-removed">- #include &lt;Security/AuthSession.h&gt;</span>
  #include &lt;CoreFoundation/CoreFoundation.h&gt;
  #include &lt;SystemConfiguration/SystemConfiguration.h&gt;
  #include &lt;Foundation/Foundation.h&gt;
  
  #include &quot;java_props_macosx.h&quot;
<span class="line-new-header">--- 26,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 90,37 ***</span>
              char *hyphenPos = strchr(languageString, &#39;-&#39;);
              int langStrLen = strlen(languageString);
  
              if (hyphenPos == NULL || // languageString contains ISO639 only, e.g., &quot;en&quot;
                  languageString + langStrLen - hyphenPos == 5) { // ISO639-ScriptCode, e.g., &quot;en-Latn&quot;
<span class="line-modified">!                 CFStringGetCString(CFLocaleGetIdentifier(CFLocaleCopyCurrent()),</span>
<span class="line-modified">!                                localeString, LOCALEIDLENGTH, CFStringGetSystemEncoding());</span>
<span class="line-modified">!                 char *underscorePos = strrchr(localeString, &#39;_&#39;);</span>
<span class="line-modified">!                 char *region = NULL;</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 if (underscorePos != NULL) {</span>
<span class="line-modified">!                     region = underscorePos + 1;</span>
<span class="line-modified">!                 }</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 if (region != NULL) {</span>
<span class="line-modified">!                     strcat(languageString, &quot;-&quot;);</span>
<span class="line-modified">!                     strcat(languageString, region);</span>
                  }
              }
  
              retVal = languageString;
          }
          break;
  
      default:
          {
<span class="line-modified">!             if (!CFStringGetCString(CFLocaleGetIdentifier(CFLocaleCopyCurrent()),</span>
<span class="line-modified">!                                     localeString, LOCALEIDLENGTH, CFStringGetSystemEncoding())) {</span>
                  return NULL;
              }
<span class="line-removed">- </span>
<span class="line-removed">-             retVal = localeString;</span>
          }
          break;
      }
  
      if (retVal != NULL) {
<span class="line-new-header">--- 89,48 ---</span>
              char *hyphenPos = strchr(languageString, &#39;-&#39;);
              int langStrLen = strlen(languageString);
  
              if (hyphenPos == NULL || // languageString contains ISO639 only, e.g., &quot;en&quot;
                  languageString + langStrLen - hyphenPos == 5) { // ISO639-ScriptCode, e.g., &quot;en-Latn&quot;
<span class="line-modified">!                 CFLocaleRef cflocale = CFLocaleCopyCurrent();</span>
<span class="line-modified">!                 if (cflocale != NULL) {</span>
<span class="line-modified">!                     CFStringGetCString(CFLocaleGetIdentifier(cflocale),</span>
<span class="line-modified">!                                    localeString, LOCALEIDLENGTH, CFStringGetSystemEncoding());</span>
<span class="line-modified">!                     char *underscorePos = strrchr(localeString, &#39;_&#39;);</span>
<span class="line-modified">!                     char *region = NULL;</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     if (underscorePos != NULL) {</span>
<span class="line-modified">!                         region = underscorePos + 1;</span>
<span class="line-modified">!                     }</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     if (region != NULL) {</span>
<span class="line-added">+                         strcat(languageString, &quot;-&quot;);</span>
<span class="line-added">+                         strcat(languageString, region);</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                     CFRelease(cflocale);</span>
                  }
              }
  
              retVal = languageString;
          }
          break;
  
      default:
          {
<span class="line-modified">!             CFLocaleRef cflocale = CFLocaleCopyCurrent();</span>
<span class="line-modified">!             if (cflocale != NULL) {</span>
<span class="line-added">+                 if (!CFStringGetCString(CFLocaleGetIdentifier(cflocale),</span>
<span class="line-added">+                                         localeString, LOCALEIDLENGTH, CFStringGetSystemEncoding())) {</span>
<span class="line-added">+                     CFRelease(cflocale);</span>
<span class="line-added">+                     return NULL;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+                 retVal = localeString;</span>
<span class="line-added">+                 CFRelease(cflocale);</span>
<span class="line-added">+             } else {</span>
                  return NULL;
              }
          }
          break;
      }
  
      if (retVal != NULL) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 210,29 ***</span>
      } else {
          return ret;
      }
  }
  
<span class="line-removed">- int isInAquaSession() {</span>
<span class="line-removed">-     // environment variable to bypass the aqua session check</span>
<span class="line-removed">-     char *ev = getenv(&quot;AWT_FORCE_HEADFUL&quot;);</span>
<span class="line-removed">-     if (ev &amp;&amp; (strncasecmp(ev, &quot;true&quot;, 4) == 0)) {</span>
<span class="line-removed">-         // if &quot;true&quot; then tell the caller we&#39;re in an Aqua session without actually checking</span>
<span class="line-removed">-         return 1;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     // Is the WindowServer available?</span>
<span class="line-removed">-     SecuritySessionId session_id;</span>
<span class="line-removed">-     SessionAttributeBits session_info;</span>
<span class="line-removed">-     OSStatus status = SessionGetInfo(callerSecuritySession, &amp;session_id, &amp;session_info);</span>
<span class="line-removed">-     if (status == noErr) {</span>
<span class="line-removed">-         if (session_info &amp; sessionHasGraphicAccess) {</span>
<span class="line-removed">-             return 1;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     return 0;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  // 10.9 SDK does not include the NSOperatingSystemVersion struct.
  // For now, create our own
  typedef struct {
          NSInteger majorVersion;
          NSInteger minorVersion;
<span class="line-new-header">--- 220,10 ---</span>
</pre>
<center><a href="HostLocaleProviderAdapter_md.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="java_props_macosx.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>