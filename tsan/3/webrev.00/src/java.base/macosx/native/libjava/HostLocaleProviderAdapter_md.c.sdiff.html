<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/macosx/native/libjava/HostLocaleProviderAdapter_md.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../classes/sun/util/locale/provider/HostLocaleProviderAdapterImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="java_props_macosx.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/macosx/native/libjava/HostLocaleProviderAdapter_md.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2013, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;sun_util_locale_provider_HostLocaleProviderAdapterImpl.h&quot;
 27 #include &quot;jni_util.h&quot;
 28 #include &lt;CoreFoundation/CoreFoundation.h&gt;
 29 #include &lt;stdio.h&gt;
 30 
 31 #define BUFLEN 256
 32 






 33 static CFDateFormatterStyle convertDateFormatterStyle(jint javaStyle);
 34 static CFNumberFormatterStyle convertNumberFormatterStyle(jint javaStyle);
 35 static void copyArrayElements(JNIEnv *env, CFArrayRef cfarray, jobjectArray jarray, CFIndex sindex, int dindex, int count);
 36 static jstring getNumberSymbolString(JNIEnv *env, jstring jlangtag, jstring jdefault, CFStringRef type);
 37 static jchar getNumberSymbolChar(JNIEnv *env, jstring jlangtag, jchar jdefault, CFStringRef type);



 38 
 39 // from java_props_macosx.c
 40 extern char * getMacOSXLocale(int cat);
 41 extern char * getPosixLocale(int cat);
 42 
 43 /*
 44  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
 45  * Method:    getDefaultLocale
 46  * Signature: (I)Ljava/lang/String;
 47  */
 48 JNIEXPORT jstring JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getDefaultLocale
 49   (JNIEnv *env, jclass cls, jint cat) {
 50     char * localeString = NULL;
 51     int posixCat;
 52     jstring ret = NULL;
 53 
 54     switch (cat) {
 55         case sun_util_locale_provider_HostLocaleProviderAdapterImpl_CAT_DISPLAY:
 56             posixCat = LC_MESSAGES;
 57             break;
</pre>
<hr />
<pre>
114     CFLocaleRef cflocale = CFLocaleCopyCurrent();
115 
116     if (cflocale != NULL) {
117         char buf[BUFLEN];
118         CFTypeRef calid = CFLocaleGetValue(cflocale, kCFLocaleCalendarIdentifier);
119         CFStringGetCString((CFStringRef)calid, buf, BUFLEN, kCFStringEncodingUTF8);
120         ret = (*env)-&gt;NewStringUTF(env, buf);
121         CFRelease(cflocale);
122     }
123 
124     return ret;
125 }
126 
127 /*
128  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
129  * Method:    getAmPmStrings
130  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
131  */
132 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getAmPmStrings
133   (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray ampms) {
<span class="line-modified">134     CFLocaleRef cflocale = CFLocaleCopyCurrent();</span>
<span class="line-removed">135     jstring tmp_string;</span>
<span class="line-removed">136     if (cflocale != NULL) {</span>
<span class="line-removed">137         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,</span>
<span class="line-removed">138                                                   cflocale,</span>
<span class="line-removed">139                                                   kCFDateFormatterFullStyle,</span>
<span class="line-removed">140                                                   kCFDateFormatterFullStyle);</span>
<span class="line-removed">141         if (df != NULL) {</span>
<span class="line-removed">142             char buf[BUFLEN];</span>
<span class="line-removed">143             CFStringRef amStr = CFDateFormatterCopyProperty(df, kCFDateFormatterAMSymbol);</span>
<span class="line-removed">144             if (amStr != NULL) {</span>
<span class="line-removed">145                 CFStringGetCString(amStr, buf, BUFLEN, kCFStringEncodingUTF8);</span>
<span class="line-removed">146                 CFRelease(amStr);</span>
<span class="line-removed">147                 tmp_string = (*env)-&gt;NewStringUTF(env, buf);</span>
<span class="line-removed">148                 if (tmp_string != NULL) {</span>
<span class="line-removed">149                     (*env)-&gt;SetObjectArrayElement(env, ampms, 0, tmp_string);</span>
<span class="line-removed">150                 }</span>
<span class="line-removed">151             }</span>
<span class="line-removed">152             if (!(*env)-&gt;ExceptionCheck(env)){</span>
<span class="line-removed">153                 CFStringRef pmStr = CFDateFormatterCopyProperty(df, kCFDateFormatterPMSymbol);</span>
<span class="line-removed">154                 if (pmStr != NULL) {</span>
<span class="line-removed">155                     CFStringGetCString(pmStr, buf, BUFLEN, kCFStringEncodingUTF8);</span>
<span class="line-removed">156                     CFRelease(pmStr);</span>
<span class="line-removed">157                     tmp_string = (*env)-&gt;NewStringUTF(env, buf);</span>
<span class="line-removed">158                     if (tmp_string != NULL) {</span>
<span class="line-removed">159                         (*env)-&gt;SetObjectArrayElement(env, ampms, 1, tmp_string);</span>
<span class="line-removed">160                     }</span>
<span class="line-removed">161                 }</span>
<span class="line-removed">162             }</span>
<span class="line-removed">163             CFRelease(df);</span>
<span class="line-removed">164         }</span>
<span class="line-removed">165         CFRelease(cflocale);</span>
<span class="line-removed">166     }</span>
<span class="line-removed">167 </span>
<span class="line-removed">168     return ampms;</span>
169 }
170 
171 /*
172  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
173  * Method:    getEras
174  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
175  */
176 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getEras
177   (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray eras) {
<span class="line-modified">178     CFLocaleRef cflocale = CFLocaleCopyCurrent();</span>
<span class="line-removed">179     if (cflocale != NULL) {</span>
<span class="line-removed">180         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,</span>
<span class="line-removed">181                                                   cflocale,</span>
<span class="line-removed">182                                                   kCFDateFormatterFullStyle,</span>
<span class="line-removed">183                                                   kCFDateFormatterFullStyle);</span>
<span class="line-removed">184         if (df != NULL) {</span>
<span class="line-removed">185             CFArrayRef cferas = CFDateFormatterCopyProperty(df, kCFDateFormatterEraSymbols);</span>
<span class="line-removed">186             if (cferas != NULL) {</span>
<span class="line-removed">187                 copyArrayElements(env, cferas, eras, 0, 0, CFArrayGetCount(cferas));</span>
<span class="line-removed">188                 CFRelease(cferas);</span>
<span class="line-removed">189             }</span>
<span class="line-removed">190             CFRelease(df);</span>
<span class="line-removed">191         }</span>
<span class="line-removed">192         CFRelease(cflocale);</span>
<span class="line-removed">193     }</span>
<span class="line-removed">194 </span>
<span class="line-removed">195     return eras;</span>
196 }
197 
198 /*
199  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
200  * Method:    getMonths
201  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
202  */
203 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getMonths
204   (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray months) {
205     CFLocaleRef cflocale = CFLocaleCopyCurrent();
206     if (cflocale != NULL) {
207         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,
208                                                   cflocale,
209                                                   kCFDateFormatterFullStyle,
210                                                   kCFDateFormatterFullStyle);
211         if (df != NULL) {
212             CFArrayRef cfmonths = CFDateFormatterCopyProperty(df, kCFDateFormatterMonthSymbols);
213             if (cfmonths != NULL) {
214                 copyArrayElements(env, cfmonths, months, 0, 0, CFArrayGetCount(cfmonths));
215                 CFRelease(cfmonths);
</pre>
<hr />
<pre>
238         if (df != NULL) {
239             CFArrayRef cfsmonths = CFDateFormatterCopyProperty(df, kCFDateFormatterShortMonthSymbols);
240             if (cfsmonths != NULL) {
241                 copyArrayElements(env, cfsmonths, smonths, 0, 0, CFArrayGetCount(cfsmonths));
242                 CFRelease(cfsmonths);
243             }
244             CFRelease(df);
245         }
246         CFRelease(cflocale);
247     }
248 
249     return smonths;
250 }
251 
252 /*
253  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
254  * Method:    getWeekdays
255  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
256  */
257 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getWeekdays
<span class="line-modified">258   (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray wdays) {</span>
<span class="line-modified">259     CFLocaleRef cflocale = CFLocaleCopyCurrent();</span>
<span class="line-removed">260     if (cflocale != NULL) {</span>
<span class="line-removed">261         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,</span>
<span class="line-removed">262                                                   cflocale,</span>
<span class="line-removed">263                                                   kCFDateFormatterFullStyle,</span>
<span class="line-removed">264                                                   kCFDateFormatterFullStyle);</span>
<span class="line-removed">265         if (df != NULL) {</span>
<span class="line-removed">266             CFArrayRef cfwdays = CFDateFormatterCopyProperty(df, kCFDateFormatterWeekdaySymbols);</span>
<span class="line-removed">267             if (cfwdays != NULL) {</span>
<span class="line-removed">268                 copyArrayElements(env, cfwdays, wdays, 0, 1, CFArrayGetCount(cfwdays));</span>
<span class="line-removed">269                 CFRelease(cfwdays);</span>
<span class="line-removed">270             }</span>
<span class="line-removed">271             CFRelease(df);</span>
<span class="line-removed">272         }</span>
<span class="line-removed">273         CFRelease(cflocale);</span>
<span class="line-removed">274     }</span>
<span class="line-removed">275 </span>
<span class="line-removed">276     return wdays;</span>
277 }
278 
279 /*
280  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
281  * Method:    getShortWeekdays
282  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
283  */
284 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getShortWeekdays
285   (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray swdays) {
286     CFLocaleRef cflocale = CFLocaleCopyCurrent();
287     if (cflocale != NULL) {
288         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,
289                                                   cflocale,
290                                                   kCFDateFormatterFullStyle,
291                                                   kCFDateFormatterFullStyle);
292         if (df != NULL) {
293             CFArrayRef cfswdays = CFDateFormatterCopyProperty(df, kCFDateFormatterShortWeekdaySymbols);
294             if (cfswdays != NULL) {
295                 copyArrayElements(env, cfswdays, swdays, 0, 1, CFArrayGetCount(cfswdays));
296                 CFRelease(cfswdays);
</pre>
<hr />
<pre>
489     CFCalendarRef cfcal = CFCalendarCopyCurrent();
490 
491     if (cfcal != NULL) {
492         switch (type) {
493             case sun_util_locale_provider_HostLocaleProviderAdapterImpl_CD_FIRSTDAYOFWEEK:
494                 ret = CFCalendarGetFirstWeekday(cfcal);
495                 break;
496             case sun_util_locale_provider_HostLocaleProviderAdapterImpl_CD_MINIMALDAYSINFIRSTWEEK:
497                 ret = CFCalendarGetMinimumDaysInFirstWeek(cfcal);
498                 break;
499             default:
500                 ret = 0;
501         }
502 
503         CFRelease(cfcal);
504     }
505 
506     return ret;
507 }
508 























509 /*
510  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
511  * Method:    getDisplayString
512  * Signature: (Ljava/lang/String;ILjava/lang/String;)Ljava/lang/String;
513  */
514 JNIEXPORT jstring JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getDisplayString
515   (JNIEnv *env, jclass cls, jstring jlangtag, jint type, jstring value) {
516     jstring ret = NULL;
517 
518     const char *clangtag = (*env)-&gt;GetStringUTFChars(env, jlangtag, 0);
519     if (clangtag != NULL) {
520         const char *cvalue = (*env)-&gt;GetStringUTFChars(env, value, 0);
521         if (cvalue != NULL) {
522             CFStringRef cflangtag =
523                 CFStringCreateWithCString(kCFAllocatorDefault, clangtag, kCFStringEncodingUTF8);
524             if (cflangtag != NULL) {
525                 CFLocaleRef cflocale = CFLocaleCreate(kCFAllocatorDefault, cflangtag);
526                 if (cflocale != NULL) {
527                     CFStringRef cfvalue =
528                         CFStringCreateWithCString(kCFAllocatorDefault, cvalue, kCFStringEncodingUTF8);
</pre>
<hr />
<pre>
708         CFNumberFormatterRef nf = CFNumberFormatterCreate(kCFAllocatorDefault,
709                                                   cflocale,
710                                                   kCFNumberFormatterNoStyle);
711         if (nf != NULL) {
712             CFStringRef str = CFNumberFormatterCopyProperty(nf, type);
713             if (str != NULL) {
714                 if (CFStringGetLength(str) &gt; 0) {
715                     ret = CFStringGetCharacterAtIndex(str, 0);
716                 }
717                 CFRelease(str);
718             }
719 
720             CFRelease(nf);
721         }
722 
723         CFRelease(cflocale);
724     }
725 
726     return ret;
727 }





































































































</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;sun_util_locale_provider_HostLocaleProviderAdapterImpl.h&quot;
 27 #include &quot;jni_util.h&quot;
 28 #include &lt;CoreFoundation/CoreFoundation.h&gt;
 29 #include &lt;stdio.h&gt;
 30 
 31 #define BUFLEN 256
 32 
<span class="line-added"> 33 // java.util.Calendar constants</span>
<span class="line-added"> 34 #define CALENDAR_FIELD_ERA              0           // Calendar.ERA</span>
<span class="line-added"> 35 #define CALENDAR_FIELD_DAY_OF_WEEK      7           // Calendar.DAY_OF_WEEK</span>
<span class="line-added"> 36 #define CALENDAR_FIELD_AM_PM            9           // Calendar.AM_PM</span>
<span class="line-added"> 37 #define JAPANESE_MEIJI_INDEX            232</span>
<span class="line-added"> 38 </span>
 39 static CFDateFormatterStyle convertDateFormatterStyle(jint javaStyle);
 40 static CFNumberFormatterStyle convertNumberFormatterStyle(jint javaStyle);
 41 static void copyArrayElements(JNIEnv *env, CFArrayRef cfarray, jobjectArray jarray, CFIndex sindex, int dindex, int count);
 42 static jstring getNumberSymbolString(JNIEnv *env, jstring jlangtag, jstring jdefault, CFStringRef type);
 43 static jchar getNumberSymbolChar(JNIEnv *env, jstring jlangtag, jchar jdefault, CFStringRef type);
<span class="line-added"> 44 jobjectArray getErasImpl(JNIEnv *env, jstring jlangtag, jint style, jobjectArray eras);</span>
<span class="line-added"> 45 jobjectArray getWeekdaysImpl(JNIEnv *env, jclass cls, jstring jlangtag, jint style, jobjectArray wdays);</span>
<span class="line-added"> 46 jobjectArray getAmPmImpl(JNIEnv *env, jclass cls, jstring jlangtag, jint style, jobjectArray ampms);</span>
 47 
 48 // from java_props_macosx.c
 49 extern char * getMacOSXLocale(int cat);
 50 extern char * getPosixLocale(int cat);
 51 
 52 /*
 53  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
 54  * Method:    getDefaultLocale
 55  * Signature: (I)Ljava/lang/String;
 56  */
 57 JNIEXPORT jstring JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getDefaultLocale
 58   (JNIEnv *env, jclass cls, jint cat) {
 59     char * localeString = NULL;
 60     int posixCat;
 61     jstring ret = NULL;
 62 
 63     switch (cat) {
 64         case sun_util_locale_provider_HostLocaleProviderAdapterImpl_CAT_DISPLAY:
 65             posixCat = LC_MESSAGES;
 66             break;
</pre>
<hr />
<pre>
123     CFLocaleRef cflocale = CFLocaleCopyCurrent();
124 
125     if (cflocale != NULL) {
126         char buf[BUFLEN];
127         CFTypeRef calid = CFLocaleGetValue(cflocale, kCFLocaleCalendarIdentifier);
128         CFStringGetCString((CFStringRef)calid, buf, BUFLEN, kCFStringEncodingUTF8);
129         ret = (*env)-&gt;NewStringUTF(env, buf);
130         CFRelease(cflocale);
131     }
132 
133     return ret;
134 }
135 
136 /*
137  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
138  * Method:    getAmPmStrings
139  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
140  */
141 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getAmPmStrings
142   (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray ampms) {
<span class="line-modified">143       return getAmPmImpl(env, cls, jlangtag, 0, ampms);</span>


































144 }
145 
146 /*
147  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
148  * Method:    getEras
149  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
150  */
151 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getEras
152   (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray eras) {
<span class="line-modified">153     return getErasImpl(env, jlangtag, 0, eras);</span>

















154 }
155 
156 /*
157  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
158  * Method:    getMonths
159  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
160  */
161 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getMonths
162   (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray months) {
163     CFLocaleRef cflocale = CFLocaleCopyCurrent();
164     if (cflocale != NULL) {
165         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,
166                                                   cflocale,
167                                                   kCFDateFormatterFullStyle,
168                                                   kCFDateFormatterFullStyle);
169         if (df != NULL) {
170             CFArrayRef cfmonths = CFDateFormatterCopyProperty(df, kCFDateFormatterMonthSymbols);
171             if (cfmonths != NULL) {
172                 copyArrayElements(env, cfmonths, months, 0, 0, CFArrayGetCount(cfmonths));
173                 CFRelease(cfmonths);
</pre>
<hr />
<pre>
196         if (df != NULL) {
197             CFArrayRef cfsmonths = CFDateFormatterCopyProperty(df, kCFDateFormatterShortMonthSymbols);
198             if (cfsmonths != NULL) {
199                 copyArrayElements(env, cfsmonths, smonths, 0, 0, CFArrayGetCount(cfsmonths));
200                 CFRelease(cfsmonths);
201             }
202             CFRelease(df);
203         }
204         CFRelease(cflocale);
205     }
206 
207     return smonths;
208 }
209 
210 /*
211  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
212  * Method:    getWeekdays
213  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
214  */
215 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getWeekdays
<span class="line-modified">216     (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray wdays) {</span>
<span class="line-modified">217     return getWeekdaysImpl(env, cls, jlangtag, 0, wdays);</span>

















218 }
219 
220 /*
221  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
222  * Method:    getShortWeekdays
223  * Signature: (Ljava/lang/String;[Ljava/lang/String;)[Ljava/lang/String;
224  */
225 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getShortWeekdays
226   (JNIEnv *env, jclass cls, jstring jlangtag, jobjectArray swdays) {
227     CFLocaleRef cflocale = CFLocaleCopyCurrent();
228     if (cflocale != NULL) {
229         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,
230                                                   cflocale,
231                                                   kCFDateFormatterFullStyle,
232                                                   kCFDateFormatterFullStyle);
233         if (df != NULL) {
234             CFArrayRef cfswdays = CFDateFormatterCopyProperty(df, kCFDateFormatterShortWeekdaySymbols);
235             if (cfswdays != NULL) {
236                 copyArrayElements(env, cfswdays, swdays, 0, 1, CFArrayGetCount(cfswdays));
237                 CFRelease(cfswdays);
</pre>
<hr />
<pre>
430     CFCalendarRef cfcal = CFCalendarCopyCurrent();
431 
432     if (cfcal != NULL) {
433         switch (type) {
434             case sun_util_locale_provider_HostLocaleProviderAdapterImpl_CD_FIRSTDAYOFWEEK:
435                 ret = CFCalendarGetFirstWeekday(cfcal);
436                 break;
437             case sun_util_locale_provider_HostLocaleProviderAdapterImpl_CD_MINIMALDAYSINFIRSTWEEK:
438                 ret = CFCalendarGetMinimumDaysInFirstWeek(cfcal);
439                 break;
440             default:
441                 ret = 0;
442         }
443 
444         CFRelease(cfcal);
445     }
446 
447     return ret;
448 }
449 
<span class="line-added">450 /*</span>
<span class="line-added">451  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl</span>
<span class="line-added">452  * Method:    getCalendarDisplayStrings</span>
<span class="line-added">453  * Signature: (Ljava/lang/String;III)[Ljava/lang/String;</span>
<span class="line-added">454  */</span>
<span class="line-added">455 JNIEXPORT jobjectArray JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getCalendarDisplayStrings</span>
<span class="line-added">456   (JNIEnv *env, jclass cls, jstring jlangtag, jint field, jint style) {</span>
<span class="line-added">457     switch (field) {</span>
<span class="line-added">458     case CALENDAR_FIELD_ERA:</span>
<span class="line-added">459         return getErasImpl(env, jlangtag, style, NULL);</span>
<span class="line-added">460 </span>
<span class="line-added">461     case CALENDAR_FIELD_DAY_OF_WEEK:</span>
<span class="line-added">462         return getWeekdaysImpl(env, cls, jlangtag, style, NULL);</span>
<span class="line-added">463 </span>
<span class="line-added">464     case CALENDAR_FIELD_AM_PM:</span>
<span class="line-added">465         return getAmPmImpl(env, cls, jlangtag, style, NULL);</span>
<span class="line-added">466 </span>
<span class="line-added">467     default:</span>
<span class="line-added">468         // not supported</span>
<span class="line-added">469         return NULL;</span>
<span class="line-added">470     }</span>
<span class="line-added">471 }</span>
<span class="line-added">472 </span>
473 /*
474  * Class:     sun_util_locale_provider_HostLocaleProviderAdapterImpl
475  * Method:    getDisplayString
476  * Signature: (Ljava/lang/String;ILjava/lang/String;)Ljava/lang/String;
477  */
478 JNIEXPORT jstring JNICALL Java_sun_util_locale_provider_HostLocaleProviderAdapterImpl_getDisplayString
479   (JNIEnv *env, jclass cls, jstring jlangtag, jint type, jstring value) {
480     jstring ret = NULL;
481 
482     const char *clangtag = (*env)-&gt;GetStringUTFChars(env, jlangtag, 0);
483     if (clangtag != NULL) {
484         const char *cvalue = (*env)-&gt;GetStringUTFChars(env, value, 0);
485         if (cvalue != NULL) {
486             CFStringRef cflangtag =
487                 CFStringCreateWithCString(kCFAllocatorDefault, clangtag, kCFStringEncodingUTF8);
488             if (cflangtag != NULL) {
489                 CFLocaleRef cflocale = CFLocaleCreate(kCFAllocatorDefault, cflangtag);
490                 if (cflocale != NULL) {
491                     CFStringRef cfvalue =
492                         CFStringCreateWithCString(kCFAllocatorDefault, cvalue, kCFStringEncodingUTF8);
</pre>
<hr />
<pre>
672         CFNumberFormatterRef nf = CFNumberFormatterCreate(kCFAllocatorDefault,
673                                                   cflocale,
674                                                   kCFNumberFormatterNoStyle);
675         if (nf != NULL) {
676             CFStringRef str = CFNumberFormatterCopyProperty(nf, type);
677             if (str != NULL) {
678                 if (CFStringGetLength(str) &gt; 0) {
679                     ret = CFStringGetCharacterAtIndex(str, 0);
680                 }
681                 CFRelease(str);
682             }
683 
684             CFRelease(nf);
685         }
686 
687         CFRelease(cflocale);
688     }
689 
690     return ret;
691 }
<span class="line-added">692 </span>
<span class="line-added">693 jobjectArray getErasImpl(JNIEnv *env, jstring jlangtag, jint style, jobjectArray eras) {</span>
<span class="line-added">694     jobjectArray ret = eras;</span>
<span class="line-added">695     CFLocaleRef cflocale = CFLocaleCopyCurrent();</span>
<span class="line-added">696     if (cflocale != NULL) {</span>
<span class="line-added">697         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,</span>
<span class="line-added">698                                                   cflocale,</span>
<span class="line-added">699                                                   convertDateFormatterStyle(style),</span>
<span class="line-added">700                                                   convertDateFormatterStyle(style));</span>
<span class="line-added">701         if (df != NULL) {</span>
<span class="line-added">702             CFArrayRef cferas = CFDateFormatterCopyProperty(df, kCFDateFormatterEraSymbols);</span>
<span class="line-added">703             if (cferas != NULL) {</span>
<span class="line-added">704                 int eraCount = CFArrayGetCount(cferas);</span>
<span class="line-added">705 </span>
<span class="line-added">706                 if (eras == NULL) {</span>
<span class="line-added">707                     ret = (*env)-&gt;NewObjectArray(env, (jsize)eraCount,</span>
<span class="line-added">708                         (*env)-&gt;FindClass(env, &quot;java/lang/String&quot;), NULL);</span>
<span class="line-added">709                 }</span>
<span class="line-added">710                 CFTypeRef cal = CFLocaleGetValue(cflocale, kCFLocaleCalendarIdentifier);</span>
<span class="line-added">711                 int sindex = cal == kCFJapaneseCalendar ? JAPANESE_MEIJI_INDEX : 0;</span>
<span class="line-added">712                 int dindex = cal == kCFJapaneseCalendar ? 1 : 0; // 0 is &quot;BeforeMeiji&quot; in JCal</span>
<span class="line-added">713                 copyArrayElements(env, cferas, ret, sindex, dindex, eraCount - sindex);</span>
<span class="line-added">714                 CFRelease(cferas);</span>
<span class="line-added">715             }</span>
<span class="line-added">716             CFRelease(df);</span>
<span class="line-added">717         }</span>
<span class="line-added">718         CFRelease(cflocale);</span>
<span class="line-added">719     }</span>
<span class="line-added">720 </span>
<span class="line-added">721     return ret;</span>
<span class="line-added">722 }</span>
<span class="line-added">723 </span>
<span class="line-added">724 jobjectArray getWeekdaysImpl(JNIEnv *env, jclass cls, jstring jlangtag, jint style, jobjectArray wdays) {</span>
<span class="line-added">725     jobjectArray ret = wdays;</span>
<span class="line-added">726     CFLocaleRef cflocale = CFLocaleCopyCurrent();</span>
<span class="line-added">727     if (cflocale != NULL) {</span>
<span class="line-added">728         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,</span>
<span class="line-added">729                                                   cflocale,</span>
<span class="line-added">730                                                   convertDateFormatterStyle(style),</span>
<span class="line-added">731                                                   convertDateFormatterStyle(style));</span>
<span class="line-added">732         if (df != NULL) {</span>
<span class="line-added">733             CFArrayRef cfwdays = CFDateFormatterCopyProperty(df, kCFDateFormatterWeekdaySymbols);</span>
<span class="line-added">734             if (cfwdays != NULL) {</span>
<span class="line-added">735                 int dayCount = CFArrayGetCount(cfwdays);</span>
<span class="line-added">736 </span>
<span class="line-added">737                 if (wdays == NULL) {</span>
<span class="line-added">738                     ret = (*env)-&gt;NewObjectArray(env, dayCount + 1,</span>
<span class="line-added">739                         (*env)-&gt;FindClass(env, &quot;java/lang/String&quot;), NULL);</span>
<span class="line-added">740                 }</span>
<span class="line-added">741                 copyArrayElements(env, cfwdays, ret, 0, 1, dayCount);</span>
<span class="line-added">742                 CFRelease(cfwdays);</span>
<span class="line-added">743             }</span>
<span class="line-added">744             CFRelease(df);</span>
<span class="line-added">745         }</span>
<span class="line-added">746         CFRelease(cflocale);</span>
<span class="line-added">747     }</span>
<span class="line-added">748 </span>
<span class="line-added">749     return ret;</span>
<span class="line-added">750 }</span>
<span class="line-added">751 </span>
<span class="line-added">752 jobjectArray getAmPmImpl(JNIEnv *env, jclass cls, jstring jlangtag, jint style, jobjectArray ampms) {</span>
<span class="line-added">753     CFLocaleRef cflocale = CFLocaleCopyCurrent();</span>
<span class="line-added">754     jstring tmp_string;</span>
<span class="line-added">755     if (cflocale != NULL) {</span>
<span class="line-added">756         CFDateFormatterRef df = CFDateFormatterCreate(kCFAllocatorDefault,</span>
<span class="line-added">757                                                   cflocale,</span>
<span class="line-added">758                                                   convertDateFormatterStyle(style),</span>
<span class="line-added">759                                                   convertDateFormatterStyle(style));</span>
<span class="line-added">760         if (df != NULL) {</span>
<span class="line-added">761             char buf[BUFLEN];</span>
<span class="line-added">762             if (ampms == NULL) {</span>
<span class="line-added">763                 ampms = (*env)-&gt;NewObjectArray(env, 2,</span>
<span class="line-added">764                     (*env)-&gt;FindClass(env, &quot;java/lang/String&quot;), NULL);</span>
<span class="line-added">765             }</span>
<span class="line-added">766             CFStringRef amStr = CFDateFormatterCopyProperty(df, kCFDateFormatterAMSymbol);</span>
<span class="line-added">767             if (amStr != NULL) {</span>
<span class="line-added">768                 CFStringGetCString(amStr, buf, BUFLEN, kCFStringEncodingUTF8);</span>
<span class="line-added">769                 CFRelease(amStr);</span>
<span class="line-added">770                 tmp_string = (*env)-&gt;NewStringUTF(env, buf);</span>
<span class="line-added">771                 if (tmp_string != NULL) {</span>
<span class="line-added">772                     (*env)-&gt;SetObjectArrayElement(env, ampms, 0, tmp_string);</span>
<span class="line-added">773                 }</span>
<span class="line-added">774             }</span>
<span class="line-added">775             if (!(*env)-&gt;ExceptionCheck(env)){</span>
<span class="line-added">776                 CFStringRef pmStr = CFDateFormatterCopyProperty(df, kCFDateFormatterPMSymbol);</span>
<span class="line-added">777                 if (pmStr != NULL) {</span>
<span class="line-added">778                     CFStringGetCString(pmStr, buf, BUFLEN, kCFStringEncodingUTF8);</span>
<span class="line-added">779                     CFRelease(pmStr);</span>
<span class="line-added">780                     tmp_string = (*env)-&gt;NewStringUTF(env, buf);</span>
<span class="line-added">781                     if (tmp_string != NULL) {</span>
<span class="line-added">782                         (*env)-&gt;SetObjectArrayElement(env, ampms, 1, tmp_string);</span>
<span class="line-added">783                     }</span>
<span class="line-added">784                 }</span>
<span class="line-added">785             }</span>
<span class="line-added">786             CFRelease(df);</span>
<span class="line-added">787         }</span>
<span class="line-added">788         CFRelease(cflocale);</span>
<span class="line-added">789     }</span>
<span class="line-added">790 </span>
<span class="line-added">791     return ampms;</span>
<span class="line-added">792 }</span>
</pre>
</td>
</tr>
</table>
<center><a href="../../classes/sun/util/locale/provider/HostLocaleProviderAdapterImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="java_props_macosx.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>