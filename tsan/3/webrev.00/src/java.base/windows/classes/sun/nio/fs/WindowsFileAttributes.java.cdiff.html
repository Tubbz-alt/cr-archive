<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/windows/classes/sun/nio/fs/WindowsFileAttributes.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="WindowsConstants.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="WindowsFileStore.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/windows/classes/sun/nio/fs/WindowsFileAttributes.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2008, 2012, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 106,12 ***</span>
      private static final short OFFSETOF_FIND_DATA_LASTWRITETIME = 20;
      private static final short OFFSETOF_FIND_DATA_SIZEHIGH = 28;
      private static final short OFFSETOF_FIND_DATA_SIZELOW = 32;
      private static final short OFFSETOF_FIND_DATA_RESERVED0 = 36;
  
<span class="line-modified">!     // used to adjust values between Windows and java epoch</span>
<span class="line-modified">!     private static final long WINDOWS_EPOCH_IN_MICROSECONDS = -11644473600000000L;</span>
  
      // indicates if accurate metadata is required (interesting on NTFS only)
      private static final boolean ensureAccurateMetadata;
      static {
          String propValue = GetPropertyAction.privilegedGetProperty(
<span class="line-new-header">--- 106,13 ---</span>
      private static final short OFFSETOF_FIND_DATA_LASTWRITETIME = 20;
      private static final short OFFSETOF_FIND_DATA_SIZEHIGH = 28;
      private static final short OFFSETOF_FIND_DATA_SIZELOW = 32;
      private static final short OFFSETOF_FIND_DATA_RESERVED0 = 36;
  
<span class="line-modified">!     // used to adjust values between Windows and java epochs</span>
<span class="line-modified">!     private static final long WINDOWS_EPOCH_IN_MICROS = -11644473600000000L;</span>
<span class="line-added">+     private static final long WINDOWS_EPOCH_IN_100NS  = -116444736000000000L;</span>
  
      // indicates if accurate metadata is required (interesting on NTFS only)
      private static final boolean ensureAccurateMetadata;
      static {
          String propValue = GetPropertyAction.privilegedGetProperty(
</pre>
<hr />
<pre>
<span class="line-old-header">*** 135,28 ***</span>
      /**
       * Convert 64-bit value representing the number of 100-nanosecond intervals
       * since January 1, 1601 to a FileTime.
       */
      static FileTime toFileTime(long time) {
<span class="line-modified">!         // 100ns -&gt; us</span>
<span class="line-modified">!         time /= 10L;</span>
<span class="line-modified">!         // adjust to java epoch</span>
<span class="line-modified">!         time += WINDOWS_EPOCH_IN_MICROSECONDS;</span>
<span class="line-modified">!         return FileTime.from(time, TimeUnit.MICROSECONDS);</span>
      }
  
      /**
<span class="line-modified">!      * Convert FileTime to 64-bit value representing the number of 100-nanosecond</span>
<span class="line-modified">!      * intervals since January 1, 1601.</span>
       */
      static long toWindowsTime(FileTime time) {
<span class="line-modified">!         long value = time.to(TimeUnit.MICROSECONDS);</span>
<span class="line-modified">!         // adjust to Windows epoch+= 11644473600000000L;</span>
<span class="line-removed">-         value -= WINDOWS_EPOCH_IN_MICROSECONDS;</span>
<span class="line-removed">-         // us -&gt; 100ns</span>
<span class="line-removed">-         value *= 10L;</span>
<span class="line-removed">-         return value;</span>
      }
  
      /**
       * Initialize a new instance of this class
       */
<span class="line-new-header">--- 136,27 ---</span>
      /**
       * Convert 64-bit value representing the number of 100-nanosecond intervals
       * since January 1, 1601 to a FileTime.
       */
      static FileTime toFileTime(long time) {
<span class="line-modified">!         try {</span>
<span class="line-modified">!             long adjusted = Math.addExact(time, WINDOWS_EPOCH_IN_100NS);</span>
<span class="line-modified">!             long nanos = Math.multiplyExact(adjusted, 100L);</span>
<span class="line-modified">!             return FileTime.from(nanos, TimeUnit.NANOSECONDS);</span>
<span class="line-modified">!         } catch (ArithmeticException e) {</span>
<span class="line-added">+             long micros = Math.addExact(time/10L, WINDOWS_EPOCH_IN_MICROS);</span>
<span class="line-added">+             return FileTime.from(micros, TimeUnit.MICROSECONDS);</span>
<span class="line-added">+         }</span>
      }
  
      /**
<span class="line-modified">!      * Convert FileTime to 64-bit value representing the number of</span>
<span class="line-modified">!      * 100-nanosecond intervals since January 1, 1601.</span>
       */
      static long toWindowsTime(FileTime time) {
<span class="line-modified">!         long adjusted = time.to(TimeUnit.NANOSECONDS)/100L;</span>
<span class="line-modified">!         return adjusted - WINDOWS_EPOCH_IN_100NS;</span>
      }
  
      /**
       * Initialize a new instance of this class
       */
</pre>
<center><a href="WindowsConstants.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="WindowsFileStore.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>