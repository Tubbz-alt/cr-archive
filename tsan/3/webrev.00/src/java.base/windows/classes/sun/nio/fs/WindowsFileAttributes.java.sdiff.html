<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/windows/classes/sun/nio/fs/WindowsFileAttributes.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="WindowsConstants.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="WindowsFileStore.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/windows/classes/sun/nio/fs/WindowsFileAttributes.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2008, 2012, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 91      *   FILETIME ftCreationTime;
 92      *   FILETIME ftLastAccessTime;
 93      *   FILETIME ftLastWriteTime;
 94      *   DWORD nFileSizeHigh;
 95      *   DWORD nFileSizeLow;
 96      *   DWORD dwReserved0;
 97      *   DWORD dwReserved1;
 98      *   TCHAR cFileName[MAX_PATH];
 99      *   TCHAR cAlternateFileName[14];
100      * } WIN32_FIND_DATA;
101      */
102     private static final short SIZEOF_FIND_DATA = 592;
103     private static final short OFFSETOF_FIND_DATA_ATTRIBUTES = 0;
104     private static final short OFFSETOF_FIND_DATA_CREATETIME = 4;
105     private static final short OFFSETOF_FIND_DATA_LASTACCESSTIME = 12;
106     private static final short OFFSETOF_FIND_DATA_LASTWRITETIME = 20;
107     private static final short OFFSETOF_FIND_DATA_SIZEHIGH = 28;
108     private static final short OFFSETOF_FIND_DATA_SIZELOW = 32;
109     private static final short OFFSETOF_FIND_DATA_RESERVED0 = 36;
110 
<span class="line-modified">111     // used to adjust values between Windows and java epoch</span>
<span class="line-modified">112     private static final long WINDOWS_EPOCH_IN_MICROSECONDS = -11644473600000000L;</span>

113 
114     // indicates if accurate metadata is required (interesting on NTFS only)
115     private static final boolean ensureAccurateMetadata;
116     static {
117         String propValue = GetPropertyAction.privilegedGetProperty(
118             &quot;sun.nio.fs.ensureAccurateMetadata&quot;, &quot;false&quot;);
119         ensureAccurateMetadata = propValue.isEmpty() ? true : Boolean.parseBoolean(propValue);
120     }
121 
122     // attributes
123     private final int fileAttrs;
124     private final long creationTime;
125     private final long lastAccessTime;
126     private final long lastWriteTime;
127     private final long size;
128     private final int reparseTag;
129 
130     // additional attributes when using GetFileInformationByHandle
131     private final int volSerialNumber;
132     private final int fileIndexHigh;
133     private final int fileIndexLow;
134 
135     /**
136      * Convert 64-bit value representing the number of 100-nanosecond intervals
137      * since January 1, 1601 to a FileTime.
138      */
139     static FileTime toFileTime(long time) {
<span class="line-modified">140         // 100ns -&gt; us</span>
<span class="line-modified">141         time /= 10L;</span>
<span class="line-modified">142         // adjust to java epoch</span>
<span class="line-modified">143         time += WINDOWS_EPOCH_IN_MICROSECONDS;</span>
<span class="line-modified">144         return FileTime.from(time, TimeUnit.MICROSECONDS);</span>



145     }
146 
147     /**
<span class="line-modified">148      * Convert FileTime to 64-bit value representing the number of 100-nanosecond</span>
<span class="line-modified">149      * intervals since January 1, 1601.</span>
150      */
151     static long toWindowsTime(FileTime time) {
<span class="line-modified">152         long value = time.to(TimeUnit.MICROSECONDS);</span>
<span class="line-modified">153         // adjust to Windows epoch+= 11644473600000000L;</span>
<span class="line-removed">154         value -= WINDOWS_EPOCH_IN_MICROSECONDS;</span>
<span class="line-removed">155         // us -&gt; 100ns</span>
<span class="line-removed">156         value *= 10L;</span>
<span class="line-removed">157         return value;</span>
158     }
159 
160     /**
161      * Initialize a new instance of this class
162      */
163     private WindowsFileAttributes(int fileAttrs,
164                                   long creationTime,
165                                   long lastAccessTime,
166                                   long lastWriteTime,
167                                   long size,
168                                   int reparseTag,
169                                   int volSerialNumber,
170                                   int fileIndexHigh,
171                                   int fileIndexLow)
172     {
173         this.fileAttrs = fileAttrs;
174         this.creationTime = creationTime;
175         this.lastAccessTime = lastAccessTime;
176         this.lastWriteTime = lastWriteTime;
177         this.size = size;
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 91      *   FILETIME ftCreationTime;
 92      *   FILETIME ftLastAccessTime;
 93      *   FILETIME ftLastWriteTime;
 94      *   DWORD nFileSizeHigh;
 95      *   DWORD nFileSizeLow;
 96      *   DWORD dwReserved0;
 97      *   DWORD dwReserved1;
 98      *   TCHAR cFileName[MAX_PATH];
 99      *   TCHAR cAlternateFileName[14];
100      * } WIN32_FIND_DATA;
101      */
102     private static final short SIZEOF_FIND_DATA = 592;
103     private static final short OFFSETOF_FIND_DATA_ATTRIBUTES = 0;
104     private static final short OFFSETOF_FIND_DATA_CREATETIME = 4;
105     private static final short OFFSETOF_FIND_DATA_LASTACCESSTIME = 12;
106     private static final short OFFSETOF_FIND_DATA_LASTWRITETIME = 20;
107     private static final short OFFSETOF_FIND_DATA_SIZEHIGH = 28;
108     private static final short OFFSETOF_FIND_DATA_SIZELOW = 32;
109     private static final short OFFSETOF_FIND_DATA_RESERVED0 = 36;
110 
<span class="line-modified">111     // used to adjust values between Windows and java epochs</span>
<span class="line-modified">112     private static final long WINDOWS_EPOCH_IN_MICROS = -11644473600000000L;</span>
<span class="line-added">113     private static final long WINDOWS_EPOCH_IN_100NS  = -116444736000000000L;</span>
114 
115     // indicates if accurate metadata is required (interesting on NTFS only)
116     private static final boolean ensureAccurateMetadata;
117     static {
118         String propValue = GetPropertyAction.privilegedGetProperty(
119             &quot;sun.nio.fs.ensureAccurateMetadata&quot;, &quot;false&quot;);
120         ensureAccurateMetadata = propValue.isEmpty() ? true : Boolean.parseBoolean(propValue);
121     }
122 
123     // attributes
124     private final int fileAttrs;
125     private final long creationTime;
126     private final long lastAccessTime;
127     private final long lastWriteTime;
128     private final long size;
129     private final int reparseTag;
130 
131     // additional attributes when using GetFileInformationByHandle
132     private final int volSerialNumber;
133     private final int fileIndexHigh;
134     private final int fileIndexLow;
135 
136     /**
137      * Convert 64-bit value representing the number of 100-nanosecond intervals
138      * since January 1, 1601 to a FileTime.
139      */
140     static FileTime toFileTime(long time) {
<span class="line-modified">141         try {</span>
<span class="line-modified">142             long adjusted = Math.addExact(time, WINDOWS_EPOCH_IN_100NS);</span>
<span class="line-modified">143             long nanos = Math.multiplyExact(adjusted, 100L);</span>
<span class="line-modified">144             return FileTime.from(nanos, TimeUnit.NANOSECONDS);</span>
<span class="line-modified">145         } catch (ArithmeticException e) {</span>
<span class="line-added">146             long micros = Math.addExact(time/10L, WINDOWS_EPOCH_IN_MICROS);</span>
<span class="line-added">147             return FileTime.from(micros, TimeUnit.MICROSECONDS);</span>
<span class="line-added">148         }</span>
149     }
150 
151     /**
<span class="line-modified">152      * Convert FileTime to 64-bit value representing the number of</span>
<span class="line-modified">153      * 100-nanosecond intervals since January 1, 1601.</span>
154      */
155     static long toWindowsTime(FileTime time) {
<span class="line-modified">156         long adjusted = time.to(TimeUnit.NANOSECONDS)/100L;</span>
<span class="line-modified">157         return adjusted - WINDOWS_EPOCH_IN_100NS;</span>




158     }
159 
160     /**
161      * Initialize a new instance of this class
162      */
163     private WindowsFileAttributes(int fileAttrs,
164                                   long creationTime,
165                                   long lastAccessTime,
166                                   long lastWriteTime,
167                                   long size,
168                                   int reparseTag,
169                                   int volSerialNumber,
170                                   int fileIndexHigh,
171                                   int fileIndexLow)
172     {
173         this.fileAttrs = fileAttrs;
174         this.creationTime = creationTime;
175         this.lastAccessTime = lastAccessTime;
176         this.lastWriteTime = lastWriteTime;
177         this.size = size;
</pre>
</td>
</tr>
</table>
<center><a href="WindowsConstants.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="WindowsFileStore.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>