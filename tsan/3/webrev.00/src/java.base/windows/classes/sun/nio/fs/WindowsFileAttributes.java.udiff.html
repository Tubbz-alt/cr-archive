<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/windows/classes/sun/nio/fs/WindowsFileAttributes.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="WindowsConstants.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="WindowsFileStore.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/windows/classes/sun/nio/fs/WindowsFileAttributes.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2008, 2012, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -106,12 +106,13 @@</span>
      private static final short OFFSETOF_FIND_DATA_LASTWRITETIME = 20;
      private static final short OFFSETOF_FIND_DATA_SIZEHIGH = 28;
      private static final short OFFSETOF_FIND_DATA_SIZELOW = 32;
      private static final short OFFSETOF_FIND_DATA_RESERVED0 = 36;
  
<span class="udiff-line-modified-removed">-     // used to adjust values between Windows and java epoch</span>
<span class="udiff-line-modified-removed">-     private static final long WINDOWS_EPOCH_IN_MICROSECONDS = -11644473600000000L;</span>
<span class="udiff-line-modified-added">+     // used to adjust values between Windows and java epochs</span>
<span class="udiff-line-modified-added">+     private static final long WINDOWS_EPOCH_IN_MICROS = -11644473600000000L;</span>
<span class="udiff-line-added">+     private static final long WINDOWS_EPOCH_IN_100NS  = -116444736000000000L;</span>
  
      // indicates if accurate metadata is required (interesting on NTFS only)
      private static final boolean ensureAccurateMetadata;
      static {
          String propValue = GetPropertyAction.privilegedGetProperty(
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -135,28 +136,27 @@</span>
      /**
       * Convert 64-bit value representing the number of 100-nanosecond intervals
       * since January 1, 1601 to a FileTime.
       */
      static FileTime toFileTime(long time) {
<span class="udiff-line-modified-removed">-         // 100ns -&gt; us</span>
<span class="udiff-line-modified-removed">-         time /= 10L;</span>
<span class="udiff-line-modified-removed">-         // adjust to java epoch</span>
<span class="udiff-line-modified-removed">-         time += WINDOWS_EPOCH_IN_MICROSECONDS;</span>
<span class="udiff-line-modified-removed">-         return FileTime.from(time, TimeUnit.MICROSECONDS);</span>
<span class="udiff-line-modified-added">+         try {</span>
<span class="udiff-line-modified-added">+             long adjusted = Math.addExact(time, WINDOWS_EPOCH_IN_100NS);</span>
<span class="udiff-line-modified-added">+             long nanos = Math.multiplyExact(adjusted, 100L);</span>
<span class="udiff-line-modified-added">+             return FileTime.from(nanos, TimeUnit.NANOSECONDS);</span>
<span class="udiff-line-modified-added">+         } catch (ArithmeticException e) {</span>
<span class="udiff-line-added">+             long micros = Math.addExact(time/10L, WINDOWS_EPOCH_IN_MICROS);</span>
<span class="udiff-line-added">+             return FileTime.from(micros, TimeUnit.MICROSECONDS);</span>
<span class="udiff-line-added">+         }</span>
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Convert FileTime to 64-bit value representing the number of 100-nanosecond</span>
<span class="udiff-line-modified-removed">-      * intervals since January 1, 1601.</span>
<span class="udiff-line-modified-added">+      * Convert FileTime to 64-bit value representing the number of</span>
<span class="udiff-line-modified-added">+      * 100-nanosecond intervals since January 1, 1601.</span>
       */
      static long toWindowsTime(FileTime time) {
<span class="udiff-line-modified-removed">-         long value = time.to(TimeUnit.MICROSECONDS);</span>
<span class="udiff-line-modified-removed">-         // adjust to Windows epoch+= 11644473600000000L;</span>
<span class="udiff-line-removed">-         value -= WINDOWS_EPOCH_IN_MICROSECONDS;</span>
<span class="udiff-line-removed">-         // us -&gt; 100ns</span>
<span class="udiff-line-removed">-         value *= 10L;</span>
<span class="udiff-line-removed">-         return value;</span>
<span class="udiff-line-modified-added">+         long adjusted = time.to(TimeUnit.NANOSECONDS)/100L;</span>
<span class="udiff-line-modified-added">+         return adjusted - WINDOWS_EPOCH_IN_100NS;</span>
      }
  
      /**
       * Initialize a new instance of this class
       */
</pre>
<center><a href="WindowsConstants.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="WindowsFileStore.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>