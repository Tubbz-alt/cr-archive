<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/unix/native/libnio/ch/InheritedChannel.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="IOUtil.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Net.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/unix/native/libnio/ch/InheritedChannel.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 64 
 65     return remote_ia;
 66 }
 67 
 68 JNIEXPORT jint JNICALL
 69 Java_sun_nio_ch_InheritedChannel_peerPort0(JNIEnv *env, jclass cla, jint fd)
 70 {
 71     SOCKETADDRESS sa;
 72     socklen_t len = sizeof(SOCKETADDRESS);
 73     jint remote_port = -1;
 74 
 75     if (getpeername(fd, &amp;sa.sa, &amp;len) == 0) {
 76         if (matchFamily(&amp;sa)) {
 77             NET_SockaddrToInetAddress(env, &amp;sa, (int *)&amp;remote_port);
 78         }
 79     }
 80 
 81     return remote_port;
 82 }
 83 

































 84 JNIEXPORT jint JNICALL
 85 Java_sun_nio_ch_InheritedChannel_soType0(JNIEnv *env, jclass cla, jint fd)
 86 {
 87     int sotype;
 88     socklen_t arglen = sizeof(sotype);
 89     if (getsockopt(fd, SOL_SOCKET, SO_TYPE, (void *)&amp;sotype, &amp;arglen) == 0) {
 90         if (sotype == SOCK_STREAM)
 91             return sun_nio_ch_InheritedChannel_SOCK_STREAM;
 92         if (sotype == SOCK_DGRAM)
 93             return sun_nio_ch_InheritedChannel_SOCK_DGRAM;
 94     }
 95     return sun_nio_ch_InheritedChannel_UNKNOWN;
 96 }
 97 
 98 JNIEXPORT jint JNICALL
 99 Java_sun_nio_ch_InheritedChannel_dup(JNIEnv *env, jclass cla, jint fd)
100 {
101    int newfd = dup(fd);
102    if (newfd &lt; 0) {
103         JNU_ThrowIOExceptionWithLastError(env, &quot;dup failed&quot;);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 64 
 65     return remote_ia;
 66 }
 67 
 68 JNIEXPORT jint JNICALL
 69 Java_sun_nio_ch_InheritedChannel_peerPort0(JNIEnv *env, jclass cla, jint fd)
 70 {
 71     SOCKETADDRESS sa;
 72     socklen_t len = sizeof(SOCKETADDRESS);
 73     jint remote_port = -1;
 74 
 75     if (getpeername(fd, &amp;sa.sa, &amp;len) == 0) {
 76         if (matchFamily(&amp;sa)) {
 77             NET_SockaddrToInetAddress(env, &amp;sa, (int *)&amp;remote_port);
 78         }
 79     }
 80 
 81     return remote_port;
 82 }
 83 
<span class="line-added"> 84 JNIEXPORT jint JNICALL</span>
<span class="line-added"> 85 Java_sun_nio_ch_InheritedChannel_addressFamily(JNIEnv *env, jclass cla, jint fd)</span>
<span class="line-added"> 86 {</span>
<span class="line-added"> 87     SOCKETADDRESS addr;</span>
<span class="line-added"> 88     socklen_t addrlen = sizeof(addr);</span>
<span class="line-added"> 89 </span>
<span class="line-added"> 90     if (getsockname(fd, (struct sockaddr *)&amp;addr, &amp;addrlen) &lt; 0) {</span>
<span class="line-added"> 91         return sun_nio_ch_InheritedChannel_AF_UNKNOWN;</span>
<span class="line-added"> 92     }</span>
<span class="line-added"> 93     if (addr.sa.sa_family == AF_INET) {</span>
<span class="line-added"> 94         return sun_nio_ch_InheritedChannel_AF_INET;</span>
<span class="line-added"> 95     }</span>
<span class="line-added"> 96     if (addr.sa.sa_family == AF_INET6) {</span>
<span class="line-added"> 97         return sun_nio_ch_InheritedChannel_AF_INET6;</span>
<span class="line-added"> 98     }</span>
<span class="line-added"> 99     if (addr.sa.sa_family == AF_UNIX) {</span>
<span class="line-added">100         return sun_nio_ch_InheritedChannel_AF_UNIX;</span>
<span class="line-added">101     }</span>
<span class="line-added">102     return sun_nio_ch_InheritedChannel_AF_UNKNOWN;</span>
<span class="line-added">103 }</span>
<span class="line-added">104 </span>
<span class="line-added">105 JNIEXPORT jboolean JNICALL</span>
<span class="line-added">106 Java_sun_nio_ch_InheritedChannel_isConnected(JNIEnv *env, jclass cla, jint fd)</span>
<span class="line-added">107 {</span>
<span class="line-added">108     SOCKETADDRESS addr;</span>
<span class="line-added">109     socklen_t addrlen = sizeof(addr);</span>
<span class="line-added">110 </span>
<span class="line-added">111     if (getpeername(fd, (struct sockaddr *)&amp;addr, &amp;addrlen) &lt; 0) {</span>
<span class="line-added">112         return JNI_FALSE;</span>
<span class="line-added">113     }</span>
<span class="line-added">114     return JNI_TRUE;</span>
<span class="line-added">115 }</span>
<span class="line-added">116 </span>
117 JNIEXPORT jint JNICALL
118 Java_sun_nio_ch_InheritedChannel_soType0(JNIEnv *env, jclass cla, jint fd)
119 {
120     int sotype;
121     socklen_t arglen = sizeof(sotype);
122     if (getsockopt(fd, SOL_SOCKET, SO_TYPE, (void *)&amp;sotype, &amp;arglen) == 0) {
123         if (sotype == SOCK_STREAM)
124             return sun_nio_ch_InheritedChannel_SOCK_STREAM;
125         if (sotype == SOCK_DGRAM)
126             return sun_nio_ch_InheritedChannel_SOCK_DGRAM;
127     }
128     return sun_nio_ch_InheritedChannel_UNKNOWN;
129 }
130 
131 JNIEXPORT jint JNICALL
132 Java_sun_nio_ch_InheritedChannel_dup(JNIEnv *env, jclass cla, jint fd)
133 {
134    int newfd = dup(fd);
135    if (newfd &lt; 0) {
136         JNU_ThrowIOExceptionWithLastError(env, &quot;dup failed&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="IOUtil.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="Net.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>