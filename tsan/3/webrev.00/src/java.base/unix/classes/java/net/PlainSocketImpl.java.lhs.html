<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.base/unix/classes/java/net/PlainSocketImpl.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2007, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package java.net;
 26 
 27 import java.io.IOException;
<a name="1" id="anc1"></a><span class="line-removed"> 28 import java.io.FileDescriptor;</span>
 29 import java.util.Set;
 30 import java.util.HashSet;
 31 import sun.net.ext.ExtendedSocketOptions;
 32 
 33 /*
 34  * On Unix systems we simply delegate to native methods.
 35  *
 36  * @author Chris Hegarty
 37  */
 38 
 39 class PlainSocketImpl extends AbstractPlainSocketImpl
 40 {
 41     static {
 42         initProto();
 43     }
 44 
 45     /**
 46      * Constructs an empty instance.
 47      */
<a name="2" id="anc2"></a><span class="line-modified"> 48     PlainSocketImpl() { }</span>
<span class="line-modified"> 49 </span>
<span class="line-removed"> 50     /**</span>
<span class="line-removed"> 51      * Constructs an instance with the given file descriptor.</span>
<span class="line-removed"> 52      */</span>
<span class="line-removed"> 53     PlainSocketImpl(FileDescriptor fd) {</span>
<span class="line-removed"> 54         this.fd = fd;</span>
<span class="line-removed"> 55     }</span>
<span class="line-removed"> 56 </span>
<span class="line-removed"> 57     static final ExtendedSocketOptions extendedOptions =</span>
<span class="line-removed"> 58             ExtendedSocketOptions.getInstance();</span>
<span class="line-removed"> 59 </span>
<span class="line-removed"> 60     protected &lt;T&gt; void setOption(SocketOption&lt;T&gt; name, T value) throws IOException {</span>
<span class="line-removed"> 61         if (isClosedOrPending()) {</span>
<span class="line-removed"> 62             throw new SocketException(&quot;Socket closed&quot;);</span>
<span class="line-removed"> 63         }</span>
<span class="line-removed"> 64         if (supportedOptions().contains(name)) {</span>
<span class="line-removed"> 65             if (extendedOptions.isOptionSupported(name)) {</span>
<span class="line-removed"> 66                 extendedOptions.setOption(fd, name, value);</span>
<span class="line-removed"> 67             } else {</span>
<span class="line-removed"> 68                 super.setOption(name, value);</span>
<span class="line-removed"> 69             }</span>
<span class="line-removed"> 70         } else {</span>
<span class="line-removed"> 71             throw new UnsupportedOperationException(&quot;unsupported option&quot;);</span>
<span class="line-removed"> 72         }</span>
<span class="line-removed"> 73     }</span>
<span class="line-removed"> 74 </span>
<span class="line-removed"> 75     @SuppressWarnings(&quot;unchecked&quot;)</span>
<span class="line-removed"> 76     protected &lt;T&gt; T getOption(SocketOption&lt;T&gt; name) throws IOException {</span>
<span class="line-removed"> 77         if (isClosedOrPending()) {</span>
<span class="line-removed"> 78             throw new SocketException(&quot;Socket closed&quot;);</span>
<span class="line-removed"> 79         }</span>
<span class="line-removed"> 80         if (supportedOptions().contains(name)) {</span>
<span class="line-removed"> 81             if (extendedOptions.isOptionSupported(name)) {</span>
<span class="line-removed"> 82                 return (T) extendedOptions.getOption(fd, name);</span>
<span class="line-removed"> 83             } else {</span>
<span class="line-removed"> 84                 return super.getOption(name);</span>
<span class="line-removed"> 85             }</span>
<span class="line-removed"> 86         } else {</span>
<span class="line-removed"> 87             throw new UnsupportedOperationException(&quot;unsupported option&quot;);</span>
<span class="line-removed"> 88         }</span>
<span class="line-removed"> 89     }</span>
<span class="line-removed"> 90 </span>
<span class="line-removed"> 91     protected Set&lt;SocketOption&lt;?&gt;&gt; supportedOptions() {</span>
<span class="line-removed"> 92         HashSet&lt;SocketOption&lt;?&gt;&gt; options = new HashSet&lt;&gt;(super.supportedOptions());</span>
<span class="line-removed"> 93         if (getServerSocket() != null) {</span>
<span class="line-removed"> 94             options.addAll(ExtendedSocketOptions.serverSocketOptions());</span>
<span class="line-removed"> 95         } else {</span>
<span class="line-removed"> 96             options.addAll(ExtendedSocketOptions.clientSocketOptions());</span>
<span class="line-removed"> 97         }</span>
<span class="line-removed"> 98         return options;</span>
 99     }
100 
101     protected void socketSetOption(int opt, boolean b, Object val) throws SocketException {
102         if (opt == SocketOptions.SO_REUSEPORT &amp;&amp;
103             !supportedOptions().contains(StandardSocketOptions.SO_REUSEPORT)) {
104             throw new UnsupportedOperationException(&quot;unsupported option&quot;);
105         }
106         try {
107             socketSetOption0(opt, b, val);
108         } catch (SocketException se) {
<a name="3" id="anc3"></a><span class="line-modified">109             if (socket == null || !socket.isConnected())</span>
110                 throw se;
111         }
112     }
113 
<a name="4" id="anc4"></a><span class="line-modified">114     native void socketCreate(boolean isServer) throws IOException;</span>




115 
116     native void socketConnect(InetAddress address, int port, int timeout)
117         throws IOException;
118 
119     native void socketBind(InetAddress address, int port)
120         throws IOException;
121 
122     native void socketListen(int count) throws IOException;
123 
124     native void socketAccept(SocketImpl s) throws IOException;
125 
126     native int socketAvailable() throws IOException;
127 
128     native void socketClose0(boolean useDeferredClose) throws IOException;
129 
130     native void socketShutdown(int howto) throws IOException;
131 
132     static native void initProto();
133 
134     native void socketSetOption0(int cmd, boolean on, Object value)
135         throws SocketException;
136 
137     native int socketGetOption(int opt, Object iaContainerObj) throws SocketException;
138 
139     native void socketSendUrgentData(int data) throws IOException;
140 }
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>