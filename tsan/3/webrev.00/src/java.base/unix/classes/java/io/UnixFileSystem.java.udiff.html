<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/unix/classes/java/io/UnixFileSystem.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../solaris/native/libnet/solaris_close.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../lang/ClassLoaderHelper.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/unix/classes/java/io/UnixFileSystem.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1998, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -49,14 +49,16 @@</span>
      }
  
  
      /* -- Normalization and construction -- */
  
<span class="udiff-line-added">+     @Override</span>
      public char getSeparator() {
          return slash;
      }
  
<span class="udiff-line-added">+     @Override</span>
      public char getPathSeparator() {
          return colon;
      }
  
      /* A normal Unix pathname contains no duplicate slashes and does not end
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -82,10 +84,11 @@</span>
      }
  
      /* Check that the given pathname is normal.  If not, invoke the real
         normalizer on the part of the pathname that requires normalization.
         This way we iterate through the whole pathname string only once. */
<span class="udiff-line-added">+     @Override</span>
      public String normalize(String pathname) {
          int n = pathname.length();
          char prevChar = 0;
          for (int i = 0; i &lt; n; i++) {
              char c = pathname.charAt(i);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -95,29 +98,33 @@</span>
          }
          if (prevChar == &#39;/&#39;) return normalize(pathname, n, n - 1);
          return pathname;
      }
  
<span class="udiff-line-added">+     @Override</span>
      public int prefixLength(String pathname) {
          if (pathname.isEmpty()) return 0;
          return (pathname.charAt(0) == &#39;/&#39;) ? 1 : 0;
      }
  
<span class="udiff-line-added">+     @Override</span>
      public String resolve(String parent, String child) {
          if (child.isEmpty()) return parent;
          if (child.charAt(0) == &#39;/&#39;) {
              if (parent.equals(&quot;/&quot;)) return child;
              return parent + child;
          }
          if (parent.equals(&quot;/&quot;)) return parent + child;
          return parent + &#39;/&#39; + child;
      }
  
<span class="udiff-line-added">+     @Override</span>
      public String getDefaultParent() {
          return &quot;/&quot;;
      }
  
<span class="udiff-line-added">+     @Override</span>
      public String fromURIPath(String path) {
          String p = path;
          if (p.endsWith(&quot;/&quot;) &amp;&amp; (p.length() &gt; 1)) {
              // &quot;/foo/&quot; --&gt; &quot;/foo&quot;, but &quot;/&quot; --&gt; &quot;/&quot;
              p = p.substring(0, p.length() - 1);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -126,14 +133,16 @@</span>
      }
  
  
      /* -- Path operations -- */
  
<span class="udiff-line-added">+     @Override</span>
      public boolean isAbsolute(File f) {
          return (f.getPrefixLength() != 0);
      }
  
<span class="udiff-line-added">+     @Override</span>
      public String resolve(File f) {
          if (isAbsolute(f)) return f.getPath();
          SecurityManager sm = System.getSecurityManager();
          if (sm != null) {
              sm.checkPropertyAccess(&quot;user.dir&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -151,10 +160,11 @@</span>
      // On Unix symlinks can jump anywhere in the file system, so we only
      // treat prefixes in java.home as trusted and cacheable in the
      // canonicalization algorithm
      private final ExpiringCache javaHomePrefixCache;
  
<span class="udiff-line-added">+     @Override</span>
      public String canonicalize(String path) throws IOException {
          if (!useCanonCaches) {
              return canonicalize0(path);
          } else {
              String res = cache.get(path);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -244,26 +254,37 @@</span>
  
      /* -- Attribute accessors -- */
  
      public native int getBooleanAttributes0(File f);
  
<span class="udiff-line-added">+     @Override</span>
      public int getBooleanAttributes(File f) {
          int rv = getBooleanAttributes0(f);
          String name = f.getName();
          boolean hidden = !name.isEmpty() &amp;&amp; name.charAt(0) == &#39;.&#39;;
          return rv | (hidden ? BA_HIDDEN : 0);
      }
  
<span class="udiff-line-added">+     @Override</span>
      public native boolean checkAccess(File f, int access);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Override</span>
      public native long getLastModifiedTime(File f);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Override</span>
      public native long getLength(File f);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Override</span>
      public native boolean setPermission(File f, int access, boolean enable, boolean owneronly);
  
      /* -- File operations -- */
  
<span class="udiff-line-added">+     @Override</span>
      public native boolean createFileExclusively(String path)
          throws IOException;
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Override</span>
      public boolean delete(File f) {
          // Keep canonicalization caches in sync after file deletion
          // and renaming operations. Could be more clever than this
          // (i.e., only remove/update affected entries) but probably
          // not worth it since these entries expire after 30 seconds
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -275,12 +296,18 @@</span>
              javaHomePrefixCache.clear();
          }
          return delete0(f);
      }
      private native boolean delete0(File f);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Override</span>
      public native String[] list(File f);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Override</span>
      public native boolean createDirectory(File f);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Override</span>
      public boolean rename(File f1, File f2) {
          // Keep canonicalization caches in sync after file deletion
          // and renaming operations. Could be more clever than this
          // (i.e., only remove/update affected entries) but probably
          // not worth it since these entries expire after 30 seconds
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -292,16 +319,20 @@</span>
              javaHomePrefixCache.clear();
          }
          return rename0(f1, f2);
      }
      private native boolean rename0(File f1, File f2);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Override</span>
      public native boolean setLastModifiedTime(File f, long time);
<span class="udiff-line-removed">-     public native boolean setReadOnly(File f);</span>
  
<span class="udiff-line-added">+     @Override</span>
<span class="udiff-line-added">+     public native boolean setReadOnly(File f);</span>
  
      /* -- Filesystem interface -- */
  
<span class="udiff-line-added">+     @Override</span>
      public File[] listRoots() {
          try {
              SecurityManager security = System.getSecurityManager();
              if (security != null) {
                  security.checkRead(&quot;/&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -311,35 +342,39 @@</span>
              return new File[0];
          }
      }
  
      /* -- Disk usage -- */
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     @Override</span>
      public native long getSpace(File f, int t);
  
      /* -- Basic infrastructure -- */
  
      private native long getNameMax0(String path);
  
<span class="udiff-line-added">+     @Override</span>
      public int getNameMax(String path) {
          long nameMax = getNameMax0(path);
          if (nameMax &gt; Integer.MAX_VALUE) {
              nameMax = Integer.MAX_VALUE;
          }
          return (int)nameMax;
      }
  
<span class="udiff-line-added">+     @Override</span>
      public int compare(File f1, File f2) {
          return f1.getPath().compareTo(f2.getPath());
      }
  
<span class="udiff-line-added">+     @Override</span>
      public int hashCode(File f) {
          return f.getPath().hashCode() ^ 1234321;
      }
  
  
      private static native void initIDs();
  
      static {
          initIDs();
      }
<span class="udiff-line-removed">- </span>
  }
</pre>
<center><a href="../../../../solaris/native/libnet/solaris_close.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../lang/ClassLoaderHelper.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>