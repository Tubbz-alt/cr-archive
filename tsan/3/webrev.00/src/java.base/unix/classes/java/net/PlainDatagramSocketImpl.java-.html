<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/java.base/unix/classes/java/net/PlainDatagramSocketImpl.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2007, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package java.net;
 26 
 27 import java.io.IOException;
 28 import java.util.Set;
 29 import java.util.HashSet;
 30 import sun.net.ext.ExtendedSocketOptions;
 31 
 32 /*
 33  * On Unix systems we simply delegate to native methods.
 34  *
 35  * @author Chris Hegarty
 36  */
 37 
 38 class PlainDatagramSocketImpl extends AbstractPlainDatagramSocketImpl
 39 {
 40     static {
 41         init();
 42     }
 43 
 44     static final ExtendedSocketOptions extendedOptions =
 45             ExtendedSocketOptions.getInstance();
 46 
 47     protected &lt;T&gt; void setOption(SocketOption&lt;T&gt; name, T value) throws IOException {
 48         if (isClosed()) {
 49             throw new SocketException(&quot;Socket closed&quot;);
 50         }
 51         if (supportedOptions().contains(name)) {
 52             if (extendedOptions.isOptionSupported(name)) {
 53                 extendedOptions.setOption(fd, name, value);
 54             } else {
 55                 super.setOption(name, value);
 56             }
 57         } else {
 58             throw new UnsupportedOperationException(&quot;unsupported option&quot;);
 59         }
 60     }
 61 
 62     @SuppressWarnings(&quot;unchecked&quot;)
 63     protected &lt;T&gt; T getOption(SocketOption&lt;T&gt; name) throws IOException {
 64         if (isClosed()) {
 65             throw new SocketException(&quot;Socket closed&quot;);
 66         }
 67         if (supportedOptions().contains(name)) {
 68             if (extendedOptions.isOptionSupported(name)) {
 69                 return (T) extendedOptions.getOption(fd, name);
 70             } else {
 71                 return super.getOption(name);
 72             }
 73         } else {
 74             throw new UnsupportedOperationException(&quot;unsupported option&quot;);
 75         }
 76     }
 77 
 78     protected Set&lt;SocketOption&lt;?&gt;&gt; supportedOptions() {
 79         HashSet&lt;SocketOption&lt;?&gt;&gt; options = new HashSet&lt;&gt;(super.supportedOptions());
 80         options.addAll(ExtendedSocketOptions.datagramSocketOptions());
 81         return options;
 82     }
 83 
 84     protected void socketSetOption(int opt, Object val) throws SocketException {
 85         if (opt == SocketOptions.SO_REUSEPORT &amp;&amp;
 86             !supportedOptions().contains(StandardSocketOptions.SO_REUSEPORT)) {
 87             throw new UnsupportedOperationException(&quot;unsupported option&quot;);
 88         }
 89         try {
 90             socketSetOption0(opt, val);
 91         } catch (SocketException se) {
 92             if (!connected)
 93                 throw se;
 94         }
 95     }
 96 
 97     protected synchronized native void bind0(int lport, InetAddress laddr)
 98         throws SocketException;
 99 
100     protected native void send(DatagramPacket p) throws IOException;
101 
102     protected synchronized native int peek(InetAddress i) throws IOException;
103 
104     protected synchronized native int peekData(DatagramPacket p) throws IOException;
105 
106     protected synchronized native void receive0(DatagramPacket p)
107         throws IOException;
108 
109     protected native void setTimeToLive(int ttl) throws IOException;
110 
111     protected native int getTimeToLive() throws IOException;
112 
113     @Deprecated
114     protected native void setTTL(byte ttl) throws IOException;
115 
116     @Deprecated
117     protected native byte getTTL() throws IOException;
118 
119     protected native void join(InetAddress inetaddr, NetworkInterface netIf)
120         throws IOException;
121 
122     protected native void leave(InetAddress inetaddr, NetworkInterface netIf)
123         throws IOException;
124 
125     protected native void datagramSocketCreate() throws SocketException;
126 
127     protected native void datagramSocketClose();
128 
129     protected native void socketSetOption0(int opt, Object val)
130         throws SocketException;
131 
132     protected native Object socketGetOption(int opt) throws SocketException;
133 
134     protected native void connect0(InetAddress address, int port) throws SocketException;
135 
136     protected native void disconnect0(int family);
137 
138     native int dataAvailable();
139 
140     /**
141      * Perform class load-time initializations.
142      */
143     private static native void init();
144 }
    </pre>
  </body>
</html>