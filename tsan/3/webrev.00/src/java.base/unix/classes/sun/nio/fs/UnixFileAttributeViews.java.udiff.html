<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.base/unix/classes/sun/nio/fs/UnixFileAttributeViews.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="UnixCopyFile.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="UnixFileAttributes.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/unix/classes/sun/nio/fs/UnixFileAttributeViews.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2008, 2015, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -71,19 +71,30 @@</span>
              // permission check
              file.checkWrite();
  
              boolean haveFd = false;
              boolean useFutimes = false;
<span class="udiff-line-added">+             boolean useFutimens = false;</span>
<span class="udiff-line-added">+             boolean useLutimes = false;</span>
              int fd = -1;
              try {
<span class="udiff-line-modified-removed">-                 fd = file.openForAttributeAccess(followLinks);</span>
<span class="udiff-line-modified-removed">-                 if (fd != -1) {</span>
<span class="udiff-line-modified-removed">-                     haveFd = true;</span>
<span class="udiff-line-modified-removed">-                     useFutimes = futimesSupported();</span>
<span class="udiff-line-modified-added">+                 if (!followLinks) {</span>
<span class="udiff-line-modified-added">+                     useLutimes = lutimesSupported() &amp;&amp;</span>
<span class="udiff-line-modified-added">+                         UnixFileAttributes.get(file, false).isSymbolicLink();</span>
<span class="udiff-line-modified-added">+                 }</span>
<span class="udiff-line-added">+                 if (!useLutimes) {</span>
<span class="udiff-line-added">+                     fd = file.openForAttributeAccess(followLinks);</span>
<span class="udiff-line-added">+                     if (fd != -1) {</span>
<span class="udiff-line-added">+                         haveFd = true;</span>
<span class="udiff-line-added">+                         if (!(useFutimens = futimensSupported())) {</span>
<span class="udiff-line-added">+                             useFutimes = futimesSupported();</span>
<span class="udiff-line-added">+                         }</span>
<span class="udiff-line-added">+                     }</span>
                  }
              } catch (UnixException x) {
<span class="udiff-line-modified-removed">-                 if (x.errno() != UnixConstants.ENXIO) {</span>
<span class="udiff-line-modified-added">+                 if (!(x.errno() == UnixConstants.ENXIO ||</span>
<span class="udiff-line-added">+                      (x.errno() == UnixConstants.ELOOP &amp;&amp; useLutimes))) {</span>
                      x.rethrowAsIOException(file);
                  }
              }
  
              try {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -102,18 +113,24 @@</span>
                      } catch (UnixException x) {
                          x.rethrowAsIOException(file);
                      }
                  }
  
<span class="udiff-line-modified-removed">-                 // uptime times</span>
<span class="udiff-line-modified-removed">-                 long modValue = lastModifiedTime.to(TimeUnit.MICROSECONDS);</span>
<span class="udiff-line-modified-removed">-                 long accessValue= lastAccessTime.to(TimeUnit.MICROSECONDS);</span>
<span class="udiff-line-modified-added">+                 // update times</span>
<span class="udiff-line-modified-added">+                 TimeUnit timeUnit = useFutimens ?</span>
<span class="udiff-line-modified-added">+                     TimeUnit.NANOSECONDS : TimeUnit.MICROSECONDS;</span>
<span class="udiff-line-added">+                 long modValue = lastModifiedTime.to(timeUnit);</span>
<span class="udiff-line-added">+                 long accessValue= lastAccessTime.to(timeUnit);</span>
  
                  boolean retry = false;
                  try {
<span class="udiff-line-modified-removed">-                     if (useFutimes) {</span>
<span class="udiff-line-modified-added">+                     if (useFutimens) {</span>
<span class="udiff-line-added">+                         futimens(fd, accessValue, modValue);</span>
<span class="udiff-line-added">+                     } else if (useFutimes) {</span>
                          futimes(fd, accessValue, modValue);
<span class="udiff-line-added">+                     } else if (useLutimes) {</span>
<span class="udiff-line-added">+                         lutimes(file, accessValue, modValue);</span>
                      } else {
                          utimes(file, accessValue, modValue);
                      }
                  } catch (UnixException x) {
                      // if futimes/utimes fails with EINVAL and one/both of the times is
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -127,12 +144,16 @@</span>
                  }
                  if (retry) {
                      if (modValue &lt; 0L) modValue = 0L;
                      if (accessValue &lt; 0L) accessValue= 0L;
                      try {
<span class="udiff-line-modified-removed">-                         if (useFutimes) {</span>
<span class="udiff-line-modified-added">+                         if (useFutimens) {</span>
<span class="udiff-line-added">+                             futimens(fd, accessValue, modValue);</span>
<span class="udiff-line-added">+                         } else if (useFutimes) {</span>
                              futimes(fd, accessValue, modValue);
<span class="udiff-line-added">+                         } else if (useLutimes) {</span>
<span class="udiff-line-added">+                             lutimes(file, accessValue, modValue);</span>
                          } else {
                              utimes(file, accessValue, modValue);
                          }
                      } catch (UnixException x) {
                          x.rethrowAsIOException(file);
</pre>
<center><a href="UnixCopyFile.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="UnixFileAttributes.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>