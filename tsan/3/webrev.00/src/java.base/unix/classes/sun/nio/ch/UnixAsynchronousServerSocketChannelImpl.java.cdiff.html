<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.base/unix/classes/sun/nio/ch/UnixAsynchronousServerSocketChannelImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="SourceChannelImpl.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="UnixAsynchronousSocketChannelImpl.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/unix/classes/sun/nio/ch/UnixAsynchronousServerSocketChannelImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2008, 2013, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2008, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 139,11 ***</span>
          FileDescriptor newfd = new FileDescriptor();
          InetSocketAddress[] isaa = new InetSocketAddress[1];
          Throwable exc = null;
          try {
              begin();
<span class="line-modified">!             int n = accept(this.fd, newfd, isaa);</span>
  
              // spurious wakeup, is this possible?
              if (n == IOStatus.UNAVAILABLE) {
                  synchronized (updateLock) {
                      acceptPending = true;
<span class="line-new-header">--- 139,11 ---</span>
          FileDescriptor newfd = new FileDescriptor();
          InetSocketAddress[] isaa = new InetSocketAddress[1];
          Throwable exc = null;
          try {
              begin();
<span class="line-modified">!             int n = Net.accept(this.fd, newfd, isaa);</span>
  
              // spurious wakeup, is this possible?
              if (n == IOStatus.UNAVAILABLE) {
                  synchronized (updateLock) {
                      acceptPending = true;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 219,20 ***</span>
                  AccessController.doPrivileged(new PrivilegedAction&lt;&gt;() {
                      public Void run() {
                          SecurityManager sm = System.getSecurityManager();
                          if (sm != null) {
                              sm.checkAccept(remote.getAddress().getHostAddress(),
<span class="line-modified">!                                            remote.getPort());</span>
                          }
                          return null;
                      }
                  }, acc);
              } else {
                  SecurityManager sm = System.getSecurityManager();
                  if (sm != null) {
                      sm.checkAccept(remote.getAddress().getHostAddress(),
<span class="line-modified">!                                    remote.getPort());</span>
                  }
              }
          } catch (SecurityException x) {
              try {
                  ch.close();
<span class="line-new-header">--- 219,20 ---</span>
                  AccessController.doPrivileged(new PrivilegedAction&lt;&gt;() {
                      public Void run() {
                          SecurityManager sm = System.getSecurityManager();
                          if (sm != null) {
                              sm.checkAccept(remote.getAddress().getHostAddress(),
<span class="line-modified">!                                     remote.getPort());</span>
                          }
                          return null;
                      }
                  }, acc);
              } else {
                  SecurityManager sm = System.getSecurityManager();
                  if (sm != null) {
                      sm.checkAccept(remote.getAddress().getHostAddress(),
<span class="line-modified">!                             remote.getPort());</span>
                  }
              }
          } catch (SecurityException x) {
              try {
                  ch.close();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 275,11 ***</span>
          InetSocketAddress[] isaa = new InetSocketAddress[1];
          Throwable exc = null;
          try {
              begin();
  
<span class="line-modified">!             int n = accept(this.fd, newfd, isaa);</span>
              if (n == IOStatus.UNAVAILABLE) {
  
                  // need calling context when there is security manager as
                  // permission check may be done in a different thread without
                  // any application call frames on the stack
<span class="line-new-header">--- 275,11 ---</span>
          InetSocketAddress[] isaa = new InetSocketAddress[1];
          Throwable exc = null;
          try {
              begin();
  
<span class="line-modified">!             int n = Net.accept(this.fd, newfd, isaa);</span>
              if (n == IOStatus.UNAVAILABLE) {
  
                  // need calling context when there is security manager as
                  // permission check may be done in a different thread without
                  // any application call frames on the stack
</pre>
<hr />
<pre>
<span class="line-old-header">*** 292,11 ***</span>
                      } else {
                          this.acceptHandler = handler;
                          this.acceptAttachment = att;
                      }
                      this.acceptAcc = (System.getSecurityManager() == null) ?
<span class="line-modified">!                         null : AccessController.getContext();</span>
                      this.acceptPending = true;
                  }
  
                  // register for connections
                  port.startPoll(fdVal, Net.POLLIN);
<span class="line-new-header">--- 292,11 ---</span>
                      } else {
                          this.acceptHandler = handler;
                          this.acceptAttachment = att;
                      }
                      this.acceptAcc = (System.getSecurityManager() == null) ?
<span class="line-modified">!                             null : AccessController.getContext();</span>
                      this.acceptPending = true;
                  }
  
                  // register for connections
                  port.startPoll(fdVal, Net.POLLIN);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 329,35 ***</span>
          } else {
              Invoker.invokeIndirectly(this, handler, att, child, exc);
              return null;
          }
      }
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Accept a connection on a socket.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * @implNote Wrap native call to allow instrumentation.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     private int accept(FileDescriptor ssfd, FileDescriptor newfd,</span>
<span class="line-removed">-                        InetSocketAddress[] isaa)</span>
<span class="line-removed">-         throws IOException</span>
<span class="line-removed">-     {</span>
<span class="line-removed">-         return accept0(ssfd, newfd, isaa);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // -- Native methods --</span>
<span class="line-removed">- </span>
<span class="line-removed">-     private static native void initIDs();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Accepts a new connection, setting the given file descriptor to refer to</span>
<span class="line-removed">-     // the new socket and setting isaa[0] to the socket&#39;s remote address.</span>
<span class="line-removed">-     // Returns 1 on success, or IOStatus.UNAVAILABLE.</span>
<span class="line-removed">-     //</span>
<span class="line-removed">-     private native int accept0(FileDescriptor ssfd, FileDescriptor newfd,</span>
<span class="line-removed">-                                InetSocketAddress[] isaa)</span>
<span class="line-removed">-         throws IOException;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     static {</span>
<span class="line-removed">-         IOUtil.load();</span>
<span class="line-removed">-         initIDs();</span>
<span class="line-removed">-     }</span>
  }
<span class="line-new-header">--- 329,6 ---</span>
</pre>
<center><a href="SourceChannelImpl.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="UnixAsynchronousSocketChannelImpl.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>