<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.security.auth/share/classes/com/sun/security/auth/module/Krb5LoginModule.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../login/ConfigFile.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="NTSystem.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.security.auth/share/classes/com/sun/security/auth/module/Krb5LoginModule.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 627             } catch (KrbException e) {
 628                 LoginException le = new LoginException(e.getMessage());
 629                 le.initCause(e);
 630                 throw le;
 631             }
 632         }
 633 
 634         try {
 635             if (useTicketCache) {
 636                 // ticketCacheName == null implies the default cache
 637                 if (debug)
 638                     System.out.println(&quot;Acquire TGT from Cache&quot;);
 639                 cred  = Credentials.acquireTGTFromCache
 640                     (principal, ticketCacheName);
 641 
 642                 if (cred != null) {
 643                     if (renewTGT &amp;&amp; isOld(cred)) {
 644                         // renew if ticket is old.
 645                         Credentials newCred = renewCredentials(cred);
 646                         if (newCred != null) {

 647                             cred = newCred;
 648                         }
 649                     }
 650                     if (!isCurrent(cred)) {
 651                         // credentials have expired
 652                         cred = null;
 653                         if (debug)
 654                             System.out.println(&quot;Credentials are&quot; +
 655                                     &quot; no longer valid&quot;);
 656                     }
 657                 }
 658 
 659                 if (cred != null) {
 660                    // get the principal name from the ticket cache
 661                    if (principal == null) {
 662                         principal = cred.getClient();
 663                    }
 664                 }
 665                 if (debug) {
 666                     System.out.println(&quot;Principal is &quot; + principal);
</pre>
<hr />
<pre>
1053 
1054             if (subject.isReadOnly()) {
1055                 cleanKerberosCred();
1056                 throw new LoginException(&quot;Subject is Readonly&quot;);
1057             }
1058 
1059             /*
1060              * Add the Principal (authenticated identity)
1061              * to the Subject&#39;s principal set and
1062              * add the credentials (TGT or Service key) to the
1063              * Subject&#39;s private credentials
1064              */
1065 
1066             Set&lt;Object&gt; privCredSet =  subject.getPrivateCredentials();
1067             Set&lt;java.security.Principal&gt; princSet  = subject.getPrincipals();
1068             kerbClientPrinc = new KerberosPrincipal(principal.getName());
1069 
1070             // create Kerberos Ticket
1071             if (isInitiator) {
1072                 kerbTicket = Krb5Util.credsToTicket(cred);




1073             }
1074 
1075             if (storeKey &amp;&amp; encKeys != null) {
1076                 if (encKeys.length == 0) {
1077                     succeeded = false;
1078                     throw new LoginException(&quot;Null Server Key &quot;);
1079                 }
1080 
1081                 kerbKeys = new KerberosKey[encKeys.length];
1082                 for (int i = 0; i &lt; encKeys.length; i ++) {
1083                     Integer temp = encKeys[i].getKeyVersionNumber();
1084                     kerbKeys[i] = new KerberosKey(kerbClientPrinc,
1085                                           encKeys[i].getBytes(),
1086                                           encKeys[i].getEType(),
1087                                           (temp == null?
1088                                           0: temp.intValue()));
1089                 }
1090 
1091             }
1092             // Let us add the kerbClientPrinc,kerbTicket and KeyTab/KerbKey (if
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 627             } catch (KrbException e) {
 628                 LoginException le = new LoginException(e.getMessage());
 629                 le.initCause(e);
 630                 throw le;
 631             }
 632         }
 633 
 634         try {
 635             if (useTicketCache) {
 636                 // ticketCacheName == null implies the default cache
 637                 if (debug)
 638                     System.out.println(&quot;Acquire TGT from Cache&quot;);
 639                 cred  = Credentials.acquireTGTFromCache
 640                     (principal, ticketCacheName);
 641 
 642                 if (cred != null) {
 643                     if (renewTGT &amp;&amp; isOld(cred)) {
 644                         // renew if ticket is old.
 645                         Credentials newCred = renewCredentials(cred);
 646                         if (newCred != null) {
<span class="line-added"> 647                             newCred.setProxy(cred.getProxy());</span>
 648                             cred = newCred;
 649                         }
 650                     }
 651                     if (!isCurrent(cred)) {
 652                         // credentials have expired
 653                         cred = null;
 654                         if (debug)
 655                             System.out.println(&quot;Credentials are&quot; +
 656                                     &quot; no longer valid&quot;);
 657                     }
 658                 }
 659 
 660                 if (cred != null) {
 661                    // get the principal name from the ticket cache
 662                    if (principal == null) {
 663                         principal = cred.getClient();
 664                    }
 665                 }
 666                 if (debug) {
 667                     System.out.println(&quot;Principal is &quot; + principal);
</pre>
<hr />
<pre>
1054 
1055             if (subject.isReadOnly()) {
1056                 cleanKerberosCred();
1057                 throw new LoginException(&quot;Subject is Readonly&quot;);
1058             }
1059 
1060             /*
1061              * Add the Principal (authenticated identity)
1062              * to the Subject&#39;s principal set and
1063              * add the credentials (TGT or Service key) to the
1064              * Subject&#39;s private credentials
1065              */
1066 
1067             Set&lt;Object&gt; privCredSet =  subject.getPrivateCredentials();
1068             Set&lt;java.security.Principal&gt; princSet  = subject.getPrincipals();
1069             kerbClientPrinc = new KerberosPrincipal(principal.getName());
1070 
1071             // create Kerberos Ticket
1072             if (isInitiator) {
1073                 kerbTicket = Krb5Util.credsToTicket(cred);
<span class="line-added">1074                 if (cred.getProxy() != null) {</span>
<span class="line-added">1075                     KerberosSecrets.getJavaxSecurityAuthKerberosAccess()</span>
<span class="line-added">1076                             .kerberosTicketSetProxy(kerbTicket,Krb5Util.credsToTicket(cred.getProxy()));</span>
<span class="line-added">1077                 }</span>
1078             }
1079 
1080             if (storeKey &amp;&amp; encKeys != null) {
1081                 if (encKeys.length == 0) {
1082                     succeeded = false;
1083                     throw new LoginException(&quot;Null Server Key &quot;);
1084                 }
1085 
1086                 kerbKeys = new KerberosKey[encKeys.length];
1087                 for (int i = 0; i &lt; encKeys.length; i ++) {
1088                     Integer temp = encKeys[i].getKeyVersionNumber();
1089                     kerbKeys[i] = new KerberosKey(kerbClientPrinc,
1090                                           encKeys[i].getBytes(),
1091                                           encKeys[i].getEType(),
1092                                           (temp == null?
1093                                           0: temp.intValue()));
1094                 }
1095 
1096             }
1097             // Let us add the kerbClientPrinc,kerbTicket and KeyTab/KerbKey (if
</pre>
</td>
</tr>
</table>
<center><a href="../login/ConfigFile.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="NTSystem.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>