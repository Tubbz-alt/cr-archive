<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.crypto.ec/share/native/libsunec/impl/ec.c</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../classes/sun/security/ec/XECParameters.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../jdk.crypto.mscapi/windows/classes/sun/security/mscapi/CKey.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.crypto.ec/share/native/libsunec/impl/ec.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2007, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2007, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * Use is subject to license terms.
   *
   * This library is free software; you can redistribute it and/or
   * modify it under the terms of the GNU Lesser General Public
   * License as published by the Free Software Foundation; either
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -658,10 +658,11 @@</span>
      mp_err err = MP_OKAY;
      ECParams *ecParams = NULL;
      SECItem kGpoint = { siBuffer, NULL, 0};
      int flen = 0;    /* length in bytes of the field size */
      unsigned olen;   /* length in bytes of the base point order */
<span class="udiff-line-added">+     unsigned int orderBitSize;</span>
  
  #if EC_DEBUG
      char mpstr[256];
  #endif
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -760,14 +761,15 @@</span>
      ** s = (k**-1 * (HASH(M) + d*r)) mod n
      */
      SECITEM_TO_MPINT(*digest, &amp;s);        /* s = HASH(M)     */
  
      /* In the definition of EC signing, digests are truncated
<span class="udiff-line-modified-removed">-      * to the length of n in bits.</span>
<span class="udiff-line-modified-added">+      * to the order length</span>
       * (see SEC 1 &quot;Elliptic Curve Digit Signature Algorithm&quot; section 4.1.*/
<span class="udiff-line-modified-removed">-     if (digest-&gt;len*8 &gt; (unsigned int)ecParams-&gt;fieldID.size) {</span>
<span class="udiff-line-modified-removed">-         mpl_rsh(&amp;s,&amp;s,digest-&gt;len*8 - ecParams-&gt;fieldID.size);</span>
<span class="udiff-line-modified-added">+     orderBitSize = mpl_significant_bits(&amp;n);</span>
<span class="udiff-line-modified-added">+     if (digest-&gt;len*8 &gt; orderBitSize) {</span>
<span class="udiff-line-added">+         mpl_rsh(&amp;s,&amp;s,digest-&gt;len*8 - orderBitSize);</span>
      }
  
  #if EC_DEBUG
      mp_todecimal(&amp;n, mpstr);
      printf(&quot;n : %s (dec)\n&quot;, mpstr);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -896,10 +898,11 @@</span>
      ECParams *ecParams = NULL;
      SECItem pointC = { siBuffer, NULL, 0 };
      int slen;       /* length in bytes of a half signature (r or s) */
      int flen;       /* length in bytes of the field size */
      unsigned olen;  /* length in bytes of the base point order */
<span class="udiff-line-added">+     unsigned int orderBitSize;</span>
  
  #if EC_DEBUG
      char mpstr[256];
      printf(&quot;ECDSA verification called\n&quot;);
  #endif
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -975,15 +978,16 @@</span>
      ** u1 = ((HASH(M&#39;)) * c) mod n
      */
      SECITEM_TO_MPINT(*digest, &amp;u1);                  /* u1 = HASH(M)     */
  
      /* In the definition of EC signing, digests are truncated
<span class="udiff-line-modified-removed">-      * to the length of n in bits.</span>
<span class="udiff-line-modified-added">+      * to the order length, in bits.</span>
       * (see SEC 1 &quot;Elliptic Curve Digit Signature Algorithm&quot; section 4.1.*/
      /* u1 = HASH(M&#39;)     */
<span class="udiff-line-modified-removed">-     if (digest-&gt;len*8 &gt; (unsigned int)ecParams-&gt;fieldID.size) {</span>
<span class="udiff-line-modified-removed">-         mpl_rsh(&amp;u1,&amp;u1,digest-&gt;len*8- ecParams-&gt;fieldID.size);</span>
<span class="udiff-line-modified-added">+     orderBitSize = mpl_significant_bits(&amp;n);</span>
<span class="udiff-line-modified-added">+     if (digest-&gt;len*8 &gt; orderBitSize) {</span>
<span class="udiff-line-added">+         mpl_rsh(&amp;u1,&amp;u1,digest-&gt;len*8- orderBitSize);</span>
      }
  
  #if EC_DEBUG
      mp_todecimal(&amp;r_, mpstr);
      printf(&quot;r_: %s (dec)\n&quot;, mpstr);
</pre>
<center><a href="../../../classes/sun/security/ec/XECParameters.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="../../../../../jdk.crypto.mscapi/windows/classes/sun/security/mscapi/CKey.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>