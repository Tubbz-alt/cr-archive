<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/taglets/ValueTaglet.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2001, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.toolkit.taglets;
 27 
 28 import java.util.EnumSet;
 29 import javax.lang.model.element.Element;
 30 import javax.lang.model.element.VariableElement;
 31 
 32 import com.sun.source.doctree.DocTree;
 33 import jdk.javadoc.doclet.Taglet.Location;
 34 import jdk.javadoc.internal.doclets.toolkit.BaseConfiguration;
 35 import jdk.javadoc.internal.doclets.toolkit.Content;
 36 import jdk.javadoc.internal.doclets.toolkit.Messages;
 37 import jdk.javadoc.internal.doclets.toolkit.util.CommentHelper;
 38 import jdk.javadoc.internal.doclets.toolkit.util.Utils;
 39 
 40 /**
 41  * An inline Taglet representing the value tag. This tag should only be used with
 42  * constant fields that have a value.  It is used to access the value of constant
 43  * fields.  This inline tag has an optional field name parameter.  If the name is
 44  * specified, the constant value is retrieved from the specified field.  A link
 45  * is also created to the specified field.  If a name is not specified, the value
 46  * is retrieved for the field that the inline tag appears on.  The name is specified
 47  * in the following format:  [fully qualified class name]#[constant field name].
 48  *
 49  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 50  *  If you write code that depends on this, you do so at your own risk.
 51  *  This code and its internal interfaces are subject to change or
 52  *  deletion without notice.&lt;/b&gt;
 53  */
 54 
 55 public class ValueTaglet extends BaseTaglet {
 56 
 57     /**
 58      * Construct a new ValueTaglet.
 59      */
 60     public ValueTaglet() {
 61         super(DocTree.Kind.VALUE, true, EnumSet.allOf(Location.class));
 62     }
 63 
 64     /**
 65      * Returns the referenced field or a null if the value tag
 66      * is empty or the reference is invalid.
 67      *
 68      * @param holder the tag holder.
 69      * @param config the  configuration of the doclet.
 70      * @param tag the value tag.
 71      *
 72      * @return the referenced field or null.
 73      */
 74     private VariableElement getVariableElement(Element holder, BaseConfiguration config, DocTree tag) {
 75         CommentHelper ch = config.utils.getCommentHelper(holder);
 76         String signature = ch.getReferencedSignature(tag);
 77 
 78         Element e = signature == null
 79                 ? holder
 80                 : ch.getReferencedMember(tag);
 81 
 82         return (e != null &amp;&amp; config.utils.isVariableElement(e))
 83                 ? (VariableElement) e
 84                 : null;
 85     }
 86 
 87     @Override
 88     public Content getTagletOutput(Element holder, DocTree tag, TagletWriter writer) {
 89         Utils utils = writer.configuration().utils;
 90         Messages messages = writer.configuration().getMessages();
 91         VariableElement field = getVariableElement(holder, writer.configuration(), tag);
 92         if (field == null) {
 93             if (tag.toString().isEmpty()) {
 94                 //Invalid use of @value
 95                 messages.warning(holder,
 96                         &quot;doclet.value_tag_invalid_use&quot;);
 97             } else {
 98                 //Reference is unknown.
 99                 messages.warning(holder,
100                         &quot;doclet.value_tag_invalid_reference&quot;, tag.toString());
101             }
102         } else if (field.getConstantValue() != null) {
103             return writer.valueTagOutput(field,
104                 utils.constantValueExpresion(field),
105                 // TODO: investigate and cleanup
106                 // in the j.l.m world, equals will not be accurate
107                 // !field.equals(tag.holder())
108                 !utils.elementsEqual(field, holder)
109             );
110         } else {
111             //Referenced field is not a constant.
112             messages.warning(holder,
113                 &quot;doclet.value_tag_invalid_constant&quot;, utils.getSimpleName(field));
114         }
115         return writer.getOutputInstance();
116     }
117 }
    </pre>
  </body>
</html>