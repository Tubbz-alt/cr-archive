<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/markup/Navigation.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Links.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="RawHtml.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/markup/Navigation.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 package jdk.javadoc.internal.doclets.formats.html.markup;
  26 
<span class="line-removed">  27 import java.util.ArrayDeque;</span>
  28 import java.util.ArrayList;
<span class="line-removed">  29 import java.util.Deque;</span>
<span class="line-removed">  30 import java.util.HashMap;</span>
  31 import java.util.List;
<span class="line-removed">  32 import java.util.Map;</span>
  33 import java.util.Set;
  34 import java.util.SortedSet;
  35 
  36 import javax.lang.model.element.Element;
  37 import javax.lang.model.element.ElementKind;
  38 import javax.lang.model.element.ModuleElement;
  39 import javax.lang.model.element.PackageElement;
  40 import javax.lang.model.element.TypeElement;
  41 
  42 import jdk.javadoc.internal.doclets.formats.html.AbstractMemberWriter;
  43 import jdk.javadoc.internal.doclets.formats.html.Contents;
  44 import jdk.javadoc.internal.doclets.formats.html.HtmlConfiguration;

  45 import jdk.javadoc.internal.doclets.formats.html.MarkerComments;
  46 import jdk.javadoc.internal.doclets.formats.html.SectionName;
  47 import jdk.javadoc.internal.doclets.toolkit.Content;
  48 import jdk.javadoc.internal.doclets.toolkit.builders.MemberSummaryBuilder;
  49 import jdk.javadoc.internal.doclets.toolkit.util.DocFile;
  50 import jdk.javadoc.internal.doclets.toolkit.util.DocLink;
  51 import jdk.javadoc.internal.doclets.toolkit.util.DocPath;
  52 import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
  53 import jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable;
  54 
  55 import static jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable.Kind.*;
  56 
  57 /**
  58  * Factory for navigation bar.
  59  *
  60  * &lt;p&gt;
  61  * &lt;b&gt;This is NOT part of any supported API. If you write code that depends on this, you do so at
  62  * your own risk. This code and its internal interfaces are subject to change or deletion without
  63  * notice.&lt;/b&gt;
  64  */
  65 public class Navigation {
  66 
  67     private final HtmlConfiguration configuration;

  68     private final Element element;
  69     private final Contents contents;
  70     private final DocPath path;
  71     private final DocPath pathToRoot;
  72     private final Links links;
<span class="line-removed">  73     private final HtmlTree fixedNavDiv;</span>
  74     private final PageMode documentedPage;
  75     private Content navLinkModule;
  76     private Content navLinkPackage;
  77     private Content navLinkClass;
  78     private MemberSummaryBuilder memberSummaryBuilder;
  79     private boolean displaySummaryModuleDescLink;
  80     private boolean displaySummaryModulesLink;
  81     private boolean displaySummaryPackagesLink;
  82     private boolean displaySummaryServicesLink;
<span class="line-removed">  83     private final Map&lt;Position, Deque&lt;Content&gt;&gt; topBottomNavContents;</span>
  84     private Content userHeader;
  85     private Content userFooter;
  86     private final String rowListTitle;
  87     private final Content searchLabel;
<span class="line-modified">  88     private static final Script FIXED_NAV_SCRIPT = new Script(&quot;&lt;!--\n&quot;</span>
<span class="line-modified">  89             + &quot;$(&#39;.navPadding&#39;).css(&#39;padding-top&#39;, $(&#39;.fixedNav&#39;).css(\&quot;height\&quot;));\n&quot;</span>
<span class="line-removed">  90             + &quot;//--&gt;\n&quot;);</span>
  91 
  92     public enum PageMode {
  93         ALLCLASSES,
  94         ALLPACKAGES,
  95         CLASS,
  96         CONSTANTVALUES,
  97         DEPRECATED,
  98         DOCFILE,
  99         HELP,
 100         INDEX,
 101         MODULE,
 102         OVERVIEW,
 103         PACKAGE,
 104         SERIALIZEDFORM,

 105         TREE,
 106         USE;
 107     }
 108 
 109     enum Position {
 110         BOTTOM(MarkerComments.START_OF_BOTTOM_NAVBAR, MarkerComments.END_OF_BOTTOM_NAVBAR),
 111         TOP(MarkerComments.START_OF_TOP_NAVBAR, MarkerComments.END_OF_TOP_NAVBAR);
 112 
 113         final Content startOfNav;
 114         final Content endOfNav;
 115 
 116         Position(Content startOfNav, Content endOfNav) {
 117             this.startOfNav = startOfNav;
 118             this.endOfNav = endOfNav;
 119         }
 120 
 121         Content startOfNav() {
 122             return startOfNav;
 123         }
 124 
 125         Content endOfNav() {
 126             return endOfNav;
 127         }
 128     }
 129 
 130     /**
 131      * Creates a {@code Navigation} object for a specific file, to be written in a specific HTML
 132      * version.
 133      *
 134      * @param element element being documented. null if its not an element documentation page
 135      * @param configuration the configuration object
<span class="line-removed"> 136      * @param fixedNavDiv the fixed navigation for the header navigation</span>
 137      * @param page the kind of page being documented
 138      * @param path the DocPath object
 139      */
<span class="line-modified"> 140     public Navigation(Element element, HtmlConfiguration configuration, HtmlTree fixedNavDiv,</span>
<span class="line-removed"> 141             PageMode page, DocPath path) {</span>
 142         this.configuration = configuration;

 143         this.element = element;
<span class="line-removed"> 144         this.fixedNavDiv = fixedNavDiv;</span>
 145         this.contents = configuration.contents;
 146         this.documentedPage = page;
 147         this.path = path;
 148         this.pathToRoot = path.parent().invert();
 149         this.links = new Links(path);
<span class="line-modified"> 150         this.topBottomNavContents = new HashMap&lt;&gt;();</span>
<span class="line-removed"> 151         this.rowListTitle = configuration.getResources().getText(&quot;doclet.Navigation&quot;);</span>
 152         this.searchLabel = contents.getContent(&quot;doclet.search&quot;);
<span class="line-removed"> 153         populateNavContents(Position.TOP);</span>
<span class="line-removed"> 154         populateNavContents(Position.BOTTOM);</span>
<span class="line-removed"> 155     }</span>
<span class="line-removed"> 156 </span>
<span class="line-removed"> 157     /**</span>
<span class="line-removed"> 158      * Populate the navigation contents for top and bottom navigation</span>
<span class="line-removed"> 159      *</span>
<span class="line-removed"> 160      * @param position the position of the navigation bar on the page</span>
<span class="line-removed"> 161      */</span>
<span class="line-removed"> 162     private void populateNavContents(Position position) {</span>
<span class="line-removed"> 163         Deque&lt;Content&gt; queue = new ArrayDeque&lt;&gt;();</span>
<span class="line-removed"> 164         Content skipNavLinks = contents.getContent(&quot;doclet.Skip_navigation_links&quot;);</span>
<span class="line-removed"> 165         switch (position) {</span>
<span class="line-removed"> 166             case TOP:</span>
<span class="line-removed"> 167                 queue.addLast(links.createAnchor(SectionName.NAVBAR_TOP));</span>
<span class="line-removed"> 168                 queue.addLast(links.createLink(SectionName.SKIP_NAVBAR_TOP, skipNavLinks,</span>
<span class="line-removed"> 169                         skipNavLinks.toString(), &quot;&quot;));</span>
<span class="line-removed"> 170                 queue.addLast(links.createAnchor(SectionName.NAVBAR_TOP_FIRSTROW));</span>
<span class="line-removed"> 171                 queue.addLast(links.createAnchor(SectionName.SKIP_NAVBAR_TOP));</span>
<span class="line-removed"> 172                 topBottomNavContents.put(position, queue);</span>
<span class="line-removed"> 173                 break;</span>
<span class="line-removed"> 174             case BOTTOM:</span>
<span class="line-removed"> 175                 queue.addLast(links.createAnchor(SectionName.NAVBAR_BOTTOM));</span>
<span class="line-removed"> 176                 queue.addLast(links.createLink(SectionName.SKIP_NAVBAR_BOTTOM, skipNavLinks,</span>
<span class="line-removed"> 177                         skipNavLinks.toString(), &quot;&quot;));</span>
<span class="line-removed"> 178                 queue.addLast(links.createAnchor(SectionName.NAVBAR_BOTTOM_FIRSTROW));</span>
<span class="line-removed"> 179                 queue.addLast(links.createAnchor(SectionName.SKIP_NAVBAR_BOTTOM));</span>
<span class="line-removed"> 180                 topBottomNavContents.put(position, queue);</span>
<span class="line-removed"> 181                 break;</span>
<span class="line-removed"> 182             default:</span>
<span class="line-removed"> 183                 break;</span>
<span class="line-removed"> 184         }</span>
 185     }
 186 
 187     public Navigation setNavLinkModule(Content navLinkModule) {
 188         this.navLinkModule = navLinkModule;
 189         return this;
 190     }
 191 
 192     public Navigation setNavLinkPackage(Content navLinkPackage) {
 193         this.navLinkPackage = navLinkPackage;
 194         return this;
 195     }
 196 
 197     public Navigation setNavLinkClass(Content navLinkClass) {
 198         this.navLinkClass = navLinkClass;
 199         return this;
 200     }
 201 
 202     public Navigation setMemberSummaryBuilder(MemberSummaryBuilder memberSummaryBuilder) {
 203         this.memberSummaryBuilder = memberSummaryBuilder;
 204         return this;
</pre>
<hr />
<pre>
 225     }
 226 
 227     public Navigation setUserHeader(Content userHeader) {
 228         this.userHeader = userHeader;
 229         return this;
 230     }
 231 
 232     public Navigation setUserFooter(Content userFooter) {
 233         this.userFooter = userFooter;
 234         return this;
 235     }
 236 
 237     /**
 238      * Add the links for the main navigation.
 239      *
 240      * @param tree the content tree to which the main navigation will added
 241      */
 242     private void addMainNavLinks(Content tree) {
 243         switch (documentedPage) {
 244             case OVERVIEW:
<span class="line-modified"> 245                 addActivePageLink(tree, contents.overviewLabel, configuration.createoverview);</span>
 246                 addModuleLink(tree);
 247                 addPackageLink(tree);
 248                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 249                 addPageLabel(tree, contents.useLabel, configuration.classuse);</span>
 250                 addTreeLink(tree);
 251                 addDeprecatedLink(tree);
 252                 addIndexLink(tree);
 253                 addHelpLink(tree);
 254                 break;
 255             case MODULE:
 256                 addOverviewLink(tree);
 257                 addActivePageLink(tree, contents.moduleLabel, configuration.showModules);
 258                 addPackageLink(tree);
 259                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 260                 addPageLabel(tree, contents.useLabel, configuration.classuse);</span>
 261                 addTreeLink(tree);
 262                 addDeprecatedLink(tree);
 263                 addIndexLink(tree);
 264                 addHelpLink(tree);
 265                 break;
 266             case PACKAGE:
 267                 addOverviewLink(tree);
 268                 addModuleOfElementLink(tree);
 269                 addActivePageLink(tree, contents.packageLabel, true);
 270                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 271                 if (configuration.classuse) {</span>
 272                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_USE,
 273                             contents.useLabel, &quot;&quot;, &quot;&quot;));
 274                 }
<span class="line-modified"> 275                 if (configuration.createtree) {</span>
 276                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_TREE,
 277                             contents.treeLabel, &quot;&quot;, &quot;&quot;));
 278                 }
 279                 addDeprecatedLink(tree);
 280                 addIndexLink(tree);
 281                 addHelpLink(tree);
 282                 break;
 283             case CLASS:
 284                 addOverviewLink(tree);
 285                 addModuleOfElementLink(tree);
 286                 addPackageSummaryLink(tree);
 287                 addActivePageLink(tree, contents.classLabel, true);
<span class="line-modified"> 288                 if (configuration.classuse) {</span>
 289                     addContentToTree(tree, links.createLink(DocPaths.CLASS_USE.resolve(path.basename()),
 290                             contents.useLabel));
 291                 }
<span class="line-modified"> 292                 if (configuration.createtree) {</span>
 293                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_TREE,
 294                             contents.treeLabel, &quot;&quot;, &quot;&quot;));
 295                 }
 296                 addDeprecatedLink(tree);
 297                 addIndexLink(tree);
 298                 addHelpLink(tree);
 299                 break;
 300             case USE:
 301                 addOverviewLink(tree);
 302                 addModuleOfElementLink(tree);
 303                 if (element instanceof PackageElement) {
 304                     addPackageSummaryLink(tree);
 305                     addPageLabel(tree, contents.classLabel, true);
 306                 } else {
 307                     addPackageOfElementLink(tree);
 308                     addContentToTree(tree, navLinkClass);
 309                 }
<span class="line-modified"> 310                 addActivePageLink(tree, contents.useLabel, configuration.classuse);</span>
 311                 if (element instanceof PackageElement) {
 312                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_TREE, contents.treeLabel));
 313                 } else {
 314                     addContentToTree(tree, configuration.utils.isEnclosingPackageIncluded((TypeElement) element)
 315                             ? links.createLink(DocPath.parent.resolve(DocPaths.PACKAGE_TREE), contents.treeLabel)
 316                             : links.createLink(pathToRoot.resolve(DocPaths.OVERVIEW_TREE), contents.treeLabel));
 317                 }
 318                 addDeprecatedLink(tree);
 319                 addIndexLink(tree);
 320                 addHelpLink(tree);
 321                 break;
 322             case TREE:
 323                 addOverviewLink(tree);
 324                 if (element == null) {
 325                     addPageLabel(tree, contents.moduleLabel, configuration.showModules);
 326                     addPageLabel(tree, contents.packageLabel, true);
 327                 } else {
 328                     addModuleOfElementLink(tree);
 329                     addPackageSummaryLink(tree);
 330                 }
 331                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 332                 addPageLabel(tree, contents.useLabel, configuration.classuse);</span>
<span class="line-modified"> 333                 addActivePageLink(tree, contents.treeLabel, configuration.createtree);</span>
 334                 addDeprecatedLink(tree);
 335                 addIndexLink(tree);
 336                 addHelpLink(tree);
 337                 break;
 338             case DEPRECATED:
 339             case INDEX:
 340             case HELP:
 341                 addOverviewLink(tree);
 342                 addModuleLink(tree);
 343                 addPackageLink(tree);
 344                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 345                 addPageLabel(tree, contents.useLabel, configuration.classuse);</span>
 346                 addTreeLink(tree);
 347                 if (documentedPage == PageMode.DEPRECATED) {
<span class="line-modified"> 348                     addActivePageLink(tree, contents.deprecatedLabel, !(configuration.nodeprecated</span>
<span class="line-modified"> 349                             || configuration.nodeprecatedlist));</span>
 350                 } else {
 351                     addDeprecatedLink(tree);
 352                 }
 353                 if (documentedPage == PageMode.INDEX) {
<span class="line-modified"> 354                     addActivePageLink(tree, contents.indexLabel, configuration.createindex);</span>
 355                 } else {
 356                     addIndexLink(tree);
 357                 }
 358                 if (documentedPage == PageMode.HELP) {
<span class="line-modified"> 359                     addActivePageLink(tree, contents.helpLabel, !configuration.nohelp);</span>
 360                 } else {
 361                     addHelpLink(tree);
 362                 }
 363                 break;
 364             case ALLCLASSES:
 365             case ALLPACKAGES:
 366             case CONSTANTVALUES:
 367             case SERIALIZEDFORM:

 368                 addOverviewLink(tree);
 369                 addModuleLink(tree);
 370                 addPackageLink(tree);
 371                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 372                 addPageLabel(tree, contents.useLabel, configuration.classuse);</span>
 373                 addTreeLink(tree);
 374                 addDeprecatedLink(tree);
 375                 addIndexLink(tree);
 376                 addHelpLink(tree);
 377                 break;
 378             case DOCFILE:
 379                 addOverviewLink(tree);
 380                 addModuleOfElementLink(tree);
 381                 addContentToTree(tree, navLinkPackage);
 382                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 383                 addPageLabel(tree, contents.useLabel, configuration.classuse);</span>
 384                 addTreeLink(tree);
 385                 addDeprecatedLink(tree);
 386                 addIndexLink(tree);
 387                 addHelpLink(tree);
 388                 break;
 389             default:
 390                 break;
 391         }
 392     }
 393 
 394     /**
 395      * Add the summary links to the sub-navigation.
 396      *
 397      * @param tree the content tree to which the sub-navigation will added
 398      */
 399     private void addSummaryLinks(Content tree) {
 400         List&lt;Content&gt; listContents = new ArrayList&lt;&gt;();
 401         switch (documentedPage) {
 402             case CLASS:
 403                 if (element.getKind() == ElementKind.ANNOTATION_TYPE) {
</pre>
<hr />
<pre>
 412                     for (VisibleMemberTable.Kind kind : summarySet) {
 413                         if (kind == ENUM_CONSTANTS &amp;&amp; !configuration.utils.isEnum(typeElement)) {
 414                             continue;
 415                         }
 416                         if (kind == CONSTRUCTORS &amp;&amp; configuration.utils.isEnum(typeElement)) {
 417                             continue;
 418                         }
 419                         AbstractMemberWriter writer
 420                                 = ((AbstractMemberWriter) memberSummaryBuilder.getMemberSummaryWriter(kind));
 421                         if (writer == null) {
 422                             addContentToList(listContents, contents.getNavLinkLabelContent(kind));
 423                         } else {
 424                             addTypeSummaryLink(memberSummaryBuilder.members(kind),
 425                                     memberSummaryBuilder.getVisibleMemberTable(),
 426                                     kind, listContents);
 427                         }
 428                     }
 429                 }
 430                 if (!listContents.isEmpty()) {
 431                     Content li = HtmlTree.LI(contents.summaryLabel);
<span class="line-modified"> 432                     li.add(Contents.SPACE);</span>
 433                     tree.add(li);
 434                     addListToNav(listContents, tree);
 435                 }
 436                 break;
 437             case MODULE:
 438                 if (displaySummaryModuleDescLink) {
 439                     addContentToList(listContents,
 440                             links.createLink(SectionName.MODULE_DESCRIPTION, contents.navModuleDescription));
 441                 } else {
 442                     addContentToList(listContents, contents.navModuleDescription);
 443                 }
 444                 if (displaySummaryModulesLink) {
 445                     addContentToList(listContents,
 446                             links.createLink(SectionName.MODULES, contents.navModules));
 447                 } else {
 448                     addContentToList(listContents, contents.navModules);
 449                 }
 450                 if (displaySummaryPackagesLink) {
 451                     addContentToList(listContents,
 452                             links.createLink(SectionName.PACKAGES, contents.navPackages));
 453                 } else {
 454                     addContentToList(listContents, contents.navPackages);
 455                 }
 456                 if (displaySummaryServicesLink) {
 457                     addContentToList(listContents,
 458                             links.createLink(SectionName.SERVICES, contents.navServices));
 459                 } else {
 460                     addContentToList(listContents, contents.navServices);
 461                 }
 462                 if (!listContents.isEmpty()) {
 463                     Content li = HtmlTree.LI(contents.moduleSubNavLabel);
<span class="line-modified"> 464                     li.add(Contents.SPACE);</span>
 465                     tree.add(li);
 466                     addListToNav(listContents, tree);
 467                 }
 468                 break;
 469             default:
 470                 break;
 471         }
 472     }
 473 
 474     /**
 475      * Add the navigation summary link.
 476      *
 477      * @param members members to be linked
 478      * @param vmt the visible member table
 479      * @param kind the visible member kind
 480      * @param listContents the list of contents
 481      */
 482     private void addTypeSummaryLink(SortedSet&lt;? extends Element&gt; members,
 483             VisibleMemberTable vmt,
 484             VisibleMemberTable.Kind kind, List&lt;Content&gt; listContents) {
</pre>
<hr />
<pre>
 648                     TypeElement typeElement = (TypeElement) element;
 649                     for (VisibleMemberTable.Kind kind : detailSet) {
 650                         AbstractMemberWriter writer
 651                                 = ((AbstractMemberWriter) memberSummaryBuilder.
 652                                         getMemberSummaryWriter(kind));
 653                         if (kind == ENUM_CONSTANTS &amp;&amp; !configuration.utils.isEnum(typeElement)) {
 654                             continue;
 655                         }
 656                         if (kind == CONSTRUCTORS &amp;&amp; configuration.utils.isEnum(typeElement)) {
 657                             continue;
 658                         }
 659                         if (writer == null) {
 660                             addContentToList(listContents, contents.getNavLinkLabelContent(kind));
 661                         } else {
 662                             addTypeDetailLink(kind, memberSummaryBuilder.hasMembers(kind), listContents);
 663                         }
 664                     }
 665                 }
 666                 if (!listContents.isEmpty()) {
 667                     Content li = HtmlTree.LI(contents.detailLabel);
<span class="line-modified"> 668                     li.add(Contents.SPACE);</span>
 669                     tree.add(li);
 670                     addListToNav(listContents, tree);
 671                 }
 672                 break;
 673             default:
 674                 break;
 675         }
 676     }
 677 
 678     /**
 679      * Add the navigation Type detail link.
 680      *
 681      * @param kind the kind of member being documented
 682      * @param link true if the members are listed and need to be linked
 683      * @param listContents the list of contents to which the detail will be added.
 684      */
 685     protected void addTypeDetailLink(VisibleMemberTable.Kind kind, boolean link, List&lt;Content&gt; listContents) {
 686         switch (kind) {
 687             case CONSTRUCTORS:
 688                 if (link) {
</pre>
<hr />
<pre>
 784                     addContentToList(listContents, contents.navAnnotationTypeMember);
 785                 }
 786                 break;
 787             default:
 788                 break;
 789         }
 790     }
 791 
 792     private void addContentToList(List&lt;Content&gt; listContents, Content tree) {
 793         listContents.add(HtmlTree.LI(tree));
 794     }
 795 
 796     private void addContentToTree(Content tree, Content content) {
 797         tree.add(HtmlTree.LI(content));
 798     }
 799 
 800     private void addListToNav(List&lt;Content&gt; listContents, Content tree) {
 801         int count = 0;
 802         for (Content liContent : listContents) {
 803             if (count &lt; listContents.size() - 1) {
<span class="line-modified"> 804                 liContent.add(Contents.SPACE);</span>
 805                 liContent.add(&quot;|&quot;);
<span class="line-modified"> 806                 liContent.add(Contents.SPACE);</span>
 807             }
 808             tree.add(liContent);
 809             count++;
 810         }
 811     }
 812 
 813     private void addActivePageLink(Content tree, Content label, boolean display) {
 814         if (display) {
 815             tree.add(HtmlTree.LI(HtmlStyle.navBarCell1Rev, label));
 816         }
 817     }
 818 
 819     private void addPageLabel(Content tree, Content label, boolean display) {
 820         if (display) {
 821             tree.add(HtmlTree.LI(label));
 822         }
 823     }
 824 
 825     private void addOverviewLink(Content tree) {
<span class="line-modified"> 826         if (configuration.createoverview) {</span>
<span class="line-modified"> 827             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(DocPaths.overviewSummary(configuration.frames)),</span>
 828                     contents.overviewLabel, &quot;&quot;, &quot;&quot;)));
 829         }
 830     }
 831 
 832     private void addModuleLink(Content tree) {
 833         if (configuration.showModules) {
 834             if (configuration.modules.size() == 1) {
 835                 ModuleElement mdle = configuration.modules.first();
 836                 boolean included = configuration.utils.isIncluded(mdle);
 837                 tree.add(HtmlTree.LI((included)
 838                         ? links.createLink(pathToRoot.resolve(configuration.docPaths.moduleSummary(mdle)), contents.moduleLabel, &quot;&quot;, &quot;&quot;)
 839                         : contents.moduleLabel));
 840             } else if (!configuration.modules.isEmpty()) {
 841                 addPageLabel(tree, contents.moduleLabel, true);
 842             }
 843         }
 844     }
 845 
 846     private void addModuleOfElementLink(Content tree) {
 847         if (configuration.showModules) {
</pre>
<hr />
<pre>
 872                     tree.add(HtmlTree.LI(links.createLink(crossPkgLink, contents.packageLabel)));
 873                 } else {
 874                     tree.add(HtmlTree.LI(contents.packageLabel));
 875                 }
 876             }
 877         } else if (!configuration.packages.isEmpty()) {
 878             addPageLabel(tree, contents.packageLabel, true);
 879         }
 880     }
 881 
 882     private void addPackageOfElementLink(Content tree) {
 883         tree.add(HtmlTree.LI(links.createLink(DocPath.parent.resolve(DocPaths.PACKAGE_SUMMARY),
 884                 contents.packageLabel)));
 885     }
 886 
 887     private void addPackageSummaryLink(Content tree) {
 888         tree.add(HtmlTree.LI(links.createLink(DocPaths.PACKAGE_SUMMARY, contents.packageLabel)));
 889     }
 890 
 891     private void addTreeLink(Content tree) {
<span class="line-modified"> 892         if (configuration.createtree) {</span>
 893             List&lt;PackageElement&gt; packages = new ArrayList&lt;&gt;(configuration.getSpecifiedPackageElements());
 894             DocPath docPath = packages.size() == 1 &amp;&amp; configuration.getSpecifiedTypeElements().isEmpty()
 895                     ? pathToRoot.resolve(configuration.docPaths.forPackage(packages.get(0)).resolve(DocPaths.PACKAGE_TREE))
 896                     : pathToRoot.resolve(DocPaths.OVERVIEW_TREE);
 897             tree.add(HtmlTree.LI(links.createLink(docPath, contents.treeLabel, &quot;&quot;, &quot;&quot;)));
 898         }
 899     }
 900 
 901     private void addDeprecatedLink(Content tree) {
<span class="line-modified"> 902         if (!(configuration.nodeprecated || configuration.nodeprecatedlist)) {</span>
 903             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(DocPaths.DEPRECATED_LIST),
 904                     contents.deprecatedLabel, &quot;&quot;, &quot;&quot;)));
 905         }
 906     }
 907 
 908     private void addIndexLink(Content tree) {
<span class="line-modified"> 909         if (configuration.createindex) {</span>
 910             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(
<span class="line-modified"> 911                     (configuration.splitindex</span>
 912                             ? DocPaths.INDEX_FILES.resolve(DocPaths.indexN(1))
 913                             : DocPaths.INDEX_ALL)),
 914                     contents.indexLabel, &quot;&quot;, &quot;&quot;)));
 915         }
 916     }
 917 
 918     private void addHelpLink(Content tree) {
<span class="line-modified"> 919         if (!configuration.nohelp) {</span>
<span class="line-modified"> 920             String helpfile = configuration.helpfile;</span>
 921             DocPath helpfilenm;
 922             if (helpfile.isEmpty()) {
 923                 helpfilenm = DocPaths.HELP_DOC;
 924             } else {
 925                 DocFile file = DocFile.createFileForInput(configuration, helpfile);
 926                 helpfilenm = DocPath.create(file.getName());
 927             }
 928             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(helpfilenm),
 929                     contents.helpLabel, &quot;&quot;, &quot;&quot;)));
 930         }
 931     }
 932 
<span class="line-removed"> 933     /**</span>
<span class="line-removed"> 934      * Add &quot;FRAMES&quot; link, to switch to the frame version of the output.</span>
<span class="line-removed"> 935      *</span>
<span class="line-removed"> 936      * @param tree the content tree to which the link will be added</span>
<span class="line-removed"> 937      */</span>
<span class="line-removed"> 938     private void addNavShowLists(Content tree) {</span>
<span class="line-removed"> 939         DocLink dl = new DocLink(pathToRoot.resolve(DocPaths.INDEX), path.getPath(), null);</span>
<span class="line-removed"> 940         Content framesContent = links.createLink(dl, contents.framesLabel, &quot;&quot;, &quot;_top&quot;);</span>
<span class="line-removed"> 941         tree.add(HtmlTree.LI(framesContent));</span>
<span class="line-removed"> 942     }</span>
<span class="line-removed"> 943 </span>
<span class="line-removed"> 944     /**</span>
<span class="line-removed"> 945      * Add &quot;NO FRAMES&quot; link, to switch to the non-frame version of the output.</span>
<span class="line-removed"> 946      *</span>
<span class="line-removed"> 947      * @param tree the content tree to which the link will be added</span>
<span class="line-removed"> 948      */</span>
<span class="line-removed"> 949     private void addNavHideLists(Content tree) {</span>
<span class="line-removed"> 950         Content noFramesContent = links.createLink(path.basename(), contents.noFramesLabel, &quot;&quot;, &quot;_top&quot;);</span>
<span class="line-removed"> 951         tree.add(HtmlTree.LI(noFramesContent));</span>
<span class="line-removed"> 952     }</span>
<span class="line-removed"> 953 </span>
 954     private void addSearch(Content tree) {
 955         String searchValueId = &quot;search&quot;;
 956         String reset = &quot;reset&quot;;
 957         HtmlTree inputText = HtmlTree.INPUT(&quot;text&quot;, searchValueId, searchValueId);
 958         HtmlTree inputReset = HtmlTree.INPUT(reset, reset, reset);
<span class="line-modified"> 959         HtmlTree liInput = HtmlTree.LI(HtmlTree.LABEL(searchValueId, searchLabel));</span>
<span class="line-modified"> 960         liInput.add(inputText);</span>
<span class="line-modified"> 961         liInput.add(inputReset);</span>
<span class="line-modified"> 962         HtmlTree ulSearch = HtmlTree.UL(HtmlStyle.navListSearch, liInput);</span>
<span class="line-removed"> 963         tree.add(ulSearch);</span>
<span class="line-removed"> 964     }</span>
<span class="line-removed"> 965 </span>
<span class="line-removed"> 966     private void addFixedNavScript(Content tree) {</span>
<span class="line-removed"> 967         tree.add(FIXED_NAV_SCRIPT.asContent());</span>
 968     }
 969 
 970     /**
 971      * Get the navigation content.
 972      *
 973      * @param top true if the top navigation bar is to be printed
 974      * @return the navigation contents
 975      */
 976     public Content getContent(boolean top) {
<span class="line-modified"> 977         Content contentTree = new ContentBuilder();</span>
<span class="line-modified"> 978         if (!configuration.nonavbar) {</span>
<span class="line-modified"> 979             Deque&lt;Content&gt; queue;</span>
<span class="line-modified"> 980             Content tree = HtmlTree.NAV();</span>
<span class="line-modified"> 981             HtmlTree navDiv = new HtmlTree(HtmlTag.DIV);</span>
<span class="line-modified"> 982             if (top) {</span>
<span class="line-modified"> 983                 queue = topBottomNavContents.get(Position.TOP);</span>
<span class="line-modified"> 984                 fixedNavDiv.add(Position.TOP.startOfNav());</span>
<span class="line-modified"> 985                 navDiv.setStyle(HtmlStyle.topNav);</span>
<span class="line-modified"> 986             } else {</span>
<span class="line-modified"> 987                 queue = topBottomNavContents.get(Position.BOTTOM);</span>
<span class="line-modified"> 988                 tree.add(Position.BOTTOM.startOfNav());</span>
<span class="line-modified"> 989                 navDiv.setStyle(HtmlStyle.bottomNav);</span>
<span class="line-modified"> 990             }</span>
<span class="line-modified"> 991             navDiv.add(queue.poll());</span>
<span class="line-modified"> 992             HtmlTree skipLinkDiv = HtmlTree.DIV(HtmlStyle.skipNav, queue.poll());</span>
<span class="line-modified"> 993             navDiv.add(skipLinkDiv);</span>
<span class="line-modified"> 994             navDiv.add(queue.poll());</span>
<span class="line-modified"> 995             HtmlTree navList = new HtmlTree(HtmlTag.UL);</span>
<span class="line-modified"> 996             navList.setStyle(HtmlStyle.navList);</span>
<span class="line-modified"> 997             navList.put(HtmlAttr.TITLE, rowListTitle);</span>
<span class="line-modified"> 998             fixedNavDiv.setStyle(HtmlStyle.fixedNav);</span>
<span class="line-modified"> 999             addMainNavLinks(navList);</span>
<span class="line-modified">1000             navDiv.add(navList);</span>
<span class="line-modified">1001             Content aboutDiv = HtmlTree.DIV(HtmlStyle.aboutLanguage, top ? userHeader : userFooter);</span>
<span class="line-modified">1002             navDiv.add(aboutDiv);</span>
<span class="line-modified">1003             if (top) {</span>
<span class="line-modified">1004                 fixedNavDiv.add(navDiv);</span>
<span class="line-modified">1005             } else {</span>
<span class="line-modified">1006                 tree.add(navDiv);</span>
<span class="line-modified">1007             }</span>
<span class="line-modified">1008             HtmlTree subDiv = new HtmlTree(HtmlTag.DIV);</span>
<span class="line-modified">1009             subDiv.setStyle(HtmlStyle.subNav);</span>
<span class="line-modified">1010             HtmlTree div = new HtmlTree(HtmlTag.DIV);</span>
<span class="line-modified">1011             // Add the summary links if present.</span>
<span class="line-modified">1012             HtmlTree ulNavSummary = new HtmlTree(HtmlTag.UL);</span>
<span class="line-modified">1013             ulNavSummary.setStyle(HtmlStyle.subNavList);</span>
<span class="line-modified">1014             addSummaryLinks(ulNavSummary);</span>
<span class="line-modified">1015             div.add(ulNavSummary);</span>
<span class="line-modified">1016             // Add the detail links if present.</span>
<span class="line-modified">1017             HtmlTree ulNavDetail = new HtmlTree(HtmlTag.UL);</span>
<span class="line-modified">1018             ulNavDetail.setStyle(HtmlStyle.subNavList);</span>
<span class="line-modified">1019             addDetailLinks(ulNavDetail);</span>
<span class="line-modified">1020             div.add(ulNavDetail);</span>
<span class="line-modified">1021             HtmlTree ulFrames = new HtmlTree(HtmlTag.UL);</span>
<span class="line-modified">1022             ulFrames.setStyle(HtmlStyle.navList);</span>
<span class="line-modified">1023             if (!configuration.nonavbar) {</span>
<span class="line-modified">1024                 if (configuration.frames) {</span>
<span class="line-modified">1025                     addNavShowLists(ulFrames);</span>
<span class="line-modified">1026                     addNavHideLists(ulFrames);</span>
<span class="line-modified">1027                 }</span>
<span class="line-modified">1028             }</span>
<span class="line-modified">1029             div.add(ulFrames);</span>
<span class="line-modified">1030             subDiv.add(div);</span>
<span class="line-modified">1031             if (top &amp;&amp; configuration.createindex) {</span>
<span class="line-modified">1032                 addSearch(subDiv);</span>
<span class="line-modified">1033             }</span>
<span class="line-removed">1034             if (top) {</span>
<span class="line-removed">1035                 fixedNavDiv.add(subDiv);</span>
<span class="line-removed">1036                 fixedNavDiv.add(queue.poll());</span>
<span class="line-removed">1037                 fixedNavDiv.add(Position.TOP.endOfNav());</span>
<span class="line-removed">1038                 tree.add(fixedNavDiv);</span>
<span class="line-removed">1039                 HtmlTree paddingDiv = HtmlTree.DIV(HtmlStyle.navPadding, Contents.SPACE);</span>
<span class="line-removed">1040                 tree.add(paddingDiv);</span>
<span class="line-removed">1041                 addFixedNavScript(tree);</span>
<span class="line-removed">1042             } else {</span>
<span class="line-removed">1043                 tree.add(subDiv);</span>
<span class="line-removed">1044                 tree.add(queue.poll());</span>
<span class="line-removed">1045                 tree.add(Position.BOTTOM.endOfNav());</span>
<span class="line-removed">1046             }</span>
<span class="line-removed">1047             return tree;</span>
1048         }
<span class="line-modified">1049         return contentTree;</span>
1050     }
1051 }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2018, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 package jdk.javadoc.internal.doclets.formats.html.markup;
  26 

  27 import java.util.ArrayList;


  28 import java.util.List;

  29 import java.util.Set;
  30 import java.util.SortedSet;
  31 
  32 import javax.lang.model.element.Element;
  33 import javax.lang.model.element.ElementKind;
  34 import javax.lang.model.element.ModuleElement;
  35 import javax.lang.model.element.PackageElement;
  36 import javax.lang.model.element.TypeElement;
  37 
  38 import jdk.javadoc.internal.doclets.formats.html.AbstractMemberWriter;
  39 import jdk.javadoc.internal.doclets.formats.html.Contents;
  40 import jdk.javadoc.internal.doclets.formats.html.HtmlConfiguration;
<span class="line-added">  41 import jdk.javadoc.internal.doclets.formats.html.HtmlOptions;</span>
  42 import jdk.javadoc.internal.doclets.formats.html.MarkerComments;
  43 import jdk.javadoc.internal.doclets.formats.html.SectionName;
  44 import jdk.javadoc.internal.doclets.toolkit.Content;
  45 import jdk.javadoc.internal.doclets.toolkit.builders.MemberSummaryBuilder;
  46 import jdk.javadoc.internal.doclets.toolkit.util.DocFile;
  47 import jdk.javadoc.internal.doclets.toolkit.util.DocLink;
  48 import jdk.javadoc.internal.doclets.toolkit.util.DocPath;
  49 import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
  50 import jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable;
  51 
  52 import static jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable.Kind.*;
  53 
  54 /**
  55  * Factory for navigation bar.
  56  *
  57  * &lt;p&gt;
  58  * &lt;b&gt;This is NOT part of any supported API. If you write code that depends on this, you do so at
  59  * your own risk. This code and its internal interfaces are subject to change or deletion without
  60  * notice.&lt;/b&gt;
  61  */
  62 public class Navigation {
  63 
  64     private final HtmlConfiguration configuration;
<span class="line-added">  65     private final HtmlOptions options;</span>
  66     private final Element element;
  67     private final Contents contents;
  68     private final DocPath path;
  69     private final DocPath pathToRoot;
  70     private final Links links;

  71     private final PageMode documentedPage;
  72     private Content navLinkModule;
  73     private Content navLinkPackage;
  74     private Content navLinkClass;
  75     private MemberSummaryBuilder memberSummaryBuilder;
  76     private boolean displaySummaryModuleDescLink;
  77     private boolean displaySummaryModulesLink;
  78     private boolean displaySummaryPackagesLink;
  79     private boolean displaySummaryServicesLink;

  80     private Content userHeader;
  81     private Content userFooter;
  82     private final String rowListTitle;
  83     private final Content searchLabel;
<span class="line-modified">  84 </span>
<span class="line-modified">  85     private static final Content EMPTY_COMMENT = new Comment(&quot; &quot;);</span>

  86 
  87     public enum PageMode {
  88         ALLCLASSES,
  89         ALLPACKAGES,
  90         CLASS,
  91         CONSTANTVALUES,
  92         DEPRECATED,
  93         DOCFILE,
  94         HELP,
  95         INDEX,
  96         MODULE,
  97         OVERVIEW,
  98         PACKAGE,
  99         SERIALIZEDFORM,
<span class="line-added"> 100         SYSTEMPROPERTIES,</span>
 101         TREE,
 102         USE;
 103     }
 104 
 105     enum Position {
 106         BOTTOM(MarkerComments.START_OF_BOTTOM_NAVBAR, MarkerComments.END_OF_BOTTOM_NAVBAR),
 107         TOP(MarkerComments.START_OF_TOP_NAVBAR, MarkerComments.END_OF_TOP_NAVBAR);
 108 
 109         final Content startOfNav;
 110         final Content endOfNav;
 111 
 112         Position(Content startOfNav, Content endOfNav) {
 113             this.startOfNav = startOfNav;
 114             this.endOfNav = endOfNav;
 115         }
 116 
 117         Content startOfNav() {
 118             return startOfNav;
 119         }
 120 
 121         Content endOfNav() {
 122             return endOfNav;
 123         }
 124     }
 125 
 126     /**
 127      * Creates a {@code Navigation} object for a specific file, to be written in a specific HTML
 128      * version.
 129      *
 130      * @param element element being documented. null if its not an element documentation page
 131      * @param configuration the configuration object

 132      * @param page the kind of page being documented
 133      * @param path the DocPath object
 134      */
<span class="line-modified"> 135     public Navigation(Element element, HtmlConfiguration configuration, PageMode page, DocPath path) {</span>

 136         this.configuration = configuration;
<span class="line-added"> 137         this.options = configuration.getOptions();</span>
 138         this.element = element;

 139         this.contents = configuration.contents;
 140         this.documentedPage = page;
 141         this.path = path;
 142         this.pathToRoot = path.parent().invert();
 143         this.links = new Links(path);
<span class="line-modified"> 144         this.rowListTitle = configuration.getDocResources().getText(&quot;doclet.Navigation&quot;);</span>

 145         this.searchLabel = contents.getContent(&quot;doclet.search&quot;);
































 146     }
 147 
 148     public Navigation setNavLinkModule(Content navLinkModule) {
 149         this.navLinkModule = navLinkModule;
 150         return this;
 151     }
 152 
 153     public Navigation setNavLinkPackage(Content navLinkPackage) {
 154         this.navLinkPackage = navLinkPackage;
 155         return this;
 156     }
 157 
 158     public Navigation setNavLinkClass(Content navLinkClass) {
 159         this.navLinkClass = navLinkClass;
 160         return this;
 161     }
 162 
 163     public Navigation setMemberSummaryBuilder(MemberSummaryBuilder memberSummaryBuilder) {
 164         this.memberSummaryBuilder = memberSummaryBuilder;
 165         return this;
</pre>
<hr />
<pre>
 186     }
 187 
 188     public Navigation setUserHeader(Content userHeader) {
 189         this.userHeader = userHeader;
 190         return this;
 191     }
 192 
 193     public Navigation setUserFooter(Content userFooter) {
 194         this.userFooter = userFooter;
 195         return this;
 196     }
 197 
 198     /**
 199      * Add the links for the main navigation.
 200      *
 201      * @param tree the content tree to which the main navigation will added
 202      */
 203     private void addMainNavLinks(Content tree) {
 204         switch (documentedPage) {
 205             case OVERVIEW:
<span class="line-modified"> 206                 addActivePageLink(tree, contents.overviewLabel, options.createOverview());</span>
 207                 addModuleLink(tree);
 208                 addPackageLink(tree);
 209                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 210                 addPageLabel(tree, contents.useLabel, options.classUse());</span>
 211                 addTreeLink(tree);
 212                 addDeprecatedLink(tree);
 213                 addIndexLink(tree);
 214                 addHelpLink(tree);
 215                 break;
 216             case MODULE:
 217                 addOverviewLink(tree);
 218                 addActivePageLink(tree, contents.moduleLabel, configuration.showModules);
 219                 addPackageLink(tree);
 220                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 221                 addPageLabel(tree, contents.useLabel, options.classUse());</span>
 222                 addTreeLink(tree);
 223                 addDeprecatedLink(tree);
 224                 addIndexLink(tree);
 225                 addHelpLink(tree);
 226                 break;
 227             case PACKAGE:
 228                 addOverviewLink(tree);
 229                 addModuleOfElementLink(tree);
 230                 addActivePageLink(tree, contents.packageLabel, true);
 231                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 232                 if (options.classUse()) {</span>
 233                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_USE,
 234                             contents.useLabel, &quot;&quot;, &quot;&quot;));
 235                 }
<span class="line-modified"> 236                 if (options.createTree()) {</span>
 237                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_TREE,
 238                             contents.treeLabel, &quot;&quot;, &quot;&quot;));
 239                 }
 240                 addDeprecatedLink(tree);
 241                 addIndexLink(tree);
 242                 addHelpLink(tree);
 243                 break;
 244             case CLASS:
 245                 addOverviewLink(tree);
 246                 addModuleOfElementLink(tree);
 247                 addPackageSummaryLink(tree);
 248                 addActivePageLink(tree, contents.classLabel, true);
<span class="line-modified"> 249                 if (options.classUse()) {</span>
 250                     addContentToTree(tree, links.createLink(DocPaths.CLASS_USE.resolve(path.basename()),
 251                             contents.useLabel));
 252                 }
<span class="line-modified"> 253                 if (options.createTree()) {</span>
 254                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_TREE,
 255                             contents.treeLabel, &quot;&quot;, &quot;&quot;));
 256                 }
 257                 addDeprecatedLink(tree);
 258                 addIndexLink(tree);
 259                 addHelpLink(tree);
 260                 break;
 261             case USE:
 262                 addOverviewLink(tree);
 263                 addModuleOfElementLink(tree);
 264                 if (element instanceof PackageElement) {
 265                     addPackageSummaryLink(tree);
 266                     addPageLabel(tree, contents.classLabel, true);
 267                 } else {
 268                     addPackageOfElementLink(tree);
 269                     addContentToTree(tree, navLinkClass);
 270                 }
<span class="line-modified"> 271                 addActivePageLink(tree, contents.useLabel, options.classUse());</span>
 272                 if (element instanceof PackageElement) {
 273                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_TREE, contents.treeLabel));
 274                 } else {
 275                     addContentToTree(tree, configuration.utils.isEnclosingPackageIncluded((TypeElement) element)
 276                             ? links.createLink(DocPath.parent.resolve(DocPaths.PACKAGE_TREE), contents.treeLabel)
 277                             : links.createLink(pathToRoot.resolve(DocPaths.OVERVIEW_TREE), contents.treeLabel));
 278                 }
 279                 addDeprecatedLink(tree);
 280                 addIndexLink(tree);
 281                 addHelpLink(tree);
 282                 break;
 283             case TREE:
 284                 addOverviewLink(tree);
 285                 if (element == null) {
 286                     addPageLabel(tree, contents.moduleLabel, configuration.showModules);
 287                     addPageLabel(tree, contents.packageLabel, true);
 288                 } else {
 289                     addModuleOfElementLink(tree);
 290                     addPackageSummaryLink(tree);
 291                 }
 292                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 293                 addPageLabel(tree, contents.useLabel, options.classUse());</span>
<span class="line-modified"> 294                 addActivePageLink(tree, contents.treeLabel, options.createTree());</span>
 295                 addDeprecatedLink(tree);
 296                 addIndexLink(tree);
 297                 addHelpLink(tree);
 298                 break;
 299             case DEPRECATED:
 300             case INDEX:
 301             case HELP:
 302                 addOverviewLink(tree);
 303                 addModuleLink(tree);
 304                 addPackageLink(tree);
 305                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 306                 addPageLabel(tree, contents.useLabel, options.classUse());</span>
 307                 addTreeLink(tree);
 308                 if (documentedPage == PageMode.DEPRECATED) {
<span class="line-modified"> 309                     addActivePageLink(tree, contents.deprecatedLabel, !(options.noDeprecated()</span>
<span class="line-modified"> 310                             || options.noDeprecatedList()));</span>
 311                 } else {
 312                     addDeprecatedLink(tree);
 313                 }
 314                 if (documentedPage == PageMode.INDEX) {
<span class="line-modified"> 315                     addActivePageLink(tree, contents.indexLabel, options.createIndex());</span>
 316                 } else {
 317                     addIndexLink(tree);
 318                 }
 319                 if (documentedPage == PageMode.HELP) {
<span class="line-modified"> 320                     addActivePageLink(tree, contents.helpLabel, !options.noHelp());</span>
 321                 } else {
 322                     addHelpLink(tree);
 323                 }
 324                 break;
 325             case ALLCLASSES:
 326             case ALLPACKAGES:
 327             case CONSTANTVALUES:
 328             case SERIALIZEDFORM:
<span class="line-added"> 329             case SYSTEMPROPERTIES:</span>
 330                 addOverviewLink(tree);
 331                 addModuleLink(tree);
 332                 addPackageLink(tree);
 333                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 334                 addPageLabel(tree, contents.useLabel, options.classUse());</span>
 335                 addTreeLink(tree);
 336                 addDeprecatedLink(tree);
 337                 addIndexLink(tree);
 338                 addHelpLink(tree);
 339                 break;
 340             case DOCFILE:
 341                 addOverviewLink(tree);
 342                 addModuleOfElementLink(tree);
 343                 addContentToTree(tree, navLinkPackage);
 344                 addPageLabel(tree, contents.classLabel, true);
<span class="line-modified"> 345                 addPageLabel(tree, contents.useLabel, options.classUse());</span>
 346                 addTreeLink(tree);
 347                 addDeprecatedLink(tree);
 348                 addIndexLink(tree);
 349                 addHelpLink(tree);
 350                 break;
 351             default:
 352                 break;
 353         }
 354     }
 355 
 356     /**
 357      * Add the summary links to the sub-navigation.
 358      *
 359      * @param tree the content tree to which the sub-navigation will added
 360      */
 361     private void addSummaryLinks(Content tree) {
 362         List&lt;Content&gt; listContents = new ArrayList&lt;&gt;();
 363         switch (documentedPage) {
 364             case CLASS:
 365                 if (element.getKind() == ElementKind.ANNOTATION_TYPE) {
</pre>
<hr />
<pre>
 374                     for (VisibleMemberTable.Kind kind : summarySet) {
 375                         if (kind == ENUM_CONSTANTS &amp;&amp; !configuration.utils.isEnum(typeElement)) {
 376                             continue;
 377                         }
 378                         if (kind == CONSTRUCTORS &amp;&amp; configuration.utils.isEnum(typeElement)) {
 379                             continue;
 380                         }
 381                         AbstractMemberWriter writer
 382                                 = ((AbstractMemberWriter) memberSummaryBuilder.getMemberSummaryWriter(kind));
 383                         if (writer == null) {
 384                             addContentToList(listContents, contents.getNavLinkLabelContent(kind));
 385                         } else {
 386                             addTypeSummaryLink(memberSummaryBuilder.members(kind),
 387                                     memberSummaryBuilder.getVisibleMemberTable(),
 388                                     kind, listContents);
 389                         }
 390                     }
 391                 }
 392                 if (!listContents.isEmpty()) {
 393                     Content li = HtmlTree.LI(contents.summaryLabel);
<span class="line-modified"> 394                     li.add(Entity.NO_BREAK_SPACE);</span>
 395                     tree.add(li);
 396                     addListToNav(listContents, tree);
 397                 }
 398                 break;
 399             case MODULE:
 400                 if (displaySummaryModuleDescLink) {
 401                     addContentToList(listContents,
 402                             links.createLink(SectionName.MODULE_DESCRIPTION, contents.navModuleDescription));
 403                 } else {
 404                     addContentToList(listContents, contents.navModuleDescription);
 405                 }
 406                 if (displaySummaryModulesLink) {
 407                     addContentToList(listContents,
 408                             links.createLink(SectionName.MODULES, contents.navModules));
 409                 } else {
 410                     addContentToList(listContents, contents.navModules);
 411                 }
 412                 if (displaySummaryPackagesLink) {
 413                     addContentToList(listContents,
 414                             links.createLink(SectionName.PACKAGES, contents.navPackages));
 415                 } else {
 416                     addContentToList(listContents, contents.navPackages);
 417                 }
 418                 if (displaySummaryServicesLink) {
 419                     addContentToList(listContents,
 420                             links.createLink(SectionName.SERVICES, contents.navServices));
 421                 } else {
 422                     addContentToList(listContents, contents.navServices);
 423                 }
 424                 if (!listContents.isEmpty()) {
 425                     Content li = HtmlTree.LI(contents.moduleSubNavLabel);
<span class="line-modified"> 426                     li.add(Entity.NO_BREAK_SPACE);</span>
 427                     tree.add(li);
 428                     addListToNav(listContents, tree);
 429                 }
 430                 break;
 431             default:
 432                 break;
 433         }
 434     }
 435 
 436     /**
 437      * Add the navigation summary link.
 438      *
 439      * @param members members to be linked
 440      * @param vmt the visible member table
 441      * @param kind the visible member kind
 442      * @param listContents the list of contents
 443      */
 444     private void addTypeSummaryLink(SortedSet&lt;? extends Element&gt; members,
 445             VisibleMemberTable vmt,
 446             VisibleMemberTable.Kind kind, List&lt;Content&gt; listContents) {
</pre>
<hr />
<pre>
 610                     TypeElement typeElement = (TypeElement) element;
 611                     for (VisibleMemberTable.Kind kind : detailSet) {
 612                         AbstractMemberWriter writer
 613                                 = ((AbstractMemberWriter) memberSummaryBuilder.
 614                                         getMemberSummaryWriter(kind));
 615                         if (kind == ENUM_CONSTANTS &amp;&amp; !configuration.utils.isEnum(typeElement)) {
 616                             continue;
 617                         }
 618                         if (kind == CONSTRUCTORS &amp;&amp; configuration.utils.isEnum(typeElement)) {
 619                             continue;
 620                         }
 621                         if (writer == null) {
 622                             addContentToList(listContents, contents.getNavLinkLabelContent(kind));
 623                         } else {
 624                             addTypeDetailLink(kind, memberSummaryBuilder.hasMembers(kind), listContents);
 625                         }
 626                     }
 627                 }
 628                 if (!listContents.isEmpty()) {
 629                     Content li = HtmlTree.LI(contents.detailLabel);
<span class="line-modified"> 630                     li.add(Entity.NO_BREAK_SPACE);</span>
 631                     tree.add(li);
 632                     addListToNav(listContents, tree);
 633                 }
 634                 break;
 635             default:
 636                 break;
 637         }
 638     }
 639 
 640     /**
 641      * Add the navigation Type detail link.
 642      *
 643      * @param kind the kind of member being documented
 644      * @param link true if the members are listed and need to be linked
 645      * @param listContents the list of contents to which the detail will be added.
 646      */
 647     protected void addTypeDetailLink(VisibleMemberTable.Kind kind, boolean link, List&lt;Content&gt; listContents) {
 648         switch (kind) {
 649             case CONSTRUCTORS:
 650                 if (link) {
</pre>
<hr />
<pre>
 746                     addContentToList(listContents, contents.navAnnotationTypeMember);
 747                 }
 748                 break;
 749             default:
 750                 break;
 751         }
 752     }
 753 
 754     private void addContentToList(List&lt;Content&gt; listContents, Content tree) {
 755         listContents.add(HtmlTree.LI(tree));
 756     }
 757 
 758     private void addContentToTree(Content tree, Content content) {
 759         tree.add(HtmlTree.LI(content));
 760     }
 761 
 762     private void addListToNav(List&lt;Content&gt; listContents, Content tree) {
 763         int count = 0;
 764         for (Content liContent : listContents) {
 765             if (count &lt; listContents.size() - 1) {
<span class="line-modified"> 766                 liContent.add(Entity.NO_BREAK_SPACE);</span>
 767                 liContent.add(&quot;|&quot;);
<span class="line-modified"> 768                 liContent.add(Entity.NO_BREAK_SPACE);</span>
 769             }
 770             tree.add(liContent);
 771             count++;
 772         }
 773     }
 774 
 775     private void addActivePageLink(Content tree, Content label, boolean display) {
 776         if (display) {
 777             tree.add(HtmlTree.LI(HtmlStyle.navBarCell1Rev, label));
 778         }
 779     }
 780 
 781     private void addPageLabel(Content tree, Content label, boolean display) {
 782         if (display) {
 783             tree.add(HtmlTree.LI(label));
 784         }
 785     }
 786 
 787     private void addOverviewLink(Content tree) {
<span class="line-modified"> 788         if (options.createOverview()) {</span>
<span class="line-modified"> 789             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(DocPaths.INDEX),</span>
 790                     contents.overviewLabel, &quot;&quot;, &quot;&quot;)));
 791         }
 792     }
 793 
 794     private void addModuleLink(Content tree) {
 795         if (configuration.showModules) {
 796             if (configuration.modules.size() == 1) {
 797                 ModuleElement mdle = configuration.modules.first();
 798                 boolean included = configuration.utils.isIncluded(mdle);
 799                 tree.add(HtmlTree.LI((included)
 800                         ? links.createLink(pathToRoot.resolve(configuration.docPaths.moduleSummary(mdle)), contents.moduleLabel, &quot;&quot;, &quot;&quot;)
 801                         : contents.moduleLabel));
 802             } else if (!configuration.modules.isEmpty()) {
 803                 addPageLabel(tree, contents.moduleLabel, true);
 804             }
 805         }
 806     }
 807 
 808     private void addModuleOfElementLink(Content tree) {
 809         if (configuration.showModules) {
</pre>
<hr />
<pre>
 834                     tree.add(HtmlTree.LI(links.createLink(crossPkgLink, contents.packageLabel)));
 835                 } else {
 836                     tree.add(HtmlTree.LI(contents.packageLabel));
 837                 }
 838             }
 839         } else if (!configuration.packages.isEmpty()) {
 840             addPageLabel(tree, contents.packageLabel, true);
 841         }
 842     }
 843 
 844     private void addPackageOfElementLink(Content tree) {
 845         tree.add(HtmlTree.LI(links.createLink(DocPath.parent.resolve(DocPaths.PACKAGE_SUMMARY),
 846                 contents.packageLabel)));
 847     }
 848 
 849     private void addPackageSummaryLink(Content tree) {
 850         tree.add(HtmlTree.LI(links.createLink(DocPaths.PACKAGE_SUMMARY, contents.packageLabel)));
 851     }
 852 
 853     private void addTreeLink(Content tree) {
<span class="line-modified"> 854         if (options.createTree()) {</span>
 855             List&lt;PackageElement&gt; packages = new ArrayList&lt;&gt;(configuration.getSpecifiedPackageElements());
 856             DocPath docPath = packages.size() == 1 &amp;&amp; configuration.getSpecifiedTypeElements().isEmpty()
 857                     ? pathToRoot.resolve(configuration.docPaths.forPackage(packages.get(0)).resolve(DocPaths.PACKAGE_TREE))
 858                     : pathToRoot.resolve(DocPaths.OVERVIEW_TREE);
 859             tree.add(HtmlTree.LI(links.createLink(docPath, contents.treeLabel, &quot;&quot;, &quot;&quot;)));
 860         }
 861     }
 862 
 863     private void addDeprecatedLink(Content tree) {
<span class="line-modified"> 864         if (!(options.noDeprecated() || options.noDeprecatedList())) {</span>
 865             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(DocPaths.DEPRECATED_LIST),
 866                     contents.deprecatedLabel, &quot;&quot;, &quot;&quot;)));
 867         }
 868     }
 869 
 870     private void addIndexLink(Content tree) {
<span class="line-modified"> 871         if (options.createIndex()) {</span>
 872             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(
<span class="line-modified"> 873                     (options.splitIndex()</span>
 874                             ? DocPaths.INDEX_FILES.resolve(DocPaths.indexN(1))
 875                             : DocPaths.INDEX_ALL)),
 876                     contents.indexLabel, &quot;&quot;, &quot;&quot;)));
 877         }
 878     }
 879 
 880     private void addHelpLink(Content tree) {
<span class="line-modified"> 881         if (!options.noHelp()) {</span>
<span class="line-modified"> 882             String helpfile = options.helpFile();</span>
 883             DocPath helpfilenm;
 884             if (helpfile.isEmpty()) {
 885                 helpfilenm = DocPaths.HELP_DOC;
 886             } else {
 887                 DocFile file = DocFile.createFileForInput(configuration, helpfile);
 888                 helpfilenm = DocPath.create(file.getName());
 889             }
 890             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(helpfilenm),
 891                     contents.helpLabel, &quot;&quot;, &quot;&quot;)));
 892         }
 893     }
 894 





















 895     private void addSearch(Content tree) {
 896         String searchValueId = &quot;search&quot;;
 897         String reset = &quot;reset&quot;;
 898         HtmlTree inputText = HtmlTree.INPUT(&quot;text&quot;, searchValueId, searchValueId);
 899         HtmlTree inputReset = HtmlTree.INPUT(reset, reset, reset);
<span class="line-modified"> 900         HtmlTree searchDiv = HtmlTree.DIV(HtmlStyle.navListSearch, HtmlTree.LABEL(searchValueId, searchLabel));</span>
<span class="line-modified"> 901         searchDiv.add(inputText);</span>
<span class="line-modified"> 902         searchDiv.add(inputReset);</span>
<span class="line-modified"> 903         tree.add(searchDiv);</span>





 904     }
 905 
 906     /**
 907      * Get the navigation content.
 908      *
 909      * @param top true if the top navigation bar is to be printed
 910      * @return the navigation contents
 911      */
 912     public Content getContent(boolean top) {
<span class="line-modified"> 913         if (options.noNavbar()) {</span>
<span class="line-modified"> 914             return new ContentBuilder();</span>
<span class="line-modified"> 915         }</span>
<span class="line-modified"> 916         Content tree = HtmlTree.NAV();</span>
<span class="line-modified"> 917         HtmlTree navDiv = new HtmlTree(HtmlTag.DIV);</span>
<span class="line-modified"> 918         Content skipNavLinks = contents.getContent(&quot;doclet.Skip_navigation_links&quot;);</span>
<span class="line-modified"> 919         if (top) {</span>
<span class="line-modified"> 920             tree.add(Position.TOP.startOfNav());</span>
<span class="line-modified"> 921             navDiv.setStyle(HtmlStyle.topNav)</span>
<span class="line-modified"> 922                     .setId(SectionName.NAVBAR_TOP.getName())</span>
<span class="line-modified"> 923                     .add(HtmlTree.DIV(HtmlStyle.skipNav,</span>
<span class="line-modified"> 924                             links.createLink(SectionName.SKIP_NAVBAR_TOP, skipNavLinks,</span>
<span class="line-modified"> 925                                     skipNavLinks.toString(), &quot;&quot;)));</span>
<span class="line-modified"> 926         } else {</span>
<span class="line-modified"> 927             tree.add(Position.BOTTOM.startOfNav());</span>
<span class="line-modified"> 928             navDiv.setStyle(HtmlStyle.bottomNav)</span>
<span class="line-modified"> 929                     .setId(SectionName.NAVBAR_BOTTOM.getName())</span>
<span class="line-modified"> 930                     .add(HtmlTree.DIV(HtmlStyle.skipNav,</span>
<span class="line-modified"> 931                             links.createLink(SectionName.SKIP_NAVBAR_BOTTOM, skipNavLinks,</span>
<span class="line-modified"> 932                                     skipNavLinks.toString(), &quot;&quot;)));</span>
<span class="line-modified"> 933         }</span>
<span class="line-modified"> 934         HtmlTree navList = new HtmlTree(HtmlTag.UL);</span>
<span class="line-modified"> 935         navList.setId(top ? SectionName.NAVBAR_TOP_FIRSTROW.getName()</span>
<span class="line-modified"> 936                           : SectionName.NAVBAR_BOTTOM_FIRSTROW.getName());</span>
<span class="line-modified"> 937         navList.setStyle(HtmlStyle.navList);</span>
<span class="line-modified"> 938         navList.put(HtmlAttr.TITLE, rowListTitle);</span>
<span class="line-modified"> 939         addMainNavLinks(navList);</span>
<span class="line-modified"> 940         navDiv.add(navList);</span>
<span class="line-modified"> 941         Content aboutDiv = HtmlTree.DIV(HtmlStyle.aboutLanguage, top ? userHeader : userFooter);</span>
<span class="line-modified"> 942         navDiv.add(aboutDiv);</span>
<span class="line-modified"> 943         tree.add(navDiv);</span>
<span class="line-modified"> 944         HtmlTree subDiv = new HtmlTree(HtmlTag.DIV);</span>
<span class="line-modified"> 945         subDiv.setStyle(HtmlStyle.subNav);</span>
<span class="line-modified"> 946         HtmlTree div = new HtmlTree(HtmlTag.DIV);</span>
<span class="line-modified"> 947         // Add the summary links if present.</span>
<span class="line-modified"> 948         HtmlTree ulNavSummary = new HtmlTree(HtmlTag.UL);</span>
<span class="line-modified"> 949         ulNavSummary.setStyle(HtmlStyle.subNavList);</span>
<span class="line-modified"> 950         addSummaryLinks(ulNavSummary);</span>
<span class="line-modified"> 951         div.add(ulNavSummary);</span>
<span class="line-modified"> 952         // Add the detail links if present.</span>
<span class="line-modified"> 953         HtmlTree ulNavDetail = new HtmlTree(HtmlTag.UL);</span>
<span class="line-modified"> 954         ulNavDetail.setStyle(HtmlStyle.subNavList);</span>
<span class="line-modified"> 955         addDetailLinks(ulNavDetail);</span>
<span class="line-modified"> 956         div.add(ulNavDetail);</span>
<span class="line-modified"> 957         subDiv.add(div);</span>
<span class="line-modified"> 958         if (top &amp;&amp; options.createIndex()) {</span>
<span class="line-modified"> 959             addSearch(subDiv);</span>
<span class="line-modified"> 960         }</span>
<span class="line-modified"> 961         tree.add(subDiv);</span>
<span class="line-modified"> 962         if (top) {</span>
<span class="line-modified"> 963             tree.add(Position.TOP.endOfNav());</span>
<span class="line-modified"> 964             tree.add(HtmlTree.SPAN(HtmlStyle.skipNav, EMPTY_COMMENT)</span>
<span class="line-modified"> 965                     .setId(SectionName.SKIP_NAVBAR_TOP.getName()));</span>
<span class="line-modified"> 966         } else {</span>
<span class="line-modified"> 967             tree.add(Position.BOTTOM.endOfNav());</span>
<span class="line-modified"> 968             tree.add(HtmlTree.SPAN(HtmlStyle.skipNav, EMPTY_COMMENT)</span>
<span class="line-modified"> 969                     .setId(SectionName.SKIP_NAVBAR_BOTTOM.getName()));</span>














 970         }
<span class="line-modified"> 971         return tree;</span>
 972     }
 973 }
</pre>
</td>
</tr>
</table>
<center><a href="Links.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="RawHtml.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>