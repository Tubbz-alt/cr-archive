<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/markup/HtmlTree.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HtmlTag.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="Links.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/markup/HtmlTree.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2010, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  30 import java.nio.charset.Charset;
  31 import java.util.ArrayList;
  32 import java.util.BitSet;
  33 import java.util.Collections;
  34 import java.util.Iterator;
  35 import java.util.LinkedHashMap;
  36 import java.util.List;
  37 import java.util.Map;
  38 
  39 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlAttr.Role;
  40 import jdk.javadoc.internal.doclets.toolkit.Content;
  41 import jdk.javadoc.internal.doclets.toolkit.util.DocletConstants;
  42 
  43 /**
  44  * Class for generating HTML tree for javadoc output.
  45  *
  46  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
  47  *  If you write code that depends on this, you do so at your own risk.
  48  *  This code and its internal interfaces are subject to change or
  49  *  deletion without notice.&lt;/b&gt;
<span class="line-removed">  50  *</span>
<span class="line-removed">  51  * @author Bhavesh Patel</span>
  52  */
  53 public class HtmlTree extends Content {
  54 
  55     public final HtmlTag htmlTag;
  56     private Map&lt;HtmlAttr,String&gt; attrs = Collections.emptyMap();
  57     private List&lt;Content&gt; content = Collections.emptyList();
  58     public static final Content EMPTY = new StringContent(&quot;&quot;);
  59 
  60     /**
  61      * Constructor to construct HtmlTree object.
  62      *
  63      * @param tag HTML tag for the HtmlTree object
  64      */
  65     public HtmlTree(HtmlTag tag) {
  66         htmlTag = nullCheck(tag);
  67     }
  68 
  69     /**
  70      * Constructor to construct HtmlTree object.
  71      *
</pre>
<hr />
<pre>
  83      *
  84      * @param tag HTML tag for the HtmlTree object
  85      * @param contents contents to be added to the tree
  86      */
  87     public HtmlTree(HtmlTag tag, List&lt;Content&gt; contents) {
  88         this(tag);
  89         for (Content c: contents)
  90             add(c);
  91     }
  92 
  93     /**
  94      * Adds an attribute for the HTML tag.
  95      *
  96      * @param attrName name of the attribute
  97      * @param attrValue value of the attribute
  98      * @return this object
  99      */
 100     public HtmlTree put(HtmlAttr attrName, String attrValue) {
 101         if (attrs.isEmpty())
 102             attrs = new LinkedHashMap&lt;&gt;(3);
<span class="line-modified"> 103         attrs.put(nullCheck(attrName), escapeHtmlChars(attrValue));</span>











 104         return this;
 105     }
 106 
 107     /**
 108      * Sets the &quot;title&quot; attribute for this tag.
 109      * Any HTML tags in the content will be removed.
 110      *
 111      * @param body the content for the title attribute
 112      * @return this object
 113      */
 114     public HtmlTree setTitle(Content body) {
 115         put(HtmlAttr.TITLE, stripHtml(body));
 116         return this;
 117     }
 118 
 119     /**
 120      * Sets the &quot;role&quot; attribute for this tag.
 121      *
 122      * @param role the role
 123      * @return this object
</pre>
<hr />
<pre>
 160     /**
 161      * Adds String content to the HTML tree. If the last content member
 162      * added is a StringContent, append the string to that StringContent or else
 163      * create a new StringContent and add it to the HTML tree.
 164      *
 165      * @param stringContent string content that needs to be added
 166      */
 167     @Override
 168     public void add(CharSequence stringContent) {
 169         if (!content.isEmpty()) {
 170             Content lastContent = content.get(content.size() - 1);
 171             if (lastContent instanceof StringContent)
 172                 lastContent.add(stringContent);
 173             else
 174                 add(new StringContent(stringContent));
 175         }
 176         else
 177             add(new StringContent(stringContent));
 178     }
 179 
<span class="line-removed"> 180     /**</span>
<span class="line-removed"> 181      * {@inheritDoc}</span>
<span class="line-removed"> 182      */</span>
 183     @Override
 184     public int charCount() {
 185         int n = 0;
 186         for (Content c : content)
 187             n += c.charCount();
 188         return n;
 189     }
 190 
<span class="line-removed"> 191     /**</span>
<span class="line-removed"> 192      * Given a string, escape all special HTML characters and</span>
<span class="line-removed"> 193      * return the result.</span>
<span class="line-removed"> 194      *</span>
<span class="line-removed"> 195      * @param s The string to check.</span>
<span class="line-removed"> 196      * @return the original string with all of the HTML characters escaped.</span>
<span class="line-removed"> 197      */</span>
<span class="line-removed"> 198     private static String escapeHtmlChars(String s) {</span>
<span class="line-removed"> 199         for (int i = 0; i &lt; s.length(); i++) {</span>
<span class="line-removed"> 200             char ch = s.charAt(i);</span>
<span class="line-removed"> 201             switch (ch) {</span>
<span class="line-removed"> 202                 // only start building a new string if we need to</span>
<span class="line-removed"> 203                 case &#39;&lt;&#39;: case &#39;&gt;&#39;: case &#39;&amp;&#39;:</span>
<span class="line-removed"> 204                     StringBuilder sb = new StringBuilder(s.substring(0, i));</span>
<span class="line-removed"> 205                     for ( ; i &lt; s.length(); i++) {</span>
<span class="line-removed"> 206                         ch = s.charAt(i);</span>
<span class="line-removed"> 207                         switch (ch) {</span>
<span class="line-removed"> 208                             case &#39;&lt;&#39;: sb.append(&quot;&amp;lt;&quot;);  break;</span>
<span class="line-removed"> 209                             case &#39;&gt;&#39;: sb.append(&quot;&amp;gt;&quot;);  break;</span>
<span class="line-removed"> 210                             case &#39;&amp;&#39;: sb.append(&quot;&amp;amp;&quot;); break;</span>
<span class="line-removed"> 211                             default:  sb.append(ch);      break;</span>
<span class="line-removed"> 212                         }</span>
<span class="line-removed"> 213                     }</span>
<span class="line-removed"> 214                     return sb.toString();</span>
<span class="line-removed"> 215             }</span>
<span class="line-removed"> 216         }</span>
<span class="line-removed"> 217         return s;</span>
<span class="line-removed"> 218     }</span>
<span class="line-removed"> 219 </span>
 220     /*
 221      * The sets of ASCII URI characters to be left unencoded.
 222      * See &quot;Uniform Resource Identifier (URI): Generic Syntax&quot;
 223      * IETF RFC 3986. https://tools.ietf.org/html/rfc3986
 224      */
 225     public static final BitSet MAIN_CHARS;
 226     public static final BitSet QUERY_FRAGMENT_CHARS;
 227 
 228     static {
 229         BitSet alphaDigit = bitSet(bitSet(&#39;A&#39;, &#39;Z&#39;), bitSet(&#39;a&#39;, &#39;z&#39;), bitSet(&#39;0&#39;, &#39;9&#39;));
 230         BitSet unreserved = bitSet(alphaDigit, bitSet(&quot;-._~&quot;));
 231         BitSet genDelims = bitSet(&quot;:/?#[]@&quot;);
 232         BitSet subDelims = bitSet(&quot;!$&amp;&#39;()*+,;=&quot;);
 233         MAIN_CHARS = bitSet(unreserved, genDelims, subDelims);
 234         BitSet pchar = bitSet(unreserved, subDelims, bitSet(&quot;:@&quot;));
 235         QUERY_FRAGMENT_CHARS = bitSet(pchar, bitSet(&quot;/?&quot;));
 236     }
 237 
 238     private static BitSet bitSet(String s) {
 239         BitSet result = new BitSet();
</pre>
<hr />
<pre>
 281             } else {
 282                 sb.append(String.format(&quot;%%%02X&quot;, c &amp; 0xFF));
 283             }
 284         }
 285         return sb.toString();
 286     }
 287 
 288     /**
 289      * Generates an HTML anchor tag.
 290      *
 291      * @param ref reference url for the anchor tag
 292      * @param body content for the anchor tag
 293      * @return an HtmlTree object
 294      */
 295     public static HtmlTree A(String ref, Content body) {
 296         HtmlTree htmltree = new HtmlTree(HtmlTag.A, nullCheck(body));
 297         htmltree.put(HtmlAttr.HREF, encodeURL(ref));
 298         return htmltree;
 299     }
 300 
<span class="line-removed"> 301     /**</span>
<span class="line-removed"> 302      * Generates an HTML anchor tag with id attribute and a body.</span>
<span class="line-removed"> 303      *</span>
<span class="line-removed"> 304      * @param id id for the anchor tag</span>
<span class="line-removed"> 305      * @param body body for the anchor tag</span>
<span class="line-removed"> 306      * @return an HtmlTree object</span>
<span class="line-removed"> 307      */</span>
<span class="line-removed"> 308     public static HtmlTree A_ID(String id, Content body) {</span>
<span class="line-removed"> 309         HtmlTree htmltree = new HtmlTree(HtmlTag.A);</span>
<span class="line-removed"> 310         htmltree.put(HtmlAttr.ID, nullCheck(id));</span>
<span class="line-removed"> 311         htmltree.add(nullCheck(body));</span>
<span class="line-removed"> 312         return htmltree;</span>
<span class="line-removed"> 313     }</span>
<span class="line-removed"> 314 </span>
<span class="line-removed"> 315     /**</span>
<span class="line-removed"> 316      * Generates an HTML anchor tag with a style class, id attribute and a body.</span>
<span class="line-removed"> 317      *</span>
<span class="line-removed"> 318      * @param styleClass stylesheet class for the tag</span>
<span class="line-removed"> 319      * @param id id for the anchor tag</span>
<span class="line-removed"> 320      * @param body body for the anchor tag</span>
<span class="line-removed"> 321      * @return an HtmlTree object</span>
<span class="line-removed"> 322      */</span>
<span class="line-removed"> 323     public static HtmlTree A_ID(HtmlStyle styleClass, String id, Content body) {</span>
<span class="line-removed"> 324         HtmlTree htmltree = A_ID(id, body);</span>
<span class="line-removed"> 325         if (styleClass != null)</span>
<span class="line-removed"> 326             htmltree.setStyle(styleClass);</span>
<span class="line-removed"> 327         return htmltree;</span>
<span class="line-removed"> 328     }</span>
<span class="line-removed"> 329 </span>
 330     /**
 331      * Generates a CAPTION tag with some content.
 332      *
 333      * @param body content for the tag
 334      * @return an HtmlTree object for the CAPTION tag
 335      */
 336     public static HtmlTree CAPTION(Content body) {
 337         HtmlTree htmltree = new HtmlTree(HtmlTag.CAPTION, nullCheck(body));
 338         return htmltree;
 339     }
 340 
 341     /**
 342      * Generates a CODE tag with some content.
 343      *
 344      * @param body content for the tag
 345      * @return an HtmlTree object for the CODE tag
 346      */
 347     public static HtmlTree CODE(Content body) {
 348         HtmlTree htmltree = new HtmlTree(HtmlTag.CODE, nullCheck(body));
 349         return htmltree;
</pre>
<hr />
<pre>
 595      * @return an HtmlTree object for the MAIN tag
 596      */
 597     public static HtmlTree MAIN() {
 598         HtmlTree htmltree = new HtmlTree(HtmlTag.MAIN);
 599         htmltree.setRole(Role.MAIN);
 600         return htmltree;
 601     }
 602 
 603     /**
 604      * Generates a MAIN tag with role attribute and some content.
 605      *
 606      * @param body content of the MAIN tag
 607      * @return an HtmlTree object for the MAIN tag
 608      */
 609     public static HtmlTree MAIN(Content body) {
 610         HtmlTree htmltree = new HtmlTree(HtmlTag.MAIN, nullCheck(body));
 611         htmltree.setRole(Role.MAIN);
 612         return htmltree;
 613     }
 614 
<span class="line-removed"> 615     /**</span>
<span class="line-removed"> 616      * Generates a MAIN tag with role attribute, style attribute and some content.</span>
<span class="line-removed"> 617      *</span>
<span class="line-removed"> 618      * @param styleClass style of the MAIN tag</span>
<span class="line-removed"> 619      * @param body content of the MAIN tag</span>
<span class="line-removed"> 620      * @return an HtmlTree object for the MAIN tag</span>
<span class="line-removed"> 621      */</span>
<span class="line-removed"> 622     public static HtmlTree MAIN(HtmlStyle styleClass, Content body) {</span>
<span class="line-removed"> 623         HtmlTree htmltree = HtmlTree.MAIN(body);</span>
<span class="line-removed"> 624         if (styleClass != null) {</span>
<span class="line-removed"> 625             htmltree.setStyle(styleClass);</span>
<span class="line-removed"> 626         }</span>
<span class="line-removed"> 627         return htmltree;</span>
<span class="line-removed"> 628     }</span>
<span class="line-removed"> 629 </span>
 630     /**
 631      * Generates a META tag with the http-equiv, content and charset attributes.
 632      *
 633      * @param httpEquiv http equiv attribute for the META tag
 634      * @param content type of content
 635      * @param charSet character set used
 636      * @return an HtmlTree object for the META tag
 637      */
 638     public static HtmlTree META(String httpEquiv, String content, String charSet) {
 639         HtmlTree htmltree = new HtmlTree(HtmlTag.META);
 640         String contentCharset = content + &quot;; charset=&quot; + charSet;
 641         htmltree.put(HtmlAttr.HTTP_EQUIV, nullCheck(httpEquiv));
 642         htmltree.put(HtmlAttr.CONTENT, contentCharset);
 643         return htmltree;
 644     }
 645 
 646     /**
 647      * Generates a META tag with the name and content attributes.
 648      *
 649      * @param name name attribute
</pre>
<hr />
<pre>
 700         HtmlTree htmltree = new HtmlTree(HtmlTag.P, nullCheck(body));
 701         if (styleClass != null)
 702             htmltree.setStyle(styleClass);
 703         return htmltree;
 704     }
 705 
 706     /**
 707      * Generates a SCRIPT tag with the type and src attributes.
 708      *
 709      * @param src the path for the script
 710      * @return an HtmlTree object for the SCRIPT tag
 711      */
 712     public static HtmlTree SCRIPT(String src) {
 713         HtmlTree htmltree = new HtmlTree(HtmlTag.SCRIPT);
 714         htmltree.put(HtmlAttr.TYPE, &quot;text/javascript&quot;);
 715         htmltree.put(HtmlAttr.SRC, nullCheck(src));
 716         return htmltree;
 717     }
 718 
 719     /**
<span class="line-modified"> 720      * Generates a SECTION tag with role attribute.</span>
 721      *

 722      * @return an HtmlTree object for the SECTION tag
 723      */
<span class="line-modified"> 724     public static HtmlTree SECTION() {</span>
<span class="line-modified"> 725         HtmlTree htmltree = new HtmlTree(HtmlTag.SECTION);</span>
<span class="line-modified"> 726         htmltree.setRole(Role.REGION);</span>
<span class="line-modified"> 727         return htmltree;</span>
 728     }
 729 
 730     /**
<span class="line-modified"> 731      * Generates a SECTION tag with role attribute and some content.</span>
 732      *

 733      * @param body content of the section tag
 734      * @return an HtmlTree object for the SECTION tag
 735      */
<span class="line-modified"> 736     public static HtmlTree SECTION(Content body) {</span>
<span class="line-modified"> 737         HtmlTree htmltree = new HtmlTree(HtmlTag.SECTION, nullCheck(body));</span>
<span class="line-modified"> 738         htmltree.setRole(Role.REGION);</span>
<span class="line-modified"> 739         return htmltree;</span>


 740     }
 741 
 742     /**
 743      * Generates a SMALL tag with some content.
 744      *
 745      * @param body content for the tag
 746      * @return an HtmlTree object for the SMALL tag
 747      */
 748     public static HtmlTree SMALL(Content body) {
 749         HtmlTree htmltree = new HtmlTree(HtmlTag.SMALL, nullCheck(body));
 750         return htmltree;
 751     }
 752 
 753     /**
 754      * Generates a SPAN tag with some content.
 755      *
 756      * @param body content for the tag
 757      * @return an HtmlTree object for the SPAN tag
 758      */
 759     public static HtmlTree SPAN(Content body) {
 760         return SPAN(null, body);
 761     }
 762 
 763     /**
 764      * Generates a SPAN tag with style class attribute and some content.
 765      *
 766      * @param styleClass style class for the tag
 767      * @param body content for the tag
 768      * @return an HtmlTree object for the SPAN tag
 769      */
 770     public static HtmlTree SPAN(HtmlStyle styleClass, Content body) {
 771         HtmlTree htmltree = new HtmlTree(HtmlTag.SPAN, nullCheck(body));
 772         if (styleClass != null)
 773             htmltree.setStyle(styleClass);
 774         return htmltree;
 775     }
 776 













 777     /**
 778      * Generates a SPAN tag with id and style class attributes. It also encloses
 779      * a content.
 780      *
 781      * @param id the id for the tag
 782      * @param styleClass stylesheet class for the tag
 783      * @param body content for the tag
 784      * @return an HtmlTree object for the SPAN tag
 785      */
 786     public static HtmlTree SPAN(String id, HtmlStyle styleClass, Content body) {
 787         HtmlTree htmltree = new HtmlTree(HtmlTag.SPAN, nullCheck(body));
 788         htmltree.put(HtmlAttr.ID, nullCheck(id));
 789         if (styleClass != null)
 790             htmltree.setStyle(styleClass);
 791         return htmltree;
 792     }
 793 
 794     /**
 795      * Generates a Table tag with style class and summary attributes and some content.
 796      *
</pre>
<hr />
<pre>
 907     }
 908 
 909     /**
 910      * Generates a UL tag with the style class attribute and some content.
 911      *
 912      * @param styleClass style for the tag
 913      * @param first initial content to be added
 914      * @param more a series of additional content nodes to be added
 915      * @return an HtmlTree object for the UL tag
 916      */
 917     public static HtmlTree UL(HtmlStyle styleClass, Content first, Content... more) {
 918         HtmlTree htmlTree = new HtmlTree(HtmlTag.UL);
 919         htmlTree.add(nullCheck(first));
 920         for (Content c : more) {
 921             htmlTree.add(nullCheck(c));
 922         }
 923         htmlTree.setStyle(nullCheck(styleClass));
 924         return htmlTree;
 925     }
 926 
<span class="line-removed"> 927     /**</span>
<span class="line-removed"> 928      * {@inheritDoc}</span>
<span class="line-removed"> 929      */</span>
 930     @Override
 931     public boolean isEmpty() {
 932         return (!hasContent() &amp;&amp; !hasAttrs());
 933     }
 934 
 935     /**
 936      * Returns true if the HTML tree has content.
 937      *
 938      * @return true if the HTML tree has content else return false
 939      */
 940     public boolean hasContent() {
 941         return (!content.isEmpty());
 942     }
 943 
 944     /**
 945      * Returns true if the HTML tree has attributes.
 946      *
 947      * @return true if the HTML tree has attributes else return false
 948      */
 949     public boolean hasAttrs() {
</pre>
<hr />
<pre>
 971     public boolean isValid() {
 972         switch (htmlTag) {
 973             case A :
 974                 return (hasAttr(HtmlAttr.NAME) || hasAttr(HtmlAttr.ID) || (hasAttr(HtmlAttr.HREF) &amp;&amp; hasContent()));
 975             case BR :
 976                 return (!hasContent() &amp;&amp; (!hasAttrs() || hasAttr(HtmlAttr.CLEAR)));
 977             case IFRAME :
 978                 return (hasAttr(HtmlAttr.SRC) &amp;&amp; !hasContent());
 979             case HR :
 980             case INPUT:
 981                 return (!hasContent());
 982             case IMG :
 983                 return (hasAttr(HtmlAttr.SRC) &amp;&amp; hasAttr(HtmlAttr.ALT) &amp;&amp; !hasContent());
 984             case LINK :
 985                 return (hasAttr(HtmlAttr.HREF) &amp;&amp; !hasContent());
 986             case META :
 987                 return (hasAttr(HtmlAttr.CONTENT) &amp;&amp; !hasContent());
 988             case SCRIPT :
 989                 return ((hasAttr(HtmlAttr.TYPE) &amp;&amp; hasAttr(HtmlAttr.SRC) &amp;&amp; !hasContent()) ||
 990                         (hasAttr(HtmlAttr.TYPE) &amp;&amp; hasContent()));


 991             default :
 992                 return hasContent();
 993         }
 994     }
 995 
 996     /**
 997      * Returns true if the element is an inline element.
 998      *
 999      * @return true if the HTML tag is an inline element
1000      */
1001     public boolean isInline() {
1002         return (htmlTag.blockType == HtmlTag.BlockType.INLINE);
1003     }
1004 
<span class="line-removed">1005     /**</span>
<span class="line-removed">1006      * {@inheritDoc}</span>
<span class="line-removed">1007      */</span>
1008     @Override
1009     public boolean write(Writer out, boolean atNewline) throws IOException {
1010         if (!isInline() &amp;&amp; !atNewline)
1011             out.write(DocletConstants.NL);
1012         String tagString = htmlTag.toString();
1013         out.write(&quot;&lt;&quot;);
1014         out.write(tagString);
1015         Iterator&lt;HtmlAttr&gt; iterator = attrs.keySet().iterator();
1016         HtmlAttr key;
1017         String value;
1018         while (iterator.hasNext()) {
1019             key = iterator.next();
1020             value = attrs.get(key);
1021             out.write(&quot; &quot;);
1022             out.write(key.toString());
1023             if (!value.isEmpty()) {
1024                 out.write(&quot;=\&quot;&quot;);
1025                 out.write(value);
1026                 out.write(&quot;\&quot;&quot;);
1027             }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2010, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  30 import java.nio.charset.Charset;
  31 import java.util.ArrayList;
  32 import java.util.BitSet;
  33 import java.util.Collections;
  34 import java.util.Iterator;
  35 import java.util.LinkedHashMap;
  36 import java.util.List;
  37 import java.util.Map;
  38 
  39 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlAttr.Role;
  40 import jdk.javadoc.internal.doclets.toolkit.Content;
  41 import jdk.javadoc.internal.doclets.toolkit.util.DocletConstants;
  42 
  43 /**
  44  * Class for generating HTML tree for javadoc output.
  45  *
  46  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
  47  *  If you write code that depends on this, you do so at your own risk.
  48  *  This code and its internal interfaces are subject to change or
  49  *  deletion without notice.&lt;/b&gt;


  50  */
  51 public class HtmlTree extends Content {
  52 
  53     public final HtmlTag htmlTag;
  54     private Map&lt;HtmlAttr,String&gt; attrs = Collections.emptyMap();
  55     private List&lt;Content&gt; content = Collections.emptyList();
  56     public static final Content EMPTY = new StringContent(&quot;&quot;);
  57 
  58     /**
  59      * Constructor to construct HtmlTree object.
  60      *
  61      * @param tag HTML tag for the HtmlTree object
  62      */
  63     public HtmlTree(HtmlTag tag) {
  64         htmlTag = nullCheck(tag);
  65     }
  66 
  67     /**
  68      * Constructor to construct HtmlTree object.
  69      *
</pre>
<hr />
<pre>
  81      *
  82      * @param tag HTML tag for the HtmlTree object
  83      * @param contents contents to be added to the tree
  84      */
  85     public HtmlTree(HtmlTag tag, List&lt;Content&gt; contents) {
  86         this(tag);
  87         for (Content c: contents)
  88             add(c);
  89     }
  90 
  91     /**
  92      * Adds an attribute for the HTML tag.
  93      *
  94      * @param attrName name of the attribute
  95      * @param attrValue value of the attribute
  96      * @return this object
  97      */
  98     public HtmlTree put(HtmlAttr attrName, String attrValue) {
  99         if (attrs.isEmpty())
 100             attrs = new LinkedHashMap&lt;&gt;(3);
<span class="line-modified"> 101         attrs.put(nullCheck(attrName), Entity.escapeHtmlChars(attrValue));</span>
<span class="line-added"> 102         return this;</span>
<span class="line-added"> 103     }</span>
<span class="line-added"> 104 </span>
<span class="line-added"> 105     /**</span>
<span class="line-added"> 106      * Sets the &quot;id&quot; attribute for this tag.</span>
<span class="line-added"> 107      *</span>
<span class="line-added"> 108      * @param id the value for the id attribute</span>
<span class="line-added"> 109      * @return this object</span>
<span class="line-added"> 110      */</span>
<span class="line-added"> 111     public HtmlTree setId(String id) {</span>
<span class="line-added"> 112         put(HtmlAttr.ID, id);</span>
 113         return this;
 114     }
 115 
 116     /**
 117      * Sets the &quot;title&quot; attribute for this tag.
 118      * Any HTML tags in the content will be removed.
 119      *
 120      * @param body the content for the title attribute
 121      * @return this object
 122      */
 123     public HtmlTree setTitle(Content body) {
 124         put(HtmlAttr.TITLE, stripHtml(body));
 125         return this;
 126     }
 127 
 128     /**
 129      * Sets the &quot;role&quot; attribute for this tag.
 130      *
 131      * @param role the role
 132      * @return this object
</pre>
<hr />
<pre>
 169     /**
 170      * Adds String content to the HTML tree. If the last content member
 171      * added is a StringContent, append the string to that StringContent or else
 172      * create a new StringContent and add it to the HTML tree.
 173      *
 174      * @param stringContent string content that needs to be added
 175      */
 176     @Override
 177     public void add(CharSequence stringContent) {
 178         if (!content.isEmpty()) {
 179             Content lastContent = content.get(content.size() - 1);
 180             if (lastContent instanceof StringContent)
 181                 lastContent.add(stringContent);
 182             else
 183                 add(new StringContent(stringContent));
 184         }
 185         else
 186             add(new StringContent(stringContent));
 187     }
 188 



 189     @Override
 190     public int charCount() {
 191         int n = 0;
 192         for (Content c : content)
 193             n += c.charCount();
 194         return n;
 195     }
 196 





























 197     /*
 198      * The sets of ASCII URI characters to be left unencoded.
 199      * See &quot;Uniform Resource Identifier (URI): Generic Syntax&quot;
 200      * IETF RFC 3986. https://tools.ietf.org/html/rfc3986
 201      */
 202     public static final BitSet MAIN_CHARS;
 203     public static final BitSet QUERY_FRAGMENT_CHARS;
 204 
 205     static {
 206         BitSet alphaDigit = bitSet(bitSet(&#39;A&#39;, &#39;Z&#39;), bitSet(&#39;a&#39;, &#39;z&#39;), bitSet(&#39;0&#39;, &#39;9&#39;));
 207         BitSet unreserved = bitSet(alphaDigit, bitSet(&quot;-._~&quot;));
 208         BitSet genDelims = bitSet(&quot;:/?#[]@&quot;);
 209         BitSet subDelims = bitSet(&quot;!$&amp;&#39;()*+,;=&quot;);
 210         MAIN_CHARS = bitSet(unreserved, genDelims, subDelims);
 211         BitSet pchar = bitSet(unreserved, subDelims, bitSet(&quot;:@&quot;));
 212         QUERY_FRAGMENT_CHARS = bitSet(pchar, bitSet(&quot;/?&quot;));
 213     }
 214 
 215     private static BitSet bitSet(String s) {
 216         BitSet result = new BitSet();
</pre>
<hr />
<pre>
 258             } else {
 259                 sb.append(String.format(&quot;%%%02X&quot;, c &amp; 0xFF));
 260             }
 261         }
 262         return sb.toString();
 263     }
 264 
 265     /**
 266      * Generates an HTML anchor tag.
 267      *
 268      * @param ref reference url for the anchor tag
 269      * @param body content for the anchor tag
 270      * @return an HtmlTree object
 271      */
 272     public static HtmlTree A(String ref, Content body) {
 273         HtmlTree htmltree = new HtmlTree(HtmlTag.A, nullCheck(body));
 274         htmltree.put(HtmlAttr.HREF, encodeURL(ref));
 275         return htmltree;
 276     }
 277 





























 278     /**
 279      * Generates a CAPTION tag with some content.
 280      *
 281      * @param body content for the tag
 282      * @return an HtmlTree object for the CAPTION tag
 283      */
 284     public static HtmlTree CAPTION(Content body) {
 285         HtmlTree htmltree = new HtmlTree(HtmlTag.CAPTION, nullCheck(body));
 286         return htmltree;
 287     }
 288 
 289     /**
 290      * Generates a CODE tag with some content.
 291      *
 292      * @param body content for the tag
 293      * @return an HtmlTree object for the CODE tag
 294      */
 295     public static HtmlTree CODE(Content body) {
 296         HtmlTree htmltree = new HtmlTree(HtmlTag.CODE, nullCheck(body));
 297         return htmltree;
</pre>
<hr />
<pre>
 543      * @return an HtmlTree object for the MAIN tag
 544      */
 545     public static HtmlTree MAIN() {
 546         HtmlTree htmltree = new HtmlTree(HtmlTag.MAIN);
 547         htmltree.setRole(Role.MAIN);
 548         return htmltree;
 549     }
 550 
 551     /**
 552      * Generates a MAIN tag with role attribute and some content.
 553      *
 554      * @param body content of the MAIN tag
 555      * @return an HtmlTree object for the MAIN tag
 556      */
 557     public static HtmlTree MAIN(Content body) {
 558         HtmlTree htmltree = new HtmlTree(HtmlTag.MAIN, nullCheck(body));
 559         htmltree.setRole(Role.MAIN);
 560         return htmltree;
 561     }
 562 















 563     /**
 564      * Generates a META tag with the http-equiv, content and charset attributes.
 565      *
 566      * @param httpEquiv http equiv attribute for the META tag
 567      * @param content type of content
 568      * @param charSet character set used
 569      * @return an HtmlTree object for the META tag
 570      */
 571     public static HtmlTree META(String httpEquiv, String content, String charSet) {
 572         HtmlTree htmltree = new HtmlTree(HtmlTag.META);
 573         String contentCharset = content + &quot;; charset=&quot; + charSet;
 574         htmltree.put(HtmlAttr.HTTP_EQUIV, nullCheck(httpEquiv));
 575         htmltree.put(HtmlAttr.CONTENT, contentCharset);
 576         return htmltree;
 577     }
 578 
 579     /**
 580      * Generates a META tag with the name and content attributes.
 581      *
 582      * @param name name attribute
</pre>
<hr />
<pre>
 633         HtmlTree htmltree = new HtmlTree(HtmlTag.P, nullCheck(body));
 634         if (styleClass != null)
 635             htmltree.setStyle(styleClass);
 636         return htmltree;
 637     }
 638 
 639     /**
 640      * Generates a SCRIPT tag with the type and src attributes.
 641      *
 642      * @param src the path for the script
 643      * @return an HtmlTree object for the SCRIPT tag
 644      */
 645     public static HtmlTree SCRIPT(String src) {
 646         HtmlTree htmltree = new HtmlTree(HtmlTag.SCRIPT);
 647         htmltree.put(HtmlAttr.TYPE, &quot;text/javascript&quot;);
 648         htmltree.put(HtmlAttr.SRC, nullCheck(src));
 649         return htmltree;
 650     }
 651 
 652     /**
<span class="line-modified"> 653      * Generates a SECTION tag with style class attribute.</span>
 654      *
<span class="line-added"> 655      * @param styleClass the style class for the tag</span>
 656      * @return an HtmlTree object for the SECTION tag
 657      */
<span class="line-modified"> 658     public static HtmlTree SECTION(HtmlStyle styleClass) {</span>
<span class="line-modified"> 659         HtmlTree htmlTree = new HtmlTree(HtmlTag.SECTION);</span>
<span class="line-modified"> 660         htmlTree.setStyle(styleClass);</span>
<span class="line-modified"> 661         return htmlTree;</span>
 662     }
 663 
 664     /**
<span class="line-modified"> 665      * Generates a SECTION tag with style class attribute and some content.</span>
 666      *
<span class="line-added"> 667      * @param styleClass the style class for the tag</span>
 668      * @param body content of the section tag
 669      * @return an HtmlTree object for the SECTION tag
 670      */
<span class="line-modified"> 671     public static HtmlTree SECTION(HtmlStyle styleClass, Content body) {</span>
<span class="line-modified"> 672         HtmlTree htmlTree = new HtmlTree(HtmlTag.SECTION, nullCheck(body));</span>
<span class="line-modified"> 673         if (styleClass != null) {</span>
<span class="line-modified"> 674             htmlTree.setStyle(styleClass);</span>
<span class="line-added"> 675         }</span>
<span class="line-added"> 676         return htmlTree;</span>
 677     }
 678 
 679     /**
 680      * Generates a SMALL tag with some content.
 681      *
 682      * @param body content for the tag
 683      * @return an HtmlTree object for the SMALL tag
 684      */
 685     public static HtmlTree SMALL(Content body) {
 686         HtmlTree htmltree = new HtmlTree(HtmlTag.SMALL, nullCheck(body));
 687         return htmltree;
 688     }
 689 
 690     /**
 691      * Generates a SPAN tag with some content.
 692      *
 693      * @param body content for the tag
 694      * @return an HtmlTree object for the SPAN tag
 695      */
 696     public static HtmlTree SPAN(Content body) {
 697         return SPAN(null, body);
 698     }
 699 
 700     /**
 701      * Generates a SPAN tag with style class attribute and some content.
 702      *
 703      * @param styleClass style class for the tag
 704      * @param body content for the tag
 705      * @return an HtmlTree object for the SPAN tag
 706      */
 707     public static HtmlTree SPAN(HtmlStyle styleClass, Content body) {
 708         HtmlTree htmltree = new HtmlTree(HtmlTag.SPAN, nullCheck(body));
 709         if (styleClass != null)
 710             htmltree.setStyle(styleClass);
 711         return htmltree;
 712     }
 713 
<span class="line-added"> 714     /**</span>
<span class="line-added"> 715      * Generates an SPAN tag with id attribute and a body.</span>
<span class="line-added"> 716      *</span>
<span class="line-added"> 717      * @param id id for the tag</span>
<span class="line-added"> 718      * @param body body for the tag</span>
<span class="line-added"> 719      * @return an HtmlTree object for the SPAN tag</span>
<span class="line-added"> 720      */</span>
<span class="line-added"> 721     public static HtmlTree SPAN_ID(String id, Content body) {</span>
<span class="line-added"> 722         HtmlTree htmltree = new HtmlTree(HtmlTag.SPAN, nullCheck(body));</span>
<span class="line-added"> 723         htmltree.put(HtmlAttr.ID, nullCheck(id));</span>
<span class="line-added"> 724         return htmltree;</span>
<span class="line-added"> 725     }</span>
<span class="line-added"> 726 </span>
 727     /**
 728      * Generates a SPAN tag with id and style class attributes. It also encloses
 729      * a content.
 730      *
 731      * @param id the id for the tag
 732      * @param styleClass stylesheet class for the tag
 733      * @param body content for the tag
 734      * @return an HtmlTree object for the SPAN tag
 735      */
 736     public static HtmlTree SPAN(String id, HtmlStyle styleClass, Content body) {
 737         HtmlTree htmltree = new HtmlTree(HtmlTag.SPAN, nullCheck(body));
 738         htmltree.put(HtmlAttr.ID, nullCheck(id));
 739         if (styleClass != null)
 740             htmltree.setStyle(styleClass);
 741         return htmltree;
 742     }
 743 
 744     /**
 745      * Generates a Table tag with style class and summary attributes and some content.
 746      *
</pre>
<hr />
<pre>
 857     }
 858 
 859     /**
 860      * Generates a UL tag with the style class attribute and some content.
 861      *
 862      * @param styleClass style for the tag
 863      * @param first initial content to be added
 864      * @param more a series of additional content nodes to be added
 865      * @return an HtmlTree object for the UL tag
 866      */
 867     public static HtmlTree UL(HtmlStyle styleClass, Content first, Content... more) {
 868         HtmlTree htmlTree = new HtmlTree(HtmlTag.UL);
 869         htmlTree.add(nullCheck(first));
 870         for (Content c : more) {
 871             htmlTree.add(nullCheck(c));
 872         }
 873         htmlTree.setStyle(nullCheck(styleClass));
 874         return htmlTree;
 875     }
 876 



 877     @Override
 878     public boolean isEmpty() {
 879         return (!hasContent() &amp;&amp; !hasAttrs());
 880     }
 881 
 882     /**
 883      * Returns true if the HTML tree has content.
 884      *
 885      * @return true if the HTML tree has content else return false
 886      */
 887     public boolean hasContent() {
 888         return (!content.isEmpty());
 889     }
 890 
 891     /**
 892      * Returns true if the HTML tree has attributes.
 893      *
 894      * @return true if the HTML tree has attributes else return false
 895      */
 896     public boolean hasAttrs() {
</pre>
<hr />
<pre>
 918     public boolean isValid() {
 919         switch (htmlTag) {
 920             case A :
 921                 return (hasAttr(HtmlAttr.NAME) || hasAttr(HtmlAttr.ID) || (hasAttr(HtmlAttr.HREF) &amp;&amp; hasContent()));
 922             case BR :
 923                 return (!hasContent() &amp;&amp; (!hasAttrs() || hasAttr(HtmlAttr.CLEAR)));
 924             case IFRAME :
 925                 return (hasAttr(HtmlAttr.SRC) &amp;&amp; !hasContent());
 926             case HR :
 927             case INPUT:
 928                 return (!hasContent());
 929             case IMG :
 930                 return (hasAttr(HtmlAttr.SRC) &amp;&amp; hasAttr(HtmlAttr.ALT) &amp;&amp; !hasContent());
 931             case LINK :
 932                 return (hasAttr(HtmlAttr.HREF) &amp;&amp; !hasContent());
 933             case META :
 934                 return (hasAttr(HtmlAttr.CONTENT) &amp;&amp; !hasContent());
 935             case SCRIPT :
 936                 return ((hasAttr(HtmlAttr.TYPE) &amp;&amp; hasAttr(HtmlAttr.SRC) &amp;&amp; !hasContent()) ||
 937                         (hasAttr(HtmlAttr.TYPE) &amp;&amp; hasContent()));
<span class="line-added"> 938             case SPAN :</span>
<span class="line-added"> 939                 return (hasAttr(HtmlAttr.ID) || hasContent());</span>
 940             default :
 941                 return hasContent();
 942         }
 943     }
 944 
 945     /**
 946      * Returns true if the element is an inline element.
 947      *
 948      * @return true if the HTML tag is an inline element
 949      */
 950     public boolean isInline() {
 951         return (htmlTag.blockType == HtmlTag.BlockType.INLINE);
 952     }
 953 



 954     @Override
 955     public boolean write(Writer out, boolean atNewline) throws IOException {
 956         if (!isInline() &amp;&amp; !atNewline)
 957             out.write(DocletConstants.NL);
 958         String tagString = htmlTag.toString();
 959         out.write(&quot;&lt;&quot;);
 960         out.write(tagString);
 961         Iterator&lt;HtmlAttr&gt; iterator = attrs.keySet().iterator();
 962         HtmlAttr key;
 963         String value;
 964         while (iterator.hasNext()) {
 965             key = iterator.next();
 966             value = attrs.get(key);
 967             out.write(&quot; &quot;);
 968             out.write(key.toString());
 969             if (!value.isEmpty()) {
 970                 out.write(&quot;=\&quot;&quot;);
 971                 out.write(value);
 972                 out.write(&quot;\&quot;&quot;);
 973             }
</pre>
</td>
</tr>
</table>
<center><a href="HtmlTag.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="Links.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>