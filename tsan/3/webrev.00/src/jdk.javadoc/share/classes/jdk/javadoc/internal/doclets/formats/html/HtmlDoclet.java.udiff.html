<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/HtmlDoclet.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HtmlConfiguration.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="HtmlDocletWriter.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/HtmlDoclet.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -50,42 +50,57 @@</span>
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
<span class="udiff-line-removed">-  *</span>
<span class="udiff-line-removed">-  * @author Atul M Dambalkar</span>
<span class="udiff-line-removed">-  * @author Robert Field</span>
<span class="udiff-line-removed">-  * @author Jamie Ho</span>
<span class="udiff-line-removed">-  *</span>
   */
  public class HtmlDoclet extends AbstractDoclet {
  
<span class="udiff-line-modified-removed">-     public HtmlDoclet(Doclet parent) {</span>
<span class="udiff-line-modified-removed">-         configuration = new HtmlConfiguration(parent);</span>
<span class="udiff-line-modified-added">+     /**</span>
<span class="udiff-line-modified-added">+      * Creates a doclet to generate HTML documentation,</span>
<span class="udiff-line-added">+      * specifying the &quot;initiating doclet&quot; to be used when</span>
<span class="udiff-line-added">+      * initializing any taglets for this doclet.</span>
<span class="udiff-line-added">+      * An initiating doclet is one that delegates to</span>
<span class="udiff-line-added">+      * this doclet.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param initiatingDoclet the initiating doclet</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     public HtmlDoclet(Doclet initiatingDoclet) {</span>
<span class="udiff-line-added">+         this.initiatingDoclet = initiatingDoclet;</span>
      }
  
      @Override // defined by Doclet
      public String getName() {
          return &quot;Html&quot;;
      }
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * The initiating doclet, to be specified when creating</span>
<span class="udiff-line-added">+      * the configuration.</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     private final Doclet initiatingDoclet;</span>
<span class="udiff-line-added">+ </span>
      /**
       * The global configuration information for this run.
<span class="udiff-line-added">+      * Initialized in {@link #init(Locale, Reporter)}.</span>
       */
<span class="udiff-line-modified-removed">-     private final HtmlConfiguration configuration;</span>
<span class="udiff-line-modified-added">+     private HtmlConfiguration configuration;</span>
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Object for generating messages and diagnostics.</span>
<span class="udiff-line-added">+      */</span>
      private Messages messages;
  
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+     /**</span>
<span class="udiff-line-added">+      * Base path for resources for this doclet.</span>
<span class="udiff-line-added">+      */</span>
      private static final DocPath DOCLET_RESOURCES = DocPath
              .create(&quot;/jdk/javadoc/internal/doclets/formats/html/resources&quot;);
  
      @Override // defined by Doclet
      public void init(Locale locale, Reporter reporter) {
<span class="udiff-line-modified-removed">-         configuration.reporter = reporter;</span>
<span class="udiff-line-removed">-         configuration.locale = locale;</span>
<span class="udiff-line-modified-added">+         configuration = new HtmlConfiguration(initiatingDoclet, locale, reporter);</span>
          messages = configuration.getMessages();
      }
  
      /**
       * Create the configuration instance.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -111,91 +126,84 @@</span>
       */
      @Override // defined by AbstractDoclet
      protected void generateOtherFiles(DocletEnvironment docEnv, ClassTree classtree)
              throws DocletException {
          super.generateOtherFiles(docEnv, classtree);
<span class="udiff-line-modified-removed">-         if (configuration.linksource) {</span>
<span class="udiff-line-modified-added">+         HtmlOptions options = configuration.getOptions();</span>
<span class="udiff-line-added">+         if (options.linkSource()) {</span>
              SourceToHTMLConverter.convertRoot(configuration,
                  docEnv, DocPaths.SOURCE_OUTPUT);
          }
          // Modules with no documented classes may be specified on the
          // command line to specify a service provider, allow these.
          if (configuration.getSpecifiedModuleElements().isEmpty() &amp;&amp;
                  configuration.topFile.isEmpty()) {
              messages.error(&quot;doclet.No_Non_Deprecated_Classes_To_Document&quot;);
              return;
          }
<span class="udiff-line-modified-removed">-         boolean nodeprecated = configuration.nodeprecated;</span>
<span class="udiff-line-modified-removed">-         performCopy(configuration.helpfile);</span>
<span class="udiff-line-modified-removed">-         performCopy(configuration.stylesheetfile);</span>
<span class="udiff-line-modified-removed">-         for (String stylesheet : configuration.additionalStylesheets) {</span>
<span class="udiff-line-modified-added">+         boolean nodeprecated = options.noDeprecated();</span>
<span class="udiff-line-modified-added">+         performCopy(options.helpFile());</span>
<span class="udiff-line-modified-added">+         performCopy(options.stylesheetFile());</span>
<span class="udiff-line-modified-added">+         for (String stylesheet : options.additionalStylesheets()) {</span>
              performCopy(stylesheet);
          }
          // do early to reduce memory footprint
<span class="udiff-line-modified-removed">-         if (configuration.classuse) {</span>
<span class="udiff-line-modified-added">+         if (options.classUse()) {</span>
              ClassUseWriter.generate(configuration, classtree);
          }
<span class="udiff-line-removed">-         IndexBuilder indexbuilder = new IndexBuilder(configuration, nodeprecated);</span>
  
<span class="udiff-line-modified-removed">-         if (configuration.createtree) {</span>
<span class="udiff-line-modified-added">+         if (options.createTree()) {</span>
              TreeWriter.generate(configuration, classtree);
          }
  
<span class="udiff-line-modified-removed">-         if (!(configuration.nodeprecatedlist || nodeprecated)) {</span>
<span class="udiff-line-modified-added">+         if (!(options.noDeprecatedList() || nodeprecated)) {</span>
              DeprecatedListWriter.generate(configuration);
          }
  
<span class="udiff-line-modified-removed">-         AllClassesFrameWriter.generate(configuration,</span>
<span class="udiff-line-removed">-             new IndexBuilder(configuration, nodeprecated, true));</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (configuration.frames) {</span>
<span class="udiff-line-removed">-             FrameOutputWriter.generate(configuration);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (configuration.createoverview) {</span>
<span class="udiff-line-modified-added">+         if (options.createOverview()) {</span>
              if (configuration.showModules) {
                  ModuleIndexWriter.generate(configuration);
              } else {
                  PackageIndexWriter.generate(configuration);
              }
          }
  
<span class="udiff-line-modified-removed">-         if (configuration.createindex) {</span>
<span class="udiff-line-modified-added">+         if (options.createIndex()) {</span>
<span class="udiff-line-added">+             IndexBuilder indexBuilder = new IndexBuilder(configuration, nodeprecated);</span>
              configuration.buildSearchTagIndex();
<span class="udiff-line-modified-removed">-             if (configuration.splitindex) {</span>
<span class="udiff-line-modified-removed">-                 SplitIndexWriter.generate(configuration, indexbuilder);</span>
<span class="udiff-line-modified-added">+             if (options.splitIndex()) {</span>
<span class="udiff-line-modified-added">+                 SplitIndexWriter.generate(configuration, indexBuilder);</span>
              } else {
<span class="udiff-line-modified-removed">-                 SingleIndexWriter.generate(configuration, indexbuilder);</span>
<span class="udiff-line-modified-added">+                 SingleIndexWriter.generate(configuration, indexBuilder);</span>
              }
              AllClassesIndexWriter.generate(configuration,
                      new IndexBuilder(configuration, nodeprecated, true));
              if (!configuration.packages.isEmpty()) {
                  AllPackagesIndexWriter.generate(configuration);
              }
<span class="udiff-line-added">+             SystemPropertiesWriter.generate(configuration);</span>
          }
  
<span class="udiff-line-modified-removed">-         if (!configuration.frames) {</span>
<span class="udiff-line-modified-removed">-             if (configuration.createoverview) {</span>
<span class="udiff-line-modified-removed">-                 IndexRedirectWriter.generate(configuration, DocPaths.OVERVIEW_SUMMARY, DocPaths.INDEX);</span>
<span class="udiff-line-modified-removed">-             } else {</span>
<span class="udiff-line-removed">-                 IndexRedirectWriter.generate(configuration);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-modified-added">+         if (options.createOverview()) {</span>
<span class="udiff-line-modified-added">+             IndexRedirectWriter.generate(configuration, DocPaths.OVERVIEW_SUMMARY, DocPaths.INDEX);</span>
<span class="udiff-line-modified-added">+         } else {</span>
<span class="udiff-line-modified-added">+             IndexRedirectWriter.generate(configuration);</span>
          }
  
<span class="udiff-line-modified-removed">-         if (configuration.helpfile.isEmpty() &amp;&amp; !configuration.nohelp) {</span>
<span class="udiff-line-modified-added">+         if (options.helpFile().isEmpty() &amp;&amp; !options.noHelp()) {</span>
              HelpWriter.generate(configuration);
          }
          // If a stylesheet file is not specified, copy the default stylesheet
          // and replace newline with platform-specific newline.
          DocFile f;
<span class="udiff-line-modified-removed">-         if (configuration.stylesheetfile.length() == 0) {</span>
<span class="udiff-line-modified-added">+         if (options.stylesheetFile().length() == 0) {</span>
              f = DocFile.createFileForOutput(configuration, DocPaths.STYLESHEET);
              f.copyResource(DocPaths.RESOURCES.resolve(DocPaths.STYLESHEET), true, true);
          }
          f = DocFile.createFileForOutput(configuration, DocPaths.JAVASCRIPT);
          f.copyResource(DocPaths.RESOURCES.resolve(DocPaths.JAVASCRIPT), true, true);
<span class="udiff-line-modified-removed">-         if (configuration.createindex) {</span>
<span class="udiff-line-modified-added">+         if (options.createIndex()) {</span>
              f = DocFile.createFileForOutput(configuration, DocPaths.SEARCH_JS);
              f.copyResource(DOCLET_RESOURCES.resolve(DocPaths.SEARCH_JS), true, true);
  
              f = DocFile.createFileForOutput(configuration, DocPaths.RESOURCES.resolve(DocPaths.GLASS_IMG));
              f.copyResource(DOCLET_RESOURCES.resolve(DocPaths.GLASS_IMG), true, false);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -206,25 +214,17 @@</span>
          }
      }
  
      private void copyJqueryFiles() throws DocletException {
          List&lt;String&gt; files = Arrays.asList(
<span class="udiff-line-modified-removed">-                 &quot;jquery-3.3.1.js&quot;,</span>
<span class="udiff-line-removed">-                 &quot;jquery-migrate-3.0.1.js&quot;,</span>
<span class="udiff-line-modified-added">+                 &quot;jquery-3.4.1.js&quot;,</span>
                  &quot;jquery-ui.js&quot;,
                  &quot;jquery-ui.css&quot;,
                  &quot;jquery-ui.min.js&quot;,
                  &quot;jquery-ui.min.css&quot;,
                  &quot;jquery-ui.structure.min.css&quot;,
                  &quot;jquery-ui.structure.css&quot;,
<span class="udiff-line-removed">-                 &quot;external/jquery/jquery.js&quot;,</span>
<span class="udiff-line-removed">-                 &quot;jszip/dist/jszip.js&quot;,</span>
<span class="udiff-line-removed">-                 &quot;jszip/dist/jszip.min.js&quot;,</span>
<span class="udiff-line-removed">-                 &quot;jszip-utils/dist/jszip-utils.js&quot;,</span>
<span class="udiff-line-removed">-                 &quot;jszip-utils/dist/jszip-utils.min.js&quot;,</span>
<span class="udiff-line-removed">-                 &quot;jszip-utils/dist/jszip-utils-ie.js&quot;,</span>
<span class="udiff-line-removed">-                 &quot;jszip-utils/dist/jszip-utils-ie.min.js&quot;,</span>
                  &quot;images/ui-bg_glass_65_dadada_1x400.png&quot;,
                  &quot;images/ui-icons_454545_256x240.png&quot;,
                  &quot;images/ui-bg_glass_95_fef1ec_1x400.png&quot;,
                  &quot;images/ui-bg_glass_75_dadada_1x400.png&quot;,
                  &quot;images/ui-bg_highlight-soft_75_cccccc_1x100.png&quot;,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -240,88 +240,66 @@</span>
              f = DocFile.createFileForOutput(configuration, filePath);
              f.copyResource(DOCLET_RESOURCES.resolve(filePath), true, false);
          }
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      */</span>
      @Override // defined by AbstractDoclet
<span class="udiff-line-modified-removed">-     protected void generateClassFiles(SortedSet&lt;TypeElement&gt; arr, ClassTree classtree)</span>
<span class="udiff-line-modified-added">+     protected void generateClassFiles(SortedSet&lt;TypeElement&gt; typeElems, ClassTree classTree)</span>
              throws DocletException {
<span class="udiff-line-modified-removed">-         List&lt;TypeElement&gt; list = new ArrayList&lt;&gt;(arr);</span>
<span class="udiff-line-modified-removed">-         for (TypeElement klass : list) {</span>
<span class="udiff-line-modified-removed">-             if (utils.hasHiddenTag(klass) ||</span>
<span class="udiff-line-removed">-                     !(configuration.isGeneratedDoc(klass) &amp;&amp; utils.isIncluded(klass))) {</span>
<span class="udiff-line-modified-added">+         for (TypeElement te : typeElems) {</span>
<span class="udiff-line-modified-added">+             if (utils.hasHiddenTag(te) ||</span>
<span class="udiff-line-modified-added">+                     !(configuration.isGeneratedDoc(te) &amp;&amp; utils.isIncluded(te))) {</span>
                  continue;
              }
<span class="udiff-line-modified-removed">-             if (utils.isAnnotationType(klass)) {</span>
<span class="udiff-line-modified-added">+             if (utils.isAnnotationType(te)) {</span>
                  AbstractBuilder annotationTypeBuilder =
                      configuration.getBuilderFactory()
<span class="udiff-line-modified-removed">-                         .getAnnotationTypeBuilder(klass);</span>
<span class="udiff-line-modified-added">+                         .getAnnotationTypeBuilder(te);</span>
                  annotationTypeBuilder.build();
              } else {
                  AbstractBuilder classBuilder =
<span class="udiff-line-modified-removed">-                     configuration.getBuilderFactory().getClassBuilder(klass, classtree);</span>
<span class="udiff-line-modified-added">+                     configuration.getBuilderFactory().getClassBuilder(te, classTree);</span>
                  classBuilder.build();
              }
          }
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      */</span>
      @Override // defined by AbstractDoclet
      protected void generateModuleFiles() throws DocletException {
          if (configuration.showModules) {
<span class="udiff-line-removed">-             if (configuration.frames  &amp;&amp; configuration.modules.size() &gt; 1) {</span>
<span class="udiff-line-removed">-                 ModuleIndexFrameWriter.generate(configuration);</span>
<span class="udiff-line-removed">-             }</span>
              List&lt;ModuleElement&gt; mdles = new ArrayList&lt;&gt;(configuration.modulePackages.keySet());
              for (ModuleElement mdle : mdles) {
<span class="udiff-line-removed">-                 if (configuration.frames &amp;&amp; configuration.modules.size() &gt; 1) {</span>
<span class="udiff-line-removed">-                     ModulePackageIndexFrameWriter.generate(configuration, mdle);</span>
<span class="udiff-line-removed">-                     ModuleFrameWriter.generate(configuration, mdle);</span>
<span class="udiff-line-removed">-                 }</span>
                  AbstractBuilder moduleSummaryBuilder =
                          configuration.getBuilderFactory().getModuleSummaryBuilder(mdle);
                  moduleSummaryBuilder.build();
              }
          }
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      */</span>
      @Override // defined by AbstractDoclet
      protected void generatePackageFiles(ClassTree classtree) throws DocletException {
<span class="udiff-line-added">+         HtmlOptions options = configuration.getOptions();</span>
          Set&lt;PackageElement&gt; packages = configuration.packages;
<span class="udiff-line-removed">-         if (packages.size() &gt; 1 &amp;&amp; configuration.frames) {</span>
<span class="udiff-line-removed">-             PackageIndexFrameWriter.generate(configuration);</span>
<span class="udiff-line-removed">-         }</span>
          List&lt;PackageElement&gt; pList = new ArrayList&lt;&gt;(packages);
          for (PackageElement pkg : pList) {
              // if -nodeprecated option is set and the package is marked as
              // deprecated, do not generate the package-summary.html, package-frame.html
              // and package-tree.html pages for that package.
<span class="udiff-line-modified-removed">-             if (!(configuration.nodeprecated &amp;&amp; utils.isDeprecated(pkg))) {</span>
<span class="udiff-line-removed">-                 if (configuration.frames) {</span>
<span class="udiff-line-removed">-                     PackageFrameWriter.generate(configuration, pkg);</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-modified-added">+             if (!(options.noDeprecated() &amp;&amp; utils.isDeprecated(pkg))) {</span>
                  AbstractBuilder packageSummaryBuilder =
                          configuration.getBuilderFactory().getPackageSummaryBuilder(pkg);
                  packageSummaryBuilder.build();
<span class="udiff-line-modified-removed">-                 if (configuration.createtree) {</span>
<span class="udiff-line-modified-removed">-                     PackageTreeWriter.generate(configuration, pkg, configuration.nodeprecated);</span>
<span class="udiff-line-modified-added">+                 if (options.createTree()) {</span>
<span class="udiff-line-modified-added">+                     PackageTreeWriter.generate(configuration, pkg, options.noDeprecated());</span>
                  }
              }
          }
      }
  
      @Override // defined by Doclet
<span class="udiff-line-modified-removed">-     public Set&lt;Option&gt; getSupportedOptions() {</span>
<span class="udiff-line-modified-removed">-         return configuration.getSupportedOptions();</span>
<span class="udiff-line-modified-added">+     public Set&lt;? extends Option&gt; getSupportedOptions() {</span>
<span class="udiff-line-modified-added">+         return configuration.getOptions().getSupportedOptions();</span>
      }
  
      private void performCopy(String filename) throws DocFileIOException {
          if (filename.isEmpty())
              return;
</pre>
<center><a href="HtmlConfiguration.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="HtmlDocletWriter.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>