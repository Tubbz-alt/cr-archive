<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/resources/search.js</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 var noResult = {l: &quot;No results found&quot;};
 27 var catModules = &quot;Modules&quot;;
 28 var catPackages = &quot;Packages&quot;;
 29 var catTypes = &quot;Types&quot;;
 30 var catMembers = &quot;Members&quot;;
 31 var catSearchTags = &quot;SearchTags&quot;;
 32 var highlight = &quot;&lt;span class=\&quot;resultHighlight\&quot;&gt;$&amp;&lt;/span&gt;&quot;;
 33 var camelCaseRegexp = &quot;&quot;;
 34 var secondaryMatcher = &quot;&quot;;
 35 function escapeHtml(str) {
 36     return str.replace(/&lt;/g, &quot;&amp;lt;&quot;).replace(/&gt;/g, &quot;&amp;gt;&quot;);
 37 }
 38 function getHighlightedText(item) {
 39     var ccMatcher = new RegExp(escapeHtml(camelCaseRegexp));
 40     var escapedItem = escapeHtml(item);
 41     var label = escapedItem.replace(ccMatcher, highlight);
 42     if (label === escapedItem) {
 43         var secMatcher = new RegExp(escapeHtml(secondaryMatcher.source), &quot;i&quot;);
 44         label = escapedItem.replace(secMatcher, highlight);
 45     }
 46     return label;
 47 }
 48 function getURLPrefix(ui) {
 49     var urlPrefix=&quot;&quot;;
 50     if (useModuleDirectories) {
 51         var slash = &quot;/&quot;;
 52         if (ui.item.category === catModules) {
 53             return ui.item.l + slash;
 54         } else if (ui.item.category === catPackages &amp;&amp; ui.item.m) {
 55             return ui.item.m + slash;
 56         } else if ((ui.item.category === catTypes &amp;&amp; ui.item.p) || ui.item.category === catMembers) {
 57             $.each(packageSearchIndex, function(index, item) {
 58                 if (item.m &amp;&amp; ui.item.p == item.l) {
 59                     urlPrefix = item.m + slash;
 60                 }
 61             });
 62             return urlPrefix;
 63         } else {
 64             return urlPrefix;
 65         }
 66     }
 67     return urlPrefix;
 68 }
 69 var watermark = &#39;Search&#39;;
 70 $(function() {
 71     $(&quot;#search&quot;).val(&#39;&#39;);
 72     $(&quot;#search&quot;).prop(&quot;disabled&quot;, false);
 73     $(&quot;#reset&quot;).prop(&quot;disabled&quot;, false);
 74     $(&quot;#search&quot;).val(watermark).addClass(&#39;watermark&#39;);
 75     $(&quot;#search&quot;).blur(function() {
 76         if ($(this).val().length == 0) {
 77             $(this).val(watermark).addClass(&#39;watermark&#39;);
 78         }
 79     });
 80     $(&quot;#search&quot;).on(&#39;click keydown&#39;, function() {
 81         if ($(this).val() == watermark) {
 82             $(this).val(&#39;&#39;).removeClass(&#39;watermark&#39;);
 83         }
 84     });
 85     $(&quot;#reset&quot;).click(function() {
 86         $(&quot;#search&quot;).val(&#39;&#39;);
 87         $(&quot;#search&quot;).focus();
 88     });
 89     $(&quot;#search&quot;).focus();
 90     $(&quot;#search&quot;)[0].setSelectionRange(0, 0);
 91 });
 92 $.widget(&quot;custom.catcomplete&quot;, $.ui.autocomplete, {
 93     _create: function() {
 94         this._super();
 95         this.widget().menu(&quot;option&quot;, &quot;items&quot;, &quot;&gt; :not(.ui-autocomplete-category)&quot;);
 96     },
 97     _renderMenu: function(ul, items) {
 98         var rMenu = this,
 99                 currentCategory = &quot;&quot;;
100         rMenu.menu.bindings = $();
101         $.each(items, function(index, item) {
102             var li;
103             if (item.l !== noResult.l &amp;&amp; item.category !== currentCategory) {
104                 ul.append(&quot;&lt;li class=\&quot;ui-autocomplete-category\&quot;&gt;&quot; + item.category + &quot;&lt;/li&gt;&quot;);
105                 currentCategory = item.category;
106             }
107             li = rMenu._renderItemData(ul, item);
108             if (item.category) {
109                 li.attr(&quot;aria-label&quot;, item.category + &quot; : &quot; + item.l);
110                 li.attr(&quot;class&quot;, &quot;resultItem&quot;);
111             } else {
112                 li.attr(&quot;aria-label&quot;, item.l);
113                 li.attr(&quot;class&quot;, &quot;resultItem&quot;);
114             }
115         });
116     },
117     _renderItem: function(ul, item) {
118         var label = &quot;&quot;;
119         if (item.category === catModules) {
120             label = getHighlightedText(item.l);
121         } else if (item.category === catPackages) {
122             label = (item.m)
123                     ? getHighlightedText(item.m + &quot;/&quot; + item.l)
124                     : getHighlightedText(item.l);
125         } else if (item.category === catTypes) {
126             label = (item.p)
127                     ? getHighlightedText(item.p + &quot;.&quot; + item.l)
128                     : getHighlightedText(item.l);
129         } else if (item.category === catMembers) {
130             label = getHighlightedText(item.p + &quot;.&quot; + (item.c + &quot;.&quot; + item.l));
131         } else if (item.category === catSearchTags) {
132             label = getHighlightedText(item.l);
133         } else {
134             label = item.l;
135         }
136         var li = $(&quot;&lt;li/&gt;&quot;).appendTo(ul);
137         var div = $(&quot;&lt;div/&gt;&quot;).appendTo(li);
138         if (item.category === catSearchTags) {
139             if (item.d) {
140                 div.html(label + &quot;&lt;span class=\&quot;searchTagHolderResult\&quot;&gt; (&quot; + item.h + &quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=\&quot;searchTagDescResult\&quot;&gt;&quot;
141                                 + item.d + &quot;&lt;/span&gt;&lt;br&gt;&quot;);
142             } else {
143                 div.html(label + &quot;&lt;span class=\&quot;searchTagHolderResult\&quot;&gt; (&quot; + item.h + &quot;)&lt;/span&gt;&quot;);
144             }
145         } else {
146             div.html(label);
147         }
148         return li;
149     }
150 });
151 $(function() {
152     $(&quot;#search&quot;).catcomplete({
153         minLength: 1,
154         delay: 300,
155         source: function(request, response) {
156             var result = new Array();
157             var presult = new Array();
158             var tresult = new Array();
159             var mresult = new Array();
160             var tgresult = new Array();
161             var secondaryresult = new Array();
162             var displayCount = 0;
163             var exactMatcher = new RegExp(&quot;^&quot; + $.ui.autocomplete.escapeRegex(request.term) + &quot;$&quot;, &quot;i&quot;);
164             camelCaseRegexp = ($.ui.autocomplete.escapeRegex(request.term)).split(/(?=[A-Z])/).join(&quot;([a-z0-9_$]*?)&quot;);
165             var camelCaseMatcher = new RegExp(&quot;^&quot; + camelCaseRegexp);
166             secondaryMatcher = new RegExp($.ui.autocomplete.escapeRegex(request.term), &quot;i&quot;);
167 
168             // Return the nested innermost name from the specified object
169             function nestedName(e) {
170                 return e.l.substring(e.l.lastIndexOf(&quot;.&quot;) + 1);
171             }
172 
173             function concatResults(a1, a2) {
174                 a1 = a1.concat(a2);
175                 a2.length = 0;
176                 return a1;
177             }
178 
179             if (moduleSearchIndex) {
180                 var mdleCount = 0;
181                 $.each(moduleSearchIndex, function(index, item) {
182                     item.category = catModules;
183                     if (exactMatcher.test(item.l)) {
184                         result.push(item);
185                         mdleCount++;
186                     } else if (camelCaseMatcher.test(item.l)) {
187                         result.push(item);
188                     } else if (secondaryMatcher.test(item.l)) {
189                         secondaryresult.push(item);
190                     }
191                 });
192                 displayCount = mdleCount;
193                 result = concatResults(result, secondaryresult);
194             }
195             if (packageSearchIndex) {
196                 var pCount = 0;
197                 var pkg = &quot;&quot;;
198                 $.each(packageSearchIndex, function(index, item) {
199                     item.category = catPackages;
200                     pkg = (item.m)
201                             ? (item.m + &quot;/&quot; + item.l)
202                             : item.l;
203                     if (exactMatcher.test(item.l)) {
204                         presult.push(item);
205                         pCount++;
206                     } else if (camelCaseMatcher.test(pkg)) {
207                         presult.push(item);
208                     } else if (secondaryMatcher.test(pkg)) {
209                         secondaryresult.push(item);
210                     }
211                 });
212                 result = result.concat(concatResults(presult, secondaryresult));
213                 displayCount = (pCount &gt; displayCount) ? pCount : displayCount;
214             }
215             if (typeSearchIndex) {
216                 var tCount = 0;
217                 $.each(typeSearchIndex, function(index, item) {
218                     item.category = catTypes;
219                     var s = nestedName(item);
220                     if (exactMatcher.test(s)) {
221                         tresult.push(item);
222                         tCount++;
223                     } else if (camelCaseMatcher.test(s)) {
224                         tresult.push(item);
225                     } else if (secondaryMatcher.test(item.p + &quot;.&quot; + item.l)) {
226                         secondaryresult.push(item);
227                     }
228                 });
229                 result = result.concat(concatResults(tresult, secondaryresult));
230                 displayCount = (tCount &gt; displayCount) ? tCount : displayCount;
231             }
232             if (memberSearchIndex) {
233                 var mCount = 0;
234                 $.each(memberSearchIndex, function(index, item) {
235                     item.category = catMembers;
236                     var s = nestedName(item);
237                     if (exactMatcher.test(s)) {
238                         mresult.push(item);
239                         mCount++;
240                     } else if (camelCaseMatcher.test(s)) {
241                         mresult.push(item);
242                     } else if (secondaryMatcher.test(item.c + &quot;.&quot; + item.l)) {
243                         secondaryresult.push(item);
244                     }
245                 });
246                 result = result.concat(concatResults(mresult, secondaryresult));
247                 displayCount = (mCount &gt; displayCount) ? mCount : displayCount;
248             }
249             if (tagSearchIndex) {
250                 var tgCount = 0;
251                 $.each(tagSearchIndex, function(index, item) {
252                     item.category = catSearchTags;
253                     if (exactMatcher.test(item.l)) {
254                         tgresult.push(item);
255                         tgCount++;
256                     } else if (secondaryMatcher.test(item.l)) {
257                         secondaryresult.push(item);
258                     }
259                 });
260                 result = result.concat(concatResults(tgresult, secondaryresult));
261                 displayCount = (tgCount &gt; displayCount) ? tgCount : displayCount;
262             }
263             displayCount = (displayCount &gt; 500) ? displayCount : 500;
264             var counter = function() {
265                 var count = {Modules: 0, Packages: 0, Types: 0, Members: 0, SearchTags: 0};
266                 var f = function(item) {
267                     count[item.category] += 1;
268                     return (count[item.category] &lt;= displayCount);
269                 };
270                 return f;
271             }();
272             response(result.filter(counter));
273         },
274         response: function(event, ui) {
275             if (!ui.content.length) {
276                 ui.content.push(noResult);
277             } else {
278                 $(&quot;#search&quot;).empty();
279             }
280         },
281         autoFocus: true,
282         position: {
283             collision: &quot;flip&quot;
284         },
285         select: function(event, ui) {
286             if (ui.item.l !== noResult.l) {
287                 var url = getURLPrefix(ui);
288                 if (ui.item.category === catModules) {
289                     if (useModuleDirectories) {
290                         url += &quot;module-summary.html&quot;;
291                     } else {
292                         url = ui.item.l + &quot;-summary.html&quot;;
293                     }
294                 } else if (ui.item.category === catPackages) {
295                     if (ui.item.url) {
296                         url = ui.item.url;
297                     } else {
298                     url += ui.item.l.replace(/\./g, &#39;/&#39;) + &quot;/package-summary.html&quot;;
299                     }
300                 } else if (ui.item.category === catTypes) {
301                     if (ui.item.url) {
302                         url = ui.item.url;
303                     } else if (ui.item.p === &quot;&lt;Unnamed&gt;&quot;) {
304                         url += ui.item.l + &quot;.html&quot;;
305                     } else {
306                         url += ui.item.p.replace(/\./g, &#39;/&#39;) + &quot;/&quot; + ui.item.l + &quot;.html&quot;;
307                     }
308                 } else if (ui.item.category === catMembers) {
309                     if (ui.item.p === &quot;&lt;Unnamed&gt;&quot;) {
310                         url += ui.item.c + &quot;.html&quot; + &quot;#&quot;;
311                     } else {
312                         url += ui.item.p.replace(/\./g, &#39;/&#39;) + &quot;/&quot; + ui.item.c + &quot;.html&quot; + &quot;#&quot;;
313                     }
314                     if (ui.item.url) {
315                         url += ui.item.url;
316                     } else {
317                         url += ui.item.l;
318                     }
319                 } else if (ui.item.category === catSearchTags) {
320                     url += ui.item.u;
321                 }
322                 if (top !== window) {
323                     parent.classFrame.location = pathtoroot + url;
324                 } else {
325                     window.location.href = pathtoroot + url;
326                 }
327                 $(&quot;#search&quot;).focus();
328             }
329         }
330     });
331 });
    </pre>
  </body>
</html>