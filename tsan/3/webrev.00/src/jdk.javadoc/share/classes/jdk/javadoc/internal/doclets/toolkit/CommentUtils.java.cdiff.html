<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/CommentUtils.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ClassWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ConstantsSummaryWriter.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/CommentUtils.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 36,24 ***</span>
<span class="line-new-header">--- 36,30 ---</span>
  
  import java.net.URI;
  import java.util.ArrayList;
  import java.util.HashMap;
  import java.util.List;
<span class="line-added">+ import java.util.regex.Matcher;</span>
<span class="line-added">+ import java.util.regex.Pattern;</span>
  
  import javax.lang.model.element.Element;
  import javax.lang.model.element.ExecutableElement;
  import javax.lang.model.element.Name;
  import javax.lang.model.element.PackageElement;
<span class="line-added">+ import javax.lang.model.element.RecordComponentElement;</span>
<span class="line-added">+ import javax.lang.model.element.TypeElement;</span>
  import javax.lang.model.element.VariableElement;
  import javax.lang.model.util.Elements;
  import javax.tools.FileObject;
  import javax.tools.JavaFileObject;
  import javax.tools.SimpleJavaFileObject;
  
<span class="line-added">+ import com.sun.source.doctree.AttributeTree;</span>
  import com.sun.source.doctree.DocCommentTree;
  import com.sun.source.doctree.DocTree;
  import com.sun.source.doctree.IdentifierTree;
<span class="line-added">+ import com.sun.source.doctree.ParamTree;</span>
  import com.sun.source.doctree.ReferenceTree;
  import com.sun.source.doctree.TextTree;
  import com.sun.source.util.DocTreeFactory;
  import com.sun.source.util.DocTreePath;
  import com.sun.source.util.DocTrees;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 63,19 ***</span>
  import jdk.javadoc.internal.doclets.toolkit.util.Utils;
  
  public class CommentUtils {
  
      final BaseConfiguration configuration;
      final Resources resources;
      final DocTreeFactory treeFactory;
      final HashMap&lt;Element, DocCommentDuo&gt; dcTreesMap = new HashMap&lt;&gt;();
      final DocTrees trees;
      final Elements elementUtils;
  
      protected CommentUtils(BaseConfiguration configuration) {
          this.configuration = configuration;
<span class="line-modified">!         resources = configuration.getResources();</span>
          trees = configuration.docEnv.getDocTrees();
          treeFactory = trees.getDocTreeFactory();
          elementUtils = configuration.docEnv.getElementUtils();
      }
  
<span class="line-new-header">--- 69,21 ---</span>
  import jdk.javadoc.internal.doclets.toolkit.util.Utils;
  
  public class CommentUtils {
  
      final BaseConfiguration configuration;
<span class="line-added">+     final Utils utils;</span>
      final Resources resources;
      final DocTreeFactory treeFactory;
      final HashMap&lt;Element, DocCommentDuo&gt; dcTreesMap = new HashMap&lt;&gt;();
      final DocTrees trees;
      final Elements elementUtils;
  
      protected CommentUtils(BaseConfiguration configuration) {
          this.configuration = configuration;
<span class="line-modified">!         utils = configuration.utils;</span>
<span class="line-added">+         resources = configuration.getDocResources();</span>
          trees = configuration.docEnv.getDocTrees();
          treeFactory = trees.getDocTreeFactory();
          elementUtils = configuration.docEnv.getElementUtils();
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 105,41 ***</span>
          List&lt;DocTree&gt; list = new ArrayList&lt;&gt;();
          list.add(treeFactory.newReferenceTree(sig));
          return treeFactory.newSeeTree(list);
      }
  
<span class="line-modified">!     public DocTree makeTextTree(String content) {</span>
<span class="line-modified">!         TextTree text = treeFactory.newTextTree(content);</span>
<span class="line-removed">-         return (DocTree) text;</span>
      }
  
<span class="line-modified">!     public void setEnumValuesTree(Element e) {</span>
<span class="line-modified">!         Utils utils = configuration.utils;</span>
<span class="line-modified">!         String klassName = utils.getSimpleName(utils.getEnclosingTypeElement(e));</span>
  
          List&lt;DocTree&gt; fullBody = new ArrayList&lt;&gt;();
<span class="line-modified">!         fullBody.add(treeFactory.newTextTree(resources.getText(&quot;doclet.enum_values_doc.fullbody&quot;, klassName)));</span>
  
          List&lt;DocTree&gt; descriptions = new ArrayList&lt;&gt;();
          descriptions.add(treeFactory.newTextTree(resources.getText(&quot;doclet.enum_values_doc.return&quot;)));
  
          List&lt;DocTree&gt; tags = new ArrayList&lt;&gt;();
          tags.add(treeFactory.newReturnTree(descriptions));
          DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, tags);
<span class="line-modified">!         dcTreesMap.put(e, new DocCommentDuo(null, docTree));</span>
      }
  
<span class="line-modified">!     public void setEnumValueOfTree(Element e) {</span>
<span class="line-removed">- </span>
          List&lt;DocTree&gt; fullBody = new ArrayList&lt;&gt;();
          fullBody.add(treeFactory.newTextTree(resources.getText(&quot;doclet.enum_valueof_doc.fullbody&quot;)));
  
          List&lt;DocTree&gt; tags = new ArrayList&lt;&gt;();
  
          List&lt;DocTree&gt; paramDescs = new ArrayList&lt;&gt;();
          paramDescs.add(treeFactory.newTextTree(resources.getText(&quot;doclet.enum_valueof_doc.param_name&quot;)));
<span class="line-removed">-         ExecutableElement ee = (ExecutableElement) e;</span>
          java.util.List&lt;? extends VariableElement&gt; parameters = ee.getParameters();
          VariableElement param = parameters.get(0);
          IdentifierTree id = treeFactory.newIdentifierTree(elementUtils.getName(param.getSimpleName().toString()));
          tags.add(treeFactory.newParamTree(false, id, paramDescs));
  
<span class="line-new-header">--- 113,39 ---</span>
          List&lt;DocTree&gt; list = new ArrayList&lt;&gt;();
          list.add(treeFactory.newReferenceTree(sig));
          return treeFactory.newSeeTree(list);
      }
  
<span class="line-modified">!     public TextTree makeTextTree(String content) {</span>
<span class="line-modified">!         return treeFactory.newTextTree(content);</span>
      }
  
<span class="line-modified">!     public TextTree makeTextTreeForResource(String key) {</span>
<span class="line-modified">!         return treeFactory.newTextTree(resources.getText(key));</span>
<span class="line-modified">!     }</span>
  
<span class="line-added">+     public void setEnumValuesTree(ExecutableElement ee) {</span>
          List&lt;DocTree&gt; fullBody = new ArrayList&lt;&gt;();
<span class="line-modified">!         fullBody.add(treeFactory.newTextTree(resources.getText(&quot;doclet.enum_values_doc.fullbody&quot;)));</span>
  
          List&lt;DocTree&gt; descriptions = new ArrayList&lt;&gt;();
          descriptions.add(treeFactory.newTextTree(resources.getText(&quot;doclet.enum_values_doc.return&quot;)));
  
          List&lt;DocTree&gt; tags = new ArrayList&lt;&gt;();
          tags.add(treeFactory.newReturnTree(descriptions));
          DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, tags);
<span class="line-modified">!         dcTreesMap.put(ee, new DocCommentDuo(null, docTree));</span>
      }
  
<span class="line-modified">!     public void setEnumValueOfTree(ExecutableElement ee) {</span>
          List&lt;DocTree&gt; fullBody = new ArrayList&lt;&gt;();
          fullBody.add(treeFactory.newTextTree(resources.getText(&quot;doclet.enum_valueof_doc.fullbody&quot;)));
  
          List&lt;DocTree&gt; tags = new ArrayList&lt;&gt;();
  
          List&lt;DocTree&gt; paramDescs = new ArrayList&lt;&gt;();
          paramDescs.add(treeFactory.newTextTree(resources.getText(&quot;doclet.enum_valueof_doc.param_name&quot;)));
          java.util.List&lt;? extends VariableElement&gt; parameters = ee.getParameters();
          VariableElement param = parameters.get(0);
          IdentifierTree id = treeFactory.newIdentifierTree(elementUtils.getName(param.getSimpleName().toString()));
          tags.add(treeFactory.newParamTree(false, id, paramDescs));
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 159,11 ***</span>
          ref = treeFactory.newReferenceTree(&quot;java.lang.NullPointerException&quot;);
          tags.add(treeFactory.newThrowsTree(ref, throwsDescs));
  
          DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, tags);
  
<span class="line-modified">!         dcTreesMap.put(e, new DocCommentDuo(null, docTree));</span>
      }
  
      /*
       * Returns the TreePath/DocCommentTree duo for synthesized element.
       */
<span class="line-new-header">--- 165,235 ---</span>
          ref = treeFactory.newReferenceTree(&quot;java.lang.NullPointerException&quot;);
          tags.add(treeFactory.newThrowsTree(ref, throwsDescs));
  
          DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, tags);
  
<span class="line-modified">!         dcTreesMap.put(ee, new DocCommentDuo(null, docTree));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Generates the description for the canonical constructor for a record.</span>
<span class="line-added">+      * @param ee the constructor</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public void setRecordConstructorTree(ExecutableElement ee) {</span>
<span class="line-added">+         TypeElement te = utils.getEnclosingTypeElement(ee);</span>
<span class="line-added">+ </span>
<span class="line-added">+         List&lt;DocTree&gt; fullBody =</span>
<span class="line-added">+                 makeDescriptionWithName(&quot;doclet.record_constructor_doc.fullbody&quot;, te.getSimpleName());</span>
<span class="line-added">+ </span>
<span class="line-added">+         List&lt;DocTree&gt; tags = new ArrayList&lt;&gt;();</span>
<span class="line-added">+         java.util.List&lt;? extends VariableElement&gt; parameters = ee.getParameters();</span>
<span class="line-added">+         for (VariableElement param : ee.getParameters()) {</span>
<span class="line-added">+             Name name = param.getSimpleName();</span>
<span class="line-added">+             IdentifierTree id = treeFactory.newIdentifierTree(name);</span>
<span class="line-added">+             tags.add(treeFactory.newParamTree(false, id,</span>
<span class="line-added">+                     makeDescriptionWithComponent(&quot;doclet.record_constructor_doc.param_name&quot;, te, name)));</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, tags);</span>
<span class="line-added">+         dcTreesMap.put(ee, new DocCommentDuo(null, docTree));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Generates the description for the standard {@code equals} method for a record.</span>
<span class="line-added">+      * @param ee the {@code equals} method</span>
<span class="line-added">+      */</span>
<span class="line-added">+     @SuppressWarnings(&quot;preview&quot;)</span>
<span class="line-added">+     public void setRecordEqualsTree(ExecutableElement ee) {</span>
<span class="line-added">+         List&lt;DocTree&gt; fullBody = new ArrayList&lt;&gt;();</span>
<span class="line-added">+         add(fullBody, &quot;doclet.record_equals_doc.fullbody.head&quot;);</span>
<span class="line-added">+         fullBody.add(treeFactory.newTextTree(&quot; &quot;));</span>
<span class="line-added">+ </span>
<span class="line-added">+         List&lt;? extends RecordComponentElement&gt; comps = ((TypeElement) ee.getEnclosingElement()).getRecordComponents();</span>
<span class="line-added">+         boolean hasPrimitiveComponents =</span>
<span class="line-added">+                 comps.stream().anyMatch(e -&gt; e.asType().getKind().isPrimitive());</span>
<span class="line-added">+         boolean hasReferenceComponents =</span>
<span class="line-added">+                 comps.stream().anyMatch(e -&gt; !e.asType().getKind().isPrimitive());</span>
<span class="line-added">+         if (hasPrimitiveComponents &amp;&amp; hasReferenceComponents) {</span>
<span class="line-added">+             add(fullBody, &quot;doclet.record_equals_doc.fullbody.tail.both&quot;);</span>
<span class="line-added">+         } else if (hasPrimitiveComponents) {</span>
<span class="line-added">+             add(fullBody, &quot;doclet.record_equals_doc.fullbody.tail.primitive&quot;);</span>
<span class="line-added">+         } else if (hasReferenceComponents) {</span>
<span class="line-added">+             add(fullBody, &quot;doclet.record_equals_doc.fullbody.tail.reference&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         Name paramName = ee.getParameters().get(0).getSimpleName();</span>
<span class="line-added">+         IdentifierTree id = treeFactory.newIdentifierTree(paramName);</span>
<span class="line-added">+         List&lt;DocTree&gt; paramDesc =</span>
<span class="line-added">+                 makeDescriptionWithName(&quot;doclet.record_equals_doc.param_name&quot;, paramName);</span>
<span class="line-added">+         DocTree paramTree = treeFactory.newParamTree(false, id, paramDesc);</span>
<span class="line-added">+ </span>
<span class="line-added">+         DocTree returnTree = treeFactory.newReturnTree(</span>
<span class="line-added">+                 makeDescriptionWithName(&quot;doclet.record_equals_doc.return&quot;, paramName));</span>
<span class="line-added">+ </span>
<span class="line-added">+         TreePath treePath = utils.getTreePath(ee.getEnclosingElement());</span>
<span class="line-added">+         DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, List.of(paramTree, returnTree));</span>
<span class="line-added">+         dcTreesMap.put(ee, new DocCommentDuo(treePath, docTree));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     private void add(List&lt;DocTree&gt; contents, String resourceKey) {</span>
<span class="line-added">+         // Special case to allow &#39;{@link ...}&#39; to appear in the string.</span>
<span class="line-added">+         // A less general case would be to detect literal use of Object.equals</span>
<span class="line-added">+         // A more general case would be to allow access to DocCommentParser somehow</span>
<span class="line-added">+         String body = resources.getText(resourceKey);</span>
<span class="line-added">+         Pattern p = Pattern.compile(&quot;\\{@link (\\S*)(.*)}&quot;);</span>
<span class="line-added">+         Matcher m = p.matcher(body);</span>
<span class="line-added">+         int start = 0;</span>
<span class="line-added">+         while (m.find(start)) {</span>
<span class="line-added">+             if (m.start() &gt; start) {</span>
<span class="line-added">+                 contents.add(treeFactory.newTextTree(body.substring(start, m.start())));</span>
<span class="line-added">+             }</span>
<span class="line-added">+             ReferenceTree refTree = treeFactory.newReferenceTree(m.group(1));</span>
<span class="line-added">+             List&lt;DocTree&gt; descr = List.of(treeFactory.newTextTree(m.group(2).trim())) ;</span>
<span class="line-added">+             contents.add(treeFactory.newLinkTree(refTree, descr));</span>
<span class="line-added">+             start = m.end();</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (start &lt; body.length()) {</span>
<span class="line-added">+             contents.add(treeFactory.newTextTree(body.substring(start)));</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Generates the description for the standard {@code hashCode} method for a record.</span>
<span class="line-added">+      * @param ee the {@code hashCode} method</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public void setRecordHashCodeTree(ExecutableElement ee) {</span>
<span class="line-added">+         List&lt;DocTree&gt; fullBody = List.of(makeTextTreeForResource(&quot;doclet.record_hashCode_doc.fullbody&quot;));</span>
<span class="line-added">+ </span>
<span class="line-added">+         DocTree returnTree = treeFactory.newReturnTree(</span>
<span class="line-added">+                 List.of(makeTextTreeForResource(&quot;doclet.record_hashCode_doc.return&quot;)));</span>
<span class="line-added">+ </span>
<span class="line-added">+         DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, List.of(returnTree));</span>
<span class="line-added">+         dcTreesMap.put(ee, new DocCommentDuo(null, docTree));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Generates the description for the standard {@code toString} method for a record.</span>
<span class="line-added">+      * @param ee the {@code toString} method</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public void setRecordToStringTree(ExecutableElement ee) {</span>
<span class="line-added">+         List&lt;DocTree&gt; fullBody = List.of(</span>
<span class="line-added">+                 treeFactory.newTextTree(resources.getText(&quot;doclet.record_toString_doc.fullbody&quot;)));</span>
<span class="line-added">+ </span>
<span class="line-added">+         DocTree returnTree = treeFactory.newReturnTree(List.of(</span>
<span class="line-added">+                 treeFactory.newTextTree(resources.getText(&quot;doclet.record_toString_doc.return&quot;))));</span>
<span class="line-added">+ </span>
<span class="line-added">+         DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, List.of(returnTree));</span>
<span class="line-added">+         dcTreesMap.put(ee, new DocCommentDuo(null, docTree));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Generates the description for the accessor method for a state component of a record.</span>
<span class="line-added">+      * @param ee the accessor method</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public void setRecordAccessorTree(ExecutableElement ee) {</span>
<span class="line-added">+         TypeElement te = utils.getEnclosingTypeElement(ee);</span>
<span class="line-added">+ </span>
<span class="line-added">+         List&lt;DocTree&gt; fullBody =</span>
<span class="line-added">+                 makeDescriptionWithComponent(&quot;doclet.record_accessor_doc.fullbody&quot;, te, ee.getSimpleName());</span>
<span class="line-added">+ </span>
<span class="line-added">+         DocTree returnTree = treeFactory.newReturnTree(</span>
<span class="line-added">+                     makeDescriptionWithComponent(&quot;doclet.record_accessor_doc.return&quot;, te, ee.getSimpleName()));</span>
<span class="line-added">+ </span>
<span class="line-added">+         DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, List.of(returnTree));</span>
<span class="line-added">+         dcTreesMap.put(ee, new DocCommentDuo(null, docTree));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Generates the description for the field for a state component of a record.</span>
<span class="line-added">+      * @param ve the field</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public void setRecordFieldTree(VariableElement ve) {</span>
<span class="line-added">+         TypeElement te = utils.getEnclosingTypeElement(ve);</span>
<span class="line-added">+ </span>
<span class="line-added">+         List&lt;DocTree&gt; fullBody =</span>
<span class="line-added">+             makeDescriptionWithComponent(&quot;doclet.record_field_doc.fullbody&quot;, te, ve.getSimpleName());</span>
<span class="line-added">+ </span>
<span class="line-added">+         DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, List.of());</span>
<span class="line-added">+         dcTreesMap.put(ve, new DocCommentDuo(null, docTree));</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Creates a description that contains a reference to a state component of a record.</span>
<span class="line-added">+      * The description is looked up as a resource, and should contain {@code {0}} where the</span>
<span class="line-added">+      * reference to the component is to be inserted. The reference will be a link if the</span>
<span class="line-added">+      * doc comment for the record has a {@code @param} tag for the component.</span>
<span class="line-added">+      * @param key the resource key for the description</span>
<span class="line-added">+      * @param elem the record element</span>
<span class="line-added">+      * @param component the name of the component</span>
<span class="line-added">+      * @return the description</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private List&lt;DocTree&gt; makeDescriptionWithComponent(String key, TypeElement elem, Name component) {</span>
<span class="line-added">+         List&lt;DocTree&gt; result = new ArrayList&lt;&gt;();</span>
<span class="line-added">+         String text = resources.getText(key);</span>
<span class="line-added">+         int index = text.indexOf(&quot;{0}&quot;);</span>
<span class="line-added">+         result.add(treeFactory.newTextTree(text.substring(0, index)));</span>
<span class="line-added">+         Name A = elementUtils.getName(&quot;a&quot;);</span>
<span class="line-added">+         Name CODE = elementUtils.getName(&quot;code&quot;);</span>
<span class="line-added">+         Name HREF = elementUtils.getName(&quot;href&quot;);</span>
<span class="line-added">+         List&lt;DocTree&gt; code = List.of(</span>
<span class="line-added">+                 treeFactory.newStartElementTree(CODE, List.of(), false),</span>
<span class="line-added">+                 treeFactory.newTextTree(component.toString()),</span>
<span class="line-added">+                 treeFactory.newEndElementTree(CODE));</span>
<span class="line-added">+         if (hasParamForComponent(elem, component)) {</span>
<span class="line-added">+             DocTree href = treeFactory.newAttributeTree(HREF,</span>
<span class="line-added">+                     AttributeTree.ValueKind.DOUBLE,</span>
<span class="line-added">+                     List.of(treeFactory.newTextTree(&quot;#param-&quot; + component)));</span>
<span class="line-added">+             result.add(treeFactory.newStartElementTree(A, List.of(href), false));</span>
<span class="line-added">+             result.addAll(code);</span>
<span class="line-added">+             result.add(treeFactory.newEndElementTree(A));</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             result.addAll(code);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         result.add(treeFactory.newTextTree(text.substring(index + 3)));</span>
<span class="line-added">+         return result;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Returns whether or not the doc comment for a record contains an {@code @param}}</span>
<span class="line-added">+      * for a state component of the record.</span>
<span class="line-added">+      * @param elem the record element</span>
<span class="line-added">+      * @param component the name of the component</span>
<span class="line-added">+      * @return whether or not there is a {@code @param}} for the component</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private boolean hasParamForComponent(TypeElement elem, Name component) {</span>
<span class="line-added">+         DocCommentTree elemComment = utils.getDocCommentTree(elem);</span>
<span class="line-added">+         if (elemComment == null) {</span>
<span class="line-added">+             return false;</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (DocTree t : elemComment.getBlockTags()) {</span>
<span class="line-added">+             if (t instanceof ParamTree &amp;&amp; ((ParamTree) t).getName().getName() == component) {</span>
<span class="line-added">+                 return true;</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         return false;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Creates a description that contains the simple name of a program element</span>
<span class="line-added">+      * The description is looked up as a resource, and should contain {@code {0}} where the</span>
<span class="line-added">+      * name is to be inserted.</span>
<span class="line-added">+      * @param key the resource key for the description</span>
<span class="line-added">+      * @param name the name</span>
<span class="line-added">+      * @return the description</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private List&lt;DocTree&gt; makeDescriptionWithName(String key, Name name) {</span>
<span class="line-added">+         String text = resources.getText(key);</span>
<span class="line-added">+         int index = text.indexOf(&quot;{0}&quot;);</span>
<span class="line-added">+         if (index == -1) {</span>
<span class="line-added">+             return List.of(treeFactory.newTextTree(text));</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             Name CODE = elementUtils.getName(&quot;code&quot;);</span>
<span class="line-added">+             return List.of(</span>
<span class="line-added">+                     treeFactory.newTextTree(text.substring(0, index)),</span>
<span class="line-added">+                     treeFactory.newStartElementTree(CODE, List.of(), false),</span>
<span class="line-added">+                     treeFactory.newTextTree(name.toString()),</span>
<span class="line-added">+                     treeFactory.newEndElementTree(CODE),</span>
<span class="line-added">+                     treeFactory.newTextTree(text.substring(index + 3))</span>
<span class="line-added">+             );</span>
<span class="line-added">+         }</span>
      }
  
      /*
       * Returns the TreePath/DocCommentTree duo for synthesized element.
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 213,11 ***</span>
              }
          });
      }
  
      public void setDocCommentTree(Element element, List&lt;? extends DocTree&gt; fullBody,
<span class="line-modified">!                                   List&lt;? extends DocTree&gt; blockTags, Utils utils) {</span>
          DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, blockTags);
          dcTreesMap.put(element, new DocCommentDuo(null, docTree));
          // A method having null comment (no comment) that might need to be replaced
          // with a synthetic comment, remove such a comment from the cache.
          utils.removeCommentHelper(element);
<span class="line-new-header">--- 443,11 ---</span>
              }
          });
      }
  
      public void setDocCommentTree(Element element, List&lt;? extends DocTree&gt; fullBody,
<span class="line-modified">!                                   List&lt;? extends DocTree&gt; blockTags) {</span>
          DocCommentTree docTree = treeFactory.newDocCommentTree(fullBody, blockTags);
          dcTreesMap.put(element, new DocCommentDuo(null, docTree));
          // A method having null comment (no comment) that might need to be replaced
          // with a synthetic comment, remove such a comment from the cache.
          utils.removeCommentHelper(element);
</pre>
<center><a href="ClassWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ConstantsSummaryWriter.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>