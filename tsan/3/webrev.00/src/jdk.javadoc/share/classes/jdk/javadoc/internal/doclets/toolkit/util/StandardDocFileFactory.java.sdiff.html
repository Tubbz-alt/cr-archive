<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/StandardDocFileFactory.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="MetaKeywords.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TypeElementCatalog.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/StandardDocFileFactory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 69     private Path destDir;
 70 
 71     public StandardDocFileFactory(BaseConfiguration configuration) {
 72         super(configuration);
 73         fileManager = (StandardJavaFileManager) configuration.getFileManager();
 74     }
 75 
 76     @Override
 77     public void setDestDir(String destDirName) throws SimpleDocletException {
 78         if (destDir != null)
 79             throw new AssertionError(&quot;destDir already initialized: &quot; + destDir);
 80 
 81         if (!destDirName.isEmpty()
 82                 || !fileManager.hasLocation(DocumentationTool.Location.DOCUMENTATION_OUTPUT)) {
 83             try {
 84                 String dirName = destDirName.isEmpty() ? &quot;.&quot; : destDirName;
 85                 Path dir = Paths.get(dirName);
 86                 fileManager.setLocationFromPaths(DocumentationTool.Location.DOCUMENTATION_OUTPUT, Arrays.asList(dir));
 87             } catch (IOException e) {
 88                 // generic IOException from file manager, setting location, e.g. file not a directory
<span class="line-modified"> 89                 String message = configuration.getResources().getText(&quot;doclet.error.initializing.dest.dir&quot;, e);</span>
 90                 throw new SimpleDocletException(message, e);
 91             }
 92         }
 93 
 94         destDir = fileManager.getLocationAsPaths(DocumentationTool.Location.DOCUMENTATION_OUTPUT).iterator().next();
 95     }
 96 
 97     private Path getDestDir() {
 98         Objects.requireNonNull(destDir, &quot;destDir not initialized&quot;);
 99         return destDir;
100     }
101 
102     @Override
103     public DocFile createFileForDirectory(String file) {
104         return new StandardDocFile(Paths.get(file));
105     }
106 
107     @Override
108     public DocFile createFileForInput(String file) {
109         return new StandardDocFile(Paths.get(file));
</pre>
<hr />
<pre>
190                 throw new DocFileIOException(this, DocFileIOException.Mode.WRITE, e);
191             }
192         }
193 
194         /**
195          * Open an writer for the file, using the encoding (if any) given in the
196          * doclet configuration.
197          * The file must have been created with a location of
198          * {@link DocumentationTool.Location#DOCUMENTATION_OUTPUT} and a corresponding relative path.
199          *
200          * @throws DocFileIOException if there is a problem while opening stream
201          * @throws UnsupportedEncodingException if the configured encoding is not supported
202          */
203         @Override
204         public Writer openWriter() throws DocFileIOException, UnsupportedEncodingException {
205             if (location != DocumentationTool.Location.DOCUMENTATION_OUTPUT)
206                 throw new IllegalStateException();
207 
208             try {
209                 OutputStream out = getFileObjectForOutput(path).openOutputStream();
<span class="line-modified">210                 return new BufferedWriter(new OutputStreamWriter(out, configuration.docencoding));</span>

211             } catch (IOException e) {
212                 throw new DocFileIOException(this, DocFileIOException.Mode.WRITE, e);
213             }
214         }
215 
216         /** Return true if the file can be read. */
217         @Override
218         public boolean canRead() {
219             return Files.isReadable(file);
220         }
221 
222         /** Return true if the file can be written. */
223         @Override
224         public boolean canWrite() {
225             return Files.isWritable(file);
226         }
227 
228         /** Return true if the file exists. */
229         @Override
230         public boolean exists() {
</pre>
<hr />
<pre>
311         }
312 
313         /**
314          * Derive a new file by resolving a relative path against this file.
315          * The new file will inherit the configuration and location of this file
316          * If this file has a path set, the new file will have a corresponding
317          * new path.
318          */
319         @Override
320         public DocFile resolve(String p) {
321             if (location == null &amp;&amp; path == null) {
322                 return new StandardDocFile(file.resolve(p));
323             } else {
324                 return new StandardDocFile(location, path.resolve(p));
325             }
326         }
327 
328         /**
329          * Resolve a relative file against the given output location.
330          * @param locn Currently, only
<span class="line-modified">331          * {@link DocumentationTool.Location.DOCUMENTATION_OUTPUT} is supported.</span>
332          */
333         @Override
334         public DocFile resolveAgainst(Location locn) {
335             if (locn != DocumentationTool.Location.DOCUMENTATION_OUTPUT)
336                 throw new IllegalArgumentException();
337             return new StandardDocFile(getDestDir().resolve(file));
338         }
339 
340         /** Return a string to identify the contents of this object,
341          * for debugging purposes.
342          */
343         @Override
344         public String toString() {
345             StringBuilder sb = new StringBuilder();
346             sb.append(&quot;StandardDocFile[&quot;);
347             if (location != null)
348                 sb.append(&quot;locn:&quot;).append(location).append(&quot;,&quot;);
349             if (path != null)
350                 sb.append(&quot;path:&quot;).append(path.getPath()).append(&quot;,&quot;);
351             sb.append(&quot;file:&quot;).append(file);
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 69     private Path destDir;
 70 
 71     public StandardDocFileFactory(BaseConfiguration configuration) {
 72         super(configuration);
 73         fileManager = (StandardJavaFileManager) configuration.getFileManager();
 74     }
 75 
 76     @Override
 77     public void setDestDir(String destDirName) throws SimpleDocletException {
 78         if (destDir != null)
 79             throw new AssertionError(&quot;destDir already initialized: &quot; + destDir);
 80 
 81         if (!destDirName.isEmpty()
 82                 || !fileManager.hasLocation(DocumentationTool.Location.DOCUMENTATION_OUTPUT)) {
 83             try {
 84                 String dirName = destDirName.isEmpty() ? &quot;.&quot; : destDirName;
 85                 Path dir = Paths.get(dirName);
 86                 fileManager.setLocationFromPaths(DocumentationTool.Location.DOCUMENTATION_OUTPUT, Arrays.asList(dir));
 87             } catch (IOException e) {
 88                 // generic IOException from file manager, setting location, e.g. file not a directory
<span class="line-modified"> 89                 String message = configuration.getDocResources().getText(&quot;doclet.error.initializing.dest.dir&quot;, e);</span>
 90                 throw new SimpleDocletException(message, e);
 91             }
 92         }
 93 
 94         destDir = fileManager.getLocationAsPaths(DocumentationTool.Location.DOCUMENTATION_OUTPUT).iterator().next();
 95     }
 96 
 97     private Path getDestDir() {
 98         Objects.requireNonNull(destDir, &quot;destDir not initialized&quot;);
 99         return destDir;
100     }
101 
102     @Override
103     public DocFile createFileForDirectory(String file) {
104         return new StandardDocFile(Paths.get(file));
105     }
106 
107     @Override
108     public DocFile createFileForInput(String file) {
109         return new StandardDocFile(Paths.get(file));
</pre>
<hr />
<pre>
190                 throw new DocFileIOException(this, DocFileIOException.Mode.WRITE, e);
191             }
192         }
193 
194         /**
195          * Open an writer for the file, using the encoding (if any) given in the
196          * doclet configuration.
197          * The file must have been created with a location of
198          * {@link DocumentationTool.Location#DOCUMENTATION_OUTPUT} and a corresponding relative path.
199          *
200          * @throws DocFileIOException if there is a problem while opening stream
201          * @throws UnsupportedEncodingException if the configured encoding is not supported
202          */
203         @Override
204         public Writer openWriter() throws DocFileIOException, UnsupportedEncodingException {
205             if (location != DocumentationTool.Location.DOCUMENTATION_OUTPUT)
206                 throw new IllegalStateException();
207 
208             try {
209                 OutputStream out = getFileObjectForOutput(path).openOutputStream();
<span class="line-modified">210                 String docencoding = configuration.getOptions().docEncoding();</span>
<span class="line-added">211                 return new BufferedWriter(new OutputStreamWriter(out, docencoding));</span>
212             } catch (IOException e) {
213                 throw new DocFileIOException(this, DocFileIOException.Mode.WRITE, e);
214             }
215         }
216 
217         /** Return true if the file can be read. */
218         @Override
219         public boolean canRead() {
220             return Files.isReadable(file);
221         }
222 
223         /** Return true if the file can be written. */
224         @Override
225         public boolean canWrite() {
226             return Files.isWritable(file);
227         }
228 
229         /** Return true if the file exists. */
230         @Override
231         public boolean exists() {
</pre>
<hr />
<pre>
312         }
313 
314         /**
315          * Derive a new file by resolving a relative path against this file.
316          * The new file will inherit the configuration and location of this file
317          * If this file has a path set, the new file will have a corresponding
318          * new path.
319          */
320         @Override
321         public DocFile resolve(String p) {
322             if (location == null &amp;&amp; path == null) {
323                 return new StandardDocFile(file.resolve(p));
324             } else {
325                 return new StandardDocFile(location, path.resolve(p));
326             }
327         }
328 
329         /**
330          * Resolve a relative file against the given output location.
331          * @param locn Currently, only
<span class="line-modified">332          * {@link DocumentationTool.Location#DOCUMENTATION_OUTPUT} is supported.</span>
333          */
334         @Override
335         public DocFile resolveAgainst(Location locn) {
336             if (locn != DocumentationTool.Location.DOCUMENTATION_OUTPUT)
337                 throw new IllegalArgumentException();
338             return new StandardDocFile(getDestDir().resolve(file));
339         }
340 
341         /** Return a string to identify the contents of this object,
342          * for debugging purposes.
343          */
344         @Override
345         public String toString() {
346             StringBuilder sb = new StringBuilder();
347             sb.append(&quot;StandardDocFile[&quot;);
348             if (location != null)
349                 sb.append(&quot;locn:&quot;).append(location).append(&quot;,&quot;);
350             if (path != null)
351                 sb.append(&quot;path:&quot;).append(path.getPath()).append(&quot;,&quot;);
352             sb.append(&quot;file:&quot;).append(file);
</pre>
</td>
</tr>
</table>
<center><a href="MetaKeywords.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TypeElementCatalog.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>