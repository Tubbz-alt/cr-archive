<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractMemberWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractIndexWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractTreeWriter.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractMemberWriter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,72 +23,75 @@</span>
   * questions.
   */
  
  package jdk.javadoc.internal.doclets.formats.html;
  
<span class="udiff-line-modified-removed">- import jdk.javadoc.internal.doclets.formats.html.markup.Table;</span>
<span class="udiff-line-modified-removed">- import jdk.javadoc.internal.doclets.formats.html.markup.TableHeader;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- import java.util.*;</span>
<span class="udiff-line-modified-added">+ import java.util.ArrayList;</span>
<span class="udiff-line-modified-added">+ import java.util.List;</span>
<span class="udiff-line-modified-added">+ import java.util.Set;</span>
<span class="udiff-line-modified-added">+ import java.util.TreeSet;</span>
  import java.util.stream.Collectors;
  
  import javax.lang.model.element.Element;
  import javax.lang.model.element.ExecutableElement;
  import javax.lang.model.element.Modifier;
  import javax.lang.model.element.TypeElement;
  import javax.lang.model.element.TypeParameterElement;
  import javax.lang.model.type.TypeMirror;
  
  import com.sun.source.doctree.DocTree;
<span class="udiff-line-added">+ </span>
  import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.Entity;</span>
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.Links;
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.StringContent;</span>
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.Table;</span>
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.TableHeader;</span>
  import jdk.javadoc.internal.doclets.toolkit.Content;
  import jdk.javadoc.internal.doclets.toolkit.MemberSummaryWriter;
  import jdk.javadoc.internal.doclets.toolkit.Resources;
  import jdk.javadoc.internal.doclets.toolkit.taglets.DeprecatedTaglet;
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.toolkit.util.DocletConstants;</span>
  import jdk.javadoc.internal.doclets.toolkit.util.Utils;
  
<span class="udiff-line-modified-removed">- import static javax.lang.model.element.Modifier.*;</span>
<span class="udiff-line-modified-added">+ import static javax.lang.model.element.Modifier.ABSTRACT;</span>
<span class="udiff-line-added">+ import static javax.lang.model.element.Modifier.NATIVE;</span>
<span class="udiff-line-added">+ import static javax.lang.model.element.Modifier.PUBLIC;</span>
<span class="udiff-line-added">+ import static javax.lang.model.element.Modifier.STRICTFP;</span>
<span class="udiff-line-added">+ import static javax.lang.model.element.Modifier.SYNCHRONIZED;</span>
  
  /**
   * The base class for member writers.
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
<span class="udiff-line-removed">-  *</span>
<span class="udiff-line-removed">-  * @author Robert Field</span>
<span class="udiff-line-removed">-  * @author Atul M Dambalkar</span>
<span class="udiff-line-removed">-  * @author Jamie Ho (Re-write)</span>
<span class="udiff-line-removed">-  * @author Bhavesh Patel (Modified)</span>
   */
  public abstract class AbstractMemberWriter implements MemberSummaryWriter {
  
      protected final HtmlConfiguration configuration;
<span class="udiff-line-added">+     protected final HtmlOptions options;</span>
      protected final Utils utils;
      protected final SubWriterHolderWriter writer;
      protected final Contents contents;
      protected final Resources resources;
      protected final Links links;
  
      protected final TypeElement typeElement;
<span class="udiff-line-removed">-     public final boolean nodepr;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     protected boolean printedSummaryHeader = false;</span>
  
      public AbstractMemberWriter(SubWriterHolderWriter writer, TypeElement typeElement) {
          this.configuration = writer.configuration;
<span class="udiff-line-added">+         this.options = configuration.getOptions();</span>
          this.writer = writer;
<span class="udiff-line-removed">-         this.nodepr = configuration.nodeprecated;</span>
          this.typeElement = typeElement;
          this.utils = configuration.utils;
          this.contents = configuration.contents;
<span class="udiff-line-modified-removed">-         this.resources = configuration.resources;</span>
<span class="udiff-line-modified-added">+         this.resources = configuration.docResources;</span>
          this.links = writer.links;
      }
  
      public AbstractMemberWriter(SubWriterHolderWriter writer) {
          this(writer, null);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -135,36 +138,18 @@</span>
       *
       * @return the summary table
       */
      protected abstract Table createSummaryTable();
  
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- </span>
      /**
       * Add inherited summary label for the member.
       *
       * @param typeElement the TypeElement to which to link to
       * @param inheritedTree the content tree to which the inherited summary label will be added
       */
      public abstract void addInheritedSummaryLabel(TypeElement typeElement, Content inheritedTree);
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Add the anchor for the summary section of the member.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param typeElement the TypeElement to be documented</span>
<span class="udiff-line-removed">-      * @param memberTree the content tree to which the summary anchor will be added</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public abstract void addSummaryAnchor(TypeElement typeElement, Content memberTree);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Add the anchor for the inherited summary section of the member.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param typeElement the TypeElement to be documented</span>
<span class="udiff-line-removed">-      * @param inheritedTree the content tree to which the inherited summary anchor will be added</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     public abstract void addInheritedSummaryAnchor(TypeElement typeElement, Content inheritedTree);</span>
<span class="udiff-line-removed">- </span>
      /**
       * Add the summary type for the member.
       *
       * @param member the member to be documented
       * @param tdSummaryType the content tree to which the type will be added
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -209,70 +194,10 @@</span>
       * @param member the member being linked to
       * @return a content tree representing the link
       */
      protected abstract Content getDeprecatedLink(Element member);
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Add the member name to the content tree.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param name the member name to be added to the content tree.</span>
<span class="udiff-line-removed">-      * @param htmltree the content tree to which the name will be added.</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     protected void addName(String name, Content htmltree) {</span>
<span class="udiff-line-removed">-         htmltree.add(name);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * Add the modifier for the member. The modifiers are ordered as specified</span>
<span class="udiff-line-removed">-      * by &lt;em&gt;The Java Language Specification&lt;/em&gt;.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param member the member for which the modifier will be added.</span>
<span class="udiff-line-removed">-      * @param htmltree the content tree to which the modifier information will be added.</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     protected void addModifiers(Element member, Content htmltree) {</span>
<span class="udiff-line-removed">-         Set&lt;Modifier&gt; set = new TreeSet&lt;&gt;(member.getModifiers());</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         // remove the ones we really don&#39;t need</span>
<span class="udiff-line-removed">-         set.remove(NATIVE);</span>
<span class="udiff-line-removed">-         set.remove(SYNCHRONIZED);</span>
<span class="udiff-line-removed">-         set.remove(STRICTFP);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         // According to JLS, we should not be showing public modifier for</span>
<span class="udiff-line-removed">-         // interface methods.</span>
<span class="udiff-line-removed">-         if ((utils.isField(member) || utils.isMethod(member))</span>
<span class="udiff-line-removed">-             &amp;&amp; ((writer instanceof ClassWriterImpl</span>
<span class="udiff-line-removed">-                  &amp;&amp; utils.isInterface(((ClassWriterImpl) writer).getTypeElement())  ||</span>
<span class="udiff-line-removed">-                  writer instanceof AnnotationTypeWriterImpl) )) {</span>
<span class="udiff-line-removed">-             // Remove the implicit abstract and public modifiers</span>
<span class="udiff-line-removed">-             if (utils.isMethod(member) &amp;&amp;</span>
<span class="udiff-line-removed">-                 (utils.isInterface(member.getEnclosingElement()) ||</span>
<span class="udiff-line-removed">-                  utils.isAnnotationType(member.getEnclosingElement()))) {</span>
<span class="udiff-line-removed">-                 set.remove(ABSTRACT);</span>
<span class="udiff-line-removed">-                 set.remove(PUBLIC);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-             if (!utils.isMethod(member)) {</span>
<span class="udiff-line-removed">-                 set.remove(PUBLIC);</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         if (!set.isEmpty()) {</span>
<span class="udiff-line-removed">-             String mods = set.stream().map(Modifier::toString).collect(Collectors.joining(&quot; &quot;));</span>
<span class="udiff-line-removed">-             htmltree.add(mods);</span>
<span class="udiff-line-removed">-             htmltree.add(Contents.SPACE);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     protected CharSequence makeSpace(int len) {</span>
<span class="udiff-line-removed">-         if (len &lt;= 0) {</span>
<span class="udiff-line-removed">-             return &quot;&quot;;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         StringBuilder sb = new StringBuilder(len);</span>
<span class="udiff-line-removed">-         for (int i = 0; i &lt; len; i++) {</span>
<span class="udiff-line-removed">-             sb.append(&#39; &#39;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return sb;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      /**
       * Add the modifier and type for the member in the member summary.
       *
       * @param member the member to add the type for
       * @param type the type to add
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -282,11 +207,11 @@</span>
              Content tdSummaryType) {
          HtmlTree code = new HtmlTree(HtmlTag.CODE);
          addModifier(member, code);
          if (type == null) {
              code.add(utils.isClass(member) ? &quot;class&quot; : &quot;interface&quot;);
<span class="udiff-line-modified-removed">-             code.add(Contents.SPACE);</span>
<span class="udiff-line-modified-added">+             code.add(Entity.NO_BREAK_SPACE);</span>
          } else {
              List&lt;? extends TypeParameterElement&gt; list = utils.isExecutableElement(member)
                      ? ((ExecutableElement)member).getTypeParameters()
                      : null;
              if (list != null &amp;&amp; !list.isEmpty()) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -295,11 +220,11 @@</span>
                      code.add(typeParameters);
                  //Code to avoid ugly wrapping in member summary table.
                  if (typeParameters.charCount() &gt; 10) {
                      code.add(new HtmlTree(HtmlTag.BR));
                  } else {
<span class="udiff-line-modified-removed">-                     code.add(Contents.SPACE);</span>
<span class="udiff-line-modified-added">+                     code.add(Entity.NO_BREAK_SPACE);</span>
                  }
                  code.add(
                          writer.getLink(new LinkInfoImpl(configuration,
                          LinkInfoImpl.Kind.SUMMARY_RETURN_TYPE, type)));
              } else {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -438,11 +363,11 @@</span>
              contentTree.add(useTable.toContent());
          }
      }
  
      protected void serialWarning(Element e, String key, String a1, String a2) {
<span class="udiff-line-modified-removed">-         if (configuration.serialwarn) {</span>
<span class="udiff-line-modified-added">+         if (options.serialWarn()) {</span>
              configuration.messages.warning(e, key, a1, a2);
          }
      }
  
      /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -496,11 +421,11 @@</span>
       * @param tElement the class the inherited member belongs to
       * @return a content tree for the inherited summary header
       */
      @Override
      public Content getInheritedSummaryHeader(TypeElement tElement) {
<span class="udiff-line-modified-removed">-         Content inheritedTree = writer.getMemberTreeHeader();</span>
<span class="udiff-line-modified-added">+         Content inheritedTree = writer.getMemberInheritedTree();</span>
          writer.addInheritedSummaryHeader(this, tElement, inheritedTree);
          return inheritedTree;
      }
  
      /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -541,18 +466,237 @@</span>
      public Content getMemberTree(Content memberTree) {
          return writer.getMemberTree(memberTree);
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Get the member tree to be documented.</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @param memberTree the content tree of member to be documented</span>
<span class="udiff-line-removed">-      * @param isLastContent true if the content to be added is the last content</span>
<span class="udiff-line-removed">-      * @return a content tree that will be added to the class documentation</span>
<span class="udiff-line-modified-added">+      * A content builder for member signatures.</span>
       */
<span class="udiff-line-modified-removed">-     public Content getMemberTree(Content memberTree, boolean isLastContent) {</span>
<span class="udiff-line-modified-removed">-         if (isLastContent)</span>
<span class="udiff-line-modified-removed">-             return HtmlTree.UL(HtmlStyle.blockListLast, memberTree);</span>
<span class="udiff-line-modified-removed">-         else</span>
<span class="udiff-line-modified-removed">-             return HtmlTree.UL(HtmlStyle.blockList, memberTree);</span>
<span class="udiff-line-modified-added">+     class MemberSignature {</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         private Element element;</span>
<span class="udiff-line-modified-added">+         private Content typeParameters;</span>
<span class="udiff-line-modified-added">+         private Content returnType;</span>
<span class="udiff-line-added">+         private Content parameters;</span>
<span class="udiff-line-added">+         private Content exceptions;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // Threshold for length of type parameters before switching from inline to block representation.</span>
<span class="udiff-line-added">+         private static final int TYPE_PARAMS_MAX_INLINE_LENGTH = 50;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         // Threshold for combined length of modifiers, type params and return type before breaking</span>
<span class="udiff-line-added">+         // it up with a line break before the return type.</span>
<span class="udiff-line-added">+         private static final int RETURN_TYPE_MAX_LINE_LENGTH = 50;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Create a new member signature builder.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @param element The element for which to create a signature.</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         MemberSignature(Element element) {</span>
<span class="udiff-line-added">+             this.element = element;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Add the type parameters for an executable member.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @param typeParameters the content tree containing the type parameters to add.</span>
<span class="udiff-line-added">+          * @return this MemberSignature instance</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         MemberSignature addTypeParameters(Content typeParameters) {</span>
<span class="udiff-line-added">+             this.typeParameters = typeParameters;</span>
<span class="udiff-line-added">+             return this;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Add the return type for an executable member.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @param returnType the content tree containing the return type to add.</span>
<span class="udiff-line-added">+          * @return this MemberSignature instance</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         MemberSignature addReturnType(Content returnType) {</span>
<span class="udiff-line-added">+             this.returnType = returnType;</span>
<span class="udiff-line-added">+             return this;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Add the type information for a non-executable member.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @param type the type of the member.</span>
<span class="udiff-line-added">+          * @return this MemberSignature instance</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         MemberSignature addType(TypeMirror type) {</span>
<span class="udiff-line-added">+             this.returnType = writer.getLink(new LinkInfoImpl(configuration, LinkInfoImpl.Kind.MEMBER, type));</span>
<span class="udiff-line-added">+             return this;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Add the parameter information of an executable member.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @param paramTree the content tree containing the parameter information.</span>
<span class="udiff-line-added">+          * @return this MemberSignature instance</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         MemberSignature addParameters(Content paramTree) {</span>
<span class="udiff-line-added">+             this.parameters = paramTree;</span>
<span class="udiff-line-added">+             return this;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Add the exception information of an executable member.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @param exceptionTree the content tree containing the exception information</span>
<span class="udiff-line-added">+          * @return this MemberSignature instance</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         MemberSignature addExceptions(Content exceptionTree) {</span>
<span class="udiff-line-added">+             this.exceptions = exceptionTree;</span>
<span class="udiff-line-added">+             return this;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Return a HTML tree containing the member signature.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @return a HTML tree containing the member signature</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         Content toContent() {</span>
<span class="udiff-line-added">+             Content content = new ContentBuilder();</span>
<span class="udiff-line-added">+             // Position of last line separator.</span>
<span class="udiff-line-added">+             int lastLineSeparator = 0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // Annotations</span>
<span class="udiff-line-added">+             Content annotationInfo = writer.getAnnotationInfo(element.getAnnotationMirrors(), true);</span>
<span class="udiff-line-added">+             if (!annotationInfo.isEmpty()) {</span>
<span class="udiff-line-added">+                 content.add(HtmlTree.SPAN(HtmlStyle.annotations, annotationInfo));</span>
<span class="udiff-line-added">+                 lastLineSeparator = content.charCount();</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // Modifiers</span>
<span class="udiff-line-added">+             appendModifiers(content);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // Type parameters</span>
<span class="udiff-line-added">+             if (typeParameters != null &amp;&amp; !typeParameters.isEmpty()) {</span>
<span class="udiff-line-added">+                 lastLineSeparator = appendTypeParameters(content, lastLineSeparator);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // Return type</span>
<span class="udiff-line-added">+             if (returnType != null) {</span>
<span class="udiff-line-added">+                 content.add(HtmlTree.SPAN(HtmlStyle.returnType, returnType));</span>
<span class="udiff-line-added">+                 content.add(Entity.NO_BREAK_SPACE);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // Name</span>
<span class="udiff-line-added">+             HtmlTree nameSpan = new HtmlTree(HtmlTag.SPAN);</span>
<span class="udiff-line-added">+             nameSpan.setStyle(HtmlStyle.memberName);</span>
<span class="udiff-line-added">+             if (options.linkSource()) {</span>
<span class="udiff-line-added">+                 Content name = new StringContent(name(element));</span>
<span class="udiff-line-added">+                 writer.addSrcLink(element, name, nameSpan);</span>
<span class="udiff-line-added">+             } else {</span>
<span class="udiff-line-added">+                 nameSpan.add(name(element));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             content.add(nameSpan);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // Parameters and exceptions</span>
<span class="udiff-line-added">+             if (parameters != null) {</span>
<span class="udiff-line-added">+                 appendParametersAndExceptions(content, lastLineSeparator);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             return HtmlTree.DIV(HtmlStyle.memberSignature, content);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Add the modifier for the member. The modifiers are ordered as specified</span>
<span class="udiff-line-added">+          * by &lt;em&gt;The Java Language Specification&lt;/em&gt;.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @param htmltree the content tree to which the modifier information will be added.</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         private void appendModifiers(Content htmltree) {</span>
<span class="udiff-line-added">+             Set&lt;Modifier&gt; set = new TreeSet&lt;&gt;(element.getModifiers());</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // remove the ones we really don&#39;t need</span>
<span class="udiff-line-added">+             set.remove(NATIVE);</span>
<span class="udiff-line-added">+             set.remove(SYNCHRONIZED);</span>
<span class="udiff-line-added">+             set.remove(STRICTFP);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // According to JLS, we should not be showing public modifier for</span>
<span class="udiff-line-added">+             // interface methods.</span>
<span class="udiff-line-added">+             if ((utils.isField(element) || utils.isMethod(element))</span>
<span class="udiff-line-added">+                     &amp;&amp; ((writer instanceof ClassWriterImpl</span>
<span class="udiff-line-added">+                     &amp;&amp; utils.isInterface(((ClassWriterImpl) writer).getTypeElement())  ||</span>
<span class="udiff-line-added">+                     writer instanceof AnnotationTypeWriterImpl) )) {</span>
<span class="udiff-line-added">+                 // Remove the implicit abstract and public modifiers</span>
<span class="udiff-line-added">+                 if (utils.isMethod(element) &amp;&amp;</span>
<span class="udiff-line-added">+                         (utils.isInterface(element.getEnclosingElement()) ||</span>
<span class="udiff-line-added">+                                 utils.isAnnotationType(element.getEnclosingElement()))) {</span>
<span class="udiff-line-added">+                     set.remove(ABSTRACT);</span>
<span class="udiff-line-added">+                     set.remove(PUBLIC);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 if (!utils.isMethod(element)) {</span>
<span class="udiff-line-added">+                     set.remove(PUBLIC);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             if (!set.isEmpty()) {</span>
<span class="udiff-line-added">+                 String mods = set.stream().map(Modifier::toString).collect(Collectors.joining(&quot; &quot;));</span>
<span class="udiff-line-added">+                 htmltree.add(HtmlTree.SPAN(HtmlStyle.modifiers, new StringContent(mods)));</span>
<span class="udiff-line-added">+                 htmltree.add(Entity.NO_BREAK_SPACE);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Append the type parameter information to the HTML tree.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @param htmltree the HTML tree</span>
<span class="udiff-line-added">+          * @param lastLineSeparator index of last line separator in HTML tree</span>
<span class="udiff-line-added">+          * @return the new index of the last line separator</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         private int appendTypeParameters(Content htmltree, int lastLineSeparator) {</span>
<span class="udiff-line-added">+             // Apply different wrapping strategies for type parameters</span>
<span class="udiff-line-added">+             // depending of combined length of type parameters and return type.</span>
<span class="udiff-line-added">+             int typeParamLength = typeParameters.charCount();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             if (typeParamLength &gt;= TYPE_PARAMS_MAX_INLINE_LENGTH) {</span>
<span class="udiff-line-added">+                 htmltree.add(HtmlTree.SPAN(HtmlStyle.typeParametersLong, typeParameters));</span>
<span class="udiff-line-added">+             } else {</span>
<span class="udiff-line-added">+                 htmltree.add(HtmlTree.SPAN(HtmlStyle.typeParameters, typeParameters));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             int lineLength = htmltree.charCount() - lastLineSeparator;</span>
<span class="udiff-line-added">+             int newLastLineSeparator = lastLineSeparator;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // sum below includes length of modifiers plus type params added above</span>
<span class="udiff-line-added">+             if (lineLength + returnType.charCount()&gt; RETURN_TYPE_MAX_LINE_LENGTH) {</span>
<span class="udiff-line-added">+                 htmltree.add(DocletConstants.NL);</span>
<span class="udiff-line-added">+                 newLastLineSeparator = htmltree.charCount();</span>
<span class="udiff-line-added">+             } else {</span>
<span class="udiff-line-added">+                 htmltree.add(Entity.NO_BREAK_SPACE);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             return newLastLineSeparator;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         /**</span>
<span class="udiff-line-added">+          * Append the parameters and exceptions information to the HTML tree.</span>
<span class="udiff-line-added">+          *</span>
<span class="udiff-line-added">+          * @param htmltree the HTML tree</span>
<span class="udiff-line-added">+          * @param lastLineSeparator the index of the last line separator in HTML tree</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         private void appendParametersAndExceptions(Content htmltree, int lastLineSeparator) {</span>
<span class="udiff-line-added">+             // Record current position for indentation of exceptions</span>
<span class="udiff-line-added">+             int indentSize = htmltree.charCount() - lastLineSeparator;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             if (parameters.isEmpty()) {</span>
<span class="udiff-line-added">+                 htmltree.add(&quot;()&quot;);</span>
<span class="udiff-line-added">+             } else {</span>
<span class="udiff-line-added">+                 parameters.add(&quot;)&quot;);</span>
<span class="udiff-line-added">+                 htmltree.add(Entity.ZERO_WIDTH_SPACE);</span>
<span class="udiff-line-added">+                 htmltree.add(&quot;(&quot;);</span>
<span class="udiff-line-added">+                 htmltree.add(HtmlTree.SPAN(HtmlStyle.arguments, parameters));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             // Exceptions</span>
<span class="udiff-line-added">+             if (exceptions != null &amp;&amp; !exceptions.isEmpty()) {</span>
<span class="udiff-line-added">+                 CharSequence indent = &quot; &quot;.repeat(Math.max(0, indentSize + 1 - 7));</span>
<span class="udiff-line-added">+                 htmltree.add(DocletConstants.NL);</span>
<span class="udiff-line-added">+                 htmltree.add(indent);</span>
<span class="udiff-line-added">+                 htmltree.add(&quot;throws &quot;);</span>
<span class="udiff-line-added">+                 htmltree.add(HtmlTree.SPAN(HtmlStyle.exceptions, exceptions));</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
      }
  }
</pre>
<center><a href="AbstractIndexWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractTreeWriter.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>