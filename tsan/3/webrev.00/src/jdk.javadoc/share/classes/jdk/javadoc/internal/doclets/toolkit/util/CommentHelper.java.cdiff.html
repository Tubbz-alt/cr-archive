<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/CommentHelper.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ClassUseMapper.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DeprecatedAPIListBuilder.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/util/CommentHelper.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 26,14 ***</span>
  package jdk.javadoc.internal.doclets.toolkit.util;
  
  import java.util.ArrayList;
  import java.util.Collections;
  import java.util.List;
  
  import javax.lang.model.element.Element;
  import javax.lang.model.element.ExecutableElement;
<span class="line-removed">- import javax.lang.model.element.ModuleElement;</span>
  import javax.lang.model.element.PackageElement;
  import javax.lang.model.element.TypeElement;
  import javax.lang.model.type.TypeMirror;
  
  import com.sun.source.doctree.AttributeTree;
<span class="line-new-header">--- 26,14 ---</span>
  package jdk.javadoc.internal.doclets.toolkit.util;
  
  import java.util.ArrayList;
  import java.util.Collections;
  import java.util.List;
<span class="line-added">+ import java.util.stream.Collectors;</span>
  
  import javax.lang.model.element.Element;
  import javax.lang.model.element.ExecutableElement;
  import javax.lang.model.element.PackageElement;
  import javax.lang.model.element.TypeElement;
  import javax.lang.model.type.TypeMirror;
  
  import com.sun.source.doctree.AttributeTree;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 81,32 ***</span>
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
   */
  public class CommentHelper {
      public final TreePath path;
<span class="line-modified">!     public final DocCommentTree dctree;</span>
      public final Element element;
      private Element overriddenElement;
  
      public static final String SPACER = &quot; &quot;;
  
<span class="line-modified">!     public CommentHelper(BaseConfiguration configuration, Element element, TreePath path, DocCommentTree dctree) {</span>
<span class="line-modified">!         //this.configuration = configuration;</span>
          this.element = element;
          this.path = path;
<span class="line-modified">!         this.dctree = dctree;</span>
      }
  
      public void setOverrideElement(Element ove) {
          if (this.element == ove) {
<span class="line-modified">!             throw new AssertionError(&quot;cannot set given element as overriden element&quot;);</span>
          }
          overriddenElement = ove;
      }
  
<span class="line-removed">-     @SuppressWarnings(&quot;fallthrough&quot;)</span>
      public String getTagName(DocTree dtree) {
          switch (dtree.getKind()) {
              case AUTHOR:
              case DEPRECATED:
              case PARAM:
<span class="line-new-header">--- 81,40 ---</span>
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
   */
  public class CommentHelper {
<span class="line-added">+     private final BaseConfiguration configuration;</span>
      public final TreePath path;
<span class="line-modified">!     public final DocCommentTree dcTree;</span>
      public final Element element;
      private Element overriddenElement;
  
      public static final String SPACER = &quot; &quot;;
  
<span class="line-modified">!     /**</span>
<span class="line-modified">!      * Creates a utility class to encapsulate the contextual information for a doc comment tree.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @param configuration the configuration</span>
<span class="line-added">+      * @param element       the element for which this is a doc comment</span>
<span class="line-added">+      * @param path          the path for the element</span>
<span class="line-added">+      * @param dcTree        the doc comment</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public CommentHelper(BaseConfiguration configuration, Element element, TreePath path, DocCommentTree dcTree) {</span>
<span class="line-added">+         this.configuration = configuration;</span>
          this.element = element;
          this.path = path;
<span class="line-modified">!         this.dcTree = dcTree;</span>
      }
  
      public void setOverrideElement(Element ove) {
          if (this.element == ove) {
<span class="line-modified">!             throw new AssertionError(&quot;cannot set given element as overridden element&quot;);</span>
          }
          overriddenElement = ove;
      }
  
      public String getTagName(DocTree dtree) {
          switch (dtree.getKind()) {
              case AUTHOR:
              case DEPRECATED:
              case PARAM:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 117,13 ***</span>
              case SERIAL_FIELD:
              case THROWS:
              case UNKNOWN_BLOCK_TAG:
              case USES:
              case VERSION:
<span class="line-modified">!                 return ((BlockTagTree)dtree).getTagName();</span>
              case UNKNOWN_INLINE_TAG:
<span class="line-modified">!                 return ((InlineTagTree)dtree).getTagName();</span>
              case ERRONEOUS:
                  return &quot;erroneous&quot;;
              default:
                  return dtree.getKind().tagName;
          }
<span class="line-new-header">--- 125,13 ---</span>
              case SERIAL_FIELD:
              case THROWS:
              case UNKNOWN_BLOCK_TAG:
              case USES:
              case VERSION:
<span class="line-modified">!                 return ((BlockTagTree) dtree).getTagName();</span>
              case UNKNOWN_INLINE_TAG:
<span class="line-modified">!                 return ((InlineTagTree) dtree).getTagName();</span>
              case ERRONEOUS:
                  return &quot;erroneous&quot;;
              default:
                  return dtree.getKind().tagName;
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 142,56 ***</span>
          } else {
              return null;
          }
      }
  
<span class="line-modified">!     Element getElement(BaseConfiguration c, ReferenceTree rtree) {</span>
          // likely a synthesized tree
          if (path == null) {
<span class="line-modified">!             TypeMirror symbol = c.utils.getSymbol(rtree.getSignature());</span>
              if (symbol == null) {
                  return null;
              }
<span class="line-modified">!             return  c.docEnv.getTypeUtils().asElement(symbol);</span>
          }
          // case A: the element contains no comments associated and
          // the comments need to be copied from ancestor
          // case B: the element has @inheritDoc, then the ancestral comment
          // as appropriate has to be copied over.
  
          // Case A.
<span class="line-modified">!         if (dctree == null &amp;&amp; overriddenElement != null) {</span>
<span class="line-modified">!             CommentHelper ovch = c.utils.getCommentHelper(overriddenElement);</span>
<span class="line-modified">!             return ovch.getElement(c, rtree);</span>
          }
<span class="line-modified">!         if (dctree == null) {</span>
              return null;
          }
<span class="line-modified">!         DocTreePath docTreePath = DocTreePath.getPath(path, dctree, rtree);</span>
          if (docTreePath == null) {
              // Case B.
              if (overriddenElement != null) {
<span class="line-modified">!                 CommentHelper ovch = c.utils.getCommentHelper(overriddenElement);</span>
<span class="line-modified">!                 return ovch.getElement(c, rtree);</span>
              }
              return null;
          }
<span class="line-modified">!         DocTrees doctrees = c.docEnv.getDocTrees();</span>
          return doctrees.getElement(docTreePath);
      }
  
<span class="line-modified">!     public Element getException(BaseConfiguration c, DocTree dtree) {</span>
          if (dtree.getKind() == THROWS || dtree.getKind() == EXCEPTION) {
              ThrowsTree tt = (ThrowsTree)dtree;
              ReferenceTree exceptionName = tt.getExceptionName();
<span class="line-modified">!             return getElement(c, exceptionName);</span>
          }
          return null;
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getDescription(BaseConfiguration c, DocTree dtree) {</span>
<span class="line-modified">!         return getTags(c, dtree);</span>
      }
  
      public String getText(List&lt;? extends DocTree&gt; list) {
          StringBuilder sb = new StringBuilder();
          for (DocTree dt : list) {
<span class="line-new-header">--- 150,60 ---</span>
          } else {
              return null;
          }
      }
  
<span class="line-modified">!     Element getElement(ReferenceTree rtree) {</span>
<span class="line-added">+         Utils utils = configuration.utils;</span>
          // likely a synthesized tree
          if (path == null) {
<span class="line-modified">!             // NOTE: this code path only supports module/package/type signatures</span>
<span class="line-added">+             //       and not member signatures. For more complete support,</span>
<span class="line-added">+             //       set a suitable path and avoid this branch.</span>
<span class="line-added">+             TypeMirror symbol = utils.getSymbol(rtree.getSignature());</span>
              if (symbol == null) {
                  return null;
              }
<span class="line-modified">!             return configuration.docEnv.getTypeUtils().asElement(symbol);</span>
          }
          // case A: the element contains no comments associated and
          // the comments need to be copied from ancestor
          // case B: the element has @inheritDoc, then the ancestral comment
          // as appropriate has to be copied over.
  
          // Case A.
<span class="line-modified">!         if (dcTree == null &amp;&amp; overriddenElement != null) {</span>
<span class="line-modified">!             CommentHelper ovch = utils.getCommentHelper(overriddenElement);</span>
<span class="line-modified">!             return ovch.getElement(rtree);</span>
          }
<span class="line-modified">!         if (dcTree == null) {</span>
              return null;
          }
<span class="line-modified">!         DocTreePath docTreePath = DocTreePath.getPath(path, dcTree, rtree);</span>
          if (docTreePath == null) {
              // Case B.
              if (overriddenElement != null) {
<span class="line-modified">!                 CommentHelper ovch = utils.getCommentHelper(overriddenElement);</span>
<span class="line-modified">!                 return ovch.getElement(rtree);</span>
              }
              return null;
          }
<span class="line-modified">!         DocTrees doctrees = configuration.docEnv.getDocTrees();</span>
          return doctrees.getElement(docTreePath);
      }
  
<span class="line-modified">!     public Element getException(DocTree dtree) {</span>
          if (dtree.getKind() == THROWS || dtree.getKind() == EXCEPTION) {
              ThrowsTree tt = (ThrowsTree)dtree;
              ReferenceTree exceptionName = tt.getExceptionName();
<span class="line-modified">!             return getElement(exceptionName);</span>
          }
          return null;
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getDescription(DocTree dtree) {</span>
<span class="line-modified">!         return getTags(dtree);</span>
      }
  
      public String getText(List&lt;? extends DocTree&gt; list) {
          StringBuilder sb = new StringBuilder();
          for (DocTree dt : list) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 219,20 ***</span>
                  switch (node.getValueKind()) {
                      case DOUBLE:
                          quote = &quot;\&quot;&quot;;
                          break;
                      case SINGLE:
<span class="line-modified">!                         quote = &quot;\&#39;&quot;;</span>
                          break;
                      default:
                          quote = &quot;&quot;;
                          break;
                  }
                  sb.append(quote);
<span class="line-modified">!                 node.getValue().stream().forEach((dt) -&gt; {</span>
<span class="line-removed">-                     dt.accept(this, null);</span>
<span class="line-removed">-                 });</span>
                  sb.append(quote);
                  return null;
              }
  
              @Override
<span class="line-new-header">--- 231,18 ---</span>
                  switch (node.getValueKind()) {
                      case DOUBLE:
                          quote = &quot;\&quot;&quot;;
                          break;
                      case SINGLE:
<span class="line-modified">!                         quote = &quot;&#39;&quot;;</span>
                          break;
                      default:
                          quote = &quot;&quot;;
                          break;
                  }
                  sb.append(quote);
<span class="line-modified">!                 node.getValue().forEach(dt -&gt; dt.accept(this, null));</span>
                  sb.append(quote);
                  return null;
              }
  
              @Override
</pre>
<hr />
<pre>
<span class="line-old-header">*** 254,13 ***</span>
                  if (node.getReference() == null) {
                      return null;
                  }
  
                  node.getReference().accept(this, null);
<span class="line-modified">!                 node.getLabel().stream().forEach((dt) -&gt; {</span>
<span class="line-removed">-                     dt.accept(this, null);</span>
<span class="line-removed">-                 });</span>
                  return null;
              }
  
              @Override
              public Void visitLiteral(LiteralTree node, Void p) {
<span class="line-new-header">--- 264,11 ---</span>
                  if (node.getReference() == null) {
                      return null;
                  }
  
                  node.getReference().accept(this, null);
<span class="line-modified">!                 node.getLabel().forEach(dt -&gt; dt.accept(this, null));</span>
                  return null;
              }
  
              @Override
              public Void visitLiteral(LiteralTree node, Void p) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 280,32 ***</span>
                  return null;
              }
  
              @Override
              public Void visitSee(SeeTree node, Void p) {
<span class="line-modified">!                 node.getReference().stream().forEach((dt) -&gt; {</span>
<span class="line-removed">-                     dt.accept(this, null);</span>
<span class="line-removed">-                 });</span>
                  return null;
              }
  
              @Override
              public Void visitSerial(SerialTree node, Void p) {
<span class="line-modified">!                 node.getDescription().stream().forEach((dt) -&gt; {</span>
<span class="line-removed">-                     dt.accept(this, null);</span>
<span class="line-removed">-                 });</span>
                  return null;
              }
  
              @Override
              public Void visitStartElement(StartElementTree node, Void p) {
                  sb.append(&quot;&lt;&quot;);
                  sb.append(node.getName());
<span class="line-modified">!                 node.getAttributes().stream().forEach((dt) -&gt; {</span>
<span class="line-modified">!                     dt.accept(this, null);</span>
<span class="line-removed">-                 });</span>
<span class="line-removed">-                 sb.append((node.isSelfClosing() ? &quot;/&gt;&quot; : &quot;&gt;&quot;));</span>
                  return null;
              }
  
              @Override
              public Void visitText(TextTree node, Void p) {
<span class="line-new-header">--- 288,26 ---</span>
                  return null;
              }
  
              @Override
              public Void visitSee(SeeTree node, Void p) {
<span class="line-modified">!                 node.getReference().forEach(dt -&gt; dt.accept(this, null));</span>
                  return null;
              }
  
              @Override
              public Void visitSerial(SerialTree node, Void p) {
<span class="line-modified">!                 node.getDescription().forEach(dt -&gt; dt.accept(this, null));</span>
                  return null;
              }
  
              @Override
              public Void visitStartElement(StartElementTree node, Void p) {
                  sb.append(&quot;&lt;&quot;);
                  sb.append(node.getName());
<span class="line-modified">!                 node.getAttributes().forEach(dt -&gt; dt.accept(this, null));</span>
<span class="line-modified">!                 sb.append(node.isSelfClosing() ? &quot;/&gt;&quot; : &quot;&gt;&quot;);</span>
                  return null;
              }
  
              @Override
              public Void visitText(TextTree node, Void p) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 313,13 ***</span>
                  return null;
              }
  
              @Override
              public Void visitUnknownBlockTag(UnknownBlockTagTree node, Void p) {
<span class="line-modified">!                 node.getContent().stream().forEach((dt) -&gt; {</span>
<span class="line-removed">-                     dt.accept(this, null);</span>
<span class="line-removed">-                 });</span>
                  return null;
              }
  
              @Override
              public Void visitValue(ValueTree node, Void p) {
<span class="line-new-header">--- 315,11 ---</span>
                  return null;
              }
  
              @Override
              public Void visitUnknownBlockTag(UnknownBlockTagTree node, Void p) {
<span class="line-modified">!                 node.getContent().forEach(dt -&gt; dt.accept(this, null));</span>
                  return null;
              }
  
              @Override
              public Void visitValue(ValueTree node, Void p) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 333,68 ***</span>
              }
          }.visit(dt, null);
          return sb;
      }
  
<span class="line-modified">!     public String getLabel(BaseConfiguration c, DocTree dtree) {</span>
          return new SimpleDocTreeVisitor&lt;String, Void&gt;() {
              @Override
              public String visitLink(LinkTree node, Void p) {
<span class="line-modified">!                 StringBuilder sb = new StringBuilder();</span>
<span class="line-modified">!                 node.getLabel().stream().forEach((dt) -&gt; {</span>
<span class="line-modified">!                     sb.append(getText(dt));</span>
<span class="line-removed">-                 });</span>
<span class="line-removed">-                 return sb.toString();</span>
              }
  
              @Override
              public String visitSee(SeeTree node, Void p) {
<span class="line-modified">!                 StringBuilder sb = new StringBuilder();</span>
<span class="line-modified">!                 node.getReference().stream().filter((dt) -&gt; (c.utils.isText(dt))).forEach((dt) -&gt; {</span>
<span class="line-modified">!                     sb.append(((TextTree)dt).getBody());</span>
<span class="line-modified">!                 });</span>
<span class="line-modified">!                 return sb.toString();</span>
              }
  
              @Override
              protected String defaultAction(DocTree node, Void p) {
                  return &quot;&quot;;
              }
          }.visit(dtree, null);
      }
  
<span class="line-modified">!     public TypeElement getReferencedClass(BaseConfiguration c, DocTree dtree) {</span>
<span class="line-modified">!         Element e = getReferencedElement(c, dtree);</span>
          if (e == null) {
              return null;
<span class="line-modified">!         } else if (c.utils.isTypeElement(e)) {</span>
              return (TypeElement) e;
<span class="line-modified">!         } else if (!c.utils.isPackage(e)) {</span>
<span class="line-modified">!             return c.utils.getEnclosingTypeElement(e);</span>
          }
          return null;
      }
  
<span class="line-modified">!     public String getReferencedClassName(BaseConfiguration c, DocTree dtree) {</span>
<span class="line-modified">!         Element e = getReferencedClass(c, dtree);</span>
          if (e != null) {
<span class="line-modified">!             return c.utils.isTypeElement(e) ? c.utils.getSimpleName(e) : null;</span>
          }
          String s = getReferencedSignature(dtree);
          if (s == null) {
              return null;
          }
          int n = s.indexOf(&quot;#&quot;);
          return (n == -1) ? s : s.substring(0, n);
      }
  
<span class="line-modified">!     public Element getReferencedMember(BaseConfiguration c, DocTree dtree) {</span>
<span class="line-modified">!         Element e = getReferencedElement(c, dtree);</span>
          if (e == null) {
              return null;
          }
<span class="line-modified">!         return (c.utils.isExecutableElement(e) || c.utils.isVariableElement(e)) ? e : null;</span>
      }
  
      public String getReferencedMemberName(DocTree dtree) {
          String s = getReferencedSignature(dtree);
          if (s == null) {
<span class="line-new-header">--- 333,69 ---</span>
              }
          }.visit(dt, null);
          return sb;
      }
  
<span class="line-modified">!     public String getLabel(DocTree dtree) {</span>
          return new SimpleDocTreeVisitor&lt;String, Void&gt;() {
              @Override
              public String visitLink(LinkTree node, Void p) {
<span class="line-modified">!                 return node.getLabel().stream()</span>
<span class="line-modified">!                         .map(dt -&gt; getText(dt))</span>
<span class="line-modified">!                         .collect(Collectors.joining());</span>
              }
  
              @Override
              public String visitSee(SeeTree node, Void p) {
<span class="line-modified">!                 Utils utils = configuration.utils;</span>
<span class="line-modified">!                 return node.getReference().stream()</span>
<span class="line-modified">!                         .filter(utils::isText)</span>
<span class="line-modified">!                         .map(dt -&gt; ((TextTree) dt).getBody())</span>
<span class="line-modified">!                         .collect(Collectors.joining());</span>
              }
  
              @Override
              protected String defaultAction(DocTree node, Void p) {
                  return &quot;&quot;;
              }
          }.visit(dtree, null);
      }
  
<span class="line-modified">!     public TypeElement getReferencedClass(DocTree dtree) {</span>
<span class="line-modified">!         Utils utils = configuration.utils;</span>
<span class="line-added">+         Element e = getReferencedElement(dtree);</span>
          if (e == null) {
              return null;
<span class="line-modified">!         } else if (utils.isTypeElement(e)) {</span>
              return (TypeElement) e;
<span class="line-modified">!         } else if (!utils.isPackage(e)) {</span>
<span class="line-modified">!             return utils.getEnclosingTypeElement(e);</span>
          }
          return null;
      }
  
<span class="line-modified">!     public String getReferencedClassName(DocTree dtree) {</span>
<span class="line-modified">!         Utils utils = configuration.utils;</span>
<span class="line-added">+         Element e = getReferencedClass(dtree);</span>
          if (e != null) {
<span class="line-modified">!             return utils.isTypeElement(e) ? utils.getSimpleName(e) : null;</span>
          }
          String s = getReferencedSignature(dtree);
          if (s == null) {
              return null;
          }
          int n = s.indexOf(&quot;#&quot;);
          return (n == -1) ? s : s.substring(0, n);
      }
  
<span class="line-modified">!     public Element getReferencedMember(DocTree dtree) {</span>
<span class="line-modified">!         Utils utils = configuration.utils;</span>
<span class="line-added">+         Element e = getReferencedElement(dtree);</span>
          if (e == null) {
              return null;
          }
<span class="line-modified">!         return (utils.isExecutableElement(e) || utils.isVariableElement(e)) ? e : null;</span>
      }
  
      public String getReferencedMemberName(DocTree dtree) {
          String s = getReferencedSignature(dtree);
          if (s == null) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 402,37 ***</span>
          }
          int n = s.indexOf(&quot;#&quot;);
          return (n == -1) ? null : s.substring(n + 1);
      }
  
<span class="line-modified">!     public String getReferencedMemberName(BaseConfiguration c, Element e) {</span>
          if (e == null) {
              return null;
          }
<span class="line-modified">!         return c.utils.isExecutableElement(e)</span>
<span class="line-modified">!                 ? c.utils.getSimpleName(e) + c.utils.makeSignature((ExecutableElement) e, true, true)</span>
<span class="line-modified">!                 : c.utils.getSimpleName(e);</span>
      }
  
<span class="line-modified">!     public PackageElement getReferencedPackage(BaseConfiguration c, DocTree dtree) {</span>
<span class="line-modified">!         Element e = getReferencedElement(c, dtree);</span>
          if (e != null) {
<span class="line-modified">!             return c.utils.containingPackage(e);</span>
          }
          return null;
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getFirstSentenceTrees(BaseConfiguration c, List&lt;? extends DocTree&gt; body) {</span>
<span class="line-modified">!         List&lt;DocTree&gt; firstSentence = c.docEnv.getDocTrees().getFirstSentence(body);</span>
<span class="line-removed">-         return firstSentence;</span>
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getFirstSentenceTrees(BaseConfiguration c, DocTree dtree) {</span>
<span class="line-modified">!         return getFirstSentenceTrees(c, getBody(c, dtree));</span>
      }
  
<span class="line-modified">!     private Element getReferencedElement(BaseConfiguration c, DocTree dtree) {</span>
          return new SimpleDocTreeVisitor&lt;Element, Void&gt;() {
              @Override
              public Element visitSee(SeeTree node, Void p) {
                  for (DocTree dt : node.getReference()) {
                      return visit(dt, null);
<span class="line-new-header">--- 403,38 ---</span>
          }
          int n = s.indexOf(&quot;#&quot;);
          return (n == -1) ? null : s.substring(n + 1);
      }
  
<span class="line-modified">!     public String getReferencedMemberName(Element e) {</span>
          if (e == null) {
              return null;
          }
<span class="line-modified">!         Utils utils = configuration.utils;</span>
<span class="line-modified">!         return utils.isExecutableElement(e)</span>
<span class="line-modified">!                 ? utils.getSimpleName(e) + utils.makeSignature((ExecutableElement) e, true, true)</span>
<span class="line-added">+                 : utils.getSimpleName(e);</span>
      }
  
<span class="line-modified">!     public PackageElement getReferencedPackage(DocTree dtree) {</span>
<span class="line-modified">!         Element e = getReferencedElement(dtree);</span>
          if (e != null) {
<span class="line-modified">!             Utils utils = configuration.utils;</span>
<span class="line-added">+             return utils.containingPackage(e);</span>
          }
          return null;
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getFirstSentenceTrees(List&lt;? extends DocTree&gt; body) {</span>
<span class="line-modified">!         return configuration.docEnv.getDocTrees().getFirstSentence(body);</span>
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getFirstSentenceTrees(DocTree dtree) {</span>
<span class="line-modified">!         return getFirstSentenceTrees(getBody(dtree));</span>
      }
  
<span class="line-modified">!     private Element getReferencedElement(DocTree dtree) {</span>
          return new SimpleDocTreeVisitor&lt;Element, Void&gt;() {
              @Override
              public Element visitSee(SeeTree node, Void p) {
                  for (DocTree dt : node.getReference()) {
                      return visit(dt, null);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 455,11 ***</span>
                  return visit(node.getReference(), null);
              }
  
              @Override
              public Element visitReference(ReferenceTree node, Void p) {
<span class="line-modified">!                 return getElement(c, node);</span>
              }
  
              @Override
              public Element visitSerialField(SerialFieldTree node, Void p) {
                  return visit(node.getType(), null);
<span class="line-new-header">--- 457,11 ---</span>
                  return visit(node.getReference(), null);
              }
  
              @Override
              public Element visitReference(ReferenceTree node, Void p) {
<span class="line-modified">!                 return getElement(node);</span>
              }
  
              @Override
              public Element visitSerialField(SerialFieldTree node, Void p) {
                  return visit(node.getType(), null);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 475,14 ***</span>
                 return null;
              }
          }.visit(dtree, null);
      }
  
<span class="line-modified">!     public TypeElement getServiceType(BaseConfiguration c, DocTree dtree) {</span>
<span class="line-modified">!         Element e = getReferencedElement(c, dtree);</span>
          if (e != null) {
<span class="line-modified">!             return c.utils.isTypeElement(e) ? (TypeElement) e : null;</span>
          }
          return null;
      }
  
      public  String getReferencedSignature(DocTree dtree) {
<span class="line-new-header">--- 477,15 ---</span>
                 return null;
              }
          }.visit(dtree, null);
      }
  
<span class="line-modified">!     public TypeElement getServiceType(DocTree dtree) {</span>
<span class="line-modified">!         Element e = getReferencedElement(dtree);</span>
          if (e != null) {
<span class="line-modified">!             Utils utils = configuration.utils;</span>
<span class="line-added">+             return utils.isTypeElement(e) ? (TypeElement) e : null;</span>
          }
          return null;
      }
  
      public  String getReferencedSignature(DocTree dtree) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 541,15 ***</span>
              default:
                  return null;
              }
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getTags(BaseConfiguration c, DocTree dtree) {</span>
          return new SimpleDocTreeVisitor&lt;List&lt;? extends DocTree&gt;, Void&gt;() {
              List&lt;? extends DocTree&gt; asList(String content) {
                  List&lt;DocTree&gt; out = new ArrayList&lt;&gt;();
<span class="line-modified">!                 out.add((TextTree)c.cmtUtils.makeTextTree(content));</span>
                  return out;
              }
  
              @Override
              public List&lt;? extends DocTree&gt; visitAuthor(AuthorTree node, Void p) {
<span class="line-new-header">--- 544,15 ---</span>
              default:
                  return null;
              }
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getTags(DocTree dtree) {</span>
          return new SimpleDocTreeVisitor&lt;List&lt;? extends DocTree&gt;, Void&gt;() {
              List&lt;? extends DocTree&gt; asList(String content) {
                  List&lt;DocTree&gt; out = new ArrayList&lt;&gt;();
<span class="line-modified">!                 out.add(configuration.cmtUtils.makeTextTree(content));</span>
                  return out;
              }
  
              @Override
              public List&lt;? extends DocTree&gt; visitAuthor(AuthorTree node, Void p) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 646,40 ***</span>
                 return Collections.emptyList();
              }
          }.visit(dtree, null);
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getBody(BaseConfiguration c, DocTree dtree) {</span>
<span class="line-modified">!         return getTags(c, dtree);</span>
      }
  
      public ReferenceTree getType(DocTree dtree) {
          if (dtree.getKind() == SERIAL_FIELD) {
<span class="line-modified">!             return ((SerialFieldTree)dtree).getType();</span>
          } else {
              return null;
          }
      }
  
      public DocTreePath getDocTreePath(DocTree dtree) {
<span class="line-modified">!         if (path == null || dctree == null || dtree == null)</span>
              return null;
<span class="line-modified">!         return DocTreePath.getPath(path, dctree, dtree);</span>
      }
  
      public Element getOverriddenElement() {
          return overriddenElement;
      }
  
<span class="line-removed">- </span>
      /**
       * For debugging purposes only. Do not rely on this for other things.
       * @return a string representation.
       */
      @Override
      public String toString() {
<span class="line-modified">!         StringBuilder sb = new StringBuilder(&quot;CommentHelper{&quot; + &quot;path=&quot; + path + &quot;, dctree=&quot; + dctree);</span>
          sb.append(&quot;, element=&quot;);
          sb.append(element.getEnclosingElement());
          sb.append(&quot;::&quot;);
          sb.append(element);
          sb.append(&quot;, overriddenElement=&quot;);
<span class="line-new-header">--- 649,39 ---</span>
                 return Collections.emptyList();
              }
          }.visit(dtree, null);
      }
  
<span class="line-modified">!     public List&lt;? extends DocTree&gt; getBody(DocTree dtree) {</span>
<span class="line-modified">!         return getTags(dtree);</span>
      }
  
      public ReferenceTree getType(DocTree dtree) {
          if (dtree.getKind() == SERIAL_FIELD) {
<span class="line-modified">!             return ((SerialFieldTree) dtree).getType();</span>
          } else {
              return null;
          }
      }
  
      public DocTreePath getDocTreePath(DocTree dtree) {
<span class="line-modified">!         if (path == null || dcTree == null || dtree == null)</span>
              return null;
<span class="line-modified">!         return DocTreePath.getPath(path, dcTree, dtree);</span>
      }
  
      public Element getOverriddenElement() {
          return overriddenElement;
      }
  
      /**
       * For debugging purposes only. Do not rely on this for other things.
       * @return a string representation.
       */
      @Override
      public String toString() {
<span class="line-modified">!         StringBuilder sb = new StringBuilder(&quot;CommentHelper{&quot; + &quot;path=&quot; + path + &quot;, dcTree=&quot; + dcTree);</span>
          sb.append(&quot;, element=&quot;);
          sb.append(element.getEnclosingElement());
          sb.append(&quot;::&quot;);
          sb.append(element);
          sb.append(&quot;, overriddenElement=&quot;);
</pre>
<center><a href="ClassUseMapper.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DeprecatedAPIListBuilder.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>