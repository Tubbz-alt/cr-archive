<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/ClassBuilder.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="BuilderFactory.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="ConstantsSummaryBuilder.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/ClassBuilder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 23,14 ***</span>
<span class="line-new-header">--- 23,25 ---</span>
   * questions.
   */
  
  package jdk.javadoc.internal.doclets.toolkit.builders;
  
<span class="line-added">+ import java.util.List;</span>
<span class="line-added">+ import java.util.Set;</span>
<span class="line-added">+ import java.util.stream.Collectors;</span>
<span class="line-added">+ </span>
<span class="line-added">+ import javax.lang.model.element.Element;</span>
<span class="line-added">+ import javax.lang.model.element.ExecutableElement;</span>
<span class="line-added">+ import javax.lang.model.element.Name;</span>
  import javax.lang.model.element.PackageElement;
  import javax.lang.model.element.TypeElement;
<span class="line-added">+ import javax.lang.model.element.VariableElement;</span>
<span class="line-added">+ import javax.lang.model.type.TypeMirror;</span>
  
<span class="line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;</span>
  import jdk.javadoc.internal.doclets.toolkit.ClassWriter;
<span class="line-added">+ import jdk.javadoc.internal.doclets.toolkit.CommentUtils;</span>
  import jdk.javadoc.internal.doclets.toolkit.Content;
  import jdk.javadoc.internal.doclets.toolkit.DocFilesHandler;
  import jdk.javadoc.internal.doclets.toolkit.DocletException;
  import jdk.javadoc.internal.doclets.toolkit.util.DocFileIOException;
  import jdk.javadoc.internal.doclets.toolkit.util.Utils;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 40,13 ***</span>
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
<span class="line-removed">-  *</span>
<span class="line-removed">-  * @author Jamie Ho</span>
<span class="line-removed">-  * @author Bhavesh Patel (Modified)</span>
   */
  public class ClassBuilder extends AbstractBuilder {
  
      /**
       * The class being documented.
<span class="line-new-header">--- 51,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 66,10 ***</span>
<span class="line-new-header">--- 74,15 ---</span>
      /**
       * Keep track of whether or not this typeElement is an enum.
       */
      private final boolean isEnum;
  
<span class="line-added">+     /**</span>
<span class="line-added">+      * Keep track of whether or not this typeElement is a record.</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private final boolean isRecord;</span>
<span class="line-added">+ </span>
      /**
       * The content tree for the class documentation.
       */
      private Content contentTree;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 88,17 ***</span>
          this.writer = writer;
          this.utils = configuration.utils;
          if (utils.isInterface(typeElement)) {
              isInterface = true;
              isEnum = false;
          } else if (utils.isEnum(typeElement)) {
              isInterface = false;
              isEnum = true;
<span class="line-modified">!             utils.setEnumDocumentation(typeElement);</span>
          } else {
              isInterface = false;
              isEnum = false;
          }
      }
  
      /**
       * Constructs a new ClassBuilder.
<span class="line-new-header">--- 101,25 ---</span>
          this.writer = writer;
          this.utils = configuration.utils;
          if (utils.isInterface(typeElement)) {
              isInterface = true;
              isEnum = false;
<span class="line-added">+             isRecord = false;</span>
          } else if (utils.isEnum(typeElement)) {
              isInterface = false;
              isEnum = true;
<span class="line-modified">!             isRecord = false;</span>
<span class="line-added">+             setEnumDocumentation(typeElement);</span>
<span class="line-added">+         } else if (utils.isRecord(typeElement)) {</span>
<span class="line-added">+             isInterface = false;</span>
<span class="line-added">+             isEnum = false;</span>
<span class="line-added">+             isRecord = true;</span>
<span class="line-added">+             setRecordDocumentation(typeElement);</span>
          } else {
              isInterface = false;
              isEnum = false;
<span class="line-added">+             isRecord = false;</span>
          }
      }
  
      /**
       * Constructs a new ClassBuilder.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 110,44 ***</span>
       */
      public static ClassBuilder getInstance(Context context, TypeElement typeElement, ClassWriter writer) {
          return new ClassBuilder(context, typeElement, writer);
      }
  
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      @Override
      public void build() throws DocletException {
<span class="line-modified">!         buildClassDoc(contentTree);</span>
      }
  
       /**
        * Handles the {@literal &lt;TypeElement&gt;} tag.
        *
<span class="line-removed">-       * @param contentTree the content tree to which the documentation will be added</span>
        * @throws DocletException if there is a problem while building the documentation
        */
<span class="line-modified">!      protected void buildClassDoc(Content contentTree) throws DocletException {</span>
          String key;
          if (isInterface) {
              key = &quot;doclet.Interface&quot;;
          } else if (isEnum) {
              key = &quot;doclet.Enum&quot;;
          } else {
              key = &quot;doclet.Class&quot;;
          }
<span class="line-modified">!         contentTree = writer.getHeader(resources.getText(key) + &quot; &quot;</span>
                  + utils.getSimpleName(typeElement));
          Content classContentTree = writer.getClassContentHeader();
  
          buildClassTree(classContentTree);
          buildClassInfo(classContentTree);
          buildMemberSummary(classContentTree);
          buildMemberDetails(classContentTree);
  
<span class="line-modified">!         writer.addClassContentTree(contentTree, classContentTree);</span>
<span class="line-modified">!         writer.addFooter(contentTree);</span>
          writer.printDocument(contentTree);
          copyDocFiles();
      }
  
       /**
<span class="line-new-header">--- 131,42 ---</span>
       */
      public static ClassBuilder getInstance(Context context, TypeElement typeElement, ClassWriter writer) {
          return new ClassBuilder(context, typeElement, writer);
      }
  
      @Override
      public void build() throws DocletException {
<span class="line-modified">!         buildClassDoc();</span>
      }
  
       /**
        * Handles the {@literal &lt;TypeElement&gt;} tag.
        *
        * @throws DocletException if there is a problem while building the documentation
        */
<span class="line-modified">!      protected void buildClassDoc() throws DocletException {</span>
          String key;
          if (isInterface) {
              key = &quot;doclet.Interface&quot;;
          } else if (isEnum) {
              key = &quot;doclet.Enum&quot;;
<span class="line-added">+         } else if (isRecord) {</span>
<span class="line-added">+             key = &quot;doclet.Record&quot;;</span>
          } else {
              key = &quot;doclet.Class&quot;;
          }
<span class="line-modified">!         Content contentTree = writer.getHeader(resources.getText(key) + &quot; &quot;</span>
                  + utils.getSimpleName(typeElement));
          Content classContentTree = writer.getClassContentHeader();
  
          buildClassTree(classContentTree);
          buildClassInfo(classContentTree);
          buildMemberSummary(classContentTree);
          buildMemberDetails(classContentTree);
  
<span class="line-modified">!         writer.addClassContentTree(classContentTree);</span>
<span class="line-modified">!         writer.addFooter();</span>
          writer.printDocument(contentTree);
          copyDocFiles();
      }
  
       /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 164,13 ***</span>
       *
       * @param classContentTree the content tree to which the documentation will be added
       * @throws DocletException if there is a problem while building the documentation
       */
      protected void buildClassInfo(Content classContentTree) throws DocletException {
<span class="line-modified">!         Content classInfoTree = writer.getClassInfoTreeHeader();</span>
<span class="line-modified">! </span>
<span class="line-removed">-         buildTypeParamInfo(classInfoTree);</span>
          buildSuperInterfacesInfo(classInfoTree);
          buildImplementedInterfacesInfo(classInfoTree);
          buildSubClassInfo(classInfoTree);
          buildSubInterfacesInfo(classInfoTree);
          buildInterfaceUsageInfo(classInfoTree);
<span class="line-new-header">--- 183,12 ---</span>
       *
       * @param classContentTree the content tree to which the documentation will be added
       * @throws DocletException if there is a problem while building the documentation
       */
      protected void buildClassInfo(Content classContentTree) throws DocletException {
<span class="line-modified">!         Content classInfoTree = new ContentBuilder();</span>
<span class="line-modified">!         buildParamInfo(classInfoTree);</span>
          buildSuperInterfacesInfo(classInfoTree);
          buildImplementedInterfacesInfo(classInfoTree);
          buildSubClassInfo(classInfoTree);
          buildSubInterfacesInfo(classInfoTree);
          buildInterfaceUsageInfo(classInfoTree);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 183,16 ***</span>
  
          classContentTree.add(writer.getClassInfo(classInfoTree));
      }
  
      /**
<span class="line-modified">!      * Build the type parameters of this class.</span>
       *
       * @param classInfoTree the content tree to which the documentation will be added
       */
<span class="line-modified">!     protected void buildTypeParamInfo(Content classInfoTree) {</span>
<span class="line-modified">!         writer.addTypeParamInfo(classInfoTree);</span>
      }
  
      /**
       * If this is an interface, list all super interfaces.
       *
<span class="line-new-header">--- 201,16 ---</span>
  
          classContentTree.add(writer.getClassInfo(classInfoTree));
      }
  
      /**
<span class="line-modified">!      * Build the type parameters and state components of this class.</span>
       *
       * @param classInfoTree the content tree to which the documentation will be added
       */
<span class="line-modified">!     protected void buildParamInfo(Content classInfoTree) {</span>
<span class="line-modified">!         writer.addParamInfo(classInfoTree);</span>
      }
  
      /**
       * If this is an interface, list all super interfaces.
       *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 390,6 ***</span>
<span class="line-new-header">--- 408,98 ---</span>
       * @throws DocletException if there is a problem while building the documentation
       */
      protected void buildMethodDetails(Content memberDetailsTree) throws DocletException {
          builderFactory.getMethodBuilder(writer).build(memberDetailsTree);
      }
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * The documentation for values() and valueOf() in Enums are set by the</span>
<span class="line-added">+      * doclet only iff the user or overridden methods are missing.</span>
<span class="line-added">+      * @param elem the enum element</span>
<span class="line-added">+      */</span>
<span class="line-added">+     private void setEnumDocumentation(TypeElement elem) {</span>
<span class="line-added">+         CommentUtils cmtUtils = configuration.cmtUtils;</span>
<span class="line-added">+         for (ExecutableElement ee : utils.getMethods(elem)) {</span>
<span class="line-added">+             if (!utils.getFullBody(ee).isEmpty()) // ignore if already set</span>
<span class="line-added">+                 continue;</span>
<span class="line-added">+             Name name = ee.getSimpleName();</span>
<span class="line-added">+             if (name.contentEquals(&quot;values&quot;) &amp;&amp; ee.getParameters().isEmpty()) {</span>
<span class="line-added">+                 utils.removeCommentHelper(ee); // purge previous entry</span>
<span class="line-added">+                 cmtUtils.setEnumValuesTree(ee);</span>
<span class="line-added">+             } else if (name.contentEquals(&quot;valueOf&quot;) &amp;&amp; ee.getParameters().size() == 1) {</span>
<span class="line-added">+                 // TODO: check parameter type</span>
<span class="line-added">+                 utils.removeCommentHelper(ee); // purge previous entry</span>
<span class="line-added">+                 cmtUtils.setEnumValueOfTree(ee);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * Sets the documentation as needed for the mandated parts of a record type.</span>
<span class="line-added">+      * This includes the canonical constructor, methods like {@code equals},</span>
<span class="line-added">+      * {@code hashCode}, {@code toString}, the accessor methods, and the underlying</span>
<span class="line-added">+      * field.</span>
<span class="line-added">+      * @param elem the record element</span>
<span class="line-added">+      */</span>
<span class="line-added">+ </span>
<span class="line-added">+     @SuppressWarnings(&quot;preview&quot;)</span>
<span class="line-added">+     private void setRecordDocumentation(TypeElement elem) {</span>
<span class="line-added">+         CommentUtils cmtUtils = configuration.cmtUtils;</span>
<span class="line-added">+         Set&lt;Name&gt; componentNames = elem.getRecordComponents().stream()</span>
<span class="line-added">+                 .map(Element::getSimpleName)</span>
<span class="line-added">+                 .collect(Collectors.toSet());</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (ExecutableElement ee : utils.getConstructors(elem)) {</span>
<span class="line-added">+             if (utils.isCanonicalRecordConstructor(ee)) {</span>
<span class="line-added">+                 if (utils.getFullBody(ee).isEmpty()) {</span>
<span class="line-added">+                     utils.removeCommentHelper(ee); // purge previous entry</span>
<span class="line-added">+                     cmtUtils.setRecordConstructorTree(ee);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 // only one canonical constructor; no need to keep looking</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (VariableElement ve : utils.getFields(elem)) {</span>
<span class="line-added">+             // The fields for the record component cannot be declared by the</span>
<span class="line-added">+             // user and so cannot have any pre-existing comment.</span>
<span class="line-added">+             Name name = ve.getSimpleName();</span>
<span class="line-added">+             if (componentNames.contains(name)) {</span>
<span class="line-added">+                 utils.removeCommentHelper(ve); // purge previous entry</span>
<span class="line-added">+                 cmtUtils.setRecordFieldTree(ve);</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         TypeMirror objectType = utils.getObjectType();</span>
<span class="line-added">+ </span>
<span class="line-added">+         for (ExecutableElement ee : utils.getMethods(elem)) {</span>
<span class="line-added">+             if (!utils.getFullBody(ee).isEmpty()) {</span>
<span class="line-added">+                 continue;</span>
<span class="line-added">+             }</span>
<span class="line-added">+ </span>
<span class="line-added">+             Name name = ee.getSimpleName();</span>
<span class="line-added">+             List&lt;? extends VariableElement&gt; params = ee.getParameters();</span>
<span class="line-added">+             if (name.contentEquals(&quot;equals&quot;)) {</span>
<span class="line-added">+                 if (params.size() == 1 &amp;&amp; utils.typeUtils.isSameType(params.get(0).asType(), objectType)) {</span>
<span class="line-added">+                     utils.removeCommentHelper(ee); // purge previous entry</span>
<span class="line-added">+                     cmtUtils.setRecordEqualsTree(ee);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             } else if (name.contentEquals(&quot;hashCode&quot;)) {</span>
<span class="line-added">+                 if (params.isEmpty()) {</span>
<span class="line-added">+                     utils.removeCommentHelper(ee); // purge previous entry</span>
<span class="line-added">+                     cmtUtils.setRecordHashCodeTree(ee);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             } else if (name.contentEquals(&quot;toString&quot;)) {</span>
<span class="line-added">+                 if (params.isEmpty()) {</span>
<span class="line-added">+                     utils.removeCommentHelper(ee); // purge previous entry</span>
<span class="line-added">+                     cmtUtils.setRecordToStringTree(ee);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             } else if (componentNames.contains(name)) {</span>
<span class="line-added">+                 if (params.isEmpty()) {</span>
<span class="line-added">+                     utils.removeCommentHelper(ee); // purge previous entry</span>
<span class="line-added">+                     cmtUtils.setRecordAccessorTree(ee);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+     }</span>
  }
</pre>
<center><a href="BuilderFactory.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="ConstantsSummaryBuilder.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>