<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/DeprecatedListWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.formats.html;
 27 
 28 import jdk.javadoc.internal.doclets.formats.html.markup.Table;
 29 import jdk.javadoc.internal.doclets.formats.html.markup.TableHeader;
 30 
 31 import java.util.EnumMap;
 32 import java.util.List;
 33 import java.util.SortedSet;
 34 
 35 import javax.lang.model.element.Element;
 36 import javax.lang.model.element.ModuleElement;
 37 import javax.lang.model.element.PackageElement;
 38 
 39 import com.sun.source.doctree.DocTree;
 40 import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;
 41 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
 42 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
 43 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
 44 import jdk.javadoc.internal.doclets.formats.html.markup.Navigation;
 45 import jdk.javadoc.internal.doclets.formats.html.markup.Navigation.PageMode;
 46 import jdk.javadoc.internal.doclets.formats.html.markup.StringContent;
 47 import jdk.javadoc.internal.doclets.toolkit.Content;
 48 import jdk.javadoc.internal.doclets.toolkit.util.DeprecatedAPIListBuilder;
 49 import jdk.javadoc.internal.doclets.toolkit.util.DeprecatedAPIListBuilder.DeprElementKind;
 50 import jdk.javadoc.internal.doclets.toolkit.util.DocFileIOException;
 51 import jdk.javadoc.internal.doclets.toolkit.util.DocPath;
 52 import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
 53 
 54 /**
 55  * Generate File to list all the deprecated classes and class members with the
 56  * appropriate links.
 57  *
 58  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 59  *  If you write code that depends on this, you do so at your own risk.
 60  *  This code and its internal interfaces are subject to change or
 61  *  deletion without notice.&lt;/b&gt;
 62  *
 63  * @see java.util.List
<a name="2" id="anc2"></a><span class="line-removed"> 64  * @author Atul M Dambalkar</span>
<span class="line-removed"> 65  * @author Bhavesh Patel (Modified)</span>
 66  */
 67 public class DeprecatedListWriter extends SubWriterHolderWriter {
 68 
 69     private String getAnchorName(DeprElementKind kind) {
 70         switch (kind) {
 71             case REMOVAL:
 72                 return &quot;forRemoval&quot;;
 73             case MODULE:
 74                 return &quot;module&quot;;
 75             case PACKAGE:
 76                 return &quot;package&quot;;
 77             case INTERFACE:
 78                 return &quot;interface&quot;;
 79             case CLASS:
 80                 return &quot;class&quot;;
 81             case ENUM:
 82                 return &quot;enum&quot;;
 83             case EXCEPTION:
 84                 return &quot;exception&quot;;
 85             case ERROR:
 86                 return &quot;error&quot;;
 87             case ANNOTATION_TYPE:
 88                 return &quot;annotation.type&quot;;
 89             case FIELD:
 90                 return &quot;field&quot;;
 91             case METHOD:
 92                 return &quot;method&quot;;
 93             case CONSTRUCTOR:
 94                 return &quot;constructor&quot;;
 95             case ENUM_CONSTANT:
 96                 return &quot;enum.constant&quot;;
 97             case ANNOTATION_TYPE_MEMBER:
 98                 return &quot;annotation.type.member&quot;;
 99             default:
100                 throw new AssertionError(&quot;unknown kind: &quot; + kind);
101         }
102     }
103 
104     private String getHeadingKey(DeprElementKind kind) {
105         switch (kind) {
106             case REMOVAL:
107                 return &quot;doclet.For_Removal&quot;;
108             case MODULE:
109                 return &quot;doclet.Modules&quot;;
110             case PACKAGE:
111                 return &quot;doclet.Packages&quot;;
112             case INTERFACE:
113                 return &quot;doclet.Interfaces&quot;;
114             case CLASS:
115                 return &quot;doclet.Classes&quot;;
116             case ENUM:
117                 return &quot;doclet.Enums&quot;;
118             case EXCEPTION:
119                 return &quot;doclet.Exceptions&quot;;
120             case ERROR:
121                 return &quot;doclet.Errors&quot;;
122             case ANNOTATION_TYPE:
123                 return &quot;doclet.Annotation_Types&quot;;
124             case FIELD:
125                 return &quot;doclet.Fields&quot;;
126             case METHOD:
127                 return &quot;doclet.Methods&quot;;
128             case CONSTRUCTOR:
129                 return &quot;doclet.Constructors&quot;;
130             case ENUM_CONSTANT:
131                 return &quot;doclet.Enum_Constants&quot;;
132             case ANNOTATION_TYPE_MEMBER:
133                 return &quot;doclet.Annotation_Type_Members&quot;;
134             default:
135                 throw new AssertionError(&quot;unknown kind: &quot; + kind);
136         }
137     }
138 
139     private String getSummaryKey(DeprElementKind kind) {
140         switch (kind) {
141             case REMOVAL:
142                 return &quot;doclet.for_removal&quot;;
143             case MODULE:
144                 return &quot;doclet.modules&quot;;
145             case PACKAGE:
146                 return &quot;doclet.packages&quot;;
147             case INTERFACE:
148                 return &quot;doclet.interfaces&quot;;
149             case CLASS:
150                 return &quot;doclet.classes&quot;;
151             case ENUM:
152                 return &quot;doclet.enums&quot;;
153             case EXCEPTION:
154                 return &quot;doclet.exceptions&quot;;
155             case ERROR:
156                 return &quot;doclet.errors&quot;;
157             case ANNOTATION_TYPE:
158                 return &quot;doclet.annotation_types&quot;;
159             case FIELD:
160                 return &quot;doclet.fields&quot;;
161             case METHOD:
162                 return &quot;doclet.methods&quot;;
163             case CONSTRUCTOR:
164                 return &quot;doclet.constructors&quot;;
165             case ENUM_CONSTANT:
166                 return &quot;doclet.enum_constants&quot;;
167             case ANNOTATION_TYPE_MEMBER:
168                 return &quot;doclet.annotation_type_members&quot;;
169             default:
170                 throw new AssertionError(&quot;unknown kind: &quot; + kind);
171         }
172     }
173 
174     private String getHeaderKey(DeprElementKind kind) {
175         switch (kind) {
176             case REMOVAL:
177                 return &quot;doclet.Element&quot;;
178             case MODULE:
179                 return &quot;doclet.Module&quot;;
180             case PACKAGE:
181                 return &quot;doclet.Package&quot;;
182             case INTERFACE:
183                 return &quot;doclet.Interface&quot;;
184             case CLASS:
185                 return &quot;doclet.Class&quot;;
186             case ENUM:
187                 return &quot;doclet.Enum&quot;;
188             case EXCEPTION:
189                 return &quot;doclet.Exceptions&quot;;
190             case ERROR:
191                 return &quot;doclet.Errors&quot;;
192             case ANNOTATION_TYPE:
193                 return &quot;doclet.AnnotationType&quot;;
194             case FIELD:
195                 return &quot;doclet.Field&quot;;
196             case METHOD:
197                 return &quot;doclet.Method&quot;;
198             case CONSTRUCTOR:
199                 return &quot;doclet.Constructor&quot;;
200             case ENUM_CONSTANT:
201                 return &quot;doclet.Enum_Constant&quot;;
202             case ANNOTATION_TYPE_MEMBER:
203                 return &quot;doclet.Annotation_Type_Member&quot;;
204             default:
205                 throw new AssertionError(&quot;unknown kind: &quot; + kind);
206         }
207     }
208 
209     private EnumMap&lt;DeprElementKind, AbstractMemberWriter&gt; writerMap;
210 
211     private HtmlConfiguration configuration;
212 
213     private final Navigation navBar;
214 
215     /**
216      * Constructor.
217      *
218      * @param configuration the configuration for this doclet
219      * @param filename the file to be generated
220      */
221 
222     public DeprecatedListWriter(HtmlConfiguration configuration, DocPath filename) {
223         super(configuration, filename);
224         this.configuration = configuration;
<a name="3" id="anc3"></a><span class="line-modified">225         this.navBar = new Navigation(null, configuration, fixedNavDiv, PageMode.DEPRECATED, path);</span>
226         NestedClassWriterImpl classW = new NestedClassWriterImpl(this);
227         writerMap = new EnumMap&lt;&gt;(DeprElementKind.class);
228         for (DeprElementKind kind : DeprElementKind.values()) {
229             switch (kind) {
230                 case REMOVAL:
231                 case MODULE:
232                 case PACKAGE:
233                 case INTERFACE:
234                 case CLASS:
235                 case ENUM:
236                 case EXCEPTION:
237                 case ERROR:
238                 case ANNOTATION_TYPE:
239                     writerMap.put(kind, classW);
240                     break;
241                 case FIELD:
242                     writerMap.put(kind, new FieldWriterImpl(this));
243                     break;
244                 case METHOD:
245                     writerMap.put(kind, new MethodWriterImpl(this));
246                     break;
247                 case CONSTRUCTOR:
248                     writerMap.put(kind, new ConstructorWriterImpl(this));
249                     break;
250                 case ENUM_CONSTANT:
251                     writerMap.put(kind, new EnumConstantWriterImpl(this));
252                     break;
253                 case ANNOTATION_TYPE_MEMBER:
254                     writerMap.put(kind, new AnnotationTypeOptionalMemberWriterImpl(this, null));
255                     break;
256                 default:
257                    throw new AssertionError(&quot;unknown kind: &quot; + kind);
258             }
259         }
260     }
261 
262     /**
263      * Get list of all the deprecated classes and members in all the Packages
<a name="4" id="anc4"></a><span class="line-modified">264      * specified on the Command Line.</span>
265      * Then instantiate DeprecatedListWriter and generate File.
266      *
267      * @param configuration the current configuration of the doclet.
268      * @throws DocFileIOException if there is a problem writing the deprecated list
269      */
270     public static void generate(HtmlConfiguration configuration) throws DocFileIOException {
271         DocPath filename = DocPaths.DEPRECATED_LIST;
272         DeprecatedListWriter depr = new DeprecatedListWriter(configuration, filename);
273         depr.generateDeprecatedListFile(
274                new DeprecatedAPIListBuilder(configuration));
275     }
276 
277     /**
278      * Generate the deprecated API list.
279      *
280      * @param deprapi list of deprecated API built already.
281      * @throws DocFileIOException if there is a problem writing the deprecated list
282      */
283     protected void generateDeprecatedListFile(DeprecatedAPIListBuilder deprapi)
284             throws DocFileIOException {
285         HtmlTree body = getHeader();
<a name="5" id="anc5"></a><span class="line-modified">286         HtmlTree htmlTree = HtmlTree.MAIN();</span>
<span class="line-removed">287         htmlTree.add(getContentsList(deprapi));</span>
288         String memberTableSummary;
289         HtmlTree div = new HtmlTree(HtmlTag.DIV);
290         div.setStyle(HtmlStyle.contentContainer);
291         for (DeprElementKind kind : DeprElementKind.values()) {
292             if (deprapi.hasDocumentation(kind)) {
<a name="6" id="anc6"></a><span class="line-removed">293                 addAnchor(deprapi, kind, div);</span>
294                 memberTableSummary = resources.getText(&quot;doclet.Member_Table_Summary&quot;,
295                         resources.getText(getHeadingKey(kind)),
296                         resources.getText(getSummaryKey(kind)));
297                 TableHeader memberTableHeader = new TableHeader(
298                         contents.getContent(getHeaderKey(kind)), contents.descriptionLabel);
<a name="7" id="anc7"></a><span class="line-modified">299                 addDeprecatedAPI(deprapi.getSet(kind),</span>
300                             getHeadingKey(kind), memberTableSummary, memberTableHeader, div);
301             }
302         }
<a name="8" id="anc8"></a><span class="line-modified">303         htmlTree.add(div);</span>
<span class="line-modified">304         body.add(htmlTree);</span>
<span class="line-removed">305         htmlTree = HtmlTree.FOOTER();</span>
306         navBar.setUserFooter(getUserHeaderFooter(false));
307         htmlTree.add(navBar.getContent(false));
308         addBottom(htmlTree);
<a name="9" id="anc9"></a><span class="line-modified">309         body.add(htmlTree);</span>
310         String description = &quot;deprecated elements&quot;;
<a name="10" id="anc10"></a>
311         printHtmlDocument(null, description, body);
312     }
313 
314     /**
315      * Add the index link.
316      *
317      * @param builder the deprecated list builder
<a name="11" id="anc11"></a><span class="line-modified">318      * @param type the type of list being documented</span>
319      * @param contentTree the content tree to which the index link will be added
320      */
321     private void addIndexLink(DeprecatedAPIListBuilder builder,
322             DeprElementKind kind, Content contentTree) {
323         if (builder.hasDocumentation(kind)) {
324             Content li = HtmlTree.LI(links.createLink(getAnchorName(kind),
325                     contents.getContent(getHeadingKey(kind))));
326             contentTree.add(li);
327         }
328     }
329 
330     /**
331      * Get the contents list.
332      *
333      * @param deprapi the deprecated list builder
334      * @return a content tree for the contents list
335      */
336     public Content getContentsList(DeprecatedAPIListBuilder deprapi) {
337         Content headContent = contents.deprecatedAPI;
338         Content heading = HtmlTree.HEADING(Headings.PAGE_TITLE_HEADING, true,
339                 HtmlStyle.title, headContent);
340         Content div = HtmlTree.DIV(HtmlStyle.header, heading);
341         Content headingContent = contents.contentsHeading;
342         div.add(HtmlTree.HEADING(Headings.CONTENT_HEADING, true,
343                 headingContent));
344         Content ul = new HtmlTree(HtmlTag.UL);
345         for (DeprElementKind kind : DeprElementKind.values()) {
346             addIndexLink(deprapi, kind, ul);
347         }
348         div.add(ul);
349         return div;
350     }
351 
<a name="12" id="anc12"></a><span class="line-removed">352     /**</span>
<span class="line-removed">353      * Add the anchor.</span>
<span class="line-removed">354      *</span>
<span class="line-removed">355      * @param builder the deprecated list builder</span>
<span class="line-removed">356      * @param type the type of list being documented</span>
<span class="line-removed">357      * @param htmlTree the content tree to which the anchor will be added</span>
<span class="line-removed">358      */</span>
<span class="line-removed">359     private void addAnchor(DeprecatedAPIListBuilder builder, DeprElementKind kind, Content htmlTree) {</span>
<span class="line-removed">360         if (builder.hasDocumentation(kind)) {</span>
<span class="line-removed">361             htmlTree.add(links.createAnchor(getAnchorName(kind)));</span>
<span class="line-removed">362         }</span>
<span class="line-removed">363     }</span>
<span class="line-removed">364 </span>
365     /**
366      * Get the header for the deprecated API Listing.
367      *
368      * @return a content tree for the header
369      */
370     public HtmlTree getHeader() {
371         String title = resources.getText(&quot;doclet.Window_Deprecated_List&quot;);
<a name="13" id="anc13"></a><span class="line-modified">372         HtmlTree bodyTree = getBody(true, getWindowTitle(title));</span>
<span class="line-modified">373         HtmlTree htmlTree = HtmlTree.HEADER();</span>
<span class="line-modified">374         addTop(htmlTree);</span>
375         navBar.setUserHeader(getUserHeaderFooter(true));
<a name="14" id="anc14"></a><span class="line-modified">376         htmlTree.add(navBar.getContent(true));</span>
<span class="line-modified">377         bodyTree.add(htmlTree);</span>
378         return bodyTree;
379     }
380 
381     /**
382      * Add deprecated information to the documentation tree
383      *
384      * @param deprList list of deprecated API elements
<a name="15" id="anc15"></a>
385      * @param headingKey the caption for the deprecated table
386      * @param tableSummary the summary for the deprecated table
387      * @param tableHeader table headers for the deprecated table
388      * @param contentTree the content tree to which the deprecated table will be added
389      */
<a name="16" id="anc16"></a><span class="line-modified">390     protected void addDeprecatedAPI(SortedSet&lt;Element&gt; deprList, String headingKey,</span>
391             String tableSummary, TableHeader tableHeader, Content contentTree) {
392         if (deprList.size() &gt; 0) {
393             Content caption = contents.getContent(headingKey);
394             Table table = new Table(HtmlStyle.deprecatedSummary)
395                     .setCaption(caption)
396                     .setHeader(tableHeader)
<a name="17" id="anc17"></a>
397                     .setColumnStyles(HtmlStyle.colDeprecatedItemName, HtmlStyle.colLast);
398             for (Element e : deprList) {
399                 Content link;
400                 switch (e.getKind()) {
401                     case MODULE:
402                         ModuleElement m = (ModuleElement) e;
403                         link = getModuleLink(m, new StringContent(m.getQualifiedName()));
404                         break;
405                     case PACKAGE:
406                         PackageElement pkg = (PackageElement) e;
407                         link = getPackageLink(pkg, getPackageName(pkg));
408                         break;
409                     default:
410                         link = getDeprecatedLink(e);
411                 }
412                 Content desc = new ContentBuilder();
413                 List&lt;? extends DocTree&gt; tags = utils.getDeprecatedTrees(e);
414                 if (!tags.isEmpty()) {
415                     addInlineDeprecatedComment(e, tags.get(0), desc);
416                 } else {
417                     desc.add(HtmlTree.EMPTY);
418                 }
419                 table.addRow(link, desc);
420             }
421             Content li = HtmlTree.LI(HtmlStyle.blockList, table.toContent());
422             Content ul = HtmlTree.UL(HtmlStyle.blockList, li);
423             contentTree.add(ul);
424         }
425     }
426 
427     protected Content getDeprecatedLink(Element e) {
428         AbstractMemberWriter writer;
429         switch (e.getKind()) {
430             case INTERFACE:
431             case CLASS:
432             case ENUM:
433             case ANNOTATION_TYPE:
434                 writer = new NestedClassWriterImpl(this);
435                 break;
436             case FIELD:
437                 writer = new FieldWriterImpl(this);
438                 break;
439             case METHOD:
440                 writer = new MethodWriterImpl(this);
441                 break;
442             case CONSTRUCTOR:
443                 writer = new ConstructorWriterImpl(this);
444                 break;
445             case ENUM_CONSTANT:
446                 writer = new EnumConstantWriterImpl(this);
447                 break;
448             default:
449                 writer = new AnnotationTypeOptionalMemberWriterImpl(this, null);
450         }
451         return writer.getDeprecatedLink(e);
452     }
453 }
<a name="18" id="anc18"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="18" type="hidden" />
</body>
</html>