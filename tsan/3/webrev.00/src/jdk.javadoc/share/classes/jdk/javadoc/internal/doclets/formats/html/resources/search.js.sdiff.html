<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/resources/search.js</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="script-dir/jquery-ui.structure.min.css.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="standard.properties.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/resources/search.js</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 var noResult = {l: &quot;No results found&quot;};
 27 var catModules = &quot;Modules&quot;;
 28 var catPackages = &quot;Packages&quot;;
 29 var catTypes = &quot;Types&quot;;
 30 var catMembers = &quot;Members&quot;;
 31 var catSearchTags = &quot;SearchTags&quot;;
 32 var highlight = &quot;&lt;span class=\&quot;resultHighlight\&quot;&gt;$&amp;&lt;/span&gt;&quot;;
<span class="line-modified"> 33 var camelCaseRegexp = &quot;&quot;;</span>
<span class="line-modified"> 34 var secondaryMatcher = &quot;&quot;;</span>


 35 function escapeHtml(str) {
 36     return str.replace(/&lt;/g, &quot;&amp;lt;&quot;).replace(/&gt;/g, &quot;&amp;gt;&quot;);
 37 }
<span class="line-modified"> 38 function getHighlightedText(item) {</span>
<span class="line-removed"> 39     var ccMatcher = new RegExp(escapeHtml(camelCaseRegexp));</span>
 40     var escapedItem = escapeHtml(item);
<span class="line-modified"> 41     var label = escapedItem.replace(ccMatcher, highlight);</span>
<span class="line-removed"> 42     if (label === escapedItem) {</span>
<span class="line-removed"> 43         var secMatcher = new RegExp(escapeHtml(secondaryMatcher.source), &quot;i&quot;);</span>
<span class="line-removed"> 44         label = escapedItem.replace(secMatcher, highlight);</span>
<span class="line-removed"> 45     }</span>
<span class="line-removed"> 46     return label;</span>
 47 }
 48 function getURLPrefix(ui) {
 49     var urlPrefix=&quot;&quot;;
<span class="line-modified"> 50     if (useModuleDirectories) {</span>
<span class="line-modified"> 51         var slash = &quot;/&quot;;</span>
<span class="line-modified"> 52         if (ui.item.category === catModules) {</span>
<span class="line-modified"> 53             return ui.item.l + slash;</span>
<span class="line-modified"> 54         } else if (ui.item.category === catPackages &amp;&amp; ui.item.m) {</span>
<span class="line-modified"> 55             return ui.item.m + slash;</span>
<span class="line-modified"> 56         } else if ((ui.item.category === catTypes &amp;&amp; ui.item.p) || ui.item.category === catMembers) {</span>
<span class="line-modified"> 57             $.each(packageSearchIndex, function(index, item) {</span>
<span class="line-modified"> 58                 if (item.m &amp;&amp; ui.item.p == item.l) {</span>
<span class="line-modified"> 59                     urlPrefix = item.m + slash;</span>
<span class="line-modified"> 60                 }</span>
<span class="line-modified"> 61             });</span>
<span class="line-modified"> 62             return urlPrefix;</span>
<span class="line-modified"> 63         } else {</span>
<span class="line-removed"> 64             return urlPrefix;</span>
<span class="line-removed"> 65         }</span>
 66     }
 67     return urlPrefix;
 68 }



























 69 var watermark = &#39;Search&#39;;
 70 $(function() {
 71     $(&quot;#search&quot;).val(&#39;&#39;);
 72     $(&quot;#search&quot;).prop(&quot;disabled&quot;, false);
 73     $(&quot;#reset&quot;).prop(&quot;disabled&quot;, false);
 74     $(&quot;#search&quot;).val(watermark).addClass(&#39;watermark&#39;);
 75     $(&quot;#search&quot;).blur(function() {
 76         if ($(this).val().length == 0) {
 77             $(this).val(watermark).addClass(&#39;watermark&#39;);
 78         }
 79     });
<span class="line-modified"> 80     $(&quot;#search&quot;).on(&#39;click keydown&#39;, function() {</span>
 81         if ($(this).val() == watermark) {
 82             $(this).val(&#39;&#39;).removeClass(&#39;watermark&#39;);
 83         }
 84     });
 85     $(&quot;#reset&quot;).click(function() {
 86         $(&quot;#search&quot;).val(&#39;&#39;);
 87         $(&quot;#search&quot;).focus();
 88     });
 89     $(&quot;#search&quot;).focus();
 90     $(&quot;#search&quot;)[0].setSelectionRange(0, 0);
 91 });
 92 $.widget(&quot;custom.catcomplete&quot;, $.ui.autocomplete, {
 93     _create: function() {
 94         this._super();
 95         this.widget().menu(&quot;option&quot;, &quot;items&quot;, &quot;&gt; :not(.ui-autocomplete-category)&quot;);
 96     },
 97     _renderMenu: function(ul, items) {
<span class="line-modified"> 98         var rMenu = this,</span>
<span class="line-modified"> 99                 currentCategory = &quot;&quot;;</span>
100         rMenu.menu.bindings = $();
101         $.each(items, function(index, item) {
102             var li;
103             if (item.l !== noResult.l &amp;&amp; item.category !== currentCategory) {
104                 ul.append(&quot;&lt;li class=\&quot;ui-autocomplete-category\&quot;&gt;&quot; + item.category + &quot;&lt;/li&gt;&quot;);
105                 currentCategory = item.category;
106             }
107             li = rMenu._renderItemData(ul, item);
108             if (item.category) {
109                 li.attr(&quot;aria-label&quot;, item.category + &quot; : &quot; + item.l);
110                 li.attr(&quot;class&quot;, &quot;resultItem&quot;);
111             } else {
112                 li.attr(&quot;aria-label&quot;, item.l);
113                 li.attr(&quot;class&quot;, &quot;resultItem&quot;);
114             }
115         });
116     },
117     _renderItem: function(ul, item) {
118         var label = &quot;&quot;;

119         if (item.category === catModules) {
<span class="line-modified">120             label = getHighlightedText(item.l);</span>
121         } else if (item.category === catPackages) {
122             label = (item.m)
<span class="line-modified">123                     ? getHighlightedText(item.m + &quot;/&quot; + item.l)</span>
<span class="line-modified">124                     : getHighlightedText(item.l);</span>
125         } else if (item.category === catTypes) {
126             label = (item.p)
<span class="line-modified">127                     ? getHighlightedText(item.p + &quot;.&quot; + item.l)</span>
<span class="line-modified">128                     : getHighlightedText(item.l);</span>
129         } else if (item.category === catMembers) {
<span class="line-modified">130             label = getHighlightedText(item.p + &quot;.&quot; + (item.c + &quot;.&quot; + item.l));</span>
131         } else if (item.category === catSearchTags) {
<span class="line-modified">132             label = getHighlightedText(item.l);</span>
133         } else {
134             label = item.l;
135         }
136         var li = $(&quot;&lt;li/&gt;&quot;).appendTo(ul);
137         var div = $(&quot;&lt;div/&gt;&quot;).appendTo(li);
138         if (item.category === catSearchTags) {
139             if (item.d) {
140                 div.html(label + &quot;&lt;span class=\&quot;searchTagHolderResult\&quot;&gt; (&quot; + item.h + &quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=\&quot;searchTagDescResult\&quot;&gt;&quot;
141                                 + item.d + &quot;&lt;/span&gt;&lt;br&gt;&quot;);
142             } else {
143                 div.html(label + &quot;&lt;span class=\&quot;searchTagHolderResult\&quot;&gt; (&quot; + item.h + &quot;)&lt;/span&gt;&quot;);
144             }
145         } else {
146             div.html(label);
147         }
148         return li;
149     }
150 });










































151 $(function() {
152     $(&quot;#search&quot;).catcomplete({
153         minLength: 1,
154         delay: 300,
155         source: function(request, response) {
<span class="line-modified">156             var result = new Array();</span>
<span class="line-modified">157             var presult = new Array();</span>
<span class="line-removed">158             var tresult = new Array();</span>
<span class="line-removed">159             var mresult = new Array();</span>
<span class="line-removed">160             var tgresult = new Array();</span>
<span class="line-removed">161             var secondaryresult = new Array();</span>
<span class="line-removed">162             var displayCount = 0;</span>
<span class="line-removed">163             var exactMatcher = new RegExp(&quot;^&quot; + $.ui.autocomplete.escapeRegex(request.term) + &quot;$&quot;, &quot;i&quot;);</span>
<span class="line-removed">164             camelCaseRegexp = ($.ui.autocomplete.escapeRegex(request.term)).split(/(?=[A-Z])/).join(&quot;([a-z0-9_$]*?)&quot;);</span>
<span class="line-removed">165             var camelCaseMatcher = new RegExp(&quot;^&quot; + camelCaseRegexp);</span>
<span class="line-removed">166             secondaryMatcher = new RegExp($.ui.autocomplete.escapeRegex(request.term), &quot;i&quot;);</span>
167 
<span class="line-modified">168             // Return the nested innermost name from the specified object</span>
<span class="line-modified">169             function nestedName(e) {</span>
<span class="line-modified">170                 return e.l.substring(e.l.lastIndexOf(&quot;.&quot;) + 1);</span>
171             }


172 
173             function concatResults(a1, a2) {
<span class="line-modified">174                 a1 = a1.concat(a2);</span>



175                 a2.length = 0;
176                 return a1;
177             }
178 
179             if (moduleSearchIndex) {
<span class="line-removed">180                 var mdleCount = 0;</span>
181                 $.each(moduleSearchIndex, function(index, item) {
182                     item.category = catModules;
<span class="line-modified">183                     if (exactMatcher.test(item.l)) {</span>
<span class="line-modified">184                         result.push(item);</span>
<span class="line-modified">185                         mdleCount++;</span>
<span class="line-removed">186                     } else if (camelCaseMatcher.test(item.l)) {</span>
<span class="line-removed">187                         result.push(item);</span>
<span class="line-removed">188                     } else if (secondaryMatcher.test(item.l)) {</span>
<span class="line-removed">189                         secondaryresult.push(item);</span>
190                     }

191                 });
<span class="line-modified">192                 displayCount = mdleCount;</span>
<span class="line-removed">193                 result = concatResults(result, secondaryresult);</span>
194             }
195             if (packageSearchIndex) {
<span class="line-removed">196                 var pCount = 0;</span>
<span class="line-removed">197                 var pkg = &quot;&quot;;</span>
198                 $.each(packageSearchIndex, function(index, item) {
199                     item.category = catPackages;
<span class="line-modified">200                     pkg = (item.m)</span>
201                             ? (item.m + &quot;/&quot; + item.l)
202                             : item.l;
<span class="line-modified">203                     if (exactMatcher.test(item.l)) {</span>
<span class="line-modified">204                         presult.push(item);</span>
<span class="line-modified">205                         pCount++;</span>
<span class="line-removed">206                     } else if (camelCaseMatcher.test(pkg)) {</span>
<span class="line-removed">207                         presult.push(item);</span>
<span class="line-removed">208                     } else if (secondaryMatcher.test(pkg)) {</span>
<span class="line-removed">209                         secondaryresult.push(item);</span>
210                     }

211                 });
<span class="line-modified">212                 result = result.concat(concatResults(presult, secondaryresult));</span>
<span class="line-removed">213                 displayCount = (pCount &gt; displayCount) ? pCount : displayCount;</span>
214             }
215             if (typeSearchIndex) {
<span class="line-removed">216                 var tCount = 0;</span>
217                 $.each(typeSearchIndex, function(index, item) {
218                     item.category = catTypes;
<span class="line-modified">219                     var s = nestedName(item);</span>
<span class="line-modified">220                     if (exactMatcher.test(s)) {</span>
<span class="line-modified">221                         tresult.push(item);</span>
<span class="line-modified">222                         tCount++;</span>
<span class="line-modified">223                     } else if (camelCaseMatcher.test(s)) {</span>
<span class="line-modified">224                         tresult.push(item);</span>
<span class="line-removed">225                     } else if (secondaryMatcher.test(item.p + &quot;.&quot; + item.l)) {</span>
<span class="line-removed">226                         secondaryresult.push(item);</span>
227                     }

228                 });
<span class="line-modified">229                 result = result.concat(concatResults(tresult, secondaryresult));</span>
<span class="line-removed">230                 displayCount = (tCount &gt; displayCount) ? tCount : displayCount;</span>
231             }
232             if (memberSearchIndex) {
<span class="line-removed">233                 var mCount = 0;</span>
234                 $.each(memberSearchIndex, function(index, item) {
235                     item.category = catMembers;
<span class="line-modified">236                     var s = nestedName(item);</span>
<span class="line-modified">237                     if (exactMatcher.test(s)) {</span>
<span class="line-modified">238                         mresult.push(item);</span>
<span class="line-modified">239                         mCount++;</span>
<span class="line-modified">240                     } else if (camelCaseMatcher.test(s)) {</span>
<span class="line-modified">241                         mresult.push(item);</span>
<span class="line-removed">242                     } else if (secondaryMatcher.test(item.c + &quot;.&quot; + item.l)) {</span>
<span class="line-removed">243                         secondaryresult.push(item);</span>
244                     }

245                 });
<span class="line-modified">246                 result = result.concat(concatResults(mresult, secondaryresult));</span>
<span class="line-removed">247                 displayCount = (mCount &gt; displayCount) ? mCount : displayCount;</span>
248             }
249             if (tagSearchIndex) {
<span class="line-removed">250                 var tgCount = 0;</span>
251                 $.each(tagSearchIndex, function(index, item) {
252                     item.category = catSearchTags;
<span class="line-modified">253                     if (exactMatcher.test(item.l)) {</span>
<span class="line-modified">254                         tgresult.push(item);</span>
<span class="line-modified">255                         tgCount++;</span>
<span class="line-removed">256                     } else if (secondaryMatcher.test(item.l)) {</span>
<span class="line-removed">257                         secondaryresult.push(item);</span>
258                     }

259                 });
<span class="line-modified">260                 result = result.concat(concatResults(tgresult, secondaryresult));</span>
<span class="line-removed">261                 displayCount = (tgCount &gt; displayCount) ? tgCount : displayCount;</span>
262             }
<span class="line-modified">263             displayCount = (displayCount &gt; 500) ? displayCount : 500;</span>
<span class="line-removed">264             var counter = function() {</span>
<span class="line-removed">265                 var count = {Modules: 0, Packages: 0, Types: 0, Members: 0, SearchTags: 0};</span>
<span class="line-removed">266                 var f = function(item) {</span>
<span class="line-removed">267                     count[item.category] += 1;</span>
<span class="line-removed">268                     return (count[item.category] &lt;= displayCount);</span>
<span class="line-removed">269                 };</span>
<span class="line-removed">270                 return f;</span>
<span class="line-removed">271             }();</span>
<span class="line-removed">272             response(result.filter(counter));</span>
273         },
274         response: function(event, ui) {
275             if (!ui.content.length) {
276                 ui.content.push(noResult);
277             } else {
278                 $(&quot;#search&quot;).empty();
279             }
280         },
281         autoFocus: true,
282         position: {
283             collision: &quot;flip&quot;
284         },
285         select: function(event, ui) {
286             if (ui.item.l !== noResult.l) {
287                 var url = getURLPrefix(ui);
288                 if (ui.item.category === catModules) {
<span class="line-modified">289                     if (useModuleDirectories) {</span>
<span class="line-removed">290                         url += &quot;module-summary.html&quot;;</span>
<span class="line-removed">291                     } else {</span>
<span class="line-removed">292                         url = ui.item.l + &quot;-summary.html&quot;;</span>
<span class="line-removed">293                     }</span>
294                 } else if (ui.item.category === catPackages) {
<span class="line-modified">295                     if (ui.item.url) {</span>
<span class="line-modified">296                         url = ui.item.url;</span>
297                     } else {
<span class="line-modified">298                     url += ui.item.l.replace(/\./g, &#39;/&#39;) + &quot;/package-summary.html&quot;;</span>
299                     }
300                 } else if (ui.item.category === catTypes) {
<span class="line-modified">301                     if (ui.item.url) {</span>
<span class="line-modified">302                         url = ui.item.url;</span>
303                     } else if (ui.item.p === &quot;&lt;Unnamed&gt;&quot;) {
304                         url += ui.item.l + &quot;.html&quot;;
305                     } else {
306                         url += ui.item.p.replace(/\./g, &#39;/&#39;) + &quot;/&quot; + ui.item.l + &quot;.html&quot;;
307                     }
308                 } else if (ui.item.category === catMembers) {
309                     if (ui.item.p === &quot;&lt;Unnamed&gt;&quot;) {
310                         url += ui.item.c + &quot;.html&quot; + &quot;#&quot;;
311                     } else {
312                         url += ui.item.p.replace(/\./g, &#39;/&#39;) + &quot;/&quot; + ui.item.c + &quot;.html&quot; + &quot;#&quot;;
313                     }
<span class="line-modified">314                     if (ui.item.url) {</span>
<span class="line-modified">315                         url += ui.item.url;</span>
316                     } else {
317                         url += ui.item.l;
318                     }
319                 } else if (ui.item.category === catSearchTags) {
320                     url += ui.item.u;
321                 }
322                 if (top !== window) {
323                     parent.classFrame.location = pathtoroot + url;
324                 } else {
325                     window.location.href = pathtoroot + url;
326                 }
327                 $(&quot;#search&quot;).focus();
328             }
329         }
330     });
331 });
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 var noResult = {l: &quot;No results found&quot;};
 27 var catModules = &quot;Modules&quot;;
 28 var catPackages = &quot;Packages&quot;;
 29 var catTypes = &quot;Types&quot;;
 30 var catMembers = &quot;Members&quot;;
 31 var catSearchTags = &quot;SearchTags&quot;;
 32 var highlight = &quot;&lt;span class=\&quot;resultHighlight\&quot;&gt;$&amp;&lt;/span&gt;&quot;;
<span class="line-modified"> 33 var searchPattern = &quot;&quot;;</span>
<span class="line-modified"> 34 var RANKING_THRESHOLD = 2;</span>
<span class="line-added"> 35 var NO_MATCH = 0xffff;</span>
<span class="line-added"> 36 var MAX_RESULTS_PER_CATEGORY = 500;</span>
 37 function escapeHtml(str) {
 38     return str.replace(/&lt;/g, &quot;&amp;lt;&quot;).replace(/&gt;/g, &quot;&amp;gt;&quot;);
 39 }
<span class="line-modified"> 40 function getHighlightedText(item, matcher) {</span>

 41     var escapedItem = escapeHtml(item);
<span class="line-modified"> 42     return escapedItem.replace(matcher, highlight);</span>





 43 }
 44 function getURLPrefix(ui) {
 45     var urlPrefix=&quot;&quot;;
<span class="line-modified"> 46     var slash = &quot;/&quot;;</span>
<span class="line-modified"> 47     if (ui.item.category === catModules) {</span>
<span class="line-modified"> 48         return ui.item.l + slash;</span>
<span class="line-modified"> 49     } else if (ui.item.category === catPackages &amp;&amp; ui.item.m) {</span>
<span class="line-modified"> 50         return ui.item.m + slash;</span>
<span class="line-modified"> 51     } else if ((ui.item.category === catTypes &amp;&amp; ui.item.p) || ui.item.category === catMembers) {</span>
<span class="line-modified"> 52         $.each(packageSearchIndex, function(index, item) {</span>
<span class="line-modified"> 53             if (item.m &amp;&amp; ui.item.p == item.l) {</span>
<span class="line-modified"> 54                 urlPrefix = item.m + slash;</span>
<span class="line-modified"> 55             }</span>
<span class="line-modified"> 56         });</span>
<span class="line-modified"> 57         return urlPrefix;</span>
<span class="line-modified"> 58     } else {</span>
<span class="line-modified"> 59         return urlPrefix;</span>


 60     }
 61     return urlPrefix;
 62 }
<span class="line-added"> 63 function makeCamelCaseRegex(term) {</span>
<span class="line-added"> 64     var pattern = &quot;&quot;;</span>
<span class="line-added"> 65     var isWordToken = false;</span>
<span class="line-added"> 66     term.replace(/,\s*/g, &quot;, &quot;).trim().split(/\s+/).forEach(function(w, index) {</span>
<span class="line-added"> 67         if (index &gt; 0) {</span>
<span class="line-added"> 68             // whitespace between identifiers is significant</span>
<span class="line-added"> 69             pattern += (isWordToken &amp;&amp; /^\w/.test(w)) ? &quot;\\s+&quot; : &quot;\\s*&quot;;</span>
<span class="line-added"> 70         }</span>
<span class="line-added"> 71         var tokens = w.split(/(?=[A-Z,.()&lt;&gt;[\/])/);</span>
<span class="line-added"> 72         for (var i = 0; i &lt; tokens.length; i++) {</span>
<span class="line-added"> 73             var s = tokens[i];</span>
<span class="line-added"> 74             if (s === &quot;&quot;) {</span>
<span class="line-added"> 75                 continue;</span>
<span class="line-added"> 76             }</span>
<span class="line-added"> 77             pattern += $.ui.autocomplete.escapeRegex(s);</span>
<span class="line-added"> 78             isWordToken =  /\w$/.test(s);</span>
<span class="line-added"> 79             if (isWordToken) {</span>
<span class="line-added"> 80                 pattern += &quot;([a-z0-9_$&lt;&gt;\\[\\]]*?)&quot;;</span>
<span class="line-added"> 81             }</span>
<span class="line-added"> 82         }</span>
<span class="line-added"> 83     });</span>
<span class="line-added"> 84     return pattern;</span>
<span class="line-added"> 85 }</span>
<span class="line-added"> 86 function createMatcher(pattern, flags) {</span>
<span class="line-added"> 87     var isCamelCase = /[A-Z]/.test(pattern);</span>
<span class="line-added"> 88     return new RegExp(pattern, flags + (isCamelCase ? &quot;&quot; : &quot;i&quot;));</span>
<span class="line-added"> 89 }</span>
 90 var watermark = &#39;Search&#39;;
 91 $(function() {
 92     $(&quot;#search&quot;).val(&#39;&#39;);
 93     $(&quot;#search&quot;).prop(&quot;disabled&quot;, false);
 94     $(&quot;#reset&quot;).prop(&quot;disabled&quot;, false);
 95     $(&quot;#search&quot;).val(watermark).addClass(&#39;watermark&#39;);
 96     $(&quot;#search&quot;).blur(function() {
 97         if ($(this).val().length == 0) {
 98             $(this).val(watermark).addClass(&#39;watermark&#39;);
 99         }
100     });
<span class="line-modified">101     $(&quot;#search&quot;).on(&#39;click keydown paste&#39;, function() {</span>
102         if ($(this).val() == watermark) {
103             $(this).val(&#39;&#39;).removeClass(&#39;watermark&#39;);
104         }
105     });
106     $(&quot;#reset&quot;).click(function() {
107         $(&quot;#search&quot;).val(&#39;&#39;);
108         $(&quot;#search&quot;).focus();
109     });
110     $(&quot;#search&quot;).focus();
111     $(&quot;#search&quot;)[0].setSelectionRange(0, 0);
112 });
113 $.widget(&quot;custom.catcomplete&quot;, $.ui.autocomplete, {
114     _create: function() {
115         this._super();
116         this.widget().menu(&quot;option&quot;, &quot;items&quot;, &quot;&gt; :not(.ui-autocomplete-category)&quot;);
117     },
118     _renderMenu: function(ul, items) {
<span class="line-modified">119         var rMenu = this;</span>
<span class="line-modified">120         var currentCategory = &quot;&quot;;</span>
121         rMenu.menu.bindings = $();
122         $.each(items, function(index, item) {
123             var li;
124             if (item.l !== noResult.l &amp;&amp; item.category !== currentCategory) {
125                 ul.append(&quot;&lt;li class=\&quot;ui-autocomplete-category\&quot;&gt;&quot; + item.category + &quot;&lt;/li&gt;&quot;);
126                 currentCategory = item.category;
127             }
128             li = rMenu._renderItemData(ul, item);
129             if (item.category) {
130                 li.attr(&quot;aria-label&quot;, item.category + &quot; : &quot; + item.l);
131                 li.attr(&quot;class&quot;, &quot;resultItem&quot;);
132             } else {
133                 li.attr(&quot;aria-label&quot;, item.l);
134                 li.attr(&quot;class&quot;, &quot;resultItem&quot;);
135             }
136         });
137     },
138     _renderItem: function(ul, item) {
139         var label = &quot;&quot;;
<span class="line-added">140         var matcher = createMatcher(escapeHtml(searchPattern), &quot;g&quot;);</span>
141         if (item.category === catModules) {
<span class="line-modified">142             label = getHighlightedText(item.l, matcher);</span>
143         } else if (item.category === catPackages) {
144             label = (item.m)
<span class="line-modified">145                     ? getHighlightedText(item.m + &quot;/&quot; + item.l, matcher)</span>
<span class="line-modified">146                     : getHighlightedText(item.l, matcher);</span>
147         } else if (item.category === catTypes) {
148             label = (item.p)
<span class="line-modified">149                     ? getHighlightedText(item.p + &quot;.&quot; + item.l, matcher)</span>
<span class="line-modified">150                     : getHighlightedText(item.l, matcher);</span>
151         } else if (item.category === catMembers) {
<span class="line-modified">152             label = getHighlightedText(item.p + &quot;.&quot; + (item.c + &quot;.&quot; + item.l), matcher);</span>
153         } else if (item.category === catSearchTags) {
<span class="line-modified">154             label = getHighlightedText(item.l, matcher);</span>
155         } else {
156             label = item.l;
157         }
158         var li = $(&quot;&lt;li/&gt;&quot;).appendTo(ul);
159         var div = $(&quot;&lt;div/&gt;&quot;).appendTo(li);
160         if (item.category === catSearchTags) {
161             if (item.d) {
162                 div.html(label + &quot;&lt;span class=\&quot;searchTagHolderResult\&quot;&gt; (&quot; + item.h + &quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=\&quot;searchTagDescResult\&quot;&gt;&quot;
163                                 + item.d + &quot;&lt;/span&gt;&lt;br&gt;&quot;);
164             } else {
165                 div.html(label + &quot;&lt;span class=\&quot;searchTagHolderResult\&quot;&gt; (&quot; + item.h + &quot;)&lt;/span&gt;&quot;);
166             }
167         } else {
168             div.html(label);
169         }
170         return li;
171     }
172 });
<span class="line-added">173 function rankMatch(match, category) {</span>
<span class="line-added">174     if (!match) {</span>
<span class="line-added">175         return NO_MATCH;</span>
<span class="line-added">176     }</span>
<span class="line-added">177     var index = match.index;</span>
<span class="line-added">178     var input = match.input;</span>
<span class="line-added">179     var leftBoundaryMatch = 2;</span>
<span class="line-added">180     var periferalMatch = 0;</span>
<span class="line-added">181     var delta = 0;</span>
<span class="line-added">182     // make sure match is anchored on a left word boundary</span>
<span class="line-added">183     if (index === 0 || /\W/.test(input[index - 1]) || &quot;_&quot; === input[index - 1] || &quot;_&quot; === input[index]) {</span>
<span class="line-added">184         leftBoundaryMatch = 0;</span>
<span class="line-added">185     } else if (input[index] === input[index].toUpperCase() &amp;&amp; !/^[A-Z0-9_$]+$/.test(input)) {</span>
<span class="line-added">186         leftBoundaryMatch = 1;</span>
<span class="line-added">187     }</span>
<span class="line-added">188     var matchEnd = index + match[0].length;</span>
<span class="line-added">189     var leftParen = input.indexOf(&quot;(&quot;);</span>
<span class="line-added">190     // exclude peripheral matches</span>
<span class="line-added">191     if (category !== catModules &amp;&amp; category !== catSearchTags) {</span>
<span class="line-added">192         var endOfName = leftParen &gt; -1 ? leftParen : input.length;</span>
<span class="line-added">193         var delim = category === catPackages ? &quot;/&quot; : &quot;.&quot;;</span>
<span class="line-added">194         if (leftParen &gt; -1 &amp;&amp; leftParen &lt; index) {</span>
<span class="line-added">195             periferalMatch += 2;</span>
<span class="line-added">196         } else if (input.lastIndexOf(delim, endOfName) &gt;= matchEnd) {</span>
<span class="line-added">197             periferalMatch += 2;</span>
<span class="line-added">198         }</span>
<span class="line-added">199     }</span>
<span class="line-added">200     for (var i = 1; i &lt; match.length; i++) {</span>
<span class="line-added">201         // lower ranking if parts of the name are missing</span>
<span class="line-added">202         if (match[i])</span>
<span class="line-added">203             delta += match[i].length;</span>
<span class="line-added">204     }</span>
<span class="line-added">205     if (category === catTypes) {</span>
<span class="line-added">206         // lower ranking if a type name contains unmatched camel-case parts</span>
<span class="line-added">207         if (/[A-Z]/.test(input.substring(matchEnd)))</span>
<span class="line-added">208             delta += 5;</span>
<span class="line-added">209         if (/[A-Z]/.test(input.substring(0, index)))</span>
<span class="line-added">210             delta += 5;</span>
<span class="line-added">211     }</span>
<span class="line-added">212     return leftBoundaryMatch + periferalMatch + (delta / 200);</span>
<span class="line-added">213 </span>
<span class="line-added">214 }</span>
215 $(function() {
216     $(&quot;#search&quot;).catcomplete({
217         minLength: 1,
218         delay: 300,
219         source: function(request, response) {
<span class="line-modified">220             var result = [];</span>
<span class="line-modified">221             var newResults = [];</span>









222 
<span class="line-modified">223             searchPattern = makeCamelCaseRegex(request.term);</span>
<span class="line-modified">224             if (searchPattern === &quot;&quot;) {</span>
<span class="line-modified">225                 return this.close();</span>
226             }
<span class="line-added">227             var camelCaseMatcher = createMatcher(searchPattern, &quot;&quot;);</span>
<span class="line-added">228             var boundaryMatcher = createMatcher(&quot;\\b&quot; + searchPattern, &quot;&quot;);</span>
229 
230             function concatResults(a1, a2) {
<span class="line-modified">231                 a2.sort(function(e1, e2) {</span>
<span class="line-added">232                     return e1.ranking - e2.ranking;</span>
<span class="line-added">233                 });</span>
<span class="line-added">234                 a1 = a1.concat(a2.map(function(e) { return e.item; }));</span>
235                 a2.length = 0;
236                 return a1;
237             }
238 
239             if (moduleSearchIndex) {

240                 $.each(moduleSearchIndex, function(index, item) {
241                     item.category = catModules;
<span class="line-modified">242                     var ranking = rankMatch(boundaryMatcher.exec(item.l), catModules);</span>
<span class="line-modified">243                     if (ranking &lt; RANKING_THRESHOLD) {</span>
<span class="line-modified">244                         newResults.push({ ranking: ranking, item: item });</span>




245                     }
<span class="line-added">246                     return newResults.length &lt; MAX_RESULTS_PER_CATEGORY;</span>
247                 });
<span class="line-modified">248                 result = concatResults(result, newResults);</span>

249             }
250             if (packageSearchIndex) {


251                 $.each(packageSearchIndex, function(index, item) {
252                     item.category = catPackages;
<span class="line-modified">253                     var name = (item.m &amp;&amp; request.term.indexOf(&quot;/&quot;) &gt; -1)</span>
254                             ? (item.m + &quot;/&quot; + item.l)
255                             : item.l;
<span class="line-modified">256                     var ranking = rankMatch(boundaryMatcher.exec(name), catPackages);</span>
<span class="line-modified">257                     if (ranking &lt; RANKING_THRESHOLD) {</span>
<span class="line-modified">258                         newResults.push({ ranking: ranking, item: item });</span>




259                     }
<span class="line-added">260                     return newResults.length &lt; MAX_RESULTS_PER_CATEGORY;</span>
261                 });
<span class="line-modified">262                 result = concatResults(result, newResults);</span>

263             }
264             if (typeSearchIndex) {

265                 $.each(typeSearchIndex, function(index, item) {
266                     item.category = catTypes;
<span class="line-modified">267                     var name = request.term.indexOf(&quot;.&quot;) &gt; -1</span>
<span class="line-modified">268                         ? item.p + &quot;.&quot; + item.l</span>
<span class="line-modified">269                         : item.l;</span>
<span class="line-modified">270                     var ranking = rankMatch(camelCaseMatcher.exec(name), catTypes);</span>
<span class="line-modified">271                     if (ranking &lt; RANKING_THRESHOLD) {</span>
<span class="line-modified">272                         newResults.push({ ranking: ranking, item: item });</span>


273                     }
<span class="line-added">274                     return newResults.length &lt; MAX_RESULTS_PER_CATEGORY;</span>
275                 });
<span class="line-modified">276                 result = concatResults(result, newResults);</span>

277             }
278             if (memberSearchIndex) {

279                 $.each(memberSearchIndex, function(index, item) {
280                     item.category = catMembers;
<span class="line-modified">281                     var name = request.term.indexOf(&quot;.&quot;) &gt; -1</span>
<span class="line-modified">282                             ? item.p + &quot;.&quot; + item.c + &quot;.&quot; + item.l</span>
<span class="line-modified">283                             : item.l;</span>
<span class="line-modified">284                     var ranking = rankMatch(camelCaseMatcher.exec(name), catMembers);</span>
<span class="line-modified">285                     if (ranking &lt; RANKING_THRESHOLD) {</span>
<span class="line-modified">286                         newResults.push({ ranking: ranking, item: item });</span>


287                     }
<span class="line-added">288                     return newResults.length &lt; MAX_RESULTS_PER_CATEGORY;</span>
289                 });
<span class="line-modified">290                 result = concatResults(result, newResults);</span>

291             }
292             if (tagSearchIndex) {

293                 $.each(tagSearchIndex, function(index, item) {
294                     item.category = catSearchTags;
<span class="line-modified">295                     var ranking = rankMatch(boundaryMatcher.exec(item.l), catSearchTags);</span>
<span class="line-modified">296                     if (ranking &lt; RANKING_THRESHOLD) {</span>
<span class="line-modified">297                         newResults.push({ ranking: ranking, item: item });</span>


298                     }
<span class="line-added">299                     return newResults.length &lt; MAX_RESULTS_PER_CATEGORY;</span>
300                 });
<span class="line-modified">301                 result = concatResults(result, newResults);</span>

302             }
<span class="line-modified">303             response(result);</span>









304         },
305         response: function(event, ui) {
306             if (!ui.content.length) {
307                 ui.content.push(noResult);
308             } else {
309                 $(&quot;#search&quot;).empty();
310             }
311         },
312         autoFocus: true,
313         position: {
314             collision: &quot;flip&quot;
315         },
316         select: function(event, ui) {
317             if (ui.item.l !== noResult.l) {
318                 var url = getURLPrefix(ui);
319                 if (ui.item.category === catModules) {
<span class="line-modified">320                     url += &quot;module-summary.html&quot;;</span>




321                 } else if (ui.item.category === catPackages) {
<span class="line-modified">322                     if (ui.item.u) {</span>
<span class="line-modified">323                         url = ui.item.u;</span>
324                     } else {
<span class="line-modified">325                         url += ui.item.l.replace(/\./g, &#39;/&#39;) + &quot;/package-summary.html&quot;;</span>
326                     }
327                 } else if (ui.item.category === catTypes) {
<span class="line-modified">328                     if (ui.item.u) {</span>
<span class="line-modified">329                         url = ui.item.u;</span>
330                     } else if (ui.item.p === &quot;&lt;Unnamed&gt;&quot;) {
331                         url += ui.item.l + &quot;.html&quot;;
332                     } else {
333                         url += ui.item.p.replace(/\./g, &#39;/&#39;) + &quot;/&quot; + ui.item.l + &quot;.html&quot;;
334                     }
335                 } else if (ui.item.category === catMembers) {
336                     if (ui.item.p === &quot;&lt;Unnamed&gt;&quot;) {
337                         url += ui.item.c + &quot;.html&quot; + &quot;#&quot;;
338                     } else {
339                         url += ui.item.p.replace(/\./g, &#39;/&#39;) + &quot;/&quot; + ui.item.c + &quot;.html&quot; + &quot;#&quot;;
340                     }
<span class="line-modified">341                     if (ui.item.u) {</span>
<span class="line-modified">342                         url += ui.item.u;</span>
343                     } else {
344                         url += ui.item.l;
345                     }
346                 } else if (ui.item.category === catSearchTags) {
347                     url += ui.item.u;
348                 }
349                 if (top !== window) {
350                     parent.classFrame.location = pathtoroot + url;
351                 } else {
352                     window.location.href = pathtoroot + url;
353                 }
354                 $(&quot;#search&quot;).focus();
355             }
356         }
357     });
358 });
</pre>
</td>
</tr>
</table>
<center><a href="script-dir/jquery-ui.structure.min.css.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="standard.properties.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>