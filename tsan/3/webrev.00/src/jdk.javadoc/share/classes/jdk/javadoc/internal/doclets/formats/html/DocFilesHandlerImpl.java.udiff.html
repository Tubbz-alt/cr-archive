<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/DocFilesHandlerImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DeprecatedListWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="EnumConstantWriterImpl.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/DocFilesHandlerImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -29,10 +29,13 @@</span>
  import com.sun.source.doctree.EndElementTree;
  import com.sun.source.doctree.StartElementTree;
  import com.sun.source.doctree.TextTree;
  import com.sun.source.util.DocTreeFactory;
  import com.sun.tools.doclint.HtmlTag;
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.BodyContents;</span>
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;</span>
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;</span>
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.Navigation;
  import jdk.javadoc.internal.doclets.toolkit.Content;
  import jdk.javadoc.internal.doclets.toolkit.DocFileElement;
  import jdk.javadoc.internal.doclets.toolkit.DocFilesHandler;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -59,10 +62,11 @@</span>
  
      public final Element element;
      public final Location location;
      public final DocPath  source;
      public final HtmlConfiguration configuration;
<span class="udiff-line-added">+     private final HtmlOptions options;</span>
      private Navigation navBar;
  
      /**
       * Constructor to construct the DocFilesWriter object.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -70,10 +74,11 @@</span>
       * @param element the containing element of the doc-files.
       *
       */
      public DocFilesHandlerImpl(HtmlConfiguration configuration, Element element) {
          this.configuration = configuration;
<span class="udiff-line-added">+         this.options = configuration.getOptions();</span>
          this.element = element;
  
          switch (element.getKind()) {
              case MODULE:
                  ModuleElement mdle = (ModuleElement)element;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -99,11 +104,11 @@</span>
       * elements directory to the generated documentation directory.
       *
       * @throws DocFileIOException if there is a problem while copying
       *         the documentation files
       */
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+     @Override</span>
      public void copyDocFiles()  throws DocFileIOException {
          boolean first = true;
          for (DocFile srcdir : DocFile.list(configuration, location, source)) {
              if (!srcdir.isDirectory()) {
                  continue;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -122,10 +127,11 @@</span>
              copyDirectory(srcdir, path.resolve(DocPaths.DOC_FILES), first);
              first = false;
          }
      }
  
<span class="udiff-line-added">+     @Override</span>
      public List&lt;DocPath&gt; getStylesheets() throws DocFileIOException {
          List&lt;DocPath&gt; stylesheets = new ArrayList&lt;DocPath&gt;();
          for (DocFile srcdir : DocFile.list(configuration, location, source)) {
              for (DocFile srcFile : srcdir.list()) {
                  if (srcFile.getName().endsWith(&quot;.css&quot;))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -155,11 +161,11 @@</span>
                                  srcfile.getPath(), dstdir.getPath());
                          destfile.copyFile(srcfile);
                      }
                  }
              } else if (srcfile.isDirectory()) {
<span class="udiff-line-modified-removed">-                 if (configuration.copydocfilesubdirs</span>
<span class="udiff-line-modified-added">+                 if (options.copyDocfileSubdirs()</span>
                          &amp;&amp; !configuration.shouldExcludeDocFileDir(srcfile.getName())) {
                      DocPath dirDocPath = dstDocPath.resolve(srcfile.getName());
                      copyDirectory(srcfile, dirDocPath, first);
                  }
              }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -167,48 +173,47 @@</span>
      }
  
      private void handleHtmlFile(DocFile srcfile, DocPath dstPath) throws DocFileIOException {
          Utils utils = configuration.utils;
          FileObject fileObject = srcfile.getFileObject();
<span class="udiff-line-modified-removed">-         DocFileElement dfElement = new DocFileElement(element, fileObject);</span>
<span class="udiff-line-modified-added">+         DocFileElement dfElement = new DocFileElement(utils, element, fileObject);</span>
  
          DocPath dfilePath = dstPath.resolve(srcfile.getName());
          HtmlDocletWriter docletWriter = new DocFileWriter(configuration, dfilePath, element);
          configuration.messages.notice(&quot;doclet.Generating_0&quot;, docletWriter.filename.getPath());
  
          List&lt;? extends DocTree&gt; localTags = getLocalHeaderTags(utils.getPreamble(dfElement));
          Content localTagsContent = docletWriter.commentTagsToContent(null, dfElement, localTags, false);
  
          String title = getWindowTitle(docletWriter, dfElement).trim();
<span class="udiff-line-modified-removed">-         HtmlTree htmlContent = docletWriter.getBody(true, title);</span>
<span class="udiff-line-modified-removed">-         docletWriter.addTop(htmlContent);</span>
<span class="udiff-line-modified-removed">-         PackageElement pkg = (PackageElement) element;</span>
<span class="udiff-line-modified-removed">-         this.navBar = new Navigation(pkg, configuration, docletWriter.fixedNavDiv,</span>
<span class="udiff-line-modified-removed">-                 PageMode.DOCFILE, docletWriter.path);</span>
<span class="udiff-line-modified-added">+         HtmlTree htmlContent = docletWriter.getBody(title);</span>
<span class="udiff-line-modified-added">+         PackageElement pkg = dfElement.getPackageElement();</span>
<span class="udiff-line-modified-added">+         this.navBar = new Navigation(element, configuration, PageMode.DOCFILE, docletWriter.path);</span>
<span class="udiff-line-modified-added">+         Content headerContent = new ContentBuilder();</span>
<span class="udiff-line-modified-added">+         docletWriter.addTop(headerContent);</span>
          Content mdleLinkContent = docletWriter.getModuleLink(utils.elementUtils.getModuleOf(pkg),
                  docletWriter.contents.moduleLabel);
          navBar.setNavLinkModule(mdleLinkContent);
          Content pkgLinkContent = docletWriter.getPackageLink(pkg, docletWriter.contents.packageLabel);
          navBar.setNavLinkPackage(pkgLinkContent);
          navBar.setUserHeader(docletWriter.getUserHeaderFooter(true));
<span class="udiff-line-modified-removed">-         Content header = HtmlTree.HEADER();</span>
<span class="udiff-line-removed">-         header.add(navBar.getContent(true));</span>
<span class="udiff-line-removed">-         htmlContent.add(header);</span>
<span class="udiff-line-modified-added">+         headerContent.add(navBar.getContent(true));</span>
  
          List&lt;? extends DocTree&gt; fullBody = utils.getFullBody(dfElement);
<span class="udiff-line-modified-removed">-         Content bodyContent = docletWriter.commentTagsToContent(null, dfElement, fullBody, false);</span>
<span class="udiff-line-modified-removed">-         docletWriter.addTagsInfo(dfElement, bodyContent);</span>
<span class="udiff-line-removed">-         Content main = HtmlTree.MAIN();</span>
<span class="udiff-line-removed">-         main.add(bodyContent);</span>
<span class="udiff-line-removed">-         htmlContent.add(main);</span>
<span class="udiff-line-modified-added">+         Content pageContent = docletWriter.commentTagsToContent(null, dfElement, fullBody, false);</span>
<span class="udiff-line-modified-added">+         docletWriter.addTagsInfo(dfElement, pageContent);</span>
  
          navBar.setUserFooter(docletWriter.getUserHeaderFooter(false));
          Content footer = HtmlTree.FOOTER();
          footer.add(navBar.getContent(false));
          docletWriter.addBottom(footer);
<span class="udiff-line-modified-removed">-         htmlContent.add(footer);</span>
<span class="udiff-line-modified-removed">-         docletWriter.printHtmlDocument(Collections.emptyList(), null, localTagsContent, htmlContent);</span>
<span class="udiff-line-modified-added">+         htmlContent.add(new BodyContents()</span>
<span class="udiff-line-modified-added">+                 .setHeader(headerContent)</span>
<span class="udiff-line-added">+                 .addMainContent(HtmlTree.DIV(HtmlStyle.contentContainer, pageContent))</span>
<span class="udiff-line-added">+                 .setFooter(footer)</span>
<span class="udiff-line-added">+                 .toContent());</span>
<span class="udiff-line-added">+         docletWriter.printHtmlDocument(Collections.emptyList(), null, localTagsContent, Collections.emptyList(), htmlContent);</span>
      }
  
  
      private List&lt;? extends DocTree&gt; getLocalHeaderTags(List&lt;? extends DocTree&gt; dtrees) {
          List&lt;DocTree&gt; localTags = new ArrayList&lt;&gt;();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -297,24 +302,22 @@</span>
          return docletWriter.getWindowTitle(sb.toString().trim());
      }
  
      private static class DocFileWriter extends HtmlDocletWriter {
  
<span class="udiff-line-removed">-         final PackageElement pkg;</span>
<span class="udiff-line-removed">- </span>
          /**
           * Constructor to construct the HtmlDocletWriter object.
           *
<span class="udiff-line-modified-removed">-          * @param configuration the configuruation of this doclet.</span>
<span class="udiff-line-modified-added">+          * @param configuration the configuration of this doclet.</span>
           * @param path          the file to be generated.
           * @param e             the anchoring element.
           */
          public DocFileWriter(HtmlConfiguration configuration, DocPath path, Element e) {
              super(configuration, path);
              switch (e.getKind()) {
                  case PACKAGE:
<span class="udiff-line-modified-removed">-                     pkg = (PackageElement)e;</span>
<span class="udiff-line-modified-added">+                 case MODULE:</span>
                      break;
                  default:
                      throw new AssertionError(&quot;unsupported element: &quot; + e.getKind());
              }
          }
</pre>
<center><a href="DeprecatedListWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="EnumConstantWriterImpl.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>