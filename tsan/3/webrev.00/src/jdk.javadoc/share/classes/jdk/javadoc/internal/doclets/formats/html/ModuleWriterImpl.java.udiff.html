<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/ModuleWriterImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ModuleIndexWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="NestedClassWriterImpl.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/ModuleWriterImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2016, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2016, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,13 +23,10 @@</span>
   * questions.
   */
  
  package jdk.javadoc.internal.doclets.formats.html;
  
<span class="udiff-line-removed">- import jdk.javadoc.internal.doclets.formats.html.markup.Table;</span>
<span class="udiff-line-removed">- import jdk.javadoc.internal.doclets.formats.html.markup.TableHeader;</span>
<span class="udiff-line-removed">- </span>
  import java.util.ArrayList;
  import java.util.Collections;
  import java.util.List;
  import java.util.Map;
  import java.util.Set;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -43,18 +40,22 @@</span>
  import javax.lang.model.element.TypeElement;
  import javax.lang.model.util.ElementFilter;
  
  import com.sun.source.doctree.DocTree;
  import jdk.javadoc.doclet.DocletEnvironment.ModuleMode;
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.BodyContents;</span>
  import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.Entity;</span>
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.Navigation;
  import jdk.javadoc.internal.doclets.formats.html.markup.Navigation.PageMode;
  import jdk.javadoc.internal.doclets.formats.html.markup.RawHtml;
  import jdk.javadoc.internal.doclets.formats.html.markup.StringContent;
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.Table;</span>
<span class="udiff-line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.TableHeader;</span>
  import jdk.javadoc.internal.doclets.toolkit.Content;
  import jdk.javadoc.internal.doclets.toolkit.ModuleSummaryWriter;
  import jdk.javadoc.internal.doclets.toolkit.util.CommentHelper;
  import jdk.javadoc.internal.doclets.toolkit.util.DocFileIOException;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -65,12 +66,10 @@</span>
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
<span class="udiff-line-removed">-  *</span>
<span class="udiff-line-removed">-  * @author Bhavesh Patel</span>
   */
  public class ModuleWriterImpl extends HtmlDocletWriter implements ModuleSummaryWriter {
  
      /**
       * The module being documented.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -159,68 +158,60 @@</span>
       * description.
       */
      private final Map&lt;TypeElement, Content&gt; providesTrees
              = new TreeMap&lt;&gt;(utils.makeAllClassesComparator());
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * The HTML tree for main tag.</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     protected HtmlTree mainTree = HtmlTree.MAIN();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * The HTML tree for section tag.</span>
<span class="udiff-line-removed">-      */</span>
<span class="udiff-line-removed">-     protected HtmlTree sectionTree = HtmlTree.SECTION();</span>
<span class="udiff-line-removed">- </span>
      private final Navigation navBar;
  
<span class="udiff-line-added">+     private final BodyContents bodyContents = new BodyContents();</span>
<span class="udiff-line-added">+ </span>
      /**
       * Constructor to construct ModuleWriter object and to generate &quot;moduleName-summary.html&quot; file.
       *
       * @param configuration the configuration of the doclet.
       * @param mdle        Module under consideration.
       */
      public ModuleWriterImpl(HtmlConfiguration configuration, ModuleElement mdle) {
          super(configuration, configuration.docPaths.moduleSummary(mdle));
          this.mdle = mdle;
          this.moduleMode = configuration.docEnv.getModuleMode();
<span class="udiff-line-modified-removed">-         this.navBar = new Navigation(mdle, configuration, fixedNavDiv, PageMode.MODULE, path);</span>
<span class="udiff-line-modified-added">+         this.navBar = new Navigation(mdle, configuration, PageMode.MODULE, path);</span>
          computeModulesData();
      }
  
      /**
       * Get the module header.
       *
       * @param heading the heading for the section
       */
      @Override
      public Content getModuleHeader(String heading) {
<span class="udiff-line-modified-removed">-         HtmlTree bodyTree = getBody(true, getWindowTitle(mdle.getQualifiedName().toString()));</span>
<span class="udiff-line-modified-removed">-         HtmlTree htmlTree = HtmlTree.HEADER();</span>
<span class="udiff-line-modified-removed">-         addTop(htmlTree);</span>
<span class="udiff-line-modified-removed">-         navBar.setDisplaySummaryModuleDescLink(!utils.getFullBody(mdle).isEmpty() &amp;&amp; !configuration.nocomment);</span>
<span class="udiff-line-modified-added">+         HtmlTree bodyTree = getBody(getWindowTitle(mdle.getQualifiedName().toString()));</span>
<span class="udiff-line-modified-added">+         Content headerContent = new ContentBuilder();</span>
<span class="udiff-line-modified-added">+         addTop(headerContent);</span>
<span class="udiff-line-modified-added">+         navBar.setDisplaySummaryModuleDescLink(!utils.getFullBody(mdle).isEmpty() &amp;&amp; !options.noComment());</span>
          navBar.setDisplaySummaryModulesLink(display(requires) || display(indirectModules));
          navBar.setDisplaySummaryPackagesLink(display(packages) || display(indirectPackages)
                  || display(indirectOpenPackages));
          navBar.setDisplaySummaryServicesLink(displayServices(uses, usesTrees) || displayServices(provides.keySet(), providesTrees));
          navBar.setUserHeader(getUserHeaderFooter(true));
<span class="udiff-line-modified-removed">-         htmlTree.add(navBar.getContent(true));</span>
<span class="udiff-line-removed">-         bodyTree.add(htmlTree);</span>
<span class="udiff-line-modified-added">+         headerContent.add(navBar.getContent(true));</span>
          HtmlTree div = new HtmlTree(HtmlTag.DIV);
          div.setStyle(HtmlStyle.header);
          Content annotationContent = new HtmlTree(HtmlTag.P);
          addAnnotationInfo(mdle, annotationContent);
          div.add(annotationContent);
          Content label = mdle.isOpen() &amp;&amp; (configuration.docEnv.getModuleMode() == ModuleMode.ALL)
                  ? contents.openModuleLabel : contents.moduleLabel;
          Content tHeading = HtmlTree.HEADING(Headings.PAGE_TITLE_HEADING, true,
                  HtmlStyle.title, label);
<span class="udiff-line-modified-removed">-         tHeading.add(Contents.SPACE);</span>
<span class="udiff-line-modified-added">+         tHeading.add(Entity.NO_BREAK_SPACE);</span>
          Content moduleHead = new RawHtml(heading);
          tHeading.add(moduleHead);
          div.add(tHeading);
<span class="udiff-line-modified-removed">-         mainTree.add(div);</span>
<span class="udiff-line-modified-added">+         bodyContents.setHeader(headerContent)</span>
<span class="udiff-line-added">+                 .addMainContent(div);</span>
          return bodyTree;
      }
  
      /**
       * Get the content header.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -235,24 +226,23 @@</span>
      /**
       * Get the summary section header.
       */
      @Override
      public Content getSummaryHeader() {
<span class="udiff-line-modified-removed">-         HtmlTree li = new HtmlTree(HtmlTag.LI);</span>
<span class="udiff-line-modified-removed">-         li.setStyle(HtmlStyle.blockList);</span>
<span class="udiff-line-modified-removed">-         return li;</span>
<span class="udiff-line-modified-added">+         HtmlTree ul = new HtmlTree(HtmlTag.UL);</span>
<span class="udiff-line-modified-added">+         ul.setStyle(HtmlStyle.blockList);</span>
<span class="udiff-line-modified-added">+         return ul;</span>
      }
  
      /**
       * Get the summary tree.
       *
       * @param summaryContentTree the content tree to be added to the summary tree.
       */
      @Override
      public Content getSummaryTree(Content summaryContentTree) {
<span class="udiff-line-modified-removed">-         HtmlTree ul = HtmlTree.UL(HtmlStyle.blockList, summaryContentTree);</span>
<span class="udiff-line-removed">-         return ul;</span>
<span class="udiff-line-modified-added">+         return HtmlTree.SECTION(HtmlStyle.summary, summaryContentTree);</span>
      }
  
      /**
       * Compute the modules data that will be displayed in various tables on the module summary page.
       */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -266,22 +256,22 @@</span>
          dependentModules.forEach((module, mod) -&gt; {
              if (shouldDocument(module)) {
                  indirectModules.put(module, new StringContent(mod));
              }
          });
<span class="udiff-line-modified-removed">-         (ElementFilter.requiresIn(mdle.getDirectives())).forEach((directive) -&gt; {</span>
<span class="udiff-line-modified-added">+         ElementFilter.requiresIn(mdle.getDirectives()).forEach(directive -&gt; {</span>
              ModuleElement m = directive.getDependency();
              if (shouldDocument(m)) {
                  if (moduleMode == ModuleMode.ALL || directive.isTransitive()) {
                      requires.put(m, new StringContent(utils.getModifiers(directive)));
<span class="udiff-line-modified-removed">-             } else {</span>
<span class="udiff-line-modified-added">+                 } else {</span>
                      // For api mode, just keep the public requires in dependentModules for display of
                      // indirect packages in the &quot;Packages&quot; section.
                      dependentModules.remove(m);
                  }
                  indirectModules.remove(m);
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-added">+             }</span>
          });
  
          // Get all packages if module is open or if displaying concealed modules
          for (PackageElement pkg : utils.getModulePackageMap().getOrDefault(mdle, Collections.emptySet())) {
              if (shouldDocument(pkg) &amp;&amp; (mdle.isOpen() || moduleMode == ModuleMode.ALL)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -289,11 +279,11 @@</span>
                  if (mdle.isOpen()) {
                      e.openedTo = Collections.emptySet();
                  }
                  packages.put(pkg, e);
              }
<span class="udiff-line-modified-removed">-         };</span>
<span class="udiff-line-modified-added">+         }</span>
  
          // Get all exported packages for the module, using the exports directive for the module.
          for (ModuleElement.ExportsDirective directive : ElementFilter.exportsIn(mdle.getDirectives())) {
              PackageElement p = directive.getPackage();
              if (shouldDocument(p)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -329,74 +319,74 @@</span>
          }
  
          // Get all the exported and opened packages, for the transitive closure of the module, to be displayed in
          // the indirect packages tables.
          dependentModules.forEach((module, mod) -&gt; {
<span class="udiff-line-modified-removed">-             SortedSet&lt;PackageElement&gt; exportPkgList = new TreeSet&lt;&gt;(utils.makePackageComparator());</span>
<span class="udiff-line-modified-removed">-             (ElementFilter.exportsIn(module.getDirectives())).forEach((directive) -&gt; {</span>
<span class="udiff-line-modified-added">+             SortedSet&lt;PackageElement&gt; exportedPackages = new TreeSet&lt;&gt;(utils.makePackageComparator());</span>
<span class="udiff-line-modified-added">+             ElementFilter.exportsIn(module.getDirectives()).forEach(directive -&gt; {</span>
                  PackageElement pkg = directive.getPackage();
                  if (shouldDocument(pkg)) {
                      // Qualified exports are not displayed in API mode
                      if (moduleMode == ModuleMode.ALL || directive.getTargetModules() == null) {
<span class="udiff-line-modified-removed">-                         exportPkgList.add(pkg);</span>
<span class="udiff-line-modified-added">+                         exportedPackages.add(pkg);</span>
                      }
                  }
              });
              // If none of the indirect modules have exported packages to be displayed, we should not be
              // displaying the table and so it should not be added to the map.
<span class="udiff-line-modified-removed">-             if (!exportPkgList.isEmpty()) {</span>
<span class="udiff-line-modified-removed">-                 indirectPackages.put(module, exportPkgList);</span>
<span class="udiff-line-modified-added">+             if (!exportedPackages.isEmpty()) {</span>
<span class="udiff-line-modified-added">+                 indirectPackages.put(module, exportedPackages);</span>
              }
<span class="udiff-line-modified-removed">-             SortedSet&lt;PackageElement&gt; openPkgList = new TreeSet&lt;&gt;(utils.makePackageComparator());</span>
<span class="udiff-line-modified-added">+             SortedSet&lt;PackageElement&gt; openPackages = new TreeSet&lt;&gt;(utils.makePackageComparator());</span>
              if (module.isOpen()) {
<span class="udiff-line-modified-removed">-                 openPkgList.addAll(utils.getModulePackageMap().getOrDefault(module, Collections.emptySet()));</span>
<span class="udiff-line-modified-added">+                 openPackages.addAll(utils.getModulePackageMap().getOrDefault(module, Collections.emptySet()));</span>
              } else {
<span class="udiff-line-modified-removed">-                 (ElementFilter.opensIn(module.getDirectives())).forEach((directive) -&gt; {</span>
<span class="udiff-line-modified-added">+                 ElementFilter.opensIn(module.getDirectives()).forEach(directive -&gt; {</span>
                      PackageElement pkg = directive.getPackage();
                      if (shouldDocument(pkg)) {
                          // Qualified opens are not displayed in API mode
                          if (moduleMode == ModuleMode.ALL || directive.getTargetModules() == null) {
<span class="udiff-line-modified-removed">-                             openPkgList.add(pkg);</span>
<span class="udiff-line-modified-added">+                             openPackages.add(pkg);</span>
                          }
                      }
                  });
              }
              // If none of the indirect modules have opened packages to be displayed, we should not be
              // displaying the table and so it should not be added to the map.
<span class="udiff-line-modified-removed">-             if (!openPkgList.isEmpty()) {</span>
<span class="udiff-line-modified-removed">-                 indirectOpenPackages.put(module, openPkgList);</span>
<span class="udiff-line-modified-added">+             if (!openPackages.isEmpty()) {</span>
<span class="udiff-line-modified-added">+                 indirectOpenPackages.put(module, openPackages);</span>
              }
          });
          // Get all the services listed as uses directive.
<span class="udiff-line-modified-removed">-         (ElementFilter.usesIn(mdle.getDirectives())).forEach((directive) -&gt; {</span>
<span class="udiff-line-modified-added">+         ElementFilter.usesIn(mdle.getDirectives()).forEach(directive -&gt; {</span>
              TypeElement u = directive.getService();
              if (shouldDocument(u)) {
                  uses.add(u);
              }
          });
          // Get all the services and implementations listed as provides directive.
<span class="udiff-line-modified-removed">-         (ElementFilter.providesIn(mdle.getDirectives())).forEach((directive) -&gt; {</span>
<span class="udiff-line-modified-added">+         ElementFilter.providesIn(mdle.getDirectives()).forEach(directive -&gt; {</span>
              TypeElement u = directive.getService();
              if (shouldDocument(u)) {
                  List&lt;? extends TypeElement&gt; implList = directive.getImplementations();
                  SortedSet&lt;TypeElement&gt; implSet = new TreeSet&lt;&gt;(utils.makeAllClassesComparator());
                  implSet.addAll(implList);
                  provides.put(u, implSet);
              }
          });
          // Generate the map of all services listed using @provides, and the description.
<span class="udiff-line-modified-removed">-         (utils.getBlockTags(mdle, DocTree.Kind.PROVIDES)).forEach((tree) -&gt; {</span>
<span class="udiff-line-modified-removed">-             TypeElement t = ch.getServiceType(configuration, tree);</span>
<span class="udiff-line-modified-added">+         utils.getBlockTags(mdle, DocTree.Kind.PROVIDES).forEach(tree -&gt; {</span>
<span class="udiff-line-modified-added">+             TypeElement t = ch.getServiceType(tree);</span>
              if (t != null) {
<span class="udiff-line-modified-removed">-                 providesTrees.put(t, commentTagsToContent(tree, mdle, ch.getDescription(configuration, tree), false, true));</span>
<span class="udiff-line-modified-added">+                 providesTrees.put(t, commentTagsToContent(tree, mdle, ch.getDescription(tree), false, true));</span>
              }
          });
          // Generate the map of all services listed using @uses, and the description.
<span class="udiff-line-modified-removed">-         (utils.getBlockTags(mdle, DocTree.Kind.USES)).forEach((tree) -&gt; {</span>
<span class="udiff-line-modified-removed">-             TypeElement t = ch.getServiceType(configuration, tree);</span>
<span class="udiff-line-modified-added">+         utils.getBlockTags(mdle, DocTree.Kind.USES).forEach(tree -&gt; {</span>
<span class="udiff-line-modified-added">+             TypeElement t = ch.getServiceType(tree);</span>
              if (t != null) {
<span class="udiff-line-modified-removed">-                 usesTrees.put(t, commentTagsToContent(tree, mdle, ch.getDescription(configuration, tree), false, true));</span>
<span class="udiff-line-modified-added">+                 usesTrees.put(t, commentTagsToContent(tree, mdle, ch.getDescription(tree), false, true));</span>
              }
          });
      }
  
      /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -434,11 +424,11 @@</span>
       * the typeElements set is referenced by a javadoc tag in tagsMap.
       */
      private boolean displayServices(Set&lt;TypeElement&gt; typeElements,
                                      Map&lt;TypeElement, Content&gt; tagsMap) {
          return typeElements != null &amp;&amp;
<span class="udiff-line-modified-removed">-                 typeElements.stream().anyMatch((v) -&gt; displayServiceDirective(v, tagsMap));</span>
<span class="udiff-line-modified-added">+                 typeElements.stream().anyMatch(v -&gt; displayServiceDirective(v, tagsMap));</span>
      }
  
      /*
       * Returns true, in API mode, if the type element is referenced
       * from a javadoc tag in tagsMap.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -450,18 +440,16 @@</span>
  
      /**
       * Add the summary header.
       *
       * @param startMarker the marker comment
<span class="udiff-line-removed">-      * @param markerAnchor the marker anchor for the section</span>
       * @param heading the heading for the section
       * @param htmltree the content tree to which the information is added
       */
<span class="udiff-line-modified-removed">-     public void addSummaryHeader(Content startMarker, SectionName markerAnchor, Content heading,</span>
<span class="udiff-line-modified-added">+     public void addSummaryHeader(Content startMarker, Content heading,</span>
              Content htmltree) {
          htmltree.add(startMarker);
<span class="udiff-line-removed">-         htmltree.add(links.createAnchor(markerAnchor));</span>
          htmltree.add(HtmlTree.HEADING(Headings.ModuleDeclaration.SUMMARY_HEADING, heading));
      }
  
      /**
       * Get a table, with two columns.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -495,33 +483,29 @@</span>
                  .setHeader(tableHeader)
                  .setRowScopeColumn(1)
                  .setColumnStyles(HtmlStyle.colFirst, HtmlStyle.colSecond, HtmlStyle.colLast);
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      */</span>
      @Override
      public void addModulesSummary(Content summaryContentTree) {
          if (display(requires) || display(indirectModules)) {
              TableHeader requiresTableHeader =
                      new TableHeader(contents.modifierLabel, contents.moduleLabel,
                              contents.descriptionLabel);
<span class="udiff-line-modified-removed">-             HtmlTree li = new HtmlTree(HtmlTag.LI);</span>
<span class="udiff-line-modified-removed">-             li.setStyle(HtmlStyle.blockList);</span>
<span class="udiff-line-modified-removed">-             addSummaryHeader(MarkerComments.START_OF_MODULES_SUMMARY, SectionName.MODULES,</span>
<span class="udiff-line-removed">-                     contents.navModules, li);</span>
<span class="udiff-line-modified-added">+             HtmlTree section = HtmlTree.SECTION(HtmlStyle.modulesSummary)</span>
<span class="udiff-line-modified-added">+                     .setId(SectionName.MODULES.getName());</span>
<span class="udiff-line-modified-added">+             addSummaryHeader(MarkerComments.START_OF_MODULES_SUMMARY, contents.navModules, section);</span>
              if (display(requires)) {
                  String text = resources.getText(&quot;doclet.Requires_Summary&quot;);
                  String tableSummary = resources.getText(&quot;doclet.Member_Table_Summary&quot;,
                          text,
                          resources.getText(&quot;doclet.modules&quot;));
                  Content caption = getTableCaption(new StringContent(text));
                  Table table = getTable3(caption, tableSummary, HtmlStyle.requiresSummary,
                              requiresTableHeader);
                  addModulesList(requires, table);
<span class="udiff-line-modified-removed">-                 li.add(table.toContent());</span>
<span class="udiff-line-modified-added">+                 section.add(table.toContent());</span>
              }
              // Display indirect modules table in both &quot;api&quot; and &quot;all&quot; mode.
              if (display(indirectModules)) {
                  String amrText = resources.getText(&quot;doclet.Indirect_Requires_Summary&quot;);
                  String amrTableSummary = resources.getText(&quot;doclet.Member_Table_Summary&quot;,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -529,22 +513,21 @@</span>
                          resources.getText(&quot;doclet.modules&quot;));
                  Content amrCaption = getTableCaption(new StringContent(amrText));
                  Table amrTable = getTable3(amrCaption, amrTableSummary, HtmlStyle.requiresSummary,
                              requiresTableHeader);
                  addModulesList(indirectModules, amrTable);
<span class="udiff-line-modified-removed">-                 li.add(amrTable.toContent());</span>
<span class="udiff-line-modified-added">+                 section.add(amrTable.toContent());</span>
              }
<span class="udiff-line-modified-removed">-             HtmlTree ul = HtmlTree.UL(HtmlStyle.blockList, li);</span>
<span class="udiff-line-removed">-             summaryContentTree.add(ul);</span>
<span class="udiff-line-modified-added">+             summaryContentTree.add(HtmlTree.LI(HtmlStyle.blockList, section));</span>
          }
      }
  
      /**
       * Add the list of modules.
       *
       * @param mdleMap map of modules and modifiers
<span class="udiff-line-modified-removed">-      * @param tbody the content tree to which the list will be added</span>
<span class="udiff-line-modified-added">+      * @param table the table to which the list will be added</span>
       */
      private void addModulesList(Map&lt;ModuleElement, Content&gt; mdleMap, Table table) {
          for (ModuleElement m : mdleMap.keySet()) {
              Content modifiers = mdleMap.get(m);
              Content moduleLink = getModuleLink(m, new StringContent(m.getQualifiedName()));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -556,35 +539,33 @@</span>
  
      @Override
      public void addPackagesSummary(Content summaryContentTree) {
          if (display(packages)
                  || display(indirectPackages) || display(indirectOpenPackages)) {
<span class="udiff-line-modified-removed">-             HtmlTree li = new HtmlTree(HtmlTag.LI);</span>
<span class="udiff-line-modified-removed">-             li.setStyle(HtmlStyle.blockList);</span>
<span class="udiff-line-modified-removed">-             addSummaryHeader(MarkerComments.START_OF_PACKAGES_SUMMARY, SectionName.PACKAGES,</span>
<span class="udiff-line-removed">-                     contents.navPackages, li);</span>
<span class="udiff-line-modified-added">+             HtmlTree section = HtmlTree.SECTION(HtmlStyle.packagesSummary)</span>
<span class="udiff-line-modified-added">+                     .setId(SectionName.PACKAGES.getName());;</span>
<span class="udiff-line-modified-added">+             addSummaryHeader(MarkerComments.START_OF_PACKAGES_SUMMARY, contents.navPackages, section);</span>
              if (display(packages)) {
<span class="udiff-line-modified-removed">-                 addPackageSummary(li);</span>
<span class="udiff-line-modified-added">+                 addPackageSummary(section);</span>
              }
              TableHeader indirectPackagesHeader =
                      new TableHeader(contents.fromLabel, contents.packagesLabel);
              if (display(indirectPackages)) {
                  String aepText = resources.getText(&quot;doclet.Indirect_Exports_Summary&quot;);
                  Table aepTable = getTable2(new StringContent(aepText),
                          HtmlStyle.packagesSummary, indirectPackagesHeader);
                  addIndirectPackages(aepTable, indirectPackages);
<span class="udiff-line-modified-removed">-                 li.add(aepTable.toContent());</span>
<span class="udiff-line-modified-added">+                 section.add(aepTable.toContent());</span>
              }
              if (display(indirectOpenPackages)) {
                  String aopText = resources.getText(&quot;doclet.Indirect_Opens_Summary&quot;);
                  Table aopTable = getTable2(new StringContent(aopText), HtmlStyle.packagesSummary,
                          indirectPackagesHeader);
                  addIndirectPackages(aopTable, indirectOpenPackages);
<span class="udiff-line-modified-removed">-                 li.add(aopTable.toContent());</span>
<span class="udiff-line-modified-added">+                 section.add(aopTable.toContent());</span>
              }
<span class="udiff-line-modified-removed">-             HtmlTree ul = HtmlTree.UL(HtmlStyle.blockList, li);</span>
<span class="udiff-line-removed">-             summaryContentTree.add(ul);</span>
<span class="udiff-line-modified-added">+             summaryContentTree.add(HtmlTree.LI(HtmlStyle.blockList, section));</span>
          }
      }
  
      /**
       * Add the package summary for the module.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -725,46 +706,41 @@</span>
              }
              table.addRow(moduleLinkContent, list);
          }
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      */</span>
      @Override
      public void addServicesSummary(Content summaryContentTree) {
  
          boolean haveUses = displayServices(uses, usesTrees);
          boolean haveProvides = displayServices(provides.keySet(), providesTrees);
  
          if (haveProvides || haveUses) {
<span class="udiff-line-modified-removed">-             HtmlTree li = new HtmlTree(HtmlTag.LI);</span>
<span class="udiff-line-modified-removed">-             li.setStyle(HtmlStyle.blockList);</span>
<span class="udiff-line-modified-removed">-             addSummaryHeader(MarkerComments.START_OF_SERVICES_SUMMARY, SectionName.SERVICES,</span>
<span class="udiff-line-removed">-                     contents.navServices, li);</span>
<span class="udiff-line-modified-added">+             HtmlTree section = HtmlTree.SECTION(HtmlStyle.servicesSummary)</span>
<span class="udiff-line-modified-added">+                     .setId(SectionName.SERVICES.getName());</span>
<span class="udiff-line-modified-added">+             addSummaryHeader(MarkerComments.START_OF_SERVICES_SUMMARY, contents.navServices, section);</span>
              TableHeader usesProvidesTableHeader =
                      new TableHeader(contents.typeLabel, contents.descriptionLabel);
              if (haveProvides) {
                  String label = resources.getText(&quot;doclet.Provides_Summary&quot;);
                  Table table = getTable2(new StringContent(label), HtmlStyle.providesSummary,
                          usesProvidesTableHeader);
                  addProvidesList(table);
                  if (!table.isEmpty()) {
<span class="udiff-line-modified-removed">-                     li.add(table.toContent());</span>
<span class="udiff-line-modified-added">+                     section.add(table.toContent());</span>
                  }
              }
              if (haveUses){
                  String label = resources.getText(&quot;doclet.Uses_Summary&quot;);
                  Table table = getTable2(new StringContent(label), HtmlStyle.usesSummary,
                          usesProvidesTableHeader);
                  addUsesList(table);
                  if (!table.isEmpty()) {
<span class="udiff-line-modified-removed">-                     li.add(table.toContent());</span>
<span class="udiff-line-modified-added">+                     section.add(table.toContent());</span>
                  }
              }
<span class="udiff-line-modified-removed">-             HtmlTree ul = HtmlTree.UL(HtmlStyle.blockList, li);</span>
<span class="udiff-line-removed">-             summaryContentTree.add(ul);</span>
<span class="udiff-line-modified-added">+             summaryContentTree.add(HtmlTree.LI(HtmlStyle.blockList, section));</span>
          }
      }
  
      /**
       * Add the uses list for the module.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -786,11 +762,11 @@</span>
                      summary.add(HtmlTree.DIV(HtmlStyle.block, description));
                  } else {
                      addSummaryComment(t, summary);
                  }
              } else {
<span class="udiff-line-modified-removed">-                 summary.add(Contents.SPACE);</span>
<span class="udiff-line-modified-added">+                 summary.add(Entity.NO_BREAK_SPACE);</span>
              }
              table.addRow(typeLinkContent, summary);
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -812,21 +788,21 @@</span>
              Content desc = new ContentBuilder();
              if (display(providesTrees)) {
                  description = providesTrees.get(srv);
                  desc.add((description != null &amp;&amp; !description.isEmpty())
                          ? HtmlTree.DIV(HtmlStyle.block, description)
<span class="udiff-line-modified-removed">-                         : Contents.SPACE);</span>
<span class="udiff-line-modified-added">+                         : Entity.NO_BREAK_SPACE);</span>
              } else {
<span class="udiff-line-modified-removed">-                 desc.add(Contents.SPACE);</span>
<span class="udiff-line-modified-added">+                 desc.add(Entity.NO_BREAK_SPACE);</span>
                  }
              // Only display the implementation details in the &quot;all&quot; mode.
              if (moduleMode == ModuleMode.ALL &amp;&amp; !implSet.isEmpty()) {
                  desc.add(new HtmlTree(HtmlTag.BR));
                  desc.add(&quot;(&quot;);
                  HtmlTree implSpan = HtmlTree.SPAN(HtmlStyle.implementationLabel, contents.implementation);
                  desc.add(implSpan);
<span class="udiff-line-modified-removed">-                 desc.add(Contents.SPACE);</span>
<span class="udiff-line-modified-added">+                 desc.add(Entity.NO_BREAK_SPACE);</span>
                  String sep = &quot;&quot;;
                  for (TypeElement impl : implSet) {
                      desc.add(sep);
                      desc.add(getLink(new LinkInfoImpl(configuration, LinkInfoImpl.Kind.PACKAGE, impl)));
                      sep = &quot;, &quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -849,75 +825,57 @@</span>
              HtmlTree deprDiv = new HtmlTree(HtmlTag.DIV);
              deprDiv.setStyle(HtmlStyle.deprecationBlock);
              Content deprPhrase = HtmlTree.SPAN(HtmlStyle.deprecatedLabel, getDeprecatedPhrase(mdle));
              deprDiv.add(deprPhrase);
              if (!deprs.isEmpty()) {
<span class="udiff-line-modified-removed">-                 List&lt;? extends DocTree&gt; commentTags = ch.getDescription(configuration, deprs.get(0));</span>
<span class="udiff-line-modified-added">+                 List&lt;? extends DocTree&gt; commentTags = ch.getDescription(deprs.get(0));</span>
                  if (!commentTags.isEmpty()) {
                      addInlineDeprecatedComment(mdle, deprs.get(0), deprDiv);
                  }
              }
              div.add(deprDiv);
          }
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      */</span>
      @Override
      public void addModuleDescription(Content moduleContentTree) {
          if (!utils.getFullBody(mdle).isEmpty()) {
<span class="udiff-line-modified-removed">-             Content tree = HtmlTree.SECTION();</span>
<span class="udiff-line-modified-added">+             HtmlTree tree = HtmlTree.SECTION(HtmlStyle.moduleDescription);</span>
<span class="udiff-line-added">+             tree.setId(SectionName.MODULE_DESCRIPTION.getName());</span>
              addDeprecationInfo(tree);
              tree.add(MarkerComments.START_OF_MODULE_DESCRIPTION);
<span class="udiff-line-removed">-             tree.add(links.createAnchor(SectionName.MODULE_DESCRIPTION));</span>
              addInlineComment(mdle, tree);
              moduleContentTree.add(tree);
          }
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      */</span>
      @Override
      public void addModuleTags(Content moduleContentTree) {
<span class="udiff-line-modified-removed">-         Content tree = HtmlTree.SECTION();</span>
<span class="udiff-line-modified-added">+         Content tree = HtmlTree.SECTION(HtmlStyle.moduleTags);</span>
          addTagsInfo(mdle, tree);
          moduleContentTree.add(tree);
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      */</span>
      @Override
<span class="udiff-line-modified-removed">-     public void addModuleContent(Content contentTree, Content moduleContentTree) {</span>
<span class="udiff-line-modified-removed">-         mainTree.add(moduleContentTree);</span>
<span class="udiff-line-removed">-         contentTree.add(mainTree);</span>
<span class="udiff-line-modified-added">+     public void addModuleContent(Content moduleContentTree) {</span>
<span class="udiff-line-modified-added">+         bodyContents.addMainContent(moduleContentTree);</span>
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      */</span>
      @Override
<span class="udiff-line-modified-removed">-     public void addModuleFooter(Content contentTree) {</span>
<span class="udiff-line-modified-added">+     public void addModuleFooter() {</span>
          Content htmlTree = HtmlTree.FOOTER();
          navBar.setUserFooter(getUserHeaderFooter(false));
          htmlTree.add(navBar.getContent(false));
          addBottom(htmlTree);
<span class="udiff-line-modified-removed">-         contentTree.add(htmlTree);</span>
<span class="udiff-line-modified-added">+         bodyContents.setFooter(htmlTree);</span>
      }
  
<span class="udiff-line-removed">-     /**</span>
<span class="udiff-line-removed">-      * {@inheritDoc}</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-removed">-      * @throws jdk.javadoc.internal.doclets.toolkit.util.DocFileIOException</span>
<span class="udiff-line-removed">-      */</span>
      @Override
      public void printDocument(Content contentTree) throws DocFileIOException {
<span class="udiff-line-added">+         contentTree.add(bodyContents.toContent());</span>
          printHtmlDocument(configuration.metakeywords.getMetaKeywordsForModule(mdle),
<span class="udiff-line-modified-removed">-                 getDescription(&quot;declaration&quot;, mdle),</span>
<span class="udiff-line-removed">-                 contentTree);</span>
<span class="udiff-line-modified-added">+                 getDescription(&quot;declaration&quot;, mdle), getLocalStylesheets(mdle), contentTree);</span>
      }
  
      /**
       * Add the module package deprecation information to the documentation tree.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -932,11 +890,11 @@</span>
              deprDiv.setStyle(HtmlStyle.deprecationBlock);
              Content deprPhrase = HtmlTree.SPAN(HtmlStyle.deprecatedLabel, getDeprecatedPhrase(pkg));
              deprDiv.add(deprPhrase);
              if (!deprs.isEmpty()) {
                  CommentHelper ch = utils.getCommentHelper(pkg);
<span class="udiff-line-modified-removed">-                 List&lt;? extends DocTree&gt; commentTags = ch.getDescription(configuration, deprs.get(0));</span>
<span class="udiff-line-modified-added">+                 List&lt;? extends DocTree&gt; commentTags = ch.getDescription(deprs.get(0));</span>
                  if (!commentTags.isEmpty()) {
                      addInlineDeprecatedComment(pkg, deprs.get(0), deprDiv);
                  }
              }
              li.add(deprDiv);
</pre>
<center><a href="ModuleIndexWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="NestedClassWriterImpl.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>