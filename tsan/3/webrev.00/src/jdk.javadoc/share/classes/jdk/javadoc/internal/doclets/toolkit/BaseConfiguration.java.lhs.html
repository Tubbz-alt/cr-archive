<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/BaseConfiguration.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
<a name="1" id="anc1"></a><span class="line-modified">   2  * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package jdk.javadoc.internal.doclets.toolkit;
  27 
  28 import java.io.*;
  29 import java.util.*;
  30 
  31 import javax.lang.model.element.Element;
  32 import javax.lang.model.element.ModuleElement;
  33 import javax.lang.model.element.PackageElement;
  34 import javax.lang.model.element.TypeElement;
<a name="2" id="anc2"></a><span class="line-modified">  35 import javax.lang.model.util.SimpleElementVisitor9;</span>
  36 import javax.tools.JavaFileManager;
  37 import javax.tools.JavaFileObject;
  38 
  39 import com.sun.source.util.DocTreePath;
  40 import com.sun.tools.javac.util.DefinedBy;
  41 import com.sun.tools.javac.util.DefinedBy.Api;
  42 import jdk.javadoc.doclet.Doclet;
  43 import jdk.javadoc.doclet.DocletEnvironment;
  44 import jdk.javadoc.doclet.Reporter;
  45 import jdk.javadoc.doclet.StandardDoclet;
  46 import jdk.javadoc.doclet.Taglet;
  47 import jdk.javadoc.internal.doclets.formats.html.HtmlDoclet;
  48 import jdk.javadoc.internal.doclets.toolkit.builders.BuilderFactory;
  49 import jdk.javadoc.internal.doclets.toolkit.taglets.TagletManager;
  50 import jdk.javadoc.internal.doclets.toolkit.util.DocFile;
  51 import jdk.javadoc.internal.doclets.toolkit.util.DocFileFactory;
  52 import jdk.javadoc.internal.doclets.toolkit.util.DocFileIOException;
<a name="3" id="anc3"></a><span class="line-removed">  53 import jdk.javadoc.internal.doclets.toolkit.util.DocletConstants;</span>
  54 import jdk.javadoc.internal.doclets.toolkit.util.Extern;
  55 import jdk.javadoc.internal.doclets.toolkit.util.Group;
  56 import jdk.javadoc.internal.doclets.toolkit.util.MetaKeywords;
  57 import jdk.javadoc.internal.doclets.toolkit.util.SimpleDocletException;
  58 import jdk.javadoc.internal.doclets.toolkit.util.TypeElementCatalog;
  59 import jdk.javadoc.internal.doclets.toolkit.util.Utils;
  60 import jdk.javadoc.internal.doclets.toolkit.util.Utils.Pair;
  61 import jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberCache;
  62 import jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable;
  63 
<a name="4" id="anc4"></a><span class="line-removed">  64 import static javax.tools.Diagnostic.Kind.*;</span>
<span class="line-removed">  65 </span>
  66 /**
  67  * Configure the output based on the options. Doclets should sub-class
  68  * BaseConfiguration, to configure and add their own options. This class contains
  69  * all user options which are supported by the standard doclet.
  70  * &lt;p&gt;
  71  * &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
  72  * If you write code that depends on this, you do so at your own risk.
  73  * This code and its internal interfaces are subject to change or
  74  * deletion without notice.&lt;/b&gt;
<a name="5" id="anc5"></a><span class="line-removed">  75  *</span>
<span class="line-removed">  76  * @author Robert Field.</span>
<span class="line-removed">  77  * @author Atul Dambalkar.</span>
<span class="line-removed">  78  * @author Jamie Ho</span>
  79  */
  80 public abstract class BaseConfiguration {
  81     /**
  82      * The doclet that created this configuration.
  83      */
  84     public final Doclet doclet;
  85 
  86     /**
  87      * The factory for builders.
  88      */
  89     protected BuilderFactory builderFactory;
  90 
  91     /**
  92      * The taglet manager.
  93      */
  94     public TagletManager tagletManager;
  95 
  96     /**
  97      * The path to the builder XML input file.
  98      */
  99     public String builderXMLPath;
 100 
 101     /**
 102      * The default path to the builder XML.
 103      */
 104     public static final String DEFAULT_BUILDER_XML = &quot;resources/doclet.xml&quot;;
 105 
<a name="6" id="anc6"></a><span class="line-removed"> 106     /**</span>
<span class="line-removed"> 107      * The path to Taglets</span>
<span class="line-removed"> 108      */</span>
<span class="line-removed"> 109     public String tagletpath = null;</span>
<span class="line-removed"> 110 </span>
<span class="line-removed"> 111     /**</span>
<span class="line-removed"> 112      * This is true if option &quot;-serialwarn&quot; is used. Defualt value is false to</span>
<span class="line-removed"> 113      * suppress excessive warnings about serial tag.</span>
<span class="line-removed"> 114      */</span>
<span class="line-removed"> 115     public boolean serialwarn = false;</span>
<span class="line-removed"> 116 </span>
<span class="line-removed"> 117     /**</span>
<span class="line-removed"> 118      * The specified amount of space between tab stops.</span>
<span class="line-removed"> 119      */</span>
<span class="line-removed"> 120     public int sourcetab;</span>
<span class="line-removed"> 121 </span>
<span class="line-removed"> 122     public String tabSpaces;</span>
<span class="line-removed"> 123 </span>
<span class="line-removed"> 124     /**</span>
<span class="line-removed"> 125      * True if we should generate browsable sources.</span>
<span class="line-removed"> 126      */</span>
<span class="line-removed"> 127     public boolean linksource = false;</span>
<span class="line-removed"> 128 </span>
<span class="line-removed"> 129     /**</span>
<span class="line-removed"> 130      * True if command line option &quot;-nosince&quot; is used. Default value is</span>
<span class="line-removed"> 131      * false.</span>
<span class="line-removed"> 132      */</span>
<span class="line-removed"> 133     public boolean nosince = false;</span>
<span class="line-removed"> 134 </span>
<span class="line-removed"> 135     /**</span>
<span class="line-removed"> 136      * True if we should recursively copy the doc-file subdirectories</span>
<span class="line-removed"> 137      */</span>
<span class="line-removed"> 138     public boolean copydocfilesubdirs = false;</span>
<span class="line-removed"> 139 </span>
 140     /**
 141      * Maintain backward compatibility with previous javadoc version
 142      */
 143     public boolean backwardCompatibility = true;
 144 
<a name="7" id="anc7"></a><span class="line-removed"> 145     /**</span>
<span class="line-removed"> 146      * True if user wants to add member names as meta keywords.</span>
<span class="line-removed"> 147      * Set to false because meta keywords are ignored in general</span>
<span class="line-removed"> 148      * by most Internet search engines.</span>
<span class="line-removed"> 149      */</span>
<span class="line-removed"> 150     public boolean keywords = false;</span>
<span class="line-removed"> 151 </span>
 152     /**
 153      * The meta tag keywords instance.
 154      */
<a name="8" id="anc8"></a><span class="line-modified"> 155     public final MetaKeywords metakeywords;</span>
<span class="line-removed"> 156 </span>
<span class="line-removed"> 157     /**</span>
<span class="line-removed"> 158      * The set of doc-file subdirectories to exclude</span>
<span class="line-removed"> 159      */</span>
<span class="line-removed"> 160     protected Set&lt;String&gt; excludedDocFileDirs;</span>
<span class="line-removed"> 161 </span>
<span class="line-removed"> 162     /**</span>
<span class="line-removed"> 163      * The set of qualifiers to exclude</span>
<span class="line-removed"> 164      */</span>
<span class="line-removed"> 165     protected Set&lt;String&gt; excludedQualifiers;</span>
 166 
 167     /**
 168      * The doclet environment.
 169      */
 170     public DocletEnvironment docEnv;
 171 
 172     /**
 173      * An utility class for commonly used helpers
 174      */
 175     public Utils utils;
 176 
 177     /**
 178      * All the temporary accessors to javac internals.
 179      */
 180     public WorkArounds workArounds;
 181 
<a name="9" id="anc9"></a><span class="line-removed"> 182     /**</span>
<span class="line-removed"> 183      * Destination directory name, in which doclet will generate the entire</span>
<span class="line-removed"> 184      * documentation. Default is current directory.</span>
<span class="line-removed"> 185      */</span>
<span class="line-removed"> 186     public String destDirName = &quot;&quot;;</span>
<span class="line-removed"> 187 </span>
<span class="line-removed"> 188     /**</span>
<span class="line-removed"> 189      * Destination directory name, in which doclet will copy the doc-files to.</span>
<span class="line-removed"> 190      */</span>
<span class="line-removed"> 191     public String docFileDestDirName = &quot;&quot;;</span>
<span class="line-removed"> 192 </span>
<span class="line-removed"> 193     /**</span>
<span class="line-removed"> 194      * Encoding for this document. Default is default encoding for this</span>
<span class="line-removed"> 195      * platform.</span>
<span class="line-removed"> 196      */</span>
<span class="line-removed"> 197     public String docencoding = null;</span>
<span class="line-removed"> 198 </span>
<span class="line-removed"> 199     /**</span>
<span class="line-removed"> 200      * True if user wants to suppress descriptions and tags.</span>
<span class="line-removed"> 201      */</span>
<span class="line-removed"> 202     public boolean nocomment = false;</span>
<span class="line-removed"> 203 </span>
<span class="line-removed"> 204     /**</span>
<span class="line-removed"> 205      * Encoding for this document. Default is default encoding for this</span>
<span class="line-removed"> 206      * platform.</span>
<span class="line-removed"> 207      */</span>
<span class="line-removed"> 208     public String encoding = null;</span>
<span class="line-removed"> 209 </span>
<span class="line-removed"> 210     /**</span>
<span class="line-removed"> 211      * Generate author specific information for all the classes if @author</span>
<span class="line-removed"> 212      * tag is used in the doc comment and if -author option is used.</span>
<span class="line-removed"> 213      * &lt;code&gt;showauthor&lt;/code&gt; is set to true if -author option is used.</span>
<span class="line-removed"> 214      * Default is don&#39;t show author information.</span>
<span class="line-removed"> 215      */</span>
<span class="line-removed"> 216     public boolean showauthor = false;</span>
<span class="line-removed"> 217 </span>
<span class="line-removed"> 218     /**</span>
<span class="line-removed"> 219      * Generate documentation for JavaFX getters and setters automatically</span>
<span class="line-removed"> 220      * by copying it from the appropriate property definition.</span>
<span class="line-removed"> 221      */</span>
<span class="line-removed"> 222     public boolean javafx = false;</span>
<span class="line-removed"> 223 </span>
<span class="line-removed"> 224     /**</span>
<span class="line-removed"> 225      * Generate version specific information for the all the classes</span>
<span class="line-removed"> 226      * if @version tag is used in the doc comment and if -version option is</span>
<span class="line-removed"> 227      * used. &lt;code&gt;showversion&lt;/code&gt; is set to true if -version option is</span>
<span class="line-removed"> 228      * used.Default is don&#39;t show version information.</span>
<span class="line-removed"> 229      */</span>
<span class="line-removed"> 230     public boolean showversion = false;</span>
<span class="line-removed"> 231 </span>
<span class="line-removed"> 232     /**</span>
<span class="line-removed"> 233      * Allow JavaScript in doc comments.</span>
<span class="line-removed"> 234      */</span>
<span class="line-removed"> 235     private boolean allowScriptInComments = false;</span>
<span class="line-removed"> 236 </span>
 237     /**
 238      * Sourcepath from where to read the source files. Default is classpath.
 239      */
 240     public String sourcepath = &quot;&quot;;
 241 
 242     /**
 243      * Generate modules documentation if more than one module is present.
 244      */
 245     public boolean showModules = false;
 246 
<a name="10" id="anc10"></a><span class="line-removed"> 247     /**</span>
<span class="line-removed"> 248      * Don&#39;t generate deprecated API information at all, if -nodeprecated</span>
<span class="line-removed"> 249      * option is used. &lt;code&gt;nodepracted&lt;/code&gt; is set to true if</span>
<span class="line-removed"> 250      * -nodeprecated option is used. Default is generate deprected API</span>
<span class="line-removed"> 251      * information.</span>
<span class="line-removed"> 252      */</span>
<span class="line-removed"> 253     public boolean nodeprecated = false;</span>
<span class="line-removed"> 254 </span>
 255     /**
 256      * The catalog of classes specified on the command-line
 257      */
 258     public TypeElementCatalog typeElementCatalog;
 259 
<a name="11" id="anc11"></a><span class="line-removed"> 260     /**</span>
<span class="line-removed"> 261      * True if user wants to suppress time stamp in output.</span>
<span class="line-removed"> 262      * Default is false.</span>
<span class="line-removed"> 263      */</span>
<span class="line-removed"> 264     public boolean notimestamp = false;</span>
<span class="line-removed"> 265 </span>
 266     /**
 267      * The package grouping instance.
 268      */
 269     public final Group group = new Group(this);
 270 
 271     /**
 272      * The tracker of external package links.
 273      */
 274     public Extern extern;
 275 
<a name="12" id="anc12"></a><span class="line-modified"> 276     public Reporter reporter;</span>
<span class="line-removed"> 277 </span>
<span class="line-removed"> 278     public Locale locale;</span>
<span class="line-removed"> 279 </span>
<span class="line-removed"> 280     /**</span>
<span class="line-removed"> 281      * Suppress all messages</span>
<span class="line-removed"> 282      */</span>
<span class="line-removed"> 283     public boolean quiet = false;</span>
<span class="line-removed"> 284 </span>
<span class="line-removed"> 285     /**</span>
<span class="line-removed"> 286      * Specifies whether those methods that override a super-type&#39;s method</span>
<span class="line-removed"> 287      * with no changes to the API contract should be summarized in the</span>
<span class="line-removed"> 288      * footnote section.</span>
<span class="line-removed"> 289      */</span>
<span class="line-removed"> 290     public boolean summarizeOverriddenMethods = false;</span>
<span class="line-removed"> 291 </span>
<span class="line-removed"> 292     // A list containing urls</span>
<span class="line-removed"> 293     private final List&lt;String&gt; linkList = new ArrayList&lt;&gt;();</span>
<span class="line-removed"> 294 </span>
<span class="line-removed"> 295      // A list of pairs containing urls and package list</span>
<span class="line-removed"> 296     private final List&lt;Pair&lt;String, String&gt;&gt; linkOfflineList = new ArrayList&lt;&gt;();</span>
<span class="line-removed"> 297 </span>
<span class="line-removed"> 298     /**</span>
<span class="line-removed"> 299      * Flag to enable/disable use of module directories when generating docs for modules</span>
<span class="line-removed"> 300      * Default: on (module directories are enabled).</span>
<span class="line-removed"> 301      */</span>
<span class="line-removed"> 302     public boolean useModuleDirectories = true;</span>
<span class="line-removed"> 303 </span>
<span class="line-removed"> 304     public boolean dumpOnError = false;</span>
 305 
<a name="13" id="anc13"></a><span class="line-modified"> 306     private List&lt;Pair&lt;String, String&gt;&gt; groupPairs;</span>
 307 
 308     public abstract Messages getMessages();
 309 
<a name="14" id="anc14"></a><span class="line-modified"> 310     public abstract Resources getResources();</span>
 311 
 312     /**
 313      * Returns a string identifying the version of the doclet.
 314      *
 315      * @return a version string
 316      */
 317     public abstract String getDocletVersion();
 318 
 319     /**
 320      * This method should be defined in all those doclets (configurations),
 321      * which want to derive themselves from this BaseConfiguration. This method
 322      * can be used to finish up the options setup.
 323      *
 324      * @return true if successful and false otherwise
 325      */
 326 
 327     public abstract boolean finishOptionSettings();
 328 
 329     public CommentUtils cmtUtils;
 330 
 331     /**
 332      * A sorted set of included packages.
 333      */
 334     public SortedSet&lt;PackageElement&gt; packages = null;
 335 
 336     public OverviewElement overviewElement;
 337 
 338     public DocFileFactory docFileFactory;
 339 
 340     /**
 341      * A sorted map, giving the (specified|included|other) packages for each module.
 342      */
 343     public SortedMap&lt;ModuleElement, Set&lt;PackageElement&gt;&gt; modulePackages;
 344 
 345     /**
 346      * The list of known modules, that should be documented.
 347      */
 348     public SortedSet&lt;ModuleElement&gt; modules;
 349 
 350     protected static final String sharedResourceBundleName =
 351             &quot;jdk.javadoc.internal.doclets.toolkit.resources.doclets&quot;;
 352 
<a name="15" id="anc15"></a><span class="line-removed"> 353     /**</span>
<span class="line-removed"> 354      * Primarily used to disable strict checks in the regression</span>
<span class="line-removed"> 355      * tests allowing those tests to be executed successfully, for</span>
<span class="line-removed"> 356      * instance, with OpenJDK builds which may not contain FX libraries.</span>
<span class="line-removed"> 357      */</span>
<span class="line-removed"> 358     public boolean disableJavaFxStrictChecks = false;</span>
<span class="line-removed"> 359 </span>
<span class="line-removed"> 360     /**</span>
<span class="line-removed"> 361      * Show taglets (internal debug switch)</span>
<span class="line-removed"> 362      */</span>
<span class="line-removed"> 363     public boolean showTaglets = false;</span>
<span class="line-removed"> 364 </span>
 365     VisibleMemberCache visibleMemberCache = null;
 366 
 367     public PropertyUtils propertyUtils = null;
 368 
 369     /**
<a name="16" id="anc16"></a><span class="line-modified"> 370      * Constructs the configurations needed by the doclet.</span>
 371      *
<a name="17" id="anc17"></a><span class="line-modified"> 372      * @apiNote</span>
<span class="line-modified"> 373      * The {@code doclet} parameter is used when {@link Taglet#init(DocletEnvironment, Doclet)</span>
<span class="line-modified"> 374      * initializing tags}.</span>
<span class="line-removed"> 375      * Some doclets (such as the {@link StandardDoclet), may delegate to another</span>
 376      * (such as the {@link HtmlDoclet}).  In such cases, the primary doclet (i.e
 377      * {@code StandardDoclet}) should be provided here, and not any internal
 378      * class like {@code HtmlDoclet}.
 379      *
<a name="18" id="anc18"></a><span class="line-modified"> 380      * @param doclet the doclet for this run of javadoc</span>


 381      */
<a name="19" id="anc19"></a><span class="line-modified"> 382     public BaseConfiguration(Doclet doclet) {</span>
 383         this.doclet = doclet;
<a name="20" id="anc20"></a><span class="line-modified"> 384         excludedDocFileDirs = new HashSet&lt;&gt;();</span>
<span class="line-modified"> 385         excludedQualifiers = new HashSet&lt;&gt;();</span>
<span class="line-removed"> 386         setTabWidth(DocletConstants.DEFAULT_TAB_STOP_LENGTH);</span>
<span class="line-removed"> 387         metakeywords = new MetaKeywords(this);</span>
<span class="line-removed"> 388         groupPairs = new ArrayList&lt;&gt;(0);</span>
 389     }
 390 
<a name="21" id="anc21"></a>

 391     private boolean initialized = false;
 392 
 393     protected void initConfiguration(DocletEnvironment docEnv) {
 394         if (initialized) {
 395             throw new IllegalStateException(&quot;configuration previously initialized&quot;);
 396         }
 397         initialized = true;
 398         this.docEnv = docEnv;
 399         // Utils needs docEnv, safe to init now.
 400         utils = new Utils(this);
 401 
<a name="22" id="anc22"></a><span class="line-modified"> 402         if (!javafx) {</span>
<span class="line-modified"> 403             javafx = isJavaFXMode();</span>

 404         }
 405 
 406         // Once docEnv and Utils have been initialized, others should be safe.
<a name="23" id="anc23"></a>
 407         cmtUtils = new CommentUtils(this);
 408         workArounds = new WorkArounds(this);
 409         visibleMemberCache = new VisibleMemberCache(this);
 410         propertyUtils = new PropertyUtils(this);
 411 
 412         Splitter specifiedSplitter = new Splitter(docEnv, false);
 413         specifiedModuleElements = Collections.unmodifiableSet(specifiedSplitter.mset);
 414         specifiedPackageElements = Collections.unmodifiableSet(specifiedSplitter.pset);
 415         specifiedTypeElements = Collections.unmodifiableSet(specifiedSplitter.tset);
 416 
 417         Splitter includedSplitter = new Splitter(docEnv, true);
 418         includedModuleElements = Collections.unmodifiableSet(includedSplitter.mset);
 419         includedPackageElements = Collections.unmodifiableSet(includedSplitter.pset);
 420         includedTypeElements = Collections.unmodifiableSet(includedSplitter.tset);
 421     }
 422 
 423     /**
 424      * Return the builder factory for this doclet.
 425      *
 426      * @return the builder factory for this doclet.
 427      */
 428     public BuilderFactory getBuilderFactory() {
 429         if (builderFactory == null) {
 430             builderFactory = new BuilderFactory(this);
 431         }
 432         return builderFactory;
 433     }
 434 
 435     public Reporter getReporter() {
 436         return this.reporter;
 437     }
 438 
 439     private Set&lt;ModuleElement&gt; specifiedModuleElements;
 440 
 441     public Set&lt;ModuleElement&gt; getSpecifiedModuleElements() {
 442         return specifiedModuleElements;
 443     }
 444 
 445     private Set&lt;PackageElement&gt; specifiedPackageElements;
 446 
 447     public Set&lt;PackageElement&gt; getSpecifiedPackageElements() {
 448         return specifiedPackageElements;
 449     }
 450 
 451     private Set&lt;TypeElement&gt; specifiedTypeElements;
 452 
 453     public Set&lt;TypeElement&gt; getSpecifiedTypeElements() {
 454         return specifiedTypeElements;
 455     }
 456 
 457     private Set&lt;ModuleElement&gt; includedModuleElements;
 458 
 459     public Set&lt;ModuleElement&gt; getIncludedModuleElements() {
 460         return includedModuleElements;
 461     }
 462 
 463     private Set&lt;PackageElement&gt; includedPackageElements;
 464 
 465     public Set&lt;PackageElement&gt; getIncludedPackageElements() {
 466         return includedPackageElements;
 467     }
 468 
 469     private Set&lt;TypeElement&gt; includedTypeElements;
 470 
 471     public Set&lt;TypeElement&gt; getIncludedTypeElements() {
 472         return includedTypeElements;
 473     }
 474 
 475     private void initModules() {
 476         // Build the modules structure used by the doclet
 477         modules = new TreeSet&lt;&gt;(utils.makeModuleComparator());
 478         modules.addAll(getSpecifiedModuleElements());
 479 
 480         modulePackages = new TreeMap&lt;&gt;(utils.makeModuleComparator());
 481         for (PackageElement p : packages) {
 482             ModuleElement mdle = docEnv.getElementUtils().getModuleOf(p);
 483             if (mdle != null &amp;&amp; !mdle.isUnnamed()) {
 484                 Set&lt;PackageElement&gt; s = modulePackages
 485                         .computeIfAbsent(mdle, m -&gt; new TreeSet&lt;&gt;(utils.makePackageComparator()));
 486                 s.add(p);
 487             }
 488         }
 489 
 490         for (PackageElement p : getIncludedPackageElements()) {
 491             ModuleElement mdle = docEnv.getElementUtils().getModuleOf(p);
 492             if (mdle != null &amp;&amp; !mdle.isUnnamed()) {
 493                 Set&lt;PackageElement&gt; s = modulePackages
 494                         .computeIfAbsent(mdle, m -&gt; new TreeSet&lt;&gt;(utils.makePackageComparator()));
 495                 s.add(p);
 496             }
 497         }
 498 
 499         // add entries for modules which may not have exported packages
<a name="24" id="anc24"></a><span class="line-modified"> 500         modules.forEach((ModuleElement mdle) -&gt; {</span>
<span class="line-removed"> 501             modulePackages.computeIfAbsent(mdle, m -&gt; Collections.emptySet());</span>
<span class="line-removed"> 502         });</span>
 503 
 504         modules.addAll(modulePackages.keySet());
 505         showModules = !modules.isEmpty();
 506         for (Set&lt;PackageElement&gt; pkgs : modulePackages.values()) {
 507             packages.addAll(pkgs);
 508         }
 509     }
 510 
 511     private void initPackages() {
 512         packages = new TreeSet&lt;&gt;(utils.makePackageComparator());
 513         // add all the included packages
 514         packages.addAll(includedPackageElements);
 515     }
 516 
<a name="25" id="anc25"></a><span class="line-removed"> 517     public Set&lt;Doclet.Option&gt; getSupportedOptions() {</span>
<span class="line-removed"> 518         Resources resources = getResources();</span>
<span class="line-removed"> 519         Doclet.Option[] options = {</span>
<span class="line-removed"> 520                 new Option(resources, &quot;-author&quot;) {</span>
<span class="line-removed"> 521                     @Override</span>
<span class="line-removed"> 522                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 523                         showauthor = true;</span>
<span class="line-removed"> 524                         return true;</span>
<span class="line-removed"> 525                     }</span>
<span class="line-removed"> 526                 },</span>
<span class="line-removed"> 527                 new Option(resources, &quot;-d&quot;, 1) {</span>
<span class="line-removed"> 528                     @Override</span>
<span class="line-removed"> 529                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 530                         destDirName = addTrailingFileSep(args.get(0));</span>
<span class="line-removed"> 531                         return true;</span>
<span class="line-removed"> 532                     }</span>
<span class="line-removed"> 533                 },</span>
<span class="line-removed"> 534                 new Option(resources, &quot;-docencoding&quot;, 1) {</span>
<span class="line-removed"> 535                     @Override</span>
<span class="line-removed"> 536                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 537                         docencoding = args.get(0);</span>
<span class="line-removed"> 538                         return true;</span>
<span class="line-removed"> 539                     }</span>
<span class="line-removed"> 540                 },</span>
<span class="line-removed"> 541                 new Option(resources, &quot;-docfilessubdirs&quot;) {</span>
<span class="line-removed"> 542                     @Override</span>
<span class="line-removed"> 543                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 544                         copydocfilesubdirs = true;</span>
<span class="line-removed"> 545                         return true;</span>
<span class="line-removed"> 546                     }</span>
<span class="line-removed"> 547                 },</span>
<span class="line-removed"> 548                 new Hidden(resources, &quot;-encoding&quot;, 1) {</span>
<span class="line-removed"> 549                     @Override</span>
<span class="line-removed"> 550                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 551                         encoding = args.get(0);</span>
<span class="line-removed"> 552                         return true;</span>
<span class="line-removed"> 553                     }</span>
<span class="line-removed"> 554                 },</span>
<span class="line-removed"> 555                 new Option(resources, &quot;-excludedocfilessubdir&quot;, 1) {</span>
<span class="line-removed"> 556                     @Override</span>
<span class="line-removed"> 557                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 558                         addToSet(excludedDocFileDirs, args.get(0));</span>
<span class="line-removed"> 559                         return true;</span>
<span class="line-removed"> 560                     }</span>
<span class="line-removed"> 561                 },</span>
<span class="line-removed"> 562                 new Option(resources, &quot;-group&quot;, 2) {</span>
<span class="line-removed"> 563                     @Override</span>
<span class="line-removed"> 564                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 565                         groupPairs.add(new Pair&lt;&gt;(args.get(0), args.get(1)));</span>
<span class="line-removed"> 566                         return true;</span>
<span class="line-removed"> 567                     }</span>
<span class="line-removed"> 568                 },</span>
<span class="line-removed"> 569                 new Option(resources, &quot;--javafx -javafx&quot;) {</span>
<span class="line-removed"> 570                     @Override</span>
<span class="line-removed"> 571                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 572                         javafx = true;</span>
<span class="line-removed"> 573                         return true;</span>
<span class="line-removed"> 574                     }</span>
<span class="line-removed"> 575                 },</span>
<span class="line-removed"> 576                 new Option(resources, &quot;-keywords&quot;) {</span>
<span class="line-removed"> 577                     @Override</span>
<span class="line-removed"> 578                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 579                         keywords = true;</span>
<span class="line-removed"> 580                         return true;</span>
<span class="line-removed"> 581                     }</span>
<span class="line-removed"> 582                 },</span>
<span class="line-removed"> 583                 new Option(resources, &quot;-link&quot;, 1) {</span>
<span class="line-removed"> 584                     @Override</span>
<span class="line-removed"> 585                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 586                         linkList.add(args.get(0));</span>
<span class="line-removed"> 587                         return true;</span>
<span class="line-removed"> 588                     }</span>
<span class="line-removed"> 589                 },</span>
<span class="line-removed"> 590                 new Option(resources, &quot;-linksource&quot;) {</span>
<span class="line-removed"> 591                     @Override</span>
<span class="line-removed"> 592                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 593                         linksource = true;</span>
<span class="line-removed"> 594                         return true;</span>
<span class="line-removed"> 595                     }</span>
<span class="line-removed"> 596                 },</span>
<span class="line-removed"> 597                 new Option(resources, &quot;-linkoffline&quot;, 2) {</span>
<span class="line-removed"> 598                     @Override</span>
<span class="line-removed"> 599                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 600                         linkOfflineList.add(new Pair&lt;&gt;(args.get(0), args.get(1)));</span>
<span class="line-removed"> 601                         return true;</span>
<span class="line-removed"> 602                     }</span>
<span class="line-removed"> 603                 },</span>
<span class="line-removed"> 604                 new Option(resources, &quot;-nocomment&quot;) {</span>
<span class="line-removed"> 605                     @Override</span>
<span class="line-removed"> 606                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 607                         nocomment = true;</span>
<span class="line-removed"> 608                         return true;</span>
<span class="line-removed"> 609                     }</span>
<span class="line-removed"> 610                 },</span>
<span class="line-removed"> 611                 new Option(resources, &quot;-nodeprecated&quot;) {</span>
<span class="line-removed"> 612                     @Override</span>
<span class="line-removed"> 613                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 614                         nodeprecated = true;</span>
<span class="line-removed"> 615                         return true;</span>
<span class="line-removed"> 616                     }</span>
<span class="line-removed"> 617                 },</span>
<span class="line-removed"> 618                 new Option(resources, &quot;-nosince&quot;) {</span>
<span class="line-removed"> 619                     @Override</span>
<span class="line-removed"> 620                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 621                         nosince = true;</span>
<span class="line-removed"> 622                         return true;</span>
<span class="line-removed"> 623                     }</span>
<span class="line-removed"> 624                 },</span>
<span class="line-removed"> 625                 new Option(resources, &quot;-notimestamp&quot;) {</span>
<span class="line-removed"> 626                     @Override</span>
<span class="line-removed"> 627                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 628                         notimestamp = true;</span>
<span class="line-removed"> 629                         return true;</span>
<span class="line-removed"> 630                     }</span>
<span class="line-removed"> 631                 },</span>
<span class="line-removed"> 632                 new Option(resources, &quot;-noqualifier&quot;, 1) {</span>
<span class="line-removed"> 633                     @Override</span>
<span class="line-removed"> 634                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 635                         addToSet(excludedQualifiers, args.get(0));</span>
<span class="line-removed"> 636                         return true;</span>
<span class="line-removed"> 637                     }</span>
<span class="line-removed"> 638                 },</span>
<span class="line-removed"> 639                 new Option(resources, &quot;--override-methods&quot;, 1) {</span>
<span class="line-removed"> 640                     @Override</span>
<span class="line-removed"> 641                     public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed"> 642                         String o = args.get(0);</span>
<span class="line-removed"> 643                         switch (o) {</span>
<span class="line-removed"> 644                             case &quot;summary&quot;:</span>
<span class="line-removed"> 645                                 summarizeOverriddenMethods = true;</span>
<span class="line-removed"> 646                                 break;</span>
<span class="line-removed"> 647                             case &quot;detail&quot;:</span>
<span class="line-removed"> 648                                 summarizeOverriddenMethods = false;</span>
<span class="line-removed"> 649                                 break;</span>
<span class="line-removed"> 650                             default:</span>
<span class="line-removed"> 651                                 reporter.print(ERROR,</span>
<span class="line-removed"> 652                                         getResources().getText(&quot;doclet.Option_invalid&quot;,o, &quot;--override-methods&quot;));</span>
<span class="line-removed"> 653                                 return false;</span>
<span class="line-removed"> 654                         }</span>
<span class="line-removed"> 655                         return true;</span>
<span class="line-removed"> 656                     }</span>
<span class="line-removed"> 657                 },</span>
<span class="line-removed"> 658                 new Hidden(resources, &quot;-quiet&quot;) {</span>
<span class="line-removed"> 659                     @Override</span>
<span class="line-removed"> 660                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 661                         quiet = true;</span>
<span class="line-removed"> 662                         return true;</span>
<span class="line-removed"> 663                     }</span>
<span class="line-removed"> 664                 },</span>
<span class="line-removed"> 665                 new Option(resources, &quot;-serialwarn&quot;) {</span>
<span class="line-removed"> 666                     @Override</span>
<span class="line-removed"> 667                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 668                         serialwarn = true;</span>
<span class="line-removed"> 669                         return true;</span>
<span class="line-removed"> 670                     }</span>
<span class="line-removed"> 671                 },</span>
<span class="line-removed"> 672                 new Option(resources, &quot;-sourcetab&quot;, 1) {</span>
<span class="line-removed"> 673                     @Override</span>
<span class="line-removed"> 674                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 675                         linksource = true;</span>
<span class="line-removed"> 676                         try {</span>
<span class="line-removed"> 677                             setTabWidth(Integer.parseInt(args.get(0)));</span>
<span class="line-removed"> 678                         } catch (NumberFormatException e) {</span>
<span class="line-removed"> 679                             //Set to -1 so that warning will be printed</span>
<span class="line-removed"> 680                             //to indicate what is valid argument.</span>
<span class="line-removed"> 681                             sourcetab = -1;</span>
<span class="line-removed"> 682                         }</span>
<span class="line-removed"> 683                         if (sourcetab &lt;= 0) {</span>
<span class="line-removed"> 684                             getMessages().warning(&quot;doclet.sourcetab_warning&quot;);</span>
<span class="line-removed"> 685                             setTabWidth(DocletConstants.DEFAULT_TAB_STOP_LENGTH);</span>
<span class="line-removed"> 686                         }</span>
<span class="line-removed"> 687                         return true;</span>
<span class="line-removed"> 688                     }</span>
<span class="line-removed"> 689                 },</span>
<span class="line-removed"> 690                 new Option(resources, &quot;-tag&quot;, 1) {</span>
<span class="line-removed"> 691                     @Override</span>
<span class="line-removed"> 692                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 693                         ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</span>
<span class="line-removed"> 694                         list.add(opt);</span>
<span class="line-removed"> 695                         list.add(args.get(0));</span>
<span class="line-removed"> 696                         customTagStrs.add(list);</span>
<span class="line-removed"> 697                         return true;</span>
<span class="line-removed"> 698                     }</span>
<span class="line-removed"> 699                 },</span>
<span class="line-removed"> 700                 new Option(resources, &quot;-taglet&quot;, 1) {</span>
<span class="line-removed"> 701                     @Override</span>
<span class="line-removed"> 702                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 703                         ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</span>
<span class="line-removed"> 704                         list.add(opt);</span>
<span class="line-removed"> 705                         list.add(args.get(0));</span>
<span class="line-removed"> 706                         customTagStrs.add(list);</span>
<span class="line-removed"> 707                         return true;</span>
<span class="line-removed"> 708                     }</span>
<span class="line-removed"> 709                 },</span>
<span class="line-removed"> 710                 new Option(resources, &quot;-tagletpath&quot;, 1) {</span>
<span class="line-removed"> 711                     @Override</span>
<span class="line-removed"> 712                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 713                         tagletpath = args.get(0);</span>
<span class="line-removed"> 714                         return true;</span>
<span class="line-removed"> 715                     }</span>
<span class="line-removed"> 716                 },</span>
<span class="line-removed"> 717                 new Option(resources, &quot;-version&quot;) {</span>
<span class="line-removed"> 718                     @Override</span>
<span class="line-removed"> 719                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 720                         showversion = true;</span>
<span class="line-removed"> 721                         return true;</span>
<span class="line-removed"> 722                     }</span>
<span class="line-removed"> 723                 },</span>
<span class="line-removed"> 724                 new Hidden(resources, &quot;--dump-on-error&quot;) {</span>
<span class="line-removed"> 725                     @Override</span>
<span class="line-removed"> 726                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 727                         dumpOnError = true;</span>
<span class="line-removed"> 728                         return true;</span>
<span class="line-removed"> 729                     }</span>
<span class="line-removed"> 730                 },</span>
<span class="line-removed"> 731                 new Option(resources, &quot;--allow-script-in-comments&quot;) {</span>
<span class="line-removed"> 732                     @Override</span>
<span class="line-removed"> 733                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 734                         allowScriptInComments = true;</span>
<span class="line-removed"> 735                         return true;</span>
<span class="line-removed"> 736                     }</span>
<span class="line-removed"> 737                 },</span>
<span class="line-removed"> 738                 new Hidden(resources, &quot;--disable-javafx-strict-checks&quot;) {</span>
<span class="line-removed"> 739                     @Override</span>
<span class="line-removed"> 740                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 741                         disableJavaFxStrictChecks = true;</span>
<span class="line-removed"> 742                         return true;</span>
<span class="line-removed"> 743                     }</span>
<span class="line-removed"> 744                 },</span>
<span class="line-removed"> 745                 new Hidden(resources, &quot;--show-taglets&quot;) {</span>
<span class="line-removed"> 746                     @Override</span>
<span class="line-removed"> 747                     public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed"> 748                         showTaglets = true;</span>
<span class="line-removed"> 749                         return true;</span>
<span class="line-removed"> 750                     }</span>
<span class="line-removed"> 751                 },</span>
<span class="line-removed"> 752                 new XOption(resources, &quot;--no-module-directories&quot;) {</span>
<span class="line-removed"> 753                     @Override</span>
<span class="line-removed"> 754                     public boolean process(String option, List&lt;String&gt; args) {</span>
<span class="line-removed"> 755                         useModuleDirectories = false;</span>
<span class="line-removed"> 756                         return true;</span>
<span class="line-removed"> 757                     }</span>
<span class="line-removed"> 758                 }</span>
<span class="line-removed"> 759         };</span>
<span class="line-removed"> 760         Set&lt;Doclet.Option&gt; set = new TreeSet&lt;&gt;();</span>
<span class="line-removed"> 761         set.addAll(Arrays.asList(options));</span>
<span class="line-removed"> 762         return set;</span>
<span class="line-removed"> 763     }</span>
<span class="line-removed"> 764 </span>
<span class="line-removed"> 765     final LinkedHashSet&lt;List&lt;String&gt;&gt; customTagStrs = new LinkedHashSet&lt;&gt;();</span>
<span class="line-removed"> 766 </span>
 767     /*
 768      * when this is called all the option have been set, this method,
 769      * initializes certain components before anything else is started.
 770      */
 771     protected boolean finishOptionSettings0() throws DocletException {
<a name="26" id="anc26"></a>
 772         extern = new Extern(this);
 773         initDestDirectory();
<a name="27" id="anc27"></a><span class="line-modified"> 774         for (String link : linkList) {</span>
 775             extern.link(link, reporter);
 776         }
<a name="28" id="anc28"></a><span class="line-modified"> 777         for (Pair&lt;String, String&gt; linkOfflinePair : linkOfflineList) {</span>
 778             extern.link(linkOfflinePair.first, linkOfflinePair.second, reporter);
 779         }
 780         typeElementCatalog = new TypeElementCatalog(includedTypeElements, this);
<a name="29" id="anc29"></a><span class="line-modified"> 781         initTagletManager(customTagStrs);</span>
<span class="line-modified"> 782         groupPairs.stream().forEach((grp) -&gt; {</span>
 783             if (showModules) {
 784                 group.checkModuleGroups(grp.first, grp.second);
 785             } else {
 786                 group.checkPackageGroups(grp.first, grp.second);
 787             }
 788         });
 789         overviewElement = new OverviewElement(workArounds.getUnnamedPackage(), getOverviewPath());
 790         return true;
 791     }
 792 
 793     /**
<a name="30" id="anc30"></a><span class="line-modified"> 794      * Set the command line options supported by this configuration.</span>
 795      *
 796      * @return true if the options are set successfully
 797      * @throws DocletException if there is a problem while setting the options
 798      */
 799     public boolean setOptions() throws DocletException {
 800         initPackages();
 801         initModules();
 802         if (!finishOptionSettings0() || !finishOptionSettings())
 803             return false;
 804 
 805         return true;
 806     }
 807 
 808     private void initDestDirectory() throws DocletException {
<a name="31" id="anc31"></a>
 809         if (!destDirName.isEmpty()) {
<a name="32" id="anc32"></a><span class="line-modified"> 810             Resources resources = getResources();</span>
 811             DocFile destDir = DocFile.createFileForDirectory(this, destDirName);
 812             if (!destDir.exists()) {
 813                 //Create the output directory (in case it doesn&#39;t exist yet)
<a name="33" id="anc33"></a><span class="line-modified"> 814                 reporter.print(NOTE, resources.getText(&quot;doclet.dest_dir_create&quot;, destDirName));</span>
 815                 destDir.mkdirs();
 816             } else if (!destDir.isDirectory()) {
<a name="34" id="anc34"></a><span class="line-modified"> 817                 throw new SimpleDocletException(resources.getText(</span>
 818                         &quot;doclet.destination_directory_not_directory_0&quot;,
 819                         destDir.getPath()));
 820             } else if (!destDir.canWrite()) {
<a name="35" id="anc35"></a><span class="line-modified"> 821                 throw new SimpleDocletException(resources.getText(</span>
 822                         &quot;doclet.destination_directory_not_writable_0&quot;,
 823                         destDir.getPath()));
 824             }
 825         }
 826         DocFileFactory.getFactory(this).setDestDir(destDirName);
 827     }
 828 
 829     /**
 830      * Initialize the taglet manager.  The strings to initialize the simple custom tags should
 831      * be in the following format:  &quot;[tag name]:[location str]:[heading]&quot;.
 832      *
 833      * @param customTagStrs the set two dimensional arrays of strings.  These arrays contain
 834      *                      either -tag or -taglet arguments.
 835      */
 836     private void initTagletManager(Set&lt;List&lt;String&gt;&gt; customTagStrs) {
<a name="36" id="anc36"></a><span class="line-modified"> 837         tagletManager = tagletManager == null ?</span>
<span class="line-modified"> 838                 new TagletManager(nosince, showversion, showauthor, javafx, this) :</span>
<span class="line-modified"> 839                 tagletManager;</span>
<span class="line-modified"> 840         for (List&lt;String&gt; args : customTagStrs) {</span>
<span class="line-modified"> 841             if (args.get(0).equals(&quot;-taglet&quot;)) {</span>
<span class="line-modified"> 842                 tagletManager.addCustomTag(args.get(1), getFileManager(), tagletpath);</span>
<span class="line-modified"> 843                 continue;</span>
<span class="line-modified"> 844             }</span>
<span class="line-modified"> 845             List&lt;String&gt; tokens = tokenize(args.get(1), TagletManager.SIMPLE_TAGLET_OPT_SEPARATOR, 3);</span>
<span class="line-modified"> 846             switch (tokens.size()) {</span>
<span class="line-modified"> 847                 case 1:</span>
<span class="line-modified"> 848                     String tagName = args.get(1);</span>
<span class="line-modified"> 849                     if (tagletManager.isKnownCustomTag(tagName)) {</span>
<span class="line-modified"> 850                         //reorder a standard tag</span>
<span class="line-modified"> 851                         tagletManager.addNewSimpleCustomTag(tagName, null, &quot;&quot;);</span>
<span class="line-modified"> 852                     } else {</span>
<span class="line-modified"> 853                         //Create a simple tag with the heading that has the same name as the tag.</span>
<span class="line-modified"> 854                         StringBuilder heading = new StringBuilder(tagName + &quot;:&quot;);</span>
<span class="line-modified"> 855                         heading.setCharAt(0, Character.toUpperCase(tagName.charAt(0)));</span>
<span class="line-modified"> 856                         tagletManager.addNewSimpleCustomTag(tagName, heading.toString(), &quot;a&quot;);</span>
<span class="line-modified"> 857                     }</span>
<span class="line-modified"> 858                     break;</span>




 859 
<a name="37" id="anc37"></a><span class="line-modified"> 860                 case 2:</span>
<span class="line-modified"> 861                     //Add simple taglet without heading, probably to excluding it in the output.</span>
<span class="line-modified"> 862                     tagletManager.addNewSimpleCustomTag(tokens.get(0), tokens.get(1), &quot;&quot;);</span>
<span class="line-modified"> 863                     break;</span>
 864 
<a name="38" id="anc38"></a><span class="line-modified"> 865                 case 3:</span>
<span class="line-modified"> 866                     tagletManager.addNewSimpleCustomTag(tokens.get(0), tokens.get(2), tokens.get(1));</span>
<span class="line-modified"> 867                     break;</span>
 868 
<a name="39" id="anc39"></a><span class="line-modified"> 869                 default:</span>
<span class="line-modified"> 870                     Messages messages = getMessages();</span>
<span class="line-modified"> 871                     messages.error(&quot;doclet.Error_invalid_custom_tag_argument&quot;, args.get(1));</span>
 872             }
<a name="40" id="anc40"></a>

 873         }
 874     }
 875 
 876     /**
 877      * Given a string, return an array of tokens.  The separator can be escaped
 878      * with the &#39;\&#39; character.  The &#39;\&#39; character may also be escaped by the
 879      * &#39;\&#39; character.
 880      *
 881      * @param s         the string to tokenize.
 882      * @param separator the separator char.
 883      * @param maxTokens the maximum number of tokens returned.  If the
 884      *                  max is reached, the remaining part of s is appended
 885      *                  to the end of the last token.
 886      * @return an array of tokens.
 887      */
 888     private List&lt;String&gt; tokenize(String s, char separator, int maxTokens) {
 889         List&lt;String&gt; tokens = new ArrayList&lt;&gt;();
 890         StringBuilder token = new StringBuilder();
 891         boolean prevIsEscapeChar = false;
 892         for (int i = 0; i &lt; s.length(); i += Character.charCount(i)) {
 893             int currentChar = s.codePointAt(i);
 894             if (prevIsEscapeChar) {
 895                 // Case 1:  escaped character
 896                 token.appendCodePoint(currentChar);
 897                 prevIsEscapeChar = false;
 898             } else if (currentChar == separator &amp;&amp; tokens.size() &lt; maxTokens - 1) {
 899                 // Case 2:  separator
 900                 tokens.add(token.toString());
 901                 token = new StringBuilder();
 902             } else if (currentChar == &#39;\\&#39;) {
 903                 // Case 3:  escape character
 904                 prevIsEscapeChar = true;
 905             } else {
 906                 // Case 4:  regular character
 907                 token.appendCodePoint(currentChar);
 908             }
 909         }
 910         if (token.length() &gt; 0) {
 911             tokens.add(token.toString());
 912         }
 913         return tokens;
 914     }
 915 
<a name="41" id="anc41"></a><span class="line-removed"> 916     private void addToSet(Set&lt;String&gt; s, String str) {</span>
<span class="line-removed"> 917         StringTokenizer st = new StringTokenizer(str, &quot;:&quot;);</span>
<span class="line-removed"> 918         String current;</span>
<span class="line-removed"> 919         while (st.hasMoreTokens()) {</span>
<span class="line-removed"> 920             current = st.nextToken();</span>
<span class="line-removed"> 921             s.add(current);</span>
<span class="line-removed"> 922         }</span>
<span class="line-removed"> 923     }</span>
<span class="line-removed"> 924 </span>
<span class="line-removed"> 925     /**</span>
<span class="line-removed"> 926      * Add a trailing file separator, if not found. Remove superfluous</span>
<span class="line-removed"> 927      * file separators if any. Preserve the front double file separator for</span>
<span class="line-removed"> 928      * UNC paths.</span>
<span class="line-removed"> 929      *</span>
<span class="line-removed"> 930      * @param path Path under consideration.</span>
<span class="line-removed"> 931      * @return String Properly constructed path string.</span>
<span class="line-removed"> 932      */</span>
<span class="line-removed"> 933     public static String addTrailingFileSep(String path) {</span>
<span class="line-removed"> 934         String fs = System.getProperty(&quot;file.separator&quot;);</span>
<span class="line-removed"> 935         String dblfs = fs + fs;</span>
<span class="line-removed"> 936         int indexDblfs;</span>
<span class="line-removed"> 937         while ((indexDblfs = path.indexOf(dblfs, 1)) &gt;= 0) {</span>
<span class="line-removed"> 938             path = path.substring(0, indexDblfs) +</span>
<span class="line-removed"> 939                     path.substring(indexDblfs + fs.length());</span>
<span class="line-removed"> 940         }</span>
<span class="line-removed"> 941         if (!path.endsWith(fs))</span>
<span class="line-removed"> 942             path += fs;</span>
<span class="line-removed"> 943         return path;</span>
<span class="line-removed"> 944     }</span>
<span class="line-removed"> 945 </span>
<span class="line-removed"> 946     /**</span>
<span class="line-removed"> 947      * This checks for the validity of the options used by the user.</span>
<span class="line-removed"> 948      * As of this writing, this checks only docencoding.</span>
<span class="line-removed"> 949      *</span>
<span class="line-removed"> 950      * @return true if all the options are valid.</span>
<span class="line-removed"> 951      */</span>
<span class="line-removed"> 952     public boolean generalValidOptions() {</span>
<span class="line-removed"> 953         if (docencoding != null) {</span>
<span class="line-removed"> 954             if (!checkOutputFileEncoding(docencoding)) {</span>
<span class="line-removed"> 955                 return false;</span>
<span class="line-removed"> 956             }</span>
<span class="line-removed"> 957         }</span>
<span class="line-removed"> 958         if (docencoding == null &amp;&amp; (encoding != null &amp;&amp; !encoding.isEmpty())) {</span>
<span class="line-removed"> 959             if (!checkOutputFileEncoding(encoding)) {</span>
<span class="line-removed"> 960                 return false;</span>
<span class="line-removed"> 961             }</span>
<span class="line-removed"> 962         }</span>
<span class="line-removed"> 963         return true;</span>
<span class="line-removed"> 964     }</span>
<span class="line-removed"> 965 </span>
<span class="line-removed"> 966     /**</span>
<span class="line-removed"> 967      * Check the validity of the given Source or Output File encoding on this</span>
<span class="line-removed"> 968      * platform.</span>
<span class="line-removed"> 969      *</span>
<span class="line-removed"> 970      * @param docencoding output file encoding.</span>
<span class="line-removed"> 971      */</span>
<span class="line-removed"> 972     private boolean checkOutputFileEncoding(String docencoding) {</span>
<span class="line-removed"> 973         OutputStream ost = new ByteArrayOutputStream();</span>
<span class="line-removed"> 974         OutputStreamWriter osw = null;</span>
<span class="line-removed"> 975         try {</span>
<span class="line-removed"> 976             osw = new OutputStreamWriter(ost, docencoding);</span>
<span class="line-removed"> 977         } catch (UnsupportedEncodingException exc) {</span>
<span class="line-removed"> 978             reporter.print(ERROR, getResources().getText(&quot;doclet.Encoding_not_supported&quot;, docencoding));</span>
<span class="line-removed"> 979             return false;</span>
<span class="line-removed"> 980         } finally {</span>
<span class="line-removed"> 981             try {</span>
<span class="line-removed"> 982                 if (osw != null) {</span>
<span class="line-removed"> 983                     osw.close();</span>
<span class="line-removed"> 984                 }</span>
<span class="line-removed"> 985             } catch (IOException exc) {</span>
<span class="line-removed"> 986             }</span>
<span class="line-removed"> 987         }</span>
<span class="line-removed"> 988         return true;</span>
<span class="line-removed"> 989     }</span>
<span class="line-removed"> 990 </span>
 991     /**
 992      * Return true if the given doc-file subdirectory should be excluded and
 993      * false otherwise.
 994      *
 995      * @param docfilesubdir the doc-files subdirectory to check.
 996      * @return true if the directory is excluded.
 997      */
 998     public boolean shouldExcludeDocFileDir(String docfilesubdir) {
<a name="42" id="anc42"></a>
 999         return excludedDocFileDirs.contains(docfilesubdir);
1000     }
1001 
1002     /**
1003      * Return true if the given qualifier should be excluded and false otherwise.
1004      *
1005      * @param qualifier the qualifier to check.
1006      * @return true if the qualifier should be excluded
1007      */
1008     public boolean shouldExcludeQualifier(String qualifier) {
<a name="43" id="anc43"></a>
1009         if (excludedQualifiers.contains(&quot;all&quot;) ||
1010                 excludedQualifiers.contains(qualifier) ||
1011                 excludedQualifiers.contains(qualifier + &quot;.*&quot;)) {
1012             return true;
1013         } else {
1014             int index = -1;
1015             while ((index = qualifier.indexOf(&quot;.&quot;, index + 1)) != -1) {
1016                 if (excludedQualifiers.contains(qualifier.substring(0, index + 1) + &quot;*&quot;)) {
1017                     return true;
1018                 }
1019             }
1020             return false;
1021         }
1022     }
1023 
1024     /**
1025      * Return the qualified name of the Element if its qualifier is not excluded.
1026      * Otherwise return the unqualified Element name.
1027      *
1028      * @param te the TypeElement to check.
1029      * @return the class name
1030      */
1031     public String getClassName(TypeElement te) {
1032         PackageElement pkg = utils.containingPackage(te);
1033         return shouldExcludeQualifier(utils.getPackageName(pkg))
1034                 ? utils.getSimpleName(te)
1035                 : utils.getFullyQualifiedName(te);
1036     }
1037 
1038     /**
1039      * Return true if the TypeElement element is getting documented, depending upon
1040      * -nodeprecated option and the deprecation information. Return true if
1041      * -nodeprecated is not used. Return false if -nodeprecated is used and if
1042      * either TypeElement element is deprecated or the containing package is deprecated.
1043      *
1044      * @param te the TypeElement for which the page generation is checked
1045      * @return true if it is a generated doc.
1046      */
1047     public boolean isGeneratedDoc(TypeElement te) {
<a name="44" id="anc44"></a>
1048         if (!nodeprecated) {
1049             return true;
1050         }
1051         return !(utils.isDeprecated(te) || utils.isDeprecated(utils.containingPackage(te)));
1052     }
1053 
1054     /**
1055      * Return the doclet specific instance of a writer factory.
1056      *
1057      * @return the {@link WriterFactory} for the doclet.
1058      */
1059     public abstract WriterFactory getWriterFactory();
1060 
1061     /**
1062      * Return the input stream to the builder XML.
1063      *
1064      * @return the input steam to the builder XML.
1065      * @throws DocFileIOException when the given XML file cannot be found or opened.
1066      */
1067     public InputStream getBuilderXML() throws DocFileIOException {
1068         return builderXMLPath == null ?
1069                 BaseConfiguration.class.getResourceAsStream(DEFAULT_BUILDER_XML) :
1070                 DocFile.createFileForInput(this, builderXMLPath).openInputStream();
1071     }
1072 
1073     /**
1074      * Return the Locale for this document.
1075      *
1076      * @return the current locale
1077      */
1078     public abstract Locale getLocale();
1079 
1080     /**
1081      * Return the path of the overview file and null if it does not exist.
1082      *
1083      * @return the path of the overview file.
1084      */
1085     public abstract JavaFileObject getOverviewPath();
1086 
1087     /**
1088      * Return the current file manager.
1089      *
1090      * @return JavaFileManager
1091      */
1092     public abstract JavaFileManager getFileManager();
1093 
<a name="45" id="anc45"></a><span class="line-removed">1094     private void setTabWidth(int n) {</span>
<span class="line-removed">1095         sourcetab = n;</span>
<span class="line-removed">1096         tabSpaces = String.format(&quot;%&quot; + n + &quot;s&quot;, &quot;&quot;);</span>
<span class="line-removed">1097     }</span>
<span class="line-removed">1098 </span>
1099     public abstract boolean showMessage(DocTreePath path, String key);
1100 
1101     public abstract boolean showMessage(Element e, String key);
1102 
<a name="46" id="anc46"></a><span class="line-removed">1103     public static abstract class Option implements Doclet.Option, Comparable&lt;Option&gt; {</span>
<span class="line-removed">1104         private final String[] names;</span>
<span class="line-removed">1105         private final String parameters;</span>
<span class="line-removed">1106         private final String description;</span>
<span class="line-removed">1107         private final int argCount;</span>
<span class="line-removed">1108 </span>
<span class="line-removed">1109         protected Option(Resources resources, String name, int argCount) {</span>
<span class="line-removed">1110             this(resources, null, name, argCount);</span>
<span class="line-removed">1111         }</span>
<span class="line-removed">1112 </span>
<span class="line-removed">1113         protected Option(Resources resources, String keyBase, String name, int argCount) {</span>
<span class="line-removed">1114             this.names = name.trim().split(&quot;\\s+&quot;);</span>
<span class="line-removed">1115             if (keyBase == null) {</span>
<span class="line-removed">1116                 keyBase = &quot;doclet.usage.&quot; + names[0].toLowerCase().replaceAll(&quot;^-+&quot;, &quot;&quot;);</span>
<span class="line-removed">1117             }</span>
<span class="line-removed">1118             String desc = getOptionsMessage(resources, keyBase + &quot;.description&quot;);</span>
<span class="line-removed">1119             if (desc.isEmpty()) {</span>
<span class="line-removed">1120                 this.description = &quot;&lt;MISSING KEY&gt;&quot;;</span>
<span class="line-removed">1121                 this.parameters = &quot;&lt;MISSING KEY&gt;&quot;;</span>
<span class="line-removed">1122             } else {</span>
<span class="line-removed">1123                 this.description = desc;</span>
<span class="line-removed">1124                 this.parameters = getOptionsMessage(resources, keyBase + &quot;.parameters&quot;);</span>
<span class="line-removed">1125             }</span>
<span class="line-removed">1126             this.argCount = argCount;</span>
<span class="line-removed">1127         }</span>
<span class="line-removed">1128 </span>
<span class="line-removed">1129         protected Option(Resources resources, String name) {</span>
<span class="line-removed">1130             this(resources, name, 0);</span>
<span class="line-removed">1131         }</span>
<span class="line-removed">1132 </span>
<span class="line-removed">1133         private String getOptionsMessage(Resources resources, String key) {</span>
<span class="line-removed">1134             try {</span>
<span class="line-removed">1135                 return resources.getText(key);</span>
<span class="line-removed">1136             } catch (MissingResourceException ignore) {</span>
<span class="line-removed">1137                 return &quot;&quot;;</span>
<span class="line-removed">1138             }</span>
<span class="line-removed">1139         }</span>
<span class="line-removed">1140 </span>
<span class="line-removed">1141         @Override</span>
<span class="line-removed">1142         public String getDescription() {</span>
<span class="line-removed">1143             return description;</span>
<span class="line-removed">1144         }</span>
<span class="line-removed">1145 </span>
<span class="line-removed">1146         @Override</span>
<span class="line-removed">1147         public Option.Kind getKind() {</span>
<span class="line-removed">1148             return Doclet.Option.Kind.STANDARD;</span>
<span class="line-removed">1149         }</span>
<span class="line-removed">1150 </span>
<span class="line-removed">1151         @Override</span>
<span class="line-removed">1152         public List&lt;String&gt; getNames() {</span>
<span class="line-removed">1153             return Arrays.asList(names);</span>
<span class="line-removed">1154         }</span>
<span class="line-removed">1155 </span>
<span class="line-removed">1156         @Override</span>
<span class="line-removed">1157         public String getParameters() {</span>
<span class="line-removed">1158             return parameters;</span>
<span class="line-removed">1159         }</span>
<span class="line-removed">1160 </span>
<span class="line-removed">1161         @Override</span>
<span class="line-removed">1162         public String toString() {</span>
<span class="line-removed">1163             return Arrays.toString(names);</span>
<span class="line-removed">1164         }</span>
<span class="line-removed">1165 </span>
<span class="line-removed">1166         @Override</span>
<span class="line-removed">1167         public int getArgumentCount() {</span>
<span class="line-removed">1168             return argCount;</span>
<span class="line-removed">1169         }</span>
<span class="line-removed">1170 </span>
<span class="line-removed">1171         public boolean matches(String option) {</span>
<span class="line-removed">1172             for (String name : names) {</span>
<span class="line-removed">1173                 boolean matchCase = name.startsWith(&quot;--&quot;);</span>
<span class="line-removed">1174                 if (option.startsWith(&quot;--&quot;) &amp;&amp; option.contains(&quot;=&quot;)) {</span>
<span class="line-removed">1175                     return name.equals(option.substring(option.indexOf(&quot;=&quot;) + 1));</span>
<span class="line-removed">1176                 } else if (matchCase) {</span>
<span class="line-removed">1177                     return name.equals(option);</span>
<span class="line-removed">1178                 }</span>
<span class="line-removed">1179                 return name.toLowerCase().equals(option.toLowerCase());</span>
<span class="line-removed">1180             }</span>
<span class="line-removed">1181             return false;</span>
<span class="line-removed">1182         }</span>
<span class="line-removed">1183 </span>
<span class="line-removed">1184         @Override</span>
<span class="line-removed">1185         public int compareTo(Option that) {</span>
<span class="line-removed">1186             return this.getNames().get(0).compareTo(that.getNames().get(0));</span>
<span class="line-removed">1187         }</span>
<span class="line-removed">1188     }</span>
<span class="line-removed">1189 </span>
<span class="line-removed">1190     public abstract class XOption extends Option {</span>
<span class="line-removed">1191 </span>
<span class="line-removed">1192         public XOption(Resources resources, String prefix, String name, int argCount) {</span>
<span class="line-removed">1193             super(resources, prefix, name, argCount);</span>
<span class="line-removed">1194         }</span>
<span class="line-removed">1195 </span>
<span class="line-removed">1196         public XOption(Resources resources, String name, int argCount) {</span>
<span class="line-removed">1197             super(resources, name, argCount);</span>
<span class="line-removed">1198         }</span>
<span class="line-removed">1199 </span>
<span class="line-removed">1200         public XOption(Resources resources, String name) {</span>
<span class="line-removed">1201             this(resources, name, 0);</span>
<span class="line-removed">1202         }</span>
<span class="line-removed">1203 </span>
<span class="line-removed">1204         @Override</span>
<span class="line-removed">1205         public Option.Kind getKind() {</span>
<span class="line-removed">1206             return Doclet.Option.Kind.EXTENDED;</span>
<span class="line-removed">1207         }</span>
<span class="line-removed">1208     }</span>
<span class="line-removed">1209 </span>
<span class="line-removed">1210     public abstract class Hidden extends Option {</span>
<span class="line-removed">1211 </span>
<span class="line-removed">1212         public Hidden(Resources resources, String name, int argCount) {</span>
<span class="line-removed">1213             super(resources, name, argCount);</span>
<span class="line-removed">1214         }</span>
<span class="line-removed">1215 </span>
<span class="line-removed">1216         public Hidden(Resources resources, String name) {</span>
<span class="line-removed">1217             this(resources, name, 0);</span>
<span class="line-removed">1218         }</span>
<span class="line-removed">1219 </span>
<span class="line-removed">1220         @Override</span>
<span class="line-removed">1221         public Option.Kind getKind() {</span>
<span class="line-removed">1222             return Doclet.Option.Kind.OTHER;</span>
<span class="line-removed">1223         }</span>
<span class="line-removed">1224     }</span>
<span class="line-removed">1225 </span>
1226     /*
1227      * Splits the elements in a collection to its individual
1228      * collection.
1229      */
<a name="47" id="anc47"></a><span class="line-modified">1230     static private class Splitter {</span>

1231 
1232         final Set&lt;ModuleElement&gt; mset = new LinkedHashSet&lt;&gt;();
1233         final Set&lt;PackageElement&gt; pset = new LinkedHashSet&lt;&gt;();
1234         final Set&lt;TypeElement&gt; tset = new LinkedHashSet&lt;&gt;();
1235 
1236         Splitter(DocletEnvironment docEnv, boolean included) {
1237 
1238             Set&lt;? extends Element&gt; inset = included
1239                     ? docEnv.getIncludedElements()
1240                     : docEnv.getSpecifiedElements();
1241 
1242             for (Element e : inset) {
<a name="48" id="anc48"></a><span class="line-modified">1243                 new SimpleElementVisitor9&lt;Void, Void&gt;() {</span>
1244                     @Override
1245                     @DefinedBy(Api.LANGUAGE_MODEL)
1246                     public Void visitModule(ModuleElement e, Void p) {
1247                         mset.add(e);
1248                         return null;
1249                     }
1250 
1251                     @Override
1252                     @DefinedBy(Api.LANGUAGE_MODEL)
1253                     public Void visitPackage(PackageElement e, Void p) {
1254                         pset.add(e);
1255                         return null;
1256                     }
1257 
1258                     @Override
1259                     @DefinedBy(Api.LANGUAGE_MODEL)
1260                     public Void visitType(TypeElement e, Void p) {
1261                         tset.add(e);
1262                         return null;
1263                     }
1264 
1265                     @Override
1266                     @DefinedBy(Api.LANGUAGE_MODEL)
1267                     protected Void defaultAction(Element e, Void p) {
1268                         throw new AssertionError(&quot;unexpected element: &quot; + e);
1269                     }
1270 
1271                 }.visit(e);
1272             }
1273         }
1274     }
1275 
1276     /**
1277      * Returns whether or not to allow JavaScript in comments.
<a name="49" id="anc49"></a><span class="line-modified">1278      * Default is off; can be set true from a command line option.</span>
1279      *
1280      * @return the allowScriptInComments
1281      */
1282     public boolean isAllowScriptInComments() {
<a name="50" id="anc50"></a><span class="line-modified">1283         return allowScriptInComments;</span>
1284     }
1285 
1286     public synchronized VisibleMemberTable getVisibleMemberTable(TypeElement te) {
1287         return visibleMemberCache.getVisibleMemberTable(te);
1288     }
1289 
1290     /**
1291      * Determines if JavaFX is available in the compilation environment.
1292      * @return true if JavaFX is available
1293      */
1294     public boolean isJavaFXMode() {
1295         TypeElement observable = utils.elementUtils.getTypeElement(&quot;javafx.beans.Observable&quot;);
<a name="51" id="anc51"></a><span class="line-modified">1296         if (observable != null) {</span>
<span class="line-modified">1297             ModuleElement javafxModule = utils.elementUtils.getModuleOf(observable);</span>
<span class="line-removed">1298             if (javafxModule == null || javafxModule.isUnnamed() || javafxModule.getQualifiedName().contentEquals(&quot;javafx.base&quot;)) {</span>
<span class="line-removed">1299                 return true;</span>
<span class="line-removed">1300             }</span>
1301         }
<a name="52" id="anc52"></a><span class="line-modified">1302         return false;</span>



1303     }
1304 }
<a name="53" id="anc53"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="53" type="hidden" />
</body>
</html>