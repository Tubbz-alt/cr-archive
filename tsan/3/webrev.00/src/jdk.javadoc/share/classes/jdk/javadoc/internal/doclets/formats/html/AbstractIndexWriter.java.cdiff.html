<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractIndexWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractExecutableMemberWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractMemberWriter.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractIndexWriter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 23,22 ***</span>
   * questions.
   */
  
  package jdk.javadoc.internal.doclets.formats.html;
  
<span class="line-modified">! import java.io.*;</span>
<span class="line-modified">! import java.util.*;</span>
<span class="line-modified">! import java.util.zip.*;</span>
  
  import javax.lang.model.element.Element;
  import javax.lang.model.element.ExecutableElement;
  import javax.lang.model.element.ModuleElement;
  import javax.lang.model.element.PackageElement;
  import javax.lang.model.element.TypeElement;
<span class="line-modified">! import javax.lang.model.util.SimpleElementVisitor9;</span>
  
  import com.sun.source.doctree.DocTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.Navigation;
  import jdk.javadoc.internal.doclets.formats.html.markup.Navigation.PageMode;
<span class="line-new-header">--- 23,24 ---</span>
   * questions.
   */
  
  package jdk.javadoc.internal.doclets.formats.html;
  
<span class="line-modified">! import java.io.IOException;</span>
<span class="line-modified">! import java.io.Writer;</span>
<span class="line-modified">! import java.util.Collection;</span>
<span class="line-added">+ import java.util.List;</span>
  
  import javax.lang.model.element.Element;
  import javax.lang.model.element.ExecutableElement;
  import javax.lang.model.element.ModuleElement;
  import javax.lang.model.element.PackageElement;
  import javax.lang.model.element.TypeElement;
<span class="line-modified">! import javax.lang.model.util.SimpleElementVisitor14;</span>
  
  import com.sun.source.doctree.DocTree;
<span class="line-added">+ import jdk.javadoc.internal.doclets.formats.html.markup.Entity;</span>
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.Navigation;
  import jdk.javadoc.internal.doclets.formats.html.markup.Navigation.PageMode;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 60,36 ***</span>
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
   *
   * @see    IndexBuilder
<span class="line-removed">-  * @author Atul M Dambalkar</span>
<span class="line-removed">-  * @author Bhavesh Patel (Modified)</span>
   */
  public class AbstractIndexWriter extends HtmlDocletWriter {
  
      /**
       * The index of all the members with unicode character.
       */
<span class="line-modified">!     protected IndexBuilder indexbuilder;</span>
  
      protected Navigation navBar;
  
      /**
       * This constructor will be used by {@link SplitIndexWriter}. Initializes
       * path to this file and relative path from this file.
       *
       * @param configuration  The current configuration
       * @param path       Path to the file which is getting generated.
<span class="line-modified">!      * @param indexbuilder Unicode based Index from {@link IndexBuilder}</span>
       */
      protected AbstractIndexWriter(HtmlConfiguration configuration,
                                    DocPath path,
<span class="line-modified">!                                   IndexBuilder indexbuilder) {</span>
          super(configuration, path);
<span class="line-modified">!         this.indexbuilder = indexbuilder;</span>
<span class="line-modified">!         this.navBar = new Navigation(null, configuration, fixedNavDiv, PageMode.INDEX, path);</span>
      }
  
      /**
       * Add the member information for the unicode character along with the
       * list of the members.
<span class="line-new-header">--- 62,34 ---</span>
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
   *
   * @see    IndexBuilder
   */
  public class AbstractIndexWriter extends HtmlDocletWriter {
  
      /**
       * The index of all the members with unicode character.
       */
<span class="line-modified">!     protected IndexBuilder indexBuilder;</span>
  
      protected Navigation navBar;
  
      /**
       * This constructor will be used by {@link SplitIndexWriter}. Initializes
       * path to this file and relative path from this file.
       *
       * @param configuration  The current configuration
       * @param path       Path to the file which is getting generated.
<span class="line-modified">!      * @param indexBuilder Unicode based Index from {@link IndexBuilder}</span>
       */
      protected AbstractIndexWriter(HtmlConfiguration configuration,
                                    DocPath path,
<span class="line-modified">!                                   IndexBuilder indexBuilder) {</span>
          super(configuration, path);
<span class="line-modified">!         this.indexBuilder = indexBuilder;</span>
<span class="line-modified">!         this.navBar = new Navigation(null, configuration, PageMode.INDEX, path);</span>
      }
  
      /**
       * Add the member information for the unicode character along with the
       * list of the members.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 164,20 ***</span>
          contentTree.add(dl);
      }
  
      protected void addHeading(Character uc, Content contentTree) {
          String unicode = uc.toString();
<span class="line-removed">-         contentTree.add(getMarkerAnchorForIndex(unicode));</span>
          Content headContent = new StringContent(unicode);
<span class="line-modified">!         Content heading = HtmlTree.HEADING(Headings.CONTENT_HEADING, false,</span>
                  HtmlStyle.title, headContent);
          contentTree.add(heading);
      }
  
      protected void addDescription(Content dl, Element element) {
          SearchIndexItem si = new SearchIndexItem();
<span class="line-modified">!         new SimpleElementVisitor9&lt;Void, Void&gt;() {</span>
  
              @Override
              public Void visitModule(ModuleElement e, Void p) {
                  if (configuration.showModules) {
                      addDescription(e, dl, si);
<span class="line-new-header">--- 164,21 ---</span>
          contentTree.add(dl);
      }
  
      protected void addHeading(Character uc, Content contentTree) {
          String unicode = uc.toString();
          Content headContent = new StringContent(unicode);
<span class="line-modified">!         HtmlTree heading = HtmlTree.HEADING(Headings.CONTENT_HEADING, false,</span>
                  HtmlStyle.title, headContent);
<span class="line-added">+         heading.setId(getNameForIndex(unicode));</span>
          contentTree.add(heading);
      }
  
<span class="line-added">+     @SuppressWarnings(&quot;preview&quot;)</span>
      protected void addDescription(Content dl, Element element) {
          SearchIndexItem si = new SearchIndexItem();
<span class="line-modified">!         new SimpleElementVisitor14&lt;Void, Void&gt;() {</span>
  
              @Override
              public Void visitModule(ModuleElement e, Void p) {
                  if (configuration.showModules) {
                      addDescription(e, dl, si);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 336,11 ***</span>
          dt.add(&quot; - &quot;);
          dt.add(contents.getContent(&quot;doclet.Search_tag_in&quot;, sii.getHolder()));
          dlTree.add(dt);
          Content dd = new HtmlTree(HtmlTag.DD);
          if (sii.getDescription().isEmpty()) {
<span class="line-modified">!             dd.add(Contents.SPACE);</span>
          } else {
              dd.add(sii.getDescription());
          }
          dlTree.add(dd);
      }
<span class="line-new-header">--- 337,11 ---</span>
          dt.add(&quot; - &quot;);
          dt.add(contents.getContent(&quot;doclet.Search_tag_in&quot;, sii.getHolder()));
          dlTree.add(dt);
          Content dd = new HtmlTree(HtmlTag.DD);
          if (sii.getDescription().isEmpty()) {
<span class="line-modified">!             dd.add(Entity.NO_BREAK_SPACE);</span>
          } else {
              dd.add(sii.getDescription());
          }
          dlTree.add(dd);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 405,20 ***</span>
          }
          addPreQualifiedClassLink(LinkInfoImpl.Kind.INDEX, containing,
                  false, contentTree);
      }
  
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Get the marker anchor which will be added to the index documentation tree.</span>
<span class="line-removed">-      *</span>
<span class="line-removed">-      * @param anchorNameForIndex the anchor name attribute for index page</span>
<span class="line-removed">-      * @return a content tree for the marker anchor</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public Content getMarkerAnchorForIndex(String anchorNameForIndex) {</span>
<span class="line-removed">-         return links.createAnchor(getNameForIndex(anchorNameForIndex), null);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      /**
       * Generate a valid HTML name for member index page.
       *
       * @param unicode the string that needs to be converted to valid HTML name.
       * @return a valid HTML name string.
<span class="line-new-header">--- 406,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 430,47 ***</span>
      /**
       * @throws DocFileIOException if there is a problem creating any of the search index files
       */
      protected void createSearchIndexFiles() throws DocFileIOException {
          if (configuration.showModules) {
<span class="line-modified">!             createSearchIndexFile(DocPaths.MODULE_SEARCH_INDEX_JSON, DocPaths.MODULE_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">!                     DocPaths.MODULE_SEARCH_INDEX_JS, configuration.moduleSearchIndex, &quot;moduleSearchIndex&quot;);</span>
          }
          if (!configuration.packages.isEmpty()) {
              SearchIndexItem si = new SearchIndexItem();
              si.setCategory(SearchIndexItem.Category.PACKAGES);
              si.setLabel(resources.getText(&quot;doclet.All_Packages&quot;));
              si.setUrl(DocPaths.ALLPACKAGES_INDEX.getPath());
              configuration.packageSearchIndex.add(si);
          }
<span class="line-modified">!         createSearchIndexFile(DocPaths.PACKAGE_SEARCH_INDEX_JSON, DocPaths.PACKAGE_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">!                 DocPaths.PACKAGE_SEARCH_INDEX_JS, configuration.packageSearchIndex, &quot;packageSearchIndex&quot;);</span>
          SearchIndexItem si = new SearchIndexItem();
          si.setCategory(SearchIndexItem.Category.TYPES);
          si.setLabel(resources.getText(&quot;doclet.All_Classes&quot;));
          si.setUrl(DocPaths.ALLCLASSES_INDEX.getPath());
          configuration.typeSearchIndex.add(si);
<span class="line-modified">!         createSearchIndexFile(DocPaths.TYPE_SEARCH_INDEX_JSON, DocPaths.TYPE_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">!                 DocPaths.TYPE_SEARCH_INDEX_JS, configuration.typeSearchIndex, &quot;typeSearchIndex&quot;);</span>
<span class="line-modified">!         createSearchIndexFile(DocPaths.MEMBER_SEARCH_INDEX_JSON, DocPaths.MEMBER_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">!                 DocPaths.MEMBER_SEARCH_INDEX_JS, configuration.memberSearchIndex, &quot;memberSearchIndex&quot;);</span>
<span class="line-modified">!         createSearchIndexFile(DocPaths.TAG_SEARCH_INDEX_JSON, DocPaths.TAG_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">!                 DocPaths.TAG_SEARCH_INDEX_JS, configuration.tagSearchIndex, &quot;tagSearchIndex&quot;);</span>
      }
  
      /**
       * Creates a search index file.
       *
<span class="line-removed">-      * @param searchIndexFile   the file to be generated</span>
<span class="line-removed">-      * @param searchIndexZip    the zip file to be generated</span>
       * @param searchIndexJS     the file for the JavaScript to be generated
       * @param searchIndex       the search index items
       * @param varName           the variable name to write in the JavaScript file
       * @throws DocFileIOException if there is a problem creating the search index file
       */
<span class="line-modified">!     protected void createSearchIndexFile(DocPath searchIndexFile, DocPath searchIndexZip,</span>
<span class="line-modified">!             DocPath searchIndexJS, Collection&lt;SearchIndexItem&gt; searchIndex, String varName) throws DocFileIOException {</span>
          if (!searchIndex.isEmpty()) {
              StringBuilder searchVar = new StringBuilder(&quot;[&quot;);
              boolean first = true;
              for (SearchIndexItem item : searchIndex) {
                  if (first) {
<span class="line-new-header">--- 421,53 ---</span>
      /**
       * @throws DocFileIOException if there is a problem creating any of the search index files
       */
      protected void createSearchIndexFiles() throws DocFileIOException {
          if (configuration.showModules) {
<span class="line-modified">!             createSearchIndexFile(DocPaths.MODULE_SEARCH_INDEX_JS,</span>
<span class="line-modified">!                                   configuration.moduleSearchIndex,</span>
<span class="line-added">+                                   &quot;moduleSearchIndex&quot;);</span>
          }
          if (!configuration.packages.isEmpty()) {
              SearchIndexItem si = new SearchIndexItem();
              si.setCategory(SearchIndexItem.Category.PACKAGES);
              si.setLabel(resources.getText(&quot;doclet.All_Packages&quot;));
              si.setUrl(DocPaths.ALLPACKAGES_INDEX.getPath());
              configuration.packageSearchIndex.add(si);
          }
<span class="line-modified">!         createSearchIndexFile(DocPaths.PACKAGE_SEARCH_INDEX_JS,</span>
<span class="line-modified">!                               configuration.packageSearchIndex,</span>
<span class="line-added">+                               &quot;packageSearchIndex&quot;);</span>
          SearchIndexItem si = new SearchIndexItem();
          si.setCategory(SearchIndexItem.Category.TYPES);
          si.setLabel(resources.getText(&quot;doclet.All_Classes&quot;));
          si.setUrl(DocPaths.ALLCLASSES_INDEX.getPath());
          configuration.typeSearchIndex.add(si);
<span class="line-modified">!         createSearchIndexFile(DocPaths.TYPE_SEARCH_INDEX_JS,</span>
<span class="line-modified">!                               configuration.typeSearchIndex,</span>
<span class="line-modified">!                               &quot;typeSearchIndex&quot;);</span>
<span class="line-modified">!         createSearchIndexFile(DocPaths.MEMBER_SEARCH_INDEX_JS,</span>
<span class="line-modified">!                               configuration.memberSearchIndex,</span>
<span class="line-modified">!                               &quot;memberSearchIndex&quot;);</span>
<span class="line-added">+         createSearchIndexFile(DocPaths.TAG_SEARCH_INDEX_JS,</span>
<span class="line-added">+                               configuration.tagSearchIndex,</span>
<span class="line-added">+                               &quot;tagSearchIndex&quot;);</span>
      }
  
      /**
       * Creates a search index file.
       *
       * @param searchIndexJS     the file for the JavaScript to be generated
       * @param searchIndex       the search index items
       * @param varName           the variable name to write in the JavaScript file
       * @throws DocFileIOException if there is a problem creating the search index file
       */
<span class="line-modified">!     protected void createSearchIndexFile(DocPath searchIndexJS,</span>
<span class="line-modified">!                                          Collection&lt;SearchIndexItem&gt; searchIndex,</span>
<span class="line-added">+                                          String varName)</span>
<span class="line-added">+             throws DocFileIOException</span>
<span class="line-added">+     {</span>
          if (!searchIndex.isEmpty()) {
              StringBuilder searchVar = new StringBuilder(&quot;[&quot;);
              boolean first = true;
              for (SearchIndexItem item : searchIndex) {
                  if (first) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 487,22 ***</span>
                  wr.write(&quot; = &quot;);
                  wr.write(searchVar.toString());
              } catch (IOException ie) {
                  throw new DocFileIOException(jsFile, DocFileIOException.Mode.WRITE, ie);
              }
<span class="line-removed">- </span>
<span class="line-removed">-             DocFile zipFile = DocFile.createFileForOutput(configuration, searchIndexZip);</span>
<span class="line-removed">-             try (OutputStream fos = zipFile.openOutputStream();</span>
<span class="line-removed">-                     ZipOutputStream zos = new ZipOutputStream(fos)) {</span>
<span class="line-removed">-                 try {</span>
<span class="line-removed">-                     ZipEntry ze = new ZipEntry(searchIndexFile.getPath());</span>
<span class="line-removed">-                     zos.putNextEntry(ze);</span>
<span class="line-removed">-                     zos.write(searchVar.toString().getBytes());</span>
<span class="line-removed">-                 } finally {</span>
<span class="line-removed">-                     zos.closeEntry();</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             } catch (IOException ie) {</span>
<span class="line-removed">-                 throw new DocFileIOException(zipFile, DocFileIOException.Mode.WRITE, ie);</span>
<span class="line-removed">-             }</span>
          }
      }
  }
<span class="line-new-header">--- 484,8 ---</span>
</pre>
<center><a href="AbstractExecutableMemberWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractMemberWriter.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>