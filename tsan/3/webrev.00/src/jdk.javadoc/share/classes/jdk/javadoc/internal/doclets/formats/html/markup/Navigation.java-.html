<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/markup/Navigation.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 /*
   2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 package jdk.javadoc.internal.doclets.formats.html.markup;
  26 
  27 import java.util.ArrayDeque;
  28 import java.util.ArrayList;
  29 import java.util.Deque;
  30 import java.util.HashMap;
  31 import java.util.List;
  32 import java.util.Map;
  33 import java.util.Set;
  34 import java.util.SortedSet;
  35 
  36 import javax.lang.model.element.Element;
  37 import javax.lang.model.element.ElementKind;
  38 import javax.lang.model.element.ModuleElement;
  39 import javax.lang.model.element.PackageElement;
  40 import javax.lang.model.element.TypeElement;
  41 
  42 import jdk.javadoc.internal.doclets.formats.html.AbstractMemberWriter;
  43 import jdk.javadoc.internal.doclets.formats.html.Contents;
  44 import jdk.javadoc.internal.doclets.formats.html.HtmlConfiguration;
  45 import jdk.javadoc.internal.doclets.formats.html.MarkerComments;
  46 import jdk.javadoc.internal.doclets.formats.html.SectionName;
  47 import jdk.javadoc.internal.doclets.toolkit.Content;
  48 import jdk.javadoc.internal.doclets.toolkit.builders.MemberSummaryBuilder;
  49 import jdk.javadoc.internal.doclets.toolkit.util.DocFile;
  50 import jdk.javadoc.internal.doclets.toolkit.util.DocLink;
  51 import jdk.javadoc.internal.doclets.toolkit.util.DocPath;
  52 import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
  53 import jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable;
  54 
  55 import static jdk.javadoc.internal.doclets.toolkit.util.VisibleMemberTable.Kind.*;
  56 
  57 /**
  58  * Factory for navigation bar.
  59  *
  60  * &lt;p&gt;
  61  * &lt;b&gt;This is NOT part of any supported API. If you write code that depends on this, you do so at
  62  * your own risk. This code and its internal interfaces are subject to change or deletion without
  63  * notice.&lt;/b&gt;
  64  */
  65 public class Navigation {
  66 
  67     private final HtmlConfiguration configuration;
  68     private final Element element;
  69     private final Contents contents;
  70     private final DocPath path;
  71     private final DocPath pathToRoot;
  72     private final Links links;
  73     private final HtmlTree fixedNavDiv;
  74     private final PageMode documentedPage;
  75     private Content navLinkModule;
  76     private Content navLinkPackage;
  77     private Content navLinkClass;
  78     private MemberSummaryBuilder memberSummaryBuilder;
  79     private boolean displaySummaryModuleDescLink;
  80     private boolean displaySummaryModulesLink;
  81     private boolean displaySummaryPackagesLink;
  82     private boolean displaySummaryServicesLink;
  83     private final Map&lt;Position, Deque&lt;Content&gt;&gt; topBottomNavContents;
  84     private Content userHeader;
  85     private Content userFooter;
  86     private final String rowListTitle;
  87     private final Content searchLabel;
  88     private static final Script FIXED_NAV_SCRIPT = new Script(&quot;&lt;!--\n&quot;
  89             + &quot;$(&#39;.navPadding&#39;).css(&#39;padding-top&#39;, $(&#39;.fixedNav&#39;).css(\&quot;height\&quot;));\n&quot;
  90             + &quot;//--&gt;\n&quot;);
  91 
  92     public enum PageMode {
  93         ALLCLASSES,
  94         ALLPACKAGES,
  95         CLASS,
  96         CONSTANTVALUES,
  97         DEPRECATED,
  98         DOCFILE,
  99         HELP,
 100         INDEX,
 101         MODULE,
 102         OVERVIEW,
 103         PACKAGE,
 104         SERIALIZEDFORM,
 105         TREE,
 106         USE;
 107     }
 108 
 109     enum Position {
 110         BOTTOM(MarkerComments.START_OF_BOTTOM_NAVBAR, MarkerComments.END_OF_BOTTOM_NAVBAR),
 111         TOP(MarkerComments.START_OF_TOP_NAVBAR, MarkerComments.END_OF_TOP_NAVBAR);
 112 
 113         final Content startOfNav;
 114         final Content endOfNav;
 115 
 116         Position(Content startOfNav, Content endOfNav) {
 117             this.startOfNav = startOfNav;
 118             this.endOfNav = endOfNav;
 119         }
 120 
 121         Content startOfNav() {
 122             return startOfNav;
 123         }
 124 
 125         Content endOfNav() {
 126             return endOfNav;
 127         }
 128     }
 129 
 130     /**
 131      * Creates a {@code Navigation} object for a specific file, to be written in a specific HTML
 132      * version.
 133      *
 134      * @param element element being documented. null if its not an element documentation page
 135      * @param configuration the configuration object
 136      * @param fixedNavDiv the fixed navigation for the header navigation
 137      * @param page the kind of page being documented
 138      * @param path the DocPath object
 139      */
 140     public Navigation(Element element, HtmlConfiguration configuration, HtmlTree fixedNavDiv,
 141             PageMode page, DocPath path) {
 142         this.configuration = configuration;
 143         this.element = element;
 144         this.fixedNavDiv = fixedNavDiv;
 145         this.contents = configuration.contents;
 146         this.documentedPage = page;
 147         this.path = path;
 148         this.pathToRoot = path.parent().invert();
 149         this.links = new Links(path);
 150         this.topBottomNavContents = new HashMap&lt;&gt;();
 151         this.rowListTitle = configuration.getResources().getText(&quot;doclet.Navigation&quot;);
 152         this.searchLabel = contents.getContent(&quot;doclet.search&quot;);
 153         populateNavContents(Position.TOP);
 154         populateNavContents(Position.BOTTOM);
 155     }
 156 
 157     /**
 158      * Populate the navigation contents for top and bottom navigation
 159      *
 160      * @param position the position of the navigation bar on the page
 161      */
 162     private void populateNavContents(Position position) {
 163         Deque&lt;Content&gt; queue = new ArrayDeque&lt;&gt;();
 164         Content skipNavLinks = contents.getContent(&quot;doclet.Skip_navigation_links&quot;);
 165         switch (position) {
 166             case TOP:
 167                 queue.addLast(links.createAnchor(SectionName.NAVBAR_TOP));
 168                 queue.addLast(links.createLink(SectionName.SKIP_NAVBAR_TOP, skipNavLinks,
 169                         skipNavLinks.toString(), &quot;&quot;));
 170                 queue.addLast(links.createAnchor(SectionName.NAVBAR_TOP_FIRSTROW));
 171                 queue.addLast(links.createAnchor(SectionName.SKIP_NAVBAR_TOP));
 172                 topBottomNavContents.put(position, queue);
 173                 break;
 174             case BOTTOM:
 175                 queue.addLast(links.createAnchor(SectionName.NAVBAR_BOTTOM));
 176                 queue.addLast(links.createLink(SectionName.SKIP_NAVBAR_BOTTOM, skipNavLinks,
 177                         skipNavLinks.toString(), &quot;&quot;));
 178                 queue.addLast(links.createAnchor(SectionName.NAVBAR_BOTTOM_FIRSTROW));
 179                 queue.addLast(links.createAnchor(SectionName.SKIP_NAVBAR_BOTTOM));
 180                 topBottomNavContents.put(position, queue);
 181                 break;
 182             default:
 183                 break;
 184         }
 185     }
 186 
 187     public Navigation setNavLinkModule(Content navLinkModule) {
 188         this.navLinkModule = navLinkModule;
 189         return this;
 190     }
 191 
 192     public Navigation setNavLinkPackage(Content navLinkPackage) {
 193         this.navLinkPackage = navLinkPackage;
 194         return this;
 195     }
 196 
 197     public Navigation setNavLinkClass(Content navLinkClass) {
 198         this.navLinkClass = navLinkClass;
 199         return this;
 200     }
 201 
 202     public Navigation setMemberSummaryBuilder(MemberSummaryBuilder memberSummaryBuilder) {
 203         this.memberSummaryBuilder = memberSummaryBuilder;
 204         return this;
 205     }
 206 
 207     public Navigation setDisplaySummaryModuleDescLink(boolean displaySummaryModuleDescLink) {
 208         this.displaySummaryModuleDescLink = displaySummaryModuleDescLink;
 209         return this;
 210     }
 211 
 212     public Navigation setDisplaySummaryModulesLink(boolean displaySummaryModulesLink) {
 213         this.displaySummaryModulesLink = displaySummaryModulesLink;
 214         return this;
 215     }
 216 
 217     public Navigation setDisplaySummaryPackagesLink(boolean displaySummaryPackagesLink) {
 218         this.displaySummaryPackagesLink = displaySummaryPackagesLink;
 219         return this;
 220     }
 221 
 222     public Navigation setDisplaySummaryServicesLink(boolean displaySummaryServicesLink) {
 223         this.displaySummaryServicesLink = displaySummaryServicesLink;
 224         return this;
 225     }
 226 
 227     public Navigation setUserHeader(Content userHeader) {
 228         this.userHeader = userHeader;
 229         return this;
 230     }
 231 
 232     public Navigation setUserFooter(Content userFooter) {
 233         this.userFooter = userFooter;
 234         return this;
 235     }
 236 
 237     /**
 238      * Add the links for the main navigation.
 239      *
 240      * @param tree the content tree to which the main navigation will added
 241      */
 242     private void addMainNavLinks(Content tree) {
 243         switch (documentedPage) {
 244             case OVERVIEW:
 245                 addActivePageLink(tree, contents.overviewLabel, configuration.createoverview);
 246                 addModuleLink(tree);
 247                 addPackageLink(tree);
 248                 addPageLabel(tree, contents.classLabel, true);
 249                 addPageLabel(tree, contents.useLabel, configuration.classuse);
 250                 addTreeLink(tree);
 251                 addDeprecatedLink(tree);
 252                 addIndexLink(tree);
 253                 addHelpLink(tree);
 254                 break;
 255             case MODULE:
 256                 addOverviewLink(tree);
 257                 addActivePageLink(tree, contents.moduleLabel, configuration.showModules);
 258                 addPackageLink(tree);
 259                 addPageLabel(tree, contents.classLabel, true);
 260                 addPageLabel(tree, contents.useLabel, configuration.classuse);
 261                 addTreeLink(tree);
 262                 addDeprecatedLink(tree);
 263                 addIndexLink(tree);
 264                 addHelpLink(tree);
 265                 break;
 266             case PACKAGE:
 267                 addOverviewLink(tree);
 268                 addModuleOfElementLink(tree);
 269                 addActivePageLink(tree, contents.packageLabel, true);
 270                 addPageLabel(tree, contents.classLabel, true);
 271                 if (configuration.classuse) {
 272                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_USE,
 273                             contents.useLabel, &quot;&quot;, &quot;&quot;));
 274                 }
 275                 if (configuration.createtree) {
 276                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_TREE,
 277                             contents.treeLabel, &quot;&quot;, &quot;&quot;));
 278                 }
 279                 addDeprecatedLink(tree);
 280                 addIndexLink(tree);
 281                 addHelpLink(tree);
 282                 break;
 283             case CLASS:
 284                 addOverviewLink(tree);
 285                 addModuleOfElementLink(tree);
 286                 addPackageSummaryLink(tree);
 287                 addActivePageLink(tree, contents.classLabel, true);
 288                 if (configuration.classuse) {
 289                     addContentToTree(tree, links.createLink(DocPaths.CLASS_USE.resolve(path.basename()),
 290                             contents.useLabel));
 291                 }
 292                 if (configuration.createtree) {
 293                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_TREE,
 294                             contents.treeLabel, &quot;&quot;, &quot;&quot;));
 295                 }
 296                 addDeprecatedLink(tree);
 297                 addIndexLink(tree);
 298                 addHelpLink(tree);
 299                 break;
 300             case USE:
 301                 addOverviewLink(tree);
 302                 addModuleOfElementLink(tree);
 303                 if (element instanceof PackageElement) {
 304                     addPackageSummaryLink(tree);
 305                     addPageLabel(tree, contents.classLabel, true);
 306                 } else {
 307                     addPackageOfElementLink(tree);
 308                     addContentToTree(tree, navLinkClass);
 309                 }
 310                 addActivePageLink(tree, contents.useLabel, configuration.classuse);
 311                 if (element instanceof PackageElement) {
 312                     addContentToTree(tree, links.createLink(DocPaths.PACKAGE_TREE, contents.treeLabel));
 313                 } else {
 314                     addContentToTree(tree, configuration.utils.isEnclosingPackageIncluded((TypeElement) element)
 315                             ? links.createLink(DocPath.parent.resolve(DocPaths.PACKAGE_TREE), contents.treeLabel)
 316                             : links.createLink(pathToRoot.resolve(DocPaths.OVERVIEW_TREE), contents.treeLabel));
 317                 }
 318                 addDeprecatedLink(tree);
 319                 addIndexLink(tree);
 320                 addHelpLink(tree);
 321                 break;
 322             case TREE:
 323                 addOverviewLink(tree);
 324                 if (element == null) {
 325                     addPageLabel(tree, contents.moduleLabel, configuration.showModules);
 326                     addPageLabel(tree, contents.packageLabel, true);
 327                 } else {
 328                     addModuleOfElementLink(tree);
 329                     addPackageSummaryLink(tree);
 330                 }
 331                 addPageLabel(tree, contents.classLabel, true);
 332                 addPageLabel(tree, contents.useLabel, configuration.classuse);
 333                 addActivePageLink(tree, contents.treeLabel, configuration.createtree);
 334                 addDeprecatedLink(tree);
 335                 addIndexLink(tree);
 336                 addHelpLink(tree);
 337                 break;
 338             case DEPRECATED:
 339             case INDEX:
 340             case HELP:
 341                 addOverviewLink(tree);
 342                 addModuleLink(tree);
 343                 addPackageLink(tree);
 344                 addPageLabel(tree, contents.classLabel, true);
 345                 addPageLabel(tree, contents.useLabel, configuration.classuse);
 346                 addTreeLink(tree);
 347                 if (documentedPage == PageMode.DEPRECATED) {
 348                     addActivePageLink(tree, contents.deprecatedLabel, !(configuration.nodeprecated
 349                             || configuration.nodeprecatedlist));
 350                 } else {
 351                     addDeprecatedLink(tree);
 352                 }
 353                 if (documentedPage == PageMode.INDEX) {
 354                     addActivePageLink(tree, contents.indexLabel, configuration.createindex);
 355                 } else {
 356                     addIndexLink(tree);
 357                 }
 358                 if (documentedPage == PageMode.HELP) {
 359                     addActivePageLink(tree, contents.helpLabel, !configuration.nohelp);
 360                 } else {
 361                     addHelpLink(tree);
 362                 }
 363                 break;
 364             case ALLCLASSES:
 365             case ALLPACKAGES:
 366             case CONSTANTVALUES:
 367             case SERIALIZEDFORM:
 368                 addOverviewLink(tree);
 369                 addModuleLink(tree);
 370                 addPackageLink(tree);
 371                 addPageLabel(tree, contents.classLabel, true);
 372                 addPageLabel(tree, contents.useLabel, configuration.classuse);
 373                 addTreeLink(tree);
 374                 addDeprecatedLink(tree);
 375                 addIndexLink(tree);
 376                 addHelpLink(tree);
 377                 break;
 378             case DOCFILE:
 379                 addOverviewLink(tree);
 380                 addModuleOfElementLink(tree);
 381                 addContentToTree(tree, navLinkPackage);
 382                 addPageLabel(tree, contents.classLabel, true);
 383                 addPageLabel(tree, contents.useLabel, configuration.classuse);
 384                 addTreeLink(tree);
 385                 addDeprecatedLink(tree);
 386                 addIndexLink(tree);
 387                 addHelpLink(tree);
 388                 break;
 389             default:
 390                 break;
 391         }
 392     }
 393 
 394     /**
 395      * Add the summary links to the sub-navigation.
 396      *
 397      * @param tree the content tree to which the sub-navigation will added
 398      */
 399     private void addSummaryLinks(Content tree) {
 400         List&lt;Content&gt; listContents = new ArrayList&lt;&gt;();
 401         switch (documentedPage) {
 402             case CLASS:
 403                 if (element.getKind() == ElementKind.ANNOTATION_TYPE) {
 404                     addAnnotationTypeSummaryLink(&quot;doclet.navField&quot;,
 405                             ANNOTATION_TYPE_FIELDS, listContents);
 406                     addAnnotationTypeSummaryLink(&quot;doclet.navAnnotationTypeRequiredMember&quot;,
 407                             ANNOTATION_TYPE_MEMBER_REQUIRED, listContents);
 408                     addAnnotationTypeSummaryLink(&quot;doclet.navAnnotationTypeOptionalMember&quot;,
 409                             ANNOTATION_TYPE_MEMBER_OPTIONAL, listContents);
 410                 } else {
 411                     TypeElement typeElement = (TypeElement) element;
 412                     for (VisibleMemberTable.Kind kind : summarySet) {
 413                         if (kind == ENUM_CONSTANTS &amp;&amp; !configuration.utils.isEnum(typeElement)) {
 414                             continue;
 415                         }
 416                         if (kind == CONSTRUCTORS &amp;&amp; configuration.utils.isEnum(typeElement)) {
 417                             continue;
 418                         }
 419                         AbstractMemberWriter writer
 420                                 = ((AbstractMemberWriter) memberSummaryBuilder.getMemberSummaryWriter(kind));
 421                         if (writer == null) {
 422                             addContentToList(listContents, contents.getNavLinkLabelContent(kind));
 423                         } else {
 424                             addTypeSummaryLink(memberSummaryBuilder.members(kind),
 425                                     memberSummaryBuilder.getVisibleMemberTable(),
 426                                     kind, listContents);
 427                         }
 428                     }
 429                 }
 430                 if (!listContents.isEmpty()) {
 431                     Content li = HtmlTree.LI(contents.summaryLabel);
 432                     li.add(Contents.SPACE);
 433                     tree.add(li);
 434                     addListToNav(listContents, tree);
 435                 }
 436                 break;
 437             case MODULE:
 438                 if (displaySummaryModuleDescLink) {
 439                     addContentToList(listContents,
 440                             links.createLink(SectionName.MODULE_DESCRIPTION, contents.navModuleDescription));
 441                 } else {
 442                     addContentToList(listContents, contents.navModuleDescription);
 443                 }
 444                 if (displaySummaryModulesLink) {
 445                     addContentToList(listContents,
 446                             links.createLink(SectionName.MODULES, contents.navModules));
 447                 } else {
 448                     addContentToList(listContents, contents.navModules);
 449                 }
 450                 if (displaySummaryPackagesLink) {
 451                     addContentToList(listContents,
 452                             links.createLink(SectionName.PACKAGES, contents.navPackages));
 453                 } else {
 454                     addContentToList(listContents, contents.navPackages);
 455                 }
 456                 if (displaySummaryServicesLink) {
 457                     addContentToList(listContents,
 458                             links.createLink(SectionName.SERVICES, contents.navServices));
 459                 } else {
 460                     addContentToList(listContents, contents.navServices);
 461                 }
 462                 if (!listContents.isEmpty()) {
 463                     Content li = HtmlTree.LI(contents.moduleSubNavLabel);
 464                     li.add(Contents.SPACE);
 465                     tree.add(li);
 466                     addListToNav(listContents, tree);
 467                 }
 468                 break;
 469             default:
 470                 break;
 471         }
 472     }
 473 
 474     /**
 475      * Add the navigation summary link.
 476      *
 477      * @param members members to be linked
 478      * @param vmt the visible member table
 479      * @param kind the visible member kind
 480      * @param listContents the list of contents
 481      */
 482     private void addTypeSummaryLink(SortedSet&lt;? extends Element&gt; members,
 483             VisibleMemberTable vmt,
 484             VisibleMemberTable.Kind kind, List&lt;Content&gt; listContents) {
 485         if (!members.isEmpty()) {
 486             addTypeSummaryLink(null, kind, true, listContents);
 487             return;
 488         }
 489         Set&lt;TypeElement&gt; visibleClasses = vmt.getVisibleTypeElements();
 490         for (TypeElement t : visibleClasses) {
 491             if (configuration.getVisibleMemberTable(t).hasVisibleMembers(kind)) {
 492                 addTypeSummaryLink(null, kind, true, listContents);
 493                 return;
 494             }
 495         }
 496         addTypeSummaryLink(null, kind, false, listContents);
 497     }
 498 
 499     /**
 500      * Add the navigation Type summary link.
 501      *
 502      * @param typeElement the Type being documented
 503      * @param kind the kind of member being documented
 504      * @param link true if the members are listed and need to be linked
 505      * @param listContents the list of contents to which the summary will be added
 506      */
 507     private void addTypeSummaryLink(TypeElement typeElement, VisibleMemberTable.Kind kind, boolean link,
 508             List&lt;Content&gt; listContents) {
 509         switch (kind) {
 510             case CONSTRUCTORS:
 511                 if (link) {
 512                     addContentToList(listContents, links.createLink(SectionName.CONSTRUCTOR_SUMMARY,
 513                             contents.navConstructor));
 514                 } else {
 515                     addContentToList(listContents, contents.navConstructor);
 516                 }
 517                 break;
 518             case ENUM_CONSTANTS:
 519                 if (link) {
 520                     if (typeElement == null) {
 521                         addContentToList(listContents, links.createLink(SectionName.ENUM_CONSTANT_SUMMARY,
 522                                 contents.navEnum));
 523                     } else {
 524                         addContentToList(listContents, links.createLink(
 525                                 SectionName.ENUM_CONSTANTS_INHERITANCE,
 526                                 configuration.getClassName(typeElement), contents.navEnum));
 527                     }
 528                 } else {
 529                     addContentToList(listContents, contents.navEnum);
 530                 }
 531                 break;
 532             case FIELDS:
 533                 if (link) {
 534                     if (typeElement == null) {
 535                         addContentToList(listContents,
 536                                 links.createLink(SectionName.FIELD_SUMMARY, contents.navField));
 537                     } else {
 538                         addContentToList(listContents, links.createLink(SectionName.FIELDS_INHERITANCE,
 539                                 configuration.getClassName(typeElement), contents.navField));
 540                     }
 541                 } else {
 542                     addContentToList(listContents, contents.navField);
 543                 }
 544                 break;
 545             case METHODS:
 546                 if (link) {
 547                     if (typeElement == null) {
 548                         addContentToList(listContents,
 549                                 links.createLink(SectionName.METHOD_SUMMARY, contents.navMethod));
 550                     } else {
 551                         addContentToList(listContents, links.createLink(SectionName.METHODS_INHERITANCE,
 552                                 configuration.getClassName(typeElement), contents.navMethod));
 553                     }
 554                 } else {
 555                     addContentToList(listContents, contents.navMethod);
 556                 }
 557                 break;
 558             case INNER_CLASSES:
 559                 if (link) {
 560                     if (typeElement == null) {
 561                         addContentToList(listContents,
 562                                 links.createLink(SectionName.NESTED_CLASS_SUMMARY, contents.navNested));
 563                     } else {
 564                         addContentToList(listContents, links.createLink(SectionName.NESTED_CLASSES_INHERITANCE,
 565                                 configuration.utils.getFullyQualifiedName(typeElement), contents.navNested));
 566                     }
 567                 } else {
 568                     addContentToList(listContents, contents.navNested);
 569                 }
 570                 break;
 571             case PROPERTIES:
 572                 if (link) {
 573                     if (typeElement == null) {
 574                         addContentToList(listContents,
 575                                 links.createLink(SectionName.PROPERTY_SUMMARY, contents.navProperty));
 576                     } else {
 577                         addContentToList(listContents, links.createLink(SectionName.PROPERTIES_INHERITANCE,
 578                                 configuration.getClassName(typeElement), contents.navProperty));
 579                     }
 580                 } else {
 581                     addContentToList(listContents, contents.navProperty);
 582                 }
 583                 break;
 584             default:
 585                 break;
 586         }
 587     }
 588 
 589     /**
 590      * Add the navigation Type summary link.
 591      *
 592      * @param label the label to be added
 593      * @param kind the kind of member being documented
 594      * @param listContents the list of contents to which the summary will be added
 595      */
 596     private void addAnnotationTypeSummaryLink(String label, VisibleMemberTable.Kind kind, List&lt;Content&gt; listContents) {
 597         AbstractMemberWriter writer = ((AbstractMemberWriter) memberSummaryBuilder.
 598                 getMemberSummaryWriter(kind));
 599         if (writer == null) {
 600             addContentToList(listContents, contents.getContent(label));
 601         } else {
 602             boolean link = memberSummaryBuilder.getVisibleMemberTable().hasVisibleMembers(kind);
 603             switch (kind) {
 604                 case ANNOTATION_TYPE_FIELDS:
 605                     if (link) {
 606                         addContentToList(listContents, links.createLink(SectionName.ANNOTATION_TYPE_FIELD_SUMMARY,
 607                                 contents.navField));
 608                     } else {
 609                         addContentToList(listContents, contents.navField);
 610                     }
 611                     break;
 612                 case ANNOTATION_TYPE_MEMBER_REQUIRED:
 613                     if (link) {
 614                         addContentToList(listContents, links.createLink(
 615                                 SectionName.ANNOTATION_TYPE_REQUIRED_ELEMENT_SUMMARY,
 616                                 contents.navAnnotationTypeRequiredMember));
 617                     } else {
 618                         addContentToList(listContents, contents.navAnnotationTypeRequiredMember);
 619                     }
 620                     break;
 621                 case ANNOTATION_TYPE_MEMBER_OPTIONAL:
 622                     if (link) {
 623                         addContentToList(listContents, links.createLink(
 624                                 SectionName.ANNOTATION_TYPE_OPTIONAL_ELEMENT_SUMMARY,
 625                                 contents.navAnnotationTypeOptionalMember));
 626                     } else {
 627                         addContentToList(listContents, contents.navAnnotationTypeOptionalMember);
 628                     }
 629                     break;
 630                 default:
 631                     break;
 632             }
 633         }
 634     }
 635 
 636     /**
 637      * Add the detail links to sub-navigation.
 638      *
 639      * @param tree the content tree to which the links will be added
 640      */
 641     private void addDetailLinks(Content tree) {
 642         switch (documentedPage) {
 643             case CLASS:
 644                 List&lt;Content&gt; listContents = new ArrayList&lt;&gt;();
 645                 if (element.getKind() == ElementKind.ANNOTATION_TYPE) {
 646                     addAnnotationTypeDetailLink(listContents);
 647                 } else {
 648                     TypeElement typeElement = (TypeElement) element;
 649                     for (VisibleMemberTable.Kind kind : detailSet) {
 650                         AbstractMemberWriter writer
 651                                 = ((AbstractMemberWriter) memberSummaryBuilder.
 652                                         getMemberSummaryWriter(kind));
 653                         if (kind == ENUM_CONSTANTS &amp;&amp; !configuration.utils.isEnum(typeElement)) {
 654                             continue;
 655                         }
 656                         if (kind == CONSTRUCTORS &amp;&amp; configuration.utils.isEnum(typeElement)) {
 657                             continue;
 658                         }
 659                         if (writer == null) {
 660                             addContentToList(listContents, contents.getNavLinkLabelContent(kind));
 661                         } else {
 662                             addTypeDetailLink(kind, memberSummaryBuilder.hasMembers(kind), listContents);
 663                         }
 664                     }
 665                 }
 666                 if (!listContents.isEmpty()) {
 667                     Content li = HtmlTree.LI(contents.detailLabel);
 668                     li.add(Contents.SPACE);
 669                     tree.add(li);
 670                     addListToNav(listContents, tree);
 671                 }
 672                 break;
 673             default:
 674                 break;
 675         }
 676     }
 677 
 678     /**
 679      * Add the navigation Type detail link.
 680      *
 681      * @param kind the kind of member being documented
 682      * @param link true if the members are listed and need to be linked
 683      * @param listContents the list of contents to which the detail will be added.
 684      */
 685     protected void addTypeDetailLink(VisibleMemberTable.Kind kind, boolean link, List&lt;Content&gt; listContents) {
 686         switch (kind) {
 687             case CONSTRUCTORS:
 688                 if (link) {
 689                     addContentToList(listContents, links.createLink(SectionName.CONSTRUCTOR_DETAIL, contents.navConstructor));
 690                 } else {
 691                     addContentToList(listContents, contents.navConstructor);
 692                 }
 693                 break;
 694             case ENUM_CONSTANTS:
 695                 if (link) {
 696                     addContentToList(listContents, links.createLink(SectionName.ENUM_CONSTANT_DETAIL, contents.navEnum));
 697                 } else {
 698                     addContentToList(listContents, contents.navEnum);
 699                 }
 700                 break;
 701             case FIELDS:
 702                 if (link) {
 703                     addContentToList(listContents, links.createLink(SectionName.FIELD_DETAIL, contents.navField));
 704                 } else {
 705                     addContentToList(listContents, contents.navField);
 706                 }
 707                 break;
 708             case METHODS:
 709                 if (link) {
 710                     addContentToList(listContents, links.createLink(SectionName.METHOD_DETAIL, contents.navMethod));
 711                 } else {
 712                     addContentToList(listContents, contents.navMethod);
 713                 }
 714                 break;
 715             case PROPERTIES:
 716                 if (link) {
 717                     addContentToList(listContents, links.createLink(SectionName.PROPERTY_DETAIL, contents.navProperty));
 718                 } else {
 719                     addContentToList(listContents, contents.navProperty);
 720                 }
 721                 break;
 722             default:
 723                 break;
 724         }
 725     }
 726 
 727     /**
 728      * Add the navigation Annotation Type detail link.
 729      *
 730      * @param listContents the list of contents to which the annotation detail will be added.
 731      */
 732     protected void addAnnotationTypeDetailLink(List&lt;Content&gt; listContents) {
 733         TypeElement annotationType = (TypeElement) element;
 734         AbstractMemberWriter writerField
 735                 = ((AbstractMemberWriter) memberSummaryBuilder.
 736                         getMemberSummaryWriter(ANNOTATION_TYPE_FIELDS));
 737         AbstractMemberWriter writerOptional
 738                 = ((AbstractMemberWriter) memberSummaryBuilder.
 739                         getMemberSummaryWriter(ANNOTATION_TYPE_MEMBER_OPTIONAL));
 740         AbstractMemberWriter writerRequired
 741                 = ((AbstractMemberWriter) memberSummaryBuilder.
 742                         getMemberSummaryWriter(ANNOTATION_TYPE_MEMBER_REQUIRED));
 743         if (writerField != null) {
 744             addAnnotationTypeDetailLink(ANNOTATION_TYPE_FIELDS,
 745                     !configuration.utils.getAnnotationFields(annotationType).isEmpty(),
 746                     listContents);
 747         } else {
 748             addContentToList(listContents, contents.navField);
 749         }
 750         if (writerOptional != null) {
 751             addAnnotationTypeDetailLink(ANNOTATION_TYPE_MEMBER_OPTIONAL,
 752                     !annotationType.getAnnotationMirrors().isEmpty(), listContents);
 753         } else if (writerRequired != null) {
 754             addAnnotationTypeDetailLink(ANNOTATION_TYPE_MEMBER_REQUIRED,
 755                     !annotationType.getAnnotationMirrors().isEmpty(), listContents);
 756         } else {
 757             addContentToList(listContents, contents.navAnnotationTypeMember);
 758         }
 759     }
 760 
 761     /**
 762      * Add the navigation Annotation Type detail link.
 763      *
 764      * @param type the kind of member being documented
 765      * @param link true if the member details need to be linked
 766      * @param listContents the list of contents to which the annotation detail will be added.
 767      */
 768     protected void addAnnotationTypeDetailLink(VisibleMemberTable.Kind type, boolean link, List&lt;Content&gt; listContents) {
 769         switch (type) {
 770             case ANNOTATION_TYPE_FIELDS:
 771                 if (link) {
 772                     addContentToList(listContents, links.createLink(SectionName.ANNOTATION_TYPE_FIELD_DETAIL,
 773                             contents.navField));
 774                 } else {
 775                     addContentToList(listContents, contents.navField);
 776                 }
 777                 break;
 778             case ANNOTATION_TYPE_MEMBER_REQUIRED:
 779             case ANNOTATION_TYPE_MEMBER_OPTIONAL:
 780                 if (link) {
 781                     addContentToList(listContents, links.createLink(SectionName.ANNOTATION_TYPE_ELEMENT_DETAIL,
 782                             contents.navAnnotationTypeMember));
 783                 } else {
 784                     addContentToList(listContents, contents.navAnnotationTypeMember);
 785                 }
 786                 break;
 787             default:
 788                 break;
 789         }
 790     }
 791 
 792     private void addContentToList(List&lt;Content&gt; listContents, Content tree) {
 793         listContents.add(HtmlTree.LI(tree));
 794     }
 795 
 796     private void addContentToTree(Content tree, Content content) {
 797         tree.add(HtmlTree.LI(content));
 798     }
 799 
 800     private void addListToNav(List&lt;Content&gt; listContents, Content tree) {
 801         int count = 0;
 802         for (Content liContent : listContents) {
 803             if (count &lt; listContents.size() - 1) {
 804                 liContent.add(Contents.SPACE);
 805                 liContent.add(&quot;|&quot;);
 806                 liContent.add(Contents.SPACE);
 807             }
 808             tree.add(liContent);
 809             count++;
 810         }
 811     }
 812 
 813     private void addActivePageLink(Content tree, Content label, boolean display) {
 814         if (display) {
 815             tree.add(HtmlTree.LI(HtmlStyle.navBarCell1Rev, label));
 816         }
 817     }
 818 
 819     private void addPageLabel(Content tree, Content label, boolean display) {
 820         if (display) {
 821             tree.add(HtmlTree.LI(label));
 822         }
 823     }
 824 
 825     private void addOverviewLink(Content tree) {
 826         if (configuration.createoverview) {
 827             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(DocPaths.overviewSummary(configuration.frames)),
 828                     contents.overviewLabel, &quot;&quot;, &quot;&quot;)));
 829         }
 830     }
 831 
 832     private void addModuleLink(Content tree) {
 833         if (configuration.showModules) {
 834             if (configuration.modules.size() == 1) {
 835                 ModuleElement mdle = configuration.modules.first();
 836                 boolean included = configuration.utils.isIncluded(mdle);
 837                 tree.add(HtmlTree.LI((included)
 838                         ? links.createLink(pathToRoot.resolve(configuration.docPaths.moduleSummary(mdle)), contents.moduleLabel, &quot;&quot;, &quot;&quot;)
 839                         : contents.moduleLabel));
 840             } else if (!configuration.modules.isEmpty()) {
 841                 addPageLabel(tree, contents.moduleLabel, true);
 842             }
 843         }
 844     }
 845 
 846     private void addModuleOfElementLink(Content tree) {
 847         if (configuration.showModules) {
 848             tree.add(HtmlTree.LI(navLinkModule));
 849         }
 850     }
 851 
 852     private void addPackageLink(Content tree) {
 853         if (configuration.packages.size() == 1) {
 854             PackageElement packageElement = configuration.packages.first();
 855             boolean included = packageElement != null &amp;&amp; configuration.utils.isIncluded(packageElement);
 856             if (!included) {
 857                 for (PackageElement p : configuration.packages) {
 858                     if (p.equals(packageElement)) {
 859                         included = true;
 860                         break;
 861                     }
 862                 }
 863             }
 864             if (included || packageElement == null) {
 865                 tree.add(HtmlTree.LI(links.createLink(
 866                         pathToRoot.resolve(configuration.docPaths.forPackage(packageElement).resolve(DocPaths.PACKAGE_SUMMARY)),
 867                         contents.packageLabel)));
 868             } else {
 869                 DocLink crossPkgLink = configuration.extern.getExternalLink(
 870                         packageElement, pathToRoot, DocPaths.PACKAGE_SUMMARY.getPath());
 871                 if (crossPkgLink != null) {
 872                     tree.add(HtmlTree.LI(links.createLink(crossPkgLink, contents.packageLabel)));
 873                 } else {
 874                     tree.add(HtmlTree.LI(contents.packageLabel));
 875                 }
 876             }
 877         } else if (!configuration.packages.isEmpty()) {
 878             addPageLabel(tree, contents.packageLabel, true);
 879         }
 880     }
 881 
 882     private void addPackageOfElementLink(Content tree) {
 883         tree.add(HtmlTree.LI(links.createLink(DocPath.parent.resolve(DocPaths.PACKAGE_SUMMARY),
 884                 contents.packageLabel)));
 885     }
 886 
 887     private void addPackageSummaryLink(Content tree) {
 888         tree.add(HtmlTree.LI(links.createLink(DocPaths.PACKAGE_SUMMARY, contents.packageLabel)));
 889     }
 890 
 891     private void addTreeLink(Content tree) {
 892         if (configuration.createtree) {
 893             List&lt;PackageElement&gt; packages = new ArrayList&lt;&gt;(configuration.getSpecifiedPackageElements());
 894             DocPath docPath = packages.size() == 1 &amp;&amp; configuration.getSpecifiedTypeElements().isEmpty()
 895                     ? pathToRoot.resolve(configuration.docPaths.forPackage(packages.get(0)).resolve(DocPaths.PACKAGE_TREE))
 896                     : pathToRoot.resolve(DocPaths.OVERVIEW_TREE);
 897             tree.add(HtmlTree.LI(links.createLink(docPath, contents.treeLabel, &quot;&quot;, &quot;&quot;)));
 898         }
 899     }
 900 
 901     private void addDeprecatedLink(Content tree) {
 902         if (!(configuration.nodeprecated || configuration.nodeprecatedlist)) {
 903             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(DocPaths.DEPRECATED_LIST),
 904                     contents.deprecatedLabel, &quot;&quot;, &quot;&quot;)));
 905         }
 906     }
 907 
 908     private void addIndexLink(Content tree) {
 909         if (configuration.createindex) {
 910             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(
 911                     (configuration.splitindex
 912                             ? DocPaths.INDEX_FILES.resolve(DocPaths.indexN(1))
 913                             : DocPaths.INDEX_ALL)),
 914                     contents.indexLabel, &quot;&quot;, &quot;&quot;)));
 915         }
 916     }
 917 
 918     private void addHelpLink(Content tree) {
 919         if (!configuration.nohelp) {
 920             String helpfile = configuration.helpfile;
 921             DocPath helpfilenm;
 922             if (helpfile.isEmpty()) {
 923                 helpfilenm = DocPaths.HELP_DOC;
 924             } else {
 925                 DocFile file = DocFile.createFileForInput(configuration, helpfile);
 926                 helpfilenm = DocPath.create(file.getName());
 927             }
 928             tree.add(HtmlTree.LI(links.createLink(pathToRoot.resolve(helpfilenm),
 929                     contents.helpLabel, &quot;&quot;, &quot;&quot;)));
 930         }
 931     }
 932 
 933     /**
 934      * Add &quot;FRAMES&quot; link, to switch to the frame version of the output.
 935      *
 936      * @param tree the content tree to which the link will be added
 937      */
 938     private void addNavShowLists(Content tree) {
 939         DocLink dl = new DocLink(pathToRoot.resolve(DocPaths.INDEX), path.getPath(), null);
 940         Content framesContent = links.createLink(dl, contents.framesLabel, &quot;&quot;, &quot;_top&quot;);
 941         tree.add(HtmlTree.LI(framesContent));
 942     }
 943 
 944     /**
 945      * Add &quot;NO FRAMES&quot; link, to switch to the non-frame version of the output.
 946      *
 947      * @param tree the content tree to which the link will be added
 948      */
 949     private void addNavHideLists(Content tree) {
 950         Content noFramesContent = links.createLink(path.basename(), contents.noFramesLabel, &quot;&quot;, &quot;_top&quot;);
 951         tree.add(HtmlTree.LI(noFramesContent));
 952     }
 953 
 954     private void addSearch(Content tree) {
 955         String searchValueId = &quot;search&quot;;
 956         String reset = &quot;reset&quot;;
 957         HtmlTree inputText = HtmlTree.INPUT(&quot;text&quot;, searchValueId, searchValueId);
 958         HtmlTree inputReset = HtmlTree.INPUT(reset, reset, reset);
 959         HtmlTree liInput = HtmlTree.LI(HtmlTree.LABEL(searchValueId, searchLabel));
 960         liInput.add(inputText);
 961         liInput.add(inputReset);
 962         HtmlTree ulSearch = HtmlTree.UL(HtmlStyle.navListSearch, liInput);
 963         tree.add(ulSearch);
 964     }
 965 
 966     private void addFixedNavScript(Content tree) {
 967         tree.add(FIXED_NAV_SCRIPT.asContent());
 968     }
 969 
 970     /**
 971      * Get the navigation content.
 972      *
 973      * @param top true if the top navigation bar is to be printed
 974      * @return the navigation contents
 975      */
 976     public Content getContent(boolean top) {
 977         Content contentTree = new ContentBuilder();
 978         if (!configuration.nonavbar) {
 979             Deque&lt;Content&gt; queue;
 980             Content tree = HtmlTree.NAV();
 981             HtmlTree navDiv = new HtmlTree(HtmlTag.DIV);
 982             if (top) {
 983                 queue = topBottomNavContents.get(Position.TOP);
 984                 fixedNavDiv.add(Position.TOP.startOfNav());
 985                 navDiv.setStyle(HtmlStyle.topNav);
 986             } else {
 987                 queue = topBottomNavContents.get(Position.BOTTOM);
 988                 tree.add(Position.BOTTOM.startOfNav());
 989                 navDiv.setStyle(HtmlStyle.bottomNav);
 990             }
 991             navDiv.add(queue.poll());
 992             HtmlTree skipLinkDiv = HtmlTree.DIV(HtmlStyle.skipNav, queue.poll());
 993             navDiv.add(skipLinkDiv);
 994             navDiv.add(queue.poll());
 995             HtmlTree navList = new HtmlTree(HtmlTag.UL);
 996             navList.setStyle(HtmlStyle.navList);
 997             navList.put(HtmlAttr.TITLE, rowListTitle);
 998             fixedNavDiv.setStyle(HtmlStyle.fixedNav);
 999             addMainNavLinks(navList);
1000             navDiv.add(navList);
1001             Content aboutDiv = HtmlTree.DIV(HtmlStyle.aboutLanguage, top ? userHeader : userFooter);
1002             navDiv.add(aboutDiv);
1003             if (top) {
1004                 fixedNavDiv.add(navDiv);
1005             } else {
1006                 tree.add(navDiv);
1007             }
1008             HtmlTree subDiv = new HtmlTree(HtmlTag.DIV);
1009             subDiv.setStyle(HtmlStyle.subNav);
1010             HtmlTree div = new HtmlTree(HtmlTag.DIV);
1011             // Add the summary links if present.
1012             HtmlTree ulNavSummary = new HtmlTree(HtmlTag.UL);
1013             ulNavSummary.setStyle(HtmlStyle.subNavList);
1014             addSummaryLinks(ulNavSummary);
1015             div.add(ulNavSummary);
1016             // Add the detail links if present.
1017             HtmlTree ulNavDetail = new HtmlTree(HtmlTag.UL);
1018             ulNavDetail.setStyle(HtmlStyle.subNavList);
1019             addDetailLinks(ulNavDetail);
1020             div.add(ulNavDetail);
1021             HtmlTree ulFrames = new HtmlTree(HtmlTag.UL);
1022             ulFrames.setStyle(HtmlStyle.navList);
1023             if (!configuration.nonavbar) {
1024                 if (configuration.frames) {
1025                     addNavShowLists(ulFrames);
1026                     addNavHideLists(ulFrames);
1027                 }
1028             }
1029             div.add(ulFrames);
1030             subDiv.add(div);
1031             if (top &amp;&amp; configuration.createindex) {
1032                 addSearch(subDiv);
1033             }
1034             if (top) {
1035                 fixedNavDiv.add(subDiv);
1036                 fixedNavDiv.add(queue.poll());
1037                 fixedNavDiv.add(Position.TOP.endOfNav());
1038                 tree.add(fixedNavDiv);
1039                 HtmlTree paddingDiv = HtmlTree.DIV(HtmlStyle.navPadding, Contents.SPACE);
1040                 tree.add(paddingDiv);
1041                 addFixedNavScript(tree);
1042             } else {
1043                 tree.add(subDiv);
1044                 tree.add(queue.poll());
1045                 tree.add(Position.BOTTOM.endOfNav());
1046             }
1047             return tree;
1048         }
1049         return contentTree;
1050     }
1051 }
    </pre>
  </body>
</html>