<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/HtmlConfiguration.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.formats.html;
 27 
<a name="2" id="anc2"></a><span class="line-removed"> 28 import java.net.*;</span>
 29 import java.util.*;
 30 import java.util.stream.Collectors;
 31 
 32 import javax.lang.model.element.Element;
 33 import javax.lang.model.element.PackageElement;
 34 import javax.lang.model.element.TypeElement;
 35 import javax.tools.JavaFileManager;
 36 import javax.tools.JavaFileObject;
 37 import javax.tools.StandardJavaFileManager;
 38 
 39 import com.sun.source.util.DocTreePath;
<a name="3" id="anc3"></a><span class="line-removed"> 40 import com.sun.tools.doclint.DocLint;</span>
 41 
 42 import jdk.javadoc.doclet.Doclet;
 43 import jdk.javadoc.doclet.DocletEnvironment;
<a name="4" id="anc4"></a>


 44 import jdk.javadoc.internal.doclets.toolkit.BaseConfiguration;
 45 import jdk.javadoc.internal.doclets.toolkit.DocletException;
 46 import jdk.javadoc.internal.doclets.toolkit.Messages;
 47 import jdk.javadoc.internal.doclets.toolkit.Resources;
 48 import jdk.javadoc.internal.doclets.toolkit.WriterFactory;
 49 import jdk.javadoc.internal.doclets.toolkit.util.DocFile;
 50 import jdk.javadoc.internal.doclets.toolkit.util.DocPath;
 51 import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
 52 
 53 import static javax.tools.Diagnostic.Kind.*;
 54 
 55 /**
<a name="5" id="anc5"></a><span class="line-modified"> 56  * Configure the output based on the command line options.</span>
 57  * &lt;p&gt;
<a name="6" id="anc6"></a><span class="line-modified"> 58  * Also determine the length of the command line option. For example,</span>
 59  * for a option &quot;-header&quot; there will be a string argument associated, then the
 60  * the length of option &quot;-header&quot; is two. But for option &quot;-nohelp&quot; no argument
 61  * is needed so it&#39;s length is 1.
 62  * &lt;/p&gt;
 63  * &lt;p&gt;
 64  * Also do the error checking on the options used. For example it is illegal to
 65  * use &quot;-helpfile&quot; option when already &quot;-nohelp&quot; option is used.
 66  * &lt;/p&gt;
 67  *
 68  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 69  *  If you write code that depends on this, you do so at your own risk.
 70  *  This code and its internal interfaces are subject to change or
 71  *  deletion without notice.&lt;/b&gt;
<a name="7" id="anc7"></a><span class="line-removed"> 72  *</span>
<span class="line-removed"> 73  * @author Robert Field.</span>
<span class="line-removed"> 74  * @author Atul Dambalkar.</span>
<span class="line-removed"> 75  * @author Jamie Ho</span>
<span class="line-removed"> 76  * @author Bhavesh Patel (Modified)</span>
 77  */
 78 public class HtmlConfiguration extends BaseConfiguration {
 79 
 80     /**
 81      * Default charset for HTML.
 82      */
 83     public static final String HTML_DEFAULT_CHARSET = &quot;utf-8&quot;;
 84 
<a name="8" id="anc8"></a><span class="line-modified"> 85     /**</span>
<span class="line-removed"> 86      * Argument for command line option &quot;-header&quot;.</span>
<span class="line-removed"> 87      */</span>
<span class="line-removed"> 88     public String header = &quot;&quot;;</span>
<span class="line-removed"> 89 </span>
<span class="line-removed"> 90     /**</span>
<span class="line-removed"> 91      * Argument for command line option &quot;-packagesheader&quot;.</span>
<span class="line-removed"> 92      */</span>
<span class="line-removed"> 93     public String packagesheader = &quot;&quot;;</span>
<span class="line-removed"> 94 </span>
<span class="line-removed"> 95     /**</span>
<span class="line-removed"> 96      * Argument for command line option &quot;-footer&quot;.</span>
<span class="line-removed"> 97      */</span>
<span class="line-removed"> 98     public String footer = &quot;&quot;;</span>
<span class="line-removed"> 99 </span>
<span class="line-removed">100     /**</span>
<span class="line-removed">101      * Argument for command line option &quot;-doctitle&quot;.</span>
<span class="line-removed">102      */</span>
<span class="line-removed">103     public String doctitle = &quot;&quot;;</span>
<span class="line-removed">104 </span>
<span class="line-removed">105     /**</span>
<span class="line-removed">106      * Argument for command line option &quot;-windowtitle&quot;.</span>
<span class="line-removed">107      */</span>
<span class="line-removed">108     public String windowtitle = &quot;&quot;;</span>
<span class="line-removed">109 </span>
<span class="line-removed">110     /**</span>
<span class="line-removed">111      * Argument for command line option &quot;-top&quot;.</span>
<span class="line-removed">112      */</span>
<span class="line-removed">113     public String top = &quot;&quot;;</span>
<span class="line-removed">114 </span>
<span class="line-removed">115     /**</span>
<span class="line-removed">116      * Argument for command line option &quot;-bottom&quot;.</span>
<span class="line-removed">117      */</span>
<span class="line-removed">118     public String bottom = &quot;&quot;;</span>
<span class="line-removed">119 </span>
<span class="line-removed">120     /**</span>
<span class="line-removed">121      * Argument for command line option &quot;-helpfile&quot;.</span>
<span class="line-removed">122      */</span>
<span class="line-removed">123     public String helpfile = &quot;&quot;;</span>
<span class="line-removed">124 </span>
<span class="line-removed">125     /**</span>
<span class="line-removed">126      * Argument for command line option &quot;-stylesheetfile&quot;.</span>
<span class="line-removed">127      */</span>
<span class="line-removed">128     public String stylesheetfile = &quot;&quot;;</span>
<span class="line-removed">129 </span>
<span class="line-removed">130     /**</span>
<span class="line-removed">131      * Argument for command line option &quot;--add-stylesheet&quot;.</span>
<span class="line-removed">132      */</span>
<span class="line-removed">133     public List&lt;String&gt; additionalStylesheets = new ArrayList&lt;&gt;();</span>
<span class="line-removed">134 </span>
<span class="line-removed">135     /**</span>
<span class="line-removed">136      * Argument for command line option &quot;-Xdocrootparent&quot;.</span>
<span class="line-removed">137      */</span>
<span class="line-removed">138     public String docrootparent = &quot;&quot;;</span>
<span class="line-removed">139 </span>
<span class="line-removed">140     /**</span>
<span class="line-removed">141      * True if command line option &quot;-nohelp&quot; is used. Default value is false.</span>
<span class="line-removed">142      */</span>
<span class="line-removed">143     public boolean nohelp = false;</span>
<span class="line-removed">144 </span>
<span class="line-removed">145     /**</span>
<span class="line-removed">146      * True if command line option &quot;-splitindex&quot; is used. Default value is</span>
<span class="line-removed">147      * false.</span>
<span class="line-removed">148      */</span>
<span class="line-removed">149     public boolean splitindex = false;</span>
<span class="line-removed">150 </span>
<span class="line-removed">151     /**</span>
<span class="line-removed">152      * False if command line option &quot;-noindex&quot; is used. Default value is true.</span>
<span class="line-removed">153      */</span>
<span class="line-removed">154     public boolean createindex = true;</span>
<span class="line-removed">155 </span>
<span class="line-removed">156     /**</span>
<span class="line-removed">157      * True if command line option &quot;-use&quot; is used. Default value is false.</span>
<span class="line-removed">158      */</span>
<span class="line-removed">159     public boolean classuse = false;</span>
<span class="line-removed">160 </span>
<span class="line-removed">161     /**</span>
<span class="line-removed">162      * False if command line option &quot;-notree&quot; is used. Default value is true.</span>
<span class="line-removed">163      */</span>
<span class="line-removed">164     public boolean createtree = true;</span>
<span class="line-removed">165 </span>
<span class="line-removed">166     /**</span>
<span class="line-removed">167      * The META charset tag used for cross-platform viewing.</span>
<span class="line-removed">168      */</span>
<span class="line-removed">169     public String charset = null;</span>
<span class="line-removed">170 </span>
<span class="line-removed">171     /**</span>
<span class="line-removed">172      * True if command line option &quot;-nodeprecated&quot; is used. Default value is</span>
<span class="line-removed">173      * false.</span>
<span class="line-removed">174      */</span>
<span class="line-removed">175     public boolean nodeprecatedlist = false;</span>
<span class="line-removed">176 </span>
<span class="line-removed">177     /**</span>
<span class="line-removed">178      * True if command line option &quot;-nonavbar&quot; is used. Default value is false.</span>
<span class="line-removed">179      */</span>
<span class="line-removed">180     public boolean nonavbar = false;</span>
<span class="line-removed">181 </span>
<span class="line-removed">182     /**</span>
<span class="line-removed">183      * True if command line option &quot;-nooverview&quot; is used. Default value is</span>
<span class="line-removed">184      * false</span>
<span class="line-removed">185      */</span>
<span class="line-removed">186     private boolean nooverview = false;</span>
<span class="line-removed">187 </span>
<span class="line-removed">188     /**</span>
<span class="line-removed">189      * The overview path specified with &quot;-overview&quot; flag.</span>
<span class="line-removed">190      */</span>
<span class="line-removed">191     public String overviewpath = null;</span>
<span class="line-removed">192 </span>
<span class="line-removed">193     /**</span>
<span class="line-removed">194      * This is true if option &quot;-overview&quot; is used or option &quot;-overview&quot; is not</span>
<span class="line-removed">195      * used and number of packages is more than one.</span>
<span class="line-removed">196      */</span>
<span class="line-removed">197     public boolean createoverview = false;</span>
<span class="line-removed">198 </span>
<span class="line-removed">199     /**</span>
<span class="line-removed">200      * Specifies whether or not frames should be generated.</span>
<span class="line-removed">201      * Defaults to false; can be set to true by --frames; can be set to false by --no-frames; last one wins.</span>
<span class="line-removed">202      */</span>
<span class="line-removed">203     public boolean frames = false;</span>
<span class="line-removed">204 </span>
<span class="line-removed">205     /**</span>
<span class="line-removed">206      * Collected set of doclint options</span>
<span class="line-removed">207      */</span>
<span class="line-removed">208     public Map&lt;Doclet.Option, String&gt; doclintOpts = new LinkedHashMap&lt;&gt;();</span>
<span class="line-removed">209 </span>
<span class="line-removed">210     public final Resources resources;</span>
211 
212     /**
213      * First file to appear in the right-hand frame in the generated
214      * documentation.
215      */
216     public DocPath topFile = DocPath.empty;
217 
218     /**
219      * The TypeElement for the class file getting generated.
220      */
221     public TypeElement currentTypeElement = null;  // Set this TypeElement in the ClassWriter.
222 
223     protected SortedSet&lt;SearchIndexItem&gt; memberSearchIndex;
224 
225     protected SortedSet&lt;SearchIndexItem&gt; moduleSearchIndex;
226 
227     protected SortedSet&lt;SearchIndexItem&gt; packageSearchIndex;
228 
229     protected SortedSet&lt;SearchIndexItem&gt; tagSearchIndex;
230 
231     protected SortedSet&lt;SearchIndexItem&gt; typeSearchIndex;
232 
<a name="9" id="anc9"></a><span class="line-modified">233     protected Map&lt;Character,List&lt;SearchIndexItem&gt;&gt; tagSearchIndexMap = new HashMap&lt;&gt;();</span>
234 
235     protected Set&lt;Character&gt; tagSearchIndexKeys;
236 
237     public final Contents contents;
238 
239     protected final Messages messages;
240 
241     public DocPaths docPaths;
242 
243     public Map&lt;Element, List&lt;DocPath&gt;&gt; localStylesheetMap = new HashMap&lt;&gt;();
244 
<a name="10" id="anc10"></a>

245     /**
<a name="11" id="anc11"></a><span class="line-modified">246      * Creates an object to hold the configuration for a doclet.</span>


247      *
<a name="12" id="anc12"></a><span class="line-modified">248      * @param doclet the doclet</span>









249      */
<a name="13" id="anc13"></a><span class="line-modified">250     public HtmlConfiguration(Doclet doclet) {</span>
<span class="line-modified">251         super(doclet);</span>
<span class="line-modified">252         resources = new Resources(this,</span>


253                 BaseConfiguration.sharedResourceBundleName,
254                 &quot;jdk.javadoc.internal.doclets.formats.html.resources.standard&quot;);
255 
<a name="14" id="anc14"></a><span class="line-modified">256         messages = new Messages(this);</span>











257         contents = new Contents(this);
<a name="15" id="anc15"></a>
258 
259         String v;
260         try {
<a name="16" id="anc16"></a><span class="line-modified">261             ResourceBundle rb = ResourceBundle.getBundle(versionBundleName, getLocale());</span>

262             try {
263                 v = rb.getString(&quot;release&quot;);
264             } catch (MissingResourceException e) {
265                 v = defaultDocletVersion;
266             }
267         } catch (MissingResourceException e) {
268             v = defaultDocletVersion;
269         }
270         docletVersion = v;
271     }
272 
273     private static final String versionBundleName = &quot;jdk.javadoc.internal.tool.resources.version&quot;;
274     private static final String defaultDocletVersion = System.getProperty(&quot;java.version&quot;);
275     public final String docletVersion;
<a name="17" id="anc17"></a>
276 
277     @Override
278     public String getDocletVersion() {
279         return docletVersion;
280     }
281 
282     @Override
<a name="18" id="anc18"></a><span class="line-modified">283     public Resources getResources() {</span>
<span class="line-modified">284         return resources;</span>
285     }
286 
<a name="19" id="anc19"></a>




287     public Contents getContents() {
288         return contents;
289     }
290 
291     @Override
292     public Messages getMessages() {
293         return messages;
294     }
295 
<a name="20" id="anc20"></a><span class="line-modified">296     protected boolean validateOptions() {</span>
<span class="line-modified">297         // check shared options</span>
<span class="line-modified">298         if (!generalValidOptions()) {</span>
<span class="line-removed">299             return false;</span>
<span class="line-removed">300         }</span>
<span class="line-removed">301 </span>
<span class="line-removed">302         // check if helpfile exists</span>
<span class="line-removed">303         if (!helpfile.isEmpty()) {</span>
<span class="line-removed">304             DocFile help = DocFile.createFileForInput(this, helpfile);</span>
<span class="line-removed">305             if (!help.exists()) {</span>
<span class="line-removed">306                 reporter.print(ERROR, resources.getText(&quot;doclet.File_not_found&quot;, helpfile));</span>
<span class="line-removed">307                 return false;</span>
<span class="line-removed">308             }</span>
<span class="line-removed">309         }</span>
<span class="line-removed">310         // check if stylesheetfile exists</span>
<span class="line-removed">311         if (!stylesheetfile.isEmpty()) {</span>
<span class="line-removed">312             DocFile stylesheet = DocFile.createFileForInput(this, stylesheetfile);</span>
<span class="line-removed">313             if (!stylesheet.exists()) {</span>
<span class="line-removed">314                 reporter.print(ERROR, resources.getText(&quot;doclet.File_not_found&quot;, stylesheetfile));</span>
<span class="line-removed">315                 return false;</span>
<span class="line-removed">316             }</span>
<span class="line-removed">317         }</span>
<span class="line-removed">318         // check if additional stylesheets exists</span>
<span class="line-removed">319         for (String ssheet : additionalStylesheets) {</span>
<span class="line-removed">320             DocFile ssfile = DocFile.createFileForInput(this, ssheet);</span>
<span class="line-removed">321             if (!ssfile.exists()) {</span>
<span class="line-removed">322                 reporter.print(ERROR, resources.getText(&quot;doclet.File_not_found&quot;, ssheet));</span>
<span class="line-removed">323                 return false;</span>
<span class="line-removed">324             }</span>
<span class="line-removed">325         }</span>
<span class="line-removed">326 </span>
<span class="line-removed">327         // In a more object-oriented world, this would be done by methods on the Option objects.</span>
<span class="line-removed">328         // Note that -windowtitle silently removes any and all HTML elements, and so does not need</span>
<span class="line-removed">329         // to be handled here.</span>
<span class="line-removed">330         utils.checkJavaScriptInOption(&quot;-header&quot;, header);</span>
<span class="line-removed">331         utils.checkJavaScriptInOption(&quot;-footer&quot;, footer);</span>
<span class="line-removed">332         utils.checkJavaScriptInOption(&quot;-top&quot;, top);</span>
<span class="line-removed">333         utils.checkJavaScriptInOption(&quot;-bottom&quot;, bottom);</span>
<span class="line-removed">334         utils.checkJavaScriptInOption(&quot;-doctitle&quot;, doctitle);</span>
<span class="line-removed">335         utils.checkJavaScriptInOption(&quot;-packagesheader&quot;, packagesheader);</span>
<span class="line-removed">336 </span>
<span class="line-removed">337         return true;</span>
338     }
339 
<a name="21" id="anc21"></a><span class="line-removed">340 </span>
341     @Override
342     public boolean finishOptionSettings() {
<a name="22" id="anc22"></a><span class="line-modified">343         if (!validateOptions()) {</span>
344             return false;
345         }
346         if (!getSpecifiedTypeElements().isEmpty()) {
347             Map&lt;String, PackageElement&gt; map = new HashMap&lt;&gt;();
348             PackageElement pkg;
349             for (TypeElement aClass : getIncludedTypeElements()) {
350                 pkg = utils.containingPackage(aClass);
351                 if (!map.containsKey(utils.getPackageName(pkg))) {
352                     map.put(utils.getPackageName(pkg), pkg);
353                 }
354             }
355         }
<a name="23" id="anc23"></a><span class="line-modified">356         docPaths = new DocPaths(utils, useModuleDirectories);</span>
357         setCreateOverview();
358         setTopFile(docEnv);
<a name="24" id="anc24"></a><span class="line-modified">359         workArounds.initDocLint(doclintOpts.values(), tagletManager.getAllTagletNames());</span>
360         return true;
361     }
362 
363     /**
364      * Decide the page which will appear first in the right-hand frame. It will
365      * be &quot;overview-summary.html&quot; if &quot;-overview&quot; option is used or no
366      * &quot;-overview&quot; but the number of packages is more than one. It will be
367      * &quot;package-summary.html&quot; of the respective package if there is only one
368      * package to document. It will be a class page(first in the sorted order),
369      * if only classes are provided on the command line.
370      *
371      * @param docEnv the doclet environment
372      */
373     protected void setTopFile(DocletEnvironment docEnv) {
374         if (!checkForDeprecation(docEnv)) {
375             return;
376         }
<a name="25" id="anc25"></a><span class="line-modified">377         if (createoverview) {</span>
<span class="line-modified">378             topFile = DocPaths.overviewSummary(frames);</span>
379         } else {
380             if (showModules) {
381                 topFile = DocPath.empty.resolve(docPaths.moduleSummary(modules.first()));
382             } else if (packages.size() == 1 &amp;&amp; packages.first().isUnnamed()) {
383                 List&lt;TypeElement&gt; classes = new ArrayList&lt;&gt;(getIncludedTypeElements());
384                 if (!classes.isEmpty()) {
385                     TypeElement te = getValidClass(classes);
386                     topFile = docPaths.forClass(te);
387                 }
388             } else if (!packages.isEmpty()) {
389                 topFile = docPaths.forPackage(packages.first()).resolve(DocPaths.PACKAGE_SUMMARY);
390             }
391         }
392     }
393 
394     protected TypeElement getValidClass(List&lt;TypeElement&gt; classes) {
<a name="26" id="anc26"></a><span class="line-modified">395         if (!nodeprecated) {</span>
396             return classes.get(0);
397         }
398         for (TypeElement te : classes) {
399             if (!utils.isDeprecated(te)) {
400                 return te;
401             }
402         }
403         return null;
404     }
405 
406     protected boolean checkForDeprecation(DocletEnvironment docEnv) {
407         for (TypeElement te : getIncludedTypeElements()) {
408             if (isGeneratedDoc(te)) {
409                 return true;
410             }
411         }
412         return false;
413     }
414 
415     /**
416      * Generate &quot;overview.html&quot; page if option &quot;-overview&quot; is used or number of
<a name="27" id="anc27"></a><span class="line-modified">417      * packages is more than one. Sets {@link #createoverview} field to true.</span>
418      */
419     protected void setCreateOverview() {
<a name="28" id="anc28"></a><span class="line-modified">420         if (!nooverview) {</span>
<span class="line-modified">421             if (overviewpath != null</span>
422                     || modules.size() &gt; 1
423                     || (modules.isEmpty() &amp;&amp; packages.size() &gt; 1)) {
<a name="29" id="anc29"></a><span class="line-modified">424                 createoverview = true;</span>
425             }
426         }
427     }
428 
<a name="30" id="anc30"></a><span class="line-removed">429     /**</span>
<span class="line-removed">430      * {@inheritDoc}</span>
<span class="line-removed">431      */</span>
432     @Override
433     public WriterFactory getWriterFactory() {
434         return new WriterFactoryImpl(this);
435     }
436 
<a name="31" id="anc31"></a><span class="line-removed">437     /**</span>
<span class="line-removed">438      * {@inheritDoc}</span>
<span class="line-removed">439      */</span>
440     @Override
441     public Locale getLocale() {
442         if (locale == null)
443             return Locale.getDefault();
444         return locale;
445     }
446 
447     /**
448      * Return the path of the overview file or null if it does not exist.
449      *
450      * @return the path of the overview file or null if it does not exist.
451      */
452     @Override
453     public JavaFileObject getOverviewPath() {
<a name="32" id="anc32"></a>
454         if (overviewpath != null &amp;&amp; getFileManager() instanceof StandardJavaFileManager) {
455             StandardJavaFileManager fm = (StandardJavaFileManager) getFileManager();
456             return fm.getJavaFileObjects(overviewpath).iterator().next();
457         }
458         return null;
459     }
460 
<a name="33" id="anc33"></a><span class="line-modified">461     public DocFile getMainStylesheet() {</span>
<span class="line-modified">462         return stylesheetfile.isEmpty() ? null : DocFile.createFileForInput(this, stylesheetfile);</span>





463     }
464 
<a name="34" id="anc34"></a><span class="line-modified">465     public List&lt;DocFile&gt; getAdditionalStylesheets() {</span>
<span class="line-modified">466         return additionalStylesheets.stream()</span>
467                 .map(ssf -&gt; DocFile.createFileForInput(this, ssf))
<a name="35" id="anc35"></a>
468                 .collect(Collectors.toList());
469     }
470 
<a name="36" id="anc36"></a><span class="line-removed">471     /**</span>
<span class="line-removed">472      * {@inheritDoc}</span>
<span class="line-removed">473      */</span>
474     @Override
475     public JavaFileManager getFileManager() {
476         return docEnv.getJavaFileManager();
477     }
478 
479     @Override
480     public boolean showMessage(DocTreePath path, String key) {
481         return (path == null || workArounds.haveDocLint());
482     }
483 
484     @Override
485     public boolean showMessage(Element e, String key) {
486         return (e == null || workArounds.haveDocLint());
487     }
488 
489     protected void buildSearchTagIndex() {
490         for (SearchIndexItem sii : tagSearchIndex) {
491             String tagLabel = sii.getLabel();
492             Character unicode = (tagLabel.length() == 0)
493                     ? &#39;*&#39;
494                     : Character.toUpperCase(tagLabel.charAt(0));
<a name="37" id="anc37"></a><span class="line-modified">495             List&lt;SearchIndexItem&gt; list = tagSearchIndexMap.get(unicode);</span>
<span class="line-removed">496             if (list == null) {</span>
<span class="line-removed">497                 list = new ArrayList&lt;&gt;();</span>
<span class="line-removed">498                 tagSearchIndexMap.put(unicode, list);</span>
<span class="line-removed">499             }</span>
<span class="line-removed">500             list.add(sii);</span>
501         }
502         tagSearchIndexKeys = tagSearchIndexMap.keySet();
503     }
504 
<a name="38" id="anc38"></a><span class="line-removed">505     @Override</span>
<span class="line-removed">506     public Set&lt;Doclet.Option&gt; getSupportedOptions() {</span>
<span class="line-removed">507         Resources resources = getResources();</span>
<span class="line-removed">508         Doclet.Option[] options = {</span>
<span class="line-removed">509             new Option(resources, &quot;--add-stylesheet&quot;, 1) {</span>
<span class="line-removed">510                 @Override</span>
<span class="line-removed">511                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">512                     additionalStylesheets.add(args.get(0));</span>
<span class="line-removed">513                     return true;</span>
<span class="line-removed">514                 }</span>
<span class="line-removed">515             },</span>
<span class="line-removed">516             new Option(resources, &quot;-bottom&quot;, 1) {</span>
<span class="line-removed">517                 @Override</span>
<span class="line-removed">518                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">519                     bottom = args.get(0);</span>
<span class="line-removed">520                     return true;</span>
<span class="line-removed">521                 }</span>
<span class="line-removed">522             },</span>
<span class="line-removed">523             new Option(resources, &quot;-charset&quot;, 1) {</span>
<span class="line-removed">524                 @Override</span>
<span class="line-removed">525                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">526                     charset = args.get(0);</span>
<span class="line-removed">527                     return true;</span>
<span class="line-removed">528                 }</span>
<span class="line-removed">529             },</span>
<span class="line-removed">530             new Option(resources, &quot;-doctitle&quot;, 1) {</span>
<span class="line-removed">531                 @Override</span>
<span class="line-removed">532                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">533                     doctitle = args.get(0);</span>
<span class="line-removed">534                     return true;</span>
<span class="line-removed">535                 }</span>
<span class="line-removed">536             },</span>
<span class="line-removed">537             new Option(resources, &quot;-footer&quot;, 1) {</span>
<span class="line-removed">538                 @Override</span>
<span class="line-removed">539                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">540                     footer = args.get(0);</span>
<span class="line-removed">541                     return true;</span>
<span class="line-removed">542                 }</span>
<span class="line-removed">543             },</span>
<span class="line-removed">544             new Option(resources, &quot;-header&quot;, 1) {</span>
<span class="line-removed">545                 @Override</span>
<span class="line-removed">546                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">547                     header = args.get(0);</span>
<span class="line-removed">548                     return true;</span>
<span class="line-removed">549                 }</span>
<span class="line-removed">550             },</span>
<span class="line-removed">551             new Option(resources, &quot;-helpfile&quot;, 1) {</span>
<span class="line-removed">552                 @Override</span>
<span class="line-removed">553                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">554                     if (nohelp == true) {</span>
<span class="line-removed">555                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">556                                 &quot;-helpfile&quot;, &quot;-nohelp&quot;));</span>
<span class="line-removed">557                         return false;</span>
<span class="line-removed">558                     }</span>
<span class="line-removed">559                     if (!helpfile.isEmpty()) {</span>
<span class="line-removed">560                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_reuse&quot;,</span>
<span class="line-removed">561                                 &quot;-helpfile&quot;));</span>
<span class="line-removed">562                         return false;</span>
<span class="line-removed">563                     }</span>
<span class="line-removed">564                     helpfile = args.get(0);</span>
<span class="line-removed">565                     return true;</span>
<span class="line-removed">566                 }</span>
<span class="line-removed">567             },</span>
<span class="line-removed">568             new Option(resources, &quot;-html5&quot;) {</span>
<span class="line-removed">569                 @Override</span>
<span class="line-removed">570                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">571                     return true;</span>
<span class="line-removed">572                 }</span>
<span class="line-removed">573             },</span>
<span class="line-removed">574             new Option(resources, &quot;-nohelp&quot;) {</span>
<span class="line-removed">575                 @Override</span>
<span class="line-removed">576                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">577                     nohelp = true;</span>
<span class="line-removed">578                     if (!helpfile.isEmpty()) {</span>
<span class="line-removed">579                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">580                                 &quot;-nohelp&quot;, &quot;-helpfile&quot;));</span>
<span class="line-removed">581                         return false;</span>
<span class="line-removed">582                     }</span>
<span class="line-removed">583                     return true;</span>
<span class="line-removed">584                 }</span>
<span class="line-removed">585             },</span>
<span class="line-removed">586             new Option(resources, &quot;-nodeprecatedlist&quot;) {</span>
<span class="line-removed">587                 @Override</span>
<span class="line-removed">588                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">589                     nodeprecatedlist = true;</span>
<span class="line-removed">590                     return true;</span>
<span class="line-removed">591                 }</span>
<span class="line-removed">592             },</span>
<span class="line-removed">593             new Option(resources, &quot;-noindex&quot;) {</span>
<span class="line-removed">594                 @Override</span>
<span class="line-removed">595                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">596                     createindex = false;</span>
<span class="line-removed">597                     if (splitindex == true) {</span>
<span class="line-removed">598                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">599                                 &quot;-noindex&quot;, &quot;-splitindex&quot;));</span>
<span class="line-removed">600                         return false;</span>
<span class="line-removed">601                     }</span>
<span class="line-removed">602                     return true;</span>
<span class="line-removed">603                 }</span>
<span class="line-removed">604             },</span>
<span class="line-removed">605             new Option(resources, &quot;-nonavbar&quot;) {</span>
<span class="line-removed">606                 @Override</span>
<span class="line-removed">607                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">608                     nonavbar = true;</span>
<span class="line-removed">609                     return true;</span>
<span class="line-removed">610                 }</span>
<span class="line-removed">611             },</span>
<span class="line-removed">612             new Hidden(resources, &quot;-nooverview&quot;) {</span>
<span class="line-removed">613                 @Override</span>
<span class="line-removed">614                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">615                     nooverview = true;</span>
<span class="line-removed">616                     if (overviewpath != null) {</span>
<span class="line-removed">617                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">618                                 &quot;-nooverview&quot;, &quot;-overview&quot;));</span>
<span class="line-removed">619                         return false;</span>
<span class="line-removed">620                     }</span>
<span class="line-removed">621                     return true;</span>
<span class="line-removed">622                 }</span>
<span class="line-removed">623             },</span>
<span class="line-removed">624             new Option(resources, &quot;-notree&quot;) {</span>
<span class="line-removed">625                 @Override</span>
<span class="line-removed">626                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">627                     createtree = false;</span>
<span class="line-removed">628                     return true;</span>
<span class="line-removed">629                 }</span>
<span class="line-removed">630             },</span>
<span class="line-removed">631             new Option(resources, &quot;-overview&quot;, 1) {</span>
<span class="line-removed">632                 @Override</span>
<span class="line-removed">633                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">634                     overviewpath = args.get(0);</span>
<span class="line-removed">635                     if (nooverview == true) {</span>
<span class="line-removed">636                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">637                                 &quot;-overview&quot;, &quot;-nooverview&quot;));</span>
<span class="line-removed">638                         return false;</span>
<span class="line-removed">639                     }</span>
<span class="line-removed">640                     return true;</span>
<span class="line-removed">641                 }</span>
<span class="line-removed">642             },</span>
<span class="line-removed">643             new Option(resources, &quot;--frames&quot;) {</span>
<span class="line-removed">644                 @Override</span>
<span class="line-removed">645                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">646                     reporter.print(WARNING, resources.getText(&quot;doclet.Frames_specified&quot;, helpfile));</span>
<span class="line-removed">647                     frames = true;</span>
<span class="line-removed">648                     return true;</span>
<span class="line-removed">649                 }</span>
<span class="line-removed">650             },</span>
<span class="line-removed">651             new Option(resources, &quot;--no-frames&quot;) {</span>
<span class="line-removed">652                 @Override</span>
<span class="line-removed">653                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">654                     frames = false;</span>
<span class="line-removed">655                     return true;</span>
<span class="line-removed">656                 }</span>
<span class="line-removed">657             },</span>
<span class="line-removed">658             new Hidden(resources, &quot;-packagesheader&quot;, 1) {</span>
<span class="line-removed">659                 @Override</span>
<span class="line-removed">660                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">661                     packagesheader = args.get(0);</span>
<span class="line-removed">662                     return true;</span>
<span class="line-removed">663                 }</span>
<span class="line-removed">664             },</span>
<span class="line-removed">665             new Option(resources, &quot;-splitindex&quot;) {</span>
<span class="line-removed">666                 @Override</span>
<span class="line-removed">667                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">668                     splitindex = true;</span>
<span class="line-removed">669                     if (createindex == false) {</span>
<span class="line-removed">670                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">671                                 &quot;-splitindex&quot;, &quot;-noindex&quot;));</span>
<span class="line-removed">672                         return false;</span>
<span class="line-removed">673                     }</span>
<span class="line-removed">674                     return true;</span>
<span class="line-removed">675                 }</span>
<span class="line-removed">676             },</span>
<span class="line-removed">677             new Option(resources, &quot;--main-stylesheet -stylesheetfile&quot;, 1) {</span>
<span class="line-removed">678                 @Override</span>
<span class="line-removed">679                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">680                     stylesheetfile = args.get(0);</span>
<span class="line-removed">681                     return true;</span>
<span class="line-removed">682                 }</span>
<span class="line-removed">683             },</span>
<span class="line-removed">684             new Option(resources, &quot;-top&quot;, 1) {</span>
<span class="line-removed">685                 @Override</span>
<span class="line-removed">686                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">687                     top = args.get(0);</span>
<span class="line-removed">688                     return true;</span>
<span class="line-removed">689                 }</span>
<span class="line-removed">690             },</span>
<span class="line-removed">691             new Option(resources, &quot;-use&quot;) {</span>
<span class="line-removed">692                 @Override</span>
<span class="line-removed">693                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">694                     classuse = true;</span>
<span class="line-removed">695                     return true;</span>
<span class="line-removed">696                 }</span>
<span class="line-removed">697             },</span>
<span class="line-removed">698             new Option(resources, &quot;-windowtitle&quot;, 1) {</span>
<span class="line-removed">699                 @Override</span>
<span class="line-removed">700                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">701                     windowtitle = args.get(0).replaceAll(&quot;\\&lt;.*?&gt;&quot;, &quot;&quot;);</span>
<span class="line-removed">702                     return true;</span>
<span class="line-removed">703                 }</span>
<span class="line-removed">704             },</span>
<span class="line-removed">705             new XOption(resources, &quot;-Xdoclint&quot;) {</span>
<span class="line-removed">706                 @Override</span>
<span class="line-removed">707                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">708                     doclintOpts.put(this, DocLint.XMSGS_OPTION);</span>
<span class="line-removed">709                     return true;</span>
<span class="line-removed">710                 }</span>
<span class="line-removed">711             },</span>
<span class="line-removed">712             new XOption(resources, &quot;-Xdocrootparent&quot;, 1) {</span>
<span class="line-removed">713                 @Override</span>
<span class="line-removed">714                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">715                     docrootparent = args.get(0);</span>
<span class="line-removed">716                     try {</span>
<span class="line-removed">717                         URL ignored = new URL(docrootparent);</span>
<span class="line-removed">718                     } catch (MalformedURLException e) {</span>
<span class="line-removed">719                         reporter.print(ERROR, resources.getText(&quot;doclet.MalformedURL&quot;, docrootparent));</span>
<span class="line-removed">720                         return false;</span>
<span class="line-removed">721                     }</span>
<span class="line-removed">722                     return true;</span>
<span class="line-removed">723                 }</span>
<span class="line-removed">724             },</span>
<span class="line-removed">725             new XOption(resources, &quot;doclet.usage.xdoclint-extended&quot;, &quot;-Xdoclint:&quot;, 0) {</span>
<span class="line-removed">726                 @Override</span>
<span class="line-removed">727                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">728                     String dopt = opt.replace(&quot;-Xdoclint:&quot;, DocLint.XMSGS_CUSTOM_PREFIX);</span>
<span class="line-removed">729                     doclintOpts.put(this, dopt);</span>
<span class="line-removed">730                     if (dopt.contains(&quot;/&quot;)) {</span>
<span class="line-removed">731                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_doclint_no_qualifiers&quot;));</span>
<span class="line-removed">732                         return false;</span>
<span class="line-removed">733                     }</span>
<span class="line-removed">734                     if (!DocLint.isValidOption(dopt)) {</span>
<span class="line-removed">735                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_doclint_invalid_arg&quot;));</span>
<span class="line-removed">736                         return false;</span>
<span class="line-removed">737                     }</span>
<span class="line-removed">738                     return true;</span>
<span class="line-removed">739                 }</span>
<span class="line-removed">740             },</span>
<span class="line-removed">741             new XOption(resources, &quot;doclet.usage.xdoclint-package&quot;, &quot;-Xdoclint/package:&quot;, 0) {</span>
<span class="line-removed">742                 @Override</span>
<span class="line-removed">743                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">744                     String dopt = opt.replace(&quot;-Xdoclint/package:&quot;, DocLint.XCHECK_PACKAGE);</span>
<span class="line-removed">745                     doclintOpts.put(this, dopt);</span>
<span class="line-removed">746                     if (!DocLint.isValidOption(dopt)) {</span>
<span class="line-removed">747                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_doclint_package_invalid_arg&quot;));</span>
<span class="line-removed">748                         return false;</span>
<span class="line-removed">749                     }</span>
<span class="line-removed">750                     return true;</span>
<span class="line-removed">751                 }</span>
<span class="line-removed">752             }</span>
<span class="line-removed">753         };</span>
<span class="line-removed">754         Set&lt;Doclet.Option&gt; oset = new TreeSet&lt;&gt;();</span>
<span class="line-removed">755         oset.addAll(Arrays.asList(options));</span>
<span class="line-removed">756         oset.addAll(super.getSupportedOptions());</span>
<span class="line-removed">757         return oset;</span>
<span class="line-removed">758     }</span>
<span class="line-removed">759 </span>
760     @Override
761     protected boolean finishOptionSettings0() throws DocletException {
<a name="39" id="anc39"></a><span class="line-modified">762         if (docencoding == null) {</span>
<span class="line-modified">763             if (charset == null) {</span>
<span class="line-modified">764                 docencoding = charset = (encoding == null) ? HTML_DEFAULT_CHARSET : encoding;</span>


765             } else {
<a name="40" id="anc40"></a><span class="line-modified">766                 docencoding = charset;</span>
767             }
768         } else {
<a name="41" id="anc41"></a><span class="line-modified">769             if (charset == null) {</span>
<span class="line-modified">770                 charset = docencoding;</span>
<span class="line-modified">771             } else if (!charset.equals(docencoding)) {</span>
<span class="line-modified">772                 reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;, &quot;-charset&quot;, &quot;-docencoding&quot;));</span>
773                 return false;
774             }
775         }
776         return super.finishOptionSettings0();
777     }
778 
779     @Override
780     protected void initConfiguration(DocletEnvironment docEnv) {
781         super.initConfiguration(docEnv);
782         memberSearchIndex = new TreeSet&lt;&gt;(utils.makeGenericSearchIndexComparator());
783         moduleSearchIndex = new TreeSet&lt;&gt;(utils.makeGenericSearchIndexComparator());
784         packageSearchIndex = new TreeSet&lt;&gt;(utils.makeGenericSearchIndexComparator());
785         tagSearchIndex = new TreeSet&lt;&gt;(utils.makeGenericSearchIndexComparator());
786         typeSearchIndex = new TreeSet&lt;&gt;(utils.makeTypeSearchIndexComparator());
787     }
788 }
<a name="42" id="anc42"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="42" type="hidden" />
</body>
</html>