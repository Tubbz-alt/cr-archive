<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/SourceToHTMLConverter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SingleIndexWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SplitIndexWriter.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/SourceToHTMLConverter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2001, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2001, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -29,10 +29,11 @@</span>
  
  import java.io.*;
  import java.util.List;
  
  import javax.lang.model.element.Element;
<span class="udiff-line-added">+ import javax.lang.model.element.ModuleElement;</span>
  import javax.lang.model.element.PackageElement;
  import javax.lang.model.element.TypeElement;
  import javax.tools.FileObject;
  
  import jdk.javadoc.doclet.DocletEnvironment;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -58,13 +59,10 @@</span>
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
<span class="udiff-line-removed">-  *</span>
<span class="udiff-line-removed">-  * @author Jamie Ho</span>
<span class="udiff-line-removed">-  * @author Bhavesh Patel (Modified)</span>
   */
  public class SourceToHTMLConverter {
  
      /**
       * The number of trailing blank lines at the end of the page.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -77,10 +75,11 @@</span>
       * New line to be added to the documentation.
       */
      private static final String NEW_LINE = DocletConstants.NL;
  
      private final HtmlConfiguration configuration;
<span class="udiff-line-added">+     private final HtmlOptions options;</span>
      private final Messages messages;
      private final Resources resources;
      private final Utils utils;
  
      private final DocletEnvironment docEnv;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -94,12 +93,13 @@</span>
      private DocPath relativePath = DocPath.empty;
  
      private SourceToHTMLConverter(HtmlConfiguration configuration, DocletEnvironment rd,
                                    DocPath outputdir) {
          this.configuration  = configuration;
<span class="udiff-line-added">+         this.options = configuration.getOptions();</span>
          this.messages = configuration.getMessages();
<span class="udiff-line-modified-removed">-         this.resources = configuration.resources;</span>
<span class="udiff-line-modified-added">+         this.resources = configuration.docResources;</span>
          this.utils = configuration.utils;
          this.docEnv = rd;
          this.outputdir = outputdir;
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -119,21 +119,27 @@</span>
  
      void generate() throws DocFileIOException, SimpleDocletException {
          if (docEnv == null || outputdir == null) {
              return;
          }
<span class="udiff-line-added">+         for (ModuleElement mdl : configuration.getSpecifiedModuleElements()) {</span>
<span class="udiff-line-added">+             // If -nodeprecated option is set and the module is marked as deprecated,</span>
<span class="udiff-line-added">+             // do not convert the module files to HTML.</span>
<span class="udiff-line-added">+             if (!(options.noDeprecated() &amp;&amp; utils.isDeprecated(mdl)))</span>
<span class="udiff-line-added">+                 convertModule(mdl, outputdir);</span>
<span class="udiff-line-added">+         }</span>
          for (PackageElement pkg : configuration.getSpecifiedPackageElements()) {
              // If -nodeprecated option is set and the package is marked as deprecated,
              // do not convert the package files to HTML.
<span class="udiff-line-modified-removed">-             if (!(configuration.nodeprecated &amp;&amp; utils.isDeprecated(pkg)))</span>
<span class="udiff-line-modified-added">+             if (!(options.noDeprecated() &amp;&amp; utils.isDeprecated(pkg)))</span>
                  convertPackage(pkg, outputdir);
          }
          for (TypeElement te : configuration.getSpecifiedTypeElements()) {
              // If -nodeprecated option is set and the class is marked as deprecated
              // or the containing package is deprecated, do not convert the
              // package files to HTML.
<span class="udiff-line-modified-removed">-             if (!(configuration.nodeprecated &amp;&amp;</span>
<span class="udiff-line-modified-added">+             if (!(options.noDeprecated() &amp;&amp;</span>
                    (utils.isDeprecated(te) || utils.isDeprecated(utils.containingPackage(te)))))
                  convertClass(te, outputdir);
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -153,15 +159,36 @@</span>
          for (Element te : utils.getAllClasses(pkg)) {
              // If -nodeprecated option is set and the class is marked as deprecated,
              // do not convert the package files to HTML. We do not check for
              // containing package deprecation since it is already check in
              // the calling method above.
<span class="udiff-line-modified-removed">-             if (!(configuration.nodeprecated &amp;&amp; utils.isDeprecated(te)))</span>
<span class="udiff-line-modified-added">+             if (!(options.noDeprecated() &amp;&amp; utils.isDeprecated(te)))</span>
                  convertClass((TypeElement)te, outputdir);
          }
      }
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Convert the documented packages contained in the given module to an HTML representation.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @param mdl the module to convert.</span>
<span class="udiff-line-added">+      * @param outputdir the name of the directory to output to.</span>
<span class="udiff-line-added">+      * @throws DocFileIOException if there is a problem generating an output file</span>
<span class="udiff-line-added">+      * @throws SimpleDocletException if there is a problem reading a source file</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     public void convertModule(ModuleElement mdl, DocPath outputdir)</span>
<span class="udiff-line-added">+             throws DocFileIOException, SimpleDocletException {</span>
<span class="udiff-line-added">+         if (mdl == null) {</span>
<span class="udiff-line-added">+             return;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         for (Element elem : mdl.getEnclosedElements()) {</span>
<span class="udiff-line-added">+             if (elem instanceof PackageElement &amp;&amp; configuration.docEnv.isIncluded(elem)</span>
<span class="udiff-line-added">+                     &amp;&amp; !(options.noDeprecated() &amp;&amp; utils.isDeprecated(elem))) {</span>
<span class="udiff-line-added">+                 convertPackage((PackageElement) elem, outputdir);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      /**
       * Convert the given Class to an HTML.
       *
       * @param te the class to convert.
       * @param outputdir the name of the directory to output to
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -208,14 +235,14 @@</span>
       *
       * @param body the documentation content to be written to the file.
       * @param path the path for the file.
       */
      private void writeToFile(Content body, DocPath path, TypeElement te) throws DocFileIOException {
<span class="udiff-line-modified-removed">-         Head head = new Head(path, configuration.docletVersion)</span>
<span class="udiff-line-modified-removed">- //                .setTimestamp(!configuration.notimestamp) // temporary: compatibility!</span>
<span class="udiff-line-modified-added">+         Head head = new Head(path, configuration.docletVersion, configuration.startTime)</span>
<span class="udiff-line-modified-added">+ //                .setTimestamp(!options.notimestamp) // temporary: compatibility!</span>
                  .setTitle(resources.getText(&quot;doclet.Window_Source_title&quot;))
<span class="udiff-line-modified-removed">- //                .setCharset(configuration.charset) // temporary: compatibility!</span>
<span class="udiff-line-modified-added">+ //                .setCharset(options.charset) // temporary: compatibility!</span>
                  .setDescription(HtmlDocletWriter.getDescription(&quot;source&quot;, te))
                  .setGenerator(HtmlDocletWriter.getGenerator(getClass()))
                  .addDefaultScript(false)
                  .setStylesheets(configuration.getMainStylesheet(), configuration.getAdditionalStylesheets());
          Content htmlTree = HtmlTree.HTML(configuration.getLocale().getLanguage(),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -229,11 +256,11 @@</span>
       * Returns a link to the stylesheet file.
       *
       * @param head an HtmlTree to which the stylesheet links will be added
       */
      public void addStyleSheetProperties(Content head) {
<span class="udiff-line-modified-removed">-         String filename = configuration.stylesheetfile;</span>
<span class="udiff-line-modified-added">+         String filename = options.stylesheetFile();</span>
          DocPath stylesheet;
          if (filename.length() &gt; 0) {
              DocFile file = DocFile.createFileForInput(configuration, filename);
              stylesheet = DocPath.create(file.getName());
          } else {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -244,20 +271,17 @@</span>
          head.add(link);
          addStylesheets(head);
      }
  
      protected void addStylesheets(Content tree) {
<span class="udiff-line-modified-removed">-         List&lt;String&gt; stylesheets = configuration.additionalStylesheets;</span>
<span class="udiff-line-modified-removed">-         if (!stylesheets.isEmpty()) {</span>
<span class="udiff-line-modified-removed">-             stylesheets.forEach((ssheet) -&gt; {</span>
<span class="udiff-line-modified-removed">-                 DocFile file = DocFile.createFileForInput(configuration, ssheet);</span>
<span class="udiff-line-modified-removed">-                 DocPath ssheetPath = DocPath.create(file.getName());</span>
<span class="udiff-line-modified-removed">-                 HtmlTree slink = HtmlTree.LINK(&quot;stylesheet&quot;, &quot;text/css&quot;, relativePath.resolve(ssheetPath).getPath(),</span>
<span class="udiff-line-modified-removed">-                         &quot;Style&quot;);</span>
<span class="udiff-line-removed">-                 tree.add(slink);</span>
<span class="udiff-line-removed">-             });</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         options.additionalStylesheets().forEach(css -&gt; {</span>
<span class="udiff-line-modified-added">+             DocFile file = DocFile.createFileForInput(configuration, css);</span>
<span class="udiff-line-modified-added">+             DocPath cssPath = DocPath.create(file.getName());</span>
<span class="udiff-line-modified-added">+             HtmlTree slink = HtmlTree.LINK(&quot;stylesheet&quot;, &quot;text/css&quot;, relativePath.resolve(cssPath).getPath(),</span>
<span class="udiff-line-modified-added">+                                            &quot;Style&quot;);</span>
<span class="udiff-line-modified-added">+             tree.add(slink);</span>
<span class="udiff-line-modified-added">+         });</span>
      }
  
      /**
       * Get the header.
       *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -293,11 +317,11 @@</span>
       * @param line the string to format.
       * @param currentLineNo the current number.
       */
      private void addLine(Content pre, String line, int currentLineNo) {
          if (line != null) {
<span class="udiff-line-modified-removed">-             Content anchor = HtmlTree.A_ID(</span>
<span class="udiff-line-modified-added">+             Content anchor = HtmlTree.SPAN_ID(</span>
                      &quot;line.&quot; + Integer.toString(currentLineNo),
                      new StringContent(utils.replaceTabs(line)));
              pre.add(anchor);
              pre.add(NEW_LINE);
          }
</pre>
<center><a href="SingleIndexWriter.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SplitIndexWriter.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>