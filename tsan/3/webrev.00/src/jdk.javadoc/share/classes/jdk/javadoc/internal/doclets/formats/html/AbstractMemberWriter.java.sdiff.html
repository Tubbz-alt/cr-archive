<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractMemberWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractIndexWriter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractTreeWriter.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractMemberWriter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.formats.html;
 27 
<span class="line-modified"> 28 import jdk.javadoc.internal.doclets.formats.html.markup.Table;</span>
<span class="line-modified"> 29 import jdk.javadoc.internal.doclets.formats.html.markup.TableHeader;</span>
<span class="line-modified"> 30 </span>
<span class="line-modified"> 31 import java.util.*;</span>
 32 import java.util.stream.Collectors;
 33 
 34 import javax.lang.model.element.Element;
 35 import javax.lang.model.element.ExecutableElement;
 36 import javax.lang.model.element.Modifier;
 37 import javax.lang.model.element.TypeElement;
 38 import javax.lang.model.element.TypeParameterElement;
 39 import javax.lang.model.type.TypeMirror;
 40 
 41 import com.sun.source.doctree.DocTree;

 42 import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;

 43 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
 44 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
 45 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
 46 import jdk.javadoc.internal.doclets.formats.html.markup.Links;



 47 import jdk.javadoc.internal.doclets.toolkit.Content;
 48 import jdk.javadoc.internal.doclets.toolkit.MemberSummaryWriter;
 49 import jdk.javadoc.internal.doclets.toolkit.Resources;
 50 import jdk.javadoc.internal.doclets.toolkit.taglets.DeprecatedTaglet;

 51 import jdk.javadoc.internal.doclets.toolkit.util.Utils;
 52 
<span class="line-modified"> 53 import static javax.lang.model.element.Modifier.*;</span>




 54 
 55 /**
 56  * The base class for member writers.
 57  *
 58  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 59  *  If you write code that depends on this, you do so at your own risk.
 60  *  This code and its internal interfaces are subject to change or
 61  *  deletion without notice.&lt;/b&gt;
<span class="line-removed"> 62  *</span>
<span class="line-removed"> 63  * @author Robert Field</span>
<span class="line-removed"> 64  * @author Atul M Dambalkar</span>
<span class="line-removed"> 65  * @author Jamie Ho (Re-write)</span>
<span class="line-removed"> 66  * @author Bhavesh Patel (Modified)</span>
 67  */
 68 public abstract class AbstractMemberWriter implements MemberSummaryWriter {
 69 
 70     protected final HtmlConfiguration configuration;

 71     protected final Utils utils;
 72     protected final SubWriterHolderWriter writer;
 73     protected final Contents contents;
 74     protected final Resources resources;
 75     protected final Links links;
 76 
 77     protected final TypeElement typeElement;
<span class="line-removed"> 78     public final boolean nodepr;</span>
<span class="line-removed"> 79 </span>
<span class="line-removed"> 80     protected boolean printedSummaryHeader = false;</span>
 81 
 82     public AbstractMemberWriter(SubWriterHolderWriter writer, TypeElement typeElement) {
 83         this.configuration = writer.configuration;

 84         this.writer = writer;
<span class="line-removed"> 85         this.nodepr = configuration.nodeprecated;</span>
 86         this.typeElement = typeElement;
 87         this.utils = configuration.utils;
 88         this.contents = configuration.contents;
<span class="line-modified"> 89         this.resources = configuration.resources;</span>
 90         this.links = writer.links;
 91     }
 92 
 93     public AbstractMemberWriter(SubWriterHolderWriter writer) {
 94         this(writer, null);
 95     }
 96 
 97     /*** abstracts ***/
 98 
 99     /**
100      * Add the summary label for the member.
101      *
102      * @param memberTree the content tree to which the label will be added
103      */
104     public abstract void addSummaryLabel(Content memberTree);
105 
106     /**
107      * Get the summary for the member summary table.
108      *
109      * @return a string for the table summary
</pre>
<hr />
<pre>
120 
121     private Table summaryTable;
122 
123     private Table getSummaryTable() {
124         if (summaryTable == null) {
125             summaryTable = createSummaryTable();
126         }
127         return summaryTable;
128     }
129 
130     /**
131      * Create the summary table for this element.
132      * The table should be created and initialized if needed, and configured
133      * so that it is ready to add content with {@link Table#addRow(Content[])}
134      * and similar methods.
135      *
136      * @return the summary table
137      */
138     protected abstract Table createSummaryTable();
139 
<span class="line-removed">140 </span>
<span class="line-removed">141 </span>
142     /**
143      * Add inherited summary label for the member.
144      *
145      * @param typeElement the TypeElement to which to link to
146      * @param inheritedTree the content tree to which the inherited summary label will be added
147      */
148     public abstract void addInheritedSummaryLabel(TypeElement typeElement, Content inheritedTree);
149 
<span class="line-removed">150     /**</span>
<span class="line-removed">151      * Add the anchor for the summary section of the member.</span>
<span class="line-removed">152      *</span>
<span class="line-removed">153      * @param typeElement the TypeElement to be documented</span>
<span class="line-removed">154      * @param memberTree the content tree to which the summary anchor will be added</span>
<span class="line-removed">155      */</span>
<span class="line-removed">156     public abstract void addSummaryAnchor(TypeElement typeElement, Content memberTree);</span>
<span class="line-removed">157 </span>
<span class="line-removed">158     /**</span>
<span class="line-removed">159      * Add the anchor for the inherited summary section of the member.</span>
<span class="line-removed">160      *</span>
<span class="line-removed">161      * @param typeElement the TypeElement to be documented</span>
<span class="line-removed">162      * @param inheritedTree the content tree to which the inherited summary anchor will be added</span>
<span class="line-removed">163      */</span>
<span class="line-removed">164     public abstract void addInheritedSummaryAnchor(TypeElement typeElement, Content inheritedTree);</span>
<span class="line-removed">165 </span>
166     /**
167      * Add the summary type for the member.
168      *
169      * @param member the member to be documented
170      * @param tdSummaryType the content tree to which the type will be added
171      */
172     protected abstract void addSummaryType(Element member, Content tdSummaryType);
173 
174     /**
175      * Add the summary link for the member.
176      *
177      * @param typeElement the TypeElement to be documented
178      * @param member the member to be documented
179      * @param tdSummary the content tree to which the link will be added
180      */
181     protected void addSummaryLink(TypeElement typeElement, Element member, Content tdSummary) {
182         addSummaryLink(LinkInfoImpl.Kind.MEMBER, typeElement, member, tdSummary);
183     }
184 
185     /**
</pre>
<hr />
<pre>
194             TypeElement typeElement, Element member, Content tdSummary);
195 
196     /**
197      * Add the inherited summary link for the member.
198      *
199      * @param typeElement the TypeElement to be documented
200      * @param member the member to be documented
201      * @param linksTree the content tree to which the inherited summary link will be added
202      */
203     protected abstract void addInheritedSummaryLink(TypeElement typeElement,
204             Element member, Content linksTree);
205 
206     /**
207      * Get the deprecated link.
208      *
209      * @param member the member being linked to
210      * @return a content tree representing the link
211      */
212     protected abstract Content getDeprecatedLink(Element member);
213 
<span class="line-removed">214     /**</span>
<span class="line-removed">215      * Add the member name to the content tree.</span>
<span class="line-removed">216      *</span>
<span class="line-removed">217      * @param name the member name to be added to the content tree.</span>
<span class="line-removed">218      * @param htmltree the content tree to which the name will be added.</span>
<span class="line-removed">219      */</span>
<span class="line-removed">220     protected void addName(String name, Content htmltree) {</span>
<span class="line-removed">221         htmltree.add(name);</span>
<span class="line-removed">222     }</span>
<span class="line-removed">223 </span>
<span class="line-removed">224     /**</span>
<span class="line-removed">225      * Add the modifier for the member. The modifiers are ordered as specified</span>
<span class="line-removed">226      * by &lt;em&gt;The Java Language Specification&lt;/em&gt;.</span>
<span class="line-removed">227      *</span>
<span class="line-removed">228      * @param member the member for which the modifier will be added.</span>
<span class="line-removed">229      * @param htmltree the content tree to which the modifier information will be added.</span>
<span class="line-removed">230      */</span>
<span class="line-removed">231     protected void addModifiers(Element member, Content htmltree) {</span>
<span class="line-removed">232         Set&lt;Modifier&gt; set = new TreeSet&lt;&gt;(member.getModifiers());</span>
<span class="line-removed">233 </span>
<span class="line-removed">234         // remove the ones we really don&#39;t need</span>
<span class="line-removed">235         set.remove(NATIVE);</span>
<span class="line-removed">236         set.remove(SYNCHRONIZED);</span>
<span class="line-removed">237         set.remove(STRICTFP);</span>
<span class="line-removed">238 </span>
<span class="line-removed">239         // According to JLS, we should not be showing public modifier for</span>
<span class="line-removed">240         // interface methods.</span>
<span class="line-removed">241         if ((utils.isField(member) || utils.isMethod(member))</span>
<span class="line-removed">242             &amp;&amp; ((writer instanceof ClassWriterImpl</span>
<span class="line-removed">243                  &amp;&amp; utils.isInterface(((ClassWriterImpl) writer).getTypeElement())  ||</span>
<span class="line-removed">244                  writer instanceof AnnotationTypeWriterImpl) )) {</span>
<span class="line-removed">245             // Remove the implicit abstract and public modifiers</span>
<span class="line-removed">246             if (utils.isMethod(member) &amp;&amp;</span>
<span class="line-removed">247                 (utils.isInterface(member.getEnclosingElement()) ||</span>
<span class="line-removed">248                  utils.isAnnotationType(member.getEnclosingElement()))) {</span>
<span class="line-removed">249                 set.remove(ABSTRACT);</span>
<span class="line-removed">250                 set.remove(PUBLIC);</span>
<span class="line-removed">251             }</span>
<span class="line-removed">252             if (!utils.isMethod(member)) {</span>
<span class="line-removed">253                 set.remove(PUBLIC);</span>
<span class="line-removed">254             }</span>
<span class="line-removed">255         }</span>
<span class="line-removed">256         if (!set.isEmpty()) {</span>
<span class="line-removed">257             String mods = set.stream().map(Modifier::toString).collect(Collectors.joining(&quot; &quot;));</span>
<span class="line-removed">258             htmltree.add(mods);</span>
<span class="line-removed">259             htmltree.add(Contents.SPACE);</span>
<span class="line-removed">260         }</span>
<span class="line-removed">261     }</span>
<span class="line-removed">262 </span>
<span class="line-removed">263     protected CharSequence makeSpace(int len) {</span>
<span class="line-removed">264         if (len &lt;= 0) {</span>
<span class="line-removed">265             return &quot;&quot;;</span>
<span class="line-removed">266         }</span>
<span class="line-removed">267         StringBuilder sb = new StringBuilder(len);</span>
<span class="line-removed">268         for (int i = 0; i &lt; len; i++) {</span>
<span class="line-removed">269             sb.append(&#39; &#39;);</span>
<span class="line-removed">270         }</span>
<span class="line-removed">271         return sb;</span>
<span class="line-removed">272     }</span>
<span class="line-removed">273 </span>
274     /**
275      * Add the modifier and type for the member in the member summary.
276      *
277      * @param member the member to add the type for
278      * @param type the type to add
279      * @param tdSummaryType the content tree to which the modified and type will be added
280      */
281     protected void addModifierAndType(Element member, TypeMirror type,
282             Content tdSummaryType) {
283         HtmlTree code = new HtmlTree(HtmlTag.CODE);
284         addModifier(member, code);
285         if (type == null) {
286             code.add(utils.isClass(member) ? &quot;class&quot; : &quot;interface&quot;);
<span class="line-modified">287             code.add(Contents.SPACE);</span>
288         } else {
289             List&lt;? extends TypeParameterElement&gt; list = utils.isExecutableElement(member)
290                     ? ((ExecutableElement)member).getTypeParameters()
291                     : null;
292             if (list != null &amp;&amp; !list.isEmpty()) {
293                 Content typeParameters = ((AbstractExecutableMemberWriter) this)
294                         .getTypeParameters((ExecutableElement)member);
295                     code.add(typeParameters);
296                 //Code to avoid ugly wrapping in member summary table.
297                 if (typeParameters.charCount() &gt; 10) {
298                     code.add(new HtmlTree(HtmlTag.BR));
299                 } else {
<span class="line-modified">300                     code.add(Contents.SPACE);</span>
301                 }
302                 code.add(
303                         writer.getLink(new LinkInfoImpl(configuration,
304                         LinkInfoImpl.Kind.SUMMARY_RETURN_TYPE, type)));
305             } else {
306                 code.add(
307                         writer.getLink(new LinkInfoImpl(configuration,
308                         LinkInfoImpl.Kind.SUMMARY_RETURN_TYPE, type)));
309             }
310 
311         }
312         tdSummaryType.add(code);
313     }
314 
315     /**
316      * Add the modifier for the member.
317      *
318      * @param member the member to add the type for
319      * @param code the content tree to which the modified will be added
320      */
</pre>
<hr />
<pre>
423                         &amp;&amp; !utils.isInterface(element)
424                         &amp;&amp; !utils.isAnnotationType(element)) {
425                     HtmlTree name = new HtmlTree(HtmlTag.SPAN);
426                     name.setStyle(HtmlStyle.typeNameLabel);
427                     name.add(name(te) + &quot;.&quot;);
428                     typeContent.add(name);
429                 }
430                 addSummaryLink(utils.isClass(element) || utils.isInterface(element)
431                         ? LinkInfoImpl.Kind.CLASS_USE
432                         : LinkInfoImpl.Kind.MEMBER,
433                         te, element, typeContent);
434                 Content desc = new ContentBuilder();
435                 writer.addSummaryLinkComment(this, element, desc);
436                 useTable.addRow(summaryType, typeContent, desc);
437             }
438             contentTree.add(useTable.toContent());
439         }
440     }
441 
442     protected void serialWarning(Element e, String key, String a1, String a2) {
<span class="line-modified">443         if (configuration.serialwarn) {</span>
444             configuration.messages.warning(e, key, a1, a2);
445         }
446     }
447 
448     /**
449      * Add the member summary for the given class.
450      *
451      * @param tElement the class that is being documented
452      * @param member the member being documented
453      * @param firstSentenceTags the first sentence tags to be added to the summary
454      */
455     @Override
456     public void addMemberSummary(TypeElement tElement, Element member,
457             List&lt;? extends DocTree&gt; firstSentenceTags) {
458         if (tElement != typeElement) {
459             throw new IllegalStateException();
460         }
461         Table table = getSummaryTable();
462         List&lt;Content&gt; rowContents = new ArrayList&lt;&gt;();
463         Content summaryType = new ContentBuilder();
</pre>
<hr />
<pre>
481      * @param isFirst true if this is the first member in the list
482      * @param isLast true if this is the last member in the list
483      * @param linksTree the content tree to which the summary will be added
484      */
485     @Override
486     public void addInheritedMemberSummary(TypeElement tElement,
487             Element nestedClass, boolean isFirst, boolean isLast,
488             Content linksTree) {
489         writer.addInheritedMemberSummary(this, tElement, nestedClass, isFirst,
490                 linksTree);
491     }
492 
493     /**
494      * Get the inherited summary header for the given class.
495      *
496      * @param tElement the class the inherited member belongs to
497      * @return a content tree for the inherited summary header
498      */
499     @Override
500     public Content getInheritedSummaryHeader(TypeElement tElement) {
<span class="line-modified">501         Content inheritedTree = writer.getMemberTreeHeader();</span>
502         writer.addInheritedSummaryHeader(this, tElement, inheritedTree);
503         return inheritedTree;
504     }
505 
506     /**
507      * Get the inherited summary links tree.
508      *
509      * @return a content tree for the inherited summary links
510      */
511     @Override
512     public Content getInheritedSummaryLinksTree() {
513         return new HtmlTree(HtmlTag.CODE);
514     }
515 
516     /**
517      * Get the summary table tree for the given class.
518      *
519      * @param tElement the class for which the summary table is generated
520      * @return a content tree for the summary table
521      */
</pre>
<hr />
<pre>
526         }
527         Table table = getSummaryTable();
528         if (table.needsScript()) {
529             writer.getMainBodyScript().append(table.getScript());
530         }
531         return table.toContent();
532     }
533 
534     /**
535      * Get the member tree to be documented.
536      *
537      * @param memberTree the content tree of member to be documented
538      * @return a content tree that will be added to the class documentation
539      */
540     @Override
541     public Content getMemberTree(Content memberTree) {
542         return writer.getMemberTree(memberTree);
543     }
544 
545     /**
<span class="line-modified">546      * Get the member tree to be documented.</span>
<span class="line-removed">547      *</span>
<span class="line-removed">548      * @param memberTree the content tree of member to be documented</span>
<span class="line-removed">549      * @param isLastContent true if the content to be added is the last content</span>
<span class="line-removed">550      * @return a content tree that will be added to the class documentation</span>
551      */
<span class="line-modified">552     public Content getMemberTree(Content memberTree, boolean isLastContent) {</span>
<span class="line-modified">553         if (isLastContent)</span>
<span class="line-modified">554             return HtmlTree.UL(HtmlStyle.blockListLast, memberTree);</span>
<span class="line-modified">555         else</span>
<span class="line-modified">556             return HtmlTree.UL(HtmlStyle.blockList, memberTree);</span>































































































































































































































557     }
558 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1997, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.formats.html;
 27 
<span class="line-modified"> 28 import java.util.ArrayList;</span>
<span class="line-modified"> 29 import java.util.List;</span>
<span class="line-modified"> 30 import java.util.Set;</span>
<span class="line-modified"> 31 import java.util.TreeSet;</span>
 32 import java.util.stream.Collectors;
 33 
 34 import javax.lang.model.element.Element;
 35 import javax.lang.model.element.ExecutableElement;
 36 import javax.lang.model.element.Modifier;
 37 import javax.lang.model.element.TypeElement;
 38 import javax.lang.model.element.TypeParameterElement;
 39 import javax.lang.model.type.TypeMirror;
 40 
 41 import com.sun.source.doctree.DocTree;
<span class="line-added"> 42 </span>
 43 import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;
<span class="line-added"> 44 import jdk.javadoc.internal.doclets.formats.html.markup.Entity;</span>
 45 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
 46 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
 47 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
 48 import jdk.javadoc.internal.doclets.formats.html.markup.Links;
<span class="line-added"> 49 import jdk.javadoc.internal.doclets.formats.html.markup.StringContent;</span>
<span class="line-added"> 50 import jdk.javadoc.internal.doclets.formats.html.markup.Table;</span>
<span class="line-added"> 51 import jdk.javadoc.internal.doclets.formats.html.markup.TableHeader;</span>
 52 import jdk.javadoc.internal.doclets.toolkit.Content;
 53 import jdk.javadoc.internal.doclets.toolkit.MemberSummaryWriter;
 54 import jdk.javadoc.internal.doclets.toolkit.Resources;
 55 import jdk.javadoc.internal.doclets.toolkit.taglets.DeprecatedTaglet;
<span class="line-added"> 56 import jdk.javadoc.internal.doclets.toolkit.util.DocletConstants;</span>
 57 import jdk.javadoc.internal.doclets.toolkit.util.Utils;
 58 
<span class="line-modified"> 59 import static javax.lang.model.element.Modifier.ABSTRACT;</span>
<span class="line-added"> 60 import static javax.lang.model.element.Modifier.NATIVE;</span>
<span class="line-added"> 61 import static javax.lang.model.element.Modifier.PUBLIC;</span>
<span class="line-added"> 62 import static javax.lang.model.element.Modifier.STRICTFP;</span>
<span class="line-added"> 63 import static javax.lang.model.element.Modifier.SYNCHRONIZED;</span>
 64 
 65 /**
 66  * The base class for member writers.
 67  *
 68  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 69  *  If you write code that depends on this, you do so at your own risk.
 70  *  This code and its internal interfaces are subject to change or
 71  *  deletion without notice.&lt;/b&gt;





 72  */
 73 public abstract class AbstractMemberWriter implements MemberSummaryWriter {
 74 
 75     protected final HtmlConfiguration configuration;
<span class="line-added"> 76     protected final HtmlOptions options;</span>
 77     protected final Utils utils;
 78     protected final SubWriterHolderWriter writer;
 79     protected final Contents contents;
 80     protected final Resources resources;
 81     protected final Links links;
 82 
 83     protected final TypeElement typeElement;



 84 
 85     public AbstractMemberWriter(SubWriterHolderWriter writer, TypeElement typeElement) {
 86         this.configuration = writer.configuration;
<span class="line-added"> 87         this.options = configuration.getOptions();</span>
 88         this.writer = writer;

 89         this.typeElement = typeElement;
 90         this.utils = configuration.utils;
 91         this.contents = configuration.contents;
<span class="line-modified"> 92         this.resources = configuration.docResources;</span>
 93         this.links = writer.links;
 94     }
 95 
 96     public AbstractMemberWriter(SubWriterHolderWriter writer) {
 97         this(writer, null);
 98     }
 99 
100     /*** abstracts ***/
101 
102     /**
103      * Add the summary label for the member.
104      *
105      * @param memberTree the content tree to which the label will be added
106      */
107     public abstract void addSummaryLabel(Content memberTree);
108 
109     /**
110      * Get the summary for the member summary table.
111      *
112      * @return a string for the table summary
</pre>
<hr />
<pre>
123 
124     private Table summaryTable;
125 
126     private Table getSummaryTable() {
127         if (summaryTable == null) {
128             summaryTable = createSummaryTable();
129         }
130         return summaryTable;
131     }
132 
133     /**
134      * Create the summary table for this element.
135      * The table should be created and initialized if needed, and configured
136      * so that it is ready to add content with {@link Table#addRow(Content[])}
137      * and similar methods.
138      *
139      * @return the summary table
140      */
141     protected abstract Table createSummaryTable();
142 


143     /**
144      * Add inherited summary label for the member.
145      *
146      * @param typeElement the TypeElement to which to link to
147      * @param inheritedTree the content tree to which the inherited summary label will be added
148      */
149     public abstract void addInheritedSummaryLabel(TypeElement typeElement, Content inheritedTree);
150 
















151     /**
152      * Add the summary type for the member.
153      *
154      * @param member the member to be documented
155      * @param tdSummaryType the content tree to which the type will be added
156      */
157     protected abstract void addSummaryType(Element member, Content tdSummaryType);
158 
159     /**
160      * Add the summary link for the member.
161      *
162      * @param typeElement the TypeElement to be documented
163      * @param member the member to be documented
164      * @param tdSummary the content tree to which the link will be added
165      */
166     protected void addSummaryLink(TypeElement typeElement, Element member, Content tdSummary) {
167         addSummaryLink(LinkInfoImpl.Kind.MEMBER, typeElement, member, tdSummary);
168     }
169 
170     /**
</pre>
<hr />
<pre>
179             TypeElement typeElement, Element member, Content tdSummary);
180 
181     /**
182      * Add the inherited summary link for the member.
183      *
184      * @param typeElement the TypeElement to be documented
185      * @param member the member to be documented
186      * @param linksTree the content tree to which the inherited summary link will be added
187      */
188     protected abstract void addInheritedSummaryLink(TypeElement typeElement,
189             Element member, Content linksTree);
190 
191     /**
192      * Get the deprecated link.
193      *
194      * @param member the member being linked to
195      * @return a content tree representing the link
196      */
197     protected abstract Content getDeprecatedLink(Element member);
198 




























































199     /**
200      * Add the modifier and type for the member in the member summary.
201      *
202      * @param member the member to add the type for
203      * @param type the type to add
204      * @param tdSummaryType the content tree to which the modified and type will be added
205      */
206     protected void addModifierAndType(Element member, TypeMirror type,
207             Content tdSummaryType) {
208         HtmlTree code = new HtmlTree(HtmlTag.CODE);
209         addModifier(member, code);
210         if (type == null) {
211             code.add(utils.isClass(member) ? &quot;class&quot; : &quot;interface&quot;);
<span class="line-modified">212             code.add(Entity.NO_BREAK_SPACE);</span>
213         } else {
214             List&lt;? extends TypeParameterElement&gt; list = utils.isExecutableElement(member)
215                     ? ((ExecutableElement)member).getTypeParameters()
216                     : null;
217             if (list != null &amp;&amp; !list.isEmpty()) {
218                 Content typeParameters = ((AbstractExecutableMemberWriter) this)
219                         .getTypeParameters((ExecutableElement)member);
220                     code.add(typeParameters);
221                 //Code to avoid ugly wrapping in member summary table.
222                 if (typeParameters.charCount() &gt; 10) {
223                     code.add(new HtmlTree(HtmlTag.BR));
224                 } else {
<span class="line-modified">225                     code.add(Entity.NO_BREAK_SPACE);</span>
226                 }
227                 code.add(
228                         writer.getLink(new LinkInfoImpl(configuration,
229                         LinkInfoImpl.Kind.SUMMARY_RETURN_TYPE, type)));
230             } else {
231                 code.add(
232                         writer.getLink(new LinkInfoImpl(configuration,
233                         LinkInfoImpl.Kind.SUMMARY_RETURN_TYPE, type)));
234             }
235 
236         }
237         tdSummaryType.add(code);
238     }
239 
240     /**
241      * Add the modifier for the member.
242      *
243      * @param member the member to add the type for
244      * @param code the content tree to which the modified will be added
245      */
</pre>
<hr />
<pre>
348                         &amp;&amp; !utils.isInterface(element)
349                         &amp;&amp; !utils.isAnnotationType(element)) {
350                     HtmlTree name = new HtmlTree(HtmlTag.SPAN);
351                     name.setStyle(HtmlStyle.typeNameLabel);
352                     name.add(name(te) + &quot;.&quot;);
353                     typeContent.add(name);
354                 }
355                 addSummaryLink(utils.isClass(element) || utils.isInterface(element)
356                         ? LinkInfoImpl.Kind.CLASS_USE
357                         : LinkInfoImpl.Kind.MEMBER,
358                         te, element, typeContent);
359                 Content desc = new ContentBuilder();
360                 writer.addSummaryLinkComment(this, element, desc);
361                 useTable.addRow(summaryType, typeContent, desc);
362             }
363             contentTree.add(useTable.toContent());
364         }
365     }
366 
367     protected void serialWarning(Element e, String key, String a1, String a2) {
<span class="line-modified">368         if (options.serialWarn()) {</span>
369             configuration.messages.warning(e, key, a1, a2);
370         }
371     }
372 
373     /**
374      * Add the member summary for the given class.
375      *
376      * @param tElement the class that is being documented
377      * @param member the member being documented
378      * @param firstSentenceTags the first sentence tags to be added to the summary
379      */
380     @Override
381     public void addMemberSummary(TypeElement tElement, Element member,
382             List&lt;? extends DocTree&gt; firstSentenceTags) {
383         if (tElement != typeElement) {
384             throw new IllegalStateException();
385         }
386         Table table = getSummaryTable();
387         List&lt;Content&gt; rowContents = new ArrayList&lt;&gt;();
388         Content summaryType = new ContentBuilder();
</pre>
<hr />
<pre>
406      * @param isFirst true if this is the first member in the list
407      * @param isLast true if this is the last member in the list
408      * @param linksTree the content tree to which the summary will be added
409      */
410     @Override
411     public void addInheritedMemberSummary(TypeElement tElement,
412             Element nestedClass, boolean isFirst, boolean isLast,
413             Content linksTree) {
414         writer.addInheritedMemberSummary(this, tElement, nestedClass, isFirst,
415                 linksTree);
416     }
417 
418     /**
419      * Get the inherited summary header for the given class.
420      *
421      * @param tElement the class the inherited member belongs to
422      * @return a content tree for the inherited summary header
423      */
424     @Override
425     public Content getInheritedSummaryHeader(TypeElement tElement) {
<span class="line-modified">426         Content inheritedTree = writer.getMemberInheritedTree();</span>
427         writer.addInheritedSummaryHeader(this, tElement, inheritedTree);
428         return inheritedTree;
429     }
430 
431     /**
432      * Get the inherited summary links tree.
433      *
434      * @return a content tree for the inherited summary links
435      */
436     @Override
437     public Content getInheritedSummaryLinksTree() {
438         return new HtmlTree(HtmlTag.CODE);
439     }
440 
441     /**
442      * Get the summary table tree for the given class.
443      *
444      * @param tElement the class for which the summary table is generated
445      * @return a content tree for the summary table
446      */
</pre>
<hr />
<pre>
451         }
452         Table table = getSummaryTable();
453         if (table.needsScript()) {
454             writer.getMainBodyScript().append(table.getScript());
455         }
456         return table.toContent();
457     }
458 
459     /**
460      * Get the member tree to be documented.
461      *
462      * @param memberTree the content tree of member to be documented
463      * @return a content tree that will be added to the class documentation
464      */
465     @Override
466     public Content getMemberTree(Content memberTree) {
467         return writer.getMemberTree(memberTree);
468     }
469 
470     /**
<span class="line-modified">471      * A content builder for member signatures.</span>




472      */
<span class="line-modified">473     class MemberSignature {</span>
<span class="line-modified">474 </span>
<span class="line-modified">475         private Element element;</span>
<span class="line-modified">476         private Content typeParameters;</span>
<span class="line-modified">477         private Content returnType;</span>
<span class="line-added">478         private Content parameters;</span>
<span class="line-added">479         private Content exceptions;</span>
<span class="line-added">480 </span>
<span class="line-added">481         // Threshold for length of type parameters before switching from inline to block representation.</span>
<span class="line-added">482         private static final int TYPE_PARAMS_MAX_INLINE_LENGTH = 50;</span>
<span class="line-added">483 </span>
<span class="line-added">484         // Threshold for combined length of modifiers, type params and return type before breaking</span>
<span class="line-added">485         // it up with a line break before the return type.</span>
<span class="line-added">486         private static final int RETURN_TYPE_MAX_LINE_LENGTH = 50;</span>
<span class="line-added">487 </span>
<span class="line-added">488         /**</span>
<span class="line-added">489          * Create a new member signature builder.</span>
<span class="line-added">490          *</span>
<span class="line-added">491          * @param element The element for which to create a signature.</span>
<span class="line-added">492          */</span>
<span class="line-added">493         MemberSignature(Element element) {</span>
<span class="line-added">494             this.element = element;</span>
<span class="line-added">495         }</span>
<span class="line-added">496 </span>
<span class="line-added">497         /**</span>
<span class="line-added">498          * Add the type parameters for an executable member.</span>
<span class="line-added">499          *</span>
<span class="line-added">500          * @param typeParameters the content tree containing the type parameters to add.</span>
<span class="line-added">501          * @return this MemberSignature instance</span>
<span class="line-added">502          */</span>
<span class="line-added">503         MemberSignature addTypeParameters(Content typeParameters) {</span>
<span class="line-added">504             this.typeParameters = typeParameters;</span>
<span class="line-added">505             return this;</span>
<span class="line-added">506         }</span>
<span class="line-added">507 </span>
<span class="line-added">508         /**</span>
<span class="line-added">509          * Add the return type for an executable member.</span>
<span class="line-added">510          *</span>
<span class="line-added">511          * @param returnType the content tree containing the return type to add.</span>
<span class="line-added">512          * @return this MemberSignature instance</span>
<span class="line-added">513          */</span>
<span class="line-added">514         MemberSignature addReturnType(Content returnType) {</span>
<span class="line-added">515             this.returnType = returnType;</span>
<span class="line-added">516             return this;</span>
<span class="line-added">517         }</span>
<span class="line-added">518 </span>
<span class="line-added">519         /**</span>
<span class="line-added">520          * Add the type information for a non-executable member.</span>
<span class="line-added">521          *</span>
<span class="line-added">522          * @param type the type of the member.</span>
<span class="line-added">523          * @return this MemberSignature instance</span>
<span class="line-added">524          */</span>
<span class="line-added">525         MemberSignature addType(TypeMirror type) {</span>
<span class="line-added">526             this.returnType = writer.getLink(new LinkInfoImpl(configuration, LinkInfoImpl.Kind.MEMBER, type));</span>
<span class="line-added">527             return this;</span>
<span class="line-added">528         }</span>
<span class="line-added">529 </span>
<span class="line-added">530         /**</span>
<span class="line-added">531          * Add the parameter information of an executable member.</span>
<span class="line-added">532          *</span>
<span class="line-added">533          * @param paramTree the content tree containing the parameter information.</span>
<span class="line-added">534          * @return this MemberSignature instance</span>
<span class="line-added">535          */</span>
<span class="line-added">536         MemberSignature addParameters(Content paramTree) {</span>
<span class="line-added">537             this.parameters = paramTree;</span>
<span class="line-added">538             return this;</span>
<span class="line-added">539         }</span>
<span class="line-added">540 </span>
<span class="line-added">541         /**</span>
<span class="line-added">542          * Add the exception information of an executable member.</span>
<span class="line-added">543          *</span>
<span class="line-added">544          * @param exceptionTree the content tree containing the exception information</span>
<span class="line-added">545          * @return this MemberSignature instance</span>
<span class="line-added">546          */</span>
<span class="line-added">547         MemberSignature addExceptions(Content exceptionTree) {</span>
<span class="line-added">548             this.exceptions = exceptionTree;</span>
<span class="line-added">549             return this;</span>
<span class="line-added">550         }</span>
<span class="line-added">551 </span>
<span class="line-added">552         /**</span>
<span class="line-added">553          * Return a HTML tree containing the member signature.</span>
<span class="line-added">554          *</span>
<span class="line-added">555          * @return a HTML tree containing the member signature</span>
<span class="line-added">556          */</span>
<span class="line-added">557         Content toContent() {</span>
<span class="line-added">558             Content content = new ContentBuilder();</span>
<span class="line-added">559             // Position of last line separator.</span>
<span class="line-added">560             int lastLineSeparator = 0;</span>
<span class="line-added">561 </span>
<span class="line-added">562             // Annotations</span>
<span class="line-added">563             Content annotationInfo = writer.getAnnotationInfo(element.getAnnotationMirrors(), true);</span>
<span class="line-added">564             if (!annotationInfo.isEmpty()) {</span>
<span class="line-added">565                 content.add(HtmlTree.SPAN(HtmlStyle.annotations, annotationInfo));</span>
<span class="line-added">566                 lastLineSeparator = content.charCount();</span>
<span class="line-added">567             }</span>
<span class="line-added">568 </span>
<span class="line-added">569             // Modifiers</span>
<span class="line-added">570             appendModifiers(content);</span>
<span class="line-added">571 </span>
<span class="line-added">572             // Type parameters</span>
<span class="line-added">573             if (typeParameters != null &amp;&amp; !typeParameters.isEmpty()) {</span>
<span class="line-added">574                 lastLineSeparator = appendTypeParameters(content, lastLineSeparator);</span>
<span class="line-added">575             }</span>
<span class="line-added">576 </span>
<span class="line-added">577             // Return type</span>
<span class="line-added">578             if (returnType != null) {</span>
<span class="line-added">579                 content.add(HtmlTree.SPAN(HtmlStyle.returnType, returnType));</span>
<span class="line-added">580                 content.add(Entity.NO_BREAK_SPACE);</span>
<span class="line-added">581             }</span>
<span class="line-added">582 </span>
<span class="line-added">583             // Name</span>
<span class="line-added">584             HtmlTree nameSpan = new HtmlTree(HtmlTag.SPAN);</span>
<span class="line-added">585             nameSpan.setStyle(HtmlStyle.memberName);</span>
<span class="line-added">586             if (options.linkSource()) {</span>
<span class="line-added">587                 Content name = new StringContent(name(element));</span>
<span class="line-added">588                 writer.addSrcLink(element, name, nameSpan);</span>
<span class="line-added">589             } else {</span>
<span class="line-added">590                 nameSpan.add(name(element));</span>
<span class="line-added">591             }</span>
<span class="line-added">592             content.add(nameSpan);</span>
<span class="line-added">593 </span>
<span class="line-added">594 </span>
<span class="line-added">595             // Parameters and exceptions</span>
<span class="line-added">596             if (parameters != null) {</span>
<span class="line-added">597                 appendParametersAndExceptions(content, lastLineSeparator);</span>
<span class="line-added">598             }</span>
<span class="line-added">599 </span>
<span class="line-added">600             return HtmlTree.DIV(HtmlStyle.memberSignature, content);</span>
<span class="line-added">601         }</span>
<span class="line-added">602 </span>
<span class="line-added">603         /**</span>
<span class="line-added">604          * Add the modifier for the member. The modifiers are ordered as specified</span>
<span class="line-added">605          * by &lt;em&gt;The Java Language Specification&lt;/em&gt;.</span>
<span class="line-added">606          *</span>
<span class="line-added">607          * @param htmltree the content tree to which the modifier information will be added.</span>
<span class="line-added">608          */</span>
<span class="line-added">609         private void appendModifiers(Content htmltree) {</span>
<span class="line-added">610             Set&lt;Modifier&gt; set = new TreeSet&lt;&gt;(element.getModifiers());</span>
<span class="line-added">611 </span>
<span class="line-added">612             // remove the ones we really don&#39;t need</span>
<span class="line-added">613             set.remove(NATIVE);</span>
<span class="line-added">614             set.remove(SYNCHRONIZED);</span>
<span class="line-added">615             set.remove(STRICTFP);</span>
<span class="line-added">616 </span>
<span class="line-added">617             // According to JLS, we should not be showing public modifier for</span>
<span class="line-added">618             // interface methods.</span>
<span class="line-added">619             if ((utils.isField(element) || utils.isMethod(element))</span>
<span class="line-added">620                     &amp;&amp; ((writer instanceof ClassWriterImpl</span>
<span class="line-added">621                     &amp;&amp; utils.isInterface(((ClassWriterImpl) writer).getTypeElement())  ||</span>
<span class="line-added">622                     writer instanceof AnnotationTypeWriterImpl) )) {</span>
<span class="line-added">623                 // Remove the implicit abstract and public modifiers</span>
<span class="line-added">624                 if (utils.isMethod(element) &amp;&amp;</span>
<span class="line-added">625                         (utils.isInterface(element.getEnclosingElement()) ||</span>
<span class="line-added">626                                 utils.isAnnotationType(element.getEnclosingElement()))) {</span>
<span class="line-added">627                     set.remove(ABSTRACT);</span>
<span class="line-added">628                     set.remove(PUBLIC);</span>
<span class="line-added">629                 }</span>
<span class="line-added">630                 if (!utils.isMethod(element)) {</span>
<span class="line-added">631                     set.remove(PUBLIC);</span>
<span class="line-added">632                 }</span>
<span class="line-added">633             }</span>
<span class="line-added">634             if (!set.isEmpty()) {</span>
<span class="line-added">635                 String mods = set.stream().map(Modifier::toString).collect(Collectors.joining(&quot; &quot;));</span>
<span class="line-added">636                 htmltree.add(HtmlTree.SPAN(HtmlStyle.modifiers, new StringContent(mods)));</span>
<span class="line-added">637                 htmltree.add(Entity.NO_BREAK_SPACE);</span>
<span class="line-added">638             }</span>
<span class="line-added">639         }</span>
<span class="line-added">640 </span>
<span class="line-added">641         /**</span>
<span class="line-added">642          * Append the type parameter information to the HTML tree.</span>
<span class="line-added">643          *</span>
<span class="line-added">644          * @param htmltree the HTML tree</span>
<span class="line-added">645          * @param lastLineSeparator index of last line separator in HTML tree</span>
<span class="line-added">646          * @return the new index of the last line separator</span>
<span class="line-added">647          */</span>
<span class="line-added">648         private int appendTypeParameters(Content htmltree, int lastLineSeparator) {</span>
<span class="line-added">649             // Apply different wrapping strategies for type parameters</span>
<span class="line-added">650             // depending of combined length of type parameters and return type.</span>
<span class="line-added">651             int typeParamLength = typeParameters.charCount();</span>
<span class="line-added">652 </span>
<span class="line-added">653             if (typeParamLength &gt;= TYPE_PARAMS_MAX_INLINE_LENGTH) {</span>
<span class="line-added">654                 htmltree.add(HtmlTree.SPAN(HtmlStyle.typeParametersLong, typeParameters));</span>
<span class="line-added">655             } else {</span>
<span class="line-added">656                 htmltree.add(HtmlTree.SPAN(HtmlStyle.typeParameters, typeParameters));</span>
<span class="line-added">657             }</span>
<span class="line-added">658 </span>
<span class="line-added">659             int lineLength = htmltree.charCount() - lastLineSeparator;</span>
<span class="line-added">660             int newLastLineSeparator = lastLineSeparator;</span>
<span class="line-added">661 </span>
<span class="line-added">662             // sum below includes length of modifiers plus type params added above</span>
<span class="line-added">663             if (lineLength + returnType.charCount()&gt; RETURN_TYPE_MAX_LINE_LENGTH) {</span>
<span class="line-added">664                 htmltree.add(DocletConstants.NL);</span>
<span class="line-added">665                 newLastLineSeparator = htmltree.charCount();</span>
<span class="line-added">666             } else {</span>
<span class="line-added">667                 htmltree.add(Entity.NO_BREAK_SPACE);</span>
<span class="line-added">668             }</span>
<span class="line-added">669 </span>
<span class="line-added">670             return newLastLineSeparator;</span>
<span class="line-added">671         }</span>
<span class="line-added">672 </span>
<span class="line-added">673         /**</span>
<span class="line-added">674          * Append the parameters and exceptions information to the HTML tree.</span>
<span class="line-added">675          *</span>
<span class="line-added">676          * @param htmltree the HTML tree</span>
<span class="line-added">677          * @param lastLineSeparator the index of the last line separator in HTML tree</span>
<span class="line-added">678          */</span>
<span class="line-added">679         private void appendParametersAndExceptions(Content htmltree, int lastLineSeparator) {</span>
<span class="line-added">680             // Record current position for indentation of exceptions</span>
<span class="line-added">681             int indentSize = htmltree.charCount() - lastLineSeparator;</span>
<span class="line-added">682 </span>
<span class="line-added">683             if (parameters.isEmpty()) {</span>
<span class="line-added">684                 htmltree.add(&quot;()&quot;);</span>
<span class="line-added">685             } else {</span>
<span class="line-added">686                 parameters.add(&quot;)&quot;);</span>
<span class="line-added">687                 htmltree.add(Entity.ZERO_WIDTH_SPACE);</span>
<span class="line-added">688                 htmltree.add(&quot;(&quot;);</span>
<span class="line-added">689                 htmltree.add(HtmlTree.SPAN(HtmlStyle.arguments, parameters));</span>
<span class="line-added">690             }</span>
<span class="line-added">691 </span>
<span class="line-added">692             // Exceptions</span>
<span class="line-added">693             if (exceptions != null &amp;&amp; !exceptions.isEmpty()) {</span>
<span class="line-added">694                 CharSequence indent = &quot; &quot;.repeat(Math.max(0, indentSize + 1 - 7));</span>
<span class="line-added">695                 htmltree.add(DocletConstants.NL);</span>
<span class="line-added">696                 htmltree.add(indent);</span>
<span class="line-added">697                 htmltree.add(&quot;throws &quot;);</span>
<span class="line-added">698                 htmltree.add(HtmlTree.SPAN(HtmlStyle.exceptions, exceptions));</span>
<span class="line-added">699             }</span>
<span class="line-added">700         }</span>
701     }
702 }
</pre>
</td>
</tr>
</table>
<center><a href="AbstractIndexWriter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractTreeWriter.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>