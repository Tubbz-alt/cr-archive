<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/taglets/ValueTaglet.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2001, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.toolkit.taglets;
 27 
 28 import java.util.EnumSet;
 29 import javax.lang.model.element.Element;
 30 import javax.lang.model.element.VariableElement;
 31 
 32 import com.sun.source.doctree.DocTree;
 33 import jdk.javadoc.internal.doclets.toolkit.BaseConfiguration;
 34 import jdk.javadoc.internal.doclets.toolkit.Content;
 35 import jdk.javadoc.internal.doclets.toolkit.Messages;
 36 import jdk.javadoc.internal.doclets.toolkit.util.CommentHelper;
 37 import jdk.javadoc.internal.doclets.toolkit.util.Utils;
 38 
 39 import static com.sun.source.doctree.DocTree.Kind.VALUE;
 40 
 41 /**
 42  * An inline Taglet representing the value tag. This tag should only be used with
 43  * constant fields that have a value.  It is used to access the value of constant
 44  * fields.  This inline tag has an optional field name parameter.  If the name is
 45  * specified, the constant value is retrieved from the specified field.  A link
 46  * is also created to the specified field.  If a name is not specified, the value
 47  * is retrieved for the field that the inline tag appears on.  The name is specifed
 48  * in the following format:  [fully qualified class name]#[constant field name].
 49  *
 50  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 51  *  If you write code that depends on this, you do so at your own risk.
 52  *  This code and its internal interfaces are subject to change or
 53  *  deletion without notice.&lt;/b&gt;
 54  *
 55  * @author Jamie Ho
 56  */
 57 
 58 public class ValueTaglet extends BaseTaglet {
 59 
 60     /**
 61      * Construct a new ValueTaglet.
 62      */
 63     public ValueTaglet() {
 64         super(VALUE.tagName, true, EnumSet.allOf(Site.class));
 65     }
 66 
 67     /**
 68      * Returns the referenced field or a null if the value tag
 69      * is empty or the reference is invalid.
 70      *
 71      * @param holder the tag holder.
 72      * @param config the  configuration of the doclet.
 73      * @param tag the value tag.
 74      *
 75      * @return the referenced field or null.
 76      */
 77     private VariableElement getVariableElement(Element holder, BaseConfiguration config, DocTree tag) {
 78         CommentHelper ch = config.utils.getCommentHelper(holder);
 79         String signature = ch.getReferencedSignature(tag);
 80 
 81         Element e = signature == null
 82                 ? holder
 83                 : ch.getReferencedMember(config, tag);
 84 
 85         return (e != null &amp;&amp; config.utils.isVariableElement(e))
 86                 ? (VariableElement) e
 87                 : null;
 88     }
 89 
 90     @Override
 91     public Content getTagletOutput(Element holder, DocTree tag, TagletWriter writer) {
 92         Utils utils = writer.configuration().utils;
 93         Messages messages = writer.configuration().getMessages();
 94         VariableElement field = getVariableElement(holder, writer.configuration(), tag);
 95         if (field == null) {
 96             if (tag.toString().isEmpty()) {
 97                 //Invalid use of @value
 98                 messages.warning(holder,
 99                         &quot;doclet.value_tag_invalid_use&quot;);
100             } else {
101                 //Reference is unknown.
102                 messages.warning(holder,
103                         &quot;doclet.value_tag_invalid_reference&quot;, tag.toString());
104             }
105         } else if (field.getConstantValue() != null) {
106             return writer.valueTagOutput(field,
107                 utils.constantValueExpresion(field),
108                 // TODO: investigate and cleanup
109                 // in the j.l.m world, equals will not be accurate
110                 // !field.equals(tag.holder())
111                 !utils.elementsEqual(field, holder)
112             );
113         } else {
114             //Referenced field is not a constant.
115             messages.warning(holder,
116                 &quot;doclet.value_tag_invalid_constant&quot;, utils.getSimpleName(field));
117         }
118         return writer.getOutputInstance();
119     }
120 }
    </pre>
  </body>
</html>