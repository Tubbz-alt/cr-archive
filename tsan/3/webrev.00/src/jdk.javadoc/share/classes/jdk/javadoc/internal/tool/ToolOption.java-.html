<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.javadoc/share/classes/jdk/javadoc/internal/tool/ToolOption.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2012, 2018, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.tool;
 27 
 28 import java.util.ArrayList;
 29 import java.util.Arrays;
 30 import java.util.EnumMap;
 31 import java.util.LinkedHashMap;
 32 import java.util.List;
 33 import java.util.Map;
 34 
 35 import javax.lang.model.element.ElementKind;
 36 
 37 import com.sun.tools.javac.main.Option;
 38 import com.sun.tools.javac.main.Option.InvalidValueException;
 39 import com.sun.tools.javac.main.Option.OptionKind;
 40 import com.sun.tools.javac.main.OptionHelper;
 41 import com.sun.tools.javac.util.Options;
 42 
 43 import static com.sun.tools.javac.main.Option.OptionKind.*;
 44 import static jdk.javadoc.internal.tool.Main.Result.*;
 45 
 46 /**
 47  * javadoc tool options.
 48  *
 49  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 50  *  If you write code that depends on this, you do so at your own risk.
 51  *  This code and its internal interfaces are subject to change or
 52  *  deletion without notice.&lt;/b&gt;
 53  */
 54 public enum ToolOption {
 55 
 56     // ----- options for underlying compiler -----
 57 
 58     BOOTCLASSPATH(&quot;-bootclasspath&quot;, STANDARD, true) {
 59         @Override
 60         public void process(Helper helper, String arg) throws InvalidValueException {
 61             Option.BOOT_CLASS_PATH.process(helper.getOptionHelper(), primaryName, arg);
 62         }
 63     },
 64 
 65     CLASS_PATH(&quot;--class-path -classpath -cp&quot;, STANDARD, true) {
 66         @Override
 67         public void process(Helper helper, String arg) throws InvalidValueException {
 68             Option.CLASS_PATH.process(helper.getOptionHelper(), primaryName, arg);
 69         }
 70     },
 71 
 72     EXTDIRS(&quot;-extdirs&quot;, STANDARD, true) {
 73         @Override
 74         public void process(Helper helper, String arg) throws InvalidValueException {
 75             Option.EXTDIRS.process(helper.getOptionHelper(), primaryName, arg);
 76         }
 77     },
 78 
 79     SOURCE_PATH(&quot;--source-path -sourcepath&quot;, STANDARD, true) {
 80         @Override
 81         public void process(Helper helper, String arg) throws InvalidValueException {
 82             Option.SOURCE_PATH.process(helper.getOptionHelper(), primaryName, arg);
 83         }
 84     },
 85 
 86     MODULE_SOURCE_PATH(&quot;--module-source-path&quot;, STANDARD, true) {
 87         @Override
 88         public void process(Helper helper, String arg) throws InvalidValueException {
 89             Option.MODULE_SOURCE_PATH.process(helper.getOptionHelper(), primaryName, arg);
 90         }
 91     },
 92 
 93     UPGRADE_MODULE_PATH(&quot;--upgrade-module-path&quot;, STANDARD, true) {
 94         @Override
 95         public void process(Helper helper, String arg) throws InvalidValueException {
 96             Option.UPGRADE_MODULE_PATH.process(helper.getOptionHelper(), primaryName, arg);
 97         }
 98     },
 99 
100     SYSTEM(&quot;--system&quot;, STANDARD, true) {
101         @Override
102         public void process(Helper helper, String arg) throws InvalidValueException {
103             Option.SYSTEM.process(helper.getOptionHelper(), primaryName, arg);
104         }
105     },
106 
107     MODULE_PATH(&quot;--module-path -p&quot;, STANDARD, true) {
108         @Override
109         public void process(Helper helper, String arg) throws InvalidValueException {
110             Option.MODULE_PATH.process(helper.getOptionHelper(), primaryName, arg);
111         }
112     },
113 
114     ADD_MODULES(&quot;--add-modules&quot;, STANDARD, true) {
115         @Override
116         public void process(Helper helper, String arg) throws InvalidValueException {
117             Option.ADD_MODULES.process(helper.getOptionHelper(), primaryName, arg);
118         }
119     },
120 
121     LIMIT_MODULES(&quot;--limit-modules&quot;, STANDARD, true) {
122         @Override
123         public void process(Helper helper, String arg) throws InvalidValueException {
124             Option.LIMIT_MODULES.process(helper.getOptionHelper(), primaryName, arg);
125         }
126     },
127 
128     MODULE(&quot;--module&quot;, STANDARD, true) {
129         @Override
130         public void process(Helper helper, String arg) {
131             helper.addToList(this, &quot;,&quot;, arg);
132         }
133     },
134 
135     ENCODING(&quot;-encoding&quot;, STANDARD, true) {
136         @Override
137         public void process(Helper helper, String arg) throws InvalidValueException {
138             Option.ENCODING.process(helper.getOptionHelper(), primaryName, arg);
139         }
140     },
141 
142     RELEASE(&quot;--release&quot;, STANDARD, true) {
143         @Override
144         public void process(Helper helper, String arg) throws InvalidValueException {
145             Option.RELEASE.process(helper.getOptionHelper(), primaryName, arg);
146         }
147     },
148 
149     SOURCE(&quot;--source -source&quot;, STANDARD, true) {
150         @Override
151         public void process(Helper helper, String arg) throws InvalidValueException {
152             Option.SOURCE.process(helper.getOptionHelper(), primaryName, arg);
153             Option.TARGET.process(helper.getOptionHelper(), Option.TARGET.primaryName, arg);
154         }
155     },
156 
157     XMAXERRS(&quot;-Xmaxerrs&quot;, EXTENDED, true) {
158         @Override
159         public void process(Helper helper, String arg) throws InvalidValueException {
160             Option.XMAXERRS.process(helper.getOptionHelper(), primaryName, arg);
161         }
162     },
163 
164     XMAXWARNS(&quot;-Xmaxwarns&quot;, EXTENDED, true) {
165         @Override
166         public void process(Helper helper, String arg) throws InvalidValueException {
167             Option.XMAXWARNS.process(helper.getOptionHelper(), primaryName, arg);
168         }
169     },
170 
171     ADD_READS(&quot;--add-reads&quot;, EXTENDED, true) {
172         @Override
173         public void process(Helper helper, String arg) throws InvalidValueException {
174             Option.ADD_READS.process(helper.getOptionHelper(), primaryName, arg);
175         }
176     },
177 
178     ADD_EXPORTS(&quot;--add-exports&quot;, EXTENDED, true) {
179         @Override
180         public void process(Helper helper, String arg) throws InvalidValueException {
181             Option.ADD_EXPORTS.process(helper.getOptionHelper(), primaryName, arg);
182         }
183     },
184 
185     PATCH_MODULE(&quot;--patch-module&quot;, EXTENDED, true) {
186         @Override
187         public void process(Helper helper, String arg) throws InvalidValueException {
188             Option.PATCH_MODULE.process(helper.getOptionHelper(), primaryName, arg);
189         }
190     },
191 
192     ADD_OPENS(&quot;--add-opens&quot;, HIDDEN, true) {
193         @Override
194         public void process(Helper helper, String arg) throws InvalidValueException {
195             Option.ADD_OPENS.process(helper.getOptionHelper(), primaryName, arg);
196         }
197     },
198 
199     ENABLE_PREVIEW(&quot;--enable-preview&quot;, STANDARD) {
200         @Override
201         public void process(Helper helper) throws InvalidValueException {
202             Option.PREVIEW.process(helper.getOptionHelper(), primaryName);
203         }
204     },
205 
206     // ----- doclet options -----
207 
208     DOCLET(&quot;-doclet&quot;, STANDARD, true), // handled in setDocletInvoker
209 
210     DOCLETPATH(&quot;-docletpath&quot;, STANDARD, true), // handled in setDocletInvoker
211 
212     // ----- selection options -----
213 
214     SUBPACKAGES(&quot;-subpackages&quot;, STANDARD, true) {
215         @Override
216         public void process(Helper helper, String arg) {
217             helper.addToList(this, &quot;:&quot;, arg);
218         }
219     },
220 
221     EXCLUDE(&quot;-exclude&quot;, STANDARD, true) {
222         @Override
223         public void process(Helper helper, String arg) {
224             helper.addToList(this, &quot;:&quot;, arg);
225         }
226     },
227 
228     // ----- filtering options -----
229 
230     PACKAGE(&quot;-package&quot;, STANDARD) {
231         @Override
232         public void process(Helper helper) throws OptionException {
233             helper.setSimpleFilter(&quot;package&quot;);
234         }
235     },
236 
237     PRIVATE(&quot;-private&quot;, STANDARD) {
238         @Override
239         public void process(Helper helper) throws OptionException {
240             helper.setSimpleFilter(&quot;private&quot;);
241         }
242     },
243 
244     PROTECTED(&quot;-protected&quot;, STANDARD) {
245         @Override
246         public void process(Helper helper) throws OptionException {
247             helper.setSimpleFilter(&quot;protected&quot;);
248         }
249     },
250 
251     PUBLIC(&quot;-public&quot;, STANDARD) {
252         @Override
253         public void process(Helper helper) throws OptionException {
254             helper.setSimpleFilter(&quot;public&quot;);
255         }
256     },
257 
258     SHOW_MEMBERS(&quot;--show-members&quot;, STANDARD, true) {
259         @Override
260         public void process(Helper helper, String arg) throws OptionException {
261             helper.setFilter(this, arg);
262         }
263     },
264 
265     SHOW_TYPES(&quot;--show-types&quot;, STANDARD, true) {
266         @Override
267         public void process(Helper helper, String arg) throws OptionException {
268             helper.setFilter(this, arg);
269         }
270     },
271 
272     SHOW_PACKAGES(&quot;--show-packages&quot;, STANDARD, true) {
273         @Override
274         public void process(Helper helper, String arg) throws OptionException {
275             helper.setShowPackageAccess(SHOW_PACKAGES, arg);
276         }
277     },
278 
279     SHOW_MODULE_CONTENTS(&quot;--show-module-contents&quot;, STANDARD, true) {
280         @Override
281         public void process(Helper helper, String arg) throws OptionException {
282             helper.setShowModuleContents(SHOW_MODULE_CONTENTS, arg);
283         }
284     },
285 
286     EXPAND_REQUIRES(&quot;--expand-requires&quot;, STANDARD, true) {
287         @Override
288         public void process(Helper helper, String arg) throws OptionException {
289             helper.setExpandRequires(EXPAND_REQUIRES, arg);
290         }
291     },
292 
293     // ----- output control options -----
294 
295     QUIET(&quot;-quiet&quot;, STANDARD) {
296         @Override
297         public void process(Helper helper) {
298             helper.jdtoolOpts.put(QUIET, true);
299         }
300     },
301 
302     VERBOSE(&quot;-verbose&quot;, STANDARD) {
303         @Override
304         public void process(Helper helper) {
305             helper.compOpts.put(&quot;-verbose&quot;, &quot;&quot;);
306         }
307     },
308 
309     XWERROR(&quot;-Xwerror&quot;, HIDDEN) {
310         @Override
311         public void process(Helper helper) {
312             helper.rejectWarnings = true;
313 
314         }
315     },
316 
317     // ----- other options -----
318 
319     BREAKITERATOR(&quot;-breakiterator&quot;, STANDARD) {
320         @Override
321         public void process(Helper helper) {
322             helper.breakiterator = true;
323         }
324     },
325 
326     LOCALE(&quot;-locale&quot;, STANDARD, true) {
327         @Override
328         public void process(Helper helper, String arg) {
329             helper.docLocale = arg;
330         }
331     },
332 
333     XCLASSES(&quot;-Xclasses&quot;, HIDDEN) {
334         @Override
335         public void process(Helper helper) {
336             helper.jdtoolOpts.put(XCLASSES, true);
337         }
338     },
339 
340     DUMPONERROR(&quot;--dump-on-error&quot;, HIDDEN) {
341         @Override
342         public void process(Helper helper) {
343             helper.dumpOnError = true;
344         }
345     },
346 
347     IGNORE_SOURCE_ERRORS(&quot;--ignore-source-errors&quot;, HIDDEN) {
348         @Override
349         public void process(Helper helper) {
350             helper.jdtoolOpts.put(IGNORE_SOURCE_ERRORS, true);
351         }
352     },
353 
354     // ----- help options -----
355 
356     HELP(&quot;--help -help -? -h&quot;, STANDARD) {
357         @Override
358         public void process(Helper helper) throws OptionException {
359             throw new OptionException(OK, helper::usage);
360         }
361     },
362 
363     HELP_EXTRA(&quot;--help-extra -X&quot;, STANDARD) {
364         @Override
365         public void process(Helper helper) throws OptionException {
366            throw new OptionException(OK, helper::Xusage);
367         }
368     },
369 
370     // This option exists only for the purpose of documenting itself.
371     // It&#39;s actually implemented by the launcher.
372     J(&quot;-J&quot;, STANDARD, true) {
373         @Override
374         public void process(Helper helper) {
375             throw new AssertionError(&quot;the -J flag should be caught by the launcher.&quot;);
376         }
377     },
378 
379     VERSION(&quot;--version&quot;, STANDARD) {
380         @Override
381         public void process(Helper helper) throws OptionException {
382             throw new OptionException(OK, helper::version);
383         }
384     },
385 
386     FULLVERSION(&quot;--full-version&quot;, HIDDEN) {
387         @Override
388         public void process(Helper helper) throws OptionException {
389             throw new OptionException(OK, helper::fullVersion);
390         }
391     };
392 
393     public final String primaryName;
394     public final List&lt;String&gt; names;
395     public final OptionKind kind;
396     public final boolean hasArg;
397     public final boolean hasSuffix; // ex: foo:bar or -foo=bar
398 
399     ToolOption(String opt, OptionKind kind) {
400         this(opt, kind, false);
401     }
402 
403     ToolOption(String names, OptionKind kind, boolean hasArg) {
404         this.names = Arrays.asList(names.split(&quot;\\s+&quot;));
405         this.primaryName = this.names.get(0);
406         this.kind = kind;
407         this.hasArg = hasArg;
408         char lastChar = names.charAt(names.length() - 1);
409         this.hasSuffix = lastChar == &#39;:&#39; || lastChar == &#39;=&#39;;
410     }
411 
412     void process(Helper helper, String arg) throws OptionException, Option.InvalidValueException { }
413 
414     void process(Helper helper) throws OptionException, Option.InvalidValueException { }
415 
416     List&lt;String&gt; getNames() {
417         return names;
418     }
419 
420     String getParameters(Messager messager) {
421         return (hasArg || primaryName.endsWith(&quot;:&quot;))
422                 ? messager.getText(getKey(primaryName, &quot;.arg&quot;))
423                 : null;
424     }
425 
426     String getDescription(Messager messager) {
427         return messager.getText(getKey(primaryName, &quot;.desc&quot;));
428     }
429 
430     private String getKey(String optionName, String suffix) {
431         return &quot;main.opt.&quot;
432                 + optionName
433                 .replaceAll(&quot;^-*&quot;, &quot;&quot;)              // remove leading &#39;-&#39;
434                 .replaceAll(&quot;[^A-Za-z0-9]+$&quot;, &quot;&quot;)   // remove trailing non-alphanumeric
435                 .replaceAll(&quot;[^A-Za-z0-9]&quot;, &quot;.&quot;)    // replace internal non-alphanumeric
436                 + suffix;
437     }
438 
439 
440     static ToolOption get(String name) {
441         String oname = name;
442         if (name.startsWith(&quot;--&quot;) &amp;&amp; name.contains(&quot;=&quot;)) {
443             oname = name.substring(0, name.indexOf(&#39;=&#39;));
444         }
445         for (ToolOption o : values()) {
446             for (String n : o.names) {
447                 if (oname.equals(n)) {
448                     return o;
449                 }
450             }
451         }
452         return null;
453     }
454 
455     static abstract class Helper {
456 
457         // File manager options
458         final Map&lt;Option, String&gt; fileManagerOpts = new LinkedHashMap&lt;&gt;();
459 
460         /** javac options, set by various options. */
461         Options compOpts; // = Options.instance(context)
462 
463         /** Javadoc tool options */
464         final Map&lt;ToolOption, Object&gt; jdtoolOpts = new EnumMap&lt;&gt;(ToolOption.class);
465 
466         /** dump stack traces for debugging etc.*/
467         boolean dumpOnError = false;
468 
469         /** Set by -breakiterator. */
470         boolean breakiterator = false;
471 
472         /** Set by -Xwerror. */
473         boolean rejectWarnings = false;
474 
475         /** Set by -prompt. */
476         boolean promptOnError;
477 
478         /** Set by -locale. */
479         String docLocale = &quot;&quot;;
480 
481         Helper() {
482             populateDefaultAccessMap();
483         }
484 
485         abstract void usage();
486         abstract void Xusage();
487 
488         abstract void version();
489         abstract void fullVersion();
490 
491         abstract String getLocalizedMessage(String msg, Object... args);
492 
493         abstract OptionHelper getOptionHelper();
494 
495         @SuppressWarnings(&quot;unchecked&quot;)
496         void addToList(ToolOption opt, String delimiter, String str) {
497             List&lt;String&gt; list = (List&lt;String&gt;) jdtoolOpts.computeIfAbsent(opt, v -&gt; new ArrayList&lt;&gt;());
498             list.addAll(Arrays.asList(str.split(delimiter)));
499             jdtoolOpts.put(opt, list);
500         }
501 
502         void setExpandRequires(ToolOption opt, String arg) throws OptionException {
503             switch (arg) {
504                 case &quot;transitive&quot;:
505                     jdtoolOpts.put(opt, AccessKind.PUBLIC);
506                     break;
507                 case &quot;all&quot;:
508                     jdtoolOpts.put(opt, AccessKind.PRIVATE);
509                     break;
510                 default:
511                     String text = getLocalizedMessage(&quot;main.illegal_option_value&quot;, arg);
512                     throw new IllegalOptionValue(this::usage, text);
513             }
514         }
515 
516         void setShowModuleContents(ToolOption opt, String arg) throws OptionException {
517             switch (arg) {
518                 case &quot;api&quot;:
519                     jdtoolOpts.put(opt, AccessKind.PUBLIC);
520                     break;
521                 case &quot;all&quot;:
522                     jdtoolOpts.put(opt, AccessKind.PRIVATE);
523                     break;
524                 default:
525                     String text = getLocalizedMessage(&quot;main.illegal_option_value&quot;, arg);
526                     throw new IllegalOptionValue(this::usage, text);
527             }
528         }
529 
530         void setShowPackageAccess(ToolOption opt, String arg) throws OptionException {
531             switch (arg) {
532                 case &quot;exported&quot;:
533                     jdtoolOpts.put(opt, AccessKind.PUBLIC);
534                     break;
535                 case &quot;all&quot;:
536                     jdtoolOpts.put(opt, AccessKind.PRIVATE);
537                     break;
538                 default:
539                     String text = getLocalizedMessage(&quot;main.illegal_option_value&quot;, arg);
540                     throw new IllegalOptionValue(this::usage, text);
541             }
542         }
543 
544 
545         void setFilter(ToolOption opt, String arg) throws OptionException {
546             jdtoolOpts.put(opt, getAccessValue(arg));
547         }
548 
549         void setSimpleFilter(String arg) throws OptionException {
550             handleSimpleOption(arg);
551         }
552 
553         void setFileManagerOpt(Option opt, String arg) {
554             fileManagerOpts.put(opt, arg);
555         }
556 
557         void handleSimpleOption(String arg) throws OptionException {
558             populateSimpleAccessMap(getAccessValue(arg));
559         }
560 
561         /*
562          * This method handles both the simple options -package,
563          * -private, so on, in addition to the new ones such as
564          * --show-types:public and so on.
565          */
566         private AccessKind getAccessValue(String arg) throws OptionException {
567             int colon = arg.indexOf(&#39;:&#39;);
568             String value = (colon &gt; 0)
569                     ? arg.substring(colon + 1)
570                     : arg;
571             switch (value) {
572                 case &quot;public&quot;:
573                     return AccessKind.PUBLIC;
574                 case &quot;protected&quot;:
575                     return AccessKind.PROTECTED;
576                 case &quot;package&quot;:
577                     return AccessKind.PACKAGE;
578                 case &quot;private&quot;:
579                     return AccessKind.PRIVATE;
580                 default:
581                     String text = getLocalizedMessage(&quot;main.illegal_option_value&quot;, value);
582                     throw new IllegalOptionValue(this::usage, text);
583             }
584         }
585 
586         /*
587          * Sets the entire kind map to PROTECTED this is the default.
588          */
589         private void populateDefaultAccessMap() {
590             populateSimpleAccessMap(AccessKind.PROTECTED);
591         }
592 
593         /*
594          * This sets access to all the allowed kinds in the
595          * access map.
596          */
597         void populateSimpleAccessMap(AccessKind accessValue) {
598             for (ElementKind kind : ElementsTable.ModifierFilter.ALLOWED_KINDS) {
599                 switch (kind) {
600                     case METHOD:
601                         jdtoolOpts.put(SHOW_MEMBERS, accessValue);
602                         break;
603                     case CLASS:
604                         jdtoolOpts.put(SHOW_TYPES, accessValue);
605                         break;
606                     case PACKAGE:
607                         jdtoolOpts.put(SHOW_PACKAGES, accessValue);
608                         break;
609                     case MODULE:
610                         jdtoolOpts.put(SHOW_MODULE_CONTENTS, accessValue);
611                         break;
612                     default:
613                         throw new AssertionError(&quot;unknown element kind:&quot; + kind);
614                 }
615             }
616         }
617     }
618 }
    </pre>
  </body>
</html>