<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/TagletWriterImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SubWriterHolderWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TreeWriter.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/TagletWriterImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 26,17 ***</span>
  package jdk.javadoc.internal.doclets.formats.html;
  
  import java.util.List;
  
  import javax.lang.model.element.Element;
  import javax.lang.model.element.TypeElement;
  import javax.lang.model.element.VariableElement;
  import javax.lang.model.type.TypeMirror;
<span class="line-modified">! import javax.lang.model.util.SimpleElementVisitor9;</span>
  
  import com.sun.source.doctree.DocTree;
  import com.sun.source.doctree.IndexTree;
  import com.sun.source.doctree.SystemPropertyTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.RawHtml;
<span class="line-new-header">--- 26,22 ---</span>
  package jdk.javadoc.internal.doclets.formats.html;
  
  import java.util.List;
  
  import javax.lang.model.element.Element;
<span class="line-added">+ import javax.lang.model.element.ElementKind;</span>
<span class="line-added">+ import javax.lang.model.element.ExecutableElement;</span>
<span class="line-added">+ import javax.lang.model.element.ModuleElement;</span>
<span class="line-added">+ import javax.lang.model.element.PackageElement;</span>
  import javax.lang.model.element.TypeElement;
  import javax.lang.model.element.VariableElement;
  import javax.lang.model.type.TypeMirror;
<span class="line-modified">! import javax.lang.model.util.SimpleElementVisitor14;</span>
  
  import com.sun.source.doctree.DocTree;
  import com.sun.source.doctree.IndexTree;
<span class="line-added">+ import com.sun.source.doctree.ParamTree;</span>
  import com.sun.source.doctree.SystemPropertyTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
  import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
  import jdk.javadoc.internal.doclets.formats.html.markup.RawHtml;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 59,19 ***</span>
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
<span class="line-removed">-  *</span>
<span class="line-removed">-  * @author Jamie Ho</span>
<span class="line-removed">-  * @author Bhavesh Patel (Modified)</span>
   */
  
  public class TagletWriterImpl extends TagletWriter {
  
      private final HtmlDocletWriter htmlWriter;
      private final HtmlConfiguration configuration;
      private final Utils utils;
      private final boolean inSummary;
      private final Resources resources;
  
      public TagletWriterImpl(HtmlDocletWriter htmlWriter, boolean isFirstSentence) {
<span class="line-new-header">--- 64,17 ---</span>
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
   */
  
  public class TagletWriterImpl extends TagletWriter {
  
      private final HtmlDocletWriter htmlWriter;
      private final HtmlConfiguration configuration;
<span class="line-added">+     private final HtmlOptions options;</span>
      private final Utils utils;
      private final boolean inSummary;
      private final Resources resources;
  
      public TagletWriterImpl(HtmlDocletWriter htmlWriter, boolean isFirstSentence) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 79,82 ***</span>
      }
  
      public TagletWriterImpl(HtmlDocletWriter htmlWriter, boolean isFirstSentence, boolean inSummary) {
          super(isFirstSentence);
          this.htmlWriter = htmlWriter;
<span class="line-removed">-         configuration = htmlWriter.configuration;</span>
<span class="line-removed">-         this.utils = configuration.utils;</span>
          this.inSummary = inSummary;
<span class="line-modified">!         resources = configuration.getResources();</span>
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content getOutputInstance() {
          return new ContentBuilder();
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      protected Content codeTagOutput(Element element, DocTree tag) {
          CommentHelper ch = utils.getCommentHelper(element);
          StringContent content = new StringContent(utils.normalizeNewlines(ch.getText(tag)));
          Content result = HtmlTree.CODE(content);
          return result;
      }
  
      protected Content indexTagOutput(Element element, DocTree tag) {
          CommentHelper ch = utils.getCommentHelper(element);
          IndexTree itt = (IndexTree)tag;
  
<span class="line-modified">!         String tagText =  ch.getText(itt.getSearchTerm());</span>
          if (tagText.charAt(0) == &#39;&quot;&#39; &amp;&amp; tagText.charAt(tagText.length() - 1) == &#39;&quot;&#39;) {
<span class="line-modified">!             tagText = tagText.substring(1, tagText.length() - 1);</span>
          }
          String desc = ch.getText(itt.getDescription());
  
<span class="line-modified">!         return createAnchorAndSearchIndex(element, tagText,desc);</span>
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content getDocRootOutput() {
          String path;
          if (htmlWriter.pathToRoot.isEmpty())
              path = &quot;.&quot;;
          else
              path = htmlWriter.pathToRoot.getPath();
          return new StringContent(path);
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content deprecatedTagOutput(Element element) {
          ContentBuilder result = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
          List&lt;? extends DocTree&gt; deprs = utils.getBlockTags(element, DocTree.Kind.DEPRECATED);
          if (utils.isTypeElement(element)) {
              if (utils.isDeprecated(element)) {
                  result.add(HtmlTree.SPAN(HtmlStyle.deprecatedLabel,
                          htmlWriter.getDeprecatedPhrase(element)));
                  if (!deprs.isEmpty()) {
<span class="line-modified">!                     List&lt;? extends DocTree&gt; commentTags = ch.getDescription(configuration, deprs.get(0));</span>
                      if (!commentTags.isEmpty()) {
                          result.add(commentTagsToOutput(null, element, commentTags, false));
                      }
                  }
              }
          } else {
              if (utils.isDeprecated(element)) {
                  result.add(HtmlTree.SPAN(HtmlStyle.deprecatedLabel,
                          htmlWriter.getDeprecatedPhrase(element)));
                  if (!deprs.isEmpty()) {
<span class="line-modified">!                     List&lt;? extends DocTree&gt; bodyTags = ch.getBody(configuration, deprs.get(0));</span>
                      Content body = commentTagsToOutput(null, element, bodyTags, false);
                      if (!body.isEmpty())
                          result.add(HtmlTree.DIV(HtmlStyle.deprecationComment, body));
                  }
              } else {
<span class="line-new-header">--- 82,77 ---</span>
      }
  
      public TagletWriterImpl(HtmlDocletWriter htmlWriter, boolean isFirstSentence, boolean inSummary) {
          super(isFirstSentence);
          this.htmlWriter = htmlWriter;
          this.inSummary = inSummary;
<span class="line-modified">!         configuration = htmlWriter.configuration;</span>
<span class="line-added">+         options = configuration.getOptions();</span>
<span class="line-added">+         utils = configuration.utils;</span>
<span class="line-added">+         resources = configuration.getDocResources();</span>
      }
  
<span class="line-modified">!     @Override</span>
      public Content getOutputInstance() {
          return new ContentBuilder();
      }
  
<span class="line-modified">!     @Override</span>
      protected Content codeTagOutput(Element element, DocTree tag) {
          CommentHelper ch = utils.getCommentHelper(element);
          StringContent content = new StringContent(utils.normalizeNewlines(ch.getText(tag)));
          Content result = HtmlTree.CODE(content);
          return result;
      }
  
<span class="line-added">+     @Override</span>
      protected Content indexTagOutput(Element element, DocTree tag) {
          CommentHelper ch = utils.getCommentHelper(element);
          IndexTree itt = (IndexTree)tag;
  
<span class="line-modified">!         String tagText = ch.getText(itt.getSearchTerm());</span>
          if (tagText.charAt(0) == &#39;&quot;&#39; &amp;&amp; tagText.charAt(tagText.length() - 1) == &#39;&quot;&#39;) {
<span class="line-modified">!             tagText = tagText.substring(1, tagText.length() - 1)</span>
<span class="line-added">+                              .replaceAll(&quot;\\s+&quot;, &quot; &quot;);</span>
          }
          String desc = ch.getText(itt.getDescription());
  
<span class="line-modified">!         return createAnchorAndSearchIndex(element, tagText, desc, false);</span>
      }
  
<span class="line-modified">!     @Override</span>
      public Content getDocRootOutput() {
          String path;
          if (htmlWriter.pathToRoot.isEmpty())
              path = &quot;.&quot;;
          else
              path = htmlWriter.pathToRoot.getPath();
          return new StringContent(path);
      }
  
<span class="line-modified">!     @Override</span>
      public Content deprecatedTagOutput(Element element) {
          ContentBuilder result = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
          List&lt;? extends DocTree&gt; deprs = utils.getBlockTags(element, DocTree.Kind.DEPRECATED);
          if (utils.isTypeElement(element)) {
              if (utils.isDeprecated(element)) {
                  result.add(HtmlTree.SPAN(HtmlStyle.deprecatedLabel,
                          htmlWriter.getDeprecatedPhrase(element)));
                  if (!deprs.isEmpty()) {
<span class="line-modified">!                     List&lt;? extends DocTree&gt; commentTags = ch.getDescription(deprs.get(0));</span>
                      if (!commentTags.isEmpty()) {
                          result.add(commentTagsToOutput(null, element, commentTags, false));
                      }
                  }
              }
          } else {
              if (utils.isDeprecated(element)) {
                  result.add(HtmlTree.SPAN(HtmlStyle.deprecatedLabel,
                          htmlWriter.getDeprecatedPhrase(element)));
                  if (!deprs.isEmpty()) {
<span class="line-modified">!                     List&lt;? extends DocTree&gt; bodyTags = ch.getBody(deprs.get(0));</span>
                      Content body = commentTagsToOutput(null, element, bodyTags, false);
                      if (!body.isEmpty())
                          result.add(HtmlTree.DIV(HtmlStyle.deprecationComment, body));
                  }
              } else {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 166,45 ***</span>
              }
          }
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      protected Content literalTagOutput(Element element, DocTree tag) {
          CommentHelper ch = utils.getCommentHelper(element);
          Content result = new StringContent(utils.normalizeNewlines(ch.getText(tag)));
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content getParamHeader(String header) {
          HtmlTree result = HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.paramLabel,
                  new StringContent(header)));
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-modified">!      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content paramTagOutput(Element element, DocTree paramTag, String paramName) {
          ContentBuilder body = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
<span class="line-modified">!         body.add(HtmlTree.CODE(new RawHtml(paramName)));</span>
          body.add(&quot; - &quot;);
<span class="line-modified">!         List&lt;? extends DocTree&gt; description = ch.getDescription(configuration, paramTag);</span>
          body.add(htmlWriter.commentTagsToContent(paramTag, element, description, false, inSummary));
<span class="line-modified">!         HtmlTree result = HtmlTree.DD(body);</span>
<span class="line-removed">-         return result;</span>
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content propertyTagOutput(Element element, DocTree tag, String prefix) {
          Content body = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
          body.add(new RawHtml(prefix));
          body.add(&quot; &quot;);
<span class="line-new-header">--- 164,41 ---</span>
              }
          }
          return result;
      }
  
<span class="line-modified">!     @Override</span>
      protected Content literalTagOutput(Element element, DocTree tag) {
          CommentHelper ch = utils.getCommentHelper(element);
          Content result = new StringContent(utils.normalizeNewlines(ch.getText(tag)));
          return result;
      }
  
<span class="line-modified">!     @Override</span>
      public Content getParamHeader(String header) {
          HtmlTree result = HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.paramLabel,
                  new StringContent(header)));
          return result;
      }
  
<span class="line-modified">!     @Override</span>
<span class="line-modified">!     @SuppressWarnings(&quot;preview&quot;)</span>
      public Content paramTagOutput(Element element, DocTree paramTag, String paramName) {
          ContentBuilder body = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
<span class="line-modified">!         // define id attributes for state components so that generated descriptions may refer to them</span>
<span class="line-added">+         boolean defineID = (element.getKind() == ElementKind.RECORD)</span>
<span class="line-added">+                 &amp;&amp; (paramTag instanceof ParamTree) &amp;&amp; !((ParamTree) paramTag).isTypeParameter();</span>
<span class="line-added">+         Content nameTree = new StringContent(paramName);</span>
<span class="line-added">+         body.add(HtmlTree.CODE(defineID ? HtmlTree.SPAN_ID(&quot;param-&quot; + paramName, nameTree) : nameTree));</span>
          body.add(&quot; - &quot;);
<span class="line-modified">!         List&lt;? extends DocTree&gt; description = ch.getDescription(paramTag);</span>
          body.add(htmlWriter.commentTagsToContent(paramTag, element, description, false, inSummary));
<span class="line-modified">!         return HtmlTree.DD(body);</span>
      }
  
<span class="line-modified">!     @Override</span>
      public Content propertyTagOutput(Element element, DocTree tag, String prefix) {
          Content body = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
          body.add(new RawHtml(prefix));
          body.add(&quot; &quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 212,26 ***</span>
          body.add(&quot;.&quot;);
          Content result = HtmlTree.P(body);
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content returnTagOutput(Element element, DocTree returnTag) {
          ContentBuilder result = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
          result.add(HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.returnLabel,
                  new StringContent(resources.getText(&quot;doclet.Returns&quot;)))));
          result.add(HtmlTree.DD(htmlWriter.commentTagsToContent(
<span class="line-modified">!                 returnTag, element, ch.getDescription(configuration, returnTag), false, inSummary)));</span>
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content seeTagOutput(Element holder, List&lt;? extends DocTree&gt; seeTags) {
          ContentBuilder body = new ContentBuilder();
          for (DocTree dt : seeTags) {
              appendSeparatorIfNotEmpty(body);
              body.add(htmlWriter.seeTagToContent(holder, dt));
<span class="line-new-header">--- 206,22 ---</span>
          body.add(&quot;.&quot;);
          Content result = HtmlTree.P(body);
          return result;
      }
  
<span class="line-modified">!     @Override</span>
      public Content returnTagOutput(Element element, DocTree returnTag) {
          ContentBuilder result = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
          result.add(HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.returnLabel,
                  new StringContent(resources.getText(&quot;doclet.Returns&quot;)))));
          result.add(HtmlTree.DD(htmlWriter.commentTagsToContent(
<span class="line-modified">!                 returnTag, element, ch.getDescription(returnTag), false, inSummary)));</span>
          return result;
      }
  
<span class="line-modified">!     @Override</span>
      public Content seeTagOutput(Element holder, List&lt;? extends DocTree&gt; seeTags) {
          ContentBuilder body = new ContentBuilder();
          for (DocTree dt : seeTags) {
              appendSeparatorIfNotEmpty(body);
              body.add(htmlWriter.seeTagToContent(holder, dt));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 276,158 ***</span>
              body.add(&quot;, &quot;);
              body.add(DocletConstants.NL);
          }
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content simpleTagOutput(Element element, List&lt;? extends DocTree&gt; simpleTags, String header) {
          CommentHelper ch = utils.getCommentHelper(element);
          ContentBuilder result = new ContentBuilder();
          result.add(HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.simpleTagLabel, new RawHtml(header))));
          ContentBuilder body = new ContentBuilder();
          boolean many = false;
          for (DocTree simpleTag : simpleTags) {
              if (many) {
                  body.add(&quot;, &quot;);
              }
<span class="line-modified">!             List&lt;? extends DocTree&gt; bodyTags = ch.getBody(configuration, simpleTag);</span>
              body.add(htmlWriter.commentTagsToContent(simpleTag, element, bodyTags, false, inSummary));
              many = true;
          }
          result.add(HtmlTree.DD(body));
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content simpleTagOutput(Element element, DocTree simpleTag, String header) {
          ContentBuilder result = new ContentBuilder();
          result.add(HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.simpleTagLabel, new RawHtml(header))));
          CommentHelper ch = utils.getCommentHelper(element);
<span class="line-modified">!         List&lt;? extends DocTree&gt; description = ch.getDescription(configuration, simpleTag);</span>
          Content body = htmlWriter.commentTagsToContent(simpleTag, element, description, false, inSummary);
          result.add(HtmlTree.DD(body));
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      protected Content systemPropertyTagOutput(Element element, DocTree tag) {
<span class="line-modified">!         SystemPropertyTree itt = (SystemPropertyTree)tag;</span>
          String tagText = itt.getPropertyName().toString();
          return HtmlTree.CODE(createAnchorAndSearchIndex(element, tagText,
<span class="line-modified">!                 resources.getText(&quot;doclet.System_Property&quot;)));</span>
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content getThrowsHeader() {
          HtmlTree result = HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.throwsLabel,
                  new StringContent(resources.getText(&quot;doclet.Throws&quot;))));
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-modified">!      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public Content throwsTagOutput(Element element, DocTree throwsTag) {</span>
          ContentBuilder body = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
<span class="line-modified">!         Element exception = ch.getException(configuration, throwsTag);</span>
          Content excName;
<span class="line-modified">!         if (exception == null) {</span>
              excName = new RawHtml(ch.getExceptionName(throwsTag).toString());
          } else if (exception.asType() == null) {
              excName = new RawHtml(utils.getFullyQualifiedName(exception));
          } else {
              LinkInfoImpl link = new LinkInfoImpl(configuration, LinkInfoImpl.Kind.MEMBER,
                                                   exception.asType());
              link.excludeTypeBounds = true;
              excName = htmlWriter.getLink(link);
          }
          body.add(HtmlTree.CODE(excName));
<span class="line-modified">!         List&lt;? extends DocTree&gt; description = ch.getDescription(configuration, throwsTag);</span>
          Content desc = htmlWriter.commentTagsToContent(throwsTag, element, description, false, inSummary);
          if (desc != null &amp;&amp; !desc.isEmpty()) {
              body.add(&quot; - &quot;);
              body.add(desc);
          }
          HtmlTree result = HtmlTree.DD(body);
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content throwsTagOutput(TypeMirror throwsType) {
          HtmlTree result = HtmlTree.DD(HtmlTree.CODE(htmlWriter.getLink(
                  new LinkInfoImpl(configuration, LinkInfoImpl.Kind.MEMBER, throwsType))));
          return result;
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content valueTagOutput(VariableElement field, String constantVal, boolean includeLink) {
          return includeLink
                  ? htmlWriter.getDocLink(LinkInfoImpl.Kind.VALUE_TAG, field, constantVal, false)
                  : new StringContent(constantVal);
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content commentTagsToOutput(DocTree holderTag, List&lt;? extends DocTree&gt; tags) {
          return commentTagsToOutput(holderTag, null, tags, false);
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content commentTagsToOutput(Element holder, List&lt;? extends DocTree&gt; tags) {
          return commentTagsToOutput(null, holder, tags, false);
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public Content commentTagsToOutput(DocTree holderTag,
<span class="line-modified">!         Element holder, List&lt;? extends DocTree&gt; tags, boolean isFirstSentence) {</span>
          return htmlWriter.commentTagsToContent(holderTag, holder,
                  tags, isFirstSentence, inSummary);
      }
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      public BaseConfiguration configuration() {
          return configuration;
      }
  
<span class="line-modified">!     private Content createAnchorAndSearchIndex(Element element, String tagText, String desc){</span>
<span class="line-modified">!         String anchorName = htmlWriter.links.getName(tagText);</span>
          Content result = null;
          if (isFirstSentence &amp;&amp; inSummary) {
              result = new StringContent(tagText);
          } else {
<span class="line-modified">!             result = HtmlTree.A_ID(HtmlStyle.searchTagResult, anchorName, new StringContent(tagText));</span>
<span class="line-modified">!             if (configuration.createindex &amp;&amp; !tagText.isEmpty()) {</span>
                  SearchIndexItem si = new SearchIndexItem();
                  si.setLabel(tagText);
                  si.setDescription(desc);
                  si.setUrl(htmlWriter.path.getPath() + &quot;#&quot; + anchorName);
<span class="line-modified">!                 DocPaths docPaths = configuration.docPaths;</span>
<span class="line-modified">!                 new SimpleElementVisitor9&lt;Void, Void&gt;() {</span>
                      @Override
                      public Void visitVariable(VariableElement e, Void p) {
                          TypeElement te = utils.getEnclosingTypeElement(e);
<span class="line-modified">!                         si.setHolder(utils.getFullyQualifiedName(e) + &quot;.&quot; + utils.getSimpleName(e));</span>
                          return null;
                      }
  
                      @Override
                      public Void visitUnknown(Element e, Void p) {
<span class="line-new-header">--- 266,182 ---</span>
              body.add(&quot;, &quot;);
              body.add(DocletConstants.NL);
          }
      }
  
<span class="line-modified">!     @Override</span>
      public Content simpleTagOutput(Element element, List&lt;? extends DocTree&gt; simpleTags, String header) {
          CommentHelper ch = utils.getCommentHelper(element);
          ContentBuilder result = new ContentBuilder();
          result.add(HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.simpleTagLabel, new RawHtml(header))));
          ContentBuilder body = new ContentBuilder();
          boolean many = false;
          for (DocTree simpleTag : simpleTags) {
              if (many) {
                  body.add(&quot;, &quot;);
              }
<span class="line-modified">!             List&lt;? extends DocTree&gt; bodyTags = ch.getBody(simpleTag);</span>
              body.add(htmlWriter.commentTagsToContent(simpleTag, element, bodyTags, false, inSummary));
              many = true;
          }
          result.add(HtmlTree.DD(body));
          return result;
      }
  
<span class="line-modified">!     @Override</span>
      public Content simpleTagOutput(Element element, DocTree simpleTag, String header) {
          ContentBuilder result = new ContentBuilder();
          result.add(HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.simpleTagLabel, new RawHtml(header))));
          CommentHelper ch = utils.getCommentHelper(element);
<span class="line-modified">!         List&lt;? extends DocTree&gt; description = ch.getDescription(simpleTag);</span>
          Content body = htmlWriter.commentTagsToContent(simpleTag, element, description, false, inSummary);
          result.add(HtmlTree.DD(body));
          return result;
      }
  
<span class="line-modified">!     @Override</span>
      protected Content systemPropertyTagOutput(Element element, DocTree tag) {
<span class="line-modified">!         SystemPropertyTree itt = (SystemPropertyTree) tag;</span>
          String tagText = itt.getPropertyName().toString();
          return HtmlTree.CODE(createAnchorAndSearchIndex(element, tagText,
<span class="line-modified">!                 resources.getText(&quot;doclet.System_Property&quot;), true));</span>
      }
  
<span class="line-modified">!     @Override</span>
      public Content getThrowsHeader() {
          HtmlTree result = HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.throwsLabel,
                  new StringContent(resources.getText(&quot;doclet.Throws&quot;))));
          return result;
      }
  
<span class="line-modified">!     @Override</span>
<span class="line-modified">!     public Content throwsTagOutput(Element element, DocTree throwsTag, TypeMirror substituteType) {</span>
          ContentBuilder body = new ContentBuilder();
          CommentHelper ch = utils.getCommentHelper(element);
<span class="line-modified">!         Element exception = ch.getException(throwsTag);</span>
          Content excName;
<span class="line-modified">!         if (substituteType != null) {</span>
<span class="line-added">+            excName = htmlWriter.getLink(new LinkInfoImpl(configuration, LinkInfoImpl.Kind.MEMBER,</span>
<span class="line-added">+                    substituteType));</span>
<span class="line-added">+         } else if (exception == null) {</span>
              excName = new RawHtml(ch.getExceptionName(throwsTag).toString());
          } else if (exception.asType() == null) {
              excName = new RawHtml(utils.getFullyQualifiedName(exception));
          } else {
              LinkInfoImpl link = new LinkInfoImpl(configuration, LinkInfoImpl.Kind.MEMBER,
                                                   exception.asType());
              link.excludeTypeBounds = true;
              excName = htmlWriter.getLink(link);
          }
          body.add(HtmlTree.CODE(excName));
<span class="line-modified">!         List&lt;? extends DocTree&gt; description = ch.getDescription(throwsTag);</span>
          Content desc = htmlWriter.commentTagsToContent(throwsTag, element, description, false, inSummary);
          if (desc != null &amp;&amp; !desc.isEmpty()) {
              body.add(&quot; - &quot;);
              body.add(desc);
          }
          HtmlTree result = HtmlTree.DD(body);
          return result;
      }
  
<span class="line-modified">!     @Override</span>
      public Content throwsTagOutput(TypeMirror throwsType) {
          HtmlTree result = HtmlTree.DD(HtmlTree.CODE(htmlWriter.getLink(
                  new LinkInfoImpl(configuration, LinkInfoImpl.Kind.MEMBER, throwsType))));
          return result;
      }
  
<span class="line-modified">!     @Override</span>
      public Content valueTagOutput(VariableElement field, String constantVal, boolean includeLink) {
          return includeLink
                  ? htmlWriter.getDocLink(LinkInfoImpl.Kind.VALUE_TAG, field, constantVal, false)
                  : new StringContent(constantVal);
      }
  
<span class="line-modified">!     @Override</span>
      public Content commentTagsToOutput(DocTree holderTag, List&lt;? extends DocTree&gt; tags) {
          return commentTagsToOutput(holderTag, null, tags, false);
      }
  
<span class="line-modified">!     @Override</span>
      public Content commentTagsToOutput(Element holder, List&lt;? extends DocTree&gt; tags) {
          return commentTagsToOutput(null, holder, tags, false);
      }
  
<span class="line-modified">!     @Override</span>
      public Content commentTagsToOutput(DocTree holderTag,
<span class="line-modified">!                                        Element holder,</span>
<span class="line-added">+                                        List&lt;? extends DocTree&gt; tags,</span>
<span class="line-added">+                                        boolean isFirstSentence)</span>
<span class="line-added">+     {</span>
          return htmlWriter.commentTagsToContent(holderTag, holder,
                  tags, isFirstSentence, inSummary);
      }
  
<span class="line-modified">!     @Override</span>
      public BaseConfiguration configuration() {
          return configuration;
      }
  
<span class="line-modified">!     @Override</span>
<span class="line-modified">!     protected TypeElement getCurrentPageElement() {</span>
<span class="line-added">+         return htmlWriter.getCurrentPageElement();</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     @SuppressWarnings(&quot;preview&quot;)</span>
<span class="line-added">+     private Content createAnchorAndSearchIndex(Element element, String tagText, String desc, boolean isSystemProperty) {</span>
          Content result = null;
          if (isFirstSentence &amp;&amp; inSummary) {
              result = new StringContent(tagText);
          } else {
<span class="line-modified">!             String anchorName = htmlWriter.links.getName(tagText);</span>
<span class="line-modified">!             int count = htmlWriter.indexAnchorTable</span>
<span class="line-added">+                     .compute(anchorName, (k, v) -&gt; v == null ? 0 : v + 1);</span>
<span class="line-added">+             if (count &gt; 0) {</span>
<span class="line-added">+                 anchorName += &quot;-&quot; + count;</span>
<span class="line-added">+             }</span>
<span class="line-added">+             result = HtmlTree.SPAN(anchorName, HtmlStyle.searchTagResult, new StringContent(tagText));</span>
<span class="line-added">+             if (options.createIndex() &amp;&amp; !tagText.isEmpty()) {</span>
                  SearchIndexItem si = new SearchIndexItem();
<span class="line-added">+                 si.setSystemProperty(isSystemProperty);</span>
                  si.setLabel(tagText);
                  si.setDescription(desc);
                  si.setUrl(htmlWriter.path.getPath() + &quot;#&quot; + anchorName);
<span class="line-modified">!                 new SimpleElementVisitor14&lt;Void, Void&gt;() {</span>
<span class="line-modified">! </span>
<span class="line-added">+                     @Override</span>
<span class="line-added">+                     public Void visitModule(ModuleElement e, Void p) {</span>
<span class="line-added">+                         si.setHolder(resources.getText(&quot;doclet.module&quot;)</span>
<span class="line-added">+                                              + &quot; &quot; + utils.getFullyQualifiedName(e));</span>
<span class="line-added">+                         return null;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+ </span>
<span class="line-added">+                     @Override</span>
<span class="line-added">+                     public Void visitPackage(PackageElement e, Void p) {</span>
<span class="line-added">+                         si.setHolder(resources.getText(&quot;doclet.package&quot;)</span>
<span class="line-added">+                                              + &quot; &quot; + utils.getFullyQualifiedName(e));</span>
<span class="line-added">+                         return null;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+ </span>
<span class="line-added">+                     @Override</span>
<span class="line-added">+                     public Void visitType(TypeElement e, Void p) {</span>
<span class="line-added">+                         si.setHolder(utils.getTypeElementName(e, true)</span>
<span class="line-added">+                                              + &quot; &quot; + utils.getFullyQualifiedName(e));</span>
<span class="line-added">+                         return null;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+ </span>
<span class="line-added">+                     @Override</span>
<span class="line-added">+                     public Void visitExecutable(ExecutableElement e, Void p) {</span>
<span class="line-added">+                         si.setHolder(utils.getFullyQualifiedName(utils.getEnclosingTypeElement(e))</span>
<span class="line-added">+                                              + &quot;.&quot; + utils.getSimpleName(e) + utils.flatSignature(e));</span>
<span class="line-added">+                         return null;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+ </span>
                      @Override
                      public Void visitVariable(VariableElement e, Void p) {
                          TypeElement te = utils.getEnclosingTypeElement(e);
<span class="line-modified">!                         si.setHolder(utils.getFullyQualifiedName(te) + &quot;.&quot; + utils.getSimpleName(e));</span>
                          return null;
                      }
  
                      @Override
                      public Void visitUnknown(Element e, Void p) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 436,11 ***</span>
                              switch (de.getSubKind()) {
                                  case OVERVIEW:
                                      si.setHolder(resources.getText(&quot;doclet.Overview&quot;));
                                      break;
                                  case DOCFILE:
<span class="line-modified">!                                     si.setHolder(de.getPackageElement().toString());</span>
                                      break;
                                  default:
                                      throw new IllegalStateException();
                              }
                              return null;
<span class="line-new-header">--- 450,11 ---</span>
                              switch (de.getSubKind()) {
                                  case OVERVIEW:
                                      si.setHolder(resources.getText(&quot;doclet.Overview&quot;));
                                      break;
                                  case DOCFILE:
<span class="line-modified">!                                     si.setHolder(getHolderName(de));</span>
                                      break;
                                  default:
                                      throw new IllegalStateException();
                              }
                              return null;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 459,6 ***</span>
<span class="line-new-header">--- 473,19 ---</span>
                  configuration.tagSearchIndex.add(si);
              }
          }
          return result;
      }
<span class="line-added">+ </span>
<span class="line-added">+     private String getHolderName(DocletElement de) {</span>
<span class="line-added">+         PackageElement pe = de.getPackageElement();</span>
<span class="line-added">+         if (pe.isUnnamed()) {</span>
<span class="line-added">+             // if package is unnamed use enclosing module only if it is named</span>
<span class="line-added">+             Element ee = pe.getEnclosingElement();</span>
<span class="line-added">+             if (ee instanceof ModuleElement &amp;&amp; !((ModuleElement)ee).isUnnamed()) {</span>
<span class="line-added">+                 return resources.getText(&quot;doclet.module&quot;) + &quot; &quot; + utils.getFullyQualifiedName(ee);</span>
<span class="line-added">+             }</span>
<span class="line-added">+             return pe.toString(); // &quot;Unnamed package&quot; or similar</span>
<span class="line-added">+         }</span>
<span class="line-added">+         return resources.getText(&quot;doclet.package&quot;) + &quot; &quot; + utils.getFullyQualifiedName(pe);</span>
<span class="line-added">+     }</span>
  }
</pre>
<center><a href="SubWriterHolderWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="TreeWriter.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>