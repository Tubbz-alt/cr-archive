<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractMemberWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.formats.html;
 27 
 28 import jdk.javadoc.internal.doclets.formats.html.markup.Table;
 29 import jdk.javadoc.internal.doclets.formats.html.markup.TableHeader;
 30 
 31 import java.util.*;
 32 import java.util.stream.Collectors;
 33 
 34 import javax.lang.model.element.Element;
 35 import javax.lang.model.element.ExecutableElement;
 36 import javax.lang.model.element.Modifier;
 37 import javax.lang.model.element.TypeElement;
 38 import javax.lang.model.element.TypeParameterElement;
 39 import javax.lang.model.type.TypeMirror;
 40 
 41 import com.sun.source.doctree.DocTree;
 42 import jdk.javadoc.internal.doclets.formats.html.markup.ContentBuilder;
 43 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
 44 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
 45 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
 46 import jdk.javadoc.internal.doclets.formats.html.markup.Links;
 47 import jdk.javadoc.internal.doclets.toolkit.Content;
 48 import jdk.javadoc.internal.doclets.toolkit.MemberSummaryWriter;
 49 import jdk.javadoc.internal.doclets.toolkit.Resources;
 50 import jdk.javadoc.internal.doclets.toolkit.taglets.DeprecatedTaglet;
 51 import jdk.javadoc.internal.doclets.toolkit.util.Utils;
 52 
 53 import static javax.lang.model.element.Modifier.*;
 54 
 55 /**
 56  * The base class for member writers.
 57  *
 58  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 59  *  If you write code that depends on this, you do so at your own risk.
 60  *  This code and its internal interfaces are subject to change or
 61  *  deletion without notice.&lt;/b&gt;
 62  *
 63  * @author Robert Field
 64  * @author Atul M Dambalkar
 65  * @author Jamie Ho (Re-write)
 66  * @author Bhavesh Patel (Modified)
 67  */
 68 public abstract class AbstractMemberWriter implements MemberSummaryWriter {
 69 
 70     protected final HtmlConfiguration configuration;
 71     protected final Utils utils;
 72     protected final SubWriterHolderWriter writer;
 73     protected final Contents contents;
 74     protected final Resources resources;
 75     protected final Links links;
 76 
 77     protected final TypeElement typeElement;
 78     public final boolean nodepr;
 79 
 80     protected boolean printedSummaryHeader = false;
 81 
 82     public AbstractMemberWriter(SubWriterHolderWriter writer, TypeElement typeElement) {
 83         this.configuration = writer.configuration;
 84         this.writer = writer;
 85         this.nodepr = configuration.nodeprecated;
 86         this.typeElement = typeElement;
 87         this.utils = configuration.utils;
 88         this.contents = configuration.contents;
 89         this.resources = configuration.resources;
 90         this.links = writer.links;
 91     }
 92 
 93     public AbstractMemberWriter(SubWriterHolderWriter writer) {
 94         this(writer, null);
 95     }
 96 
 97     /*** abstracts ***/
 98 
 99     /**
100      * Add the summary label for the member.
101      *
102      * @param memberTree the content tree to which the label will be added
103      */
104     public abstract void addSummaryLabel(Content memberTree);
105 
106     /**
107      * Get the summary for the member summary table.
108      *
109      * @return a string for the table summary
110      */
111     private String getTableSummaryX() { return null; }
112 
113     /**
114      * Get the summary table header for the member.
115      *
116      * @param member the member to be documented
117      * @return the summary table header
118      */
119     public abstract TableHeader getSummaryTableHeader(Element member);
120 
121     private Table summaryTable;
122 
123     private Table getSummaryTable() {
124         if (summaryTable == null) {
125             summaryTable = createSummaryTable();
126         }
127         return summaryTable;
128     }
129 
130     /**
131      * Create the summary table for this element.
132      * The table should be created and initialized if needed, and configured
133      * so that it is ready to add content with {@link Table#addRow(Content[])}
134      * and similar methods.
135      *
136      * @return the summary table
137      */
138     protected abstract Table createSummaryTable();
139 
140 
141 
142     /**
143      * Add inherited summary label for the member.
144      *
145      * @param typeElement the TypeElement to which to link to
146      * @param inheritedTree the content tree to which the inherited summary label will be added
147      */
148     public abstract void addInheritedSummaryLabel(TypeElement typeElement, Content inheritedTree);
149 
150     /**
151      * Add the anchor for the summary section of the member.
152      *
153      * @param typeElement the TypeElement to be documented
154      * @param memberTree the content tree to which the summary anchor will be added
155      */
156     public abstract void addSummaryAnchor(TypeElement typeElement, Content memberTree);
157 
158     /**
159      * Add the anchor for the inherited summary section of the member.
160      *
161      * @param typeElement the TypeElement to be documented
162      * @param inheritedTree the content tree to which the inherited summary anchor will be added
163      */
164     public abstract void addInheritedSummaryAnchor(TypeElement typeElement, Content inheritedTree);
165 
166     /**
167      * Add the summary type for the member.
168      *
169      * @param member the member to be documented
170      * @param tdSummaryType the content tree to which the type will be added
171      */
172     protected abstract void addSummaryType(Element member, Content tdSummaryType);
173 
174     /**
175      * Add the summary link for the member.
176      *
177      * @param typeElement the TypeElement to be documented
178      * @param member the member to be documented
179      * @param tdSummary the content tree to which the link will be added
180      */
181     protected void addSummaryLink(TypeElement typeElement, Element member, Content tdSummary) {
182         addSummaryLink(LinkInfoImpl.Kind.MEMBER, typeElement, member, tdSummary);
183     }
184 
185     /**
186      * Add the summary link for the member.
187      *
188      * @param context the id of the context where the link will be printed
189      * @param typeElement the TypeElement to be documented
190      * @param member the member to be documented
191      * @param tdSummary the content tree to which the summary link will be added
192      */
193     protected abstract void addSummaryLink(LinkInfoImpl.Kind context,
194             TypeElement typeElement, Element member, Content tdSummary);
195 
196     /**
197      * Add the inherited summary link for the member.
198      *
199      * @param typeElement the TypeElement to be documented
200      * @param member the member to be documented
201      * @param linksTree the content tree to which the inherited summary link will be added
202      */
203     protected abstract void addInheritedSummaryLink(TypeElement typeElement,
204             Element member, Content linksTree);
205 
206     /**
207      * Get the deprecated link.
208      *
209      * @param member the member being linked to
210      * @return a content tree representing the link
211      */
212     protected abstract Content getDeprecatedLink(Element member);
213 
214     /**
215      * Add the member name to the content tree.
216      *
217      * @param name the member name to be added to the content tree.
218      * @param htmltree the content tree to which the name will be added.
219      */
220     protected void addName(String name, Content htmltree) {
221         htmltree.add(name);
222     }
223 
224     /**
225      * Add the modifier for the member. The modifiers are ordered as specified
226      * by &lt;em&gt;The Java Language Specification&lt;/em&gt;.
227      *
228      * @param member the member for which the modifier will be added.
229      * @param htmltree the content tree to which the modifier information will be added.
230      */
231     protected void addModifiers(Element member, Content htmltree) {
232         Set&lt;Modifier&gt; set = new TreeSet&lt;&gt;(member.getModifiers());
233 
234         // remove the ones we really don&#39;t need
235         set.remove(NATIVE);
236         set.remove(SYNCHRONIZED);
237         set.remove(STRICTFP);
238 
239         // According to JLS, we should not be showing public modifier for
240         // interface methods.
241         if ((utils.isField(member) || utils.isMethod(member))
242             &amp;&amp; ((writer instanceof ClassWriterImpl
243                  &amp;&amp; utils.isInterface(((ClassWriterImpl) writer).getTypeElement())  ||
244                  writer instanceof AnnotationTypeWriterImpl) )) {
245             // Remove the implicit abstract and public modifiers
246             if (utils.isMethod(member) &amp;&amp;
247                 (utils.isInterface(member.getEnclosingElement()) ||
248                  utils.isAnnotationType(member.getEnclosingElement()))) {
249                 set.remove(ABSTRACT);
250                 set.remove(PUBLIC);
251             }
252             if (!utils.isMethod(member)) {
253                 set.remove(PUBLIC);
254             }
255         }
256         if (!set.isEmpty()) {
257             String mods = set.stream().map(Modifier::toString).collect(Collectors.joining(&quot; &quot;));
258             htmltree.add(mods);
259             htmltree.add(Contents.SPACE);
260         }
261     }
262 
263     protected CharSequence makeSpace(int len) {
264         if (len &lt;= 0) {
265             return &quot;&quot;;
266         }
267         StringBuilder sb = new StringBuilder(len);
268         for (int i = 0; i &lt; len; i++) {
269             sb.append(&#39; &#39;);
270         }
271         return sb;
272     }
273 
274     /**
275      * Add the modifier and type for the member in the member summary.
276      *
277      * @param member the member to add the type for
278      * @param type the type to add
279      * @param tdSummaryType the content tree to which the modified and type will be added
280      */
281     protected void addModifierAndType(Element member, TypeMirror type,
282             Content tdSummaryType) {
283         HtmlTree code = new HtmlTree(HtmlTag.CODE);
284         addModifier(member, code);
285         if (type == null) {
286             code.add(utils.isClass(member) ? &quot;class&quot; : &quot;interface&quot;);
287             code.add(Contents.SPACE);
288         } else {
289             List&lt;? extends TypeParameterElement&gt; list = utils.isExecutableElement(member)
290                     ? ((ExecutableElement)member).getTypeParameters()
291                     : null;
292             if (list != null &amp;&amp; !list.isEmpty()) {
293                 Content typeParameters = ((AbstractExecutableMemberWriter) this)
294                         .getTypeParameters((ExecutableElement)member);
295                     code.add(typeParameters);
296                 //Code to avoid ugly wrapping in member summary table.
297                 if (typeParameters.charCount() &gt; 10) {
298                     code.add(new HtmlTree(HtmlTag.BR));
299                 } else {
300                     code.add(Contents.SPACE);
301                 }
302                 code.add(
303                         writer.getLink(new LinkInfoImpl(configuration,
304                         LinkInfoImpl.Kind.SUMMARY_RETURN_TYPE, type)));
305             } else {
306                 code.add(
307                         writer.getLink(new LinkInfoImpl(configuration,
308                         LinkInfoImpl.Kind.SUMMARY_RETURN_TYPE, type)));
309             }
310 
311         }
312         tdSummaryType.add(code);
313     }
314 
315     /**
316      * Add the modifier for the member.
317      *
318      * @param member the member to add the type for
319      * @param code the content tree to which the modified will be added
320      */
321     private void addModifier(Element member, Content code) {
322         if (utils.isProtected(member)) {
323             code.add(&quot;protected &quot;);
324         } else if (utils.isPrivate(member)) {
325             code.add(&quot;private &quot;);
326         } else if (!utils.isPublic(member)) { // Package private
327             code.add(resources.getText(&quot;doclet.Package_private&quot;));
328             code.add(&quot; &quot;);
329         }
330         boolean isAnnotatedTypeElement = utils.isAnnotationType(member.getEnclosingElement());
331         if (!isAnnotatedTypeElement &amp;&amp; utils.isMethod(member)) {
332             if (!utils.isInterface(member.getEnclosingElement()) &amp;&amp; utils.isAbstract(member)) {
333                 code.add(&quot;abstract &quot;);
334             }
335             if (utils.isDefault(member)) {
336                 code.add(&quot;default &quot;);
337             }
338         }
339         if (utils.isStatic(member)) {
340             code.add(&quot;static &quot;);
341         }
342     }
343 
344     /**
345      * Add the deprecated information for the given member.
346      *
347      * @param member the member being documented.
348      * @param contentTree the content tree to which the deprecated information will be added.
349      */
350     protected void addDeprecatedInfo(Element member, Content contentTree) {
351         Content output = (new DeprecatedTaglet()).getTagletOutput(member,
352             writer.getTagletWriterInstance(false));
353         if (!output.isEmpty()) {
354             Content deprecatedContent = output;
355             Content div = HtmlTree.DIV(HtmlStyle.deprecationBlock, deprecatedContent);
356             contentTree.add(div);
357         }
358     }
359 
360     /**
361      * Add the comment for the given member.
362      *
363      * @param member the member being documented.
364      * @param htmltree the content tree to which the comment will be added.
365      */
366     protected void addComment(Element member, Content htmltree) {
367         if (!utils.getFullBody(member).isEmpty()) {
368             writer.addInlineComment(member, htmltree);
369         }
370     }
371 
372     protected String name(Element member) {
373         return utils.getSimpleName(member);
374     }
375 
376     /**
377     * Return true if the given &lt;code&gt;ProgramElement&lt;/code&gt; is inherited
378     * by the class that is being documented.
379     *
380     * @param ped The &lt;code&gt;ProgramElement&lt;/code&gt; being checked.
381     * return true if the &lt;code&gt;ProgramElement&lt;/code&gt; is being inherited and
382     * false otherwise.
383      *@return true if inherited
384     */
385     protected boolean isInherited(Element ped){
386         return (!utils.isPrivate(ped) &amp;&amp;
387                 (!utils.isPackagePrivate(ped) ||
388                     ped.getEnclosingElement().equals(ped.getEnclosingElement())));
389     }
390 
391     /**
392      * Add use information to the documentation tree.
393      *
394      * @param mems list of program elements for which the use information will be added
395      * @param heading the section heading
396      * @param contentTree the content tree to which the use information will be added
397      */
398     protected void addUseInfo(List&lt;? extends Element&gt; mems, Content heading, Content contentTree) {
399         if (mems == null || mems.isEmpty()) {
400             return;
401         }
402         List&lt;? extends Element&gt; members = mems;
403         boolean printedUseTableHeader = false;
404         if (members.size() &gt; 0) {
405             Table useTable = new Table(HtmlStyle.useSummary)
406                     .setCaption(heading)
407                     .setRowScopeColumn(1)
408                     .setColumnStyles(HtmlStyle.colFirst, HtmlStyle.colSecond, HtmlStyle.colLast);
409             for (Element element : members) {
410                 TypeElement te = (typeElement == null)
411                         ? utils.getEnclosingTypeElement(element)
412                         : typeElement;
413                 if (!printedUseTableHeader) {
414                     useTable.setHeader(getSummaryTableHeader(element));
415                     printedUseTableHeader = true;
416                 }
417                 Content summaryType = new ContentBuilder();
418                 addSummaryType(element, summaryType);
419                 Content typeContent = new ContentBuilder();
420                 if (te != null
421                         &amp;&amp; !utils.isConstructor(element)
422                         &amp;&amp; !utils.isClass(element)
423                         &amp;&amp; !utils.isInterface(element)
424                         &amp;&amp; !utils.isAnnotationType(element)) {
425                     HtmlTree name = new HtmlTree(HtmlTag.SPAN);
426                     name.setStyle(HtmlStyle.typeNameLabel);
427                     name.add(name(te) + &quot;.&quot;);
428                     typeContent.add(name);
429                 }
430                 addSummaryLink(utils.isClass(element) || utils.isInterface(element)
431                         ? LinkInfoImpl.Kind.CLASS_USE
432                         : LinkInfoImpl.Kind.MEMBER,
433                         te, element, typeContent);
434                 Content desc = new ContentBuilder();
435                 writer.addSummaryLinkComment(this, element, desc);
436                 useTable.addRow(summaryType, typeContent, desc);
437             }
438             contentTree.add(useTable.toContent());
439         }
440     }
441 
442     protected void serialWarning(Element e, String key, String a1, String a2) {
443         if (configuration.serialwarn) {
444             configuration.messages.warning(e, key, a1, a2);
445         }
446     }
447 
448     /**
449      * Add the member summary for the given class.
450      *
451      * @param tElement the class that is being documented
452      * @param member the member being documented
453      * @param firstSentenceTags the first sentence tags to be added to the summary
454      */
455     @Override
456     public void addMemberSummary(TypeElement tElement, Element member,
457             List&lt;? extends DocTree&gt; firstSentenceTags) {
458         if (tElement != typeElement) {
459             throw new IllegalStateException();
460         }
461         Table table = getSummaryTable();
462         List&lt;Content&gt; rowContents = new ArrayList&lt;&gt;();
463         Content summaryType = new ContentBuilder();
464         addSummaryType(member, summaryType);
465         if (!summaryType.isEmpty())
466             rowContents.add(summaryType);
467         Content summaryLink = new ContentBuilder();
468         addSummaryLink(tElement, member, summaryLink);
469         rowContents.add(summaryLink);
470         Content desc = new ContentBuilder();
471         writer.addSummaryLinkComment(this, member, firstSentenceTags, desc);
472         rowContents.add(desc);
473         table.addRow(member, rowContents);
474     }
475 
476     /**
477      * Add inherited member summary for the given class and member.
478      *
479      * @param tElement the class the inherited member belongs to
480      * @param nestedClass the inherited member that is summarized
481      * @param isFirst true if this is the first member in the list
482      * @param isLast true if this is the last member in the list
483      * @param linksTree the content tree to which the summary will be added
484      */
485     @Override
486     public void addInheritedMemberSummary(TypeElement tElement,
487             Element nestedClass, boolean isFirst, boolean isLast,
488             Content linksTree) {
489         writer.addInheritedMemberSummary(this, tElement, nestedClass, isFirst,
490                 linksTree);
491     }
492 
493     /**
494      * Get the inherited summary header for the given class.
495      *
496      * @param tElement the class the inherited member belongs to
497      * @return a content tree for the inherited summary header
498      */
499     @Override
500     public Content getInheritedSummaryHeader(TypeElement tElement) {
501         Content inheritedTree = writer.getMemberTreeHeader();
502         writer.addInheritedSummaryHeader(this, tElement, inheritedTree);
503         return inheritedTree;
504     }
505 
506     /**
507      * Get the inherited summary links tree.
508      *
509      * @return a content tree for the inherited summary links
510      */
511     @Override
512     public Content getInheritedSummaryLinksTree() {
513         return new HtmlTree(HtmlTag.CODE);
514     }
515 
516     /**
517      * Get the summary table tree for the given class.
518      *
519      * @param tElement the class for which the summary table is generated
520      * @return a content tree for the summary table
521      */
522     @Override
523     public Content getSummaryTableTree(TypeElement tElement) {
524         if (tElement != typeElement) {
525             throw new IllegalStateException();
526         }
527         Table table = getSummaryTable();
528         if (table.needsScript()) {
529             writer.getMainBodyScript().append(table.getScript());
530         }
531         return table.toContent();
532     }
533 
534     /**
535      * Get the member tree to be documented.
536      *
537      * @param memberTree the content tree of member to be documented
538      * @return a content tree that will be added to the class documentation
539      */
540     @Override
541     public Content getMemberTree(Content memberTree) {
542         return writer.getMemberTree(memberTree);
543     }
544 
545     /**
546      * Get the member tree to be documented.
547      *
548      * @param memberTree the content tree of member to be documented
549      * @param isLastContent true if the content to be added is the last content
550      * @return a content tree that will be added to the class documentation
551      */
552     public Content getMemberTree(Content memberTree, boolean isLastContent) {
553         if (isLastContent)
554             return HtmlTree.UL(HtmlStyle.blockListLast, memberTree);
555         else
556             return HtmlTree.UL(HtmlStyle.blockList, memberTree);
557     }
558 }
    </pre>
  </body>
</html>