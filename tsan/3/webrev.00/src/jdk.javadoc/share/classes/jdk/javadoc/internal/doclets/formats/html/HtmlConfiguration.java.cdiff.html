<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/HtmlConfiguration.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HelpWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="HtmlDoclet.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/HtmlConfiguration.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 23,11 ***</span>
   * questions.
   */
  
  package jdk.javadoc.internal.doclets.formats.html;
  
<span class="line-removed">- import java.net.*;</span>
  import java.util.*;
  import java.util.stream.Collectors;
  
  import javax.lang.model.element.Element;
  import javax.lang.model.element.PackageElement;
<span class="line-new-header">--- 23,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 35,14 ***</span>
  import javax.tools.JavaFileManager;
  import javax.tools.JavaFileObject;
  import javax.tools.StandardJavaFileManager;
  
  import com.sun.source.util.DocTreePath;
<span class="line-removed">- import com.sun.tools.doclint.DocLint;</span>
  
  import jdk.javadoc.doclet.Doclet;
  import jdk.javadoc.doclet.DocletEnvironment;
  import jdk.javadoc.internal.doclets.toolkit.BaseConfiguration;
  import jdk.javadoc.internal.doclets.toolkit.DocletException;
  import jdk.javadoc.internal.doclets.toolkit.Messages;
  import jdk.javadoc.internal.doclets.toolkit.Resources;
  import jdk.javadoc.internal.doclets.toolkit.WriterFactory;
<span class="line-new-header">--- 34,16 ---</span>
  import javax.tools.JavaFileManager;
  import javax.tools.JavaFileObject;
  import javax.tools.StandardJavaFileManager;
  
  import com.sun.source.util.DocTreePath;
  
  import jdk.javadoc.doclet.Doclet;
  import jdk.javadoc.doclet.DocletEnvironment;
<span class="line-added">+ import jdk.javadoc.doclet.Reporter;</span>
<span class="line-added">+ import jdk.javadoc.doclet.StandardDoclet;</span>
<span class="line-added">+ import jdk.javadoc.doclet.Taglet;</span>
  import jdk.javadoc.internal.doclets.toolkit.BaseConfiguration;
  import jdk.javadoc.internal.doclets.toolkit.DocletException;
  import jdk.javadoc.internal.doclets.toolkit.Messages;
  import jdk.javadoc.internal.doclets.toolkit.Resources;
  import jdk.javadoc.internal.doclets.toolkit.WriterFactory;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 51,13 ***</span>
  import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
  
  import static javax.tools.Diagnostic.Kind.*;
  
  /**
<span class="line-modified">!  * Configure the output based on the command line options.</span>
   * &lt;p&gt;
<span class="line-modified">!  * Also determine the length of the command line option. For example,</span>
   * for a option &quot;-header&quot; there will be a string argument associated, then the
   * the length of option &quot;-header&quot; is two. But for option &quot;-nohelp&quot; no argument
   * is needed so it&#39;s length is 1.
   * &lt;/p&gt;
   * &lt;p&gt;
<span class="line-new-header">--- 52,13 ---</span>
  import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
  
  import static javax.tools.Diagnostic.Kind.*;
  
  /**
<span class="line-modified">!  * Configure the output based on the command-line options.</span>
   * &lt;p&gt;
<span class="line-modified">!  * Also determine the length of the command-line option. For example,</span>
   * for a option &quot;-header&quot; there will be a string argument associated, then the
   * the length of option &quot;-header&quot; is two. But for option &quot;-nohelp&quot; no argument
   * is needed so it&#39;s length is 1.
   * &lt;/p&gt;
   * &lt;p&gt;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 67,149 ***</span>
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
<span class="line-removed">-  *</span>
<span class="line-removed">-  * @author Robert Field.</span>
<span class="line-removed">-  * @author Atul Dambalkar.</span>
<span class="line-removed">-  * @author Jamie Ho</span>
<span class="line-removed">-  * @author Bhavesh Patel (Modified)</span>
   */
  public class HtmlConfiguration extends BaseConfiguration {
  
      /**
       * Default charset for HTML.
       */
      public static final String HTML_DEFAULT_CHARSET = &quot;utf-8&quot;;
  
<span class="line-modified">!     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-header&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String header = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-packagesheader&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String packagesheader = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-footer&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String footer = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-doctitle&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String doctitle = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-windowtitle&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String windowtitle = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-top&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String top = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-bottom&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String bottom = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-helpfile&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String helpfile = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-stylesheetfile&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String stylesheetfile = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;--add-stylesheet&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public List&lt;String&gt; additionalStylesheets = new ArrayList&lt;&gt;();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Argument for command line option &quot;-Xdocrootparent&quot;.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String docrootparent = &quot;&quot;;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * True if command line option &quot;-nohelp&quot; is used. Default value is false.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public boolean nohelp = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * True if command line option &quot;-splitindex&quot; is used. Default value is</span>
<span class="line-removed">-      * false.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public boolean splitindex = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * False if command line option &quot;-noindex&quot; is used. Default value is true.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public boolean createindex = true;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * True if command line option &quot;-use&quot; is used. Default value is false.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public boolean classuse = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * False if command line option &quot;-notree&quot; is used. Default value is true.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public boolean createtree = true;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * The META charset tag used for cross-platform viewing.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String charset = null;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * True if command line option &quot;-nodeprecated&quot; is used. Default value is</span>
<span class="line-removed">-      * false.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public boolean nodeprecatedlist = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * True if command line option &quot;-nonavbar&quot; is used. Default value is false.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public boolean nonavbar = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * True if command line option &quot;-nooverview&quot; is used. Default value is</span>
<span class="line-removed">-      * false</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     private boolean nooverview = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * The overview path specified with &quot;-overview&quot; flag.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public String overviewpath = null;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * This is true if option &quot;-overview&quot; is used or option &quot;-overview&quot; is not</span>
<span class="line-removed">-      * used and number of packages is more than one.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public boolean createoverview = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Specifies whether or not frames should be generated.</span>
<span class="line-removed">-      * Defaults to false; can be set to true by --frames; can be set to false by --no-frames; last one wins.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public boolean frames = false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Collected set of doclint options</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     public Map&lt;Doclet.Option, String&gt; doclintOpts = new LinkedHashMap&lt;&gt;();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     public final Resources resources;</span>
  
      /**
       * First file to appear in the right-hand frame in the generated
       * documentation.
       */
<span class="line-new-header">--- 68,19 ---</span>
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
   */
  public class HtmlConfiguration extends BaseConfiguration {
  
      /**
       * Default charset for HTML.
       */
      public static final String HTML_DEFAULT_CHARSET = &quot;utf-8&quot;;
  
<span class="line-modified">!     public final Resources docResources;</span>
  
      /**
       * First file to appear in the right-hand frame in the generated
       * documentation.
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 228,11 ***</span>
  
      protected SortedSet&lt;SearchIndexItem&gt; tagSearchIndex;
  
      protected SortedSet&lt;SearchIndexItem&gt; typeSearchIndex;
  
<span class="line-modified">!     protected Map&lt;Character,List&lt;SearchIndexItem&gt;&gt; tagSearchIndexMap = new HashMap&lt;&gt;();</span>
  
      protected Set&lt;Character&gt; tagSearchIndexKeys;
  
      public final Contents contents;
  
<span class="line-new-header">--- 99,11 ---</span>
  
      protected SortedSet&lt;SearchIndexItem&gt; tagSearchIndex;
  
      protected SortedSet&lt;SearchIndexItem&gt; typeSearchIndex;
  
<span class="line-modified">!     protected Map&lt;Character, List&lt;SearchIndexItem&gt;&gt; tagSearchIndexMap = new HashMap&lt;&gt;();</span>
  
      protected Set&lt;Character&gt; tagSearchIndexKeys;
  
      public final Contents contents;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 240,27 ***</span>
  
      public DocPaths docPaths;
  
      public Map&lt;Element, List&lt;DocPath&gt;&gt; localStylesheetMap = new HashMap&lt;&gt;();
  
      /**
<span class="line-modified">!      * Creates an object to hold the configuration for a doclet.</span>
       *
<span class="line-modified">!      * @param doclet the doclet</span>
       */
<span class="line-modified">!     public HtmlConfiguration(Doclet doclet) {</span>
<span class="line-modified">!         super(doclet);</span>
<span class="line-modified">!         resources = new Resources(this,</span>
                  BaseConfiguration.sharedResourceBundleName,
                  &quot;jdk.javadoc.internal.doclets.formats.html.resources.standard&quot;);
  
<span class="line-modified">!         messages = new Messages(this);</span>
          contents = new Contents(this);
  
          String v;
          try {
<span class="line-modified">!             ResourceBundle rb = ResourceBundle.getBundle(versionBundleName, getLocale());</span>
              try {
                  v = rb.getString(&quot;release&quot;);
              } catch (MissingResourceException e) {
                  v = defaultDocletVersion;
              }
<span class="line-new-header">--- 111,55 ---</span>
  
      public DocPaths docPaths;
  
      public Map&lt;Element, List&lt;DocPath&gt;&gt; localStylesheetMap = new HashMap&lt;&gt;();
  
<span class="line-added">+     private final HtmlOptions options;</span>
<span class="line-added">+ </span>
      /**
<span class="line-modified">!      * Constructs the full configuration needed by the doclet, including</span>
<span class="line-added">+      * the format-specific part, defined in this class, and the format-independent</span>
<span class="line-added">+      * part, defined in the supertype.</span>
       *
<span class="line-modified">!      * @apiNote The {@code doclet} parameter is used when</span>
<span class="line-added">+      * {@link Taglet#init(DocletEnvironment, Doclet) initializing tags}.</span>
<span class="line-added">+      * Some doclets (such as the {@link StandardDoclet}), may delegate to another</span>
<span class="line-added">+      * (such as the {@link HtmlDoclet}).  In such cases, the primary doclet (i.e</span>
<span class="line-added">+      * {@code StandardDoclet}) should be provided here, and not any internal</span>
<span class="line-added">+      * class like {@code HtmlDoclet}.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @param doclet   the doclet for this run of javadoc</span>
<span class="line-added">+      * @param locale   the locale for the generated documentation</span>
<span class="line-added">+      * @param reporter the reporter to use for console messages</span>
       */
<span class="line-modified">!     public HtmlConfiguration(Doclet doclet, Locale locale, Reporter reporter) {</span>
<span class="line-modified">!         super(doclet, locale, reporter);</span>
<span class="line-modified">! </span>
<span class="line-added">+         // Use the default locale for console messages.</span>
<span class="line-added">+         Resources msgResources = new Resources(Locale.getDefault(),</span>
                  BaseConfiguration.sharedResourceBundleName,
                  &quot;jdk.javadoc.internal.doclets.formats.html.resources.standard&quot;);
  
<span class="line-modified">!         // Use the provided locale for generated docs</span>
<span class="line-added">+         // Ideally, the doc resources would be in different resource files than the</span>
<span class="line-added">+         // message resources, so that we do not have different copies of the same resources.</span>
<span class="line-added">+         if (locale.equals(Locale.getDefault())) {</span>
<span class="line-added">+             docResources = msgResources;</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             docResources = new Resources(locale,</span>
<span class="line-added">+                     BaseConfiguration.sharedResourceBundleName,</span>
<span class="line-added">+                     &quot;jdk.javadoc.internal.doclets.formats.html.resources.standard&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         messages = new Messages(this, msgResources);</span>
          contents = new Contents(this);
<span class="line-added">+         options = new HtmlOptions(this);</span>
  
          String v;
          try {
<span class="line-modified">!             // the version bundle is not localized</span>
<span class="line-added">+             ResourceBundle rb = ResourceBundle.getBundle(versionBundleName, Locale.getDefault());</span>
              try {
                  v = rb.getString(&quot;release&quot;);
              } catch (MissingResourceException e) {
                  v = defaultDocletVersion;
              }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 271,78 ***</span>
      }
  
      private static final String versionBundleName = &quot;jdk.javadoc.internal.tool.resources.version&quot;;
      private static final String defaultDocletVersion = System.getProperty(&quot;java.version&quot;);
      public final String docletVersion;
  
      @Override
      public String getDocletVersion() {
          return docletVersion;
      }
  
      @Override
<span class="line-modified">!     public Resources getResources() {</span>
<span class="line-modified">!         return resources;</span>
      }
  
      public Contents getContents() {
          return contents;
      }
  
      @Override
      public Messages getMessages() {
          return messages;
      }
  
<span class="line-modified">!     protected boolean validateOptions() {</span>
<span class="line-modified">!         // check shared options</span>
<span class="line-modified">!         if (!generalValidOptions()) {</span>
<span class="line-removed">-             return false;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         // check if helpfile exists</span>
<span class="line-removed">-         if (!helpfile.isEmpty()) {</span>
<span class="line-removed">-             DocFile help = DocFile.createFileForInput(this, helpfile);</span>
<span class="line-removed">-             if (!help.exists()) {</span>
<span class="line-removed">-                 reporter.print(ERROR, resources.getText(&quot;doclet.File_not_found&quot;, helpfile));</span>
<span class="line-removed">-                 return false;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         // check if stylesheetfile exists</span>
<span class="line-removed">-         if (!stylesheetfile.isEmpty()) {</span>
<span class="line-removed">-             DocFile stylesheet = DocFile.createFileForInput(this, stylesheetfile);</span>
<span class="line-removed">-             if (!stylesheet.exists()) {</span>
<span class="line-removed">-                 reporter.print(ERROR, resources.getText(&quot;doclet.File_not_found&quot;, stylesheetfile));</span>
<span class="line-removed">-                 return false;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         // check if additional stylesheets exists</span>
<span class="line-removed">-         for (String ssheet : additionalStylesheets) {</span>
<span class="line-removed">-             DocFile ssfile = DocFile.createFileForInput(this, ssheet);</span>
<span class="line-removed">-             if (!ssfile.exists()) {</span>
<span class="line-removed">-                 reporter.print(ERROR, resources.getText(&quot;doclet.File_not_found&quot;, ssheet));</span>
<span class="line-removed">-                 return false;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         // In a more object-oriented world, this would be done by methods on the Option objects.</span>
<span class="line-removed">-         // Note that -windowtitle silently removes any and all HTML elements, and so does not need</span>
<span class="line-removed">-         // to be handled here.</span>
<span class="line-removed">-         utils.checkJavaScriptInOption(&quot;-header&quot;, header);</span>
<span class="line-removed">-         utils.checkJavaScriptInOption(&quot;-footer&quot;, footer);</span>
<span class="line-removed">-         utils.checkJavaScriptInOption(&quot;-top&quot;, top);</span>
<span class="line-removed">-         utils.checkJavaScriptInOption(&quot;-bottom&quot;, bottom);</span>
<span class="line-removed">-         utils.checkJavaScriptInOption(&quot;-doctitle&quot;, doctitle);</span>
<span class="line-removed">-         utils.checkJavaScriptInOption(&quot;-packagesheader&quot;, packagesheader);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         return true;</span>
      }
  
<span class="line-removed">- </span>
      @Override
      public boolean finishOptionSettings() {
<span class="line-modified">!         if (!validateOptions()) {</span>
              return false;
          }
          if (!getSpecifiedTypeElements().isEmpty()) {
              Map&lt;String, PackageElement&gt; map = new HashMap&lt;&gt;();
              PackageElement pkg;
<span class="line-new-header">--- 170,44 ---</span>
      }
  
      private static final String versionBundleName = &quot;jdk.javadoc.internal.tool.resources.version&quot;;
      private static final String defaultDocletVersion = System.getProperty(&quot;java.version&quot;);
      public final String docletVersion;
<span class="line-added">+     public final Date startTime = new Date();</span>
  
      @Override
      public String getDocletVersion() {
          return docletVersion;
      }
  
      @Override
<span class="line-modified">!     public Resources getDocResources() {</span>
<span class="line-modified">!         return docResources;</span>
      }
  
<span class="line-added">+     /**</span>
<span class="line-added">+      * Returns a utility object providing commonly used fragments of content.</span>
<span class="line-added">+      *</span>
<span class="line-added">+      * @return a utility object providing commonly used fragments of content</span>
<span class="line-added">+      */</span>
      public Contents getContents() {
          return contents;
      }
  
      @Override
      public Messages getMessages() {
          return messages;
      }
  
<span class="line-modified">!     @Override</span>
<span class="line-modified">!     public HtmlOptions getOptions() {</span>
<span class="line-modified">!         return options;</span>
      }
  
      @Override
      public boolean finishOptionSettings() {
<span class="line-modified">!         if (!options.validateOptions()) {</span>
              return false;
          }
          if (!getSpecifiedTypeElements().isEmpty()) {
              Map&lt;String, PackageElement&gt; map = new HashMap&lt;&gt;();
              PackageElement pkg;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 351,14 ***</span>
                  if (!map.containsKey(utils.getPackageName(pkg))) {
                      map.put(utils.getPackageName(pkg), pkg);
                  }
              }
          }
<span class="line-modified">!         docPaths = new DocPaths(utils, useModuleDirectories);</span>
          setCreateOverview();
          setTopFile(docEnv);
<span class="line-modified">!         workArounds.initDocLint(doclintOpts.values(), tagletManager.getAllTagletNames());</span>
          return true;
      }
  
      /**
       * Decide the page which will appear first in the right-hand frame. It will
<span class="line-new-header">--- 216,14 ---</span>
                  if (!map.containsKey(utils.getPackageName(pkg))) {
                      map.put(utils.getPackageName(pkg), pkg);
                  }
              }
          }
<span class="line-modified">!         docPaths = new DocPaths(utils);</span>
          setCreateOverview();
          setTopFile(docEnv);
<span class="line-modified">!         workArounds.initDocLint(options.doclintOpts(), tagletManager.getAllTagletNames());</span>
          return true;
      }
  
      /**
       * Decide the page which will appear first in the right-hand frame. It will
</pre>
<hr />
<pre>
<span class="line-old-header">*** 372,12 ***</span>
       */
      protected void setTopFile(DocletEnvironment docEnv) {
          if (!checkForDeprecation(docEnv)) {
              return;
          }
<span class="line-modified">!         if (createoverview) {</span>
<span class="line-modified">!             topFile = DocPaths.overviewSummary(frames);</span>
          } else {
              if (showModules) {
                  topFile = DocPath.empty.resolve(docPaths.moduleSummary(modules.first()));
              } else if (packages.size() == 1 &amp;&amp; packages.first().isUnnamed()) {
                  List&lt;TypeElement&gt; classes = new ArrayList&lt;&gt;(getIncludedTypeElements());
<span class="line-new-header">--- 237,12 ---</span>
       */
      protected void setTopFile(DocletEnvironment docEnv) {
          if (!checkForDeprecation(docEnv)) {
              return;
          }
<span class="line-modified">!         if (options.createOverview()) {</span>
<span class="line-modified">!             topFile = DocPaths.INDEX;</span>
          } else {
              if (showModules) {
                  topFile = DocPath.empty.resolve(docPaths.moduleSummary(modules.first()));
              } else if (packages.size() == 1 &amp;&amp; packages.first().isUnnamed()) {
                  List&lt;TypeElement&gt; classes = new ArrayList&lt;&gt;(getIncludedTypeElements());
</pre>
<hr />
<pre>
<span class="line-old-header">*** 390,11 ***</span>
              }
          }
      }
  
      protected TypeElement getValidClass(List&lt;TypeElement&gt; classes) {
<span class="line-modified">!         if (!nodeprecated) {</span>
              return classes.get(0);
          }
          for (TypeElement te : classes) {
              if (!utils.isDeprecated(te)) {
                  return te;
<span class="line-new-header">--- 255,11 ---</span>
              }
          }
      }
  
      protected TypeElement getValidClass(List&lt;TypeElement&gt; classes) {
<span class="line-modified">!         if (!options.noDeprecated()) {</span>
              return classes.get(0);
          }
          for (TypeElement te : classes) {
              if (!utils.isDeprecated(te)) {
                  return te;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 412,33 ***</span>
          return false;
      }
  
      /**
       * Generate &quot;overview.html&quot; page if option &quot;-overview&quot; is used or number of
<span class="line-modified">!      * packages is more than one. Sets {@link #createoverview} field to true.</span>
       */
      protected void setCreateOverview() {
<span class="line-modified">!         if (!nooverview) {</span>
<span class="line-modified">!             if (overviewpath != null</span>
                      || modules.size() &gt; 1
                      || (modules.isEmpty() &amp;&amp; packages.size() &gt; 1)) {
<span class="line-modified">!                 createoverview = true;</span>
              }
          }
      }
  
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      @Override
      public WriterFactory getWriterFactory() {
          return new WriterFactoryImpl(this);
      }
  
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      @Override
      public Locale getLocale() {
          if (locale == null)
              return Locale.getDefault();
          return locale;
<span class="line-new-header">--- 277,27 ---</span>
          return false;
      }
  
      /**
       * Generate &quot;overview.html&quot; page if option &quot;-overview&quot; is used or number of
<span class="line-modified">!      * packages is more than one. Sets {@code HtmlOptions.createOverview} field to true.</span>
       */
      protected void setCreateOverview() {
<span class="line-modified">!         if (!options.noOverview()) {</span>
<span class="line-modified">!             if (options.overviewPath() != null</span>
                      || modules.size() &gt; 1
                      || (modules.isEmpty() &amp;&amp; packages.size() &gt; 1)) {
<span class="line-modified">!                 options.setCreateOverview(true);</span>
              }
          }
      }
  
      @Override
      public WriterFactory getWriterFactory() {
          return new WriterFactoryImpl(this);
      }
  
      @Override
      public Locale getLocale() {
          if (locale == null)
              return Locale.getDefault();
          return locale;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 449,30 ***</span>
       *
       * @return the path of the overview file or null if it does not exist.
       */
      @Override
      public JavaFileObject getOverviewPath() {
          if (overviewpath != null &amp;&amp; getFileManager() instanceof StandardJavaFileManager) {
              StandardJavaFileManager fm = (StandardJavaFileManager) getFileManager();
              return fm.getJavaFileObjects(overviewpath).iterator().next();
          }
          return null;
      }
  
<span class="line-modified">!     public DocFile getMainStylesheet() {</span>
<span class="line-modified">!         return stylesheetfile.isEmpty() ? null : DocFile.createFileForInput(this, stylesheetfile);</span>
      }
  
<span class="line-modified">!     public List&lt;DocFile&gt; getAdditionalStylesheets() {</span>
<span class="line-modified">!         return additionalStylesheets.stream()</span>
                  .map(ssf -&gt; DocFile.createFileForInput(this, ssf))
                  .collect(Collectors.toList());
      }
  
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * {@inheritDoc}</span>
<span class="line-removed">-      */</span>
      @Override
      public JavaFileManager getFileManager() {
          return docEnv.getJavaFileManager();
      }
  
<span class="line-new-header">--- 308,34 ---</span>
       *
       * @return the path of the overview file or null if it does not exist.
       */
      @Override
      public JavaFileObject getOverviewPath() {
<span class="line-added">+         String overviewpath = options.overviewPath();</span>
          if (overviewpath != null &amp;&amp; getFileManager() instanceof StandardJavaFileManager) {
              StandardJavaFileManager fm = (StandardJavaFileManager) getFileManager();
              return fm.getJavaFileObjects(overviewpath).iterator().next();
          }
          return null;
      }
  
<span class="line-modified">!     public DocPath getMainStylesheet() {</span>
<span class="line-modified">!         String stylesheetfile = options.stylesheetFile();</span>
<span class="line-added">+         if(!stylesheetfile.isEmpty()){</span>
<span class="line-added">+             DocFile docFile = DocFile.createFileForInput(this, stylesheetfile);</span>
<span class="line-added">+             return DocPath.create(docFile.getName());</span>
<span class="line-added">+         }</span>
<span class="line-added">+         return  null;</span>
      }
  
<span class="line-modified">!     public List&lt;DocPath&gt; getAdditionalStylesheets() {</span>
<span class="line-modified">!         return options.additionalStylesheets().stream()</span>
                  .map(ssf -&gt; DocFile.createFileForInput(this, ssf))
<span class="line-added">+                 .map(file -&gt; DocPath.create(file.getName()))</span>
                  .collect(Collectors.toList());
      }
  
      @Override
      public JavaFileManager getFileManager() {
          return docEnv.getJavaFileManager();
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 490,288 ***</span>
          for (SearchIndexItem sii : tagSearchIndex) {
              String tagLabel = sii.getLabel();
              Character unicode = (tagLabel.length() == 0)
                      ? &#39;*&#39;
                      : Character.toUpperCase(tagLabel.charAt(0));
<span class="line-modified">!             List&lt;SearchIndexItem&gt; list = tagSearchIndexMap.get(unicode);</span>
<span class="line-removed">-             if (list == null) {</span>
<span class="line-removed">-                 list = new ArrayList&lt;&gt;();</span>
<span class="line-removed">-                 tagSearchIndexMap.put(unicode, list);</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             list.add(sii);</span>
          }
          tagSearchIndexKeys = tagSearchIndexMap.keySet();
      }
  
<span class="line-removed">-     @Override</span>
<span class="line-removed">-     public Set&lt;Doclet.Option&gt; getSupportedOptions() {</span>
<span class="line-removed">-         Resources resources = getResources();</span>
<span class="line-removed">-         Doclet.Option[] options = {</span>
<span class="line-removed">-             new Option(resources, &quot;--add-stylesheet&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">-                     additionalStylesheets.add(args.get(0));</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-bottom&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     bottom = args.get(0);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-charset&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     charset = args.get(0);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-doctitle&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     doctitle = args.get(0);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-footer&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">-                     footer = args.get(0);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-header&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     header = args.get(0);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-helpfile&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     if (nohelp == true) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">-                                 &quot;-helpfile&quot;, &quot;-nohelp&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     if (!helpfile.isEmpty()) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_reuse&quot;,</span>
<span class="line-removed">-                                 &quot;-helpfile&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     helpfile = args.get(0);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-html5&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-nohelp&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">-                     nohelp = true;</span>
<span class="line-removed">-                     if (!helpfile.isEmpty()) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">-                                 &quot;-nohelp&quot;, &quot;-helpfile&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-nodeprecatedlist&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     nodeprecatedlist = true;</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-noindex&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     createindex = false;</span>
<span class="line-removed">-                     if (splitindex == true) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">-                                 &quot;-noindex&quot;, &quot;-splitindex&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-nonavbar&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     nonavbar = true;</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Hidden(resources, &quot;-nooverview&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     nooverview = true;</span>
<span class="line-removed">-                     if (overviewpath != null) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">-                                 &quot;-nooverview&quot;, &quot;-overview&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-notree&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     createtree = false;</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-overview&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     overviewpath = args.get(0);</span>
<span class="line-removed">-                     if (nooverview == true) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">-                                 &quot;-overview&quot;, &quot;-nooverview&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;--frames&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     reporter.print(WARNING, resources.getText(&quot;doclet.Frames_specified&quot;, helpfile));</span>
<span class="line-removed">-                     frames = true;</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;--no-frames&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     frames = false;</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Hidden(resources, &quot;-packagesheader&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     packagesheader = args.get(0);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-splitindex&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">-                     splitindex = true;</span>
<span class="line-removed">-                     if (createindex == false) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;,</span>
<span class="line-removed">-                                 &quot;-splitindex&quot;, &quot;-noindex&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;--main-stylesheet -stylesheetfile&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     stylesheetfile = args.get(0);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-top&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     top = args.get(0);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-use&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     classuse = true;</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new Option(resources, &quot;-windowtitle&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     windowtitle = args.get(0).replaceAll(&quot;\\&lt;.*?&gt;&quot;, &quot;&quot;);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new XOption(resources, &quot;-Xdoclint&quot;) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     doclintOpts.put(this, DocLint.XMSGS_OPTION);</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new XOption(resources, &quot;-Xdocrootparent&quot;, 1) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt, List&lt;String&gt; args) {</span>
<span class="line-removed">-                     docrootparent = args.get(0);</span>
<span class="line-removed">-                     try {</span>
<span class="line-removed">-                         URL ignored = new URL(docrootparent);</span>
<span class="line-removed">-                     } catch (MalformedURLException e) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.MalformedURL&quot;, docrootparent));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new XOption(resources, &quot;doclet.usage.xdoclint-extended&quot;, &quot;-Xdoclint:&quot;, 0) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     String dopt = opt.replace(&quot;-Xdoclint:&quot;, DocLint.XMSGS_CUSTOM_PREFIX);</span>
<span class="line-removed">-                     doclintOpts.put(this, dopt);</span>
<span class="line-removed">-                     if (dopt.contains(&quot;/&quot;)) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_doclint_no_qualifiers&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     if (!DocLint.isValidOption(dopt)) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_doclint_invalid_arg&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             },</span>
<span class="line-removed">-             new XOption(resources, &quot;doclet.usage.xdoclint-package&quot;, &quot;-Xdoclint/package:&quot;, 0) {</span>
<span class="line-removed">-                 @Override</span>
<span class="line-removed">-                 public boolean process(String opt,  List&lt;String&gt; args) {</span>
<span class="line-removed">-                     String dopt = opt.replace(&quot;-Xdoclint/package:&quot;, DocLint.XCHECK_PACKAGE);</span>
<span class="line-removed">-                     doclintOpts.put(this, dopt);</span>
<span class="line-removed">-                     if (!DocLint.isValidOption(dopt)) {</span>
<span class="line-removed">-                         reporter.print(ERROR, resources.getText(&quot;doclet.Option_doclint_package_invalid_arg&quot;));</span>
<span class="line-removed">-                         return false;</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     return true;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         };</span>
<span class="line-removed">-         Set&lt;Doclet.Option&gt; oset = new TreeSet&lt;&gt;();</span>
<span class="line-removed">-         oset.addAll(Arrays.asList(options));</span>
<span class="line-removed">-         oset.addAll(super.getSupportedOptions());</span>
<span class="line-removed">-         return oset;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      @Override
      protected boolean finishOptionSettings0() throws DocletException {
<span class="line-modified">!         if (docencoding == null) {</span>
<span class="line-modified">!             if (charset == null) {</span>
<span class="line-modified">!                 docencoding = charset = (encoding == null) ? HTML_DEFAULT_CHARSET : encoding;</span>
              } else {
<span class="line-modified">!                 docencoding = charset;</span>
              }
          } else {
<span class="line-modified">!             if (charset == null) {</span>
<span class="line-modified">!                 charset = docencoding;</span>
<span class="line-modified">!             } else if (!charset.equals(docencoding)) {</span>
<span class="line-modified">!                 reporter.print(ERROR, resources.getText(&quot;doclet.Option_conflict&quot;, &quot;-charset&quot;, &quot;-docencoding&quot;));</span>
                  return false;
              }
          }
          return super.finishOptionSettings0();
      }
<span class="line-new-header">--- 353,30 ---</span>
          for (SearchIndexItem sii : tagSearchIndex) {
              String tagLabel = sii.getLabel();
              Character unicode = (tagLabel.length() == 0)
                      ? &#39;*&#39;
                      : Character.toUpperCase(tagLabel.charAt(0));
<span class="line-modified">!             tagSearchIndexMap.computeIfAbsent(unicode, k -&gt; new ArrayList&lt;&gt;()).add(sii);</span>
          }
          tagSearchIndexKeys = tagSearchIndexMap.keySet();
      }
  
      @Override
      protected boolean finishOptionSettings0() throws DocletException {
<span class="line-modified">!         if (options.docEncoding() == null) {</span>
<span class="line-modified">!             if (options.charset() == null) {</span>
<span class="line-modified">!                 String charset = (options.encoding() == null) ? HTML_DEFAULT_CHARSET : options.encoding();</span>
<span class="line-added">+                 options.setCharset(charset);</span>
<span class="line-added">+                 options.setDocEncoding((options.charset()));</span>
              } else {
<span class="line-modified">!                 options.setDocEncoding(options.charset());</span>
              }
          } else {
<span class="line-modified">!             if (options.charset() == null) {</span>
<span class="line-modified">!                 options.setCharset(options.docEncoding());</span>
<span class="line-modified">!             } else if (!options.charset().equals(options.docEncoding())) {</span>
<span class="line-modified">!                 messages.error(&quot;doclet.Option_conflict&quot;, &quot;-charset&quot;, &quot;-docencoding&quot;);</span>
                  return false;
              }
          }
          return super.finishOptionSettings0();
      }
</pre>
<center><a href="HelpWriter.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="HtmlDoclet.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>