<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractIndexWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AbstractExecutableMemberWriter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractMemberWriter.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/AbstractIndexWriter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.formats.html;
 27 
<span class="line-modified"> 28 import java.io.*;</span>
<span class="line-modified"> 29 import java.util.*;</span>
<span class="line-modified"> 30 import java.util.zip.*;</span>

 31 
 32 import javax.lang.model.element.Element;
 33 import javax.lang.model.element.ExecutableElement;
 34 import javax.lang.model.element.ModuleElement;
 35 import javax.lang.model.element.PackageElement;
 36 import javax.lang.model.element.TypeElement;
<span class="line-modified"> 37 import javax.lang.model.util.SimpleElementVisitor9;</span>
 38 
 39 import com.sun.source.doctree.DocTree;

 40 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
 41 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
 42 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
 43 import jdk.javadoc.internal.doclets.formats.html.markup.Navigation;
 44 import jdk.javadoc.internal.doclets.formats.html.markup.Navigation.PageMode;
 45 import jdk.javadoc.internal.doclets.formats.html.markup.StringContent;
 46 import jdk.javadoc.internal.doclets.toolkit.Content;
 47 import jdk.javadoc.internal.doclets.toolkit.util.DocFile;
 48 import jdk.javadoc.internal.doclets.toolkit.util.DocFileIOException;
 49 import jdk.javadoc.internal.doclets.toolkit.util.DocPath;
 50 import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
 51 import jdk.javadoc.internal.doclets.toolkit.util.IndexBuilder;
 52 
 53 /**
 54  * Generate Index for all the Member Names with Indexing in
 55  * Unicode Order. This class is a base class for {@link SingleIndexWriter} and
 56  * {@link SplitIndexWriter}. It uses the functionality from
 57  * {@link HtmlDocletWriter} to generate the Index Contents.
 58  *
 59  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 60  *  If you write code that depends on this, you do so at your own risk.
 61  *  This code and its internal interfaces are subject to change or
 62  *  deletion without notice.&lt;/b&gt;
 63  *
 64  * @see    IndexBuilder
<span class="line-removed"> 65  * @author Atul M Dambalkar</span>
<span class="line-removed"> 66  * @author Bhavesh Patel (Modified)</span>
 67  */
 68 public class AbstractIndexWriter extends HtmlDocletWriter {
 69 
 70     /**
 71      * The index of all the members with unicode character.
 72      */
<span class="line-modified"> 73     protected IndexBuilder indexbuilder;</span>
 74 
 75     protected Navigation navBar;
 76 
 77     /**
 78      * This constructor will be used by {@link SplitIndexWriter}. Initializes
 79      * path to this file and relative path from this file.
 80      *
 81      * @param configuration  The current configuration
 82      * @param path       Path to the file which is getting generated.
<span class="line-modified"> 83      * @param indexbuilder Unicode based Index from {@link IndexBuilder}</span>
 84      */
 85     protected AbstractIndexWriter(HtmlConfiguration configuration,
 86                                   DocPath path,
<span class="line-modified"> 87                                   IndexBuilder indexbuilder) {</span>
 88         super(configuration, path);
<span class="line-modified"> 89         this.indexbuilder = indexbuilder;</span>
<span class="line-modified"> 90         this.navBar = new Navigation(null, configuration, fixedNavDiv, PageMode.INDEX, path);</span>
 91     }
 92 
 93     /**
 94      * Add the member information for the unicode character along with the
 95      * list of the members.
 96      *
 97      * @param uc Unicode for which member list information to be generated
 98      * @param memberlist List of members for the unicode character
 99      * @param contentTree the content tree to which the information will be added
100      */
101     protected void addContents(Character uc, Collection&lt;? extends Element&gt; memberlist,
102             Content contentTree) {
103         addHeading(uc, contentTree);
104         // Display the list only if there are elements to be displayed.
105         if (!memberlist.isEmpty()) {
106             Content dl = new HtmlTree(HtmlTag.DL);
107             for (Element element : memberlist) {
108                 addDescription(dl, element);
109             }
110             contentTree.add(dl);
</pre>
<hr />
<pre>
149                 i++;
150             }
151         }
152         if (i &gt;= memberListSize) {
153             while (j &lt; searchListSize) {
154                 addDescription(searchList.get(j), dl);
155                 j++;
156             }
157         }
158         if (j &gt;= searchListSize) {
159             while (i &lt; memberListSize) {
160                 addDescription(dl, memberlist.get(i));
161                 i++;
162             }
163         }
164         contentTree.add(dl);
165     }
166 
167     protected void addHeading(Character uc, Content contentTree) {
168         String unicode = uc.toString();
<span class="line-removed">169         contentTree.add(getMarkerAnchorForIndex(unicode));</span>
170         Content headContent = new StringContent(unicode);
<span class="line-modified">171         Content heading = HtmlTree.HEADING(Headings.CONTENT_HEADING, false,</span>
172                 HtmlStyle.title, headContent);

173         contentTree.add(heading);
174     }
175 

176     protected void addDescription(Content dl, Element element) {
177         SearchIndexItem si = new SearchIndexItem();
<span class="line-modified">178         new SimpleElementVisitor9&lt;Void, Void&gt;() {</span>
179 
180             @Override
181             public Void visitModule(ModuleElement e, Void p) {
182                 if (configuration.showModules) {
183                     addDescription(e, dl, si);
184                     configuration.moduleSearchIndex.add(si);
185                 }
186                 return null;
187             }
188 
189             @Override
190             public Void visitPackage(PackageElement e, Void p) {
191                 addDescription(e, dl, si);
192                 configuration.packageSearchIndex.add(si);
193                 return null;
194             }
195 
196             @Override
197             public Void visitType(TypeElement e, Void p) {
198                 addDescription(e, dl, si);
</pre>
<hr />
<pre>
321                 getDocLink(LinkInfoImpl.Kind.INDEX, member, name));
322         Content dt = HtmlTree.DT(span);
323         dt.add(&quot; - &quot;);
324         addMemberDesc(member, dt);
325         dlTree.add(dt);
326         Content dd = new HtmlTree(HtmlTag.DD);
327         addComment(member, dd);
328         dlTree.add(dd);
329     }
330 
331     protected void addDescription(SearchIndexItem sii, Content dlTree) {
332         String siiPath = pathToRoot.isEmpty() ? &quot;&quot; : pathToRoot.getPath() + &quot;/&quot;;
333         siiPath += sii.getUrl();
334         HtmlTree labelLink = HtmlTree.A(siiPath, new StringContent(sii.getLabel()));
335         Content dt = HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.searchTagLink, labelLink));
336         dt.add(&quot; - &quot;);
337         dt.add(contents.getContent(&quot;doclet.Search_tag_in&quot;, sii.getHolder()));
338         dlTree.add(dt);
339         Content dd = new HtmlTree(HtmlTag.DD);
340         if (sii.getDescription().isEmpty()) {
<span class="line-modified">341             dd.add(Contents.SPACE);</span>
342         } else {
343             dd.add(sii.getDescription());
344         }
345         dlTree.add(dd);
346     }
347 
348     /**
349      * Add comment for each element in the index. If the element is deprecated
350      * and it has a @deprecated tag, use that comment. Else if the containing
351      * class for this element is deprecated, then add the word &quot;Deprecated.&quot; at
352      * the start and then print the normal comment.
353      *
354      * @param element Index element
355      * @param contentTree the content tree to which the comment will be added
356      */
357     protected void addComment(Element element, Content contentTree) {
358         List&lt;? extends DocTree&gt; tags;
359         Content span = HtmlTree.SPAN(HtmlStyle.deprecatedLabel, getDeprecatedPhrase(element));
360         HtmlTree div = new HtmlTree(HtmlTag.DIV);
361         div.setStyle(HtmlStyle.deprecationBlock);
</pre>
<hr />
<pre>
390         TypeElement containing = utils.getEnclosingTypeElement(member);
391         String classdesc = utils.getTypeElementName(containing, true) + &quot; &quot;;
392         if (utils.isField(member)) {
393             Content resource = contents.getContent(utils.isStatic(member)
394                     ? &quot;doclet.Static_variable_in&quot;
395                     : &quot;doclet.Variable_in&quot;, classdesc);
396             contentTree.add(resource);
397         } else if (utils.isConstructor(member)) {
398             contentTree.add(
399                     contents.getContent(&quot;doclet.Constructor_for&quot;, classdesc));
400         } else if (utils.isMethod(member)) {
401             Content resource = contents.getContent(utils.isStatic(member)
402                     ? &quot;doclet.Static_method_in&quot;
403                     : &quot;doclet.Method_in&quot;, classdesc);
404             contentTree.add(resource);
405         }
406         addPreQualifiedClassLink(LinkInfoImpl.Kind.INDEX, containing,
407                 false, contentTree);
408     }
409 
<span class="line-removed">410     /**</span>
<span class="line-removed">411      * Get the marker anchor which will be added to the index documentation tree.</span>
<span class="line-removed">412      *</span>
<span class="line-removed">413      * @param anchorNameForIndex the anchor name attribute for index page</span>
<span class="line-removed">414      * @return a content tree for the marker anchor</span>
<span class="line-removed">415      */</span>
<span class="line-removed">416     public Content getMarkerAnchorForIndex(String anchorNameForIndex) {</span>
<span class="line-removed">417         return links.createAnchor(getNameForIndex(anchorNameForIndex), null);</span>
<span class="line-removed">418     }</span>
<span class="line-removed">419 </span>
420     /**
421      * Generate a valid HTML name for member index page.
422      *
423      * @param unicode the string that needs to be converted to valid HTML name.
424      * @return a valid HTML name string.
425      */
426     public String getNameForIndex(String unicode) {
427         return &quot;I:&quot; + links.getName(unicode);
428     }
429 
430     /**
431      * @throws DocFileIOException if there is a problem creating any of the search index files
432      */
433     protected void createSearchIndexFiles() throws DocFileIOException {
434         if (configuration.showModules) {
<span class="line-modified">435             createSearchIndexFile(DocPaths.MODULE_SEARCH_INDEX_JSON, DocPaths.MODULE_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">436                     DocPaths.MODULE_SEARCH_INDEX_JS, configuration.moduleSearchIndex, &quot;moduleSearchIndex&quot;);</span>

437         }
438         if (!configuration.packages.isEmpty()) {
439             SearchIndexItem si = new SearchIndexItem();
440             si.setCategory(SearchIndexItem.Category.PACKAGES);
441             si.setLabel(resources.getText(&quot;doclet.All_Packages&quot;));
442             si.setUrl(DocPaths.ALLPACKAGES_INDEX.getPath());
443             configuration.packageSearchIndex.add(si);
444         }
<span class="line-modified">445         createSearchIndexFile(DocPaths.PACKAGE_SEARCH_INDEX_JSON, DocPaths.PACKAGE_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">446                 DocPaths.PACKAGE_SEARCH_INDEX_JS, configuration.packageSearchIndex, &quot;packageSearchIndex&quot;);</span>

447         SearchIndexItem si = new SearchIndexItem();
448         si.setCategory(SearchIndexItem.Category.TYPES);
449         si.setLabel(resources.getText(&quot;doclet.All_Classes&quot;));
450         si.setUrl(DocPaths.ALLCLASSES_INDEX.getPath());
451         configuration.typeSearchIndex.add(si);
<span class="line-modified">452         createSearchIndexFile(DocPaths.TYPE_SEARCH_INDEX_JSON, DocPaths.TYPE_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">453                 DocPaths.TYPE_SEARCH_INDEX_JS, configuration.typeSearchIndex, &quot;typeSearchIndex&quot;);</span>
<span class="line-modified">454         createSearchIndexFile(DocPaths.MEMBER_SEARCH_INDEX_JSON, DocPaths.MEMBER_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">455                 DocPaths.MEMBER_SEARCH_INDEX_JS, configuration.memberSearchIndex, &quot;memberSearchIndex&quot;);</span>
<span class="line-modified">456         createSearchIndexFile(DocPaths.TAG_SEARCH_INDEX_JSON, DocPaths.TAG_SEARCH_INDEX_ZIP,</span>
<span class="line-modified">457                 DocPaths.TAG_SEARCH_INDEX_JS, configuration.tagSearchIndex, &quot;tagSearchIndex&quot;);</span>



458     }
459 
460     /**
461      * Creates a search index file.
462      *
<span class="line-removed">463      * @param searchIndexFile   the file to be generated</span>
<span class="line-removed">464      * @param searchIndexZip    the zip file to be generated</span>
465      * @param searchIndexJS     the file for the JavaScript to be generated
466      * @param searchIndex       the search index items
467      * @param varName           the variable name to write in the JavaScript file
468      * @throws DocFileIOException if there is a problem creating the search index file
469      */
<span class="line-modified">470     protected void createSearchIndexFile(DocPath searchIndexFile, DocPath searchIndexZip,</span>
<span class="line-modified">471             DocPath searchIndexJS, Collection&lt;SearchIndexItem&gt; searchIndex, String varName) throws DocFileIOException {</span>



472         if (!searchIndex.isEmpty()) {
473             StringBuilder searchVar = new StringBuilder(&quot;[&quot;);
474             boolean first = true;
475             for (SearchIndexItem item : searchIndex) {
476                 if (first) {
477                     searchVar.append(item.toString());
478                     first = false;
479                 } else {
480                     searchVar.append(&quot;,&quot;).append(item.toString());
481                 }
482             }
483             searchVar.append(&quot;]&quot;);
484             DocFile jsFile = DocFile.createFileForOutput(configuration, searchIndexJS);
485             try (Writer wr = jsFile.openWriter()) {
486                 wr.write(varName);
487                 wr.write(&quot; = &quot;);
488                 wr.write(searchVar.toString());
489             } catch (IOException ie) {
490                 throw new DocFileIOException(jsFile, DocFileIOException.Mode.WRITE, ie);
491             }
<span class="line-removed">492 </span>
<span class="line-removed">493             DocFile zipFile = DocFile.createFileForOutput(configuration, searchIndexZip);</span>
<span class="line-removed">494             try (OutputStream fos = zipFile.openOutputStream();</span>
<span class="line-removed">495                     ZipOutputStream zos = new ZipOutputStream(fos)) {</span>
<span class="line-removed">496                 try {</span>
<span class="line-removed">497                     ZipEntry ze = new ZipEntry(searchIndexFile.getPath());</span>
<span class="line-removed">498                     zos.putNextEntry(ze);</span>
<span class="line-removed">499                     zos.write(searchVar.toString().getBytes());</span>
<span class="line-removed">500                 } finally {</span>
<span class="line-removed">501                     zos.closeEntry();</span>
<span class="line-removed">502                 }</span>
<span class="line-removed">503             } catch (IOException ie) {</span>
<span class="line-removed">504                 throw new DocFileIOException(zipFile, DocFileIOException.Mode.WRITE, ie);</span>
<span class="line-removed">505             }</span>
506         }
507     }
508 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.formats.html;
 27 
<span class="line-modified"> 28 import java.io.IOException;</span>
<span class="line-modified"> 29 import java.io.Writer;</span>
<span class="line-modified"> 30 import java.util.Collection;</span>
<span class="line-added"> 31 import java.util.List;</span>
 32 
 33 import javax.lang.model.element.Element;
 34 import javax.lang.model.element.ExecutableElement;
 35 import javax.lang.model.element.ModuleElement;
 36 import javax.lang.model.element.PackageElement;
 37 import javax.lang.model.element.TypeElement;
<span class="line-modified"> 38 import javax.lang.model.util.SimpleElementVisitor14;</span>
 39 
 40 import com.sun.source.doctree.DocTree;
<span class="line-added"> 41 import jdk.javadoc.internal.doclets.formats.html.markup.Entity;</span>
 42 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
 43 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
 44 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
 45 import jdk.javadoc.internal.doclets.formats.html.markup.Navigation;
 46 import jdk.javadoc.internal.doclets.formats.html.markup.Navigation.PageMode;
 47 import jdk.javadoc.internal.doclets.formats.html.markup.StringContent;
 48 import jdk.javadoc.internal.doclets.toolkit.Content;
 49 import jdk.javadoc.internal.doclets.toolkit.util.DocFile;
 50 import jdk.javadoc.internal.doclets.toolkit.util.DocFileIOException;
 51 import jdk.javadoc.internal.doclets.toolkit.util.DocPath;
 52 import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
 53 import jdk.javadoc.internal.doclets.toolkit.util.IndexBuilder;
 54 
 55 /**
 56  * Generate Index for all the Member Names with Indexing in
 57  * Unicode Order. This class is a base class for {@link SingleIndexWriter} and
 58  * {@link SplitIndexWriter}. It uses the functionality from
 59  * {@link HtmlDocletWriter} to generate the Index Contents.
 60  *
 61  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 62  *  If you write code that depends on this, you do so at your own risk.
 63  *  This code and its internal interfaces are subject to change or
 64  *  deletion without notice.&lt;/b&gt;
 65  *
 66  * @see    IndexBuilder


 67  */
 68 public class AbstractIndexWriter extends HtmlDocletWriter {
 69 
 70     /**
 71      * The index of all the members with unicode character.
 72      */
<span class="line-modified"> 73     protected IndexBuilder indexBuilder;</span>
 74 
 75     protected Navigation navBar;
 76 
 77     /**
 78      * This constructor will be used by {@link SplitIndexWriter}. Initializes
 79      * path to this file and relative path from this file.
 80      *
 81      * @param configuration  The current configuration
 82      * @param path       Path to the file which is getting generated.
<span class="line-modified"> 83      * @param indexBuilder Unicode based Index from {@link IndexBuilder}</span>
 84      */
 85     protected AbstractIndexWriter(HtmlConfiguration configuration,
 86                                   DocPath path,
<span class="line-modified"> 87                                   IndexBuilder indexBuilder) {</span>
 88         super(configuration, path);
<span class="line-modified"> 89         this.indexBuilder = indexBuilder;</span>
<span class="line-modified"> 90         this.navBar = new Navigation(null, configuration, PageMode.INDEX, path);</span>
 91     }
 92 
 93     /**
 94      * Add the member information for the unicode character along with the
 95      * list of the members.
 96      *
 97      * @param uc Unicode for which member list information to be generated
 98      * @param memberlist List of members for the unicode character
 99      * @param contentTree the content tree to which the information will be added
100      */
101     protected void addContents(Character uc, Collection&lt;? extends Element&gt; memberlist,
102             Content contentTree) {
103         addHeading(uc, contentTree);
104         // Display the list only if there are elements to be displayed.
105         if (!memberlist.isEmpty()) {
106             Content dl = new HtmlTree(HtmlTag.DL);
107             for (Element element : memberlist) {
108                 addDescription(dl, element);
109             }
110             contentTree.add(dl);
</pre>
<hr />
<pre>
149                 i++;
150             }
151         }
152         if (i &gt;= memberListSize) {
153             while (j &lt; searchListSize) {
154                 addDescription(searchList.get(j), dl);
155                 j++;
156             }
157         }
158         if (j &gt;= searchListSize) {
159             while (i &lt; memberListSize) {
160                 addDescription(dl, memberlist.get(i));
161                 i++;
162             }
163         }
164         contentTree.add(dl);
165     }
166 
167     protected void addHeading(Character uc, Content contentTree) {
168         String unicode = uc.toString();

169         Content headContent = new StringContent(unicode);
<span class="line-modified">170         HtmlTree heading = HtmlTree.HEADING(Headings.CONTENT_HEADING, false,</span>
171                 HtmlStyle.title, headContent);
<span class="line-added">172         heading.setId(getNameForIndex(unicode));</span>
173         contentTree.add(heading);
174     }
175 
<span class="line-added">176     @SuppressWarnings(&quot;preview&quot;)</span>
177     protected void addDescription(Content dl, Element element) {
178         SearchIndexItem si = new SearchIndexItem();
<span class="line-modified">179         new SimpleElementVisitor14&lt;Void, Void&gt;() {</span>
180 
181             @Override
182             public Void visitModule(ModuleElement e, Void p) {
183                 if (configuration.showModules) {
184                     addDescription(e, dl, si);
185                     configuration.moduleSearchIndex.add(si);
186                 }
187                 return null;
188             }
189 
190             @Override
191             public Void visitPackage(PackageElement e, Void p) {
192                 addDescription(e, dl, si);
193                 configuration.packageSearchIndex.add(si);
194                 return null;
195             }
196 
197             @Override
198             public Void visitType(TypeElement e, Void p) {
199                 addDescription(e, dl, si);
</pre>
<hr />
<pre>
322                 getDocLink(LinkInfoImpl.Kind.INDEX, member, name));
323         Content dt = HtmlTree.DT(span);
324         dt.add(&quot; - &quot;);
325         addMemberDesc(member, dt);
326         dlTree.add(dt);
327         Content dd = new HtmlTree(HtmlTag.DD);
328         addComment(member, dd);
329         dlTree.add(dd);
330     }
331 
332     protected void addDescription(SearchIndexItem sii, Content dlTree) {
333         String siiPath = pathToRoot.isEmpty() ? &quot;&quot; : pathToRoot.getPath() + &quot;/&quot;;
334         siiPath += sii.getUrl();
335         HtmlTree labelLink = HtmlTree.A(siiPath, new StringContent(sii.getLabel()));
336         Content dt = HtmlTree.DT(HtmlTree.SPAN(HtmlStyle.searchTagLink, labelLink));
337         dt.add(&quot; - &quot;);
338         dt.add(contents.getContent(&quot;doclet.Search_tag_in&quot;, sii.getHolder()));
339         dlTree.add(dt);
340         Content dd = new HtmlTree(HtmlTag.DD);
341         if (sii.getDescription().isEmpty()) {
<span class="line-modified">342             dd.add(Entity.NO_BREAK_SPACE);</span>
343         } else {
344             dd.add(sii.getDescription());
345         }
346         dlTree.add(dd);
347     }
348 
349     /**
350      * Add comment for each element in the index. If the element is deprecated
351      * and it has a @deprecated tag, use that comment. Else if the containing
352      * class for this element is deprecated, then add the word &quot;Deprecated.&quot; at
353      * the start and then print the normal comment.
354      *
355      * @param element Index element
356      * @param contentTree the content tree to which the comment will be added
357      */
358     protected void addComment(Element element, Content contentTree) {
359         List&lt;? extends DocTree&gt; tags;
360         Content span = HtmlTree.SPAN(HtmlStyle.deprecatedLabel, getDeprecatedPhrase(element));
361         HtmlTree div = new HtmlTree(HtmlTag.DIV);
362         div.setStyle(HtmlStyle.deprecationBlock);
</pre>
<hr />
<pre>
391         TypeElement containing = utils.getEnclosingTypeElement(member);
392         String classdesc = utils.getTypeElementName(containing, true) + &quot; &quot;;
393         if (utils.isField(member)) {
394             Content resource = contents.getContent(utils.isStatic(member)
395                     ? &quot;doclet.Static_variable_in&quot;
396                     : &quot;doclet.Variable_in&quot;, classdesc);
397             contentTree.add(resource);
398         } else if (utils.isConstructor(member)) {
399             contentTree.add(
400                     contents.getContent(&quot;doclet.Constructor_for&quot;, classdesc));
401         } else if (utils.isMethod(member)) {
402             Content resource = contents.getContent(utils.isStatic(member)
403                     ? &quot;doclet.Static_method_in&quot;
404                     : &quot;doclet.Method_in&quot;, classdesc);
405             contentTree.add(resource);
406         }
407         addPreQualifiedClassLink(LinkInfoImpl.Kind.INDEX, containing,
408                 false, contentTree);
409     }
410 










411     /**
412      * Generate a valid HTML name for member index page.
413      *
414      * @param unicode the string that needs to be converted to valid HTML name.
415      * @return a valid HTML name string.
416      */
417     public String getNameForIndex(String unicode) {
418         return &quot;I:&quot; + links.getName(unicode);
419     }
420 
421     /**
422      * @throws DocFileIOException if there is a problem creating any of the search index files
423      */
424     protected void createSearchIndexFiles() throws DocFileIOException {
425         if (configuration.showModules) {
<span class="line-modified">426             createSearchIndexFile(DocPaths.MODULE_SEARCH_INDEX_JS,</span>
<span class="line-modified">427                                   configuration.moduleSearchIndex,</span>
<span class="line-added">428                                   &quot;moduleSearchIndex&quot;);</span>
429         }
430         if (!configuration.packages.isEmpty()) {
431             SearchIndexItem si = new SearchIndexItem();
432             si.setCategory(SearchIndexItem.Category.PACKAGES);
433             si.setLabel(resources.getText(&quot;doclet.All_Packages&quot;));
434             si.setUrl(DocPaths.ALLPACKAGES_INDEX.getPath());
435             configuration.packageSearchIndex.add(si);
436         }
<span class="line-modified">437         createSearchIndexFile(DocPaths.PACKAGE_SEARCH_INDEX_JS,</span>
<span class="line-modified">438                               configuration.packageSearchIndex,</span>
<span class="line-added">439                               &quot;packageSearchIndex&quot;);</span>
440         SearchIndexItem si = new SearchIndexItem();
441         si.setCategory(SearchIndexItem.Category.TYPES);
442         si.setLabel(resources.getText(&quot;doclet.All_Classes&quot;));
443         si.setUrl(DocPaths.ALLCLASSES_INDEX.getPath());
444         configuration.typeSearchIndex.add(si);
<span class="line-modified">445         createSearchIndexFile(DocPaths.TYPE_SEARCH_INDEX_JS,</span>
<span class="line-modified">446                               configuration.typeSearchIndex,</span>
<span class="line-modified">447                               &quot;typeSearchIndex&quot;);</span>
<span class="line-modified">448         createSearchIndexFile(DocPaths.MEMBER_SEARCH_INDEX_JS,</span>
<span class="line-modified">449                               configuration.memberSearchIndex,</span>
<span class="line-modified">450                               &quot;memberSearchIndex&quot;);</span>
<span class="line-added">451         createSearchIndexFile(DocPaths.TAG_SEARCH_INDEX_JS,</span>
<span class="line-added">452                               configuration.tagSearchIndex,</span>
<span class="line-added">453                               &quot;tagSearchIndex&quot;);</span>
454     }
455 
456     /**
457      * Creates a search index file.
458      *


459      * @param searchIndexJS     the file for the JavaScript to be generated
460      * @param searchIndex       the search index items
461      * @param varName           the variable name to write in the JavaScript file
462      * @throws DocFileIOException if there is a problem creating the search index file
463      */
<span class="line-modified">464     protected void createSearchIndexFile(DocPath searchIndexJS,</span>
<span class="line-modified">465                                          Collection&lt;SearchIndexItem&gt; searchIndex,</span>
<span class="line-added">466                                          String varName)</span>
<span class="line-added">467             throws DocFileIOException</span>
<span class="line-added">468     {</span>
469         if (!searchIndex.isEmpty()) {
470             StringBuilder searchVar = new StringBuilder(&quot;[&quot;);
471             boolean first = true;
472             for (SearchIndexItem item : searchIndex) {
473                 if (first) {
474                     searchVar.append(item.toString());
475                     first = false;
476                 } else {
477                     searchVar.append(&quot;,&quot;).append(item.toString());
478                 }
479             }
480             searchVar.append(&quot;]&quot;);
481             DocFile jsFile = DocFile.createFileForOutput(configuration, searchIndexJS);
482             try (Writer wr = jsFile.openWriter()) {
483                 wr.write(varName);
484                 wr.write(&quot; = &quot;);
485                 wr.write(searchVar.toString());
486             } catch (IOException ie) {
487                 throw new DocFileIOException(jsFile, DocFileIOException.Mode.WRITE, ie);
488             }














489         }
490     }
491 }
</pre>
</td>
</tr>
</table>
<center><a href="AbstractExecutableMemberWriter.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="AbstractMemberWriter.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>