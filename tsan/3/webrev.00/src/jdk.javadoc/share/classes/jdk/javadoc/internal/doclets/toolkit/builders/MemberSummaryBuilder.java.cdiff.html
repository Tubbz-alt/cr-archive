<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/MemberSummaryBuilder.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FieldBuilder.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="MethodBuilder.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/toolkit/builders/MemberSummaryBuilder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2003, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 36,10 ***</span>
<span class="line-new-header">--- 36,11 ---</span>
  import javax.lang.model.util.ElementFilter;
  
  import com.sun.source.doctree.DocCommentTree;
  import com.sun.source.doctree.DocTree;
  import com.sun.source.doctree.DocTree.Kind;
<span class="line-added">+ import com.sun.source.doctree.UnknownBlockTagTree;</span>
  import jdk.javadoc.internal.doclets.toolkit.AnnotationTypeWriter;
  import jdk.javadoc.internal.doclets.toolkit.ClassWriter;
  import jdk.javadoc.internal.doclets.toolkit.Content;
  import jdk.javadoc.internal.doclets.toolkit.MemberSummaryWriter;
  import jdk.javadoc.internal.doclets.toolkit.WriterFactory;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 58,13 ***</span>
   *
   *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
   *  If you write code that depends on this, you do so at your own risk.
   *  This code and its internal interfaces are subject to change or
   *  deletion without notice.&lt;/b&gt;
<span class="line-removed">-  *</span>
<span class="line-removed">-  * @author Jamie Ho</span>
<span class="line-removed">-  * @author Bhavesh Patel (Modified)</span>
   */
  public abstract class MemberSummaryBuilder extends AbstractMemberBuilder {
  
      /*
       * Comparator used to sort the members in the summary.
<span class="line-new-header">--- 59,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 314,15 ***</span>
                  if (property != null) {
                      processProperty(member, property);
                  }
                  List&lt;? extends DocTree&gt; firstSentenceTags = utils.getFirstSentenceTrees(member);
                  if (utils.isExecutableElement(member) &amp;&amp; firstSentenceTags.isEmpty()) {
<span class="line-modified">!                     //Inherit comments from overriden or implemented method if</span>
                      //necessary.
                      DocFinder.Output inheritedDoc =
                              DocFinder.search(configuration,
<span class="line-modified">!                                     new DocFinder.Input(utils, (ExecutableElement) member));</span>
                      if (inheritedDoc.holder != null
                              &amp;&amp; !utils.getFirstSentenceTrees(inheritedDoc.holder).isEmpty()) {
                          // let the comment helper know of the overridden element
                          CommentHelper ch = utils.getCommentHelper(member);
                          ch.setOverrideElement(inheritedDoc.holder);
<span class="line-new-header">--- 312,15 ---</span>
                  if (property != null) {
                      processProperty(member, property);
                  }
                  List&lt;? extends DocTree&gt; firstSentenceTags = utils.getFirstSentenceTrees(member);
                  if (utils.isExecutableElement(member) &amp;&amp; firstSentenceTags.isEmpty()) {
<span class="line-modified">!                     //Inherit comments from overridden or implemented method if</span>
                      //necessary.
                      DocFinder.Output inheritedDoc =
                              DocFinder.search(configuration,
<span class="line-modified">!                                     new DocFinder.Input(utils, member));</span>
                      if (inheritedDoc.holder != null
                              &amp;&amp; !utils.getFirstSentenceTrees(inheritedDoc.holder).isEmpty()) {
                          // let the comment helper know of the overridden element
                          CommentHelper ch = utils.getCommentHelper(member);
                          ch.setOverrideElement(inheritedDoc.holder);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 366,11 ***</span>
                  String text = MessageFormat.format(
                          resources.getText(&quot;doclet.PropertyGetterWithName&quot;),
                          utils.propertyName((ExecutableElement) member));
                  fullBody.addAll(cmtutils.makeFirstSentenceTree(text));
              }
<span class="line-modified">!             List&lt;? extends DocTree&gt; propertyTags = utils.getBlockTags(property, &quot;propertyDescription&quot;);</span>
              if (propertyTags.isEmpty()) {
                  List&lt;? extends DocTree&gt; comment = utils.getFullBody(property);
                  blockTags.addAll(cmtutils.makePropertyDescriptionTree(comment));
              }
          } else {
<span class="line-new-header">--- 364,13 ---</span>
                  String text = MessageFormat.format(
                          resources.getText(&quot;doclet.PropertyGetterWithName&quot;),
                          utils.propertyName((ExecutableElement) member));
                  fullBody.addAll(cmtutils.makeFirstSentenceTree(text));
              }
<span class="line-modified">!             List&lt;? extends DocTree&gt; propertyTags = utils.getBlockTags(property,</span>
<span class="line-added">+                     t -&gt; (t instanceof UnknownBlockTagTree)</span>
<span class="line-added">+                             &amp;&amp; ((UnknownBlockTagTree) t).getTagName().equals(&quot;propertyDescription&quot;));</span>
              if (propertyTags.isEmpty()) {
                  List&lt;? extends DocTree&gt; comment = utils.getFullBody(property);
                  blockTags.addAll(cmtutils.makePropertyDescriptionTree(comment));
              }
          } else {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 379,18 ***</span>
  
          // copy certain tags
          List&lt;? extends DocTree&gt; tags = utils.getBlockTags(property, Kind.SINCE);
          blockTags.addAll(tags);
  
<span class="line-modified">!         List&lt;? extends DocTree&gt; bTags = utils.getBlockTags(property, Kind.UNKNOWN_BLOCK_TAG);</span>
<span class="line-modified">!         CommentHelper ch = utils.getCommentHelper(property);</span>
<span class="line-modified">!         for (DocTree dt : bTags) {</span>
<span class="line-modified">!             String tagName = ch.getTagName(dt);</span>
<span class="line-removed">-             if ( &quot;defaultValue&quot;.equals(tagName)) {</span>
<span class="line-removed">-                 blockTags.add(dt);</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
  
          //add @see tags
          if (!isGetter &amp;&amp; !isSetter) {
              ExecutableElement getter = pHelper.getGetterForProperty((ExecutableElement)member);
              ExecutableElement setter = pHelper.getSetterForProperty((ExecutableElement)member);
<span class="line-new-header">--- 379,14 ---</span>
  
          // copy certain tags
          List&lt;? extends DocTree&gt; tags = utils.getBlockTags(property, Kind.SINCE);
          blockTags.addAll(tags);
  
<span class="line-modified">!         List&lt;? extends DocTree&gt; bTags = utils.getBlockTags(property,</span>
<span class="line-modified">!                 t -&gt; (t instanceof UnknownBlockTagTree)</span>
<span class="line-modified">!                         &amp;&amp; ((UnknownBlockTagTree) t).getTagName().equals(&quot;defaultValue&quot;));</span>
<span class="line-modified">!         blockTags.addAll(bTags);</span>
  
          //add @see tags
          if (!isGetter &amp;&amp; !isSetter) {
              ExecutableElement getter = pHelper.getGetterForProperty((ExecutableElement)member);
              ExecutableElement setter = pHelper.getSetterForProperty((ExecutableElement)member);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 409,11 ***</span>
                      sb.append(&quot;(&quot;).append(utils.getTypeSignature(param.asType(), false, true)).append(&quot;)&quot;);
                  }
                  blockTags.add(cmtutils.makeSeeTree(sb.toString(), setter));
              }
          }
<span class="line-modified">!         cmtutils.setDocCommentTree(member, fullBody, blockTags, utils);</span>
      }
  
      /**
       * Test whether the method is a getter.
       * @param element property method documentation. Needs to be either property
<span class="line-new-header">--- 405,11 ---</span>
                      sb.append(&quot;(&quot;).append(utils.getTypeSignature(param.asType(), false, true)).append(&quot;)&quot;);
                  }
                  blockTags.add(cmtutils.makeSeeTree(sb.toString(), setter));
              }
          }
<span class="line-modified">!         cmtutils.setDocCommentTree(member, fullBody, blockTags);</span>
      }
  
      /**
       * Test whether the method is a getter.
       * @param element property method documentation. Needs to be either property
</pre>
<hr />
<pre>
<span class="line-old-header">*** 463,19 ***</span>
                  inheritedMembers.addAll(members);
                  Content inheritedTree = writer.getInheritedSummaryHeader(inheritedClass);
                  Content linksTree = writer.getInheritedSummaryLinksTree();
                  addSummaryFootNote(inheritedClass, inheritedMembers, linksTree, writer);
                  inheritedTree.add(linksTree);
<span class="line-modified">!                 summaryTreeList.add(writer.getMemberTree(inheritedTree));</span>
              }
          }
      }
  
      private void addSummaryFootNote(TypeElement inheritedClass, SortedSet&lt;Element&gt; inheritedMembers,
                                      Content linksTree, MemberSummaryWriter writer) {
          for (Element member : inheritedMembers) {
<span class="line-modified">!             TypeElement t = (utils.isPackagePrivate(inheritedClass) &amp;&amp; !utils.isLinkable(inheritedClass))</span>
                      ? typeElement : inheritedClass;
              writer.addInheritedMemberSummary(t, member, inheritedMembers.first() == member,
                      inheritedMembers.last() == member, linksTree);
          }
      }
<span class="line-new-header">--- 459,19 ---</span>
                  inheritedMembers.addAll(members);
                  Content inheritedTree = writer.getInheritedSummaryHeader(inheritedClass);
                  Content linksTree = writer.getInheritedSummaryLinksTree();
                  addSummaryFootNote(inheritedClass, inheritedMembers, linksTree, writer);
                  inheritedTree.add(linksTree);
<span class="line-modified">!                 summaryTreeList.add(inheritedTree);</span>
              }
          }
      }
  
      private void addSummaryFootNote(TypeElement inheritedClass, SortedSet&lt;Element&gt; inheritedMembers,
                                      Content linksTree, MemberSummaryWriter writer) {
          for (Element member : inheritedMembers) {
<span class="line-modified">!             TypeElement t = utils.isUndocumentedEnclosure(inheritedClass)</span>
                      ? typeElement : inheritedClass;
              writer.addInheritedMemberSummary(t, member, inheritedMembers.first() == member,
                      inheritedMembers.last() == member, linksTree);
          }
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 487,19 ***</span>
       * @param kind the kind of members to document.
       * @param showInheritedSummary true if inherited summary should be documented
       * @param memberSummaryTree the content tree to which the documentation will be added
       */
      private void addSummary(MemberSummaryWriter writer,
<span class="line-modified">!             VisibleMemberTable.Kind kind, boolean showInheritedSummary,</span>
<span class="line-modified">!             Content memberSummaryTree) {</span>
          LinkedList&lt;Content&gt; summaryTreeList = new LinkedList&lt;&gt;();
          buildSummary(writer, kind, summaryTreeList);
          if (showInheritedSummary)
              buildInheritedSummary(writer, kind, summaryTreeList);
          if (!summaryTreeList.isEmpty()) {
              Content memberTree = writer.getMemberSummaryHeader(typeElement, memberSummaryTree);
<span class="line-modified">!             summaryTreeList.stream().forEach(memberTree::add);</span>
              writer.addMemberTree(memberSummaryTree, memberTree);
          }
      }
  
      private SortedSet&lt;? extends Element&gt; asSortedSet(Collection&lt;? extends Element&gt; members) {
<span class="line-new-header">--- 483,21 ---</span>
       * @param kind the kind of members to document.
       * @param showInheritedSummary true if inherited summary should be documented
       * @param memberSummaryTree the content tree to which the documentation will be added
       */
      private void addSummary(MemberSummaryWriter writer,
<span class="line-modified">!                             VisibleMemberTable.Kind kind,</span>
<span class="line-modified">!                             boolean showInheritedSummary,</span>
<span class="line-added">+                             Content memberSummaryTree)</span>
<span class="line-added">+     {</span>
          LinkedList&lt;Content&gt; summaryTreeList = new LinkedList&lt;&gt;();
          buildSummary(writer, kind, summaryTreeList);
          if (showInheritedSummary)
              buildInheritedSummary(writer, kind, summaryTreeList);
          if (!summaryTreeList.isEmpty()) {
              Content memberTree = writer.getMemberSummaryHeader(typeElement, memberSummaryTree);
<span class="line-modified">!             summaryTreeList.forEach(memberTree::add);</span>
              writer.addMemberTree(memberSummaryTree, memberTree);
          }
      }
  
      private SortedSet&lt;? extends Element&gt; asSortedSet(Collection&lt;? extends Element&gt; members) {
</pre>
<center><a href="FieldBuilder.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="MethodBuilder.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>