<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.javadoc/share/classes/jdk/javadoc/internal/doclets/formats/html/FrameOutputWriter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 1997, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.javadoc.internal.doclets.formats.html;
 27 
 28 import jdk.javadoc.internal.doclets.formats.html.markup.Head;
 29 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlAttr;
 30 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlDocument;
 31 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlStyle;
 32 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTag;
 33 import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;
 34 import jdk.javadoc.internal.doclets.formats.html.markup.Script;
 35 import jdk.javadoc.internal.doclets.toolkit.Content;
 36 import jdk.javadoc.internal.doclets.toolkit.util.DocFile;
 37 import jdk.javadoc.internal.doclets.toolkit.util.DocFileIOException;
 38 import jdk.javadoc.internal.doclets.toolkit.util.DocPath;
 39 import jdk.javadoc.internal.doclets.toolkit.util.DocPaths;
 40 
 41 
 42 /**
 43  * Generate the documentation in the Html &quot;frame&quot; format in the browser. The
 44  * generated documentation will have two or three frames depending upon the
 45  * number of packages on the command line. In general there will be three frames
 46  * in the output, a left-hand top frame will have a list of all packages with
 47  * links to target left-hand bottom frame. The left-hand bottom frame will have
 48  * the particular package contents or the all-classes list, where as the single
 49  * right-hand frame will have overview or package summary or class file. Also
 50  * take care of browsers which do not support Html frames.
 51  *
 52  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
 53  *  If you write code that depends on this, you do so at your own risk.
 54  *  This code and its internal interfaces are subject to change or
 55  *  deletion without notice.&lt;/b&gt;
 56  *
 57  * @author Atul M Dambalkar
 58  */
 59 public class FrameOutputWriter extends HtmlDocletWriter {
 60 
 61     /**
 62      * Number of packages specified on the command line.
 63      */
 64     int noOfPackages;
 65 
 66     /**
 67      * Constructor to construct FrameOutputWriter object.
 68      *
 69      * @param configuration for this run
 70      * @param filename File to be generated.
 71      */
 72     public FrameOutputWriter(HtmlConfiguration configuration, DocPath filename) {
 73         super(configuration, filename);
 74         noOfPackages = configuration.packages.size();
 75     }
 76 
 77     /**
 78      * Construct FrameOutputWriter object and then use it to generate the Html
 79      * file which will have the description of all the frames in the
 80      * documentation. The name of the generated file is &quot;index.html&quot; which is
 81      * the default first file for Html documents.
 82      * @param configuration the configuration for this doclet
 83      * @throws DocFileIOException if there is a problem generating the frame file
 84      */
 85     public static void generate(HtmlConfiguration configuration) throws DocFileIOException {
 86         FrameOutputWriter framegen = new FrameOutputWriter(configuration, DocPaths.INDEX);
 87         framegen.generateFrameFile();
 88     }
 89 
 90     /**
 91      * Generate the constants in the &quot;index.html&quot; file. Print the frame details
 92      * as well as warning if browser is not supporting the Html frames.
 93      * @throws DocFileIOException if there is a problem generating the frame file
 94      */
 95     protected void generateFrameFile() throws DocFileIOException {
 96         Content frame = getFrameDetails();
 97         HtmlTree body = new HtmlTree(HtmlTag.BODY);
 98         body.put(HtmlAttr.CLASS, &quot;frames&quot;);
 99         body.put(HtmlAttr.ONLOAD, &quot;loadFrames()&quot;);
100         String topFilePath = configuration.topFile.getPath();
101         Script script = new Script(
102                 &quot;\nif (targetPage == \&quot;\&quot; || targetPage == \&quot;undefined\&quot;)\n&quot; +
103                 &quot;     window.location.replace(&quot;)
104                 .appendStringLiteral(topFilePath, &#39;\&#39;&#39;)
105                 .append(&quot;);\n&quot;);
106         body.add(script.asContent());
107         Content noScript = HtmlTree.NOSCRIPT(contents.noScriptMessage);
108         body.add(noScript);
109         HtmlTree main = HtmlTree.MAIN(frame);
110         body.add(main);
111         if (configuration.windowtitle.length() &gt; 0) {
112             printFramesDocument(configuration.windowtitle, body);
113         } else {
114             printFramesDocument(resources.getText(&quot;doclet.Generated_Docs_Untitled&quot;), body);
115         }
116     }
117 
118     /**
119      * Print the frames version of the Html file header.
120      * Called only when generating an HTML frames file.
121      *
122      * @param title Title of this HTML document
123      * @param body the body content tree to be added to the HTML document
124      * @throws DocFileIOException if there is an error writing the frames document
125      */
126     private void printFramesDocument(String title, HtmlTree body) throws DocFileIOException {
127         Content htmlComment = contents.newPage;
128         Head head = new Head(path, configuration.docletVersion)
129                 .setTimestamp(!configuration.notimestamp)
130                 .setTitle(title)
131                 .setDescription(&quot;frames&quot;)
132                 .setGenerator(getGenerator(getClass()))
133                 .setCharset(configuration.charset)
134                 .setStylesheets(configuration.getMainStylesheet(), configuration.getAdditionalStylesheets())
135                 .addDefaultScript(false)
136                 .addScript(getFramesScript());
137 
138         Content htmlTree = HtmlTree.HTML(configuration.getLocale().getLanguage(), head.toContent(), body);
139         HtmlDocument htmlDocument = new HtmlDocument(htmlComment, htmlTree);
140         htmlDocument.write(DocFile.createFileForOutput(configuration, path));
141    }
142 
143     /**
144      * Get the frame sizes and their contents.
145      *
146      * @return a content tree for the frame details
147      */
148     protected Content getFrameDetails() {
149         HtmlTree leftContainerDiv = new HtmlTree(HtmlTag.DIV);
150         HtmlTree rightContainerDiv = new HtmlTree(HtmlTag.DIV);
151         leftContainerDiv.setStyle(HtmlStyle.leftContainer);
152         rightContainerDiv.setStyle(HtmlStyle.rightContainer);
153         if (configuration.showModules &amp;&amp; configuration.modules.size() &gt; 1) {
154             addAllModulesFrameTag(leftContainerDiv);
155         } else if (noOfPackages &gt; 1) {
156             addAllPackagesFrameTag(leftContainerDiv);
157         }
158         addAllClassesFrameTag(leftContainerDiv);
159         addClassFrameTag(rightContainerDiv);
160         HtmlTree mainContainer = HtmlTree.DIV(HtmlStyle.mainContainer, leftContainerDiv);
161         mainContainer.add(rightContainerDiv);
162         return mainContainer;
163     }
164 
165     /**
166      * Add the IFRAME tag for the frame that lists all modules.
167      *
168      * @param contentTree to which the information will be added
169      */
170     private void addAllModulesFrameTag(Content contentTree) {
171         HtmlTree frame = HtmlTree.IFRAME(DocPaths.MODULE_OVERVIEW_FRAME.getPath(),
172                 &quot;packageListFrame&quot;, resources.getText(&quot;doclet.All_Modules&quot;));
173         HtmlTree leftTop = HtmlTree.DIV(HtmlStyle.leftTop, frame);
174         contentTree.add(leftTop);
175     }
176 
177     /**
178      * Add the IFRAME tag for the frame that lists all packages.
179      *
180      * @param contentTree the content tree to which the information will be added
181      */
182     private void addAllPackagesFrameTag(Content contentTree) {
183         HtmlTree frame = HtmlTree.IFRAME(DocPaths.OVERVIEW_FRAME.getPath(),
184                 &quot;packageListFrame&quot;, resources.getText(&quot;doclet.All_Packages&quot;));
185         HtmlTree leftTop = HtmlTree.DIV(HtmlStyle.leftTop, frame);
186         contentTree.add(leftTop);
187     }
188 
189     /**
190      * Add the IFRAME tag for the frame that lists all classes.
191      *
192      * @param contentTree the content tree to which the information will be added
193      */
194     private void addAllClassesFrameTag(Content contentTree) {
195         HtmlTree frame = HtmlTree.IFRAME(DocPaths.ALLCLASSES_FRAME.getPath(),
196                 &quot;packageFrame&quot;, resources.getText(&quot;doclet.All_classes_and_interfaces&quot;));
197         HtmlTree leftBottom = HtmlTree.DIV(HtmlStyle.leftBottom, frame);
198         contentTree.add(leftBottom);
199     }
200 
201     /**
202      * Add the IFRAME tag for the frame that describes the class in detail.
203      *
204      * @param contentTree the content tree to which the information will be added
205      */
206     private void addClassFrameTag(Content contentTree) {
207         HtmlTree frame = HtmlTree.IFRAME(configuration.topFile.getPath(), &quot;classFrame&quot;,
208                 resources.getText(&quot;doclet.Package_class_and_interface_descriptions&quot;));
209         frame.setStyle(HtmlStyle.rightIframe);
210         contentTree.add(frame);
211     }
212 
213     /**
214      * Returns a content tree for the SCRIPT tag for the main page(index.html).
215      *
216      * @return a content for the SCRIPT tag
217      */
218     protected Script getFramesScript() {
219         return new Script(&quot;\n&quot; +
220                 &quot;    tmpTargetPage = \&quot;\&quot; + window.location.search;\n&quot; +
221                 &quot;    if (tmpTargetPage != \&quot;\&quot; &amp;&amp; tmpTargetPage != \&quot;undefined\&quot;)\n&quot; +
222                 &quot;        tmpTargetPage = tmpTargetPage.substring(1);\n&quot; +
223                 &quot;    if (tmpTargetPage.indexOf(\&quot;:\&quot;) != -1 || (tmpTargetPage != \&quot;\&quot; &amp;&amp; !validURL(tmpTargetPage)))\n&quot; +
224                 &quot;        tmpTargetPage = \&quot;undefined\&quot;;\n&quot; +
225                 &quot;    targetPage = tmpTargetPage;\n&quot; +
226                 &quot;    function validURL(url) {\n&quot; +
227                 &quot;        try {\n&quot; +
228                 &quot;            url = decodeURIComponent(url);\n&quot; +
229                 &quot;        }\n&quot; +
230                 &quot;        catch (error) {\n&quot; +
231                 &quot;            return false;\n&quot; +
232                 &quot;        }\n&quot; +
233                 &quot;        var pos = url.indexOf(\&quot;.html\&quot;);\n&quot; +
234                 &quot;        if (pos == -1 || pos != url.length - 5)\n&quot; +
235                 &quot;            return false;\n&quot; +
236                 &quot;        var allowNumber = false;\n&quot; +
237                 &quot;        var allowSep = false;\n&quot; +
238                 &quot;        var seenDot = false;\n&quot; +
239                 &quot;        for (var i = 0; i &lt; url.length - 5; i++) {\n&quot; +
240                 &quot;            var ch = url.charAt(i);\n&quot; +
241                 &quot;            if (&#39;a&#39; &lt;= ch &amp;&amp; ch &lt;= &#39;z&#39; ||\n&quot; +
242                 &quot;                    &#39;A&#39; &lt;= ch &amp;&amp; ch &lt;= &#39;Z&#39; ||\n&quot; +
243                 &quot;                    ch == &#39;$&#39; ||\n&quot; +
244                 &quot;                    ch == &#39;_&#39; ||\n&quot; +
245                 &quot;                    ch.charCodeAt(0) &gt; 127) {\n&quot; +
246                 &quot;                allowNumber = true;\n&quot; +
247                 &quot;                allowSep = true;\n&quot; +
248                 &quot;            } else if (&#39;0&#39; &lt;= ch &amp;&amp; ch &lt;= &#39;9&#39;\n&quot; +
249                 &quot;                    || ch == &#39;-&#39;) {\n&quot; +
250                 &quot;                if (!allowNumber)\n&quot; +
251                 &quot;                     return false;\n&quot; +
252                 &quot;            } else if (ch == &#39;/&#39; || ch == &#39;.&#39;) {\n&quot; +
253                 &quot;                if (!allowSep)\n&quot; +
254                 &quot;                    return false;\n&quot; +
255                 &quot;                allowNumber = false;\n&quot; +
256                 &quot;                allowSep = false;\n&quot; +
257                 &quot;                if (ch == &#39;.&#39;)\n&quot; +
258                 &quot;                     seenDot = true;\n&quot; +
259                 &quot;                if (ch == &#39;/&#39; &amp;&amp; seenDot)\n&quot; +
260                 &quot;                     return false;\n&quot; +
261                 &quot;            } else {\n&quot; +
262                 &quot;                return false;\n&quot; +
263                 &quot;            }\n&quot; +
264                 &quot;        }\n&quot; +
265                 &quot;        return true;\n&quot; +
266                 &quot;    }\n&quot; +
267                 &quot;    function loadFrames() {\n&quot; +
268                 &quot;        if (targetPage != \&quot;\&quot; &amp;&amp; targetPage != \&quot;undefined\&quot;)\n&quot; +
269                 &quot;             top.classFrame.location = top.targetPage;\n&quot; +
270                 &quot;    }\n&quot;);
271     }
272 }
    </pre>
  </body>
</html>