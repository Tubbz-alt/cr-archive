<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.compiler/share/classes/javax/annotation/processing/AbstractProcessor.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package javax.annotation.processing;
 27 
<a name="1" id="anc1"></a><span class="line-added"> 28 import java.util.List;</span>
 29 import java.util.Set;
 30 import java.util.HashSet;
 31 import java.util.Collections;
 32 import java.util.Objects;
 33 import javax.lang.model.element.*;
 34 import javax.lang.model.SourceVersion;
 35 import javax.tools.Diagnostic;
 36 
 37 /**
 38  * An abstract annotation processor designed to be a convenient
 39  * superclass for most concrete annotation processors.  This class
 40  * examines annotation values to compute the {@linkplain
 41  * #getSupportedOptions options}, {@linkplain
 42  * #getSupportedAnnotationTypes annotation types}, and {@linkplain
 43  * #getSupportedSourceVersion source version} supported by its
 44  * subtypes.
 45  *
 46  * &lt;p&gt;The getter methods may {@linkplain Messager#printMessage issue
 47  * warnings} about noteworthy conditions using the facilities available
 48  * after the processor has been {@linkplain #isInitialized
 49  * initialized}.
 50  *
 51  * &lt;p&gt;Subclasses are free to override the implementation and
 52  * specification of any of the methods in this class as long as the
 53  * general {@link javax.annotation.processing.Processor Processor}
 54  * contract for that method is obeyed.
 55  *
 56  * @author Joseph D. Darcy
 57  * @author Scott Seligman
 58  * @author Peter von der Ah&amp;eacute;
 59  * @since 1.6
 60  */
 61 public abstract class AbstractProcessor implements Processor {
 62     /**
 63      * Processing environment providing by the tool framework.
 64      */
 65     protected ProcessingEnvironment processingEnv;
 66     private boolean initialized = false;
 67 
 68     /**
 69      * Constructor for subclasses to call.
 70      */
 71     protected AbstractProcessor() {}
 72 
 73     /**
 74      * If the processor class is annotated with {@link
 75      * SupportedOptions}, return an unmodifiable set with the same set
 76      * of strings as the annotation.  If the class is not so
 77      * annotated, an empty set is returned.
 78      *
 79      * @return the options recognized by this processor, or an empty
 80      * set if none
 81      */
 82     public Set&lt;String&gt; getSupportedOptions() {
 83         SupportedOptions so = this.getClass().getAnnotation(SupportedOptions.class);
<a name="2" id="anc2"></a><span class="line-modified"> 84         return (so == null) ?</span>
<span class="line-modified"> 85             Set.of() :</span>
<span class="line-modified"> 86             arrayToSet(so.value(), false, &quot;option value&quot;, &quot;@SupportedOptions&quot;);</span>

 87     }
 88 
 89     /**
 90      * If the processor class is annotated with {@link
 91      * SupportedAnnotationTypes}, return an unmodifiable set with the
 92      * same set of strings as the annotation.  If the class is not so
 93      * annotated, an empty set is returned.
 94      *
 95      * If the {@linkplain ProcessingEnvironment#getSourceVersion source
 96      * version} does not support modules, in other words if it is less
 97      * than or equal to {@link SourceVersion#RELEASE_8 RELEASE_8},
 98      * then any leading {@linkplain Processor#getSupportedAnnotationTypes
 99      * module prefixes} are stripped from the names.
100      *
101      * @return the names of the annotation types supported by this
102      * processor, or an empty set if none
103      */
104     public Set&lt;String&gt; getSupportedAnnotationTypes() {
105             SupportedAnnotationTypes sat = this.getClass().getAnnotation(SupportedAnnotationTypes.class);
106             boolean initialized = isInitialized();
107             if  (sat == null) {
108                 if (initialized)
109                     processingEnv.getMessager().printMessage(Diagnostic.Kind.WARNING,
110                                                              &quot;No SupportedAnnotationTypes annotation &quot; +
111                                                              &quot;found on &quot; + this.getClass().getName() +
112                                                              &quot;, returning an empty set.&quot;);
<a name="3" id="anc3"></a><span class="line-modified">113                 return Set.of();</span>
114             } else {
115                 boolean stripModulePrefixes =
116                         initialized &amp;&amp;
117                         processingEnv.getSourceVersion().compareTo(SourceVersion.RELEASE_8) &lt;= 0;
<a name="4" id="anc4"></a><span class="line-modified">118                 return arrayToSet(sat.value(), stripModulePrefixes,</span>
<span class="line-added">119                                   &quot;annotation type&quot;, &quot;@SupportedAnnotationTypes&quot;);</span>
120             }
121         }
122 
123     /**
124      * If the processor class is annotated with {@link
125      * SupportedSourceVersion}, return the source version in the
126      * annotation.  If the class is not so annotated, {@link
127      * SourceVersion#RELEASE_6} is returned.
128      *
129      * @return the latest source version supported by this processor
130      */
131     public SourceVersion getSupportedSourceVersion() {
132         SupportedSourceVersion ssv = this.getClass().getAnnotation(SupportedSourceVersion.class);
133         SourceVersion sv = null;
134         if (ssv == null) {
135             sv = SourceVersion.RELEASE_6;
136             if (isInitialized())
137                 processingEnv.getMessager().printMessage(Diagnostic.Kind.WARNING,
138                                                          &quot;No SupportedSourceVersion annotation &quot; +
139                                                          &quot;found on &quot; + this.getClass().getName() +
140                                                          &quot;, returning &quot; + sv + &quot;.&quot;);
141         } else
142             sv = ssv.value();
143         return sv;
144     }
145 
146 
147     /**
148      * Initializes the processor with the processing environment by
149      * setting the {@code processingEnv} field to the value of the
150      * {@code processingEnv} argument.  An {@code
151      * IllegalStateException} will be thrown if this method is called
152      * more than once on the same object.
153      *
154      * @param processingEnv environment to access facilities the tool framework
155      * provides to the processor
156      * @throws IllegalStateException if this method is called more than once.
157      */
158     public synchronized void init(ProcessingEnvironment processingEnv) {
159         if (initialized)
160             throw new IllegalStateException(&quot;Cannot call init more than once.&quot;);
161         Objects.requireNonNull(processingEnv, &quot;Tool provided null ProcessingEnvironment&quot;);
162 
163         this.processingEnv = processingEnv;
164         initialized = true;
165     }
166 
167     /**
168      * {@inheritDoc}
169      */
170     public abstract boolean process(Set&lt;? extends TypeElement&gt; annotations,
171                                     RoundEnvironment roundEnv);
172 
173     /**
174      * Returns an empty iterable of completions.
175      *
176      * @param element {@inheritDoc}
177      * @param annotation {@inheritDoc}
178      * @param member {@inheritDoc}
179      * @param userText {@inheritDoc}
180      */
181     public Iterable&lt;? extends Completion&gt; getCompletions(Element element,
182                                                          AnnotationMirror annotation,
183                                                          ExecutableElement member,
184                                                          String userText) {
<a name="5" id="anc5"></a><span class="line-modified">185         return List.of();</span>
186     }
187 
188     /**
189      * Returns {@code true} if this object has been {@linkplain #init
190      * initialized}, {@code false} otherwise.
191      *
192      * @return {@code true} if this object has been initialized,
193      * {@code false} otherwise.
194      */
195     protected synchronized boolean isInitialized() {
196         return initialized;
197     }
198 
<a name="6" id="anc6"></a><span class="line-modified">199     private Set&lt;String&gt; arrayToSet(String[] array,</span>
<span class="line-modified">200                                           boolean stripModulePrefixes,</span>
<span class="line-added">201                                    String contentType,</span>
<span class="line-added">202                                    String annotationName) {</span>
203         assert array != null;
<a name="7" id="anc7"></a><span class="line-modified">204         Set&lt;String&gt; set = new HashSet&lt;&gt;();</span>
205         for (String s : array) {
<a name="8" id="anc8"></a><span class="line-added">206             boolean stripped = false;</span>
207             if (stripModulePrefixes) {
208                 int index = s.indexOf(&#39;/&#39;);
<a name="9" id="anc9"></a><span class="line-modified">209                 if (index != -1) {</span>
210                     s = s.substring(index + 1);
<a name="10" id="anc10"></a><span class="line-added">211                     stripped = true;</span>
<span class="line-added">212                 }</span>
<span class="line-added">213             }</span>
<span class="line-added">214             boolean added = set.add(s);</span>
<span class="line-added">215             // Don&#39;t issue a duplicate warning when the module name is</span>
<span class="line-added">216             // stripped off to avoid spurious warnings in a case like</span>
<span class="line-added">217             // &quot;foo/a.B&quot;, &quot;bar/a.B&quot;.</span>
<span class="line-added">218             if (!added &amp;&amp; !stripped &amp;&amp; isInitialized() ) {</span>
<span class="line-added">219                 processingEnv.getMessager().printMessage(Diagnostic.Kind.WARNING,</span>
<span class="line-added">220                                                          &quot;Duplicate &quot; + contentType  +</span>
<span class="line-added">221                                                          &quot; ``&quot; + s  + &quot;&#39;&#39; for processor &quot; +</span>
<span class="line-added">222                                                          this.getClass().getName() +</span>
<span class="line-added">223                                                          &quot; in its &quot; + annotationName  +</span>
<span class="line-added">224                                                          &quot;annotation.&quot;);</span>
225             }
<a name="11" id="anc11"></a>
226         }
227         return Collections.unmodifiableSet(set);
228     }
229 }
<a name="12" id="anc12"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="12" type="hidden" />
</body>
</html>