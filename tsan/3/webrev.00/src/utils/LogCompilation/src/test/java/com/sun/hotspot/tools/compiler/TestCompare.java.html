<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/utils/LogCompilation/src/test/java/com/sun/hotspot/tools/compiler/TestCompare.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.
  8  *
  9  * This code is distributed in the hope that it will be useful, but WITHOUT
 10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  *
 23  */
 24 package com.sun.hotspot.tools.compiler;
 25 
 26 import java.util.Arrays;
 27 import java.util.Collection;
 28 import org.junit.BeforeClass;
 29 import org.junit.Test;
 30 import org.junit.runner.RunWith;
 31 import org.junit.runners.Parameterized;
 32 import org.junit.runners.Parameterized.Parameters;
 33 
 34 @RunWith(value = Parameterized.class)
 35 public class TestCompare {
 36 
 37     String logFile;
 38 
 39     static final String setupArgsTieredVersion[] = {
 40         &quot;java&quot;,
 41         &quot;-XX:+UnlockDiagnosticVMOptions&quot;,
 42         &quot;-XX:+LogCompilation&quot;,
 43         &quot;-XX:LogFile=target/tiered_version.log&quot;,
 44         &quot;-version&quot;
 45     };
 46 
 47     static final String setupArgsTieredVersion2[] = {
 48         &quot;java&quot;,
 49         &quot;-XX:+UnlockDiagnosticVMOptions&quot;,
 50         &quot;-XX:+LogCompilation&quot;,
 51         &quot;-XX:LogFile=target/tiered_version.log.2&quot;,
 52         &quot;-version&quot;
 53     };
 54 
 55         static final String setupArgsNoTiered[] = {
 56         &quot;java&quot;,
 57         &quot;-XX:-TieredCompilation&quot;,
 58         &quot;-XX:+UnlockDiagnosticVMOptions&quot;,
 59         &quot;-XX:+LogCompilation&quot;,
 60         &quot;-XX:LogFile=target/no_tiered_short.log&quot;
 61     };
 62 
 63     static final String setupArgsNoTiered2[] = {
 64         &quot;java&quot;,
 65         &quot;-XX:-TieredCompilation&quot;,
 66         &quot;-XX:+UnlockDiagnosticVMOptions&quot;,
 67         &quot;-XX:+LogCompilation&quot;,
 68         &quot;-XX:LogFile=target/no_tiered_short.log.2&quot;
 69     };
 70 
 71     static final String allSetupArgs[][] = {
 72         setupArgsTieredVersion,
 73         setupArgsTieredVersion2,
 74         setupArgsNoTiered,
 75         setupArgsNoTiered2
 76     };
 77 
 78     @Parameters
 79     public static Collection data() {
 80         Object[][] data = new Object[][]{
 81             // Take care these match whats created in the setup method
 82             {&quot;./target/tiered_version.log&quot;},
 83             {&quot;./target/no_tiered_short.log&quot;}
 84         };
 85         assert data.length == (allSetupArgs.length/2) : &quot;Files dont match args. Need 2 inputs per test case.&quot;;
 86         return Arrays.asList(data);
 87     }
 88 
 89     @BeforeClass
 90     public static void setup() {
 91         try {
 92             for (String[] setupArgs : allSetupArgs) {
 93                 Process p = Runtime.getRuntime().exec(setupArgs);
 94                 p.waitFor();
 95             }
 96         } catch (Exception e) {
 97             System.out.println(e + &quot;: exec failed:&quot; + setupArgsNoTiered[0]);
 98         }
 99     }
100 
101     public TestCompare(String logFile) {
102         this.logFile = logFile;
103     }
104 
105     @Test
106     public void testDashC() throws Exception {
107         String[] args = {&quot;-C&quot;,
108             logFile,
109             logFile + &quot;.2&quot;
110         };
111 
112         LogCompilation.main(args);
113     }
114 
115 }
    </pre>
  </body>
</html>