<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/utils/LogCompilation/src/main/java/com/sun/hotspot/tools/compiler/LogParser.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LogCompilation.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="Method.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/utils/LogCompilation/src/main/java/com/sun/hotspot/tools/compiler/LogParser.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 849             String phaseName = search(atts, &quot;name&quot;, null);
 850             if (phaseName != null &amp;&amp; !p.getId().equals(phaseName)) {
 851                 System.out.println(&quot;phase: &quot; + p.getId());
 852                 reportInternalError(&quot;phase name mismatch&quot;);
 853             }
 854             p.setEnd(Double.parseDouble(search(atts, &quot;stamp&quot;)));
 855             p.setEndNodes(Integer.parseInt(search(atts, &quot;nodes&quot;, &quot;0&quot;)));
 856             p.setEndLiveNodes(Integer.parseInt(search(atts, &quot;live&quot;, &quot;0&quot;)));
 857             compile.getPhases().add(p);
 858         } else if (qname.equals(&quot;task&quot;)) {
 859             String id = makeId(atts);
 860 
 861             // Create the new Compilation instance and populate it with readily
 862             // available data.
 863             compile = new Compilation(Integer.parseInt(search(atts, &quot;compile_id&quot;, &quot;-1&quot;)));
 864             compile.setStart(Double.parseDouble(search(atts, &quot;stamp&quot;)));
 865             compile.setICount(search(atts, &quot;count&quot;, &quot;0&quot;));
 866             compile.setBCount(search(atts, &quot;backedge_count&quot;, &quot;0&quot;));
 867             compile.setBCI(Integer.parseInt(search(atts, &quot;osr_bci&quot;, &quot;-1&quot;)));
 868             String compiler = atts.getValue(&quot;compiler&quot;);
<span class="line-modified"> 869             if (compiler == null) {</span>
<span class="line-modified"> 870                 compiler = &quot;&quot;;</span>


 871             }
<span class="line-removed"> 872             compile.setCompiler(compiler);</span>
<span class="line-removed"> 873 </span>
 874             // Extract the name of the compiled method.
 875             String[] parts = spacePattern.split(atts.getValue(&quot;method&quot;));
 876             String methodName = parts[0] + &quot;::&quot; + parts[1];
 877 
 878             // Continue collecting compilation meta-data.
 879             String kind = atts.getValue(&quot;compile_kind&quot;);
 880             if (kind == null) {
 881                 kind = &quot;normal&quot;;
 882             }
 883             if (kind.equals(&quot;osr&quot;)) {
 884                 compile.setOsr(true);
 885             } else if (kind.equals(&quot;c2i&quot;)) {
 886                 compile.setSpecial(&quot;--- adapter &quot; + methodName);
 887             } else {
 888                 compile.setSpecial(compile.getId() + &quot; &quot; + methodName + &quot; (0 bytes)&quot;);
 889             }
 890 
 891             // Build a dummy method to stuff in the Compilation at the
 892             // beginning.
 893             Method m = new Method();
 894             m.setHolder(parts[0]);
 895             m.setName(parts[1]);
 896             m.setSignature(parts[2]);
 897             m.setFlags(&quot;0&quot;);
 898             m.setBytes(search(atts, &quot;bytes&quot;, &quot;unknown&quot;));

 899             compile.setMethod(m);
 900             events.add(compile);
 901             compiles.put(id, compile);
 902             site = compile.getCall();
 903         } else if (qname.equals(&quot;type&quot;)) {
 904             type(search(atts, &quot;id&quot;), search(atts, &quot;name&quot;));
 905         } else if (qname.equals(&quot;bc&quot;)) {
 906             current_bci = Integer.parseInt(search(atts, &quot;bci&quot;));
 907             current_bytecode = Integer.parseInt(search(atts, &quot;code&quot;));
 908         } else if (qname.equals(&quot;klass&quot;)) {
 909             type(search(atts, &quot;id&quot;), search(atts, &quot;name&quot;));
 910         } else if (qname.equals(&quot;method&quot;)) {
 911             String id = search(atts, &quot;id&quot;);
 912             Method m = new Method();
 913             m.setHolder(type(search(atts, &quot;holder&quot;)));
 914             m.setName(search(atts, &quot;name&quot;));
 915             m.setReturnType(type(search(atts, &quot;return&quot;)));
 916             String arguments = atts.getValue(&quot;arguments&quot;);;
 917             if (arguments == null) {
 918                 m.setSignature(&quot;()&quot; + sigtype(atts.getValue(&quot;return&quot;)));
 919             } else {
 920                 String[] args = spacePattern.split(arguments);
 921                 StringBuilder sb = new StringBuilder(&quot;(&quot;);
 922                 for (int i = 0; i &lt; args.length; i++) {
 923                     sb.append(sigtype(args[i]));
 924                 }
 925                 sb.append(&quot;)&quot;);
 926                 sb.append(sigtype(atts.getValue(&quot;return&quot;)));
 927                 m.setSignature(sb.toString());
 928             }
 929 
 930             if (search(atts, &quot;unloaded&quot;, &quot;0&quot;).equals(&quot;0&quot;)) {
 931                m.setBytes(search(atts, &quot;bytes&quot;));
 932                m.setIICount(search(atts, &quot;iicount&quot;));
 933                m.setFlags(search(atts, &quot;flags&quot;));
 934             }






 935             methods.put(id, m);
 936         } else if (qname.equals(&quot;call&quot;)) {
 937             if (methodHandleSite != null) {
 938                 methodHandleSite = null;
 939             }
 940             Method m = method(search(atts, &quot;method&quot;));
 941             if (lateInlining &amp;&amp; scopes.size() == 0) {
 942                 // re-attempting already seen call site (late inlining for MH invokes)
 943                 if (m != site.getMethod()) {
 944                     if (current_bci != site.getBci()) {
 945                         System.err.println(m + &quot; bci: &quot; + current_bci);
 946                         System.err.println(site.getMethod() +  &quot; bci: &quot; + site.getBci());
 947                         reportInternalError(&quot;bci mismatch after late inlining&quot;);
 948                     }
 949                     site.setMethod(m);
 950                 }
 951             } else {
 952                 // We&#39;re dealing with a new call site; the called method is
 953                 // likely to be parsed next.
 954                 site = new CallSite(current_bci, m);
</pre>
<hr />
<pre>
1083             } else {
1084                 // Ignore &lt;eliminate_allocation type=&#39;667&#39;&gt;,
1085                 //        &lt;replace_string_concat arguments=&#39;2&#39; string_alloc=&#39;0&#39; multiple=&#39;0&#39;&gt;
1086             }
1087         } else if (qname.equals(&quot;inline_id&quot;)) {
1088             if (methodHandleSite != null) {
1089                 reportInternalError(&quot;method handle site should have been replaced&quot;);
1090             }
1091             long id = Long.parseLong(search(atts, &quot;id&quot;));
1092             site.setInlineId(id);
1093         } else if (qname.equals(&quot;nmethod&quot;)) {
1094             String id = makeId(atts);
1095             NMethod nm = new NMethod(Double.parseDouble(search(atts, &quot;stamp&quot;)),
1096                     id,
1097                     parseLong(atts.getValue(&quot;address&quot;)),
1098                     parseLong(atts.getValue(&quot;size&quot;)));
1099             String level = atts.getValue(&quot;level&quot;);
1100             if (level != null) {
1101                 nm.setLevel(parseLong(level));
1102             }


1103             nmethods.put(id, nm);
1104             events.add(nm);
1105         } else if (qname.equals(&quot;parse&quot;)) {
1106             if (failureReason != null &amp;&amp; scopes.size() == 0 &amp;&amp; !lateInlining) {
1107                 // A compilation just failed, and we&#39;re back at a top
1108                 // compilation scope.
1109                 failureReason = null;
1110                 compile.reset();
1111                 site = compile.getCall();
1112             }
1113 
1114             // Error checking.
1115             if (methodHandleSite != null) {
1116                 reportInternalError(&quot;method handle site should have been replaced&quot;);
1117             }
1118             Method m = method(search(atts, &quot;method&quot;)); // this is the method being parsed
1119             if (lateInlining &amp;&amp; scopes.size() == 0) {
1120                 if (site.getMethod() != m) {
1121                     reportInternalError(&quot;Unexpected method mismatch during late inlining (method at call site: &quot; +
1122                         site.getMethod() + &quot;, method being parsed: &quot; + m + &quot;)&quot;);
</pre>
</td>
<td>
<hr />
<pre>
 849             String phaseName = search(atts, &quot;name&quot;, null);
 850             if (phaseName != null &amp;&amp; !p.getId().equals(phaseName)) {
 851                 System.out.println(&quot;phase: &quot; + p.getId());
 852                 reportInternalError(&quot;phase name mismatch&quot;);
 853             }
 854             p.setEnd(Double.parseDouble(search(atts, &quot;stamp&quot;)));
 855             p.setEndNodes(Integer.parseInt(search(atts, &quot;nodes&quot;, &quot;0&quot;)));
 856             p.setEndLiveNodes(Integer.parseInt(search(atts, &quot;live&quot;, &quot;0&quot;)));
 857             compile.getPhases().add(p);
 858         } else if (qname.equals(&quot;task&quot;)) {
 859             String id = makeId(atts);
 860 
 861             // Create the new Compilation instance and populate it with readily
 862             // available data.
 863             compile = new Compilation(Integer.parseInt(search(atts, &quot;compile_id&quot;, &quot;-1&quot;)));
 864             compile.setStart(Double.parseDouble(search(atts, &quot;stamp&quot;)));
 865             compile.setICount(search(atts, &quot;count&quot;, &quot;0&quot;));
 866             compile.setBCount(search(atts, &quot;backedge_count&quot;, &quot;0&quot;));
 867             compile.setBCI(Integer.parseInt(search(atts, &quot;osr_bci&quot;, &quot;-1&quot;)));
 868             String compiler = atts.getValue(&quot;compiler&quot;);
<span class="line-modified"> 869             assert compiler == null : &quot;Compiler is not specified in task&quot;;</span>
<span class="line-modified"> 870             long level = parseLong(search(atts, &quot;level&quot;, &quot;0&quot;));</span>
<span class="line-added"> 871             if (level != 0) {</span>
<span class="line-added"> 872                 compile.setLevel(level);</span>
 873             }


 874             // Extract the name of the compiled method.
 875             String[] parts = spacePattern.split(atts.getValue(&quot;method&quot;));
 876             String methodName = parts[0] + &quot;::&quot; + parts[1];
 877 
 878             // Continue collecting compilation meta-data.
 879             String kind = atts.getValue(&quot;compile_kind&quot;);
 880             if (kind == null) {
 881                 kind = &quot;normal&quot;;
 882             }
 883             if (kind.equals(&quot;osr&quot;)) {
 884                 compile.setOsr(true);
 885             } else if (kind.equals(&quot;c2i&quot;)) {
 886                 compile.setSpecial(&quot;--- adapter &quot; + methodName);
 887             } else {
 888                 compile.setSpecial(compile.getId() + &quot; &quot; + methodName + &quot; (0 bytes)&quot;);
 889             }
 890 
 891             // Build a dummy method to stuff in the Compilation at the
 892             // beginning.
 893             Method m = new Method();
 894             m.setHolder(parts[0]);
 895             m.setName(parts[1]);
 896             m.setSignature(parts[2]);
 897             m.setFlags(&quot;0&quot;);
 898             m.setBytes(search(atts, &quot;bytes&quot;, &quot;unknown&quot;));
<span class="line-added"> 899             m.setLevel(compile.getLevel());</span>
 900             compile.setMethod(m);
 901             events.add(compile);
 902             compiles.put(id, compile);
 903             site = compile.getCall();
 904         } else if (qname.equals(&quot;type&quot;)) {
 905             type(search(atts, &quot;id&quot;), search(atts, &quot;name&quot;));
 906         } else if (qname.equals(&quot;bc&quot;)) {
 907             current_bci = Integer.parseInt(search(atts, &quot;bci&quot;));
 908             current_bytecode = Integer.parseInt(search(atts, &quot;code&quot;));
 909         } else if (qname.equals(&quot;klass&quot;)) {
 910             type(search(atts, &quot;id&quot;), search(atts, &quot;name&quot;));
 911         } else if (qname.equals(&quot;method&quot;)) {
 912             String id = search(atts, &quot;id&quot;);
 913             Method m = new Method();
 914             m.setHolder(type(search(atts, &quot;holder&quot;)));
 915             m.setName(search(atts, &quot;name&quot;));
 916             m.setReturnType(type(search(atts, &quot;return&quot;)));
 917             String arguments = atts.getValue(&quot;arguments&quot;);;
 918             if (arguments == null) {
 919                 m.setSignature(&quot;()&quot; + sigtype(atts.getValue(&quot;return&quot;)));
 920             } else {
 921                 String[] args = spacePattern.split(arguments);
 922                 StringBuilder sb = new StringBuilder(&quot;(&quot;);
 923                 for (int i = 0; i &lt; args.length; i++) {
 924                     sb.append(sigtype(args[i]));
 925                 }
 926                 sb.append(&quot;)&quot;);
 927                 sb.append(sigtype(atts.getValue(&quot;return&quot;)));
 928                 m.setSignature(sb.toString());
 929             }
 930 
 931             if (search(atts, &quot;unloaded&quot;, &quot;0&quot;).equals(&quot;0&quot;)) {
 932                m.setBytes(search(atts, &quot;bytes&quot;));
 933                m.setIICount(search(atts, &quot;iicount&quot;));
 934                m.setFlags(search(atts, &quot;flags&quot;));
 935             }
<span class="line-added"> 936             String compiler = search(atts, &quot;compiler&quot;, &quot;&quot;);</span>
<span class="line-added"> 937             m.setCompiler(compiler);</span>
<span class="line-added"> 938             long level = parseLong(search(atts, &quot;level&quot;, &quot;0&quot;));</span>
<span class="line-added"> 939             if (level != 0) {</span>
<span class="line-added"> 940                 m.setLevel(level);</span>
<span class="line-added"> 941             }</span>
 942             methods.put(id, m);
 943         } else if (qname.equals(&quot;call&quot;)) {
 944             if (methodHandleSite != null) {
 945                 methodHandleSite = null;
 946             }
 947             Method m = method(search(atts, &quot;method&quot;));
 948             if (lateInlining &amp;&amp; scopes.size() == 0) {
 949                 // re-attempting already seen call site (late inlining for MH invokes)
 950                 if (m != site.getMethod()) {
 951                     if (current_bci != site.getBci()) {
 952                         System.err.println(m + &quot; bci: &quot; + current_bci);
 953                         System.err.println(site.getMethod() +  &quot; bci: &quot; + site.getBci());
 954                         reportInternalError(&quot;bci mismatch after late inlining&quot;);
 955                     }
 956                     site.setMethod(m);
 957                 }
 958             } else {
 959                 // We&#39;re dealing with a new call site; the called method is
 960                 // likely to be parsed next.
 961                 site = new CallSite(current_bci, m);
</pre>
<hr />
<pre>
1090             } else {
1091                 // Ignore &lt;eliminate_allocation type=&#39;667&#39;&gt;,
1092                 //        &lt;replace_string_concat arguments=&#39;2&#39; string_alloc=&#39;0&#39; multiple=&#39;0&#39;&gt;
1093             }
1094         } else if (qname.equals(&quot;inline_id&quot;)) {
1095             if (methodHandleSite != null) {
1096                 reportInternalError(&quot;method handle site should have been replaced&quot;);
1097             }
1098             long id = Long.parseLong(search(atts, &quot;id&quot;));
1099             site.setInlineId(id);
1100         } else if (qname.equals(&quot;nmethod&quot;)) {
1101             String id = makeId(atts);
1102             NMethod nm = new NMethod(Double.parseDouble(search(atts, &quot;stamp&quot;)),
1103                     id,
1104                     parseLong(atts.getValue(&quot;address&quot;)),
1105                     parseLong(atts.getValue(&quot;size&quot;)));
1106             String level = atts.getValue(&quot;level&quot;);
1107             if (level != null) {
1108                 nm.setLevel(parseLong(level));
1109             }
<span class="line-added">1110             String compiler = search(atts, &quot;compiler&quot;, &quot;&quot;);</span>
<span class="line-added">1111             nm.setCompiler(compiler);</span>
1112             nmethods.put(id, nm);
1113             events.add(nm);
1114         } else if (qname.equals(&quot;parse&quot;)) {
1115             if (failureReason != null &amp;&amp; scopes.size() == 0 &amp;&amp; !lateInlining) {
1116                 // A compilation just failed, and we&#39;re back at a top
1117                 // compilation scope.
1118                 failureReason = null;
1119                 compile.reset();
1120                 site = compile.getCall();
1121             }
1122 
1123             // Error checking.
1124             if (methodHandleSite != null) {
1125                 reportInternalError(&quot;method handle site should have been replaced&quot;);
1126             }
1127             Method m = method(search(atts, &quot;method&quot;)); // this is the method being parsed
1128             if (lateInlining &amp;&amp; scopes.size() == 0) {
1129                 if (site.getMethod() != m) {
1130                     reportInternalError(&quot;Unexpected method mismatch during late inlining (method at call site: &quot; +
1131                         site.getMethod() + &quot;, method being parsed: &quot; + m + &quot;)&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="LogCompilation.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="Method.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>