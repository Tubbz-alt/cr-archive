<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.accessibility/windows/native/common/AccessBridgeDebug.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../classes/com/sun/java/accessibility/internal/AccessBridge.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="AccessBridgeDebug.h.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.accessibility/windows/native/common/AccessBridgeDebug.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2005, 2015, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -39,38 +39,28 @@</span>
  extern &quot;C&quot; {
  #endif
  
  static FILE* logFP = nullptr;
  
<span class="udiff-line-modified-removed">- void initializeFileLogger(char * suffix) {</span>
<span class="udiff-line-modified-removed">-     auto var = &quot;JAVA_ACCESSBRIDGE_LOGFILE&quot;;</span>
<span class="udiff-line-modified-added">+ void initializeFileLogger(char * fileName) {</span>
<span class="udiff-line-modified-added">+     auto var = &quot;JAVA_ACCESSBRIDGE_LOGDIR&quot;;</span>
      const auto envfilePath = getenv(var);
<span class="udiff-line-modified-removed">-     if (envfilePath != nullptr) {</span>
<span class="udiff-line-modified-removed">-         auto ext = const_cast&lt;char*&gt;(strrchr(envfilePath, &#39;.&#39;));</span>
<span class="udiff-line-modified-removed">-         auto filePath = static_cast&lt;char*&gt;(nullptr);</span>
<span class="udiff-line-modified-removed">-         auto len = strlen(envfilePath);</span>
<span class="udiff-line-modified-removed">-         auto suffixlen = suffix != nullptr ? strlen(suffix) : (decltype(strlen(nullptr)))0;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         if (ext == nullptr) {</span>
<span class="udiff-line-modified-removed">-             filePath = new char[len + suffixlen + 5];</span>
<span class="udiff-line-modified-removed">-             memset(filePath, 0, len + suffixlen + 5);</span>
<span class="udiff-line-modified-removed">-             memcpy(filePath, envfilePath, len);</span>
<span class="udiff-line-removed">-             memcpy(filePath + len, suffix, suffixlen);</span>
<span class="udiff-line-removed">-             memcpy(filePath + len + suffixlen, &quot;.log&quot;, 4);</span>
<span class="udiff-line-removed">-         } else {</span>
<span class="udiff-line-removed">-             auto extLen = strlen(ext);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-             filePath = new char[len + suffixlen + 1];</span>
<span class="udiff-line-removed">-             memset(filePath, 0, len + suffixlen + 1);</span>
<span class="udiff-line-removed">-             memcpy(filePath, envfilePath, len - extLen);</span>
<span class="udiff-line-removed">-             memcpy(filePath + len - extLen, suffix, suffixlen);</span>
<span class="udiff-line-removed">-             memcpy(filePath + len + suffixlen - extLen, ext, extLen);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+     if (envfilePath != nullptr &amp;&amp; fileName != nullptr) {</span>
<span class="udiff-line-modified-added">+         auto envFilePathLength = strlen(envfilePath);</span>
<span class="udiff-line-modified-added">+         auto fileNameLength = strlen(fileName);</span>
<span class="udiff-line-modified-added">+         auto filePathSize = envFilePathLength + 1 + fileNameLength + 5; //1 for &quot;/&quot;, 5 for &quot;.log&quot; and 0;</span>
<span class="udiff-line-modified-added">+         auto filePath = new char[filePathSize];</span>
<span class="udiff-line-modified-added">+         memset(filePath, 0, filePathSize*sizeof(char));</span>
<span class="udiff-line-modified-added">+         memcpy(filePath, envfilePath, envFilePathLength*sizeof(char));</span>
<span class="udiff-line-modified-added">+         filePath[envFilePathLength] = &#39;/&#39;;</span>
<span class="udiff-line-modified-added">+         memcpy(filePath + envFilePathLength + 1, fileName, fileNameLength*sizeof(char));</span>
<span class="udiff-line-modified-added">+         memcpy(filePath + envFilePathLength + 1 + fileNameLength, &quot;.log&quot;, 4*sizeof(char));</span>
  
          logFP = fopen(filePath, &quot;w&quot;);
          if (logFP == nullptr) {
<span class="udiff-line-modified-removed">-             PrintDebugString(&quot;couldnot open file %s&quot;, filePath);</span>
<span class="udiff-line-modified-added">+             printf(&quot;\n%s\n&quot;, filePath);</span>
<span class="udiff-line-added">+             PrintDebugString(&quot;Could not open file %s&quot;, filePath);</span>
          }
  
          delete [] filePath;
      }
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -142,11 +132,11 @@</span>
          printf(buf);
          printf(&quot;\r\n&quot;);
  #endif
  #endif
          if (logFP) {
<span class="udiff-line-modified-removed">-             fprintf(logFP, &quot;[%lldu] &quot;, getTimeStamp());</span>
<span class="udiff-line-modified-added">+             fprintf(logFP, &quot;[%llu] &quot;, getTimeStamp());</span>
              va_list args;
              va_start(args, msg);
              vfprintf(logFP, msg, args);
              va_end(args);
              fprintf(logFP, &quot;\r\n&quot;);
</pre>
<center><a href="../../classes/com/sun/java/accessibility/internal/AccessBridge.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="AccessBridgeDebug.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>