<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.management.jfr/share/classes/jdk/management/jfr/FlightRecorderMXBeanImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="FlightRecorderMXBean.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MBeanUtils.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.management.jfr/share/classes/jdk/management/jfr/FlightRecorderMXBeanImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 26,10 ***</span>
<span class="line-new-header">--- 26,11 ---</span>
  package jdk.management.jfr;
  
  import java.io.IOException;
  import java.io.InputStream;
  import java.io.StringReader;
<span class="line-added">+ import java.nio.file.Path;</span>
  import java.nio.file.Paths;
  import java.security.AccessControlContext;
  import java.security.AccessController;
  import java.security.PrivilegedAction;
  import java.text.ParseException;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 103,11 ***</span>
      private static final String OPTION_MAX_AGE = &quot;maxAge&quot;;
      private static final String OPTION_NAME = &quot;name&quot;;
      private static final String OPTION_DISK = &quot;disk&quot;;
      private static final String OPTION_DUMP_ON_EXIT = &quot;dumpOnExit&quot;;
      private static final String OPTION_DURATION = &quot;duration&quot;;
<span class="line-modified">!     private static final List&lt;String&gt; OPTIONS = Arrays.asList(new String[] { OPTION_DUMP_ON_EXIT, OPTION_DURATION, OPTION_NAME, OPTION_MAX_AGE, OPTION_MAX_SIZE, OPTION_DISK, });</span>
      private final StreamManager streamHandler = new StreamManager();
      private final Map&lt;Long, Object&gt; changes = new ConcurrentHashMap&lt;&gt;();
      private final AtomicLong sequenceNumber = new AtomicLong();
      private final List&lt;MXBeanListener&gt; listeners = new CopyOnWriteArrayList&lt;&gt;();
      private FlightRecorder recorder;
<span class="line-new-header">--- 104,12 ---</span>
      private static final String OPTION_MAX_AGE = &quot;maxAge&quot;;
      private static final String OPTION_NAME = &quot;name&quot;;
      private static final String OPTION_DISK = &quot;disk&quot;;
      private static final String OPTION_DUMP_ON_EXIT = &quot;dumpOnExit&quot;;
      private static final String OPTION_DURATION = &quot;duration&quot;;
<span class="line-modified">!     private static final String OPTION_DESTINATION = &quot;destination&quot;;</span>
<span class="line-added">+     private static final List&lt;String&gt; OPTIONS = Arrays.asList(new String[] { OPTION_DUMP_ON_EXIT, OPTION_DURATION, OPTION_NAME, OPTION_MAX_AGE, OPTION_MAX_SIZE, OPTION_DISK, OPTION_DESTINATION, });</span>
      private final StreamManager streamHandler = new StreamManager();
      private final Map&lt;Long, Object&gt; changes = new ConcurrentHashMap&lt;&gt;();
      private final AtomicLong sequenceNumber = new AtomicLong();
      private final List&lt;MXBeanListener&gt; listeners = new CopyOnWriteArrayList&lt;&gt;();
      private FlightRecorder recorder;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 281,18 ***</span>
<span class="line-new-header">--- 283,20 ---</span>
          validateOption(ops, OPTION_DISK, MBeanUtils::booleanValue);
          validateOption(ops, OPTION_NAME, Function.identity());
          validateOption(ops, OPTION_MAX_AGE, MBeanUtils::duration);
          validateOption(ops, OPTION_MAX_SIZE, MBeanUtils::size);
          validateOption(ops, OPTION_DURATION, MBeanUtils::duration);
<span class="line-added">+         validateOption(ops, OPTION_DESTINATION, x -&gt; MBeanUtils.destination(r, x));</span>
  
          // All OK, now set them.atomically
          setOption(ops, OPTION_DUMP_ON_EXIT, &quot;false&quot;, MBeanUtils::booleanValue, x -&gt; r.setDumpOnExit(x));
          setOption(ops, OPTION_DISK, &quot;true&quot;, MBeanUtils::booleanValue, x -&gt; r.setToDisk(x));
          setOption(ops, OPTION_NAME, String.valueOf(r.getId()), Function.identity(), x -&gt; r.setName(x));
          setOption(ops, OPTION_MAX_AGE, null, MBeanUtils::duration, x -&gt; r.setMaxAge(x));
          setOption(ops, OPTION_MAX_SIZE, &quot;0&quot;, MBeanUtils::size, x -&gt; r.setMaxSize(x));
          setOption(ops, OPTION_DURATION, null, MBeanUtils::duration, x -&gt; r.setDuration(x));
<span class="line-added">+         setOption(ops, OPTION_DESTINATION, null, x -&gt; MBeanUtils.destination(r, x), x -&gt; setOptionDestination(r, x));</span>
      }
  
      @Override
      public Map&lt;String, String&gt; getRecordingOptions(long recording) throws IllegalArgumentException {
          MBeanUtils.checkMonitor();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 303,10 ***</span>
<span class="line-new-header">--- 307,11 ---</span>
          options.put(OPTION_NAME, String.valueOf(r.getName()));
          options.put(OPTION_MAX_AGE, ManagementSupport.formatTimespan(r.getMaxAge(), &quot; &quot;));
          Long maxSize = r.getMaxSize();
          options.put(OPTION_MAX_SIZE, String.valueOf(maxSize == null ? &quot;0&quot; : maxSize.toString()));
          options.put(OPTION_DURATION, ManagementSupport.formatTimespan(r.getDuration(), &quot; &quot;));
<span class="line-added">+         options.put(OPTION_DESTINATION, ManagementSupport.getDestinationOriginalText(r));</span>
          return options;
      }
  
      @Override
      public long cloneRecording(long id, boolean stop) throws IllegalStateException, SecurityException {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 347,10 ***</span>
<span class="line-new-header">--- 352,24 ---</span>
          } catch (IllegalArgumentException iae) {
              throw new IllegalArgumentException(&quot;Not a valid value for option &#39;&quot; + name + &quot;&#39;. &quot; + iae.getMessage());
          }
      }
  
<span class="line-added">+     private static void setOptionDestination(Recording recording, String destination){</span>
<span class="line-added">+         try {</span>
<span class="line-added">+             Path pathDestination = null;</span>
<span class="line-added">+             if(destination != null){</span>
<span class="line-added">+                 pathDestination = Paths.get(destination);</span>
<span class="line-added">+             }</span>
<span class="line-added">+             recording.setDestination(pathDestination);</span>
<span class="line-added">+         } catch (IOException e) {</span>
<span class="line-added">+             IllegalArgumentException iae = new IllegalArgumentException(&quot;Not a valid destination &quot; + destination);</span>
<span class="line-added">+             iae.addSuppressed(e);</span>
<span class="line-added">+             throw iae;</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      private static &lt;T, U&gt; void validateOption(Map&lt;String, String&gt; options, String name, Function&lt;String, U&gt; validator) {
          try {
              String v = options.get(name);
              if (v == null) {
                  return; // OK, will set default
</pre>
<center><a href="FlightRecorderMXBean.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MBeanUtils.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>