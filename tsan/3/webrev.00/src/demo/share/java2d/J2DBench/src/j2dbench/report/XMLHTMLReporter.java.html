<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/demo/share/java2d/J2DBench/src/j2dbench/report/XMLHTMLReporter.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 /*
   2  * Copyright (c) 2004, 2018, Oracle and/or its affiliates. All rights reserved.
   3  *
   4  * Redistribution and use in source and binary forms, with or without
   5  * modification, are permitted provided that the following conditions
   6  * are met:
   7  *
   8  *   - Redistributions of source code must retain the above copyright
   9  *     notice, this list of conditions and the following disclaimer.
  10  *
  11  *   - Redistributions in binary form must reproduce the above copyright
  12  *     notice, this list of conditions and the following disclaimer in the
  13  *     documentation and/or other materials provided with the distribution.
  14  *
  15  *   - Neither the name of Oracle nor the names of its
  16  *     contributors may be used to endorse or promote products derived
  17  *     from this software without specific prior written permission.
  18  *
  19  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS
  20  * IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  21  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  22  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
  23  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  24  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  25  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  26  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  27  * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  28  * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  29  * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  30  */
  31 
  32 /*
  33  * This source code is provided to illustrate the usage of a given feature
  34  * or technique and has been deliberately simplified. Additional steps
  35  * required for a production-quality application, such as security checks,
  36  * input validation and proper error handling, might not be present in
  37  * this sample code.
  38  */
  39 
  40 
  41 /**
  42  * XMLHTMLReporter.java
  43  *
  44  * Generates HTML reports from XML results
  45  *
  46  * @author Rakesh Menon
  47  */
  48 
  49 package j2dbench.report;
  50 
  51 import java.io.*;
  52 import java.util.*;
  53 import java.text.DecimalFormat;
  54 import java.text.SimpleDateFormat;
  55 
  56 public class XMLHTMLReporter {
  57 
  58     /**
  59      * Flag to indicate - Generate new report or append to existing report
  60      */
  61     private static final int HTMLGEN_FILE_NEW = 1;
  62     private static final int HTMLGEN_FILE_UPDATE = 2;
  63 
  64     /**
  65      * Path to results directory where all results are stored
  66      */
  67     public static String resultsDir = &quot;.&quot;;
  68 
  69     /**
  70      * Holds the groups and corresponding group-display-names
  71      */
  72     public static List groups = new ArrayList();
  73     public static Map groupNames = new HashMap();
  74 
  75     /**
  76      * Level at which tests are grouped to be displayed in summary
  77      */
  78     public static int LEVEL = 2;
  79 
  80     /**
  81      * Color -&gt; Better, Same, Worse
  82      */
  83     private static final String[] color = {&quot;#99FF99&quot;, &quot;#CCFFFF&quot;, &quot;#FFCC00&quot;};
  84 
  85     /**
  86      * String for holding base-build and target-build version
  87      */
  88     private static String baseBuild = &quot;&quot;;
  89     private static String targetBuild = &quot;&quot;;
  90 
  91     private static final DecimalFormat decimalFormat =
  92         new DecimalFormat(&quot;0.##&quot;);
  93     private static final SimpleDateFormat dateFormat =
  94         new SimpleDateFormat(&quot;EEE, MMM d, yyyy G &#39;at&#39; HH:mm:ss z&quot;);
  95 
  96     public static void setGroupLevel(int level) {
  97         XMLHTMLReporter.LEVEL = level;
  98     }
  99 
 100     /**
 101      * Add Test Group to the list
 102      */
 103     private static void addGroup(String testName) {
 104 
 105         String[] testNameSplit = testName.replace(&#39;.&#39;, &#39;_&#39;).split(&quot;_&quot;);
 106         String group = testNameSplit[0];
 107         for(int i=1; i&lt;LEVEL; i++) {
 108             group = group + &quot;.&quot; + testNameSplit[i];
 109         }
 110 
 111         if( ! groups.contains(group)) {
 112             groups.add(group);
 113             groupNames.put(group, getDisplayGroupName(group));
 114         }
 115     }
 116 
 117     /**
 118      * Generate a Display Name for this group
 119      */
 120     private static String getDisplayGroupName(String group) {
 121 
 122         String[] groupSplit = group.replace(&#39;.&#39;, &#39;_&#39;).split(&quot;_&quot;);
 123 
 124         StringBuffer groupName = new StringBuffer();
 125         String tempName = null;
 126 
 127         for(int i=0; i&lt;groupSplit.length; i++) {
 128             tempName = groupSplit[i].substring(0, 1).toUpperCase() +
 129                 groupSplit[i].substring(1);
 130             if(i == 0) {
 131                 groupName.append(tempName);
 132             } else {
 133                 groupName.append(&quot; &quot; + tempName);
 134             }
 135         }
 136 
 137         return groupName.toString();
 138     }
 139 
 140     /**
 141      * Get the group to which this testcase belongs
 142      */
 143     private static String getGroup(String testName) {
 144 
 145         String[] testNameSplit = testName.replace(&#39;.&#39;, &#39;_&#39;).split(&quot;_&quot;);
 146         String group = testNameSplit[0];
 147         for(int i=1; i&lt;LEVEL; i++) {
 148             group = group + &quot;.&quot; + testNameSplit[i];
 149         }
 150 
 151         return group;
 152     }
 153 
 154     /**
 155      * Opens a File and returns a PrintWriter instance based on new/update
 156      * option specified in argument.
 157      */
 158     private static PrintWriter openFile(String name, int nSwitch) {
 159 
 160         FileOutputStream file = null;
 161         OutputStreamWriter writer = null;
 162 
 163         try {
 164             switch (nSwitch) {
 165                 case 1: // HTMLGEN_FILE_NEW
 166                     file = new FileOutputStream(name, false);
 167                     break;
 168                 case 2: // HTMLGEN_FILE_UPDATE
 169                     file = new FileOutputStream(name, true);
 170                     break;
 171             }
 172             writer = new OutputStreamWriter(file);
 173         } catch (IOException ee) {
 174             System.out.println(&quot;Error opening file: &quot; + ee);
 175             System.exit(1);
 176         }
 177 
 178         return new PrintWriter(new BufferedWriter(writer));
 179     }
 180 
 181     /**
 182      * Generate an HTML report based on the XML results file passed -
 183      * J2DBench_Results.html
 184      */
 185     public static void generateReport(String resultsDir, String xmlFileName) {
 186 
 187         try {
 188 
 189             String strhtml = null;
 190             String strstr = null;
 191             String[] tempstr2 = new String[2];
 192             String[] tempstr = new String[2];
 193 
 194             J2DAnalyzer.readResults(xmlFileName);
 195             J2DAnalyzer.SingleResultSetHolder srsh =
 196                 (J2DAnalyzer.SingleResultSetHolder)
 197                 J2DAnalyzer.results.elementAt(0);
 198             Enumeration enum_ = srsh.getKeyEnumeration();
 199             Vector keyvector = new Vector();
 200             while (enum_.hasMoreElements()) {
 201                 keyvector.add(enum_.nextElement());
 202             }
 203             String[] keys = new String[keyvector.size()];
 204             keyvector.copyInto(keys);
 205             J2DAnalyzer.sort(keys);
 206 
 207             File reportFile = new File(resultsDir, &quot;J2DBench_Results.html&quot;);
 208             PrintWriter writer =
 209                 openFile(reportFile.getAbsolutePath(), HTMLGEN_FILE_NEW);
 210 
 211             writer.println(&quot;&lt;html&gt;&lt;body bgcolor=\&quot;#ffffff\&quot;&gt;&lt;hr size=\&quot;1\&quot;&gt;&quot;);
 212             writer.println(&quot;&lt;center&gt;&lt;h2&gt;J2DBench2 - Report&lt;/h2&gt;&quot;);
 213             writer.println(&quot;&lt;/center&gt;&lt;hr size=\&quot;1\&quot;&gt;&lt;br&gt;&quot;);
 214             writer.println(&quot;&lt;table cols=\&quot;2\&quot; cellspacing=\&quot;2\&quot; &quot; +
 215                            &quot;cellpadding=\&quot;5\&quot; &quot; +
 216                            &quot;border=\&quot;0\&quot; width=\&quot;80%\&quot;&gt;&quot;);
 217             writer.println(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#CCCCFF\&quot; colspan=\&quot;2\&quot;&gt;&quot; +
 218                            &quot;&lt;b&gt;Build Details&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
 219             writer.println(&quot;&lt;tr&gt;&quot;);
 220             writer.println(&quot;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;Description&lt;/td&gt;&quot;);
 221             writer.println(&quot;&lt;td&gt;&quot; + srsh.getDescription() + &quot;&lt;/td&gt;&quot;);
 222             writer.println(&quot;&lt;/tr&gt;&quot;);
 223             writer.println(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;From Date&lt;/td&gt;&quot;);
 224             writer.println(&quot;&lt;td&gt;&quot; +
 225                            dateFormat.format(new Date(srsh.getStartTime())) +
 226                            &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
 227             writer.println(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;To Date&lt;/td&gt;&quot;);
 228             writer.println(&quot;&lt;td&gt;&quot; +
 229                            dateFormat.format(new Date(srsh.getEndTime())) +
 230                            &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
 231             writer.flush();
 232 
 233             //System Properties
 234             writer.println(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#CCCCFF\&quot;&gt;&lt;b&gt;System Property&lt;/b&gt;&quot;+
 235                            &quot;&lt;/td&gt;&lt;td bgcolor=\&quot;#CCCCFF\&quot;&gt;&quot; +
 236                            &quot;&lt;b&gt;Value&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
 237             String key = null;
 238             String value = null;
 239             Map sysProps = srsh.getProperties();
 240             Iterator iter = sysProps.keySet().iterator();
 241             while(iter.hasNext()) {
 242                 key = iter.next().toString();
 243                 value = sysProps.get(key).toString();
 244                 writer.println(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
 245                                key + &quot;&lt;/td&gt;&lt;td&gt;&quot; + value + &quot;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&quot;);
 246             }
 247             writer.flush();
 248 
 249             writer.println(&quot;&lt;/table&gt;&quot;);
 250             writer.println(&quot;&lt;br&gt;&quot;);
 251             writer.println(&quot;&lt;hr size=\&quot;1\&quot;&gt;&quot;);
 252             writer.println(&quot;&lt;br&gt;&quot;);
 253 
 254             writer.println(&quot;&lt;table cellspacing=\&quot;0\&quot; &quot; +
 255                            &quot;cellpadding=\&quot;3\&quot; border=\&quot;1\&quot; width=\&quot;80%\&quot;&gt;&quot;);
 256             writer.println(&quot;&lt;tr&gt;&quot;);
 257             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 258                            &quot;&lt;b&gt;Num Reps&lt;/b&gt;&lt;/td&gt;&quot;);
 259             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 260                            &quot;&lt;b&gt;Num Units&lt;/b&gt;&lt;/td&gt;&quot;);
 261             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 262                            &quot;&lt;b&gt;Name&lt;/b&gt;&lt;/td&gt;&quot;);
 263             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 264                            &quot;&lt;b&gt;Options&lt;/b&gt;&lt;/td&gt;&quot;);
 265             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 266                            &quot;&lt;b&gt;Score&lt;/b&gt;&lt;/td&gt;&quot;);
 267             writer.println(&quot;&lt;/tr&gt;&quot;);
 268             writer.flush();
 269 
 270             for (int k = 0; k &lt; keys.length; k++) {
 271 
 272                 J2DAnalyzer.ResultHolder testResult =
 273                     srsh.getResultByKey(keys[k]);
 274 
 275                 writer.println(&quot;&lt;tr&gt;&quot;);
 276                 writer.println(&quot;&lt;td&gt;&quot; + testResult.getReps() + &quot;&lt;/td&gt;&quot;);
 277                 writer.println(&quot;&lt;td&gt;&quot; + testResult.getUnits() + &quot;&lt;/td&gt;&quot;);
 278                 writer.println(&quot;&lt;td&gt;&quot; + testResult.getName() + &quot;&lt;/td&gt;&quot;);
 279                 writer.println(&quot;&lt;td valign=\&quot;center\&quot;&gt;&lt;ul&gt;&quot;);
 280                 Map map = testResult.getOptions();
 281                 iter = map.keySet().iterator();
 282                 while(iter.hasNext()) {
 283                     key = iter.next().toString();
 284                     value = map.get(key).toString();
 285                     writer.println(&quot;&lt;li&gt;&quot; + key + &quot; = &quot; + value + &quot;&lt;/li&gt;&quot;);
 286                 }
 287                 writer.println(&quot;&lt;/ul&gt;&lt;/td&gt;&quot;);
 288                 writer.println(&quot;&lt;td valign=\&quot;center\&quot;&gt;&quot; +
 289                                decimalFormat.format(testResult.getScore()) +
 290                                &quot;&lt;/td&gt;&quot;);
 291                 writer.println(&quot;&lt;/tr&gt;&quot;);
 292             }
 293             writer.flush();
 294 
 295             writer.println(&quot;&lt;/table&gt;&quot;);
 296 
 297             writer.println(&quot;&lt;br&gt;&lt;hr WIDTH=\&quot;100%\&quot; size=\&quot;1\&quot;&gt;&quot;);
 298             writer.println(&quot;&lt;/p&gt;&lt;hr WIDTH=\&quot;100%\&quot; size=\&quot;1\&quot;&gt;&lt;/body&gt;&lt;/html&gt;&quot;);
 299 
 300             writer.flush();
 301             writer.close();
 302         }
 303         catch(Exception e) {
 304             e.printStackTrace();
 305         }
 306     }
 307 
 308     /**
 309      * Generate the reports from the base &amp; target result XML
 310      */
 311     public static void generateComparisonReport(String resultsDir,
 312                                                 String baseXMLFileName,
 313                                                 String targetXMLFileName) {
 314 
 315         XMLHTMLReporter.resultsDir = resultsDir;
 316 
 317         //Get Base XML File ResultSetHolder
 318         J2DAnalyzer.readResults(baseXMLFileName);
 319         J2DAnalyzer.SingleResultSetHolder baseSRSH =
 320             (J2DAnalyzer.SingleResultSetHolder) J2DAnalyzer.results.elementAt(0);
 321         Enumeration baseEnum_ = baseSRSH.getKeyEnumeration();
 322         Vector baseKeyvector = new Vector();
 323         while (baseEnum_.hasMoreElements()) {
 324             baseKeyvector.add(baseEnum_.nextElement());
 325         }
 326         String[] baseKeys = new String[baseKeyvector.size()];
 327         baseKeyvector.copyInto(baseKeys);
 328         J2DAnalyzer.sort(baseKeys);
 329 
 330         //Get Target XML File ResultSetHolder
 331         J2DAnalyzer.readResults(targetXMLFileName);
 332         J2DAnalyzer.SingleResultSetHolder targetSRSH =
 333             (J2DAnalyzer.SingleResultSetHolder)
 334                 J2DAnalyzer.results.elementAt(1);
 335         Enumeration targetEnum_ = baseSRSH.getKeyEnumeration();
 336         Vector targetKeyvector = new Vector();
 337         while (targetEnum_.hasMoreElements()) {
 338             targetKeyvector.add(targetEnum_.nextElement());
 339         }
 340         String[] targetKeys = new String[targetKeyvector.size()];
 341         targetKeyvector.copyInto(targetKeys);
 342         J2DAnalyzer.sort(targetKeys);
 343 
 344         baseBuild = (String)baseSRSH.getProperties().get(&quot;java.vm.version&quot;);
 345         targetBuild = (String)targetSRSH.getProperties().get(&quot;java.vm.version&quot;);
 346         generateSysPropsReport(targetSRSH);
 347 
 348         File reportFile = new File(resultsDir, &quot;J2DBench_Complete_Report.html&quot;);
 349         PrintWriter writer = openFile(reportFile.getAbsolutePath(),
 350                                       HTMLGEN_FILE_NEW);
 351 
 352         String header = getHeader(baseSRSH, targetSRSH,
 353                                   &quot;J2DBench - Complete Report&quot;,
 354                                   &quot;System_Properties.html&quot;);
 355         writer.println(header);
 356         writer.flush();
 357 
 358         StringBuffer startTags = new StringBuffer();
 359         startTags.append(&quot;&lt;tr&gt;&quot;);
 360         startTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 361                          &quot;&lt;b&gt;Num Reps&lt;/b&gt;&lt;/td&gt;&quot;);
 362         startTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 363                          &quot;&lt;b&gt;Num Units&lt;/b&gt;&lt;/td&gt;&quot;);
 364         startTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 365                          &quot;&lt;b&gt;Name&lt;/b&gt;&lt;/td&gt;&quot;);
 366         startTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 367                          &quot;&lt;b&gt;Options&lt;/b&gt;&lt;/td&gt;&quot;);
 368         startTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 369                          &quot;&lt;b&gt;&quot; + baseBuild + &quot; Score&lt;/b&gt;&lt;/td&gt;&quot;);
 370         startTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&lt;b&gt;&quot; +
 371                          targetBuild + &quot; Score&lt;/b&gt;&lt;/td&gt;&quot;);
 372         startTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 373                          &quot;&lt;b&gt;% Speedup&lt;/b&gt;&lt;/td&gt;&quot;);
 374         startTags.append(&quot;&lt;/tr&gt;&quot;);
 375 
 376         StringBuffer worseResultTags = new StringBuffer(startTags.toString());
 377         StringBuffer sameResultTags = new StringBuffer(startTags.toString());
 378         StringBuffer betterResultTags = new StringBuffer(startTags.toString());
 379 
 380         Map consolBaseRes = new HashMap();
 381         Map consolTargetResult = new HashMap();
 382 
 383         Map testCaseBaseResult = new HashMap();
 384         Map testCaseResultCount = new HashMap();
 385         Map testCaseTargetResult = new HashMap();
 386 
 387         for (int k = 0; k &lt; targetKeys.length; k++) {
 388 
 389             J2DAnalyzer.ResultHolder baseTCR =
 390                 baseSRSH.getResultByKey(targetKeys[k]);
 391             J2DAnalyzer.ResultHolder targetTCR =
 392                 targetSRSH.getResultByKey(targetKeys[k]);
 393 
 394             Object curTestCountObj = testCaseResultCount.get(baseTCR.getName());
 395             int curTestCount = 0;
 396             if(curTestCountObj != null) {
 397                 curTestCount = ((Integer) curTestCountObj).intValue();
 398             }
 399             curTestCount++;
 400             testCaseBaseResult.put(baseTCR.getName() + &quot;_&quot; +
 401                                    (curTestCount - 1), baseTCR);
 402             testCaseTargetResult.put(targetTCR.getName() + &quot;_&quot; +
 403                                      (curTestCount - 1), targetTCR);
 404             testCaseResultCount.put(baseTCR.getName(),
 405                                     new Integer(curTestCount));
 406 
 407             /******************************************************************
 408              * Add the Test to Group List
 409              ******************************************************************/
 410             addGroup(baseTCR.getName());
 411 
 412             double baseScore = baseTCR.getScore();
 413             double targetScore = targetTCR.getScore();
 414 
 415             int selColorIndex = selectColor(baseScore, targetScore);
 416 
 417             StringBuffer tagBuffer = new StringBuffer();
 418 
 419             tagBuffer.append(&quot;&lt;tr bgcolor=\&quot;&quot;+ color[selColorIndex] + &quot;\&quot;&gt;&quot;);
 420             tagBuffer.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; + baseTCR.getScore() +
 421                              &quot;&lt;/td&gt;&quot;);
 422             tagBuffer.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; + baseTCR.getUnits() +
 423                              &quot;&lt;/td&gt;&quot;);
 424             tagBuffer.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; + baseTCR.getName() +
 425                              &quot;&lt;/td&gt;&quot;);
 426             tagBuffer.append(&quot;&lt;td valign=\&quot;center\&quot;&gt;&lt;ul&gt;&quot;);
 427             Map map = baseTCR.getOptions();
 428             Iterator iter = map.keySet().iterator();
 429             while(iter.hasNext()) {
 430                 Object key = iter.next().toString();
 431                 Object value = map.get(key).toString();
 432                 tagBuffer.append(&quot;&lt;li&gt;&quot; + key + &quot; = &quot; + value + &quot;&lt;/li&gt;&quot;);
 433             }
 434             tagBuffer.append(&quot;&lt;/ul&gt;&lt;/td&gt;&quot;);
 435             tagBuffer.append(&quot;&lt;td valign=\&quot;center\&quot; align=\&quot;center\&quot;&gt;&quot; +
 436                              decimalFormat.format(baseTCR.getScore()) +
 437                              &quot;&lt;/td&gt;&quot;);
 438             tagBuffer.append(&quot;&lt;td valign=\&quot;center\&quot; align=\&quot;center\&quot;&gt;&quot; +
 439                              decimalFormat.format(targetTCR.getScore()) +
 440                              &quot;&lt;/td&gt;&quot;);
 441             tagBuffer.append(&quot;&lt;td valign=\&quot;center\&quot; align=\&quot;center\&quot;&gt;&quot; +
 442                              decimalFormat.format(
 443                                  calculateSpeedupPercentage(
 444                                      baseTCR.getScore(),
 445                                      targetTCR.getScore())) + &quot;&lt;/td&gt;&quot;);
 446             tagBuffer.append(&quot;&lt;/tr&gt;&quot;);
 447 
 448             switch(selColorIndex) {
 449                 case 0:
 450                     betterResultTags.append(tagBuffer.toString());
 451                     break;
 452                 case 1:
 453                     sameResultTags.append(tagBuffer.toString());
 454                     break;
 455                 case 2:
 456                     worseResultTags.append(tagBuffer.toString());
 457                     break;
 458             }
 459 
 460             Object curTotalScoreObj = consolBaseRes.get(baseTCR.getName());
 461             double curTotalScore = 0;
 462             if(curTotalScoreObj != null) {
 463                 curTotalScore = ((Double) curTotalScoreObj).doubleValue();
 464             }
 465             curTotalScore = curTotalScore + baseTCR.getScore();
 466             consolBaseRes.put(baseTCR.getName(), new Double(curTotalScore));
 467 
 468             curTotalScoreObj = consolTargetResult.get(targetTCR.getName());
 469             curTotalScore = 0;
 470             if(curTotalScoreObj != null) {
 471                 curTotalScore = ((Double) curTotalScoreObj).doubleValue();
 472             }
 473             curTotalScore = curTotalScore + targetTCR.getScore();
 474             consolTargetResult.put(targetTCR.getName(),
 475                                    new Double(curTotalScore));
 476         }
 477 
 478         writer.println(&quot;&lt;br&gt;&lt;hr WIDTH=\&quot;100%\&quot; size=\&quot;1\&quot;&gt;&quot;);
 479         writer.println(&quot;&lt;A NAME=\&quot;results\&quot;&gt;&lt;/A&gt;&lt;H3&gt;Results:&lt;/H3&gt;&quot;);
 480 
 481         writer.println(&quot;&lt;table cellspacing=\&quot;0\&quot; &quot; +
 482                          &quot;cellpadding=\&quot;3\&quot; border=\&quot;1\&quot; width=\&quot;80%\&quot;&gt;&quot;);
 483 
 484         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;7\&quot; bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
 485                        &quot;&lt;font size=\&quot;+1\&quot;&gt;Tests which run BETTER on target&quot; +
 486                        &quot;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
 487         writer.println(betterResultTags.toString());
 488         writer.flush();
 489 
 490         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;7\&quot;&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&quot;);
 491         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;7\&quot; bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
 492                        &quot;&lt;font size=\&quot;+1\&quot;&gt;Tests which run &quot; +
 493                        &quot;SAME on target&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
 494         writer.println(sameResultTags.toString());
 495         writer.flush();
 496 
 497         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;7\&quot;&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&quot;);
 498         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;7\&quot; bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
 499                        &quot;&lt;font size=\&quot;+1\&quot;&gt;Tests which run WORSE on target&quot; +
 500                        &quot;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
 501         writer.println(worseResultTags.toString());
 502         writer.flush();
 503 
 504         writer.println(&quot;&lt;/table&gt;&quot;);
 505 
 506         writer.println(getFooter());
 507         writer.flush();
 508 
 509         writer.close();
 510 
 511         generateTestCaseSummaryReport(baseSRSH, targetSRSH,
 512                                       consolBaseRes, consolTargetResult,
 513                                       testCaseBaseResult,
 514                                       testCaseResultCount,
 515                                       testCaseTargetResult);
 516 
 517         generateGroupSummaryReport(baseSRSH, targetSRSH,
 518                                    consolBaseRes, consolTargetResult,
 519                                    testCaseBaseResult,
 520                                    testCaseResultCount, testCaseTargetResult);
 521     }
 522 
 523     /**
 524      * Generate Group-Summary report - Summary_Report.html
 525      */
 526     private static void generateGroupSummaryReport(
 527         J2DAnalyzer.SingleResultSetHolder baseSRSH,
 528         J2DAnalyzer.SingleResultSetHolder targetSRSH,
 529         Map consolBaseResult,
 530         Map consolTargetResult,
 531         Map testCaseBaseResult,
 532         Map testCaseResultCount,
 533         Map testCaseTargetResult) {
 534 
 535         File groupSummaryReportFile =
 536             new File(resultsDir, &quot;Summary_Report.html&quot;);
 537         PrintWriter writer =
 538             openFile(groupSummaryReportFile.getAbsolutePath(),
 539                      HTMLGEN_FILE_NEW);
 540 
 541         String header = getHeader(baseSRSH, targetSRSH,
 542                                   &quot;J2DBench - Summary Report&quot;,
 543                                   &quot;System_Properties.html&quot;);
 544         writer.println(header);
 545         writer.flush();
 546 
 547         writer.println(&quot;&lt;br&gt;&lt;hr size=\&quot;1\&quot;&gt;&quot;);
 548 
 549         Map baseValuesMap = new HashMap();
 550         Map targetValuesMap = new HashMap();
 551 
 552         String tempGroup = null;
 553         for(int i=0; i&lt;groups.size(); i++) {
 554             tempGroup = groups.get(i).toString();
 555             baseValuesMap.put(tempGroup, new Double(0));
 556             targetValuesMap.put(tempGroup, new Double(0));
 557         }
 558 
 559 
 560         Object key = null;
 561         double baseValue = 0, targetValue = 0;
 562         Iterator resultsIter = consolBaseResult.keySet().iterator();
 563 
 564         while(resultsIter.hasNext()) {
 565 
 566             key = resultsIter.next();
 567 
 568             baseValue = ((Double) consolBaseResult.get(key)).doubleValue();
 569             targetValue = ((Double) consolTargetResult.get(key)).doubleValue();
 570 
 571             tempGroup = getGroup(key.toString());
 572 
 573             Object curTotalScoreObj = null;
 574             double curTotalScore = 0;
 575 
 576             curTotalScoreObj = baseValuesMap.get(tempGroup);
 577             if(curTotalScoreObj != null) {
 578                 curTotalScore = ((Double) curTotalScoreObj).doubleValue();
 579             }
 580             curTotalScore = curTotalScore + baseValue;
 581             baseValuesMap.put(tempGroup, new Double(curTotalScore));
 582 
 583             curTotalScore = 0;
 584             curTotalScoreObj = targetValuesMap.get(tempGroup);
 585             if(curTotalScoreObj != null) {
 586                 curTotalScore = ((Double) curTotalScoreObj).doubleValue();
 587             }
 588             curTotalScore = curTotalScore + targetValue;
 589             targetValuesMap.put(tempGroup, new Double(curTotalScore));
 590         }
 591 
 592         writer.println(&quot;&lt;A NAME=\&quot;results_summary\&quot;&gt;&lt;/A&gt;&quot; +
 593                        &quot;&lt;H3&gt;Results Summary:&lt;/H3&gt;&quot;);
 594         writer.println(&quot;&lt;table cols=\&quot;4\&quot; cellspacing=\&quot;0\&quot; &quot; +
 595                        &quot;cellpadding=\&quot;3\&quot; border=\&quot;1\&quot; width=\&quot;80%\&quot;&gt;&quot;);
 596         writer.println(&quot;&lt;TR BGCOLOR=\&quot;#CCCCFF\&quot;&gt;&quot;);
 597         writer.println(&quot;&lt;TD&gt;&lt;B&gt;Testcase&lt;/B&gt;&lt;/TD&gt;&quot;);
 598         writer.println(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;B&gt;Score for &quot; + baseBuild +
 599                        &quot;&lt;/B&gt;&lt;/TD&gt;&quot;);
 600         writer.println(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;B&gt;Score for &quot; + targetBuild +
 601                        &quot;&lt;/B&gt;&lt;/TD&gt;&quot;);
 602         writer.println(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;B&gt;% Speedup&lt;/TD&gt;&quot;);
 603         writer.println(&quot;&lt;/TR&gt;&quot;);
 604 
 605         StringBuffer betterResultTags = new StringBuffer();
 606         StringBuffer sameResultTags = new StringBuffer();
 607         StringBuffer worseResultTags = new StringBuffer();
 608 
 609         resultsIter = baseValuesMap.keySet().iterator();
 610 
 611         double speedup = 0;
 612 
 613         while(resultsIter.hasNext()) {
 614 
 615             key = resultsIter.next();
 616 
 617             baseValue = ((Double) baseValuesMap.get(key)).doubleValue();
 618             targetValue = ((Double) targetValuesMap.get(key)).doubleValue();
 619             speedup = calculateSpeedupPercentage(baseValue, targetValue);
 620 
 621             int selColorIndex = selectColor(baseValue, targetValue);
 622 
 623             String tcFileName = key.toString().replace(&#39;.&#39;, &#39;_&#39;);
 624             tcFileName = tcFileName.toLowerCase() + &quot;.html&quot;;
 625 
 626             switch(selColorIndex) {
 627                 case 0:
 628                     betterResultTags.append(&quot;&lt;tr bgcolor=\&quot;&quot;+
 629                                             color[selColorIndex] + &quot;\&quot;&gt;&quot;);
 630                     betterResultTags.append(&quot;&lt;td&gt;&lt;a href=&quot; +
 631                         &quot;\&quot;Testcase_Summary_Report.html#status_&quot; + key +
 632                                             &quot;\&quot;&gt;&quot; + groupNames.get(key) +
 633                                             &quot;&lt;/a&gt;&lt;/td&gt;&quot;);
 634                     betterResultTags.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; +
 635                                             decimalFormat.format(baseValue) +
 636                                             &quot;&lt;/td&gt;&quot;);
 637                     betterResultTags.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; +
 638                                             decimalFormat.format(targetValue) +
 639                                             &quot;&lt;/td&gt;&quot;);
 640                     betterResultTags.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; +
 641                                             decimalFormat.format(speedup) +
 642                                             &quot;&lt;/td&gt;&quot;);
 643                     betterResultTags.append(&quot;&lt;/tr&gt;&quot;);
 644                     break;
 645                 case 1:
 646                     sameResultTags.append(&quot;&lt;tr bgcolor=\&quot;&quot;+
 647                                           color[selColorIndex] + &quot;\&quot;&gt;&quot;);
 648                     sameResultTags.append(&quot;&lt;td&gt;&quot; +
 649                         &quot;&lt;a href=\&quot;Testcase_Summary_Report.html#status_&quot; + key +
 650                                           &quot;\&quot;&gt;&quot; + groupNames.get(key) +
 651                                           &quot;&lt;/a&gt;&lt;/td&gt;&quot;);
 652                     sameResultTags.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; +
 653                                           decimalFormat.format(baseValue) +
 654                                           &quot;&lt;/td&gt;&quot;);
 655                     sameResultTags.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; +
 656                                           decimalFormat.format(targetValue) +
 657                                           &quot;&lt;/td&gt;&quot;);
 658                     sameResultTags.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; +
 659                                           decimalFormat.format(speedup) +
 660                                           &quot;&lt;/td&gt;&quot;);
 661                     sameResultTags.append(&quot;&lt;/tr&gt;&quot;);
 662                     break;
 663                 case 2:
 664                     worseResultTags.append(&quot;&lt;tr bgcolor=\&quot;&quot;+
 665                                            color[selColorIndex] + &quot;\&quot;&gt;&quot;);
 666                     worseResultTags.append(&quot;&lt;td&gt;&quot; +
 667                         &quot;&lt;a href=\&quot;Testcase_Summary_Report.html#status_&quot; + key +
 668                                            &quot;\&quot;&gt;&quot; + groupNames.get(key) +
 669                                            &quot;&lt;/a&gt;&lt;/td&gt;&quot;);
 670                     worseResultTags.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; +
 671                                            decimalFormat.format(baseValue) +
 672                                            &quot;&lt;/td&gt;&quot;);
 673                     worseResultTags.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; +
 674                                            decimalFormat.format(targetValue) +
 675                                            &quot;&lt;/td&gt;&quot;);
 676                     worseResultTags.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; +
 677                                            decimalFormat.format(speedup) +
 678                                            &quot;&lt;/td&gt;&quot;);
 679                     worseResultTags.append(&quot;&lt;/tr&gt;&quot;);
 680                     break;
 681             }
 682         }
 683 
 684         writer.println(betterResultTags.toString());
 685         writer.flush();
 686 
 687         writer.println(sameResultTags.toString());
 688         writer.flush();
 689 
 690         writer.println(worseResultTags.toString());
 691         writer.flush();
 692 
 693         writer.println(&quot;&lt;/table&gt;&quot;);
 694 
 695         writer.println(getFooter());
 696         writer.flush();
 697         writer.close();
 698     }
 699 
 700     /**
 701      * Generate Testcase Summary Report - Testcase_Summary_Report.html
 702      */
 703     private static void generateTestCaseSummaryReport(
 704         J2DAnalyzer.SingleResultSetHolder baseSRSH,
 705         J2DAnalyzer.SingleResultSetHolder targetSRSH,
 706         Map consolBaseResult,
 707         Map consolTargetResult,
 708         Map testCaseBaseResult,
 709         Map testCaseResultCount,
 710         Map testCaseTargetResult) {
 711 
 712         File tcSummaryReportFile =
 713             new File(resultsDir, &quot;Testcase_Summary_Report.html&quot;);
 714         PrintWriter writer =
 715             openFile(tcSummaryReportFile.getAbsolutePath(), HTMLGEN_FILE_NEW);
 716 
 717         String header = getHeader(baseSRSH, targetSRSH,
 718                                   &quot;J2DBench - Testcase Summary Report&quot;,
 719                                   &quot;System_Properties.html&quot;);
 720         writer.println(header);
 721         writer.flush();
 722 
 723         StringBuffer testResultsStartBuffer = new StringBuffer();
 724         testResultsStartBuffer.append(&quot;&lt;TR BGCOLOR=\&quot;#CCCCFF\&quot;&gt;&quot;);
 725         testResultsStartBuffer.append(&quot;&lt;TD&gt;&lt;B&gt;Testcase&lt;/B&gt;&lt;/TD&gt;&quot;);
 726         testResultsStartBuffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;B&gt;Score for &quot; +
 727                                       baseBuild + &quot;&lt;/B&gt;&lt;/TD&gt;&quot;);
 728         testResultsStartBuffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;B&gt;Score for &quot; +
 729                                      targetBuild + &quot;&lt;/B&gt;&lt;/TD&gt;&quot;);
 730         testResultsStartBuffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;B&gt;% Speedup&lt;/TD&gt;&quot;);
 731         testResultsStartBuffer.append(&quot;&lt;/TR&gt;&quot;);
 732 
 733         StringBuffer testResultsScoreBuffer = new StringBuffer();
 734         testResultsScoreBuffer.append(&quot;&lt;table cols=\&quot;4\&quot; cellspacing=\&quot;0\&quot; &quot; +
 735                                       &quot;cellpadding=\&quot;3\&quot; border=\&quot;1\&quot; &quot; +
 736                                       &quot;width=\&quot;80%\&quot;&gt;&quot;);
 737 
 738         StringBuffer betterResultTags = new StringBuffer();
 739         StringBuffer sameResultTags = new StringBuffer();
 740         StringBuffer worseResultTags = new StringBuffer();
 741 
 742         Double baseValue = null, targetValue = null;
 743 
 744         String curGroupName = null;
 745         String curTestName = null;
 746 
 747         Object[] groupNameArray = groups.toArray();
 748         Arrays.sort(groupNameArray);
 749 
 750         Object[] testCaseList = consolBaseResult.keySet().toArray();
 751         Arrays.sort(testCaseList);
 752 
 753         writer.println(&quot;&lt;br&gt;&lt;hr size=\&quot;1\&quot;&gt;&lt;br&gt;&quot;);
 754         writer.println(&quot;&lt;A NAME=\&quot;status\&quot;&gt;&lt;/A&gt;&lt;H3&gt;Status:&lt;/H3&gt;&quot;);
 755 
 756         writer.println(&quot;&lt;table cellspacing=\&quot;0\&quot; &quot; +
 757                        &quot;cellpadding=\&quot;3\&quot; border=\&quot;1\&quot; width=\&quot;80%\&quot;&gt;&quot;);
 758 
 759         for(int j=0; j&lt;groupNameArray.length; j++) {
 760 
 761             if(j != 0) {
 762                 testResultsScoreBuffer.append(&quot;&lt;tr&gt;&lt;td colspan=\&quot;4\&quot;&gt;&amp;nbsp;&quot; +
 763                                               &quot;&lt;br&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&quot;);
 764                 writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;5\&quot;&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;&quot; +
 765                                &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
 766             }
 767 
 768             curGroupName = groupNameArray[j].toString();
 769 
 770             writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;5\&quot; valign=\&quot;center\&quot; &quot; +
 771                            &quot;bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
 772                            &quot;&lt;A NAME=\&quot;status_&quot; + curGroupName + &quot;\&quot;&gt;&lt;/A&gt;&quot; +
 773                            &quot;&lt;font size=\&quot;+1\&quot;&gt;Status - &quot; +
 774                            groupNames.get(curGroupName) + &quot;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
 775             writer.println(&quot;&lt;tr&gt;&quot;);
 776             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot;&gt;&lt;b&gt;Tests &quot; +
 777                            &quot;Performance&lt;/b&gt;&lt;/td&gt;&quot;);
 778             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 779                            &quot;&lt;b&gt;BETTER (Num / %)&lt;/b&gt;&lt;/td&gt;&quot;);
 780             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 781                            &quot;&lt;b&gt;SAME (Num / %)&lt;/b&gt;&lt;/td&gt;&quot;);
 782             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 783                            &quot;&lt;b&gt;WORSE (Num / %)&lt;/b&gt;&lt;/td&gt;&quot;);
 784             writer.println(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
 785                            &quot;&lt;b&gt;Total&lt;/b&gt;&lt;/td&gt;&quot;);
 786             writer.println(&quot;&lt;/tr&gt;&quot;);
 787             writer.flush();
 788 
 789             testResultsScoreBuffer.append(&quot;&lt;tr&gt;&lt;td colspan=\&quot;4\&quot; &quot; +
 790                                           &quot;valign=\&quot;center\&quot; &quot; +
 791                                           &quot;bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
 792                                           &quot;&lt;A NAME=\&quot;test_result_&quot; +
 793                                           curGroupName +
 794                                           &quot;\&quot;&gt;&lt;/A&gt;&lt;font size=\&quot;+1\&quot;&gt;&quot; +
 795                                           &quot;Test Results - &quot; +
 796                                           groupNames.get(curGroupName) +
 797                                           &quot;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
 798             testResultsScoreBuffer.append(testResultsStartBuffer);
 799 
 800             String[] tableTags = null;
 801 
 802             for(int i=0; i&lt;testCaseList.length; i++) {
 803 
 804                 curTestName = testCaseList[i].toString();
 805 
 806                 if(curTestName.startsWith(curGroupName)) {
 807 
 808                     tableTags = generateTestCaseReport(
 809                         curGroupName, curTestName, baseSRSH, targetSRSH,
 810                         testCaseResultCount, testCaseBaseResult,
 811                         testCaseTargetResult);
 812 
 813                     writer.println(tableTags[0]);
 814                     writer.flush();
 815 
 816                     testResultsScoreBuffer.append(tableTags[1]);
 817                 }
 818             }
 819         }
 820 
 821         testResultsScoreBuffer.append(&quot;&lt;/table&gt;&quot;);
 822         writer.println(&quot;&lt;/table&gt;&quot;);
 823 
 824         writer.println(&quot;&lt;br&gt;&lt;hr size=\&quot;1\&quot;&gt;&lt;br&gt;&quot;);
 825         writer.println(&quot;&lt;A NAME=\&quot;test_results\&quot;&gt;&lt;/A&gt;&lt;H3&gt;Test Results:&lt;/H3&gt;&quot;);
 826         writer.println(testResultsScoreBuffer.toString());
 827         writer.flush();
 828 
 829         writer.println(getFooter());
 830         writer.flush();
 831 
 832         writer.close();
 833     }
 834 
 835     /**
 836      *|----------|------------------------|--------------------------|-----------|
 837      *| Testcase | Score for &lt;base build&gt; | Score for &lt;target build&gt; | % Speedup |
 838      *|----------|------------------------|--------------------------|-----------|
 839      *
 840      */
 841     private static String getTestResultsTableForSummary(String testName,
 842                                                         double baseScore,
 843                                                         double targetScore)
 844     {
 845 
 846         double totalScore = baseScore + targetScore;
 847 
 848         String fileName = testName.replace(&#39;.&#39;, &#39;_&#39;);
 849         fileName = fileName.toLowerCase() + &quot;.html&quot;;
 850 
 851         int selColorIndex = selectColor(baseScore, targetScore);
 852 
 853         StringBuffer buffer = new StringBuffer();
 854 
 855         buffer.append(&quot;&lt;TR BGCOLOR=\&quot;&quot; + color[selColorIndex] + &quot;\&quot;&gt;&quot;);
 856         buffer.append(&quot;&lt;TD&gt;&lt;P&gt;&lt;A HREF=\&quot;testcases/&quot; + fileName +
 857                       &quot;\&quot;&gt;&quot; + testName + &quot;&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 858         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;P&gt;&lt;A HREF=\&quot;testcases/&quot; +
 859                       fileName +
 860                       &quot;\&quot;&gt;&lt;B&gt;&quot; + decimalFormat.format(baseScore) +
 861                       &quot;&lt;/B&gt;&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 862         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;P&gt;&lt;A HREF=\&quot;testcases/&quot; +
 863                       fileName + &quot;\&quot;&gt;&lt;B&gt;&quot; + decimalFormat.format(targetScore) +
 864                       &quot;&lt;/B&gt;&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 865         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;P&gt;&lt;A HREF=\&quot;testcases/&quot; +
 866                       fileName + &quot;\&quot;&gt;&lt;B&gt;&quot; +
 867                       decimalFormat.format(calculateSpeedupPercentage(
 868                           baseScore,
 869                           targetScore)) +
 870                       &quot;&lt;/B&gt;&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 871         buffer.append(&quot;&lt;/TR&gt;&quot;);
 872 
 873         return buffer.toString();
 874     }
 875 
 876     /**
 877      *|-------------------|-------------------|-----------------|-------------------|--------|
 878      *| Tests Performance | BETTER  (Num / %) | SAME  (Num / %) | WORSE  ( Num / %) | Total  |
 879      *|-------------------|-------------------|-----------------|-------------------|--------|
 880      *
 881      */
 882     private static String getStatusTableForSummary(
 883         String curGroupName, String testName, int nBetter,
 884         int nSame, int nWorse)
 885     {
 886 
 887         String fileName = testName.replace(&#39;.&#39;, &#39;_&#39;);
 888         fileName = fileName.toLowerCase() + &quot;.html&quot;;
 889 
 890         int totalTests = nBetter + nSame + nWorse;
 891 
 892         StringBuffer buffer = new StringBuffer();
 893 
 894         buffer.append(&quot;&lt;TR&gt;&quot;);
 895         buffer.append(&quot;&lt;TD&gt;&lt;P&gt;&lt;A HREF=\&quot;#test_result_&quot; + curGroupName +
 896                       &quot;\&quot;&gt;&quot; + testName + &quot;&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 897         buffer.append(&quot;&lt;TD BGCOLOR=\&quot;#99FF99\&quot; align=\&quot;center\&quot;&gt;&lt;P&gt;&quot; +
 898                       &quot;&lt;A HREF=\&quot;#test_result_&quot; + curGroupName +
 899                       &quot;\&quot;&gt;&lt;B&gt;&quot; + nBetter + &quot;&lt;/A&gt;&lt;/B&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(&quot; +
 900                       (nBetter * 100)/totalTests + &quot;%)&lt;/P&gt;&lt;/TD&gt;&quot;);
 901         buffer.append(&quot;&lt;TD BGCOLOR=\&quot;#CCFFFF\&quot; align=\&quot;center\&quot;&gt;&lt;P&gt;&quot; +
 902                       &quot;&lt;A HREF=\&quot;#test_result_&quot; + curGroupName +
 903                       &quot;\&quot;&gt;&lt;B&gt;&quot; + nSame + &quot;&lt;/A&gt;&lt;/B&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(&quot; +
 904                       (nSame * 100)/totalTests + &quot;%)&lt;/P&gt;&lt;/TD&gt;&quot;);
 905         buffer.append(&quot;&lt;TD BGCOLOR=\&quot;#FFCC00\&quot; align=\&quot;center\&quot;&gt;&lt;P&gt;&quot; +
 906                       &quot;&lt;A HREF=\&quot;#test_result_&quot; + curGroupName +
 907                       &quot;\&quot;&gt;&lt;B&gt;&quot; + nWorse + &quot;&lt;/A&gt;&lt;/B&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(&quot; +
 908                       (nWorse * 100)/totalTests + &quot;%)&lt;/P&gt;&lt;/TD&gt;&quot;);
 909         buffer.append(&quot;&lt;TD BGCOLOR=\&quot;#FFFFFF\&quot; align=\&quot;center\&quot;&gt;&lt;P&gt;&quot; +
 910                       &quot;&lt;A HREF=\&quot;#test_result_&quot; + curGroupName +
 911                       &quot;\&quot;&gt;&lt;B&gt;&quot; + totalTests + &quot;&lt;/B&gt;&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 912         buffer.append(&quot;&lt;/TR&gt;&quot;);
 913 
 914         return buffer.toString();
 915     }
 916 
 917     /**
 918      *  |-------------------|-----------------|------------------------------|
 919      *  | Tests performance | Number of tests | % from total number of tests |
 920      *  |-------------------|-----------------|------------------------------|
 921      *
 922      */
 923     private static String getPerformanceTableForTestcase(
 924         String testName, int nBetter, int nSame, int nWorse) {
 925 
 926         StringBuffer buffer = new StringBuffer();
 927 
 928         int totalTests = nBetter + nSame + nWorse;
 929 
 930         buffer.append(&quot;&lt;hr size=\&quot;1\&quot;&gt;&quot;);
 931         buffer.append(&quot;&lt;H3&gt;Status:&lt;/H3&gt;&quot;);
 932 
 933         buffer.append(&quot;&lt;table cols=\&quot;4\&quot; cellspacing=\&quot;0\&quot; &quot; +
 934                       &quot;cellpadding=\&quot;3\&quot; border=\&quot;1\&quot; width=\&quot;80%\&quot;&gt;&quot;);
 935         buffer.append(&quot;&lt;TR BGCOLOR=\&quot;#CCCCFF\&quot;&gt;&quot;);
 936         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;B&gt;Tests performance&lt;/B&gt;&lt;/TD&gt;&quot;);
 937         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;B&gt;Number of tests&lt;/B&gt;&lt;/TD&gt;&quot;);
 938         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;B&gt;% from total number of &quot; +
 939                       &quot;tests&lt;/B&gt;&lt;/TD&gt;&quot;);
 940         buffer.append(&quot;&lt;/TR&gt;&quot;);
 941 
 942         buffer.append(&quot;&lt;TR BGCOLOR=\&quot;#99FF99\&quot;&gt;&quot;);
 943         buffer.append(&quot;&lt;TD&gt;&lt;P&gt;&lt;A HREF=\&quot;#better\&quot;&gt;&quot; +
 944                       &quot;Target is at least 10 percent BETTER&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 945         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;P&gt;&lt;A HREF=\&quot;#better\&quot;&gt;&lt;B&gt;&quot; +
 946                       nBetter + &quot;&lt;/B&gt;&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 947         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;P&gt;&quot; + (nBetter * 100/totalTests) +
 948                       &quot;&lt;/P&gt;&lt;/TD&gt;&quot;);
 949         buffer.append(&quot;&lt;/TR&gt;&quot;);
 950 
 951         buffer.append(&quot;&lt;TR BGCOLOR=\&quot;#CCFFFF\&quot;&gt;&quot;);
 952         buffer.append(&quot;&lt;TD&gt;&lt;P&gt;&lt;A HREF=\&quot;#same\&quot;&gt;&quot; +
 953                       &quot;The same within 10 percent&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 954         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;P&gt;&lt;A HREF=\&quot;#same\&quot;&gt;&lt;B&gt;&quot; +
 955                       nSame + &quot;&lt;/B&gt;&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 956         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;P&gt;&quot; + (nSame * 100/totalTests) +
 957                       &quot;&lt;/P&gt;&lt;/TD&gt;&quot;);
 958         buffer.append(&quot;&lt;/TR&gt;&quot;);
 959 
 960         buffer.append(&quot;&lt;TR BGCOLOR=\&quot;#FFCC00\&quot;&gt;&quot;);
 961         buffer.append(&quot;&lt;TD&gt;&lt;P&gt;&lt;A HREF=\&quot;#worse\&quot;&gt;&quot; +
 962                       &quot;Target is at least 10 percent WORSE&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 963         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;P&gt;&lt;A HREF=\&quot;#worse\&quot;&gt;&lt;B&gt;&quot; +
 964                       nWorse + &quot;&lt;/B&gt;&lt;/A&gt;&lt;/P&gt;&lt;/TD&gt;&quot;);
 965         buffer.append(&quot;&lt;TD align=\&quot;center\&quot;&gt;&lt;P&gt;&quot; + (nWorse * 100/totalTests) +
 966                       &quot;&lt;/P&gt;&lt;/TD&gt;&quot;);
 967         buffer.append(&quot;&lt;/TR&gt;&quot;);
 968 
 969         buffer.append(&quot;&lt;/TABLE&gt;&quot;);
 970 
 971         return buffer.toString();
 972     }
 973 
 974     /**
 975      *  |-----------|---------|--------------------|----------------------|------------|
 976      *  | Num Units | Options | &lt;base build&gt; Score | &lt;target build&gt; Score | % Speedup  |
 977      *  |-----------|---------|--------------------|----------------------|------------|
 978      *
 979      *  String[0] = getStatusTableForSummary()
 980      *  String[1] = getTestResultsTableForSummary()
 981      *
 982      * Generate Testcase Report - testcases/&lt;testcase name&gt;.html
 983      */
 984     private static String[] generateTestCaseReport(
 985         String curGroupName,
 986         Object key,
 987         J2DAnalyzer.SingleResultSetHolder baseSRSH,
 988         J2DAnalyzer.SingleResultSetHolder targetSRSH,
 989         Map testCaseResultCount,
 990         Map testCaseBaseResult,
 991         Map testCaseTargetResult) {
 992 
 993         int numBetterTestCases = 0;
 994         int numWorseTestCases = 0;
 995         int numSameTestCases = 0;
 996 
 997         StringBuffer tcStartTags = new StringBuffer();
 998         tcStartTags.append(&quot;&lt;tr&gt;&quot;);
 999         tcStartTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
1000                            &quot;&lt;b&gt;Num Units&lt;/b&gt;&lt;/td&gt;&quot;);
1001         tcStartTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
1002                            &quot;&lt;b&gt;Options&lt;/b&gt;&lt;/td&gt;&quot;);
1003         tcStartTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&lt;b&gt;&quot; +
1004                            baseBuild + &quot; Score&lt;/b&gt;&lt;/td&gt;&quot;);
1005         tcStartTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&lt;b&gt;&quot; +
1006                            targetBuild + &quot; Score&lt;/b&gt;&lt;/td&gt;&quot;);
1007         tcStartTags.append(&quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot; align=\&quot;center\&quot;&gt;&quot; +
1008                            &quot;&lt;b&gt;% Speedup&lt;/b&gt;&lt;/td&gt;&quot;);
1009         tcStartTags.append(&quot;&lt;/tr&gt;&quot;);
1010 
1011         StringBuffer worseTestcaseResultTags =
1012             new StringBuffer(tcStartTags.toString());
1013         StringBuffer sameTestcaseResultTags =
1014             new StringBuffer(tcStartTags.toString());
1015         StringBuffer betterTestcaseResultTags =
1016             new StringBuffer(tcStartTags.toString());
1017 
1018         Object curTestCountObj = testCaseResultCount.get(key.toString());
1019         int curTestCount = 0;
1020         if(curTestCountObj != null) {
1021             curTestCount = ((Integer) curTestCountObj).intValue();
1022         }
1023 
1024         String fileName = key.toString().replace(&#39;.&#39;, &#39;_&#39;);
1025         fileName = fileName.toLowerCase() + &quot;.html&quot;;
1026         File testcaseReportFile =
1027             new File(resultsDir + File.separator + &quot;testcases&quot;, fileName);
1028         PrintWriter writer = openFile(
1029             testcaseReportFile.getAbsolutePath(), HTMLGEN_FILE_NEW);
1030 
1031         String header = getHeader(baseSRSH, targetSRSH,
1032                                   &quot;J2DBench - &quot; + key.toString(),
1033                                   &quot;../System_Properties.html&quot;);
1034         writer.println(header);
1035         writer.flush();
1036 
1037         double totalBaseScore = 0;
1038         double totalTargetScore = 0;
1039 
1040         for(int i=0; i&lt;curTestCount; i++) {
1041 
1042             J2DAnalyzer.ResultHolder baseTCR =
1043                 (J2DAnalyzer.ResultHolder)testCaseBaseResult.get(
1044                     key.toString() + &quot;_&quot; + i);
1045             J2DAnalyzer.ResultHolder targetTCR =
1046                 (J2DAnalyzer.ResultHolder) testCaseTargetResult.get(
1047                     key.toString() + &quot;_&quot; + i);
1048 
1049             double baseScore = baseTCR.getScore();
1050             double targetScore = targetTCR.getScore();
1051 
1052             StringBuffer tcTagBuffer = new StringBuffer();
1053 
1054             int selColorIndex = selectColor(baseScore, targetScore);
1055             tcTagBuffer.append(&quot;&lt;tr bgcolor=\&quot;&quot;+ color[selColorIndex] + &quot;\&quot;&gt;&quot;);
1056             tcTagBuffer.append(&quot;&lt;td align=\&quot;center\&quot;&gt;&quot; + baseTCR.getUnits() +
1057                                &quot;&lt;/td&gt;&quot;);
1058             tcTagBuffer.append(&quot;&lt;td valign=\&quot;center\&quot;&gt;&quot;);
1059 
1060             Map map = baseTCR.getOptions();
1061             Iterator iter = map.keySet().iterator();
1062             Object subKey=null, subValue=null;
1063             tcTagBuffer.append(&quot;&lt;ul&gt;&quot;);
1064             while(iter.hasNext()) {
1065                 subKey = iter.next().toString();
1066                 subValue = map.get(subKey).toString();
1067                 tcTagBuffer.append(&quot;&lt;li&gt;&quot; + subKey + &quot; = &quot; +
1068                                    subValue + &quot;&lt;/li&gt;&quot;);
1069             }
1070             tcTagBuffer.append(&quot;&lt;/ul&gt;&lt;/td&gt;&quot;);
1071             tcTagBuffer.append(&quot;&lt;td valign=\&quot;center\&quot; align=\&quot;center\&quot;&gt;&quot; +
1072                                decimalFormat.format(baseTCR.getScore()) +
1073                                &quot;&lt;/td&gt;&quot;);
1074             tcTagBuffer.append(&quot;&lt;td valign=\&quot;center\&quot; align=\&quot;center\&quot;&gt;&quot; +
1075                                decimalFormat.format(targetTCR.getScore()) +
1076                                &quot;&lt;/td&gt;&quot;);
1077             tcTagBuffer.append(&quot;&lt;td valign=\&quot;center\&quot; align=\&quot;center\&quot;&gt;&quot; +
1078                                decimalFormat.format(
1079                                    calculateSpeedupPercentage(
1080                                        baseTCR.getScore(),
1081                                        targetTCR.getScore())) +
1082                                    &quot;&lt;/td&gt;&quot;);
1083             tcTagBuffer.append(&quot;&lt;/tr&gt;&quot;);
1084 
1085             totalBaseScore = totalBaseScore + baseTCR.getScore();
1086             totalTargetScore = totalTargetScore + targetTCR.getScore();
1087 
1088             switch(selColorIndex) {
1089                 case 0:
1090                     betterTestcaseResultTags.append(tcTagBuffer.toString());
1091                     numBetterTestCases++;
1092                     break;
1093                 case 1:
1094                     sameTestcaseResultTags.append(tcTagBuffer.toString());
1095                     numSameTestCases++;
1096                     break;
1097                 case 2:
1098                     worseTestcaseResultTags.append(tcTagBuffer.toString());
1099                     numWorseTestCases++;
1100                     break;
1101             }
1102         }
1103 
1104         String performanceTable =
1105             getPerformanceTableForTestcase(key.toString(),
1106                                            numBetterTestCases, numSameTestCases,
1107                                            numWorseTestCases);
1108 
1109         writer.println(performanceTable);
1110         writer.flush();
1111 
1112         writer.println(&quot;&lt;hr size=\&quot;1\&quot;&gt;&quot;);
1113         writer.println(&quot;&lt;A NAME=\&quot;details\&quot;&gt;&lt;/A&gt;&lt;H3&gt;Details:&lt;/H3&gt;&quot;);
1114 
1115         writer.println(&quot;&lt;table cellspacing=\&quot;0\&quot; &quot; +
1116                        &quot;cellpadding=\&quot;3\&quot; border=\&quot;1\&quot; width=\&quot;80%\&quot;&gt;&quot;);
1117 
1118         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;5\&quot; &quot; +
1119                        &quot;valign=\&quot;center\&quot; bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
1120                        &quot;&lt;a name=\&quot;better\&quot;&gt;&lt;/a&gt;&lt;font size=\&quot;+1\&quot;&gt;&quot; +
1121                        key.toString() +
1122                        &quot; Tests which run BETTER on target&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
1123         writer.println(betterTestcaseResultTags.toString());
1124         writer.flush();
1125 
1126         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;5\&quot;&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&quot;);
1127 
1128         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;5\&quot; &quot; +
1129                        &quot;valign=\&quot;center\&quot; bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
1130                        &quot;&lt;a name=\&quot;same\&quot;&gt;&lt;/a&gt;&lt;font size=\&quot;+1\&quot;&gt;&quot; +
1131                        key.toString() +
1132                        &quot; Tests which run SAME on target&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
1133         writer.println(sameTestcaseResultTags.toString());
1134         writer.flush();
1135 
1136         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;5\&quot;&gt;&amp;nbsp;&lt;br&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&quot;);
1137 
1138         writer.println(&quot;&lt;tr&gt;&lt;td colspan=\&quot;5\&quot; &quot; +
1139                        &quot;valign=\&quot;center\&quot; bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
1140                        &quot;&lt;a name=\&quot;worse\&quot;&gt;&lt;/a&gt;&lt;font size=\&quot;+1\&quot;&gt;&quot; +
1141                        key.toString() +
1142                        &quot; Tests which run WORSE on target&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
1143         writer.println(worseTestcaseResultTags.toString());
1144         writer.flush();
1145 
1146         writer.println(&quot;&lt;/table&gt;&quot;);
1147 
1148         writer.println(getFooter());
1149         writer.flush();
1150 
1151         writer.close();
1152 
1153         String statusTable =
1154             getStatusTableForSummary(curGroupName, key.toString(),
1155                                      numBetterTestCases,
1156                                      numSameTestCases, numWorseTestCases);
1157 
1158         String testResultsTable =
1159             getTestResultsTableForSummary(key.toString(),
1160                                           totalBaseScore, totalTargetScore);
1161 
1162         return new String[] {statusTable, testResultsTable};
1163     }
1164 
1165     /**
1166      * Returns footer tag for HTML files
1167      */
1168     private static String getFooter() {
1169 
1170         StringBuffer buffer = new StringBuffer();
1171 
1172         buffer.append(&quot;&lt;br&gt;&lt;hr WIDTH=\&quot;100%\&quot; size=\&quot;1\&quot;&gt;&quot;);
1173         buffer.append(&quot;&lt;A NAME=\&quot;legend\&quot;&gt;&lt;/A&gt;&lt;H3&gt;Legend:&lt;/H3&gt;&quot;);
1174         buffer.append(&quot;&lt;table cellspacing=\&quot;0\&quot; cellpadding=\&quot;3\&quot; &quot; +
1175                       &quot;border=\&quot;1\&quot; width=\&quot;80%\&quot;&gt;&quot;);
1176         buffer.append(&quot;&lt;TR BGCOLOR=\&quot;&quot; + color[0] +
1177                       &quot;\&quot;&gt;&lt;TD&gt;The result for &quot; + targetBuild +
1178                       &quot; is at least 10 percent BETTER than for &quot; + baseBuild +
1179                       &quot;&lt;/TD&gt;&lt;/TR&gt;&quot;);
1180         buffer.append(&quot;&lt;TR BGCOLOR=\&quot;&quot; + color[1] +
1181                       &quot;\&quot;&gt;&lt;TD&gt;The results for &quot; + targetBuild + &quot; and &quot; +
1182                       baseBuild + &quot; are within 10 percent&lt;/TD&gt;&lt;/TR&gt;&quot;);
1183         buffer.append(&quot;&lt;TR BGCOLOR=\&quot;&quot; + color[2] +
1184                       &quot;\&quot;&gt;&lt;TD&gt;The result for &quot; + targetBuild +
1185                       &quot; is at least 10 percent WORSE than &quot; + baseBuild +
1186                       &quot;&lt;/TD&gt;&lt;/TR&gt;&quot;);
1187         buffer.append(&quot;&lt;TR&gt;&lt;TD&gt;The &#39;Score&#39; is a number of &quot; +
1188                       &quot;successful rendering &quot; +
1189                       &quot;operations per second&lt;/TD&gt;&lt;/TR&gt;&quot;);
1190         buffer.append(&quot;&lt;/table&gt;&quot;);
1191 
1192         buffer.append(&quot;&lt;br&gt;&lt;hr WIDTH=\&quot;100%\&quot; size=\&quot;1\&quot;&gt;&quot;);
1193         buffer.append(&quot;&lt;/p&gt;&lt;hr WIDTH=\&quot;100%\&quot; size=\&quot;1\&quot;&gt;&lt;/body&gt;&lt;/html&gt;&quot;);
1194 
1195         return buffer.toString();
1196     }
1197 
1198     /**
1199      * Returns header tag for HTML files
1200      */
1201     private static String
1202         getHeader(J2DAnalyzer.SingleResultSetHolder baseSRSH,
1203                   J2DAnalyzer.SingleResultSetHolder targetSRSH,
1204                   String title,
1205                  String sysPropLoc)
1206     {
1207 
1208         StringBuffer buffer = new StringBuffer();
1209 
1210         String headerTitle = getHeaderTitle(title);
1211         buffer.append(headerTitle);
1212 
1213         //System Properties
1214         buffer.append(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#CCCCFF\&quot;&gt;&quot; +
1215                       &quot;&lt;b&gt;&lt;A HREF=\&quot;&quot; + sysPropLoc + &quot;\&quot;&gt;System Property&lt;/A&gt;&quot; +
1216                       &quot;&lt;/b&gt;&lt;/td&gt;&quot; +
1217                       &quot;&lt;td bgcolor=\&quot;#CCCCFF\&quot;&gt;&lt;b&gt;&lt;A HREF=\&quot;&quot; +
1218                       sysPropLoc + &quot;\&quot;&gt;Value&lt;A&gt;&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
1219         Map sysProps = targetSRSH.getProperties();
1220         buffer.append(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;os.name&lt;/td&gt;&lt;td&gt;&quot; +
1221                       sysProps.get(&quot;os.name&quot;) + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
1222         buffer.append(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;os.version&lt;/td&gt;&lt;td&gt;&quot; +
1223                       sysProps.get(&quot;os.version&quot;) + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
1224         buffer.append(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;os.arch&lt;/td&gt;&lt;td&gt;&quot; +
1225                       sysProps.get(&quot;os.arch&quot;) + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
1226 
1227         buffer.append(&quot;&lt;/table&gt;&quot;);
1228 
1229         return buffer.toString();
1230     }
1231 
1232     /**
1233      * Returns start tag and title tag for HTML files
1234      */
1235     private static String getHeaderTitle(String title) {
1236 
1237         StringBuffer buffer = new StringBuffer();
1238 
1239         buffer.append(&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;&quot; + title + &quot;&lt;/title&gt;&lt;/head&gt;&quot;);
1240         buffer.append(&quot;&lt;body bgcolor=\&quot;#ffffff\&quot;&gt;&lt;hr size=\&quot;1\&quot;&gt;&quot;);
1241         buffer.append(&quot;&lt;center&gt;&lt;h2&gt;&quot; + title + &quot;&lt;/h2&gt;&quot;);
1242         buffer.append(&quot;&lt;/center&gt;&lt;hr size=\&quot;1\&quot;&gt;&lt;br&gt;&quot;);
1243         buffer.append(&quot;&lt;table cols=\&quot;2\&quot; cellspacing=\&quot;2\&quot; cellpadding=\&quot;5\&quot; &quot; +
1244                       &quot;border=\&quot;0\&quot; width=\&quot;80%\&quot;&gt;&quot;);
1245         buffer.append(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#CCCCFF\&quot; colspan=\&quot;2\&quot;&gt;&quot; +
1246                       &quot;&lt;b&gt;Test Details&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
1247         buffer.append(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;Base Build&lt;/td&gt;&quot;);
1248         buffer.append(&quot;&lt;td&gt;&quot; + baseBuild + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
1249         buffer.append(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;Target Build&lt;/td&gt;&quot;);
1250         buffer.append(&quot;&lt;td&gt;&quot; + targetBuild + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
1251 
1252         return buffer.toString();
1253     }
1254 
1255     /**
1256      * Generats System-Properties HTML file - System_Property.html
1257      */
1258     private static void
1259         generateSysPropsReport(J2DAnalyzer.SingleResultSetHolder srsh)
1260     {
1261 
1262         File sysPropsFile =
1263             new File(resultsDir, &quot;System_Properties.html&quot;);
1264         PrintWriter writer =
1265             openFile(sysPropsFile.getAbsolutePath(), HTMLGEN_FILE_NEW);
1266 
1267         String headerTitle = getHeaderTitle(&quot;System Properties&quot;);
1268         writer.println(headerTitle);
1269         writer.flush();
1270 
1271         writer.println(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#CCCCFF\&quot;&gt;&lt;b&gt;&quot; +
1272                        &quot;System Property&lt;/b&gt;&lt;/td&gt;&lt;td bgcolor=\&quot;#CCCCFF\&quot;&gt;&quot; +
1273                        &quot;&lt;b&gt;Value&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
1274 
1275         String key = null;
1276         String value = null;
1277         Map sysProps = srsh.getProperties();
1278         Iterator iter = sysProps.keySet().iterator();
1279         while(iter.hasNext()) {
1280             key = iter.next().toString();
1281             value = sysProps.get(key).toString();
1282             writer.println(&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#f0f0f0\&quot;&gt;&quot; +
1283                            key + &quot;&lt;/td&gt;&lt;td&gt;&quot; + value + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
1284         }
1285         writer.println(&quot;&lt;/table&gt;&quot;);
1286         writer.flush();
1287 
1288         writer.println(&quot;&lt;br&gt;&lt;hr WIDTH=\&quot;100%\&quot; size=\&quot;1\&quot;&gt;&quot;);
1289         writer.println(&quot;&lt;/p&gt;&lt;hr WIDTH=\&quot;100%\&quot; size=\&quot;1\&quot;&gt;&lt;/body&gt;&lt;/html&gt;&quot;);
1290 
1291         writer.flush();
1292     }
1293 
1294     /**
1295      * Returns the index of color from color array based on the results
1296      * Can change this implementation so as to select based on some analysis.
1297      */
1298     private static int selectColor(double baseScore, double targetScore) {
1299 
1300         double res = calculateSpeedupPercentage(baseScore, targetScore);
1301 
1302         if (res &lt; -10) {
1303             return 2;
1304         } else if (res &gt; 10) {
1305             return 0;
1306         } else {
1307             return 1;
1308         }
1309     }
1310 
1311     /**
1312      * Calculate Speedup Percentage -&gt;
1313      *     ((target_score - base_score) * 100) / baseScore
1314      * Can change this implementation so as to provide some analysis.
1315      */
1316     private static double calculateSpeedupPercentage(double baseScore,
1317                                                      double targetScore)
1318     {
1319         return ((targetScore - baseScore) * 100)/baseScore;
1320     }
1321 
1322     private static void printUsage() {
1323         String usage =
1324             &quot;\njava XMLHTMLReporter [options]      &quot;     +
1325             &quot;                                      \n\n&quot; +
1326             &quot;where options include:                &quot;     +
1327             &quot;                                      \n&quot;   +
1328             &quot;    -r | -results &lt;result directory&gt;  &quot;     +
1329             &quot;directory to which reports are stored \n&quot;   +
1330             &quot;    -basexml | -b &lt;xml file path&gt;     &quot;     +
1331             &quot;path to base-build result             \n&quot;   +
1332             &quot;    -targetxml | -t &lt;xml file path&gt;   &quot;     +
1333             &quot;path to target-build result           \n&quot;   +
1334             &quot;    -resultxml | -xml &lt;xml file path&gt; &quot;     +
1335             &quot;path to result XML                    \n&quot;   +
1336             &quot;    -group | -g  &lt;level&gt;              &quot;     +
1337             &quot;group-level for tests                 \n&quot;   +
1338             &quot;                                      &quot;     +
1339             &quot; [ 1 , 2 , 3 or 4 ]                   \n&quot;   +
1340             &quot;    -analyzermode | -am               &quot;     +
1341             &quot;mode to be used for finding score     \n&quot;   +
1342             &quot;                                      &quot;     +
1343             &quot; [ BEST , WORST , AVERAGE , MIDAVG ]  &quot;;
1344         System.out.println(usage);
1345         System.exit(0);
1346     }
1347 
1348     /**
1349      * main
1350      */
1351     public static void main(String[] args) {
1352 
1353         String resDir = &quot;.&quot;;
1354         String baseXML = null;
1355         String targetXML = null;
1356         String resultXML = null;
1357         int group = 2;
1358 
1359         /* ---- Analysis Mode ----
1360             BEST    = 1;
1361             WORST   = 2;
1362             AVERAGE = 3;
1363             MIDAVG  = 4;
1364          ------------------------ */
1365         int analyzerMode = 4;
1366 
1367         try {
1368 
1369             for (int i = 0; i &lt; args.length; i++) {
1370                 if (args[i].startsWith(&quot;-results&quot;) ||
1371                     args[i].startsWith(&quot;-r&quot;))
1372                 {
1373                     i++;
1374                     resDir = args[i];
1375                 } else if (args[i].startsWith(&quot;-basexml&quot;) ||
1376                            args[i].startsWith(&quot;-b&quot;))
1377                 {
1378                     i++;
1379                     baseXML = args[i];
1380                 } else if (args[i].startsWith(&quot;-targetxml&quot;) ||
1381                            args[i].startsWith(&quot;-t&quot;))
1382                 {
1383                     i++;
1384                     targetXML = args[i];
1385                 } else if (args[i].startsWith(&quot;-resultxml&quot;) ||
1386                            args[i].startsWith(&quot;-xml&quot;))
1387                 {
1388                     i++;
1389                     resultXML = args[i];
1390                 } else if (args[i].startsWith(&quot;-group&quot;) ||
1391                            args[i].startsWith(&quot;-g&quot;))
1392                 {
1393                     i++;
1394                     group = Integer.parseInt(args[i]);
1395                     System.out.println(&quot;Grouping Level for tests: &quot; + group);
1396                 } else if (args[i].startsWith(&quot;-analyzermode&quot;) ||
1397                            args[i].startsWith(&quot;-am&quot;))
1398                 {
1399                     i++;
1400                     String strAnalyzerMode = args[i];
1401                     if(strAnalyzerMode.equalsIgnoreCase(&quot;BEST&quot;)) {
1402                         analyzerMode = 0;
1403                     } else if (strAnalyzerMode.equalsIgnoreCase(&quot;WORST&quot;)) {
1404                         analyzerMode = 1;
1405                     } else if (strAnalyzerMode.equalsIgnoreCase(&quot;AVERAGE&quot;)) {
1406                         analyzerMode = 2;
1407                     } else if (strAnalyzerMode.equalsIgnoreCase(&quot;MIDAVG&quot;)) {
1408                         analyzerMode = 3;
1409                     } else {
1410                         printUsage();
1411                     }
1412                     System.out.println(&quot;Analyzer-Mode: &quot; + analyzerMode);
1413                 }
1414             }
1415         }
1416         catch(Exception e) {
1417             printUsage();
1418         }
1419 
1420         if(resDir != null) {
1421 
1422             XMLHTMLReporter.setGroupLevel(group);
1423             J2DAnalyzer.setMode(analyzerMode);
1424 
1425             if(targetXML != null &amp;&amp; baseXML != null) {
1426                 XMLHTMLReporter.generateComparisonReport(resDir, baseXML,
1427                                                          targetXML);
1428             } else if (resultXML != null) {
1429                 XMLHTMLReporter.generateReport(resDir, resultXML);
1430             } else {
1431                 printUsage();
1432             }
1433         } else {
1434             printUsage();
1435         }
1436     }
1437 }
    </pre>
  </body>
</html>