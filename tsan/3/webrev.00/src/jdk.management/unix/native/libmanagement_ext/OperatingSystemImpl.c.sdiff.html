<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.management/unix/native/libmanagement_ext/OperatingSystemImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../classes/com/sun/management/internal/OperatingSystemImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../windows/classes/com/sun/management/internal/OperatingSystemImpl.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.management/unix/native/libmanagement_ext/OperatingSystemImpl.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
289 #if defined(__solaris__) || defined(_SC_CLK_TCK)
290     clk_tck = (jlong) sysconf(_SC_CLK_TCK);
291 #elif defined(__linux__) || defined(_ALLBSD_SOURCE)
292     clk_tck = 100;
293 #endif
294     if (clk_tck == -1) {
295         throw_internal_error(env,
296                              &quot;sysconf failed - not able to get clock tick&quot;);
297         return -1;
298     }
299 
300     times(&amp;time);
301     ns_per_clock_tick = (jlong) 1000 * 1000 * 1000 / (jlong) clk_tck;
302     cpu_time_ns = ((jlong)time.tms_utime + (jlong) time.tms_stime) *
303                       ns_per_clock_tick;
304     return cpu_time_ns;
305 #endif
306 }
307 
308 JNIEXPORT jlong JNICALL
<span class="line-modified">309 Java_com_sun_management_internal_OperatingSystemImpl_getFreePhysicalMemorySize0</span>
310   (JNIEnv *env, jobject mbean)
311 {
312 #ifdef __APPLE__
313     mach_msg_type_number_t count;
314     vm_statistics_data_t vm_stats;
315     kern_return_t res;
316 
317     count = HOST_VM_INFO_COUNT;
318     res = host_statistics(mach_host_self(), HOST_VM_INFO, (host_info_t)&amp;vm_stats, &amp;count);
319     if (res != KERN_SUCCESS) {
320         throw_internal_error(env, &quot;host_statistics failed&quot;);
321         return -1;
322     }
323     return (jlong)vm_stats.free_count * page_size;
324 #elif defined(_ALLBSD_SOURCE)
325     /*
326      * XXBSDL no way to do it in FreeBSD
327      */
328     // throw_internal_error(env, &quot;unimplemented in FreeBSD&quot;)
329     return (128 * MB);
330 #elif defined(_AIX)
331     perfstat_memory_total_t memory_info;
332     if (-1 != perfstat_memory_total(NULL, &amp;memory_info, sizeof(perfstat_memory_total_t), 1)) {
333         return (jlong)(memory_info.real_free * 4L * 1024L);
334     }
335     return -1;
336 #else // solaris / linux
337     jlong num_avail_physical_pages = sysconf(_SC_AVPHYS_PAGES);
338     return (num_avail_physical_pages * page_size);
339 #endif
340 }
341 
342 JNIEXPORT jlong JNICALL
<span class="line-modified">343 Java_com_sun_management_internal_OperatingSystemImpl_getTotalPhysicalMemorySize0</span>
344   (JNIEnv *env, jobject mbean)
345 {
346 #ifdef _ALLBSD_SOURCE
347     jlong result = 0;
348     int mib[2];
349     size_t rlen;
350 
351     mib[0] = CTL_HW;
352     mib[1] = HW_MEMSIZE;
353     rlen = sizeof(result);
354     if (sysctl(mib, 2, &amp;result, &amp;rlen, NULL, 0) != 0) {
355         throw_internal_error(env, &quot;sysctl failed&quot;);
356         return -1;
357     }
358     return result;
359 #elif defined(_AIX)
360     perfstat_memory_total_t memory_info;
361     if (-1 != perfstat_memory_total(NULL, &amp;memory_info, sizeof(perfstat_memory_total_t), 1)) {
362         return (jlong)(memory_info.real_total * 4L * 1024L);
363     }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
289 #if defined(__solaris__) || defined(_SC_CLK_TCK)
290     clk_tck = (jlong) sysconf(_SC_CLK_TCK);
291 #elif defined(__linux__) || defined(_ALLBSD_SOURCE)
292     clk_tck = 100;
293 #endif
294     if (clk_tck == -1) {
295         throw_internal_error(env,
296                              &quot;sysconf failed - not able to get clock tick&quot;);
297         return -1;
298     }
299 
300     times(&amp;time);
301     ns_per_clock_tick = (jlong) 1000 * 1000 * 1000 / (jlong) clk_tck;
302     cpu_time_ns = ((jlong)time.tms_utime + (jlong) time.tms_stime) *
303                       ns_per_clock_tick;
304     return cpu_time_ns;
305 #endif
306 }
307 
308 JNIEXPORT jlong JNICALL
<span class="line-modified">309 Java_com_sun_management_internal_OperatingSystemImpl_getFreeMemorySize0</span>
310   (JNIEnv *env, jobject mbean)
311 {
312 #ifdef __APPLE__
313     mach_msg_type_number_t count;
314     vm_statistics_data_t vm_stats;
315     kern_return_t res;
316 
317     count = HOST_VM_INFO_COUNT;
318     res = host_statistics(mach_host_self(), HOST_VM_INFO, (host_info_t)&amp;vm_stats, &amp;count);
319     if (res != KERN_SUCCESS) {
320         throw_internal_error(env, &quot;host_statistics failed&quot;);
321         return -1;
322     }
323     return (jlong)vm_stats.free_count * page_size;
324 #elif defined(_ALLBSD_SOURCE)
325     /*
326      * XXBSDL no way to do it in FreeBSD
327      */
328     // throw_internal_error(env, &quot;unimplemented in FreeBSD&quot;)
329     return (128 * MB);
330 #elif defined(_AIX)
331     perfstat_memory_total_t memory_info;
332     if (-1 != perfstat_memory_total(NULL, &amp;memory_info, sizeof(perfstat_memory_total_t), 1)) {
333         return (jlong)(memory_info.real_free * 4L * 1024L);
334     }
335     return -1;
336 #else // solaris / linux
337     jlong num_avail_physical_pages = sysconf(_SC_AVPHYS_PAGES);
338     return (num_avail_physical_pages * page_size);
339 #endif
340 }
341 
342 JNIEXPORT jlong JNICALL
<span class="line-modified">343 Java_com_sun_management_internal_OperatingSystemImpl_getTotalMemorySize0</span>
344   (JNIEnv *env, jobject mbean)
345 {
346 #ifdef _ALLBSD_SOURCE
347     jlong result = 0;
348     int mib[2];
349     size_t rlen;
350 
351     mib[0] = CTL_HW;
352     mib[1] = HW_MEMSIZE;
353     rlen = sizeof(result);
354     if (sysctl(mib, 2, &amp;result, &amp;rlen, NULL, 0) != 0) {
355         throw_internal_error(env, &quot;sysctl failed&quot;);
356         return -1;
357     }
358     return result;
359 #elif defined(_AIX)
360     perfstat_memory_total_t memory_info;
361     if (-1 != perfstat_memory_total(NULL, &amp;memory_info, sizeof(perfstat_memory_total_t), 1)) {
362         return (jlong)(memory_info.real_total * 4L * 1024L);
363     }
</pre>
</td>
</tr>
</table>
<center><a href="../../classes/com/sun/management/internal/OperatingSystemImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../windows/classes/com/sun/management/internal/OperatingSystemImpl.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>