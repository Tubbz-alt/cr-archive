<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.management/windows/native/libmanagement_ext/OperatingSystemImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../classes/com/sun/management/internal/OperatingSystemImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.naming.dns/share/classes/com/sun/jndi/dns/DnsClient.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.management/windows/native/libmanagement_ext/OperatingSystemImpl.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2003, 2015, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 117 JNIEXPORT jlong JNICALL
 118 Java_com_sun_management_internal_OperatingSystemImpl_getProcessCpuTime0
 119   (JNIEnv *env, jobject mbean)
 120 {
 121 
 122     FILETIME process_creation_time, process_exit_time,
 123              process_user_time, process_kernel_time;
 124 
 125     // Using static variables declared above
 126     // Units are 100-ns intervals.  Convert to ns.
 127     GetProcessTimes(main_process, &amp;process_creation_time,
 128                     &amp;process_exit_time,
 129                     &amp;process_kernel_time, &amp;process_user_time);
 130     return (jlong_from(process_user_time.dwHighDateTime,
 131                         process_user_time.dwLowDateTime) +
 132             jlong_from(process_kernel_time.dwHighDateTime,
 133                         process_kernel_time.dwLowDateTime)) * 100;
 134 }
 135 
 136 JNIEXPORT jlong JNICALL
<span class="line-modified"> 137 Java_com_sun_management_internal_OperatingSystemImpl_getFreePhysicalMemorySize0</span>
 138   (JNIEnv *env, jobject mbean)
 139 {
 140     MEMORYSTATUSEX ms;
 141     ms.dwLength = sizeof(ms);
 142     GlobalMemoryStatusEx(&amp;ms);
 143     return (jlong) ms.ullAvailPhys;
 144 }
 145 
 146 JNIEXPORT jlong JNICALL
<span class="line-modified"> 147 Java_com_sun_management_internal_OperatingSystemImpl_getTotalPhysicalMemorySize0</span>
 148   (JNIEnv *env, jobject mbean)
 149 {
 150     MEMORYSTATUSEX ms;
 151     ms.dwLength = sizeof(ms);
 152     GlobalMemoryStatusEx(&amp;ms);
 153     return (jlong) ms.ullTotalPhys;
 154 }
 155 
 156 /* Performance Data Helper API (PDH) support */
 157 
 158 typedef PDH_STATUS (WINAPI *PdhAddCounterFunc)(
 159                            HQUERY      hQuery,
 160                            LPCSTR      szFullCounterPath,
 161                            DWORD       dwUserData,
 162                            HCOUNTER    *phCounter
 163                            );
 164 typedef PDH_STATUS (WINAPI *PdhOpenQueryFunc)(
 165                            LPCWSTR     szDataSource,
 166                            DWORD       dwUserData,
 167                            HQUERY      *phQuery
</pre>
<hr />
<pre>
1332         // warn?
1333         return -1.0;
1334     }
1335 
1336     if (-1 == which) {
1337         c = multiCounterCPULoad-&gt;counters[multiCounterCPULoad-&gt;noOfCounters - 1];
1338     } else {
1339         if (which &lt; multiCounterCPULoad-&gt;noOfCounters) {
1340             c = multiCounterCPULoad-&gt;counters[which];
1341         } else {
1342             return -1.0;
1343         }
1344     }
1345     if (getPerformanceData(&amp;multiCounterCPULoad-&gt;query, c, &amp;cv, PDH_FMT_DOUBLE ) == 0) {
1346         return cv.doubleValue / 100;
1347     }
1348     return -1.0;
1349 }
1350 
1351 JNIEXPORT jdouble JNICALL
<span class="line-modified">1352 Java_com_sun_management_internal_OperatingSystemImpl_getSystemCpuLoad0</span>
1353 (JNIEnv *env, jobject dummy)
1354 {
1355     return perfGetCPULoad(-1);
1356 }
1357 
1358 JNIEXPORT jdouble JNICALL
1359 Java_com_sun_management_internal_OperatingSystemImpl_getProcessCpuLoad0
1360 (JNIEnv *env, jobject dummy)
1361 {
1362     return perfGetProcessCPULoad();
1363 }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 117 JNIEXPORT jlong JNICALL
 118 Java_com_sun_management_internal_OperatingSystemImpl_getProcessCpuTime0
 119   (JNIEnv *env, jobject mbean)
 120 {
 121 
 122     FILETIME process_creation_time, process_exit_time,
 123              process_user_time, process_kernel_time;
 124 
 125     // Using static variables declared above
 126     // Units are 100-ns intervals.  Convert to ns.
 127     GetProcessTimes(main_process, &amp;process_creation_time,
 128                     &amp;process_exit_time,
 129                     &amp;process_kernel_time, &amp;process_user_time);
 130     return (jlong_from(process_user_time.dwHighDateTime,
 131                         process_user_time.dwLowDateTime) +
 132             jlong_from(process_kernel_time.dwHighDateTime,
 133                         process_kernel_time.dwLowDateTime)) * 100;
 134 }
 135 
 136 JNIEXPORT jlong JNICALL
<span class="line-modified"> 137 Java_com_sun_management_internal_OperatingSystemImpl_getFreeMemorySize0</span>
 138   (JNIEnv *env, jobject mbean)
 139 {
 140     MEMORYSTATUSEX ms;
 141     ms.dwLength = sizeof(ms);
 142     GlobalMemoryStatusEx(&amp;ms);
 143     return (jlong) ms.ullAvailPhys;
 144 }
 145 
 146 JNIEXPORT jlong JNICALL
<span class="line-modified"> 147 Java_com_sun_management_internal_OperatingSystemImpl_getTotalMemorySize0</span>
 148   (JNIEnv *env, jobject mbean)
 149 {
 150     MEMORYSTATUSEX ms;
 151     ms.dwLength = sizeof(ms);
 152     GlobalMemoryStatusEx(&amp;ms);
 153     return (jlong) ms.ullTotalPhys;
 154 }
 155 
 156 /* Performance Data Helper API (PDH) support */
 157 
 158 typedef PDH_STATUS (WINAPI *PdhAddCounterFunc)(
 159                            HQUERY      hQuery,
 160                            LPCSTR      szFullCounterPath,
 161                            DWORD       dwUserData,
 162                            HCOUNTER    *phCounter
 163                            );
 164 typedef PDH_STATUS (WINAPI *PdhOpenQueryFunc)(
 165                            LPCWSTR     szDataSource,
 166                            DWORD       dwUserData,
 167                            HQUERY      *phQuery
</pre>
<hr />
<pre>
1332         // warn?
1333         return -1.0;
1334     }
1335 
1336     if (-1 == which) {
1337         c = multiCounterCPULoad-&gt;counters[multiCounterCPULoad-&gt;noOfCounters - 1];
1338     } else {
1339         if (which &lt; multiCounterCPULoad-&gt;noOfCounters) {
1340             c = multiCounterCPULoad-&gt;counters[which];
1341         } else {
1342             return -1.0;
1343         }
1344     }
1345     if (getPerformanceData(&amp;multiCounterCPULoad-&gt;query, c, &amp;cv, PDH_FMT_DOUBLE ) == 0) {
1346         return cv.doubleValue / 100;
1347     }
1348     return -1.0;
1349 }
1350 
1351 JNIEXPORT jdouble JNICALL
<span class="line-modified">1352 Java_com_sun_management_internal_OperatingSystemImpl_getCpuLoad0</span>
1353 (JNIEnv *env, jobject dummy)
1354 {
1355     return perfGetCPULoad(-1);
1356 }
1357 
1358 JNIEXPORT jdouble JNICALL
1359 Java_com_sun_management_internal_OperatingSystemImpl_getProcessCpuLoad0
1360 (JNIEnv *env, jobject dummy)
1361 {
1362     return perfGetProcessCPULoad();
1363 }
</pre>
</td>
</tr>
</table>
<center><a href="../../classes/com/sun/management/internal/OperatingSystemImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.naming.dns/share/classes/com/sun/jndi/dns/DnsClient.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>