<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.jartool/share/classes/sun/tools/jar/Main.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="GNUStyleOptions.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="resources/jar.properties.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jartool/share/classes/sun/tools/jar/Main.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 148,11 ***</span>
       * iflag: generate jar index
       * nflag: Perform jar normalization at the end
       * pflag: preserve/don&#39;t strip leading slash and .. component from file name
       * dflag: print module descriptor
       */
<span class="line-modified">!     boolean cflag, uflag, xflag, tflag, vflag, flag0, Mflag, iflag, nflag, pflag, dflag;</span>
  
      boolean suppressDeprecateMsg = false;
  
      /* To support additional GNU Style informational options */
      Consumer&lt;PrintWriter&gt; info;
<span class="line-new-header">--- 148,11 ---</span>
       * iflag: generate jar index
       * nflag: Perform jar normalization at the end
       * pflag: preserve/don&#39;t strip leading slash and .. component from file name
       * dflag: print module descriptor
       */
<span class="line-modified">!     boolean cflag, uflag, xflag, tflag, vflag, flag0, Mflag, iflag, pflag, dflag;</span>
  
      boolean suppressDeprecateMsg = false;
  
      /* To support additional GNU Style informational options */
      Consumer&lt;PrintWriter&gt; info;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 316,38 ***</span>
  
                  tmpFile = createTemporaryFile(tmpbase, &quot;.jar&quot;);
                  try (OutputStream out = new FileOutputStream(tmpFile)) {
                      create(new BufferedOutputStream(out, 4096), manifest);
                  }
<span class="line-removed">-                 if (nflag) {</span>
<span class="line-removed">-                     if (!suppressDeprecateMsg) {</span>
<span class="line-removed">-                         warn(formatMsg(&quot;warn.flag.is.deprecated&quot;, &quot;-n&quot;));</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                     File packFile = createTemporaryFile(tmpbase, &quot;.pack&quot;);</span>
<span class="line-removed">-                     try {</span>
<span class="line-removed">-                         java.util.jar.Pack200.Packer packer = java.util.jar.Pack200.newPacker();</span>
<span class="line-removed">-                         Map&lt;String, String&gt; p = packer.properties();</span>
<span class="line-removed">-                         p.put(java.util.jar.Pack200.Packer.EFFORT, &quot;1&quot;); // Minimal effort to conserve CPU</span>
<span class="line-removed">-                         try (JarFile jarFile = new JarFile(tmpFile.getCanonicalPath());</span>
<span class="line-removed">-                              OutputStream pack = new FileOutputStream(packFile))</span>
<span class="line-removed">-                         {</span>
<span class="line-removed">-                             packer.pack(jarFile, pack);</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                         if (tmpFile.exists()) {</span>
<span class="line-removed">-                             tmpFile.delete();</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                         tmpFile = createTemporaryFile(tmpbase, &quot;.jar&quot;);</span>
<span class="line-removed">-                         try (OutputStream out = new FileOutputStream(tmpFile);</span>
<span class="line-removed">-                              JarOutputStream jos = new JarOutputStream(out))</span>
<span class="line-removed">-                         {</span>
<span class="line-removed">-                             java.util.jar.Pack200.Unpacker unpacker = java.util.jar.Pack200.newUnpacker();</span>
<span class="line-removed">-                             unpacker.unpack(packFile, jos);</span>
<span class="line-removed">-                         }</span>
<span class="line-removed">-                     } finally {</span>
<span class="line-removed">-                         Files.deleteIfExists(packFile.toPath());</span>
<span class="line-removed">-                     }</span>
<span class="line-removed">-                 }</span>
                  validateAndClose(tmpFile);
              } else if (uflag) {
                  File inputFile = null;
                  if (fname != null) {
                      inputFile = new File(fname);
<span class="line-new-header">--- 316,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 585,13 ***</span>
                              }
                              // do not increase the counter, files will contain rootjar
                              rootjar = args[count++];
                              iflag = true;
                              break;
<span class="line-removed">-                         case &#39;n&#39;:</span>
<span class="line-removed">-                             nflag = true;</span>
<span class="line-removed">-                             break;</span>
                          case &#39;e&#39;:
                              ename = args[count++];
                              break;
                          case &#39;P&#39;:
                              pflag = true;
<span class="line-new-header">--- 557,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 942,15 ***</span>
                  foundManifest = true;
                  if (newManifest != null) {
                      // Don&#39;t read from the newManifest InputStream, as we
                      // might need it below, and we can&#39;t re-read the same data
                      // twice.
<span class="line-modified">!                     FileInputStream fis = new FileInputStream(mname);</span>
<span class="line-modified">!                     boolean ambiguous = isAmbiguousMainClass(new Manifest(fis));</span>
<span class="line-modified">!                     fis.close();</span>
<span class="line-modified">!                     if (ambiguous) {</span>
<span class="line-removed">-                         return false;</span>
                      }
                  }
                  // Update the manifest.
                  Manifest old = new Manifest(zis);
                  if (newManifest != null) {
<span class="line-new-header">--- 911,14 ---</span>
                  foundManifest = true;
                  if (newManifest != null) {
                      // Don&#39;t read from the newManifest InputStream, as we
                      // might need it below, and we can&#39;t re-read the same data
                      // twice.
<span class="line-modified">!                     try (FileInputStream fis = new FileInputStream(mname)) {</span>
<span class="line-modified">!                         if (isAmbiguousMainClass(new Manifest(fis))) {</span>
<span class="line-modified">!                             return false;</span>
<span class="line-modified">!                         }</span>
                      }
                  }
                  // Update the manifest.
                  Manifest old = new Manifest(zis);
                  if (newManifest != null) {
</pre>
<center><a href="GNUStyleOptions.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="resources/jar.properties.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>