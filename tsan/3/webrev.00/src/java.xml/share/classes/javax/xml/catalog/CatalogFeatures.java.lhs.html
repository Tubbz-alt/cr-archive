<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml/share/classes/javax/xml/catalog/CatalogFeatures.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2015, 2017, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package javax.xml.catalog;
 26 
 27 import java.net.MalformedURLException;
 28 import java.net.URISyntaxException;
 29 import java.util.HashMap;
 30 import java.util.Map;
 31 import jdk.xml.internal.SecuritySupport;
 32 
 33 /**
 34  * The CatalogFeatures holds a collection of features and properties.
 35  *
 36  *
 37  * &lt;table class=&quot;plain&quot; id=&quot;CatalogFeatures&quot;&gt;
 38  * &lt;caption&gt;Catalog Features&lt;/caption&gt;
 39  * &lt;thead&gt;
 40  * &lt;tr&gt;
 41  * &lt;th scope=&quot;col&quot; rowspan=&quot;2&quot;&gt;Feature&lt;/th&gt;
 42  * &lt;th scope=&quot;col&quot; rowspan=&quot;2&quot;&gt;Description&lt;/th&gt;
 43  * &lt;th scope=&quot;col&quot; rowspan=&quot;2&quot;&gt;Property Name&lt;/th&gt;
 44  * &lt;th scope=&quot;col&quot; rowspan=&quot;2&quot;&gt;System Property [1]&lt;/th&gt;
 45  * &lt;th scope=&quot;col&quot; rowspan=&quot;2&quot;&gt;jaxp.properties [1]&lt;/th&gt;
 46  * &lt;th scope=&quot;col&quot; colspan=&quot;2&quot; style=&quot;text-align:center&quot;&gt;Value [2]&lt;/th&gt;
 47  * &lt;th scope=&quot;col&quot; rowspan=&quot;2&quot;&gt;Action&lt;/th&gt;
 48  * &lt;/tr&gt;
 49  * &lt;tr&gt;
 50  * &lt;th scope=&quot;col&quot;&gt;Type&lt;/th&gt;
 51  * &lt;th scope=&quot;col&quot;&gt;Value&lt;/th&gt;
 52  * &lt;/tr&gt;
 53  * &lt;/thead&gt;
 54  *
 55  * &lt;tbody&gt;
 56  *
 57  * &lt;tr&gt;
 58  * &lt;th scope=&quot;row&quot; style=&quot;font-weight:normal&quot; id=&quot;FILES&quot;&gt;FILES&lt;/th&gt;
 59  * &lt;td&gt;A semicolon-delimited list of URIs to locate the catalog files.
 60  * The URIs must be absolute and have a URL protocol handler for the URI scheme.
 61  * &lt;/td&gt;
 62  * &lt;td&gt;javax.xml.catalog.files&lt;/td&gt;
 63  * &lt;td&gt;javax.xml.catalog.files&lt;/td&gt;
 64  * &lt;td&gt;javax.xml.catalog.files&lt;/td&gt;
 65  * &lt;td&gt;String&lt;/td&gt;
 66  * &lt;th id=&quot;URIs&quot; scope=&quot;row&quot; style=&quot;font-weight:normal&quot;&gt;URIs&lt;/th&gt;
 67  * &lt;td&gt;
 68  * Reads the first catalog as the current catalog; Loads others if no match
 69  * is found in the current catalog including delegate catalogs if any.
 70  * &lt;/td&gt;
 71  * &lt;/tr&gt;
 72  *
 73  * &lt;tr&gt;
 74  * &lt;th rowspan=&quot;2&quot; scope=&quot;row&quot; style=&quot;font-weight:normal&quot; id=&quot;PREFER&quot;&gt;PREFER&lt;/th&gt;
 75  * &lt;td rowspan=&quot;2&quot;&gt;Indicates the preference between the public and system
 76  * identifiers. The default value is public [3].&lt;/td&gt;
 77  * &lt;td rowspan=&quot;2&quot;&gt;javax.xml.catalog.prefer&lt;/td&gt;
 78  * &lt;td rowspan=&quot;2&quot;&gt;N/A&lt;/td&gt;
 79  * &lt;td rowspan=&quot;2&quot;&gt;N/A&lt;/td&gt;
 80  * &lt;td rowspan=&quot;2&quot;&gt;String&lt;/td&gt;
 81  * &lt;th scope=&quot;row&quot; id=&quot;system&quot; style=&quot;font-weight:normal&quot;&gt;{@code system}&lt;/th&gt;
 82  * &lt;td&gt;
 83  * Searches system entries for a match; Searches public entries when
 84  * external identifier specifies only a public identifier&lt;/td&gt;
 85  * &lt;/tr&gt;
 86  * &lt;tr&gt;
 87  * &lt;th scope=&quot;row&quot; id=&quot;public&quot; style=&quot;font-weight:normal&quot;&gt;{@code public}&lt;/th&gt;
 88  * &lt;td&gt;
 89  * Searches system entries for a match; Searches public entries when
 90  * there is no matching system entry.&lt;/td&gt;
 91  * &lt;/tr&gt;
 92  *
 93  * &lt;tr&gt;
 94  * &lt;th rowspan=&quot;2&quot; scope=&quot;row&quot; style=&quot;font-weight:normal&quot; id=&quot;DEFER&quot;&gt;DEFER&lt;/th&gt;
 95  * &lt;td rowspan=&quot;2&quot;&gt;Indicates that the alternative catalogs including those
 96  * specified in delegate entries or nextCatalog are not read until they are
 97  * needed. The default value is true.&lt;/td&gt;
 98  * &lt;td rowspan=&quot;2&quot;&gt;javax.xml.catalog.defer [4]&lt;/td&gt;
 99  * &lt;td rowspan=&quot;2&quot;&gt;javax.xml.catalog.defer&lt;/td&gt;
100  * &lt;td rowspan=&quot;2&quot;&gt;javax.xml.catalog.defer&lt;/td&gt;
101  * &lt;td rowspan=&quot;2&quot;&gt;String&lt;/td&gt;
102  * &lt;th scope=&quot;row&quot; id=&quot;true&quot; style=&quot;font-weight:normal&quot;&gt;{@code true}&lt;/th&gt;
103  * &lt;td&gt;
104  * Loads alternative catalogs as needed.
105  * &lt;/td&gt;
106  * &lt;/tr&gt;
107  * &lt;tr&gt;
108  * &lt;th scope=&quot;row&quot; id=&quot;false&quot; style=&quot;font-weight:normal&quot;&gt;{@code false}&lt;/th&gt;
109  * &lt;td&gt;
110  * Loads all catalogs[5]. &lt;/td&gt;
111  * &lt;/tr&gt;
112  *
113  * &lt;tr&gt;
114  * &lt;th rowspan=&quot;3&quot; scope=&quot;row&quot; style=&quot;font-weight:normal&quot; id=&quot;RESOLVE&quot;&gt;RESOLVE&lt;/th&gt;
115  * &lt;td rowspan=&quot;3&quot;&gt;Determines the action if there is no matching entry found after
116  * all of the specified catalogs are exhausted. The default is strict.&lt;/td&gt;
117  * &lt;td rowspan=&quot;3&quot;&gt;javax.xml.catalog.resolve [4]&lt;/td&gt;
118  * &lt;td rowspan=&quot;3&quot;&gt;javax.xml.catalog.resolve&lt;/td&gt;
119  * &lt;td rowspan=&quot;3&quot;&gt;javax.xml.catalog.resolve&lt;/td&gt;
120  * &lt;td rowspan=&quot;3&quot;&gt;String&lt;/td&gt;
121  * &lt;th scope=&quot;row&quot; id=&quot;strict&quot; style=&quot;font-weight:normal&quot;&gt;{@code strict}&lt;/th&gt;
122  * &lt;td&gt;
123  * Throws CatalogException if there is no match.
124  * &lt;/td&gt;
125  * &lt;/tr&gt;
126  * &lt;tr&gt;
127  * &lt;th scope=&quot;row&quot; id=&quot;continue&quot; style=&quot;font-weight:normal&quot;&gt;{@code continue}&lt;/th&gt;
128  * &lt;td&gt;
129  * Allows the XML parser to continue as if there is no match.
130  * &lt;/td&gt;
131  * &lt;/tr&gt;
132  * &lt;tr&gt;
133  * &lt;th scope=&quot;row&quot; id=&quot;ignore&quot; style=&quot;font-weight:normal&quot;&gt;{@code ignore}&lt;/th&gt;
134  * &lt;td&gt;
135  * Tells the XML parser to skip the external references if there no match.
136  * &lt;/td&gt;
137  * &lt;/tr&gt;
138  *
139  * &lt;/tbody&gt;
140  * &lt;/table&gt;
141  * &lt;p&gt;
142  * &lt;b&gt;[1]&lt;/b&gt; There is no System property for the features that marked as &quot;N/A&quot;.
143  *
144  * &lt;p&gt;
145  * &lt;b&gt;[2]&lt;/b&gt; The value shall be exactly as listed in this table, case-sensitive.
146  * Any unspecified value will result in {@link IllegalArgumentException}.
147  * &lt;p&gt;
148  * &lt;b&gt;[3]&lt;/b&gt; The Catalog specification defined complex rules on
149  * &lt;a href=&quot;https://www.oasis-open.org/committees/download.php/14809/xml-catalogs.html#attrib.prefer&quot;&gt;
150  * the prefer attribute&lt;/a&gt;. Although the prefer can be public or system, the
151  * specification actually made system the preferred option, that is, no matter
152  * the option, a system entry is always used if found. Public entries are only
153  * considered if the prefer is public and system entries are not found. It is
154  * therefore recommended that the prefer attribute be set as public
155  * (which is the default).
156  * &lt;p&gt;
157  * &lt;b&gt;[4]&lt;/b&gt; Although non-standard attributes in the OASIS Catalog specification,
158  * {@code defer} and {@code resolve} are recognized by the Java Catalog API the
159  * same as the {@code prefer} as being an attribute in the catalog entry of the
160  * main catalog. Note that only the attributes specified for the catalog entry
161  * of the main Catalog file will be used.
162   * &lt;p&gt;
163  * &lt;b&gt;[5]&lt;/b&gt; If the intention is to share an entire catalog store, it may be desirable to
164  * set the property {@code javax.xml.catalog.defer} to false to allow the entire
165  * catalog to be pre-loaded.
166  *
<a name="1" id="anc1"></a><span class="line-modified">167  * &lt;h3&gt;Scope and Order&lt;/h3&gt;</span>
168  * Features and properties can be set through the catalog file, the Catalog API,
169  * system properties, and {@code jaxp.properties}, with a preference in the same order.
170  * &lt;p&gt;
171  * Properties that are specified as attributes in the catalog file for the
172  * catalog and group entries shall take preference over any of the other settings.
173  * For example, if a {@code prefer} attribute is set in the catalog file as in
174  * {@code &lt;catalog prefer=&quot;public&quot;&gt;}, any other input for the &quot;prefer&quot; property
175  * is not necessary or will be ignored.
176  * &lt;p&gt;
177  * Properties set through the Catalog API override those that may have been set
178  * by system properties and/or in {@code jaxp.properties}. In case of multiple
179  * interfaces, the latest in a procedure shall take preference. For
180  * {@link Feature#FILES}, this means that the URI(s) specified through the methods
181  * of the {@link CatalogManager} will override any that may have been entered
182  * through the {@link Builder}.
183  *
184  * &lt;p&gt;
185  * System properties when set shall override those in {@code jaxp.properties}.
186  * &lt;p&gt;
187  * The {@code jaxp.properties} file is typically in the conf directory of the Java
188  * installation. The file is read only once by the JAXP implementation and
189  * its values are then cached for future use. If the file does not exist
190  * when the first attempt is made to read from it, no further attempts are
191  * made to check for its existence. It is not possible to change the value
192  * of any properties in {@code jaxp.properties} after it has been read.
193  * &lt;p&gt;
194  * A CatalogFeatures instance can be created through its builder as illustrated
195  * in the following sample code:
196  * &lt;pre&gt;{@code
197                 CatalogFeatures f = CatalogFeatures.builder()
198                         .with(Feature.FILES, &quot;file:///etc/xml/catalog&quot;)
199                         .with(Feature.PREFER, &quot;public&quot;)
200                         .with(Feature.DEFER, &quot;true&quot;)
201                         .with(Feature.RESOLVE, &quot;ignore&quot;)
202                         .build();
203  * }&lt;/pre&gt;
204  *
<a name="2" id="anc2"></a><span class="line-modified">205  * &lt;h3&gt;JAXP XML Processor Support&lt;/h3&gt;</span>
206  * The Catalog Features are supported throughout the JAXP processors, including
207  * SAX and DOM ({@link javax.xml.parsers}), and StAX parsers ({@link javax.xml.stream}),
208  * Schema Validation ({@link javax.xml.validation}), and XML Transformation
209  * ({@link javax.xml.transform}). The features described above can be set through JAXP
210  * factories or processors that define a setProperty or setAttribute interface.
211  * For example, the following code snippet sets a URI to a catalog file on a SAX
212  * parser through the {@code javax.xml.catalog.files} property:
213  *
214  * &lt;pre&gt;{@code
215  *      SAXParserFactory spf = SAXParserFactory.newInstance();
216  *      spf.setFeature(XMLConstants.USE_CATALOG, true); [1]
217  *      SAXParser parser = spf.newSAXParser();
218  *      parser.setProperty(CatalogFeatures.Feature.FILES.getPropertyName(), &quot;file:///etc/xml/catalog&quot;);
219  * }&lt;/pre&gt;
220  * &lt;p&gt;
221  * [1] Note that this statement is not required since the default value of
222  * {@link javax.xml.XMLConstants#USE_CATALOG USE_CATALOG} is true.
223  *
224  * &lt;p&gt;
225  * The JAXP Processors&#39; support for Catalog depends on both the
226  * {@link javax.xml.XMLConstants#USE_CATALOG USE_CATALOG} feature and the
227  * existence of valid Catalog file(s). A JAXP processor will use the Catalog
228  * only when the feature is true and valid Catalog file(s) are specified through
229  * the {@code javax.xml.catalog.files} property. It will make no attempt to use
230  * the Catalog if either {@link javax.xml.XMLConstants#USE_CATALOG USE_CATALOG}
231  * is set to false, or there is no Catalog file specified.
232  *
233  * &lt;p&gt;
234  * The JAXP processors will observe the default settings of the
235  * {@link javax.xml.catalog.CatalogFeatures}. The processors, for example, will
236  * report an Exception by default when no matching entry is found since the
237  * default value of the {@code javax.xml.catalog.resolve} property is strict.
238  *
239  * &lt;p&gt;
240  * The JAXP processors give preference to user-specified custom resolvers. If such
241  * a resolver is registered, it will be used over the CatalogResolver. If it returns
242  * null however, the processors will continue resolving with the CatalogResolver.
243  * If it returns an empty source, no attempt will be made by the CatalogResolver.
244  *
245  * &lt;p&gt;
246  * The Catalog support is available for any process in the JAXP library that
247  * supports a resolver. The following table lists all such processes.
248  *
<a name="3" id="anc3"></a><span class="line-modified">249  * &lt;h3&gt;&lt;a id=&quot;ProcessesWithCatalogSupport&quot;&gt;Processes with Catalog Support&lt;/a&gt;&lt;/h3&gt;</span>
250  *
251  * &lt;table class=&quot;striped&quot;&gt;
252  * &lt;caption&gt;Processes with Catalog Support&lt;/caption&gt;
253  * &lt;thead&gt;
254  * &lt;tr&gt;
255  * &lt;th scope=&quot;col&quot;&gt;Process&lt;/th&gt;
256  * &lt;th scope=&quot;col&quot;&gt;Catalog Entry Type&lt;/th&gt;
257  * &lt;th scope=&quot;col&quot;&gt;Example&lt;/th&gt;
258  * &lt;/tr&gt;
259  * &lt;/thead&gt;
260  * &lt;tbody&gt;
261  * &lt;tr&gt;
262  * &lt;th scope=&quot;row&quot;&gt;DTDs and external entities&lt;/th&gt;
263  * &lt;td&gt;public, system&lt;/td&gt;
264  * &lt;td&gt;
265  * &lt;pre&gt;{@literal
266    The following DTD reference:
267    &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
268 
269    Can be resolved using the following Catalog entry:
270    &lt;public publicId=&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; uri=&quot;catalog/xhtml1-strict.dtd&quot;/&gt;
271    or
272    &lt;systemSuffix systemIdSuffix=&quot;html1-strict.dtd&quot; uri=&quot;catalog/xhtml1-strict.dtd&quot;/&gt;
273  * }&lt;/pre&gt;
274  * &lt;/td&gt;
275  * &lt;/tr&gt;
276  * &lt;tr&gt;
277  * &lt;th scope=&quot;row&quot;&gt;XInclude&lt;/th&gt;
278  * &lt;td&gt;uri&lt;/td&gt;
279  * &lt;td&gt;
280  * &lt;pre&gt;{@literal
281    The following XInclude element:
282    &lt;xi:include href=&quot;http://openjdk.java.net/xml/disclaimer.xml&quot;/&gt;
283 
284    can be resolved using a URI entry:
285    &lt;uri name=&quot;http://openjdk.java.net/xml/disclaimer.xml&quot; uri=&quot;file:///pathto/local/disclaimer.xml&quot;/&gt;
286    or
287    &lt;uriSuffix uriSuffix=&quot;disclaimer.xml&quot; uri=&quot;file:///pathto/local/disclaimer.xml&quot;/&gt;
288  * }&lt;/pre&gt;
289  * &lt;/td&gt;
290  * &lt;/tr&gt;
291  * &lt;tr&gt;
292  * &lt;th scope=&quot;row&quot;&gt;XSD import&lt;/th&gt;
293  * &lt;td&gt;uri&lt;/td&gt;
294  * &lt;td&gt;
295  * &lt;pre&gt;{@literal
296    The following import element:
297     &lt;xsd:import namespace=&quot;http://openjdk.java.net/xsd/XSDImport_person&quot;
298                 schemaLocation=&quot;http://openjdk.java.net/xsd/XSDImport_person.xsd&quot;/&gt;
299 
300    can be resolved using a URI entry:
301    &lt;uri name=&quot;http://openjdk.java.net/xsd/XSDImport_person.xsd&quot; uri=&quot;file:///pathto/local/XSDImport_person.xsd&quot;/&gt;
302    or
303    &lt;uriSuffix uriSuffix=&quot;XSDImport_person.xsd&quot; uri=&quot;file:///pathto/local/XSDImport_person.xsd&quot;/&gt;
304    or
305    &lt;uriSuffix uriSuffix=&quot;http://openjdk.java.net/xsd/XSDImport_person&quot; uri=&quot;file:///pathto/local/XSDImport_person.xsd&quot;/&gt;
306  * }&lt;/pre&gt;
307  * &lt;/td&gt;
308  * &lt;/tr&gt;
309  * &lt;tr&gt;
310  * &lt;th scope=&quot;row&quot;&gt;XSD include&lt;/th&gt;
311  * &lt;td&gt;uri&lt;/td&gt;
312  * &lt;td&gt;
313  * &lt;pre&gt;{@literal
314    The following include element:
315    &lt;xsd:include schemaLocation=&quot;http://openjdk.java.net/xsd/XSDInclude_person.xsd&quot;/&gt;
316 
317    can be resolved using a URI entry:
318    &lt;uri name=&quot;http://openjdk.java.net/xsd/XSDInclude_person.xsd&quot; uri=&quot;file:///pathto/local/XSDInclude_person.xsd&quot;/&gt;
319    or
320    &lt;uriSuffix uriSuffix=&quot;XSDInclude_person.xsd&quot; uri=&quot;file:///pathto/local/XSDInclude_person.xsd&quot;/&gt;
321  * }&lt;/pre&gt;
322  * &lt;/td&gt;
323  * &lt;/tr&gt;
324  * &lt;tr&gt;
325  * &lt;th scope=&quot;row&quot;&gt;XSL import and include&lt;/th&gt;
326  * &lt;td&gt;uri&lt;/td&gt;
327  * &lt;td&gt;
328  * &lt;pre&gt;{@literal
329    The following include element:
330    &lt;xsl:include href=&quot;http://openjdk.java.net/xsl/include.xsl&quot;/&gt;
331 
332    can be resolved using a URI entry:
333    &lt;uri name=&quot;http://openjdk.java.net/xsl/include.xsl&quot; uri=&quot;file:///pathto/local/include.xsl&quot;/&gt;
334    or
335    &lt;uriSuffix uriSuffix=&quot;include.xsl&quot; uri=&quot;file:///pathto/local/include.xsl&quot;/&gt;
336  * }&lt;/pre&gt;
337  * &lt;/td&gt;
338  * &lt;/tr&gt;
339  * &lt;tr&gt;
340  * &lt;th scope=&quot;row&quot;&gt;XSL document function&lt;/th&gt;
341  * &lt;td&gt;uri&lt;/td&gt;
342  * &lt;td&gt;
343  * &lt;pre&gt;{@literal
344    The document in the following element:
345    &lt;xsl:variable name=&quot;dummy&quot; select=&quot;document(&#39;http://openjdk.java.net/xsl/list.xml&#39;)&quot;/&gt;
346 
347    can be resolved using a URI entry:
348    &lt;uri name=&quot;http://openjdk.java.net/xsl/list.xml&quot; uri=&quot;file:///pathto/local/list.xml&quot;/&gt;
349    or
350    &lt;uriSuffix uriSuffix=&quot;list.xml&quot; uri=&quot;file:///pathto/local/list.xml&quot;/&gt;
351  * }&lt;/pre&gt;
352  * &lt;/td&gt;
353  * &lt;/tr&gt;
354  * &lt;/tbody&gt;
355  * &lt;/table&gt;
356  *
357  * @since 9
358  */
359 public class CatalogFeatures {
360 
361     /**
362      * The constant name of the javax.xml.catalog.files property as described
363      * in the property table above.
364      */
365     static final String CATALOG_FILES = &quot;javax.xml.catalog.files&quot;;
366 
367     /**
368      * The javax.xml.catalog.prefer property as described
369      * in the property table above.
370      */
371     static final String CATALOG_PREFER = &quot;javax.xml.catalog.prefer&quot;;
372 
373     /**
374      * The javax.xml.catalog.defer property as described
375      * in the property table above.
376      */
377     static final String CATALOG_DEFER = &quot;javax.xml.catalog.defer&quot;;
378 
379     /**
380      * The javax.xml.catalog.resolve property as described
381      * in the property table above.
382      */
383     static final String CATALOG_RESOLVE = &quot;javax.xml.catalog.resolve&quot;;
384 
385     //values for the prefer property
386     static final String PREFER_SYSTEM = &quot;system&quot;;
387     static final String PREFER_PUBLIC = &quot;public&quot;;
388 
389     //values for the defer property
390     static final String DEFER_TRUE = &quot;true&quot;;
391     static final String DEFER_FALSE = &quot;false&quot;;
392 
393     //values for the Resolve property
394     static final String RESOLVE_STRICT = &quot;strict&quot;;
395     static final String RESOLVE_CONTINUE = &quot;continue&quot;;
396     static final String RESOLVE_IGNORE = &quot;ignore&quot;;
397 
398     /**
399      * A Feature type as defined in the
400      * &lt;a href=&quot;CatalogFeatures.html#CatalogFeatures&quot;&gt;Catalog Features table&lt;/a&gt;.
401      */
402     public static enum Feature {
403         /**
404          * The {@code javax.xml.catalog.files} property as described in
405          * item &lt;a href=&quot;CatalogFeatures.html#FILES&quot;&gt;FILES&lt;/a&gt; of the
406          * Catalog Features table.
407          */
408         FILES(CATALOG_FILES, null, true),
409         /**
410          * The {@code javax.xml.catalog.prefer} property as described in
411          * item &lt;a href=&quot;CatalogFeatures.html#PREFER&quot;&gt;PREFER&lt;/a&gt; of the
412          * Catalog Features table.
413          */
414         PREFER(CATALOG_PREFER, PREFER_PUBLIC, false),
415         /**
416          * The {@code javax.xml.catalog.defer} property as described in
417          * item &lt;a href=&quot;CatalogFeatures.html#DEFER&quot;&gt;DEFER&lt;/a&gt; of the
418          * Catalog Features table.
419          */
420         DEFER(CATALOG_DEFER, DEFER_TRUE, true),
421         /**
422          * The {@code javax.xml.catalog.resolve} property as described in
423          * item &lt;a href=&quot;CatalogFeatures.html#RESOLVE&quot;&gt;RESOLVE&lt;/a&gt; of the
424          * Catalog Features table.
425          */
426         RESOLVE(CATALOG_RESOLVE, RESOLVE_STRICT, true);
427 
428         private final String name;
429         private final String defaultValue;
430         private String value;
431         private final boolean hasSystem;
432 
433         /**
434          * Constructs a CatalogFeature instance.
435          * @param name the name of the feature
436          * @param value the value of the feature
437          * @param hasSystem a flag to indicate whether the feature is supported
438          * with a System property
439          */
440         Feature(String name, String value, boolean hasSystem) {
441             this.name = name;
442             this.defaultValue = value;
443             this.hasSystem = hasSystem;
444         }
445 
446         /**
447          * Checks whether the specified property is equal to the current property.
448          * @param propertyName the name of a property
449          * @return true if the specified property is the current property, false
450          * otherwise
451          */
452         boolean equalsPropertyName(String propertyName) {
453             return name.equals(propertyName);
454         }
455 
456         /**
457          * Returns the name of the corresponding System Property.
458          *
459          * @return the name of the System Property
460          */
461         public String getPropertyName() {
462             return name;
463         }
464 
465         /**
466          * Returns the default value of the property.
467          * @return the default value of the property
468          */
469         public String defaultValue() {
470             return defaultValue;
471         }
472 
473         /**
474          * Returns the value of the property.
475          * @return the value of the property
476          */
477         String getValue() {
478             return value;
479         }
480 
481         /**
482          * Checks whether System property is supported for the feature.
483          * @return true it is supported, false otherwise
484          */
485         boolean hasSystemProperty() {
486             return hasSystem;
487         }
488     }
489 
490     /**
491      * States of the settings of a property, in the order: default value,
492      * jaxp.properties file, jaxp system properties, and jaxp api properties
493      */
494     static enum State {
495         /** represents the default state of a feature. */
496         DEFAULT(&quot;default&quot;),
497         /** indicates the value of the feature is read from jaxp.properties. */
498         JAXPDOTPROPERTIES(&quot;jaxp.properties&quot;),
499         /** indicates the value of the feature is read from its System property. */
500         SYSTEMPROPERTY(&quot;system property&quot;),
501         /** indicates the value of the feature is specified through the API. */
502         APIPROPERTY(&quot;property&quot;),
503         /** indicates the value of the feature is specified as a catalog attribute. */
504         CATALOGATTRIBUTE(&quot;catalog attribute&quot;);
505 
506         final String literal;
507 
508         State(String literal) {
509             this.literal = literal;
510         }
511 
512         String literal() {
513             return literal;
514         }
515     }
516 
517     /**
518      * Values of the properties
519      */
520     private String[] values;
521 
522     /**
523      * States of the settings for each property
524      */
525     private State[] states;
526 
527     /**
528      * Private class constructor
529      */
530     private CatalogFeatures() {
531     }
532 
533     /**
534      * Returns a CatalogFeatures instance with default settings.
535      * @return a default CatalogFeatures instance
536      */
537     public static CatalogFeatures defaults() {
538         return CatalogFeatures.builder().build();
539     }
540 
541     /**
542      * Constructs a new CatalogFeatures instance with the builder.
543      *
544      * @param builder the builder to build the CatalogFeatures
545      */
546     CatalogFeatures(Builder builder) {
547         init();
548         setProperties(builder);
549     }
550 
551     /**
552      * Returns the value of the specified feature.
553      *
554      * @param cf the type of the Catalog feature
555      * @return the value of the feature
556      */
557     public String get(Feature cf) {
558         return values[cf.ordinal()];
559     }
560 
561     /**
562      * Initializes the supported properties
563      */
564     private void init() {
565         values = new String[Feature.values().length];
566         states = new State[Feature.values().length];
567         for (Feature cf : Feature.values()) {
568             setProperty(cf, State.DEFAULT, cf.defaultValue());
569         }
570         //read system properties or jaxp.properties
571         readSystemProperties();
572     }
573 
574     /**
575      * Sets properties by the Builder.
576      * @param builder the CatalogFeatures builder
577      */
578     private void setProperties(Builder builder) {
579         builder.values.entrySet().stream().forEach((entry) -&gt; {
580             setProperty(entry.getKey(), State.APIPROPERTY, entry.getValue());
581         });
582     }
583     /**
584      * Sets the value of a property, updates only if it shall override.
585      *
586      * @param index the index of the property
587      * @param state the state of the property
588      * @param value the value of the property
589      * @throws IllegalArgumentException if the value is invalid
590      */
591     private void setProperty(Feature feature, State state, String value) {
592         int index = feature.ordinal();
593         if (value != null &amp;&amp; value.length() != 0) {
594             if (state != State.APIPROPERTY) {
595                 Util.validateFeatureInput(feature, value);
596             }
597             if (states[index] == null || state.compareTo(states[index]) &gt;= 0) {
598                 values[index] = value;
599                 states[index] = state;
600             }
601         }
602     }
603 
604     /**
605      * Reads from system properties, or those in jaxp.properties
606      */
607     private void readSystemProperties() {
608         for (Feature cf : Feature.values()) {
609             getSystemProperty(cf, cf.getPropertyName());
610         }
611     }
612 
613     /**
614      * Reads from system properties, or those in jaxp.properties
615      *
616      * @param cf the type of the property
617      * @param sysPropertyName the name of system property
618      */
619     private boolean getSystemProperty(Feature cf, String sysPropertyName) {
620         if (cf.hasSystemProperty()) {
621             String value = SecuritySupport.getSystemProperty(sysPropertyName);
622             if (value != null &amp;&amp; !value.isEmpty()) {
623                 setProperty(cf, State.SYSTEMPROPERTY, value);
624                 return true;
625             }
626 
627             value = SecuritySupport.readJAXPProperty(sysPropertyName);
628             if (value != null &amp;&amp; !value.isEmpty()) {
629                 setProperty(cf, State.JAXPDOTPROPERTIES, value);
630                 return true;
631             }
632         }
633         return false;
634     }
635 
636     /**
637      * Returns an instance of the builder for creating the CatalogFeatures object.
638      *
639      * @return an instance of the builder
640      */
641     public static Builder builder() {
642         return new CatalogFeatures.Builder();
643     }
644 
645     /**
646      * The Builder class for building the CatalogFeatures object.
647      */
648     public static class Builder {
649         /**
650          * Values of the features supported by CatalogFeatures.
651          */
652         Map&lt;Feature, String&gt; values = new HashMap&lt;&gt;();
653 
654         /**
655          * Instantiation of Builder is not allowed.
656          */
657         private Builder() {}
658 
659         /**
660          * Sets the value to a specified Feature.
661          * @param feature the Feature to be set
662          * @param value the value to be set for the Feature
663          * @return this Builder instance
664          * @throws IllegalArgumentException if the value is not valid for the
665          * Feature or has the wrong syntax for the {@code javax.xml.catalog.files}
666          * property
667          */
668         public Builder with(Feature feature, String value) {
669             Util.validateFeatureInput(feature, value);
670             values.put(feature, value);
671             return this;
672         }
673 
674         /**
675          * Returns a CatalogFeatures object built by this builder.
676          *
677          * @return an instance of CatalogFeatures
678          */
679         public CatalogFeatures build() {
680             return new CatalogFeatures(this);
681         }
682     }
683 }
<a name="4" id="anc4"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="4" type="hidden" />
</body>
</html>