<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/LineNumberTable.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LineNumber.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="LocalVariable.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/LineNumberTable.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
   */
  /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   */
  /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 24,17 ***</span>
  import java.io.DataOutputStream;
  import java.io.IOException;
  import jdk.xml.internal.SecuritySupport;
  
  /**
<span class="line-modified">!  * This class represents a table of line numbers for debugging purposes. This</span>
<span class="line-modified">!  * attribute is used by the &lt;em&gt;Code&lt;/em&gt; attribute. It contains pairs of PCs</span>
<span class="line-modified">!  * and line numbers.</span>
   *
<span class="line-modified">!  * @version $Id: LineNumberTable.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
<span class="line-removed">-  * @see Code</span>
   * @see LineNumber
   */
  public final class LineNumberTable extends Attribute {
  
      private static final int MAX_LINE_LENGTH = 72;
      private LineNumber[] line_number_table; // Table of line/numbers pairs
<span class="line-new-header">--- 24,17 ---</span>
  import java.io.DataOutputStream;
  import java.io.IOException;
  import jdk.xml.internal.SecuritySupport;
  
  /**
<span class="line-modified">!  * This class represents a table of line numbers for debugging</span>
<span class="line-modified">!  * purposes. This attribute is used by the &lt;em&gt;Code&lt;/em&gt; attribute. It</span>
<span class="line-modified">!  * contains pairs of PCs and line numbers.</span>
   *
<span class="line-modified">!  * @see     Code</span>
   * @see LineNumber
<span class="line-added">+  * @LastModified: Jan 2020</span>
   */
  public final class LineNumberTable extends Attribute {
  
      private static final int MAX_LINE_LENGTH = 72;
      private LineNumber[] line_number_table; // Table of line/numbers pairs
</pre>
<hr />
<pre>
<span class="line-old-header">*** 61,16 ***</span>
          this.line_number_table = line_number_table;
      }
  
      /**
       * Construct object from input stream.
<span class="line-removed">-      *</span>
       * @param name_index Index of name
       * @param length Content length in bytes
       * @param input Input stream
       * @param constant_pool Array of constants
<span class="line-modified">!      * @throws IOEXception if an I/O Exception occurs in readUnsignedShort</span>
       */
      LineNumberTable(final int name_index, final int length, final DataInput input, final ConstantPool constant_pool)
              throws IOException {
          this(name_index, length, (LineNumber[]) null, constant_pool);
          final int line_number_table_length = input.readUnsignedShort();
<span class="line-new-header">--- 61,15 ---</span>
          this.line_number_table = line_number_table;
      }
  
      /**
       * Construct object from input stream.
       * @param name_index Index of name
       * @param length Content length in bytes
       * @param input Input stream
       * @param constant_pool Array of constants
<span class="line-modified">!      * @throws IOException if an I/O Exception occurs in readUnsignedShort</span>
       */
      LineNumberTable(final int name_index, final int length, final DataInput input, final ConstantPool constant_pool)
              throws IOException {
          this(name_index, length, (LineNumber[]) null, constant_pool);
          final int line_number_table_length = input.readUnsignedShort();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 86,48 ***</span>
       * fields, attributes, etc. spawns a tree of objects.
       *
       * @param v Visitor object
       */
      @Override
<span class="line-modified">!     public void accept(final Visitor v) {</span>
          v.visitLineNumberTable(this);
      }
  
      /**
       * Dump line number table attribute to file stream in binary format.
       *
       * @param file Output file stream
<span class="line-modified">!      * @throws IOEXception if an I/O Exception occurs in writeShort</span>
       */
      @Override
<span class="line-modified">!     public final void dump(final DataOutputStream file) throws IOException {</span>
          super.dump(file);
          file.writeShort(line_number_table.length);
          for (final LineNumber lineNumber : line_number_table) {
              lineNumber.dump(file);
          }
      }
  
      /**
       * @return Array of (pc offset, line number) pairs.
       */
<span class="line-modified">!     public final LineNumber[] getLineNumberTable() {</span>
          return line_number_table;
      }
  
      /**
       * @param line_number_table the line number entries for this table
       */
<span class="line-modified">!     public final void setLineNumberTable(final LineNumber[] line_number_table) {</span>
          this.line_number_table = line_number_table;
      }
  
      /**
       * @return String representation.
       */
      @Override
<span class="line-modified">!     public final String toString() {</span>
          final StringBuilder buf = new StringBuilder();
          final StringBuilder line = new StringBuilder();
  
          for (int i = 0; i &lt; line_number_table.length; i++) {
              line.append(line_number_table[i].toString());
<span class="line-new-header">--- 85,48 ---</span>
       * fields, attributes, etc. spawns a tree of objects.
       *
       * @param v Visitor object
       */
      @Override
<span class="line-modified">!     public void accept( final Visitor v ) {</span>
          v.visitLineNumberTable(this);
      }
  
      /**
       * Dump line number table attribute to file stream in binary format.
       *
       * @param file Output file stream
<span class="line-modified">!      * @throws IOException if an I/O Exception occurs in writeShort</span>
       */
      @Override
<span class="line-modified">!     public void dump( final DataOutputStream file ) throws IOException {</span>
          super.dump(file);
          file.writeShort(line_number_table.length);
          for (final LineNumber lineNumber : line_number_table) {
              lineNumber.dump(file);
          }
      }
  
      /**
       * @return Array of (pc offset, line number) pairs.
       */
<span class="line-modified">!     public LineNumber[] getLineNumberTable() {</span>
          return line_number_table;
      }
  
      /**
       * @param line_number_table the line number entries for this table
       */
<span class="line-modified">!     public void setLineNumberTable( final LineNumber[] line_number_table ) {</span>
          this.line_number_table = line_number_table;
      }
  
      /**
       * @return String representation.
       */
      @Override
<span class="line-modified">!     public String toString() {</span>
          final StringBuilder buf = new StringBuilder();
          final StringBuilder line = new StringBuilder();
  
          for (int i = 0; i &lt; line_number_table.length; i++) {
              line.append(line_number_table[i].toString());
</pre>
<hr />
<pre>
<span class="line-old-header">*** 148,22 ***</span>
       * Map byte code positions to source code lines.
       *
       * @param pos byte code offset
       * @return corresponding line in source code
       */
<span class="line-modified">!     public int getSourceLine(final int pos) {</span>
          int l = 0;
          int r = line_number_table.length - 1;
          if (r &lt; 0) {
              return -1;
          }
          int min_index = -1;
          int min = -1;
          /* Do a binary search since the array is ordered.
           */
          do {
<span class="line-modified">!             final int i = (l + r) / 2;</span>
              final int j = line_number_table[i].getStartPC();
              if (j == pos) {
                  return line_number_table[i].getLineNumber();
              } else if (pos &lt; j) {
                  r = i - 1;
<span class="line-new-header">--- 147,22 ---</span>
       * Map byte code positions to source code lines.
       *
       * @param pos byte code offset
       * @return corresponding line in source code
       */
<span class="line-modified">!     public int getSourceLine( final int pos ) {</span>
          int l = 0;
          int r = line_number_table.length - 1;
          if (r &lt; 0) {
              return -1;
          }
          int min_index = -1;
          int min = -1;
          /* Do a binary search since the array is ordered.
           */
          do {
<span class="line-modified">!             final int i = (l + r) &gt;&gt;&gt; 1;</span>
              final int j = line_number_table[i].getStartPC();
              if (j == pos) {
                  return line_number_table[i].getLineNumber();
              } else if (pos &lt; j) {
                  r = i - 1;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 190,11 ***</span>
  
      /**
       * @return deep copy of this attribute
       */
      @Override
<span class="line-modified">!     public Attribute copy(final ConstantPool _constant_pool) {</span>
          // TODO could use the lower level constructor and thereby allow
          // line_number_table to be made final
          final LineNumberTable c = (LineNumberTable) clone();
          c.line_number_table = new LineNumber[line_number_table.length];
          for (int i = 0; i &lt; line_number_table.length; i++) {
<span class="line-new-header">--- 189,11 ---</span>
  
      /**
       * @return deep copy of this attribute
       */
      @Override
<span class="line-modified">!     public Attribute copy( final ConstantPool _constant_pool ) {</span>
          // TODO could use the lower level constructor and thereby allow
          // line_number_table to be made final
          final LineNumberTable c = (LineNumberTable) clone();
          c.line_number_table = new LineNumber[line_number_table.length];
          for (int i = 0; i &lt; line_number_table.length; i++) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 202,9 ***</span>
          }
          c.setConstantPool(_constant_pool);
          return c;
      }
  
<span class="line-modified">!     public final int getTableLength() {</span>
          return line_number_table == null ? 0 : line_number_table.length;
      }
  }
<span class="line-new-header">--- 201,9 ---</span>
          }
          c.setConstantPool(_constant_pool);
          return c;
      }
  
<span class="line-modified">!     public int getTableLength() {</span>
          return line_number_table == null ? 0 : line_number_table.length;
      }
  }
</pre>
<center><a href="LineNumber.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="LocalVariable.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>