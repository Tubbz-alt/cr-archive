<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/trax/StAXStream2SAX.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DOM2TO.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="TemplatesHandlerImpl.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/trax/StAXStream2SAX.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2005, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
102     //Main Work Starts Here.
103     public void parse() throws IOException, SAXException, XMLStreamException {
104         bridge();
105     }
106 
107 
108    /**
109      * This class is only used internally so this method should never
110      * be called.
111      */
112     public void parse(String sysId) throws IOException, SAXException {
113         throw new IOException(&quot;This method is not yet implemented.&quot;);
114     }
115 
116 
117    public void bridge() throws XMLStreamException {
118 
119         try {
120             // remembers the nest level of elements to know when we are done.
121             int depth=0;

122 
123             // skip over START_DOCUMENT
124             int event = staxStreamReader.getEventType();
125             if (event == XMLStreamConstants.START_DOCUMENT) {

126                 event = staxStreamReader.next();
127             }
128 
<span class="line-modified">129             // If not a START_ELEMENT (e.g., a DTD), skip to next tag</span>
<span class="line-modified">130             if (event != XMLStreamConstants.START_ELEMENT) {</span>
<span class="line-modified">131                 event = staxStreamReader.nextTag();</span>
<span class="line-modified">132                 // An error if a START_ELEMENT isn&#39;t found now</span>
<span class="line-modified">133                 if (event != XMLStreamConstants.START_ELEMENT) {</span>
<span class="line-modified">134                     throw new IllegalStateException(&quot;The current event is &quot; +</span>
<span class="line-modified">135                             &quot;not START_ELEMENT\n but&quot; + event);</span>















136                 }

137             }
138 
<span class="line-removed">139             handleStartDocument();</span>
<span class="line-removed">140 </span>
141             do {
142                 // These are all of the events listed in the javadoc for
143                 // XMLEvent.
144                 // The spec only really describes 11 of them.
145                 switch (event) {
146                     case XMLStreamConstants.START_ELEMENT :
147                         depth++;
148                         handleStartElement();
149                         break;
150                     case XMLStreamConstants.END_ELEMENT :
151                         handleEndElement();
152                         depth--;
153                         break;
154                     case XMLStreamConstants.CHARACTERS :
155                         handleCharacters();
156                         break;
157                     case XMLStreamConstants.ENTITY_REFERENCE :
158                         handleEntityReference();
159                         break;
160                     case XMLStreamConstants.PROCESSING_INSTRUCTION :
</pre>
<hr />
<pre>
174                         break;
175                     case XMLStreamConstants.CDATA :
176                         handleCDATA();
177                         break;
178                     case XMLStreamConstants.ENTITY_DECLARATION :
179                         handleEntityDecl();
180                         break;
181                     case XMLStreamConstants.NOTATION_DECLARATION :
182                         handleNotationDecl();
183                         break;
184                     case XMLStreamConstants.SPACE :
185                         handleSpace();
186                         break;
187                     default :
188                         throw new InternalError(&quot;processing event: &quot; + event);
189                 }
190 
191                 event=staxStreamReader.next();
192             } while (depth!=0);
193 























194             handleEndDocument();
195         } catch (SAXException e) {
196             throw new XMLStreamException(e);
197         }
198     }
199 
200     private void handleEndDocument() throws SAXException {
201         _sax.endDocument();
202     }
203 
204     private void handleStartDocument() throws SAXException {
205         _sax.setDocumentLocator(new Locator2() {
206             public int getColumnNumber() {
207                 return staxStreamReader.getLocation().getColumnNumber();
208             }
209             public int getLineNumber() {
210                 return staxStreamReader.getLocation().getLineNumber();
211             }
212             public String getPublicId() {
213                 return staxStreamReader.getLocation().getPublicId();
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
102     //Main Work Starts Here.
103     public void parse() throws IOException, SAXException, XMLStreamException {
104         bridge();
105     }
106 
107 
108    /**
109      * This class is only used internally so this method should never
110      * be called.
111      */
112     public void parse(String sysId) throws IOException, SAXException {
113         throw new IOException(&quot;This method is not yet implemented.&quot;);
114     }
115 
116 
117    public void bridge() throws XMLStreamException {
118 
119         try {
120             // remembers the nest level of elements to know when we are done.
121             int depth=0;
<span class="line-added">122             boolean startedAtDocument = false;</span>
123 
124             // skip over START_DOCUMENT
125             int event = staxStreamReader.getEventType();
126             if (event == XMLStreamConstants.START_DOCUMENT) {
<span class="line-added">127                 startedAtDocument = true;</span>
128                 event = staxStreamReader.next();
129             }
130 
<span class="line-modified">131             handleStartDocument();</span>
<span class="line-modified">132 </span>
<span class="line-modified">133             // Handle the prolog: http://www.w3.org/TR/REC-xml/#NT-prolog</span>
<span class="line-modified">134             while (event != XMLStreamConstants.START_ELEMENT) {</span>
<span class="line-modified">135                 switch (event) {</span>
<span class="line-modified">136                     case XMLStreamConstants.CHARACTERS :</span>
<span class="line-modified">137                         handleCharacters();</span>
<span class="line-added">138                         break;</span>
<span class="line-added">139                     case XMLStreamConstants.PROCESSING_INSTRUCTION :</span>
<span class="line-added">140                         handlePI();</span>
<span class="line-added">141                         break;</span>
<span class="line-added">142                     case XMLStreamConstants.COMMENT :</span>
<span class="line-added">143                         handleComment();</span>
<span class="line-added">144                         break;</span>
<span class="line-added">145                     case XMLStreamConstants.DTD :</span>
<span class="line-added">146                         handleDTD();</span>
<span class="line-added">147                         break;</span>
<span class="line-added">148                     case XMLStreamConstants.SPACE :</span>
<span class="line-added">149                         handleSpace();</span>
<span class="line-added">150                         break;</span>
<span class="line-added">151                     default :</span>
<span class="line-added">152                         throw new InternalError(&quot;processing prolog event: &quot; + event);</span>
153                 }
<span class="line-added">154                 event=staxStreamReader.next();</span>
155             }
156 


157             do {
158                 // These are all of the events listed in the javadoc for
159                 // XMLEvent.
160                 // The spec only really describes 11 of them.
161                 switch (event) {
162                     case XMLStreamConstants.START_ELEMENT :
163                         depth++;
164                         handleStartElement();
165                         break;
166                     case XMLStreamConstants.END_ELEMENT :
167                         handleEndElement();
168                         depth--;
169                         break;
170                     case XMLStreamConstants.CHARACTERS :
171                         handleCharacters();
172                         break;
173                     case XMLStreamConstants.ENTITY_REFERENCE :
174                         handleEntityReference();
175                         break;
176                     case XMLStreamConstants.PROCESSING_INSTRUCTION :
</pre>
<hr />
<pre>
190                         break;
191                     case XMLStreamConstants.CDATA :
192                         handleCDATA();
193                         break;
194                     case XMLStreamConstants.ENTITY_DECLARATION :
195                         handleEntityDecl();
196                         break;
197                     case XMLStreamConstants.NOTATION_DECLARATION :
198                         handleNotationDecl();
199                         break;
200                     case XMLStreamConstants.SPACE :
201                         handleSpace();
202                         break;
203                     default :
204                         throw new InternalError(&quot;processing event: &quot; + event);
205                 }
206 
207                 event=staxStreamReader.next();
208             } while (depth!=0);
209 
<span class="line-added">210             if (startedAtDocument) {</span>
<span class="line-added">211                 // Handle the Misc (http://www.w3.org/TR/REC-xml/#NT-Misc) that can follow the document element</span>
<span class="line-added">212                 while (event != XMLStreamConstants.END_DOCUMENT) {</span>
<span class="line-added">213                     switch (event) {</span>
<span class="line-added">214                         case XMLStreamConstants.CHARACTERS :</span>
<span class="line-added">215                             handleCharacters();</span>
<span class="line-added">216                             break;</span>
<span class="line-added">217                         case XMLStreamConstants.PROCESSING_INSTRUCTION :</span>
<span class="line-added">218                             handlePI();</span>
<span class="line-added">219                             break;</span>
<span class="line-added">220                         case XMLStreamConstants.COMMENT :</span>
<span class="line-added">221                             handleComment();</span>
<span class="line-added">222                             break;</span>
<span class="line-added">223                         case XMLStreamConstants.SPACE :</span>
<span class="line-added">224                             handleSpace();</span>
<span class="line-added">225                             break;</span>
<span class="line-added">226                         default :</span>
<span class="line-added">227                             throw new InternalError(&quot;processing misc event after document element: &quot; + event);</span>
<span class="line-added">228                     }</span>
<span class="line-added">229                     event=staxStreamReader.next();</span>
<span class="line-added">230                 }</span>
<span class="line-added">231             }</span>
<span class="line-added">232 </span>
233             handleEndDocument();
234         } catch (SAXException e) {
235             throw new XMLStreamException(e);
236         }
237     }
238 
239     private void handleEndDocument() throws SAXException {
240         _sax.endDocument();
241     }
242 
243     private void handleStartDocument() throws SAXException {
244         _sax.setDocumentLocator(new Locator2() {
245             public int getColumnNumber() {
246                 return staxStreamReader.getLocation().getColumnNumber();
247             }
248             public int getLineNumber() {
249                 return staxStreamReader.getLocation().getLineNumber();
250             }
251             public String getPublicId() {
252                 return staxStreamReader.getLocation().getPublicId();
</pre>
</td>
</tr>
</table>
<center><a href="DOM2TO.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="TemplatesHandlerImpl.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>