<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/LocalVariable.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LineNumberTable.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="LocalVariableTable.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/LocalVariable.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.bcel.internal.classfile;
 22 
 23 import java.io.DataInput;
 24 import java.io.DataOutputStream;
 25 import java.io.IOException;
 26 
 27 import com.sun.org.apache.bcel.internal.Const;
 28 
 29 /**
 30  * This class represents a local variable within a method. It contains its
<span class="line-modified"> 31  * scope, name, signature and index on the method&#39;s frame.</span>






 32  *
<span class="line-removed"> 33  * @version $Id: LocalVariable.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
 34  * @see     LocalVariableTable


 35  */
 36 public final class LocalVariable implements Cloneable, Node {
 37 
 38     private int start_pc; // Range in which the variable is valid
 39     private int length;
 40     private int name_index; // Index in constant pool of variable name


 41     private int signature_index; // Index of variable signature
<span class="line-modified"> 42     private int index; /* Variable is `index&#39;th local variable on</span>
 43      * this method&#39;s frame.
 44      */
 45     private ConstantPool constant_pool;

 46 
 47 
 48     /**
<span class="line-modified"> 49      * Initialize from another object. Note that both objects use the same</span>
 50      * references (shallow copy). Use copy() for a physical copy.


 51      */
<span class="line-modified"> 52     public LocalVariable(final LocalVariable c) {</span>
<span class="line-modified"> 53         this(c.getStartPC(), c.getLength(), c.getNameIndex(), c.getSignatureIndex(), c.getIndex(),</span>
<span class="line-modified"> 54                 c.getConstantPool());</span>

 55     }
 56 
<span class="line-removed"> 57 </span>
 58     /**
<span class="line-modified"> 59      * Construct object from file stream.</span>
 60      * @param file Input stream
 61      * @throws IOException
 62      */
 63     LocalVariable(final DataInput file, final ConstantPool constant_pool) throws IOException {
 64         this(file.readUnsignedShort(), file.readUnsignedShort(), file.readUnsignedShort(), file
 65                 .readUnsignedShort(), file.readUnsignedShort(), constant_pool);
 66     }
 67 
 68 
 69     /**
 70      * @param start_pc Range in which the variable
 71      * @param length ... is valid
 72      * @param name_index Index in constant pool of variable name
 73      * @param signature_index Index of variable&#39;s signature
 74      * @param index Variable is `index&#39;th local variable on the method&#39;s frame
 75      * @param constant_pool Array of constants
 76      */
 77     public LocalVariable(final int start_pc, final int length, final int name_index, final int signature_index, final int index,
 78             final ConstantPool constant_pool) {
 79         this.start_pc = start_pc;
 80         this.length = length;
 81         this.name_index = name_index;
 82         this.signature_index = signature_index;
 83         this.index = index;
 84         this.constant_pool = constant_pool;






















 85     }
 86 
 87 
 88     /**
 89      * Called by objects that are traversing the nodes of the tree implicitely
 90      * defined by the contents of a Java class. I.e., the hierarchy of methods,
 91      * fields, attributes, etc. spawns a tree of objects.
 92      *
 93      * @param v Visitor object
 94      */
 95     @Override
 96     public void accept( final Visitor v ) {
 97         v.visitLocalVariable(this);
 98     }
 99 
100 
101     /**
<span class="line-modified">102      * Dump local variable to file stream in binary format.</span>
103      *
<span class="line-modified">104      * @param file Output file stream</span>
<span class="line-modified">105      * @throws IOException</span>

106      */
<span class="line-modified">107     public final void dump( final DataOutputStream file ) throws IOException {</span>
<span class="line-modified">108         file.writeShort(start_pc);</span>
<span class="line-modified">109         file.writeShort(length);</span>
<span class="line-modified">110         file.writeShort(name_index);</span>
<span class="line-modified">111         file.writeShort(signature_index);</span>
<span class="line-modified">112         file.writeShort(index);</span>
113     }
114 
<span class="line-removed">115 </span>
116     /**
117      * @return Constant pool used by this object.
118      */
<span class="line-modified">119     public final ConstantPool getConstantPool() {</span>
120         return constant_pool;
121     }
122 
123 
124     /**
125      * @return Variable is valid within getStartPC() .. getStartPC()+getLength()
126      */
<span class="line-modified">127     public final int getLength() {</span>
128         return length;
129     }
130 
131 
132     /**
133      * @return Variable name.
134      */
<span class="line-modified">135     public final String getName() {</span>
136         ConstantUtf8 c;
137         c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);
138         return c.getBytes();
139     }
140 
141 
142     /**
143      * @return Index in constant pool of variable name.
144      */
<span class="line-modified">145     public final int getNameIndex() {</span>
146         return name_index;
147     }
148 
149 
150     /**
151      * @return Signature.
152      */
<span class="line-modified">153     public final String getSignature() {</span>
154         ConstantUtf8 c;
155         c = (ConstantUtf8) constant_pool.getConstant(signature_index, Const.CONSTANT_Utf8);
156         return c.getBytes();
157     }
158 
159 
160     /**
161      * @return Index in constant pool of variable signature.
162      */
<span class="line-modified">163     public final int getSignatureIndex() {</span>
164         return signature_index;
165     }
166 
167 
168     /**
169      * @return index of register where variable is stored
170      */
<span class="line-modified">171     public final int getIndex() {</span>
172         return index;
173     }
174 
175 
176     /**
<span class="line-modified">177      * @return Start of range where he variable is valid</span>








178      */
<span class="line-modified">179     public final int getStartPC() {</span>
180         return start_pc;
181     }
182 
183 
184     /*
185      * Helper method shared with LocalVariableTypeTable
186      */
<span class="line-modified">187     final String toStringShared( final boolean typeTable ) {</span>
188         final String name = getName();
189         final String signature = Utility.signatureToString(getSignature(), false);
190         final String label = &quot;LocalVariable&quot; + (typeTable ? &quot;Types&quot; : &quot;&quot; );
191         return label + &quot;(start_pc = &quot; + start_pc + &quot;, length = &quot; + length + &quot;, index = &quot;
192                 + index + &quot;:&quot; + signature + &quot; &quot; + name + &quot;)&quot;;
193     }
194 
195 
196     /**
197      * @param constant_pool Constant pool to be used for this object.
198      */
<span class="line-modified">199     public final void setConstantPool( final ConstantPool constant_pool ) {</span>
200         this.constant_pool = constant_pool;
201     }
202 
203 
204     /**
205      * @param length the length of this local variable
206      */
<span class="line-modified">207     public final void setLength( final int length ) {</span>
208         this.length = length;
209     }
210 
211 
212     /**
213      * @param name_index the index into the constant pool for the name of this variable
214      */
<span class="line-modified">215     public final void setNameIndex( final int name_index ) { // TODO unused</span>
216         this.name_index = name_index;
217     }
218 
219 
220     /**
221      * @param signature_index the index into the constant pool for the signature of this variable
222      */
<span class="line-modified">223     public final void setSignatureIndex( final int signature_index ) { // TODO unused</span>
224         this.signature_index = signature_index;
225     }
226 
227 
228     /**
229      * @param index the index in the local variable table of this variable
230      */
<span class="line-modified">231     public final void setIndex( final int index ) { // TODO unused</span>
232         this.index = index;
233     }
234 
235 
236     /**
237      * @param start_pc Specify range where the local variable is valid.
238      */
<span class="line-modified">239     public final void setStartPC( final int start_pc ) { // TODO unused</span>
240         this.start_pc = start_pc;
241     }
242 
243 
244     /**
245      * @return string representation.
246      */
247     @Override
<span class="line-modified">248     public final String toString() {</span>
249         return toStringShared(false);
250     }
251 
252 
253     /**
254      * @return deep copy of this object
255      */
256     public LocalVariable copy() {
257         try {
258             return (LocalVariable) clone();
259         } catch (final CloneNotSupportedException e) {
260             // TODO should this throw?
261         }
262         return null;
263     }
264 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.bcel.internal.classfile;
 22 
 23 import java.io.DataInput;
 24 import java.io.DataOutputStream;
 25 import java.io.IOException;
 26 
 27 import com.sun.org.apache.bcel.internal.Const;
 28 
 29 /**
 30  * This class represents a local variable within a method. It contains its
<span class="line-modified"> 31  * scope, name, signature and index on the method&#39;s frame.  It is used both</span>
<span class="line-added"> 32  * to represent an element of the LocalVariableTable as well as an element</span>
<span class="line-added"> 33  * of the LocalVariableTypeTable.  The nomenclature used here may be a bit confusing;</span>
<span class="line-added"> 34  * while the two items have the same layout in a class file, a LocalVariableTable</span>
<span class="line-added"> 35  * attribute contains a descriptor_index, not a signature_index.  The</span>
<span class="line-added"> 36  * LocalVariableTypeTable attribute does have a signature_index.</span>
<span class="line-added"> 37  * @see com.sun.org.apache.bcel.internal.classfile.Utility for more details on the difference.</span>
 38  *

 39  * @see     LocalVariableTable
<span class="line-added"> 40  * @see     LocalVariableTypeTable</span>
<span class="line-added"> 41  * @LastModified: Jan 2020</span>
 42  */
 43 public final class LocalVariable implements Cloneable, Node {
 44 
 45     private int start_pc; // Range in which the variable is valid
 46     private int length;
 47     private int name_index; // Index in constant pool of variable name
<span class="line-added"> 48     // Technically, a decscriptor_index for a local variable table entry</span>
<span class="line-added"> 49     // and a signature_index for a local variable type table entry.</span>
 50     private int signature_index; // Index of variable signature
<span class="line-modified"> 51     private int index; /* Variable is index&#39;th local variable on</span>
 52      * this method&#39;s frame.
 53      */
 54     private ConstantPool constant_pool;
<span class="line-added"> 55     private int orig_index; // never changes; used to match up with LocalVariableTypeTable entries</span>
 56 
 57 
 58     /**
<span class="line-modified"> 59      * Initializes from another LocalVariable. Note that both objects use the same</span>
 60      * references (shallow copy). Use copy() for a physical copy.
<span class="line-added"> 61      *</span>
<span class="line-added"> 62      * @param localVariable Another LocalVariable.</span>
 63      */
<span class="line-modified"> 64     public LocalVariable(final LocalVariable localVariable) {</span>
<span class="line-modified"> 65         this(localVariable.getStartPC(), localVariable.getLength(), localVariable.getNameIndex(),</span>
<span class="line-modified"> 66                 localVariable.getSignatureIndex(), localVariable.getIndex(), localVariable.getConstantPool());</span>
<span class="line-added"> 67         this.orig_index = localVariable.getOrigIndex();</span>
 68     }
 69 

 70     /**
<span class="line-modified"> 71      * Constructs object from file stream.</span>
 72      * @param file Input stream
 73      * @throws IOException
 74      */
 75     LocalVariable(final DataInput file, final ConstantPool constant_pool) throws IOException {
 76         this(file.readUnsignedShort(), file.readUnsignedShort(), file.readUnsignedShort(), file
 77                 .readUnsignedShort(), file.readUnsignedShort(), constant_pool);
 78     }
 79 
 80 
 81     /**
 82      * @param start_pc Range in which the variable
 83      * @param length ... is valid
 84      * @param name_index Index in constant pool of variable name
 85      * @param signature_index Index of variable&#39;s signature
 86      * @param index Variable is `index&#39;th local variable on the method&#39;s frame
 87      * @param constant_pool Array of constants
 88      */
 89     public LocalVariable(final int start_pc, final int length, final int name_index, final int signature_index, final int index,
 90             final ConstantPool constant_pool) {
 91         this.start_pc = start_pc;
 92         this.length = length;
 93         this.name_index = name_index;
 94         this.signature_index = signature_index;
 95         this.index = index;
 96         this.constant_pool = constant_pool;
<span class="line-added"> 97         this.orig_index = index;</span>
<span class="line-added"> 98     }</span>
<span class="line-added"> 99 </span>
<span class="line-added">100 </span>
<span class="line-added">101     /**</span>
<span class="line-added">102      * @param start_pc Range in which the variable</span>
<span class="line-added">103      * @param length ... is valid</span>
<span class="line-added">104      * @param name_index Index in constant pool of variable name</span>
<span class="line-added">105      * @param signature_index Index of variable&#39;s signature</span>
<span class="line-added">106      * @param index Variable is `index&#39;th local variable on the method&#39;s frame</span>
<span class="line-added">107      * @param constant_pool Array of constants</span>
<span class="line-added">108      * @param orig_index Variable is `index&#39;th local variable on the method&#39;s frame prior to any changes</span>
<span class="line-added">109      */</span>
<span class="line-added">110     public LocalVariable(final int start_pc, final int length, final int name_index, final int signature_index, final int index,</span>
<span class="line-added">111             final ConstantPool constant_pool, final int orig_index) {</span>
<span class="line-added">112         this.start_pc = start_pc;</span>
<span class="line-added">113         this.length = length;</span>
<span class="line-added">114         this.name_index = name_index;</span>
<span class="line-added">115         this.signature_index = signature_index;</span>
<span class="line-added">116         this.index = index;</span>
<span class="line-added">117         this.constant_pool = constant_pool;</span>
<span class="line-added">118         this.orig_index = orig_index;</span>
119     }
120 
121 
122     /**
123      * Called by objects that are traversing the nodes of the tree implicitely
124      * defined by the contents of a Java class. I.e., the hierarchy of methods,
125      * fields, attributes, etc. spawns a tree of objects.
126      *
127      * @param v Visitor object
128      */
129     @Override
130     public void accept( final Visitor v ) {
131         v.visitLocalVariable(this);
132     }
133 
134 
135     /**
<span class="line-modified">136      * Dumps local variable to file stream in binary format.</span>
137      *
<span class="line-modified">138      * @param dataOutputStream Output file stream</span>
<span class="line-modified">139      * @exception IOException if an I/O error occurs.</span>
<span class="line-added">140      * @see java.io.FilterOutputStream#out</span>
141      */
<span class="line-modified">142     public void dump(final DataOutputStream dataOutputStream) throws IOException {</span>
<span class="line-modified">143         dataOutputStream.writeShort(start_pc);</span>
<span class="line-modified">144         dataOutputStream.writeShort(length);</span>
<span class="line-modified">145         dataOutputStream.writeShort(name_index);</span>
<span class="line-modified">146         dataOutputStream.writeShort(signature_index);</span>
<span class="line-modified">147         dataOutputStream.writeShort(index);</span>
148     }
149 

150     /**
151      * @return Constant pool used by this object.
152      */
<span class="line-modified">153     public ConstantPool getConstantPool() {</span>
154         return constant_pool;
155     }
156 
157 
158     /**
159      * @return Variable is valid within getStartPC() .. getStartPC()+getLength()
160      */
<span class="line-modified">161     public int getLength() {</span>
162         return length;
163     }
164 
165 
166     /**
167      * @return Variable name.
168      */
<span class="line-modified">169     public String getName() {</span>
170         ConstantUtf8 c;
171         c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);
172         return c.getBytes();
173     }
174 
175 
176     /**
177      * @return Index in constant pool of variable name.
178      */
<span class="line-modified">179     public int getNameIndex() {</span>
180         return name_index;
181     }
182 
183 
184     /**
185      * @return Signature.
186      */
<span class="line-modified">187     public String getSignature() {</span>
188         ConstantUtf8 c;
189         c = (ConstantUtf8) constant_pool.getConstant(signature_index, Const.CONSTANT_Utf8);
190         return c.getBytes();
191     }
192 
193 
194     /**
195      * @return Index in constant pool of variable signature.
196      */
<span class="line-modified">197     public int getSignatureIndex() {</span>
198         return signature_index;
199     }
200 
201 
202     /**
203      * @return index of register where variable is stored
204      */
<span class="line-modified">205     public int getIndex() {</span>
206         return index;
207     }
208 
209 
210     /**
<span class="line-modified">211      * @return index of register where variable was originally stored</span>
<span class="line-added">212      */</span>
<span class="line-added">213     public int getOrigIndex() {</span>
<span class="line-added">214         return orig_index;</span>
<span class="line-added">215     }</span>
<span class="line-added">216 </span>
<span class="line-added">217 </span>
<span class="line-added">218     /**</span>
<span class="line-added">219      * @return Start of range where the variable is valid</span>
220      */
<span class="line-modified">221     public int getStartPC() {</span>
222         return start_pc;
223     }
224 
225 
226     /*
227      * Helper method shared with LocalVariableTypeTable
228      */
<span class="line-modified">229     String toStringShared( final boolean typeTable ) {</span>
230         final String name = getName();
231         final String signature = Utility.signatureToString(getSignature(), false);
232         final String label = &quot;LocalVariable&quot; + (typeTable ? &quot;Types&quot; : &quot;&quot; );
233         return label + &quot;(start_pc = &quot; + start_pc + &quot;, length = &quot; + length + &quot;, index = &quot;
234                 + index + &quot;:&quot; + signature + &quot; &quot; + name + &quot;)&quot;;
235     }
236 
237 
238     /**
239      * @param constant_pool Constant pool to be used for this object.
240      */
<span class="line-modified">241     public void setConstantPool( final ConstantPool constant_pool ) {</span>
242         this.constant_pool = constant_pool;
243     }
244 
245 
246     /**
247      * @param length the length of this local variable
248      */
<span class="line-modified">249     public void setLength( final int length ) {</span>
250         this.length = length;
251     }
252 
253 
254     /**
255      * @param name_index the index into the constant pool for the name of this variable
256      */
<span class="line-modified">257     public void setNameIndex( final int name_index ) { // TODO unused</span>
258         this.name_index = name_index;
259     }
260 
261 
262     /**
263      * @param signature_index the index into the constant pool for the signature of this variable
264      */
<span class="line-modified">265     public void setSignatureIndex( final int signature_index ) { // TODO unused</span>
266         this.signature_index = signature_index;
267     }
268 
269 
270     /**
271      * @param index the index in the local variable table of this variable
272      */
<span class="line-modified">273     public void setIndex( final int index ) { // TODO unused</span>
274         this.index = index;
275     }
276 
277 
278     /**
279      * @param start_pc Specify range where the local variable is valid.
280      */
<span class="line-modified">281     public void setStartPC( final int start_pc ) { // TODO unused</span>
282         this.start_pc = start_pc;
283     }
284 
285 
286     /**
287      * @return string representation.
288      */
289     @Override
<span class="line-modified">290     public String toString() {</span>
291         return toStringShared(false);
292     }
293 
294 
295     /**
296      * @return deep copy of this object
297      */
298     public LocalVariable copy() {
299         try {
300             return (LocalVariable) clone();
301         } catch (final CloneNotSupportedException e) {
302             // TODO should this throw?
303         }
304         return null;
305     }
306 }
</pre>
</td>
</tr>
</table>
<center><a href="LineNumberTable.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="LocalVariableTable.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>