<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/INVOKEDYNAMIC.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="INSTANCEOF.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="INVOKEINTERFACE.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/INVOKEDYNAMIC.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.bcel.internal.generic;
 22 
 23 import java.io.DataOutputStream;
 24 import java.io.IOException;
 25 
 26 import com.sun.org.apache.bcel.internal.Const;
 27 import com.sun.org.apache.bcel.internal.ExceptionConst;
 28 import com.sun.org.apache.bcel.internal.classfile.ConstantInvokeDynamic;
 29 import com.sun.org.apache.bcel.internal.classfile.ConstantNameAndType;
 30 import com.sun.org.apache.bcel.internal.classfile.ConstantPool;
 31 import com.sun.org.apache.bcel.internal.util.ByteSequence;
 32 
 33 /**
 34  * Class for INVOKEDYNAMIC. Not an instance of InvokeInstruction, since that class
 35  * expects to be able to get the class of the method. Ignores the bootstrap
 36  * mechanism entirely.
 37  *
<span class="line-removed"> 38  * @version $Id: InvokeInstruction.java 1152072 2011-07-29 01:54:05Z dbrosius $</span>
 39  * @see
 40  * &lt;a href=&quot;http://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5.invokedynamic&quot;&gt;
 41  * The invokedynamic instruction in The Java Virtual Machine Specification&lt;/a&gt;
 42  * @since 6.0
<span class="line-modified"> 43  * @LastModified: Nov 2017</span>
 44  */
 45 public class INVOKEDYNAMIC extends InvokeInstruction {
 46 
 47     /**
<span class="line-modified"> 48      * Empty constructor needed for the Class.newInstance() statement in</span>
<span class="line-modified"> 49      * Instruction.readInstruction(). Not to be used otherwise.</span>
 50      */
 51     INVOKEDYNAMIC() {
 52     }
 53 
 54 
 55     public INVOKEDYNAMIC(final int index) {
 56         super(Const.INVOKEDYNAMIC, index);
 57     }
 58 
 59 
 60     /**
 61      * Dump instruction as byte code to stream out.
 62      * @param out Output stream
 63      */
 64     @Override
 65     public void dump( final DataOutputStream out ) throws IOException {
 66         out.writeByte(super.getOpcode());
 67         out.writeShort(super.getIndex());
 68         out.writeByte(0);
 69         out.writeByte(0);
</pre>
<hr />
<pre>
120         v.visitFieldOrMethod(this);
121         v.visitInvokeInstruction(this);
122         v.visitINVOKEDYNAMIC(this);
123     }
124 
125     /**
126      * Override the parent method because our classname is held elsewhere.
127      *
128      * @param cpg the ConstantPool generator
129      * @deprecated in FieldOrMethod
130      *
131      * @return name of the referenced class/interface
132      */
133     @Override
134     @Deprecated
135     public String getClassName( final ConstantPoolGen cpg ) {
136         final ConstantPool cp = cpg.getConstantPool();
137         final ConstantInvokeDynamic cid = (ConstantInvokeDynamic) cp.getConstant(super.getIndex(), Const.CONSTANT_InvokeDynamic);
138         return ((ConstantNameAndType) cp.getConstant(cid.getNameAndTypeIndex())).getName(cp);
139     }















140 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.bcel.internal.generic;
 22 
 23 import java.io.DataOutputStream;
 24 import java.io.IOException;
 25 
 26 import com.sun.org.apache.bcel.internal.Const;
 27 import com.sun.org.apache.bcel.internal.ExceptionConst;
 28 import com.sun.org.apache.bcel.internal.classfile.ConstantInvokeDynamic;
 29 import com.sun.org.apache.bcel.internal.classfile.ConstantNameAndType;
 30 import com.sun.org.apache.bcel.internal.classfile.ConstantPool;
 31 import com.sun.org.apache.bcel.internal.util.ByteSequence;
 32 
 33 /**
 34  * Class for INVOKEDYNAMIC. Not an instance of InvokeInstruction, since that class
 35  * expects to be able to get the class of the method. Ignores the bootstrap
 36  * mechanism entirely.
 37  *

 38  * @see
 39  * &lt;a href=&quot;http://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5.invokedynamic&quot;&gt;
 40  * The invokedynamic instruction in The Java Virtual Machine Specification&lt;/a&gt;
 41  * @since 6.0
<span class="line-modified"> 42  * @LastModified: Jan 2020</span>
 43  */
 44 public class INVOKEDYNAMIC extends InvokeInstruction {
 45 
 46     /**
<span class="line-modified"> 47      * Empty constructor needed for Instruction.readInstruction.</span>
<span class="line-modified"> 48      * Not to be used otherwise.</span>
 49      */
 50     INVOKEDYNAMIC() {
 51     }
 52 
 53 
 54     public INVOKEDYNAMIC(final int index) {
 55         super(Const.INVOKEDYNAMIC, index);
 56     }
 57 
 58 
 59     /**
 60      * Dump instruction as byte code to stream out.
 61      * @param out Output stream
 62      */
 63     @Override
 64     public void dump( final DataOutputStream out ) throws IOException {
 65         out.writeByte(super.getOpcode());
 66         out.writeShort(super.getIndex());
 67         out.writeByte(0);
 68         out.writeByte(0);
</pre>
<hr />
<pre>
119         v.visitFieldOrMethod(this);
120         v.visitInvokeInstruction(this);
121         v.visitINVOKEDYNAMIC(this);
122     }
123 
124     /**
125      * Override the parent method because our classname is held elsewhere.
126      *
127      * @param cpg the ConstantPool generator
128      * @deprecated in FieldOrMethod
129      *
130      * @return name of the referenced class/interface
131      */
132     @Override
133     @Deprecated
134     public String getClassName( final ConstantPoolGen cpg ) {
135         final ConstantPool cp = cpg.getConstantPool();
136         final ConstantInvokeDynamic cid = (ConstantInvokeDynamic) cp.getConstant(super.getIndex(), Const.CONSTANT_InvokeDynamic);
137         return ((ConstantNameAndType) cp.getConstant(cid.getNameAndTypeIndex())).getName(cp);
138     }
<span class="line-added">139 </span>
<span class="line-added">140 </span>
<span class="line-added">141     /**</span>
<span class="line-added">142      * Since InvokeDynamic doesn&#39;t refer to a reference type, just return java.lang.Object,</span>
<span class="line-added">143      * as that is the only type we can say for sure the reference will be.</span>
<span class="line-added">144      *</span>
<span class="line-added">145      * @param cpg</span>
<span class="line-added">146      *            the ConstantPoolGen used to create the instruction</span>
<span class="line-added">147      * @return an ObjectType for java.lang.Object</span>
<span class="line-added">148      * @since 6.1</span>
<span class="line-added">149      */</span>
<span class="line-added">150     @Override</span>
<span class="line-added">151     public ReferenceType getReferenceType(final ConstantPoolGen cpg) {</span>
<span class="line-added">152         return new ObjectType(Object.class.getName());</span>
<span class="line-added">153     }</span>
154 }
</pre>
</td>
</tr>
</table>
<center><a href="INSTANCEOF.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="INVOKEINTERFACE.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>