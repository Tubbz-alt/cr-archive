<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/Code.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ClassParser.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="CodeException.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/Code.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 22 package com.sun.org.apache.bcel.internal.classfile;
 23 
 24 import java.io.DataInput;
 25 import java.io.DataOutputStream;
 26 import java.io.IOException;
 27 
 28 import com.sun.org.apache.bcel.internal.Const;
 29 
 30 /**
 31  * This class represents a chunk of Java byte code contained in a
 32  * method. It is instantiated by the
 33  * &lt;em&gt;Attribute.readAttribute()&lt;/em&gt; method. A &lt;em&gt;Code&lt;/em&gt;
 34  * attribute contains informations about operand stack, local
 35  * variables, byte code and the exceptions handled within this
 36  * method.
 37  *
 38  * This attribute has attributes itself, namely &lt;em&gt;LineNumberTable&lt;/em&gt; which
 39  * is used for debugging purposes and &lt;em&gt;LocalVariableTable&lt;/em&gt; which
 40  * contains information about the local variables.
 41  *
<span class="line-removed"> 42  * @version $Id: Code.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
 43  * @see     Attribute
 44  * @see     CodeException
 45  * @see     LineNumberTable
 46  * @see LocalVariableTable
 47  */
 48 public final class Code extends Attribute {
 49 
 50     private int max_stack; // Maximum size of stack used by this method  // TODO this could be made final (setter is not used)
 51     private int max_locals; // Number of local variables  // TODO this could be made final (setter is not used)
 52     private byte[] code; // Actual byte code
 53     private CodeException[] exception_table; // Table of handled exceptions
 54     private Attribute[] attributes; // or LocalVariable
 55 
 56 
 57     /**
 58      * Initialize from another object. Note that both objects use the same
 59      * references (shallow copy). Use copy() for a physical copy.
 60      */
 61     public Code(final Code c) {
 62         this(c.getNameIndex(), c.getLength(), c.getMaxStack(), c.getMaxLocals(), c.getCode(), c
</pre>
<hr />
<pre>
127     /**
128      * Called by objects that are traversing the nodes of the tree implicitely
129      * defined by the contents of a Java class. I.e., the hierarchy of methods,
130      * fields, attributes, etc. spawns a tree of objects.
131      *
132      * @param v Visitor object
133      */
134     @Override
135     public void accept( final Visitor v ) {
136         v.visitCode(this);
137     }
138 
139 
140     /**
141      * Dump code attribute to file stream in binary format.
142      *
143      * @param file Output file stream
144      * @throws IOException
145      */
146     @Override
<span class="line-modified">147     public final void dump( final DataOutputStream file ) throws IOException {</span>
148         super.dump(file);
149         file.writeShort(max_stack);
150         file.writeShort(max_locals);
151         file.writeInt(code.length);
152         file.write(code, 0, code.length);
153         file.writeShort(exception_table.length);
154         for (final CodeException exception : exception_table) {
155             exception.dump(file);
156         }
157         file.writeShort(attributes.length);
158         for (final Attribute attribute : attributes) {
159             attribute.dump(file);
160         }
161     }
162 
163 
164     /**
165      * @return Collection of code attributes.
166      * @see Attribute
167      */
<span class="line-modified">168     public final Attribute[] getAttributes() {</span>
169         return attributes;
170     }
171 
172 
173     /**
174      * @return LineNumberTable of Code, if it has one
175      */
176     public LineNumberTable getLineNumberTable() {
177         for (final Attribute attribute : attributes) {
178             if (attribute instanceof LineNumberTable) {
179                 return (LineNumberTable) attribute;
180             }
181         }
182         return null;
183     }
184 
185 
186     /**
187      * @return LocalVariableTable of Code, if it has one
188      */
189     public LocalVariableTable getLocalVariableTable() {
190         for (final Attribute attribute : attributes) {
191             if (attribute instanceof LocalVariableTable) {
192                 return (LocalVariableTable) attribute;
193             }
194         }
195         return null;
196     }
197 
198 
199     /**
200      * @return Actual byte code of the method.
201      */
<span class="line-modified">202     public final byte[] getCode() {</span>
203         return code;
204     }
205 
206 
207     /**
208      * @return Table of handled exceptions.
209      * @see CodeException
210      */
<span class="line-modified">211     public final CodeException[] getExceptionTable() {</span>
212         return exception_table;
213     }
214 
215 
216     /**
217      * @return Number of local variables.
218      */
<span class="line-modified">219     public final int getMaxLocals() {</span>
220         return max_locals;
221     }
222 
223 
224     /**
225      * @return Maximum size of stack used by this method.
226      */
<span class="line-modified">227     public final int getMaxStack() {</span>
228         return max_stack;
229     }
230 
231 
232     /**
233      * @return the internal length of this code attribute (minus the first 6 bytes)
234      * and excluding all its attributes
235      */
236     private int getInternalLength() {
237         return 2 /*max_stack*/+ 2 /*max_locals*/+ 4 /*code length*/
238                 + code.length /*byte-code*/
239                 + 2 /*exception-table length*/
240                 + 8 * (exception_table == null ? 0 : exception_table.length) /* exception table */
241                 + 2 /* attributes count */;
242     }
243 
244 
245     /**
246      * @return the full size of this code attribute, minus its first 6 bytes,
247      * including the size of all its contained attributes
248      */
249     private int calculateLength() {
250         int len = 0;
251         if (attributes != null) {
252             for (final Attribute attribute : attributes) {
253                 len += attribute.getLength() + 6 /*attribute header size*/;
254             }
255         }
256         return len + getInternalLength();
257     }
258 
259 
260     /**
261      * @param attributes the attributes to set for this Code
262      */
<span class="line-modified">263     public final void setAttributes( final Attribute[] attributes ) {</span>
264         this.attributes = attributes != null ? attributes : new Attribute[0];
265         super.setLength(calculateLength()); // Adjust length
266     }
267 
268 
269     /**
270      * @param code byte code
271      */
<span class="line-modified">272     public final void setCode( final byte[] code ) {</span>
273         this.code = code != null ? code : new byte[0];
274         super.setLength(calculateLength()); // Adjust length
275     }
276 
277 
278     /**
279      * @param exception_table exception table
280      */
<span class="line-modified">281     public final void setExceptionTable( final CodeException[] exception_table ) {</span>
282         this.exception_table = exception_table != null ? exception_table : new CodeException[0];
283         super.setLength(calculateLength()); // Adjust length
284     }
285 
286 
287     /**
288      * @param max_locals maximum number of local variables
289      */
<span class="line-modified">290     public final void setMaxLocals( final int max_locals ) {</span>
291         this.max_locals = max_locals;
292     }
293 
294 
295     /**
296      * @param max_stack maximum stack size
297      */
<span class="line-modified">298     public final void setMaxStack( final int max_stack ) {</span>
299         this.max_stack = max_stack;
300     }
301 
302 
303     /**
304      * @return String representation of code chunk.
305      */
<span class="line-modified">306     public final String toString( final boolean verbose ) {</span>
307         final StringBuilder buf = new StringBuilder(100); // CHECKSTYLE IGNORE MagicNumber
308         buf.append(&quot;Code(max_stack = &quot;).append(max_stack).append(&quot;, max_locals = &quot;).append(
309                 max_locals).append(&quot;, code_length = &quot;).append(code.length).append(&quot;)\n&quot;).append(
310                 Utility.codeToString(code, super.getConstantPool(), 0, -1, verbose));
311         if (exception_table.length &gt; 0) {
312             buf.append(&quot;\nException handler(s) = \n&quot;).append(&quot;From\tTo\tHandler\tType\n&quot;);
313             for (final CodeException exception : exception_table) {
314                 buf.append(exception.toString(super.getConstantPool(), verbose)).append(&quot;\n&quot;);
315             }
316         }
317         if (attributes.length &gt; 0) {
318             buf.append(&quot;\nAttribute(s) = &quot;);
319             for (final Attribute attribute : attributes) {
320                 buf.append(&quot;\n&quot;).append(attribute);
321             }
322         }
323         return buf.toString();
324     }
325 
326 
327     /**
328      * @return String representation of code chunk.
329      */
330     @Override
<span class="line-modified">331     public final String toString() {</span>
332         return toString(true);
333     }
334 
335 
336     /**
337      * @return deep copy of this attribute
338      *
339      * @param _constant_pool the constant pool to duplicate
340      */
341     @Override
342     public Attribute copy( final ConstantPool _constant_pool ) {
343         final Code c = (Code) clone();
344         if (code != null) {
345             c.code = new byte[code.length];
346             System.arraycopy(code, 0, c.code, 0, code.length);
347         }
348         c.setConstantPool(_constant_pool);
349         c.exception_table = new CodeException[exception_table.length];
350         for (int i = 0; i &lt; exception_table.length; i++) {
351             c.exception_table[i] = exception_table[i].copy();
</pre>
</td>
<td>
<hr />
<pre>
 22 package com.sun.org.apache.bcel.internal.classfile;
 23 
 24 import java.io.DataInput;
 25 import java.io.DataOutputStream;
 26 import java.io.IOException;
 27 
 28 import com.sun.org.apache.bcel.internal.Const;
 29 
 30 /**
 31  * This class represents a chunk of Java byte code contained in a
 32  * method. It is instantiated by the
 33  * &lt;em&gt;Attribute.readAttribute()&lt;/em&gt; method. A &lt;em&gt;Code&lt;/em&gt;
 34  * attribute contains informations about operand stack, local
 35  * variables, byte code and the exceptions handled within this
 36  * method.
 37  *
 38  * This attribute has attributes itself, namely &lt;em&gt;LineNumberTable&lt;/em&gt; which
 39  * is used for debugging purposes and &lt;em&gt;LocalVariableTable&lt;/em&gt; which
 40  * contains information about the local variables.
 41  *

 42  * @see     Attribute
 43  * @see     CodeException
 44  * @see     LineNumberTable
 45  * @see LocalVariableTable
 46  */
 47 public final class Code extends Attribute {
 48 
 49     private int max_stack; // Maximum size of stack used by this method  // TODO this could be made final (setter is not used)
 50     private int max_locals; // Number of local variables  // TODO this could be made final (setter is not used)
 51     private byte[] code; // Actual byte code
 52     private CodeException[] exception_table; // Table of handled exceptions
 53     private Attribute[] attributes; // or LocalVariable
 54 
 55 
 56     /**
 57      * Initialize from another object. Note that both objects use the same
 58      * references (shallow copy). Use copy() for a physical copy.
 59      */
 60     public Code(final Code c) {
 61         this(c.getNameIndex(), c.getLength(), c.getMaxStack(), c.getMaxLocals(), c.getCode(), c
</pre>
<hr />
<pre>
126     /**
127      * Called by objects that are traversing the nodes of the tree implicitely
128      * defined by the contents of a Java class. I.e., the hierarchy of methods,
129      * fields, attributes, etc. spawns a tree of objects.
130      *
131      * @param v Visitor object
132      */
133     @Override
134     public void accept( final Visitor v ) {
135         v.visitCode(this);
136     }
137 
138 
139     /**
140      * Dump code attribute to file stream in binary format.
141      *
142      * @param file Output file stream
143      * @throws IOException
144      */
145     @Override
<span class="line-modified">146     public void dump( final DataOutputStream file ) throws IOException {</span>
147         super.dump(file);
148         file.writeShort(max_stack);
149         file.writeShort(max_locals);
150         file.writeInt(code.length);
151         file.write(code, 0, code.length);
152         file.writeShort(exception_table.length);
153         for (final CodeException exception : exception_table) {
154             exception.dump(file);
155         }
156         file.writeShort(attributes.length);
157         for (final Attribute attribute : attributes) {
158             attribute.dump(file);
159         }
160     }
161 
162 
163     /**
164      * @return Collection of code attributes.
165      * @see Attribute
166      */
<span class="line-modified">167     public Attribute[] getAttributes() {</span>
168         return attributes;
169     }
170 
171 
172     /**
173      * @return LineNumberTable of Code, if it has one
174      */
175     public LineNumberTable getLineNumberTable() {
176         for (final Attribute attribute : attributes) {
177             if (attribute instanceof LineNumberTable) {
178                 return (LineNumberTable) attribute;
179             }
180         }
181         return null;
182     }
183 
184 
185     /**
186      * @return LocalVariableTable of Code, if it has one
187      */
188     public LocalVariableTable getLocalVariableTable() {
189         for (final Attribute attribute : attributes) {
190             if (attribute instanceof LocalVariableTable) {
191                 return (LocalVariableTable) attribute;
192             }
193         }
194         return null;
195     }
196 
197 
198     /**
199      * @return Actual byte code of the method.
200      */
<span class="line-modified">201     public byte[] getCode() {</span>
202         return code;
203     }
204 
205 
206     /**
207      * @return Table of handled exceptions.
208      * @see CodeException
209      */
<span class="line-modified">210     public CodeException[] getExceptionTable() {</span>
211         return exception_table;
212     }
213 
214 
215     /**
216      * @return Number of local variables.
217      */
<span class="line-modified">218     public int getMaxLocals() {</span>
219         return max_locals;
220     }
221 
222 
223     /**
224      * @return Maximum size of stack used by this method.
225      */
<span class="line-modified">226     public int getMaxStack() {</span>
227         return max_stack;
228     }
229 
230 
231     /**
232      * @return the internal length of this code attribute (minus the first 6 bytes)
233      * and excluding all its attributes
234      */
235     private int getInternalLength() {
236         return 2 /*max_stack*/+ 2 /*max_locals*/+ 4 /*code length*/
237                 + code.length /*byte-code*/
238                 + 2 /*exception-table length*/
239                 + 8 * (exception_table == null ? 0 : exception_table.length) /* exception table */
240                 + 2 /* attributes count */;
241     }
242 
243 
244     /**
245      * @return the full size of this code attribute, minus its first 6 bytes,
246      * including the size of all its contained attributes
247      */
248     private int calculateLength() {
249         int len = 0;
250         if (attributes != null) {
251             for (final Attribute attribute : attributes) {
252                 len += attribute.getLength() + 6 /*attribute header size*/;
253             }
254         }
255         return len + getInternalLength();
256     }
257 
258 
259     /**
260      * @param attributes the attributes to set for this Code
261      */
<span class="line-modified">262     public void setAttributes( final Attribute[] attributes ) {</span>
263         this.attributes = attributes != null ? attributes : new Attribute[0];
264         super.setLength(calculateLength()); // Adjust length
265     }
266 
267 
268     /**
269      * @param code byte code
270      */
<span class="line-modified">271     public void setCode( final byte[] code ) {</span>
272         this.code = code != null ? code : new byte[0];
273         super.setLength(calculateLength()); // Adjust length
274     }
275 
276 
277     /**
278      * @param exception_table exception table
279      */
<span class="line-modified">280     public void setExceptionTable( final CodeException[] exception_table ) {</span>
281         this.exception_table = exception_table != null ? exception_table : new CodeException[0];
282         super.setLength(calculateLength()); // Adjust length
283     }
284 
285 
286     /**
287      * @param max_locals maximum number of local variables
288      */
<span class="line-modified">289     public void setMaxLocals( final int max_locals ) {</span>
290         this.max_locals = max_locals;
291     }
292 
293 
294     /**
295      * @param max_stack maximum stack size
296      */
<span class="line-modified">297     public void setMaxStack( final int max_stack ) {</span>
298         this.max_stack = max_stack;
299     }
300 
301 
302     /**
303      * @return String representation of code chunk.
304      */
<span class="line-modified">305     public String toString( final boolean verbose ) {</span>
306         final StringBuilder buf = new StringBuilder(100); // CHECKSTYLE IGNORE MagicNumber
307         buf.append(&quot;Code(max_stack = &quot;).append(max_stack).append(&quot;, max_locals = &quot;).append(
308                 max_locals).append(&quot;, code_length = &quot;).append(code.length).append(&quot;)\n&quot;).append(
309                 Utility.codeToString(code, super.getConstantPool(), 0, -1, verbose));
310         if (exception_table.length &gt; 0) {
311             buf.append(&quot;\nException handler(s) = \n&quot;).append(&quot;From\tTo\tHandler\tType\n&quot;);
312             for (final CodeException exception : exception_table) {
313                 buf.append(exception.toString(super.getConstantPool(), verbose)).append(&quot;\n&quot;);
314             }
315         }
316         if (attributes.length &gt; 0) {
317             buf.append(&quot;\nAttribute(s) = &quot;);
318             for (final Attribute attribute : attributes) {
319                 buf.append(&quot;\n&quot;).append(attribute);
320             }
321         }
322         return buf.toString();
323     }
324 
325 
326     /**
327      * @return String representation of code chunk.
328      */
329     @Override
<span class="line-modified">330     public String toString() {</span>
331         return toString(true);
332     }
333 
334 
335     /**
336      * @return deep copy of this attribute
337      *
338      * @param _constant_pool the constant pool to duplicate
339      */
340     @Override
341     public Attribute copy( final ConstantPool _constant_pool ) {
342         final Code c = (Code) clone();
343         if (code != null) {
344             c.code = new byte[code.length];
345             System.arraycopy(code, 0, c.code, 0, code.length);
346         }
347         c.setConstantPool(_constant_pool);
348         c.exception_table = new CodeException[exception_table.length];
349         for (int i = 0; i &lt; exception_table.length; i++) {
350             c.exception_table[i] = exception_table[i].copy();
</pre>
</td>
</tr>
</table>
<center><a href="ClassParser.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="CodeException.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>