<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/LocalVariableTable.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /*
  6  * Licensed to the Apache Software Foundation (ASF) under one or more
  7  * contributor license agreements.  See the NOTICE file distributed with
  8  * this work for additional information regarding copyright ownership.
  9  * The ASF licenses this file to You under the Apache License, Version 2.0
 10  * (the &quot;License&quot;); you may not use this file except in compliance with
 11  * the License.  You may obtain a copy of the License at
 12  *
 13  *      http://www.apache.org/licenses/LICENSE-2.0
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.bcel.internal.classfile;
 23 
 24 import java.io.DataInput;
 25 import java.io.DataOutputStream;
 26 import java.io.IOException;
 27 
 28 import com.sun.org.apache.bcel.internal.Const;
 29 
 30 /**
 31  * This class represents colection of local variables in a
 32  * method. This attribute is contained in the &lt;em&gt;Code&lt;/em&gt; attribute.
 33  *
<a name="1" id="anc1"></a>
 34  * @see     Code
 35  * @see LocalVariable
 36  */
 37 public class LocalVariableTable extends Attribute {
 38 
 39     private LocalVariable[] local_variable_table; // variables
 40 
 41 
 42     /**
 43      * Initialize from another object. Note that both objects use the same
 44      * references (shallow copy). Use copy() for a physical copy.
 45      */
 46     public LocalVariableTable(final LocalVariableTable c) {
 47         this(c.getNameIndex(), c.getLength(), c.getLocalVariableTable(), c.getConstantPool());
 48     }
 49 
 50 
 51     /**
 52      * @param name_index Index in constant pool to `LocalVariableTable&#39;
 53      * @param length Content length in bytes
 54      * @param local_variable_table Table of local variables
 55      * @param constant_pool Array of constants
 56      */
 57     public LocalVariableTable(final int name_index, final int length, final LocalVariable[] local_variable_table,
 58             final ConstantPool constant_pool) {
 59         super(Const.ATTR_LOCAL_VARIABLE_TABLE, name_index, length, constant_pool);
 60         this.local_variable_table = local_variable_table;
 61     }
 62 
 63 
 64     /**
 65      * Construct object from input stream.
 66      * @param name_index Index in constant pool
 67      * @param length Content length in bytes
 68      * @param input Input stream
 69      * @param constant_pool Array of constants
 70      * @throws IOException
 71      */
 72     LocalVariableTable(final int name_index, final int length, final DataInput input, final ConstantPool constant_pool)
 73             throws IOException {
 74         this(name_index, length, (LocalVariable[]) null, constant_pool);
 75         final int local_variable_table_length = input.readUnsignedShort();
 76         local_variable_table = new LocalVariable[local_variable_table_length];
 77         for (int i = 0; i &lt; local_variable_table_length; i++) {
 78             local_variable_table[i] = new LocalVariable(input, constant_pool);
 79         }
 80     }
 81 
 82 
 83     /**
 84      * Called by objects that are traversing the nodes of the tree implicitely
 85      * defined by the contents of a Java class. I.e., the hierarchy of methods,
 86      * fields, attributes, etc. spawns a tree of objects.
 87      *
 88      * @param v Visitor object
 89      */
 90     @Override
 91     public void accept( final Visitor v ) {
 92         v.visitLocalVariableTable(this);
 93     }
 94 
 95 
 96     /**
 97      * Dump local variable table attribute to file stream in binary format.
 98      *
 99      * @param file Output file stream
100      * @throws IOException
101      */
102     @Override
103     public final void dump( final DataOutputStream file ) throws IOException {
104         super.dump(file);
105         file.writeShort(local_variable_table.length);
106         for (final LocalVariable variable : local_variable_table) {
107             variable.dump(file);
108         }
109     }
110 
111 
112     /**
113      * @return Array of local variables of method.
114      */
115     public final LocalVariable[] getLocalVariableTable() {
116         return local_variable_table;
117     }
118 
119 
120     /**
121      *
122      * @param index the variable slot
123      *
124      * @return the first LocalVariable that matches the slot or null if not found
125      *
126      * @deprecated since 5.2 because multiple variables can share the
127      *             same slot, use getLocalVariable(int index, int pc) instead.
128      */
129     @java.lang.Deprecated
130     public final LocalVariable getLocalVariable( final int index ) {
131         for (final LocalVariable variable : local_variable_table) {
132             if (variable.getIndex() == index) {
133                 return variable;
134             }
135         }
136         return null;
137     }
138 
139 
140     /**
141      *
142      * @param index the variable slot
143      * @param pc the current pc that this variable is alive
144      *
145      * @return the LocalVariable that matches or null if not found
146      */
147     public final LocalVariable getLocalVariable( final int index, final int pc ) {
148         for (final LocalVariable variable : local_variable_table) {
149             if (variable.getIndex() == index) {
150                 final int start_pc = variable.getStartPC();
151                 final int end_pc = start_pc + variable.getLength();
152                 if ((pc &gt;= start_pc) &amp;&amp; (pc &lt;= end_pc)) {
153                     return variable;
154                 }
155             }
156         }
157         return null;
158     }
159 
160 
161     public final void setLocalVariableTable( final LocalVariable[] local_variable_table ) {
162         this.local_variable_table = local_variable_table;
163     }
164 
165 
166     /**
167      * @return String representation.
168      */
169     @Override
170     public final String toString() {
171         final StringBuilder buf = new StringBuilder();
172         for (int i = 0; i &lt; local_variable_table.length; i++) {
173             buf.append(local_variable_table[i]);
174             if (i &lt; local_variable_table.length - 1) {
175                 buf.append(&#39;\n&#39;);
176             }
177         }
178         return buf.toString();
179     }
180 
181 
182     /**
183      * @return deep copy of this attribute
184      */
185     @Override
186     public Attribute copy( final ConstantPool _constant_pool ) {
187         final LocalVariableTable c = (LocalVariableTable) clone();
188         c.local_variable_table = new LocalVariable[local_variable_table.length];
189         for (int i = 0; i &lt; local_variable_table.length; i++) {
190             c.local_variable_table[i] = local_variable_table[i].copy();
191         }
192         c.setConstantPool(_constant_pool);
193         return c;
194     }
195 
196 
197     public final int getTableLength() {
198         return local_variable_table == null ? 0 : local_variable_table.length;
199     }
200 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>