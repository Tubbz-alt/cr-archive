<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/LocalVariable.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.bcel.internal.classfile;
 22 
 23 import java.io.DataInput;
 24 import java.io.DataOutputStream;
 25 import java.io.IOException;
 26 
 27 import com.sun.org.apache.bcel.internal.Const;
 28 
 29 /**
 30  * This class represents a local variable within a method. It contains its
 31  * scope, name, signature and index on the method&#39;s frame.  It is used both
 32  * to represent an element of the LocalVariableTable as well as an element
 33  * of the LocalVariableTypeTable.  The nomenclature used here may be a bit confusing;
 34  * while the two items have the same layout in a class file, a LocalVariableTable
 35  * attribute contains a descriptor_index, not a signature_index.  The
 36  * LocalVariableTypeTable attribute does have a signature_index.
 37  * @see com.sun.org.apache.bcel.internal.classfile.Utility for more details on the difference.
 38  *
 39  * @see     LocalVariableTable
 40  * @see     LocalVariableTypeTable
 41  * @LastModified: Jan 2020
 42  */
 43 public final class LocalVariable implements Cloneable, Node {
 44 
 45     private int start_pc; // Range in which the variable is valid
 46     private int length;
 47     private int name_index; // Index in constant pool of variable name
 48     // Technically, a decscriptor_index for a local variable table entry
 49     // and a signature_index for a local variable type table entry.
 50     private int signature_index; // Index of variable signature
 51     private int index; /* Variable is index&#39;th local variable on
 52      * this method&#39;s frame.
 53      */
 54     private ConstantPool constant_pool;
 55     private int orig_index; // never changes; used to match up with LocalVariableTypeTable entries
 56 
 57 
 58     /**
 59      * Initializes from another LocalVariable. Note that both objects use the same
 60      * references (shallow copy). Use copy() for a physical copy.
 61      *
 62      * @param localVariable Another LocalVariable.
 63      */
 64     public LocalVariable(final LocalVariable localVariable) {
 65         this(localVariable.getStartPC(), localVariable.getLength(), localVariable.getNameIndex(),
 66                 localVariable.getSignatureIndex(), localVariable.getIndex(), localVariable.getConstantPool());
 67         this.orig_index = localVariable.getOrigIndex();
 68     }
 69 
 70     /**
 71      * Constructs object from file stream.
 72      * @param file Input stream
 73      * @throws IOException
 74      */
 75     LocalVariable(final DataInput file, final ConstantPool constant_pool) throws IOException {
 76         this(file.readUnsignedShort(), file.readUnsignedShort(), file.readUnsignedShort(), file
 77                 .readUnsignedShort(), file.readUnsignedShort(), constant_pool);
 78     }
 79 
 80 
 81     /**
 82      * @param start_pc Range in which the variable
 83      * @param length ... is valid
 84      * @param name_index Index in constant pool of variable name
 85      * @param signature_index Index of variable&#39;s signature
 86      * @param index Variable is `index&#39;th local variable on the method&#39;s frame
 87      * @param constant_pool Array of constants
 88      */
 89     public LocalVariable(final int start_pc, final int length, final int name_index, final int signature_index, final int index,
 90             final ConstantPool constant_pool) {
 91         this.start_pc = start_pc;
 92         this.length = length;
 93         this.name_index = name_index;
 94         this.signature_index = signature_index;
 95         this.index = index;
 96         this.constant_pool = constant_pool;
 97         this.orig_index = index;
 98     }
 99 
100 
101     /**
102      * @param start_pc Range in which the variable
103      * @param length ... is valid
104      * @param name_index Index in constant pool of variable name
105      * @param signature_index Index of variable&#39;s signature
106      * @param index Variable is `index&#39;th local variable on the method&#39;s frame
107      * @param constant_pool Array of constants
108      * @param orig_index Variable is `index&#39;th local variable on the method&#39;s frame prior to any changes
109      */
110     public LocalVariable(final int start_pc, final int length, final int name_index, final int signature_index, final int index,
111             final ConstantPool constant_pool, final int orig_index) {
112         this.start_pc = start_pc;
113         this.length = length;
114         this.name_index = name_index;
115         this.signature_index = signature_index;
116         this.index = index;
117         this.constant_pool = constant_pool;
118         this.orig_index = orig_index;
119     }
120 
121 
122     /**
123      * Called by objects that are traversing the nodes of the tree implicitely
124      * defined by the contents of a Java class. I.e., the hierarchy of methods,
125      * fields, attributes, etc. spawns a tree of objects.
126      *
127      * @param v Visitor object
128      */
129     @Override
130     public void accept( final Visitor v ) {
131         v.visitLocalVariable(this);
132     }
133 
134 
135     /**
136      * Dumps local variable to file stream in binary format.
137      *
138      * @param dataOutputStream Output file stream
139      * @exception IOException if an I/O error occurs.
140      * @see java.io.FilterOutputStream#out
141      */
142     public void dump(final DataOutputStream dataOutputStream) throws IOException {
143         dataOutputStream.writeShort(start_pc);
144         dataOutputStream.writeShort(length);
145         dataOutputStream.writeShort(name_index);
146         dataOutputStream.writeShort(signature_index);
147         dataOutputStream.writeShort(index);
148     }
149 
150     /**
151      * @return Constant pool used by this object.
152      */
153     public ConstantPool getConstantPool() {
154         return constant_pool;
155     }
156 
157 
158     /**
159      * @return Variable is valid within getStartPC() .. getStartPC()+getLength()
160      */
161     public int getLength() {
162         return length;
163     }
164 
165 
166     /**
167      * @return Variable name.
168      */
169     public String getName() {
170         ConstantUtf8 c;
171         c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);
172         return c.getBytes();
173     }
174 
175 
176     /**
177      * @return Index in constant pool of variable name.
178      */
179     public int getNameIndex() {
180         return name_index;
181     }
182 
183 
184     /**
185      * @return Signature.
186      */
187     public String getSignature() {
188         ConstantUtf8 c;
189         c = (ConstantUtf8) constant_pool.getConstant(signature_index, Const.CONSTANT_Utf8);
190         return c.getBytes();
191     }
192 
193 
194     /**
195      * @return Index in constant pool of variable signature.
196      */
197     public int getSignatureIndex() {
198         return signature_index;
199     }
200 
201 
202     /**
203      * @return index of register where variable is stored
204      */
205     public int getIndex() {
206         return index;
207     }
208 
209 
210     /**
211      * @return index of register where variable was originally stored
212      */
213     public int getOrigIndex() {
214         return orig_index;
215     }
216 
217 
218     /**
219      * @return Start of range where the variable is valid
220      */
221     public int getStartPC() {
222         return start_pc;
223     }
224 
225 
226     /*
227      * Helper method shared with LocalVariableTypeTable
228      */
229     String toStringShared( final boolean typeTable ) {
230         final String name = getName();
231         final String signature = Utility.signatureToString(getSignature(), false);
232         final String label = &quot;LocalVariable&quot; + (typeTable ? &quot;Types&quot; : &quot;&quot; );
233         return label + &quot;(start_pc = &quot; + start_pc + &quot;, length = &quot; + length + &quot;, index = &quot;
234                 + index + &quot;:&quot; + signature + &quot; &quot; + name + &quot;)&quot;;
235     }
236 
237 
238     /**
239      * @param constant_pool Constant pool to be used for this object.
240      */
241     public void setConstantPool( final ConstantPool constant_pool ) {
242         this.constant_pool = constant_pool;
243     }
244 
245 
246     /**
247      * @param length the length of this local variable
248      */
249     public void setLength( final int length ) {
250         this.length = length;
251     }
252 
253 
254     /**
255      * @param name_index the index into the constant pool for the name of this variable
256      */
257     public void setNameIndex( final int name_index ) { // TODO unused
258         this.name_index = name_index;
259     }
260 
261 
262     /**
263      * @param signature_index the index into the constant pool for the signature of this variable
264      */
265     public void setSignatureIndex( final int signature_index ) { // TODO unused
266         this.signature_index = signature_index;
267     }
268 
269 
270     /**
271      * @param index the index in the local variable table of this variable
272      */
273     public void setIndex( final int index ) { // TODO unused
274         this.index = index;
275     }
276 
277 
278     /**
279      * @param start_pc Specify range where the local variable is valid.
280      */
281     public void setStartPC( final int start_pc ) { // TODO unused
282         this.start_pc = start_pc;
283     }
284 
285 
286     /**
287      * @return string representation.
288      */
289     @Override
290     public String toString() {
291         return toStringShared(false);
292     }
293 
294 
295     /**
296      * @return deep copy of this object
297      */
298     public LocalVariable copy() {
299         try {
300             return (LocalVariable) clone();
301         } catch (final CloneNotSupportedException e) {
302             // TODO should this throw?
303         }
304         return null;
305     }
306 }
    </pre>
  </body>
</html>