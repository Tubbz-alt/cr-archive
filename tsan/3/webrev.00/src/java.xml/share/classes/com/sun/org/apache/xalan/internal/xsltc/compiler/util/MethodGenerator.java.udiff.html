<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../XSLTC.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../dom/NodeSortRecord.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/compiler/util/MethodGenerator.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   */
  /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -73,11 +73,11 @@</span>
  import java.util.Stack;
  
  /**
   * @author Jacek Ambroziak
   * @author Santiago Pericas-Geertsen
<span class="udiff-line-modified-removed">-  * @LastModified: Nov 2017</span>
<span class="udiff-line-modified-added">+  * @LastModified: July 2019</span>
   */
  public class MethodGenerator extends MethodGen
      implements com.sun.org.apache.xalan.internal.xsltc.compiler.Constants {
      protected static final int INVALID_INDEX   = -1;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -205,11 +205,11 @@</span>
  
          index = cpg.addInterfaceMethodref(NODE_ITERATOR, NEXT, NEXT_SIG);
          _nextNode = new INVOKEINTERFACE(index, 1);
  
          _slotAllocator = new SlotAllocator();
<span class="udiff-line-modified-removed">-         _slotAllocator.initialize(getLocalVariableRegistry().getLocals(false));</span>
<span class="udiff-line-modified-added">+         _slotAllocator.initialize(getLocalVariableRegistry().getLocals());</span>
          _allocatorInit = true;
      }
  
      /**
       * Allocates a local variable. If the slot allocator has already been
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -443,11 +443,11 @@</span>
                          sameNameList.remove(i);
                          break;
                      }
                  }
              } else {
<span class="udiff-line-modified-removed">-                 _nameToLVGMap.remove(lvg);</span>
<span class="udiff-line-modified-added">+                 _nameToLVGMap.remove(lvg.getName());</span>
              }
          }
  
          /**
           * &lt;p&gt;Given the name of a variable, finds a {@link LocalVariableGen}
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -478,59 +478,35 @@</span>
  
              return lvg;
          }
  
          /**
<span class="udiff-line-modified-removed">-          * &lt;p&gt;Gets all {@link LocalVariableGen} objects for this method.&lt;/p&gt;</span>
<span class="udiff-line-modified-removed">-          * &lt;p&gt;When the &lt;code&gt;includeRemoved&lt;/code&gt; argument has the value</span>
<span class="udiff-line-removed">-          * &lt;code&gt;false&lt;/code&gt;, this method replaces uses of</span>
<span class="udiff-line-removed">-          * {@link MethodGen#getLocalVariables()} which has</span>
<span class="udiff-line-modified-added">+          * Gets all {@link LocalVariableGen} objects.</span>
<span class="udiff-line-modified-added">+          * This method replaces {@link MethodGen#getLocalVariables()} which has</span>
           * a side-effect of setting the start and end range for any
<span class="udiff-line-modified-removed">-          * &lt;code&gt;LocalVariableGen&lt;/code&gt; if either was &lt;code&gt;null&lt;/code&gt;.  That</span>
<span class="udiff-line-modified-added">+          * {@code LocalVariableGen} if either was {@code null}.  That</span>
           * side-effect causes problems for outlining of code in XSLTC.
<span class="udiff-line-modified-removed">-          * @param includeRemoved Specifies whether all local variables ever</span>
<span class="udiff-line-modified-removed">-          * declared should be returned (&lt;code&gt;true&lt;/code&gt;) or only those not</span>
<span class="udiff-line-removed">-          * removed (&lt;code&gt;false&lt;/code&gt;)</span>
<span class="udiff-line-removed">-          * @return an array of &lt;code&gt;LocalVariableGen&lt;/code&gt; containing all the</span>
<span class="udiff-line-modified-added">+          *</span>
<span class="udiff-line-modified-added">+          * @return an array of {@code LocalVariableGen} containing all the</span>
           * local variables
           */
          @SuppressWarnings(&quot;unchecked&quot;)
<span class="udiff-line-modified-removed">-         protected LocalVariableGen[] getLocals(boolean includeRemoved) {</span>
<span class="udiff-line-modified-added">+         private LocalVariableGen[] getLocals() {</span>
              LocalVariableGen[] locals = null;
              List&lt;LocalVariableGen&gt; allVarsEverDeclared = new ArrayList&lt;&gt;();
  
<span class="udiff-line-modified-removed">-             if (includeRemoved) {</span>
<span class="udiff-line-modified-removed">-                 int slotCount = allVarsEverDeclared.size();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-                 for (int i = 0; i &lt; slotCount; i++) {</span>
<span class="udiff-line-modified-removed">-                     Object slotEntries = _variables.get(i);</span>
<span class="udiff-line-modified-removed">-                     if (slotEntries != null) {</span>
<span class="udiff-line-modified-removed">-                         if (slotEntries instanceof ArrayList) {</span>
<span class="udiff-line-modified-removed">-                             List&lt;LocalVariableGen&gt; slotList =</span>
<span class="udiff-line-removed">-                                     (List&lt;LocalVariableGen&gt;)slotEntries;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-                             for (int j = 0; j &lt; slotList.size(); j++) {</span>
<span class="udiff-line-removed">-                                 allVarsEverDeclared.add(slotList.get(i));</span>
<span class="udiff-line-removed">-                             }</span>
<span class="udiff-line-removed">-                         } else {</span>
<span class="udiff-line-removed">-                             allVarsEverDeclared.add((LocalVariableGen)slotEntries);</span>
<span class="udiff-line-removed">-                         }</span>
<span class="udiff-line-removed">-                     }</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-             } else {</span>
<span class="udiff-line-removed">-                 for (Map.Entry&lt;String, Object&gt; nameVarsPair : _nameToLVGMap.entrySet()) {</span>
<span class="udiff-line-removed">-                     Object vars = nameVarsPair.getValue();</span>
<span class="udiff-line-removed">-                     if (vars != null) {</span>
<span class="udiff-line-removed">-                         if (vars instanceof ArrayList) {</span>
<span class="udiff-line-removed">-                             List&lt;LocalVariableGen&gt; varsList =</span>
<span class="udiff-line-removed">-                                     (List&lt;LocalVariableGen&gt;) vars;</span>
<span class="udiff-line-removed">-                             for (int i = 0; i &lt; varsList.size(); i++) {</span>
<span class="udiff-line-removed">-                                 allVarsEverDeclared.add(varsList.get(i));</span>
<span class="udiff-line-removed">-                             }</span>
<span class="udiff-line-removed">-                         } else {</span>
<span class="udiff-line-removed">-                             allVarsEverDeclared.add((LocalVariableGen)vars);</span>
<span class="udiff-line-modified-added">+             for (Map.Entry&lt;String, Object&gt; nameVarsPair : _nameToLVGMap.entrySet()) {</span>
<span class="udiff-line-modified-added">+                 Object vars = nameVarsPair.getValue();</span>
<span class="udiff-line-modified-added">+                 if (vars != null) {</span>
<span class="udiff-line-modified-added">+                     if (vars instanceof ArrayList) {</span>
<span class="udiff-line-modified-added">+                         List&lt;LocalVariableGen&gt; varsList =</span>
<span class="udiff-line-modified-added">+                                 (List&lt;LocalVariableGen&gt;) vars;</span>
<span class="udiff-line-modified-added">+                         for (int i = 0; i &lt; varsList.size(); i++) {</span>
<span class="udiff-line-modified-added">+                             allVarsEverDeclared.add(varsList.get(i));</span>
                          }
<span class="udiff-line-added">+                     } else {</span>
<span class="udiff-line-added">+                         allVarsEverDeclared.add((LocalVariableGen)vars);</span>
                      }
                  }
              }
  
              locals = new LocalVariableGen[allVarsEverDeclared.size()];
</pre>
<center><a href="../XSLTC.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../dom/NodeSortRecord.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>