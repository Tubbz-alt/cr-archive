<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml/share/classes/com/sun/org/apache/bcel/internal/util/AttributeHTML.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /*
  6  * Licensed to the Apache Software Foundation (ASF) under one or more
  7  * contributor license agreements.  See the NOTICE file distributed with
  8  * this work for additional information regarding copyright ownership.
  9  * The ASF licenses this file to You under the Apache License, Version 2.0
 10  * (the &quot;License&quot;); you may not use this file except in compliance with
 11  * the License.  You may obtain a copy of the License at
 12  *
 13  *      http://www.apache.org/licenses/LICENSE-2.0
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.bcel.internal.util;
 23 
 24 import java.io.FileOutputStream;
 25 import java.io.IOException;
 26 import java.io.PrintWriter;
 27 
 28 import com.sun.org.apache.bcel.internal.Const;
 29 import com.sun.org.apache.bcel.internal.classfile.Attribute;
 30 import com.sun.org.apache.bcel.internal.classfile.Code;
 31 import com.sun.org.apache.bcel.internal.classfile.CodeException;
 32 import com.sun.org.apache.bcel.internal.classfile.ConstantPool;
 33 import com.sun.org.apache.bcel.internal.classfile.ConstantUtf8;
 34 import com.sun.org.apache.bcel.internal.classfile.ConstantValue;
 35 import com.sun.org.apache.bcel.internal.classfile.ExceptionTable;
 36 import com.sun.org.apache.bcel.internal.classfile.InnerClass;
 37 import com.sun.org.apache.bcel.internal.classfile.InnerClasses;
 38 import com.sun.org.apache.bcel.internal.classfile.LineNumber;
 39 import com.sun.org.apache.bcel.internal.classfile.LineNumberTable;
 40 import com.sun.org.apache.bcel.internal.classfile.LocalVariable;
 41 import com.sun.org.apache.bcel.internal.classfile.LocalVariableTable;
 42 import com.sun.org.apache.bcel.internal.classfile.SourceFile;
 43 import com.sun.org.apache.bcel.internal.classfile.Utility;
 44 
 45 /**
 46  * Convert found attributes into HTML file.
 47  *
<a name="1" id="anc1"></a>
 48  *
 49  */
 50 final class AttributeHTML {
 51 
 52     private final String class_name; // name of current class
 53     private final PrintWriter file; // file to write to
 54     private int attr_count = 0;
 55     private final ConstantHTML constant_html;
 56     private final ConstantPool constant_pool;
 57 
 58 
 59     AttributeHTML(final String dir, final String class_name, final ConstantPool constant_pool,
 60             final ConstantHTML constant_html) throws IOException {
 61         this.class_name = class_name;
 62         this.constant_pool = constant_pool;
 63         this.constant_html = constant_html;
 64         file = new PrintWriter(new FileOutputStream(dir + class_name + &quot;_attributes.html&quot;));
 65         file.println(&quot;&lt;HTML&gt;&lt;BODY BGCOLOR=\&quot;#C0C0C0\&quot;&gt;&lt;TABLE BORDER=0&gt;&quot;);
 66     }
 67 
 68 
 69     private String codeLink( final int link, final int method_number ) {
 70         return &quot;&lt;A HREF=\&quot;&quot; + class_name + &quot;_code.html#code&quot; + method_number + &quot;@&quot; + link
 71                 + &quot;\&quot; TARGET=Code&gt;&quot; + link + &quot;&lt;/A&gt;&quot;;
 72     }
 73 
 74 
<a name="2" id="anc2"></a><span class="line-modified"> 75     void close() {</span>
 76         file.println(&quot;&lt;/TABLE&gt;&lt;/BODY&gt;&lt;/HTML&gt;&quot;);
 77         file.close();
 78     }
 79 
 80 
<a name="3" id="anc3"></a><span class="line-modified"> 81     void writeAttribute( final Attribute attribute, final String anchor ) {</span>
 82         writeAttribute(attribute, anchor, 0);
 83     }
 84 
 85 
<a name="4" id="anc4"></a><span class="line-modified"> 86     void writeAttribute( final Attribute attribute, final String anchor, final int method_number ) {</span>
 87         final byte tag = attribute.getTag();
 88         int index;
 89         if (tag == Const.ATTR_UNKNOWN) {
 90             return;
 91         }
 92         attr_count++; // Increment number of attributes found so far
 93         if (attr_count % 2 == 0) {
 94             file.print(&quot;&lt;TR BGCOLOR=\&quot;#C0C0C0\&quot;&gt;&lt;TD&gt;&quot;);
 95         } else {
 96             file.print(&quot;&lt;TR BGCOLOR=\&quot;#A0A0A0\&quot;&gt;&lt;TD&gt;&quot;);
 97         }
 98         file.println(&quot;&lt;H4&gt;&lt;A NAME=\&quot;&quot; + anchor + &quot;\&quot;&gt;&quot; + attr_count + &quot; &quot; + Const.getAttributeName(tag)
 99                 + &quot;&lt;/A&gt;&lt;/H4&gt;&quot;);
100         /* Handle different attributes
101          */
102         switch (tag) {
103             case Const.ATTR_CODE:
104                 final Code c = (Code) attribute;
105                 // Some directly printable values
106                 file.print(&quot;&lt;UL&gt;&lt;LI&gt;Maximum stack size = &quot; + c.getMaxStack()
107                         + &quot;&lt;/LI&gt;\n&lt;LI&gt;Number of local variables = &quot; + c.getMaxLocals()
108                         + &quot;&lt;/LI&gt;\n&lt;LI&gt;&lt;A HREF=\&quot;&quot; + class_name + &quot;_code.html#method&quot;
109                         + method_number + &quot;\&quot; TARGET=Code&gt;Byte code&lt;/A&gt;&lt;/LI&gt;&lt;/UL&gt;\n&quot;);
110                 // Get handled exceptions and list them
111                 final CodeException[] ce = c.getExceptionTable();
112                 final int len = ce.length;
113                 if (len &gt; 0) {
114                     file.print(&quot;&lt;P&gt;&lt;B&gt;Exceptions handled&lt;/B&gt;&lt;UL&gt;&quot;);
115                     for (final CodeException cex : ce) {
116                         final int catch_type = cex.getCatchType(); // Index in constant pool
117                         file.print(&quot;&lt;LI&gt;&quot;);
118                         if (catch_type != 0) {
119                             file.print(constant_html.referenceConstant(catch_type)); // Create Link to _cp.html
120                         } else {
121                             file.print(&quot;Any Exception&quot;);
122                         }
123                         file.print(&quot;&lt;BR&gt;(Ranging from lines &quot;
124                                 + codeLink(cex.getStartPC(), method_number) + &quot; to &quot;
125                                 + codeLink(cex.getEndPC(), method_number) + &quot;, handled at line &quot;
126                                 + codeLink(cex.getHandlerPC(), method_number) + &quot;)&lt;/LI&gt;&quot;);
127                     }
128                     file.print(&quot;&lt;/UL&gt;&quot;);
129                 }
130                 break;
131             case Const.ATTR_CONSTANT_VALUE:
132                 index = ((ConstantValue) attribute).getConstantValueIndex();
133                 // Reference _cp.html
134                 file.print(&quot;&lt;UL&gt;&lt;LI&gt;&lt;A HREF=\&quot;&quot; + class_name + &quot;_cp.html#cp&quot; + index
135                         + &quot;\&quot; TARGET=\&quot;ConstantPool\&quot;&gt;Constant value index(&quot; + index
136                         + &quot;)&lt;/A&gt;&lt;/UL&gt;\n&quot;);
137                 break;
138             case Const.ATTR_SOURCE_FILE:
139                 index = ((SourceFile) attribute).getSourceFileIndex();
140                 // Reference _cp.html
141                 file.print(&quot;&lt;UL&gt;&lt;LI&gt;&lt;A HREF=\&quot;&quot; + class_name + &quot;_cp.html#cp&quot; + index
142                         + &quot;\&quot; TARGET=\&quot;ConstantPool\&quot;&gt;Source file index(&quot; + index + &quot;)&lt;/A&gt;&lt;/UL&gt;\n&quot;);
143                 break;
144             case Const.ATTR_EXCEPTIONS:
145                 // List thrown exceptions
146                 final int[] indices = ((ExceptionTable) attribute).getExceptionIndexTable();
147                 file.print(&quot;&lt;UL&gt;&quot;);
148                 for (final int indice : indices) {
149                     file.print(&quot;&lt;LI&gt;&lt;A HREF=\&quot;&quot; + class_name + &quot;_cp.html#cp&quot; + indice
150                             + &quot;\&quot; TARGET=\&quot;ConstantPool\&quot;&gt;Exception class index(&quot; + indice
151                             + &quot;)&lt;/A&gt;\n&quot;);
152                 }
153                 file.print(&quot;&lt;/UL&gt;\n&quot;);
154                 break;
155             case Const.ATTR_LINE_NUMBER_TABLE:
156                 final LineNumber[] line_numbers = ((LineNumberTable) attribute).getLineNumberTable();
157                 // List line number pairs
158                 file.print(&quot;&lt;P&gt;&quot;);
159                 for (int i = 0; i &lt; line_numbers.length; i++) {
160                     file.print(&quot;(&quot; + line_numbers[i].getStartPC() + &quot;,&amp;nbsp;&quot;
161                             + line_numbers[i].getLineNumber() + &quot;)&quot;);
162                     if (i &lt; line_numbers.length - 1) {
163                         file.print(&quot;, &quot;); // breakable
164                     }
165                 }
166                 break;
167             case Const.ATTR_LOCAL_VARIABLE_TABLE:
168                 final LocalVariable[] vars = ((LocalVariableTable) attribute).getLocalVariableTable();
169                 // List name, range and type
170                 file.print(&quot;&lt;UL&gt;&quot;);
171                 for (final LocalVariable var : vars) {
172                     index = var.getSignatureIndex();
173                     String signature = ((ConstantUtf8) constant_pool.getConstant(index,
174                             Const.CONSTANT_Utf8)).getBytes();
175                     signature = Utility.signatureToString(signature, false);
176                     final int start = var.getStartPC();
177                     final int end = start + var.getLength();
178                     file.println(&quot;&lt;LI&gt;&quot; + Class2HTML.referenceType(signature) + &quot;&amp;nbsp;&lt;B&gt;&quot;
179                             + var.getName() + &quot;&lt;/B&gt; in slot %&quot; + var.getIndex()
180                             + &quot;&lt;BR&gt;Valid from lines &quot; + &quot;&lt;A HREF=\&quot;&quot; + class_name
181                             + &quot;_code.html#code&quot; + method_number + &quot;@&quot; + start + &quot;\&quot; TARGET=Code&gt;&quot;
182                             + start + &quot;&lt;/A&gt; to &quot; + &quot;&lt;A HREF=\&quot;&quot; + class_name + &quot;_code.html#code&quot;
183                             + method_number + &quot;@&quot; + end + &quot;\&quot; TARGET=Code&gt;&quot; + end + &quot;&lt;/A&gt;&lt;/LI&gt;&quot;);
184                 }
185                 file.print(&quot;&lt;/UL&gt;\n&quot;);
186                 break;
187             case Const.ATTR_INNER_CLASSES:
188                 final InnerClass[] classes = ((InnerClasses) attribute).getInnerClasses();
189                 // List inner classes
190                 file.print(&quot;&lt;UL&gt;&quot;);
191                 for (final InnerClass classe : classes) {
192                     String name;
193                     String access;
194                     index = classe.getInnerNameIndex();
195                     if (index &gt; 0) {
196                         name = ((ConstantUtf8) constant_pool.getConstant(index, Const.CONSTANT_Utf8))
197                                 .getBytes();
198                     } else {
199                         name = &quot;&amp;lt;anonymous&amp;gt;&quot;;
200                     }
201                     access = Utility.accessToString(classe.getInnerAccessFlags());
202                     file.print(&quot;&lt;LI&gt;&lt;FONT COLOR=\&quot;#FF0000\&quot;&gt;&quot; + access + &quot;&lt;/FONT&gt; &quot;
203                             + constant_html.referenceConstant(classe.getInnerClassIndex())
204                             + &quot; in&amp;nbsp;class &quot;
205                             + constant_html.referenceConstant(classe.getOuterClassIndex())
206                             + &quot; named &quot; + name + &quot;&lt;/LI&gt;\n&quot;);
207                 }
208                 file.print(&quot;&lt;/UL&gt;\n&quot;);
209                 break;
210             default: // Such as Unknown attribute or Deprecated
211                 file.print(&quot;&lt;P&gt;&quot; + attribute);
212         }
213         file.println(&quot;&lt;/TD&gt;&lt;/TR&gt;&quot;);
214         file.flush();
215     }
216 }
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>