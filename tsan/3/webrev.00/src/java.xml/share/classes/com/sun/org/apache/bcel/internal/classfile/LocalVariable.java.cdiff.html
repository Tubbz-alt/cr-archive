<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/LocalVariable.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="LineNumberTable.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="LocalVariableTable.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/LocalVariable.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
   */
  /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   */
  /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 26,39 ***</span>
  
  import com.sun.org.apache.bcel.internal.Const;
  
  /**
   * This class represents a local variable within a method. It contains its
<span class="line-modified">!  * scope, name, signature and index on the method&#39;s frame.</span>
   *
<span class="line-removed">-  * @version $Id: LocalVariable.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
   * @see     LocalVariableTable
   */
  public final class LocalVariable implements Cloneable, Node {
  
      private int start_pc; // Range in which the variable is valid
      private int length;
      private int name_index; // Index in constant pool of variable name
      private int signature_index; // Index of variable signature
<span class="line-modified">!     private int index; /* Variable is `index&#39;th local variable on</span>
       * this method&#39;s frame.
       */
      private ConstantPool constant_pool;
  
  
      /**
<span class="line-modified">!      * Initialize from another object. Note that both objects use the same</span>
       * references (shallow copy). Use copy() for a physical copy.
       */
<span class="line-modified">!     public LocalVariable(final LocalVariable c) {</span>
<span class="line-modified">!         this(c.getStartPC(), c.getLength(), c.getNameIndex(), c.getSignatureIndex(), c.getIndex(),</span>
<span class="line-modified">!                 c.getConstantPool());</span>
      }
  
<span class="line-removed">- </span>
      /**
<span class="line-modified">!      * Construct object from file stream.</span>
       * @param file Input stream
       * @throws IOException
       */
      LocalVariable(final DataInput file, final ConstantPool constant_pool) throws IOException {
          this(file.readUnsignedShort(), file.readUnsignedShort(), file.readUnsignedShort(), file
<span class="line-new-header">--- 26,51 ---</span>
  
  import com.sun.org.apache.bcel.internal.Const;
  
  /**
   * This class represents a local variable within a method. It contains its
<span class="line-modified">!  * scope, name, signature and index on the method&#39;s frame.  It is used both</span>
<span class="line-added">+  * to represent an element of the LocalVariableTable as well as an element</span>
<span class="line-added">+  * of the LocalVariableTypeTable.  The nomenclature used here may be a bit confusing;</span>
<span class="line-added">+  * while the two items have the same layout in a class file, a LocalVariableTable</span>
<span class="line-added">+  * attribute contains a descriptor_index, not a signature_index.  The</span>
<span class="line-added">+  * LocalVariableTypeTable attribute does have a signature_index.</span>
<span class="line-added">+  * @see com.sun.org.apache.bcel.internal.classfile.Utility for more details on the difference.</span>
   *
   * @see     LocalVariableTable
<span class="line-added">+  * @see     LocalVariableTypeTable</span>
<span class="line-added">+  * @LastModified: Jan 2020</span>
   */
  public final class LocalVariable implements Cloneable, Node {
  
      private int start_pc; // Range in which the variable is valid
      private int length;
      private int name_index; // Index in constant pool of variable name
<span class="line-added">+     // Technically, a decscriptor_index for a local variable table entry</span>
<span class="line-added">+     // and a signature_index for a local variable type table entry.</span>
      private int signature_index; // Index of variable signature
<span class="line-modified">!     private int index; /* Variable is index&#39;th local variable on</span>
       * this method&#39;s frame.
       */
      private ConstantPool constant_pool;
<span class="line-added">+     private int orig_index; // never changes; used to match up with LocalVariableTypeTable entries</span>
  
  
      /**
<span class="line-modified">!      * Initializes from another LocalVariable. Note that both objects use the same</span>
       * references (shallow copy). Use copy() for a physical copy.
<span class="line-added">+      *</span>
<span class="line-added">+      * @param localVariable Another LocalVariable.</span>
       */
<span class="line-modified">!     public LocalVariable(final LocalVariable localVariable) {</span>
<span class="line-modified">!         this(localVariable.getStartPC(), localVariable.getLength(), localVariable.getNameIndex(),</span>
<span class="line-modified">!                 localVariable.getSignatureIndex(), localVariable.getIndex(), localVariable.getConstantPool());</span>
<span class="line-added">+         this.orig_index = localVariable.getOrigIndex();</span>
      }
  
      /**
<span class="line-modified">!      * Constructs object from file stream.</span>
       * @param file Input stream
       * @throws IOException
       */
      LocalVariable(final DataInput file, final ConstantPool constant_pool) throws IOException {
          this(file.readUnsignedShort(), file.readUnsignedShort(), file.readUnsignedShort(), file
</pre>
<hr />
<pre>
<span class="line-old-header">*** 80,10 ***</span>
<span class="line-new-header">--- 92,32 ---</span>
          this.length = length;
          this.name_index = name_index;
          this.signature_index = signature_index;
          this.index = index;
          this.constant_pool = constant_pool;
<span class="line-added">+         this.orig_index = index;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * @param start_pc Range in which the variable</span>
<span class="line-added">+      * @param length ... is valid</span>
<span class="line-added">+      * @param name_index Index in constant pool of variable name</span>
<span class="line-added">+      * @param signature_index Index of variable&#39;s signature</span>
<span class="line-added">+      * @param index Variable is `index&#39;th local variable on the method&#39;s frame</span>
<span class="line-added">+      * @param constant_pool Array of constants</span>
<span class="line-added">+      * @param orig_index Variable is `index&#39;th local variable on the method&#39;s frame prior to any changes</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public LocalVariable(final int start_pc, final int length, final int name_index, final int signature_index, final int index,</span>
<span class="line-added">+             final ConstantPool constant_pool, final int orig_index) {</span>
<span class="line-added">+         this.start_pc = start_pc;</span>
<span class="line-added">+         this.length = length;</span>
<span class="line-added">+         this.name_index = name_index;</span>
<span class="line-added">+         this.signature_index = signature_index;</span>
<span class="line-added">+         this.index = index;</span>
<span class="line-added">+         this.constant_pool = constant_pool;</span>
<span class="line-added">+         this.orig_index = orig_index;</span>
      }
  
  
      /**
       * Called by objects that are traversing the nodes of the tree implicitely
</pre>
<hr />
<pre>
<span class="line-old-header">*** 97,96 ***</span>
          v.visitLocalVariable(this);
      }
  
  
      /**
<span class="line-modified">!      * Dump local variable to file stream in binary format.</span>
       *
<span class="line-modified">!      * @param file Output file stream</span>
<span class="line-modified">!      * @throws IOException</span>
       */
<span class="line-modified">!     public final void dump( final DataOutputStream file ) throws IOException {</span>
<span class="line-modified">!         file.writeShort(start_pc);</span>
<span class="line-modified">!         file.writeShort(length);</span>
<span class="line-modified">!         file.writeShort(name_index);</span>
<span class="line-modified">!         file.writeShort(signature_index);</span>
<span class="line-modified">!         file.writeShort(index);</span>
      }
  
<span class="line-removed">- </span>
      /**
       * @return Constant pool used by this object.
       */
<span class="line-modified">!     public final ConstantPool getConstantPool() {</span>
          return constant_pool;
      }
  
  
      /**
       * @return Variable is valid within getStartPC() .. getStartPC()+getLength()
       */
<span class="line-modified">!     public final int getLength() {</span>
          return length;
      }
  
  
      /**
       * @return Variable name.
       */
<span class="line-modified">!     public final String getName() {</span>
          ConstantUtf8 c;
          c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);
          return c.getBytes();
      }
  
  
      /**
       * @return Index in constant pool of variable name.
       */
<span class="line-modified">!     public final int getNameIndex() {</span>
          return name_index;
      }
  
  
      /**
       * @return Signature.
       */
<span class="line-modified">!     public final String getSignature() {</span>
          ConstantUtf8 c;
          c = (ConstantUtf8) constant_pool.getConstant(signature_index, Const.CONSTANT_Utf8);
          return c.getBytes();
      }
  
  
      /**
       * @return Index in constant pool of variable signature.
       */
<span class="line-modified">!     public final int getSignatureIndex() {</span>
          return signature_index;
      }
  
  
      /**
       * @return index of register where variable is stored
       */
<span class="line-modified">!     public final int getIndex() {</span>
          return index;
      }
  
  
      /**
<span class="line-modified">!      * @return Start of range where he variable is valid</span>
       */
<span class="line-modified">!     public final int getStartPC() {</span>
          return start_pc;
      }
  
  
      /*
       * Helper method shared with LocalVariableTypeTable
       */
<span class="line-modified">!     final String toStringShared( final boolean typeTable ) {</span>
          final String name = getName();
          final String signature = Utility.signatureToString(getSignature(), false);
          final String label = &quot;LocalVariable&quot; + (typeTable ? &quot;Types&quot; : &quot;&quot; );
          return label + &quot;(start_pc = &quot; + start_pc + &quot;, length = &quot; + length + &quot;, index = &quot;
                  + index + &quot;:&quot; + signature + &quot; &quot; + name + &quot;)&quot;;
<span class="line-new-header">--- 131,104 ---</span>
          v.visitLocalVariable(this);
      }
  
  
      /**
<span class="line-modified">!      * Dumps local variable to file stream in binary format.</span>
       *
<span class="line-modified">!      * @param dataOutputStream Output file stream</span>
<span class="line-modified">!      * @exception IOException if an I/O error occurs.</span>
<span class="line-added">+      * @see java.io.FilterOutputStream#out</span>
       */
<span class="line-modified">!     public void dump(final DataOutputStream dataOutputStream) throws IOException {</span>
<span class="line-modified">!         dataOutputStream.writeShort(start_pc);</span>
<span class="line-modified">!         dataOutputStream.writeShort(length);</span>
<span class="line-modified">!         dataOutputStream.writeShort(name_index);</span>
<span class="line-modified">!         dataOutputStream.writeShort(signature_index);</span>
<span class="line-modified">!         dataOutputStream.writeShort(index);</span>
      }
  
      /**
       * @return Constant pool used by this object.
       */
<span class="line-modified">!     public ConstantPool getConstantPool() {</span>
          return constant_pool;
      }
  
  
      /**
       * @return Variable is valid within getStartPC() .. getStartPC()+getLength()
       */
<span class="line-modified">!     public int getLength() {</span>
          return length;
      }
  
  
      /**
       * @return Variable name.
       */
<span class="line-modified">!     public String getName() {</span>
          ConstantUtf8 c;
          c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);
          return c.getBytes();
      }
  
  
      /**
       * @return Index in constant pool of variable name.
       */
<span class="line-modified">!     public int getNameIndex() {</span>
          return name_index;
      }
  
  
      /**
       * @return Signature.
       */
<span class="line-modified">!     public String getSignature() {</span>
          ConstantUtf8 c;
          c = (ConstantUtf8) constant_pool.getConstant(signature_index, Const.CONSTANT_Utf8);
          return c.getBytes();
      }
  
  
      /**
       * @return Index in constant pool of variable signature.
       */
<span class="line-modified">!     public int getSignatureIndex() {</span>
          return signature_index;
      }
  
  
      /**
       * @return index of register where variable is stored
       */
<span class="line-modified">!     public int getIndex() {</span>
          return index;
      }
  
  
      /**
<span class="line-modified">!      * @return index of register where variable was originally stored</span>
<span class="line-added">+      */</span>
<span class="line-added">+     public int getOrigIndex() {</span>
<span class="line-added">+         return orig_index;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
<span class="line-added">+     /**</span>
<span class="line-added">+      * @return Start of range where the variable is valid</span>
       */
<span class="line-modified">!     public int getStartPC() {</span>
          return start_pc;
      }
  
  
      /*
       * Helper method shared with LocalVariableTypeTable
       */
<span class="line-modified">!     String toStringShared( final boolean typeTable ) {</span>
          final String name = getName();
          final String signature = Utility.signatureToString(getSignature(), false);
          final String label = &quot;LocalVariable&quot; + (typeTable ? &quot;Types&quot; : &quot;&quot; );
          return label + &quot;(start_pc = &quot; + start_pc + &quot;, length = &quot; + length + &quot;, index = &quot;
                  + index + &quot;:&quot; + signature + &quot; &quot; + name + &quot;)&quot;;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 194,60 ***</span>
  
  
      /**
       * @param constant_pool Constant pool to be used for this object.
       */
<span class="line-modified">!     public final void setConstantPool( final ConstantPool constant_pool ) {</span>
          this.constant_pool = constant_pool;
      }
  
  
      /**
       * @param length the length of this local variable
       */
<span class="line-modified">!     public final void setLength( final int length ) {</span>
          this.length = length;
      }
  
  
      /**
       * @param name_index the index into the constant pool for the name of this variable
       */
<span class="line-modified">!     public final void setNameIndex( final int name_index ) { // TODO unused</span>
          this.name_index = name_index;
      }
  
  
      /**
       * @param signature_index the index into the constant pool for the signature of this variable
       */
<span class="line-modified">!     public final void setSignatureIndex( final int signature_index ) { // TODO unused</span>
          this.signature_index = signature_index;
      }
  
  
      /**
       * @param index the index in the local variable table of this variable
       */
<span class="line-modified">!     public final void setIndex( final int index ) { // TODO unused</span>
          this.index = index;
      }
  
  
      /**
       * @param start_pc Specify range where the local variable is valid.
       */
<span class="line-modified">!     public final void setStartPC( final int start_pc ) { // TODO unused</span>
          this.start_pc = start_pc;
      }
  
  
      /**
       * @return string representation.
       */
      @Override
<span class="line-modified">!     public final String toString() {</span>
          return toStringShared(false);
      }
  
  
      /**
<span class="line-new-header">--- 236,60 ---</span>
  
  
      /**
       * @param constant_pool Constant pool to be used for this object.
       */
<span class="line-modified">!     public void setConstantPool( final ConstantPool constant_pool ) {</span>
          this.constant_pool = constant_pool;
      }
  
  
      /**
       * @param length the length of this local variable
       */
<span class="line-modified">!     public void setLength( final int length ) {</span>
          this.length = length;
      }
  
  
      /**
       * @param name_index the index into the constant pool for the name of this variable
       */
<span class="line-modified">!     public void setNameIndex( final int name_index ) { // TODO unused</span>
          this.name_index = name_index;
      }
  
  
      /**
       * @param signature_index the index into the constant pool for the signature of this variable
       */
<span class="line-modified">!     public void setSignatureIndex( final int signature_index ) { // TODO unused</span>
          this.signature_index = signature_index;
      }
  
  
      /**
       * @param index the index in the local variable table of this variable
       */
<span class="line-modified">!     public void setIndex( final int index ) { // TODO unused</span>
          this.index = index;
      }
  
  
      /**
       * @param start_pc Specify range where the local variable is valid.
       */
<span class="line-modified">!     public void setStartPC( final int start_pc ) { // TODO unused</span>
          this.start_pc = start_pc;
      }
  
  
      /**
       * @return string representation.
       */
      @Override
<span class="line-modified">!     public String toString() {</span>
          return toStringShared(false);
      }
  
  
      /**
</pre>
<center><a href="LineNumberTable.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="LocalVariableTable.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>