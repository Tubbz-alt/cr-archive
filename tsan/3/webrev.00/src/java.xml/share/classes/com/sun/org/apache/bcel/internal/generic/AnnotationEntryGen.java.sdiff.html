<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/AnnotationEntryGen.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AllocationInstruction.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="ArithmeticInstruction.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/AnnotationEntryGen.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * reserved comment block</span>
<span class="line-removed">  3  * DO NOT REMOVE OR ALTER!</span>
  4  */
  5 /*
  6  * Licensed to the Apache Software Foundation (ASF) under one or more
  7  * contributor license agreements.  See the NOTICE file distributed with
  8  * this work for additional information regarding copyright ownership.
  9  * The ASF licenses this file to You under the Apache License, Version 2.0
 10  * (the &quot;License&quot;); you may not use this file except in compliance with
 11  * the License.  You may obtain a copy of the License at
 12  *
 13  *      http://www.apache.org/licenses/LICENSE-2.0
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.bcel.internal.generic;
 23 
 24 import java.io.ByteArrayInputStream;
 25 import java.io.ByteArrayOutputStream;
 26 import java.io.DataInput;
 27 import java.io.DataInputStream;
 28 import java.io.DataOutputStream;
 29 import java.io.IOException;
 30 import java.util.ArrayList;
 31 import java.util.List;
 32 
 33 import com.sun.org.apache.bcel.internal.classfile.AnnotationEntry;
 34 import com.sun.org.apache.bcel.internal.classfile.Attribute;
 35 import com.sun.org.apache.bcel.internal.classfile.ConstantUtf8;
 36 import com.sun.org.apache.bcel.internal.classfile.ElementValuePair;
 37 import com.sun.org.apache.bcel.internal.classfile.RuntimeInvisibleAnnotations;
 38 import com.sun.org.apache.bcel.internal.classfile.RuntimeInvisibleParameterAnnotations;
 39 import com.sun.org.apache.bcel.internal.classfile.RuntimeVisibleAnnotations;
 40 import com.sun.org.apache.bcel.internal.classfile.RuntimeVisibleParameterAnnotations;
 41 
 42 /**
 43  * @since 6.0

 44  */
 45 public class AnnotationEntryGen {
 46     private int typeIndex;
 47 
 48     private List&lt;ElementValuePairGen&gt; evs;
 49 
 50     private final ConstantPoolGen cpool;
 51 
 52     private boolean isRuntimeVisible = false;
 53 
 54     /**
 55      * Here we are taking a fixed annotation of type Annotation and building a
 56      * modifiable AnnotationGen object. If the pool passed in is for a different
 57      * class file, then copyPoolEntries should have been passed as true as that
 58      * will force us to do a deep copy of the annotation and move the cpool
 59      * entries across. We need to copy the type and the element name value pairs
 60      * and the visibility.
 61      */
 62     public AnnotationEntryGen(final AnnotationEntry a, final ConstantPoolGen cpool,
 63                               final boolean copyPoolEntries) {
</pre>
<hr />
<pre>
246                 rvaIndex = cp.addUtf8(&quot;RuntimeVisibleAnnotations&quot;);
247             }
248             if (riaData.length &gt; 2) {
249                 riaIndex = cp.addUtf8(&quot;RuntimeInvisibleAnnotations&quot;);
250             }
251 
252             final List&lt;Attribute&gt; newAttributes = new ArrayList&lt;&gt;();
253             if (rvaData.length &gt; 2) {
254                 newAttributes.add(
255                         new RuntimeVisibleAnnotations(rvaIndex, rvaData.length,
256                             new DataInputStream(new ByteArrayInputStream(rvaData)), cp.getConstantPool()));
257             }
258             if (riaData.length &gt; 2) {
259                 newAttributes.add(
260                         new RuntimeInvisibleAnnotations(riaIndex, riaData.length,
261                             new DataInputStream(new ByteArrayInputStream(riaData)), cp.getConstantPool()));
262             }
263 
264             return newAttributes.toArray(new Attribute[newAttributes.size()]);
265         } catch (final IOException e) {
<span class="line-modified">266             System.err.println(&quot;IOException whilst processing annotations. &quot; +</span>
<span class="line-modified">267                     e.getMessage());</span>
268         }
269         return null;
270     }
271 
272 
273     /**
274      * Annotations against a class are stored in one of four attribute kinds:
275      * - RuntimeVisibleParameterAnnotations
276      * - RuntimeInvisibleParameterAnnotations
277      */
278     static Attribute[] getParameterAnnotationAttributes(
279             final ConstantPoolGen cp,
280             final List&lt;AnnotationEntryGen&gt;[] /*Array of lists, array size depends on #params */vec) {
281         final int[] visCount = new int[vec.length];
282         int totalVisCount = 0;
283         final int[] invisCount = new int[vec.length];
284         int totalInvisCount = 0;
285         try {
286             for (int i = 0; i &lt; vec.length; i++) {
287                 if (vec[i] != null) {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>

  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.bcel.internal.generic;
 22 
 23 import java.io.ByteArrayInputStream;
 24 import java.io.ByteArrayOutputStream;
 25 import java.io.DataInput;
 26 import java.io.DataInputStream;
 27 import java.io.DataOutputStream;
 28 import java.io.IOException;
 29 import java.util.ArrayList;
 30 import java.util.List;
 31 
 32 import com.sun.org.apache.bcel.internal.classfile.AnnotationEntry;
 33 import com.sun.org.apache.bcel.internal.classfile.Attribute;
 34 import com.sun.org.apache.bcel.internal.classfile.ConstantUtf8;
 35 import com.sun.org.apache.bcel.internal.classfile.ElementValuePair;
 36 import com.sun.org.apache.bcel.internal.classfile.RuntimeInvisibleAnnotations;
 37 import com.sun.org.apache.bcel.internal.classfile.RuntimeInvisibleParameterAnnotations;
 38 import com.sun.org.apache.bcel.internal.classfile.RuntimeVisibleAnnotations;
 39 import com.sun.org.apache.bcel.internal.classfile.RuntimeVisibleParameterAnnotations;
 40 
 41 /**
 42  * @since 6.0
<span class="line-added"> 43  * @LastModified: Jan 2020</span>
 44  */
 45 public class AnnotationEntryGen {
 46     private int typeIndex;
 47 
 48     private List&lt;ElementValuePairGen&gt; evs;
 49 
 50     private final ConstantPoolGen cpool;
 51 
 52     private boolean isRuntimeVisible = false;
 53 
 54     /**
 55      * Here we are taking a fixed annotation of type Annotation and building a
 56      * modifiable AnnotationGen object. If the pool passed in is for a different
 57      * class file, then copyPoolEntries should have been passed as true as that
 58      * will force us to do a deep copy of the annotation and move the cpool
 59      * entries across. We need to copy the type and the element name value pairs
 60      * and the visibility.
 61      */
 62     public AnnotationEntryGen(final AnnotationEntry a, final ConstantPoolGen cpool,
 63                               final boolean copyPoolEntries) {
</pre>
<hr />
<pre>
246                 rvaIndex = cp.addUtf8(&quot;RuntimeVisibleAnnotations&quot;);
247             }
248             if (riaData.length &gt; 2) {
249                 riaIndex = cp.addUtf8(&quot;RuntimeInvisibleAnnotations&quot;);
250             }
251 
252             final List&lt;Attribute&gt; newAttributes = new ArrayList&lt;&gt;();
253             if (rvaData.length &gt; 2) {
254                 newAttributes.add(
255                         new RuntimeVisibleAnnotations(rvaIndex, rvaData.length,
256                             new DataInputStream(new ByteArrayInputStream(rvaData)), cp.getConstantPool()));
257             }
258             if (riaData.length &gt; 2) {
259                 newAttributes.add(
260                         new RuntimeInvisibleAnnotations(riaIndex, riaData.length,
261                             new DataInputStream(new ByteArrayInputStream(riaData)), cp.getConstantPool()));
262             }
263 
264             return newAttributes.toArray(new Attribute[newAttributes.size()]);
265         } catch (final IOException e) {
<span class="line-modified">266             System.err.println(&quot;IOException whilst processing annotations&quot;);</span>
<span class="line-modified">267             e.printStackTrace();</span>
268         }
269         return null;
270     }
271 
272 
273     /**
274      * Annotations against a class are stored in one of four attribute kinds:
275      * - RuntimeVisibleParameterAnnotations
276      * - RuntimeInvisibleParameterAnnotations
277      */
278     static Attribute[] getParameterAnnotationAttributes(
279             final ConstantPoolGen cp,
280             final List&lt;AnnotationEntryGen&gt;[] /*Array of lists, array size depends on #params */vec) {
281         final int[] visCount = new int[vec.length];
282         int totalVisCount = 0;
283         final int[] invisCount = new int[vec.length];
284         int totalInvisCount = 0;
285         try {
286             for (int i = 0; i &lt; vec.length; i++) {
287                 if (vec[i] != null) {
</pre>
</td>
</tr>
</table>
<center><a href="AllocationInstruction.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="ArithmeticInstruction.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>