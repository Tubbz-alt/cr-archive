<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/dom/NodeSortRecord.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../compiler/util/MethodGenerator.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../runtime/AbstractTranslet.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/dom/NodeSortRecord.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xalan.internal.xsltc.dom;
 22 
<span class="line-removed"> 23 import com.sun.org.apache.xalan.internal.utils.ObjectFactory;</span>
<span class="line-removed"> 24 import com.sun.org.apache.xalan.internal.xsltc.CollatorFactory;</span>
 25 import com.sun.org.apache.xalan.internal.xsltc.DOM;
 26 import com.sun.org.apache.xalan.internal.xsltc.TransletException;
 27 import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;
 28 import com.sun.org.apache.xml.internal.utils.StringComparable;
 29 import java.text.Collator;
 30 import java.util.Locale;
<span class="line-removed"> 31 import jdk.xml.internal.SecuritySupport;</span>
 32 
 33 /**
 34  * Base class for sort records containing application specific sort keys
 35  *
<span class="line-modified"> 36  * @LastModified: Oct 2017</span>
 37  */
 38 public abstract class NodeSortRecord {
 39     public static final int COMPARE_STRING     = 0;
 40     public static final int COMPARE_NUMERIC    = 1;
 41 
 42     public static final int COMPARE_ASCENDING  = 0;
 43     public static final int COMPARE_DESCENDING = 1;
 44 
 45     /**
 46      * A reference to a collator. May be updated by subclass if the stylesheet
 47      * specifies a different language (will be updated iff _locale is updated).
 48      * @deprecated This field continues to exist for binary compatibility.
 49      *             New code should not refer to it.
 50      */
 51     @Deprecated
 52     private static final Collator DEFAULT_COLLATOR = Collator.getInstance();
 53 
 54     /**
 55      * A reference to the first Collator
 56      * @deprecated This field continues to exist for binary compatibility.
 57      *             New code should not refer to it.
 58      */
 59     @Deprecated
 60     protected Collator _collator = DEFAULT_COLLATOR;
 61     protected Collator[] _collators;
 62 
 63     /**
 64      * A locale field that might be set by an instance of a subclass.
 65      * @deprecated This field continues to exist for binary compatibility.
 66      *             New code should not refer to it.
 67      */
 68     @Deprecated
 69     protected Locale _locale;
 70 
<span class="line-removed"> 71     protected CollatorFactory _collatorFactory;</span>
<span class="line-removed"> 72 </span>
 73     protected SortSettings _settings;
 74 
 75     private DOM    _dom = null;
 76     private int    _node;           // The position in the current iterator
 77     private int    _last = 0;       // Number of nodes in the current iterator
 78     private int    _scanned = 0;    // Number of key levels extracted from DOM
 79 
 80     private Object[] _values; // Contains Comparable  objects
 81 
 82     /**
 83      * This constructor is run by a call to ClassLoader in the
 84      * makeNodeSortRecord method in the NodeSortRecordFactory class. Since we
 85      * cannot pass any parameters to the constructor in that case we just set
 86      * the default values here and wait for new values through initialize().
 87      */
 88     public NodeSortRecord(int node) {
 89         _node = node;
 90     }
 91 
 92     public NodeSortRecord() {
 93         this(0);
 94     }
 95 
 96     /**
 97      * This method allows the caller to set the values that could not be passed
 98      * to the default constructor.
 99      */
100     public final void initialize(int node, int last, DOM dom,
101          SortSettings settings)
102         throws TransletException
103     {
104         _dom = dom;
105         _node = node;
106         _last = last;
107         _settings = settings;
108 
109         int levels = settings.getSortOrders().length;
110         _values = new Object[levels];
111 
<span class="line-modified">112         String colFactClassname = null;</span>
<span class="line-modified">113         try {</span>
<span class="line-removed">114             // -- W. Eliot Kimber (eliot@isogen.com)</span>
<span class="line-removed">115             colFactClassname =</span>
<span class="line-removed">116                 SecuritySupport.getSystemProperty(&quot;com.sun.org.apache.xalan.internal.xsltc.COLLATOR_FACTORY&quot;);</span>
<span class="line-removed">117         }</span>
<span class="line-removed">118         catch (SecurityException e) {</span>
<span class="line-removed">119             // If we can&#39;t read the propery, just use default collator</span>
<span class="line-removed">120         }</span>
<span class="line-removed">121 </span>
<span class="line-removed">122         if (colFactClassname != null) {</span>
<span class="line-removed">123             try {</span>
<span class="line-removed">124                 Object candObj = ObjectFactory.findProviderClass(colFactClassname, true);</span>
<span class="line-removed">125                 _collatorFactory = (CollatorFactory)candObj;</span>
<span class="line-removed">126             } catch (ClassNotFoundException e) {</span>
<span class="line-removed">127                 throw new TransletException(e);</span>
<span class="line-removed">128             }</span>
<span class="line-removed">129             Locale[] locales = settings.getLocales();</span>
<span class="line-removed">130             _collators = new Collator[levels];</span>
<span class="line-removed">131             for (int i = 0; i &lt; levels; i++){</span>
<span class="line-removed">132                 _collators[i] = _collatorFactory.getCollator(locales[i]);</span>
<span class="line-removed">133             }</span>
<span class="line-removed">134             _collator = _collators[0];</span>
<span class="line-removed">135         } else {</span>
<span class="line-removed">136             _collators = settings.getCollators();</span>
<span class="line-removed">137             _collator = _collators[0];</span>
<span class="line-removed">138         }</span>
139     }
140 
141     /**
142      * Returns the node for this sort object
143      */
144     public final int getNode() {
145         return _node;
146     }
147 
148     /**
149      *
150      */
151     public final int compareDocOrder(NodeSortRecord other) {
152         return _node - other._node;
153     }
154 
155     /**
156      * Get the string or numeric value of a specific level key for this sort
157      * element. The value is extracted from the DOM if it is not already in
158      * our sort key vector.
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xalan.internal.xsltc.dom;
 22 


 23 import com.sun.org.apache.xalan.internal.xsltc.DOM;
 24 import com.sun.org.apache.xalan.internal.xsltc.TransletException;
 25 import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;
 26 import com.sun.org.apache.xml.internal.utils.StringComparable;
 27 import java.text.Collator;
 28 import java.util.Locale;

 29 
 30 /**
 31  * Base class for sort records containing application specific sort keys
 32  *
<span class="line-modified"> 33  * @LastModified: May 2019</span>
 34  */
 35 public abstract class NodeSortRecord {
 36     public static final int COMPARE_STRING     = 0;
 37     public static final int COMPARE_NUMERIC    = 1;
 38 
 39     public static final int COMPARE_ASCENDING  = 0;
 40     public static final int COMPARE_DESCENDING = 1;
 41 
 42     /**
 43      * A reference to a collator. May be updated by subclass if the stylesheet
 44      * specifies a different language (will be updated iff _locale is updated).
 45      * @deprecated This field continues to exist for binary compatibility.
 46      *             New code should not refer to it.
 47      */
 48     @Deprecated
 49     private static final Collator DEFAULT_COLLATOR = Collator.getInstance();
 50 
 51     /**
 52      * A reference to the first Collator
 53      * @deprecated This field continues to exist for binary compatibility.
 54      *             New code should not refer to it.
 55      */
 56     @Deprecated
 57     protected Collator _collator = DEFAULT_COLLATOR;
 58     protected Collator[] _collators;
 59 
 60     /**
 61      * A locale field that might be set by an instance of a subclass.
 62      * @deprecated This field continues to exist for binary compatibility.
 63      *             New code should not refer to it.
 64      */
 65     @Deprecated
 66     protected Locale _locale;
 67 


 68     protected SortSettings _settings;
 69 
 70     private DOM    _dom = null;
 71     private int    _node;           // The position in the current iterator
 72     private int    _last = 0;       // Number of nodes in the current iterator
 73     private int    _scanned = 0;    // Number of key levels extracted from DOM
 74 
 75     private Object[] _values; // Contains Comparable  objects
 76 
 77     /**
 78      * This constructor is run by a call to ClassLoader in the
 79      * makeNodeSortRecord method in the NodeSortRecordFactory class. Since we
 80      * cannot pass any parameters to the constructor in that case we just set
 81      * the default values here and wait for new values through initialize().
 82      */
 83     public NodeSortRecord(int node) {
 84         _node = node;
 85     }
 86 
 87     public NodeSortRecord() {
 88         this(0);
 89     }
 90 
 91     /**
 92      * This method allows the caller to set the values that could not be passed
 93      * to the default constructor.
 94      */
 95     public final void initialize(int node, int last, DOM dom,
 96          SortSettings settings)
 97         throws TransletException
 98     {
 99         _dom = dom;
100         _node = node;
101         _last = last;
102         _settings = settings;
103 
104         int levels = settings.getSortOrders().length;
105         _values = new Object[levels];
106 
<span class="line-modified">107         _collators = settings.getCollators();</span>
<span class="line-modified">108         _collator = _collators[0];</span>

























109     }
110 
111     /**
112      * Returns the node for this sort object
113      */
114     public final int getNode() {
115         return _node;
116     }
117 
118     /**
119      *
120      */
121     public final int compareDocOrder(NodeSortRecord other) {
122         return _node - other._node;
123     }
124 
125     /**
126      * Get the string or numeric value of a specific level key for this sort
127      * element. The value is extracted from the DOM if it is not already in
128      * our sort key vector.
</pre>
</td>
</tr>
</table>
<center><a href="../compiler/util/MethodGenerator.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../runtime/AbstractTranslet.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>