<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xpath/internal/axes/WalkerFactory.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FilterExprWalker.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../compiler/Compiler.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xpath/internal/axes/WalkerFactory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
   3  */
   4 /*
   5  * Licensed to the Apache Software Foundation (ASF) under one or more
   6  * contributor license agreements.  See the NOTICE file distributed with
   7  * this work for additional information regarding copyright ownership.
   8  * The ASF licenses this file to You under the Apache License, Version 2.0
   9  * (the &quot;License&quot;); you may not use this file except in compliance with
  10  * the License.  You may obtain a copy of the License at
  11  *
  12  *      http://www.apache.org/licenses/LICENSE-2.0
  13  *
  14  * Unless required by applicable law or agreed to in writing, software
  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  17  * See the License for the specific language governing permissions and
  18  * limitations under the License.
  19  */
  20 
  21 package com.sun.org.apache.xpath.internal.axes;
  22 
</pre>
<hr />
<pre>
  24 import com.sun.org.apache.xml.internal.dtm.Axis;
  25 import com.sun.org.apache.xml.internal.dtm.DTMFilter;
  26 import com.sun.org.apache.xml.internal.dtm.DTMIterator;
  27 import com.sun.org.apache.xpath.internal.Expression;
  28 import com.sun.org.apache.xpath.internal.compiler.Compiler;
  29 import com.sun.org.apache.xpath.internal.compiler.FunctionTable;
  30 import com.sun.org.apache.xpath.internal.compiler.OpCodes;
  31 import com.sun.org.apache.xpath.internal.compiler.OpMap;
  32 import com.sun.org.apache.xpath.internal.objects.XNumber;
  33 import com.sun.org.apache.xpath.internal.patterns.ContextMatchStepPattern;
  34 import com.sun.org.apache.xpath.internal.patterns.FunctionPattern;
  35 import com.sun.org.apache.xpath.internal.patterns.NodeTest;
  36 import com.sun.org.apache.xpath.internal.patterns.StepPattern;
  37 import com.sun.org.apache.xpath.internal.res.XPATHErrorResources;
  38 
  39 /**
  40  * This class is both a factory for XPath location path expressions,
  41  * which are built from the opcode map output, and an analysis engine
  42  * for the location path expressions in order to provide optimization hints.
  43  *
<span class="line-modified">  44  * @LastModified: Oct 2017</span>
  45  */
  46 public class WalkerFactory
  47 {
  48 
  49   /**
  50    * This method is for building an array of possible levels
  51    * where the target element(s) could be found for a match.
  52    * @param lpi The owning location path iterator.
  53    * @param compiler non-null reference to compiler object that has processed
  54    *                 the XPath operations into an opcode map.
  55    * @param stepOpCodePos The opcode position for the step.
  56    *
  57    * @return non-null AxesWalker derivative.
  58    *
  59    * @throws javax.xml.transform.TransformerException
  60    * @xsl.usage advanced
  61    */
  62   static AxesWalker loadOneWalker(
  63           WalkingIterator lpi, Compiler compiler, int stepOpCodePos)
  64             throws javax.xml.transform.TransformerException
</pre>
<hr />
<pre>
 991     int whatToShow = compiler.getWhatToShow(opPos);
 992     StepPattern ai = null;
 993     int axis, predicateAxis;
 994 
 995     switch (stepType)
 996     {
 997     case OpCodes.OP_VARIABLE :
 998     case OpCodes.OP_EXTFUNCTION :
 999     case OpCodes.OP_FUNCTION :
1000     case OpCodes.OP_GROUP :
1001       prevIsOneStepDown = false;
1002 
1003       Expression expr;
1004 
1005       switch (stepType)
1006       {
1007       case OpCodes.OP_VARIABLE :
1008       case OpCodes.OP_EXTFUNCTION :
1009       case OpCodes.OP_FUNCTION :
1010       case OpCodes.OP_GROUP :
<span class="line-modified">1011         expr = compiler.compile(opPos);</span>
1012         break;
1013       default :
<span class="line-modified">1014         expr = compiler.compile(opPos + 2);</span>
1015       }
1016 
1017       axis = Axis.FILTEREDLIST;
1018       predicateAxis = Axis.FILTEREDLIST;
1019       ai = new FunctionPattern(expr, axis, predicateAxis);
1020       simpleInit = true;
1021       break;
1022     case OpCodes.FROM_ROOT :
1023       whatToShow = DTMFilter.SHOW_DOCUMENT
1024                    | DTMFilter.SHOW_DOCUMENT_FRAGMENT;
1025 
1026       axis = Axis.ROOT;
1027       predicateAxis = Axis.ROOT;
1028       ai = new StepPattern(DTMFilter.SHOW_DOCUMENT |
1029                                 DTMFilter.SHOW_DOCUMENT_FRAGMENT,
1030                                 axis, predicateAxis);
1031       break;
1032     case OpCodes.FROM_ATTRIBUTES :
1033       whatToShow = DTMFilter.SHOW_ATTRIBUTE;
1034       axis = Axis.PARENT;
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  */
   4 /*
   5  * Licensed to the Apache Software Foundation (ASF) under one or more
   6  * contributor license agreements.  See the NOTICE file distributed with
   7  * this work for additional information regarding copyright ownership.
   8  * The ASF licenses this file to You under the Apache License, Version 2.0
   9  * (the &quot;License&quot;); you may not use this file except in compliance with
  10  * the License.  You may obtain a copy of the License at
  11  *
  12  *      http://www.apache.org/licenses/LICENSE-2.0
  13  *
  14  * Unless required by applicable law or agreed to in writing, software
  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  17  * See the License for the specific language governing permissions and
  18  * limitations under the License.
  19  */
  20 
  21 package com.sun.org.apache.xpath.internal.axes;
  22 
</pre>
<hr />
<pre>
  24 import com.sun.org.apache.xml.internal.dtm.Axis;
  25 import com.sun.org.apache.xml.internal.dtm.DTMFilter;
  26 import com.sun.org.apache.xml.internal.dtm.DTMIterator;
  27 import com.sun.org.apache.xpath.internal.Expression;
  28 import com.sun.org.apache.xpath.internal.compiler.Compiler;
  29 import com.sun.org.apache.xpath.internal.compiler.FunctionTable;
  30 import com.sun.org.apache.xpath.internal.compiler.OpCodes;
  31 import com.sun.org.apache.xpath.internal.compiler.OpMap;
  32 import com.sun.org.apache.xpath.internal.objects.XNumber;
  33 import com.sun.org.apache.xpath.internal.patterns.ContextMatchStepPattern;
  34 import com.sun.org.apache.xpath.internal.patterns.FunctionPattern;
  35 import com.sun.org.apache.xpath.internal.patterns.NodeTest;
  36 import com.sun.org.apache.xpath.internal.patterns.StepPattern;
  37 import com.sun.org.apache.xpath.internal.res.XPATHErrorResources;
  38 
  39 /**
  40  * This class is both a factory for XPath location path expressions,
  41  * which are built from the opcode map output, and an analysis engine
  42  * for the location path expressions in order to provide optimization hints.
  43  *
<span class="line-modified">  44  * @LastModified: May 2019</span>
  45  */
  46 public class WalkerFactory
  47 {
  48 
  49   /**
  50    * This method is for building an array of possible levels
  51    * where the target element(s) could be found for a match.
  52    * @param lpi The owning location path iterator.
  53    * @param compiler non-null reference to compiler object that has processed
  54    *                 the XPath operations into an opcode map.
  55    * @param stepOpCodePos The opcode position for the step.
  56    *
  57    * @return non-null AxesWalker derivative.
  58    *
  59    * @throws javax.xml.transform.TransformerException
  60    * @xsl.usage advanced
  61    */
  62   static AxesWalker loadOneWalker(
  63           WalkingIterator lpi, Compiler compiler, int stepOpCodePos)
  64             throws javax.xml.transform.TransformerException
</pre>
<hr />
<pre>
 991     int whatToShow = compiler.getWhatToShow(opPos);
 992     StepPattern ai = null;
 993     int axis, predicateAxis;
 994 
 995     switch (stepType)
 996     {
 997     case OpCodes.OP_VARIABLE :
 998     case OpCodes.OP_EXTFUNCTION :
 999     case OpCodes.OP_FUNCTION :
1000     case OpCodes.OP_GROUP :
1001       prevIsOneStepDown = false;
1002 
1003       Expression expr;
1004 
1005       switch (stepType)
1006       {
1007       case OpCodes.OP_VARIABLE :
1008       case OpCodes.OP_EXTFUNCTION :
1009       case OpCodes.OP_FUNCTION :
1010       case OpCodes.OP_GROUP :
<span class="line-modified">1011         expr = compiler.compileExpression(opPos);</span>
1012         break;
1013       default :
<span class="line-modified">1014         expr = compiler.compileExpression(opPos + 2);</span>
1015       }
1016 
1017       axis = Axis.FILTEREDLIST;
1018       predicateAxis = Axis.FILTEREDLIST;
1019       ai = new FunctionPattern(expr, axis, predicateAxis);
1020       simpleInit = true;
1021       break;
1022     case OpCodes.FROM_ROOT :
1023       whatToShow = DTMFilter.SHOW_DOCUMENT
1024                    | DTMFilter.SHOW_DOCUMENT_FRAGMENT;
1025 
1026       axis = Axis.ROOT;
1027       predicateAxis = Axis.ROOT;
1028       ai = new StepPattern(DTMFilter.SHOW_DOCUMENT |
1029                                 DTMFilter.SHOW_DOCUMENT_FRAGMENT,
1030                                 axis, predicateAxis);
1031       break;
1032     case OpCodes.FROM_ATTRIBUTES :
1033       whatToShow = DTMFilter.SHOW_ATTRIBUTE;
1034       axis = Axis.PARENT;
</pre>
</td>
</tr>
</table>
<center><a href="FilterExprWalker.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../compiler/Compiler.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>