<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/BranchInstruction.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="BranchHandle.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="CALOAD.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/BranchInstruction.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,8 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * reserved comment block</span>
<span class="udiff-line-removed">-  * DO NOT REMOVE OR ALTER!</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   */
  /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -24,16 +23,16 @@</span>
  import java.io.IOException;
  
  import com.sun.org.apache.bcel.internal.util.ByteSequence;
  
  /**
<span class="udiff-line-modified-removed">-  * Abstract super class for branching instructions like GOTO, IFEQ, etc.. Branch</span>
<span class="udiff-line-modified-removed">-  * instructions may have a variable length, namely GOTO, JSR, LOOKUPSWITCH and</span>
<span class="udiff-line-modified-removed">-  * TABLESWITCH.</span>
<span class="udiff-line-modified-added">+  * Abstract super class for branching instructions like GOTO, IFEQ, etc..</span>
<span class="udiff-line-modified-added">+  * Branch instructions may have a variable length, namely GOTO, JSR,</span>
<span class="udiff-line-modified-added">+  * LOOKUPSWITCH and TABLESWITCH.</span>
   *
   * @see InstructionList
<span class="udiff-line-modified-removed">-  * @version $Id: BranchInstruction.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
<span class="udiff-line-modified-added">+  * @LastModified: Jan 2020</span>
   */
  public abstract class BranchInstruction extends Instruction implements InstructionTargeter {
  
      private int index; // Branch target relative to this instruction
      private InstructionHandle target; // Target object in instruction list
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -44,41 +43,41 @@</span>
       * Instruction.readInstruction(). Not to be used otherwise.
       */
      BranchInstruction() {
      }
  
<span class="udiff-line-modified-removed">-     /**</span>
<span class="udiff-line-modified-removed">-      * Common super constructor</span>
<span class="udiff-line-removed">-      *</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+     /** Common super constructor</span>
       * @param opcode Instruction opcode
       * @param target instruction to branch to
       */
      protected BranchInstruction(final short opcode, final InstructionHandle target) {
          super(opcode, (short) 3);
          setTarget(target);
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * Dump instruction as byte code to stream out.
<span class="udiff-line-removed">-      *</span>
       * @param out Output stream
       */
      @Override
<span class="udiff-line-modified-removed">-     public void dump(final DataOutputStream out) throws IOException {</span>
<span class="udiff-line-modified-added">+     public void dump( final DataOutputStream out ) throws IOException {</span>
          out.writeByte(super.getOpcode());
          index = getTargetOffset();
          if (!isValidShort(index)) {
              throw new ClassGenException(&quot;Branch target offset too large for short: &quot; + index);
          }
          out.writeShort(index); // May be negative, i.e., point backwards
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @param _target branch target
<span class="udiff-line-modified-removed">-      * @return the offset to `target&#39; relative to this instruction</span>
<span class="udiff-line-modified-added">+      * @return the offset to  `target&#39; relative to this instruction</span>
       */
<span class="udiff-line-modified-removed">-     protected int getTargetOffset(final InstructionHandle _target) {</span>
<span class="udiff-line-modified-added">+     protected int getTargetOffset( final InstructionHandle _target ) {</span>
          if (_target == null) {
              throw new ClassGenException(&quot;Target of &quot; + super.toString(true)
                      + &quot; is invalid null handle&quot;);
          }
          final int t = _target.getPosition();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -87,48 +86,48 @@</span>
                      + super.toString(true) + &quot;:&quot; + t + &quot;:&quot; + _target);
          }
          return t - position;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return the offset to this instruction&#39;s target
       */
      protected int getTargetOffset() {
          return getTargetOffset(target);
      }
  
<span class="udiff-line-added">+ </span>
      /**
<span class="udiff-line-modified-removed">-      * Called by InstructionList.setPositions when setting the position for</span>
<span class="udiff-line-modified-removed">-      * every instruction. In the presence of variable length instructions</span>
<span class="udiff-line-modified-removed">-      * `setPositions&#39; performs multiple passes over the instruction list to</span>
<span class="udiff-line-modified-removed">-      * calculate the correct (byte) positions and offsets by calling this</span>
<span class="udiff-line-removed">-      * function.</span>
<span class="udiff-line-modified-added">+      * Called by InstructionList.setPositions when setting the position for every</span>
<span class="udiff-line-modified-added">+      * instruction. In the presence of variable length instructions `setPositions&#39;</span>
<span class="udiff-line-modified-added">+      * performs multiple passes over the instruction list to calculate the</span>
<span class="udiff-line-modified-added">+      * correct (byte) positions and offsets by calling this function.</span>
       *
<span class="udiff-line-modified-removed">-      * @param offset additional offset caused by preceding (variable length)</span>
<span class="udiff-line-modified-removed">-      * instructions</span>
<span class="udiff-line-modified-removed">-      * @param max_offset the maximum offset that may be caused by these</span>
<span class="udiff-line-removed">-      * instructions</span>
<span class="udiff-line-removed">-      * @return additional offset caused by possible change of this instruction&#39;s</span>
<span class="udiff-line-removed">-      * length</span>
<span class="udiff-line-modified-added">+      * @param offset additional offset caused by preceding (variable length) instructions</span>
<span class="udiff-line-modified-added">+      * @param max_offset the maximum offset that may be caused by these instructions</span>
<span class="udiff-line-modified-added">+      * @return additional offset caused by possible change of this instruction&#39;s length</span>
       */
<span class="udiff-line-modified-removed">-     protected int updatePosition(final int offset, final int max_offset) {</span>
<span class="udiff-line-modified-added">+     protected int updatePosition( final int offset, final int max_offset ) {</span>
          position += offset;
          return 0;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * Long output format:
       *
<span class="udiff-line-modified-removed">-      * &amp;lt;position in byte code&amp;gt; &amp;lt;name of opcode&amp;gt; &quot;[&quot;&amp;lt;opcode</span>
<span class="udiff-line-modified-removed">-      * number&amp;gt;&quot;]&quot; &quot;(&quot;&amp;lt;length of instruction&amp;gt;&quot;)&quot; &quot;&amp;lt;&quot;&amp;lt;target</span>
<span class="udiff-line-modified-removed">-      * instruction&amp;gt;&quot;&amp;gt;&quot; &quot;@&quot;&amp;lt;branch target offset&amp;gt;</span>
<span class="udiff-line-modified-added">+      * &amp;lt;position in byte code&amp;gt;</span>
<span class="udiff-line-modified-added">+      * &amp;lt;name of opcode&amp;gt; &quot;[&quot;&amp;lt;opcode number&amp;gt;&quot;]&quot;</span>
<span class="udiff-line-modified-added">+      * &quot;(&quot;&amp;lt;length of instruction&amp;gt;&quot;)&quot;</span>
<span class="udiff-line-added">+      * &quot;&amp;lt;&quot;&amp;lt;target instruction&amp;gt;&quot;&amp;gt;&quot; &quot;@&quot;&amp;lt;branch target offset&amp;gt;</span>
       *
       * @param verbose long/short format switch
       * @return mnemonic for instruction
       */
      @Override
<span class="udiff-line-modified-removed">-     public String toString(final boolean verbose) {</span>
<span class="udiff-line-modified-added">+     public String toString( final boolean verbose ) {</span>
          final String s = super.toString(verbose);
          String t = &quot;null&quot;;
          if (verbose) {
              if (target != null) {
                  if (target.getInstruction() == this) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -151,109 +150,118 @@</span>
              }
          }
          return s + &quot; -&gt; &quot; + t;
      }
  
<span class="udiff-line-added">+ </span>
      /**
<span class="udiff-line-modified-removed">-      * Read needed data (e.g. index) from file. Conversion to a</span>
<span class="udiff-line-modified-removed">-      * InstructionHandle is done in InstructionList(byte[]).</span>
<span class="udiff-line-modified-added">+      * Read needed data (e.g. index) from file. Conversion to a InstructionHandle</span>
<span class="udiff-line-modified-added">+      * is done in InstructionList(byte[]).</span>
       *
       * @param bytes input stream
       * @param wide wide prefix?
       * @see InstructionList
       */
      @Override
<span class="udiff-line-modified-removed">-     protected void initFromFile(final ByteSequence bytes, final boolean wide) throws IOException {</span>
<span class="udiff-line-modified-added">+     protected void initFromFile( final ByteSequence bytes, final boolean wide ) throws IOException {</span>
          super.setLength(3);
          index = bytes.readShort();
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return target offset in byte code
       */
      public final int getIndex() {
          return index;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return target of branch instruction
       */
      public InstructionHandle getTarget() {
          return target;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * Set branch target
<span class="udiff-line-removed">-      *</span>
       * @param target branch target
       */
<span class="udiff-line-modified-removed">-     public void setTarget(final InstructionHandle target) {</span>
<span class="udiff-line-modified-added">+     public void setTarget( final InstructionHandle target ) {</span>
          notifyTarget(this.target, target, this);
          this.target = target;
      }
  
<span class="udiff-line-added">+ </span>
      /**
<span class="udiff-line-modified-removed">-      * Used by BranchInstruction, LocalVariableGen, CodeExceptionGen,</span>
<span class="udiff-line-removed">-      * LineNumberGen</span>
<span class="udiff-line-modified-added">+      * Used by BranchInstruction, LocalVariableGen, CodeExceptionGen, LineNumberGen</span>
       */
<span class="udiff-line-modified-removed">-     static void notifyTarget(final InstructionHandle old_ih, final InstructionHandle new_ih,</span>
<span class="udiff-line-modified-removed">-             final InstructionTargeter t) {</span>
<span class="udiff-line-modified-added">+     static void notifyTarget( final InstructionHandle old_ih, final InstructionHandle new_ih,</span>
<span class="udiff-line-modified-added">+             final InstructionTargeter t ) {</span>
          if (old_ih != null) {
              old_ih.removeTargeter(t);
          }
          if (new_ih != null) {
              new_ih.addTargeter(t);
          }
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @param old_ih old target
       * @param new_ih new target
       */
      @Override
<span class="udiff-line-modified-removed">-     public void updateTarget(final InstructionHandle old_ih, final InstructionHandle new_ih) {</span>
<span class="udiff-line-modified-added">+     public void updateTarget( final InstructionHandle old_ih, final InstructionHandle new_ih ) {</span>
          if (target == old_ih) {
              setTarget(new_ih);
          } else {
              throw new ClassGenException(&quot;Not targeting &quot; + old_ih + &quot;, but &quot; + target);
          }
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return true, if ih is target of this instruction
       */
      @Override
<span class="udiff-line-modified-removed">-     public boolean containsTarget(final InstructionHandle ih) {</span>
<span class="udiff-line-modified-added">+     public boolean containsTarget( final InstructionHandle ih ) {</span>
          return target == ih;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * Inform target that it&#39;s not targeted anymore.
       */
      @Override
      void dispose() {
          setTarget(null);
          index = -1;
          position = -1;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return the position
       * @since 6.0
       */
      protected int getPosition() {
          return position;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @param position the position to set
       * @since 6.0
       */
      protected void setPosition(final int position) {
          this.position = position;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @param index the index to set
       * @since 6.0
       */
      protected void setIndex(final int index) {
</pre>
<center><a href="BranchHandle.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="CALOAD.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>