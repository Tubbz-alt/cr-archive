<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/NestMembers.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /*
  6  * Licensed to the Apache Software Foundation (ASF) under one or more
  7  * contributor license agreements.  See the NOTICE file distributed with
  8  * this work for additional information regarding copyright ownership.
  9  * The ASF licenses this file to You under the Apache License, Version 2.0
 10  * (the &quot;License&quot;); you may not use this file except in compliance with
 11  * the License.  You may obtain a copy of the License at
 12  *
 13  *      http://www.apache.org/licenses/LICENSE-2.0
 14  *
 15  *  Unless required by applicable law or agreed to in writing, software
 16  *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  *  See the License for the specific language governing permissions and
 19  *  limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.bcel.internal.classfile;
 23 
 24 import java.io.DataInput;
 25 import java.io.DataOutputStream;
 26 import java.io.IOException;
 27 
 28 import com.sun.org.apache.bcel.internal.Const;
 29 
 30 /**
 31  * This class is derived from &lt;em&gt;Attribute&lt;/em&gt; and records the classes and interfaces that
 32  * are authorized to claim membership in the nest hosted by the current class or interface.
 33  * There may be at most one NestMembers attribute in a ClassFile structure.
 34  *
 35  * @see     Attribute
 36  */
 37 public final class NestMembers extends Attribute {
 38 
 39     private int[] classes;
 40 
 41 
 42     /**
 43      * Initialize from another object. Note that both objects use the same
 44      * references (shallow copy). Use copy() for a physical copy.
 45      */
 46     public NestMembers(final NestMembers c) {
 47         this(c.getNameIndex(), c.getLength(), c.getClasses(), c.getConstantPool());
 48     }
 49 
 50 
 51     /**
 52      * @param name_index Index in constant pool
 53      * @param length Content length in bytes
 54      * @param classes Table of indices in constant pool
 55      * @param constant_pool Array of constants
 56      */
 57     public NestMembers(final int name_index, final int length, final int[] classes,
 58             final ConstantPool constant_pool) {
 59         super(Const.ATTR_NEST_MEMBERS, name_index, length, constant_pool);
 60         this.classes = classes != null ? classes : new int[0];
 61     }
 62 
 63 
 64     /**
 65      * Construct object from input stream.
 66      * @param name_index Index in constant pool
 67      * @param length Content length in bytes
 68      * @param input Input stream
 69      * @param constant_pool Array of constants
 70      * @throws IOException
 71      */
 72     NestMembers(final int name_index, final int length, final DataInput input, final ConstantPool constant_pool) throws IOException {
 73         this(name_index, length, (int[]) null, constant_pool);
 74         final int number_of_classes = input.readUnsignedShort();
 75         classes = new int[number_of_classes];
 76         for (int i = 0; i &lt; number_of_classes; i++) {
 77             classes[i] = input.readUnsignedShort();
 78         }
 79     }
 80 
 81 
 82     /**
 83      * Called by objects that are traversing the nodes of the tree implicitely
 84      * defined by the contents of a Java class. I.e., the hierarchy of methods,
 85      * fields, attributes, etc. spawns a tree of objects.
 86      *
 87      * @param v Visitor object
 88      */
 89     @Override
 90     public void accept( final Visitor v ) {
 91         v.visitNestMembers(this);
 92     }
 93 
 94 
 95     /**
 96      * Dump NestMembers attribute to file stream in binary format.
 97      *
 98      * @param file Output file stream
 99      * @throws IOException
100      */
101     @Override
102     public void dump( final DataOutputStream file ) throws IOException {
103         super.dump(file);
104         file.writeShort(classes.length);
105         for (final int index : classes) {
106             file.writeShort(index);
107         }
108     }
109 
110 
111     /**
112      * @return array of indices into constant pool of class names.
113      */
114     public int[] getClasses() {
115         return classes;
116     }
117 
118 
119     /**
120      * @return Length of classes table.
121      */
122     public int getNumberClasses() {
123         return classes == null ? 0 : classes.length;
124     }
125 
126 
127     /**
128      * @return string array of class names
129      */
130     public String[] getClassNames() {
131         final String[] names = new String[classes.length];
132         for (int i = 0; i &lt; classes.length; i++) {
133             names[i] = super.getConstantPool().getConstantString(classes[i],
134                     Const.CONSTANT_Class).replace(&#39;/&#39;, &#39;.&#39;);
135         }
136         return names;
137     }
138 
139 
140     /**
141      * @param classes the list of class indexes
142      * Also redefines number_of_classes according to table length.
143      */
144     public void setClasses( final int[] classes ) {
145         this.classes = classes != null ? classes : new int[0];
146     }
147 
148 
149     /**
150      * @return String representation, i.e., a list of classes.
151      */
152     @Override
153     public String toString() {
154         final StringBuilder buf = new StringBuilder();
155         buf.append(&quot;NestMembers(&quot;);
156         buf.append(classes.length);
157         buf.append(&quot;):\n&quot;);
158         for (final int index : classes) {
159             final String class_name = super.getConstantPool().getConstantString(index, Const.CONSTANT_Class);
160             buf.append(&quot;  &quot;).append(Utility.compactClassName(class_name, false)).append(&quot;\n&quot;);
161         }
162         return buf.substring(0, buf.length()-1); // remove the last newline
163     }
164 
165 
166     /**
167      * @return deep copy of this attribute
168      */
169     @Override
170     public Attribute copy( final ConstantPool _constant_pool ) {
171         final NestMembers c = (NestMembers) clone();
172         if (classes != null) {
173             c.classes = new int[classes.length];
174             System.arraycopy(classes, 0, c.classes, 0,
175                     classes.length);
176         }
177         c.setConstantPool(_constant_pool);
178         return c;
179     }
180 }
    </pre>
  </body>
</html>