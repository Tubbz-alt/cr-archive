<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/compiler/Parser.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../bcel/internal/util/SyntheticRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="XPathParser.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/compiler/Parser.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2015, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   3  */
   4 /*
   5  * Licensed to the Apache Software Foundation (ASF) under one or more
   6  * contributor license agreements.  See the NOTICE file distributed with
   7  * this work for additional information regarding copyright ownership.
   8  * The ASF licenses this file to You under the Apache License, Version 2.0
   9  * (the &quot;License&quot;); you may not use this file except in compliance with
  10  * the License.  You may obtain a copy of the License at
  11  *
  12  *     http://www.apache.org/licenses/LICENSE-2.0
  13  *
  14  * Unless required by applicable law or agreed to in writing, software
  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  17  * See the License for the specific language governing permissions and
  18  * limitations under the License.
  19  */
  20 
  21 package com.sun.org.apache.xalan.internal.xsltc.compiler;
  22 
</pre>
<hr />
<pre>
  25 import com.sun.org.apache.xalan.internal.utils.ObjectFactory;
  26 import com.sun.org.apache.xalan.internal.utils.XMLSecurityManager;
  27 import com.sun.org.apache.xalan.internal.xsltc.compiler.util.ErrorMsg;
  28 import com.sun.org.apache.xalan.internal.xsltc.compiler.util.MethodType;
  29 import com.sun.org.apache.xalan.internal.xsltc.compiler.util.Type;
  30 import com.sun.org.apache.xalan.internal.xsltc.compiler.util.TypeCheckError;
  31 import com.sun.org.apache.xml.internal.serializer.utils.SystemIDResolver;
  32 import java.io.File;
  33 import java.io.IOException;
  34 import java.io.StringReader;
  35 import java.util.ArrayList;
  36 import java.util.HashMap;
  37 import java.util.Iterator;
  38 import java.util.List;
  39 import java.util.Map;
  40 import java.util.Properties;
  41 import java.util.Stack;
  42 import java.util.StringTokenizer;
  43 import javax.xml.XMLConstants;
  44 import javax.xml.catalog.CatalogFeatures;

  45 import jdk.xml.internal.JdkXmlFeatures;
  46 import jdk.xml.internal.JdkXmlUtils;
  47 import jdk.xml.internal.SecuritySupport;
  48 import org.xml.sax.Attributes;
  49 import org.xml.sax.ContentHandler;
  50 import org.xml.sax.InputSource;
  51 import org.xml.sax.Locator;
  52 import org.xml.sax.SAXException;
  53 import org.xml.sax.SAXNotRecognizedException;
  54 import org.xml.sax.SAXNotSupportedException;
  55 import org.xml.sax.XMLReader;
  56 import org.xml.sax.helpers.AttributesImpl;
  57 
  58 /**
  59  * @author Jacek Ambroziak
  60  * @author Santiago Pericas-Geertsen
  61  * @author G. Todd Miller
  62  * @author Morten Jorgensen
  63  * @author Erwin Bolwidt &lt;ejb@klomp.org&gt;
<span class="line-modified">  64  * @LastModified: Nov 2017</span>
  65  */
  66 public class Parser implements Constants, ContentHandler {
  67 
  68     private static final String XSL = &quot;xsl&quot;;           // standard prefix
  69     private static final String TRANSLET = &quot;translet&quot;; // extension prefix
  70 
  71     private Locator _locator = null;
  72 
  73     private XSLTC _xsltc;                  // Reference to the compiler object.
  74     private XPathParser _xpathParser;      // Reference to the XPath parser.
  75     private ArrayList&lt;ErrorMsg&gt; _errors;   // Contains all compilation errors
  76     private ArrayList&lt;ErrorMsg&gt; _warnings; // Contains all compilation warnings
  77 
  78     private Map&lt;String, String&gt;   _instructionClasses; // Maps instructions to classes
  79     private Map&lt;String, String[]&gt; _instructionAttrs;  // reqd and opt attrs
  80     private Map&lt;String, QName&gt;    _qNames;
  81     private Map&lt;String, Map&lt;String, QName&gt;&gt; _namespaces;
  82     private QName       _useAttributeSets;
  83     private QName       _excludeResultPrefixes;
  84     private QName       _extensionElementPrefixes;
  85     private Map&lt;String, Object&gt;   _variableScope;
  86     private Stylesheet  _currentStylesheet;
  87     private SymbolTable _symbolTable; // Maps QNames to syntax-tree nodes
  88     private Output      _output;
  89     private Template    _template;    // Reference to the template being parsed.
  90 
  91     private boolean     _rootNamespaceDef; // Used for validity check
  92 
  93     private SyntaxTreeNode _root;
  94 
  95     private String _target;
  96 
  97     private int _currentImportPrecedence;
  98 
  99     private boolean _overrideDefaultParser;
 100 
<span class="line-modified"> 101     public Parser(XSLTC xsltc, boolean useOverrideDefaultParser) {</span>



 102         _xsltc = xsltc;
 103         _overrideDefaultParser = useOverrideDefaultParser;

 104     }
 105 
 106     public void init() {
 107         _qNames              = new HashMap&lt;&gt;(512);
 108         _namespaces          = new HashMap&lt;&gt;();
 109         _instructionClasses  = new HashMap&lt;&gt;();
 110         _instructionAttrs    = new HashMap&lt;&gt;();
 111         _variableScope       = new HashMap&lt;&gt;();
 112         _template            = null;
 113         _errors              = new ArrayList&lt;&gt;();
 114         _warnings            = new ArrayList&lt;&gt;();
 115         _symbolTable         = new SymbolTable();
 116         _xpathParser         = new XPathParser(this);
 117         _currentStylesheet   = null;
 118         _output              = null;
 119         _root                = null;
 120         _rootNamespaceDef    = false;
 121         _currentImportPrecedence = 1;
 122 
 123         initStdClasses();
</pre>
<hr />
<pre>
 409                 if (!errorsFound()) {
 410                     stylesheet.typeCheck(_symbolTable);
 411                 }
 412             }
 413         }
 414         catch (TypeCheckError e) {
 415             reportError(ERROR, new ErrorMsg(ErrorMsg.JAXP_COMPILE_ERR, e));
 416         }
 417     }
 418 
 419     /**
 420      * Parses a stylesheet and builds the internal abstract syntax tree
 421      * @param reader A SAX2 SAXReader (parser)
 422      * @param input A SAX2 InputSource can be passed to a SAX reader
 423      * @return The root of the abstract syntax tree
 424      */
 425     public SyntaxTreeNode parse(XMLReader reader, InputSource input) {
 426         try {
 427             // Parse the input document and build the abstract syntax tree
 428             reader.setContentHandler(this);





 429             reader.parse(input);
 430             // Find the start of the stylesheet within the tree
 431             return getStylesheet(_root);
 432         }
 433         catch (IOException e) {
 434             if (_xsltc.debug()) e.printStackTrace();
 435             reportError(ERROR,new ErrorMsg(ErrorMsg.JAXP_COMPILE_ERR, e));
 436         }
 437         catch (SAXException e) {
 438             Throwable ex = e.getException();
 439             if (_xsltc.debug()) {
 440                 e.printStackTrace();
 441                 if (ex != null) ex.printStackTrace();
 442             }
 443             reportError(ERROR, new ErrorMsg(ErrorMsg.JAXP_COMPILE_ERR, e));
 444         }
 445         catch (CompilerException e) {
 446             if (_xsltc.debug()) e.printStackTrace();
 447             reportError(ERROR, new ErrorMsg(ErrorMsg.JAXP_COMPILE_ERR, e));
 448         }
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  */
   4 /*
   5  * Licensed to the Apache Software Foundation (ASF) under one or more
   6  * contributor license agreements.  See the NOTICE file distributed with
   7  * this work for additional information regarding copyright ownership.
   8  * The ASF licenses this file to You under the Apache License, Version 2.0
   9  * (the &quot;License&quot;); you may not use this file except in compliance with
  10  * the License.  You may obtain a copy of the License at
  11  *
  12  *     http://www.apache.org/licenses/LICENSE-2.0
  13  *
  14  * Unless required by applicable law or agreed to in writing, software
  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  17  * See the License for the specific language governing permissions and
  18  * limitations under the License.
  19  */
  20 
  21 package com.sun.org.apache.xalan.internal.xsltc.compiler;
  22 
</pre>
<hr />
<pre>
  25 import com.sun.org.apache.xalan.internal.utils.ObjectFactory;
  26 import com.sun.org.apache.xalan.internal.utils.XMLSecurityManager;
  27 import com.sun.org.apache.xalan.internal.xsltc.compiler.util.ErrorMsg;
  28 import com.sun.org.apache.xalan.internal.xsltc.compiler.util.MethodType;
  29 import com.sun.org.apache.xalan.internal.xsltc.compiler.util.Type;
  30 import com.sun.org.apache.xalan.internal.xsltc.compiler.util.TypeCheckError;
  31 import com.sun.org.apache.xml.internal.serializer.utils.SystemIDResolver;
  32 import java.io.File;
  33 import java.io.IOException;
  34 import java.io.StringReader;
  35 import java.util.ArrayList;
  36 import java.util.HashMap;
  37 import java.util.Iterator;
  38 import java.util.List;
  39 import java.util.Map;
  40 import java.util.Properties;
  41 import java.util.Stack;
  42 import java.util.StringTokenizer;
  43 import javax.xml.XMLConstants;
  44 import javax.xml.catalog.CatalogFeatures;
<span class="line-added">  45 import jdk.xml.internal.ErrorHandlerProxy;</span>
  46 import jdk.xml.internal.JdkXmlFeatures;
  47 import jdk.xml.internal.JdkXmlUtils;
  48 import jdk.xml.internal.SecuritySupport;
  49 import org.xml.sax.Attributes;
  50 import org.xml.sax.ContentHandler;
  51 import org.xml.sax.InputSource;
  52 import org.xml.sax.Locator;
  53 import org.xml.sax.SAXException;
  54 import org.xml.sax.SAXNotRecognizedException;
  55 import org.xml.sax.SAXNotSupportedException;
  56 import org.xml.sax.XMLReader;
  57 import org.xml.sax.helpers.AttributesImpl;
  58 
  59 /**
  60  * @author Jacek Ambroziak
  61  * @author Santiago Pericas-Geertsen
  62  * @author G. Todd Miller
  63  * @author Morten Jorgensen
  64  * @author Erwin Bolwidt &lt;ejb@klomp.org&gt;
<span class="line-modified">  65  * @LastModified: July 2019</span>
  66  */
  67 public class Parser implements Constants, ContentHandler {
  68 
  69     private static final String XSL = &quot;xsl&quot;;           // standard prefix
  70     private static final String TRANSLET = &quot;translet&quot;; // extension prefix
  71 
  72     private Locator _locator = null;
  73 
  74     private XSLTC _xsltc;                  // Reference to the compiler object.
  75     private XPathParser _xpathParser;      // Reference to the XPath parser.
  76     private ArrayList&lt;ErrorMsg&gt; _errors;   // Contains all compilation errors
  77     private ArrayList&lt;ErrorMsg&gt; _warnings; // Contains all compilation warnings
  78 
  79     private Map&lt;String, String&gt;   _instructionClasses; // Maps instructions to classes
  80     private Map&lt;String, String[]&gt; _instructionAttrs;  // reqd and opt attrs
  81     private Map&lt;String, QName&gt;    _qNames;
  82     private Map&lt;String, Map&lt;String, QName&gt;&gt; _namespaces;
  83     private QName       _useAttributeSets;
  84     private QName       _excludeResultPrefixes;
  85     private QName       _extensionElementPrefixes;
  86     private Map&lt;String, Object&gt;   _variableScope;
  87     private Stylesheet  _currentStylesheet;
  88     private SymbolTable _symbolTable; // Maps QNames to syntax-tree nodes
  89     private Output      _output;
  90     private Template    _template;    // Reference to the template being parsed.
  91 
  92     private boolean     _rootNamespaceDef; // Used for validity check
  93 
  94     private SyntaxTreeNode _root;
  95 
  96     private String _target;
  97 
  98     private int _currentImportPrecedence;
  99 
 100     private boolean _overrideDefaultParser;
 101 
<span class="line-modified"> 102     // flag indicates whether there&#39;s an user&#39;s ErrorListener</span>
<span class="line-added"> 103     private boolean _hasUserErrListener;</span>
<span class="line-added"> 104 </span>
<span class="line-added"> 105     public Parser(XSLTC xsltc, boolean useOverrideDefaultParser, boolean hasUserErrListener) {</span>
 106         _xsltc = xsltc;
 107         _overrideDefaultParser = useOverrideDefaultParser;
<span class="line-added"> 108         _hasUserErrListener = hasUserErrListener;</span>
 109     }
 110 
 111     public void init() {
 112         _qNames              = new HashMap&lt;&gt;(512);
 113         _namespaces          = new HashMap&lt;&gt;();
 114         _instructionClasses  = new HashMap&lt;&gt;();
 115         _instructionAttrs    = new HashMap&lt;&gt;();
 116         _variableScope       = new HashMap&lt;&gt;();
 117         _template            = null;
 118         _errors              = new ArrayList&lt;&gt;();
 119         _warnings            = new ArrayList&lt;&gt;();
 120         _symbolTable         = new SymbolTable();
 121         _xpathParser         = new XPathParser(this);
 122         _currentStylesheet   = null;
 123         _output              = null;
 124         _root                = null;
 125         _rootNamespaceDef    = false;
 126         _currentImportPrecedence = 1;
 127 
 128         initStdClasses();
</pre>
<hr />
<pre>
 414                 if (!errorsFound()) {
 415                     stylesheet.typeCheck(_symbolTable);
 416                 }
 417             }
 418         }
 419         catch (TypeCheckError e) {
 420             reportError(ERROR, new ErrorMsg(ErrorMsg.JAXP_COMPILE_ERR, e));
 421         }
 422     }
 423 
 424     /**
 425      * Parses a stylesheet and builds the internal abstract syntax tree
 426      * @param reader A SAX2 SAXReader (parser)
 427      * @param input A SAX2 InputSource can be passed to a SAX reader
 428      * @return The root of the abstract syntax tree
 429      */
 430     public SyntaxTreeNode parse(XMLReader reader, InputSource input) {
 431         try {
 432             // Parse the input document and build the abstract syntax tree
 433             reader.setContentHandler(this);
<span class="line-added"> 434             if (_hasUserErrListener) {</span>
<span class="line-added"> 435                 // Set a ErrorHandler proxy to pass any parsing error on to be handled</span>
<span class="line-added"> 436                 // by the user&#39;s ErrorListener</span>
<span class="line-added"> 437                 reader.setErrorHandler(new ErrorHandlerProxy());</span>
<span class="line-added"> 438             }</span>
 439             reader.parse(input);
 440             // Find the start of the stylesheet within the tree
 441             return getStylesheet(_root);
 442         }
 443         catch (IOException e) {
 444             if (_xsltc.debug()) e.printStackTrace();
 445             reportError(ERROR,new ErrorMsg(ErrorMsg.JAXP_COMPILE_ERR, e));
 446         }
 447         catch (SAXException e) {
 448             Throwable ex = e.getException();
 449             if (_xsltc.debug()) {
 450                 e.printStackTrace();
 451                 if (ex != null) ex.printStackTrace();
 452             }
 453             reportError(ERROR, new ErrorMsg(ErrorMsg.JAXP_COMPILE_ERR, e));
 454         }
 455         catch (CompilerException e) {
 456             if (_xsltc.debug()) e.printStackTrace();
 457             reportError(ERROR, new ErrorMsg(ErrorMsg.JAXP_COMPILE_ERR, e));
 458         }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../bcel/internal/util/SyntheticRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="XPathParser.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>