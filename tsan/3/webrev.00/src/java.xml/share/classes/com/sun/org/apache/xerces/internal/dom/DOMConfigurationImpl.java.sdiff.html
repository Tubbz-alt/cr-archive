<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xerces/internal/dom/DOMConfigurationImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CoreDocumentImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="DOMNormalizer.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xerces/internal/dom/DOMConfigurationImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2013, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   3  */
   4 /*
   5  * Licensed to the Apache Software Foundation (ASF) under one or more
   6  * contributor license agreements.  See the NOTICE file distributed with
   7  * this work for additional information regarding copyright ownership.
   8  * The ASF licenses this file to You under the Apache License, Version 2.0
   9  * (the &quot;License&quot;); you may not use this file except in compliance with
  10  * the License.  You may obtain a copy of the License at
  11  *
  12  *      http://www.apache.org/licenses/LICENSE-2.0
  13  *
  14  * Unless required by applicable law or agreed to in writing, software
  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  17  * See the License for the specific language governing permissions and
  18  * limitations under the License.
  19  */
  20 
  21 package com.sun.org.apache.xerces.internal.dom;
  22 
  23 import com.sun.org.apache.xerces.internal.impl.Constants;
  24 import com.sun.org.apache.xerces.internal.impl.XMLEntityManager;
  25 import com.sun.org.apache.xerces.internal.impl.XMLErrorReporter;
  26 import com.sun.org.apache.xerces.internal.impl.dv.DTDDVFactory;
  27 import com.sun.org.apache.xerces.internal.impl.msg.XMLMessageFormatter;
  28 import com.sun.org.apache.xerces.internal.impl.validation.ValidationManager;
  29 import com.sun.org.apache.xerces.internal.util.DOMEntityResolverWrapper;
  30 import com.sun.org.apache.xerces.internal.util.DOMErrorHandlerWrapper;
  31 import com.sun.org.apache.xerces.internal.util.MessageFormatter;
  32 import com.sun.org.apache.xerces.internal.util.ParserConfigurationSettings;
  33 import com.sun.org.apache.xerces.internal.util.PropertyState;
  34 import com.sun.org.apache.xerces.internal.util.SymbolTable;
<span class="line-removed">  35 import com.sun.org.apache.xerces.internal.utils.ObjectFactory;</span>
  36 import com.sun.org.apache.xerces.internal.utils.XMLSecurityManager;
  37 import com.sun.org.apache.xerces.internal.utils.XMLSecurityPropertyManager;
  38 import com.sun.org.apache.xerces.internal.xni.XMLDTDContentModelHandler;
  39 import com.sun.org.apache.xerces.internal.xni.XMLDTDHandler;
  40 import com.sun.org.apache.xerces.internal.xni.XMLDocumentHandler;
  41 import com.sun.org.apache.xerces.internal.xni.XNIException;
  42 import com.sun.org.apache.xerces.internal.xni.grammars.XMLGrammarPool;
  43 import com.sun.org.apache.xerces.internal.xni.parser.XMLComponent;
  44 import com.sun.org.apache.xerces.internal.xni.parser.XMLComponentManager;
  45 import com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException;
  46 import com.sun.org.apache.xerces.internal.xni.parser.XMLEntityResolver;
  47 import com.sun.org.apache.xerces.internal.xni.parser.XMLErrorHandler;
  48 import com.sun.org.apache.xerces.internal.xni.parser.XMLInputSource;
  49 import com.sun.org.apache.xerces.internal.xni.parser.XMLParserConfiguration;
  50 import java.io.IOException;
  51 import java.util.ArrayList;
  52 import java.util.HashMap;
  53 import java.util.List;
  54 import java.util.Locale;

  55 import javax.xml.XMLConstants;
  56 import javax.xml.catalog.CatalogFeatures;
  57 import jdk.xml.internal.JdkXmlUtils;
  58 import org.w3c.dom.DOMConfiguration;
  59 import org.w3c.dom.DOMErrorHandler;
  60 import org.w3c.dom.DOMException;
  61 import org.w3c.dom.DOMStringList;
  62 import org.w3c.dom.ls.LSResourceResolver;
  63 
  64 
  65 
  66 /**
  67  * Xerces implementation of DOMConfiguration that maintains a table of recognized parameters.
  68  *
  69  * @xerces.internal
  70  *
  71  * @author Elena Litani, IBM
  72  * @author Neeraj Bajaj, Sun Microsystems.
<span class="line-modified">  73  * @LastModified: Oct 2017</span>
  74  */
  75 public class DOMConfigurationImpl extends ParserConfigurationSettings
  76     implements XMLParserConfiguration, DOMConfiguration {
  77 
  78     //
  79     // Constants
  80     //
  81 



  82     // feature identifiers
  83 
  84     /** Feature identifier: validation. */
  85     protected static final String XERCES_VALIDATION =
  86         Constants.SAX_FEATURE_PREFIX + Constants.VALIDATION_FEATURE;
  87 
  88     /** Feature identifier: namespaces. */
  89     protected static final String XERCES_NAMESPACES =
  90         Constants.SAX_FEATURE_PREFIX + Constants.NAMESPACES_FEATURE;
  91 
  92     protected static final String SCHEMA =
  93         Constants.XERCES_FEATURE_PREFIX + Constants.SCHEMA_VALIDATION_FEATURE;
  94 
  95     protected static final String SCHEMA_FULL_CHECKING =
  96         Constants.XERCES_FEATURE_PREFIX + Constants.SCHEMA_FULL_CHECKING;
  97 
  98     protected static final String DYNAMIC_VALIDATION =
  99         Constants.XERCES_FEATURE_PREFIX + Constants.DYNAMIC_VALIDATION_FEATURE;
 100 
 101     protected static final String NORMALIZE_DATA =
 102         Constants.XERCES_FEATURE_PREFIX + Constants.SCHEMA_NORMALIZED_VALUE;
 103 




 104     /** sending psvi in the pipeline */
 105     protected static final String SEND_PSVI =
 106         Constants.XERCES_FEATURE_PREFIX + Constants.SCHEMA_AUGMENT_PSVI;
 107 
<span class="line-modified"> 108     protected final static String DTD_VALIDATOR_FACTORY_PROPERTY =</span>
<span class="line-modified"> 109         Constants.XERCES_PROPERTY_PREFIX + Constants.DATATYPE_VALIDATOR_FACTORY_PROPERTY;</span>

























 110 
 111     /** Feature identifier: namespace growth */
 112     protected static final String NAMESPACE_GROWTH =
 113         Constants.XERCES_FEATURE_PREFIX + Constants.NAMESPACE_GROWTH_FEATURE;
 114 
 115     protected static final String TOLERATE_DUPLICATES =
 116         Constants.XERCES_FEATURE_PREFIX + Constants.TOLERATE_DUPLICATES_FEATURE;
 117 
 118     // property identifiers
 119 
 120     /** Property identifier: entity manager. */
 121     protected static final String ENTITY_MANAGER =
 122         Constants.XERCES_PROPERTY_PREFIX + Constants.ENTITY_MANAGER_PROPERTY;
 123 
 124     /** Property identifier: error reporter. */
 125     protected static final String ERROR_REPORTER =
 126         Constants.XERCES_PROPERTY_PREFIX + Constants.ERROR_REPORTER_PROPERTY;
 127 
 128     /** Property identifier: xml string. */
 129     protected static final String XML_STRING =
 130         Constants.SAX_PROPERTY_PREFIX + Constants.XML_STRING_PROPERTY;
 131 
 132     /** Property identifier: symbol table. */
 133     protected static final String SYMBOL_TABLE =
 134         Constants.XERCES_PROPERTY_PREFIX + Constants.SYMBOL_TABLE_PROPERTY;
 135 
<span class="line-modified"> 136     /** Property id: Grammar pool*/</span>
 137     protected static final String GRAMMAR_POOL =
<span class="line-modified"> 138     Constants.XERCES_PROPERTY_PREFIX + Constants.XMLGRAMMAR_POOL_PROPERTY;</span>
 139 
 140     /** Property identifier: error handler. */
 141     protected static final String ERROR_HANDLER =
 142         Constants.XERCES_PROPERTY_PREFIX + Constants.ERROR_HANDLER_PROPERTY;
 143 
 144     /** Property identifier: entity resolver. */
 145     protected static final String ENTITY_RESOLVER =
 146         Constants.XERCES_PROPERTY_PREFIX + Constants.ENTITY_RESOLVER_PROPERTY;
 147 
 148     /** Property identifier: JAXP schema language / DOM schema-type. */
 149     protected static final String JAXP_SCHEMA_LANGUAGE =
<span class="line-modified"> 150     Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE;</span>
 151 
 152     /** Property identifier: JAXP schema source/ DOM schema-location. */
 153     protected static final String JAXP_SCHEMA_SOURCE =
<span class="line-modified"> 154     Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_SOURCE;</span>








 155 
 156     protected static final String VALIDATION_MANAGER =
 157         Constants.XERCES_PROPERTY_PREFIX + Constants.VALIDATION_MANAGER_PROPERTY;
 158 








 159     /** Property identifier: Schema DV Factory */
 160     protected static final String SCHEMA_DV_FACTORY =
 161         Constants.XERCES_PROPERTY_PREFIX + Constants.SCHEMA_DV_FACTORY_PROPERTY;
 162 
 163     /** Property identifier: Security manager. */
 164     private static final String SECURITY_MANAGER = Constants.SECURITY_MANAGER;
 165 
 166     /** Property identifier: Security property manager. */
 167     private static final String XML_SECURITY_PROPERTY_MANAGER =
 168             Constants.XML_SECURITY_PROPERTY_MANAGER;
 169 
 170     //
 171     // Data
 172     //
 173     XMLDocumentHandler fDocumentHandler;
 174 
 175     /** Normalization features*/
 176     protected short features = 0;
 177 
 178     protected final static short NAMESPACES          = 0x1&lt;&lt;0;
</pre>
<hr />
<pre>
 192 
 193     // components
 194 
 195     /** Symbol table. */
 196     protected SymbolTable fSymbolTable;
 197 
 198     /** Components. */
 199     protected List&lt;XMLComponent&gt; fComponents;
 200 
 201     protected ValidationManager fValidationManager;
 202 
 203     /** Locale. */
 204     protected Locale fLocale;
 205 
 206     /** Error reporter */
 207     protected XMLErrorReporter fErrorReporter;
 208 
 209     protected final DOMErrorHandlerWrapper fErrorHandlerWrapper =
 210                 new DOMErrorHandlerWrapper();
 211 









 212     // private data
 213 

 214     private DOMStringList fRecognizedParameters;
 215 
 216 
 217     //
 218     // Constructors
 219     //
 220 
 221     /** Default Constructor. */
 222     protected DOMConfigurationImpl() {
 223         this(null, null);
 224     } // &lt;init&gt;()
 225 
 226     /**
 227      * Constructs a parser configuration using the specified symbol table.
 228      *
 229      * @param symbolTable The symbol table to use.
 230      */
 231     protected DOMConfigurationImpl(SymbolTable symbolTable) {
 232         this(symbolTable, null);
 233     } // &lt;init&gt;(SymbolTable)
</pre>
<hr />
<pre>
 239      * @param symbolTable    The symbol table to use.
 240      * @param parentSettings The parent settings.
 241      */
 242     protected DOMConfigurationImpl(SymbolTable symbolTable,
 243                                     XMLComponentManager parentSettings) {
 244         super(parentSettings);
 245 
 246 
 247         // create table for features and properties
 248         fFeatures = new HashMap&lt;&gt;();
 249         fProperties = new HashMap&lt;&gt;();
 250 
 251         // add default recognized features
 252         final String[] recognizedFeatures = {
 253             XERCES_VALIDATION,
 254             XERCES_NAMESPACES,
 255             SCHEMA,
 256             SCHEMA_FULL_CHECKING,
 257             DYNAMIC_VALIDATION,
 258             NORMALIZE_DATA,

 259             SEND_PSVI,








 260             NAMESPACE_GROWTH,
 261             TOLERATE_DUPLICATES,
 262             XMLConstants.USE_CATALOG,
 263             JdkXmlUtils.OVERRIDE_PARSER
 264         };
 265         addRecognizedFeatures(recognizedFeatures);
 266 
 267         // set state for default features
 268         setFeature(XERCES_VALIDATION, false);
 269         setFeature(SCHEMA, false);
 270         setFeature(SCHEMA_FULL_CHECKING, false);
 271         setFeature(DYNAMIC_VALIDATION, false);
 272         setFeature(NORMALIZE_DATA, false);

 273         setFeature(XERCES_NAMESPACES, true);
 274         setFeature(SEND_PSVI, true);








 275         setFeature(NAMESPACE_GROWTH, false);

 276         setFeature(XMLConstants.USE_CATALOG, JdkXmlUtils.USE_CATALOG_DEFAULT);
 277         setFeature(JdkXmlUtils.OVERRIDE_PARSER, JdkXmlUtils.OVERRIDE_PARSER_DEFAULT);
 278 
 279         // add default recognized properties
 280         final String[] recognizedProperties = {
 281             XML_STRING,
 282             SYMBOL_TABLE,
 283             ERROR_HANDLER,
 284             ENTITY_RESOLVER,
 285             ERROR_REPORTER,
 286             ENTITY_MANAGER,
 287             VALIDATION_MANAGER,
 288             GRAMMAR_POOL,
 289             JAXP_SCHEMA_SOURCE,
 290             JAXP_SCHEMA_LANGUAGE,



 291             DTD_VALIDATOR_FACTORY_PROPERTY,
 292             SCHEMA_DV_FACTORY,
 293             SECURITY_MANAGER,
 294             XML_SECURITY_PROPERTY_MANAGER,
 295             JdkXmlUtils.CATALOG_DEFER,
 296             JdkXmlUtils.CATALOG_FILES,
 297             JdkXmlUtils.CATALOG_PREFER,
 298             JdkXmlUtils.CATALOG_RESOLVE,
 299             JdkXmlUtils.CDATA_CHUNK_SIZE
 300         };
 301         addRecognizedProperties(recognizedProperties);
 302 
 303         // set default values for normalization features
 304         features |= NAMESPACES;
 305         features |= ENTITIES;
 306         features |= COMMENTS;
 307         features |= CDATA;
 308         features |= SPLITCDATA;
 309         features |= WELLFORMED;
 310         features |= NSDECL;
 311 
 312         if (symbolTable == null) {
 313             symbolTable = new SymbolTable();
 314         }
 315         fSymbolTable = symbolTable;
 316 
 317         fComponents = new ArrayList&lt;&gt;();
 318 
 319         setProperty(SYMBOL_TABLE, fSymbolTable);
 320         fErrorReporter = new XMLErrorReporter();
 321         setProperty(ERROR_REPORTER, fErrorReporter);
 322         addComponent(fErrorReporter);
 323 
<span class="line-modified"> 324         setProperty(DTD_VALIDATOR_FACTORY_PROPERTY, DTDDVFactory.getInstance());</span>



 325 
 326         XMLEntityManager manager =  new XMLEntityManager();
 327         setProperty(ENTITY_MANAGER, manager);
 328         addComponent(manager);
 329 
 330         fValidationManager = createValidationManager();
 331         setProperty(VALIDATION_MANAGER, fValidationManager);
 332 
 333         setProperty(SECURITY_MANAGER, new XMLSecurityManager(true));
 334 
 335         setProperty(Constants.XML_SECURITY_PROPERTY_MANAGER,
 336                 new XMLSecurityPropertyManager());
 337 
 338         // add message formatters
 339         if (fErrorReporter.getMessageFormatter(XMLMessageFormatter.XML_DOMAIN) == null) {
 340             XMLMessageFormatter xmft = new XMLMessageFormatter();
 341             fErrorReporter.putMessageFormatter(XMLMessageFormatter.XML_DOMAIN, xmft);
 342             fErrorReporter.putMessageFormatter(XMLMessageFormatter.XMLNS_DOMAIN, xmft);
 343         }
 344 
 345         // REVISIT: try to include XML Schema formatter.
 346         //          This is a hack to allow DTD configuration to be build.
 347         //
 348         if (fErrorReporter.getMessageFormatter(&quot;http://www.w3.org/TR/xml-schema-1&quot;) == null) {
 349             MessageFormatter xmft = null;
 350             try {
<span class="line-modified"> 351                xmft = (MessageFormatter)(</span>
<span class="line-removed"> 352                     ObjectFactory.newInstance(&quot;com.sun.org.apache.xerces.internal.impl.xs.XSMessageFormatter&quot;, true));</span>
 353             } catch (Exception exception){
 354             }
 355 
 356              if (xmft !=  null) {
 357                  fErrorReporter.putMessageFormatter(&quot;http://www.w3.org/TR/xml-schema-1&quot;, xmft);
 358              }
 359         }
 360 
 361 
 362         // set locale
 363         try {
 364             setLocale(Locale.getDefault());
 365         }
 366         catch (XNIException e) {
 367             // do nothing
 368             // REVISIT: What is the right thing to do? -Ac
 369         }
 370 
 371         // Initialize Catalog features
 372         for( CatalogFeatures.Feature f : CatalogFeatures.Feature.values()) {
</pre>
<hr />
<pre>
 379 
 380     //
 381     // XMLParserConfiguration methods
 382     //
 383 
 384     /**
 385      * Parse an XML document.
 386      * &lt;p&gt;
 387      * The parser can use this method to instruct this configuration
 388      * to begin parsing an XML document from any valid input source
 389      * (a character stream, a byte stream, or a URI).
 390      * &lt;p&gt;
 391      * Parsers may not invoke this method while a parse is in progress.
 392      * Once a parse is complete, the parser may then parse another XML
 393      * document.
 394      * &lt;p&gt;
 395      * This method is synchronous: it will not return until parsing
 396      * has ended.  If a client application wants to terminate
 397      * parsing early, it should throw an exception.
 398      *
<span class="line-modified"> 399      * @param source The input source for the top-level of the</span>
<span class="line-modified"> 400      *               XML document.</span>
 401      *
 402      * @exception XNIException Any XNI exception, possibly wrapping
 403      *                         another exception.
 404      * @exception IOException  An IO exception from the parser, possibly
 405      *                         from a byte stream or character stream
 406      *                         supplied by the parser.
 407      */
 408     public void parse(XMLInputSource inputSource)
 409         throws XNIException, IOException{
 410         // no-op
 411     }
 412 
 413     /**
 414      * Sets the document handler on the last component in the pipeline
 415      * to receive information about the document.
 416      *
 417      * @param documentHandler   The document handler.
 418      */
 419     public void setDocumentHandler(XMLDocumentHandler documentHandler) {
 420         fDocumentHandler = documentHandler;
</pre>
<hr />
<pre>
 445      * @param handler The DTD content model handler.
 446      */
 447     public void setDTDContentModelHandler(XMLDTDContentModelHandler handler) {
 448         //no-op
 449 
 450     } // setDTDContentModelHandler(XMLDTDContentModelHandler)
 451 
 452     /** Returns the registered DTD content model handler. */
 453     public XMLDTDContentModelHandler getDTDContentModelHandler() {
 454         return null;
 455     } // getDTDContentModelHandler():XMLDTDContentModelHandler
 456 
 457     /**
 458      * Sets the resolver used to resolve external entities. The EntityResolver
 459      * interface supports resolution of public and system identifiers.
 460      *
 461      * @param resolver The new entity resolver. Passing a null value will
 462      *                 uninstall the currently installed resolver.
 463      */
 464     public void setEntityResolver(XMLEntityResolver resolver) {
<span class="line-modified"> 465         if (resolver !=null) {</span>
<span class="line-removed"> 466             fProperties.put(ENTITY_RESOLVER, resolver);</span>
<span class="line-removed"> 467         }</span>
 468     } // setEntityResolver(XMLEntityResolver)
 469 
 470     /**
 471      * Return the current entity resolver.
 472      *
 473      * @return The current entity resolver, or null if none
 474      *         has been registered.
 475      * @see #setEntityResolver
 476      */
 477     public XMLEntityResolver getEntityResolver() {
 478         return (XMLEntityResolver)fProperties.get(ENTITY_RESOLVER);
 479     } // getEntityResolver():XMLEntityResolver
 480 
 481     /**
 482      * Allow an application to register an error event handler.
 483      *
 484      * &lt;p&gt;If the application does not register an error handler, all
 485      * error events reported by the SAX parser will be silently
 486      * ignored; however, normal processing may not continue.  It is
 487      * highly recommended that all SAX applications implement an
</pre>
<hr />
<pre>
 496      *            argument is null.
 497      * @see #getErrorHandler
 498      */
 499     public void setErrorHandler(XMLErrorHandler errorHandler) {
 500         if (errorHandler != null) {
 501             fProperties.put(ERROR_HANDLER, errorHandler);
 502         }
 503     } // setErrorHandler(XMLErrorHandler)
 504 
 505     /**
 506      * Return the current error handler.
 507      *
 508      * @return The current error handler, or null if none
 509      *         has been registered.
 510      * @see #setErrorHandler
 511      */
 512     public XMLErrorHandler getErrorHandler() {
 513         return (XMLErrorHandler)fProperties.get(ERROR_HANDLER);
 514     } // getErrorHandler():XMLErrorHandler
 515 




















 516     /**
 517      * Set the state of a feature.
 518      *
 519      * Set the state of any feature in a SAX2 parser.  The parser
 520      * might not recognize the feature, and if it does recognize
 521      * it, it might not be able to fulfill the request.
 522      *
 523      * @param featureId The unique identifier (URI) of the feature.
 524      * @param state The requested state of the feature (true or false).
 525      *
 526      * @exception com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException If the
 527      *            requested feature is not known.
 528      */
 529     public void setFeature(String featureId, boolean state)
 530         throws XMLConfigurationException {
 531 
 532         // save state if noone &quot;objects&quot;
 533         super.setFeature(featureId, state);
 534 
 535     } // setFeature(String,boolean)
</pre>
<hr />
<pre>
 559     public void setLocale(Locale locale) throws XNIException {
 560         fLocale = locale;
 561         fErrorReporter.setLocale(locale);
 562 
 563     } // setLocale(Locale)
 564 
 565     /** Returns the locale. */
 566     public Locale getLocale() {
 567         return fLocale;
 568     } // getLocale():Locale
 569 
 570     /**
 571      * DOM Level 3 WD - Experimental.
 572      * setParameter
 573      */
 574     public void setParameter(String name, Object value) throws DOMException {
 575         boolean found = true;
 576 
 577         // REVISIT: Recognizes DOM L3 default features only.
 578         //          Does not yet recognize Xerces features.
<span class="line-modified"> 579                 if(value instanceof Boolean){</span>
<span class="line-modified"> 580                         boolean state = ((Boolean)value).booleanValue();</span>
 581 
 582             if (name.equalsIgnoreCase(Constants.DOM_COMMENTS)) {
 583                 features = (short) (state ? features | COMMENTS : features &amp; ~COMMENTS);
 584             }
 585             else if (name.equalsIgnoreCase(Constants.DOM_DATATYPE_NORMALIZATION)) {
 586                 setFeature(NORMALIZE_DATA, state);
 587                 features =
 588                     (short) (state ? features | DTNORMALIZATION : features &amp; ~DTNORMALIZATION);
 589                 if (state) {
 590                     features = (short) (features | VALIDATE);
 591                 }
 592             }
 593             else if (name.equalsIgnoreCase(Constants.DOM_NAMESPACES)) {
 594                 features = (short) (state ? features | NAMESPACES : features &amp; ~NAMESPACES);
 595             }
 596             else if (name.equalsIgnoreCase(Constants.DOM_CDATA_SECTIONS)) {
 597                 features = (short) (state ? features | CDATA : features &amp; ~CDATA);
 598             }
 599             else if (name.equalsIgnoreCase(Constants.DOM_ENTITIES)) {
 600                 features = (short) (state ? features | ENTITIES : features &amp; ~ENTITIES);
</pre>
<hr />
<pre>
 608             else if (name.equalsIgnoreCase(Constants.DOM_WELLFORMED)) {
 609                 features = (short) (state ? features | WELLFORMED : features &amp; ~WELLFORMED );
 610             }
 611             else if (name.equalsIgnoreCase(Constants.DOM_NAMESPACE_DECLARATIONS)) {
 612                 features = (short) (state ? features | NSDECL : features &amp; ~NSDECL);
 613             }
 614             else if (name.equalsIgnoreCase(Constants.DOM_INFOSET)) {
 615                 // Setting to false has no effect.
 616                 if (state) {
 617                     features = (short) (features | INFOSET_TRUE_PARAMS);
 618                     features = (short) (features &amp; ~INFOSET_FALSE_PARAMS);
 619                     setFeature(NORMALIZE_DATA, false);
 620                 }
 621             }
 622             else if (name.equalsIgnoreCase(Constants.DOM_NORMALIZE_CHARACTERS)
 623                     || name.equalsIgnoreCase(Constants.DOM_CANONICAL_FORM)
 624                     || name.equalsIgnoreCase(Constants.DOM_VALIDATE_IF_SCHEMA)
 625                     || name.equalsIgnoreCase(Constants.DOM_CHECK_CHAR_NORMALIZATION)
 626                     ) {
 627                 if (state) { // true is not supported
<span class="line-modified"> 628                     String msg =</span>
<span class="line-removed"> 629                         DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 630                             DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 631                             &quot;FEATURE_NOT_SUPPORTED&quot;,</span>
<span class="line-removed"> 632                             new Object[] { name });</span>
<span class="line-removed"> 633                     throw new DOMException(DOMException.NOT_SUPPORTED_ERR, msg);</span>
 634                 }
 635             }
 636                         else if ( name.equalsIgnoreCase(Constants.DOM_ELEMENT_CONTENT_WHITESPACE)) {
 637                 if (!state) { // false is not supported
<span class="line-modified"> 638                     String msg =</span>
<span class="line-removed"> 639                         DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 640                             DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 641                             &quot;FEATURE_NOT_SUPPORTED&quot;,</span>
<span class="line-removed"> 642                             new Object[] { name });</span>
<span class="line-removed"> 643                    throw new DOMException(DOMException.NOT_SUPPORTED_ERR, msg);</span>
 644                 }
 645             }
 646             else if (name.equalsIgnoreCase(SEND_PSVI) ){
 647                 // REVISIT: turning augmentation of PSVI is not support,
 648                 // because in this case we won&#39;t be able to retrieve element
 649                 // default value.
 650                 if (!state) { // false is not supported
<span class="line-modified"> 651                     String msg =</span>
<span class="line-removed"> 652                         DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 653                             DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 654                             &quot;FEATURE_NOT_SUPPORTED&quot;,</span>
<span class="line-removed"> 655                             new Object[] { name });</span>
<span class="line-removed"> 656                     throw new DOMException(DOMException.NOT_SUPPORTED_ERR, msg);</span>
 657                 }
 658             }
 659             else if (name.equalsIgnoreCase(Constants.DOM_PSVI)){
 660                   features = (short) (state ? features | PSVI : features &amp; ~PSVI);
 661             }
 662             else {
 663                 found = false;
 664                 /*
 665                 String msg =
 666                     DOMMessageFormatter.formatMessage(
 667                         DOMMessageFormatter.DOM_DOMAIN,
 668                         &quot;FEATURE_NOT_FOUND&quot;,
 669                         new Object[] { name });
 670                 throw new DOMException(DOMException.NOT_FOUND_ERR, msg);
 671                 */
 672             }
 673 
 674         }
 675 
<span class="line-modified"> 676                 if (!found || !(value instanceof Boolean))  { // set properties</span>
<span class="line-modified"> 677                         found = true;</span>
 678 
 679             if (name.equalsIgnoreCase(Constants.DOM_ERROR_HANDLER)) {
 680                 if (value instanceof DOMErrorHandler || value == null) {
 681                     fErrorHandlerWrapper.setErrorHandler((DOMErrorHandler)value);
 682                     setErrorHandler(fErrorHandlerWrapper);
 683                 }
<span class="line-removed"> 684 </span>
 685                 else {
<span class="line-modified"> 686                     // REVISIT: type mismatch</span>
<span class="line-removed"> 687                     String msg =</span>
<span class="line-removed"> 688                         DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 689                             DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 690                             &quot;TYPE_MISMATCH_ERR&quot;,</span>
<span class="line-removed"> 691                             new Object[] { name });</span>
<span class="line-removed"> 692                     throw new DOMException(DOMException.TYPE_MISMATCH_ERR, msg);</span>
 693                 }
 694             }
 695             else if (name.equalsIgnoreCase(Constants.DOM_RESOURCE_RESOLVER)) {
 696                 if (value instanceof LSResourceResolver || value == null) {
 697                     try {
 698                         setEntityResolver(new DOMEntityResolverWrapper((LSResourceResolver) value));
 699                     }
 700                     catch (XMLConfigurationException e) {}
 701                 }
 702                 else {
<span class="line-modified"> 703                     // REVISIT: type mismatch</span>
<span class="line-removed"> 704                     String msg =</span>
<span class="line-removed"> 705                         DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 706                             DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 707                             &quot;TYPE_MISMATCH_ERR&quot;,</span>
<span class="line-removed"> 708                             new Object[] { name });</span>
<span class="line-removed"> 709                     throw new DOMException(DOMException.TYPE_MISMATCH_ERR, msg);</span>
 710                 }
<span class="line-removed"> 711 </span>
 712             }
 713             else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_LOCATION)) {
 714                 if (value instanceof String || value == null) {
 715                     try {
<span class="line-modified"> 716                         // map DOM schema-location to JAXP schemaSource property</span>
<span class="line-modified"> 717                         setProperty(</span>
<span class="line-modified"> 718                             Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_SOURCE,</span>
<span class="line-modified"> 719                             value);</span>























 720                     }
 721                     catch (XMLConfigurationException e) {}
 722                 }
 723                 else {
<span class="line-modified"> 724                     // REVISIT: type mismatch</span>
<span class="line-removed"> 725                     String msg =</span>
<span class="line-removed"> 726                         DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 727                             DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 728                             &quot;TYPE_MISMATCH_ERR&quot;,</span>
<span class="line-removed"> 729                             new Object[] { name });</span>
<span class="line-removed"> 730                     throw new DOMException(DOMException.TYPE_MISMATCH_ERR, msg);</span>
 731                 }
<span class="line-removed"> 732 </span>
 733             }
 734             else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_TYPE)) {
 735                 if (value instanceof String || value == null) {
 736                     try {
 737                         if (value == null) {
 738                             setProperty(
 739                                 Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE,
 740                                 null);
 741                         }
 742                         else if (value.equals(Constants.NS_XMLSCHEMA)) {
 743                             // REVISIT: when add support to DTD validation
 744                             setProperty(
 745                                 Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE,
 746                                 Constants.NS_XMLSCHEMA);
 747                         }
 748                         else if (value.equals(Constants.NS_DTD)) {
 749                             // Added support for revalidation against DTDs
 750                                 setProperty(Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE,
 751                                                 Constants.NS_DTD);
 752                         }
 753                     }
 754                     catch (XMLConfigurationException e) {}
 755                 }
 756                 else {
<span class="line-modified"> 757                     String msg =</span>
<span class="line-removed"> 758                         DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 759                             DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 760                             &quot;TYPE_MISMATCH_ERR&quot;,</span>
<span class="line-removed"> 761                             new Object[] { name });</span>
<span class="line-removed"> 762                     throw new DOMException(DOMException.TYPE_MISMATCH_ERR, msg);</span>
 763                 }
<span class="line-removed"> 764 </span>
 765             }
<span class="line-modified"> 766             else if (name.equalsIgnoreCase(SYMBOL_TABLE)){</span>











 767                 // Xerces Symbol Table
 768                 if (value instanceof SymbolTable){
 769                     setProperty(SYMBOL_TABLE, value);
 770                 }
 771                 else {
<span class="line-modified"> 772                     // REVISIT: type mismatch</span>
<span class="line-removed"> 773                     String msg =</span>
<span class="line-removed"> 774                         DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 775                             DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 776                             &quot;TYPE_MISMATCH_ERR&quot;,</span>
<span class="line-removed"> 777                             new Object[] { name });</span>
<span class="line-removed"> 778                     throw new DOMException(DOMException.TYPE_MISMATCH_ERR, msg);</span>
 779                 }
 780             }
<span class="line-modified"> 781             else if (name.equalsIgnoreCase (GRAMMAR_POOL)){</span>
<span class="line-modified"> 782                 if (value instanceof XMLGrammarPool){</span>
 783                     setProperty(GRAMMAR_POOL, value);
 784                 }
 785                 else {
<span class="line-modified"> 786                     // REVISIT: type mismatch</span>
<span class="line-removed"> 787                     String msg =</span>
<span class="line-removed"> 788                         DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 789                             DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 790                             &quot;TYPE_MISMATCH_ERR&quot;,</span>
<span class="line-removed"> 791                             new Object[] { name });</span>
<span class="line-removed"> 792                     throw new DOMException(DOMException.TYPE_MISMATCH_ERR, msg);</span>
 793                 }
<span class="line-removed"> 794 </span>
 795             }
<span class="line-modified"> 796             else {</span>
 797                 // REVISIT: check if this is a boolean parameter -- type mismatch should be thrown.
 798                 //parameter is not recognized
<span class="line-modified"> 799                 String msg =</span>
<span class="line-removed"> 800                     DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 801                         DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 802                         &quot;FEATURE_NOT_FOUND&quot;,</span>
<span class="line-removed"> 803                         new Object[] { name });</span>
<span class="line-removed"> 804                 throw new DOMException(DOMException.NOT_FOUND_ERR, msg);</span>
 805             }
 806         }
<span class="line-removed"> 807 </span>
 808     }
 809 
 810 
 811     /**
 812      * DOM Level 3 WD - Experimental.
 813      * getParameter
 814      */
 815         public Object getParameter(String name) throws DOMException {
 816 
 817                 // REVISIT: Recognizes DOM L3 default features only.
 818                 //          Does not yet recognize Xerces features.
 819 
 820                 if (name.equalsIgnoreCase(Constants.DOM_COMMENTS)) {
 821                         return ((features &amp; COMMENTS) != 0) ? Boolean.TRUE : Boolean.FALSE;
 822                 }
 823                 else if (name.equalsIgnoreCase(Constants.DOM_NAMESPACES)) {
 824                         return (features &amp; NAMESPACES) != 0 ? Boolean.TRUE : Boolean.FALSE;
 825                 }
 826                 else if (name.equalsIgnoreCase(Constants.DOM_DATATYPE_NORMALIZATION)) {
 827                         // REVISIT: datatype-normalization only takes effect if validation is on
</pre>
<hr />
<pre>
 861         else if (name.equalsIgnoreCase(Constants.DOM_PSVI)) {
 862             return (features &amp; PSVI) != 0 ? Boolean.TRUE : Boolean.FALSE;
 863         }
 864         else if (name.equalsIgnoreCase(Constants.DOM_ELEMENT_CONTENT_WHITESPACE)) {
 865                         return Boolean.TRUE;
 866                 }
 867                 else if (name.equalsIgnoreCase(Constants.DOM_ERROR_HANDLER)) {
 868             return fErrorHandlerWrapper.getErrorHandler();
 869                 }
 870                 else if (name.equalsIgnoreCase(Constants.DOM_RESOURCE_RESOLVER)) {
 871                         XMLEntityResolver entityResolver = getEntityResolver();
 872                         if (entityResolver != null &amp;&amp; entityResolver instanceof DOMEntityResolverWrapper) {
 873                                 return ((DOMEntityResolverWrapper) entityResolver).getEntityResolver();
 874                         }
 875                         return null;
 876                 }
 877                 else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_TYPE)) {
 878                         return getProperty(Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE);
 879                 }
 880                 else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_LOCATION)) {
<span class="line-modified"> 881                         return getProperty(Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_SOURCE);</span>
 882                 }
<span class="line-modified"> 883         else if (name.equalsIgnoreCase(SYMBOL_TABLE)){</span>



 884             return getProperty(SYMBOL_TABLE);
 885         }
<span class="line-modified"> 886         else if (name.equalsIgnoreCase(GRAMMAR_POOL)){</span>
 887             return getProperty(GRAMMAR_POOL);



 888         }
 889                 else {
<span class="line-modified"> 890                         String msg =</span>
<span class="line-removed"> 891                                 DOMMessageFormatter.formatMessage(</span>
<span class="line-removed"> 892                                         DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-removed"> 893                                         &quot;FEATURE_NOT_FOUND&quot;,</span>
<span class="line-removed"> 894                                         new Object[] { name });</span>
<span class="line-removed"> 895                         throw new DOMException(DOMException.NOT_FOUND_ERR, msg);</span>
 896                 }
<span class="line-removed"> 897 </span>
 898         }
 899 
 900     /**
 901      * DOM Level 3 WD - Experimental.
 902      * Check if setting a parameter to a specific value is supported.
 903      *
 904      * @param name The name of the parameter to check.
 905      *
 906      * @param value An object. if null, the returned value is true.
 907      *
 908      * @return true if the parameter could be successfully set to the
 909      * specified value, or false if the parameter is not recognized or
 910      * the requested value is not supported. This does not change the
 911      * current value of the parameter itself.
 912      */
 913         public boolean canSetParameter(String name, Object value) {
 914 
 915         if (value == null){
 916             //if null, the returned value is true.
 917             //REVISIT: I dont like this --- even for unrecognized parameter it would
</pre>
<hr />
<pre>
 949             else if( name.equalsIgnoreCase(Constants.DOM_ELEMENT_CONTENT_WHITESPACE)
 950                     || name.equalsIgnoreCase(SEND_PSVI)
 951                     ) {
 952                     return (value.equals(Boolean.TRUE)) ? true : false;
 953             }// if name is not among the above listed above -- its not recognized. return false
 954             else {
 955                 return false ;
 956             }
 957         }
 958                 else if (name.equalsIgnoreCase(Constants.DOM_ERROR_HANDLER)) {
 959             return (value instanceof DOMErrorHandler) ? true : false ;
 960         }
 961         else if (name.equalsIgnoreCase(Constants.DOM_RESOURCE_RESOLVER)) {
 962             return (value instanceof LSResourceResolver) ? true : false ;
 963         }
 964         else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_LOCATION)) {
 965             return (value instanceof String) ? true : false ;
 966         }
 967         else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_TYPE)) {
 968             // REVISIT: should null value be supported?
<span class="line-modified"> 969             //as of now we are only supporting W3C XML Schema</span>
<span class="line-modified"> 970             return ( (value instanceof String) &amp;&amp; value.equals(Constants.NS_XMLSCHEMA) ) ? true : false ;</span>




 971         }
<span class="line-modified"> 972         else if (name.equalsIgnoreCase(SYMBOL_TABLE)){</span>
 973             // Xerces Symbol Table
<span class="line-modified"> 974             return (value instanceof SymbolTable) ? true : false ;</span>
 975         }
<span class="line-modified"> 976         else if (name.equalsIgnoreCase (GRAMMAR_POOL)){</span>
<span class="line-modified"> 977             return (value instanceof XMLGrammarPool) ? true : false ;</span>
 978         }
 979         else {
 980             //false if the parameter is not recognized or the requested value is not supported.
 981             return false ;
 982         }
 983 
 984         } //canSetParameter
 985 
 986     /**
 987      *  DOM Level 3 CR - Experimental.
 988      *
 989      *  The list of the parameters supported by this
 990      * &lt;code&gt;DOMConfiguration&lt;/code&gt; object and for which at least one value
 991      * can be set by the application. Note that this list can also contain
 992      * parameter names defined outside this specification.
 993      */
<span class="line-modified"> 994     public DOMStringList getParameterNames() {</span>
<span class="line-modified"> 995         if (fRecognizedParameters == null){</span>
 996             List&lt;String&gt; parameters = new ArrayList&lt;&gt;();
 997 
<span class="line-modified"> 998             //Add DOM recognized parameters</span>
<span class="line-modified"> 999             //REVISIT: Would have been nice to have a list of</span>
<span class="line-modified">1000             //recognized paramters.</span>
<span class="line-modified">1001             parameters.add(Constants.DOM_COMMENTS);</span>
<span class="line-modified">1002             parameters.add(Constants.DOM_DATATYPE_NORMALIZATION);</span>
<span class="line-modified">1003             parameters.add(Constants.DOM_CDATA_SECTIONS);</span>
<span class="line-modified">1004             parameters.add(Constants.DOM_ENTITIES);</span>
<span class="line-modified">1005             parameters.add(Constants.DOM_SPLIT_CDATA);</span>
<span class="line-modified">1006             parameters.add(Constants.DOM_NAMESPACES);</span>
<span class="line-modified">1007             parameters.add(Constants.DOM_VALIDATE);</span>
<span class="line-modified">1008 </span>
<span class="line-modified">1009             parameters.add(Constants.DOM_INFOSET);</span>
<span class="line-modified">1010             parameters.add(Constants.DOM_NORMALIZE_CHARACTERS);</span>
<span class="line-modified">1011             parameters.add(Constants.DOM_CANONICAL_FORM);</span>
<span class="line-modified">1012             parameters.add(Constants.DOM_VALIDATE_IF_SCHEMA);</span>
<span class="line-modified">1013             parameters.add(Constants.DOM_CHECK_CHAR_NORMALIZATION);</span>
<span class="line-modified">1014             parameters.add(Constants.DOM_WELLFORMED);</span>
<span class="line-modified">1015 </span>
<span class="line-modified">1016             parameters.add(Constants.DOM_NAMESPACE_DECLARATIONS);</span>
<span class="line-modified">1017             parameters.add(Constants.DOM_ELEMENT_CONTENT_WHITESPACE);</span>
<span class="line-modified">1018 </span>
<span class="line-modified">1019             parameters.add(Constants.DOM_ERROR_HANDLER);</span>
<span class="line-modified">1020             parameters.add(Constants.DOM_SCHEMA_TYPE);</span>
<span class="line-modified">1021             parameters.add(Constants.DOM_SCHEMA_LOCATION);</span>
<span class="line-modified">1022             parameters.add(Constants.DOM_RESOURCE_RESOLVER);</span>
<span class="line-modified">1023 </span>
<span class="line-modified">1024             //Add recognized xerces features and properties</span>
<span class="line-modified">1025             parameters.add(GRAMMAR_POOL);</span>
<span class="line-modified">1026             parameters.add(SYMBOL_TABLE);</span>
<span class="line-modified">1027             parameters.add(SEND_PSVI);</span>
<span class="line-modified">1028 </span>
<span class="line-modified">1029             fRecognizedParameters = new DOMStringListImpl(parameters);</span>
<span class="line-modified">1030         }</span>

1031 
<span class="line-modified">1032         return fRecognizedParameters;</span>
<span class="line-modified">1033     }//getParameterNames</span>


1034 
1035     //
1036     // Protected methods
1037     //
1038 
1039     /**
1040      * reset all components before parsing
1041      */
1042     protected void reset() throws XNIException {
1043 
1044         if (fValidationManager != null)
1045             fValidationManager.reset();
1046 
1047         int count = fComponents.size();
1048         for (int i = 0; i &lt; count; i++) {
1049             XMLComponent c = fComponents.get(i);
1050             c.reset(this);
1051         }
1052 
1053     } // reset()
1054 
1055     /**
1056      * Check a property. If the property is known and supported, this method
1057      * simply returns. Otherwise, the appropriate exception is thrown.
1058      *
1059      * @param propertyId The unique identifier (URI) of the property
1060      *                   being set.
1061      * @exception com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException If the
1062      *            requested feature is not known or supported.
1063      */

1064     protected PropertyState checkProperty(String propertyId)
1065         throws XMLConfigurationException {
1066 
1067         // special cases
1068         if (propertyId.startsWith(Constants.SAX_PROPERTY_PREFIX)) {
1069             final int suffixLength = propertyId.length() - Constants.SAX_PROPERTY_PREFIX.length();
1070 
1071             //
1072             // http://xml.org/sax/properties/xml-string
1073             // Value type: String
1074             // Access: read-only
1075             //   Get the literal string of characters associated with the
1076             //   current event.  If the parser recognises and supports this
1077             //   property but is not currently parsing text, it should return
1078             //   null (this is a good way to check for availability before the
1079             //   parse begins).
1080             //
1081             if (suffixLength == Constants.XML_STRING_PROPERTY.length() &amp;&amp;
1082                 propertyId.endsWith(Constants.XML_STRING_PROPERTY)) {
1083                 // REVISIT - we should probably ask xml-dev for a precise
</pre>
<hr />
<pre>
1098         // don&#39;t add a component more than once
1099         if (fComponents.contains(component)) {
1100             return;
1101         }
1102         fComponents.add(component);
1103 
1104         // register component&#39;s recognized features
1105         String[] recognizedFeatures = component.getRecognizedFeatures();
1106         addRecognizedFeatures(recognizedFeatures);
1107 
1108         // register component&#39;s recognized properties
1109         String[] recognizedProperties = component.getRecognizedProperties();
1110         addRecognizedProperties(recognizedProperties);
1111 
1112     } // addComponent(XMLComponent)
1113 
1114     protected ValidationManager createValidationManager(){
1115         return new ValidationManager();
1116     }
1117 
<span class="line-modified">1118 } // class XMLParser</span>








































</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  */
   4 /*
   5  * Licensed to the Apache Software Foundation (ASF) under one or more
   6  * contributor license agreements.  See the NOTICE file distributed with
   7  * this work for additional information regarding copyright ownership.
   8  * The ASF licenses this file to You under the Apache License, Version 2.0
   9  * (the &quot;License&quot;); you may not use this file except in compliance with
  10  * the License.  You may obtain a copy of the License at
  11  *
  12  *      http://www.apache.org/licenses/LICENSE-2.0
  13  *
  14  * Unless required by applicable law or agreed to in writing, software
  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  17  * See the License for the specific language governing permissions and
  18  * limitations under the License.
  19  */
  20 
  21 package com.sun.org.apache.xerces.internal.dom;
  22 
  23 import com.sun.org.apache.xerces.internal.impl.Constants;
  24 import com.sun.org.apache.xerces.internal.impl.XMLEntityManager;
  25 import com.sun.org.apache.xerces.internal.impl.XMLErrorReporter;
  26 import com.sun.org.apache.xerces.internal.impl.dv.DTDDVFactory;
  27 import com.sun.org.apache.xerces.internal.impl.msg.XMLMessageFormatter;
  28 import com.sun.org.apache.xerces.internal.impl.validation.ValidationManager;
  29 import com.sun.org.apache.xerces.internal.util.DOMEntityResolverWrapper;
  30 import com.sun.org.apache.xerces.internal.util.DOMErrorHandlerWrapper;
  31 import com.sun.org.apache.xerces.internal.util.MessageFormatter;
  32 import com.sun.org.apache.xerces.internal.util.ParserConfigurationSettings;
  33 import com.sun.org.apache.xerces.internal.util.PropertyState;
  34 import com.sun.org.apache.xerces.internal.util.SymbolTable;

  35 import com.sun.org.apache.xerces.internal.utils.XMLSecurityManager;
  36 import com.sun.org.apache.xerces.internal.utils.XMLSecurityPropertyManager;
  37 import com.sun.org.apache.xerces.internal.xni.XMLDTDContentModelHandler;
  38 import com.sun.org.apache.xerces.internal.xni.XMLDTDHandler;
  39 import com.sun.org.apache.xerces.internal.xni.XMLDocumentHandler;
  40 import com.sun.org.apache.xerces.internal.xni.XNIException;
  41 import com.sun.org.apache.xerces.internal.xni.grammars.XMLGrammarPool;
  42 import com.sun.org.apache.xerces.internal.xni.parser.XMLComponent;
  43 import com.sun.org.apache.xerces.internal.xni.parser.XMLComponentManager;
  44 import com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException;
  45 import com.sun.org.apache.xerces.internal.xni.parser.XMLEntityResolver;
  46 import com.sun.org.apache.xerces.internal.xni.parser.XMLErrorHandler;
  47 import com.sun.org.apache.xerces.internal.xni.parser.XMLInputSource;
  48 import com.sun.org.apache.xerces.internal.xni.parser.XMLParserConfiguration;
  49 import java.io.IOException;
  50 import java.util.ArrayList;
  51 import java.util.HashMap;
  52 import java.util.List;
  53 import java.util.Locale;
<span class="line-added">  54 import java.util.StringTokenizer;</span>
  55 import javax.xml.XMLConstants;
  56 import javax.xml.catalog.CatalogFeatures;
  57 import jdk.xml.internal.JdkXmlUtils;
  58 import org.w3c.dom.DOMConfiguration;
  59 import org.w3c.dom.DOMErrorHandler;
  60 import org.w3c.dom.DOMException;
  61 import org.w3c.dom.DOMStringList;
  62 import org.w3c.dom.ls.LSResourceResolver;
  63 
  64 
  65 
  66 /**
  67  * Xerces implementation of DOMConfiguration that maintains a table of recognized parameters.
  68  *
  69  * @xerces.internal
  70  *
  71  * @author Elena Litani, IBM
  72  * @author Neeraj Bajaj, Sun Microsystems.
<span class="line-modified">  73  * @LastModified: Apr 2019</span>
  74  */
  75 public class DOMConfigurationImpl extends ParserConfigurationSettings
  76     implements XMLParserConfiguration, DOMConfiguration {
  77 
  78     //
  79     // Constants
  80     //
  81 
<span class="line-added">  82     protected static final String XML11_DATATYPE_VALIDATOR_FACTORY =</span>
<span class="line-added">  83         &quot;com.sun.org.apache.xerces.internal.impl.dv.dtd.XML11DTDDVFactoryImpl&quot;;</span>
<span class="line-added">  84 </span>
  85     // feature identifiers
  86 
  87     /** Feature identifier: validation. */
  88     protected static final String XERCES_VALIDATION =
  89         Constants.SAX_FEATURE_PREFIX + Constants.VALIDATION_FEATURE;
  90 
  91     /** Feature identifier: namespaces. */
  92     protected static final String XERCES_NAMESPACES =
  93         Constants.SAX_FEATURE_PREFIX + Constants.NAMESPACES_FEATURE;
  94 
  95     protected static final String SCHEMA =
  96         Constants.XERCES_FEATURE_PREFIX + Constants.SCHEMA_VALIDATION_FEATURE;
  97 
  98     protected static final String SCHEMA_FULL_CHECKING =
  99         Constants.XERCES_FEATURE_PREFIX + Constants.SCHEMA_FULL_CHECKING;
 100 
 101     protected static final String DYNAMIC_VALIDATION =
 102         Constants.XERCES_FEATURE_PREFIX + Constants.DYNAMIC_VALIDATION_FEATURE;
 103 
 104     protected static final String NORMALIZE_DATA =
 105         Constants.XERCES_FEATURE_PREFIX + Constants.SCHEMA_NORMALIZED_VALUE;
 106 
<span class="line-added"> 107     /** Feature identifier: send element default value via characters() */</span>
<span class="line-added"> 108     protected static final String SCHEMA_ELEMENT_DEFAULT =</span>
<span class="line-added"> 109         Constants.XERCES_FEATURE_PREFIX + Constants.SCHEMA_ELEMENT_DEFAULT;</span>
<span class="line-added"> 110 </span>
 111     /** sending psvi in the pipeline */
 112     protected static final String SEND_PSVI =
 113         Constants.XERCES_FEATURE_PREFIX + Constants.SCHEMA_AUGMENT_PSVI;
 114 
<span class="line-modified"> 115     /** Feature: generate synthetic annotations */</span>
<span class="line-modified"> 116     protected static final String GENERATE_SYNTHETIC_ANNOTATIONS =</span>
<span class="line-added"> 117         Constants.XERCES_FEATURE_PREFIX + Constants.GENERATE_SYNTHETIC_ANNOTATIONS_FEATURE;</span>
<span class="line-added"> 118 </span>
<span class="line-added"> 119     /** Feature identifier: validate annotations */</span>
<span class="line-added"> 120     protected static final String VALIDATE_ANNOTATIONS =</span>
<span class="line-added"> 121         Constants.XERCES_FEATURE_PREFIX + Constants.VALIDATE_ANNOTATIONS_FEATURE;</span>
<span class="line-added"> 122 </span>
<span class="line-added"> 123     /** Feature identifier: honour all schemaLocations */</span>
<span class="line-added"> 124     protected static final String HONOUR_ALL_SCHEMALOCATIONS =</span>
<span class="line-added"> 125         Constants.XERCES_FEATURE_PREFIX + Constants.HONOUR_ALL_SCHEMALOCATIONS_FEATURE;</span>
<span class="line-added"> 126 </span>
<span class="line-added"> 127     /** Feature identifier: use grammar pool only */</span>
<span class="line-added"> 128     protected static final String USE_GRAMMAR_POOL_ONLY =</span>
<span class="line-added"> 129         Constants.XERCES_FEATURE_PREFIX + Constants.USE_GRAMMAR_POOL_ONLY_FEATURE;</span>
<span class="line-added"> 130 </span>
<span class="line-added"> 131     /** Feature identifier: load external DTD. */</span>
<span class="line-added"> 132     protected static final String DISALLOW_DOCTYPE_DECL_FEATURE =</span>
<span class="line-added"> 133         Constants.XERCES_FEATURE_PREFIX + Constants.DISALLOW_DOCTYPE_DECL_FEATURE;</span>
<span class="line-added"> 134 </span>
<span class="line-added"> 135     /** Feature identifier: balance syntax trees. */</span>
<span class="line-added"> 136     protected static final String BALANCE_SYNTAX_TREES =</span>
<span class="line-added"> 137         Constants.XERCES_FEATURE_PREFIX + Constants.BALANCE_SYNTAX_TREES;</span>
<span class="line-added"> 138 </span>
<span class="line-added"> 139     /** Feature identifier: warn on duplicate attribute definition. */</span>
<span class="line-added"> 140     protected static final String WARN_ON_DUPLICATE_ATTDEF =</span>
<span class="line-added"> 141         Constants.XERCES_FEATURE_PREFIX + Constants.WARN_ON_DUPLICATE_ATTDEF_FEATURE;</span>
 142 
 143     /** Feature identifier: namespace growth */
 144     protected static final String NAMESPACE_GROWTH =
 145         Constants.XERCES_FEATURE_PREFIX + Constants.NAMESPACE_GROWTH_FEATURE;
 146 
 147     protected static final String TOLERATE_DUPLICATES =
 148         Constants.XERCES_FEATURE_PREFIX + Constants.TOLERATE_DUPLICATES_FEATURE;
 149 
 150     // property identifiers
 151 
 152     /** Property identifier: entity manager. */
 153     protected static final String ENTITY_MANAGER =
 154         Constants.XERCES_PROPERTY_PREFIX + Constants.ENTITY_MANAGER_PROPERTY;
 155 
 156     /** Property identifier: error reporter. */
 157     protected static final String ERROR_REPORTER =
 158         Constants.XERCES_PROPERTY_PREFIX + Constants.ERROR_REPORTER_PROPERTY;
 159 
 160     /** Property identifier: xml string. */
 161     protected static final String XML_STRING =
 162         Constants.SAX_PROPERTY_PREFIX + Constants.XML_STRING_PROPERTY;
 163 
 164     /** Property identifier: symbol table. */
 165     protected static final String SYMBOL_TABLE =
 166         Constants.XERCES_PROPERTY_PREFIX + Constants.SYMBOL_TABLE_PROPERTY;
 167 
<span class="line-modified"> 168     /** Property id: Grammar pool. */</span>
 169     protected static final String GRAMMAR_POOL =
<span class="line-modified"> 170         Constants.XERCES_PROPERTY_PREFIX + Constants.XMLGRAMMAR_POOL_PROPERTY;</span>
 171 
 172     /** Property identifier: error handler. */
 173     protected static final String ERROR_HANDLER =
 174         Constants.XERCES_PROPERTY_PREFIX + Constants.ERROR_HANDLER_PROPERTY;
 175 
 176     /** Property identifier: entity resolver. */
 177     protected static final String ENTITY_RESOLVER =
 178         Constants.XERCES_PROPERTY_PREFIX + Constants.ENTITY_RESOLVER_PROPERTY;
 179 
 180     /** Property identifier: JAXP schema language / DOM schema-type. */
 181     protected static final String JAXP_SCHEMA_LANGUAGE =
<span class="line-modified"> 182         Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE;</span>
 183 
 184     /** Property identifier: JAXP schema source/ DOM schema-location. */
 185     protected static final String JAXP_SCHEMA_SOURCE =
<span class="line-modified"> 186         Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_SOURCE;</span>
<span class="line-added"> 187 </span>
<span class="line-added"> 188     /** Property identifier: DTD validator. */</span>
<span class="line-added"> 189     protected final static String DTD_VALIDATOR_PROPERTY =</span>
<span class="line-added"> 190         Constants.XERCES_PROPERTY_PREFIX + Constants.DTD_VALIDATOR_PROPERTY;</span>
<span class="line-added"> 191 </span>
<span class="line-added"> 192     /** Property identifier: datatype validator factory. */</span>
<span class="line-added"> 193     protected static final String DTD_VALIDATOR_FACTORY_PROPERTY =</span>
<span class="line-added"> 194         Constants.XERCES_PROPERTY_PREFIX + Constants.DATATYPE_VALIDATOR_FACTORY_PROPERTY;</span>
 195 
 196     protected static final String VALIDATION_MANAGER =
 197         Constants.XERCES_PROPERTY_PREFIX + Constants.VALIDATION_MANAGER_PROPERTY;
 198 
<span class="line-added"> 199     /** Property identifier: schema location. */</span>
<span class="line-added"> 200     protected static final String SCHEMA_LOCATION =</span>
<span class="line-added"> 201         Constants.XERCES_PROPERTY_PREFIX + Constants.SCHEMA_LOCATION;</span>
<span class="line-added"> 202 </span>
<span class="line-added"> 203     /** Property identifier: no namespace schema location. */</span>
<span class="line-added"> 204     protected static final String SCHEMA_NONS_LOCATION =</span>
<span class="line-added"> 205         Constants.XERCES_PROPERTY_PREFIX + Constants.SCHEMA_NONS_LOCATION;</span>
<span class="line-added"> 206 </span>
 207     /** Property identifier: Schema DV Factory */
 208     protected static final String SCHEMA_DV_FACTORY =
 209         Constants.XERCES_PROPERTY_PREFIX + Constants.SCHEMA_DV_FACTORY_PROPERTY;
 210 
 211     /** Property identifier: Security manager. */
 212     private static final String SECURITY_MANAGER = Constants.SECURITY_MANAGER;
 213 
 214     /** Property identifier: Security property manager. */
 215     private static final String XML_SECURITY_PROPERTY_MANAGER =
 216             Constants.XML_SECURITY_PROPERTY_MANAGER;
 217 
 218     //
 219     // Data
 220     //
 221     XMLDocumentHandler fDocumentHandler;
 222 
 223     /** Normalization features*/
 224     protected short features = 0;
 225 
 226     protected final static short NAMESPACES          = 0x1&lt;&lt;0;
</pre>
<hr />
<pre>
 240 
 241     // components
 242 
 243     /** Symbol table. */
 244     protected SymbolTable fSymbolTable;
 245 
 246     /** Components. */
 247     protected List&lt;XMLComponent&gt; fComponents;
 248 
 249     protected ValidationManager fValidationManager;
 250 
 251     /** Locale. */
 252     protected Locale fLocale;
 253 
 254     /** Error reporter */
 255     protected XMLErrorReporter fErrorReporter;
 256 
 257     protected final DOMErrorHandlerWrapper fErrorHandlerWrapper =
 258                 new DOMErrorHandlerWrapper();
 259 
<span class="line-added"> 260     /** Current Datatype validator factory. */</span>
<span class="line-added"> 261     protected DTDDVFactory fCurrentDVFactory;</span>
<span class="line-added"> 262 </span>
<span class="line-added"> 263     /** The XML 1.0 Datatype validator factory. */</span>
<span class="line-added"> 264     protected DTDDVFactory fDatatypeValidatorFactory;</span>
<span class="line-added"> 265 </span>
<span class="line-added"> 266     /** The XML 1.1 Datatype validator factory. **/</span>
<span class="line-added"> 267     protected DTDDVFactory fXML11DatatypeFactory;</span>
<span class="line-added"> 268 </span>
 269     // private data
 270 
<span class="line-added"> 271     private String fSchemaLocation = null;</span>
 272     private DOMStringList fRecognizedParameters;
 273 
 274 
 275     //
 276     // Constructors
 277     //
 278 
 279     /** Default Constructor. */
 280     protected DOMConfigurationImpl() {
 281         this(null, null);
 282     } // &lt;init&gt;()
 283 
 284     /**
 285      * Constructs a parser configuration using the specified symbol table.
 286      *
 287      * @param symbolTable The symbol table to use.
 288      */
 289     protected DOMConfigurationImpl(SymbolTable symbolTable) {
 290         this(symbolTable, null);
 291     } // &lt;init&gt;(SymbolTable)
</pre>
<hr />
<pre>
 297      * @param symbolTable    The symbol table to use.
 298      * @param parentSettings The parent settings.
 299      */
 300     protected DOMConfigurationImpl(SymbolTable symbolTable,
 301                                     XMLComponentManager parentSettings) {
 302         super(parentSettings);
 303 
 304 
 305         // create table for features and properties
 306         fFeatures = new HashMap&lt;&gt;();
 307         fProperties = new HashMap&lt;&gt;();
 308 
 309         // add default recognized features
 310         final String[] recognizedFeatures = {
 311             XERCES_VALIDATION,
 312             XERCES_NAMESPACES,
 313             SCHEMA,
 314             SCHEMA_FULL_CHECKING,
 315             DYNAMIC_VALIDATION,
 316             NORMALIZE_DATA,
<span class="line-added"> 317             SCHEMA_ELEMENT_DEFAULT,</span>
 318             SEND_PSVI,
<span class="line-added"> 319             GENERATE_SYNTHETIC_ANNOTATIONS,</span>
<span class="line-added"> 320             VALIDATE_ANNOTATIONS,</span>
<span class="line-added"> 321             HONOUR_ALL_SCHEMALOCATIONS,</span>
<span class="line-added"> 322             USE_GRAMMAR_POOL_ONLY,</span>
<span class="line-added"> 323             DISALLOW_DOCTYPE_DECL_FEATURE,</span>
<span class="line-added"> 324             BALANCE_SYNTAX_TREES,</span>
<span class="line-added"> 325             WARN_ON_DUPLICATE_ATTDEF,</span>
<span class="line-added"> 326             PARSER_SETTINGS,</span>
 327             NAMESPACE_GROWTH,
 328             TOLERATE_DUPLICATES,
 329             XMLConstants.USE_CATALOG,
 330             JdkXmlUtils.OVERRIDE_PARSER
 331         };
 332         addRecognizedFeatures(recognizedFeatures);
 333 
 334         // set state for default features
 335         setFeature(XERCES_VALIDATION, false);
 336         setFeature(SCHEMA, false);
 337         setFeature(SCHEMA_FULL_CHECKING, false);
 338         setFeature(DYNAMIC_VALIDATION, false);
 339         setFeature(NORMALIZE_DATA, false);
<span class="line-added"> 340         setFeature(SCHEMA_ELEMENT_DEFAULT, false);</span>
 341         setFeature(XERCES_NAMESPACES, true);
 342         setFeature(SEND_PSVI, true);
<span class="line-added"> 343         setFeature(GENERATE_SYNTHETIC_ANNOTATIONS, false);</span>
<span class="line-added"> 344         setFeature(VALIDATE_ANNOTATIONS, false);</span>
<span class="line-added"> 345         setFeature(HONOUR_ALL_SCHEMALOCATIONS, false);</span>
<span class="line-added"> 346         setFeature(USE_GRAMMAR_POOL_ONLY, false);</span>
<span class="line-added"> 347         setFeature(DISALLOW_DOCTYPE_DECL_FEATURE, false);</span>
<span class="line-added"> 348         setFeature(BALANCE_SYNTAX_TREES, false);</span>
<span class="line-added"> 349         setFeature(WARN_ON_DUPLICATE_ATTDEF, false);</span>
<span class="line-added"> 350         setFeature(PARSER_SETTINGS, true);</span>
 351         setFeature(NAMESPACE_GROWTH, false);
<span class="line-added"> 352         setFeature(TOLERATE_DUPLICATES, false);</span>
 353         setFeature(XMLConstants.USE_CATALOG, JdkXmlUtils.USE_CATALOG_DEFAULT);
 354         setFeature(JdkXmlUtils.OVERRIDE_PARSER, JdkXmlUtils.OVERRIDE_PARSER_DEFAULT);
 355 
 356         // add default recognized properties
 357         final String[] recognizedProperties = {
 358             XML_STRING,
 359             SYMBOL_TABLE,
 360             ERROR_HANDLER,
 361             ENTITY_RESOLVER,
 362             ERROR_REPORTER,
 363             ENTITY_MANAGER,
 364             VALIDATION_MANAGER,
 365             GRAMMAR_POOL,
 366             JAXP_SCHEMA_SOURCE,
 367             JAXP_SCHEMA_LANGUAGE,
<span class="line-added"> 368             SCHEMA_LOCATION,</span>
<span class="line-added"> 369             SCHEMA_NONS_LOCATION,</span>
<span class="line-added"> 370             DTD_VALIDATOR_PROPERTY,</span>
 371             DTD_VALIDATOR_FACTORY_PROPERTY,
 372             SCHEMA_DV_FACTORY,
 373             SECURITY_MANAGER,
 374             XML_SECURITY_PROPERTY_MANAGER,
 375             JdkXmlUtils.CATALOG_DEFER,
 376             JdkXmlUtils.CATALOG_FILES,
 377             JdkXmlUtils.CATALOG_PREFER,
 378             JdkXmlUtils.CATALOG_RESOLVE,
 379             JdkXmlUtils.CDATA_CHUNK_SIZE
 380         };
 381         addRecognizedProperties(recognizedProperties);
 382 
 383         // set default values for normalization features
 384         features |= NAMESPACES;
 385         features |= ENTITIES;
 386         features |= COMMENTS;
 387         features |= CDATA;
 388         features |= SPLITCDATA;
 389         features |= WELLFORMED;
 390         features |= NSDECL;
 391 
 392         if (symbolTable == null) {
 393             symbolTable = new SymbolTable();
 394         }
 395         fSymbolTable = symbolTable;
 396 
 397         fComponents = new ArrayList&lt;&gt;();
 398 
 399         setProperty(SYMBOL_TABLE, fSymbolTable);
 400         fErrorReporter = new XMLErrorReporter();
 401         setProperty(ERROR_REPORTER, fErrorReporter);
 402         addComponent(fErrorReporter);
 403 
<span class="line-modified"> 404         fDatatypeValidatorFactory = DTDDVFactory.getInstance();</span>
<span class="line-added"> 405         fXML11DatatypeFactory = DTDDVFactory.getInstance(XML11_DATATYPE_VALIDATOR_FACTORY);</span>
<span class="line-added"> 406         fCurrentDVFactory = fDatatypeValidatorFactory;</span>
<span class="line-added"> 407         setProperty(DTD_VALIDATOR_FACTORY_PROPERTY, fCurrentDVFactory);</span>
 408 
 409         XMLEntityManager manager =  new XMLEntityManager();
 410         setProperty(ENTITY_MANAGER, manager);
 411         addComponent(manager);
 412 
 413         fValidationManager = createValidationManager();
 414         setProperty(VALIDATION_MANAGER, fValidationManager);
 415 
 416         setProperty(SECURITY_MANAGER, new XMLSecurityManager(true));
 417 
 418         setProperty(Constants.XML_SECURITY_PROPERTY_MANAGER,
 419                 new XMLSecurityPropertyManager());
 420 
 421         // add message formatters
 422         if (fErrorReporter.getMessageFormatter(XMLMessageFormatter.XML_DOMAIN) == null) {
 423             XMLMessageFormatter xmft = new XMLMessageFormatter();
 424             fErrorReporter.putMessageFormatter(XMLMessageFormatter.XML_DOMAIN, xmft);
 425             fErrorReporter.putMessageFormatter(XMLMessageFormatter.XMLNS_DOMAIN, xmft);
 426         }
 427 
 428         // REVISIT: try to include XML Schema formatter.
 429         //          This is a hack to allow DTD configuration to be build.
 430         //
 431         if (fErrorReporter.getMessageFormatter(&quot;http://www.w3.org/TR/xml-schema-1&quot;) == null) {
 432             MessageFormatter xmft = null;
 433             try {
<span class="line-modified"> 434                xmft = new com.sun.org.apache.xerces.internal.impl.xs.XSMessageFormatter();</span>

 435             } catch (Exception exception){
 436             }
 437 
 438              if (xmft !=  null) {
 439                  fErrorReporter.putMessageFormatter(&quot;http://www.w3.org/TR/xml-schema-1&quot;, xmft);
 440              }
 441         }
 442 
 443 
 444         // set locale
 445         try {
 446             setLocale(Locale.getDefault());
 447         }
 448         catch (XNIException e) {
 449             // do nothing
 450             // REVISIT: What is the right thing to do? -Ac
 451         }
 452 
 453         // Initialize Catalog features
 454         for( CatalogFeatures.Feature f : CatalogFeatures.Feature.values()) {
</pre>
<hr />
<pre>
 461 
 462     //
 463     // XMLParserConfiguration methods
 464     //
 465 
 466     /**
 467      * Parse an XML document.
 468      * &lt;p&gt;
 469      * The parser can use this method to instruct this configuration
 470      * to begin parsing an XML document from any valid input source
 471      * (a character stream, a byte stream, or a URI).
 472      * &lt;p&gt;
 473      * Parsers may not invoke this method while a parse is in progress.
 474      * Once a parse is complete, the parser may then parse another XML
 475      * document.
 476      * &lt;p&gt;
 477      * This method is synchronous: it will not return until parsing
 478      * has ended.  If a client application wants to terminate
 479      * parsing early, it should throw an exception.
 480      *
<span class="line-modified"> 481      * @param inputSource The input source for the top-level of the</span>
<span class="line-modified"> 482      *                    XML document.</span>
 483      *
 484      * @exception XNIException Any XNI exception, possibly wrapping
 485      *                         another exception.
 486      * @exception IOException  An IO exception from the parser, possibly
 487      *                         from a byte stream or character stream
 488      *                         supplied by the parser.
 489      */
 490     public void parse(XMLInputSource inputSource)
 491         throws XNIException, IOException{
 492         // no-op
 493     }
 494 
 495     /**
 496      * Sets the document handler on the last component in the pipeline
 497      * to receive information about the document.
 498      *
 499      * @param documentHandler   The document handler.
 500      */
 501     public void setDocumentHandler(XMLDocumentHandler documentHandler) {
 502         fDocumentHandler = documentHandler;
</pre>
<hr />
<pre>
 527      * @param handler The DTD content model handler.
 528      */
 529     public void setDTDContentModelHandler(XMLDTDContentModelHandler handler) {
 530         //no-op
 531 
 532     } // setDTDContentModelHandler(XMLDTDContentModelHandler)
 533 
 534     /** Returns the registered DTD content model handler. */
 535     public XMLDTDContentModelHandler getDTDContentModelHandler() {
 536         return null;
 537     } // getDTDContentModelHandler():XMLDTDContentModelHandler
 538 
 539     /**
 540      * Sets the resolver used to resolve external entities. The EntityResolver
 541      * interface supports resolution of public and system identifiers.
 542      *
 543      * @param resolver The new entity resolver. Passing a null value will
 544      *                 uninstall the currently installed resolver.
 545      */
 546     public void setEntityResolver(XMLEntityResolver resolver) {
<span class="line-modified"> 547         fProperties.put(ENTITY_RESOLVER, resolver);</span>


 548     } // setEntityResolver(XMLEntityResolver)
 549 
 550     /**
 551      * Return the current entity resolver.
 552      *
 553      * @return The current entity resolver, or null if none
 554      *         has been registered.
 555      * @see #setEntityResolver
 556      */
 557     public XMLEntityResolver getEntityResolver() {
 558         return (XMLEntityResolver)fProperties.get(ENTITY_RESOLVER);
 559     } // getEntityResolver():XMLEntityResolver
 560 
 561     /**
 562      * Allow an application to register an error event handler.
 563      *
 564      * &lt;p&gt;If the application does not register an error handler, all
 565      * error events reported by the SAX parser will be silently
 566      * ignored; however, normal processing may not continue.  It is
 567      * highly recommended that all SAX applications implement an
</pre>
<hr />
<pre>
 576      *            argument is null.
 577      * @see #getErrorHandler
 578      */
 579     public void setErrorHandler(XMLErrorHandler errorHandler) {
 580         if (errorHandler != null) {
 581             fProperties.put(ERROR_HANDLER, errorHandler);
 582         }
 583     } // setErrorHandler(XMLErrorHandler)
 584 
 585     /**
 586      * Return the current error handler.
 587      *
 588      * @return The current error handler, or null if none
 589      *         has been registered.
 590      * @see #setErrorHandler
 591      */
 592     public XMLErrorHandler getErrorHandler() {
 593         return (XMLErrorHandler)fProperties.get(ERROR_HANDLER);
 594     } // getErrorHandler():XMLErrorHandler
 595 
<span class="line-added"> 596     /**</span>
<span class="line-added"> 597      * Returns the state of a feature.</span>
<span class="line-added"> 598      *</span>
<span class="line-added"> 599      * @param featureId The feature identifier.</span>
<span class="line-added"> 600      * @return true if the feature is supported</span>
<span class="line-added"> 601      *</span>
<span class="line-added"> 602      * @throws XMLConfigurationException Thrown for configuration error.</span>
<span class="line-added"> 603      *                                   In general, components should</span>
<span class="line-added"> 604      *                                   only throw this exception if</span>
<span class="line-added"> 605      *                                   it is &lt;strong&gt;really&lt;/strong&gt;</span>
<span class="line-added"> 606      *                                   a critical error.</span>
<span class="line-added"> 607      */</span>
<span class="line-added"> 608     public boolean getFeature(String featureId)</span>
<span class="line-added"> 609         throws XMLConfigurationException {</span>
<span class="line-added"> 610         if (featureId.equals(PARSER_SETTINGS)) {</span>
<span class="line-added"> 611             return true;</span>
<span class="line-added"> 612         }</span>
<span class="line-added"> 613         return super.getFeature(featureId);</span>
<span class="line-added"> 614     }</span>
<span class="line-added"> 615 </span>
 616     /**
 617      * Set the state of a feature.
 618      *
 619      * Set the state of any feature in a SAX2 parser.  The parser
 620      * might not recognize the feature, and if it does recognize
 621      * it, it might not be able to fulfill the request.
 622      *
 623      * @param featureId The unique identifier (URI) of the feature.
 624      * @param state The requested state of the feature (true or false).
 625      *
 626      * @exception com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException If the
 627      *            requested feature is not known.
 628      */
 629     public void setFeature(String featureId, boolean state)
 630         throws XMLConfigurationException {
 631 
 632         // save state if noone &quot;objects&quot;
 633         super.setFeature(featureId, state);
 634 
 635     } // setFeature(String,boolean)
</pre>
<hr />
<pre>
 659     public void setLocale(Locale locale) throws XNIException {
 660         fLocale = locale;
 661         fErrorReporter.setLocale(locale);
 662 
 663     } // setLocale(Locale)
 664 
 665     /** Returns the locale. */
 666     public Locale getLocale() {
 667         return fLocale;
 668     } // getLocale():Locale
 669 
 670     /**
 671      * DOM Level 3 WD - Experimental.
 672      * setParameter
 673      */
 674     public void setParameter(String name, Object value) throws DOMException {
 675         boolean found = true;
 676 
 677         // REVISIT: Recognizes DOM L3 default features only.
 678         //          Does not yet recognize Xerces features.
<span class="line-modified"> 679         if(value instanceof Boolean){</span>
<span class="line-modified"> 680             boolean state = ((Boolean)value).booleanValue();</span>
 681 
 682             if (name.equalsIgnoreCase(Constants.DOM_COMMENTS)) {
 683                 features = (short) (state ? features | COMMENTS : features &amp; ~COMMENTS);
 684             }
 685             else if (name.equalsIgnoreCase(Constants.DOM_DATATYPE_NORMALIZATION)) {
 686                 setFeature(NORMALIZE_DATA, state);
 687                 features =
 688                     (short) (state ? features | DTNORMALIZATION : features &amp; ~DTNORMALIZATION);
 689                 if (state) {
 690                     features = (short) (features | VALIDATE);
 691                 }
 692             }
 693             else if (name.equalsIgnoreCase(Constants.DOM_NAMESPACES)) {
 694                 features = (short) (state ? features | NAMESPACES : features &amp; ~NAMESPACES);
 695             }
 696             else if (name.equalsIgnoreCase(Constants.DOM_CDATA_SECTIONS)) {
 697                 features = (short) (state ? features | CDATA : features &amp; ~CDATA);
 698             }
 699             else if (name.equalsIgnoreCase(Constants.DOM_ENTITIES)) {
 700                 features = (short) (state ? features | ENTITIES : features &amp; ~ENTITIES);
</pre>
<hr />
<pre>
 708             else if (name.equalsIgnoreCase(Constants.DOM_WELLFORMED)) {
 709                 features = (short) (state ? features | WELLFORMED : features &amp; ~WELLFORMED );
 710             }
 711             else if (name.equalsIgnoreCase(Constants.DOM_NAMESPACE_DECLARATIONS)) {
 712                 features = (short) (state ? features | NSDECL : features &amp; ~NSDECL);
 713             }
 714             else if (name.equalsIgnoreCase(Constants.DOM_INFOSET)) {
 715                 // Setting to false has no effect.
 716                 if (state) {
 717                     features = (short) (features | INFOSET_TRUE_PARAMS);
 718                     features = (short) (features &amp; ~INFOSET_FALSE_PARAMS);
 719                     setFeature(NORMALIZE_DATA, false);
 720                 }
 721             }
 722             else if (name.equalsIgnoreCase(Constants.DOM_NORMALIZE_CHARACTERS)
 723                     || name.equalsIgnoreCase(Constants.DOM_CANONICAL_FORM)
 724                     || name.equalsIgnoreCase(Constants.DOM_VALIDATE_IF_SCHEMA)
 725                     || name.equalsIgnoreCase(Constants.DOM_CHECK_CHAR_NORMALIZATION)
 726                     ) {
 727                 if (state) { // true is not supported
<span class="line-modified"> 728                     throw newFeatureNotSupportedError(name);</span>





 729                 }
 730             }
 731                         else if ( name.equalsIgnoreCase(Constants.DOM_ELEMENT_CONTENT_WHITESPACE)) {
 732                 if (!state) { // false is not supported
<span class="line-modified"> 733                     throw newFeatureNotSupportedError(name);</span>





 734                 }
 735             }
 736             else if (name.equalsIgnoreCase(SEND_PSVI) ){
 737                 // REVISIT: turning augmentation of PSVI is not support,
 738                 // because in this case we won&#39;t be able to retrieve element
 739                 // default value.
 740                 if (!state) { // false is not supported
<span class="line-modified"> 741                     throw newFeatureNotSupportedError(name);</span>





 742                 }
 743             }
 744             else if (name.equalsIgnoreCase(Constants.DOM_PSVI)){
 745                   features = (short) (state ? features | PSVI : features &amp; ~PSVI);
 746             }
 747             else {
 748                 found = false;
 749                 /*
 750                 String msg =
 751                     DOMMessageFormatter.formatMessage(
 752                         DOMMessageFormatter.DOM_DOMAIN,
 753                         &quot;FEATURE_NOT_FOUND&quot;,
 754                         new Object[] { name });
 755                 throw new DOMException(DOMException.NOT_FOUND_ERR, msg);
 756                 */
 757             }
 758 
 759         }
 760 
<span class="line-modified"> 761         if (!found || !(value instanceof Boolean))  { // set properties</span>
<span class="line-modified"> 762                 found = true;</span>
 763 
 764             if (name.equalsIgnoreCase(Constants.DOM_ERROR_HANDLER)) {
 765                 if (value instanceof DOMErrorHandler || value == null) {
 766                     fErrorHandlerWrapper.setErrorHandler((DOMErrorHandler)value);
 767                     setErrorHandler(fErrorHandlerWrapper);
 768                 }

 769                 else {
<span class="line-modified"> 770                     throw newTypeMismatchError(name);</span>






 771                 }
 772             }
 773             else if (name.equalsIgnoreCase(Constants.DOM_RESOURCE_RESOLVER)) {
 774                 if (value instanceof LSResourceResolver || value == null) {
 775                     try {
 776                         setEntityResolver(new DOMEntityResolverWrapper((LSResourceResolver) value));
 777                     }
 778                     catch (XMLConfigurationException e) {}
 779                 }
 780                 else {
<span class="line-modified"> 781                     throw newTypeMismatchError(name);</span>






 782                 }

 783             }
 784             else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_LOCATION)) {
 785                 if (value instanceof String || value == null) {
 786                     try {
<span class="line-modified"> 787                         if (value == null) {</span>
<span class="line-modified"> 788                             fSchemaLocation = null;</span>
<span class="line-modified"> 789                             setProperty (</span>
<span class="line-modified"> 790                                 Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_SOURCE,</span>
<span class="line-added"> 791                                 null);</span>
<span class="line-added"> 792                         }</span>
<span class="line-added"> 793                         else {</span>
<span class="line-added"> 794                             fSchemaLocation = (String) value;</span>
<span class="line-added"> 795                             // map DOM schema-location to JAXP schemaSource property</span>
<span class="line-added"> 796                             // tokenize location string</span>
<span class="line-added"> 797                             StringTokenizer t = new StringTokenizer(fSchemaLocation, &quot; \n\t\r&quot;);</span>
<span class="line-added"> 798                             if (t.hasMoreTokens()) {</span>
<span class="line-added"> 799                                 List&lt;String&gt; locations = new ArrayList&lt;&gt;();</span>
<span class="line-added"> 800                                 locations.add(t.nextToken());</span>
<span class="line-added"> 801                                 while (t.hasMoreTokens()) {</span>
<span class="line-added"> 802                                     locations.add (t.nextToken());</span>
<span class="line-added"> 803                                 }</span>
<span class="line-added"> 804                                 setProperty (</span>
<span class="line-added"> 805                                     Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_SOURCE,</span>
<span class="line-added"> 806                                     locations.toArray(new String[locations.size()]));</span>
<span class="line-added"> 807                             }</span>
<span class="line-added"> 808                             else {</span>
<span class="line-added"> 809                                 setProperty (</span>
<span class="line-added"> 810                                     Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_SOURCE,</span>
<span class="line-added"> 811                                     new String [] {(String) value});</span>
<span class="line-added"> 812                             }</span>
<span class="line-added"> 813                         }</span>
 814                     }
 815                     catch (XMLConfigurationException e) {}
 816                 }
 817                 else {
<span class="line-modified"> 818                     throw newTypeMismatchError(name);</span>






 819                 }

 820             }
 821             else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_TYPE)) {
 822                 if (value instanceof String || value == null) {
 823                     try {
 824                         if (value == null) {
 825                             setProperty(
 826                                 Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE,
 827                                 null);
 828                         }
 829                         else if (value.equals(Constants.NS_XMLSCHEMA)) {
 830                             // REVISIT: when add support to DTD validation
 831                             setProperty(
 832                                 Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE,
 833                                 Constants.NS_XMLSCHEMA);
 834                         }
 835                         else if (value.equals(Constants.NS_DTD)) {
 836                             // Added support for revalidation against DTDs
 837                                 setProperty(Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE,
 838                                                 Constants.NS_DTD);
 839                         }
 840                     }
 841                     catch (XMLConfigurationException e) {}
 842                 }
 843                 else {
<span class="line-modified"> 844                     throw newTypeMismatchError(name);</span>





 845                 }

 846             }
<span class="line-modified"> 847             else if (name.equalsIgnoreCase(ENTITY_RESOLVER)) {</span>
<span class="line-added"> 848                 if (value instanceof XMLEntityResolver || value == null) {</span>
<span class="line-added"> 849                     try {</span>
<span class="line-added"> 850                         setEntityResolver((XMLEntityResolver) value);</span>
<span class="line-added"> 851                     }</span>
<span class="line-added"> 852                     catch (XMLConfigurationException e) {}</span>
<span class="line-added"> 853                 }</span>
<span class="line-added"> 854                 else {</span>
<span class="line-added"> 855                     throw newTypeMismatchError(name);</span>
<span class="line-added"> 856                 }</span>
<span class="line-added"> 857             }</span>
<span class="line-added"> 858             else if (name.equalsIgnoreCase(SYMBOL_TABLE)) {</span>
 859                 // Xerces Symbol Table
 860                 if (value instanceof SymbolTable){
 861                     setProperty(SYMBOL_TABLE, value);
 862                 }
 863                 else {
<span class="line-modified"> 864                     throw newTypeMismatchError(name);</span>






 865                 }
 866             }
<span class="line-modified"> 867             else if (name.equalsIgnoreCase (GRAMMAR_POOL)) {</span>
<span class="line-modified"> 868                 if (value instanceof XMLGrammarPool || value == null) {</span>
 869                     setProperty(GRAMMAR_POOL, value);
 870                 }
 871                 else {
<span class="line-modified"> 872                     throw newTypeMismatchError(name);</span>






 873                 }

 874             }
<span class="line-modified"> 875                 else {</span>
 876                 // REVISIT: check if this is a boolean parameter -- type mismatch should be thrown.
 877                 //parameter is not recognized
<span class="line-modified"> 878                 throw newFeatureNotFoundError(name);</span>





 879             }
 880         }

 881     }
 882 
 883 
 884     /**
 885      * DOM Level 3 WD - Experimental.
 886      * getParameter
 887      */
 888         public Object getParameter(String name) throws DOMException {
 889 
 890                 // REVISIT: Recognizes DOM L3 default features only.
 891                 //          Does not yet recognize Xerces features.
 892 
 893                 if (name.equalsIgnoreCase(Constants.DOM_COMMENTS)) {
 894                         return ((features &amp; COMMENTS) != 0) ? Boolean.TRUE : Boolean.FALSE;
 895                 }
 896                 else if (name.equalsIgnoreCase(Constants.DOM_NAMESPACES)) {
 897                         return (features &amp; NAMESPACES) != 0 ? Boolean.TRUE : Boolean.FALSE;
 898                 }
 899                 else if (name.equalsIgnoreCase(Constants.DOM_DATATYPE_NORMALIZATION)) {
 900                         // REVISIT: datatype-normalization only takes effect if validation is on
</pre>
<hr />
<pre>
 934         else if (name.equalsIgnoreCase(Constants.DOM_PSVI)) {
 935             return (features &amp; PSVI) != 0 ? Boolean.TRUE : Boolean.FALSE;
 936         }
 937         else if (name.equalsIgnoreCase(Constants.DOM_ELEMENT_CONTENT_WHITESPACE)) {
 938                         return Boolean.TRUE;
 939                 }
 940                 else if (name.equalsIgnoreCase(Constants.DOM_ERROR_HANDLER)) {
 941             return fErrorHandlerWrapper.getErrorHandler();
 942                 }
 943                 else if (name.equalsIgnoreCase(Constants.DOM_RESOURCE_RESOLVER)) {
 944                         XMLEntityResolver entityResolver = getEntityResolver();
 945                         if (entityResolver != null &amp;&amp; entityResolver instanceof DOMEntityResolverWrapper) {
 946                                 return ((DOMEntityResolverWrapper) entityResolver).getEntityResolver();
 947                         }
 948                         return null;
 949                 }
 950                 else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_TYPE)) {
 951                         return getProperty(Constants.JAXP_PROPERTY_PREFIX + Constants.SCHEMA_LANGUAGE);
 952                 }
 953                 else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_LOCATION)) {
<span class="line-modified"> 954             return fSchemaLocation;</span>
 955                 }
<span class="line-modified"> 956         else if (name.equalsIgnoreCase(ENTITY_RESOLVER)) {</span>
<span class="line-added"> 957             return getEntityResolver();</span>
<span class="line-added"> 958         }</span>
<span class="line-added"> 959         else if (name.equalsIgnoreCase(SYMBOL_TABLE)) {</span>
 960             return getProperty(SYMBOL_TABLE);
 961         }
<span class="line-modified"> 962         else if (name.equalsIgnoreCase(GRAMMAR_POOL)) {</span>
 963             return getProperty(GRAMMAR_POOL);
<span class="line-added"> 964         }</span>
<span class="line-added"> 965         else if (name.equalsIgnoreCase(SECURITY_MANAGER)) {</span>
<span class="line-added"> 966             return getProperty(SECURITY_MANAGER);</span>
 967         }
 968                 else {
<span class="line-modified"> 969                     throw newFeatureNotFoundError(name);</span>





 970                 }

 971         }
 972 
 973     /**
 974      * DOM Level 3 WD - Experimental.
 975      * Check if setting a parameter to a specific value is supported.
 976      *
 977      * @param name The name of the parameter to check.
 978      *
 979      * @param value An object. if null, the returned value is true.
 980      *
 981      * @return true if the parameter could be successfully set to the
 982      * specified value, or false if the parameter is not recognized or
 983      * the requested value is not supported. This does not change the
 984      * current value of the parameter itself.
 985      */
 986         public boolean canSetParameter(String name, Object value) {
 987 
 988         if (value == null){
 989             //if null, the returned value is true.
 990             //REVISIT: I dont like this --- even for unrecognized parameter it would
</pre>
<hr />
<pre>
1022             else if( name.equalsIgnoreCase(Constants.DOM_ELEMENT_CONTENT_WHITESPACE)
1023                     || name.equalsIgnoreCase(SEND_PSVI)
1024                     ) {
1025                     return (value.equals(Boolean.TRUE)) ? true : false;
1026             }// if name is not among the above listed above -- its not recognized. return false
1027             else {
1028                 return false ;
1029             }
1030         }
1031                 else if (name.equalsIgnoreCase(Constants.DOM_ERROR_HANDLER)) {
1032             return (value instanceof DOMErrorHandler) ? true : false ;
1033         }
1034         else if (name.equalsIgnoreCase(Constants.DOM_RESOURCE_RESOLVER)) {
1035             return (value instanceof LSResourceResolver) ? true : false ;
1036         }
1037         else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_LOCATION)) {
1038             return (value instanceof String) ? true : false ;
1039         }
1040         else if (name.equalsIgnoreCase(Constants.DOM_SCHEMA_TYPE)) {
1041             // REVISIT: should null value be supported?
<span class="line-modified">1042             // as of now we are only supporting W3C XML Schema and DTD.</span>
<span class="line-modified">1043             return ((value instanceof String) &amp;&amp;</span>
<span class="line-added">1044                     (value.equals(Constants.NS_XMLSCHEMA) || value.equals(Constants.NS_DTD))) ? true : false;</span>
<span class="line-added">1045         }</span>
<span class="line-added">1046         else if (name.equalsIgnoreCase(ENTITY_RESOLVER)) {</span>
<span class="line-added">1047             return (value instanceof XMLEntityResolver) ? true : false;</span>
1048         }
<span class="line-modified">1049         else if (name.equalsIgnoreCase(SYMBOL_TABLE)) {</span>
1050             // Xerces Symbol Table
<span class="line-modified">1051             return (value instanceof SymbolTable) ? true : false;</span>
1052         }
<span class="line-modified">1053         else if (name.equalsIgnoreCase (GRAMMAR_POOL)) {</span>
<span class="line-modified">1054             return (value instanceof XMLGrammarPool) ? true : false;</span>
1055         }
1056         else {
1057             //false if the parameter is not recognized or the requested value is not supported.
1058             return false ;
1059         }
1060 
1061         } //canSetParameter
1062 
1063     /**
1064      *  DOM Level 3 CR - Experimental.
1065      *
1066      *  The list of the parameters supported by this
1067      * &lt;code&gt;DOMConfiguration&lt;/code&gt; object and for which at least one value
1068      * can be set by the application. Note that this list can also contain
1069      * parameter names defined outside this specification.
1070      */
<span class="line-modified">1071         public DOMStringList getParameterNames() {</span>
<span class="line-modified">1072             if (fRecognizedParameters == null){</span>
1073             List&lt;String&gt; parameters = new ArrayList&lt;&gt;();
1074 
<span class="line-modified">1075                 //Add DOM recognized parameters</span>
<span class="line-modified">1076                 //REVISIT: Would have been nice to have a list of</span>
<span class="line-modified">1077                 //recognized paramters.</span>
<span class="line-modified">1078                 parameters.add(Constants.DOM_COMMENTS);</span>
<span class="line-modified">1079                 parameters.add(Constants.DOM_DATATYPE_NORMALIZATION);</span>
<span class="line-modified">1080                 parameters.add(Constants.DOM_CDATA_SECTIONS);</span>
<span class="line-modified">1081                 parameters.add(Constants.DOM_ENTITIES);</span>
<span class="line-modified">1082                 parameters.add(Constants.DOM_SPLIT_CDATA);</span>
<span class="line-modified">1083                 parameters.add(Constants.DOM_NAMESPACES);</span>
<span class="line-modified">1084                 parameters.add(Constants.DOM_VALIDATE);</span>
<span class="line-modified">1085 </span>
<span class="line-modified">1086                 parameters.add(Constants.DOM_INFOSET);</span>
<span class="line-modified">1087                 parameters.add(Constants.DOM_NORMALIZE_CHARACTERS);</span>
<span class="line-modified">1088                 parameters.add(Constants.DOM_CANONICAL_FORM);</span>
<span class="line-modified">1089                 parameters.add(Constants.DOM_VALIDATE_IF_SCHEMA);</span>
<span class="line-modified">1090                 parameters.add(Constants.DOM_CHECK_CHAR_NORMALIZATION);</span>
<span class="line-modified">1091                 parameters.add(Constants.DOM_WELLFORMED);</span>
<span class="line-modified">1092 </span>
<span class="line-modified">1093                 parameters.add(Constants.DOM_NAMESPACE_DECLARATIONS);</span>
<span class="line-modified">1094                 parameters.add(Constants.DOM_ELEMENT_CONTENT_WHITESPACE);</span>
<span class="line-modified">1095 </span>
<span class="line-modified">1096                 parameters.add(Constants.DOM_ERROR_HANDLER);</span>
<span class="line-modified">1097                 parameters.add(Constants.DOM_SCHEMA_TYPE);</span>
<span class="line-modified">1098                 parameters.add(Constants.DOM_SCHEMA_LOCATION);</span>
<span class="line-modified">1099                 parameters.add(Constants.DOM_RESOURCE_RESOLVER);</span>
<span class="line-modified">1100 </span>
<span class="line-modified">1101                 //Add recognized xerces features and properties</span>
<span class="line-modified">1102                 parameters.add(ENTITY_RESOLVER);</span>
<span class="line-modified">1103                 parameters.add(GRAMMAR_POOL);</span>
<span class="line-modified">1104                 parameters.add(SECURITY_MANAGER);</span>
<span class="line-modified">1105                 parameters.add(SYMBOL_TABLE);</span>
<span class="line-modified">1106                 parameters.add(SEND_PSVI);</span>
<span class="line-modified">1107 </span>
<span class="line-added">1108                 fRecognizedParameters = new DOMStringListImpl(parameters);</span>
1109 
<span class="line-modified">1110             }</span>
<span class="line-modified">1111 </span>
<span class="line-added">1112             return fRecognizedParameters;</span>
<span class="line-added">1113         }//getParameterNames</span>
1114 
1115     //
1116     // Protected methods
1117     //
1118 
1119     /**
1120      * reset all components before parsing
1121      */
1122     protected void reset() throws XNIException {
1123 
1124         if (fValidationManager != null)
1125             fValidationManager.reset();
1126 
1127         int count = fComponents.size();
1128         for (int i = 0; i &lt; count; i++) {
1129             XMLComponent c = fComponents.get(i);
1130             c.reset(this);
1131         }
1132 
1133     } // reset()
1134 
1135     /**
1136      * Check a property. If the property is known and supported, this method
1137      * simply returns. Otherwise, the appropriate exception is thrown.
1138      *
1139      * @param propertyId The unique identifier (URI) of the property
1140      *                   being set.
1141      * @exception com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException If the
1142      *            requested feature is not known or supported.
1143      */
<span class="line-added">1144     @Override</span>
1145     protected PropertyState checkProperty(String propertyId)
1146         throws XMLConfigurationException {
1147 
1148         // special cases
1149         if (propertyId.startsWith(Constants.SAX_PROPERTY_PREFIX)) {
1150             final int suffixLength = propertyId.length() - Constants.SAX_PROPERTY_PREFIX.length();
1151 
1152             //
1153             // http://xml.org/sax/properties/xml-string
1154             // Value type: String
1155             // Access: read-only
1156             //   Get the literal string of characters associated with the
1157             //   current event.  If the parser recognises and supports this
1158             //   property but is not currently parsing text, it should return
1159             //   null (this is a good way to check for availability before the
1160             //   parse begins).
1161             //
1162             if (suffixLength == Constants.XML_STRING_PROPERTY.length() &amp;&amp;
1163                 propertyId.endsWith(Constants.XML_STRING_PROPERTY)) {
1164                 // REVISIT - we should probably ask xml-dev for a precise
</pre>
<hr />
<pre>
1179         // don&#39;t add a component more than once
1180         if (fComponents.contains(component)) {
1181             return;
1182         }
1183         fComponents.add(component);
1184 
1185         // register component&#39;s recognized features
1186         String[] recognizedFeatures = component.getRecognizedFeatures();
1187         addRecognizedFeatures(recognizedFeatures);
1188 
1189         // register component&#39;s recognized properties
1190         String[] recognizedProperties = component.getRecognizedProperties();
1191         addRecognizedProperties(recognizedProperties);
1192 
1193     } // addComponent(XMLComponent)
1194 
1195     protected ValidationManager createValidationManager(){
1196         return new ValidationManager();
1197     }
1198 
<span class="line-modified">1199     protected final void setDTDValidatorFactory(String version) {</span>
<span class="line-added">1200         if (&quot;1.1&quot;.equals(version)) {</span>
<span class="line-added">1201             if (fCurrentDVFactory != fXML11DatatypeFactory) {</span>
<span class="line-added">1202                 fCurrentDVFactory = fXML11DatatypeFactory;</span>
<span class="line-added">1203                 setProperty(DTD_VALIDATOR_FACTORY_PROPERTY, fCurrentDVFactory);</span>
<span class="line-added">1204             }</span>
<span class="line-added">1205         }</span>
<span class="line-added">1206         else if (fCurrentDVFactory != fDatatypeValidatorFactory) {</span>
<span class="line-added">1207             fCurrentDVFactory = fDatatypeValidatorFactory;</span>
<span class="line-added">1208             setProperty(DTD_VALIDATOR_FACTORY_PROPERTY, fCurrentDVFactory);</span>
<span class="line-added">1209         }</span>
<span class="line-added">1210     }</span>
<span class="line-added">1211 </span>
<span class="line-added">1212     private static DOMException newFeatureNotSupportedError(String name) {</span>
<span class="line-added">1213         String msg =</span>
<span class="line-added">1214             DOMMessageFormatter.formatMessage(</span>
<span class="line-added">1215                 DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-added">1216                 &quot;FEATURE_NOT_SUPPORTED&quot;,</span>
<span class="line-added">1217                 new Object[] { name });</span>
<span class="line-added">1218         return new DOMException(DOMException.NOT_SUPPORTED_ERR, msg);</span>
<span class="line-added">1219     }</span>
<span class="line-added">1220 </span>
<span class="line-added">1221     private static DOMException newFeatureNotFoundError(String name) {</span>
<span class="line-added">1222         String msg =</span>
<span class="line-added">1223             DOMMessageFormatter.formatMessage(</span>
<span class="line-added">1224                 DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-added">1225                 &quot;FEATURE_NOT_FOUND&quot;,</span>
<span class="line-added">1226                 new Object[] { name });</span>
<span class="line-added">1227         return new DOMException(DOMException.NOT_FOUND_ERR, msg);</span>
<span class="line-added">1228     }</span>
<span class="line-added">1229 </span>
<span class="line-added">1230     private static DOMException newTypeMismatchError(String name) {</span>
<span class="line-added">1231         String msg =</span>
<span class="line-added">1232             DOMMessageFormatter.formatMessage(</span>
<span class="line-added">1233                 DOMMessageFormatter.DOM_DOMAIN,</span>
<span class="line-added">1234                 &quot;TYPE_MISMATCH_ERR&quot;,</span>
<span class="line-added">1235                 new Object[] { name });</span>
<span class="line-added">1236         return new DOMException(DOMException.TYPE_MISMATCH_ERR, msg);</span>
<span class="line-added">1237     }</span>
<span class="line-added">1238 </span>
<span class="line-added">1239 } // class DOMConfigurationImpl</span>
</pre>
</td>
</tr>
</table>
<center><a href="CoreDocumentImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="DOMNormalizer.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>