<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/FieldOrMethod.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Field.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="InnerClass.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/FieldOrMethod.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   */
  /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -27,11 +27,11 @@</span>
  import com.sun.org.apache.bcel.internal.Const;
  
  /**
   * Abstract super class for fields and methods.
   *
<span class="udiff-line-modified-removed">-  * @version $Id: FieldOrMethod.java 1750029 2016-06-23 22:14:38Z sebb $</span>
<span class="udiff-line-modified-added">+  * @LastModified: Jan 2020</span>
   */
  public abstract class FieldOrMethod extends AccessFlags implements Cloneable, Node {
      private int name_index; // Points to field name in constant pool
      private int signature_index; // Points to encoded signature
      private Attribute[] attributes; // Collection of attributes
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -46,53 +46,55 @@</span>
      private boolean searchedForSignatureAttribute = false;
  
      FieldOrMethod() {
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * Initialize from another object. Note that both objects use the same
       * references (shallow copy). Use clone() for a physical copy.
       */
      protected FieldOrMethod(final FieldOrMethod c) {
          this(c.getAccessFlags(), c.getNameIndex(), c.getSignatureIndex(),
                  c.getAttributes(), c.getConstantPool());
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * Construct object from file stream.
       *
       * @param file Input stream
       * @throws IOException
       * @throws ClassFormatException
<span class="udiff-line-modified-removed">-      * @deprecated (6.0) Use</span>
<span class="udiff-line-removed">-      * {@link #FieldOrMethod(java.io.DataInput, ConstantPool)} instead.</span>
<span class="udiff-line-modified-added">+      * @deprecated (6.0) Use {@link #FieldOrMethod(java.io.DataInput, ConstantPool)} instead.</span>
       */
      @java.lang.Deprecated
<span class="udiff-line-modified-removed">-     protected FieldOrMethod(final DataInputStream file,</span>
<span class="udiff-line-modified-removed">-             final ConstantPool constant_pool) throws IOException,</span>
<span class="udiff-line-modified-added">+     protected FieldOrMethod(final DataInputStream file, final ConstantPool constant_pool)</span>
<span class="udiff-line-modified-added">+             throws IOException,</span>
              ClassFormatException {
          this((DataInput) file, constant_pool);
      }
  
      /**
       * Construct object from file stream.
<span class="udiff-line-removed">-      *</span>
       * @param file Input stream
       * @throws IOException
       * @throws ClassFormatException
       */
<span class="udiff-line-modified-removed">-     protected FieldOrMethod(final DataInput file,</span>
<span class="udiff-line-modified-removed">-             final ConstantPool constant_pool) throws IOException, ClassFormatException {</span>
<span class="udiff-line-modified-added">+     protected FieldOrMethod(final DataInput file, final ConstantPool constant_pool)</span>
<span class="udiff-line-modified-added">+             throws IOException, ClassFormatException {</span>
          this(file.readUnsignedShort(), file.readUnsignedShort(), file.readUnsignedShort(), null,
                  constant_pool);
<span class="udiff-line-modified-removed">-         attributes_count = file.readUnsignedShort();</span>
<span class="udiff-line-modified-added">+         final int attributes_count = file.readUnsignedShort();</span>
          attributes = new Attribute[attributes_count];
          for (int i = 0; i &lt; attributes_count; i++) {
              attributes[i] = Attribute.readAttribute(file, constant_pool);
          }
<span class="udiff-line-added">+         this.attributes_count = attributes_count; // init deprecated field</span>
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @param access_flags Access rights of method
       * @param name_index Points to field name in constant pool
       * @param signature_index Points to encoded signature
       * @param attributes Collection of attributes
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -105,10 +107,11 @@</span>
          this.signature_index = signature_index;
          this.constant_pool = constant_pool;
          setAttributes(attributes);
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * Dump object to file stream on binary format.
       *
       * @param file Output file stream
       * @throws IOException
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -116,108 +119,120 @@</span>
      public final void dump(final DataOutputStream file) throws IOException {
          file.writeShort(super.getAccessFlags());
          file.writeShort(name_index);
          file.writeShort(signature_index);
          file.writeShort(attributes_count);
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         for(int i=0; i &lt; attributes_count; i++) {</span>
<span class="udiff-line-modified-removed">-             attributes[i].dump(file);</span>
<span class="udiff-line-modified-added">+         if (attributes != null) {</span>
<span class="udiff-line-modified-added">+             for (final Attribute attribute : attributes) {</span>
<span class="udiff-line-modified-added">+                 attribute.dump(file);</span>
<span class="udiff-line-added">+             }</span>
          }
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return Collection of object attributes.
       */
      public final Attribute[] getAttributes() {
          return attributes;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @param attributes Collection of object attributes.
       */
<span class="udiff-line-modified-removed">-     public final void setAttributes(final Attribute[] attributes) {</span>
<span class="udiff-line-modified-added">+     public final void setAttributes( final Attribute[] attributes ) {</span>
          this.attributes = attributes;
<span class="udiff-line-modified-removed">-         this.attributes_count = attributes != null ? attributes.length : 0;</span>
<span class="udiff-line-modified-added">+         this.attributes_count = attributes != null ? attributes.length : 0; // init deprecated field</span>
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return Constant pool used by this object.
       */
      public final ConstantPool getConstantPool() {
          return constant_pool;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @param constant_pool Constant pool to be used for this object.
       */
<span class="udiff-line-modified-removed">-     public final void setConstantPool(final ConstantPool constant_pool) {</span>
<span class="udiff-line-modified-added">+     public final void setConstantPool( final ConstantPool constant_pool ) {</span>
          this.constant_pool = constant_pool;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return Index in constant pool of object&#39;s name.
       */
      public final int getNameIndex() {
          return name_index;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @param name_index Index in constant pool of object&#39;s name.
       */
<span class="udiff-line-modified-removed">-     public final void setNameIndex(final int name_index) {</span>
<span class="udiff-line-modified-added">+     public final void setNameIndex( final int name_index ) {</span>
          this.name_index = name_index;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return Index in constant pool of field signature.
       */
      public final int getSignatureIndex() {
          return signature_index;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @param signature_index Index in constant pool of field signature.
       */
<span class="udiff-line-modified-removed">-     public final void setSignatureIndex(final int signature_index) {</span>
<span class="udiff-line-modified-added">+     public final void setSignatureIndex( final int signature_index ) {</span>
          this.signature_index = signature_index;
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return Name of object, i.e., method name or field name
       */
      public final String getName() {
          ConstantUtf8 c;
          c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);
          return c.getBytes();
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return String representation of object&#39;s type signature (java style)
       */
      public final String getSignature() {
          ConstantUtf8 c;
          c = (ConstantUtf8) constant_pool.getConstant(signature_index, Const.CONSTANT_Utf8);
          return c.getBytes();
      }
  
<span class="udiff-line-added">+ </span>
      /**
       * @return deep copy of this field
       */
<span class="udiff-line-modified-removed">-     protected FieldOrMethod copy_(final ConstantPool _constant_pool) {</span>
<span class="udiff-line-modified-added">+     protected FieldOrMethod copy_( final ConstantPool _constant_pool ) {</span>
          FieldOrMethod c = null;
  
          try {
<span class="udiff-line-modified-removed">-             c = (FieldOrMethod) clone();</span>
<span class="udiff-line-modified-removed">-         } catch (final CloneNotSupportedException e) {</span>
<span class="udiff-line-modified-added">+           c = (FieldOrMethod)clone();</span>
<span class="udiff-line-modified-added">+         } catch(final CloneNotSupportedException e) {</span>
              // ignored, but will cause NPE ...
          }
  
<span class="udiff-line-modified-removed">-         c.constant_pool = constant_pool;</span>
<span class="udiff-line-modified-removed">-         c.attributes = new Attribute[attributes_count];</span>
<span class="udiff-line-modified-removed">-         c.attributes_count = attributes_count;</span>
<span class="udiff-line-modified-added">+         c.constant_pool    = constant_pool;</span>
<span class="udiff-line-modified-added">+         c.attributes       = new Attribute[attributes.length];</span>
<span class="udiff-line-modified-added">+         c.attributes_count = attributes_count; // init deprecated field</span>
  
<span class="udiff-line-modified-removed">-         for (int i = 0; i &lt; attributes_count; i++) {</span>
<span class="udiff-line-modified-added">+         for (int i = 0; i &lt; attributes.length; i++) {</span>
              c.attributes[i] = attributes[i].copy(constant_pool);
          }
  
          return c;
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -242,15 +257,19 @@</span>
       * searches for the attribute only when requested - only searches for it
       * once.
       *
       * @since 6.0
       */
<span class="udiff-line-modified-removed">-     public final String getGenericSignature() {</span>
<span class="udiff-line-modified-removed">-         if (!searchedForSignatureAttribute) {</span>
<span class="udiff-line-modified-added">+     public final String getGenericSignature()</span>
<span class="udiff-line-modified-added">+     {</span>
<span class="udiff-line-added">+         if (!searchedForSignatureAttribute)</span>
<span class="udiff-line-added">+         {</span>
              boolean found = false;
<span class="udiff-line-modified-removed">-             for (int i = 0; !found &amp;&amp; i &lt; attributes.length; i++) {</span>
<span class="udiff-line-modified-removed">-                 if (attributes[i] instanceof Signature) {</span>
<span class="udiff-line-modified-added">+             for (int i = 0; !found &amp;&amp; i &lt; attributes.length; i++)</span>
<span class="udiff-line-modified-added">+             {</span>
<span class="udiff-line-added">+                 if (attributes[i] instanceof Signature)</span>
<span class="udiff-line-added">+                 {</span>
                      signatureAttributeString = ((Signature) attributes[i])
                              .getSignature();
                      found = true;
                  }
              }
</pre>
<center><a href="Field.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="InnerClass.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>