<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/trax/TransformerFactoryImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TemplatesHandlerImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="TransformerImpl.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/trax/TransformerFactoryImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2007, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  */
   4 /*
   5  * Licensed to the Apache Software Foundation (ASF) under one or more
   6  * contributor license agreements.  See the NOTICE file distributed with
   7  * this work for additional information regarding copyright ownership.
   8  * The ASF licenses this file to You under the Apache License, Version 2.0
   9  * (the &quot;License&quot;); you may not use this file except in compliance with
  10  * the License.  You may obtain a copy of the License at
  11  *
  12  *     http://www.apache.org/licenses/LICENSE-2.0
  13  *
  14  * Unless required by applicable law or agreed to in writing, software
  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  17  * See the License for the specific language governing permissions and
  18  * limitations under the License.
  19  */
  20 
  21 package com.sun.org.apache.xalan.internal.xsltc.trax;
  22 
</pre>
<hr />
<pre>
  57 import javax.xml.transform.ErrorListener;
  58 import javax.xml.transform.Source;
  59 import javax.xml.transform.Templates;
  60 import javax.xml.transform.Transformer;
  61 import javax.xml.transform.TransformerConfigurationException;
  62 import javax.xml.transform.TransformerException;
  63 import javax.xml.transform.URIResolver;
  64 import javax.xml.transform.dom.DOMResult;
  65 import javax.xml.transform.dom.DOMSource;
  66 import javax.xml.transform.sax.SAXResult;
  67 import javax.xml.transform.sax.SAXSource;
  68 import javax.xml.transform.sax.SAXTransformerFactory;
  69 import javax.xml.transform.sax.TemplatesHandler;
  70 import javax.xml.transform.sax.TransformerHandler;
  71 import javax.xml.transform.stax.*;
  72 import javax.xml.transform.stream.StreamResult;
  73 import javax.xml.transform.stream.StreamSource;
  74 import jdk.xml.internal.JdkXmlFeatures;
  75 import jdk.xml.internal.JdkXmlUtils;
  76 import jdk.xml.internal.SecuritySupport;

  77 import org.xml.sax.InputSource;
  78 import org.xml.sax.SAXException;
  79 import org.xml.sax.XMLFilter;
  80 import org.xml.sax.XMLReader;
  81 
  82 /**
  83  * Implementation of a JAXP TransformerFactory for Translets.
  84  * @author G. Todd Miller
  85  * @author Morten Jorgensen
  86  * @author Santiago Pericas-Geertsen
<span class="line-modified">  87  * @LastModified: July 2018</span>
  88  */
  89 public class TransformerFactoryImpl
<span class="line-modified">  90     extends SAXTransformerFactory implements SourceLoader, ErrorListener</span>
  91 {
  92     // Public constants for attributes supported by the XSLTC TransformerFactory.
  93     public final static String TRANSLET_NAME = &quot;translet-name&quot;;
  94     public final static String DESTINATION_DIRECTORY = &quot;destination-directory&quot;;
  95     public final static String PACKAGE_NAME = &quot;package-name&quot;;
  96     public final static String JAR_NAME = &quot;jar-name&quot;;
  97     public final static String GENERATE_TRANSLET = &quot;generate-translet&quot;;
  98     public final static String AUTO_TRANSLET = &quot;auto-translet&quot;;
  99     public final static String USE_CLASSPATH = &quot;use-classpath&quot;;
 100     public final static String DEBUG = &quot;debug&quot;;
 101     public final static String ENABLE_INLINING = &quot;enable-inlining&quot;;
 102     public final static String INDENT_NUMBER = &quot;indent-number&quot;;
 103 





 104     /**
 105      * This error listener is used only for this factory and is not passed to
 106      * the Templates or Transformer objects that we create.
 107      */
<span class="line-modified"> 108     private ErrorListener _errorListener = this;</span>



 109 
 110     /**
 111      * This URIResolver is passed to all created Templates and Transformers
 112      */
 113     private URIResolver _uriResolver = null;
 114 
 115     /**
 116      * As Gregor Samsa awoke one morning from uneasy dreams he found himself
 117      * transformed in his bed into a gigantic insect. He was lying on his hard,
 118      * as it were armour plated, back, and if he lifted his head a little he
 119      * could see his big, brown belly divided into stiff, arched segments, on
 120      * top of which the bed quilt could hardly keep in position and was about
 121      * to slide off completely. His numerous legs, which were pitifully thin
 122      * compared to the rest of his bulk, waved helplessly before his eyes.
 123      * &quot;What has happened to me?&quot;, he thought. It was no dream....
 124      */
 125     protected final static String DEFAULT_TRANSLET_NAME = &quot;GregorSamsa&quot;;
 126 
 127     /**
 128      * The class name of the translet
</pre>
<hr />
<pre>
 280     }
 281 
 282     /**
 283      * javax.xml.transform.sax.TransformerFactory implementation.
 284      * Set the error event listener for the TransformerFactory, which is used
 285      * for the processing of transformation instructions, and not for the
 286      * transformation itself.
 287      *
 288      * @param listener The error listener to use with the TransformerFactory
 289      * @throws IllegalArgumentException
 290      */
 291     @Override
 292     public void setErrorListener(ErrorListener listener)
 293         throws IllegalArgumentException
 294     {
 295         if (listener == null) {
 296             ErrorMsg err = new ErrorMsg(ErrorMsg.ERROR_LISTENER_NULL_ERR,
 297                                         &quot;TransformerFactory&quot;);
 298             throw new IllegalArgumentException(err.toString());
 299         }

 300         _errorListener = listener;
 301     }
 302 
 303     /**
 304      * javax.xml.transform.sax.TransformerFactory implementation.
 305      * Get the error event handler for the TransformerFactory.
 306      *
 307      * @return The error listener used with the TransformerFactory
 308      */
 309     @Override
 310     public ErrorListener getErrorListener() {
 311         return _errorListener;
 312     }
 313 
 314     /**
 315      * Returns the package name.
 316      */
 317     String getPackageName() {
 318         return _packageName;
 319     }
</pre>
<hr />
<pre>
 929                     if (_jarFileName != null)
 930                         System.err.println(new ErrorMsg(
 931                             ErrorMsg.TRANSFORM_WITH_JAR_STR, transletClassName, _jarFileName));
 932                     else
 933                         System.err.println(new ErrorMsg(
 934                             ErrorMsg.TRANSFORM_WITH_TRANSLET_STR, transletClassName));
 935                 }
 936 
 937                 // Reset the per-session attributes to their default values
 938                 // after each newTemplates() call.
 939                 resetTransientAttributes();
 940                 templates = new TemplatesImpl(bytecodes, transletClassName, null, _indentNumber, this);
 941                 if (_uriResolver != null) {
 942                     templates.setURIResolver(_uriResolver);
 943                 }
 944                 return templates;
 945             }
 946         }
 947 
 948         // Create and initialize a stylesheet compiler
<span class="line-modified"> 949         final XSLTC xsltc = new XSLTC(_xmlFeatures);</span>
 950         if (_debug) xsltc.setDebug(true);
 951         if (_enableInlining)
 952                 xsltc.setTemplateInlining(true);
 953         else
 954                 xsltc.setTemplateInlining(false);
 955 
 956         if (!_isNotSecureProcessing) xsltc.setSecureProcessing(true);
 957         xsltc.setProperty(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, _accessExternalStylesheet);
 958         xsltc.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, _accessExternalDTD);
 959         xsltc.setProperty(XalanConstants.SECURITY_MANAGER, _xmlSecurityManager);
 960         xsltc.setProperty(XalanConstants.JDK_EXTENSION_CLASSLOADER, _extensionClassLoader);
 961 
 962         // set Catalog features
 963         buildCatalogFeatures();
 964         xsltc.setProperty(JdkXmlFeatures.CATALOG_FEATURES, _catalogFeatures);
 965 
 966         xsltc.init();
 967         if (!_isNotSecureProcessing)
 968             _xsltcExtensionFunctions = xsltc.getExternalExtensionFunctions();
 969         // Set a document loader (for xsl:include/import) if defined
</pre>
<hr />
<pre>
1087         }
1088         return templates;
1089     }
1090 
1091     /**
1092      * javax.xml.transform.sax.SAXTransformerFactory implementation.
1093      * Get a TemplatesHandler object that can process SAX ContentHandler
1094      * events into a Templates object.
1095      *
1096      * @return A TemplatesHandler object that can handle SAX events
1097      * @throws TransformerConfigurationException
1098      */
1099     @Override
1100     public TemplatesHandler newTemplatesHandler()
1101         throws TransformerConfigurationException
1102     {
1103         // create CatalogFeatures that is accessible by the Handler
1104         // through the factory instance
1105         buildCatalogFeatures();
1106         final TemplatesHandlerImpl handler =
<span class="line-modified">1107             new TemplatesHandlerImpl(_indentNumber, this);</span>
1108         if (_uriResolver != null) {
1109             handler.setURIResolver(_uriResolver);
1110         }
1111         return handler;
1112     }
1113 
1114     /**
1115      * javax.xml.transform.sax.SAXTransformerFactory implementation.
1116      * Get a TransformerHandler object that can process SAX ContentHandler
1117      * events into a Result. This method will return a pure copy transformer.
1118      *
1119      * @return A TransformerHandler object that can handle SAX events
1120      * @throws TransformerConfigurationException
1121      */
1122     @Override
1123     public TransformerHandler newTransformerHandler()
1124         throws TransformerConfigurationException
1125     {
1126         final Transformer transformer = newTransformer();
1127         if (_uriResolver != null) {
</pre>
<hr />
<pre>
1201     public XMLFilter newXMLFilter(Templates templates)
1202         throws TransformerConfigurationException
1203     {
1204         try {
1205             return new com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter(templates);
1206         }
1207         catch (TransformerConfigurationException e1) {
1208             if (_errorListener != null) {
1209                 try {
1210                     _errorListener.fatalError(e1);
1211                     return null;
1212                 }
1213                 catch (TransformerException e2) {
1214                     throw new TransformerConfigurationException(e2);
1215                 }
1216             }
1217             throw e1;
1218         }
1219     }
1220 
<span class="line-removed">1221     /**</span>
<span class="line-removed">1222      * Receive notification of a recoverable error.</span>
<span class="line-removed">1223      * The transformer must continue to provide normal parsing events after</span>
<span class="line-removed">1224      * invoking this method. It should still be possible for the application</span>
<span class="line-removed">1225      * to process the document through to the end.</span>
<span class="line-removed">1226      *</span>
<span class="line-removed">1227      * @param e The warning information encapsulated in a transformer</span>
<span class="line-removed">1228      * exception.</span>
<span class="line-removed">1229      * @throws TransformerException if the application chooses to discontinue</span>
<span class="line-removed">1230      * the transformation (always does in our case).</span>
<span class="line-removed">1231      */</span>
<span class="line-removed">1232     @Override</span>
<span class="line-removed">1233     public void error(TransformerException e)</span>
<span class="line-removed">1234         throws TransformerException</span>
<span class="line-removed">1235     {</span>
<span class="line-removed">1236         Throwable wrapped = e.getException();</span>
<span class="line-removed">1237         if (wrapped != null) {</span>
<span class="line-removed">1238             System.err.println(new ErrorMsg(ErrorMsg.ERROR_PLUS_WRAPPED_MSG,</span>
<span class="line-removed">1239                                             e.getMessageAndLocation(),</span>
<span class="line-removed">1240                                             wrapped.getMessage()));</span>
<span class="line-removed">1241         } else {</span>
<span class="line-removed">1242             System.err.println(new ErrorMsg(ErrorMsg.ERROR_MSG,</span>
<span class="line-removed">1243                                             e.getMessageAndLocation()));</span>
<span class="line-removed">1244         }</span>
<span class="line-removed">1245         throw e;</span>
<span class="line-removed">1246     }</span>
<span class="line-removed">1247 </span>
<span class="line-removed">1248     /**</span>
<span class="line-removed">1249      * Receive notification of a non-recoverable error.</span>
<span class="line-removed">1250      * The application must assume that the transformation cannot continue</span>
<span class="line-removed">1251      * after the Transformer has invoked this method, and should continue</span>
<span class="line-removed">1252      * (if at all) only to collect addition error messages. In fact,</span>
<span class="line-removed">1253      * Transformers are free to stop reporting events once this method has</span>
<span class="line-removed">1254      * been invoked.</span>
<span class="line-removed">1255      *</span>
<span class="line-removed">1256      * @param e warning information encapsulated in a transformer</span>
<span class="line-removed">1257      * exception.</span>
<span class="line-removed">1258      * @throws TransformerException if the application chooses to discontinue</span>
<span class="line-removed">1259      * the transformation (always does in our case).</span>
<span class="line-removed">1260      */</span>
<span class="line-removed">1261     @Override</span>
<span class="line-removed">1262     public void fatalError(TransformerException e)</span>
<span class="line-removed">1263         throws TransformerException</span>
<span class="line-removed">1264     {</span>
<span class="line-removed">1265         Throwable wrapped = e.getException();</span>
<span class="line-removed">1266         if (wrapped != null) {</span>
<span class="line-removed">1267             System.err.println(new ErrorMsg(ErrorMsg.FATAL_ERR_PLUS_WRAPPED_MSG,</span>
<span class="line-removed">1268                                             e.getMessageAndLocation(),</span>
<span class="line-removed">1269                                             wrapped.getMessage()));</span>
<span class="line-removed">1270         } else {</span>
<span class="line-removed">1271             System.err.println(new ErrorMsg(ErrorMsg.FATAL_ERR_MSG,</span>
<span class="line-removed">1272                                             e.getMessageAndLocation()));</span>
<span class="line-removed">1273         }</span>
<span class="line-removed">1274         throw e;</span>
<span class="line-removed">1275     }</span>
<span class="line-removed">1276 </span>
<span class="line-removed">1277     /**</span>
<span class="line-removed">1278      * Receive notification of a warning.</span>
<span class="line-removed">1279      * Transformers can use this method to report conditions that are not</span>
<span class="line-removed">1280      * errors or fatal errors. The default behaviour is to take no action.</span>
<span class="line-removed">1281      * After invoking this method, the Transformer must continue with the</span>
<span class="line-removed">1282      * transformation. It should still be possible for the application to</span>
<span class="line-removed">1283      * process the document through to the end.</span>
<span class="line-removed">1284      *</span>
<span class="line-removed">1285      * @param e The warning information encapsulated in a transformer</span>
<span class="line-removed">1286      * exception.</span>
<span class="line-removed">1287      * @throws TransformerException if the application chooses to discontinue</span>
<span class="line-removed">1288      * the transformation (never does in our case).</span>
<span class="line-removed">1289      */</span>
<span class="line-removed">1290     @Override</span>
<span class="line-removed">1291     public void warning(TransformerException e)</span>
<span class="line-removed">1292         throws TransformerException</span>
<span class="line-removed">1293     {</span>
<span class="line-removed">1294         Throwable wrapped = e.getException();</span>
<span class="line-removed">1295         if (wrapped != null) {</span>
<span class="line-removed">1296             System.err.println(new ErrorMsg(ErrorMsg.WARNING_PLUS_WRAPPED_MSG,</span>
<span class="line-removed">1297                                             e.getMessageAndLocation(),</span>
<span class="line-removed">1298                                             wrapped.getMessage()));</span>
<span class="line-removed">1299         } else {</span>
<span class="line-removed">1300             System.err.println(new ErrorMsg(ErrorMsg.WARNING_MSG,</span>
<span class="line-removed">1301                                             e.getMessageAndLocation()));</span>
<span class="line-removed">1302         }</span>
<span class="line-removed">1303     }</span>
<span class="line-removed">1304 </span>
1305     /**
1306      * This method implements XSLTC&#39;s SourceLoader interface. It is used to
1307      * glue a TrAX URIResolver to the XSLTC compiler&#39;s Input and Import classes.
1308      *
1309      * @param href The URI of the document to load
1310      * @param context The URI of the currently loaded document
1311      * @param xsltc The compiler that resuests the document
1312      * @return An InputSource with the loaded document
1313      */
1314     @Override
1315     public InputSource loadSource(String href, String context, XSLTC xsltc) {
1316         try {
1317             Source source = null;
1318             if (_uriResolver != null) {
1319                 source = _uriResolver.resolve(href, context);
1320             }
1321             if (source == null &amp;&amp; _catalogFiles != null &amp;&amp;
1322                     _xmlFeatures.getFeature(JdkXmlFeatures.XmlFeature.USE_CATALOG)) {
1323                 if (_catalogUriResolver == null) {
1324                     _catalogUriResolver = CatalogManager.catalogResolver(_catalogFeatures);
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2007, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  */
   4 /*
   5  * Licensed to the Apache Software Foundation (ASF) under one or more
   6  * contributor license agreements.  See the NOTICE file distributed with
   7  * this work for additional information regarding copyright ownership.
   8  * The ASF licenses this file to You under the Apache License, Version 2.0
   9  * (the &quot;License&quot;); you may not use this file except in compliance with
  10  * the License.  You may obtain a copy of the License at
  11  *
  12  *     http://www.apache.org/licenses/LICENSE-2.0
  13  *
  14  * Unless required by applicable law or agreed to in writing, software
  15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  17  * See the License for the specific language governing permissions and
  18  * limitations under the License.
  19  */
  20 
  21 package com.sun.org.apache.xalan.internal.xsltc.trax;
  22 
</pre>
<hr />
<pre>
  57 import javax.xml.transform.ErrorListener;
  58 import javax.xml.transform.Source;
  59 import javax.xml.transform.Templates;
  60 import javax.xml.transform.Transformer;
  61 import javax.xml.transform.TransformerConfigurationException;
  62 import javax.xml.transform.TransformerException;
  63 import javax.xml.transform.URIResolver;
  64 import javax.xml.transform.dom.DOMResult;
  65 import javax.xml.transform.dom.DOMSource;
  66 import javax.xml.transform.sax.SAXResult;
  67 import javax.xml.transform.sax.SAXSource;
  68 import javax.xml.transform.sax.SAXTransformerFactory;
  69 import javax.xml.transform.sax.TemplatesHandler;
  70 import javax.xml.transform.sax.TransformerHandler;
  71 import javax.xml.transform.stax.*;
  72 import javax.xml.transform.stream.StreamResult;
  73 import javax.xml.transform.stream.StreamSource;
  74 import jdk.xml.internal.JdkXmlFeatures;
  75 import jdk.xml.internal.JdkXmlUtils;
  76 import jdk.xml.internal.SecuritySupport;
<span class="line-added">  77 import jdk.xml.internal.TransformErrorListener;</span>
  78 import org.xml.sax.InputSource;
  79 import org.xml.sax.SAXException;
  80 import org.xml.sax.XMLFilter;
  81 import org.xml.sax.XMLReader;
  82 
  83 /**
  84  * Implementation of a JAXP TransformerFactory for Translets.
  85  * @author G. Todd Miller
  86  * @author Morten Jorgensen
  87  * @author Santiago Pericas-Geertsen
<span class="line-modified">  88  * @LastModified: Aug 2019</span>
  89  */
  90 public class TransformerFactoryImpl
<span class="line-modified">  91     extends SAXTransformerFactory implements SourceLoader</span>
  92 {
  93     // Public constants for attributes supported by the XSLTC TransformerFactory.
  94     public final static String TRANSLET_NAME = &quot;translet-name&quot;;
  95     public final static String DESTINATION_DIRECTORY = &quot;destination-directory&quot;;
  96     public final static String PACKAGE_NAME = &quot;package-name&quot;;
  97     public final static String JAR_NAME = &quot;jar-name&quot;;
  98     public final static String GENERATE_TRANSLET = &quot;generate-translet&quot;;
  99     public final static String AUTO_TRANSLET = &quot;auto-translet&quot;;
 100     public final static String USE_CLASSPATH = &quot;use-classpath&quot;;
 101     public final static String DEBUG = &quot;debug&quot;;
 102     public final static String ENABLE_INLINING = &quot;enable-inlining&quot;;
 103     public final static String INDENT_NUMBER = &quot;indent-number&quot;;
 104 
<span class="line-added"> 105     /**</span>
<span class="line-added"> 106      * Default error listener</span>
<span class="line-added"> 107      */</span>
<span class="line-added"> 108     private final ErrorListener _defaultListener = new TransformErrorListener();</span>
<span class="line-added"> 109 </span>
 110     /**
 111      * This error listener is used only for this factory and is not passed to
 112      * the Templates or Transformer objects that we create.
 113      */
<span class="line-modified"> 114     private ErrorListener _errorListener = _defaultListener;</span>
<span class="line-added"> 115 </span>
<span class="line-added"> 116     // flag indicating whether there&#39;s an user&#39;s ErrorListener</span>
<span class="line-added"> 117     private boolean _hasUserErrListener;</span>
 118 
 119     /**
 120      * This URIResolver is passed to all created Templates and Transformers
 121      */
 122     private URIResolver _uriResolver = null;
 123 
 124     /**
 125      * As Gregor Samsa awoke one morning from uneasy dreams he found himself
 126      * transformed in his bed into a gigantic insect. He was lying on his hard,
 127      * as it were armour plated, back, and if he lifted his head a little he
 128      * could see his big, brown belly divided into stiff, arched segments, on
 129      * top of which the bed quilt could hardly keep in position and was about
 130      * to slide off completely. His numerous legs, which were pitifully thin
 131      * compared to the rest of his bulk, waved helplessly before his eyes.
 132      * &quot;What has happened to me?&quot;, he thought. It was no dream....
 133      */
 134     protected final static String DEFAULT_TRANSLET_NAME = &quot;GregorSamsa&quot;;
 135 
 136     /**
 137      * The class name of the translet
</pre>
<hr />
<pre>
 289     }
 290 
 291     /**
 292      * javax.xml.transform.sax.TransformerFactory implementation.
 293      * Set the error event listener for the TransformerFactory, which is used
 294      * for the processing of transformation instructions, and not for the
 295      * transformation itself.
 296      *
 297      * @param listener The error listener to use with the TransformerFactory
 298      * @throws IllegalArgumentException
 299      */
 300     @Override
 301     public void setErrorListener(ErrorListener listener)
 302         throws IllegalArgumentException
 303     {
 304         if (listener == null) {
 305             ErrorMsg err = new ErrorMsg(ErrorMsg.ERROR_LISTENER_NULL_ERR,
 306                                         &quot;TransformerFactory&quot;);
 307             throw new IllegalArgumentException(err.toString());
 308         }
<span class="line-added"> 309         _hasUserErrListener = true;</span>
 310         _errorListener = listener;
 311     }
 312 
 313     /**
 314      * javax.xml.transform.sax.TransformerFactory implementation.
 315      * Get the error event handler for the TransformerFactory.
 316      *
 317      * @return The error listener used with the TransformerFactory
 318      */
 319     @Override
 320     public ErrorListener getErrorListener() {
 321         return _errorListener;
 322     }
 323 
 324     /**
 325      * Returns the package name.
 326      */
 327     String getPackageName() {
 328         return _packageName;
 329     }
</pre>
<hr />
<pre>
 939                     if (_jarFileName != null)
 940                         System.err.println(new ErrorMsg(
 941                             ErrorMsg.TRANSFORM_WITH_JAR_STR, transletClassName, _jarFileName));
 942                     else
 943                         System.err.println(new ErrorMsg(
 944                             ErrorMsg.TRANSFORM_WITH_TRANSLET_STR, transletClassName));
 945                 }
 946 
 947                 // Reset the per-session attributes to their default values
 948                 // after each newTemplates() call.
 949                 resetTransientAttributes();
 950                 templates = new TemplatesImpl(bytecodes, transletClassName, null, _indentNumber, this);
 951                 if (_uriResolver != null) {
 952                     templates.setURIResolver(_uriResolver);
 953                 }
 954                 return templates;
 955             }
 956         }
 957 
 958         // Create and initialize a stylesheet compiler
<span class="line-modified"> 959         final XSLTC xsltc = new XSLTC(_xmlFeatures, _hasUserErrListener);</span>
 960         if (_debug) xsltc.setDebug(true);
 961         if (_enableInlining)
 962                 xsltc.setTemplateInlining(true);
 963         else
 964                 xsltc.setTemplateInlining(false);
 965 
 966         if (!_isNotSecureProcessing) xsltc.setSecureProcessing(true);
 967         xsltc.setProperty(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, _accessExternalStylesheet);
 968         xsltc.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, _accessExternalDTD);
 969         xsltc.setProperty(XalanConstants.SECURITY_MANAGER, _xmlSecurityManager);
 970         xsltc.setProperty(XalanConstants.JDK_EXTENSION_CLASSLOADER, _extensionClassLoader);
 971 
 972         // set Catalog features
 973         buildCatalogFeatures();
 974         xsltc.setProperty(JdkXmlFeatures.CATALOG_FEATURES, _catalogFeatures);
 975 
 976         xsltc.init();
 977         if (!_isNotSecureProcessing)
 978             _xsltcExtensionFunctions = xsltc.getExternalExtensionFunctions();
 979         // Set a document loader (for xsl:include/import) if defined
</pre>
<hr />
<pre>
1097         }
1098         return templates;
1099     }
1100 
1101     /**
1102      * javax.xml.transform.sax.SAXTransformerFactory implementation.
1103      * Get a TemplatesHandler object that can process SAX ContentHandler
1104      * events into a Templates object.
1105      *
1106      * @return A TemplatesHandler object that can handle SAX events
1107      * @throws TransformerConfigurationException
1108      */
1109     @Override
1110     public TemplatesHandler newTemplatesHandler()
1111         throws TransformerConfigurationException
1112     {
1113         // create CatalogFeatures that is accessible by the Handler
1114         // through the factory instance
1115         buildCatalogFeatures();
1116         final TemplatesHandlerImpl handler =
<span class="line-modified">1117             new TemplatesHandlerImpl(_indentNumber, this, _hasUserErrListener);</span>
1118         if (_uriResolver != null) {
1119             handler.setURIResolver(_uriResolver);
1120         }
1121         return handler;
1122     }
1123 
1124     /**
1125      * javax.xml.transform.sax.SAXTransformerFactory implementation.
1126      * Get a TransformerHandler object that can process SAX ContentHandler
1127      * events into a Result. This method will return a pure copy transformer.
1128      *
1129      * @return A TransformerHandler object that can handle SAX events
1130      * @throws TransformerConfigurationException
1131      */
1132     @Override
1133     public TransformerHandler newTransformerHandler()
1134         throws TransformerConfigurationException
1135     {
1136         final Transformer transformer = newTransformer();
1137         if (_uriResolver != null) {
</pre>
<hr />
<pre>
1211     public XMLFilter newXMLFilter(Templates templates)
1212         throws TransformerConfigurationException
1213     {
1214         try {
1215             return new com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter(templates);
1216         }
1217         catch (TransformerConfigurationException e1) {
1218             if (_errorListener != null) {
1219                 try {
1220                     _errorListener.fatalError(e1);
1221                     return null;
1222                 }
1223                 catch (TransformerException e2) {
1224                     throw new TransformerConfigurationException(e2);
1225                 }
1226             }
1227             throw e1;
1228         }
1229     }
1230 




















































































1231     /**
1232      * This method implements XSLTC&#39;s SourceLoader interface. It is used to
1233      * glue a TrAX URIResolver to the XSLTC compiler&#39;s Input and Import classes.
1234      *
1235      * @param href The URI of the document to load
1236      * @param context The URI of the currently loaded document
1237      * @param xsltc The compiler that resuests the document
1238      * @return An InputSource with the loaded document
1239      */
1240     @Override
1241     public InputSource loadSource(String href, String context, XSLTC xsltc) {
1242         try {
1243             Source source = null;
1244             if (_uriResolver != null) {
1245                 source = _uriResolver.resolve(href, context);
1246             }
1247             if (source == null &amp;&amp; _catalogFiles != null &amp;&amp;
1248                     _xmlFeatures.getFeature(JdkXmlFeatures.XmlFeature.USE_CATALOG)) {
1249                 if (_catalogUriResolver == null) {
1250                     _catalogUriResolver = CatalogManager.catalogResolver(_catalogFeatures);
</pre>
</td>
</tr>
</table>
<center><a href="TemplatesHandlerImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="TransformerImpl.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>