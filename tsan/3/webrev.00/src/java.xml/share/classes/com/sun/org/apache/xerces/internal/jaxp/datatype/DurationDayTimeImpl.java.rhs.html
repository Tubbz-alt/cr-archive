<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml/share/classes/com/sun/org/apache/xerces/internal/jaxp/datatype/DurationDayTimeImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2009, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package com.sun.org.apache.xerces.internal.jaxp.datatype;
 27 
 28 
 29 import java.math.BigInteger;
 30 import java.math.BigDecimal;
 31 import javax.xml.datatype.DatatypeConstants;
 32 
 33 /**
 34  * &lt;p&gt;Represent a subtype &lt;code&gt;xdt:dayTimeDuration&lt;/code&gt; of a &lt;code&gt;Duration&lt;/code&gt;
 35  * as specified in &lt;a href=&quot;http://www.w3.org/TR/xpath-datamodel#dayTimeDuration&quot;&gt;
 36  *   XQuery 1.0 and XPath 2.0 Data Model, xdt:dayTimeDuration&lt;/a&gt;.&lt;/p&gt;
 37  *
 38  *
 39  * &lt;p&gt;The DurationYearMonth object represents a period of Gregorian time,
 40  * with a lexical representation, &quot;&lt;em&gt;PnDTnHnMnS&lt;/em&gt;&quot; that contains only year and month components.
 41  * &lt;/p&gt;
 42  *
 43  *
 44  * @author Vikram Aroskar
 45  * @see XMLGregorianCalendar#add(Duration)
 46  */
 47 
 48 class DurationDayTimeImpl
 49         extends DurationImpl {
 50     private static final long serialVersionUID = 844792794952655204L;
 51 
 52     public DurationDayTimeImpl(
 53         boolean isPositive,
 54         BigInteger days,
 55         BigInteger hours,
 56         BigInteger minutes,
 57         BigDecimal seconds) {
 58 
 59         super(isPositive, null, null, days, hours, minutes, seconds);
 60         convertToCanonicalDayTime();
 61     }
 62 
 63     public DurationDayTimeImpl(
 64         boolean isPositive,
 65         int days,
 66         int hours,
 67         int minutes,
 68         int seconds) {
 69 
 70         this(
 71             isPositive,
 72             wrap(days),
 73             wrap(hours),
 74             wrap(minutes),
 75             (seconds != DatatypeConstants.FIELD_UNDEFINED ? new BigDecimal(String.valueOf(seconds)) : null));
 76     }
 77 
 78         /**
 79          * &lt;p&gt;Construct a &lt;code&gt;Duration&lt;/code&gt; of type &lt;code&gt;xdt:dayTimeDuration&lt;/code&gt; by parsing its &lt;code&gt;String&lt;/code&gt; representation,
 80          * &quot;&lt;em&gt;PnDTnHnMnS&lt;/em&gt;&quot;, &lt;a href=&quot;http://www.w3.org/TR/xpath-datamodel#dayTimeDuration&quot;&gt;
 81          *   XQuery 1.0 and XPath 2.0 Data Model, xdt:dayTimeDuration&lt;/a&gt;.&lt;/p&gt;
 82          *
 83          * &lt;p&gt;The datatype &lt;code&gt;xdt:dayTimeDuration&lt;/code&gt; is a subtype of &lt;code&gt;xs:duration&lt;/code&gt;
 84          * whose lexical representation contains only day, hour, minute, and second components.
 85          * This datatype resides in the namespace &lt;code&gt;http://www.w3.org/2003/11/xpath-datatypes&lt;/code&gt;.&lt;/p&gt;
 86          *
 87      * &lt;p&gt;All four values are set and availabe from the created {@link Duration}&lt;/p&gt;
 88          *
 89      * &lt;p&gt;The XML Schema specification states that values can be of an arbitrary size.
 90      * Implementations may chose not to or be incapable of supporting arbitrarily large and/or small values.
 91      * An {@link UnsupportedOperationException} will be thrown with a message indicating implementation limits
 92      * if implementation capacities are exceeded.&lt;/p&gt;
 93      *
 94          * @param lexicalRepresentation Lexical representation of a duration.
 95          *
 96          * @throws IllegalArgumentException If &lt;code&gt;lexicalRepresentation&lt;/code&gt; is not a valid representation of a &lt;code&gt;Duration&lt;/code&gt; expressed only in terms of days and time.
 97          * @throws UnsupportedOperationException If implementation cannot support requested values.
 98          * @throws NullPointerException If &lt;code&gt;lexicalRepresentation&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.
 99          */
100     protected DurationDayTimeImpl(String lexicalRepresentation) {
101         super(lexicalRepresentation);
102 
103         if (getYears() &gt; 0 || getMonths() &gt; 0) {
104             throw new IllegalArgumentException(
105                     &quot;Trying to create an xdt:dayTimeDuration with an invalid&quot;
106                     + &quot; lexical representation of \&quot;&quot; + lexicalRepresentation
107                     + &quot;\&quot;, data model requires a format PnDTnHnMnS.&quot;);
108         }
109 
110         convertToCanonicalDayTime();
111     }
112         /**
113          * &lt;p&gt;Create a &lt;code&gt;Duration&lt;/code&gt; of type &lt;code&gt;xdt:dayTimeDuration&lt;/code&gt; using the specified milliseconds as defined in
114          * &lt;a href=&quot;http://www.w3.org/TR/xpath-datamodel#dayTimeDuration&quot;&gt;
115          *   XQuery 1.0 and XPath 2.0 Data Model, xdt:dayTimeDuration&lt;/a&gt;.&lt;/p&gt;
116          *
117          * &lt;p&gt;The datatype &lt;code&gt;xdt:dayTimeDuration&lt;/code&gt; is a subtype of &lt;code&gt;xs:duration&lt;/code&gt;
118          * whose lexical representation contains only day, hour, minute, and second components.
119          * This datatype resides in the namespace &lt;code&gt;http://www.w3.org/2003/11/xpath-datatypes&lt;/code&gt;.&lt;/p&gt;
120          *
121      * &lt;p&gt;All four values are set by computing their values from the specified milliseconds
122      * and are availabe using the &lt;code&gt;get&lt;/code&gt; methods of  the created {@link Duration}.
123      * The values conform to and are defined by:&lt;/p&gt;
124      * &lt;ul&gt;
125      *   &lt;li&gt;ISO 8601:2000(E) Section 5.5.3.2 Alternative format&lt;/li&gt;
126      *   &lt;li&gt;&lt;a href=&quot;http://www.w3.org/TR/xmlschema-2/#isoformats&quot;&gt;
127      *     W3C XML Schema 1.0 Part 2, Appendix D, ISO 8601 Date and Time Formats&lt;/a&gt;
128      *   &lt;/li&gt;
129      *   &lt;li&gt;{@link XMLGregorianCalendar}  Date/Time Datatype Field Mapping Between XML Schema 1.0 and Java Representation&lt;/li&gt;
130      * &lt;/ul&gt;
131          *
132          * &lt;p&gt;The default start instance is defined by {@link GregorianCalendar}&#39;s use of the start of the epoch: i.e.,
133          * {@link java.util.Calendar#YEAR} = 1970,
134          * {@link java.util.Calendar#MONTH} = {@link java.util.Calendar#JANUARY},
135          * {@link java.util.Calendar#DATE} = 1, etc.
136          * This is important as there are variations in the Gregorian Calendar,
137          * e.g. leap years have different days in the month = {@link java.util.Calendar#FEBRUARY}
138          * so the result of {@link Duration#getDays()} can be influenced.&lt;/p&gt;
139          *
140      * &lt;p&gt;Any remaining milliseconds after determining the day, hour, minute and second are discarded.&lt;/p&gt;
141      *
142      * @param durationInMilliseconds Milliseconds of &lt;code&gt;Duration&lt;/code&gt; to create.
143      *
144      * @return New &lt;code&gt;Duration&lt;/code&gt; created with the specified &lt;code&gt;durationInMilliseconds&lt;/code&gt;.
145      *
146      * @see &lt;a href=&quot;http://www.w3.org/TR/xpath-datamodel#dayTimeDuration&quot;&gt;
147      *   XQuery 1.0 and XPath 2.0 Data Model, xdt:dayTimeDuration&lt;/a&gt;
148      */
149     protected DurationDayTimeImpl(final long durationInMilliseconds) {
150             super(durationInMilliseconds);
151             convertToCanonicalDayTime();
152             // only day, hour, minute, and second should have values
153             years = null;
154             months = null;
155     }
156 
157 
158     /**
159      * The value space of xs:dayTimeDuration is the set of fractional second values.
160      * @return fractional second values
161      */
162     public float getValue() {
163         float sec = (seconds==null)?0:seconds.floatValue();
164         return (((((getDays() * 24) +
165                     getHours()) * 60) +
166                     getMinutes())*60) +
167                     sec;
168     }
169 
170     private void convertToCanonicalDayTime() {
171 
172         while (getSeconds() &gt;= 60)
173         {
174             seconds = seconds.subtract(BigDecimal.valueOf(60));
175             minutes = BigInteger.valueOf((long) getMinutes()).add(BigInteger.ONE);
176         }
177 
178         while (getMinutes() &gt;= 60)
179         {
180             minutes = minutes.subtract(BigInteger.valueOf(60));
181             hours = BigInteger.valueOf((long) getHours()).add(BigInteger.ONE);
182         }
183 
184         while (getHours() &gt;= 24)
185         {
186             hours = hours.subtract(BigInteger.valueOf(24));
187             days = BigInteger.valueOf((long) getDays()).add(BigInteger.ONE);
188         }
189     }
190 
191 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>