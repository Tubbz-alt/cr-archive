<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/FieldOrMethod.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FieldObserver.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="GETFIELD.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/FieldOrMethod.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.bcel.internal.generic;
 23 
 24 import com.sun.org.apache.bcel.internal.Const;
 25 import com.sun.org.apache.bcel.internal.classfile.ConstantCP;
 26 import com.sun.org.apache.bcel.internal.classfile.ConstantNameAndType;
 27 import com.sun.org.apache.bcel.internal.classfile.ConstantPool;
 28 import com.sun.org.apache.bcel.internal.classfile.ConstantUtf8;
 29 
 30 /**
 31  * Super class for InvokeInstruction and FieldInstruction, since they have
 32  * some methods in common!
 33  *
<span class="line-removed"> 34  * @version $Id: FieldOrMethod.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
 35  */
 36 public abstract class FieldOrMethod extends CPInstruction implements LoadClass {
 37 
 38     /**
<span class="line-modified"> 39      * Empty constructor needed for the Class.newInstance() statement in</span>
<span class="line-modified"> 40      * Instruction.readInstruction(). Not to be used otherwise.</span>
 41      */
 42     FieldOrMethod() {

 43     }
 44 
 45 
 46     /**
 47      * @param index to constant pool
 48      */
 49     protected FieldOrMethod(final short opcode, final int index) {
 50         super(opcode, index);
 51     }
 52 
 53 
 54     /** @return signature of referenced method/field.
 55      */
<span class="line-modified"> 56     public String getSignature( final ConstantPoolGen cpg ) {</span>
 57         final ConstantPool cp = cpg.getConstantPool();
 58         final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
 59         final ConstantNameAndType cnat = (ConstantNameAndType) cp.getConstant(cmr.getNameAndTypeIndex());
 60         return ((ConstantUtf8) cp.getConstant(cnat.getSignatureIndex())).getBytes();
 61     }
 62 
 63 
 64     /** @return name of referenced method/field.
 65      */
<span class="line-modified"> 66     public String getName( final ConstantPoolGen cpg ) {</span>
 67         final ConstantPool cp = cpg.getConstantPool();
 68         final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
 69         final ConstantNameAndType cnat = (ConstantNameAndType) cp.getConstant(cmr.getNameAndTypeIndex());
 70         return ((ConstantUtf8) cp.getConstant(cnat.getNameIndex())).getBytes();
 71     }
 72 
 73 
 74     /**
 75      * @return name of the referenced class/interface
 76      * @deprecated If the instruction references an array class,
 77      *    this method will return &quot;java.lang.Object&quot;.
 78      *    For code generated by Java 1.5, this answer is
 79      *    sometimes wrong (e.g., if the &quot;clone()&quot; method is
 80      *    called on an array).  A better idea is to use
 81      *    the {@link #getReferenceType(ConstantPoolGen)} method, which correctly distinguishes
 82      *    between class types and array types.
 83      *
 84      */
 85     @Deprecated
<span class="line-modified"> 86     public String getClassName( final ConstantPoolGen cpg ) {</span>
 87         final ConstantPool cp = cpg.getConstantPool();
 88         final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
 89         final String className = cp.getConstantString(cmr.getClassIndex(), Const.CONSTANT_Class);
 90         if (className.startsWith(&quot;[&quot;)) {
 91             // Turn array classes into java.lang.Object.
 92             return &quot;java.lang.Object&quot;;
 93         }
 94         return className.replace(&#39;/&#39;, &#39;.&#39;);
 95     }
 96 
 97 
 98     /** @return type of the referenced class/interface
 99      * @deprecated If the instruction references an array class,
100      *    the ObjectType returned will be invalid.  Use
101      *    getReferenceType() instead.
102      */
103     @Deprecated
<span class="line-modified">104     public ObjectType getClassType( final ConstantPoolGen cpg ) {</span>
105         return ObjectType.getInstance(getClassName(cpg));
106     }
107 
108 
109     /**
<span class="line-modified">110      * Return the reference type representing the class, interface,</span>
111      * or array class referenced by the instruction.
112      * @param cpg the ConstantPoolGen used to create the instruction
113      * @return an ObjectType (if the referenced class type is a class
114      *   or interface), or an ArrayType (if the referenced class
115      *   type is an array class)
116      */
<span class="line-modified">117     public ReferenceType getReferenceType( final ConstantPoolGen cpg ) {</span>
118         final ConstantPool cp = cpg.getConstantPool();
119         final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
120         String className = cp.getConstantString(cmr.getClassIndex(), Const.CONSTANT_Class);
121         if (className.startsWith(&quot;[&quot;)) {
122             return (ArrayType) Type.getType(className);
123         }
124         className = className.replace(&#39;/&#39;, &#39;.&#39;);
125         return ObjectType.getInstance(className);
126     }
127 
128 
129     /**
<span class="line-modified">130      * Get the ObjectType of the method return or field.</span>
131      *
132      * @return type of the referenced class/interface
133      * @throws ClassGenException when the field is (or method returns) an array,
134      */
135     @Override
<span class="line-modified">136     public ObjectType getLoadClassType( final ConstantPoolGen cpg ) {</span>
137         final ReferenceType rt = getReferenceType(cpg);
<span class="line-modified">138         if(rt instanceof ObjectType) {</span>
<span class="line-modified">139             return (ObjectType)rt;</span>
140         }
<span class="line-modified">141         throw new ClassGenException(rt.getSignature() + &quot; does not represent an ObjectType&quot;);</span>

142     }
143 }
</pre>
</td>
<td>
<hr />
<pre>
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.bcel.internal.generic;
 23 
 24 import com.sun.org.apache.bcel.internal.Const;
 25 import com.sun.org.apache.bcel.internal.classfile.ConstantCP;
 26 import com.sun.org.apache.bcel.internal.classfile.ConstantNameAndType;
 27 import com.sun.org.apache.bcel.internal.classfile.ConstantPool;
 28 import com.sun.org.apache.bcel.internal.classfile.ConstantUtf8;
 29 
 30 /**
 31  * Super class for InvokeInstruction and FieldInstruction, since they have
 32  * some methods in common!
 33  *

 34  */
 35 public abstract class FieldOrMethod extends CPInstruction implements LoadClass {
 36 
 37     /**
<span class="line-modified"> 38      * Empty constructor needed for Instruction.readInstruction.</span>
<span class="line-modified"> 39      * Not to be used otherwise.</span>
 40      */
 41     FieldOrMethod() {
<span class="line-added"> 42         // no init</span>
 43     }
 44 
 45 
 46     /**
 47      * @param index to constant pool
 48      */
 49     protected FieldOrMethod(final short opcode, final int index) {
 50         super(opcode, index);
 51     }
 52 
 53 
 54     /** @return signature of referenced method/field.
 55      */
<span class="line-modified"> 56     public String getSignature(final ConstantPoolGen cpg) {</span>
 57         final ConstantPool cp = cpg.getConstantPool();
 58         final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
 59         final ConstantNameAndType cnat = (ConstantNameAndType) cp.getConstant(cmr.getNameAndTypeIndex());
 60         return ((ConstantUtf8) cp.getConstant(cnat.getSignatureIndex())).getBytes();
 61     }
 62 
 63 
 64     /** @return name of referenced method/field.
 65      */
<span class="line-modified"> 66     public String getName(final ConstantPoolGen cpg) {</span>
 67         final ConstantPool cp = cpg.getConstantPool();
 68         final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
 69         final ConstantNameAndType cnat = (ConstantNameAndType) cp.getConstant(cmr.getNameAndTypeIndex());
 70         return ((ConstantUtf8) cp.getConstant(cnat.getNameIndex())).getBytes();
 71     }
 72 
 73 
 74     /**
 75      * @return name of the referenced class/interface
 76      * @deprecated If the instruction references an array class,
 77      *    this method will return &quot;java.lang.Object&quot;.
 78      *    For code generated by Java 1.5, this answer is
 79      *    sometimes wrong (e.g., if the &quot;clone()&quot; method is
 80      *    called on an array).  A better idea is to use
 81      *    the {@link #getReferenceType(ConstantPoolGen)} method, which correctly distinguishes
 82      *    between class types and array types.
 83      *
 84      */
 85     @Deprecated
<span class="line-modified"> 86     public String getClassName(final ConstantPoolGen cpg) {</span>
 87         final ConstantPool cp = cpg.getConstantPool();
 88         final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
 89         final String className = cp.getConstantString(cmr.getClassIndex(), Const.CONSTANT_Class);
 90         if (className.startsWith(&quot;[&quot;)) {
 91             // Turn array classes into java.lang.Object.
 92             return &quot;java.lang.Object&quot;;
 93         }
 94         return className.replace(&#39;/&#39;, &#39;.&#39;);
 95     }
 96 
 97 
 98     /** @return type of the referenced class/interface
 99      * @deprecated If the instruction references an array class,
100      *    the ObjectType returned will be invalid.  Use
101      *    getReferenceType() instead.
102      */
103     @Deprecated
<span class="line-modified">104     public ObjectType getClassType(final ConstantPoolGen cpg) {</span>
105         return ObjectType.getInstance(getClassName(cpg));
106     }
107 
108 
109     /**
<span class="line-modified">110      * Gets the reference type representing the class, interface,</span>
111      * or array class referenced by the instruction.
112      * @param cpg the ConstantPoolGen used to create the instruction
113      * @return an ObjectType (if the referenced class type is a class
114      *   or interface), or an ArrayType (if the referenced class
115      *   type is an array class)
116      */
<span class="line-modified">117     public ReferenceType getReferenceType(final ConstantPoolGen cpg) {</span>
118         final ConstantPool cp = cpg.getConstantPool();
119         final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
120         String className = cp.getConstantString(cmr.getClassIndex(), Const.CONSTANT_Class);
121         if (className.startsWith(&quot;[&quot;)) {
122             return (ArrayType) Type.getType(className);
123         }
124         className = className.replace(&#39;/&#39;, &#39;.&#39;);
125         return ObjectType.getInstance(className);
126     }
127 
128 
129     /**
<span class="line-modified">130      * Gets the ObjectType of the method return or field.</span>
131      *
132      * @return type of the referenced class/interface
133      * @throws ClassGenException when the field is (or method returns) an array,
134      */
135     @Override
<span class="line-modified">136     public ObjectType getLoadClassType(final ConstantPoolGen cpg) {</span>
137         final ReferenceType rt = getReferenceType(cpg);
<span class="line-modified">138         if (rt instanceof ObjectType) {</span>
<span class="line-modified">139             return (ObjectType) rt;</span>
140         }
<span class="line-modified">141         throw new ClassGenException(rt.getClass().getCanonicalName() + &quot; &quot; +</span>
<span class="line-added">142                 rt.getSignature() + &quot; does not represent an ObjectType&quot;);</span>
143     }
144 }
</pre>
</td>
</tr>
</table>
<center><a href="FieldObserver.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="GETFIELD.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>