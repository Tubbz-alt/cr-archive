<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xerces/internal/impl/dv/xs/TypeValidator.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../XMLEntityManager.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../msg/XMLSchemaMessages.properties.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xerces/internal/impl/dv/xs/TypeValidator.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * reserved comment block</span>
<span class="line-removed">  3  * DO NOT REMOVE OR ALTER!</span>
  4  */
  5 /*
  6  * Licensed to the Apache Software Foundation (ASF) under one or more
  7  * contributor license agreements.  See the NOTICE file distributed with
  8  * this work for additional information regarding copyright ownership.
  9  * The ASF licenses this file to You under the Apache License, Version 2.0
 10  * (the &quot;License&quot;); you may not use this file except in compliance with
 11  * the License.  You may obtain a copy of the License at
 12  *
 13  *      http://www.apache.org/licenses/LICENSE-2.0
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.xerces.internal.impl.dv.xs;
 23 
 24 import com.sun.org.apache.xerces.internal.impl.dv.InvalidDatatypeValueException;
 25 import com.sun.org.apache.xerces.internal.impl.dv.ValidationContext;


 26 
 27 /**
 28  * All primitive types plus ID/IDREF/ENTITY/INTEGER are derived from this abstract
 29  * class. It provides extra information XSSimpleTypeDecl requires from each
 30  * type: allowed facets, converting String to actual value, check equality,
 31  * comparison, etc.
 32  *
 33  * @xerces.internal
 34  *
 35  * @author Neeraj Bajaj, Sun Microsystems, inc.
 36  * @author Sandy Gao, IBM
 37  *

 38  */
 39 public abstract class TypeValidator {
 40 




 41     // which facets are allowed for this type
 42     public abstract short getAllowedFacets();
 43 
 44     // convert a string to an actual value. for example,
 45     // for number types (decimal, double, float, and types derived from them),
 46     // get the BigDecimal, Double, Flout object.
 47     // for some types (string and derived), they just return the string itself
 48     public abstract Object getActualValue(String content, ValidationContext context)
 49         throws InvalidDatatypeValueException;
 50 
 51     // for ID/IDREF/ENTITY types, do some extra checking after the value is
 52     // checked to be valid with respect to both lexical representation and
 53     // facets
 54     public void checkExtraRules(Object value, ValidationContext context) throws InvalidDatatypeValueException {
 55     }
 56 
 57     // the following methods might not be supported by every DV.
 58     // but XSSimpleTypeDecl should know which type supports which methods,
 59     // and it&#39;s an *internal* error if a method is called on a DV that
 60     // doesn&#39;t support it.
</pre>
<hr />
<pre>
 65     public static final short GREATER_THAN  = 1;
 66     public static final short INDETERMINATE = 2;
 67 
 68     // where there is distinction between identity and equality, this method
 69     // will be overwritten
 70     // checks whether the two values are identical; for ex, this distinguishes
 71     // -0.0 from 0.0
 72     public boolean isIdentical (Object value1, Object value2) {
 73         return value1.equals(value2);
 74     }
 75 
 76     // check the order relation between the two values
 77     // the parameters are in compiled form (from getActualValue)
 78     public int compare(Object value1, Object value2) {
 79         return -1;
 80     }
 81 
 82     // get the length of the value
 83     // the parameters are in compiled form (from getActualValue)
 84     public int getDataLength(Object value) {
<span class="line-modified"> 85         return (value instanceof String) ? ((String)value).length() : -1;</span>







 86     }
 87 
 88     // get the number of digits of the value
 89     // the parameters are in compiled form (from getActualValue)
 90     public int getTotalDigits(Object value) {
 91         return -1;
 92     }
 93 
 94     // get the number of fraction digits of the value
 95     // the parameters are in compiled form (from getActualValue)
 96     public int getFractionDigits(Object value) {
 97         return -1;
 98     }
 99 



















100     // check whether the character is in the range 0x30 ~ 0x39
101     public static final boolean isDigit(char ch) {
102         return ch &gt;= &#39;0&#39; &amp;&amp; ch &lt;= &#39;9&#39;;
103     }
104 
105     // if the character is in the range 0x30 ~ 0x39, return its int value (0~9),
106     // otherwise, return -1
107     public static final int getDigit(char ch) {
108         return isDigit(ch) ? ch - &#39;0&#39; : -1;
109     }
110 
111 } // interface TypeValidator
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>

  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xerces.internal.impl.dv.xs;
 22 
 23 import com.sun.org.apache.xerces.internal.impl.dv.InvalidDatatypeValueException;
 24 import com.sun.org.apache.xerces.internal.impl.dv.ValidationContext;
<span class="line-added"> 25 import com.sun.org.apache.xerces.internal.util.XMLChar;</span>
<span class="line-added"> 26 import jdk.xml.internal.SecuritySupport;</span>
 27 
 28 /**
 29  * All primitive types plus ID/IDREF/ENTITY/INTEGER are derived from this abstract
 30  * class. It provides extra information XSSimpleTypeDecl requires from each
 31  * type: allowed facets, converting String to actual value, check equality,
 32  * comparison, etc.
 33  *
 34  * @xerces.internal
 35  *
 36  * @author Neeraj Bajaj, Sun Microsystems, inc.
 37  * @author Sandy Gao, IBM
 38  *
<span class="line-added"> 39  * @LastModified: Apr 2019</span>
 40  */
 41 public abstract class TypeValidator {
 42 
<span class="line-added"> 43     private static final boolean USE_CODE_POINT_COUNT_FOR_STRING_LENGTH =</span>
<span class="line-added"> 44             Boolean.parseBoolean(SecuritySupport.getSystemProperty(</span>
<span class="line-added"> 45                     &quot;com.sun.org.apache.xerces.internal.impl.dv.xs.useCodePointCountForStringLength&quot;, &quot;false&quot;));</span>
<span class="line-added"> 46 </span>
 47     // which facets are allowed for this type
 48     public abstract short getAllowedFacets();
 49 
 50     // convert a string to an actual value. for example,
 51     // for number types (decimal, double, float, and types derived from them),
 52     // get the BigDecimal, Double, Flout object.
 53     // for some types (string and derived), they just return the string itself
 54     public abstract Object getActualValue(String content, ValidationContext context)
 55         throws InvalidDatatypeValueException;
 56 
 57     // for ID/IDREF/ENTITY types, do some extra checking after the value is
 58     // checked to be valid with respect to both lexical representation and
 59     // facets
 60     public void checkExtraRules(Object value, ValidationContext context) throws InvalidDatatypeValueException {
 61     }
 62 
 63     // the following methods might not be supported by every DV.
 64     // but XSSimpleTypeDecl should know which type supports which methods,
 65     // and it&#39;s an *internal* error if a method is called on a DV that
 66     // doesn&#39;t support it.
</pre>
<hr />
<pre>
 71     public static final short GREATER_THAN  = 1;
 72     public static final short INDETERMINATE = 2;
 73 
 74     // where there is distinction between identity and equality, this method
 75     // will be overwritten
 76     // checks whether the two values are identical; for ex, this distinguishes
 77     // -0.0 from 0.0
 78     public boolean isIdentical (Object value1, Object value2) {
 79         return value1.equals(value2);
 80     }
 81 
 82     // check the order relation between the two values
 83     // the parameters are in compiled form (from getActualValue)
 84     public int compare(Object value1, Object value2) {
 85         return -1;
 86     }
 87 
 88     // get the length of the value
 89     // the parameters are in compiled form (from getActualValue)
 90     public int getDataLength(Object value) {
<span class="line-modified"> 91         if (value instanceof String) {</span>
<span class="line-added"> 92             final String str = (String)value;</span>
<span class="line-added"> 93             if (!USE_CODE_POINT_COUNT_FOR_STRING_LENGTH) {</span>
<span class="line-added"> 94                 return str.length();</span>
<span class="line-added"> 95             }</span>
<span class="line-added"> 96             return getCodePointLength(str);</span>
<span class="line-added"> 97         }</span>
<span class="line-added"> 98         return -1;</span>
 99     }
100 
101     // get the number of digits of the value
102     // the parameters are in compiled form (from getActualValue)
103     public int getTotalDigits(Object value) {
104         return -1;
105     }
106 
107     // get the number of fraction digits of the value
108     // the parameters are in compiled form (from getActualValue)
109     public int getFractionDigits(Object value) {
110         return -1;
111     }
112 
<span class="line-added">113     // Returns the length of the string in Unicode code points.</span>
<span class="line-added">114     private int getCodePointLength(String value) {</span>
<span class="line-added">115         // Count the number of surrogate pairs, and subtract them from</span>
<span class="line-added">116         // the total length.</span>
<span class="line-added">117         final int len = value.length();</span>
<span class="line-added">118         int surrogatePairCount = 0;</span>
<span class="line-added">119         for (int i = 0; i &lt; len - 1; ++i) {</span>
<span class="line-added">120             if (XMLChar.isHighSurrogate(value.charAt(i))) {</span>
<span class="line-added">121                 if (XMLChar.isLowSurrogate(value.charAt(++i))) {</span>
<span class="line-added">122                     ++surrogatePairCount;</span>
<span class="line-added">123                 }</span>
<span class="line-added">124                 else {</span>
<span class="line-added">125                     --i;</span>
<span class="line-added">126                 }</span>
<span class="line-added">127             }</span>
<span class="line-added">128         }</span>
<span class="line-added">129         return len - surrogatePairCount;</span>
<span class="line-added">130     }</span>
<span class="line-added">131 </span>
132     // check whether the character is in the range 0x30 ~ 0x39
133     public static final boolean isDigit(char ch) {
134         return ch &gt;= &#39;0&#39; &amp;&amp; ch &lt;= &#39;9&#39;;
135     }
136 
137     // if the character is in the range 0x30 ~ 0x39, return its int value (0~9),
138     // otherwise, return -1
139     public static final int getDigit(char ch) {
140         return isDigit(ch) ? ch - &#39;0&#39; : -1;
141     }
142 
143 } // interface TypeValidator
</pre>
</td>
</tr>
</table>
<center><a href="../../XMLEntityManager.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../msg/XMLSchemaMessages.properties.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>