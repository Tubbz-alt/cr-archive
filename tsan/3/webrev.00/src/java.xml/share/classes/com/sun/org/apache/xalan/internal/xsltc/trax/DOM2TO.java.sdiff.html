<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/trax/DOM2TO.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../runtime/output/TransletOutputHandlerFactory.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="StAXStream2SAX.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/trax/DOM2TO.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * reserved comment block</span>
<span class="line-removed">  3  * DO NOT REMOVE OR ALTER!</span>
  4  */
  5 /*
  6  * Licensed to the Apache Software Foundation (ASF) under one or more
  7  * contributor license agreements.  See the NOTICE file distributed with
  8  * this work for additional information regarding copyright ownership.
  9  * The ASF licenses this file to You under the Apache License, Version 2.0
 10  * (the &quot;License&quot;); you may not use this file except in compliance with
 11  * the License.  You may obtain a copy of the License at
 12  *
 13  *      http://www.apache.org/licenses/LICENSE-2.0
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.xalan.internal.xsltc.trax;
 23 
</pre>
<hr />
<pre>
 25 
 26 import org.w3c.dom.NamedNodeMap;
 27 import org.w3c.dom.Node;
 28 import org.w3c.dom.Document;
 29 import com.sun.org.apache.xml.internal.serializer.SerializationHandler;
 30 import org.xml.sax.ContentHandler;
 31 import org.xml.sax.DTDHandler;
 32 import org.xml.sax.EntityResolver;
 33 import org.xml.sax.ErrorHandler;
 34 import org.xml.sax.InputSource;
 35 import org.xml.sax.ext.Locator2;
 36 import org.xml.sax.SAXException;
 37 import org.xml.sax.SAXNotRecognizedException;
 38 import org.xml.sax.SAXNotSupportedException;
 39 import org.xml.sax.XMLReader;
 40 import com.sun.org.apache.xml.internal.serializer.NamespaceMappings;
 41 
 42 /**
 43  * @author Santiago Pericas-Geertsen
 44  * @author Sunitha Reddy

 45  */
 46 public class DOM2TO implements XMLReader, Locator2 {
 47 
 48     private final static String EMPTYSTRING = &quot;&quot;;
 49     private static final String XMLNS_PREFIX = &quot;xmlns&quot;;
 50 
 51     /**
 52      * A reference to the DOM to be traversed.
 53      */
 54     private Node _dom;
 55 
 56     /**
 57      * A reference to the output handler receiving the events.
 58      */
 59     private SerializationHandler _handler;
 60 
 61 
 62     private String xmlVersion = null;
 63 
 64     private String xmlEncoding = null;
</pre>
<hr />
<pre>
154             String prefix;
155             final NamedNodeMap map = node.getAttributes();
156             final int length = map.getLength();
157 
158             // Process all namespace attributes first
159             for (int i = 0; i &lt; length; i++) {
160                 final Node attr = map.item(i);
161                 final String qnameAttr = attr.getNodeName();
162 
163                 // Is this a namespace declaration?
164                 if (qnameAttr.startsWith(XMLNS_PREFIX)) {
165                     final String uriAttr = attr.getNodeValue();
166                     colon = qnameAttr.lastIndexOf(&#39;:&#39;);
167                     prefix = (colon &gt; 0) ? qnameAttr.substring(colon + 1)
168                                          : EMPTYSTRING;
169                     _handler.namespaceAfterStartElement(prefix, uriAttr);
170                 }
171             }
172 
173             // Process all non-namespace attributes next
<span class="line-modified">174             NamespaceMappings nm = new NamespaceMappings();</span>
175             for (int i = 0; i &lt; length; i++) {
176                 final Node attr = map.item(i);
177                 final String qnameAttr = attr.getNodeName();
178 
179                 // Is this a regular attribute?
180                 if (!qnameAttr.startsWith(XMLNS_PREFIX)) {
181                     final String uriAttr = attr.getNamespaceURI();
182                     // Uri may be implicitly declared
183                     if (uriAttr != null &amp;&amp; !uriAttr.equals(EMPTYSTRING) ) {
184                         colon = qnameAttr.lastIndexOf(&#39;:&#39;);
185 
186                         // Fix for bug 26319
187                         // For attributes not given an prefix explictly
188                         // but having a namespace uri we need
189                         // to explicitly generate the prefix

190                         String newPrefix = nm.lookupPrefix(uriAttr);
191                         if (newPrefix == null)
192                             newPrefix = nm.generateNextPrefix();
193                         prefix = (colon &gt; 0) ? qnameAttr.substring(0, colon)
194                             : newPrefix;
195                         _handler.namespaceAfterStartElement(prefix, uriAttr);
196                         _handler.addAttribute((prefix + &quot;:&quot; + qnameAttr),
197                             attr.getNodeValue());
198                     } else {
199                          _handler.addAttribute(qnameAttr, attr.getNodeValue());
200                     }
201                 }
202             }
203 
204             // Now element namespace and children
205             final String uri = node.getNamespaceURI();
206             final String localName = node.getLocalName();
207 
208             // Uri may be implicitly declared
209             if (uri != null) {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2019, Oracle and/or its affiliates. All rights reserved.</span>

  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xalan.internal.xsltc.trax;
 22 
</pre>
<hr />
<pre>
 24 
 25 import org.w3c.dom.NamedNodeMap;
 26 import org.w3c.dom.Node;
 27 import org.w3c.dom.Document;
 28 import com.sun.org.apache.xml.internal.serializer.SerializationHandler;
 29 import org.xml.sax.ContentHandler;
 30 import org.xml.sax.DTDHandler;
 31 import org.xml.sax.EntityResolver;
 32 import org.xml.sax.ErrorHandler;
 33 import org.xml.sax.InputSource;
 34 import org.xml.sax.ext.Locator2;
 35 import org.xml.sax.SAXException;
 36 import org.xml.sax.SAXNotRecognizedException;
 37 import org.xml.sax.SAXNotSupportedException;
 38 import org.xml.sax.XMLReader;
 39 import com.sun.org.apache.xml.internal.serializer.NamespaceMappings;
 40 
 41 /**
 42  * @author Santiago Pericas-Geertsen
 43  * @author Sunitha Reddy
<span class="line-added"> 44  * @LastModified: Nov 2019</span>
 45  */
 46 public class DOM2TO implements XMLReader, Locator2 {
 47 
 48     private final static String EMPTYSTRING = &quot;&quot;;
 49     private static final String XMLNS_PREFIX = &quot;xmlns&quot;;
 50 
 51     /**
 52      * A reference to the DOM to be traversed.
 53      */
 54     private Node _dom;
 55 
 56     /**
 57      * A reference to the output handler receiving the events.
 58      */
 59     private SerializationHandler _handler;
 60 
 61 
 62     private String xmlVersion = null;
 63 
 64     private String xmlEncoding = null;
</pre>
<hr />
<pre>
154             String prefix;
155             final NamedNodeMap map = node.getAttributes();
156             final int length = map.getLength();
157 
158             // Process all namespace attributes first
159             for (int i = 0; i &lt; length; i++) {
160                 final Node attr = map.item(i);
161                 final String qnameAttr = attr.getNodeName();
162 
163                 // Is this a namespace declaration?
164                 if (qnameAttr.startsWith(XMLNS_PREFIX)) {
165                     final String uriAttr = attr.getNodeValue();
166                     colon = qnameAttr.lastIndexOf(&#39;:&#39;);
167                     prefix = (colon &gt; 0) ? qnameAttr.substring(colon + 1)
168                                          : EMPTYSTRING;
169                     _handler.namespaceAfterStartElement(prefix, uriAttr);
170                 }
171             }
172 
173             // Process all non-namespace attributes next
<span class="line-modified">174             NamespaceMappings nm = null;</span>
175             for (int i = 0; i &lt; length; i++) {
176                 final Node attr = map.item(i);
177                 final String qnameAttr = attr.getNodeName();
178 
179                 // Is this a regular attribute?
180                 if (!qnameAttr.startsWith(XMLNS_PREFIX)) {
181                     final String uriAttr = attr.getNamespaceURI();
182                     // Uri may be implicitly declared
183                     if (uriAttr != null &amp;&amp; !uriAttr.equals(EMPTYSTRING) ) {
184                         colon = qnameAttr.lastIndexOf(&#39;:&#39;);
185 
186                         // Fix for bug 26319
187                         // For attributes not given an prefix explictly
188                         // but having a namespace uri we need
189                         // to explicitly generate the prefix
<span class="line-added">190                         if (nm == null) nm = new NamespaceMappings();</span>
191                         String newPrefix = nm.lookupPrefix(uriAttr);
192                         if (newPrefix == null)
193                             newPrefix = nm.generateNextPrefix();
194                         prefix = (colon &gt; 0) ? qnameAttr.substring(0, colon)
195                             : newPrefix;
196                         _handler.namespaceAfterStartElement(prefix, uriAttr);
197                         _handler.addAttribute((prefix + &quot;:&quot; + qnameAttr),
198                             attr.getNodeValue());
199                     } else {
200                          _handler.addAttribute(qnameAttr, attr.getNodeValue());
201                     }
202                 }
203             }
204 
205             // Now element namespace and children
206             final String uri = node.getNamespaceURI();
207             final String localName = node.getLocalName();
208 
209             // Uri may be implicitly declared
210             if (uri != null) {
</pre>
</td>
</tr>
</table>
<center><a href="../runtime/output/TransletOutputHandlerFactory.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="StAXStream2SAX.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>