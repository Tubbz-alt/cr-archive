<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/java.xml/share/classes/com/sun/org/apache/bcel/internal/util/Class2HTML.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 package com.sun.org.apache.bcel.internal.util;
 21 
 22 import java.io.File;
 23 import java.io.FileOutputStream;
 24 import java.io.IOException;
 25 import java.io.PrintWriter;
 26 import java.util.HashSet;
 27 import java.util.Set;
 28 
 29 import com.sun.org.apache.bcel.internal.Const;
 30 import com.sun.org.apache.bcel.internal.classfile.Attribute;
 31 import com.sun.org.apache.bcel.internal.classfile.ClassParser;
 32 import com.sun.org.apache.bcel.internal.classfile.ConstantPool;
 33 import com.sun.org.apache.bcel.internal.classfile.JavaClass;
 34 import com.sun.org.apache.bcel.internal.classfile.Method;
 35 import com.sun.org.apache.bcel.internal.classfile.Utility;
 36 
 37 /**
 38  * Read class file(s) and convert them into HTML files.
 39  *
 40  * Given a JavaClass object &quot;class&quot; that is in package &quot;package&quot; five files
 41  * will be created in the specified directory.
 42  *
 43  * &lt;OL&gt;
 44  * &lt;LI&gt; &quot;package&quot;.&quot;class&quot;.html as the main file which defines the frames for
 45  * the following subfiles.
 46  * &lt;LI&gt;  &quot;package&quot;.&quot;class&quot;_attributes.html contains all (known) attributes found in the file
 47  * &lt;LI&gt;  &quot;package&quot;.&quot;class&quot;_cp.html contains the constant pool
 48  * &lt;LI&gt;  &quot;package&quot;.&quot;class&quot;_code.html contains the byte code
 49  * &lt;LI&gt;  &quot;package&quot;.&quot;class&quot;_methods.html contains references to all methods and fields of the class
 50  * &lt;/OL&gt;
 51  *
 52  * All subfiles reference each other appropriately, e.g. clicking on a
 53  * method in the Method&#39;s frame will jump to the appropriate method in
 54  * the Code frame.
 55  *
 56  * @LastModified: Jan 2020
 57  */
 58 public class Class2HTML {
 59 
 60     private final JavaClass java_class; // current class object
 61     private final String dir;
 62     private static String class_package; // name of package, unclean to make it static, but ...
 63     private static String class_name; // name of current class, dito
 64     private static ConstantPool constant_pool;
 65     private static final Set&lt;String&gt; basic_types = new HashSet&lt;&gt;();
 66 
 67     static {
 68         basic_types.add(&quot;int&quot;);
 69         basic_types.add(&quot;short&quot;);
 70         basic_types.add(&quot;boolean&quot;);
 71         basic_types.add(&quot;void&quot;);
 72         basic_types.add(&quot;char&quot;);
 73         basic_types.add(&quot;byte&quot;);
 74         basic_types.add(&quot;long&quot;);
 75         basic_types.add(&quot;double&quot;);
 76         basic_types.add(&quot;float&quot;);
 77     }
 78 
 79     /**
 80      * Write contents of the given JavaClass into HTML files.
 81      *
 82      * @param java_class The class to write
 83      * @param dir The directory to put the files in
 84      */
 85     public Class2HTML(final JavaClass java_class, final String dir) throws IOException {
 86         final Method[] methods = java_class.getMethods();
 87         this.java_class = java_class;
 88         this.dir = dir;
 89         class_name = java_class.getClassName(); // Remember full name
 90         constant_pool = java_class.getConstantPool();
 91         // Get package name by tacking off everything after the last `.&#39;
 92         final int index = class_name.lastIndexOf(&#39;.&#39;);
 93         if (index &gt; -1) {
 94             class_package = class_name.substring(0, index);
 95         } else {
 96             class_package = &quot;&quot;; // default package
 97         }
 98         final ConstantHTML constant_html = new ConstantHTML(dir, class_name, class_package, methods,
 99                 constant_pool);
100         /* Attributes can&#39;t be written in one step, so we just open a file
101          * which will be written consequently.
102          */
103         final AttributeHTML attribute_html = new AttributeHTML(dir, class_name, constant_pool,
104                 constant_html);
105         new MethodHTML(dir, class_name, methods, java_class.getFields(),
106                 constant_html, attribute_html);
107         // Write main file (with frames, yuk)
108         writeMainHTML(attribute_html);
109         new CodeHTML(dir, class_name, methods, constant_pool, constant_html);
110         attribute_html.close();
111     }
112 
113 
114     public static void main( final String[] argv ) throws IOException {
115         final String[] file_name = new String[argv.length];
116         int files = 0;
117         ClassParser parser = null;
118         JavaClass java_class = null;
119         String zip_file = null;
120         final char sep = File.separatorChar;
121         String dir = &quot;.&quot; + sep; // Where to store HTML files
122         /* Parse command line arguments.
123          */
124         for (int i = 0; i &lt; argv.length; i++) {
125             if (argv[i].charAt(0) == &#39;-&#39;) { // command line switch
126                 if (argv[i].equals(&quot;-d&quot;)) { // Specify target directory, default &#39;.&#39;
127                     dir = argv[++i];
128                     if (!dir.endsWith(&quot;&quot; + sep)) {
129                         dir = dir + sep;
130                     }
131                     final File store = new File(dir);
132                     if (!store.isDirectory()) {
133                         final boolean created = store.mkdirs(); // Create target directory if necessary
134                         if (!created) {
135                             if (!store.isDirectory()) {
136                                 System.out.println(&quot;Tried to create the directory &quot; + dir + &quot; but failed&quot;);
137                             }
138                         }
139                     }
140                 } else if (argv[i].equals(&quot;-zip&quot;)) {
141                     zip_file = argv[++i];
142                 } else {
143                     System.out.println(&quot;Unknown option &quot; + argv[i]);
144                 }
145             } else {
146                 file_name[files++] = argv[i];
147             }
148         }
149         if (files == 0) {
150             System.err.println(&quot;Class2HTML: No input files specified.&quot;);
151         } else { // Loop through files ...
152             for (int i = 0; i &lt; files; i++) {
153                 System.out.print(&quot;Processing &quot; + file_name[i] + &quot;...&quot;);
154                 if (zip_file == null) {
155                     parser = new ClassParser(file_name[i]); // Create parser object from file
156                 } else {
157                     parser = new ClassParser(zip_file, file_name[i]); // Create parser object from zip file
158                 }
159                 java_class = parser.parse();
160                 new Class2HTML(java_class, dir);
161                 System.out.println(&quot;Done.&quot;);
162             }
163         }
164     }
165 
166     /**
167      * Utility method that converts a class reference in the constant pool,
168      * i.e., an index to a string.
169      */
170     static String referenceClass(final int index) {
171         String str = constant_pool.getConstantString(index, Const.CONSTANT_Class);
172         str = Utility.compactClassName(str);
173         str = Utility.compactClassName(str, class_package + &quot;.&quot;, true);
174         return &quot;&lt;A HREF=\&quot;&quot; + class_name + &quot;_cp.html#cp&quot; + index + &quot;\&quot; TARGET=ConstantPool&gt;&quot; + str
175                 + &quot;&lt;/A&gt;&quot;;
176     }
177 
178 
179     static String referenceType( final String type ) {
180         String short_type = Utility.compactClassName(type);
181         short_type = Utility.compactClassName(short_type, class_package + &quot;.&quot;, true);
182         final int index = type.indexOf(&#39;[&#39;); // Type is an array?
183         String base_type = type;
184         if (index &gt; -1) {
185             base_type = type.substring(0, index); // Tack of the `[&#39;
186         }
187         // test for basic type
188         if (basic_types.contains(base_type)) {
189             return &quot;&lt;FONT COLOR=\&quot;#00FF00\&quot;&gt;&quot; + type + &quot;&lt;/FONT&gt;&quot;;
190         }
191         return &quot;&lt;A HREF=\&quot;&quot; + base_type + &quot;.html\&quot; TARGET=_top&gt;&quot; + short_type + &quot;&lt;/A&gt;&quot;;
192     }
193 
194 
195     static String toHTML( final String str ) {
196         final StringBuilder buf = new StringBuilder();
197         for (int i = 0; i &lt; str.length(); i++) {
198             char ch;
199             switch (ch = str.charAt(i)) {
200                 case &#39;&lt;&#39;:
201                     buf.append(&quot;&amp;lt;&quot;);
202                     break;
203                 case &#39;&gt;&#39;:
204                     buf.append(&quot;&amp;gt;&quot;);
205                     break;
206                 case &#39;\n&#39;:
207                     buf.append(&quot;\\n&quot;);
208                     break;
209                 case &#39;\r&#39;:
210                     buf.append(&quot;\\r&quot;);
211                     break;
212                 default:
213                     buf.append(ch);
214             }
215         }
216         return buf.toString();
217     }
218 
219 
220     private void writeMainHTML( final AttributeHTML attribute_html ) throws IOException {
221         try (PrintWriter file = new PrintWriter(new FileOutputStream(dir + class_name + &quot;.html&quot;))) {
222             file.println(&quot;&lt;HTML&gt;\n&quot; + &quot;&lt;HEAD&gt;&lt;TITLE&gt;Documentation for &quot; + class_name + &quot;&lt;/TITLE&gt;&quot; + &quot;&lt;/HEAD&gt;\n&quot;
223                     + &quot;&lt;FRAMESET BORDER=1 cols=\&quot;30%,*\&quot;&gt;\n&quot; + &quot;&lt;FRAMESET BORDER=1 rows=\&quot;80%,*\&quot;&gt;\n&quot;
224                     + &quot;&lt;FRAME NAME=\&quot;ConstantPool\&quot; SRC=\&quot;&quot; + class_name + &quot;_cp.html&quot; + &quot;\&quot;\n MARGINWIDTH=\&quot;0\&quot; &quot;
225                     + &quot;MARGINHEIGHT=\&quot;0\&quot; FRAMEBORDER=\&quot;1\&quot; SCROLLING=\&quot;AUTO\&quot;&gt;\n&quot; + &quot;&lt;FRAME NAME=\&quot;Attributes\&quot; SRC=\&quot;&quot;
226                     + class_name + &quot;_attributes.html&quot; + &quot;\&quot;\n MARGINWIDTH=\&quot;0\&quot; &quot;
227                     + &quot;MARGINHEIGHT=\&quot;0\&quot; FRAMEBORDER=\&quot;1\&quot; SCROLLING=\&quot;AUTO\&quot;&gt;\n&quot; + &quot;&lt;/FRAMESET&gt;\n&quot;
228                     + &quot;&lt;FRAMESET BORDER=1 rows=\&quot;80%,*\&quot;&gt;\n&quot; + &quot;&lt;FRAME NAME=\&quot;Code\&quot; SRC=\&quot;&quot; + class_name
229                     + &quot;_code.html\&quot;\n MARGINWIDTH=0 &quot; + &quot;MARGINHEIGHT=0 FRAMEBORDER=1 SCROLLING=\&quot;AUTO\&quot;&gt;\n&quot;
230                     + &quot;&lt;FRAME NAME=\&quot;Methods\&quot; SRC=\&quot;&quot; + class_name + &quot;_methods.html\&quot;\n MARGINWIDTH=0 &quot;
231                     + &quot;MARGINHEIGHT=0 FRAMEBORDER=1 SCROLLING=\&quot;AUTO\&quot;&gt;\n&quot; + &quot;&lt;/FRAMESET&gt;&lt;/FRAMESET&gt;&lt;/HTML&gt;&quot;);
232         }
233         final Attribute[] attributes = java_class.getAttributes();
234         for (int i = 0; i &lt; attributes.length; i++) {
235             attribute_html.writeAttribute(attributes[i], &quot;class&quot; + i);
236         }
237     }
238 }
    </pre>
  </body>
</html>