<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/runtime/output/TransletOutputHandlerFactory.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../MessageHandler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../trax/DOM2TO.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xalan/internal/xsltc/runtime/output/TransletOutputHandlerFactory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xalan.internal.xsltc.runtime.output;
 22 
</pre>
<hr />
<pre>
 24 import java.io.OutputStream;
 25 import java.io.Writer;
 26 
 27 import javax.xml.parsers.ParserConfigurationException;
 28 import javax.xml.stream.XMLEventWriter;
 29 import javax.xml.stream.util.XMLEventConsumer;
 30 import javax.xml.stream.XMLStreamWriter;
 31 
 32 import com.sun.org.apache.xalan.internal.xsltc.trax.SAX2DOM;
 33 import com.sun.org.apache.xalan.internal.xsltc.trax.SAX2StAXEventWriter;
 34 import com.sun.org.apache.xalan.internal.xsltc.trax.SAX2StAXStreamWriter;
 35 
 36 import com.sun.org.apache.xml.internal.serializer.ToHTMLSAXHandler;
 37 import com.sun.org.apache.xml.internal.serializer.ToHTMLStream;
 38 import com.sun.org.apache.xml.internal.serializer.ToTextSAXHandler;
 39 import com.sun.org.apache.xml.internal.serializer.ToTextStream;
 40 import com.sun.org.apache.xml.internal.serializer.ToUnknownStream;
 41 import com.sun.org.apache.xml.internal.serializer.ToXMLSAXHandler;
 42 import com.sun.org.apache.xml.internal.serializer.ToXMLStream;
 43 import com.sun.org.apache.xml.internal.serializer.SerializationHandler;

 44 import org.w3c.dom.Node;
 45 
 46 import org.xml.sax.ContentHandler;
 47 import org.xml.sax.ext.LexicalHandler;
 48 
 49 /**
 50  * @author Santiago Pericas-Geertsen
<span class="line-modified"> 51  * @LastModified: Oct 2017</span>
 52  */
 53 public class TransletOutputHandlerFactory {
 54 
 55     public static final int STREAM = 0;
 56     public static final int SAX    = 1;
 57     public static final int DOM    = 2;
 58     public static final int STAX   = 3;
 59 
 60     private String _encoding                        = &quot;utf-8&quot;;
 61     private String _method                          = null;
 62     private int    _outputType                      = STREAM;
 63     private OutputStream _ostream                   = System.out;
 64     private Writer _writer                          = null;
 65     private Node _node                              = null;
 66     private Node   _nextSibling                     = null;
 67     private XMLEventWriter _xmlStAXEventWriter      = null;
 68     private XMLStreamWriter _xmlStAXStreamWriter    = null;
 69     private int _indentNumber                       = -1;
 70     private ContentHandler _handler                 = null;
 71     private LexicalHandler _lexHandler              = null;
 72 
 73     private boolean _overrideDefaultParser;

 74 
<span class="line-modified"> 75     static public TransletOutputHandlerFactory newInstance() {</span>
<span class="line-modified"> 76         return new TransletOutputHandlerFactory(true);</span>
<span class="line-modified"> 77     }</span>
<span class="line-removed"> 78     static public TransletOutputHandlerFactory newInstance(boolean overrideDefaultParser) {</span>
<span class="line-removed"> 79         return new TransletOutputHandlerFactory(overrideDefaultParser);</span>
 80     }
 81 
<span class="line-modified"> 82     public TransletOutputHandlerFactory(boolean overrideDefaultParser) {</span>

 83         _overrideDefaultParser = overrideDefaultParser;

 84     }
 85     public void setOutputType(int outputType) {
 86         _outputType = outputType;
 87     }
 88 
 89     public void setEncoding(String encoding) {
 90         if (encoding != null) {
 91             _encoding = encoding;
 92         }
 93     }
 94 
 95     public void setOutputMethod(String method) {
 96         _method = method;
 97     }
 98 
 99     public void setOutputStream(OutputStream ostream) {
100         _ostream = ostream;
101     }
102 
103     public void setWriter(Writer writer) {
</pre>
<hr />
<pre>
139 
140     public void setXMLStreamWriter(XMLStreamWriter streamWriter) {
141         _xmlStAXStreamWriter = streamWriter;
142     }
143 
144     public void setIndentNumber(int value) {
145         _indentNumber = value;
146     }
147 
148     @SuppressWarnings(&quot;fallthrough&quot;)  // intentional at case STAX, SAX
149     public SerializationHandler getSerializationHandler()
150         throws IOException, ParserConfigurationException
151     {
152         SerializationHandler result = null;
153         switch (_outputType)
154         {
155             case STREAM :
156 
157                 if (_method == null)
158                 {
<span class="line-modified">159                     result = new ToUnknownStream();</span>
160                 }
161                 else if (_method.equalsIgnoreCase(&quot;xml&quot;))
162                 {
163 
<span class="line-modified">164                     result = new ToXMLStream();</span>
165 
166                 }
167                 else if (_method.equalsIgnoreCase(&quot;html&quot;))
168                 {
169 
<span class="line-modified">170                     result = new ToHTMLStream();</span>
171 
172                 }
173                 else if (_method.equalsIgnoreCase(&quot;text&quot;))
174                 {
175 
<span class="line-modified">176                     result = new ToTextStream();</span>
177 
178                 }
179 
180                 if (result != null &amp;&amp; _indentNumber &gt;= 0)
181                 {
182                     result.setIndentAmount(_indentNumber);
183                 }
184 
185                 result.setEncoding(_encoding);
186 
187                 if (_writer != null)
188                 {
189                     result.setWriter(_writer);
190                 }
191                 else
192                 {
193                     result.setOutputStream(_ostream);
194                 }
195                 return result;
196 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xalan.internal.xsltc.runtime.output;
 22 
</pre>
<hr />
<pre>
 24 import java.io.OutputStream;
 25 import java.io.Writer;
 26 
 27 import javax.xml.parsers.ParserConfigurationException;
 28 import javax.xml.stream.XMLEventWriter;
 29 import javax.xml.stream.util.XMLEventConsumer;
 30 import javax.xml.stream.XMLStreamWriter;
 31 
 32 import com.sun.org.apache.xalan.internal.xsltc.trax.SAX2DOM;
 33 import com.sun.org.apache.xalan.internal.xsltc.trax.SAX2StAXEventWriter;
 34 import com.sun.org.apache.xalan.internal.xsltc.trax.SAX2StAXStreamWriter;
 35 
 36 import com.sun.org.apache.xml.internal.serializer.ToHTMLSAXHandler;
 37 import com.sun.org.apache.xml.internal.serializer.ToHTMLStream;
 38 import com.sun.org.apache.xml.internal.serializer.ToTextSAXHandler;
 39 import com.sun.org.apache.xml.internal.serializer.ToTextStream;
 40 import com.sun.org.apache.xml.internal.serializer.ToUnknownStream;
 41 import com.sun.org.apache.xml.internal.serializer.ToXMLSAXHandler;
 42 import com.sun.org.apache.xml.internal.serializer.ToXMLStream;
 43 import com.sun.org.apache.xml.internal.serializer.SerializationHandler;
<span class="line-added"> 44 import javax.xml.transform.ErrorListener;</span>
 45 import org.w3c.dom.Node;
 46 
 47 import org.xml.sax.ContentHandler;
 48 import org.xml.sax.ext.LexicalHandler;
 49 
 50 /**
 51  * @author Santiago Pericas-Geertsen
<span class="line-modified"> 52  * @LastModified: Aug 2019</span>
 53  */
 54 public class TransletOutputHandlerFactory {
 55 
 56     public static final int STREAM = 0;
 57     public static final int SAX    = 1;
 58     public static final int DOM    = 2;
 59     public static final int STAX   = 3;
 60 
 61     private String _encoding                        = &quot;utf-8&quot;;
 62     private String _method                          = null;
 63     private int    _outputType                      = STREAM;
 64     private OutputStream _ostream                   = System.out;
 65     private Writer _writer                          = null;
 66     private Node _node                              = null;
 67     private Node   _nextSibling                     = null;
 68     private XMLEventWriter _xmlStAXEventWriter      = null;
 69     private XMLStreamWriter _xmlStAXStreamWriter    = null;
 70     private int _indentNumber                       = -1;
 71     private ContentHandler _handler                 = null;
 72     private LexicalHandler _lexHandler              = null;
 73 
 74     private boolean _overrideDefaultParser;
<span class="line-added"> 75     private ErrorListener _errListener;</span>
 76 
<span class="line-modified"> 77     static public TransletOutputHandlerFactory newInstance(boolean overrideDefaultParser,</span>
<span class="line-modified"> 78             ErrorListener errListener) {</span>
<span class="line-modified"> 79         return new TransletOutputHandlerFactory(overrideDefaultParser, errListener);</span>


 80     }
 81 
<span class="line-modified"> 82     public TransletOutputHandlerFactory(boolean overrideDefaultParser,</span>
<span class="line-added"> 83             ErrorListener errListener) {</span>
 84         _overrideDefaultParser = overrideDefaultParser;
<span class="line-added"> 85         _errListener = errListener;</span>
 86     }
 87     public void setOutputType(int outputType) {
 88         _outputType = outputType;
 89     }
 90 
 91     public void setEncoding(String encoding) {
 92         if (encoding != null) {
 93             _encoding = encoding;
 94         }
 95     }
 96 
 97     public void setOutputMethod(String method) {
 98         _method = method;
 99     }
100 
101     public void setOutputStream(OutputStream ostream) {
102         _ostream = ostream;
103     }
104 
105     public void setWriter(Writer writer) {
</pre>
<hr />
<pre>
141 
142     public void setXMLStreamWriter(XMLStreamWriter streamWriter) {
143         _xmlStAXStreamWriter = streamWriter;
144     }
145 
146     public void setIndentNumber(int value) {
147         _indentNumber = value;
148     }
149 
150     @SuppressWarnings(&quot;fallthrough&quot;)  // intentional at case STAX, SAX
151     public SerializationHandler getSerializationHandler()
152         throws IOException, ParserConfigurationException
153     {
154         SerializationHandler result = null;
155         switch (_outputType)
156         {
157             case STREAM :
158 
159                 if (_method == null)
160                 {
<span class="line-modified">161                     result = new ToUnknownStream(_errListener);</span>
162                 }
163                 else if (_method.equalsIgnoreCase(&quot;xml&quot;))
164                 {
165 
<span class="line-modified">166                     result = new ToXMLStream(_errListener);</span>
167 
168                 }
169                 else if (_method.equalsIgnoreCase(&quot;html&quot;))
170                 {
171 
<span class="line-modified">172                     result = new ToHTMLStream(_errListener);</span>
173 
174                 }
175                 else if (_method.equalsIgnoreCase(&quot;text&quot;))
176                 {
177 
<span class="line-modified">178                     result = new ToTextStream(_errListener);</span>
179 
180                 }
181 
182                 if (result != null &amp;&amp; _indentNumber &gt;= 0)
183                 {
184                     result.setIndentAmount(_indentNumber);
185                 }
186 
187                 result.setEncoding(_encoding);
188 
189                 if (_writer != null)
190                 {
191                     result.setWriter(_writer);
192                 }
193                 else
194                 {
195                     result.setOutputStream(_ostream);
196                 }
197                 return result;
198 
</pre>
</td>
</tr>
</table>
<center><a href="../MessageHandler.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../trax/DOM2TO.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>