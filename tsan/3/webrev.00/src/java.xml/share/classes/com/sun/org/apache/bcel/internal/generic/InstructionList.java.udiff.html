<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/InstructionList.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InstructionHandle.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="InstructionListObserver.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/InstructionList.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,9 +1,9 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   */
<span class="udiff-line-modified-removed">- /*</span>
<span class="udiff-line-modified-added">+  /*</span>
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
   * The ASF licenses this file to You under the Apache License, Version 2.0
   * (the &quot;License&quot;); you may not use this file except in compliance with
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -42,16 +42,17 @@</span>
   * controlled way.
   *
   * A list is finally dumped to a byte code array with &lt;a
   * href=&quot;#getByteCode()&quot;&gt;getByteCode&lt;/a&gt;.
   *
<span class="udiff-line-removed">-  * @version $Id: InstructionList.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
   * @see Instruction
   * @see InstructionHandle
   * @see BranchHandle
<span class="udiff-line-added">+  * @LastModified: Jan 2020</span>
   */
  public class InstructionList implements Iterable&lt;InstructionHandle&gt; {
<span class="udiff-line-added">+ </span>
      private InstructionHandle start = null;
      private InstructionHandle end = null;
      private int length = 0; // number of elements in list
      private int[] byte_positions; // byte code offsets corresponding to instructions
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -62,30 +63,33 @@</span>
      }
  
      /**
       * Create instruction list containing one instruction.
       *
<span class="udiff-line-modified-removed">-      * @param i initial instruction</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-added">+      *            initial instruction</span>
       */
      public InstructionList(final Instruction i) {
          append(i);
      }
  
      /**
       * Create instruction list containing one instruction.
       *
<span class="udiff-line-modified-removed">-      * @param i initial instruction</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-added">+      *            initial instruction</span>
       */
      public InstructionList(final BranchInstruction i) {
          append(i);
      }
  
      /**
       * Initialize list with (nonnull) compound instruction. Consumes argument
       * list, i.e., it becomes empty.
       *
<span class="udiff-line-modified-removed">-      * @param c compound instruction (list)</span>
<span class="udiff-line-modified-added">+      * @param c</span>
<span class="udiff-line-added">+      *            compound instruction (list)</span>
       */
      public InstructionList(final CompoundInstruction c) {
          append(c.getInstructionList());
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -98,25 +102,29 @@</span>
  
      /**
       * Find the target instruction (handle) that corresponds to the given target
       * position (byte code offset).
       *
<span class="udiff-line-modified-removed">-      * @param ihs array of instruction handles, i.e. il.getInstructionHandles()</span>
<span class="udiff-line-modified-removed">-      * @param pos array of positions corresponding to ihs, i.e.</span>
<span class="udiff-line-modified-removed">-      * il.getInstructionPositions()</span>
<span class="udiff-line-modified-removed">-      * @param count length of arrays</span>
<span class="udiff-line-modified-removed">-      * @param target target position to search for</span>
<span class="udiff-line-modified-added">+      * @param ihs</span>
<span class="udiff-line-modified-added">+      *            array of instruction handles, i.e. il.getInstructionHandles()</span>
<span class="udiff-line-modified-added">+      * @param pos</span>
<span class="udiff-line-modified-added">+      *            array of positions corresponding to ihs, i.e. il.getInstructionPositions()</span>
<span class="udiff-line-modified-added">+      * @param count</span>
<span class="udiff-line-added">+      *            length of arrays</span>
<span class="udiff-line-added">+      * @param target</span>
<span class="udiff-line-added">+      *            target position to search for</span>
       * @return target position&#39;s instruction handle if available
       */
<span class="udiff-line-modified-removed">-     public static InstructionHandle findHandle(final InstructionHandle[] ihs, final int[] pos, final int count, final int target) {</span>
<span class="udiff-line-modified-added">+     public static InstructionHandle findHandle(final InstructionHandle[] ihs,</span>
<span class="udiff-line-added">+             final int[] pos, final int count, final int target) {</span>
          int l = 0;
          int r = count - 1;
          /*
           * Do a binary search since the pos array is orderd.
           */
          do {
<span class="udiff-line-modified-removed">-             final int i = (l + r) / 2;</span>
<span class="udiff-line-modified-added">+             final int i = (l + r) &gt;&gt;&gt; 1;</span>
              final int j = pos[i];
              if (j == target) {
                  return ihs[i];
              } else if (target &lt; j) {
                  r = i - 1;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -130,11 +138,12 @@</span>
      /**
       * Get instruction handle for instruction at byte code position pos. This
       * only works properly, if the list is freshly initialized from a byte array
       * or setPositions() has been called before this method.
       *
<span class="udiff-line-modified-removed">-      * @param pos byte code position to search for</span>
<span class="udiff-line-modified-added">+      * @param pos</span>
<span class="udiff-line-added">+      *            byte code position to search for</span>
       * @return target position&#39;s instruction handle if available
       */
      public InstructionHandle findHandle(final int pos) {
          final int[] positions = byte_positions;
          InstructionHandle ih = start;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -148,11 +157,12 @@</span>
      }
  
      /**
       * Initialize instruction list from byte array.
       *
<span class="udiff-line-modified-removed">-      * @param code byte array containing the instructions</span>
<span class="udiff-line-modified-added">+      * @param code</span>
<span class="udiff-line-added">+      *            byte array containing the instructions</span>
       */
      public InstructionList(final byte[] code) {
          int count = 0; // Contains actual length
          int[] pos;
          InstructionHandle[] ihs;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -189,16 +199,15 @@</span>
           * Pass 2: Look for BranchInstruction and update their targets, i.e., convert offsets to instruction handles.
           */
          for (int i = 0; i &lt; count; i++) {
              if (ihs[i] instanceof BranchHandle) {
                  final BranchInstruction bi = (BranchInstruction) ihs[i].getInstruction();
<span class="udiff-line-modified-removed">-                 int target = bi.getPosition() + bi.getIndex(); /*</span>
<span class="udiff-line-modified-added">+                 int target = bi.getPosition() + bi.getIndex();</span>
<span class="udiff-line-added">+                 /*</span>
                   * Byte code position: relative -&gt; absolute.
<span class="udiff-line-modified-removed">-                  */</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-modified-added">+                 */</span>
                  // Search for target position
<span class="udiff-line-removed">- </span>
                  InstructionHandle ih = findHandle(ihs, pos, count, target);
                  if (ih == null) {
                      throw new ClassGenException(&quot;Couldn&#39;t find target for branch: &quot; + bi);
                  }
                  bi.setTarget(ih); // Update target
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -221,14 +230,15 @@</span>
  
      /**
       * Append another list after instruction (handle) ih contained in this list.
       * Consumes argument list, i.e., it becomes empty.
       *
<span class="udiff-line-modified-removed">-      * @param ih where to append the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param il Instruction list to append to this one</span>
<span class="udiff-line-modified-removed">-      * @return instruction handle pointing to the &lt;B&gt;first&lt;/B&gt; appended</span>
<span class="udiff-line-modified-removed">-      * instruction</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-modified-added">+      *            where to append the instruction list</span>
<span class="udiff-line-modified-added">+      * @param il</span>
<span class="udiff-line-modified-added">+      *            Instruction list to append to this one</span>
<span class="udiff-line-added">+      * @return instruction handle pointing to the &lt;B&gt;first&lt;/B&gt; appended instruction</span>
       */
      public InstructionHandle append(final InstructionHandle ih, final InstructionList il) {
          if (il == null) {
              throw new ClassGenException(&quot;Appending null InstructionList&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -252,14 +262,15 @@</span>
  
      /**
       * Append another list after instruction i contained in this list. Consumes
       * argument list, i.e., it becomes empty.
       *
<span class="udiff-line-modified-removed">-      * @param i where to append the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param il Instruction list to append to this one</span>
<span class="udiff-line-modified-removed">-      * @return instruction handle pointing to the &lt;B&gt;first&lt;/B&gt; appended</span>
<span class="udiff-line-modified-removed">-      * instruction</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-modified-added">+      *            where to append the instruction list</span>
<span class="udiff-line-modified-added">+      * @param il</span>
<span class="udiff-line-modified-added">+      *            Instruction list to append to this one</span>
<span class="udiff-line-added">+      * @return instruction handle pointing to the &lt;B&gt;first&lt;/B&gt; appended instruction</span>
       */
      public InstructionHandle append(final Instruction i, final InstructionList il) {
          InstructionHandle ih;
          if ((ih = findInstruction2(i)) == null) {
              throw new ClassGenException(&quot;Instruction &quot; + i + &quot; is not contained in this list.&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -269,11 +280,12 @@</span>
  
      /**
       * Append another list to this one. Consumes argument list, i.e., it becomes
       * empty.
       *
<span class="udiff-line-modified-removed">-      * @param il list to append to end of this list</span>
<span class="udiff-line-modified-added">+      * @param il</span>
<span class="udiff-line-added">+      *            list to append to end of this list</span>
       * @return instruction handle of the &lt;B&gt;first&lt;/B&gt; appended instruction
       */
      public InstructionHandle append(final InstructionList il) {
          if (il == null) {
              throw new ClassGenException(&quot;Appending null InstructionList&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -292,11 +304,12 @@</span>
      }
  
      /**
       * Append an instruction to the end of this list.
       *
<span class="udiff-line-modified-removed">-      * @param ih instruction to append</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-added">+      *            instruction to append</span>
       */
      private void append(final InstructionHandle ih) {
          if (isEmpty()) {
              start = end = ih;
              ih.setNext(ih.setPrev(null));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -304,18 +317,18 @@</span>
              end.setNext(ih);
              ih.setPrev(end);
              ih.setNext(null);
              end = ih;
          }
<span class="udiff-line-removed">- </span>
          length++; // Update length
      }
  
      /**
       * Append an instruction to the end of this list.
       *
<span class="udiff-line-modified-removed">-      * @param i instruction to append</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-added">+      *            instruction to append</span>
       * @return instruction handle of the appended instruction
       */
      public InstructionHandle append(final Instruction i) {
          final InstructionHandle ih = InstructionHandle.getInstructionHandle(i);
          append(ih);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -323,11 +336,12 @@</span>
      }
  
      /**
       * Append a branch instruction to the end of this list.
       *
<span class="udiff-line-modified-removed">-      * @param i branch instruction to append</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-added">+      *            branch instruction to append</span>
       * @return branch instruction handle of the appended instruction
       */
      public BranchHandle append(final BranchInstruction i) {
          final BranchHandle ih = BranchHandle.getBranchHandle(i);
          append(ih);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -336,71 +350,78 @@</span>
  
      /**
       * Append a single instruction j after another instruction i, which must be
       * in this list of course!
       *
<span class="udiff-line-modified-removed">-      * @param i Instruction in list</span>
<span class="udiff-line-modified-removed">-      * @param j Instruction to append after i in list</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-modified-added">+      *            Instruction in list</span>
<span class="udiff-line-added">+      * @param j</span>
<span class="udiff-line-added">+      *            Instruction to append after i in list</span>
       * @return instruction handle of the first appended instruction
       */
      public InstructionHandle append(final Instruction i, final Instruction j) {
          return append(i, new InstructionList(j));
      }
  
      /**
       * Append a compound instruction, after instruction i.
       *
<span class="udiff-line-modified-removed">-      * @param i Instruction in list</span>
<span class="udiff-line-modified-removed">-      * @param c The composite instruction (containing an InstructionList)</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-modified-added">+      *            Instruction in list</span>
<span class="udiff-line-added">+      * @param c</span>
<span class="udiff-line-added">+      *            The composite instruction (containing an InstructionList)</span>
       * @return instruction handle of the first appended instruction
       */
      public InstructionHandle append(final Instruction i, final CompoundInstruction c) {
          return append(i, c.getInstructionList());
      }
  
      /**
       * Append a compound instruction.
       *
<span class="udiff-line-modified-removed">-      * @param c The composite instruction (containing an InstructionList)</span>
<span class="udiff-line-modified-added">+      * @param c</span>
<span class="udiff-line-added">+      *            The composite instruction (containing an InstructionList)</span>
       * @return instruction handle of the first appended instruction
       */
      public InstructionHandle append(final CompoundInstruction c) {
          return append(c.getInstructionList());
      }
  
      /**
       * Append a compound instruction.
       *
<span class="udiff-line-modified-removed">-      * @param ih where to append the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param c The composite instruction (containing an InstructionList)</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-modified-added">+      *            where to append the instruction list</span>
<span class="udiff-line-added">+      * @param c</span>
<span class="udiff-line-added">+      *            The composite instruction (containing an InstructionList)</span>
       * @return instruction handle of the first appended instruction
       */
      public InstructionHandle append(final InstructionHandle ih, final CompoundInstruction c) {
          return append(ih, c.getInstructionList());
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Append an instruction after instruction (handle) ih contained in this</span>
<span class="udiff-line-removed">-      * list.</span>
<span class="udiff-line-modified-added">+      * Append an instruction after instruction (handle) ih contained in this list.</span>
       *
<span class="udiff-line-modified-removed">-      * @param ih where to append the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param i Instruction to append</span>
<span class="udiff-line-modified-removed">-      * @return instruction handle pointing to the &lt;B&gt;first&lt;/B&gt; appended</span>
<span class="udiff-line-modified-removed">-      * instruction</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-modified-added">+      *            where to append the instruction list</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-modified-added">+      *            Instruction to append</span>
<span class="udiff-line-added">+      * @return instruction handle pointing to the &lt;B&gt;first&lt;/B&gt; appended instruction</span>
       */
      public InstructionHandle append(final InstructionHandle ih, final Instruction i) {
          return append(ih, new InstructionList(i));
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Append an instruction after instruction (handle) ih contained in this</span>
<span class="udiff-line-removed">-      * list.</span>
<span class="udiff-line-modified-added">+      * Append an instruction after instruction (handle) ih contained in this list.</span>
       *
<span class="udiff-line-modified-removed">-      * @param ih where to append the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param i Instruction to append</span>
<span class="udiff-line-modified-removed">-      * @return instruction handle pointing to the &lt;B&gt;first&lt;/B&gt; appended</span>
<span class="udiff-line-modified-removed">-      * instruction</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-modified-added">+      *            where to append the instruction list</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-modified-added">+      *            Instruction to append</span>
<span class="udiff-line-added">+      * @return instruction handle pointing to the &lt;B&gt;first&lt;/B&gt; appended instruction</span>
       */
      public BranchHandle append(final InstructionHandle ih, final BranchInstruction i) {
          final BranchHandle bh = BranchHandle.getBranchHandle(i);
          final InstructionList il = new InstructionList();
          il.append(bh);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -410,12 +431,14 @@</span>
  
      /**
       * Insert another list before Instruction handle ih contained in this list.
       * Consumes argument list, i.e., it becomes empty.
       *
<span class="udiff-line-modified-removed">-      * @param ih where to append the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param il Instruction list to insert</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-modified-added">+      *            where to append the instruction list</span>
<span class="udiff-line-added">+      * @param il</span>
<span class="udiff-line-added">+      *            Instruction list to insert</span>
       * @return instruction handle of the first inserted instruction
       */
      public InstructionHandle insert(final InstructionHandle ih, final InstructionList il) {
          if (il == null) {
              throw new ClassGenException(&quot;Inserting null InstructionList&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -431,20 +454,20 @@</span>
          if (prev != null) {
              prev.setNext(il.start);
          } else {
              start = il.start; // Update start ...
          }
<span class="udiff-line-removed">- </span>
          length += il.length; // Update length
          il.clear();
          return ret;
      }
  
      /**
       * Insert another list.
       *
<span class="udiff-line-modified-removed">-      * @param il list to insert before start of this list</span>
<span class="udiff-line-modified-added">+      * @param il</span>
<span class="udiff-line-added">+      *            list to insert before start of this list</span>
       * @return instruction handle of the first inserted instruction
       */
      public InstructionHandle insert(final InstructionList il) {
          if (isEmpty()) {
              append(il); // Code is identical for this case
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -454,11 +477,12 @@</span>
      }
  
      /**
       * Insert an instruction at start of this list.
       *
<span class="udiff-line-modified-removed">-      * @param ih instruction to insert</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-added">+      *            instruction to insert</span>
       */
      private void insert(final InstructionHandle ih) {
          if (isEmpty()) {
              start = end = ih;
              ih.setNext(ih.setPrev(null));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -466,22 +490,22 @@</span>
              start.setPrev(ih);
              ih.setNext(start);
              ih.setPrev(null);
              start = ih;
          }
<span class="udiff-line-removed">- </span>
          length++;
      }
  
      /**
       * Insert another list before Instruction i contained in this list. Consumes
       * argument list, i.e., it becomes empty.
       *
<span class="udiff-line-modified-removed">-      * @param i where to append the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param il Instruction list to insert</span>
<span class="udiff-line-modified-removed">-      * @return instruction handle pointing to the first inserted instruction,</span>
<span class="udiff-line-modified-removed">-      * i.e., il.getStart()</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-modified-added">+      *            where to append the instruction list</span>
<span class="udiff-line-modified-added">+      * @param il</span>
<span class="udiff-line-modified-added">+      *            Instruction list to insert</span>
<span class="udiff-line-added">+      * @return instruction handle pointing to the first inserted instruction, i.e., il.getStart()</span>
       */
      public InstructionHandle insert(final Instruction i, final InstructionList il) {
          InstructionHandle ih;
          if ((ih = findInstruction1(i)) == null) {
              throw new ClassGenException(&quot;Instruction &quot; + i + &quot; is not contained in this list.&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -490,11 +514,12 @@</span>
      }
  
      /**
       * Insert an instruction at start of this list.
       *
<span class="udiff-line-modified-removed">-      * @param i instruction to insert</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-added">+      *            instruction to insert</span>
       * @return instruction handle of the inserted instruction
       */
      public InstructionHandle insert(final Instruction i) {
          final InstructionHandle ih = InstructionHandle.getInstructionHandle(i);
          insert(ih);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -502,11 +527,12 @@</span>
      }
  
      /**
       * Insert a branch instruction at start of this list.
       *
<span class="udiff-line-modified-removed">-      * @param i branch instruction to insert</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-added">+      *            branch instruction to insert</span>
       * @return branch instruction handle of the appended instruction
       */
      public BranchHandle insert(final BranchInstruction i) {
          final BranchHandle ih = BranchHandle.getBranchHandle(i);
          insert(ih);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -515,68 +541,77 @@</span>
  
      /**
       * Insert a single instruction j before another instruction i, which must be
       * in this list of course!
       *
<span class="udiff-line-modified-removed">-      * @param i Instruction in list</span>
<span class="udiff-line-modified-removed">-      * @param j Instruction to insert before i in list</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-modified-added">+      *            Instruction in list</span>
<span class="udiff-line-added">+      * @param j</span>
<span class="udiff-line-added">+      *            Instruction to insert before i in list</span>
       * @return instruction handle of the first inserted instruction
       */
      public InstructionHandle insert(final Instruction i, final Instruction j) {
          return insert(i, new InstructionList(j));
      }
  
      /**
       * Insert a compound instruction before instruction i.
       *
<span class="udiff-line-modified-removed">-      * @param i Instruction in list</span>
<span class="udiff-line-modified-removed">-      * @param c The composite instruction (containing an InstructionList)</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-modified-added">+      *            Instruction in list</span>
<span class="udiff-line-added">+      * @param c</span>
<span class="udiff-line-added">+      *            The composite instruction (containing an InstructionList)</span>
       * @return instruction handle of the first inserted instruction
       */
      public InstructionHandle insert(final Instruction i, final CompoundInstruction c) {
          return insert(i, c.getInstructionList());
      }
  
      /**
       * Insert a compound instruction.
       *
<span class="udiff-line-modified-removed">-      * @param c The composite instruction (containing an InstructionList)</span>
<span class="udiff-line-modified-added">+      * @param c</span>
<span class="udiff-line-added">+      *            The composite instruction (containing an InstructionList)</span>
       * @return instruction handle of the first inserted instruction
       */
      public InstructionHandle insert(final CompoundInstruction c) {
          return insert(c.getInstructionList());
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Insert an instruction before instruction (handle) ih contained in this</span>
<span class="udiff-line-removed">-      * list.</span>
<span class="udiff-line-modified-added">+      * Insert an instruction before instruction (handle) ih contained in this list.</span>
       *
<span class="udiff-line-modified-removed">-      * @param ih where to insert to the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param i Instruction to insert</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-modified-added">+      *            where to insert to the instruction list</span>
<span class="udiff-line-added">+      * @param i</span>
<span class="udiff-line-added">+      *            Instruction to insert</span>
       * @return instruction handle of the first inserted instruction
       */
      public InstructionHandle insert(final InstructionHandle ih, final Instruction i) {
          return insert(ih, new InstructionList(i));
      }
  
      /**
       * Insert a compound instruction.
       *
<span class="udiff-line-modified-removed">-      * @param ih where to insert the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param c The composite instruction (containing an InstructionList)</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-modified-added">+      *            where to insert the instruction list</span>
<span class="udiff-line-added">+      * @param c</span>
<span class="udiff-line-added">+      *            The composite instruction (containing an InstructionList)</span>
       * @return instruction handle of the first inserted instruction
       */
      public InstructionHandle insert(final InstructionHandle ih, final CompoundInstruction c) {
          return insert(ih, c.getInstructionList());
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Insert an instruction before instruction (handle) ih contained in this</span>
<span class="udiff-line-removed">-      * list.</span>
<span class="udiff-line-modified-added">+      * Insert an instruction before instruction (handle) ih contained in this list.</span>
       *
<span class="udiff-line-modified-removed">-      * @param ih where to insert to the instruction list</span>
<span class="udiff-line-modified-removed">-      * @param i Instruction to insert</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-modified-added">+      *            where to insert to the instruction list</span>
<span class="udiff-line-added">+      * @param i</span>
<span class="udiff-line-added">+      *            Instruction to insert</span>
       * @return instruction handle of the first inserted instruction
       */
      public BranchHandle insert(final InstructionHandle ih, final BranchInstruction i) {
          final BranchHandle bh = BranchHandle.getBranchHandle(i);
          final InstructionList il = new InstructionList();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -586,18 +621,22 @@</span>
      }
  
      /**
       * Take all instructions (handles) from &quot;start&quot; to &quot;end&quot; and append them
       * after the new location &quot;target&quot;. Of course, &quot;end&quot; must be after &quot;start&quot;
<span class="udiff-line-modified-removed">-      * and target must not be located withing this range. If you want to move</span>
<span class="udiff-line-modified-removed">-      * something to the start of the list use null as value for target.&lt;br&gt;</span>
<span class="udiff-line-modified-added">+      * and target must not be located within this range. If you want to move</span>
<span class="udiff-line-modified-added">+      * something to the start of the list use null as value for target.</span>
<span class="udiff-line-added">+      * &lt;p&gt;</span>
       * Any instruction targeters pointing to handles within the block, keep
       * their targets.
       *
<span class="udiff-line-modified-removed">-      * @param start of moved block</span>
<span class="udiff-line-modified-removed">-      * @param end of moved block</span>
<span class="udiff-line-modified-removed">-      * @param target of moved block</span>
<span class="udiff-line-modified-added">+      * @param start</span>
<span class="udiff-line-modified-added">+      *            of moved block</span>
<span class="udiff-line-modified-added">+      * @param end</span>
<span class="udiff-line-added">+      *            of moved block</span>
<span class="udiff-line-added">+      * @param target</span>
<span class="udiff-line-added">+      *            of moved block</span>
       */
      public void move(final InstructionHandle start, final InstructionHandle end, final InstructionHandle target) {
          // Step 1: Check constraints
          if ((start == null) || (end == null)) {
              throw new ClassGenException(&quot;Invalid null handle: From &quot; + start + &quot; to &quot; + end);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -647,24 +686,28 @@</span>
      }
  
      /**
       * Move a single instruction (handle) to a new location.
       *
<span class="udiff-line-modified-removed">-      * @param ih moved instruction</span>
<span class="udiff-line-modified-removed">-      * @param target new location of moved instruction</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-modified-added">+      *            moved instruction</span>
<span class="udiff-line-added">+      * @param target</span>
<span class="udiff-line-added">+      *            new location of moved instruction</span>
       */
      public void move(final InstructionHandle ih, final InstructionHandle target) {
          move(ih, ih, target);
      }
  
      /**
       * Remove from instruction `prev&#39; to instruction `next&#39; both contained in
       * this list. Throws TargetLostException when one of the removed instruction
       * handles is still being targeted.
       *
<span class="udiff-line-modified-removed">-      * @param prev where to start deleting (predecessor, exclusive)</span>
<span class="udiff-line-modified-removed">-      * @param next where to end deleting (successor, exclusive)</span>
<span class="udiff-line-modified-added">+      * @param prev</span>
<span class="udiff-line-modified-added">+      *            where to start deleting (predecessor, exclusive)</span>
<span class="udiff-line-added">+      * @param next</span>
<span class="udiff-line-added">+      *            where to end deleting (successor, exclusive)</span>
       */
      private void remove(final InstructionHandle prev, InstructionHandle next) throws TargetLostException {
          InstructionHandle first;
          InstructionHandle last; // First and last deleted instruction
          if ((prev == null) &amp;&amp; (next == null)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -715,21 +758,22 @@</span>
  
      /**
       * Remove instruction from this list. The corresponding Instruction handles
       * must not be reused!
       *
<span class="udiff-line-modified-removed">-      * @param ih instruction (handle) to remove</span>
<span class="udiff-line-modified-added">+      * @param ih</span>
<span class="udiff-line-added">+      *            instruction (handle) to remove</span>
       */
      public void delete(final InstructionHandle ih) throws TargetLostException {
          remove(ih.getPrev(), ih.getNext());
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Remove instruction from this list. The corresponding Instruction handles</span>
<span class="udiff-line-removed">-      * must not be reused!</span>
<span class="udiff-line-modified-added">+      * Remove instruction from this list. The corresponding Instruction handles must not be reused!</span>
       *
<span class="udiff-line-modified-removed">-      * @param i instruction to remove</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-added">+      *            instruction to remove</span>
       */
      public void delete(final Instruction i) throws TargetLostException {
          InstructionHandle ih;
          if ((ih = findInstruction1(i)) == null) {
              throw new ClassGenException(&quot;Instruction &quot; + i + &quot; is not contained in this list.&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -741,12 +785,14 @@</span>
       * Remove instructions from instruction `from&#39; to instruction `to&#39; contained
       * in this list. The user must ensure that `from&#39; is an instruction before
       * `to&#39;, or risk havoc. The corresponding Instruction handles must not be
       * reused!
       *
<span class="udiff-line-modified-removed">-      * @param from where to start deleting (inclusive)</span>
<span class="udiff-line-modified-removed">-      * @param to where to end deleting (inclusive)</span>
<span class="udiff-line-modified-added">+      * @param from</span>
<span class="udiff-line-modified-added">+      *            where to start deleting (inclusive)</span>
<span class="udiff-line-added">+      * @param to</span>
<span class="udiff-line-added">+      *            where to end deleting (inclusive)</span>
       */
      public void delete(final InstructionHandle from, final InstructionHandle to) throws TargetLostException {
          remove(from.getPrev(), to.getNext());
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -754,12 +800,14 @@</span>
       * Remove instructions from instruction `from&#39; to instruction `to&#39; contained
       * in this list. The user must ensure that `from&#39; is an instruction before
       * `to&#39;, or risk havoc. The corresponding Instruction handles must not be
       * reused!
       *
<span class="udiff-line-modified-removed">-      * @param from where to start deleting (inclusive)</span>
<span class="udiff-line-modified-removed">-      * @param to where to end deleting (inclusive)</span>
<span class="udiff-line-modified-added">+      * @param from</span>
<span class="udiff-line-modified-added">+      *            where to start deleting (inclusive)</span>
<span class="udiff-line-added">+      * @param to</span>
<span class="udiff-line-added">+      *            where to end deleting (inclusive)</span>
       */
      public void delete(final Instruction from, final Instruction to) throws TargetLostException {
          InstructionHandle from_ih;
          InstructionHandle to_ih;
          if ((from_ih = findInstruction1(from)) == null) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -772,11 +820,12 @@</span>
      }
  
      /**
       * Search for given Instruction reference, start at beginning of list.
       *
<span class="udiff-line-modified-removed">-      * @param i instruction to search for</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-added">+      *            instruction to search for</span>
       * @return instruction found on success, null otherwise
       */
      private InstructionHandle findInstruction1(final Instruction i) {
          for (InstructionHandle ih = start; ih != null; ih = ih.getNext()) {
              if (ih.getInstruction() == i) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -787,11 +836,12 @@</span>
      }
  
      /**
       * Search for given Instruction reference, start at end of list
       *
<span class="udiff-line-modified-removed">-      * @param i instruction to search for</span>
<span class="udiff-line-modified-added">+      * @param i</span>
<span class="udiff-line-added">+      *            instruction to search for</span>
       * @return instruction found on success, null otherwise
       */
      private InstructionHandle findInstruction2(final Instruction i) {
          for (InstructionHandle ih = end; ih != null; ih = ih.getPrev()) {
              if (ih.getInstruction() == i) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -823,12 +873,12 @@</span>
  
      /**
       * Give all instructions their position number (offset in byte stream),
       * i.e., make the list ready to be dumped.
       *
<span class="udiff-line-modified-removed">-      * @param check Perform sanity checks, e.g. if all targeted instructions</span>
<span class="udiff-line-modified-removed">-      * really belong to this list</span>
<span class="udiff-line-modified-added">+      * @param check</span>
<span class="udiff-line-modified-added">+      *            Perform sanity checks, e.g. if all targeted instructions really belong to this list</span>
       */
      public void setPositions(final boolean check) { // called by code in other packages
          int max_additional_bytes = 0;
          int additional_bytes = 0;
          int index = 0;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -841,57 +891,55 @@</span>
              for (InstructionHandle ih = start; ih != null; ih = ih.getNext()) {
                  final Instruction i = ih.getInstruction();
                  if (i instanceof BranchInstruction) { // target instruction within list?
                      Instruction inst = ((BranchInstruction) i).getTarget().getInstruction();
                      if (!contains(inst)) {
<span class="udiff-line-modified-removed">-                         throw new ClassGenException(&quot;Branch target of &quot; +</span>
<span class="udiff-line-modified-removed">-                                 Const.getOpcodeName(i.getOpcode()) + &quot;:&quot; +</span>
<span class="udiff-line-modified-removed">-                                 inst + &quot; not in instruction list&quot;);</span>
<span class="udiff-line-modified-added">+                         throw new ClassGenException(&quot;Branch target of &quot;</span>
<span class="udiff-line-modified-added">+                                 + Const.getOpcodeName(i.getOpcode()) + &quot;:&quot;</span>
<span class="udiff-line-modified-added">+                                 + inst + &quot; not in instruction list&quot;);</span>
                      }
                      if (i instanceof Select) {
                          final InstructionHandle[] targets = ((Select) i).getTargets();
                          for (final InstructionHandle target : targets) {
                              inst = target.getInstruction();
                              if (!contains(inst)) {
<span class="udiff-line-modified-removed">-                                 throw new ClassGenException(&quot;Branch target of &quot; +</span>
<span class="udiff-line-modified-removed">-                                         Const.getOpcodeName(i.getOpcode()) + &quot;:&quot; +</span>
<span class="udiff-line-modified-removed">-                                         inst + &quot; not in instruction list&quot;);</span>
<span class="udiff-line-modified-added">+                                 throw new ClassGenException(&quot;Branch target of &quot;</span>
<span class="udiff-line-modified-added">+                                         + Const.getOpcodeName(i.getOpcode()) + &quot;:&quot;</span>
<span class="udiff-line-modified-added">+                                         + inst + &quot; not in instruction list&quot;);</span>
                              }
                          }
                      }
                      if (!(ih instanceof BranchHandle)) {
                          throw new ClassGenException(
<span class="udiff-line-modified-removed">-                                 &quot;Branch instruction &quot; +</span>
<span class="udiff-line-modified-removed">-                                         Const.getOpcodeName(i.getOpcode()) + &quot;:&quot; +</span>
<span class="udiff-line-modified-removed">-                                         inst + &quot; not contained in BranchHandle.&quot;);</span>
<span class="udiff-line-modified-added">+                                 &quot;Branch instruction &quot;</span>
<span class="udiff-line-modified-added">+                                 + Const.getOpcodeName(i.getOpcode()) + &quot;:&quot;</span>
<span class="udiff-line-modified-added">+                                 + inst + &quot; not contained in BranchHandle.&quot;);</span>
                      }
                  }
              }
          }
          /*
           * Pass 1: Set position numbers and sum up the maximum number of bytes an instruction may be shifted.
           */
          for (InstructionHandle ih = start; ih != null; ih = ih.getNext()) {
<span class="udiff-line-removed">- </span>
              final Instruction i = ih.getInstruction();
              ih.setPosition(index);
              pos[count++] = index;
<span class="udiff-line-removed">- </span>
              /*
               * Get an estimate about how many additional bytes may be added,
               * because BranchInstructions may have variable length depending on the target offset
               * (short vs. int) or alignment issues (TABLESWITCH and LOOKUPSWITCH).
               */
              switch (i.getOpcode()) {
                  case Const.JSR:
                  case Const.GOTO:
                      max_additional_bytes += 2;
<span class="udiff-line-modified-removed">-                     break;</span>
<span class="udiff-line-modified-added">+                 break;</span>
                  case Const.TABLESWITCH:
                  case Const.LOOKUPSWITCH:
                      max_additional_bytes += 3;
<span class="udiff-line-modified-removed">-                     break;</span>
<span class="udiff-line-modified-added">+                 break;</span>
              }
              index += i.getLength();
          }
  
          /* Pass 2: Expand the variable-length (Branch)Instructions depending on
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -906,21 +954,16 @@</span>
           * preceding expansions), like pass 1.
           */
          index = count = 0;
          for (InstructionHandle ih = start; ih != null; ih = ih.getNext()) {
              final Instruction i = ih.getInstruction();
<span class="udiff-line-removed">- </span>
              ih.setPosition(index);
              pos[count++] = index;
              index += i.getLength();
          }
<span class="udiff-line-modified-removed">-         if (length == count) {</span>
<span class="udiff-line-modified-removed">-             byte_positions = pos;</span>
<span class="udiff-line-removed">-         } else {</span>
<span class="udiff-line-removed">-             byte_positions = new int[count]; // Trim to proper size</span>
<span class="udiff-line-removed">-             System.arraycopy(pos, 0, byte_positions, 0, count);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         byte_positions = new int[count]; // Trim to proper size</span>
<span class="udiff-line-modified-added">+         System.arraycopy(pos, 0, byte_positions, 0, count);</span>
      }
  
      /**
       * When everything is finished, use this method to convert the instruction
       * list into an array of bytes.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -965,11 +1008,12 @@</span>
      public String toString() {
          return toString(true);
      }
  
      /**
<span class="udiff-line-modified-removed">-      * @param verbose toggle output format</span>
<span class="udiff-line-modified-added">+      * @param verbose</span>
<span class="udiff-line-added">+      *            toggle output format</span>
       * @return String containing all instructions in this list.
       */
      public String toString(final boolean verbose) {
          final StringBuilder buf = new StringBuilder();
          for (InstructionHandle ih = start; ih != null; ih = ih.getNext()) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1038,11 +1082,12 @@</span>
       */
      public InstructionList copy() {
          final Map&lt;InstructionHandle, InstructionHandle&gt; map = new HashMap&lt;&gt;();
          final InstructionList il = new InstructionList();
          /*
<span class="udiff-line-modified-removed">-          * Pass 1: Make copies of all instructions, append them to the new list and associate old instruction references with the new ones, i.e., a 1:1 mapping.</span>
<span class="udiff-line-modified-added">+          * Pass 1: Make copies of all instructions, append them to the new list</span>
<span class="udiff-line-added">+          * and associate old instruction references with the new ones, i.e., a 1:1 mapping.</span>
           */
          for (InstructionHandle ih = start; ih != null; ih = ih.getNext()) {
              final Instruction i = ih.getInstruction();
              final Instruction c = i.copy(); // Use clone for shallow copy
              if (c instanceof BranchInstruction) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1146,15 +1191,16 @@</span>
  
      /**
       * Redirect all references from old_target to new_target, i.e., update
       * targets of branch instructions.
       *
<span class="udiff-line-modified-removed">-      * @param old_target the old target instruction handle</span>
<span class="udiff-line-modified-removed">-      * @param new_target the new target instruction handle</span>
<span class="udiff-line-modified-added">+      * @param old_target</span>
<span class="udiff-line-modified-added">+      *            the old target instruction handle</span>
<span class="udiff-line-added">+      * @param new_target</span>
<span class="udiff-line-added">+      *            the new target instruction handle</span>
       */
<span class="udiff-line-modified-removed">-     public void redirectBranches(final InstructionHandle old_target,</span>
<span class="udiff-line-removed">-             final InstructionHandle new_target) {</span>
<span class="udiff-line-modified-added">+     public void redirectBranches(final InstructionHandle old_target, final InstructionHandle new_target) {</span>
          for (InstructionHandle ih = start; ih != null; ih = ih.getNext()) {
              final Instruction i = ih.getInstruction();
              if (i instanceof BranchInstruction) {
                  final BranchInstruction b = (BranchInstruction) i;
                  final InstructionHandle target = b.getTarget();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1174,17 +1220,19 @@</span>
      }
  
      /**
       * Redirect all references of local variables from old_target to new_target.
       *
<span class="udiff-line-modified-removed">-      * @param lg array of local variables</span>
<span class="udiff-line-modified-removed">-      * @param old_target the old target instruction handle</span>
<span class="udiff-line-modified-removed">-      * @param new_target the new target instruction handle</span>
<span class="udiff-line-modified-added">+      * @param lg</span>
<span class="udiff-line-modified-added">+      *            array of local variables</span>
<span class="udiff-line-modified-added">+      * @param old_target</span>
<span class="udiff-line-added">+      *            the old target instruction handle</span>
<span class="udiff-line-added">+      * @param new_target</span>
<span class="udiff-line-added">+      *            the new target instruction handle</span>
       * @see MethodGen
       */
<span class="udiff-line-modified-removed">-     public void redirectLocalVariables(final LocalVariableGen[] lg,</span>
<span class="udiff-line-removed">-             final InstructionHandle old_target, final InstructionHandle new_target) {</span>
<span class="udiff-line-modified-added">+     public void redirectLocalVariables(final LocalVariableGen[] lg, final InstructionHandle old_target, final InstructionHandle new_target) {</span>
          for (final LocalVariableGen element : lg) {
              final InstructionHandle start = element.getStart();
              final InstructionHandle end = element.getEnd();
              if (start == old_target) {
                  element.setStart(new_target);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1194,16 +1242,18 @@</span>
              }
          }
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Redirect all references of exception handlers from old_target to</span>
<span class="udiff-line-removed">-      * new_target.</span>
<span class="udiff-line-modified-added">+      * Redirect all references of exception handlers from old_target to new_target.</span>
       *
<span class="udiff-line-modified-removed">-      * @param exceptions array of exception handlers</span>
<span class="udiff-line-modified-removed">-      * @param old_target the old target instruction handle</span>
<span class="udiff-line-modified-removed">-      * @param new_target the new target instruction handle</span>
<span class="udiff-line-modified-added">+      * @param exceptions</span>
<span class="udiff-line-modified-added">+      *            array of exception handlers</span>
<span class="udiff-line-modified-added">+      * @param old_target</span>
<span class="udiff-line-added">+      *            the old target instruction handle</span>
<span class="udiff-line-added">+      * @param new_target</span>
<span class="udiff-line-added">+      *            the new target instruction handle</span>
       * @see MethodGen
       */
      public void redirectExceptionHandlers(final CodeExceptionGen[] exceptions,
              final InstructionHandle old_target, final InstructionHandle new_target) {
          for (final CodeExceptionGen exception : exceptions) {
</pre>
<center><a href="InstructionHandle.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="InstructionListObserver.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>