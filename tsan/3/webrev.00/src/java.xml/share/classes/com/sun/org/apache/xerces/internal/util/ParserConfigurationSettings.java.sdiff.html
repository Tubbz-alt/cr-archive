<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xerces/internal/util/ParserConfigurationSettings.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../parsers/AbstractSAXParser.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../xml/internal/serialize/ElementState.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xerces/internal/util/ParserConfigurationSettings.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2010, 2016, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xerces.internal.util;
 22 
 23 import com.sun.org.apache.xerces.internal.impl.Constants;
 24 import com.sun.org.apache.xerces.internal.xni.parser.XMLComponentManager;
 25 import com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException;

 26 import java.util.Arrays;
 27 import java.util.HashMap;
<span class="line-modified"> 28 import java.util.HashSet;</span>
 29 import java.util.Map;
<span class="line-removed"> 30 import java.util.Set;</span>
 31 
 32 /**
 33  * This class implements the basic operations for managing parser
 34  * configuration features and properties. This utility class can
 35  * be used as a base class for parser configurations or separately
 36  * to encapsulate a number of parser settings as a component
 37  * manager.
 38  * &lt;p&gt;
 39  * This class can be constructed with a &quot;parent&quot; settings object
 40  * (in the form of an &lt;code&gt;XMLComponentManager&lt;/code&gt;) that allows
 41  * parser configuration settings to be &quot;chained&quot; together.
 42  *
 43  * @author Andy Clark, IBM
 44  *

 45  */
 46 public class ParserConfigurationSettings
 47     implements XMLComponentManager {
 48 
 49         protected static final String PARSER_SETTINGS =
 50                         Constants.XERCES_FEATURE_PREFIX + Constants.PARSER_SETTINGS;
 51 
 52     //
 53     // Data
 54     //
 55 
 56     // data
 57 
 58     /** Recognized properties. */
<span class="line-modified"> 59     protected Set&lt;String&gt; fRecognizedProperties;</span>
 60 
 61     /** Properties. */
 62     protected Map&lt;String, Object&gt; fProperties;
 63 
 64     /** Recognized features. */
<span class="line-modified"> 65     protected Set&lt;String&gt; fRecognizedFeatures;</span>
 66 
 67     /** Features. */
 68     protected Map&lt;String, Boolean&gt; fFeatures;
 69 
 70     /** Parent parser configuration settings. */
 71     protected XMLComponentManager fParentSettings;
 72 
 73     //
 74     // Constructors
 75     //
 76 
 77     /** Default Constructor. */
 78     public ParserConfigurationSettings() {
 79         this(null);
 80     } // &lt;init&gt;()
 81 
 82     /**
 83      * Constructs a parser configuration settings object with a
 84      * parent settings object.
 85      */
 86     public ParserConfigurationSettings(XMLComponentManager parent) {
 87 
 88         // create storage for recognized features and properties
<span class="line-modified"> 89         fRecognizedFeatures = new HashSet&lt;&gt;();</span>
<span class="line-modified"> 90         fRecognizedProperties = new HashSet&lt;&gt;();</span>
 91 
 92         // create table for features and properties
 93         fFeatures = new HashMap&lt;&gt;();
 94         fProperties = new HashMap&lt;&gt;();
 95 
 96         // save parent
 97         fParentSettings = parent;
 98 
 99     } // &lt;init&gt;(XMLComponentManager)
100 
101     //
102     // XMLParserConfiguration methods
103     //
104 
105     /**
106      * Allows a parser to add parser specific features to be recognized
107      * and managed by the parser configuration.
108      *
109      * @param featureIds An array of the additional feature identifiers
110      *                   to be recognized.
</pre>
<hr />
<pre>
178 
179     } // setProperty(String,Object)
180 
181     //
182     // XMLComponentManager methods
183     //
184 
185     /**
186      * Returns the state of a feature.
187      *
188      * @param featureId The feature identifier.
189                  * @return true if the feature is supported
190      *
191      * @throws XMLConfigurationException Thrown for configuration error.
192      *                                   In general, components should
193      *                                   only throw this exception if
194      *                                   it is &lt;strong&gt;really&lt;/strong&gt;
195      *                                   a critical error.
196      */
197     @Override
<span class="line-modified">198     public final boolean getFeature(String featureId)</span>
199         throws XMLConfigurationException {
200 
201         FeatureState state = getFeatureState(featureId);
202         if (state.isExceptional()) {
203             throw new XMLConfigurationException(state.status, featureId);
204         }
205         return state.state;
206     } // getFeature(String):boolean
207 
208     @Override
209     public final boolean getFeature(String featureId, boolean defaultValue) {
210         FeatureState state = getFeatureState(featureId);
211         if (state.isExceptional()) {
212             return defaultValue;
213         }
214         return state.state;
215     }
216 
217     @Override
218     public FeatureState getFeatureState(String featureId) {
219         Boolean state = fFeatures.get(featureId);
220 
221         if (state == null) {
222             FeatureState checkState = checkFeature(featureId);
223             if (checkState.isExceptional()) {
224                 return checkState;
<span class="line-modified">225             }</span>
226             return FeatureState.is(false);
227         }
228         return FeatureState.is(state);
229     }
230 
231     /**
232      * Returns the value of a property.
233      *
234      * @param propertyId The property identifier.
235                  * @return the value of the property
236      *
237      * @throws XMLConfigurationException Thrown for configuration error.
238      *                                   In general, components should
239      *                                   only throw this exception if
240      *                                   it is &lt;strong&gt;really&lt;/strong&gt;
241      *                                   a critical error.
242      */
243     @Override
<span class="line-modified">244     public final Object getProperty(String propertyId)</span>
245         throws XMLConfigurationException {
246 
247         PropertyState state = getPropertyState(propertyId);
248         if (state.isExceptional()) {
249             throw new XMLConfigurationException(state.status, propertyId);
250         }
251 
252         return state.state;
253     } // getProperty(String):Object
254 
255     @Override
256     public final Object getProperty(String propertyId, Object defaultValue) {
257         PropertyState state = getPropertyState(propertyId);
258         if (state.isExceptional()) {
259             return defaultValue;
260         }
261 
262         return state.state;
263     }
264 
265     @Override
266     public PropertyState getPropertyState(String propertyId) {
267         Object propertyValue = fProperties.get(propertyId);
268 
269         if (propertyValue == null) {
270             PropertyState state = checkProperty(propertyId);
271             if (state.isExceptional()) {
272                 return state;
<span class="line-modified">273             }</span>
274         }
275 
276         return PropertyState.is(propertyValue);
277     }
278 
279     //
280     // Protected methods
281     //
282 
283     /**
284      * Check a feature. If feature is known and supported, this method simply
285      * returns. Otherwise, the appropriate exception is thrown.
286      *
287      * @param featureId The unique identifier (URI) of the feature.
288      *
289      * @exception com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException If the
290      *            requested feature is not known.
291      */
292     protected FeatureState checkFeature(String featureId)
293         throws XMLConfigurationException {
</pre>
<hr />
<pre>
308 
309     /**
310      * Check a property. If the property is known and supported, this method
311      * simply returns. Otherwise, the appropriate exception is thrown.
312      *
313      * @param propertyId The unique identifier (URI) of the property
314      *                   being set.
315      * @return the PropertyState
316      * @exception com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException If the
317      *            requested feature is not known.
318      */
319     protected PropertyState checkProperty(String propertyId)
320         throws XMLConfigurationException {
321 
322         // check property
323         if (!fRecognizedProperties.contains(propertyId)) {
324             if (fParentSettings != null) {
325                 PropertyState state = fParentSettings.getPropertyState(propertyId);
326                 if (state.isExceptional()) {
327                     return state;
<span class="line-modified">328                 }</span>
329             }
330             else {
331                 return PropertyState.NOT_RECOGNIZED;
332             }
333         }
334         return PropertyState.RECOGNIZED;
335     } // checkProperty(String)
336 
337 } // class ParserConfigurationSettings
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2010, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xerces.internal.util;
 22 
 23 import com.sun.org.apache.xerces.internal.impl.Constants;
 24 import com.sun.org.apache.xerces.internal.xni.parser.XMLComponentManager;
 25 import com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException;
<span class="line-added"> 26 import java.util.ArrayList;</span>
 27 import java.util.Arrays;
 28 import java.util.HashMap;
<span class="line-modified"> 29 import java.util.List;</span>
 30 import java.util.Map;

 31 
 32 /**
 33  * This class implements the basic operations for managing parser
 34  * configuration features and properties. This utility class can
 35  * be used as a base class for parser configurations or separately
 36  * to encapsulate a number of parser settings as a component
 37  * manager.
 38  * &lt;p&gt;
 39  * This class can be constructed with a &quot;parent&quot; settings object
 40  * (in the form of an &lt;code&gt;XMLComponentManager&lt;/code&gt;) that allows
 41  * parser configuration settings to be &quot;chained&quot; together.
 42  *
 43  * @author Andy Clark, IBM
 44  *
<span class="line-added"> 45  * @LastModified: Apr 2019</span>
 46  */
 47 public class ParserConfigurationSettings
 48     implements XMLComponentManager {
 49 
 50         protected static final String PARSER_SETTINGS =
 51                         Constants.XERCES_FEATURE_PREFIX + Constants.PARSER_SETTINGS;
 52 
 53     //
 54     // Data
 55     //
 56 
 57     // data
 58 
 59     /** Recognized properties. */
<span class="line-modified"> 60     protected List&lt;String&gt; fRecognizedProperties;</span>
 61 
 62     /** Properties. */
 63     protected Map&lt;String, Object&gt; fProperties;
 64 
 65     /** Recognized features. */
<span class="line-modified"> 66     protected List&lt;String&gt; fRecognizedFeatures;</span>
 67 
 68     /** Features. */
 69     protected Map&lt;String, Boolean&gt; fFeatures;
 70 
 71     /** Parent parser configuration settings. */
 72     protected XMLComponentManager fParentSettings;
 73 
 74     //
 75     // Constructors
 76     //
 77 
 78     /** Default Constructor. */
 79     public ParserConfigurationSettings() {
 80         this(null);
 81     } // &lt;init&gt;()
 82 
 83     /**
 84      * Constructs a parser configuration settings object with a
 85      * parent settings object.
 86      */
 87     public ParserConfigurationSettings(XMLComponentManager parent) {
 88 
 89         // create storage for recognized features and properties
<span class="line-modified"> 90         fRecognizedFeatures = new ArrayList&lt;&gt;();</span>
<span class="line-modified"> 91         fRecognizedProperties = new ArrayList&lt;&gt;();</span>
 92 
 93         // create table for features and properties
 94         fFeatures = new HashMap&lt;&gt;();
 95         fProperties = new HashMap&lt;&gt;();
 96 
 97         // save parent
 98         fParentSettings = parent;
 99 
100     } // &lt;init&gt;(XMLComponentManager)
101 
102     //
103     // XMLParserConfiguration methods
104     //
105 
106     /**
107      * Allows a parser to add parser specific features to be recognized
108      * and managed by the parser configuration.
109      *
110      * @param featureIds An array of the additional feature identifiers
111      *                   to be recognized.
</pre>
<hr />
<pre>
179 
180     } // setProperty(String,Object)
181 
182     //
183     // XMLComponentManager methods
184     //
185 
186     /**
187      * Returns the state of a feature.
188      *
189      * @param featureId The feature identifier.
190                  * @return true if the feature is supported
191      *
192      * @throws XMLConfigurationException Thrown for configuration error.
193      *                                   In general, components should
194      *                                   only throw this exception if
195      *                                   it is &lt;strong&gt;really&lt;/strong&gt;
196      *                                   a critical error.
197      */
198     @Override
<span class="line-modified">199     public boolean getFeature(String featureId)</span>
200         throws XMLConfigurationException {
201 
202         FeatureState state = getFeatureState(featureId);
203         if (state.isExceptional()) {
204             throw new XMLConfigurationException(state.status, featureId);
205         }
206         return state.state;
207     } // getFeature(String):boolean
208 
209     @Override
210     public final boolean getFeature(String featureId, boolean defaultValue) {
211         FeatureState state = getFeatureState(featureId);
212         if (state.isExceptional()) {
213             return defaultValue;
214         }
215         return state.state;
216     }
217 
218     @Override
219     public FeatureState getFeatureState(String featureId) {
220         Boolean state = fFeatures.get(featureId);
221 
222         if (state == null) {
223             FeatureState checkState = checkFeature(featureId);
224             if (checkState.isExceptional()) {
225                 return checkState;
<span class="line-modified">226         }</span>
227             return FeatureState.is(false);
228         }
229         return FeatureState.is(state);
230     }
231 
232     /**
233      * Returns the value of a property.
234      *
235      * @param propertyId The property identifier.
236                  * @return the value of the property
237      *
238      * @throws XMLConfigurationException Thrown for configuration error.
239      *                                   In general, components should
240      *                                   only throw this exception if
241      *                                   it is &lt;strong&gt;really&lt;/strong&gt;
242      *                                   a critical error.
243      */
244     @Override
<span class="line-modified">245     public Object getProperty(String propertyId)</span>
246         throws XMLConfigurationException {
247 
248         PropertyState state = getPropertyState(propertyId);
249         if (state.isExceptional()) {
250             throw new XMLConfigurationException(state.status, propertyId);
251         }
252 
253         return state.state;
254     } // getProperty(String):Object
255 
256     @Override
257     public final Object getProperty(String propertyId, Object defaultValue) {
258         PropertyState state = getPropertyState(propertyId);
259         if (state.isExceptional()) {
260             return defaultValue;
261         }
262 
263         return state.state;
264     }
265 
266     @Override
267     public PropertyState getPropertyState(String propertyId) {
268         Object propertyValue = fProperties.get(propertyId);
269 
270         if (propertyValue == null) {
271             PropertyState state = checkProperty(propertyId);
272             if (state.isExceptional()) {
273                 return state;
<span class="line-modified">274         }</span>
275         }
276 
277         return PropertyState.is(propertyValue);
278     }
279 
280     //
281     // Protected methods
282     //
283 
284     /**
285      * Check a feature. If feature is known and supported, this method simply
286      * returns. Otherwise, the appropriate exception is thrown.
287      *
288      * @param featureId The unique identifier (URI) of the feature.
289      *
290      * @exception com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException If the
291      *            requested feature is not known.
292      */
293     protected FeatureState checkFeature(String featureId)
294         throws XMLConfigurationException {
</pre>
<hr />
<pre>
309 
310     /**
311      * Check a property. If the property is known and supported, this method
312      * simply returns. Otherwise, the appropriate exception is thrown.
313      *
314      * @param propertyId The unique identifier (URI) of the property
315      *                   being set.
316      * @return the PropertyState
317      * @exception com.sun.org.apache.xerces.internal.xni.parser.XMLConfigurationException If the
318      *            requested feature is not known.
319      */
320     protected PropertyState checkProperty(String propertyId)
321         throws XMLConfigurationException {
322 
323         // check property
324         if (!fRecognizedProperties.contains(propertyId)) {
325             if (fParentSettings != null) {
326                 PropertyState state = fParentSettings.getPropertyState(propertyId);
327                 if (state.isExceptional()) {
328                     return state;
<span class="line-modified">329             }</span>
330             }
331             else {
332                 return PropertyState.NOT_RECOGNIZED;
333             }
334         }
335         return PropertyState.RECOGNIZED;
336     } // checkProperty(String)
337 
338 } // class ParserConfigurationSettings
</pre>
</td>
</tr>
</table>
<center><a href="../parsers/AbstractSAXParser.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../xml/internal/serialize/ElementState.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>