<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.xml/share/classes/com/sun/org/apache/xerces/internal/dom/NodeImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ElementNSImpl.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="PSVIDOMImplementationImpl.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xerces/internal/dom/NodeImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2017 Oracle and/or its affiliates. All rights reserved.</span>
   */
   /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   */
   /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 25,10 ***</span>
<span class="line-new-header">--- 25,11 ---</span>
  import java.io.Serializable;
  import java.util.Map;
  import org.w3c.dom.DOMException;
  import org.w3c.dom.Document;
  import org.w3c.dom.DocumentType;
<span class="line-added">+ import org.w3c.dom.Element;</span>
  import org.w3c.dom.NamedNodeMap;
  import org.w3c.dom.Node;
  import org.w3c.dom.NodeList;
  import org.w3c.dom.UserDataHandler;
  import org.w3c.dom.events.Event;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 76,10 ***</span>
<span class="line-new-header">--- 77,11 ---</span>
   * @xerces.internal
   *
   * @author Arnaud  Le Hors, IBM
   * @author Joe Kesselman, IBM
   * @since  PR-DOM-Level-1-19980818.
<span class="line-added">+  * @LastModified: Apr 2019</span>
   */
  public abstract class NodeImpl
      implements Node, NodeList, EventTarget, Cloneable, Serializable{
  
      //
</pre>
<hr />
<pre>
<span class="line-old-header">*** 120,19 ***</span>
       * The two nodes are disconnected, they do not have any common ancestor.
       * This is the case of two nodes that are not in the same document.
       */
      public static final short TREE_POSITION_DISCONNECTED = 0x00;
  
<span class="line-removed">- </span>
<span class="line-removed">-     // DocumentPosition</span>
<span class="line-removed">-     public static final short DOCUMENT_POSITION_DISCONNECTED = 0x01;</span>
<span class="line-removed">-     public static final short DOCUMENT_POSITION_PRECEDING = 0x02;</span>
<span class="line-removed">-     public static final short DOCUMENT_POSITION_FOLLOWING = 0x04;</span>
<span class="line-removed">-     public static final short DOCUMENT_POSITION_CONTAINS = 0x08;</span>
<span class="line-removed">-     public static final short DOCUMENT_POSITION_IS_CONTAINED = 0x10;</span>
<span class="line-removed">-     public static final short DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = 0x20;</span>
<span class="line-removed">- </span>
      /** Serialization version. */
      static final long serialVersionUID = -6316591992167219696L;
  
      // public
  
<span class="line-new-header">--- 122,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 322,11 ***</span>
  
      /**
       * NON-DOM
       * set the ownerDocument of this node
       */
<span class="line-modified">!     void setOwnerDocument(CoreDocumentImpl doc) {</span>
          if (needsSyncData()) {
              synchronizeData();
          }
          // if we have an owner we rely on it to have it right
          // otherwise ownerNode is our ownerDocument
<span class="line-new-header">--- 315,11 ---</span>
  
      /**
       * NON-DOM
       * set the ownerDocument of this node
       */
<span class="line-modified">!     protected void setOwnerDocument(CoreDocumentImpl doc) {</span>
          if (needsSyncData()) {
              synchronizeData();
          }
          // if we have an owner we rely on it to have it right
          // otherwise ownerNode is our ownerDocument
</pre>
<hr />
<pre>
<span class="line-old-header">*** 557,11 ***</span>
       * &lt;P&gt;
       * By default we do not have any children, ParentNode overrides this.
       * @see ParentNode
       *
       * @return org.w3c.dom.Node
<span class="line-modified">!      * @param Index int</span>
       */
      public Node item(int index) {
          return null;
      }
  
<span class="line-new-header">--- 550,11 ---</span>
       * &lt;P&gt;
       * By default we do not have any children, ParentNode overrides this.
       * @see ParentNode
       *
       * @return org.w3c.dom.Node
<span class="line-modified">!      * @param index int</span>
       */
      public Node item(int index) {
          return null;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 974,13 ***</span>
          // If the nodes are the same, no flags should be set
          if (this==other)
            return 0;
  
          // check if other is from a different implementation
<span class="line-modified">!         try {</span>
<span class="line-removed">-             NodeImpl node = (NodeImpl) other;</span>
<span class="line-removed">-         } catch (ClassCastException e) {</span>
              // other comes from a different implementation
              String msg = DOMMessageFormatter.formatMessage(
                 DOMMessageFormatter.DOM_DOMAIN, &quot;NOT_SUPPORTED_ERR&quot;, null);
              throw new DOMException(DOMException.NOT_SUPPORTED_ERR, msg);
          }
<span class="line-new-header">--- 967,11 ---</span>
          // If the nodes are the same, no flags should be set
          if (this==other)
            return 0;
  
          // check if other is from a different implementation
<span class="line-modified">!         if (other != null &amp;&amp; !(other instanceof NodeImpl)) {</span>
              // other comes from a different implementation
              String msg = DOMMessageFormatter.formatMessage(
                 DOMMessageFormatter.DOM_DOMAIN, &quot;NOT_SUPPORTED_ERR&quot;, null);
              throw new DOMException(DOMException.NOT_SUPPORTED_ERR, msg);
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1039,11 ***</span>
  
          for (node=other; node!=null; node=node.getParentNode()) {
              otherDepth +=1;
              if (node == this)
                // The other node is a descendent of the reference node.
<span class="line-modified">!               return (DOCUMENT_POSITION_IS_CONTAINED |</span>
                        DOCUMENT_POSITION_FOLLOWING);
              otherAncestor = node;
          }
  
  
<span class="line-new-header">--- 1030,11 ---</span>
  
          for (node=other; node!=null; node=node.getParentNode()) {
              otherDepth +=1;
              if (node == this)
                // The other node is a descendent of the reference node.
<span class="line-modified">!               return (DOCUMENT_POSITION_CONTAINED_BY |</span>
                        DOCUMENT_POSITION_FOLLOWING);
              otherAncestor = node;
          }
  
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1129,19 ***</span>
          }
          switch (otherAncestorType) {
            case Node.NOTATION_NODE:
            case Node.ENTITY_NODE: {
            DocumentType container = thisOwnerDoc.getDoctype();
<span class="line-modified">!             if (container == this) return (DOCUMENT_POSITION_IS_CONTAINED |</span>
                                            DOCUMENT_POSITION_FOLLOWING);
              otherNode = otherAncestor = thisOwnerDoc;
              break;
            }
            case Node.DOCUMENT_TYPE_NODE: {
              if (thisNode == otherOwnerDoc)
                return (DOCUMENT_POSITION_FOLLOWING |
<span class="line-modified">!                       DOCUMENT_POSITION_IS_CONTAINED);</span>
              else if (otherOwnerDoc!=null &amp;&amp; thisOwnerDoc==otherOwnerDoc)
                return (DOCUMENT_POSITION_PRECEDING);
              break;
            }
            case Node.ATTRIBUTE_NODE: {
<span class="line-new-header">--- 1120,19 ---</span>
          }
          switch (otherAncestorType) {
            case Node.NOTATION_NODE:
            case Node.ENTITY_NODE: {
            DocumentType container = thisOwnerDoc.getDoctype();
<span class="line-modified">!             if (container == this) return (DOCUMENT_POSITION_CONTAINED_BY |</span>
                                            DOCUMENT_POSITION_FOLLOWING);
              otherNode = otherAncestor = thisOwnerDoc;
              break;
            }
            case Node.DOCUMENT_TYPE_NODE: {
              if (thisNode == otherOwnerDoc)
                return (DOCUMENT_POSITION_FOLLOWING |
<span class="line-modified">!                       DOCUMENT_POSITION_CONTAINED_BY);</span>
              else if (otherOwnerDoc!=null &amp;&amp; thisOwnerDoc==otherOwnerDoc)
                return (DOCUMENT_POSITION_PRECEDING);
              break;
            }
            case Node.ATTRIBUTE_NODE: {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1151,11 ***</span>
                  otherDepth +=1;
                  if (node == thisNode)
                    // The other node is a descendent of the reference
                    // node&#39;s element
                    return DOCUMENT_POSITION_FOLLOWING |
<span class="line-modified">!                          DOCUMENT_POSITION_IS_CONTAINED;</span>
                  otherAncestor = node;
              }
  
            }
          }
<span class="line-new-header">--- 1142,11 ---</span>
                  otherDepth +=1;
                  if (node == thisNode)
                    // The other node is a descendent of the reference
                    // node&#39;s element
                    return DOCUMENT_POSITION_FOLLOWING |
<span class="line-modified">!                          DOCUMENT_POSITION_CONTAINED_BY;</span>
                  otherAncestor = node;
              }
  
            }
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1300,12 ***</span>
       */
      public String getTextContent() throws DOMException {
          return getNodeValue();  // overriden in some subclasses
      }
  
<span class="line-modified">!     // internal method taking a StringBuffer in parameter</span>
<span class="line-modified">!     void getTextContent(StringBuffer buf) throws DOMException {</span>
          String content = getNodeValue();
          if (content != null) {
              buf.append(content);
          }
      }
<span class="line-new-header">--- 1291,12 ---</span>
       */
      public String getTextContent() throws DOMException {
          return getNodeValue();  // overriden in some subclasses
      }
  
<span class="line-modified">!     // internal method taking a StringBuilder in parameter</span>
<span class="line-modified">!     void getTextContent(StringBuilder buf) throws DOMException {</span>
          String content = getNodeValue();
          if (content != null) {
              buf.append(content);
          }
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1423,11 ***</span>
                  return ancestor.isDefaultNamespace(namespaceURI);
              }
              return false;
          }
          case Node.DOCUMENT_NODE:{
<span class="line-modified">!                 return((NodeImpl)((Document)this).getDocumentElement()).isDefaultNamespace(namespaceURI);</span>
              }
  
          case Node.ENTITY_NODE :
          case Node.NOTATION_NODE:
          case Node.DOCUMENT_FRAGMENT_NODE:
<span class="line-new-header">--- 1414,15 ---</span>
                  return ancestor.isDefaultNamespace(namespaceURI);
              }
              return false;
          }
          case Node.DOCUMENT_NODE:{
<span class="line-modified">!                 Element docElement = ((Document)this).getDocumentElement();</span>
<span class="line-added">+                 if (docElement != null) {</span>
<span class="line-added">+                     return docElement.isDefaultNamespace(namespaceURI);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 return false;</span>
              }
  
          case Node.ENTITY_NODE :
          case Node.NOTATION_NODE:
          case Node.DOCUMENT_FRAGMENT_NODE:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1473,16 ***</span>
  
          short type = this.getNodeType();
  
          switch (type) {
          case Node.ELEMENT_NODE: {
<span class="line-modified">! </span>
<span class="line-removed">-                 String namespace = this.getNamespaceURI(); // to flip out children</span>
                  return lookupNamespacePrefix(namespaceURI, (ElementImpl)this);
              }
          case Node.DOCUMENT_NODE:{
<span class="line-modified">!                 return((NodeImpl)((Document)this).getDocumentElement()).lookupPrefix(namespaceURI);</span>
              }
  
          case Node.ENTITY_NODE :
          case Node.NOTATION_NODE:
          case Node.DOCUMENT_FRAGMENT_NODE:
<span class="line-new-header">--- 1468,19 ---</span>
  
          short type = this.getNodeType();
  
          switch (type) {
          case Node.ELEMENT_NODE: {
<span class="line-modified">!                 this.getNamespaceURI(); // to flip out children</span>
                  return lookupNamespacePrefix(namespaceURI, (ElementImpl)this);
              }
          case Node.DOCUMENT_NODE:{
<span class="line-modified">!                 Element docElement = ((Document)this).getDocumentElement();</span>
<span class="line-added">+                 if (docElement != null) {</span>
<span class="line-added">+                     return docElement.lookupPrefix(namespaceURI);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 return null;</span>
              }
  
          case Node.ENTITY_NODE :
          case Node.NOTATION_NODE:
          case Node.DOCUMENT_FRAGMENT_NODE:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1509,12 ***</span>
      /**
       * DOM Level 3 - Experimental:
       * Look up the namespace URI associated to the given prefix, starting from this node.
       * Use lookupNamespaceURI(null) to lookup the default namespace
       *
<span class="line-modified">!      * @param namespaceURI</span>
<span class="line-modified">!      * @return th URI for the namespace</span>
       * @since DOM Level 3
       */
      public String lookupNamespaceURI(String specifiedPrefix) {
          short type = this.getNodeType();
          switch (type) {
<span class="line-new-header">--- 1507,12 ---</span>
      /**
       * DOM Level 3 - Experimental:
       * Look up the namespace URI associated to the given prefix, starting from this node.
       * Use lookupNamespaceURI(null) to lookup the default namespace
       *
<span class="line-modified">!      * @param specifiedPrefix</span>
<span class="line-modified">!      * @return the URI for the namespace</span>
       * @since DOM Level 3
       */
      public String lookupNamespaceURI(String specifiedPrefix) {
          short type = this.getNodeType();
          switch (type) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1535,24 ***</span>
                  if (this.hasAttributes()) {
                      NamedNodeMap map = this.getAttributes();
                      int length = map.getLength();
                      for (int i=0;i&lt;length;i++) {
                          Node attr = map.item(i);
<span class="line-removed">-                         String attrPrefix = attr.getPrefix();</span>
<span class="line-removed">-                         String value = attr.getNodeValue();</span>
                          namespace = attr.getNamespaceURI();
                          if (namespace !=null &amp;&amp; namespace.equals(&quot;http://www.w3.org/2000/xmlns/&quot;)) {
                              // at this point we are dealing with DOM Level 2 nodes only
                              if (specifiedPrefix == null &amp;&amp;
                                  attr.getNodeName().equals(&quot;xmlns&quot;)) {
                                  // default namespace
<span class="line-modified">!                                 return value;</span>
                              } else if (attrPrefix !=null &amp;&amp;
                                         attrPrefix.equals(&quot;xmlns&quot;) &amp;&amp;
                                         attr.getLocalName().equals(specifiedPrefix)) {
                                  // non default namespace
<span class="line-modified">!                                 return value;</span>
                              }
                          }
                      }
                  }
                  NodeImpl ancestor = (NodeImpl)getElementAncestor(this);
<span class="line-new-header">--- 1533,24 ---</span>
                  if (this.hasAttributes()) {
                      NamedNodeMap map = this.getAttributes();
                      int length = map.getLength();
                      for (int i=0;i&lt;length;i++) {
                          Node attr = map.item(i);
                          namespace = attr.getNamespaceURI();
                          if (namespace !=null &amp;&amp; namespace.equals(&quot;http://www.w3.org/2000/xmlns/&quot;)) {
<span class="line-added">+                             String attrPrefix = attr.getPrefix();</span>
<span class="line-added">+                             String value = attr.getNodeValue();</span>
                              // at this point we are dealing with DOM Level 2 nodes only
                              if (specifiedPrefix == null &amp;&amp;
                                  attr.getNodeName().equals(&quot;xmlns&quot;)) {
                                  // default namespace
<span class="line-modified">!                                 return value.length() &gt; 0 ? value : null;</span>
                              } else if (attrPrefix !=null &amp;&amp;
                                         attrPrefix.equals(&quot;xmlns&quot;) &amp;&amp;
                                         attr.getLocalName().equals(specifiedPrefix)) {
                                  // non default namespace
<span class="line-modified">!                                 return value.length() &gt; 0 ? value : null;</span>
                              }
                          }
                      }
                  }
                  NodeImpl ancestor = (NodeImpl)getElementAncestor(this);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1563,11 ***</span>
                  return null;
  
  
              }
          case Node.DOCUMENT_NODE : {
<span class="line-modified">!                 return((NodeImpl)((Document)this).getDocumentElement()).lookupNamespaceURI(specifiedPrefix);</span>
              }
          case Node.ENTITY_NODE :
          case Node.NOTATION_NODE:
          case Node.DOCUMENT_FRAGMENT_NODE:
          case Node.DOCUMENT_TYPE_NODE:
<span class="line-new-header">--- 1561,15 ---</span>
                  return null;
  
  
              }
          case Node.DOCUMENT_NODE : {
<span class="line-modified">!                 Element docElement = ((Document)this).getDocumentElement();</span>
<span class="line-added">+                 if (docElement != null) {</span>
<span class="line-added">+                     return docElement.lookupNamespaceURI(specifiedPrefix);</span>
<span class="line-added">+                 }</span>
<span class="line-added">+                 return null;</span>
              }
          case Node.ENTITY_NODE :
          case Node.NOTATION_NODE:
          case Node.DOCUMENT_FRAGMENT_NODE:
          case Node.DOCUMENT_TYPE_NODE:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1589,19 ***</span>
              }
  
          }
      }
  
<span class="line-modified">! </span>
<span class="line-removed">-     Node getElementAncestor (Node currentNode){</span>
          Node parent = currentNode.getParentNode();
<span class="line-modified">!         if (parent != null) {</span>
              short type = parent.getNodeType();
              if (type == Node.ELEMENT_NODE) {
                  return parent;
              }
<span class="line-modified">!             return getElementAncestor(parent);</span>
          }
          return null;
      }
  
      String lookupNamespacePrefix(String namespaceURI, ElementImpl el){
<span class="line-new-header">--- 1591,18 ---</span>
              }
  
          }
      }
  
<span class="line-modified">!     Node getElementAncestor(Node currentNode) {</span>
          Node parent = currentNode.getParentNode();
<span class="line-modified">!         while (parent != null) {</span>
              short type = parent.getNodeType();
              if (type == Node.ELEMENT_NODE) {
                  return parent;
              }
<span class="line-modified">!             parent = parent.getParentNode();</span>
          }
          return null;
      }
  
      String lookupNamespacePrefix(String namespaceURI, ElementImpl el){
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1622,14 ***</span>
          if (this.hasAttributes()) {
              NamedNodeMap map = this.getAttributes();
              int length = map.getLength();
              for (int i=0;i&lt;length;i++) {
                  Node attr = map.item(i);
<span class="line-removed">-                 String attrPrefix = attr.getPrefix();</span>
<span class="line-removed">-                 String value = attr.getNodeValue();</span>
                  namespace = attr.getNamespaceURI();
                  if (namespace !=null &amp;&amp; namespace.equals(&quot;http://www.w3.org/2000/xmlns/&quot;)) {
                      // DOM Level 2 nodes
                      if (((attr.getNodeName().equals(&quot;xmlns&quot;)) ||
                           (attrPrefix !=null &amp;&amp; attrPrefix.equals(&quot;xmlns&quot;)) &amp;&amp;
                           value.equals(namespaceURI))) {
  
<span class="line-new-header">--- 1623,14 ---</span>
          if (this.hasAttributes()) {
              NamedNodeMap map = this.getAttributes();
              int length = map.getLength();
              for (int i=0;i&lt;length;i++) {
                  Node attr = map.item(i);
                  namespace = attr.getNamespaceURI();
                  if (namespace !=null &amp;&amp; namespace.equals(&quot;http://www.w3.org/2000/xmlns/&quot;)) {
<span class="line-added">+                     String attrPrefix = attr.getPrefix();</span>
<span class="line-added">+                     String value = attr.getNodeValue();</span>
                      // DOM Level 2 nodes
                      if (((attr.getNodeName().equals(&quot;xmlns&quot;)) ||
                           (attrPrefix !=null &amp;&amp; attrPrefix.equals(&quot;xmlns&quot;)) &amp;&amp;
                           value.equals(namespaceURI))) {
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1685,13 ***</span>
       * attribute for &lt;code&gt;Attr&lt;/code&gt; nodes, the
       * &lt;code&gt;isWhitespaceInElementContent&lt;/code&gt; attribute for
       * &lt;code&gt;Text&lt;/code&gt; nodes, as well as any user data or event listeners
       * registered on the nodes.
       * @param arg The node to compare equality with.
<span class="line-removed">-      * @param deep If &lt;code&gt;true&lt;/code&gt;, recursively compare the subtrees; if</span>
<span class="line-removed">-      *   &lt;code&gt;false&lt;/code&gt;, compare only the nodes themselves (and its</span>
<span class="line-removed">-      *   attributes, if it is an &lt;code&gt;Element&lt;/code&gt;).</span>
       * @return If the nodes, and possibly subtrees are equal,
       *   &lt;code&gt;true&lt;/code&gt; otherwise &lt;code&gt;false&lt;/code&gt;.
       * @since DOM Level 3
       */
      public boolean isEqualNode(Node arg) {
<span class="line-new-header">--- 1686,10 ---</span>
</pre>
<center><a href="ElementNSImpl.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="PSVIDOMImplementationImpl.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>