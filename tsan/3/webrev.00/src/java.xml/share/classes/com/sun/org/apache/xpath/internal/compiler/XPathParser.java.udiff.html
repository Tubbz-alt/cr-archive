<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.xml/share/classes/com/sun/org/apache/xpath/internal/compiler/XPathParser.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Compiler.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../res/XPATHErrorResources.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xpath/internal/compiler/XPathParser.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   */
  /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -32,10 +32,11 @@</span>
  
  /**
   * Tokenizes and parses XPath expressions. This should really be named
   * XPathParserImpl, and may be renamed in the future.
   * @xsl.usage general
<span class="udiff-line-added">+  * @LastModified: May 2019</span>
   */
  public class XPathParser
  {
          // %REVIEW% Is there a better way of doing this?
          // Upside is minimum object churn. Downside is that we don&#39;t have a useful
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -69,10 +70,13 @@</span>
     */
    protected final static int FILTER_MATCH_FAILED     = 0;
    protected final static int FILTER_MATCH_PRIMARY    = 1;
    protected final static int FILTER_MATCH_PREDICATES = 2;
  
<span class="udiff-line-added">+   // counts open predicates</span>
<span class="udiff-line-added">+   private int countPredicate;</span>
<span class="udiff-line-added">+ </span>
    /**
     * The parser constructor.
     */
    public XPathParser(ErrorListener errorListener, javax.xml.transform.SourceLocator sourceLocator)
    {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -155,10 +159,13 @@</span>
                  // %REVIEW%!!!
                  initXPath(compiler, &quot;/..&quot;,  namespaceContext);
            }
            else
                  throw e;
<span class="udiff-line-added">+     } catch (StackOverflowError sof) {</span>
<span class="udiff-line-added">+         error(XPATHErrorResources.ER_PREDICATE_TOO_MANY_OPEN,</span>
<span class="udiff-line-added">+               new Object[]{m_token, m_queueMark, countPredicate});</span>
      }
  
      compiler.shrink();
    }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -188,11 +195,16 @@</span>
  
      m_ops.setOp(0, OpCodes.OP_MATCHPATTERN);
      m_ops.setOp(OpMap.MAPINDEX_LENGTH, 2);
  
      nextToken();
<span class="udiff-line-modified-removed">-     Pattern();</span>
<span class="udiff-line-modified-added">+     try {</span>
<span class="udiff-line-added">+         Pattern();</span>
<span class="udiff-line-added">+     } catch (StackOverflowError sof) {</span>
<span class="udiff-line-added">+         error(XPATHErrorResources.ER_PREDICATE_TOO_MANY_OPEN,</span>
<span class="udiff-line-added">+               new Object[]{m_token, m_queueMark, countPredicate});</span>
<span class="udiff-line-added">+     }</span>
  
      if (null != m_token)
      {
        String extraTokens = &quot;&quot;;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -739,11 +751,11 @@</span>
     *
     * @throws javax.xml.transform.TransformerException
     */
    protected void Expr() throws javax.xml.transform.TransformerException
    {
<span class="udiff-line-modified-removed">-     OrExpr();</span>
<span class="udiff-line-modified-added">+        OrExpr();</span>
    }
  
    /**
     *
     *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1881,15 +1893,16 @@</span>
     *
     * @throws javax.xml.transform.TransformerException
     */
    protected void Predicate() throws javax.xml.transform.TransformerException
    {
<span class="udiff-line-removed">- </span>
      if (tokenIs(&#39;[&#39;))
      {
<span class="udiff-line-added">+       countPredicate++;</span>
        nextToken();
        PredicateExpr();
<span class="udiff-line-added">+       countPredicate--;</span>
        consumeExpected(&#39;]&#39;);
      }
    }
  
    /**
</pre>
<center><a href="Compiler.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../res/XPATHErrorResources.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>