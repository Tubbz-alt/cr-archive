<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/java.xml/share/classes/com/sun/org/apache/bcel/internal/util/Class2HTML.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 package com.sun.org.apache.bcel.internal.util;
 21 
 22 import java.io.File;
 23 import java.io.FileOutputStream;
 24 import java.io.IOException;
 25 import java.io.PrintWriter;
 26 import java.util.HashSet;
 27 import java.util.Set;
 28 
 29 import com.sun.org.apache.bcel.internal.Const;
 30 import com.sun.org.apache.bcel.internal.classfile.Attribute;
 31 import com.sun.org.apache.bcel.internal.classfile.ClassParser;
 32 import com.sun.org.apache.bcel.internal.classfile.ConstantPool;
 33 import com.sun.org.apache.bcel.internal.classfile.JavaClass;
 34 import com.sun.org.apache.bcel.internal.classfile.Method;
 35 import com.sun.org.apache.bcel.internal.classfile.Utility;
 36 
 37 /**
 38  * Read class file(s) and convert them into HTML files.
 39  *
 40  * Given a JavaClass object &quot;class&quot; that is in package &quot;package&quot; five files will
 41  * be created in the specified directory.
 42  *
 43  * &lt;OL&gt;
 44  * &lt;LI&gt; &quot;package&quot;.&quot;class&quot;.html as the main file which defines the frames for the
 45  * following subfiles.
 46  * &lt;LI&gt; &quot;package&quot;.&quot;class&quot;_attributes.html contains all (known) attributes found
 47  * in the file
 48  * &lt;LI&gt; &quot;package&quot;.&quot;class&quot;_cp.html contains the constant pool
 49  * &lt;LI&gt; &quot;package&quot;.&quot;class&quot;_code.html contains the byte code
 50  * &lt;LI&gt; &quot;package&quot;.&quot;class&quot;_methods.html contains references to all methods and
 51  * fields of the class
 52  * &lt;/OL&gt;
 53  *
 54  * All subfiles reference each other appropriately, e.g. clicking on a method in
 55  * the Method&#39;s frame will jump to the appropriate method in the Code frame.
 56  *
 57  * @version $Id: Class2HTML.java 1749603 2016-06-21 20:50:19Z ggregory $
 58  */
 59 public class Class2HTML {
 60 
 61     private final JavaClass java_class; // current class object
 62     private final String dir;
 63     private static String class_package; // name of package, unclean to make it static, but ...
 64     private static String class_name; // name of current class, dito
 65     private static ConstantPool constant_pool;
 66     private static final Set&lt;String&gt; basic_types = new HashSet&lt;&gt;();
 67 
 68     static {
 69         basic_types.add(&quot;int&quot;);
 70         basic_types.add(&quot;short&quot;);
 71         basic_types.add(&quot;boolean&quot;);
 72         basic_types.add(&quot;void&quot;);
 73         basic_types.add(&quot;char&quot;);
 74         basic_types.add(&quot;byte&quot;);
 75         basic_types.add(&quot;long&quot;);
 76         basic_types.add(&quot;double&quot;);
 77         basic_types.add(&quot;float&quot;);
 78     }
 79 
 80     /**
 81      * Write contents of the given JavaClass into HTML files.
 82      *
 83      * @param java_class The class to write
 84      * @param dir The directory to put the files in
 85      */
 86     public Class2HTML(final JavaClass java_class, final String dir) throws IOException {
 87         final Method[] methods = java_class.getMethods();
 88         this.java_class = java_class;
 89         this.dir = dir;
 90         class_name = java_class.getClassName(); // Remember full name
 91         constant_pool = java_class.getConstantPool();
 92         // Get package name by tacking off everything after the last `.&#39;
 93         final int index = class_name.lastIndexOf(&#39;.&#39;);
 94         if (index &gt; -1) {
 95             class_package = class_name.substring(0, index);
 96         } else {
 97             class_package = &quot;&quot;; // default package
 98         }
 99         final ConstantHTML constant_html = new ConstantHTML(dir, class_name, class_package, methods,
100                 constant_pool);
101         /* Attributes can&#39;t be written in one step, so we just open a file
102          * which will be written consequently.
103          */
104         final AttributeHTML attribute_html = new AttributeHTML(dir, class_name, constant_pool,
105                 constant_html);
106         new MethodHTML(dir, class_name, methods, java_class.getFields(),
107                 constant_html, attribute_html);
108         // Write main file (with frames, yuk)
109         writeMainHTML(attribute_html);
110         new CodeHTML(dir, class_name, methods, constant_pool, constant_html);
111         attribute_html.close();
112     }
113 
114     public static void _main(final String[] argv) throws IOException {
115         final String[] file_name = new String[argv.length];
116         int files = 0;
117         ClassParser parser = null;
118         JavaClass java_class = null;
119         String zip_file = null;
120         final char sep = File.separatorChar;
121         String dir = &quot;.&quot; + sep; // Where to store HTML files
122         /* Parse command line arguments.
123          */
124         for (int i = 0; i &lt; argv.length; i++) {
125             if (argv[i].charAt(0) == &#39;-&#39;) { // command line switch
126                 if (argv[i].equals(&quot;-d&quot;)) { // Specify target directory, default &#39;.&#39;
127                     dir = argv[++i];
128                     if (!dir.endsWith(&quot;&quot; + sep)) {
129                         dir = dir + sep;
130                     }
131                     final File store = new File(dir);
132 
133                     if (!store.isDirectory()) {
134                         final boolean created = store.mkdirs(); // Create target directory if necessary
135                         if (!created) {
136                             if (!store.isDirectory()) {
137                                 System.out.println(&quot;Tried to create the directory &quot; + dir + &quot; but failed&quot;);
138                             }
139                         }
140                     }
141                 } else if (argv[i].equals(&quot;-zip&quot;)) {
142                     zip_file = argv[++i];
143                 } else {
144                     System.out.println(&quot;Unknown option &quot; + argv[i]);
145                 }
146             } else {
147                 file_name[files++] = argv[i];
148             }
149         }
150         if (files == 0) {
151             System.err.println(&quot;Class2HTML: No input files specified.&quot;);
152         } else { // Loop through files ...
153             for (int i = 0; i &lt; files; i++) {
154                 System.out.print(&quot;Processing &quot; + file_name[i] + &quot;...&quot;);
155                 if (zip_file == null) {
156                     parser = new ClassParser(file_name[i]); // Create parser object from file
157                 } else {
158                     parser = new ClassParser(zip_file, file_name[i]); // Create parser object from zip file
159                 }
160                 java_class = parser.parse();
161                 new Class2HTML(java_class, dir);
162                 System.out.println(&quot;Done.&quot;);
163             }
164         }
165     }
166 
167     /**
168      * Utility method that converts a class reference in the constant pool,
169      * i.e., an index to a string.
170      */
171     static String referenceClass(final int index) {
172         String str = constant_pool.getConstantString(index, Const.CONSTANT_Class);
173         str = Utility.compactClassName(str);
174         str = Utility.compactClassName(str, class_package + &quot;.&quot;, true);
175         return &quot;&lt;A HREF=\&quot;&quot; + class_name + &quot;_cp.html#cp&quot; + index + &quot;\&quot; TARGET=ConstantPool&gt;&quot; + str
176                 + &quot;&lt;/A&gt;&quot;;
177     }
178 
179     static String referenceType(final String type) {
180         String short_type = Utility.compactClassName(type);
181         short_type = Utility.compactClassName(short_type, class_package + &quot;.&quot;, true);
182         final int index = type.indexOf(&#39;[&#39;); // Type is an array?
183         String base_type = type;
184         if (index &gt; -1) {
185             base_type = type.substring(0, index); // Tack of the `[&#39;
186         }
187         // test for basic type
188         if (basic_types.contains(base_type)) {
189             return &quot;&lt;FONT COLOR=\&quot;#00FF00\&quot;&gt;&quot; + type + &quot;&lt;/FONT&gt;&quot;;
190         }
191         return &quot;&lt;A HREF=\&quot;&quot; + base_type + &quot;.html\&quot; TARGET=_top&gt;&quot; + short_type + &quot;&lt;/A&gt;&quot;;
192     }
193 
194     static String toHTML(final String str) {
195         final StringBuilder buf = new StringBuilder();
196         for (int i = 0; i &lt; str.length(); i++) {
197             char ch;
198             switch (ch = str.charAt(i)) {
199                 case &#39;&lt;&#39;:
200                     buf.append(&quot;&amp;lt;&quot;);
201                     break;
202                 case &#39;&gt;&#39;:
203                     buf.append(&quot;&amp;gt;&quot;);
204                     break;
205                 case &#39;\n&#39;:
206                     buf.append(&quot;\\n&quot;);
207                     break;
208                 case &#39;\r&#39;:
209                     buf.append(&quot;\\r&quot;);
210                     break;
211                 default:
212                     buf.append(ch);
213             }
214         }
215         return buf.toString();
216     }
217 
218     private void writeMainHTML(final AttributeHTML attribute_html) throws IOException {
219         try (PrintWriter file = new PrintWriter(new FileOutputStream(dir + class_name + &quot;.html&quot;))) {
220             file.println(&quot;&lt;HTML&gt;\n&quot; + &quot;&lt;HEAD&gt;&lt;TITLE&gt;Documentation for &quot; + class_name + &quot;&lt;/TITLE&gt;&quot; + &quot;&lt;/HEAD&gt;\n&quot;
221                     + &quot;&lt;FRAMESET BORDER=1 cols=\&quot;30%,*\&quot;&gt;\n&quot; + &quot;&lt;FRAMESET BORDER=1 rows=\&quot;80%,*\&quot;&gt;\n&quot;
222                     + &quot;&lt;FRAME NAME=\&quot;ConstantPool\&quot; SRC=\&quot;&quot; + class_name + &quot;_cp.html&quot; + &quot;\&quot;\n MARGINWIDTH=\&quot;0\&quot; &quot;
223                     + &quot;MARGINHEIGHT=\&quot;0\&quot; FRAMEBORDER=\&quot;1\&quot; SCROLLING=\&quot;AUTO\&quot;&gt;\n&quot; + &quot;&lt;FRAME NAME=\&quot;Attributes\&quot; SRC=\&quot;&quot;
224                     + class_name + &quot;_attributes.html&quot; + &quot;\&quot;\n MARGINWIDTH=\&quot;0\&quot; &quot;
225                     + &quot;MARGINHEIGHT=\&quot;0\&quot; FRAMEBORDER=\&quot;1\&quot; SCROLLING=\&quot;AUTO\&quot;&gt;\n&quot; + &quot;&lt;/FRAMESET&gt;\n&quot;
226                     + &quot;&lt;FRAMESET BORDER=1 rows=\&quot;80%,*\&quot;&gt;\n&quot; + &quot;&lt;FRAME NAME=\&quot;Code\&quot; SRC=\&quot;&quot; + class_name
227                     + &quot;_code.html\&quot;\n MARGINWIDTH=0 &quot; + &quot;MARGINHEIGHT=0 FRAMEBORDER=1 SCROLLING=\&quot;AUTO\&quot;&gt;\n&quot;
228                     + &quot;&lt;FRAME NAME=\&quot;Methods\&quot; SRC=\&quot;&quot; + class_name + &quot;_methods.html\&quot;\n MARGINWIDTH=0 &quot;
229                     + &quot;MARGINHEIGHT=0 FRAMEBORDER=1 SCROLLING=\&quot;AUTO\&quot;&gt;\n&quot; + &quot;&lt;/FRAMESET&gt;&lt;/FRAMESET&gt;&lt;/HTML&gt;&quot;);
230         }
231         final Attribute[] attributes = java_class.getAttributes();
232         for (int i = 0; i &lt; attributes.length; i++) {
233             attribute_html.writeAttribute(attributes[i], &quot;class&quot; + i);
234         }
235     }
236 }
    </pre>
  </body>
</html>