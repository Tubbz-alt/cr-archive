<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/SWITCH.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SWAP.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="Select.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/SWITCH.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9  * The ASF licenses this file to You under the Apache License, Version 2.0
 10  * (the &quot;License&quot;); you may not use this file except in compliance with
 11  * the License.  You may obtain a copy of the License at
 12  *
 13  *      http://www.apache.org/licenses/LICENSE-2.0
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.bcel.internal.generic;
 23 
 24 /**
 25  * SWITCH - Branch depending on int value, generates either LOOKUPSWITCH or
 26  * TABLESWITCH instruction, depending on whether the match values (int[]) can be
 27  * sorted with no gaps between the numbers.
 28  *
<span class="line-removed"> 29  * @version $Id: SWITCH.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
 30  */
 31 public final class SWITCH implements CompoundInstruction {
 32 
 33     private int[] match;
 34     private InstructionHandle[] targets;
 35     private Select instruction;
 36     private int match_length;
 37 
 38 
 39     /**
 40      * Template for switch() constructs. If the match array can be
 41      * sorted in ascending order with gaps no larger than max_gap
 42      * between the numbers, a TABLESWITCH instruction is generated, and
 43      * a LOOKUPSWITCH otherwise. The former may be more efficient, but
 44      * needs more space.
 45      *
 46      * Note, that the key array always will be sorted, though we leave
 47      * the original arrays unaltered.
 48      *
 49      * @param match array of match values (case 2: ... case 7: ..., etc.)
</pre>
<hr />
<pre>
 89                 count++;
 90             }
 91             m_vec[count] = match[i];
 92             t_vec[count] = targets[i];
 93             count++;
 94         }
 95         match = new int[count];
 96         targets = new InstructionHandle[count];
 97         System.arraycopy(m_vec, 0, match, 0, count);
 98         System.arraycopy(t_vec, 0, targets, 0, count);
 99     }
100 
101 
102     /**
103      * Sort match and targets array with QuickSort.
104      */
105     private void sort( final int l, final int r ) {
106         int i = l;
107         int j = r;
108         int h;
<span class="line-modified">109         final int m = match[(l + r) / 2];</span>
110         InstructionHandle h2;
111         do {
112             while (match[i] &lt; m) {
113                 i++;
114             }
115             while (m &lt; match[j]) {
116                 j--;
117             }
118             if (i &lt;= j) {
119                 h = match[i];
120                 match[i] = match[j];
121                 match[j] = h; // Swap elements
122                 h2 = targets[i];
123                 targets[i] = targets[j];
124                 targets[j] = h2; // Swap instructions, too
125                 i++;
126                 j--;
127             }
128         } while (i &lt;= j);
129         if (l &lt; j) {
</pre>
<hr />
<pre>
132         if (i &lt; r) {
133             sort(i, r);
134         }
135     }
136 
137 
138     /**
139      * @return match is sorted in ascending order with no gap bigger than max_gap?
140      */
141     private boolean matchIsOrdered( final int max_gap ) {
142         for (int i = 1; i &lt; match_length; i++) {
143             if (match[i] - match[i - 1] &gt; max_gap) {
144                 return false;
145             }
146         }
147         return true;
148     }
149 
150 
151     @Override
<span class="line-modified">152     public final InstructionList getInstructionList() {</span>
153         return new InstructionList(instruction);
154     }
155 
156 
<span class="line-modified">157     public final Instruction getInstruction() {</span>
158         return instruction;
159     }
160 }
</pre>
</td>
<td>
<hr />
<pre>
  9  * The ASF licenses this file to You under the Apache License, Version 2.0
 10  * (the &quot;License&quot;); you may not use this file except in compliance with
 11  * the License.  You may obtain a copy of the License at
 12  *
 13  *      http://www.apache.org/licenses/LICENSE-2.0
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 
 22 package com.sun.org.apache.bcel.internal.generic;
 23 
 24 /**
 25  * SWITCH - Branch depending on int value, generates either LOOKUPSWITCH or
 26  * TABLESWITCH instruction, depending on whether the match values (int[]) can be
 27  * sorted with no gaps between the numbers.
 28  *

 29  */
 30 public final class SWITCH implements CompoundInstruction {
 31 
 32     private int[] match;
 33     private InstructionHandle[] targets;
 34     private Select instruction;
 35     private int match_length;
 36 
 37 
 38     /**
 39      * Template for switch() constructs. If the match array can be
 40      * sorted in ascending order with gaps no larger than max_gap
 41      * between the numbers, a TABLESWITCH instruction is generated, and
 42      * a LOOKUPSWITCH otherwise. The former may be more efficient, but
 43      * needs more space.
 44      *
 45      * Note, that the key array always will be sorted, though we leave
 46      * the original arrays unaltered.
 47      *
 48      * @param match array of match values (case 2: ... case 7: ..., etc.)
</pre>
<hr />
<pre>
 88                 count++;
 89             }
 90             m_vec[count] = match[i];
 91             t_vec[count] = targets[i];
 92             count++;
 93         }
 94         match = new int[count];
 95         targets = new InstructionHandle[count];
 96         System.arraycopy(m_vec, 0, match, 0, count);
 97         System.arraycopy(t_vec, 0, targets, 0, count);
 98     }
 99 
100 
101     /**
102      * Sort match and targets array with QuickSort.
103      */
104     private void sort( final int l, final int r ) {
105         int i = l;
106         int j = r;
107         int h;
<span class="line-modified">108         final int m = match[(l + r) &gt;&gt;&gt; 1];</span>
109         InstructionHandle h2;
110         do {
111             while (match[i] &lt; m) {
112                 i++;
113             }
114             while (m &lt; match[j]) {
115                 j--;
116             }
117             if (i &lt;= j) {
118                 h = match[i];
119                 match[i] = match[j];
120                 match[j] = h; // Swap elements
121                 h2 = targets[i];
122                 targets[i] = targets[j];
123                 targets[j] = h2; // Swap instructions, too
124                 i++;
125                 j--;
126             }
127         } while (i &lt;= j);
128         if (l &lt; j) {
</pre>
<hr />
<pre>
131         if (i &lt; r) {
132             sort(i, r);
133         }
134     }
135 
136 
137     /**
138      * @return match is sorted in ascending order with no gap bigger than max_gap?
139      */
140     private boolean matchIsOrdered( final int max_gap ) {
141         for (int i = 1; i &lt; match_length; i++) {
142             if (match[i] - match[i - 1] &gt; max_gap) {
143                 return false;
144             }
145         }
146         return true;
147     }
148 
149 
150     @Override
<span class="line-modified">151     public InstructionList getInstructionList() {</span>
152         return new InstructionList(instruction);
153     }
154 
155 
<span class="line-modified">156     public Instruction getInstruction() {</span>
157         return instruction;
158     }
159 }
</pre>
</td>
</tr>
</table>
<center><a href="SWAP.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="Select.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>