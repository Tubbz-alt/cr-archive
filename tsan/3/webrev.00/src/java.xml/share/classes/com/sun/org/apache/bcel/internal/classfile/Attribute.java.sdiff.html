<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/Attribute.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Annotations.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AttributeReader.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/Attribute.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 package com.sun.org.apache.bcel.internal.classfile;
 21 
 22 import java.io.DataInput;
 23 import java.io.DataInputStream;
 24 import java.io.DataOutputStream;
 25 import java.io.IOException;
 26 import java.util.HashMap;
 27 import java.util.Map;
 28 
 29 import com.sun.org.apache.bcel.internal.Const;
 30 
 31 /**
 32  * Abstract super class for &lt;em&gt;Attribute&lt;/em&gt; objects. Currently the
 33  * &lt;em&gt;ConstantValue&lt;/em&gt;, &lt;em&gt;SourceFile&lt;/em&gt;, &lt;em&gt;Code&lt;/em&gt;,
 34  * &lt;em&gt;Exceptiontable&lt;/em&gt;, &lt;em&gt;LineNumberTable&lt;/em&gt;,
 35  * &lt;em&gt;LocalVariableTable&lt;/em&gt;, &lt;em&gt;InnerClasses&lt;/em&gt; and
 36  * &lt;em&gt;Synthetic&lt;/em&gt; attributes are supported. The &lt;em&gt;Unknown&lt;/em&gt;
 37  * attribute stands for non-standard-attributes.
 38  *
<span class="line-removed"> 39  * @version $Id: Attribute.java 1750029 2016-06-23 22:14:38Z sebb $</span>
 40  * @see ConstantValue
 41  * @see SourceFile
 42  * @see Code
 43  * @see Unknown
 44  * @see ExceptionTable
 45  * @see LineNumberTable
 46  * @see LocalVariableTable
 47  * @see InnerClasses
 48  * @see Synthetic
 49  * @see Deprecated
 50  * @see Signature

 51  */
 52 public abstract class Attribute implements Cloneable, Node {
<span class="line-modified"> 53 </span>
 54     private int name_index; // Points to attribute name in constant pool
 55     private int length; // Content length of attribute field
 56     private final byte tag; // Tag to distinguish subclasses
 57     private ConstantPool constant_pool;
 58 
<span class="line-removed"> 59     protected Attribute(final byte tag, final int name_index, final int length, final ConstantPool constant_pool) {</span>
<span class="line-removed"> 60         this.tag = tag;</span>
<span class="line-removed"> 61         this.name_index = name_index;</span>
<span class="line-removed"> 62         this.length = length;</span>
<span class="line-removed"> 63         this.constant_pool = constant_pool;</span>
<span class="line-removed"> 64     }</span>
<span class="line-removed"> 65 </span>
<span class="line-removed"> 66     /**</span>
<span class="line-removed"> 67      * Called by objects that are traversing the nodes of the tree implicitely</span>
<span class="line-removed"> 68      * defined by the contents of a Java class. I.e., the hierarchy of methods,</span>
<span class="line-removed"> 69      * fields, attributes, etc. spawns a tree of objects.</span>
<span class="line-removed"> 70      *</span>
<span class="line-removed"> 71      * @param v Visitor object</span>
<span class="line-removed"> 72      */</span>
<span class="line-removed"> 73     @Override</span>
<span class="line-removed"> 74     public abstract void accept(Visitor v);</span>
<span class="line-removed"> 75 </span>
<span class="line-removed"> 76     /**</span>
<span class="line-removed"> 77      * Dump attribute to file stream in binary format.</span>
<span class="line-removed"> 78      *</span>
<span class="line-removed"> 79      * @param file Output file stream</span>
<span class="line-removed"> 80      * @throws IOException</span>
<span class="line-removed"> 81      */</span>
<span class="line-removed"> 82     public void dump(final DataOutputStream file) throws IOException {</span>
<span class="line-removed"> 83         file.writeShort(name_index);</span>
<span class="line-removed"> 84         file.writeInt(length);</span>
<span class="line-removed"> 85     }</span>
<span class="line-removed"> 86 </span>
 87     private static final Map&lt;String, Object&gt; readers = new HashMap&lt;&gt;();
 88 
 89     /**
 90      * Add an Attribute reader capable of parsing (user-defined) attributes
 91      * named &quot;name&quot;. You should not add readers for the standard attributes such
 92      * as &quot;LineNumberTable&quot;, because those are handled internally.
 93      *
 94      * @param name the name of the attribute as stored in the class file
<span class="line-modified"> 95      * @param r the reader object</span>
 96      */
<span class="line-modified"> 97     public static void addAttributeReader(final String name, final UnknownAttributeReader r) {</span>

 98         readers.put(name, r);
 99     }
100 
<span class="line-modified">101     /**</span>
<span class="line-modified">102      * Remove attribute reader</span>
<span class="line-modified">103      *</span>
<span class="line-modified">104      * @param name the name of the attribute as stored in the class file</span>
<span class="line-removed">105      */</span>
<span class="line-removed">106     public static void removeAttributeReader(final String name) {</span>
<span class="line-removed">107         readers.remove(name);</span>
<span class="line-removed">108     }</span>
<span class="line-removed">109 </span>
<span class="line-removed">110     /**</span>
<span class="line-removed">111      * Class method reads one attribute from the input data stream. This method</span>
<span class="line-removed">112      * must not be accessible from the outside. It is called by the Field and</span>
<span class="line-removed">113      * Method constructor methods.</span>
<span class="line-removed">114      *</span>
<span class="line-removed">115      * @see Field</span>
<span class="line-removed">116      * @see Method</span>
<span class="line-removed">117      *</span>
<span class="line-removed">118      * @param file Input stream</span>
<span class="line-removed">119      * @param constant_pool Array of constants</span>
<span class="line-removed">120      * @return Attribute</span>
<span class="line-removed">121      * @throws IOException</span>
<span class="line-removed">122      * @throws ClassFormatException</span>
<span class="line-removed">123      */</span>
<span class="line-removed">124     public static Attribute readAttribute(final DataInputStream file, final ConstantPool constant_pool)</span>
<span class="line-removed">125             throws IOException, ClassFormatException {</span>
<span class="line-removed">126         return readAttribute((DataInput) file, constant_pool);</span>
127     }
128 
129     /**
130      * Class method reads one attribute from the input data stream. This method
131      * must not be accessible from the outside. It is called by the Field and
132      * Method constructor methods.
133      *
134      * @see Field
135      * @see Method
136      *
137      * @param file Input stream
138      * @param constant_pool Array of constants
139      * @return Attribute
140      * @throws IOException
141      * @throws ClassFormatException
142      * @since 6.0
143      */
144     public static Attribute readAttribute(final DataInput file, final ConstantPool constant_pool)
<span class="line-modified">145             throws IOException, ClassFormatException {</span>

146         byte tag = Const.ATTR_UNKNOWN; // Unknown attribute
147         // Get class name from constant pool via `name_index&#39; indirection
148         final int name_index = file.readUnsignedShort();
149         final ConstantUtf8 c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);
150         final String name = c.getBytes();
151 
152         // Length of data in bytes
153         final int length = file.readInt();
154 
155         // Compare strings to find known attribute
<span class="line-modified">156         for (byte i = 0; i &lt; Const.KNOWN_ATTRIBUTES; i++) {</span>
<span class="line-modified">157             if (name.equals(Const.getAttributeName(i))) {</span>


158                 tag = i; // found!
159                 break;
160             }
161         }
162 
163         // Call proper constructor, depending on `tag&#39;
<span class="line-modified">164         switch (tag) {</span>

165             case Const.ATTR_UNKNOWN:
166                 final Object r = readers.get(name);
<span class="line-modified">167                 if (r instanceof UnknownAttributeReader) {</span>

168                     return ((UnknownAttributeReader) r).createAttribute(name_index, length, file, constant_pool);
169                 }
170                 return new Unknown(name_index, length, file, constant_pool);
171             case Const.ATTR_CONSTANT_VALUE:
172                 return new ConstantValue(name_index, length, file, constant_pool);
173             case Const.ATTR_SOURCE_FILE:
174                 return new SourceFile(name_index, length, file, constant_pool);
175             case Const.ATTR_CODE:
176                 return new Code(name_index, length, file, constant_pool);
177             case Const.ATTR_EXCEPTIONS:
178                 return new ExceptionTable(name_index, length, file, constant_pool);
179             case Const.ATTR_LINE_NUMBER_TABLE:
180                 return new LineNumberTable(name_index, length, file, constant_pool);
181             case Const.ATTR_LOCAL_VARIABLE_TABLE:
182                 return new LocalVariableTable(name_index, length, file, constant_pool);
183             case Const.ATTR_INNER_CLASSES:
184                 return new InnerClasses(name_index, length, file, constant_pool);
185             case Const.ATTR_SYNTHETIC:
186                 return new Synthetic(name_index, length, file, constant_pool);
187             case Const.ATTR_DEPRECATED:
188                 return new Deprecated(name_index, length, file, constant_pool);
189             case Const.ATTR_PMG:
190                 return new PMGClass(name_index, length, file, constant_pool);
191             case Const.ATTR_SIGNATURE:
192                 return new Signature(name_index, length, file, constant_pool);
193             case Const.ATTR_STACK_MAP:
<span class="line-modified">194                 return new StackMap(name_index, length, file, constant_pool);</span>



195             case Const.ATTR_RUNTIME_VISIBLE_ANNOTATIONS:
196                 return new RuntimeVisibleAnnotations(name_index, length, file, constant_pool);
197             case Const.ATTR_RUNTIME_INVISIBLE_ANNOTATIONS:
198                 return new RuntimeInvisibleAnnotations(name_index, length, file, constant_pool);
199             case Const.ATTR_RUNTIME_VISIBLE_PARAMETER_ANNOTATIONS:
200                 return new RuntimeVisibleParameterAnnotations(name_index, length, file, constant_pool);
201             case Const.ATTR_RUNTIME_INVISIBLE_PARAMETER_ANNOTATIONS:
202                 return new RuntimeInvisibleParameterAnnotations(name_index, length, file, constant_pool);
203             case Const.ATTR_ANNOTATION_DEFAULT:
204                 return new AnnotationDefault(name_index, length, file, constant_pool);
205             case Const.ATTR_LOCAL_VARIABLE_TYPE_TABLE:
206                 return new LocalVariableTypeTable(name_index, length, file, constant_pool);
207             case Const.ATTR_ENCLOSING_METHOD:
208                 return new EnclosingMethod(name_index, length, file, constant_pool);
209             case Const.ATTR_STACK_MAP_TABLE:


210                 return new StackMap(name_index, length, file, constant_pool);
211             case Const.ATTR_BOOTSTRAP_METHODS:
212                 return new BootstrapMethods(name_index, length, file, constant_pool);
213             case Const.ATTR_METHOD_PARAMETERS:
214                 return new MethodParameters(name_index, length, file, constant_pool);










215             default:
216                 // Never reached
217                 throw new IllegalStateException(&quot;Unrecognized attribute type tag parsed: &quot; + tag);
218         }
219     }
220 
221     /**
<span class="line-modified">222      * @return Name of attribute</span>
<span class="line-modified">223      * @since 6.0</span>










224      */
<span class="line-modified">225     public String getName() {</span>
<span class="line-modified">226         final ConstantUtf8 c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);</span>
<span class="line-modified">227         return c.getBytes();</span>

228     }
229 
230     /**
<span class="line-modified">231      * @return Length of attribute field in bytes.</span>


232      */
<span class="line-modified">233     public final int getLength() {</span>
<span class="line-modified">234         return length;</span>

235     }
236 
<span class="line-modified">237     /**</span>
<span class="line-modified">238      * @param length length in bytes.</span>
<span class="line-modified">239      */</span>
<span class="line-modified">240     public final void setLength(final int length) {</span>
241         this.length = length;

242     }
243 
244     /**
<span class="line-modified">245      * @param name_index of attribute.</span>





246      */
<span class="line-modified">247     public final void setNameIndex(final int name_index) {</span>
<span class="line-modified">248         this.name_index = name_index;</span>
<span class="line-removed">249     }</span>
250 
251     /**
<span class="line-modified">252      * @return Name index in constant pool of attribute name.</span>



253      */
<span class="line-modified">254     public final int getNameIndex() {</span>
<span class="line-modified">255         return name_index;</span>











256     }
257 
258     /**
<span class="line-modified">259      * @return Tag of attribute, i.e., its type. Value may not be altered, thus</span>
<span class="line-removed">260      * there is no setTag() method.</span>
261      */
<span class="line-modified">262     public final byte getTag() {</span>
<span class="line-modified">263         return tag;</span>











264     }
265 
266     /**
267      * @return Constant pool used by this object.
268      * @see ConstantPool
269      */
<span class="line-modified">270     public final ConstantPool getConstantPool() {</span>

271         return constant_pool;
272     }
273 


































274     /**
275      * @param constant_pool Constant pool to be used for this object.
276      * @see ConstantPool
277      */
<span class="line-modified">278     public final void setConstantPool(final ConstantPool constant_pool) {</span>

279         this.constant_pool = constant_pool;
280     }
281 
282     /**
<span class="line-modified">283      * Use copy() if you want to have a deep copy(), i.e., with all references</span>
<span class="line-removed">284      * copied correctly.</span>
<span class="line-removed">285      *</span>
<span class="line-removed">286      * @return shallow copy of this attribute</span>
287      */
<span class="line-modified">288     @Override</span>
<span class="line-modified">289     public Object clone() {</span>
<span class="line-modified">290         Attribute attr = null;</span>
<span class="line-removed">291         try {</span>
<span class="line-removed">292             attr = (Attribute) super.clone();</span>
<span class="line-removed">293         } catch (final CloneNotSupportedException e) {</span>
<span class="line-removed">294             throw new Error(&quot;Clone Not Supported&quot;); // never happens</span>
<span class="line-removed">295         }</span>
<span class="line-removed">296         return attr;</span>
297     }
298 
299     /**
<span class="line-modified">300      * @return deep copy of this attribute</span>
301      */
<span class="line-modified">302     public abstract Attribute copy(ConstantPool _constant_pool);</span>



303 
304     /**
305      * @return attribute name.
306      */
307     @Override
<span class="line-modified">308     public String toString() {</span>

309         return Const.getAttributeName(tag);
310     }
311 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 package com.sun.org.apache.bcel.internal.classfile;
 21 
 22 import java.io.DataInput;
 23 import java.io.DataInputStream;
 24 import java.io.DataOutputStream;
 25 import java.io.IOException;
 26 import java.util.HashMap;
 27 import java.util.Map;
 28 
 29 import com.sun.org.apache.bcel.internal.Const;
 30 
 31 /**
 32  * Abstract super class for &lt;em&gt;Attribute&lt;/em&gt; objects. Currently the
 33  * &lt;em&gt;ConstantValue&lt;/em&gt;, &lt;em&gt;SourceFile&lt;/em&gt;, &lt;em&gt;Code&lt;/em&gt;,
 34  * &lt;em&gt;Exceptiontable&lt;/em&gt;, &lt;em&gt;LineNumberTable&lt;/em&gt;,
 35  * &lt;em&gt;LocalVariableTable&lt;/em&gt;, &lt;em&gt;InnerClasses&lt;/em&gt; and
 36  * &lt;em&gt;Synthetic&lt;/em&gt; attributes are supported. The &lt;em&gt;Unknown&lt;/em&gt;
 37  * attribute stands for non-standard-attributes.
 38  *

 39  * @see ConstantValue
 40  * @see SourceFile
 41  * @see Code
 42  * @see Unknown
 43  * @see ExceptionTable
 44  * @see LineNumberTable
 45  * @see LocalVariableTable
 46  * @see InnerClasses
 47  * @see Synthetic
 48  * @see Deprecated
 49  * @see Signature
<span class="line-added"> 50  * @LastModified: Jan 2020</span>
 51  */
 52 public abstract class Attribute implements Cloneable, Node {
<span class="line-modified"> 53     private static final boolean debug = false;</span>
 54     private int name_index; // Points to attribute name in constant pool
 55     private int length; // Content length of attribute field
 56     private final byte tag; // Tag to distinguish subclasses
 57     private ConstantPool constant_pool;
 58 




























 59     private static final Map&lt;String, Object&gt; readers = new HashMap&lt;&gt;();
 60 
 61     /**
 62      * Add an Attribute reader capable of parsing (user-defined) attributes
 63      * named &quot;name&quot;. You should not add readers for the standard attributes such
 64      * as &quot;LineNumberTable&quot;, because those are handled internally.
 65      *
 66      * @param name the name of the attribute as stored in the class file
<span class="line-modified"> 67      * @param r    the reader object</span>
 68      */
<span class="line-modified"> 69     public static void addAttributeReader(final String name, final UnknownAttributeReader r)</span>
<span class="line-added"> 70     {</span>
 71         readers.put(name, r);
 72     }
 73 
<span class="line-modified"> 74     protected static void println(final String msg) {</span>
<span class="line-modified"> 75         if (debug) {</span>
<span class="line-modified"> 76             System.err.println(msg);</span>
<span class="line-modified"> 77         }</span>






















 78     }
 79 
 80     /**
 81      * Class method reads one attribute from the input data stream. This method
 82      * must not be accessible from the outside. It is called by the Field and
 83      * Method constructor methods.
 84      *
 85      * @see Field
 86      * @see Method
 87      *
 88      * @param file Input stream
 89      * @param constant_pool Array of constants
 90      * @return Attribute
 91      * @throws IOException
 92      * @throws ClassFormatException
 93      * @since 6.0
 94      */
 95     public static Attribute readAttribute(final DataInput file, final ConstantPool constant_pool)
<span class="line-modified"> 96             throws IOException, ClassFormatException</span>
<span class="line-added"> 97     {</span>
 98         byte tag = Const.ATTR_UNKNOWN; // Unknown attribute
 99         // Get class name from constant pool via `name_index&#39; indirection
100         final int name_index = file.readUnsignedShort();
101         final ConstantUtf8 c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);
102         final String name = c.getBytes();
103 
104         // Length of data in bytes
105         final int length = file.readInt();
106 
107         // Compare strings to find known attribute
<span class="line-modified">108         for (byte i = 0; i &lt; Const.KNOWN_ATTRIBUTES; i++)</span>
<span class="line-modified">109         {</span>
<span class="line-added">110             if (name.equals(Const.getAttributeName(i)))</span>
<span class="line-added">111             {</span>
112                 tag = i; // found!
113                 break;
114             }
115         }
116 
117         // Call proper constructor, depending on `tag&#39;
<span class="line-modified">118         switch (tag)</span>
<span class="line-added">119         {</span>
120             case Const.ATTR_UNKNOWN:
121                 final Object r = readers.get(name);
<span class="line-modified">122                 if (r instanceof UnknownAttributeReader)</span>
<span class="line-added">123                 {</span>
124                     return ((UnknownAttributeReader) r).createAttribute(name_index, length, file, constant_pool);
125                 }
126                 return new Unknown(name_index, length, file, constant_pool);
127             case Const.ATTR_CONSTANT_VALUE:
128                 return new ConstantValue(name_index, length, file, constant_pool);
129             case Const.ATTR_SOURCE_FILE:
130                 return new SourceFile(name_index, length, file, constant_pool);
131             case Const.ATTR_CODE:
132                 return new Code(name_index, length, file, constant_pool);
133             case Const.ATTR_EXCEPTIONS:
134                 return new ExceptionTable(name_index, length, file, constant_pool);
135             case Const.ATTR_LINE_NUMBER_TABLE:
136                 return new LineNumberTable(name_index, length, file, constant_pool);
137             case Const.ATTR_LOCAL_VARIABLE_TABLE:
138                 return new LocalVariableTable(name_index, length, file, constant_pool);
139             case Const.ATTR_INNER_CLASSES:
140                 return new InnerClasses(name_index, length, file, constant_pool);
141             case Const.ATTR_SYNTHETIC:
142                 return new Synthetic(name_index, length, file, constant_pool);
143             case Const.ATTR_DEPRECATED:
144                 return new Deprecated(name_index, length, file, constant_pool);
145             case Const.ATTR_PMG:
146                 return new PMGClass(name_index, length, file, constant_pool);
147             case Const.ATTR_SIGNATURE:
148                 return new Signature(name_index, length, file, constant_pool);
149             case Const.ATTR_STACK_MAP:
<span class="line-modified">150                 // old style stack map: unneeded for JDK5 and below;</span>
<span class="line-added">151                 // illegal(?) for JDK6 and above.  So just delete with a warning.</span>
<span class="line-added">152                 println(&quot;Warning: Obsolete StackMap attribute ignored.&quot;);</span>
<span class="line-added">153                 return new Unknown(name_index, length, file, constant_pool);</span>
154             case Const.ATTR_RUNTIME_VISIBLE_ANNOTATIONS:
155                 return new RuntimeVisibleAnnotations(name_index, length, file, constant_pool);
156             case Const.ATTR_RUNTIME_INVISIBLE_ANNOTATIONS:
157                 return new RuntimeInvisibleAnnotations(name_index, length, file, constant_pool);
158             case Const.ATTR_RUNTIME_VISIBLE_PARAMETER_ANNOTATIONS:
159                 return new RuntimeVisibleParameterAnnotations(name_index, length, file, constant_pool);
160             case Const.ATTR_RUNTIME_INVISIBLE_PARAMETER_ANNOTATIONS:
161                 return new RuntimeInvisibleParameterAnnotations(name_index, length, file, constant_pool);
162             case Const.ATTR_ANNOTATION_DEFAULT:
163                 return new AnnotationDefault(name_index, length, file, constant_pool);
164             case Const.ATTR_LOCAL_VARIABLE_TYPE_TABLE:
165                 return new LocalVariableTypeTable(name_index, length, file, constant_pool);
166             case Const.ATTR_ENCLOSING_METHOD:
167                 return new EnclosingMethod(name_index, length, file, constant_pool);
168             case Const.ATTR_STACK_MAP_TABLE:
<span class="line-added">169                 // read new style stack map: StackMapTable.  The rest of the code</span>
<span class="line-added">170                 // calls this a StackMap for historical reasons.</span>
171                 return new StackMap(name_index, length, file, constant_pool);
172             case Const.ATTR_BOOTSTRAP_METHODS:
173                 return new BootstrapMethods(name_index, length, file, constant_pool);
174             case Const.ATTR_METHOD_PARAMETERS:
175                 return new MethodParameters(name_index, length, file, constant_pool);
<span class="line-added">176             case Const.ATTR_MODULE:</span>
<span class="line-added">177                 return new Module(name_index, length, file, constant_pool);</span>
<span class="line-added">178             case Const.ATTR_MODULE_PACKAGES:</span>
<span class="line-added">179                 return new ModulePackages(name_index, length, file, constant_pool);</span>
<span class="line-added">180             case Const.ATTR_MODULE_MAIN_CLASS:</span>
<span class="line-added">181                 return new ModuleMainClass(name_index, length, file, constant_pool);</span>
<span class="line-added">182             case Const.ATTR_NEST_HOST:</span>
<span class="line-added">183                 return new NestHost(name_index, length, file, constant_pool);</span>
<span class="line-added">184             case Const.ATTR_NEST_MEMBERS:</span>
<span class="line-added">185                 return new NestMembers(name_index, length, file, constant_pool);</span>
186             default:
187                 // Never reached
188                 throw new IllegalStateException(&quot;Unrecognized attribute type tag parsed: &quot; + tag);
189         }
190     }
191 
192     /**
<span class="line-modified">193      * Class method reads one attribute from the input data stream. This method</span>
<span class="line-modified">194      * must not be accessible from the outside. It is called by the Field and</span>
<span class="line-added">195      * Method constructor methods.</span>
<span class="line-added">196      *</span>
<span class="line-added">197      * @see Field</span>
<span class="line-added">198      * @see Method</span>
<span class="line-added">199      *</span>
<span class="line-added">200      * @param file Input stream</span>
<span class="line-added">201      * @param constant_pool Array of constants</span>
<span class="line-added">202      * @return Attribute</span>
<span class="line-added">203      * @throws IOException</span>
<span class="line-added">204      * @throws ClassFormatException</span>
205      */
<span class="line-modified">206     public static Attribute readAttribute(final DataInputStream file, final ConstantPool constant_pool)</span>
<span class="line-modified">207             throws IOException, ClassFormatException</span>
<span class="line-modified">208     {</span>
<span class="line-added">209         return readAttribute((DataInput) file, constant_pool);</span>
210     }
211 
212     /**
<span class="line-modified">213      * Remove attribute reader</span>
<span class="line-added">214      *</span>
<span class="line-added">215      * @param name the name of the attribute as stored in the class file</span>
216      */
<span class="line-modified">217     public static void removeAttributeReader(final String name)</span>
<span class="line-modified">218     {</span>
<span class="line-added">219         readers.remove(name);</span>
220     }
221 
<span class="line-modified">222     protected Attribute(final byte tag, final int name_index, final int length, final ConstantPool constant_pool)</span>
<span class="line-modified">223     {</span>
<span class="line-modified">224         this.tag = tag;</span>
<span class="line-modified">225         this.name_index = name_index;</span>
226         this.length = length;
<span class="line-added">227         this.constant_pool = constant_pool;</span>
228     }
229 
230     /**
<span class="line-modified">231      * Called by objects that are traversing the nodes of the tree implicitely</span>
<span class="line-added">232      * defined by the contents of a Java class. I.e., the hierarchy of methods,</span>
<span class="line-added">233      * fields, attributes, etc. spawns a tree of objects.</span>
<span class="line-added">234      *</span>
<span class="line-added">235      * @param v</span>
<span class="line-added">236      *            Visitor object</span>
237      */
<span class="line-modified">238     @Override</span>
<span class="line-modified">239     public abstract void accept(Visitor v);</span>

240 
241     /**
<span class="line-modified">242      * Use copy() if you want to have a deep copy(), i.e., with all references</span>
<span class="line-added">243      * copied correctly.</span>
<span class="line-added">244      *</span>
<span class="line-added">245      * @return shallow copy of this attribute</span>
246      */
<span class="line-modified">247     @Override</span>
<span class="line-modified">248     public Object clone()</span>
<span class="line-added">249     {</span>
<span class="line-added">250         Attribute attr = null;</span>
<span class="line-added">251         try</span>
<span class="line-added">252         {</span>
<span class="line-added">253             attr = (Attribute) super.clone();</span>
<span class="line-added">254         }</span>
<span class="line-added">255         catch (final CloneNotSupportedException e)</span>
<span class="line-added">256         {</span>
<span class="line-added">257             throw new Error(&quot;Clone Not Supported&quot;); // never happens</span>
<span class="line-added">258         }</span>
<span class="line-added">259         return attr;</span>
260     }
261 
262     /**
<span class="line-modified">263      * @return deep copy of this attribute</span>

264      */
<span class="line-modified">265     public abstract Attribute copy(ConstantPool _constant_pool);</span>
<span class="line-modified">266 </span>
<span class="line-added">267     /**</span>
<span class="line-added">268      * Dump attribute to file stream in binary format.</span>
<span class="line-added">269      *</span>
<span class="line-added">270      * @param file</span>
<span class="line-added">271      *            Output file stream</span>
<span class="line-added">272      * @throws IOException</span>
<span class="line-added">273      */</span>
<span class="line-added">274     public void dump(final DataOutputStream file) throws IOException</span>
<span class="line-added">275     {</span>
<span class="line-added">276         file.writeShort(name_index);</span>
<span class="line-added">277         file.writeInt(length);</span>
278     }
279 
280     /**
281      * @return Constant pool used by this object.
282      * @see ConstantPool
283      */
<span class="line-modified">284     public final ConstantPool getConstantPool()</span>
<span class="line-added">285     {</span>
286         return constant_pool;
287     }
288 
<span class="line-added">289     /**</span>
<span class="line-added">290      * @return Length of attribute field in bytes.</span>
<span class="line-added">291      */</span>
<span class="line-added">292     public final int getLength()</span>
<span class="line-added">293     {</span>
<span class="line-added">294         return length;</span>
<span class="line-added">295     }</span>
<span class="line-added">296 </span>
<span class="line-added">297     /**</span>
<span class="line-added">298      * @return Name of attribute</span>
<span class="line-added">299      * @since 6.0</span>
<span class="line-added">300      */</span>
<span class="line-added">301     public String getName()</span>
<span class="line-added">302     {</span>
<span class="line-added">303         final ConstantUtf8 c = (ConstantUtf8) constant_pool.getConstant(name_index, Const.CONSTANT_Utf8);</span>
<span class="line-added">304         return c.getBytes();</span>
<span class="line-added">305     }</span>
<span class="line-added">306 </span>
<span class="line-added">307     /**</span>
<span class="line-added">308      * @return Name index in constant pool of attribute name.</span>
<span class="line-added">309      */</span>
<span class="line-added">310     public final int getNameIndex()</span>
<span class="line-added">311     {</span>
<span class="line-added">312         return name_index;</span>
<span class="line-added">313     }</span>
<span class="line-added">314 </span>
<span class="line-added">315     /**</span>
<span class="line-added">316      * @return Tag of attribute, i.e., its type. Value may not be altered, thus there is no setTag() method.</span>
<span class="line-added">317      */</span>
<span class="line-added">318     public final byte getTag()</span>
<span class="line-added">319     {</span>
<span class="line-added">320         return tag;</span>
<span class="line-added">321     }</span>
<span class="line-added">322 </span>
323     /**
324      * @param constant_pool Constant pool to be used for this object.
325      * @see ConstantPool
326      */
<span class="line-modified">327     public final void setConstantPool(final ConstantPool constant_pool)</span>
<span class="line-added">328     {</span>
329         this.constant_pool = constant_pool;
330     }
331 
332     /**
<span class="line-modified">333      * @param length length in bytes.</span>



334      */
<span class="line-modified">335     public final void setLength(final int length)</span>
<span class="line-modified">336     {</span>
<span class="line-modified">337         this.length = length;</span>






338     }
339 
340     /**
<span class="line-modified">341      * @param name_index of attribute.</span>
342      */
<span class="line-modified">343     public final void setNameIndex(final int name_index)</span>
<span class="line-added">344     {</span>
<span class="line-added">345         this.name_index = name_index;</span>
<span class="line-added">346     }</span>
347 
348     /**
349      * @return attribute name.
350      */
351     @Override
<span class="line-modified">352     public String toString()</span>
<span class="line-added">353     {</span>
354         return Const.getAttributeName(tag);
355     }
356 }
</pre>
</td>
</tr>
</table>
<center><a href="Annotations.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="AttributeReader.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>