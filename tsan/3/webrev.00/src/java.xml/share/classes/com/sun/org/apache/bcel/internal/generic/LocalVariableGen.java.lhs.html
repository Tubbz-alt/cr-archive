<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/LocalVariableGen.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /*
  6  * Licensed to the Apache Software Foundation (ASF) under one or more
  7  * contributor license agreements.  See the NOTICE file distributed with
  8  * this work for additional information regarding copyright ownership.
  9  * The ASF licenses this file to You under the Apache License, Version 2.0
 10  * (the &quot;License&quot;); you may not use this file except in compliance with
 11  * the License.  You may obtain a copy of the License at
 12  *
 13  *      http://www.apache.org/licenses/LICENSE-2.0
 14  *
 15  * Unless required by applicable law or agreed to in writing, software
 16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 18  * See the License for the specific language governing permissions and
 19  * limitations under the License.
 20  */
 21 package com.sun.org.apache.bcel.internal.generic;
 22 
 23 import com.sun.org.apache.bcel.internal.Const;
 24 import com.sun.org.apache.bcel.internal.classfile.LocalVariable;
 25 
 26 /**
<a name="1" id="anc1"></a><span class="line-modified"> 27  * This class represents a local variable within a method. It contains its</span>
<span class="line-modified"> 28  * scope, name and type. The generated LocalVariable object can be obtained with</span>
<span class="line-modified"> 29  * getLocalVariable which needs the instruction list and the constant pool as</span>
<span class="line-modified"> 30  * parameters.</span>
 31  *
<a name="2" id="anc2"></a><span class="line-modified"> 32  * @version $Id: LocalVariableGen.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
<span class="line-modified"> 33  * @see LocalVariable</span>
<span class="line-removed"> 34  * @see MethodGen</span>
 35  */
 36 public class LocalVariableGen implements InstructionTargeter, NamedAndTyped, Cloneable {
 37 
 38     private int index;
 39     private String name;
 40     private Type type;
 41     private InstructionHandle start;
 42     private InstructionHandle end;
<a name="3" id="anc3"></a>


 43 
 44     /**
<a name="4" id="anc4"></a><span class="line-modified"> 45      * Generate a local variable that with index `index&#39;. Note that double and</span>
<span class="line-modified"> 46      * long variables need two indexs. Index indices have to be provided by the</span>
<span class="line-removed"> 47      * user.</span>
 48      *
 49      * @param index index of local variable
 50      * @param name its name
 51      * @param type its type
<a name="5" id="anc5"></a><span class="line-modified"> 52      * @param start from where the instruction is valid (null means from the</span>
<span class="line-removed"> 53      * start)</span>
 54      * @param end until where the instruction is valid (null means to the end)
 55      */
<a name="6" id="anc6"></a><span class="line-modified"> 56     public LocalVariableGen(final int index, final String name, final Type type,</span>
<span class="line-modified"> 57             final InstructionHandle start, final InstructionHandle end) {</span>
 58         if ((index &lt; 0) || (index &gt; Const.MAX_SHORT)) {
 59             throw new ClassGenException(&quot;Invalid index index: &quot; + index);
 60         }
 61         this.name = name;
 62         this.type = type;
 63         this.index = index;
 64         setStart(start);
 65         setEnd(end);
<a name="7" id="anc7"></a>



















 66     }
 67 
<a name="8" id="anc8"></a>
 68     /**
<a name="9" id="anc9"></a><span class="line-modified"> 69      * Get LocalVariable object.</span>
 70      *
<a name="10" id="anc10"></a><span class="line-modified"> 71      * This relies on that the instruction list has already been dumped to byte</span>
<span class="line-modified"> 72      * code or or that the `setPositions&#39; methods has been called for the</span>
<span class="line-removed"> 73      * instruction list.</span>
 74      *
<a name="11" id="anc11"></a><span class="line-modified"> 75      * Note that for local variables whose scope end at the last instruction of</span>
<span class="line-modified"> 76      * the method&#39;s code, the JVM specification is ambiguous: both a</span>
<span class="line-modified"> 77      * start_pc+length ending at the last instruction and start_pc+length ending</span>
<span class="line-modified"> 78      * at first index beyond the end of the code are valid.</span>

 79      *
 80      * @param cp constant pool
 81      */
<a name="12" id="anc12"></a><span class="line-modified"> 82     public LocalVariable getLocalVariable(final ConstantPoolGen cp) {</span>
 83         int start_pc = 0;
 84         int length = 0;
 85         if ((start != null) &amp;&amp; (end != null)) {
 86             start_pc = start.getPosition();
 87             length = end.getPosition() - start_pc;
<a name="13" id="anc13"></a><span class="line-modified"> 88             if (end.getNext() == null) {</span>
 89                 length += end.getInstruction().getLength();
 90             }
 91         }
 92         final int name_index = cp.addUtf8(name);
 93         final int signature_index = cp.addUtf8(type.getSignature());
 94         return new LocalVariable(start_pc, length, name_index, signature_index, index, cp
<a name="14" id="anc14"></a><span class="line-modified"> 95                 .getConstantPool());</span>
 96     }
 97 
<a name="15" id="anc15"></a><span class="line-modified"> 98     public void setIndex(final int index) {</span>

 99         this.index = index;
100     }
101 
<a name="16" id="anc16"></a>
102     public int getIndex() {
103         return index;
104     }
105 
<a name="17" id="anc17"></a>















106     @Override
<a name="18" id="anc18"></a><span class="line-modified">107     public void setName(final String name) {</span>
108         this.name = name;
109     }
110 
<a name="19" id="anc19"></a>
111     @Override
112     public String getName() {
113         return name;
114     }
115 
<a name="20" id="anc20"></a>
116     @Override
<a name="21" id="anc21"></a><span class="line-modified">117     public void setType(final Type type) {</span>
118         this.type = type;
119     }
120 
<a name="22" id="anc22"></a>
121     @Override
122     public Type getType() {
123         return type;
124     }
125 
<a name="23" id="anc23"></a>
126     public InstructionHandle getStart() {
127         return start;
128     }
129 
<a name="24" id="anc24"></a>
130     public InstructionHandle getEnd() {
131         return end;
132     }
133 
<a name="25" id="anc25"></a><span class="line-modified">134     public void setStart(final InstructionHandle start) { // TODO could be package-protected?</span>

135         BranchInstruction.notifyTarget(this.start, start, this);
136         this.start = start;
137     }
138 
<a name="26" id="anc26"></a><span class="line-modified">139     public void setEnd(final InstructionHandle end) { // TODO could be package-protected?</span>

140         BranchInstruction.notifyTarget(this.end, end, this);
141         this.end = end;
142     }
143 
<a name="27" id="anc27"></a>
144     /**
145      * @param old_ih old target, either start or end
146      * @param new_ih new target
147      */
148     @Override
<a name="28" id="anc28"></a><span class="line-modified">149     public void updateTarget(final InstructionHandle old_ih, final InstructionHandle new_ih) {</span>
150         boolean targeted = false;
151         if (start == old_ih) {
152             targeted = true;
153             setStart(new_ih);
154         }
155         if (end == old_ih) {
156             targeted = true;
157             setEnd(new_ih);
158         }
159         if (!targeted) {
160             throw new ClassGenException(&quot;Not targeting &quot; + old_ih + &quot;, but {&quot; + start + &quot;, &quot; + end
161                     + &quot;}&quot;);
162         }
163     }
164 
165     /**
166      * Clear the references from and to this variable when it&#39;s removed.
167      */
168     void dispose() {
169         setStart(null);
170         setEnd(null);
171     }
172 
173     /**
174      * @return true, if ih is target of this variable
175      */
176     @Override
<a name="29" id="anc29"></a><span class="line-modified">177     public boolean containsTarget(final InstructionHandle ih) {</span>
178         return (start == ih) || (end == ih);
179     }
180 
<a name="30" id="anc30"></a>
181     @Override
182     public int hashCode() {
183         // If the user changes the name or type, problems with the targeter hashmap will occur.
184         // Note: index cannot be part of hash as it may be changed by the user.
185         return name.hashCode() ^ type.hashCode();
186     }
187 
<a name="31" id="anc31"></a>
188     /**
189      * We consider to local variables to be equal, if the use the same index and
190      * are valid in the same range.
191      */
192     @Override
<a name="32" id="anc32"></a><span class="line-modified">193     public boolean equals(final Object o) {</span>
194         if (!(o instanceof LocalVariableGen)) {
195             return false;
196         }
197         final LocalVariableGen l = (LocalVariableGen) o;
198         return (l.index == index) &amp;&amp; (l.start == start) &amp;&amp; (l.end == end);
199     }
200 
<a name="33" id="anc33"></a>
201     @Override
202     public String toString() {
203         return &quot;LocalVariableGen(&quot; + name + &quot;, &quot; + type + &quot;, &quot; + start + &quot;, &quot; + end + &quot;)&quot;;
204     }
205 
<a name="34" id="anc34"></a>
206     @Override
207     public Object clone() {
208         try {
209             return super.clone();
210         } catch (final CloneNotSupportedException e) {
211             throw new Error(&quot;Clone Not Supported&quot;); // never happens
212         }
213     }
214 }
<a name="35" id="anc35"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="35" type="hidden" />
</body>
</html>