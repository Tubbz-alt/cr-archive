<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml/share/classes/com/sun/org/apache/xpath/internal/axes/FilterExprWalker.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../XPath.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="WalkerFactory.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xpath/internal/axes/FilterExprWalker.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xpath.internal.axes;
 22 
 23 import com.sun.org.apache.xml.internal.dtm.Axis;
 24 import com.sun.org.apache.xml.internal.dtm.DTM;
 25 import com.sun.org.apache.xml.internal.dtm.DTMIterator;
 26 import com.sun.org.apache.xml.internal.utils.QName;
 27 import com.sun.org.apache.xpath.internal.Expression;
 28 import com.sun.org.apache.xpath.internal.ExpressionOwner;
 29 import com.sun.org.apache.xpath.internal.XPathContext;
 30 import com.sun.org.apache.xpath.internal.XPathVisitor;
 31 import com.sun.org.apache.xpath.internal.compiler.Compiler;
 32 import com.sun.org.apache.xpath.internal.compiler.OpCodes;
 33 import com.sun.org.apache.xpath.internal.objects.XNodeSet;
 34 import java.util.List;
 35 
 36 /**
 37  * Walker for the OP_VARIABLE, or OP_EXTFUNCTION, or OP_FUNCTION, or OP_GROUP,
 38  * op codes.
 39  * @see &lt;a href=&quot;http://www.w3.org/TR/xpath#NT-FilterExpr&quot;&gt;XPath FilterExpr descriptions&lt;/a&gt;
<span class="line-modified"> 40  * @LastModified: Oct 2017</span>
 41  */
 42 public class FilterExprWalker extends AxesWalker
 43 {
 44     static final long serialVersionUID = 5457182471424488375L;
 45 
 46   /**
 47    * Construct a FilterExprWalker using a LocPathIterator.
 48    *
 49    * @param locPathIterator non-null reference to the parent iterator.
 50    */
 51   public FilterExprWalker(WalkingIterator locPathIterator)
 52   {
 53     super(locPathIterator, Axis.FILTEREDLIST);
 54   }
 55 
 56   /**
 57    * Init a FilterExprWalker.
 58    *
 59    * @param compiler non-null reference to the Compiler that is constructing.
 60    * @param opPos positive opcode position for this step.
 61    * @param stepType The type of step.
 62    *
 63    * @throws javax.xml.transform.TransformerException
 64    */
 65   @SuppressWarnings(&quot;fallthrough&quot;)
 66   public void init(Compiler compiler, int opPos, int stepType)
 67           throws javax.xml.transform.TransformerException
 68   {
 69 
 70     super.init(compiler, opPos, stepType);
 71 
 72     // Smooth over an anomily in the opcode map...
 73     switch (stepType)
 74     {
 75     case OpCodes.OP_FUNCTION :
 76     case OpCodes.OP_EXTFUNCTION :
 77         m_mustHardReset = true;
 78     case OpCodes.OP_GROUP :
 79     case OpCodes.OP_VARIABLE :
<span class="line-modified"> 80       m_expr = compiler.compile(opPos);</span>
 81       m_expr.exprSetParent(this);
 82       //if((OpCodes.OP_FUNCTION == stepType) &amp;&amp; (m_expr instanceof com.sun.org.apache.xalan.internal.templates.FuncKey))
 83       if(m_expr instanceof com.sun.org.apache.xpath.internal.operations.Variable)
 84       {
 85         // hack/temp workaround
 86         m_canDetachNodeset = false;
 87       }
 88       break;
 89     default :
<span class="line-modified"> 90       m_expr = compiler.compile(opPos + 2);</span>
 91       m_expr.exprSetParent(this);
 92     }
 93 //    if(m_expr instanceof WalkingIterator)
 94 //    {
 95 //      WalkingIterator wi = (WalkingIterator)m_expr;
 96 //      if(wi.getFirstWalker() instanceof FilterExprWalker)
 97 //      {
 98 //              FilterExprWalker fw = (FilterExprWalker)wi.getFirstWalker();
 99 //              if(null == fw.getNextWalker())
100 //              {
101 //                      m_expr = fw.m_expr;
102 //                      m_expr.exprSetParent(this);
103 //              }
104 //      }
105 //
106 //    }
107   }
108 
109   /**
110    * Detaches the walker from the set which it iterated over, releasing
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2017, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 /*
  5  * Licensed to the Apache Software Foundation (ASF) under one or more
  6  * contributor license agreements.  See the NOTICE file distributed with
  7  * this work for additional information regarding copyright ownership.
  8  * The ASF licenses this file to You under the Apache License, Version 2.0
  9  * (the &quot;License&quot;); you may not use this file except in compliance with
 10  * the License.  You may obtain a copy of the License at
 11  *
 12  *      http://www.apache.org/licenses/LICENSE-2.0
 13  *
 14  * Unless required by applicable law or agreed to in writing, software
 15  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 16  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 17  * See the License for the specific language governing permissions and
 18  * limitations under the License.
 19  */
 20 
 21 package com.sun.org.apache.xpath.internal.axes;
 22 
 23 import com.sun.org.apache.xml.internal.dtm.Axis;
 24 import com.sun.org.apache.xml.internal.dtm.DTM;
 25 import com.sun.org.apache.xml.internal.dtm.DTMIterator;
 26 import com.sun.org.apache.xml.internal.utils.QName;
 27 import com.sun.org.apache.xpath.internal.Expression;
 28 import com.sun.org.apache.xpath.internal.ExpressionOwner;
 29 import com.sun.org.apache.xpath.internal.XPathContext;
 30 import com.sun.org.apache.xpath.internal.XPathVisitor;
 31 import com.sun.org.apache.xpath.internal.compiler.Compiler;
 32 import com.sun.org.apache.xpath.internal.compiler.OpCodes;
 33 import com.sun.org.apache.xpath.internal.objects.XNodeSet;
 34 import java.util.List;
 35 
 36 /**
 37  * Walker for the OP_VARIABLE, or OP_EXTFUNCTION, or OP_FUNCTION, or OP_GROUP,
 38  * op codes.
 39  * @see &lt;a href=&quot;http://www.w3.org/TR/xpath#NT-FilterExpr&quot;&gt;XPath FilterExpr descriptions&lt;/a&gt;
<span class="line-modified"> 40  * @LastModified: May 2019</span>
 41  */
 42 public class FilterExprWalker extends AxesWalker
 43 {
 44     static final long serialVersionUID = 5457182471424488375L;
 45 
 46   /**
 47    * Construct a FilterExprWalker using a LocPathIterator.
 48    *
 49    * @param locPathIterator non-null reference to the parent iterator.
 50    */
 51   public FilterExprWalker(WalkingIterator locPathIterator)
 52   {
 53     super(locPathIterator, Axis.FILTEREDLIST);
 54   }
 55 
 56   /**
 57    * Init a FilterExprWalker.
 58    *
 59    * @param compiler non-null reference to the Compiler that is constructing.
 60    * @param opPos positive opcode position for this step.
 61    * @param stepType The type of step.
 62    *
 63    * @throws javax.xml.transform.TransformerException
 64    */
 65   @SuppressWarnings(&quot;fallthrough&quot;)
 66   public void init(Compiler compiler, int opPos, int stepType)
 67           throws javax.xml.transform.TransformerException
 68   {
 69 
 70     super.init(compiler, opPos, stepType);
 71 
 72     // Smooth over an anomily in the opcode map...
 73     switch (stepType)
 74     {
 75     case OpCodes.OP_FUNCTION :
 76     case OpCodes.OP_EXTFUNCTION :
 77         m_mustHardReset = true;
 78     case OpCodes.OP_GROUP :
 79     case OpCodes.OP_VARIABLE :
<span class="line-modified"> 80       m_expr = compiler.compileExpression(opPos);</span>
 81       m_expr.exprSetParent(this);
 82       //if((OpCodes.OP_FUNCTION == stepType) &amp;&amp; (m_expr instanceof com.sun.org.apache.xalan.internal.templates.FuncKey))
 83       if(m_expr instanceof com.sun.org.apache.xpath.internal.operations.Variable)
 84       {
 85         // hack/temp workaround
 86         m_canDetachNodeset = false;
 87       }
 88       break;
 89     default :
<span class="line-modified"> 90       m_expr = compiler.compileExpression(opPos + 2);</span>
 91       m_expr.exprSetParent(this);
 92     }
 93 //    if(m_expr instanceof WalkingIterator)
 94 //    {
 95 //      WalkingIterator wi = (WalkingIterator)m_expr;
 96 //      if(wi.getFirstWalker() instanceof FilterExprWalker)
 97 //      {
 98 //              FilterExprWalker fw = (FilterExprWalker)wi.getFirstWalker();
 99 //              if(null == fw.getNextWalker())
100 //              {
101 //                      m_expr = fw.m_expr;
102 //                      m_expr.exprSetParent(this);
103 //              }
104 //      }
105 //
106 //    }
107   }
108 
109   /**
110    * Detaches the walker from the set which it iterated over, releasing
</pre>
</td>
</tr>
</table>
<center><a href="../XPath.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="WalkerFactory.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>