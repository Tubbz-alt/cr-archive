<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/InstructionComparator.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Instruction.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="InstructionConst.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/InstructionComparator.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 23,44 ***</span>
  
  /**
   * Equality of instructions isn&#39;t clearly to be defined. You might
   * wish, for example, to compare whether instructions have the same
   * meaning. E.g., whether two INVOKEVIRTUALs describe the same
<span class="line-modified">!  * call.&lt;br&gt;The DEFAULT comparator however, considers two instructions</span>
   * to be equal if they have same opcode and point to the same indexes
   * (if any) in the constant pool or the same local variable index. Branch
   * instructions must have the same target.
   *
   * @see Instruction
<span class="line-removed">-  * @version $Id: InstructionComparator.java 1749597 2016-06-21 20:28:51Z ggregory $</span>
   */
  public interface InstructionComparator {
  
<span class="line-modified">!     InstructionComparator DEFAULT = new InstructionComparator() {</span>
<span class="line-modified">! </span>
<span class="line-modified">!         @Override</span>
<span class="line-modified">!         public boolean equals( final Instruction i1, final Instruction i2 ) {</span>
<span class="line-modified">!             if (i1.getOpcode() == i2.getOpcode()) {</span>
<span class="line-removed">-                 if (i1 instanceof BranchInstruction) {</span>
<span class="line-removed">-                  // BIs are never equal to make targeters work correctly (BCEL-195)</span>
<span class="line-removed">-                     return false;</span>
  //                } else if (i1 == i2) { TODO consider adding this shortcut
  //                    return true; // this must be AFTER the BI test
<span class="line-modified">!                 } else if (i1 instanceof ConstantPushInstruction) {</span>
<span class="line-modified">!                     return ((ConstantPushInstruction) i1).getValue().equals(</span>
<span class="line-modified">!                             ((ConstantPushInstruction) i2).getValue());</span>
<span class="line-modified">!                 } else if (i1 instanceof IndexedInstruction) {</span>
<span class="line-modified">!                     return ((IndexedInstruction) i1).getIndex() == ((IndexedInstruction) i2)</span>
<span class="line-modified">!                             .getIndex();</span>
<span class="line-modified">!                 } else if (i1 instanceof NEWARRAY) {</span>
<span class="line-modified">!                     return ((NEWARRAY) i1).getTypecode() == ((NEWARRAY) i2).getTypecode();</span>
<span class="line-modified">!                 } else {</span>
<span class="line-modified">!                     return true;</span>
<span class="line-removed">-                 }</span>
              }
<span class="line-removed">-             return false;</span>
          }
      };
  
  
      boolean equals( Instruction i1, Instruction i2 );
  }
<span class="line-new-header">--- 23,42 ---</span>
  
  /**
   * Equality of instructions isn&#39;t clearly to be defined. You might
   * wish, for example, to compare whether instructions have the same
   * meaning. E.g., whether two INVOKEVIRTUALs describe the same
<span class="line-modified">!  * call.</span>
<span class="line-added">+  * &lt;p&gt;</span>
<span class="line-added">+  * The DEFAULT comparator however, considers two instructions</span>
   * to be equal if they have same opcode and point to the same indexes
   * (if any) in the constant pool or the same local variable index. Branch
   * instructions must have the same target.
<span class="line-added">+  * &lt;/p&gt;</span>
   *
   * @see Instruction
   */
  public interface InstructionComparator {
  
<span class="line-modified">!     InstructionComparator DEFAULT = (i1, i2) -&gt; {</span>
<span class="line-modified">!         if (i1.getOpcode() == i2.getOpcode()) {</span>
<span class="line-modified">!             if (i1 instanceof BranchInstruction) {</span>
<span class="line-modified">!              // BIs are never equal to make targeters work correctly (BCEL-195)</span>
<span class="line-modified">!                 return false;</span>
  //                } else if (i1 == i2) { TODO consider adding this shortcut
  //                    return true; // this must be AFTER the BI test
<span class="line-modified">!             } else if (i1 instanceof ConstantPushInstruction) {</span>
<span class="line-modified">!                 return ((ConstantPushInstruction) i1).getValue().equals(</span>
<span class="line-modified">!                         ((ConstantPushInstruction) i2).getValue());</span>
<span class="line-modified">!             } else if (i1 instanceof IndexedInstruction) {</span>
<span class="line-modified">!                 return ((IndexedInstruction) i1).getIndex() == ((IndexedInstruction) i2)</span>
<span class="line-modified">!                         .getIndex();</span>
<span class="line-modified">!             } else if (i1 instanceof NEWARRAY) {</span>
<span class="line-modified">!                 return ((NEWARRAY) i1).getTypecode() == ((NEWARRAY) i2).getTypecode();</span>
<span class="line-modified">!             } else {</span>
<span class="line-modified">!                 return true;</span>
              }
          }
<span class="line-added">+         return false;</span>
      };
  
  
      boolean equals( Instruction i1, Instruction i2 );
  }
</pre>
<center><a href="Instruction.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="InstructionConst.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>