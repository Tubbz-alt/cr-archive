<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/ConstantPool.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ConstantObject.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="ConstantString.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/classfile/ConstantPool.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 33,29 ***</span>
   * specification that skips an entry after an 8-byte constant (double,
   * long) entry.  Those interested in generating constant pools
   * programatically should see &lt;a href=&quot;../generic/ConstantPoolGen.html&quot;&gt;
   * ConstantPoolGen&lt;/a&gt;.
  
<span class="line-removed">-  * @version $Id: ConstantPool.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
   * @see     Constant
   * @see     com.sun.org.apache.bcel.internal.generic.ConstantPoolGen
   */
  public class ConstantPool implements Cloneable, Node {
  
      private Constant[] constant_pool;
  
<span class="line-removed">- </span>
      /**
       * @param constant_pool Array of constants
       */
      public ConstantPool(final Constant[] constant_pool) {
          this.constant_pool = constant_pool;
      }
  
<span class="line-removed">- </span>
      /**
<span class="line-modified">!      * Read constants from given input stream.</span>
       *
       * @param input Input stream
       * @throws IOException
       * @throws ClassFormatException
       */
<span class="line-new-header">--- 33,26 ---</span>
   * specification that skips an entry after an 8-byte constant (double,
   * long) entry.  Those interested in generating constant pools
   * programatically should see &lt;a href=&quot;../generic/ConstantPoolGen.html&quot;&gt;
   * ConstantPoolGen&lt;/a&gt;.
  
   * @see     Constant
   * @see     com.sun.org.apache.bcel.internal.generic.ConstantPoolGen
   */
  public class ConstantPool implements Cloneable, Node {
  
      private Constant[] constant_pool;
  
      /**
       * @param constant_pool Array of constants
       */
      public ConstantPool(final Constant[] constant_pool) {
          this.constant_pool = constant_pool;
      }
  
      /**
<span class="line-modified">!      * Reads constants from given input stream.</span>
       *
       * @param input Input stream
       * @throws IOException
       * @throws ClassFormatException
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 80,11 ***</span>
                  i++;
              }
          }
      }
  
<span class="line-removed">- </span>
      /**
       * Called by objects that are traversing the nodes of the tree implicitely
       * defined by the contents of a Java class. I.e., the hierarchy of methods,
       * fields, attributes, etc. spawns a tree of objects.
       *
<span class="line-new-header">--- 77,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 93,13 ***</span>
      @Override
      public void accept( final Visitor v ) {
          v.visitConstantPool(this);
      }
  
<span class="line-removed">- </span>
      /**
<span class="line-modified">!      * Resolve constant to a string representation.</span>
       *
       * @param  c Constant to be printed
       * @return String representation
       */
      public String constantToString( Constant c ) throws ClassFormatException {
<span class="line-new-header">--- 89,12 ---</span>
      @Override
      public void accept( final Visitor v ) {
          v.visitConstantPool(this);
      }
  
      /**
<span class="line-modified">!      * Resolves constant to a string representation.</span>
       *
       * @param  c Constant to be printed
       * @return String representation
       */
      public String constantToString( Constant c ) throws ClassFormatException {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 133,11 ***</span>
                  str = String.valueOf(((ConstantInteger) c).getBytes());
                  break;
              case Const.CONSTANT_NameAndType:
                  str = constantToString(((ConstantNameAndType) c).getNameIndex(),
                          Const.CONSTANT_Utf8)
<span class="line-modified">!                         + &quot;:&quot; + constantToString(((ConstantNameAndType) c).getSignatureIndex(),</span>
                          Const.CONSTANT_Utf8);
                  break;
              case Const.CONSTANT_InterfaceMethodref:
              case Const.CONSTANT_Methodref:
              case Const.CONSTANT_Fieldref:
<span class="line-new-header">--- 128,11 ---</span>
                  str = String.valueOf(((ConstantInteger) c).getBytes());
                  break;
              case Const.CONSTANT_NameAndType:
                  str = constantToString(((ConstantNameAndType) c).getNameIndex(),
                          Const.CONSTANT_Utf8)
<span class="line-modified">!                         + &quot; &quot; + constantToString(((ConstantNameAndType) c).getSignatureIndex(),</span>
                          Const.CONSTANT_Utf8);
                  break;
              case Const.CONSTANT_InterfaceMethodref:
              case Const.CONSTANT_Methodref:
              case Const.CONSTANT_Fieldref:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 161,17 ***</span>
                  final ConstantInvokeDynamic cid = (ConstantInvokeDynamic) c;
                  str = cid.getBootstrapMethodAttrIndex()
                          + &quot;:&quot; + constantToString(cid.getNameAndTypeIndex(),
                          Const.CONSTANT_NameAndType);
                  break;
              default: // Never reached
                  throw new RuntimeException(&quot;Unknown constant type &quot; + tag);
          }
          return str;
      }
  
<span class="line-removed">- </span>
      private static String escape( final String str ) {
          final int len = str.length();
          final StringBuilder buf = new StringBuilder(len + 5);
          final char[] ch = str.toCharArray();
          for (int i = 0; i &lt; len; i++) {
<span class="line-new-header">--- 156,26 ---</span>
                  final ConstantInvokeDynamic cid = (ConstantInvokeDynamic) c;
                  str = cid.getBootstrapMethodAttrIndex()
                          + &quot;:&quot; + constantToString(cid.getNameAndTypeIndex(),
                          Const.CONSTANT_NameAndType);
                  break;
<span class="line-added">+             case Const.CONSTANT_Module:</span>
<span class="line-added">+                 i = ((ConstantModule) c).getNameIndex();</span>
<span class="line-added">+                 c = getConstant(i, Const.CONSTANT_Utf8);</span>
<span class="line-added">+                 str = Utility.compactClassName(((ConstantUtf8) c).getBytes(), false);</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             case Const.CONSTANT_Package:</span>
<span class="line-added">+                 i = ((ConstantPackage) c).getNameIndex();</span>
<span class="line-added">+                 c = getConstant(i, Const.CONSTANT_Utf8);</span>
<span class="line-added">+                 str = Utility.compactClassName(((ConstantUtf8) c).getBytes(), false);</span>
<span class="line-added">+                 break;</span>
              default: // Never reached
                  throw new RuntimeException(&quot;Unknown constant type &quot; + tag);
          }
          return str;
      }
  
      private static String escape( final String str ) {
          final int len = str.length();
          final StringBuilder buf = new StringBuilder(len + 5);
          final char[] ch = str.toCharArray();
          for (int i = 0; i &lt; len; i++) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 196,13 ***</span>
              }
          }
          return buf.toString();
      }
  
<span class="line-removed">- </span>
      /**
<span class="line-modified">!      * Retrieve constant at `index&#39; from constant pool and resolve it to</span>
       * a string representation.
       *
       * @param  index of constant in constant pool
       * @param  tag expected type
       * @return String representation
<span class="line-new-header">--- 200,12 ---</span>
              }
          }
          return buf.toString();
      }
  
      /**
<span class="line-modified">!      * Retrieves constant at `index&#39; from constant pool and resolve it to</span>
       * a string representation.
       *
       * @param  index of constant in constant pool
       * @param  tag expected type
       * @return String representation
</pre>
<hr />
<pre>
<span class="line-old-header">*** 210,11 ***</span>
      public String constantToString( final int index, final byte tag ) throws ClassFormatException {
          final Constant c = getConstant(index, tag);
          return constantToString(c);
      }
  
<span class="line-removed">- </span>
      /**
       * Dump constant pool to file stream in binary format.
       *
       * @param file Output file stream
       * @throws IOException
<span class="line-new-header">--- 213,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 226,13 ***</span>
                  constant_pool[i].dump(file);
              }
          }
      }
  
<span class="line-removed">- </span>
      /**
<span class="line-modified">!      * Get constant from constant pool.</span>
       *
       * @param  index Index in constant pool
       * @return Constant value
       * @see    Constant
       */
<span class="line-new-header">--- 228,12 ---</span>
                  constant_pool[i].dump(file);
              }
          }
      }
  
      /**
<span class="line-modified">!      * Gets constant from constant pool.</span>
       *
       * @param  index Index in constant pool
       * @return Constant value
       * @see    Constant
       */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 242,13 ***</span>
                      + &quot;. Constant pool size is: &quot; + constant_pool.length);
          }
          return constant_pool[index];
      }
  
<span class="line-removed">- </span>
      /**
<span class="line-modified">!      * Get constant from constant pool and check whether it has the</span>
       * expected type.
       *
       * @param  index Index in constant pool
       * @param  tag Tag of expected constant, i.e., its type
       * @return Constant value
<span class="line-new-header">--- 243,12 ---</span>
                      + &quot;. Constant pool size is: &quot; + constant_pool.length);
          }
          return constant_pool[index];
      }
  
      /**
<span class="line-modified">!      * Gets constant from constant pool and check whether it has the</span>
       * expected type.
       *
       * @param  index Index in constant pool
       * @param  tag Tag of expected constant, i.e., its type
       * @return Constant value
</pre>
<hr />
<pre>
<span class="line-old-header">*** 266,22 ***</span>
                      + &quot;&#39; at index &quot; + index + &quot; and got &quot; + c);
          }
          return c;
      }
  
<span class="line-removed">- </span>
      /**
       * @return Array of constants.
       * @see    Constant
       */
      public Constant[] getConstantPool() {
          return constant_pool;
      }
  
<span class="line-removed">- </span>
      /**
<span class="line-modified">!      * Get string from constant pool and bypass the indirection of</span>
       * `ConstantClass&#39; and `ConstantString&#39; objects. I.e. these classes have
       * an index field that points to another entry of the constant pool of
       * type `ConstantUtf8&#39; which contains the real data.
       *
       * @param  index Index in constant pool
<span class="line-new-header">--- 266,20 ---</span>
                      + &quot;&#39; at index &quot; + index + &quot; and got &quot; + c);
          }
          return c;
      }
  
      /**
       * @return Array of constants.
       * @see    Constant
       */
      public Constant[] getConstantPool() {
          return constant_pool;
      }
  
      /**
<span class="line-modified">!      * Gets string from constant pool and bypass the indirection of</span>
       * `ConstantClass&#39; and `ConstantString&#39; objects. I.e. these classes have
       * an index field that points to another entry of the constant pool of
       * type `ConstantUtf8&#39; which contains the real data.
       *
       * @param  index Index in constant pool
</pre>
<hr />
<pre>
<span class="line-old-header">*** 293,11 ***</span>
       */
      public String getConstantString( final int index, final byte tag ) throws ClassFormatException {
          Constant c;
          int i;
          c = getConstant(index, tag);
<span class="line-modified">!         /* This switch() is not that elegant, since the two classes have the</span>
           * same contents, they just differ in the name of the index
           * field variable.
           * But we want to stick to the JVM naming conventions closely though
           * we could have solved these more elegantly by using the same
           * variable name or by subclassing.
<span class="line-new-header">--- 291,11 ---</span>
       */
      public String getConstantString( final int index, final byte tag ) throws ClassFormatException {
          Constant c;
          int i;
          c = getConstant(index, tag);
<span class="line-modified">!         /* This switch() is not that elegant, since the four classes have the</span>
           * same contents, they just differ in the name of the index
           * field variable.
           * But we want to stick to the JVM naming conventions closely though
           * we could have solved these more elegantly by using the same
           * variable name or by subclassing.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 307,10 ***</span>
<span class="line-new-header">--- 305,16 ---</span>
                  i = ((ConstantClass) c).getNameIndex();
                  break;
              case Const.CONSTANT_String:
                  i = ((ConstantString) c).getStringIndex();
                  break;
<span class="line-added">+             case Const.CONSTANT_Module:</span>
<span class="line-added">+                 i = ((ConstantModule) c).getNameIndex();</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             case Const.CONSTANT_Package:</span>
<span class="line-added">+                 i = ((ConstantPackage) c).getNameIndex();</span>
<span class="line-added">+                 break;</span>
              default:
                  throw new RuntimeException(&quot;getConstantString called with illegal tag &quot; + tag);
          }
          // Finally get the string from the constant pool
          c = getConstant(i, Const.CONSTANT_Utf8);
</pre>
<center><a href="ConstantObject.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="ConstantString.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>