<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/FieldOrMethod.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FieldObserver.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="GETFIELD.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/bcel/internal/generic/FieldOrMethod.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 29,19 ***</span>
  
  /**
   * Super class for InvokeInstruction and FieldInstruction, since they have
   * some methods in common!
   *
<span class="line-removed">-  * @version $Id: FieldOrMethod.java 1749603 2016-06-21 20:50:19Z ggregory $</span>
   */
  public abstract class FieldOrMethod extends CPInstruction implements LoadClass {
  
      /**
<span class="line-modified">!      * Empty constructor needed for the Class.newInstance() statement in</span>
<span class="line-modified">!      * Instruction.readInstruction(). Not to be used otherwise.</span>
       */
      FieldOrMethod() {
      }
  
  
      /**
       * @param index to constant pool
<span class="line-new-header">--- 29,19 ---</span>
  
  /**
   * Super class for InvokeInstruction and FieldInstruction, since they have
   * some methods in common!
   *
   */
  public abstract class FieldOrMethod extends CPInstruction implements LoadClass {
  
      /**
<span class="line-modified">!      * Empty constructor needed for Instruction.readInstruction.</span>
<span class="line-modified">!      * Not to be used otherwise.</span>
       */
      FieldOrMethod() {
<span class="line-added">+         // no init</span>
      }
  
  
      /**
       * @param index to constant pool
</pre>
<hr />
<pre>
<span class="line-old-header">*** 51,21 ***</span>
      }
  
  
      /** @return signature of referenced method/field.
       */
<span class="line-modified">!     public String getSignature( final ConstantPoolGen cpg ) {</span>
          final ConstantPool cp = cpg.getConstantPool();
          final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
          final ConstantNameAndType cnat = (ConstantNameAndType) cp.getConstant(cmr.getNameAndTypeIndex());
          return ((ConstantUtf8) cp.getConstant(cnat.getSignatureIndex())).getBytes();
      }
  
  
      /** @return name of referenced method/field.
       */
<span class="line-modified">!     public String getName( final ConstantPoolGen cpg ) {</span>
          final ConstantPool cp = cpg.getConstantPool();
          final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
          final ConstantNameAndType cnat = (ConstantNameAndType) cp.getConstant(cmr.getNameAndTypeIndex());
          return ((ConstantUtf8) cp.getConstant(cnat.getNameIndex())).getBytes();
      }
<span class="line-new-header">--- 51,21 ---</span>
      }
  
  
      /** @return signature of referenced method/field.
       */
<span class="line-modified">!     public String getSignature(final ConstantPoolGen cpg) {</span>
          final ConstantPool cp = cpg.getConstantPool();
          final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
          final ConstantNameAndType cnat = (ConstantNameAndType) cp.getConstant(cmr.getNameAndTypeIndex());
          return ((ConstantUtf8) cp.getConstant(cnat.getSignatureIndex())).getBytes();
      }
  
  
      /** @return name of referenced method/field.
       */
<span class="line-modified">!     public String getName(final ConstantPoolGen cpg) {</span>
          final ConstantPool cp = cpg.getConstantPool();
          final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
          final ConstantNameAndType cnat = (ConstantNameAndType) cp.getConstant(cmr.getNameAndTypeIndex());
          return ((ConstantUtf8) cp.getConstant(cnat.getNameIndex())).getBytes();
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 81,11 ***</span>
       *    the {@link #getReferenceType(ConstantPoolGen)} method, which correctly distinguishes
       *    between class types and array types.
       *
       */
      @Deprecated
<span class="line-modified">!     public String getClassName( final ConstantPoolGen cpg ) {</span>
          final ConstantPool cp = cpg.getConstantPool();
          final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
          final String className = cp.getConstantString(cmr.getClassIndex(), Const.CONSTANT_Class);
          if (className.startsWith(&quot;[&quot;)) {
              // Turn array classes into java.lang.Object.
<span class="line-new-header">--- 81,11 ---</span>
       *    the {@link #getReferenceType(ConstantPoolGen)} method, which correctly distinguishes
       *    between class types and array types.
       *
       */
      @Deprecated
<span class="line-modified">!     public String getClassName(final ConstantPoolGen cpg) {</span>
          final ConstantPool cp = cpg.getConstantPool();
          final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
          final String className = cp.getConstantString(cmr.getClassIndex(), Const.CONSTANT_Class);
          if (className.startsWith(&quot;[&quot;)) {
              // Turn array classes into java.lang.Object.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 99,24 ***</span>
       * @deprecated If the instruction references an array class,
       *    the ObjectType returned will be invalid.  Use
       *    getReferenceType() instead.
       */
      @Deprecated
<span class="line-modified">!     public ObjectType getClassType( final ConstantPoolGen cpg ) {</span>
          return ObjectType.getInstance(getClassName(cpg));
      }
  
  
      /**
<span class="line-modified">!      * Return the reference type representing the class, interface,</span>
       * or array class referenced by the instruction.
       * @param cpg the ConstantPoolGen used to create the instruction
       * @return an ObjectType (if the referenced class type is a class
       *   or interface), or an ArrayType (if the referenced class
       *   type is an array class)
       */
<span class="line-modified">!     public ReferenceType getReferenceType( final ConstantPoolGen cpg ) {</span>
          final ConstantPool cp = cpg.getConstantPool();
          final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
          String className = cp.getConstantString(cmr.getClassIndex(), Const.CONSTANT_Class);
          if (className.startsWith(&quot;[&quot;)) {
              return (ArrayType) Type.getType(className);
<span class="line-new-header">--- 99,24 ---</span>
       * @deprecated If the instruction references an array class,
       *    the ObjectType returned will be invalid.  Use
       *    getReferenceType() instead.
       */
      @Deprecated
<span class="line-modified">!     public ObjectType getClassType(final ConstantPoolGen cpg) {</span>
          return ObjectType.getInstance(getClassName(cpg));
      }
  
  
      /**
<span class="line-modified">!      * Gets the reference type representing the class, interface,</span>
       * or array class referenced by the instruction.
       * @param cpg the ConstantPoolGen used to create the instruction
       * @return an ObjectType (if the referenced class type is a class
       *   or interface), or an ArrayType (if the referenced class
       *   type is an array class)
       */
<span class="line-modified">!     public ReferenceType getReferenceType(final ConstantPoolGen cpg) {</span>
          final ConstantPool cp = cpg.getConstantPool();
          final ConstantCP cmr = (ConstantCP) cp.getConstant(super.getIndex());
          String className = cp.getConstantString(cmr.getClassIndex(), Const.CONSTANT_Class);
          if (className.startsWith(&quot;[&quot;)) {
              return (ArrayType) Type.getType(className);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 125,19 ***</span>
          return ObjectType.getInstance(className);
      }
  
  
      /**
<span class="line-modified">!      * Get the ObjectType of the method return or field.</span>
       *
       * @return type of the referenced class/interface
       * @throws ClassGenException when the field is (or method returns) an array,
       */
      @Override
<span class="line-modified">!     public ObjectType getLoadClassType( final ConstantPoolGen cpg ) {</span>
          final ReferenceType rt = getReferenceType(cpg);
<span class="line-modified">!         if(rt instanceof ObjectType) {</span>
<span class="line-modified">!             return (ObjectType)rt;</span>
          }
<span class="line-modified">!         throw new ClassGenException(rt.getSignature() + &quot; does not represent an ObjectType&quot;);</span>
      }
  }
<span class="line-new-header">--- 125,20 ---</span>
          return ObjectType.getInstance(className);
      }
  
  
      /**
<span class="line-modified">!      * Gets the ObjectType of the method return or field.</span>
       *
       * @return type of the referenced class/interface
       * @throws ClassGenException when the field is (or method returns) an array,
       */
      @Override
<span class="line-modified">!     public ObjectType getLoadClassType(final ConstantPoolGen cpg) {</span>
          final ReferenceType rt = getReferenceType(cpg);
<span class="line-modified">!         if (rt instanceof ObjectType) {</span>
<span class="line-modified">!             return (ObjectType) rt;</span>
          }
<span class="line-modified">!         throw new ClassGenException(rt.getClass().getCanonicalName() + &quot; &quot; +</span>
<span class="line-added">+                 rt.getSignature() + &quot; does not represent an ObjectType&quot;);</span>
      }
  }
</pre>
<center><a href="FieldObserver.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="GETFIELD.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>