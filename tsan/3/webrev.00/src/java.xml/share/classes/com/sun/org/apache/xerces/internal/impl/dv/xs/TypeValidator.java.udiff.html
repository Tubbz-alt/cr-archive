<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.xml/share/classes/com/sun/org/apache/xerces/internal/impl/dv/xs/TypeValidator.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../XMLEntityManager.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../msg/XMLSchemaMessages.properties.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml/share/classes/com/sun/org/apache/xerces/internal/impl/dv/xs/TypeValidator.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,8 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * reserved comment block</span>
<span class="udiff-line-removed">-  * DO NOT REMOVE OR ALTER!</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2013, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   */
  /*
   * Licensed to the Apache Software Foundation (ASF) under one or more
   * contributor license agreements.  See the NOTICE file distributed with
   * this work for additional information regarding copyright ownership.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,10 +20,12 @@</span>
  
  package com.sun.org.apache.xerces.internal.impl.dv.xs;
  
  import com.sun.org.apache.xerces.internal.impl.dv.InvalidDatatypeValueException;
  import com.sun.org.apache.xerces.internal.impl.dv.ValidationContext;
<span class="udiff-line-added">+ import com.sun.org.apache.xerces.internal.util.XMLChar;</span>
<span class="udiff-line-added">+ import jdk.xml.internal.SecuritySupport;</span>
  
  /**
   * All primitive types plus ID/IDREF/ENTITY/INTEGER are derived from this abstract
   * class. It provides extra information XSSimpleTypeDecl requires from each
   * type: allowed facets, converting String to actual value, check equality,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -33,13 +34,18 @@</span>
   * @xerces.internal
   *
   * @author Neeraj Bajaj, Sun Microsystems, inc.
   * @author Sandy Gao, IBM
   *
<span class="udiff-line-added">+  * @LastModified: Apr 2019</span>
   */
  public abstract class TypeValidator {
  
<span class="udiff-line-added">+     private static final boolean USE_CODE_POINT_COUNT_FOR_STRING_LENGTH =</span>
<span class="udiff-line-added">+             Boolean.parseBoolean(SecuritySupport.getSystemProperty(</span>
<span class="udiff-line-added">+                     &quot;com.sun.org.apache.xerces.internal.impl.dv.xs.useCodePointCountForStringLength&quot;, &quot;false&quot;));</span>
<span class="udiff-line-added">+ </span>
      // which facets are allowed for this type
      public abstract short getAllowedFacets();
  
      // convert a string to an actual value. for example,
      // for number types (decimal, double, float, and types derived from them),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -80,11 +86,18 @@</span>
      }
  
      // get the length of the value
      // the parameters are in compiled form (from getActualValue)
      public int getDataLength(Object value) {
<span class="udiff-line-modified-removed">-         return (value instanceof String) ? ((String)value).length() : -1;</span>
<span class="udiff-line-modified-added">+         if (value instanceof String) {</span>
<span class="udiff-line-added">+             final String str = (String)value;</span>
<span class="udiff-line-added">+             if (!USE_CODE_POINT_COUNT_FOR_STRING_LENGTH) {</span>
<span class="udiff-line-added">+                 return str.length();</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             return getCodePointLength(str);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return -1;</span>
      }
  
      // get the number of digits of the value
      // the parameters are in compiled form (from getActualValue)
      public int getTotalDigits(Object value) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -95,10 +108,29 @@</span>
      // the parameters are in compiled form (from getActualValue)
      public int getFractionDigits(Object value) {
          return -1;
      }
  
<span class="udiff-line-added">+     // Returns the length of the string in Unicode code points.</span>
<span class="udiff-line-added">+     private int getCodePointLength(String value) {</span>
<span class="udiff-line-added">+         // Count the number of surrogate pairs, and subtract them from</span>
<span class="udiff-line-added">+         // the total length.</span>
<span class="udiff-line-added">+         final int len = value.length();</span>
<span class="udiff-line-added">+         int surrogatePairCount = 0;</span>
<span class="udiff-line-added">+         for (int i = 0; i &lt; len - 1; ++i) {</span>
<span class="udiff-line-added">+             if (XMLChar.isHighSurrogate(value.charAt(i))) {</span>
<span class="udiff-line-added">+                 if (XMLChar.isLowSurrogate(value.charAt(++i))) {</span>
<span class="udiff-line-added">+                     ++surrogatePairCount;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 else {</span>
<span class="udiff-line-added">+                     --i;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         return len - surrogatePairCount;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      // check whether the character is in the range 0x30 ~ 0x39
      public static final boolean isDigit(char ch) {
          return ch &gt;= &#39;0&#39; &amp;&amp; ch &lt;= &#39;9&#39;;
      }
  
</pre>
<center><a href="../../XMLEntityManager.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../msg/XMLSchemaMessages.properties.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>