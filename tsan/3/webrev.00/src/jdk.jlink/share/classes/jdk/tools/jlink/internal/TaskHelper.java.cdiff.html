<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.jlink/share/classes/jdk/tools/jlink/internal/TaskHelper.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ImagePluginConfiguration.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="plugins/DefaultStripDebugPlugin.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jlink/share/classes/jdk/tools/jlink/internal/TaskHelper.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 221,10 ***</span>
<span class="line-new-header">--- 221,12 ---</span>
          }
      }
  
      private final class PluginsHelper {
  
<span class="line-added">+         // Duplicated here so as to avoid a direct dependency on platform specific plugin</span>
<span class="line-added">+         private static final String STRIP_NATIVE_DEBUG_SYMBOLS_NAME = &quot;strip-native-debug-symbols&quot;;</span>
          private ModuleLayer pluginsLayer = ModuleLayer.boot();
          private final List&lt;Plugin&gt; plugins;
          private String lastSorter;
          private boolean listPlugins;
          private Path existingImage;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 321,11 ***</span>
                                      return;
                                  }
  
                                  Map&lt;String, String&gt; m = addArgumentMap(plugin);
                                  // handle one or more arguments
<span class="line-modified">!                                 if (arg.indexOf(&#39;:&#39;) == -1) {</span>
                                      // single argument case
                                      m.put(option, arg);
                                  } else {
                                      // This option can accept more than one arguments
                                      // like --option_name=arg_value:arg2=value2:arg3=value3
<span class="line-new-header">--- 323,11 ---</span>
                                      return;
                                  }
  
                                  Map&lt;String, String&gt; m = addArgumentMap(plugin);
                                  // handle one or more arguments
<span class="line-modified">!                                 if (plugin.hasRawArgument() || arg.indexOf(&#39;:&#39;) == -1) {</span>
                                      // single argument case
                                      m.put(option, arg);
                                  } else {
                                      // This option can accept more than one arguments
                                      // like --option_name=arg_value:arg2=value2:arg3=value3
</pre>
<hr />
<pre>
<span class="line-old-header">*** 422,10 ***</span>
<span class="line-new-header">--- 424,11 ---</span>
                              getMessage(&quot;err.dir.already.exits&quot;, output));
                  }
              }
  
              List&lt;Plugin&gt; pluginsList = new ArrayList&lt;&gt;();
<span class="line-added">+             Set&lt;String&gt; seenPlugins = new HashSet&lt;&gt;();</span>
              for (Entry&lt;Plugin, List&lt;Map&lt;String, String&gt;&gt;&gt; entry : pluginToMaps.entrySet()) {
                  Plugin plugin = entry.getKey();
                  List&lt;Map&lt;String, String&gt;&gt; argsMaps = entry.getValue();
  
                  // same plugin option may be used multiple times in command line.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 442,11 ***</span>
<span class="line-new-header">--- 445,21 ---</span>
                          throw e;
                      }
                  }
  
                  if (!Utils.isDisabled(plugin)) {
<span class="line-added">+                     // make sure that --strip-debug and --strip-native-debug-symbols</span>
<span class="line-added">+                     // aren&#39;t being used at the same time. --strip-debug invokes --strip-native-debug-symbols on</span>
<span class="line-added">+                     // platforms that support it, so it makes little sense to allow both at the same time.</span>
<span class="line-added">+                     if ((plugin instanceof DefaultStripDebugPlugin &amp;&amp; seenPlugins.contains(STRIP_NATIVE_DEBUG_SYMBOLS_NAME)) ||</span>
<span class="line-added">+                         (STRIP_NATIVE_DEBUG_SYMBOLS_NAME.equals(plugin.getName()) &amp;&amp; seenPlugins.contains(DefaultStripDebugPlugin.NAME))) {</span>
<span class="line-added">+                         throw new BadArgs(&quot;err.plugin.conflicts&quot;, &quot;--&quot; + DefaultStripDebugPlugin.NAME,</span>
<span class="line-added">+                                                                 &quot;-G&quot;,</span>
<span class="line-added">+                                                                 &quot;--&quot; + STRIP_NATIVE_DEBUG_SYMBOLS_NAME);</span>
<span class="line-added">+                     }</span>
                      pluginsList.add(plugin);
<span class="line-added">+                     seenPlugins.add(plugin.getName());</span>
                  }
              }
  
              // recreate or postprocessing don&#39;t require an output directory.
              ImageBuilder builder = null;
</pre>
<center><a href="ImagePluginConfiguration.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="plugins/DefaultStripDebugPlugin.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>