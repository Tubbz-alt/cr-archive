<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jlink/share/classes/jdk/tools/jlink/internal/plugins/SystemModulesPlugin.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PluginsResourceBundle.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../plugin/Plugin.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jlink/share/classes/jdk/tools/jlink/internal/plugins/SystemModulesPlugin.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2015, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  44 import java.util.Collection;
  45 import java.util.Collections;
  46 import java.util.EnumSet;
  47 import java.util.HashMap;
  48 import java.util.HashSet;
  49 import java.util.LinkedHashMap;
  50 import java.util.List;
  51 import java.util.Map;
  52 import java.util.Objects;
  53 import java.util.Optional;
  54 import java.util.Set;
  55 import java.util.TreeMap;
  56 import java.util.TreeSet;
  57 import java.util.function.IntSupplier;
  58 import java.util.function.Supplier;
  59 import java.util.stream.Collectors;
  60 
  61 import jdk.internal.module.Checks;
  62 import jdk.internal.module.DefaultRoots;
  63 import jdk.internal.module.IllegalAccessMaps;

  64 import jdk.internal.module.ModuleHashes;
  65 import jdk.internal.module.ModuleInfo.Attributes;
  66 import jdk.internal.module.ModuleInfoExtender;
  67 import jdk.internal.module.ModuleReferenceImpl;
  68 import jdk.internal.module.ModuleResolution;
  69 import jdk.internal.module.ModuleTarget;
  70 
  71 import jdk.internal.org.objectweb.asm.ClassReader;
  72 import jdk.internal.org.objectweb.asm.ClassVisitor;
  73 import jdk.internal.org.objectweb.asm.ClassWriter;
  74 import jdk.internal.org.objectweb.asm.MethodVisitor;
  75 import jdk.internal.org.objectweb.asm.ModuleVisitor;
  76 import jdk.internal.org.objectweb.asm.Opcodes;
  77 import static jdk.internal.org.objectweb.asm.Opcodes.*;
  78 
  79 import jdk.tools.jlink.internal.ModuleSorter;
  80 import jdk.tools.jlink.plugin.Plugin;
  81 import jdk.tools.jlink.plugin.PluginException;
  82 import jdk.tools.jlink.plugin.ResourcePool;
  83 import jdk.tools.jlink.plugin.ResourcePoolBuilder;
</pre>
<hr />
<pre>
 274                     rn = genSystemModulesClass(sublist(moduleInfos, cf), cf, cn, out);
 275                     map.put(moduleName, cn);
 276                     generated.add(rn);
 277                 }
 278             }
 279         }
 280 
 281         // generate SystemModulesMap
 282         rn = genSystemModulesMapClass(ALL_SYSTEM_MODULES_CLASS,
 283                                       defaultSystemModulesClassName,
 284                                       map,
 285                                       out);
 286         generated.add(rn);
 287 
 288         // return the resource names of the generated classes
 289         return generated;
 290     }
 291 
 292     /**
 293      * Resolves a collection of root modules, with service binding, to create
<span class="line-modified"> 294      * configuration.</span>
 295      */
 296     private Configuration resolve(ModuleFinder finder, Set&lt;String&gt; roots) {
<span class="line-modified"> 297         return Configuration.empty().resolveAndBind(finder, ModuleFinder.of(), roots);</span>
 298     }
 299 
 300     /**
 301      * Returns the list of ModuleInfo objects that correspond to the modules in
 302      * the given configuration.
 303      */
 304     private List&lt;ModuleInfo&gt; sublist(List&lt;ModuleInfo&gt; moduleInfos, Configuration cf) {
 305         Set&lt;String&gt; names = cf.modules()
 306                 .stream()
 307                 .map(ResolvedModule::name)
 308                 .collect(Collectors.toSet());
 309         return moduleInfos.stream()
 310                 .filter(mi -&gt; names.contains(mi.moduleName()))
 311                 .collect(Collectors.toList());
 312     }
 313 
 314     /**
 315      * Generate a SystemModules implementation class and add it as a resource.
 316      *
 317      * @return the name of the class resource added to the pool
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  44 import java.util.Collection;
  45 import java.util.Collections;
  46 import java.util.EnumSet;
  47 import java.util.HashMap;
  48 import java.util.HashSet;
  49 import java.util.LinkedHashMap;
  50 import java.util.List;
  51 import java.util.Map;
  52 import java.util.Objects;
  53 import java.util.Optional;
  54 import java.util.Set;
  55 import java.util.TreeMap;
  56 import java.util.TreeSet;
  57 import java.util.function.IntSupplier;
  58 import java.util.function.Supplier;
  59 import java.util.stream.Collectors;
  60 
  61 import jdk.internal.module.Checks;
  62 import jdk.internal.module.DefaultRoots;
  63 import jdk.internal.module.IllegalAccessMaps;
<span class="line-added">  64 import jdk.internal.module.Modules;</span>
  65 import jdk.internal.module.ModuleHashes;
  66 import jdk.internal.module.ModuleInfo.Attributes;
  67 import jdk.internal.module.ModuleInfoExtender;
  68 import jdk.internal.module.ModuleReferenceImpl;
  69 import jdk.internal.module.ModuleResolution;
  70 import jdk.internal.module.ModuleTarget;
  71 
  72 import jdk.internal.org.objectweb.asm.ClassReader;
  73 import jdk.internal.org.objectweb.asm.ClassVisitor;
  74 import jdk.internal.org.objectweb.asm.ClassWriter;
  75 import jdk.internal.org.objectweb.asm.MethodVisitor;
  76 import jdk.internal.org.objectweb.asm.ModuleVisitor;
  77 import jdk.internal.org.objectweb.asm.Opcodes;
  78 import static jdk.internal.org.objectweb.asm.Opcodes.*;
  79 
  80 import jdk.tools.jlink.internal.ModuleSorter;
  81 import jdk.tools.jlink.plugin.Plugin;
  82 import jdk.tools.jlink.plugin.PluginException;
  83 import jdk.tools.jlink.plugin.ResourcePool;
  84 import jdk.tools.jlink.plugin.ResourcePoolBuilder;
</pre>
<hr />
<pre>
 275                     rn = genSystemModulesClass(sublist(moduleInfos, cf), cf, cn, out);
 276                     map.put(moduleName, cn);
 277                     generated.add(rn);
 278                 }
 279             }
 280         }
 281 
 282         // generate SystemModulesMap
 283         rn = genSystemModulesMapClass(ALL_SYSTEM_MODULES_CLASS,
 284                                       defaultSystemModulesClassName,
 285                                       map,
 286                                       out);
 287         generated.add(rn);
 288 
 289         // return the resource names of the generated classes
 290         return generated;
 291     }
 292 
 293     /**
 294      * Resolves a collection of root modules, with service binding, to create
<span class="line-modified"> 295      * a Configuration for the boot layer.</span>
 296      */
 297     private Configuration resolve(ModuleFinder finder, Set&lt;String&gt; roots) {
<span class="line-modified"> 298         return Modules.newBootLayerConfiguration(finder, roots, null);</span>
 299     }
 300 
 301     /**
 302      * Returns the list of ModuleInfo objects that correspond to the modules in
 303      * the given configuration.
 304      */
 305     private List&lt;ModuleInfo&gt; sublist(List&lt;ModuleInfo&gt; moduleInfos, Configuration cf) {
 306         Set&lt;String&gt; names = cf.modules()
 307                 .stream()
 308                 .map(ResolvedModule::name)
 309                 .collect(Collectors.toSet());
 310         return moduleInfos.stream()
 311                 .filter(mi -&gt; names.contains(mi.moduleName()))
 312                 .collect(Collectors.toList());
 313     }
 314 
 315     /**
 316      * Generate a SystemModules implementation class and add it as a resource.
 317      *
 318      * @return the name of the class resource added to the pool
</pre>
</td>
</tr>
</table>
<center><a href="PluginsResourceBundle.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../plugin/Plugin.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>