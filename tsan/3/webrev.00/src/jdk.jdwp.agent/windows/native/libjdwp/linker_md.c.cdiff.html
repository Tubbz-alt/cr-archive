<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.jdwp.agent/windows/native/libjdwp/linker_md.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../libdt_socket/socket_md.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.jfr/share/classes/jdk/jfr/FlightRecorder.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdwp.agent/windows/native/libjdwp/linker_md.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 35,34 ***</span>
  #include &lt;io.h&gt;
  #include &lt;stdlib.h&gt;
  
  #include &quot;sys.h&quot;
  
  #include &quot;path_md.h&quot;
  
  static void dll_build_name(char* buffer, size_t buflen,
                             const char* paths, const char* fname) {
      char *path, *paths_copy, *next_token;
  
<span class="line-modified">!     paths_copy = strdup(paths);</span>
      if (paths_copy == NULL) {
          return;
      }
  
      next_token = NULL;
      path = strtok_s(paths_copy, PATH_SEPARATOR, &amp;next_token);
  
      while (path != NULL) {
<span class="line-modified">!         _snprintf(buffer, buflen, &quot;%s\\%s.dll&quot;, path, fname);</span>
<span class="line-modified">!         if (_access(buffer, 0) == 0) {</span>
              break;
          }
          *buffer = &#39;\0&#39;;
          path = strtok_s(NULL, PATH_SEPARATOR, &amp;next_token);
      }
  
<span class="line-modified">!     free(paths_copy);</span>
  }
  
  /*
   * From system_md.c v1.54
   */
<span class="line-new-header">--- 35,40 ---</span>
  #include &lt;io.h&gt;
  #include &lt;stdlib.h&gt;
  
  #include &quot;sys.h&quot;
  
<span class="line-added">+ #include &quot;util.h&quot;</span>
  #include &quot;path_md.h&quot;
  
  static void dll_build_name(char* buffer, size_t buflen,
                             const char* paths, const char* fname) {
      char *path, *paths_copy, *next_token;
<span class="line-added">+     *buffer = &#39;\0&#39;;</span>
  
<span class="line-modified">!     paths_copy = jvmtiAllocate((int)strlen(paths) + 1);</span>
<span class="line-added">+     strcpy(paths_copy, paths);</span>
      if (paths_copy == NULL) {
          return;
      }
  
      next_token = NULL;
      path = strtok_s(paths_copy, PATH_SEPARATOR, &amp;next_token);
  
      while (path != NULL) {
<span class="line-modified">!         size_t result_len = (size_t)_snprintf(buffer, buflen, &quot;%s\\%s.dll&quot;, path, fname);</span>
<span class="line-modified">!         if (result_len &gt;= buflen) {</span>
<span class="line-added">+             EXIT_ERROR(JVMTI_ERROR_INVALID_LOCATION, &quot;One or more of the library paths supplied to jdwp, &quot;</span>
<span class="line-added">+                                                      &quot;likely by sun.boot.library.path, is too long.&quot;);</span>
<span class="line-added">+         } else if (_access(buffer, 0) == 0) {</span>
              break;
          }
          *buffer = &#39;\0&#39;;
          path = strtok_s(NULL, PATH_SEPARATOR, &amp;next_token);
      }
  
<span class="line-modified">!     jvmtiDeallocate(paths_copy);</span>
  }
  
  /*
   * From system_md.c v1.54
   */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 105,17 ***</span>
  void
  dbgsysBuildLibName(char *holder, int holderlen, const char *pname, const char *fname)
  {
      const int pnamelen = pname ? (int)strlen(pname) : 0;
  
<span class="line-removed">-     *holder = &#39;\0&#39;;</span>
<span class="line-removed">-     /* Quietly truncates on buffer overflow. Should be an error. */</span>
<span class="line-removed">-     if (pnamelen + (int)strlen(fname) + 10 &gt; holderlen) {</span>
<span class="line-removed">-         return;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
      if (pnamelen == 0) {
          sprintf(holder, &quot;%s.dll&quot;, fname);
      } else {
        dll_build_name(holder, holderlen, pname, fname);
      }
  }
<span class="line-new-header">--- 111,15 ---</span>
  void
  dbgsysBuildLibName(char *holder, int holderlen, const char *pname, const char *fname)
  {
      const int pnamelen = pname ? (int)strlen(pname) : 0;
  
      if (pnamelen == 0) {
<span class="line-added">+         if (pnamelen + (int)strlen(fname) + 10 &gt; holderlen) {</span>
<span class="line-added">+                 EXIT_ERROR(JVMTI_ERROR_INVALID_LOCATION, &quot;One or more of the library paths supplied to jdwp, &quot;</span>
<span class="line-added">+                                                          &quot;likely by sun.boot.library.path, is too long.&quot;);</span>
<span class="line-added">+         }</span>
          sprintf(holder, &quot;%s.dll&quot;, fname);
      } else {
        dll_build_name(holder, holderlen, pname, fname);
      }
  }
</pre>
<center><a href="../libdt_socket/socket_md.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.jfr/share/classes/jdk/jfr/FlightRecorder.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>