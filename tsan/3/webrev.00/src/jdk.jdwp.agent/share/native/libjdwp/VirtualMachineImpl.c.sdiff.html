<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jdwp.agent/share/native/libjdwp/VirtualMachineImpl.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="ThreadReferenceImpl.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="VirtualMachineImpl.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdwp.agent/share/native/libjdwp/VirtualMachineImpl.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;util.h&quot;
 27 #include &quot;VirtualMachineImpl.h&quot;
 28 #include &quot;commonRef.h&quot;
 29 #include &quot;inStream.h&quot;
 30 #include &quot;outStream.h&quot;
 31 #include &quot;eventHandler.h&quot;
 32 #include &quot;eventHelper.h&quot;
 33 #include &quot;threadControl.h&quot;
 34 #include &quot;SDE.h&quot;
 35 #include &quot;FrameID.h&quot;
 36 
 37 static char *versionName = &quot;Java Debug Wire Protocol (Reference Implementation)&quot;;
<span class="line-removed"> 38 static int majorVersion = 11;  /* JDWP major version */</span>
<span class="line-removed"> 39 static int minorVersion = 0;  /* JDWP minor version */</span>
 40 
 41 static jboolean
 42 version(PacketInputStream *in, PacketOutputStream *out)
 43 {
 44     char buf[500];
 45     char *vmName;
 46     char *vmVersion;
 47     char *vmInfo;
 48 




 49     if (gdata-&gt;vmDead) {
 50         outStream_setError(out, JDWP_ERROR(VM_DEAD));
 51         return JNI_TRUE;
 52     }
 53 
 54     vmVersion = gdata-&gt;property_java_version;
 55     if (vmVersion == NULL) {
 56         vmVersion = &quot;&lt;unknown&gt;&quot;;
 57     }
 58     vmName = gdata-&gt;property_java_vm_name;
 59     if (vmName == NULL) {
 60         vmName = &quot;&lt;unknown&gt;&quot;;
 61     }
 62     vmInfo = gdata-&gt;property_java_vm_info;
 63     if (vmInfo == NULL) {
 64         vmInfo = &quot;&lt;unknown&gt;&quot;;
 65     }
 66 
 67     /*
 68      * Write the descriptive version information
</pre>
<hr />
<pre>
908         commonRef_releaseMultiple(env, id, refCount);
909     }
910 
911     return JNI_TRUE;
912 }
913 
914 static jboolean
915 holdEvents(PacketInputStream *in, PacketOutputStream *out)
916 {
917     eventHelper_holdEvents();
918     return JNI_TRUE;
919 }
920 
921 static jboolean
922 releaseEvents(PacketInputStream *in, PacketOutputStream *out)
923 {
924     eventHelper_releaseEvents();
925     return JNI_TRUE;
926 }
927 
<span class="line-modified">928 void *VirtualMachine_Cmds[] = { (void *)22</span>
<span class="line-modified">929     ,(void *)version</span>
<span class="line-modified">930     ,(void *)classesForSignature</span>
<span class="line-modified">931     ,(void *)allClasses</span>
<span class="line-modified">932     ,(void *)getAllThreads</span>
<span class="line-modified">933     ,(void *)topLevelThreadGroups</span>
<span class="line-modified">934     ,(void *)dispose</span>
<span class="line-modified">935     ,(void *)idSizes</span>
<span class="line-modified">936     ,(void *)suspend</span>
<span class="line-modified">937     ,(void *)resume</span>
<span class="line-modified">938     ,(void *)doExit</span>
<span class="line-modified">939     ,(void *)createString</span>
<span class="line-modified">940     ,(void *)capabilities</span>
<span class="line-modified">941     ,(void *)classPaths</span>
<span class="line-modified">942     ,(void *)disposeObjects</span>
<span class="line-modified">943     ,(void *)holdEvents</span>
<span class="line-modified">944     ,(void *)releaseEvents</span>
<span class="line-modified">945     ,(void *)capabilitiesNew</span>
<span class="line-modified">946     ,(void *)redefineClasses</span>
<span class="line-modified">947     ,(void *)setDefaultStratum</span>
<span class="line-modified">948     ,(void *)allClassesWithGeneric</span>
<span class="line-modified">949     ,(void *)instanceCounts</span>
<span class="line-modified">950     ,(void *)allModules</span>
951 };


</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 1998, 2020, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 #include &quot;util.h&quot;
 27 #include &quot;VirtualMachineImpl.h&quot;
 28 #include &quot;commonRef.h&quot;
 29 #include &quot;inStream.h&quot;
 30 #include &quot;outStream.h&quot;
 31 #include &quot;eventHandler.h&quot;
 32 #include &quot;eventHelper.h&quot;
 33 #include &quot;threadControl.h&quot;
 34 #include &quot;SDE.h&quot;
 35 #include &quot;FrameID.h&quot;
 36 
 37 static char *versionName = &quot;Java Debug Wire Protocol (Reference Implementation)&quot;;


 38 
 39 static jboolean
 40 version(PacketInputStream *in, PacketOutputStream *out)
 41 {
 42     char buf[500];
 43     char *vmName;
 44     char *vmVersion;
 45     char *vmInfo;
 46 
<span class="line-added"> 47     /* Now the JDWP versions are the same as JVMTI versions */</span>
<span class="line-added"> 48     int majorVersion = jvmtiMajorVersion();</span>
<span class="line-added"> 49     int minorVersion = 0;</span>
<span class="line-added"> 50 </span>
 51     if (gdata-&gt;vmDead) {
 52         outStream_setError(out, JDWP_ERROR(VM_DEAD));
 53         return JNI_TRUE;
 54     }
 55 
 56     vmVersion = gdata-&gt;property_java_version;
 57     if (vmVersion == NULL) {
 58         vmVersion = &quot;&lt;unknown&gt;&quot;;
 59     }
 60     vmName = gdata-&gt;property_java_vm_name;
 61     if (vmName == NULL) {
 62         vmName = &quot;&lt;unknown&gt;&quot;;
 63     }
 64     vmInfo = gdata-&gt;property_java_vm_info;
 65     if (vmInfo == NULL) {
 66         vmInfo = &quot;&lt;unknown&gt;&quot;;
 67     }
 68 
 69     /*
 70      * Write the descriptive version information
</pre>
<hr />
<pre>
910         commonRef_releaseMultiple(env, id, refCount);
911     }
912 
913     return JNI_TRUE;
914 }
915 
916 static jboolean
917 holdEvents(PacketInputStream *in, PacketOutputStream *out)
918 {
919     eventHelper_holdEvents();
920     return JNI_TRUE;
921 }
922 
923 static jboolean
924 releaseEvents(PacketInputStream *in, PacketOutputStream *out)
925 {
926     eventHelper_releaseEvents();
927     return JNI_TRUE;
928 }
929 
<span class="line-modified">930 Command VirtualMachine_Commands[] = {</span>
<span class="line-modified">931     {version, &quot;Version&quot;},</span>
<span class="line-modified">932     {classesForSignature, &quot;ClassesForSignature&quot;},</span>
<span class="line-modified">933     {allClasses, &quot;AllClasses&quot;},</span>
<span class="line-modified">934     {getAllThreads, &quot;GetAllThreads&quot;},</span>
<span class="line-modified">935     {topLevelThreadGroups, &quot;TopLevelThreadGroups&quot;},</span>
<span class="line-modified">936     {dispose, &quot;Dispose&quot;},</span>
<span class="line-modified">937     {idSizes, &quot;IDSizes&quot;},</span>
<span class="line-modified">938     {suspend, &quot;Suspend&quot;},</span>
<span class="line-modified">939     {resume, &quot;Resume&quot;},</span>
<span class="line-modified">940     {doExit, &quot;DoExit&quot;},</span>
<span class="line-modified">941     {createString, &quot;CreateString&quot;},</span>
<span class="line-modified">942     {capabilities, &quot;Capabilities&quot;},</span>
<span class="line-modified">943     {classPaths, &quot;ClassPaths&quot;},</span>
<span class="line-modified">944     {disposeObjects, &quot;DisposeObjects&quot;},</span>
<span class="line-modified">945     {holdEvents, &quot;HoldEvents&quot;},</span>
<span class="line-modified">946     {releaseEvents, &quot;ReleaseEvents&quot;},</span>
<span class="line-modified">947     {capabilitiesNew, &quot;CapabilitiesNew&quot;},</span>
<span class="line-modified">948     {redefineClasses, &quot;RedefineClasses&quot;},</span>
<span class="line-modified">949     {setDefaultStratum, &quot;SetDefaultStratum&quot;},</span>
<span class="line-modified">950     {allClassesWithGeneric, &quot;AllClassesWithGeneric&quot;},</span>
<span class="line-modified">951     {instanceCounts, &quot;InstanceCounts&quot;},</span>
<span class="line-modified">952     {allModules, &quot;AllModules&quot;}</span>
953 };
<span class="line-added">954 </span>
<span class="line-added">955 DEBUG_DISPATCH_DEFINE_CMDSET(VirtualMachine)</span>
</pre>
</td>
</tr>
</table>
<center><a href="ThreadReferenceImpl.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="VirtualMachineImpl.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>