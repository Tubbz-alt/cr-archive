<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.jdwp.agent/unix/native/libjdwp/linker_md.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../libdt_socket/socket_md.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../windows/native/libdt_socket/socket_md.c.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jdwp.agent/unix/native/libjdwp/linker_md.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -32,10 +32,11 @@</span>
  #include &lt;dlfcn.h&gt;
  #include &lt;unistd.h&gt;
  #include &lt;stdlib.h&gt;
  #include &lt;string.h&gt;
  
<span class="udiff-line-added">+ #include &quot;util.h&quot;</span>
  #include &quot;path_md.h&quot;
  
  #ifdef __APPLE__
  #define LIB_SUFFIX &quot;dylib&quot;
  #else
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -43,29 +44,34 @@</span>
  #endif
  
  static void dll_build_name(char* buffer, size_t buflen,
                             const char* paths, const char* fname) {
      char *path, *paths_copy, *next_token;
<span class="udiff-line-added">+     *buffer = &#39;\0&#39;;</span>
  
<span class="udiff-line-modified-removed">-     paths_copy = strdup(paths);</span>
<span class="udiff-line-modified-added">+     paths_copy = jvmtiAllocate((int)strlen(paths) + 1);</span>
<span class="udiff-line-added">+     strcpy(paths_copy, paths);</span>
      if (paths_copy == NULL) {
          return;
      }
  
      next_token = NULL;
      path = strtok_r(paths_copy, PATH_SEPARATOR, &amp;next_token);
  
      while (path != NULL) {
<span class="udiff-line-modified-removed">-         snprintf(buffer, buflen, &quot;%s/lib%s.&quot; LIB_SUFFIX, path, fname);</span>
<span class="udiff-line-modified-removed">-         if (access(buffer, F_OK) == 0) {</span>
<span class="udiff-line-modified-added">+         size_t result_len = (size_t)snprintf(buffer, buflen, &quot;%s/lib%s.&quot; LIB_SUFFIX, path, fname);</span>
<span class="udiff-line-modified-added">+         if (result_len &gt;= buflen) {</span>
<span class="udiff-line-added">+             EXIT_ERROR(JVMTI_ERROR_INVALID_LOCATION, &quot;One or more of the library paths supplied to jdwp, &quot;</span>
<span class="udiff-line-added">+                                                      &quot;likely by sun.boot.library.path, is too long.&quot;);</span>
<span class="udiff-line-added">+         } else if (access(buffer, F_OK) == 0) {</span>
              break;
          }
          *buffer = &#39;\0&#39;;
          path = strtok_r(NULL, PATH_SEPARATOR, &amp;next_token);
      }
  
<span class="udiff-line-modified-removed">-     free(paths_copy);</span>
<span class="udiff-line-modified-added">+     jvmtiDeallocate(paths_copy);</span>
  }
  
  /*
   * create a string for the JNI native function name by adding the
   * appropriate decorations.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -87,17 +93,15 @@</span>
  dbgsysBuildLibName(char *holder, int holderlen, const char *pname,
                     const char *fname)
  {
      const int pnamelen = pname ? strlen(pname) : 0;
  
<span class="udiff-line-removed">-     *holder = &#39;\0&#39;;</span>
<span class="udiff-line-removed">-     // Quietly truncate on buffer overflow.  Should be an error.</span>
<span class="udiff-line-removed">-     if (pnamelen + (int)strlen(fname) + 10 &gt; holderlen) {</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      if (pnamelen == 0) {
<span class="udiff-line-added">+         if (pnamelen + (int)strlen(fname) + 10 &gt; holderlen) {</span>
<span class="udiff-line-added">+             EXIT_ERROR(JVMTI_ERROR_INVALID_LOCATION, &quot;One or more of the library paths supplied to jdwp, &quot;</span>
<span class="udiff-line-added">+                                                      &quot;likely by sun.boot.library.path, is too long.&quot;);</span>
<span class="udiff-line-added">+         }</span>
          (void)snprintf(holder, holderlen, &quot;lib%s.&quot; LIB_SUFFIX, fname);
      } else {
        dll_build_name(holder, holderlen, pname, fname);
      }
  }
</pre>
<center><a href="../libdt_socket/socket_md.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../windows/native/libdt_socket/socket_md.c.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>