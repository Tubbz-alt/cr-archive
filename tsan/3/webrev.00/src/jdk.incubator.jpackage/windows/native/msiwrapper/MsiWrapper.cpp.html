<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New src/jdk.incubator.jpackage/windows/native/msiwrapper/MsiWrapper.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 #include &lt;algorithm&gt;
 2 #include &lt;windows.h&gt;
 3 
 4 #include &quot;SysInfo.h&quot;
 5 #include &quot;FileUtils.h&quot;
 6 #include &quot;Executor.h&quot;
 7 #include &quot;Resources.h&quot;
 8 #include &quot;WinErrorHandling.h&quot;
 9 
10 
11 int __stdcall WinMain(HINSTANCE, HINSTANCE, LPSTR lpCmdLine, int nShowCmd)
12 {
13     JP_TRY;
14 
15     // Create temporary directory where to extract msi file.
16     const auto tempMsiDir = FileUtils::createTempDirectory();
17 
18     // Schedule temporary directory for deletion.
19     FileUtils::Deleter cleaner;
20     cleaner.appendRecursiveDirectory(tempMsiDir);
21 
22     const auto msiPath = FileUtils::mkpath() &lt;&lt; tempMsiDir &lt;&lt; L&quot;main.msi&quot;;
23 
24     // Extract msi file.
25     Resource(L&quot;msi&quot;, RT_RCDATA).saveToFile(msiPath);
26 
27     // Setup executor to run msiexec
28     Executor msiExecutor(SysInfo::getWIPath());
29     msiExecutor.arg(L&quot;/i&quot;).arg(msiPath);
30     const auto args = SysInfo::getCommandArgs();
31     std::for_each(args.begin(), args.end(),
32             [&amp;msiExecutor] (const tstring&amp; arg) {
33         msiExecutor.arg(arg);
34     });
35 
36     // Install msi file.
37     return msiExecutor.execAndWaitForExit();
38 
39     JP_CATCH_ALL;
40 
41     return -1;
42 }
    </pre>
  </body>
</html>