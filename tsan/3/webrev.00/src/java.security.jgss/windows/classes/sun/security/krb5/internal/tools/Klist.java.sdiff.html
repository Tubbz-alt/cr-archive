<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.jgss/windows/classes/sun/security/krb5/internal/tools/Klist.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="KinitOptions.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../native/libw2k_lsa_auth/NativeCreds.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/windows/classes/sun/security/krb5/internal/tools/Klist.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 /*
 27  *  (C) Copyright IBM Corp. 1999 All Rights Reserved.
 28  *  Copyright 1997 The Open Group Research Institute.  All rights reserved.
 29  */
 30 
 31 package sun.security.krb5.internal.tools;
 32 
 33 import java.net.InetAddress;


 34 import sun.security.krb5.*;
 35 import sun.security.krb5.internal.*;
 36 import sun.security.krb5.internal.ccache.*;
 37 import sun.security.krb5.internal.ktab.*;
 38 import sun.security.krb5.internal.crypto.EType;
 39 
 40 /**
 41  * This class can execute as a command-line tool to list entries in
 42  * credential cache and key tab.
 43  *
 44  * @author Yanni Zhang
 45  * @author Ram Marti
 46  */
 47 public class Klist {
 48     Object target;
 49     // for credentials cache, options are &#39;f&#39;, &#39;e&#39;, &#39;a&#39; and &#39;n&#39;;
 50     // for  keytab, optionsare &#39;t&#39; and &#39;K&#39; and &#39;e&#39;
 51     char[] options = new char[4];
 52     String name;       // the name of credentials cache and keytable.
 53     char action;       // actions would be &#39;c&#39; for credentials cache
</pre>
<hr />
<pre>
232         }
233         System.out.println(&quot;\nCredentials cache: &quot; +  name);
234         String defaultPrincipal = cache.getPrimaryPrincipal().toString();
235         int num = creds.length;
236 
237         if (num == 1)
238             System.out.println(&quot;\nDefault principal: &quot; +
239                                defaultPrincipal + &quot;, &quot; +
240                                creds.length + &quot; entry found.\n&quot;);
241         else
242             System.out.println(&quot;\nDefault principal: &quot; +
243                                defaultPrincipal + &quot;, &quot; +
244                                creds.length + &quot; entries found.\n&quot;);
245         if (creds != null) {
246             for (int i = 0; i &lt; creds.length; i++) {
247                 try {
248                     String starttime;
249                     String endtime;
250                     String renewTill;
251                     String servicePrincipal;


252                     if (creds[i].getStartTime() != null) {
253                         starttime = format(creds[i].getStartTime());
254                     } else {
255                         starttime = format(creds[i].getAuthTime());
256                     }
257                     endtime = format(creds[i].getEndTime());
258                     servicePrincipal =
259                         creds[i].getServicePrincipal().toString();
260                     System.out.println(&quot;[&quot; + (i + 1) + &quot;] &quot; +
261                                        &quot; Service Principal:  &quot; +
262                                        servicePrincipal);












263                     System.out.println(&quot;     Valid starting:     &quot; + starttime);
264                     System.out.println(&quot;     Expires:            &quot; + endtime);
265                     if (creds[i].getRenewTill() != null) {
266                         renewTill = format(creds[i].getRenewTill());
267                         System.out.println(
268                                 &quot;     Renew until:        &quot; + renewTill);
269                     }
270                     if (options[0] == &#39;e&#39;) {
271                         String eskey = EType.toString(creds[i].getEType());
272                         String etkt = EType.toString(creds[i].getTktEType());
<span class="line-modified">273                         System.out.println(&quot;     EType (skey, tkt):  &quot;</span>
<span class="line-modified">274                                 + eskey + &quot;, &quot; + etkt);</span>







275                     }
276                     if (options[1] == &#39;f&#39;) {
277                         System.out.println(&quot;     Flags:              &quot; +
278                                            creds[i].getTicketFlags().toString());
279                     }
280                     if (options[2] == &#39;a&#39;) {
281                         boolean first = true;
282                         InetAddress[] caddr
283                                 = creds[i].setKrbCreds().getClientAddresses();
284                         if (caddr != null) {
285                             for (InetAddress ia: caddr) {
286                                 String out;
287                                 if (options[3] == &#39;n&#39;) {
288                                     out = ia.getHostAddress();
289                                 } else {
290                                     out = ia.getCanonicalHostName();
291                                 }
292                                 System.out.println(&quot;     &quot; +
293                                         (first?&quot;Addresses:&quot;:&quot;          &quot;) +
294                                         &quot;       &quot; + out);
295                                 first = false;
296                             }
297                         } else {
298                             System.out.println(&quot;     [No host addresses info]&quot;);
299                         }
300                     }
301                 } catch (RealmException e) {
302                     System.out.println(&quot;Error reading principal from &quot;+
303                                        &quot;the entry.&quot;);
304                     if (DEBUG) {
305                         e.printStackTrace();
306                     }
307                     System.exit(-1);
308                 }
309             }
310         } else {
311             System.out.println(&quot;\nNo entries found.&quot;);
312         }









313     }
314 
315     void displayMessage(String target) {
316         if (name == null) {
317             System.out.println(&quot;Default &quot; + target + &quot; not found.&quot;);
318         } else {
319             System.out.println(target + &quot; &quot; + name + &quot; not found.&quot;);
320         }
321     }
322     /**
323      * Reformats the date from the form -
324      *     dow mon dd hh:mm:ss zzz yyyy to mon/dd/yyyy hh:mm
325      * where dow is the day of the week, mon is the month,
326      * dd is the day of the month, hh is the hour of
327      * the day, mm is the minute within the hour,
328      * ss is the second within the minute, zzz is the time zone,
329      * and yyyy is the year.
330      * @param date the string form of Date object.
331      */
332     private String format(KerberosTime kt) {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 /*
 27  *  (C) Copyright IBM Corp. 1999 All Rights Reserved.
 28  *  Copyright 1997 The Open Group Research Institute.  All rights reserved.
 29  */
 30 
 31 package sun.security.krb5.internal.tools;
 32 
 33 import java.net.InetAddress;
<span class="line-added"> 34 import java.util.List;</span>
<span class="line-added"> 35 </span>
 36 import sun.security.krb5.*;
 37 import sun.security.krb5.internal.*;
 38 import sun.security.krb5.internal.ccache.*;
 39 import sun.security.krb5.internal.ktab.*;
 40 import sun.security.krb5.internal.crypto.EType;
 41 
 42 /**
 43  * This class can execute as a command-line tool to list entries in
 44  * credential cache and key tab.
 45  *
 46  * @author Yanni Zhang
 47  * @author Ram Marti
 48  */
 49 public class Klist {
 50     Object target;
 51     // for credentials cache, options are &#39;f&#39;, &#39;e&#39;, &#39;a&#39; and &#39;n&#39;;
 52     // for  keytab, optionsare &#39;t&#39; and &#39;K&#39; and &#39;e&#39;
 53     char[] options = new char[4];
 54     String name;       // the name of credentials cache and keytable.
 55     char action;       // actions would be &#39;c&#39; for credentials cache
</pre>
<hr />
<pre>
234         }
235         System.out.println(&quot;\nCredentials cache: &quot; +  name);
236         String defaultPrincipal = cache.getPrimaryPrincipal().toString();
237         int num = creds.length;
238 
239         if (num == 1)
240             System.out.println(&quot;\nDefault principal: &quot; +
241                                defaultPrincipal + &quot;, &quot; +
242                                creds.length + &quot; entry found.\n&quot;);
243         else
244             System.out.println(&quot;\nDefault principal: &quot; +
245                                defaultPrincipal + &quot;, &quot; +
246                                creds.length + &quot; entries found.\n&quot;);
247         if (creds != null) {
248             for (int i = 0; i &lt; creds.length; i++) {
249                 try {
250                     String starttime;
251                     String endtime;
252                     String renewTill;
253                     String servicePrincipal;
<span class="line-added">254                     PrincipalName servicePrincipal2;</span>
<span class="line-added">255                     String clientPrincipal;</span>
256                     if (creds[i].getStartTime() != null) {
257                         starttime = format(creds[i].getStartTime());
258                     } else {
259                         starttime = format(creds[i].getAuthTime());
260                     }
261                     endtime = format(creds[i].getEndTime());
262                     servicePrincipal =
263                         creds[i].getServicePrincipal().toString();
264                     System.out.println(&quot;[&quot; + (i + 1) + &quot;] &quot; +
265                                        &quot; Service Principal:  &quot; +
266                                        servicePrincipal);
<span class="line-added">267                     servicePrincipal2 =</span>
<span class="line-added">268                             creds[i].getServicePrincipal2();</span>
<span class="line-added">269                     if (servicePrincipal2 != null) {</span>
<span class="line-added">270                         System.out.println(&quot;     Second Service:     &quot;</span>
<span class="line-added">271                                 + servicePrincipal2);</span>
<span class="line-added">272                     }</span>
<span class="line-added">273                     clientPrincipal =</span>
<span class="line-added">274                             creds[i].getClientPrincipal().toString();</span>
<span class="line-added">275                     if (!clientPrincipal.equals(defaultPrincipal)) {</span>
<span class="line-added">276                         System.out.println(&quot;     Client Principal:   &quot; +</span>
<span class="line-added">277                                 clientPrincipal);</span>
<span class="line-added">278                     }</span>
279                     System.out.println(&quot;     Valid starting:     &quot; + starttime);
280                     System.out.println(&quot;     Expires:            &quot; + endtime);
281                     if (creds[i].getRenewTill() != null) {
282                         renewTill = format(creds[i].getRenewTill());
283                         System.out.println(
284                                 &quot;     Renew until:        &quot; + renewTill);
285                     }
286                     if (options[0] == &#39;e&#39;) {
287                         String eskey = EType.toString(creds[i].getEType());
288                         String etkt = EType.toString(creds[i].getTktEType());
<span class="line-modified">289                         if (creds[i].getTktEType2() == 0) {</span>
<span class="line-modified">290                             System.out.println(&quot;     EType (skey, tkt):  &quot;</span>
<span class="line-added">291                                     + eskey + &quot;, &quot; + etkt);</span>
<span class="line-added">292                         } else {</span>
<span class="line-added">293                             String etkt2 = EType.toString(creds[i].getTktEType2());</span>
<span class="line-added">294                             System.out.println(&quot;     EType (skey, tkts): &quot;</span>
<span class="line-added">295                                     + eskey + &quot;, &quot; + etkt</span>
<span class="line-added">296                                     + &quot;, &quot; + etkt2);</span>
<span class="line-added">297                         }</span>
298                     }
299                     if (options[1] == &#39;f&#39;) {
300                         System.out.println(&quot;     Flags:              &quot; +
301                                            creds[i].getTicketFlags().toString());
302                     }
303                     if (options[2] == &#39;a&#39;) {
304                         boolean first = true;
305                         InetAddress[] caddr
306                                 = creds[i].setKrbCreds().getClientAddresses();
307                         if (caddr != null) {
308                             for (InetAddress ia: caddr) {
309                                 String out;
310                                 if (options[3] == &#39;n&#39;) {
311                                     out = ia.getHostAddress();
312                                 } else {
313                                     out = ia.getCanonicalHostName();
314                                 }
315                                 System.out.println(&quot;     &quot; +
316                                         (first?&quot;Addresses:&quot;:&quot;          &quot;) +
317                                         &quot;       &quot; + out);
318                                 first = false;
319                             }
320                         } else {
321                             System.out.println(&quot;     [No host addresses info]&quot;);
322                         }
323                     }
324                 } catch (RealmException e) {
325                     System.out.println(&quot;Error reading principal from &quot;+
326                                        &quot;the entry.&quot;);
327                     if (DEBUG) {
328                         e.printStackTrace();
329                     }
330                     System.exit(-1);
331                 }
332             }
333         } else {
334             System.out.println(&quot;\nNo entries found.&quot;);
335         }
<span class="line-added">336 </span>
<span class="line-added">337         List&lt;CredentialsCache.ConfigEntry&gt; configEntries</span>
<span class="line-added">338                 = cache.getConfigEntries();</span>
<span class="line-added">339         if (configEntries != null &amp;&amp; !configEntries.isEmpty()) {</span>
<span class="line-added">340             System.out.println(&quot;\nConfig entries:&quot;);</span>
<span class="line-added">341             for (CredentialsCache.ConfigEntry e : configEntries) {</span>
<span class="line-added">342                 System.out.println(&quot;     &quot; + e);</span>
<span class="line-added">343             }</span>
<span class="line-added">344         }</span>
345     }
346 
347     void displayMessage(String target) {
348         if (name == null) {
349             System.out.println(&quot;Default &quot; + target + &quot; not found.&quot;);
350         } else {
351             System.out.println(target + &quot; &quot; + name + &quot; not found.&quot;);
352         }
353     }
354     /**
355      * Reformats the date from the form -
356      *     dow mon dd hh:mm:ss zzz yyyy to mon/dd/yyyy hh:mm
357      * where dow is the day of the week, mon is the month,
358      * dd is the day of the month, hh is the hour of
359      * the day, mm is the minute within the hour,
360      * ss is the second within the minute, zzz is the time zone,
361      * and yyyy is the year.
362      * @param date the string form of Date object.
363      */
364     private String format(KerberosTime kt) {
</pre>
</td>
</tr>
</table>
<center><a href="KinitOptions.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../native/libw2k_lsa_auth/NativeCreds.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>