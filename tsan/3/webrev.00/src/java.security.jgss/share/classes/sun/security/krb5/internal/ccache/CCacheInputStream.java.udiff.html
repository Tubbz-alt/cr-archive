<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.security.jgss/share/classes/sun/security/krb5/internal/ccache/CCacheInputStream.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../TicketFlags.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="CCacheOutputStream.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/classes/sun/security/krb5/internal/ccache/CCacheInputStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -126,11 +126,11 @@</span>
           */
          if (version == KRB5_FCC_FVNO_1)
              length--;
          for (int i = 0; i &lt;= length; i++) {
              namelength = readLength4();
<span class="udiff-line-modified-removed">-             byte[] bytes = IOUtils.readFully(this, namelength, true);</span>
<span class="udiff-line-modified-added">+             byte[] bytes = IOUtils.readExactlyNBytes(this, namelength);</span>
              result.add(new String(bytes));
          }
          if (result.isEmpty()) {
              throw new IOException(&quot;No realm or principal&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -184,11 +184,11 @@</span>
          int keyType, keyLen;
          keyType = read(2);
          if (version == KRB5_FCC_FVNO_3)
              read(2); /* keytype recorded twice in fvno 3 */
          keyLen = readLength4();
<span class="udiff-line-modified-removed">-         byte[] bytes = IOUtils.readFully(this, keyLen, true);</span>
<span class="udiff-line-modified-added">+         byte[] bytes = IOUtils.readExactlyNBytes(this, keyLen);</span>
          return new EncryptionKey(bytes, keyType, version);
      }
  
      long[] readTimes() throws IOException {
          long[] times = new long[4];
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -237,11 +237,11 @@</span>
              List&lt;AuthorizationDataEntry&gt; auData = new ArrayList&lt;&gt;();
              byte[] data = null;
              for (int i = 0; i &lt; num; i++) {
                  adtype = read(2);
                  adlength = readLength4();
<span class="udiff-line-modified-removed">-                 data = IOUtils.readFully(this, adlength, true);</span>
<span class="udiff-line-modified-added">+                 data = IOUtils.readExactlyNBytes(this, adlength);</span>
                  auData.add(new AuthorizationDataEntry(adtype, data));
              }
              return auData.toArray(new AuthorizationDataEntry[auData.size()]);
          }
          else return null;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -251,11 +251,11 @@</span>
          int length;
          length = readLength4();
          if (length == 0) {
              return null;
          } else {
<span class="udiff-line-modified-removed">-             return IOUtils.readFully(this, length, true);</span>
<span class="udiff-line-modified-added">+             return IOUtils.readExactlyNBytes(this, length);</span>
          }
      }
  
      boolean[] readFlags() throws IOException {
          boolean[] flags = new boolean[Krb5.TKT_OPTS_MAX+1];
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -323,20 +323,17 @@</span>
          }
          return flags;
      }
  
      /**
<span class="udiff-line-modified-removed">-      * Reads the next cred in stream.</span>
<span class="udiff-line-modified-removed">-      * @return the next cred, null if ticket or second_ticket unparseable.</span>
<span class="udiff-line-modified-added">+      * Reads the next cred or config entry in stream.</span>
<span class="udiff-line-modified-added">+      * @return the next cred or config entry, null if data unparseable.</span>
       *
<span class="udiff-line-modified-removed">-      * Note: MIT krb5 1.8.1 might generate a config entry with server principal</span>
<span class="udiff-line-modified-removed">-      * X-CACHECONF:/krb5_ccache_conf_data/fast_avail/krbtgt/REALM@REALM. The</span>
<span class="udiff-line-removed">-      * entry is used by KDC to inform the client that it support certain</span>
<span class="udiff-line-removed">-      * features. Its ticket is not a valid krb5 ticket and thus this method</span>
<span class="udiff-line-removed">-      * returns null.</span>
<span class="udiff-line-modified-added">+      * When data is unparseable, this method makes sure the correct number of</span>
<span class="udiff-line-modified-added">+      * bytes are consumed so it&#39;s safe to start reading the next element.</span>
       */
<span class="udiff-line-modified-removed">-     Credentials readCred(int version) throws IOException,RealmException, KrbApErrException, Asn1Exception {</span>
<span class="udiff-line-modified-added">+     Object readCred(int version) throws IOException,RealmException, KrbApErrException, Asn1Exception {</span>
          PrincipalName cpname = null;
          try {
              cpname = readPrincipal(version);
          } catch (Exception e) {
              // Do not return here. All data for this cred should be fully
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -394,15 +391,26 @@</span>
          if (cpname == null || spname == null) {
              return null;
          }
  
          try {
<span class="udiff-line-added">+             if (spname.getRealmString().equals(&quot;X-CACHECONF:&quot;)) {</span>
<span class="udiff-line-added">+                 String[] nameParts = spname.getNameStrings();</span>
<span class="udiff-line-added">+                 if (nameParts[0].equals(&quot;krb5_ccache_conf_data&quot;)) {</span>
<span class="udiff-line-added">+                     return new CredentialsCache.ConfigEntry(nameParts[1],</span>
<span class="udiff-line-added">+                             nameParts.length &gt; 2 ? new PrincipalName(nameParts[2]) : null,</span>
<span class="udiff-line-added">+                             ticketData);</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             }</span>
              return new Credentials(cpname, spname, key, authtime, starttime,
<span class="udiff-line-modified-removed">-                 endtime, renewTill, skey, tFlags,</span>
<span class="udiff-line-modified-removed">-                 addrs, auData,</span>
<span class="udiff-line-modified-removed">-                 ticketData != null ? new Ticket(ticketData) : null,</span>
<span class="udiff-line-modified-removed">-                 ticketData2 != null ? new Ticket(ticketData2) : null);</span>
<span class="udiff-line-modified-added">+                     endtime, renewTill, skey, tFlags,</span>
<span class="udiff-line-modified-added">+                     addrs, auData,</span>
<span class="udiff-line-modified-added">+                     ticketData != null ? new Ticket(ticketData) : null,</span>
<span class="udiff-line-modified-added">+                     ticketData2 != null ? new Ticket(ticketData2) : null);</span>
          } catch (Exception e) {     // If any of new Ticket(*) fails.
<span class="udiff-line-added">+             if (DEBUG) {</span>
<span class="udiff-line-added">+                 e.printStackTrace(System.out);</span>
<span class="udiff-line-added">+             }</span>
              return null;
          }
      }
  }
</pre>
<center><a href="../TicketFlags.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="CCacheOutputStream.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>