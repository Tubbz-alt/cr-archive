<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/java.security.jgss/share/classes/sun/security/krb5/internal/ETypeInfo.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2005, 2009, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.krb5.internal;
 27 
 28 import sun.security.util.*;
 29 import sun.security.krb5.Asn1Exception;
 30 import java.io.IOException;
 31 import sun.security.krb5.internal.util.KerberosString;
 32 
 33 /**
 34  * Implements the ASN.1 ETYPE-INFO-ENTRY type.
 35  *
 36  * ETYPE-INFO-ENTRY     ::= SEQUENCE {
 37  *         etype        [0] Int32,
 38  *         salt         [1] OCTET STRING OPTIONAL
 39  *   }
 40  *
 41  * @author Seema Malkani
 42  */
 43 
 44 public class ETypeInfo {
 45 
 46     private int etype;
 47     private String salt = null;
 48 
 49     private static final byte TAG_TYPE = 0;
 50     private static final byte TAG_VALUE = 1;
 51 
 52     private ETypeInfo() {
 53     }
 54 
 55     public ETypeInfo(int etype, String salt) {
 56         this.etype = etype;
 57         this.salt = salt;
 58     }
 59 
 60     public Object clone() {
 61         return new ETypeInfo(etype, salt);
 62     }
 63 
 64     /**
 65      * Constructs a ETypeInfo object.
 66      * @param encoding a DER-encoded data.
 67      * @exception Asn1Exception if an error occurs while decoding an
 68      *            ASN1 encoded data.
 69      * @exception IOException if an I/O error occurs while reading encoded data.
 70      */
 71     public ETypeInfo(DerValue encoding) throws Asn1Exception, IOException {
 72         DerValue der = null;
 73 
 74         if (encoding.getTag() != DerValue.tag_Sequence) {
 75             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
 76         }
 77 
 78         // etype
 79         der = encoding.getData().getDerValue();
 80         if ((der.getTag() &amp; 0x1F) == 0x00) {
 81             this.etype = der.getData().getBigInteger().intValue();
 82         }
 83         else
 84             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
 85 
 86         // salt
 87         if (encoding.getData().available() &gt; 0) {
 88             der = encoding.getData().getDerValue();
 89             if ((der.getTag() &amp; 0x1F) == 0x01) {
 90                 byte[] saltBytes = der.getData().getOctetString();
 91 
 92                 // Although salt is defined as an OCTET STRING, it&#39;s the
 93                 // encoding from of a string. As RFC 4120 says:
 94                 //
 95                 // &quot;The salt, ..., is also completely unspecified with respect
 96                 // to character set and is probably locale-specific&quot;.
 97                 //
 98                 // It&#39;s known that this field is using the same encoding as
 99                 // KerberosString in most implementations.
100 
101                 if (KerberosString.MSNAME) {
102                     this.salt = new String(saltBytes, &quot;UTF8&quot;);
103                 } else {
104                     this.salt = new String(saltBytes);
105                 }
106             }
107         }
108 
109         if (encoding.getData().available() &gt; 0)
110             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
111     }
112 
113     /**
114      * Encodes this object to an OutputStream.
115      *
116      * @return byte array of the encoded data.
117      * @exception IOException if an I/O error occurs while reading encoded data.
118      * @exception Asn1Exception on encoding errors.
119      */
120     public byte[] asn1Encode() throws Asn1Exception, IOException {
121 
122         DerOutputStream bytes = new DerOutputStream();
123         DerOutputStream temp = new DerOutputStream();
124 
125         temp.putInteger(etype);
126         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true,
127                                         TAG_TYPE), temp);
128 
129         if (salt != null) {
130             temp = new DerOutputStream();
131             if (KerberosString.MSNAME) {
132                 temp.putOctetString(salt.getBytes(&quot;UTF8&quot;));
133             } else {
134                 temp.putOctetString(salt.getBytes());
135             }
136             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true,
137                                         TAG_VALUE), temp);
138         }
139 
140         temp = new DerOutputStream();
141         temp.write(DerValue.tag_Sequence, bytes);
142         return temp.toByteArray();
143     }
144 
145     // accessor methods
146     public int getEType() {
147         return etype;
148     }
149 
150     public String getSalt() {
151         return salt;
152     }
153 
154 }
    </pre>
  </body>
</html>