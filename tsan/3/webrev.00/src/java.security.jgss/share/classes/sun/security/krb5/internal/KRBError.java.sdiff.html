<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.jgss/share/classes/sun/security/krb5/internal/KRBError.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="KDCReq.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="KerberosTime.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/classes/sun/security/krb5/internal/KRBError.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2012, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 62  *         realm           [9] Realm -- service realm --,
 63  *         sname           [10] PrincipalName -- service name --,
 64  *         e-text          [11] KerberosString OPTIONAL,
 65  *         e-data          [12] OCTET STRING OPTIONAL
 66  * }
 67  *
 68  * METHOD-DATA     ::= SEQUENCE OF PA-DATA
 69  *
 70  * TYPED-DATA      ::= SEQUENCE SIZE (1..MAX) OF SEQUENCE {
 71  *         data-type       [0] Int32,
 72  *         data-value      [1] OCTET STRING OPTIONAL
 73  * }
 74  * }&lt;/pre&gt;
 75  *
 76  * &lt;p&gt;
 77  * This definition reflects the Network Working Group RFC 4120
 78  * specification available at
 79  * &lt;a href=&quot;http://www.ietf.org/rfc/rfc4120.txt&quot;&gt;
 80  * http://www.ietf.org/rfc/rfc4120.txt&lt;/a&gt;.
 81  */
<span class="line-modified"> 82 </span>


 83 public class KRBError implements java.io.Serializable {
 84     static final long serialVersionUID = 3643809337475284503L;
 85 
 86     private int pvno;
 87     private int msgType;
 88     private KerberosTime cTime; //optional
 89     private Integer cuSec; //optional
 90     private KerberosTime sTime;
 91     private Integer suSec;
 92     private int errorCode;

 93     private PrincipalName cname; //optional
 94     private PrincipalName sname;
 95     private String eText; //optional
 96     private byte[] eData; //optional
 97     private Checksum eCksum; //optional
 98 
 99     private PAData[] pa;    // PA-DATA in eData
100 
101     private static boolean DEBUG = Krb5.DEBUG;
102 
103     private void readObject(ObjectInputStream is)
104             throws IOException, ClassNotFoundException {
105         try {
106             init(new DerValue((byte[])is.readObject()));
107             parseEData(eData);
108         } catch (Exception e) {
109             throw new IOException(e);
110         }
111     }
112 
</pre>
<hr />
<pre>
121 
122     public KRBError(
123                     APOptions new_apOptions,
124                     KerberosTime new_cTime,
125                     Integer new_cuSec,
126                     KerberosTime new_sTime,
127                     Integer new_suSec,
128                     int new_errorCode,
129                     PrincipalName new_cname,
130                     PrincipalName new_sname,
131                     String new_eText,
132                     byte[] new_eData
133                         ) throws IOException, Asn1Exception {
134         pvno = Krb5.PVNO;
135         msgType = Krb5.KRB_ERROR;
136         cTime = new_cTime;
137         cuSec = new_cuSec;
138         sTime = new_sTime;
139         suSec = new_suSec;
140         errorCode = new_errorCode;

141         cname = new_cname;
142         sname = new_sname;
143         eText = new_eText;
144         eData = new_eData;
145 
146         parseEData(eData);
147     }
148 
149     public KRBError(
150                     APOptions new_apOptions,
151                     KerberosTime new_cTime,
152                     Integer new_cuSec,
153                     KerberosTime new_sTime,
154                     Integer new_suSec,
155                     int new_errorCode,
156                     PrincipalName new_cname,
157                     PrincipalName new_sname,
158                     String new_eText,
159                     byte[] new_eData,
160                     Checksum new_eCksum
161                         ) throws IOException, Asn1Exception {
162         pvno = Krb5.PVNO;
163         msgType = Krb5.KRB_ERROR;
164         cTime = new_cTime;
165         cuSec = new_cuSec;
166         sTime = new_sTime;
167         suSec = new_suSec;
168         errorCode = new_errorCode;

169         cname = new_cname;
170         sname = new_sname;
171         eText = new_eText;
172         eData = new_eData;
173         eCksum = new_eCksum;
174 
175         parseEData(eData);
176     }
177 
178     public KRBError(byte[] data) throws Asn1Exception,
179             RealmException, KrbApErrException, IOException {
180         init(new DerValue(data));
181         parseEData(eData);
182     }
183 
184     public KRBError(DerValue encoding) throws Asn1Exception,
185             RealmException, KrbApErrException, IOException {
186         init(encoding);
187         showDebug();
188         parseEData(eData);
</pre>
<hr />
<pre>
245     /**
246      * Try parsing the data as a sequence of PA-DATA.
247      * @param data the data block
248      */
249     private void parsePAData(byte[] data)
250             throws IOException, Asn1Exception {
251         DerValue derPA = new DerValue(data);
252         List&lt;PAData&gt; paList = new ArrayList&lt;&gt;();
253         while (derPA.data.available() &gt; 0) {
254             // read the PA-DATA
255             DerValue tmp = derPA.data.getDerValue();
256             PAData pa_data = new PAData(tmp);
257             paList.add(pa_data);
258             if (DEBUG) {
259                 System.out.println(pa_data);
260             }
261         }
262         pa = paList.toArray(new PAData[paList.size()]);
263     }
264 




265     public final KerberosTime getServerTime() {
266         return sTime;
267     }
268 
269     public final KerberosTime getClientTime() {
270         return cTime;
271     }
272 
273     public final Integer getServerMicroSeconds() {
274         return suSec;
275     }
276 
277     public final Integer getClientMicroSeconds() {
278         return cuSec;
279     }
280 
281     public final int getErrorCode() {
282         return errorCode;
283     }
284 
</pre>
<hr />
<pre>
332             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
333         }
334 
335         cTime = KerberosTime.parse(der.getData(), (byte)0x02, true);
336         if ((der.getData().peekByte() &amp; 0x1F) == 0x03) {
337             subDer = der.getData().getDerValue();
338             cuSec = subDer.getData().getBigInteger().intValue();
339         }
340         else cuSec = null;
341         sTime = KerberosTime.parse(der.getData(), (byte)0x04, false);
342         subDer = der.getData().getDerValue();
343         if ((subDer.getTag() &amp; (byte)0x1F) == (byte)0x05) {
344             suSec = subDer.getData().getBigInteger().intValue();
345         }
346         else  throw new Asn1Exception(Krb5.ASN1_BAD_ID);
347         subDer = der.getData().getDerValue();
348         if ((subDer.getTag() &amp; (byte)0x1F) == (byte)0x06) {
349             errorCode = subDer.getData().getBigInteger().intValue();
350         }
351         else  throw new Asn1Exception(Krb5.ASN1_BAD_ID);
<span class="line-modified">352         Realm crealm = Realm.parse(der.getData(), (byte)0x07, true);</span>
353         cname = PrincipalName.parse(der.getData(), (byte)0x08, true, crealm);
354         Realm realm = Realm.parse(der.getData(), (byte)0x09, false);
355         sname = PrincipalName.parse(der.getData(), (byte)0x0A, false, realm);
356         eText = null;
357         eData = null;
358         eCksum = null;
359         if (der.getData().available() &gt;0) {
360             if ((der.getData().peekByte() &amp; 0x1F) == 0x0B) {
361                 subDer = der.getData().getDerValue();
362                 eText = new KerberosString(subDer.getData().getDerValue())
363                         .toString();
364             }
365         }
366         if (der.getData().available() &gt;0) {
367             if ((der.getData().peekByte() &amp; 0x1F) == 0x0C) {
368                 subDer = der.getData().getDerValue();
369                 eData = subDer.getData().getOctetString();
370             }
371         }
372         if (der.getData().available() &gt;0) {
</pre>
<hr />
<pre>
376             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
377     }
378 
379     /**
380      * For debug use only
381      */
382     private void showDebug() {
383         if (DEBUG) {
384             System.out.println(&quot;&gt;&gt;&gt;KRBError:&quot;);
385             if (cTime != null)
386                 System.out.println(&quot;\t cTime is &quot; + cTime.toDate().toString() + &quot; &quot; + cTime.toDate().getTime());
387             if (cuSec != null) {
388                 System.out.println(&quot;\t cuSec is &quot; + cuSec.intValue());
389             }
390 
391             System.out.println(&quot;\t sTime is &quot; + sTime.toDate().toString
392                                () + &quot; &quot; + sTime.toDate().getTime());
393             System.out.println(&quot;\t suSec is &quot; + suSec);
394             System.out.println(&quot;\t error code is &quot; + errorCode);
395             System.out.println(&quot;\t error Message is &quot; + Krb5.getErrorMessage(errorCode));



396             if (cname != null) {
397                 System.out.println(&quot;\t cname is &quot; + cname.toString());
398             }
399             if (sname != null) {
400                 System.out.println(&quot;\t sname is &quot; + sname.toString());
401             }
402             if (eData != null) {
403                 System.out.println(&quot;\t eData provided.&quot;);
404             }
405             if (eCksum != null) {
406                 System.out.println(&quot;\t checksum provided.&quot;);
407             }
408             System.out.println(&quot;\t msgType is &quot; + msgType);
409         }
410     }
411 
412     /**
413      * Encodes an KRBError object.
414      * @return the byte array of encoded KRBError object.
415      * @exception Asn1Exception if an error occurs while decoding an ASN1 encoded data.
</pre>
<hr />
<pre>
425         temp.putInteger(BigInteger.valueOf(msgType));
426         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x01), temp);
427 
428         if (cTime != null) {
429             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x02), cTime.asn1Encode());
430         }
431         if (cuSec != null) {
432             temp = new DerOutputStream();
433             temp.putInteger(BigInteger.valueOf(cuSec.intValue()));
434             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x03), temp);
435         }
436 
437         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x04), sTime.asn1Encode());
438         temp = new DerOutputStream();
439         temp.putInteger(BigInteger.valueOf(suSec.intValue()));
440         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x05), temp);
441         temp = new DerOutputStream();
442         temp.putInteger(BigInteger.valueOf(errorCode));
443         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x06), temp);
444 



445         if (cname != null) {
<span class="line-removed">446             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x07), cname.getRealm().asn1Encode());</span>
447             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x08), cname.asn1Encode());
448         }
449 
450         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x09), sname.getRealm().asn1Encode());
451         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x0A), sname.asn1Encode());
452 
453         if (eText != null) {
454             temp = new DerOutputStream();
455             temp.putDerValue(new KerberosString(eText).toDerValue());
456             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x0B), temp);
457         }
458         if (eData != null) {
459             temp = new DerOutputStream();
460             temp.putOctetString(eData);
461             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x0C), temp);
462         }
463         if (eCksum != null) {
464             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x0D), eCksum.asn1Encode());
465         }
466 
</pre>
<hr />
<pre>
471         return bytes.toByteArray();
472     }
473 
474     @Override public boolean equals(Object obj) {
475         if (this == obj) {
476             return true;
477         }
478 
479         if (!(obj instanceof KRBError)) {
480             return false;
481         }
482 
483         KRBError other = (KRBError)obj;
484         return  pvno == other.pvno &amp;&amp;
485                 msgType == other.msgType &amp;&amp;
486                 isEqual(cTime, other.cTime) &amp;&amp;
487                 isEqual(cuSec, other.cuSec) &amp;&amp;
488                 isEqual(sTime, other.sTime) &amp;&amp;
489                 isEqual(suSec, other.suSec) &amp;&amp;
490                 errorCode == other.errorCode &amp;&amp;

491                 isEqual(cname, other.cname) &amp;&amp;
492                 isEqual(sname, other.sname) &amp;&amp;
493                 isEqual(eText, other.eText) &amp;&amp;
494                 java.util.Arrays.equals(eData, other.eData) &amp;&amp;
495                 isEqual(eCksum, other.eCksum);
496     }
497 
498     private static boolean isEqual(Object a, Object b) {
499         return (a == null)?(b == null):(a.equals(b));
500     }
501 
502     @Override public int hashCode() {
503         int result = 17;
504         result = 37 * result + pvno;
505         result = 37 * result + msgType;
506         if (cTime != null) result = 37 * result + cTime.hashCode();
507         if (cuSec != null) result = 37 * result + cuSec.hashCode();
508         if (sTime != null) result = 37 * result + sTime.hashCode();
509         if (suSec != null) result = 37 * result + suSec.hashCode();
510         result = 37 * result + errorCode;

511         if (cname != null) result = 37 * result + cname.hashCode();
512         if (sname != null) result = 37 * result + sname.hashCode();
513         if (eText != null) result = 37 * result + eText.hashCode();
514         result = 37 * result + Arrays.hashCode(eData);
515         if (eCksum != null) result = 37 * result + eCksum.hashCode();
516         return result;
517     }
518 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 62  *         realm           [9] Realm -- service realm --,
 63  *         sname           [10] PrincipalName -- service name --,
 64  *         e-text          [11] KerberosString OPTIONAL,
 65  *         e-data          [12] OCTET STRING OPTIONAL
 66  * }
 67  *
 68  * METHOD-DATA     ::= SEQUENCE OF PA-DATA
 69  *
 70  * TYPED-DATA      ::= SEQUENCE SIZE (1..MAX) OF SEQUENCE {
 71  *         data-type       [0] Int32,
 72  *         data-value      [1] OCTET STRING OPTIONAL
 73  * }
 74  * }&lt;/pre&gt;
 75  *
 76  * &lt;p&gt;
 77  * This definition reflects the Network Working Group RFC 4120
 78  * specification available at
 79  * &lt;a href=&quot;http://www.ietf.org/rfc/rfc4120.txt&quot;&gt;
 80  * http://www.ietf.org/rfc/rfc4120.txt&lt;/a&gt;.
 81  */
<span class="line-modified"> 82 // The instance fields not statically typed as Serializable are ASN.1</span>
<span class="line-added"> 83 // encoded and written by the writeObject method.</span>
<span class="line-added"> 84 @SuppressWarnings(&quot;serial&quot;)</span>
 85 public class KRBError implements java.io.Serializable {
 86     static final long serialVersionUID = 3643809337475284503L;
 87 
 88     private int pvno;
 89     private int msgType;
 90     private KerberosTime cTime; //optional
 91     private Integer cuSec; //optional
 92     private KerberosTime sTime;
 93     private Integer suSec;
 94     private int errorCode;
<span class="line-added"> 95     private Realm crealm; //optional</span>
 96     private PrincipalName cname; //optional
 97     private PrincipalName sname;
 98     private String eText; //optional
 99     private byte[] eData; //optional
100     private Checksum eCksum; //optional
101 
102     private PAData[] pa;    // PA-DATA in eData
103 
104     private static boolean DEBUG = Krb5.DEBUG;
105 
106     private void readObject(ObjectInputStream is)
107             throws IOException, ClassNotFoundException {
108         try {
109             init(new DerValue((byte[])is.readObject()));
110             parseEData(eData);
111         } catch (Exception e) {
112             throw new IOException(e);
113         }
114     }
115 
</pre>
<hr />
<pre>
124 
125     public KRBError(
126                     APOptions new_apOptions,
127                     KerberosTime new_cTime,
128                     Integer new_cuSec,
129                     KerberosTime new_sTime,
130                     Integer new_suSec,
131                     int new_errorCode,
132                     PrincipalName new_cname,
133                     PrincipalName new_sname,
134                     String new_eText,
135                     byte[] new_eData
136                         ) throws IOException, Asn1Exception {
137         pvno = Krb5.PVNO;
138         msgType = Krb5.KRB_ERROR;
139         cTime = new_cTime;
140         cuSec = new_cuSec;
141         sTime = new_sTime;
142         suSec = new_suSec;
143         errorCode = new_errorCode;
<span class="line-added">144         crealm = new_cname != null ? new_cname.getRealm() : null;</span>
145         cname = new_cname;
146         sname = new_sname;
147         eText = new_eText;
148         eData = new_eData;
149 
150         parseEData(eData);
151     }
152 
153     public KRBError(
154                     APOptions new_apOptions,
155                     KerberosTime new_cTime,
156                     Integer new_cuSec,
157                     KerberosTime new_sTime,
158                     Integer new_suSec,
159                     int new_errorCode,
160                     PrincipalName new_cname,
161                     PrincipalName new_sname,
162                     String new_eText,
163                     byte[] new_eData,
164                     Checksum new_eCksum
165                         ) throws IOException, Asn1Exception {
166         pvno = Krb5.PVNO;
167         msgType = Krb5.KRB_ERROR;
168         cTime = new_cTime;
169         cuSec = new_cuSec;
170         sTime = new_sTime;
171         suSec = new_suSec;
172         errorCode = new_errorCode;
<span class="line-added">173         crealm = new_cname != null ? new_cname.getRealm() : null;</span>
174         cname = new_cname;
175         sname = new_sname;
176         eText = new_eText;
177         eData = new_eData;
178         eCksum = new_eCksum;
179 
180         parseEData(eData);
181     }
182 
183     public KRBError(byte[] data) throws Asn1Exception,
184             RealmException, KrbApErrException, IOException {
185         init(new DerValue(data));
186         parseEData(eData);
187     }
188 
189     public KRBError(DerValue encoding) throws Asn1Exception,
190             RealmException, KrbApErrException, IOException {
191         init(encoding);
192         showDebug();
193         parseEData(eData);
</pre>
<hr />
<pre>
250     /**
251      * Try parsing the data as a sequence of PA-DATA.
252      * @param data the data block
253      */
254     private void parsePAData(byte[] data)
255             throws IOException, Asn1Exception {
256         DerValue derPA = new DerValue(data);
257         List&lt;PAData&gt; paList = new ArrayList&lt;&gt;();
258         while (derPA.data.available() &gt; 0) {
259             // read the PA-DATA
260             DerValue tmp = derPA.data.getDerValue();
261             PAData pa_data = new PAData(tmp);
262             paList.add(pa_data);
263             if (DEBUG) {
264                 System.out.println(pa_data);
265             }
266         }
267         pa = paList.toArray(new PAData[paList.size()]);
268     }
269 
<span class="line-added">270     public final Realm getClientRealm() {</span>
<span class="line-added">271         return crealm;</span>
<span class="line-added">272     }</span>
<span class="line-added">273 </span>
274     public final KerberosTime getServerTime() {
275         return sTime;
276     }
277 
278     public final KerberosTime getClientTime() {
279         return cTime;
280     }
281 
282     public final Integer getServerMicroSeconds() {
283         return suSec;
284     }
285 
286     public final Integer getClientMicroSeconds() {
287         return cuSec;
288     }
289 
290     public final int getErrorCode() {
291         return errorCode;
292     }
293 
</pre>
<hr />
<pre>
341             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
342         }
343 
344         cTime = KerberosTime.parse(der.getData(), (byte)0x02, true);
345         if ((der.getData().peekByte() &amp; 0x1F) == 0x03) {
346             subDer = der.getData().getDerValue();
347             cuSec = subDer.getData().getBigInteger().intValue();
348         }
349         else cuSec = null;
350         sTime = KerberosTime.parse(der.getData(), (byte)0x04, false);
351         subDer = der.getData().getDerValue();
352         if ((subDer.getTag() &amp; (byte)0x1F) == (byte)0x05) {
353             suSec = subDer.getData().getBigInteger().intValue();
354         }
355         else  throw new Asn1Exception(Krb5.ASN1_BAD_ID);
356         subDer = der.getData().getDerValue();
357         if ((subDer.getTag() &amp; (byte)0x1F) == (byte)0x06) {
358             errorCode = subDer.getData().getBigInteger().intValue();
359         }
360         else  throw new Asn1Exception(Krb5.ASN1_BAD_ID);
<span class="line-modified">361         crealm = Realm.parse(der.getData(), (byte)0x07, true);</span>
362         cname = PrincipalName.parse(der.getData(), (byte)0x08, true, crealm);
363         Realm realm = Realm.parse(der.getData(), (byte)0x09, false);
364         sname = PrincipalName.parse(der.getData(), (byte)0x0A, false, realm);
365         eText = null;
366         eData = null;
367         eCksum = null;
368         if (der.getData().available() &gt;0) {
369             if ((der.getData().peekByte() &amp; 0x1F) == 0x0B) {
370                 subDer = der.getData().getDerValue();
371                 eText = new KerberosString(subDer.getData().getDerValue())
372                         .toString();
373             }
374         }
375         if (der.getData().available() &gt;0) {
376             if ((der.getData().peekByte() &amp; 0x1F) == 0x0C) {
377                 subDer = der.getData().getDerValue();
378                 eData = subDer.getData().getOctetString();
379             }
380         }
381         if (der.getData().available() &gt;0) {
</pre>
<hr />
<pre>
385             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
386     }
387 
388     /**
389      * For debug use only
390      */
391     private void showDebug() {
392         if (DEBUG) {
393             System.out.println(&quot;&gt;&gt;&gt;KRBError:&quot;);
394             if (cTime != null)
395                 System.out.println(&quot;\t cTime is &quot; + cTime.toDate().toString() + &quot; &quot; + cTime.toDate().getTime());
396             if (cuSec != null) {
397                 System.out.println(&quot;\t cuSec is &quot; + cuSec.intValue());
398             }
399 
400             System.out.println(&quot;\t sTime is &quot; + sTime.toDate().toString
401                                () + &quot; &quot; + sTime.toDate().getTime());
402             System.out.println(&quot;\t suSec is &quot; + suSec);
403             System.out.println(&quot;\t error code is &quot; + errorCode);
404             System.out.println(&quot;\t error Message is &quot; + Krb5.getErrorMessage(errorCode));
<span class="line-added">405             if (crealm != null) {</span>
<span class="line-added">406                 System.out.println(&quot;\t crealm is &quot; + crealm.toString());</span>
<span class="line-added">407             }</span>
408             if (cname != null) {
409                 System.out.println(&quot;\t cname is &quot; + cname.toString());
410             }
411             if (sname != null) {
412                 System.out.println(&quot;\t sname is &quot; + sname.toString());
413             }
414             if (eData != null) {
415                 System.out.println(&quot;\t eData provided.&quot;);
416             }
417             if (eCksum != null) {
418                 System.out.println(&quot;\t checksum provided.&quot;);
419             }
420             System.out.println(&quot;\t msgType is &quot; + msgType);
421         }
422     }
423 
424     /**
425      * Encodes an KRBError object.
426      * @return the byte array of encoded KRBError object.
427      * @exception Asn1Exception if an error occurs while decoding an ASN1 encoded data.
</pre>
<hr />
<pre>
437         temp.putInteger(BigInteger.valueOf(msgType));
438         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x01), temp);
439 
440         if (cTime != null) {
441             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x02), cTime.asn1Encode());
442         }
443         if (cuSec != null) {
444             temp = new DerOutputStream();
445             temp.putInteger(BigInteger.valueOf(cuSec.intValue()));
446             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x03), temp);
447         }
448 
449         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x04), sTime.asn1Encode());
450         temp = new DerOutputStream();
451         temp.putInteger(BigInteger.valueOf(suSec.intValue()));
452         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x05), temp);
453         temp = new DerOutputStream();
454         temp.putInteger(BigInteger.valueOf(errorCode));
455         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x06), temp);
456 
<span class="line-added">457         if (crealm != null) {</span>
<span class="line-added">458             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x07), crealm.asn1Encode());</span>
<span class="line-added">459         }</span>
460         if (cname != null) {

461             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x08), cname.asn1Encode());
462         }
463 
464         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x09), sname.getRealm().asn1Encode());
465         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x0A), sname.asn1Encode());
466 
467         if (eText != null) {
468             temp = new DerOutputStream();
469             temp.putDerValue(new KerberosString(eText).toDerValue());
470             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x0B), temp);
471         }
472         if (eData != null) {
473             temp = new DerOutputStream();
474             temp.putOctetString(eData);
475             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x0C), temp);
476         }
477         if (eCksum != null) {
478             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0x0D), eCksum.asn1Encode());
479         }
480 
</pre>
<hr />
<pre>
485         return bytes.toByteArray();
486     }
487 
488     @Override public boolean equals(Object obj) {
489         if (this == obj) {
490             return true;
491         }
492 
493         if (!(obj instanceof KRBError)) {
494             return false;
495         }
496 
497         KRBError other = (KRBError)obj;
498         return  pvno == other.pvno &amp;&amp;
499                 msgType == other.msgType &amp;&amp;
500                 isEqual(cTime, other.cTime) &amp;&amp;
501                 isEqual(cuSec, other.cuSec) &amp;&amp;
502                 isEqual(sTime, other.sTime) &amp;&amp;
503                 isEqual(suSec, other.suSec) &amp;&amp;
504                 errorCode == other.errorCode &amp;&amp;
<span class="line-added">505                 isEqual(crealm, other.crealm) &amp;&amp;</span>
506                 isEqual(cname, other.cname) &amp;&amp;
507                 isEqual(sname, other.sname) &amp;&amp;
508                 isEqual(eText, other.eText) &amp;&amp;
509                 java.util.Arrays.equals(eData, other.eData) &amp;&amp;
510                 isEqual(eCksum, other.eCksum);
511     }
512 
513     private static boolean isEqual(Object a, Object b) {
514         return (a == null)?(b == null):(a.equals(b));
515     }
516 
517     @Override public int hashCode() {
518         int result = 17;
519         result = 37 * result + pvno;
520         result = 37 * result + msgType;
521         if (cTime != null) result = 37 * result + cTime.hashCode();
522         if (cuSec != null) result = 37 * result + cuSec.hashCode();
523         if (sTime != null) result = 37 * result + sTime.hashCode();
524         if (suSec != null) result = 37 * result + suSec.hashCode();
525         result = 37 * result + errorCode;
<span class="line-added">526         if (crealm != null) result = 37 * result + crealm.hashCode();</span>
527         if (cname != null) result = 37 * result + cname.hashCode();
528         if (sname != null) result = 37 * result + sname.hashCode();
529         if (eText != null) result = 37 * result + eText.hashCode();
530         result = 37 * result + Arrays.hashCode(eData);
531         if (eCksum != null) result = 37 * result + eCksum.hashCode();
532         return result;
533     }
534 }
</pre>
</td>
</tr>
</table>
<center><a href="KDCReq.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="KerberosTime.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>