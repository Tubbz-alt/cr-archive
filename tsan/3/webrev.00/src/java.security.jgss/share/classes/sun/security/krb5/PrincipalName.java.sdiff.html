<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.jgss/share/classes/sun/security/krb5/PrincipalName.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="KrbTgsReq.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Realm.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/classes/sun/security/krb5/PrincipalName.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 73     /**
 74      * Service and other unique instance (krbtgt)
 75      */
 76     public static final int KRB_NT_SRV_INST =  2;
 77 
 78     /**
 79      * Service with host name as instance (telnet, rcommands)
 80      */
 81     public static final int KRB_NT_SRV_HST =   3;
 82 
 83     /**
 84      * Service with host as remaining components
 85      */
 86     public static final int KRB_NT_SRV_XHST =  4;
 87 
 88     /**
 89      * Unique ID
 90      */
 91     public static final int KRB_NT_UID = 5;
 92 





 93     /**
 94      * TGS Name
 95      */
 96     public static final String TGS_DEFAULT_SRV_NAME = &quot;krbtgt&quot;;
 97     public static final int TGS_DEFAULT_NT = KRB_NT_SRV_INST;
 98 
 99     public static final char NAME_COMPONENT_SEPARATOR = &#39;/&#39;;
100     public static final char NAME_REALM_SEPARATOR = &#39;@&#39;;
101     public static final char REALM_COMPONENT_SEPARATOR = &#39;.&#39;;
102 
103     public static final String NAME_COMPONENT_SEPARATOR_STR = &quot;/&quot;;
104     public static final String NAME_REALM_SEPARATOR_STR = &quot;@&quot;;
105     public static final String REALM_COMPONENT_SEPARATOR_STR = &quot;.&quot;;
106 
107     // Instance fields.
108 
109     /**
110      * The name type, from PrincipalName&#39;s name-type field.
111      */
112     private final int nameType;
</pre>
<hr />
<pre>
136     // There are 3 basic constructors. All other constructors must call them.
137     // All basic constructors must call validateNameStrings.
138     // 1. From name components
139     // 2. From name
140     // 3. From DER encoding
141 
142     /**
143      * Creates a PrincipalName.
144      */
145     public PrincipalName(int nameType, String[] nameStrings, Realm nameRealm) {
146         if (nameRealm == null) {
147             throw new IllegalArgumentException(&quot;Null realm not allowed&quot;);
148         }
149         validateNameStrings(nameStrings);
150         this.nameType = nameType;
151         this.nameStrings = nameStrings.clone();
152         this.nameRealm = nameRealm;
153         this.realmDeduced = false;
154     }
155 
<span class="line-modified">156     // This method is called by Windows NativeCred.c</span>
157     public PrincipalName(String[] nameParts, String realm) throws RealmException {
158         this(KRB_NT_UNKNOWN, nameParts, new Realm(realm));
159     }
160 
161     // Validate a nameStrings argument
162     private static void validateNameStrings(String[] ns) {
163         if (ns == null) {
164             throw new IllegalArgumentException(&quot;Null nameStrings not allowed&quot;);
165         }
166         if (ns.length == 0) {
167             throw new IllegalArgumentException(&quot;Empty nameStrings not allowed&quot;);
168         }
169         for (String s: ns) {
170             if (s == null) {
171                 throw new IllegalArgumentException(&quot;Null nameString not allowed&quot;);
172             }
173             if (s.isEmpty()) {
174                 throw new IllegalArgumentException(&quot;Empty nameString not allowed&quot;);
175             }
176         }
</pre>
<hr />
<pre>
448             } else {
449                 // We will try to get realm name from the mapping in
450                 // the configuration. If it is not specified
451                 // we will use the default realm. This nametype does
452                 // not allow a realm to be specified. The name string must of
453                 // the form service@host and this is internally changed into
454                 // service/host by Kerberos
455                 String mapRealm =  mapHostToRealm(nameParts[1]);
456                 if (mapRealm != null) {
457                     nameRealm = new Realm(mapRealm);
458                 } else {
459                     nameRealm = Realm.getDefault();
460                 }
461             }
462             break;
463         case KRB_NT_UNKNOWN:
464         case KRB_NT_PRINCIPAL:
465         case KRB_NT_SRV_INST:
466         case KRB_NT_SRV_XHST:
467         case KRB_NT_UID:

468             nameStrings = nameParts;
469             nameType = type;
470             if (realm != null) {
471                 nameRealm = new Realm(realm);
472             } else {
473                 nameRealm = Realm.getDefault();
474             }
475             break;
476         default:
477             throw new IllegalArgumentException(&quot;Illegal name type&quot;);
478         }
479     }
480 

481     public PrincipalName(String name, int type) throws RealmException {
482         this(name, type, (String)null);
483     }
484 
485     public PrincipalName(String name) throws RealmException {
486         this(name, KRB_NT_UNKNOWN);
487     }
488 
489     public PrincipalName(String name, String realm) throws RealmException {
490         this(name, KRB_NT_UNKNOWN, realm);
491     }
492 
493     public static PrincipalName tgsService(String r1, String r2)
494             throws KrbException {
495         return new PrincipalName(PrincipalName.KRB_NT_SRV_INST,
496                 new String[] {PrincipalName.TGS_DEFAULT_SRV_NAME, r1},
497                 new Realm(r2));
498     }
499 
500     public String getRealmAsString() {
</pre>
<hr />
<pre>
541         return nameRealm;
542     }
543 
544     public String getSalt() {
545         if (salt == null) {
546             StringBuilder salt = new StringBuilder();
547             salt.append(nameRealm.toString());
548             for (int i = 0; i &lt; nameStrings.length; i++) {
549                 salt.append(nameStrings[i]);
550             }
551             return salt.toString();
552         }
553         return salt;
554     }
555 
556     public String toString() {
557         StringBuilder str = new StringBuilder();
558         for (int i = 0; i &lt; nameStrings.length; i++) {
559             if (i &gt; 0)
560                 str.append(&quot;/&quot;);
<span class="line-modified">561             str.append(nameStrings[i]);</span>


562         }
563         str.append(&quot;@&quot;);
564         str.append(nameRealm.toString());
565         return str.toString();
566     }
567 
568     public String getNameString() {
569         StringBuilder str = new StringBuilder();
570         for (int i = 0; i &lt; nameStrings.length; i++) {
571             if (i &gt; 0)
572                 str.append(&quot;/&quot;);
573             str.append(nameStrings[i]);
574         }
575         return str.toString();
576     }
577 
578     /**
579      * Encodes a &lt;code&gt;PrincipalName&lt;/code&gt; object. Note that only the type and
580      * names are encoded. To encode the realm, call getRealm().asn1Encode().
581      * @return the byte array of the encoded PrncipalName object.
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 73     /**
 74      * Service and other unique instance (krbtgt)
 75      */
 76     public static final int KRB_NT_SRV_INST =  2;
 77 
 78     /**
 79      * Service with host name as instance (telnet, rcommands)
 80      */
 81     public static final int KRB_NT_SRV_HST =   3;
 82 
 83     /**
 84      * Service with host as remaining components
 85      */
 86     public static final int KRB_NT_SRV_XHST =  4;
 87 
 88     /**
 89      * Unique ID
 90      */
 91     public static final int KRB_NT_UID = 5;
 92 
<span class="line-added"> 93     /**</span>
<span class="line-added"> 94      * Enterprise name (alias)</span>
<span class="line-added"> 95      */</span>
<span class="line-added"> 96     public static final int KRB_NT_ENTERPRISE = 10;</span>
<span class="line-added"> 97 </span>
 98     /**
 99      * TGS Name
100      */
101     public static final String TGS_DEFAULT_SRV_NAME = &quot;krbtgt&quot;;
102     public static final int TGS_DEFAULT_NT = KRB_NT_SRV_INST;
103 
104     public static final char NAME_COMPONENT_SEPARATOR = &#39;/&#39;;
105     public static final char NAME_REALM_SEPARATOR = &#39;@&#39;;
106     public static final char REALM_COMPONENT_SEPARATOR = &#39;.&#39;;
107 
108     public static final String NAME_COMPONENT_SEPARATOR_STR = &quot;/&quot;;
109     public static final String NAME_REALM_SEPARATOR_STR = &quot;@&quot;;
110     public static final String REALM_COMPONENT_SEPARATOR_STR = &quot;.&quot;;
111 
112     // Instance fields.
113 
114     /**
115      * The name type, from PrincipalName&#39;s name-type field.
116      */
117     private final int nameType;
</pre>
<hr />
<pre>
141     // There are 3 basic constructors. All other constructors must call them.
142     // All basic constructors must call validateNameStrings.
143     // 1. From name components
144     // 2. From name
145     // 3. From DER encoding
146 
147     /**
148      * Creates a PrincipalName.
149      */
150     public PrincipalName(int nameType, String[] nameStrings, Realm nameRealm) {
151         if (nameRealm == null) {
152             throw new IllegalArgumentException(&quot;Null realm not allowed&quot;);
153         }
154         validateNameStrings(nameStrings);
155         this.nameType = nameType;
156         this.nameStrings = nameStrings.clone();
157         this.nameRealm = nameRealm;
158         this.realmDeduced = false;
159     }
160 
<span class="line-modified">161     // Warning: called by NativeCreds.c</span>
162     public PrincipalName(String[] nameParts, String realm) throws RealmException {
163         this(KRB_NT_UNKNOWN, nameParts, new Realm(realm));
164     }
165 
166     // Validate a nameStrings argument
167     private static void validateNameStrings(String[] ns) {
168         if (ns == null) {
169             throw new IllegalArgumentException(&quot;Null nameStrings not allowed&quot;);
170         }
171         if (ns.length == 0) {
172             throw new IllegalArgumentException(&quot;Empty nameStrings not allowed&quot;);
173         }
174         for (String s: ns) {
175             if (s == null) {
176                 throw new IllegalArgumentException(&quot;Null nameString not allowed&quot;);
177             }
178             if (s.isEmpty()) {
179                 throw new IllegalArgumentException(&quot;Empty nameString not allowed&quot;);
180             }
181         }
</pre>
<hr />
<pre>
453             } else {
454                 // We will try to get realm name from the mapping in
455                 // the configuration. If it is not specified
456                 // we will use the default realm. This nametype does
457                 // not allow a realm to be specified. The name string must of
458                 // the form service@host and this is internally changed into
459                 // service/host by Kerberos
460                 String mapRealm =  mapHostToRealm(nameParts[1]);
461                 if (mapRealm != null) {
462                     nameRealm = new Realm(mapRealm);
463                 } else {
464                     nameRealm = Realm.getDefault();
465                 }
466             }
467             break;
468         case KRB_NT_UNKNOWN:
469         case KRB_NT_PRINCIPAL:
470         case KRB_NT_SRV_INST:
471         case KRB_NT_SRV_XHST:
472         case KRB_NT_UID:
<span class="line-added">473         case KRB_NT_ENTERPRISE:</span>
474             nameStrings = nameParts;
475             nameType = type;
476             if (realm != null) {
477                 nameRealm = new Realm(realm);
478             } else {
479                 nameRealm = Realm.getDefault();
480             }
481             break;
482         default:
483             throw new IllegalArgumentException(&quot;Illegal name type&quot;);
484         }
485     }
486 
<span class="line-added">487     // Warning: called by nativeccache.c</span>
488     public PrincipalName(String name, int type) throws RealmException {
489         this(name, type, (String)null);
490     }
491 
492     public PrincipalName(String name) throws RealmException {
493         this(name, KRB_NT_UNKNOWN);
494     }
495 
496     public PrincipalName(String name, String realm) throws RealmException {
497         this(name, KRB_NT_UNKNOWN, realm);
498     }
499 
500     public static PrincipalName tgsService(String r1, String r2)
501             throws KrbException {
502         return new PrincipalName(PrincipalName.KRB_NT_SRV_INST,
503                 new String[] {PrincipalName.TGS_DEFAULT_SRV_NAME, r1},
504                 new Realm(r2));
505     }
506 
507     public String getRealmAsString() {
</pre>
<hr />
<pre>
548         return nameRealm;
549     }
550 
551     public String getSalt() {
552         if (salt == null) {
553             StringBuilder salt = new StringBuilder();
554             salt.append(nameRealm.toString());
555             for (int i = 0; i &lt; nameStrings.length; i++) {
556                 salt.append(nameStrings[i]);
557             }
558             return salt.toString();
559         }
560         return salt;
561     }
562 
563     public String toString() {
564         StringBuilder str = new StringBuilder();
565         for (int i = 0; i &lt; nameStrings.length; i++) {
566             if (i &gt; 0)
567                 str.append(&quot;/&quot;);
<span class="line-modified">568             String n = nameStrings[i];</span>
<span class="line-added">569             n = n.replace(&quot;@&quot;, &quot;\\@&quot;);</span>
<span class="line-added">570             str.append(n);</span>
571         }
572         str.append(&quot;@&quot;);
573         str.append(nameRealm.toString());
574         return str.toString();
575     }
576 
577     public String getNameString() {
578         StringBuilder str = new StringBuilder();
579         for (int i = 0; i &lt; nameStrings.length; i++) {
580             if (i &gt; 0)
581                 str.append(&quot;/&quot;);
582             str.append(nameStrings[i]);
583         }
584         return str.toString();
585     }
586 
587     /**
588      * Encodes a &lt;code&gt;PrincipalName&lt;/code&gt; object. Note that only the type and
589      * names are encoded. To encode the realm, call getRealm().asn1Encode().
590      * @return the byte array of the encoded PrncipalName object.
</pre>
</td>
</tr>
</table>
<center><a href="KrbTgsReq.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="Realm.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>