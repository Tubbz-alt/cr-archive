<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.jgss/share/classes/sun/security/krb5/internal/crypto/DesMacCksumType.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DesCbcCrcEType.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DesMacKCksumType.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/classes/sun/security/krb5/internal/crypto/DesMacCksumType.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 32 import sun.security.krb5.Checksum;
 33 import sun.security.krb5.Confounder;
 34 import sun.security.krb5.KrbCryptoException;
 35 import sun.security.krb5.internal.*;
 36 import javax.crypto.spec.DESKeySpec;
 37 import java.security.InvalidKeyException;
 38 
 39 public class DesMacCksumType extends CksumType {
 40 
 41     public DesMacCksumType() {
 42     }
 43 
 44     public int confounderSize() {
 45         return 8;
 46     }
 47 
 48     public int cksumType() {
 49         return Checksum.CKSUMTYPE_DES_MAC;
 50     }
 51 
<span class="line-modified"> 52     public boolean isSafe() {</span>
 53         return true;
 54     }
 55 
 56     public int cksumSize() {
 57         return 16;
 58     }
 59 
 60     public int keyType() {
 61         return Krb5.KEYTYPE_DES;
 62     }
 63 
 64     public int keySize() {
 65         return 8;
 66     }
 67 
<span class="line-removed"> 68     public byte[] calculateChecksum(byte[] data, int size) {</span>
<span class="line-removed"> 69         return null;</span>
<span class="line-removed"> 70     }</span>
<span class="line-removed"> 71 </span>
 72     /**
 73      * Calculates keyed checksum.
 74      * @param data the data used to generate the checksum.
 75      * @param size length of the data.
 76      * @param key the key used to encrypt the checksum.
 77      * @return keyed checksum.
 78      *
 79      * @modified by Yanni Zhang, 12/08/99.
 80      */
<span class="line-modified"> 81     public byte[] calculateKeyedChecksum(byte[] data, int size, byte[] key,</span>
 82         int usage) throws KrbCryptoException {
 83         byte[] new_data = new byte[size + confounderSize()];
 84         byte[] conf = Confounder.bytes(confounderSize());
 85         System.arraycopy(conf, 0, new_data, 0, confounderSize());
 86         System.arraycopy(data, 0, new_data, confounderSize(), size);
 87 
 88         //check for weak keys
 89         try {
 90             if (DESKeySpec.isWeak(key, 0)) {
 91                 key[7] = (byte)(key[7] ^ 0xF0);
 92             }
 93         } catch (InvalidKeyException ex) {
 94             // swallow, since it should never happen
 95         }
 96         byte[] residue_ivec = new byte[key.length];
 97         byte[] residue = Des.des_cksum(residue_ivec, new_data, key);
 98         byte[] cksum = new byte[cksumSize()];
 99         System.arraycopy(conf, 0, cksum, 0, confounderSize());
100         System.arraycopy(residue, 0, cksum, confounderSize(),
101                          cksumSize() - confounderSize());
</pre>
<hr />
<pre>
113             // swallow, since it should never happen
114         }
115         byte[] ivec = new byte[new_key.length];
116 
117         //des-cbc encrypt
118         byte[] enc_cksum = new byte[cksum.length];
119         Des.cbc_encrypt(cksum, enc_cksum, new_key, ivec, true);
120         return enc_cksum;
121     }
122 
123     /**
124      * Verifies keyed checksum.
125      * @param data the data.
126      * @param size the length of data.
127      * @param key the key used to encrypt the checksum.
128      * @param checksum the checksum.
129      * @return true if verification is successful.
130      *
131      * @modified by Yanni Zhang, 12/08/99.
132      */
<span class="line-modified">133     public boolean verifyKeyedChecksum(byte[] data, int size,</span>
134         byte[] key, byte[] checksum, int usage) throws KrbCryptoException {
135         byte[] cksum = decryptKeyedChecksum(checksum, key);
136 
137         byte[] new_data = new byte[size + confounderSize()];
138         System.arraycopy(cksum, 0, new_data, 0, confounderSize());
139         System.arraycopy(data, 0, new_data, confounderSize(), size);
140 
141         //check for weak keys
142         try {
143             if (DESKeySpec.isWeak(key, 0)) {
144                 key[7] = (byte)(key[7] ^ 0xF0);
145             }
146         } catch (InvalidKeyException ex) {
147             // swallow, since it should never happen
148         }
149         byte[] ivec = new byte[key.length];
150         byte[] new_cksum = Des.des_cksum(ivec, new_data, key);
151         byte[] orig_cksum = new byte[cksumSize() - confounderSize()];
152         System.arraycopy(cksum,  confounderSize(), orig_cksum, 0,
153                          cksumSize() - confounderSize());
</pre>
</td>
<td>
<hr />
<pre>
 32 import sun.security.krb5.Checksum;
 33 import sun.security.krb5.Confounder;
 34 import sun.security.krb5.KrbCryptoException;
 35 import sun.security.krb5.internal.*;
 36 import javax.crypto.spec.DESKeySpec;
 37 import java.security.InvalidKeyException;
 38 
 39 public class DesMacCksumType extends CksumType {
 40 
 41     public DesMacCksumType() {
 42     }
 43 
 44     public int confounderSize() {
 45         return 8;
 46     }
 47 
 48     public int cksumType() {
 49         return Checksum.CKSUMTYPE_DES_MAC;
 50     }
 51 
<span class="line-modified"> 52     public boolean isKeyed() {</span>
 53         return true;
 54     }
 55 
 56     public int cksumSize() {
 57         return 16;
 58     }
 59 
 60     public int keyType() {
 61         return Krb5.KEYTYPE_DES;
 62     }
 63 
 64     public int keySize() {
 65         return 8;
 66     }
 67 




 68     /**
 69      * Calculates keyed checksum.
 70      * @param data the data used to generate the checksum.
 71      * @param size length of the data.
 72      * @param key the key used to encrypt the checksum.
 73      * @return keyed checksum.
 74      *
 75      * @modified by Yanni Zhang, 12/08/99.
 76      */
<span class="line-modified"> 77     public byte[] calculateChecksum(byte[] data, int size, byte[] key,</span>
 78         int usage) throws KrbCryptoException {
 79         byte[] new_data = new byte[size + confounderSize()];
 80         byte[] conf = Confounder.bytes(confounderSize());
 81         System.arraycopy(conf, 0, new_data, 0, confounderSize());
 82         System.arraycopy(data, 0, new_data, confounderSize(), size);
 83 
 84         //check for weak keys
 85         try {
 86             if (DESKeySpec.isWeak(key, 0)) {
 87                 key[7] = (byte)(key[7] ^ 0xF0);
 88             }
 89         } catch (InvalidKeyException ex) {
 90             // swallow, since it should never happen
 91         }
 92         byte[] residue_ivec = new byte[key.length];
 93         byte[] residue = Des.des_cksum(residue_ivec, new_data, key);
 94         byte[] cksum = new byte[cksumSize()];
 95         System.arraycopy(conf, 0, cksum, 0, confounderSize());
 96         System.arraycopy(residue, 0, cksum, confounderSize(),
 97                          cksumSize() - confounderSize());
</pre>
<hr />
<pre>
109             // swallow, since it should never happen
110         }
111         byte[] ivec = new byte[new_key.length];
112 
113         //des-cbc encrypt
114         byte[] enc_cksum = new byte[cksum.length];
115         Des.cbc_encrypt(cksum, enc_cksum, new_key, ivec, true);
116         return enc_cksum;
117     }
118 
119     /**
120      * Verifies keyed checksum.
121      * @param data the data.
122      * @param size the length of data.
123      * @param key the key used to encrypt the checksum.
124      * @param checksum the checksum.
125      * @return true if verification is successful.
126      *
127      * @modified by Yanni Zhang, 12/08/99.
128      */
<span class="line-modified">129     public boolean verifyChecksum(byte[] data, int size,</span>
130         byte[] key, byte[] checksum, int usage) throws KrbCryptoException {
131         byte[] cksum = decryptKeyedChecksum(checksum, key);
132 
133         byte[] new_data = new byte[size + confounderSize()];
134         System.arraycopy(cksum, 0, new_data, 0, confounderSize());
135         System.arraycopy(data, 0, new_data, confounderSize(), size);
136 
137         //check for weak keys
138         try {
139             if (DESKeySpec.isWeak(key, 0)) {
140                 key[7] = (byte)(key[7] ^ 0xF0);
141             }
142         } catch (InvalidKeyException ex) {
143             // swallow, since it should never happen
144         }
145         byte[] ivec = new byte[key.length];
146         byte[] new_cksum = Des.des_cksum(ivec, new_data, key);
147         byte[] orig_cksum = new byte[cksumSize() - confounderSize()];
148         System.arraycopy(cksum,  confounderSize(), orig_cksum, 0,
149                          cksumSize() - confounderSize());
</pre>
</td>
</tr>
</table>
<center><a href="DesCbcCrcEType.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="DesMacKCksumType.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>