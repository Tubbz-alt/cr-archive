<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.security.jgss/share/classes/sun/security/jgss/krb5/Krb5InitCredential.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Krb5Context.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Krb5MechFactory.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/classes/sun/security/jgss/krb5/Krb5InitCredential.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 51,17 ***</span>
<span class="line-new-header">--- 51,22 ---</span>
      extends KerberosTicket
      implements Krb5CredElement {
  
      private static final long serialVersionUID = 7723415700837898232L;
  
<span class="line-added">+     @SuppressWarnings(&quot;serial&quot;) // Not statically typed as Serializable</span>
      private Krb5NameElement name;
<span class="line-added">+     @SuppressWarnings(&quot;serial&quot;) // Not statically typed as Serializable</span>
      private Credentials krb5Credentials;
<span class="line-added">+     public KerberosTicket proxyTicket;</span>
  
      private Krb5InitCredential(Krb5NameElement name,
                                 byte[] asn1Encoding,
                                 KerberosPrincipal client,
<span class="line-added">+                                KerberosPrincipal clientAlias,</span>
                                 KerberosPrincipal server,
<span class="line-added">+                                KerberosPrincipal serverAlias,</span>
                                 byte[] sessionKey,
                                 int keyType,
                                 boolean[] flags,
                                 Date authTime,
                                 Date startTime,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 78,18 ***</span>
                authTime,
                startTime,
                endTime,
                renewTill,
                clientAddresses);
<span class="line-modified">! </span>
          this.name = name;
  
          try {
              // Cache this for later use by the sun.security.krb5 package.
              krb5Credentials = new Credentials(asn1Encoding,
                                                client.getName(),
                                                server.getName(),
                                                sessionKey,
                                                keyType,
                                                flags,
                                                authTime,
                                                startTime,
<span class="line-new-header">--- 83,25 ---</span>
                authTime,
                startTime,
                endTime,
                renewTill,
                clientAddresses);
<span class="line-modified">!         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()</span>
<span class="line-added">+                 .kerberosTicketSetClientAlias(this, clientAlias);</span>
<span class="line-added">+         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()</span>
<span class="line-added">+                 .kerberosTicketSetServerAlias(this, serverAlias);</span>
          this.name = name;
  
          try {
              // Cache this for later use by the sun.security.krb5 package.
              krb5Credentials = new Credentials(asn1Encoding,
                                                client.getName(),
<span class="line-added">+                                               (clientAlias != null ?</span>
<span class="line-added">+                                                       clientAlias.getName() : null),</span>
                                                server.getName(),
<span class="line-added">+                                               (serverAlias != null ?</span>
<span class="line-added">+                                                       serverAlias.getName() : null),</span>
                                                sessionKey,
                                                keyType,
                                                flags,
                                                authTime,
                                                startTime,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 108,11 ***</span>
<span class="line-new-header">--- 120,13 ---</span>
  
      private Krb5InitCredential(Krb5NameElement name,
                                 Credentials delegatedCred,
                                 byte[] asn1Encoding,
                                 KerberosPrincipal client,
<span class="line-added">+                                KerberosPrincipal clientAlias,</span>
                                 KerberosPrincipal server,
<span class="line-added">+                                KerberosPrincipal serverAlias,</span>
                                 byte[] sessionKey,
                                 int keyType,
                                 boolean[] flags,
                                 Date authTime,
                                 Date startTime,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 129,11 ***</span>
                authTime,
                startTime,
                endTime,
                renewTill,
                clientAddresses);
<span class="line-modified">! </span>
          this.name = name;
          // A delegated cred does not have all fields set. So do not try to
          // creat new Credentials out of the delegatedCred.
          this.krb5Credentials = delegatedCred;
      }
<span class="line-new-header">--- 143,14 ---</span>
                authTime,
                startTime,
                endTime,
                renewTill,
                clientAddresses);
<span class="line-modified">!         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()</span>
<span class="line-added">+                 .kerberosTicketSetClientAlias(this, clientAlias);</span>
<span class="line-added">+         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()</span>
<span class="line-added">+                 .kerberosTicketSetServerAlias(this, serverAlias);</span>
          this.name = name;
          // A delegated cred does not have all fields set. So do not try to
          // creat new Credentials out of the delegatedCred.
          this.krb5Credentials = delegatedCred;
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 151,22 ***</span>
              String fullName = tgt.getClient().getName();
              name = Krb5NameElement.getInstance(fullName,
                                         Krb5MechFactory.NT_GSS_KRB5_PRINCIPAL);
          }
  
<span class="line-modified">!         return new Krb5InitCredential(name,</span>
                                        tgt.getEncoded(),
                                        tgt.getClient(),
                                        tgt.getServer(),
                                        tgt.getSessionKey().getEncoded(),
                                        tgt.getSessionKeyType(),
                                        tgt.getFlags(),
                                        tgt.getAuthTime(),
                                        tgt.getStartTime(),
                                        tgt.getEndTime(),
                                        tgt.getRenewTill(),
                                        tgt.getClientAddresses());
      }
  
      static Krb5InitCredential getInstance(Krb5NameElement name,
                                     Credentials delegatedCred)
          throws GSSException {
<span class="line-new-header">--- 168,33 ---</span>
              String fullName = tgt.getClient().getName();
              name = Krb5NameElement.getInstance(fullName,
                                         Krb5MechFactory.NT_GSS_KRB5_PRINCIPAL);
          }
  
<span class="line-modified">!         KerberosPrincipal clientAlias = KerberosSecrets</span>
<span class="line-added">+                 .getJavaxSecurityAuthKerberosAccess()</span>
<span class="line-added">+                 .kerberosTicketGetClientAlias(tgt);</span>
<span class="line-added">+         KerberosPrincipal serverAlias = KerberosSecrets</span>
<span class="line-added">+                 .getJavaxSecurityAuthKerberosAccess()</span>
<span class="line-added">+                 .kerberosTicketGetServerAlias(tgt);</span>
<span class="line-added">+         Krb5InitCredential result = new Krb5InitCredential(name,</span>
                                        tgt.getEncoded(),
                                        tgt.getClient(),
<span class="line-added">+                                       clientAlias,</span>
                                        tgt.getServer(),
<span class="line-added">+                                       serverAlias,</span>
                                        tgt.getSessionKey().getEncoded(),
                                        tgt.getSessionKeyType(),
                                        tgt.getFlags(),
                                        tgt.getAuthTime(),
                                        tgt.getStartTime(),
                                        tgt.getEndTime(),
                                        tgt.getRenewTill(),
                                        tgt.getClientAddresses());
<span class="line-added">+         result.proxyTicket = KerberosSecrets.getJavaxSecurityAuthKerberosAccess().</span>
<span class="line-added">+             kerberosTicketGetProxy(tgt);</span>
<span class="line-added">+         return result;</span>
      }
  
      static Krb5InitCredential getInstance(Krb5NameElement name,
                                     Credentials delegatedCred)
          throws GSSException {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 177,37 ***</span>
<span class="line-new-header">--- 205,51 ---</span>
           * all of the following data is optional in a KRB-CRED
           * messages. This check for each field.
           */
  
          PrincipalName cPrinc = delegatedCred.getClient();
<span class="line-added">+         PrincipalName cAPrinc = delegatedCred.getClientAlias();</span>
          PrincipalName sPrinc = delegatedCred.getServer();
<span class="line-added">+         PrincipalName sAPrinc = delegatedCred.getServerAlias();</span>
  
          KerberosPrincipal client = null;
<span class="line-added">+         KerberosPrincipal clientAlias = null;</span>
          KerberosPrincipal server = null;
<span class="line-added">+         KerberosPrincipal serverAlias = null;</span>
  
          Krb5NameElement credName = null;
  
          if (cPrinc != null) {
              String fullName = cPrinc.getName();
              credName = Krb5NameElement.getInstance(fullName,
                                 Krb5MechFactory.NT_GSS_KRB5_PRINCIPAL);
              client =  new KerberosPrincipal(fullName);
          }
  
<span class="line-added">+         if (cAPrinc != null) {</span>
<span class="line-added">+             clientAlias = new KerberosPrincipal(cAPrinc.getName());</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
          // XXX Compare name to credName
  
          if (sPrinc != null) {
              server =
                  new KerberosPrincipal(sPrinc.getName(),
                                          KerberosPrincipal.KRB_NT_SRV_INST);
          }
  
<span class="line-added">+         if (sAPrinc != null) {</span>
<span class="line-added">+             serverAlias = new KerberosPrincipal(sAPrinc.getName());</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
          return new Krb5InitCredential(credName,
                                        delegatedCred,
                                        delegatedCred.getEncoded(),
                                        client,
<span class="line-added">+                                       clientAlias,</span>
                                        server,
<span class="line-added">+                                       serverAlias,</span>
                                        sessionKey.getBytes(),
                                        sessionKey.getEType(),
                                        delegatedCred.getFlags(),
                                        delegatedCred.getAuthTime(),
                                        delegatedCred.getStartTime(),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 331,13 ***</span>
              return AccessController.doPrivileged(
                  new PrivilegedExceptionAction&lt;KerberosTicket&gt;() {
                  public KerberosTicket run() throws Exception {
                      // It&#39;s OK to use null as serverPrincipal. TGT is almost
                      // the first ticket for a principal and we use list.
<span class="line-modified">!                     return Krb5Util.getTicket(</span>
                          realCaller,
<span class="line-modified">!                         clientPrincipal, null, acc);</span>
                          }});
          } catch (PrivilegedActionException e) {
              GSSException ge =
                  new GSSException(GSSException.NO_CRED, -1,
                      &quot;Attempt to obtain new INITIATE credentials failed!&quot; +
<span class="line-new-header">--- 373,13 ---</span>
              return AccessController.doPrivileged(
                  new PrivilegedExceptionAction&lt;KerberosTicket&gt;() {
                  public KerberosTicket run() throws Exception {
                      // It&#39;s OK to use null as serverPrincipal. TGT is almost
                      // the first ticket for a principal and we use list.
<span class="line-modified">!                     return Krb5Util.getInitialTicket(</span>
                          realCaller,
<span class="line-modified">!                         clientPrincipal, acc);</span>
                          }});
          } catch (PrivilegedActionException e) {
              GSSException ge =
                  new GSSException(GSSException.NO_CRED, -1,
                      &quot;Attempt to obtain new INITIATE credentials failed!&quot; +
</pre>
<center><a href="Krb5Context.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Krb5MechFactory.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>