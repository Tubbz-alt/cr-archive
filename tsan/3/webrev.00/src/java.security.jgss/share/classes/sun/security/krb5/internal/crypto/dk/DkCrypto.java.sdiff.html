<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.jgss/share/classes/sun/security/krb5/internal/crypto/dk/DkCrypto.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AesSha2DkCrypto.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../ktab/KeyTab.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/classes/sun/security/krb5/internal/crypto/dk/DkCrypto.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2004, 2017, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 
  5 /*
  6  * Copyright (C) 1998 by the FundsXpress, INC.
  7  *
  8  * All rights reserved.
  9  *
 10  * Export of this software from the United States of America may require
 11  * a specific license from the United States Government.  It is the
 12  * responsibility of any person or organization contemplating export to
 13  * obtain such a license before exporting.
 14  *
 15  * WITHIN THAT CONSTRAINT, permission to use, copy, modify, and
 16  * distribute this software and its documentation for any purpose and
 17  * without fee is hereby granted, provided that the above copyright
 18  * notice appear in all copies and that both that copyright notice and
 19  * this permission notice appear in supporting documentation, and that
 20  * the name of FundsXpress. not be used in advertising or publicity pertaining
 21  * to distribution of the software without specific, written prior
 22  * permission.  FundsXpress makes no representations about the suitability of
 23  * this software for any purpose.  It is provided &quot;as is&quot; without express
 24  * or implied warranty.
 25  *
 26  * THIS SOFTWARE IS PROVIDED ``AS IS&#39;&#39; AND WITHOUT ANY EXPRESS OR
 27  * IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
 28  * WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR PURPOSE.
 29  */
 30 
 31 package sun.security.krb5.internal.crypto.dk;
 32 
 33 import javax.crypto.Cipher;
 34 import javax.crypto.Mac;
 35 import java.security.GeneralSecurityException;
<span class="line-removed"> 36 import java.io.UnsupportedEncodingException;</span>
 37 import java.util.Arrays;
 38 import java.io.ByteArrayInputStream;
 39 import java.io.ByteArrayOutputStream;
 40 import java.nio.charset.Charset;
 41 import java.nio.CharBuffer;
 42 import java.nio.ByteBuffer;
 43 import sun.security.util.HexDumpEncoder;
 44 import sun.security.krb5.Confounder;
 45 import sun.security.krb5.internal.crypto.KeyUsage;
 46 import sun.security.krb5.KrbCryptoException;
 47 


 48 /**
 49  * Implements Derive Key cryptography functionality as defined in RFC 3961.
 50  * http://www.ietf.org/rfc/rfc3961.txt
 51  *
 52  * This is an abstract class. Concrete subclasses need to implement
 53  * the abstract methods.
 54  */
 55 
 56 public abstract class DkCrypto {
 57 
 58     protected static final boolean debug = false;
 59 
 60     // These values correspond to the ASCII encoding for the string &quot;kerberos&quot;
 61     static final byte[] KERBEROS_CONSTANT =
 62         {0x6b, 0x65, 0x72, 0x62, 0x65, 0x72, 0x6f, 0x73};
 63 
 64     protected abstract int getKeySeedLength();  // in bits
 65 
 66     protected abstract byte[] randomToKey(byte[] in);
 67 
</pre>
<hr />
<pre>
655         for (int i = 0; i &lt; usage.length; i++) {
656             byte a = Byte.parseByte(new String(usageStr, i*2, 1), 16);
657             byte b = Byte.parseByte(new String(usageStr, i*2 + 1, 1), 16);
658             usage[i] = (byte) ((a&lt;&lt;4)|b);
659         }
660         return usage;
661     }
662 
663     static void traceOutput(String traceTag, byte[] output, int offset,
664         int len) {
665         try {
666             ByteArrayOutputStream out = new ByteArrayOutputStream(len);
667             new HexDumpEncoder().encodeBuffer(
668                 new ByteArrayInputStream(output, offset, len), out);
669 
670             System.err.println(traceTag + &quot;:\n&quot; + out.toString());
671         } catch (Exception e) {
672         }
673     }
674 
<span class="line-modified">675 // String.getBytes(&quot;UTF-8&quot;);</span>
676 // Do this instead of using String to avoid making password immutable
677     static byte[] charToUtf8(char[] chars) {
<span class="line-removed">678         Charset utf8 = Charset.forName(&quot;UTF-8&quot;);</span>
<span class="line-removed">679 </span>
680         CharBuffer cb = CharBuffer.wrap(chars);
<span class="line-modified">681         ByteBuffer bb = utf8.encode(cb);</span>
682         int len = bb.limit();
683         byte[] answer = new byte[len];
684         bb.get(answer, 0, len);
685         return answer;
686     }
687 
688     static byte[] charToUtf16(char[] chars) {
<span class="line-removed">689         Charset utf8 = Charset.forName(&quot;UTF-16LE&quot;);</span>
<span class="line-removed">690 </span>
691         CharBuffer cb = CharBuffer.wrap(chars);
<span class="line-modified">692         ByteBuffer bb = utf8.encode(cb);</span>
693         int len = bb.limit();
694         byte[] answer = new byte[len];
695         bb.get(answer, 0, len);
696         return answer;
697     }
698 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2004, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  */
  4 
  5 /*
  6  * Copyright (C) 1998 by the FundsXpress, INC.
  7  *
  8  * All rights reserved.
  9  *
 10  * Export of this software from the United States of America may require
 11  * a specific license from the United States Government.  It is the
 12  * responsibility of any person or organization contemplating export to
 13  * obtain such a license before exporting.
 14  *
 15  * WITHIN THAT CONSTRAINT, permission to use, copy, modify, and
 16  * distribute this software and its documentation for any purpose and
 17  * without fee is hereby granted, provided that the above copyright
 18  * notice appear in all copies and that both that copyright notice and
 19  * this permission notice appear in supporting documentation, and that
 20  * the name of FundsXpress. not be used in advertising or publicity pertaining
 21  * to distribution of the software without specific, written prior
 22  * permission.  FundsXpress makes no representations about the suitability of
 23  * this software for any purpose.  It is provided &quot;as is&quot; without express
 24  * or implied warranty.
 25  *
 26  * THIS SOFTWARE IS PROVIDED ``AS IS&#39;&#39; AND WITHOUT ANY EXPRESS OR
 27  * IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
 28  * WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR PURPOSE.
 29  */
 30 
 31 package sun.security.krb5.internal.crypto.dk;
 32 
 33 import javax.crypto.Cipher;
 34 import javax.crypto.Mac;
 35 import java.security.GeneralSecurityException;

 36 import java.util.Arrays;
 37 import java.io.ByteArrayInputStream;
 38 import java.io.ByteArrayOutputStream;
 39 import java.nio.charset.Charset;
 40 import java.nio.CharBuffer;
 41 import java.nio.ByteBuffer;
 42 import sun.security.util.HexDumpEncoder;
 43 import sun.security.krb5.Confounder;
 44 import sun.security.krb5.internal.crypto.KeyUsage;
 45 import sun.security.krb5.KrbCryptoException;
 46 
<span class="line-added"> 47 import static java.nio.charset.StandardCharsets.*;</span>
<span class="line-added"> 48 </span>
 49 /**
 50  * Implements Derive Key cryptography functionality as defined in RFC 3961.
 51  * http://www.ietf.org/rfc/rfc3961.txt
 52  *
 53  * This is an abstract class. Concrete subclasses need to implement
 54  * the abstract methods.
 55  */
 56 
 57 public abstract class DkCrypto {
 58 
 59     protected static final boolean debug = false;
 60 
 61     // These values correspond to the ASCII encoding for the string &quot;kerberos&quot;
 62     static final byte[] KERBEROS_CONSTANT =
 63         {0x6b, 0x65, 0x72, 0x62, 0x65, 0x72, 0x6f, 0x73};
 64 
 65     protected abstract int getKeySeedLength();  // in bits
 66 
 67     protected abstract byte[] randomToKey(byte[] in);
 68 
</pre>
<hr />
<pre>
656         for (int i = 0; i &lt; usage.length; i++) {
657             byte a = Byte.parseByte(new String(usageStr, i*2, 1), 16);
658             byte b = Byte.parseByte(new String(usageStr, i*2 + 1, 1), 16);
659             usage[i] = (byte) ((a&lt;&lt;4)|b);
660         }
661         return usage;
662     }
663 
664     static void traceOutput(String traceTag, byte[] output, int offset,
665         int len) {
666         try {
667             ByteArrayOutputStream out = new ByteArrayOutputStream(len);
668             new HexDumpEncoder().encodeBuffer(
669                 new ByteArrayInputStream(output, offset, len), out);
670 
671             System.err.println(traceTag + &quot;:\n&quot; + out.toString());
672         } catch (Exception e) {
673         }
674     }
675 
<span class="line-modified">676 // String.getBytes(UTF_8);</span>
677 // Do this instead of using String to avoid making password immutable
678     static byte[] charToUtf8(char[] chars) {


679         CharBuffer cb = CharBuffer.wrap(chars);
<span class="line-modified">680         ByteBuffer bb = UTF_8.encode(cb);</span>
681         int len = bb.limit();
682         byte[] answer = new byte[len];
683         bb.get(answer, 0, len);
684         return answer;
685     }
686 
687     static byte[] charToUtf16(char[] chars) {


688         CharBuffer cb = CharBuffer.wrap(chars);
<span class="line-modified">689         ByteBuffer bb = UTF_16LE.encode(cb);</span>
690         int len = bb.limit();
691         byte[] answer = new byte[len];
692         bb.get(answer, 0, len);
693         return answer;
694     }
695 }
</pre>
</td>
</tr>
</table>
<center><a href="AesSha2DkCrypto.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../ktab/KeyTab.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>