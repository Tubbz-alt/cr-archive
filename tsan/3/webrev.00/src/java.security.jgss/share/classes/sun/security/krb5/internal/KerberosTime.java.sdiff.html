<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.jgss/share/classes/sun/security/krb5/internal/KerberosTime.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="KRBError.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Krb5.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/classes/sun/security/krb5/internal/KerberosTime.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 71     // The time when this class is loaded. Used in setNow()
 72     private static long initMilli = System.currentTimeMillis();
 73     private static long initMicro = System.nanoTime() / 1000;
 74 
 75     private static boolean DEBUG = Krb5.DEBUG;
 76 
 77     // Do not make this public. It&#39;s a little confusing that micro
 78     // is only the last 3 digits of microsecond.
 79     private KerberosTime(long time, int micro) {
 80         kerberosTime = time;
 81         microSeconds = micro;
 82     }
 83 
 84     /**
 85      * Creates a KerberosTime object from milliseconds since epoch.
 86      */
 87     public KerberosTime(long time) {
 88         this(time, 0);
 89     }
 90 
<span class="line-modified"> 91     // This constructor is used in the native code</span>
<span class="line-removed"> 92     // src/windows/native/sun/security/krb5/NativeCreds.c</span>
 93     public KerberosTime(String time) throws Asn1Exception {
 94         this(toKerberosTime(time), 0);
 95     }
 96 
 97     private static long toKerberosTime(String time) throws Asn1Exception {
 98         // ASN.1 GeneralizedTime format:
 99 
100         // &quot;19700101000000Z&quot;
101         //  |   | | | | | |
102         //  0   4 6 8 | | |
103         //           10 | |
104         //             12 |
105         //               14
106 
107         if (time.length() != 15)
108             throw new Asn1Exception(Krb5.ASN1_BAD_TIMEFORMAT);
109         if (time.charAt(14) != &#39;Z&#39;)
110             throw new Asn1Exception(Krb5.ASN1_BAD_TIMEFORMAT);
111         int year = Integer.parseInt(time.substring(0, 4));
112         Calendar calendar = Calendar.getInstance(TimeZone.getTimeZone(&quot;UTC&quot;));
</pre>
<hr />
<pre>
284         }
285         else {
286             DerValue subDer = der.getData().getDerValue();
287             Date temp = subDer.getGeneralizedTime();
288             return new KerberosTime(temp.getTime(), 0);
289         }
290     }
291 
292     public static int getDefaultSkew() {
293         int tdiff = Krb5.DEFAULT_ALLOWABLE_CLOCKSKEW;
294         try {
295             if ((tdiff = Config.getInstance().getIntValue(
296                     &quot;libdefaults&quot;, &quot;clockskew&quot;))
297                         == Integer.MIN_VALUE) {   //value is not defined
298                 tdiff = Krb5.DEFAULT_ALLOWABLE_CLOCKSKEW;
299             }
300         } catch (KrbException e) {
301             if (DEBUG) {
302                 System.out.println(&quot;Exception in getting clockskew from &quot; +
303                                    &quot;Configuration &quot; +
<span class="line-modified">304                                    &quot;using default value &quot; +</span>
305                                    e.getMessage());
306             }
307         }
308         return tdiff;
309     }
310 
311     public String toString() {
312         return toGeneralizedTimeString();
313     }
314 }
</pre>
</td>
<td>
<hr />
<pre>
 71     // The time when this class is loaded. Used in setNow()
 72     private static long initMilli = System.currentTimeMillis();
 73     private static long initMicro = System.nanoTime() / 1000;
 74 
 75     private static boolean DEBUG = Krb5.DEBUG;
 76 
 77     // Do not make this public. It&#39;s a little confusing that micro
 78     // is only the last 3 digits of microsecond.
 79     private KerberosTime(long time, int micro) {
 80         kerberosTime = time;
 81         microSeconds = micro;
 82     }
 83 
 84     /**
 85      * Creates a KerberosTime object from milliseconds since epoch.
 86      */
 87     public KerberosTime(long time) {
 88         this(time, 0);
 89     }
 90 
<span class="line-modified"> 91     // Warning: called by NativeCreds.c and nativeccache.c</span>

 92     public KerberosTime(String time) throws Asn1Exception {
 93         this(toKerberosTime(time), 0);
 94     }
 95 
 96     private static long toKerberosTime(String time) throws Asn1Exception {
 97         // ASN.1 GeneralizedTime format:
 98 
 99         // &quot;19700101000000Z&quot;
100         //  |   | | | | | |
101         //  0   4 6 8 | | |
102         //           10 | |
103         //             12 |
104         //               14
105 
106         if (time.length() != 15)
107             throw new Asn1Exception(Krb5.ASN1_BAD_TIMEFORMAT);
108         if (time.charAt(14) != &#39;Z&#39;)
109             throw new Asn1Exception(Krb5.ASN1_BAD_TIMEFORMAT);
110         int year = Integer.parseInt(time.substring(0, 4));
111         Calendar calendar = Calendar.getInstance(TimeZone.getTimeZone(&quot;UTC&quot;));
</pre>
<hr />
<pre>
283         }
284         else {
285             DerValue subDer = der.getData().getDerValue();
286             Date temp = subDer.getGeneralizedTime();
287             return new KerberosTime(temp.getTime(), 0);
288         }
289     }
290 
291     public static int getDefaultSkew() {
292         int tdiff = Krb5.DEFAULT_ALLOWABLE_CLOCKSKEW;
293         try {
294             if ((tdiff = Config.getInstance().getIntValue(
295                     &quot;libdefaults&quot;, &quot;clockskew&quot;))
296                         == Integer.MIN_VALUE) {   //value is not defined
297                 tdiff = Krb5.DEFAULT_ALLOWABLE_CLOCKSKEW;
298             }
299         } catch (KrbException e) {
300             if (DEBUG) {
301                 System.out.println(&quot;Exception in getting clockskew from &quot; +
302                                    &quot;Configuration &quot; +
<span class="line-modified">303                                    &quot;using default value: &quot; +</span>
304                                    e.getMessage());
305             }
306         }
307         return tdiff;
308     }
309 
310     public String toString() {
311         return toGeneralizedTimeString();
312     }
313 }
</pre>
</td>
</tr>
</table>
<center><a href="KRBError.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Krb5.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>