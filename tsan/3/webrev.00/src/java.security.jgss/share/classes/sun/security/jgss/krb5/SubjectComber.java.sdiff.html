<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.jgss/share/classes/sun/security/jgss/krb5/SubjectComber.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Krb5Util.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../spnego/NegTokenTarg.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/classes/sun/security/jgss/krb5/SubjectComber.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2002, 2013, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.jgss.krb5;
 27 


 28 import javax.security.auth.kerberos.KerberosTicket;
 29 import javax.security.auth.kerberos.KerberosKey;
 30 import javax.security.auth.Subject;
 31 import javax.security.auth.DestroyFailedException;
 32 import java.util.Iterator;
 33 import java.util.ArrayList;
 34 import java.util.List;
 35 import java.util.Set;
 36 import javax.security.auth.kerberos.KerberosPrincipal;
 37 import javax.security.auth.kerberos.KeyTab;
 38 
 39 /**
 40  * This utility looks through the current Subject and retrieves private
 41  * credentials for the desired client/server principals.
 42  *
 43  * @author Ram Marti
 44  * @since 1.4.2
 45  */
 46 
 47 class SubjectComber {
</pre>
<hr />
<pre>
165                                 // removed  upon expiration
166                                 if (!subject.isReadOnly()) {
167                                     iterator.remove();
168                                     try {
169                                         ticket.destroy();
170                                         if (DEBUG) {
171                                             System.out.println(&quot;Removed and destroyed &quot;
172                                                         + &quot;the expired Ticket \n&quot;
173                                                         + ticket);
174 
175                                         }
176                                     } catch (DestroyFailedException dfe) {
177                                         if (DEBUG) {
178                                             System.out.println(&quot;Expired ticket not&quot; +
179                                                     &quot; detroyed successfully. &quot; + dfe);
180                                         }
181                                     }
182 
183                                 }
184                             } else {



185                                 if (serverPrincipal == null ||
<span class="line-modified">186                                     ticket.getServer().getName().equals(serverPrincipal))  {</span>
<span class="line-modified">187 </span>





188                                     if (clientPrincipal == null ||
189                                         clientPrincipal.equals(
<span class="line-modified">190                                             ticket.getClient().getName())) {</span>



191                                         if (oneOnly) {
192                                             return ticket;
193                                         } else {
194                                             // Record names so that tickets will
195                                             // all belong to same principals
196                                             if (clientPrincipal == null) {
<span class="line-modified">197                                                 clientPrincipal =</span>
<span class="line-modified">198                                                 ticket.getClient().getName();</span>





199                                             }
200                                             if (serverPrincipal == null) {
<span class="line-modified">201                                                 serverPrincipal =</span>
<span class="line-modified">202                                                 ticket.getServer().getName();</span>





203                                             }
204                                             answer.add(credClass.cast(ticket));
205                                         }
206                                     }
207                                 }
208                             }
209                         }
210                     }
211                 }
212             }
213             return answer;
214         }
215     }
216 }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.jgss.krb5;
 27 
<span class="line-added"> 28 import sun.security.krb5.KerberosSecrets;</span>
<span class="line-added"> 29 </span>
 30 import javax.security.auth.kerberos.KerberosTicket;
 31 import javax.security.auth.kerberos.KerberosKey;
 32 import javax.security.auth.Subject;
 33 import javax.security.auth.DestroyFailedException;
 34 import java.util.Iterator;
 35 import java.util.ArrayList;
 36 import java.util.List;
 37 import java.util.Set;
 38 import javax.security.auth.kerberos.KerberosPrincipal;
 39 import javax.security.auth.kerberos.KeyTab;
 40 
 41 /**
 42  * This utility looks through the current Subject and retrieves private
 43  * credentials for the desired client/server principals.
 44  *
 45  * @author Ram Marti
 46  * @since 1.4.2
 47  */
 48 
 49 class SubjectComber {
</pre>
<hr />
<pre>
167                                 // removed  upon expiration
168                                 if (!subject.isReadOnly()) {
169                                     iterator.remove();
170                                     try {
171                                         ticket.destroy();
172                                         if (DEBUG) {
173                                             System.out.println(&quot;Removed and destroyed &quot;
174                                                         + &quot;the expired Ticket \n&quot;
175                                                         + ticket);
176 
177                                         }
178                                     } catch (DestroyFailedException dfe) {
179                                         if (DEBUG) {
180                                             System.out.println(&quot;Expired ticket not&quot; +
181                                                     &quot; detroyed successfully. &quot; + dfe);
182                                         }
183                                     }
184 
185                                 }
186                             } else {
<span class="line-added">187                                 KerberosPrincipal serverAlias = KerberosSecrets</span>
<span class="line-added">188                                         .getJavaxSecurityAuthKerberosAccess()</span>
<span class="line-added">189                                         .kerberosTicketGetServerAlias(ticket);</span>
190                                 if (serverPrincipal == null ||
<span class="line-modified">191                                     ticket.getServer().getName().equals(serverPrincipal) ||</span>
<span class="line-modified">192                                             (serverAlias != null &amp;&amp;</span>
<span class="line-added">193                                                     serverPrincipal.equals(</span>
<span class="line-added">194                                                             serverAlias.getName())))  {</span>
<span class="line-added">195                                     KerberosPrincipal clientAlias = KerberosSecrets</span>
<span class="line-added">196                                             .getJavaxSecurityAuthKerberosAccess()</span>
<span class="line-added">197                                             .kerberosTicketGetClientAlias(ticket);</span>
198                                     if (clientPrincipal == null ||
199                                         clientPrincipal.equals(
<span class="line-modified">200                                             ticket.getClient().getName()) ||</span>
<span class="line-added">201                                             (clientAlias != null &amp;&amp;</span>
<span class="line-added">202                                             clientPrincipal.equals(</span>
<span class="line-added">203                                                     clientAlias.getName()))) {</span>
204                                         if (oneOnly) {
205                                             return ticket;
206                                         } else {
207                                             // Record names so that tickets will
208                                             // all belong to same principals
209                                             if (clientPrincipal == null) {
<span class="line-modified">210                                                 if (clientAlias == null) {</span>
<span class="line-modified">211                                                     clientPrincipal =</span>
<span class="line-added">212                                                             ticket.getClient().getName();</span>
<span class="line-added">213                                                 } else {</span>
<span class="line-added">214                                                     clientPrincipal =</span>
<span class="line-added">215                                                             clientAlias.getName();</span>
<span class="line-added">216                                                 }</span>
217                                             }
218                                             if (serverPrincipal == null) {
<span class="line-modified">219                                                 if (serverAlias == null) {</span>
<span class="line-modified">220                                                     serverPrincipal =</span>
<span class="line-added">221                                                             ticket.getServer().getName();</span>
<span class="line-added">222                                                 } else {</span>
<span class="line-added">223                                                     serverPrincipal =</span>
<span class="line-added">224                                                             serverAlias.getName();</span>
<span class="line-added">225                                                 }</span>
226                                             }
227                                             answer.add(credClass.cast(ticket));
228                                         }
229                                     }
230                                 }
231                             }
232                         }
233                     }
234                 }
235             }
236             return answer;
237         }
238     }
239 }
</pre>
</td>
</tr>
</table>
<center><a href="Krb5Util.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../spnego/NegTokenTarg.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>