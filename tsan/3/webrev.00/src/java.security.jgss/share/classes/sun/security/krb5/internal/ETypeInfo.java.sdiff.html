<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.jgss/share/classes/sun/security/krb5/internal/ETypeInfo.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CredentialsUtil.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="EncASRepPart.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/classes/sun/security/krb5/internal/ETypeInfo.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2005, 2009, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.krb5.internal;
 27 
<span class="line-removed"> 28 import sun.security.util.*;</span>
<span class="line-removed"> 29 import sun.security.krb5.Asn1Exception;</span>
 30 import java.io.IOException;




 31 import sun.security.krb5.internal.util.KerberosString;

 32 
 33 /**
 34  * Implements the ASN.1 ETYPE-INFO-ENTRY type.
 35  *
 36  * ETYPE-INFO-ENTRY     ::= SEQUENCE {
 37  *         etype        [0] Int32,
 38  *         salt         [1] OCTET STRING OPTIONAL
 39  *   }
 40  *
 41  * @author Seema Malkani
 42  */
 43 
 44 public class ETypeInfo {
 45 
 46     private int etype;
 47     private String salt = null;
 48 
 49     private static final byte TAG_TYPE = 0;
 50     private static final byte TAG_VALUE = 1;
 51 
</pre>
<hr />
<pre>
 82         }
 83         else
 84             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
 85 
 86         // salt
 87         if (encoding.getData().available() &gt; 0) {
 88             der = encoding.getData().getDerValue();
 89             if ((der.getTag() &amp; 0x1F) == 0x01) {
 90                 byte[] saltBytes = der.getData().getOctetString();
 91 
 92                 // Although salt is defined as an OCTET STRING, it&#39;s the
 93                 // encoding from of a string. As RFC 4120 says:
 94                 //
 95                 // &quot;The salt, ..., is also completely unspecified with respect
 96                 // to character set and is probably locale-specific&quot;.
 97                 //
 98                 // It&#39;s known that this field is using the same encoding as
 99                 // KerberosString in most implementations.
100 
101                 if (KerberosString.MSNAME) {
<span class="line-modified">102                     this.salt = new String(saltBytes, &quot;UTF8&quot;);</span>
103                 } else {
104                     this.salt = new String(saltBytes);
105                 }
106             }
107         }
108 
109         if (encoding.getData().available() &gt; 0)
110             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
111     }
112 
113     /**
114      * Encodes this object to an OutputStream.
115      *
116      * @return byte array of the encoded data.
117      * @exception IOException if an I/O error occurs while reading encoded data.
118      * @exception Asn1Exception on encoding errors.
119      */
120     public byte[] asn1Encode() throws Asn1Exception, IOException {
121 
122         DerOutputStream bytes = new DerOutputStream();
123         DerOutputStream temp = new DerOutputStream();
124 
125         temp.putInteger(etype);
126         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true,
127                                         TAG_TYPE), temp);
128 
129         if (salt != null) {
130             temp = new DerOutputStream();
131             if (KerberosString.MSNAME) {
<span class="line-modified">132                 temp.putOctetString(salt.getBytes(&quot;UTF8&quot;));</span>
133             } else {
134                 temp.putOctetString(salt.getBytes());
135             }
136             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true,
137                                         TAG_VALUE), temp);
138         }
139 
140         temp = new DerOutputStream();
141         temp.write(DerValue.tag_Sequence, bytes);
142         return temp.toByteArray();
143     }
144 
145     // accessor methods
146     public int getEType() {
147         return etype;
148     }
149 
150     public String getSalt() {
151         return salt;
152     }
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.security.krb5.internal;
 27 


 28 import java.io.IOException;
<span class="line-added"> 29 </span>
<span class="line-added"> 30 import static java.nio.charset.StandardCharsets.UTF_8;</span>
<span class="line-added"> 31 </span>
<span class="line-added"> 32 import sun.security.krb5.Asn1Exception;</span>
 33 import sun.security.krb5.internal.util.KerberosString;
<span class="line-added"> 34 import sun.security.util.*;</span>
 35 
 36 /**
 37  * Implements the ASN.1 ETYPE-INFO-ENTRY type.
 38  *
 39  * ETYPE-INFO-ENTRY     ::= SEQUENCE {
 40  *         etype        [0] Int32,
 41  *         salt         [1] OCTET STRING OPTIONAL
 42  *   }
 43  *
 44  * @author Seema Malkani
 45  */
 46 
 47 public class ETypeInfo {
 48 
 49     private int etype;
 50     private String salt = null;
 51 
 52     private static final byte TAG_TYPE = 0;
 53     private static final byte TAG_VALUE = 1;
 54 
</pre>
<hr />
<pre>
 85         }
 86         else
 87             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
 88 
 89         // salt
 90         if (encoding.getData().available() &gt; 0) {
 91             der = encoding.getData().getDerValue();
 92             if ((der.getTag() &amp; 0x1F) == 0x01) {
 93                 byte[] saltBytes = der.getData().getOctetString();
 94 
 95                 // Although salt is defined as an OCTET STRING, it&#39;s the
 96                 // encoding from of a string. As RFC 4120 says:
 97                 //
 98                 // &quot;The salt, ..., is also completely unspecified with respect
 99                 // to character set and is probably locale-specific&quot;.
100                 //
101                 // It&#39;s known that this field is using the same encoding as
102                 // KerberosString in most implementations.
103 
104                 if (KerberosString.MSNAME) {
<span class="line-modified">105                     this.salt = new String(saltBytes, UTF_8);</span>
106                 } else {
107                     this.salt = new String(saltBytes);
108                 }
109             }
110         }
111 
112         if (encoding.getData().available() &gt; 0)
113             throw new Asn1Exception(Krb5.ASN1_BAD_ID);
114     }
115 
116     /**
117      * Encodes this object to an OutputStream.
118      *
119      * @return byte array of the encoded data.
120      * @exception IOException if an I/O error occurs while reading encoded data.
121      * @exception Asn1Exception on encoding errors.
122      */
123     public byte[] asn1Encode() throws Asn1Exception, IOException {
124 
125         DerOutputStream bytes = new DerOutputStream();
126         DerOutputStream temp = new DerOutputStream();
127 
128         temp.putInteger(etype);
129         bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true,
130                                         TAG_TYPE), temp);
131 
132         if (salt != null) {
133             temp = new DerOutputStream();
134             if (KerberosString.MSNAME) {
<span class="line-modified">135                 temp.putOctetString(salt.getBytes(UTF_8));</span>
136             } else {
137                 temp.putOctetString(salt.getBytes());
138             }
139             bytes.write(DerValue.createTag(DerValue.TAG_CONTEXT, true,
140                                         TAG_VALUE), temp);
141         }
142 
143         temp = new DerOutputStream();
144         temp.write(DerValue.tag_Sequence, bytes);
145         return temp.toByteArray();
146     }
147 
148     // accessor methods
149     public int getEType() {
150         return etype;
151     }
152 
153     public String getSalt() {
154         return salt;
155     }
</pre>
</td>
</tr>
</table>
<center><a href="CredentialsUtil.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="EncASRepPart.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>