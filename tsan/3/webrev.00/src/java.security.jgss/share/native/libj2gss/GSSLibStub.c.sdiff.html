<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.security.jgss/share/native/libj2gss/GSSLibStub.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../classes/sun/security/krb5/internal/util/KerberosString.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="NativeFunc.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.security.jgss/share/native/libj2gss/GSSLibStub.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 965 JNIEXPORT jbyteArray JNICALL
 966 Java_sun_security_jgss_wrapper_GSSLibStub_acceptContext(JNIEnv *env,
 967                                                         jobject jobj,
 968                                                         jlong pCred,
 969                                                         jobject jcb,
 970                                                         jbyteArray jinToken,
 971                                                         jobject jcontextSpi)
 972 {
 973   OM_uint32 minor, major;
 974   OM_uint32 minor2, major2;
 975   gss_ctx_id_t contextHdl, contextHdlSave;
 976   gss_cred_id_t credHdl;
 977   gss_buffer_desc inToken;
 978   gss_channel_bindings_t cb;
 979   gss_name_t srcName;
 980   gss_buffer_desc outToken;
 981   gss_OID aMech;
 982   OM_uint32 aFlags;
 983   OM_uint32 aTime;
 984   gss_cred_id_t delCred;
<span class="line-modified"> 985   jobject jsrcName=GSS_C_NO_NAME;</span>
 986   jobject jdelCred;
 987   jobject jMech;
 988   jboolean setTarget;
 989   gss_name_t targetName;
 990   jobject jtargetName;
 991 
 992   TRACE0(&quot;[GSSLibStub_acceptContext]&quot;);
 993 
 994   contextHdl = contextHdlSave = (gss_ctx_id_t)jlong_to_ptr(
 995     (*env)-&gt;GetLongField(env, jcontextSpi, FID_NativeGSSContext_pContext));
 996   credHdl = (gss_cred_id_t) jlong_to_ptr(pCred);
 997   initGSSBuffer(env, jinToken, &amp;inToken);
 998   if ((*env)-&gt;ExceptionCheck(env)) {
 999     return NULL;
1000   }
1001   cb = newGSSCB(env, jcb);
1002   if ((*env)-&gt;ExceptionCheck(env)) {
1003     resetGSSBuffer(&amp;inToken);
1004     return NULL;
1005   }
</pre>
<hr />
<pre>
1147   }
1148   return NULL;
1149 }
1150 
1151 /*
1152  * Class:     sun_security_jgss_wrapper_GSSLibStub
1153  * Method:    inquireContext
1154  * Signature: (J)[J
1155  */
1156 JNIEXPORT jlongArray JNICALL
1157 Java_sun_security_jgss_wrapper_GSSLibStub_inquireContext(JNIEnv *env,
1158                                                          jobject jobj,
1159                                                          jlong pContext)
1160 {
1161   OM_uint32 minor, major;
1162   gss_ctx_id_t contextHdl;
1163   gss_name_t srcName, targetName;
1164   OM_uint32 time;
1165   OM_uint32 flags;
1166   int isInitiator, isEstablished;



1167   jlong result[6];
1168   jlongArray jresult;
1169 
1170   contextHdl = (gss_ctx_id_t) jlong_to_ptr(pContext);
1171 
1172   TRACE1(&quot;[GSSLibStub_inquireContext] %&quot; PRIuPTR &quot;&quot;, (uintptr_t)contextHdl);
1173 
1174   srcName = targetName = GSS_C_NO_NAME;
1175   time = 0;
1176   flags = isInitiator = isEstablished = 0;
1177 
1178   /* gss_inquire_context(...) =&gt; GSS_S_NO_CONTEXT(!) */
1179   major = (*ftab-&gt;inquireContext)(&amp;minor, contextHdl, &amp;srcName,
1180                               &amp;targetName, &amp;time, NULL, &amp;flags,
1181                               &amp;isInitiator, &amp;isEstablished);
1182   /* update member values if needed */
1183   TRACE2(&quot;[GSSLibStub_inquireContext] srcName %&quot; PRIuPTR &quot;, targetName %&quot; PRIuPTR &quot;&quot;,
1184       (uintptr_t)srcName, (uintptr_t)targetName);
1185 
1186   checkStatus(env, jobj, major, minor, &quot;[GSSLibStub_inquireContext]&quot;);
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 965 JNIEXPORT jbyteArray JNICALL
 966 Java_sun_security_jgss_wrapper_GSSLibStub_acceptContext(JNIEnv *env,
 967                                                         jobject jobj,
 968                                                         jlong pCred,
 969                                                         jobject jcb,
 970                                                         jbyteArray jinToken,
 971                                                         jobject jcontextSpi)
 972 {
 973   OM_uint32 minor, major;
 974   OM_uint32 minor2, major2;
 975   gss_ctx_id_t contextHdl, contextHdlSave;
 976   gss_cred_id_t credHdl;
 977   gss_buffer_desc inToken;
 978   gss_channel_bindings_t cb;
 979   gss_name_t srcName;
 980   gss_buffer_desc outToken;
 981   gss_OID aMech;
 982   OM_uint32 aFlags;
 983   OM_uint32 aTime;
 984   gss_cred_id_t delCred;
<span class="line-modified"> 985   jobject jsrcName = NULL;</span>
 986   jobject jdelCred;
 987   jobject jMech;
 988   jboolean setTarget;
 989   gss_name_t targetName;
 990   jobject jtargetName;
 991 
 992   TRACE0(&quot;[GSSLibStub_acceptContext]&quot;);
 993 
 994   contextHdl = contextHdlSave = (gss_ctx_id_t)jlong_to_ptr(
 995     (*env)-&gt;GetLongField(env, jcontextSpi, FID_NativeGSSContext_pContext));
 996   credHdl = (gss_cred_id_t) jlong_to_ptr(pCred);
 997   initGSSBuffer(env, jinToken, &amp;inToken);
 998   if ((*env)-&gt;ExceptionCheck(env)) {
 999     return NULL;
1000   }
1001   cb = newGSSCB(env, jcb);
1002   if ((*env)-&gt;ExceptionCheck(env)) {
1003     resetGSSBuffer(&amp;inToken);
1004     return NULL;
1005   }
</pre>
<hr />
<pre>
1147   }
1148   return NULL;
1149 }
1150 
1151 /*
1152  * Class:     sun_security_jgss_wrapper_GSSLibStub
1153  * Method:    inquireContext
1154  * Signature: (J)[J
1155  */
1156 JNIEXPORT jlongArray JNICALL
1157 Java_sun_security_jgss_wrapper_GSSLibStub_inquireContext(JNIEnv *env,
1158                                                          jobject jobj,
1159                                                          jlong pContext)
1160 {
1161   OM_uint32 minor, major;
1162   gss_ctx_id_t contextHdl;
1163   gss_name_t srcName, targetName;
1164   OM_uint32 time;
1165   OM_uint32 flags;
1166   int isInitiator, isEstablished;
<span class="line-added">1167 #if defined (_WIN32) &amp;&amp; defined (_MSC_VER)</span>
<span class="line-added">1168   __declspec(align(8))</span>
<span class="line-added">1169 #endif</span>
1170   jlong result[6];
1171   jlongArray jresult;
1172 
1173   contextHdl = (gss_ctx_id_t) jlong_to_ptr(pContext);
1174 
1175   TRACE1(&quot;[GSSLibStub_inquireContext] %&quot; PRIuPTR &quot;&quot;, (uintptr_t)contextHdl);
1176 
1177   srcName = targetName = GSS_C_NO_NAME;
1178   time = 0;
1179   flags = isInitiator = isEstablished = 0;
1180 
1181   /* gss_inquire_context(...) =&gt; GSS_S_NO_CONTEXT(!) */
1182   major = (*ftab-&gt;inquireContext)(&amp;minor, contextHdl, &amp;srcName,
1183                               &amp;targetName, &amp;time, NULL, &amp;flags,
1184                               &amp;isInitiator, &amp;isEstablished);
1185   /* update member values if needed */
1186   TRACE2(&quot;[GSSLibStub_inquireContext] srcName %&quot; PRIuPTR &quot;, targetName %&quot; PRIuPTR &quot;&quot;,
1187       (uintptr_t)srcName, (uintptr_t)targetName);
1188 
1189   checkStatus(env, jobj, major, minor, &quot;[GSSLibStub_inquireContext]&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../../classes/sun/security/krb5/internal/util/KerberosString.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="NativeFunc.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>