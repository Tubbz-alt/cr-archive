<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/java.rmi/share/classes/sun/rmi/transport/tcp/TCPTransport.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TCPEndpoint.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../man/rmid.1.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.rmi/share/classes/sun/rmi/transport/tcp/TCPTransport.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 271,16 ***</span>
<span class="line-new-header">--- 271,27 ---</span>
       * server socket if the count reaches zero.
       **/
      private void decrementExportCount() {
          assert Thread.holdsLock(this);
          exportCount--;
<span class="line-added">+         if (tcpLog.isLoggable(Log.VERBOSE)) {</span>
<span class="line-added">+             tcpLog.log(Log.VERBOSE,</span>
<span class="line-added">+                     &quot;server socket: &quot; + server + &quot;, exportCount: &quot; + exportCount);</span>
<span class="line-added">+         }</span>
          if (exportCount == 0 &amp;&amp; getEndpoint().getListenPort() != 0) {
              ServerSocket ss = server;
              server = null;
              try {
<span class="line-added">+                 if (tcpLog.isLoggable(Log.BRIEF)) {</span>
<span class="line-added">+                     tcpLog.log(Log.BRIEF, &quot;server socket close: &quot; + ss);</span>
<span class="line-added">+                 }</span>
                  ss.close();
              } catch (IOException e) {
<span class="line-added">+                 if (tcpLog.isLoggable(Log.BRIEF)) {</span>
<span class="line-added">+                     tcpLog.log(Log.BRIEF,</span>
<span class="line-added">+                             &quot;server socket close throws: &quot; + e);</span>
<span class="line-added">+                 }</span>
              }
          }
      }
  
      /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 364,18 ***</span>
<span class="line-new-header">--- 375,26 ---</span>
          public void run() {
              try {
                  executeAcceptLoop();
              } finally {
                  try {
<span class="line-added">+                     if (tcpLog.isLoggable(Log.BRIEF)) {</span>
<span class="line-added">+                         tcpLog.log(Log.BRIEF,</span>
<span class="line-added">+                                 &quot;server socket close: &quot; + serverSocket);</span>
<span class="line-added">+                     }</span>
                      /*
                       * Only one accept loop is started per server
                       * socket, so after no more connections will be
                       * accepted, ensure that the server socket is no
                       * longer listening.
                       */
                      serverSocket.close();
                  } catch (IOException e) {
<span class="line-added">+                     if (tcpLog.isLoggable(Log.BRIEF)) {</span>
<span class="line-added">+                         tcpLog.log(Log.BRIEF,</span>
<span class="line-added">+                                 &quot;server socket close throws: &quot; + e);</span>
<span class="line-added">+                     }</span>
                  }
              }
          }
  
          /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 522,13 ***</span>
<span class="line-new-header">--- 541,19 ---</span>
      }
  
      /** close socket and eat exception */
      private static void closeSocket(Socket sock) {
          try {
<span class="line-added">+             if (tcpLog.isLoggable(Log.BRIEF)) {</span>
<span class="line-added">+                 tcpLog.log(Log.BRIEF, &quot;socket close: &quot; + sock);</span>
<span class="line-added">+             }</span>
              sock.close();
          } catch (IOException ex) {
              // eat exception
<span class="line-added">+             if (tcpLog.isLoggable(Log.BRIEF)) {</span>
<span class="line-added">+                 tcpLog.log(Log.BRIEF, &quot;socket close throws: &quot; + ex);</span>
<span class="line-added">+             }</span>
          }
      }
  
      /**
       * handleMessages decodes transport operations and handles messages
</pre>
<hr />
<pre>
<span class="line-old-header">*** 589,10 ***</span>
<span class="line-new-header">--- 614,13 ---</span>
          } finally {
              try {
                  conn.close();
              } catch (IOException ex) {
                  // eat exception
<span class="line-added">+                 if (tcpLog.isLoggable(Log.BRIEF)) {</span>
<span class="line-added">+                     tcpLog.log(Log.BRIEF, &quot;Connection close throws &quot; + ex);</span>
<span class="line-added">+                 }</span>
              }
          }
      }
  
      /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 721,10 ***</span>
<span class="line-new-header">--- 749,14 ---</span>
                      version != TransportConstants.Version) {
                      // protocol mismatch detected...
                      // just close socket: this would recurse if we marshal an
                      // exception to the client and the protocol at other end
                      // doesn&#39;t match.
<span class="line-added">+                     if (tcpLog.isLoggable(Log.BRIEF)) {</span>
<span class="line-added">+                         tcpLog.log(Log.BRIEF, &quot;magic or version not match: &quot;</span>
<span class="line-added">+                                                   + magic + &quot;, &quot; + version);</span>
<span class="line-added">+                     }</span>
                      closeSocket(socket);
                      return;
                  }
  
                  OutputStream sockOut = socket.getOutputStream();
</pre>
<center><a href="TCPEndpoint.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../man/rmid.1.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>