<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.rmi/share/classes/sun/rmi/server/UnicastRef.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="ActivationGroupImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="UnicastServerRef.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.rmi/share/classes/sun/rmi/server/UnicastRef.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.rmi.server;
 27 
 28 import java.io.IOException;
 29 import java.io.ObjectInput;

 30 import java.io.ObjectOutput;
 31 import java.lang.reflect.Method;
 32 import java.rmi.MarshalException;
 33 import java.rmi.Remote;
 34 import java.rmi.RemoteException;
 35 import java.rmi.UnmarshalException;
 36 import java.rmi.server.Operation;
 37 import java.rmi.server.RemoteCall;
 38 import java.rmi.server.RemoteObject;
 39 import java.rmi.server.RemoteRef;
 40 import java.security.AccessController;
 41 import java.security.PrivilegedAction;


 42 import sun.rmi.runtime.Log;
 43 import sun.rmi.transport.Connection;
 44 import sun.rmi.transport.LiveRef;
 45 import sun.rmi.transport.StreamRemoteCall;
 46 
 47 /**
 48  * NOTE: There is a JDK-internal dependency on the existence of this
 49  * class&#39;s getLiveRef method (as it is inherited by UnicastRef2) in
 50  * the implementation of javax.management.remote.rmi.RMIConnector.
 51  */
 52 @SuppressWarnings(&quot;deprecation&quot;)
 53 public class UnicastRef implements RemoteRef {
 54 
 55     /**
 56      * Client-side transport log.
 57      */
 58     public static final Log clientRefLog =
 59         Log.getLog(&quot;sun.rmi.client.ref&quot;, &quot;transport&quot;,  Util.logLevel);
 60 
 61     /**
</pre>
<hr />
<pre>
301         if (type.isPrimitive()) {
302             if (type == int.class) {
303                 return Integer.valueOf(in.readInt());
304             } else if (type == boolean.class) {
305                 return Boolean.valueOf(in.readBoolean());
306             } else if (type == byte.class) {
307                 return Byte.valueOf(in.readByte());
308             } else if (type == char.class) {
309                 return Character.valueOf(in.readChar());
310             } else if (type == short.class) {
311                 return Short.valueOf(in.readShort());
312             } else if (type == long.class) {
313                 return Long.valueOf(in.readLong());
314             } else if (type == float.class) {
315                 return Float.valueOf(in.readFloat());
316             } else if (type == double.class) {
317                 return Double.valueOf(in.readDouble());
318             } else {
319                 throw new Error(&quot;Unrecognized primitive type: &quot; + type);
320             }


321         } else {
322             return in.readObject();
323         }
324     }
325 
326     /**
327      * Create an appropriate call object for a new call on this object.
328      * Passing operation array and index, allows the stubs generator to
329      * assign the operation indexes and interpret them. The RemoteRef
330      * may need the operation to encode in for the call.
331      */
332     public RemoteCall newCall(RemoteObject obj, Operation[] ops, int opnum,
333                               long hash)
334         throws RemoteException
335     {
336         clientRefLog.log(Log.BRIEF, &quot;get connection&quot;);
337 
338         Connection conn = ref.getChannel().newConnection();
339         try {
340             clientRefLog.log(Log.VERBOSE, &quot;create call context&quot;);
</pre>
</td>
<td>
<hr />
<pre>
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package sun.rmi.server;
 27 
 28 import java.io.IOException;
 29 import java.io.ObjectInput;
<span class="line-added"> 30 import java.io.ObjectInputStream;</span>
 31 import java.io.ObjectOutput;
 32 import java.lang.reflect.Method;
 33 import java.rmi.MarshalException;
 34 import java.rmi.Remote;
 35 import java.rmi.RemoteException;
 36 import java.rmi.UnmarshalException;
 37 import java.rmi.server.Operation;
 38 import java.rmi.server.RemoteCall;
 39 import java.rmi.server.RemoteObject;
 40 import java.rmi.server.RemoteRef;
 41 import java.security.AccessController;
 42 import java.security.PrivilegedAction;
<span class="line-added"> 43 </span>
<span class="line-added"> 44 import jdk.internal.access.SharedSecrets;</span>
 45 import sun.rmi.runtime.Log;
 46 import sun.rmi.transport.Connection;
 47 import sun.rmi.transport.LiveRef;
 48 import sun.rmi.transport.StreamRemoteCall;
 49 
 50 /**
 51  * NOTE: There is a JDK-internal dependency on the existence of this
 52  * class&#39;s getLiveRef method (as it is inherited by UnicastRef2) in
 53  * the implementation of javax.management.remote.rmi.RMIConnector.
 54  */
 55 @SuppressWarnings(&quot;deprecation&quot;)
 56 public class UnicastRef implements RemoteRef {
 57 
 58     /**
 59      * Client-side transport log.
 60      */
 61     public static final Log clientRefLog =
 62         Log.getLog(&quot;sun.rmi.client.ref&quot;, &quot;transport&quot;,  Util.logLevel);
 63 
 64     /**
</pre>
<hr />
<pre>
304         if (type.isPrimitive()) {
305             if (type == int.class) {
306                 return Integer.valueOf(in.readInt());
307             } else if (type == boolean.class) {
308                 return Boolean.valueOf(in.readBoolean());
309             } else if (type == byte.class) {
310                 return Byte.valueOf(in.readByte());
311             } else if (type == char.class) {
312                 return Character.valueOf(in.readChar());
313             } else if (type == short.class) {
314                 return Short.valueOf(in.readShort());
315             } else if (type == long.class) {
316                 return Long.valueOf(in.readLong());
317             } else if (type == float.class) {
318                 return Float.valueOf(in.readFloat());
319             } else if (type == double.class) {
320                 return Double.valueOf(in.readDouble());
321             } else {
322                 throw new Error(&quot;Unrecognized primitive type: &quot; + type);
323             }
<span class="line-added">324         } else if (type == String.class &amp;&amp; in instanceof ObjectInputStream) {</span>
<span class="line-added">325             return SharedSecrets.getJavaObjectInputStreamReadString().readString((ObjectInputStream)in);</span>
326         } else {
327             return in.readObject();
328         }
329     }
330 
331     /**
332      * Create an appropriate call object for a new call on this object.
333      * Passing operation array and index, allows the stubs generator to
334      * assign the operation indexes and interpret them. The RemoteRef
335      * may need the operation to encode in for the call.
336      */
337     public RemoteCall newCall(RemoteObject obj, Operation[] ops, int opnum,
338                               long hash)
339         throws RemoteException
340     {
341         clientRefLog.log(Log.BRIEF, &quot;get connection&quot;);
342 
343         Connection conn = ref.getChannel().newConnection();
344         try {
345             clientRefLog.log(Log.VERBOSE, &quot;create call context&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="ActivationGroupImpl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="UnicastServerRef.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>