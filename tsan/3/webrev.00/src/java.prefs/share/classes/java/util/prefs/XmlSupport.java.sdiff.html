<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.prefs/share/classes/java/util/prefs/XmlSupport.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="NodeChangeEvent.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../windows/native/libprefs/WindowsPreferences.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.prefs/share/classes/java/util/prefs/XmlSupport.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.util.prefs;
 27 
 28 import java.util.*;
 29 import java.io.*;
 30 import javax.xml.parsers.*;
 31 import javax.xml.transform.*;
 32 import javax.xml.transform.dom.*;
 33 import javax.xml.transform.stream.*;
 34 import org.xml.sax.*;
 35 import org.w3c.dom.*;
 36 


 37 /**
 38  * XML Support for java.util.prefs. Methods to import and export preference
 39  * nodes and subtrees.
 40  *
 41  * @author  Josh Bloch and Mark Reinhold
 42  * @see     Preferences
 43  * @since   1.4
 44  */
 45 class XmlSupport {
 46     // The required DTD URI for exported preferences
 47     private static final String PREFS_DTD_URI =
 48         &quot;http://java.sun.com/dtd/preferences.dtd&quot;;
 49 
 50     // The actual DTD corresponding to the URI
 51     private static final String PREFS_DTD =
 52         &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&quot; +
 53 
 54         &quot;&lt;!-- DTD for preferences --&gt;&quot;               +
 55 
 56         &quot;&lt;!ELEMENT preferences (root) &gt;&quot;             +
</pre>
<hr />
<pre>
257      * Write XML document to the specified output stream.
258      */
259     private static final void writeDoc(Document doc, OutputStream out)
260         throws IOException
261     {
262         try {
263             TransformerFactory tf = TransformerFactory.newInstance();
264             try {
265                 tf.setAttribute(&quot;indent-number&quot;, 2);
266             } catch (IllegalArgumentException iae) {
267                 //Ignore the IAE. Should not fail the writeout even the
268                 //transformer provider does not support &quot;indent-number&quot;.
269             }
270             Transformer t = tf.newTransformer();
271             t.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, doc.getDoctype().getSystemId());
272             t.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);
273             //Transformer resets the &quot;indent&quot; info if the &quot;result&quot; is a StreamResult with
274             //an OutputStream object embedded, creating a Writer object on top of that
275             //OutputStream object however works.
276             t.transform(new DOMSource(doc),
<span class="line-modified">277                         new StreamResult(new BufferedWriter(new OutputStreamWriter(out, &quot;UTF-8&quot;))));</span>
278         } catch(TransformerException e) {
279             throw new AssertionError(e);
280         }
281     }
282 
283     /**
284      * Recursively traverse the specified preferences node and store
285      * the described preferences into the system or current user
286      * preferences tree, as appropriate.
287      */
288     private static void ImportSubtree(Preferences prefsNode, Element xmlNode) {
289         NodeList xmlKids = xmlNode.getChildNodes();
290         int numXmlKids = xmlKids.getLength();
291         /*
292          * We first lock the node, import its contents and get
293          * child nodes. Then we unlock the node and go to children
294          * Since some of the children might have been concurrently
295          * deleted we check for this.
296          */
297         Preferences[] prefsKids;
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2002, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.util.prefs;
 27 
 28 import java.util.*;
 29 import java.io.*;
 30 import javax.xml.parsers.*;
 31 import javax.xml.transform.*;
 32 import javax.xml.transform.dom.*;
 33 import javax.xml.transform.stream.*;
 34 import org.xml.sax.*;
 35 import org.w3c.dom.*;
 36 
<span class="line-added"> 37 import static java.nio.charset.StandardCharsets.UTF_8;</span>
<span class="line-added"> 38 </span>
 39 /**
 40  * XML Support for java.util.prefs. Methods to import and export preference
 41  * nodes and subtrees.
 42  *
 43  * @author  Josh Bloch and Mark Reinhold
 44  * @see     Preferences
 45  * @since   1.4
 46  */
 47 class XmlSupport {
 48     // The required DTD URI for exported preferences
 49     private static final String PREFS_DTD_URI =
 50         &quot;http://java.sun.com/dtd/preferences.dtd&quot;;
 51 
 52     // The actual DTD corresponding to the URI
 53     private static final String PREFS_DTD =
 54         &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&quot; +
 55 
 56         &quot;&lt;!-- DTD for preferences --&gt;&quot;               +
 57 
 58         &quot;&lt;!ELEMENT preferences (root) &gt;&quot;             +
</pre>
<hr />
<pre>
259      * Write XML document to the specified output stream.
260      */
261     private static final void writeDoc(Document doc, OutputStream out)
262         throws IOException
263     {
264         try {
265             TransformerFactory tf = TransformerFactory.newInstance();
266             try {
267                 tf.setAttribute(&quot;indent-number&quot;, 2);
268             } catch (IllegalArgumentException iae) {
269                 //Ignore the IAE. Should not fail the writeout even the
270                 //transformer provider does not support &quot;indent-number&quot;.
271             }
272             Transformer t = tf.newTransformer();
273             t.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, doc.getDoctype().getSystemId());
274             t.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);
275             //Transformer resets the &quot;indent&quot; info if the &quot;result&quot; is a StreamResult with
276             //an OutputStream object embedded, creating a Writer object on top of that
277             //OutputStream object however works.
278             t.transform(new DOMSource(doc),
<span class="line-modified">279                         new StreamResult(new BufferedWriter(new OutputStreamWriter(out, UTF_8))));</span>
280         } catch(TransformerException e) {
281             throw new AssertionError(e);
282         }
283     }
284 
285     /**
286      * Recursively traverse the specified preferences node and store
287      * the described preferences into the system or current user
288      * preferences tree, as appropriate.
289      */
290     private static void ImportSubtree(Preferences prefsNode, Element xmlNode) {
291         NodeList xmlKids = xmlNode.getChildNodes();
292         int numXmlKids = xmlKids.getLength();
293         /*
294          * We first lock the node, import its contents and get
295          * child nodes. Then we unlock the node and go to children
296          * Since some of the children might have been concurrently
297          * deleted we check for this.
298          */
299         Preferences[] prefsKids;
</pre>
</td>
</tr>
</table>
<center><a href="NodeChangeEvent.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../windows/native/libprefs/WindowsPreferences.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>