<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.prefs/windows/native/libprefs/WindowsPreferences.c</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="../../../share/classes/java/util/prefs/XmlSupport.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../java.rmi/share/classes/java/rmi/activation/ActivationGroup.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.prefs/windows/native/libprefs/WindowsPreferences.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 32 
 33 #ifdef __cplusplus
 34 extern &quot;C&quot; {
 35 #endif
 36 
 37 /*
 38  * Declare library specific JNI_Onload entry if static build
 39  */
 40 DEF_STATIC_JNI_OnLoad
 41 
 42 JNIEXPORT jlongArray JNICALL
 43 Java_java_util_prefs_WindowsPreferences_WindowsRegOpenKey(JNIEnv* env,
 44     jclass this_class, jlong hKey, jbyteArray lpSubKey, jint securityMask) {
 45     char* str = (*env)-&gt;GetByteArrayElements(env, lpSubKey, NULL);
 46     CHECK_NULL_RETURN(str, NULL);
 47 
 48     HKEY handle;
 49     int errorCode = RegOpenKeyEx((HKEY) hKey, str, 0, securityMask, &amp;handle);
 50     (*env)-&gt;ReleaseByteArrayElements(env, lpSubKey, str, 0);
 51 
<span class="line-modified"> 52     jlong tmp[2];</span>
 53     tmp[0] = (jlong) handle;
 54     tmp[1] = errorCode;
 55     jlongArray result = (*env)-&gt;NewLongArray(env, 2);
 56     if (result != NULL) {
 57         (*env)-&gt;SetLongArrayRegion(env, result, 0, 2, tmp);
 58     }
 59     return result;
 60 }
 61 
 62 JNIEXPORT jint JNICALL
 63 Java_java_util_prefs_WindowsPreferences_WindowsRegCloseKey(JNIEnv* env,
 64     jclass this_class, jlong hKey) {
 65     return (jint) RegCloseKey((HKEY) hKey);
 66 };
 67 
 68 JNIEXPORT jlongArray JNICALL
 69 Java_java_util_prefs_WindowsPreferences_WindowsRegCreateKeyEx(JNIEnv* env,
 70     jclass this_class, jlong hKey, jbyteArray lpSubKey) {
 71     char* str = (*env)-&gt;GetByteArrayElements(env, lpSubKey, NULL);
 72     CHECK_NULL_RETURN(str, NULL);
 73 
 74     HKEY handle;
 75     DWORD lpdwDisposition;
 76     int errorCode = RegCreateKeyEx((HKEY) hKey, str, 0, NULL,
 77         REG_OPTION_NON_VOLATILE, KEY_READ,
 78         NULL, &amp;handle, &amp;lpdwDisposition);
 79     (*env)-&gt;ReleaseByteArrayElements(env, lpSubKey, str, 0);
 80 
<span class="line-modified"> 81     jlong tmp[3];</span>
 82     tmp[0] = (jlong) handle;
 83     tmp[1] = errorCode;
 84     tmp[2] = lpdwDisposition;
 85     jlongArray result = (*env)-&gt;NewLongArray(env, 3);
 86     if (result != NULL) {
 87         (*env)-&gt;SetLongArrayRegion(env, result, 0, 3, tmp);
 88     }
 89     return result;
 90 }
 91 
 92 JNIEXPORT jint JNICALL
 93 Java_java_util_prefs_WindowsPreferences_WindowsRegDeleteKey(JNIEnv* env,
 94     jclass this_class, jlong hKey, jbyteArray lpSubKey) {
 95     char* str = (*env)-&gt;GetByteArrayElements(env, lpSubKey, NULL);
 96     CHECK_NULL_RETURN(str, -1);
 97 
 98     int result = RegDeleteKey((HKEY) hKey, str);
 99     (*env)-&gt;ReleaseByteArrayElements(env, lpSubKey, str, 0);
100     return result;
101 
</pre>
<hr />
<pre>
179     char* valueNameStr = (*env)-&gt;GetByteArrayElements(env, valueName, NULL);
180     CHECK_NULL_RETURN(valueNameStr, -1);
181 
182     int error_code = RegDeleteValue((HKEY) hKey, valueNameStr);
183     (*env)-&gt;ReleaseByteArrayElements(env, valueName, valueNameStr, 0);
184     return error_code;
185 }
186 
187 JNIEXPORT jlongArray JNICALL
188 Java_java_util_prefs_WindowsPreferences_WindowsRegQueryInfoKey(JNIEnv* env,
189     jclass this_class, jlong hKey) {
190     int subKeysNumber;
191     int maxSubKeyLength;
192     int valuesNumber;
193     int maxValueNameLength;
194     int errorCode = RegQueryInfoKey((HKEY) hKey, NULL, NULL, NULL,
195         &amp;subKeysNumber, &amp;maxSubKeyLength, NULL,
196         &amp;valuesNumber, &amp;maxValueNameLength,
197         NULL, NULL, NULL);
198 
<span class="line-modified">199     jlong tmp[5];</span>
200     tmp[0] = subKeysNumber;
201     tmp[1] = errorCode;
202     tmp[2] = valuesNumber;
203     tmp[3] = maxSubKeyLength;
204     tmp[4] = maxValueNameLength;
205     jintArray result = (*env)-&gt;NewLongArray(env, 5);
206     if (result != NULL) {
207         (*env)-&gt;SetLongArrayRegion(env, result, 0, 5, tmp);
208     }
209     return result;
210 }
211 
212 JNIEXPORT jbyteArray JNICALL
213 Java_java_util_prefs_WindowsPreferences_WindowsRegEnumKeyEx(JNIEnv* env,
214     jclass this_class, jlong hKey, jint subKeyIndex, jint maxKeyLength) {
215     int size = maxKeyLength;
216     char* buffer = (char*) malloc(maxKeyLength);
217     if (buffer == NULL) {
218         JNU_ThrowOutOfMemoryError(env, &quot;native memory allocation failed&quot;);
219         return NULL;
</pre>
</td>
<td>
<hr />
<pre>
 32 
 33 #ifdef __cplusplus
 34 extern &quot;C&quot; {
 35 #endif
 36 
 37 /*
 38  * Declare library specific JNI_Onload entry if static build
 39  */
 40 DEF_STATIC_JNI_OnLoad
 41 
 42 JNIEXPORT jlongArray JNICALL
 43 Java_java_util_prefs_WindowsPreferences_WindowsRegOpenKey(JNIEnv* env,
 44     jclass this_class, jlong hKey, jbyteArray lpSubKey, jint securityMask) {
 45     char* str = (*env)-&gt;GetByteArrayElements(env, lpSubKey, NULL);
 46     CHECK_NULL_RETURN(str, NULL);
 47 
 48     HKEY handle;
 49     int errorCode = RegOpenKeyEx((HKEY) hKey, str, 0, securityMask, &amp;handle);
 50     (*env)-&gt;ReleaseByteArrayElements(env, lpSubKey, str, 0);
 51 
<span class="line-modified"> 52     __declspec(align(8)) jlong tmp[2];</span>
 53     tmp[0] = (jlong) handle;
 54     tmp[1] = errorCode;
 55     jlongArray result = (*env)-&gt;NewLongArray(env, 2);
 56     if (result != NULL) {
 57         (*env)-&gt;SetLongArrayRegion(env, result, 0, 2, tmp);
 58     }
 59     return result;
 60 }
 61 
 62 JNIEXPORT jint JNICALL
 63 Java_java_util_prefs_WindowsPreferences_WindowsRegCloseKey(JNIEnv* env,
 64     jclass this_class, jlong hKey) {
 65     return (jint) RegCloseKey((HKEY) hKey);
 66 };
 67 
 68 JNIEXPORT jlongArray JNICALL
 69 Java_java_util_prefs_WindowsPreferences_WindowsRegCreateKeyEx(JNIEnv* env,
 70     jclass this_class, jlong hKey, jbyteArray lpSubKey) {
 71     char* str = (*env)-&gt;GetByteArrayElements(env, lpSubKey, NULL);
 72     CHECK_NULL_RETURN(str, NULL);
 73 
 74     HKEY handle;
 75     DWORD lpdwDisposition;
 76     int errorCode = RegCreateKeyEx((HKEY) hKey, str, 0, NULL,
 77         REG_OPTION_NON_VOLATILE, KEY_READ,
 78         NULL, &amp;handle, &amp;lpdwDisposition);
 79     (*env)-&gt;ReleaseByteArrayElements(env, lpSubKey, str, 0);
 80 
<span class="line-modified"> 81     __declspec(align(8)) jlong tmp[3];</span>
 82     tmp[0] = (jlong) handle;
 83     tmp[1] = errorCode;
 84     tmp[2] = lpdwDisposition;
 85     jlongArray result = (*env)-&gt;NewLongArray(env, 3);
 86     if (result != NULL) {
 87         (*env)-&gt;SetLongArrayRegion(env, result, 0, 3, tmp);
 88     }
 89     return result;
 90 }
 91 
 92 JNIEXPORT jint JNICALL
 93 Java_java_util_prefs_WindowsPreferences_WindowsRegDeleteKey(JNIEnv* env,
 94     jclass this_class, jlong hKey, jbyteArray lpSubKey) {
 95     char* str = (*env)-&gt;GetByteArrayElements(env, lpSubKey, NULL);
 96     CHECK_NULL_RETURN(str, -1);
 97 
 98     int result = RegDeleteKey((HKEY) hKey, str);
 99     (*env)-&gt;ReleaseByteArrayElements(env, lpSubKey, str, 0);
100     return result;
101 
</pre>
<hr />
<pre>
179     char* valueNameStr = (*env)-&gt;GetByteArrayElements(env, valueName, NULL);
180     CHECK_NULL_RETURN(valueNameStr, -1);
181 
182     int error_code = RegDeleteValue((HKEY) hKey, valueNameStr);
183     (*env)-&gt;ReleaseByteArrayElements(env, valueName, valueNameStr, 0);
184     return error_code;
185 }
186 
187 JNIEXPORT jlongArray JNICALL
188 Java_java_util_prefs_WindowsPreferences_WindowsRegQueryInfoKey(JNIEnv* env,
189     jclass this_class, jlong hKey) {
190     int subKeysNumber;
191     int maxSubKeyLength;
192     int valuesNumber;
193     int maxValueNameLength;
194     int errorCode = RegQueryInfoKey((HKEY) hKey, NULL, NULL, NULL,
195         &amp;subKeysNumber, &amp;maxSubKeyLength, NULL,
196         &amp;valuesNumber, &amp;maxValueNameLength,
197         NULL, NULL, NULL);
198 
<span class="line-modified">199     __declspec(align(8)) jlong tmp[5];</span>
200     tmp[0] = subKeysNumber;
201     tmp[1] = errorCode;
202     tmp[2] = valuesNumber;
203     tmp[3] = maxSubKeyLength;
204     tmp[4] = maxValueNameLength;
205     jintArray result = (*env)-&gt;NewLongArray(env, 5);
206     if (result != NULL) {
207         (*env)-&gt;SetLongArrayRegion(env, result, 0, 5, tmp);
208     }
209     return result;
210 }
211 
212 JNIEXPORT jbyteArray JNICALL
213 Java_java_util_prefs_WindowsPreferences_WindowsRegEnumKeyEx(JNIEnv* env,
214     jclass this_class, jlong hKey, jint subKeyIndex, jint maxKeyLength) {
215     int size = maxKeyLength;
216     char* buffer = (char*) malloc(maxKeyLength);
217     if (buffer == NULL) {
218         JNU_ThrowOutOfMemoryError(env, &quot;native memory allocation failed&quot;);
219         return NULL;
</pre>
</td>
</tr>
</table>
<center><a href="../../../share/classes/java/util/prefs/XmlSupport.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../java.rmi/share/classes/java/rmi/activation/ActivationGroup.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>