<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/java.management/share/classes/java/lang/management/MemoryUsage.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2003, 2017, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package java.lang.management;
 27 
 28 import javax.management.openmbean.CompositeData;
 29 import sun.management.MemoryUsageCompositeData;
 30 
 31 /**
 32  * A {@code MemoryUsage} object represents a snapshot of memory usage.
 33  * Instances of the {@code MemoryUsage} class are usually constructed
 34  * by methods that are used to obtain memory usage
 35  * information about individual memory pool of the Java virtual machine or
 36  * the heap or non-heap memory of the Java virtual machine as a whole.
 37  *
 38  * &lt;p&gt; A {@code MemoryUsage} object contains four values:
 39  * &lt;table class=&quot;striped&quot;&gt;
 40  * &lt;caption style=&quot;display:none&quot;&gt;Describes the MemoryUsage object content&lt;/caption&gt;
 41  * &lt;thead&gt;
 42  * &lt;tr&gt;&lt;th scope=&quot;col&quot;&gt;Value&lt;/th&gt;&lt;th scope=&quot;col&quot;&gt;Description&lt;/th&gt;&lt;/tr&gt;
 43  * &lt;/thead&gt;
 44  * &lt;tbody style=&quot;text-align:left&quot;&gt;
 45  * &lt;tr&gt;
 46  * &lt;th scope=&quot;row&quot; style=&quot;vertical-align:top&quot;&gt; {@code init} &lt;/th&gt;
 47  * &lt;td style=&quot;vertical-align:top&quot;&gt; represents the initial amount of memory (in bytes) that
 48  *      the Java virtual machine requests from the operating system
 49  *      for memory management during startup.  The Java virtual machine
 50  *      may request additional memory from the operating system and
 51  *      may also release memory to the system over time.
 52  *      The value of {@code init} may be undefined.
 53  * &lt;/td&gt;
 54  * &lt;/tr&gt;
 55  * &lt;tr&gt;
 56  * &lt;th scope=&quot;row&quot; style=&quot;vertical-align:top&quot;&gt; {@code used} &lt;/th&gt;
 57  * &lt;td style=&quot;vertical-align:top&quot;&gt; represents the amount of memory currently used (in bytes).
 58  * &lt;/td&gt;
 59  * &lt;/tr&gt;
 60  * &lt;tr&gt;
 61  * &lt;th scope=&quot;row&quot; style=&quot;vertical-align:top&quot;&gt; {@code committed} &lt;/th&gt;
 62  * &lt;td style=&quot;vertical-align:top&quot;&gt; represents the amount of memory (in bytes) that is
 63  *      guaranteed to be available for use by the Java virtual machine.
 64  *      The amount of committed memory may change over time (increase
 65  *      or decrease).  The Java virtual machine may release memory to
 66  *      the system and {@code committed} could be less than {@code init}.
 67  *      {@code committed} will always be greater than
 68  *      or equal to {@code used}.
 69  * &lt;/td&gt;
 70  * &lt;/tr&gt;
 71  * &lt;tr&gt;
 72  * &lt;th scope=&quot;row&quot; style=&quot;vertical-align:top&quot;&gt; {@code max} &lt;/th&gt;
 73  * &lt;td style=&quot;vertical-align:top&quot;&gt; represents the maximum amount of memory (in bytes)
 74  *      that can be used for memory management. Its value may be undefined.
 75  *      The maximum amount of memory may change over time if defined.
 76  *      The amount of used and committed memory will always be less than
 77  *      or equal to {@code max} if {@code max} is defined.
 78  *      A memory allocation may fail if it attempts to increase the
 79  *      used memory such that {@code used &gt; committed} even
 80  *      if {@code used &lt;= max} would still be true (for example,
 81  *      when the system is low on virtual memory).
 82  * &lt;/td&gt;
 83  * &lt;/tr&gt;
 84  * &lt;/tbody&gt;
 85  * &lt;/table&gt;
 86  *
 87  * Below is a picture showing an example of a memory pool:
 88  *
 89  * &lt;pre&gt;
 90  *        +----------------------------------------------+
 91  *        +////////////////           |                  +
 92  *        +////////////////           |                  +
 93  *        +----------------------------------------------+
 94  *
 95  *        |--------|
 96  *           init
 97  *        |---------------|
 98  *               used
 99  *        |---------------------------|
100  *                  committed
101  *        |----------------------------------------------|
102  *                            max
103  * &lt;/pre&gt;
104  *
105  * &lt;h3&gt;MXBean Mapping&lt;/h3&gt;
106  * {@code MemoryUsage} is mapped to a {@link CompositeData CompositeData}
107  * with attributes as specified in the {@link #from from} method.
108  *
109  * @author   Mandy Chung
110  * @since   1.5
111  */
112 public class MemoryUsage {
113     private final long init;
114     private final long used;
115     private final long committed;
116     private final long max;
117 
118     /**
119      * Constructs a {@code MemoryUsage} object.
120      *
121      * @param init      the initial amount of memory in bytes that
122      *                  the Java virtual machine allocates;
123      *                  or {@code -1} if undefined.
124      * @param used      the amount of used memory in bytes.
125      * @param committed the amount of committed memory in bytes.
126      * @param max       the maximum amount of memory in bytes that
127      *                  can be used; or {@code -1} if undefined.
128      *
129      * @throws IllegalArgumentException if
130      * &lt;ul&gt;
131      * &lt;li&gt; the value of {@code init} or {@code max} is negative
132      *      but not {@code -1}; or&lt;/li&gt;
133      * &lt;li&gt; the value of {@code used} or {@code committed} is negative;
134      *      or&lt;/li&gt;
135      * &lt;li&gt; {@code used} is greater than the value of {@code committed};
136      *      or&lt;/li&gt;
137      * &lt;li&gt; {@code committed} is greater than the value of {@code max}
138      *      {@code max} if defined.&lt;/li&gt;
139      * &lt;/ul&gt;
140      */
141     public MemoryUsage(long init,
142                        long used,
143                        long committed,
144                        long max) {
145         if (init &lt; -1) {
146             throw new IllegalArgumentException( &quot;init parameter = &quot; +
147                 init + &quot; is negative but not -1.&quot;);
148         }
149         if (max &lt; -1) {
150             throw new IllegalArgumentException( &quot;max parameter = &quot; +
151                 max + &quot; is negative but not -1.&quot;);
152         }
153         if (used &lt; 0) {
154             throw new IllegalArgumentException( &quot;used parameter = &quot; +
155                 used + &quot; is negative.&quot;);
156         }
157         if (committed &lt; 0) {
158             throw new IllegalArgumentException( &quot;committed parameter = &quot; +
159                 committed + &quot; is negative.&quot;);
160         }
161         if (used &gt; committed) {
162             throw new IllegalArgumentException( &quot;used = &quot; + used +
163                 &quot; should be &lt;= committed = &quot; + committed);
164         }
165         if (max &gt;= 0 &amp;&amp; committed &gt; max) {
166             throw new IllegalArgumentException( &quot;committed = &quot; + committed +
167                 &quot; should be &lt; max = &quot; + max);
168         }
169 
170         this.init = init;
171         this.used = used;
172         this.committed = committed;
173         this.max = max;
174     }
175 
176     /**
177      * Constructs a {@code MemoryUsage} object from a
178      * {@link CompositeData CompositeData}.
179      */
180     private MemoryUsage(CompositeData cd) {
181         // validate the input composite data
182         MemoryUsageCompositeData.validateCompositeData(cd);
183 
184         this.init = MemoryUsageCompositeData.getInit(cd);
185         this.used = MemoryUsageCompositeData.getUsed(cd);
186         this.committed = MemoryUsageCompositeData.getCommitted(cd);
187         this.max = MemoryUsageCompositeData.getMax(cd);
188     }
189 
190     /**
191      * Returns the amount of memory in bytes that the Java virtual machine
192      * initially requests from the operating system for memory management.
193      * This method returns {@code -1} if the initial memory size is undefined.
194      *
195      * @return the initial size of memory in bytes;
196      * {@code -1} if undefined.
197      */
198     public long getInit() {
199         return init;
200     }
201 
202     /**
203      * Returns the amount of used memory in bytes.
204      *
205      * @return the amount of used memory in bytes.
206      *
207      */
208     public long getUsed() {
209         return used;
210     };
211 
212     /**
213      * Returns the amount of memory in bytes that is committed for
214      * the Java virtual machine to use.  This amount of memory is
215      * guaranteed for the Java virtual machine to use.
216      *
217      * @return the amount of committed memory in bytes.
218      *
219      */
220     public long getCommitted() {
221         return committed;
222     };
223 
224     /**
225      * Returns the maximum amount of memory in bytes that can be
226      * used for memory management.  This method returns {@code -1}
227      * if the maximum memory size is undefined.
228      *
229      * &lt;p&gt; This amount of memory is not guaranteed to be available
230      * for memory management if it is greater than the amount of
231      * committed memory.  The Java virtual machine may fail to allocate
232      * memory even if the amount of used memory does not exceed this
233      * maximum size.
234      *
235      * @return the maximum amount of memory in bytes;
236      * {@code -1} if undefined.
237      */
238     public long getMax() {
239         return max;
240     };
241 
242     /**
243      * Returns a descriptive representation of this memory usage.
244      */
245     public String toString() {
246         StringBuilder buf = new StringBuilder();
247         buf.append(&quot;init = &quot; + init + &quot;(&quot; + (init &gt;&gt; 10) + &quot;K) &quot;);
248         buf.append(&quot;used = &quot; + used + &quot;(&quot; + (used &gt;&gt; 10) + &quot;K) &quot;);
249         buf.append(&quot;committed = &quot; + committed + &quot;(&quot; +
250                    (committed &gt;&gt; 10) + &quot;K) &quot; );
251         buf.append(&quot;max = &quot; + max + &quot;(&quot; + (max &gt;&gt; 10) + &quot;K)&quot;);
252         return buf.toString();
253     }
254 
255     /**
256      * Returns a {@code MemoryUsage} object represented by the
257      * given {@code CompositeData}. The given {@code CompositeData}
258      * must contain the following attributes:
259      *
260      * &lt;table class=&quot;striped&quot; style=&quot;margin-left:2em;&quot;&gt;
261      * &lt;caption style=&quot;display:none&quot;&gt;The attributes and the types the given CompositeData contains&lt;/caption&gt;
262      * &lt;thead&gt;
263      * &lt;tr&gt;
264      *   &lt;th scope=&quot;col&quot;&gt;Attribute Name&lt;/th&gt;
265      *   &lt;th scope=&quot;col&quot;&gt;Type&lt;/th&gt;
266      * &lt;/tr&gt;
267      * &lt;/thead&gt;
268      * &lt;tbody style=&quot;text-align:left&quot;&gt;
269      * &lt;tr&gt;
270      *   &lt;th scope=&quot;row&quot;&gt;init&lt;/th&gt;
271      *   &lt;td&gt;{@code java.lang.Long}&lt;/td&gt;
272      * &lt;/tr&gt;
273      * &lt;tr&gt;
274      *   &lt;th scope=&quot;row&quot;&gt;used&lt;/th&gt;
275      *   &lt;td&gt;{@code java.lang.Long}&lt;/td&gt;
276      * &lt;/tr&gt;
277      * &lt;tr&gt;
278      *   &lt;th scope=&quot;row&quot;&gt;committed&lt;/th&gt;
279      *   &lt;td&gt;{@code java.lang.Long}&lt;/td&gt;
280      * &lt;/tr&gt;
281      * &lt;tr&gt;
282      *   &lt;th scope=&quot;row&quot;&gt;max&lt;/th&gt;
283      *   &lt;td&gt;{@code java.lang.Long}&lt;/td&gt;
284      * &lt;/tr&gt;
285      * &lt;/tbody&gt;
286      * &lt;/table&gt;
287      *
288      * @param cd {@code CompositeData} representing a {@code MemoryUsage}
289      *
290      * @throws IllegalArgumentException if {@code cd} does not
291      *   represent a {@code MemoryUsage} with the attributes described
292      *   above.
293      *
294      * @return a {@code MemoryUsage} object represented by {@code cd}
295      *         if {@code cd} is not {@code null};
296      *         {@code null} otherwise.
297      */
298     public static MemoryUsage from(CompositeData cd) {
299         if (cd == null) {
300             return null;
301         }
302 
303         if (cd instanceof MemoryUsageCompositeData) {
304             return ((MemoryUsageCompositeData) cd).getMemoryUsage();
305         } else {
306             return new MemoryUsage(cd);
307         }
308 
309     }
310 }
    </pre>
  </body>
</html>