<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.management/share/classes/java/lang/management/ManagementFactory.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="LockInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MemoryMXBean.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.management/share/classes/java/lang/management/ManagementFactory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2003, 2017, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  50 import java.util.Collection;
  51 import java.util.Optional;
  52 import java.util.ServiceLoader;
  53 import java.util.function.Function;
  54 import java.util.stream.Collectors;
  55 import static java.util.stream.Collectors.toMap;
  56 import java.util.stream.Stream;
  57 import javax.management.JMX;
  58 import sun.management.Util;
  59 import sun.management.spi.PlatformMBeanProvider;
  60 import sun.management.spi.PlatformMBeanProvider.PlatformComponent;
  61 
  62 /**
  63  * The {@code ManagementFactory} class is a factory class for getting
  64  * managed beans for the Java platform.
  65  * This class consists of static methods each of which returns
  66  * one or more &lt;i&gt;platform MXBeans&lt;/i&gt; representing
  67  * the management interface of a component of the Java virtual
  68  * machine.
  69  *
<span class="line-modified">  70  * &lt;h3&gt;&lt;a id=&quot;MXBean&quot;&gt;Platform MXBeans&lt;/a&gt;&lt;/h3&gt;</span>
  71  * &lt;p&gt;
  72  * A platform MXBean is a &lt;i&gt;managed bean&lt;/i&gt; that
  73  * conforms to the &lt;a href=&quot;../../../javax/management/package-summary.html&quot;&gt;JMX&lt;/a&gt;
  74  * Instrumentation Specification and only uses a set of basic data types.
  75  * A JMX management application and the {@linkplain
  76  * #getPlatformMBeanServer platform MBeanServer}
  77  * can interoperate without requiring classes for MXBean specific
  78  * data types.
  79  * The data types being transmitted between the JMX connector
  80  * server and the connector client are
  81  * {@linkplain javax.management.openmbean.OpenType open types}
  82  * and this allows interoperation across versions.
  83  * See &lt;a href=&quot;../../../javax/management/MXBean.html#MXBean-spec&quot;&gt;
  84  * the specification of MXBeans&lt;/a&gt; for details.
  85  *
  86  * &lt;a id=&quot;MXBeanNames&quot;&gt;&lt;/a&gt;
  87  * &lt;p&gt;Each platform MXBean is a {@link PlatformManagedObject}
  88  * and it has a unique
  89  * {@link javax.management.ObjectName ObjectName} for
  90  * registration in the platform {@code MBeanServer} as returned by
  91  * by the {@link PlatformManagedObject#getObjectName getObjectName}
  92  * method.
  93  *
  94  * &lt;p&gt;
  95  * An application can access a platform MXBean in the following ways:
<span class="line-modified">  96  * &lt;h4&gt;1. Direct access to an MXBean interface&lt;/h4&gt;</span>
  97  * &lt;blockquote&gt;
  98  * &lt;ul&gt;
  99  *     &lt;li&gt;Get an MXBean instance by calling the
 100  *         {@link #getPlatformMXBean(Class) getPlatformMXBean} or
 101  *         {@link #getPlatformMXBeans(Class) getPlatformMXBeans} method
 102  *         and access the MXBean locally in the running
 103  *         virtual machine.
 104  *         &lt;/li&gt;
 105  *     &lt;li&gt;Construct an MXBean proxy instance that forwards the
 106  *         method calls to a given {@link MBeanServer MBeanServer} by calling
 107  *         the {@link #getPlatformMXBean(MBeanServerConnection, Class)} or
 108  *         {@link #getPlatformMXBeans(MBeanServerConnection, Class)} method.
 109  *         The {@link #newPlatformMXBeanProxy newPlatformMXBeanProxy} method
 110  *         can also be used to construct an MXBean proxy instance of
 111  *         a given {@code ObjectName}.
 112  *         A proxy is typically constructed to remotely access
 113  *         an MXBean of another running virtual machine.
 114  *         &lt;/li&gt;
 115  * &lt;/ul&gt;
<span class="line-modified"> 116  * &lt;h4&gt;2. Indirect access to an MXBean interface via MBeanServer&lt;/h4&gt;</span>
 117  * &lt;ul&gt;
 118  *     &lt;li&gt;Go through the platform {@code MBeanServer} to access MXBeans
 119  *         locally or a specific {@code MBeanServerConnection} to access
 120  *         MXBeans remotely.
 121  *         The attributes and operations of an MXBean use only
 122  *         &lt;em&gt;JMX open types&lt;/em&gt; which include basic data types,
 123  *         {@link javax.management.openmbean.CompositeData CompositeData},
 124  *         and {@link javax.management.openmbean.TabularData TabularData}
 125  *         defined in
 126  *         {@link javax.management.openmbean.OpenType OpenType}.
 127  *         The mapping is specified in
 128  *         the {@linkplain javax.management.MXBean MXBean} specification
 129  *         for details.
 130  *        &lt;/li&gt;
 131  * &lt;/ul&gt;
 132  * &lt;/blockquote&gt;
 133  *
 134  * &lt;p&gt;
 135  * The {@link #getPlatformManagementInterfaces getPlatformManagementInterfaces}
 136  * method returns all management interfaces supported in the Java virtual machine
</pre>
<hr />
<pre>
 855         }
 856         return Stream.empty();
 857     }
 858 
 859     /**
 860      * Returns the set of {@code Class} objects, subinterface of
 861      * {@link PlatformManagedObject}, representing
 862      * all management interfaces for
 863      * monitoring and managing the Java platform.
 864      *
 865      * @return the set of {@code Class} objects, subinterface of
 866      * {@link PlatformManagedObject} representing
 867      * the management interfaces for
 868      * monitoring and managing the Java platform.
 869      *
 870      * @since 1.7
 871      */
 872     public static Set&lt;Class&lt;? extends PlatformManagedObject&gt;&gt;
 873            getPlatformManagementInterfaces()
 874     {
<span class="line-modified"> 875         return platformComponents()</span>

 876                 .stream()
 877                 .flatMap(pc -&gt; pc.mbeanInterfaces().stream())
 878                 .filter(clazz -&gt; PlatformManagedObject.class.isAssignableFrom(clazz))
<span class="line-modified"> 879                 .map(clazz -&gt; clazz.asSubclass(PlatformManagedObject.class))</span>
<span class="line-modified"> 880                 .collect(Collectors.toSet());</span>
 881     }
 882 
 883     private static final String NOTIF_EMITTER =
 884         &quot;javax.management.NotificationEmitter&quot;;
 885 
 886     private static void addMXBean(final MBeanServer mbs, String name, final Object pmo)
 887     {
 888         try {
 889             ObjectName oname = ObjectName.getInstance(name);
 890             // Make DynamicMBean out of MXBean by wrapping it with a StandardMBean
 891             AccessController.doPrivileged((PrivilegedExceptionAction&lt;Void&gt;) () -&gt; {
 892                 final DynamicMBean dmbean;
 893                 if (pmo instanceof DynamicMBean) {
 894                     dmbean = DynamicMBean.class.cast(pmo);
 895                 } else if (pmo instanceof NotificationEmitter) {
 896                     dmbean = new StandardEmitterMBean(pmo, null, true, (NotificationEmitter) pmo);
 897                 } else {
 898                     dmbean = new StandardMBean(pmo, null, true);
 899                 }
 900 
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2003, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
  50 import java.util.Collection;
  51 import java.util.Optional;
  52 import java.util.ServiceLoader;
  53 import java.util.function.Function;
  54 import java.util.stream.Collectors;
  55 import static java.util.stream.Collectors.toMap;
  56 import java.util.stream.Stream;
  57 import javax.management.JMX;
  58 import sun.management.Util;
  59 import sun.management.spi.PlatformMBeanProvider;
  60 import sun.management.spi.PlatformMBeanProvider.PlatformComponent;
  61 
  62 /**
  63  * The {@code ManagementFactory} class is a factory class for getting
  64  * managed beans for the Java platform.
  65  * This class consists of static methods each of which returns
  66  * one or more &lt;i&gt;platform MXBeans&lt;/i&gt; representing
  67  * the management interface of a component of the Java virtual
  68  * machine.
  69  *
<span class="line-modified">  70  * &lt;h2&gt;&lt;a id=&quot;MXBean&quot;&gt;Platform MXBeans&lt;/a&gt;&lt;/h2&gt;</span>
  71  * &lt;p&gt;
  72  * A platform MXBean is a &lt;i&gt;managed bean&lt;/i&gt; that
  73  * conforms to the &lt;a href=&quot;../../../javax/management/package-summary.html&quot;&gt;JMX&lt;/a&gt;
  74  * Instrumentation Specification and only uses a set of basic data types.
  75  * A JMX management application and the {@linkplain
  76  * #getPlatformMBeanServer platform MBeanServer}
  77  * can interoperate without requiring classes for MXBean specific
  78  * data types.
  79  * The data types being transmitted between the JMX connector
  80  * server and the connector client are
  81  * {@linkplain javax.management.openmbean.OpenType open types}
  82  * and this allows interoperation across versions.
  83  * See &lt;a href=&quot;../../../javax/management/MXBean.html#MXBean-spec&quot;&gt;
  84  * the specification of MXBeans&lt;/a&gt; for details.
  85  *
  86  * &lt;a id=&quot;MXBeanNames&quot;&gt;&lt;/a&gt;
  87  * &lt;p&gt;Each platform MXBean is a {@link PlatformManagedObject}
  88  * and it has a unique
  89  * {@link javax.management.ObjectName ObjectName} for
  90  * registration in the platform {@code MBeanServer} as returned by
  91  * by the {@link PlatformManagedObject#getObjectName getObjectName}
  92  * method.
  93  *
  94  * &lt;p&gt;
  95  * An application can access a platform MXBean in the following ways:
<span class="line-modified">  96  * &lt;h3&gt;1. Direct access to an MXBean interface&lt;/h3&gt;</span>
  97  * &lt;blockquote&gt;
  98  * &lt;ul&gt;
  99  *     &lt;li&gt;Get an MXBean instance by calling the
 100  *         {@link #getPlatformMXBean(Class) getPlatformMXBean} or
 101  *         {@link #getPlatformMXBeans(Class) getPlatformMXBeans} method
 102  *         and access the MXBean locally in the running
 103  *         virtual machine.
 104  *         &lt;/li&gt;
 105  *     &lt;li&gt;Construct an MXBean proxy instance that forwards the
 106  *         method calls to a given {@link MBeanServer MBeanServer} by calling
 107  *         the {@link #getPlatformMXBean(MBeanServerConnection, Class)} or
 108  *         {@link #getPlatformMXBeans(MBeanServerConnection, Class)} method.
 109  *         The {@link #newPlatformMXBeanProxy newPlatformMXBeanProxy} method
 110  *         can also be used to construct an MXBean proxy instance of
 111  *         a given {@code ObjectName}.
 112  *         A proxy is typically constructed to remotely access
 113  *         an MXBean of another running virtual machine.
 114  *         &lt;/li&gt;
 115  * &lt;/ul&gt;
<span class="line-modified"> 116  * &lt;h3&gt;2. Indirect access to an MXBean interface via MBeanServer&lt;/h3&gt;</span>
 117  * &lt;ul&gt;
 118  *     &lt;li&gt;Go through the platform {@code MBeanServer} to access MXBeans
 119  *         locally or a specific {@code MBeanServerConnection} to access
 120  *         MXBeans remotely.
 121  *         The attributes and operations of an MXBean use only
 122  *         &lt;em&gt;JMX open types&lt;/em&gt; which include basic data types,
 123  *         {@link javax.management.openmbean.CompositeData CompositeData},
 124  *         and {@link javax.management.openmbean.TabularData TabularData}
 125  *         defined in
 126  *         {@link javax.management.openmbean.OpenType OpenType}.
 127  *         The mapping is specified in
 128  *         the {@linkplain javax.management.MXBean MXBean} specification
 129  *         for details.
 130  *        &lt;/li&gt;
 131  * &lt;/ul&gt;
 132  * &lt;/blockquote&gt;
 133  *
 134  * &lt;p&gt;
 135  * The {@link #getPlatformManagementInterfaces getPlatformManagementInterfaces}
 136  * method returns all management interfaces supported in the Java virtual machine
</pre>
<hr />
<pre>
 855         }
 856         return Stream.empty();
 857     }
 858 
 859     /**
 860      * Returns the set of {@code Class} objects, subinterface of
 861      * {@link PlatformManagedObject}, representing
 862      * all management interfaces for
 863      * monitoring and managing the Java platform.
 864      *
 865      * @return the set of {@code Class} objects, subinterface of
 866      * {@link PlatformManagedObject} representing
 867      * the management interfaces for
 868      * monitoring and managing the Java platform.
 869      *
 870      * @since 1.7
 871      */
 872     public static Set&lt;Class&lt;? extends PlatformManagedObject&gt;&gt;
 873            getPlatformManagementInterfaces()
 874     {
<span class="line-modified"> 875         // local variable required here; see JDK-8223553</span>
<span class="line-added"> 876         Stream&lt;Class&lt;? extends PlatformManagedObject&gt;&gt; pmos = platformComponents()</span>
 877                 .stream()
 878                 .flatMap(pc -&gt; pc.mbeanInterfaces().stream())
 879                 .filter(clazz -&gt; PlatformManagedObject.class.isAssignableFrom(clazz))
<span class="line-modified"> 880                 .map(clazz -&gt; clazz.asSubclass(PlatformManagedObject.class));</span>
<span class="line-modified"> 881         return pmos.collect(Collectors.toSet());</span>
 882     }
 883 
 884     private static final String NOTIF_EMITTER =
 885         &quot;javax.management.NotificationEmitter&quot;;
 886 
 887     private static void addMXBean(final MBeanServer mbs, String name, final Object pmo)
 888     {
 889         try {
 890             ObjectName oname = ObjectName.getInstance(name);
 891             // Make DynamicMBean out of MXBean by wrapping it with a StandardMBean
 892             AccessController.doPrivileged((PrivilegedExceptionAction&lt;Void&gt;) () -&gt; {
 893                 final DynamicMBean dmbean;
 894                 if (pmo instanceof DynamicMBean) {
 895                     dmbean = DynamicMBean.class.cast(pmo);
 896                 } else if (pmo instanceof NotificationEmitter) {
 897                     dmbean = new StandardEmitterMBean(pmo, null, true, (NotificationEmitter) pmo);
 898                 } else {
 899                     dmbean = new StandardMBean(pmo, null, true);
 900                 }
 901 
</pre>
</td>
</tr>
</table>
<center><a href="LockInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="MemoryMXBean.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>