<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/java.xml.crypto/share/classes/org/jcp/xml/dsig/internal/dom/DOMSignatureProperties.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /**
  6  * Licensed to the Apache Software Foundation (ASF) under one
  7  * or more contributor license agreements. See the NOTICE file
  8  * distributed with this work for additional information
  9  * regarding copyright ownership. The ASF licenses this file
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 /*
 24  * Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.
 25  */
 26 /*
 27  * $Id: DOMSignatureProperties.java 1788465 2017-03-24 15:10:51Z coheigea $
 28  */
 29 package org.jcp.xml.dsig.internal.dom;
 30 
 31 import javax.xml.crypto.*;
 32 import javax.xml.crypto.dom.DOMCryptoContext;
 33 import javax.xml.crypto.dsig.*;
 34 
 35 import java.util.*;
 36 
 37 import org.w3c.dom.Attr;
 38 import org.w3c.dom.Document;
 39 import org.w3c.dom.Element;
 40 import org.w3c.dom.Node;
 41 
 42 /**
 43  * DOM-based implementation of SignatureProperties.
 44  *
 45  */
 46 public final class DOMSignatureProperties extends DOMStructure
 47     implements SignatureProperties {
 48 
 49     private final String id;
 50     private final List&lt;SignatureProperty&gt; properties;
 51 
 52     /**
 53      * Creates a {@code DOMSignatureProperties} from the specified
 54      * parameters.
 55      *
 56      * @param properties a list of one or more {@link SignatureProperty}s. The
 57      *    list is defensively copied to protect against subsequent modification.
 58      * @param id the Id (may be {@code null})
 59      * @throws ClassCastException if {@code properties} contains any
 60      *    entries that are not of type {@link SignatureProperty}
 61      * @throws IllegalArgumentException if {@code properties} is empty
 62      * @throws NullPointerException if {@code properties}
 63      */
 64     public DOMSignatureProperties(List&lt;? extends SignatureProperty&gt; properties,
 65                                   String id)
 66     {
 67         if (properties == null) {
 68             throw new NullPointerException(&quot;properties cannot be null&quot;);
 69         } else if (properties.isEmpty()) {
 70             throw new IllegalArgumentException(&quot;properties cannot be empty&quot;);
 71         } else {
 72             this.properties = Collections.unmodifiableList(
 73                 new ArrayList&lt;&gt;(properties));
 74             for (int i = 0, size = this.properties.size(); i &lt; size; i++) {
 75                 if (!(this.properties.get(i) instanceof SignatureProperty)) {
 76                     throw new ClassCastException
 77                         (&quot;properties[&quot;+i+&quot;] is not a valid type&quot;);
 78                 }
 79             }
 80         }
 81         this.id = id;
 82     }
 83 
 84     /**
 85      * Creates a {@code DOMSignatureProperties} from an element.
 86      *
 87      * @param propsElem a SignatureProperties element
 88      * @throws MarshalException if a marshalling error occurs
 89      */
 90     public DOMSignatureProperties(Element propsElem)
 91         throws MarshalException
 92     {
 93         // unmarshal attributes
 94         Attr attr = propsElem.getAttributeNodeNS(null, &quot;Id&quot;);
 95         if (attr != null) {
 96             id = attr.getValue();
 97             propsElem.setIdAttributeNode(attr, true);
 98         } else {
 99             id = null;
100         }
101 
102         List&lt;SignatureProperty&gt; newProperties = new ArrayList&lt;&gt;();
103         Node firstChild = propsElem.getFirstChild();
104         while (firstChild != null) {
105             if (firstChild.getNodeType() == Node.ELEMENT_NODE) {
106                 String name = firstChild.getLocalName();
107                 String namespace = firstChild.getNamespaceURI();
108                 if (!&quot;SignatureProperty&quot;.equals(name) || !XMLSignature.XMLNS.equals(namespace)) {
109                     throw new MarshalException(&quot;Invalid element name: &quot; + namespace + &quot;:&quot; + name +
110                                                &quot;, expected SignatureProperty&quot;);
111                 }
112                 newProperties.add(new DOMSignatureProperty((Element)firstChild));
113             }
114             firstChild = firstChild.getNextSibling();
115         }
116         if (newProperties.isEmpty()) {
117             throw new MarshalException(&quot;properties cannot be empty&quot;);
118         } else {
119             this.properties = Collections.unmodifiableList(newProperties);
120         }
121     }
122 
123     public List&lt;SignatureProperty&gt; getProperties() {
124         return properties;
125     }
126 
127     public String getId() {
128         return id;
129     }
130 
131     @Override
132     public void marshal(Node parent, String dsPrefix, DOMCryptoContext context)
133         throws MarshalException
134     {
135         Document ownerDoc = DOMUtils.getOwnerDocument(parent);
136         Element propsElem = DOMUtils.createElement(ownerDoc,
137                                                    &quot;SignatureProperties&quot;,
138                                                    XMLSignature.XMLNS,
139                                                    dsPrefix);
140 
141         // set attributes
142         DOMUtils.setAttributeID(propsElem, &quot;Id&quot;, id);
143 
144         // create and append any properties
145         for (SignatureProperty property : properties) {
146             ((DOMSignatureProperty)property).marshal(propsElem, dsPrefix,
147                                                      context);
148         }
149 
150         parent.appendChild(propsElem);
151     }
152 
153     @Override
154     public boolean equals(Object o) {
155         if (this == o) {
156             return true;
157         }
158 
159         if (!(o instanceof SignatureProperties)) {
160             return false;
161         }
162         SignatureProperties osp = (SignatureProperties)o;
163 
164         boolean idsEqual = id == null ? osp.getId() == null
165                                        : id.equals(osp.getId());
166 
167         return properties.equals(osp.getProperties()) &amp;&amp; idsEqual;
168     }
169 
170     @Override
171     public int hashCode() {
172         int result = 17;
173         if (id != null) {
174             result = 31 * result + id.hashCode();
175         }
176         result = 31 * result + properties.hashCode();
177 
178         return result;
179     }
180 }
    </pre>
  </body>
</html>