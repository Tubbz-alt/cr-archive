<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml.crypto/share/classes/org/jcp/xml/dsig/internal/dom/DOMManifest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /**
  6  * Licensed to the Apache Software Foundation (ASF) under one
  7  * or more contributor license agreements. See the NOTICE file
  8  * distributed with this work for additional information
  9  * regarding copyright ownership. The ASF licenses this file
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 /*
<a name="1" id="anc1"></a><span class="line-modified"> 24  * Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.</span>
 25  */
 26 /*
<a name="2" id="anc2"></a><span class="line-modified"> 27  * $Id: DOMManifest.java 1788465 2017-03-24 15:10:51Z coheigea $</span>
 28  */
 29 package org.jcp.xml.dsig.internal.dom;
 30 
 31 import javax.xml.crypto.*;
 32 import javax.xml.crypto.dom.DOMCryptoContext;
 33 import javax.xml.crypto.dsig.*;
 34 
 35 import java.security.Provider;
 36 import java.util.*;
 37 
 38 import org.w3c.dom.Document;
 39 import org.w3c.dom.Element;
 40 import org.w3c.dom.Node;
 41 
 42 /**
 43  * DOM-based implementation of Manifest.
 44  *
 45  */
 46 public final class DOMManifest extends DOMStructure implements Manifest {
 47 
 48     private final List&lt;Reference&gt; references;
 49     private final String id;
 50 
 51     /**
 52      * Creates a {@code DOMManifest} containing the specified
 53      * list of {@link Reference}s and optional id.
 54      *
 55      * @param references a list of one or more {@code Reference}s. The list
 56      *    is defensively copied to protect against subsequent modification.
 57      * @param id the id (may be {@code null}
 58      * @throws NullPointerException if {@code references} is
 59      *    {@code null}
 60      * @throws IllegalArgumentException if {@code references} is empty
 61      * @throws ClassCastException if {@code references} contains any
 62      *    entries that are not of type {@link Reference}
 63      */
 64     public DOMManifest(List&lt;? extends Reference&gt; references, String id) {
 65         if (references == null) {
 66             throw new NullPointerException(&quot;references cannot be null&quot;);
 67         }
 68         this.references =
 69             Collections.unmodifiableList(new ArrayList&lt;&gt;(references));
 70         if (this.references.isEmpty()) {
 71             throw new IllegalArgumentException(&quot;list of references must &quot; +
 72                 &quot;contain at least one entry&quot;);
 73         }
 74         for (int i = 0, size = this.references.size(); i &lt; size; i++) {
 75             if (!(this.references.get(i) instanceof Reference)) {
 76                 throw new ClassCastException
 77                     (&quot;references[&quot;+i+&quot;] is not a valid type&quot;);
 78             }
 79         }
 80         this.id = id;
 81     }
 82 
 83     /**
 84      * Creates a {@code DOMManifest} from an element.
 85      *
 86      * @param manElem a Manifest element
 87      */
 88     public DOMManifest(Element manElem, XMLCryptoContext context,
 89                        Provider provider)
 90         throws MarshalException
 91     {
 92         this.id = DOMUtils.getIdAttributeValue(manElem, &quot;Id&quot;);
 93 
 94         boolean secVal = Utils.secureValidation(context);
 95 
 96         Element refElem = DOMUtils.getFirstChildElement(manElem, &quot;Reference&quot;, XMLSignature.XMLNS);
 97         List&lt;Reference&gt; refs = new ArrayList&lt;&gt;();
 98         refs.add(new DOMReference(refElem, context, provider));
 99 
100         refElem = DOMUtils.getNextSiblingElement(refElem);
101         while (refElem != null) {
102             String localName = refElem.getLocalName();
103             String namespace = refElem.getNamespaceURI();
104             if (!&quot;Reference&quot;.equals(localName) || !XMLSignature.XMLNS.equals(namespace)) {
105                 throw new MarshalException(&quot;Invalid element name: &quot; +
106                                            namespace + &quot;:&quot; + localName + &quot;, expected Reference&quot;);
107             }
108             refs.add(new DOMReference(refElem, context, provider));
109             if (secVal &amp;&amp; Policy.restrictNumReferences(refs.size())) {
110                 String error = &quot;A maxiumum of &quot; + Policy.maxReferences()
111                     + &quot; references per Manifest are allowed when&quot;
112                     + &quot; secure validation is enabled&quot;;
113                 throw new MarshalException(error);
114             }
115             refElem = DOMUtils.getNextSiblingElement(refElem);
116         }
117         this.references = Collections.unmodifiableList(refs);
118     }
119 
120     public String getId() {
121         return id;
122     }
123 
124     @SuppressWarnings(&quot;unchecked&quot;)
125     public static List&lt;Reference&gt; getManifestReferences(Manifest mf) {
126         return mf.getReferences();
127     }
128 
129     @Override
130     public List&lt;Reference&gt; getReferences() {
131         return references;
132     }
133 
134     @Override
135     public void marshal(Node parent, String dsPrefix, DOMCryptoContext context)
136         throws MarshalException
137     {
138         Document ownerDoc = DOMUtils.getOwnerDocument(parent);
139         Element manElem = DOMUtils.createElement(ownerDoc, &quot;Manifest&quot;,
140                                                  XMLSignature.XMLNS, dsPrefix);
141 
142         DOMUtils.setAttributeID(manElem, &quot;Id&quot;, id);
143 
144         // add references
145         for (Reference ref : references) {
146             ((DOMReference)ref).marshal(manElem, dsPrefix, context);
147         }
148         parent.appendChild(manElem);
149     }
150 
151     @Override
152     public boolean equals(Object o) {
153         if (this == o) {
154             return true;
155         }
156 
157         if (!(o instanceof Manifest)) {
158             return false;
159         }
160         Manifest oman = (Manifest)o;
161 
162         boolean idsEqual = id == null ? oman.getId() == null
163                                        : id.equals(oman.getId());
164 
165         return idsEqual &amp;&amp; references.equals(oman.getReferences());
166     }
167 
168     @Override
169     public int hashCode() {
170         int result = 17;
171         if (id != null) {
172             result = 31 * result + id.hashCode();
173         }
174         result = 31 * result + references.hashCode();
175 
176         return result;
177     }
178 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>