<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml.crypto/share/classes/org/jcp/xml/dsig/internal/dom/DOMTransform.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /**
  6  * Licensed to the Apache Software Foundation (ASF) under one
  7  * or more contributor license agreements. See the NOTICE file
  8  * distributed with this work for additional information
  9  * regarding copyright ownership. The ASF licenses this file
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 /*
<a name="1" id="anc1"></a><span class="line-modified"> 24  * Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.</span>
 25  */
 26 /*
<a name="2" id="anc2"></a><span class="line-modified"> 27  * $Id: DOMTransform.java 1788465 2017-03-24 15:10:51Z coheigea $</span>
 28  */
 29 package org.jcp.xml.dsig.internal.dom;
 30 
 31 import java.io.OutputStream;
 32 import java.security.InvalidAlgorithmParameterException;
 33 import java.security.NoSuchAlgorithmException;
 34 import java.security.Provider;
 35 import java.security.spec.AlgorithmParameterSpec;
 36 
 37 import javax.xml.crypto.Data;
 38 import javax.xml.crypto.MarshalException;
 39 import javax.xml.crypto.XMLCryptoContext;
 40 import javax.xml.crypto.dom.DOMCryptoContext;
 41 import javax.xml.crypto.dsig.Transform;
 42 import javax.xml.crypto.dsig.TransformException;
 43 import javax.xml.crypto.dsig.TransformService;
 44 import javax.xml.crypto.dsig.XMLSignature;
 45 import javax.xml.crypto.dsig.dom.DOMSignContext;
 46 
 47 import org.w3c.dom.Document;
 48 import org.w3c.dom.Element;
 49 import org.w3c.dom.Node;
 50 
 51 /**
 52  * DOM-based abstract implementation of Transform.
 53  *
 54  */
 55 public class DOMTransform extends DOMStructure implements Transform {
 56 
 57     protected TransformService spi;
 58 
 59     /**
 60      * Creates a {@code DOMTransform}.
 61      *
 62      * @param spi the TransformService
 63      */
 64     public DOMTransform(TransformService spi) {
 65         this.spi = spi;
 66     }
 67 
 68     /**
 69      * Creates a {@code DOMTransform} from an element. It unmarshals any
 70      * algorithm-specific input parameters.
 71      *
 72      * @param transElem a Transform element
 73      */
 74     public DOMTransform(Element transElem, XMLCryptoContext context,
 75                         Provider provider)
 76         throws MarshalException
 77     {
 78         String algorithm = DOMUtils.getAttributeValue(transElem, &quot;Algorithm&quot;);
 79 
 80         if (provider == null) {
 81             try {
 82                 spi = TransformService.getInstance(algorithm, &quot;DOM&quot;);
 83             } catch (NoSuchAlgorithmException e1) {
 84                 throw new MarshalException(e1);
 85             }
 86         } else {
 87             try {
 88                 spi = TransformService.getInstance(algorithm, &quot;DOM&quot;, provider);
 89             } catch (NoSuchAlgorithmException nsae) {
 90                 try {
 91                     spi = TransformService.getInstance(algorithm, &quot;DOM&quot;);
 92                 } catch (NoSuchAlgorithmException e2) {
 93                     throw new MarshalException(e2);
 94                 }
 95             }
 96         }
 97         try {
 98             spi.init(new javax.xml.crypto.dom.DOMStructure(transElem), context);
 99         } catch (InvalidAlgorithmParameterException iape) {
100             throw new MarshalException(iape);
101         }
102     }
103 
104     public final AlgorithmParameterSpec getParameterSpec() {
105         return spi.getParameterSpec();
106     }
107 
108     public final String getAlgorithm() {
109         return spi.getAlgorithm();
110     }
111 
112     /**
113      * This method marshals any algorithm-specific parameters.
114      */
115     @Override
116     public void marshal(Node parent, String dsPrefix, DOMCryptoContext context)
117         throws MarshalException
118     {
119         Document ownerDoc = DOMUtils.getOwnerDocument(parent);
120 
121         Element transformElem = null;
122         if (parent.getLocalName().equals(&quot;Transforms&quot;)) {
123             transformElem = DOMUtils.createElement(ownerDoc, &quot;Transform&quot;,
124                                                    XMLSignature.XMLNS,
125                                                    dsPrefix);
126         } else {
127             transformElem = DOMUtils.createElement(ownerDoc,
128                                                    &quot;CanonicalizationMethod&quot;,
129                                                    XMLSignature.XMLNS,
130                                                    dsPrefix);
131         }
132         DOMUtils.setAttribute(transformElem, &quot;Algorithm&quot;, getAlgorithm());
133 
134         spi.marshalParams(new javax.xml.crypto.dom.DOMStructure(transformElem),
135                           context);
136 
137         parent.appendChild(transformElem);
138     }
139 
140     /**
141      * Transforms the specified data using the underlying transform algorithm.
142      *
143      * @param data the data to be transformed
144      * @param xc the {@code XMLCryptoContext} containing
145      *    additional context (may be {@code null} if not applicable)
146      * @return the transformed data
147      * @throws NullPointerException if {@code data} is {@code null}
148      * @throws XMLSignatureException if an unexpected error occurs while
149      *    executing the transform
150      */
151     public Data transform(Data data, XMLCryptoContext xc)
152         throws TransformException
153     {
154         return spi.transform(data, xc);
155     }
156 
157     /**
158      * Transforms the specified data using the underlying transform algorithm.
159      *
160      * @param data the data to be transformed
161      * @param xc     the {@code XMLCryptoContext} containing
162      *    additional context (may be {@code null} if not applicable)
163      * @param os the {@code OutputStream} that should be used to write
164      *    the transformed data to
165      * @return the transformed data
166      * @throws NullPointerException if {@code data} is {@code null}
167      * @throws XMLSignatureException if an unexpected error occurs while
168      *    executing the transform
169      */
170     public Data transform(Data data, XMLCryptoContext xc, OutputStream os)
171         throws TransformException
172     {
173         return spi.transform(data, xc, os);
174     }
175 
176     @Override
177     public boolean equals(Object o) {
178         if (this == o) {
179             return true;
180         }
181 
182         if (!(o instanceof Transform)) {
183             return false;
184         }
185         Transform otransform = (Transform)o;
186 
187         return getAlgorithm().equals(otransform.getAlgorithm()) &amp;&amp;
188                 DOMUtils.paramsEqual(getParameterSpec(),
189                                      otransform.getParameterSpec());
190     }
191 
192     @Override
193     public int hashCode() {
194         int result = 17;
195         result = 31 * result + getAlgorithm().hashCode();
196         AlgorithmParameterSpec spec = getParameterSpec();
197         if (spec != null) {
198             result = 31 * result + spec.hashCode();
199         }
200 
201         return result;
202     }
203 
204     /**
205      * Transforms the specified data using the underlying transform algorithm.
206      * This method invokes the {@link #marshal marshal} method and passes it
207      * the specified {@code DOMSignContext} before transforming the data.
208      *
209      * @param data the data to be transformed
210      * @param sc the {@code XMLCryptoContext} containing
211      *    additional context (may be {@code null} if not applicable)
212      * @param context the marshalling context
213      * @return the transformed data
214      * @throws MarshalException if an exception occurs while marshalling
215      * @throws NullPointerException if {@code data} or {@code context}
216      *    is {@code null}
217      * @throws XMLSignatureException if an unexpected error occurs while
218      *    executing the transform
219      */
220     Data transform(Data data, XMLCryptoContext xc, DOMSignContext context)
221         throws MarshalException, TransformException
222     {
223         marshal(context.getParent(),
224                 DOMUtils.getSignaturePrefix(context), context);
225         return transform(data, xc);
226     }
227 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>