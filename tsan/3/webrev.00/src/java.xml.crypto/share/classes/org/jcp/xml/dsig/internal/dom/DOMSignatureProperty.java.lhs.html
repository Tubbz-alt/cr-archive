<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml.crypto/share/classes/org/jcp/xml/dsig/internal/dom/DOMSignatureProperty.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /**
  6  * Licensed to the Apache Software Foundation (ASF) under one
  7  * or more contributor license agreements. See the NOTICE file
  8  * distributed with this work for additional information
  9  * regarding copyright ownership. The ASF licenses this file
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 /*
<a name="1" id="anc1"></a><span class="line-modified"> 24  * Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.</span>
 25  */
 26 /*
<a name="2" id="anc2"></a><span class="line-modified"> 27  * $Id: DOMSignatureProperty.java 1788465 2017-03-24 15:10:51Z coheigea $</span>
 28  */
 29 package org.jcp.xml.dsig.internal.dom;
 30 
 31 import javax.xml.crypto.*;
 32 import javax.xml.crypto.dom.DOMCryptoContext;
 33 import javax.xml.crypto.dsig.*;
 34 
 35 import java.util.*;
 36 
 37 import org.w3c.dom.Attr;
 38 import org.w3c.dom.Document;
 39 import org.w3c.dom.Element;
 40 import org.w3c.dom.Node;
 41 
 42 /**
 43  * DOM-based implementation of SignatureProperty.
 44  *
 45  */
 46 public final class DOMSignatureProperty extends DOMStructure
 47     implements SignatureProperty {
 48 
 49     private final String id;
 50     private final String target;
 51     private final List&lt;XMLStructure&gt; content;
 52 
 53     /**
 54      * Creates a {@code SignatureProperty} from the specified parameters.
 55      *
 56      * @param content a list of one or more {@link XMLStructure}s. The list
 57      *    is defensively copied to protect against subsequent modification.
 58      * @param target the target URI
 59      * @param id the Id (may be {@code null})
 60      * @throws ClassCastException if {@code content} contains any
 61      *    entries that are not of type {@link XMLStructure}
 62      * @throws IllegalArgumentException if {@code content} is empty
 63      * @throws NullPointerException if {@code content} or
 64      *    {@code target} is {@code null}
 65      */
 66     public DOMSignatureProperty(List&lt;? extends XMLStructure&gt; content,
 67                                 String target, String id)
 68     {
 69         if (target == null) {
 70             throw new NullPointerException(&quot;target cannot be null&quot;);
 71         } else if (content == null) {
 72             throw new NullPointerException(&quot;content cannot be null&quot;);
 73         } else if (content.isEmpty()) {
 74             throw new IllegalArgumentException(&quot;content cannot be empty&quot;);
 75         } else {
 76             this.content = Collections.unmodifiableList(
 77                 new ArrayList&lt;&gt;(content));
 78             for (int i = 0, size = this.content.size(); i &lt; size; i++) {
 79                 if (!(this.content.get(i) instanceof XMLStructure)) {
 80                     throw new ClassCastException
 81                         (&quot;content[&quot;+i+&quot;] is not a valid type&quot;);
 82                 }
 83             }
 84         }
 85         this.target = target;
 86         this.id = id;
 87     }
 88 
 89     /**
 90      * Creates a {@code DOMSignatureProperty} from an element.
 91      *
 92      * @param propElem a SignatureProperty element
 93      */
 94     public DOMSignatureProperty(Element propElem)
 95         throws MarshalException
 96     {
 97         // unmarshal attributes
 98         target = DOMUtils.getAttributeValue(propElem, &quot;Target&quot;);
 99         if (target == null) {
100             throw new MarshalException(&quot;target cannot be null&quot;);
101         }
102         Attr attr = propElem.getAttributeNodeNS(null, &quot;Id&quot;);
103         if (attr != null) {
104             id = attr.getValue();
105             propElem.setIdAttributeNode(attr, true);
106         } else {
107             id = null;
108         }
109 
110         List&lt;XMLStructure&gt; newContent = new ArrayList&lt;&gt;();
111         Node firstChild = propElem.getFirstChild();
112         while (firstChild != null) {
113             newContent.add(new javax.xml.crypto.dom.DOMStructure(firstChild));
114             firstChild = firstChild.getNextSibling();
115         }
116         if (newContent.isEmpty()) {
117             throw new MarshalException(&quot;content cannot be empty&quot;);
118         } else {
119             this.content = Collections.unmodifiableList(newContent);
120         }
121     }
122 
123     public List&lt;XMLStructure&gt; getContent() {
124         return content;
125     }
126 
127     public String getId() {
128         return id;
129     }
130 
131     public String getTarget() {
132         return target;
133     }
134 
135     @Override
136     public void marshal(Node parent, String dsPrefix, DOMCryptoContext context)
137         throws MarshalException
138     {
139         Document ownerDoc = DOMUtils.getOwnerDocument(parent);
140         Element propElem = DOMUtils.createElement(ownerDoc, &quot;SignatureProperty&quot;,
141                                                   XMLSignature.XMLNS, dsPrefix);
142 
143         // set attributes
144         DOMUtils.setAttributeID(propElem, &quot;Id&quot;, id);
145         DOMUtils.setAttribute(propElem, &quot;Target&quot;, target);
146 
147         // create and append any elements and mixed content
148         for (XMLStructure property : content) {
149             DOMUtils.appendChild(propElem,
150                 ((javax.xml.crypto.dom.DOMStructure)property).getNode());
151         }
152 
153         parent.appendChild(propElem);
154     }
155 
156     @Override
157     public boolean equals(Object o) {
158         if (this == o) {
159             return true;
160         }
161 
162         if (!(o instanceof SignatureProperty)) {
163             return false;
164         }
165         SignatureProperty osp = (SignatureProperty)o;
166 
167         boolean idsEqual = id == null ? osp.getId() == null
168                                        : id.equals(osp.getId());
169 
170         @SuppressWarnings(&quot;unchecked&quot;)
171         List&lt;XMLStructure&gt; ospContent = osp.getContent();
172         return equalsContent(ospContent) &amp;&amp;
173                 target.equals(osp.getTarget()) &amp;&amp; idsEqual;
174     }
175 
176     @Override
177     public int hashCode() {
178         int result = 17;
179         if (id != null) {
180             result = 31 * result + id.hashCode();
181         }
182         result = 31 * result + target.hashCode();
183         result = 31 * result + content.hashCode();
184 
185         return result;
186     }
187 
188     private boolean equalsContent(List&lt;XMLStructure&gt; otherContent) {
189         int osize = otherContent.size();
190         if (content.size() != osize) {
191             return false;
192         }
193         for (int i = 0; i &lt; osize; i++) {
194             XMLStructure oxs = otherContent.get(i);
195             XMLStructure xs = content.get(i);
196             if (oxs instanceof javax.xml.crypto.dom.DOMStructure) {
197                 if (!(xs instanceof javax.xml.crypto.dom.DOMStructure)) {
198                     return false;
199                 }
200                 Node onode = ((javax.xml.crypto.dom.DOMStructure)oxs).getNode();
201                 Node node = ((javax.xml.crypto.dom.DOMStructure)xs).getNode();
202                 if (!DOMUtils.nodesEqual(node, onode)) {
203                     return false;
204                 }
205             } else {
206                 if (!(xs.equals(oxs))) {
207                     return false;
208                 }
209             }
210         }
211 
212         return true;
213     }
214 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>