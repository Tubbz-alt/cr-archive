<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml.crypto/share/classes/org/jcp/xml/dsig/internal/dom/DOMXMLSignature.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DOMXMLObject.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DOMXMLSignatureFactory.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml.crypto/share/classes/org/jcp/xml/dsig/internal/dom/DOMXMLSignature.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  4  */
  5 /**
  6  * Licensed to the Apache Software Foundation (ASF) under one
  7  * or more contributor license agreements. See the NOTICE file
  8  * distributed with this work for additional information
  9  * regarding copyright ownership. The ASF licenses this file
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 /*
<span class="line-modified"> 24  * Portions copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.</span>
 25  */
 26 /*
 27  * ===========================================================================
 28  *
 29  * (C) Copyright IBM Corp. 2003 All Rights Reserved.
 30  *
 31  * ===========================================================================
 32  */
 33 /*
<span class="line-modified"> 34  * $Id: DOMXMLSignature.java 1788465 2017-03-24 15:10:51Z coheigea $</span>
 35  */
 36 package org.jcp.xml.dsig.internal.dom;
 37 
 38 import javax.xml.crypto.*;
 39 import javax.xml.crypto.dom.*;
 40 import javax.xml.crypto.dsig.*;
 41 import javax.xml.crypto.dsig.dom.DOMSignContext;
 42 import javax.xml.crypto.dsig.dom.DOMValidateContext;
 43 import javax.xml.crypto.dsig.keyinfo.KeyInfo;
 44 
 45 import java.security.InvalidKeyException;
 46 import java.security.Key;
 47 import java.security.Provider;
 48 import java.util.Collections;
 49 import java.util.ArrayList;
 50 import java.util.HashMap;
 51 import java.util.List;
 52 import java.util.Map;
 53 
 54 import org.w3c.dom.Attr;
</pre>
<hr />
<pre>
491     }
492 
493     public class DOMSignatureValue extends DOMStructure
494         implements SignatureValue
495     {
496         private String id;
497         private byte[] value;
498         private String valueBase64;
499         private Element sigValueElem;
500         private boolean validated = false;
501         private boolean validationStatus;
502 
503         DOMSignatureValue(String id) {
504             this.id = id;
505         }
506 
507         DOMSignatureValue(Element sigValueElem)
508             throws MarshalException
509         {
510             // base64 decode signatureValue
<span class="line-modified">511             String content = XMLUtils.getFullTextChildrenFromElement(sigValueElem);</span>
512             value = XMLUtils.decode(content);
513 
514             Attr attr = sigValueElem.getAttributeNodeNS(null, &quot;Id&quot;);
515             if (attr != null) {
516                 id = attr.getValue();
517                 sigValueElem.setIdAttributeNode(attr, true);
518             } else {
519                 id = null;
520             }
521             this.sigValueElem = sigValueElem;
522         }
523 
524         public String getId() {
525             return id;
526         }
527 
528         public byte[] getValue() {
529             return (value == null) ? null : value.clone();
530         }
531 
</pre>
<hr />
<pre>
595                 id == null ? osv.getId() == null : id.equals(osv.getId());
596 
597             //XXX compare signature values?
598             return idEqual;
599         }
600 
601         @Override
602         public int hashCode() {
603             int result = 17;
604             if (id != null) {
605                 result = 31 * result + id.hashCode();
606             }
607 
608             return result;
609         }
610 
611         public void marshal(Node parent, String dsPrefix,
612                             DOMCryptoContext context)
613             throws MarshalException
614         {

615             sigValueElem = DOMUtils.createElement(ownerDoc, &quot;SignatureValue&quot;,
616                                                   XMLSignature.XMLNS, dsPrefix);
617             if (valueBase64 != null) {
618                 sigValueElem.appendChild(ownerDoc.createTextNode(valueBase64));
619             }
620 
621             // append Id attribute, if specified
622             DOMUtils.setAttributeID(sigValueElem, &quot;Id&quot;, id);
623             parent.appendChild(sigValueElem);
624         }
625 
626         void setValue(byte[] value) {
627             this.value = value;
628             valueBase64 = XMLUtils.encodeToString(value);
629             sigValueElem.appendChild(ownerDoc.createTextNode(valueBase64));
630         }
631     }
632 }
</pre>
</td>
<td>
<hr />
<pre>
  4  */
  5 /**
  6  * Licensed to the Apache Software Foundation (ASF) under one
  7  * or more contributor license agreements. See the NOTICE file
  8  * distributed with this work for additional information
  9  * regarding copyright ownership. The ASF licenses this file
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 /*
<span class="line-modified"> 24  * Portions copyright (c) 2005, 2019, Oracle and/or its affiliates. All rights reserved.</span>
 25  */
 26 /*
 27  * ===========================================================================
 28  *
 29  * (C) Copyright IBM Corp. 2003 All Rights Reserved.
 30  *
 31  * ===========================================================================
 32  */
 33 /*
<span class="line-modified"> 34  * $Id: DOMXMLSignature.java 1854026 2019-02-21 09:30:01Z coheigea $</span>
 35  */
 36 package org.jcp.xml.dsig.internal.dom;
 37 
 38 import javax.xml.crypto.*;
 39 import javax.xml.crypto.dom.*;
 40 import javax.xml.crypto.dsig.*;
 41 import javax.xml.crypto.dsig.dom.DOMSignContext;
 42 import javax.xml.crypto.dsig.dom.DOMValidateContext;
 43 import javax.xml.crypto.dsig.keyinfo.KeyInfo;
 44 
 45 import java.security.InvalidKeyException;
 46 import java.security.Key;
 47 import java.security.Provider;
 48 import java.util.Collections;
 49 import java.util.ArrayList;
 50 import java.util.HashMap;
 51 import java.util.List;
 52 import java.util.Map;
 53 
 54 import org.w3c.dom.Attr;
</pre>
<hr />
<pre>
491     }
492 
493     public class DOMSignatureValue extends DOMStructure
494         implements SignatureValue
495     {
496         private String id;
497         private byte[] value;
498         private String valueBase64;
499         private Element sigValueElem;
500         private boolean validated = false;
501         private boolean validationStatus;
502 
503         DOMSignatureValue(String id) {
504             this.id = id;
505         }
506 
507         DOMSignatureValue(Element sigValueElem)
508             throws MarshalException
509         {
510             // base64 decode signatureValue
<span class="line-modified">511             String content = XMLUtils.getFullTextChildrenFromNode(sigValueElem);</span>
512             value = XMLUtils.decode(content);
513 
514             Attr attr = sigValueElem.getAttributeNodeNS(null, &quot;Id&quot;);
515             if (attr != null) {
516                 id = attr.getValue();
517                 sigValueElem.setIdAttributeNode(attr, true);
518             } else {
519                 id = null;
520             }
521             this.sigValueElem = sigValueElem;
522         }
523 
524         public String getId() {
525             return id;
526         }
527 
528         public byte[] getValue() {
529             return (value == null) ? null : value.clone();
530         }
531 
</pre>
<hr />
<pre>
595                 id == null ? osv.getId() == null : id.equals(osv.getId());
596 
597             //XXX compare signature values?
598             return idEqual;
599         }
600 
601         @Override
602         public int hashCode() {
603             int result = 17;
604             if (id != null) {
605                 result = 31 * result + id.hashCode();
606             }
607 
608             return result;
609         }
610 
611         public void marshal(Node parent, String dsPrefix,
612                             DOMCryptoContext context)
613             throws MarshalException
614         {
<span class="line-added">615             // create SignatureValue element</span>
616             sigValueElem = DOMUtils.createElement(ownerDoc, &quot;SignatureValue&quot;,
617                                                   XMLSignature.XMLNS, dsPrefix);
618             if (valueBase64 != null) {
619                 sigValueElem.appendChild(ownerDoc.createTextNode(valueBase64));
620             }
621 
622             // append Id attribute, if specified
623             DOMUtils.setAttributeID(sigValueElem, &quot;Id&quot;, id);
624             parent.appendChild(sigValueElem);
625         }
626 
627         void setValue(byte[] value) {
628             this.value = value;
629             valueBase64 = XMLUtils.encodeToString(value);
630             sigValueElem.appendChild(ownerDoc.createTextNode(valueBase64));
631         }
632     }
633 }
</pre>
</td>
</tr>
</table>
<center><a href="DOMXMLObject.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="DOMXMLSignatureFactory.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>