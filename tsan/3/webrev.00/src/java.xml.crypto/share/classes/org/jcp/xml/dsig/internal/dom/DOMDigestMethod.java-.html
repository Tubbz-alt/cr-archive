<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/java.xml.crypto/share/classes/org/jcp/xml/dsig/internal/dom/DOMDigestMethod.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /**
  6  * Licensed to the Apache Software Foundation (ASF) under one
  7  * or more contributor license agreements. See the NOTICE file
  8  * distributed with this work for additional information
  9  * regarding copyright ownership. The ASF licenses this file
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 /*
 24  * Copyright (c) 2005, 2018, Oracle and/or its affiliates. All rights reserved.
 25  */
 26 /*
 27  * $Id: DOMDigestMethod.java 1788465 2017-03-24 15:10:51Z coheigea $
 28  */
 29 package org.jcp.xml.dsig.internal.dom;
 30 
 31 import javax.xml.crypto.*;
 32 import javax.xml.crypto.dom.DOMCryptoContext;
 33 import javax.xml.crypto.dsig.*;
 34 import javax.xml.crypto.dsig.spec.DigestMethodParameterSpec;
 35 
 36 import java.security.InvalidAlgorithmParameterException;
 37 import java.security.spec.AlgorithmParameterSpec;
 38 import org.w3c.dom.Document;
 39 import org.w3c.dom.Element;
 40 import org.w3c.dom.Node;
 41 
 42 /**
 43  * DOM-based abstract implementation of DigestMethod.
 44  *
 45  */
 46 public abstract class DOMDigestMethod extends DOMStructure
 47     implements DigestMethod {
 48 
 49     static final String SHA224 =
 50         &quot;http://www.w3.org/2001/04/xmldsig-more#sha224&quot;; // see RFC 4051
 51     static final String SHA384 =
 52         &quot;http://www.w3.org/2001/04/xmldsig-more#sha384&quot;; // see RFC 4051
 53     static final String WHIRLPOOL =
 54         &quot;http://www.w3.org/2007/05/xmldsig-more#whirlpool&quot;; // see RFC 6931
 55     static final String SHA3_224 =
 56         &quot;http://www.w3.org/2007/05/xmldsig-more#sha3-224&quot;; // see RFC 6931
 57     static final String SHA3_256 =
 58         &quot;http://www.w3.org/2007/05/xmldsig-more#sha3-256&quot;; // see RFC 6931
 59     static final String SHA3_384 =
 60         &quot;http://www.w3.org/2007/05/xmldsig-more#sha3-384&quot;; // see RFC 6931
 61     static final String SHA3_512 =
 62         &quot;http://www.w3.org/2007/05/xmldsig-more#sha3-512&quot;; // see RFC 6931
 63 
 64     private DigestMethodParameterSpec params;
 65 
 66     /**
 67      * Creates a {@code DOMDigestMethod}.
 68      *
 69      * @param params the algorithm-specific params (may be {@code null})
 70      * @throws InvalidAlgorithmParameterException if the parameters are not
 71      *    appropriate for this digest method
 72      */
 73     DOMDigestMethod(AlgorithmParameterSpec params)
 74         throws InvalidAlgorithmParameterException
 75     {
 76         if (params != null &amp;&amp; !(params instanceof DigestMethodParameterSpec)) {
 77             throw new InvalidAlgorithmParameterException
 78                 (&quot;params must be of type DigestMethodParameterSpec&quot;);
 79         }
 80         checkParams((DigestMethodParameterSpec)params);
 81         this.params = (DigestMethodParameterSpec)params;
 82     }
 83 
 84     /**
 85      * Creates a {@code DOMDigestMethod} from an element. This constructor
 86      * invokes the abstract {@link #unmarshalParams unmarshalParams} method to
 87      * unmarshal any algorithm-specific input parameters.
 88      *
 89      * @param dmElem a DigestMethod element
 90      */
 91     DOMDigestMethod(Element dmElem) throws MarshalException {
 92         Element paramsElem = DOMUtils.getFirstChildElement(dmElem);
 93         if (paramsElem != null) {
 94             params = unmarshalParams(paramsElem);
 95         }
 96         try {
 97             checkParams(params);
 98         } catch (InvalidAlgorithmParameterException iape) {
 99             throw new MarshalException(iape);
100         }
101     }
102 
103     static DigestMethod unmarshal(Element dmElem) throws MarshalException {
104         String alg = DOMUtils.getAttributeValue(dmElem, &quot;Algorithm&quot;);
105         if (alg.equals(DigestMethod.SHA1)) {
106             return new SHA1(dmElem);
107         } else if (alg.equals(SHA224)) {
108             return new SHA224(dmElem);
109         } else if (alg.equals(DigestMethod.SHA256)) {
110             return new SHA256(dmElem);
111         } else if (alg.equals(SHA384)) {
112             return new SHA384(dmElem);
113         } else if (alg.equals(DigestMethod.SHA512)) {
114             return new SHA512(dmElem);
115         } else if (alg.equals(DigestMethod.RIPEMD160)) {
116             return new RIPEMD160(dmElem);
117         } else if (alg.equals(WHIRLPOOL)) {
118             return new WHIRLPOOL(dmElem);
119         } else if (alg.equals(SHA3_224)) {
120             return new SHA3_224(dmElem);
121         } else if (alg.equals(SHA3_256)) {
122             return new SHA3_256(dmElem);
123         } else if (alg.equals(SHA3_384)) {
124             return new SHA3_384(dmElem);
125         } else if (alg.equals(SHA3_512)) {
126             return new SHA3_512(dmElem);
127         } else {
128             throw new MarshalException(&quot;unsupported DigestMethod algorithm: &quot; +
129                                        alg);
130         }
131     }
132 
133     /**
134      * Checks if the specified parameters are valid for this algorithm. By
135      * default, this method throws an exception if parameters are specified
136      * since most DigestMethod algorithms do not have parameters. Subclasses
137      * should override it if they have parameters.
138      *
139      * @param params the algorithm-specific params (may be {@code null})
140      * @throws InvalidAlgorithmParameterException if the parameters are not
141      *    appropriate for this digest method
142      */
143     void checkParams(DigestMethodParameterSpec params)
144         throws InvalidAlgorithmParameterException
145     {
146         if (params != null) {
147             throw new InvalidAlgorithmParameterException(&quot;no parameters &quot; +
148                 &quot;should be specified for the &quot; + getMessageDigestAlgorithm() +
149                 &quot; DigestMethod algorithm&quot;);
150         }
151     }
152 
153     public final AlgorithmParameterSpec getParameterSpec() {
154         return params;
155     }
156 
157     /**
158      * Unmarshals {@code DigestMethodParameterSpec} from the specified
159      * {@code Element}.  By default, this method throws an exception since
160      * most DigestMethod algorithms do not have parameters. Subclasses should
161      * override it if they have parameters.
162      *
163      * @param paramsElem the {@code Element} holding the input params
164      * @return the algorithm-specific {@code DigestMethodParameterSpec}
165      * @throws MarshalException if the parameters cannot be unmarshalled
166      */
167     DigestMethodParameterSpec unmarshalParams(Element paramsElem)
168         throws MarshalException
169     {
170         throw new MarshalException(&quot;no parameters should &quot; +
171                                    &quot;be specified for the &quot; +
172                                    getMessageDigestAlgorithm() +
173                                    &quot; DigestMethod algorithm&quot;);
174     }
175 
176     /**
177      * This method invokes the abstract {@link #marshalParams marshalParams}
178      * method to marshal any algorithm-specific parameters.
179      */
180     @Override
181     public void marshal(Node parent, String prefix, DOMCryptoContext context)
182         throws MarshalException
183     {
184         Document ownerDoc = DOMUtils.getOwnerDocument(parent);
185 
186         Element dmElem = DOMUtils.createElement(ownerDoc, &quot;DigestMethod&quot;,
187                                                 XMLSignature.XMLNS, prefix);
188         DOMUtils.setAttribute(dmElem, &quot;Algorithm&quot;, getAlgorithm());
189 
190         if (params != null) {
191             marshalParams(dmElem, prefix);
192         }
193 
194         parent.appendChild(dmElem);
195     }
196 
197     @Override
198     public boolean equals(Object o) {
199         if (this == o) {
200             return true;
201         }
202 
203         if (!(o instanceof DigestMethod)) {
204             return false;
205         }
206         DigestMethod odm = (DigestMethod)o;
207 
208         boolean paramsEqual = params == null ? odm.getParameterSpec() == null :
209             params.equals(odm.getParameterSpec());
210 
211         return getAlgorithm().equals(odm.getAlgorithm()) &amp;&amp; paramsEqual;
212     }
213 
214     @Override
215     public int hashCode() {
216         int result = 17;
217         if (params != null) {
218             result = 31 * result + params.hashCode();
219         }
220         result = 31 * result + getAlgorithm().hashCode();
221 
222         return result;
223     }
224 
225     /**
226      * Marshals the algorithm-specific parameters to an Element and
227      * appends it to the specified parent element. By default, this method
228      * throws an exception since most DigestMethod algorithms do not have
229      * parameters. Subclasses should override it if they have parameters.
230      *
231      * @param parent the parent element to append the parameters to
232      * @param the namespace prefix to use
233      * @throws MarshalException if the parameters cannot be marshalled
234      */
235     void marshalParams(Element parent, String prefix)
236         throws MarshalException
237     {
238         throw new MarshalException(&quot;no parameters should &quot; +
239                                    &quot;be specified for the &quot; +
240                                    getMessageDigestAlgorithm() +
241                                    &quot; DigestMethod algorithm&quot;);
242     }
243 
244     /**
245      * Returns the MessageDigest standard algorithm name.
246      */
247     abstract String getMessageDigestAlgorithm();
248 
249     static final class SHA1 extends DOMDigestMethod {
250         SHA1(AlgorithmParameterSpec params)
251             throws InvalidAlgorithmParameterException {
252             super(params);
253         }
254         SHA1(Element dmElem) throws MarshalException {
255             super(dmElem);
256         }
257         public String getAlgorithm() {
258             return DigestMethod.SHA1;
259         }
260         String getMessageDigestAlgorithm() {
261             return &quot;SHA-1&quot;;
262         }
263     }
264 
265     static final class SHA224 extends DOMDigestMethod {
266         SHA224(AlgorithmParameterSpec params)
267             throws InvalidAlgorithmParameterException {
268             super(params);
269         }
270         SHA224(Element dmElem) throws MarshalException {
271             super(dmElem);
272         }
273         @Override
274         public String getAlgorithm() {
275             return SHA224;
276         }
277         @Override
278         String getMessageDigestAlgorithm() {
279             return &quot;SHA-224&quot;;
280         }
281     }
282 
283     static final class SHA256 extends DOMDigestMethod {
284         SHA256(AlgorithmParameterSpec params)
285             throws InvalidAlgorithmParameterException {
286             super(params);
287         }
288         SHA256(Element dmElem) throws MarshalException {
289             super(dmElem);
290         }
291         public String getAlgorithm() {
292             return DigestMethod.SHA256;
293         }
294         String getMessageDigestAlgorithm() {
295             return &quot;SHA-256&quot;;
296         }
297     }
298 
299     static final class SHA384 extends DOMDigestMethod {
300         SHA384(AlgorithmParameterSpec params)
301             throws InvalidAlgorithmParameterException {
302             super(params);
303         }
304         SHA384(Element dmElem) throws MarshalException {
305             super(dmElem);
306         }
307         public String getAlgorithm() {
308             return SHA384;
309         }
310         String getMessageDigestAlgorithm() {
311             return &quot;SHA-384&quot;;
312         }
313     }
314 
315     static final class SHA512 extends DOMDigestMethod {
316         SHA512(AlgorithmParameterSpec params)
317             throws InvalidAlgorithmParameterException {
318             super(params);
319         }
320         SHA512(Element dmElem) throws MarshalException {
321             super(dmElem);
322         }
323         public String getAlgorithm() {
324             return DigestMethod.SHA512;
325         }
326         String getMessageDigestAlgorithm() {
327             return &quot;SHA-512&quot;;
328         }
329     }
330 
331     static final class RIPEMD160 extends DOMDigestMethod {
332         RIPEMD160(AlgorithmParameterSpec params)
333             throws InvalidAlgorithmParameterException {
334             super(params);
335         }
336         RIPEMD160(Element dmElem) throws MarshalException {
337             super(dmElem);
338         }
339         @Override
340         public String getAlgorithm() {
341             return DigestMethod.RIPEMD160;
342         }
343         @Override
344         String getMessageDigestAlgorithm() {
345             return &quot;RIPEMD160&quot;;
346         }
347     }
348 
349     static final class WHIRLPOOL extends DOMDigestMethod {
350         WHIRLPOOL(AlgorithmParameterSpec params)
351             throws InvalidAlgorithmParameterException {
352             super(params);
353         }
354         WHIRLPOOL(Element dmElem) throws MarshalException {
355             super(dmElem);
356         }
357         @Override
358         public String getAlgorithm() {
359             return WHIRLPOOL;
360         }
361         @Override
362         String getMessageDigestAlgorithm() {
363             return &quot;WHIRLPOOL&quot;;
364         }
365     }
366 
367     static final class SHA3_224 extends DOMDigestMethod {
368         SHA3_224(AlgorithmParameterSpec params)
369             throws InvalidAlgorithmParameterException {
370             super(params);
371         }
372         SHA3_224(Element dmElem) throws MarshalException {
373             super(dmElem);
374         }
375         @Override
376         public String getAlgorithm() {
377             return SHA3_224;
378         }
379         @Override
380         String getMessageDigestAlgorithm() {
381             return &quot;SHA3-224&quot;;
382         }
383     }
384 
385     static final class SHA3_256 extends DOMDigestMethod {
386         SHA3_256(AlgorithmParameterSpec params)
387             throws InvalidAlgorithmParameterException {
388             super(params);
389         }
390         SHA3_256(Element dmElem) throws MarshalException {
391             super(dmElem);
392         }
393         @Override
394         public String getAlgorithm() {
395             return SHA3_256;
396         }
397         @Override
398         String getMessageDigestAlgorithm() {
399             return &quot;SHA3-256&quot;;
400         }
401     }
402 
403     static final class SHA3_384 extends DOMDigestMethod {
404         SHA3_384(AlgorithmParameterSpec params)
405             throws InvalidAlgorithmParameterException {
406             super(params);
407         }
408         SHA3_384(Element dmElem) throws MarshalException {
409             super(dmElem);
410         }
411         @Override
412         public String getAlgorithm() {
413             return SHA3_384;
414         }
415         @Override
416         String getMessageDigestAlgorithm() {
417             return &quot;SHA3-384&quot;;
418         }
419     }
420 
421     static final class SHA3_512 extends DOMDigestMethod {
422         SHA3_512(AlgorithmParameterSpec params)
423             throws InvalidAlgorithmParameterException {
424             super(params);
425         }
426         SHA3_512(Element dmElem) throws MarshalException {
427             super(dmElem);
428         }
429         @Override
430         public String getAlgorithm() {
431             return SHA3_512;
432         }
433         @Override
434         String getMessageDigestAlgorithm() {
435             return &quot;SHA3-512&quot;;
436         }
437     }
438 }
    </pre>
  </body>
</html>