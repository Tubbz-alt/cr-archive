<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/transforms/params/XPathFilterCHGPContainer.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /**
  6  * Licensed to the Apache Software Foundation (ASF) under one
  7  * or more contributor license agreements. See the NOTICE file
  8  * distributed with this work for additional information
  9  * regarding copyright ownership. The ASF licenses this file
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.transforms.params;
 24 
 25 
 26 import com.sun.org.apache.xml.internal.security.exceptions.XMLSecurityException;
 27 import com.sun.org.apache.xml.internal.security.transforms.TransformParam;
 28 import com.sun.org.apache.xml.internal.security.utils.ElementProxy;
 29 import com.sun.org.apache.xml.internal.security.utils.XMLUtils;
 30 import org.w3c.dom.Document;
 31 import org.w3c.dom.Element;
 32 import org.w3c.dom.Node;
<a name="1" id="anc1"></a>
 33 
 34 /**
 35  * Implements the parameters for a custom Transform which has a better performance
 36  * than the xfilter2.
 37  *
 38  */
 39 public class XPathFilterCHGPContainer extends ElementProxy implements TransformParam {
 40 
 41     public static final String TRANSFORM_XPATHFILTERCHGP =
 42         &quot;http://www.nue.et-inf.uni-siegen.de/~geuer-pollmann/#xpathFilter&quot;;
 43 
 44     /** Field _ATT_FILTER_VALUE_INTERSECT */
 45     private static final String _TAG_INCLUDE_BUT_SEARCH = &quot;IncludeButSearch&quot;;
 46 
 47     /** Field _ATT_FILTER_VALUE_SUBTRACT */
 48     private static final String _TAG_EXCLUDE_BUT_SEARCH = &quot;ExcludeButSearch&quot;;
 49 
 50     /** Field _ATT_FILTER_VALUE_UNION */
 51     private static final String _TAG_EXCLUDE = &quot;Exclude&quot;;
 52 
 53     /** Field _TAG_XPATHCHGP */
 54     public static final String _TAG_XPATHCHGP = &quot;XPathAlternative&quot;;
 55 
 56     /** Field _ATT_INCLUDESLASH */
 57     public static final String _ATT_INCLUDESLASH = &quot;IncludeSlashPolicy&quot;;
 58 
 59     /** Field IncludeSlash           */
 60     public static final boolean IncludeSlash = true;
 61 
 62     /** Field ExcludeSlash           */
 63     public static final boolean ExcludeSlash = false;
 64 
 65     /**
 66      * Constructor XPathFilterCHGPContainer
 67      *
 68      */
 69     private XPathFilterCHGPContainer() {
 70         // no instantiation
 71     }
 72 
 73     /**
 74      * Constructor XPathFilterCHGPContainer
 75      *
 76      * @param doc
 77      * @param includeSlashPolicy
 78      * @param includeButSearch
 79      * @param excludeButSearch
 80      * @param exclude
 81      */
 82     private XPathFilterCHGPContainer(
 83         Document doc, boolean includeSlashPolicy, String includeButSearch,
 84         String excludeButSearch, String exclude
 85     ) {
 86         super(doc);
 87 
 88         if (includeSlashPolicy) {
 89             setLocalAttribute(XPathFilterCHGPContainer._ATT_INCLUDESLASH, &quot;true&quot;);
 90         } else {
 91             setLocalAttribute(XPathFilterCHGPContainer._ATT_INCLUDESLASH, &quot;false&quot;);
 92         }
 93 
 94         if (includeButSearch != null &amp;&amp; includeButSearch.trim().length() &gt; 0) {
 95             Element includeButSearchElem =
 96                 ElementProxy.createElementForFamily(
 97                     doc, this.getBaseNamespace(), XPathFilterCHGPContainer._TAG_INCLUDE_BUT_SEARCH
 98                 );
 99 
100             includeButSearchElem.appendChild(
101                 createText(indentXPathText(includeButSearch))
102             );
103             addReturnToSelf();
104             appendSelf(includeButSearchElem);
105         }
106 
107         if (excludeButSearch != null &amp;&amp; excludeButSearch.trim().length() &gt; 0) {
108             Element excludeButSearchElem =
109                 ElementProxy.createElementForFamily(
110                     doc, this.getBaseNamespace(), XPathFilterCHGPContainer._TAG_EXCLUDE_BUT_SEARCH
111                 );
112 
113             excludeButSearchElem.appendChild(
114                 createText(indentXPathText(excludeButSearch)));
115 
116             addReturnToSelf();
117             appendSelf(excludeButSearchElem);
118         }
119 
120         if (exclude != null &amp;&amp; exclude.trim().length() &gt; 0) {
121             Element excludeElem =
122                 ElementProxy.createElementForFamily(
123                    doc, this.getBaseNamespace(), XPathFilterCHGPContainer._TAG_EXCLUDE);
124 
125             excludeElem.appendChild(createText(indentXPathText(exclude)));
126             addReturnToSelf();
127             appendSelf(excludeElem);
128         }
129 
130         addReturnToSelf();
131     }
132 
133     /**
134      * Method indentXPathText
135      *
136      * @param xp
137      * @return the string with enters
138      */
139     static String indentXPathText(String xp) {
140         if (xp.length() &gt; 2 &amp;&amp; !Character.isWhitespace(xp.charAt(0))) {
141             return &quot;\n&quot; + xp + &quot;\n&quot;;
142         }
143         return xp;
144     }
145 
146     /**
147      * Constructor XPathFilterCHGPContainer
148      *
149      * @param element
150      * @param baseURI
151      * @throws XMLSecurityException
152      */
153     private XPathFilterCHGPContainer(Element element, String baseURI)
154         throws XMLSecurityException {
155         super(element, baseURI);
156     }
157 
158     /**
159      * Creates a new XPathFilterCHGPContainer; needed for generation.
160      *
161      * @param doc
162      * @param includeSlashPolicy
163      * @param includeButSearch
164      * @param excludeButSearch
165      * @param exclude
166      * @return the created object
167      */
168     public static XPathFilterCHGPContainer getInstance(
169         Document doc, boolean includeSlashPolicy, String includeButSearch,
170         String excludeButSearch, String exclude
171     ) {
172         return new XPathFilterCHGPContainer(
173             doc, includeSlashPolicy, includeButSearch, excludeButSearch, exclude);
174     }
175 
176     /**
177      * Creates a XPathFilterCHGPContainer from an existing Element; needed for verification.
178      *
179      * @param element
180      * @param baseURI
181      *
182      * @throws XMLSecurityException
183      * @return the created object.
184      */
185     public static XPathFilterCHGPContainer getInstance(
186         Element element, String baseURI
187     ) throws XMLSecurityException {
188         return new XPathFilterCHGPContainer(element, baseURI);
189     }
190 
191     /**
192      * Method getXStr
193      *
194      * @param type
195      * @return The Xstr
196      */
197     private String getXStr(String type) {
198         if (this.length(this.getBaseNamespace(), type) != 1) {
199             return &quot;&quot;;
200         }
201 
202         Element xElem =
203             XMLUtils.selectNode(
204                 getElement().getFirstChild(), this.getBaseNamespace(), type, 0
205             );
206 
<a name="2" id="anc2"></a><span class="line-modified">207         return XMLUtils.getFullTextChildrenFromElement(xElem);</span>
208     }
209 
210     /**
211      * Method getIncludeButSearch
212      *
213      * @return the string
214      */
215     public String getIncludeButSearch() {
216         return this.getXStr(XPathFilterCHGPContainer._TAG_INCLUDE_BUT_SEARCH);
217     }
218 
219     /**
220      * Method getExcludeButSearch
221      *
222      * @return the string
223      */
224     public String getExcludeButSearch() {
225         return this.getXStr(XPathFilterCHGPContainer._TAG_EXCLUDE_BUT_SEARCH);
226     }
227 
228     /**
229      * Method getExclude
230      *
231      * @return the string
232      */
233     public String getExclude() {
234         return this.getXStr(XPathFilterCHGPContainer._TAG_EXCLUDE);
235     }
236 
237     /**
238      * Method getIncludeSlashPolicy
239      *
240      * @return the string
241      */
242     public boolean getIncludeSlashPolicy() {
243         return getLocalAttribute(XPathFilterCHGPContainer._ATT_INCLUDESLASH).equals(&quot;true&quot;);
244     }
245 
246     /**
247      * Returns the first Text node which contains information from the XPath
248      * Filter String. We must use this stupid hook to enable the here() function
249      * to work.
250      *
251      * $todo$ I dunno whether this crashes: &lt;XPath&gt; he&lt;!-- comment --&gt;re()/ds:Signature[1]&lt;/XPath&gt;
252      * @param type
253      * @return the first Text node which contains information from the XPath 2 Filter String
254      */
255     private Node getHereContextNode(String type) {
256 
257         if (this.length(this.getBaseNamespace(), type) != 1) {
258             return null;
259         }
260 
<a name="3" id="anc3"></a><span class="line-modified">261         return XMLUtils.selectNodeText(</span>
262             getFirstChild(), this.getBaseNamespace(), type, 0
263         );
264     }
265 
<a name="4" id="anc4"></a>











266     /**
267      * Method getHereContextNodeIncludeButSearch
268      *
269      * @return the string
270      */
271     public Node getHereContextNodeIncludeButSearch() {
272         return this.getHereContextNode(XPathFilterCHGPContainer._TAG_INCLUDE_BUT_SEARCH);
273     }
274 
275     /**
276      * Method getHereContextNodeExcludeButSearch
277      *
278      * @return the string
279      */
280     public Node getHereContextNodeExcludeButSearch() {
281         return this.getHereContextNode(XPathFilterCHGPContainer._TAG_EXCLUDE_BUT_SEARCH);
282     }
283 
284     /**
285      * Method getHereContextNodeExclude
286      *
287      * @return the string
288      */
289     public Node getHereContextNodeExclude() {
290         return this.getHereContextNode(XPathFilterCHGPContainer._TAG_EXCLUDE);
291     }
292 
293     /**
294      * Method getBaseLocalName
295      *
296      * {@inheritDoc}
297      */
298     public final String getBaseLocalName() {
299         return XPathFilterCHGPContainer._TAG_XPATHCHGP;
300     }
301 
302     /**
303      * Method getBaseNamespace
304      *
305      * {@inheritDoc}
306      */
307     public final String getBaseNamespace() {
308         return TRANSFORM_XPATHFILTERCHGP;
309     }
310 }
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>