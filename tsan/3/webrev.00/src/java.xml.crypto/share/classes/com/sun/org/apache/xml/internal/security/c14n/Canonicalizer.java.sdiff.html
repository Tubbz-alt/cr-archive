<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/c14n/Canonicalizer.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../algorithms/implementations/SignatureECDSA.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="CanonicalizerSpi.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/c14n/Canonicalizer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.c14n;
 24 
 25 import java.io.ByteArrayInputStream;
 26 import java.io.InputStream;
 27 import java.io.OutputStream;
 28 import java.nio.charset.StandardCharsets;
 29 import java.util.Map;
 30 import java.util.Set;
 31 import java.util.concurrent.ConcurrentHashMap;
 32 
<span class="line-removed"> 33 import javax.xml.parsers.DocumentBuilder;</span>
<span class="line-removed"> 34 </span>
 35 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer11_OmitComments;
 36 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer11_WithComments;
 37 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315ExclOmitComments;
 38 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315ExclWithComments;
 39 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315OmitComments;
 40 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315WithComments;
 41 import com.sun.org.apache.xml.internal.security.c14n.implementations.CanonicalizerPhysical;
 42 import com.sun.org.apache.xml.internal.security.exceptions.AlgorithmAlreadyRegisteredException;
 43 import com.sun.org.apache.xml.internal.security.utils.JavaUtils;
 44 import com.sun.org.apache.xml.internal.security.utils.XMLUtils;
 45 import org.w3c.dom.Document;
 46 import org.w3c.dom.Node;
 47 import org.w3c.dom.NodeList;
 48 import org.xml.sax.InputSource;
 49 
 50 /**
 51  *
 52  */
 53 public class Canonicalizer {
 54 
</pre>
<hr />
<pre>
244 
245     /**
246      * This method tries to canonicalize the given bytes. It&#39;s possible to even
247      * canonicalize non-wellformed sequences if they are well-formed after being
248      * wrapped with a {@code &amp;gt;a&amp;lt;...&amp;gt;/a&amp;lt;}.
249      *
250      * @param inputBytes
251      * @return the result of the canonicalization.
252      * @throws CanonicalizationException
253      * @throws java.io.IOException
254      * @throws javax.xml.parsers.ParserConfigurationException
255      * @throws org.xml.sax.SAXException
256      */
257     public byte[] canonicalize(byte[] inputBytes)
258         throws javax.xml.parsers.ParserConfigurationException,
259         java.io.IOException, org.xml.sax.SAXException, CanonicalizationException {
260         Document document = null;
261         try (InputStream bais = new ByteArrayInputStream(inputBytes)) {
262             InputSource in = new InputSource(bais);
263 
<span class="line-removed">264             // needs to validate for ID attribute normalization</span>
<span class="line-removed">265             DocumentBuilder db = XMLUtils.createDocumentBuilder(true, secureValidation);</span>
<span class="line-removed">266 </span>
267             /*
<span class="line-removed">268              * for some of the test vectors from the specification,</span>
<span class="line-removed">269              * there has to be a validating parser for ID attributes, default</span>
<span class="line-removed">270              * attribute values, NMTOKENS, etc.</span>
<span class="line-removed">271              * Unfortunately, the test vectors do use different DTDs or</span>
<span class="line-removed">272              * even no DTD. So Xerces 1.3.1 fires many warnings about using</span>
<span class="line-removed">273              * ErrorHandlers.</span>
<span class="line-removed">274              *</span>
275              * Text from the spec:
276              *
277              * The input octet stream MUST contain a well-formed XML document,
278              * but the input need not be validated. However, the attribute
279              * value normalization and entity reference resolution MUST be
280              * performed in accordance with the behaviors of a validating
281              * XML processor. As well, nodes for default attributes (declared
282              * in the ATTLIST with an AttValue but not specified) are created
283              * in each element. Thus, the declarations in the document type
284              * declaration are used to help create the canonical form, even
285              * though the document type declaration is not retained in the
286              * canonical form.
287              */
<span class="line-modified">288             db.setErrorHandler(new com.sun.org.apache.xml.internal.security.utils.IgnoreAllErrorHandler());</span>
<span class="line-removed">289 </span>
<span class="line-removed">290             document = db.parse(in);</span>
291         }
292         return this.canonicalizeSubtree(document);
293     }
294 
295     /**
296      * Canonicalizes the subtree rooted by {@code node}.
297      *
298      * @param node The node to canonicalize
299      * @return the result of the c14n.
300      *
301      * @throws CanonicalizationException
302      */
303     public byte[] canonicalizeSubtree(Node node) throws CanonicalizationException {
304         canonicalizerSpi.secureValidation = secureValidation;
305         return canonicalizerSpi.engineCanonicalizeSubTree(node);
306     }
307 
308     /**
309      * Canonicalizes the subtree rooted by {@code node}.
310      *
</pre>
</td>
<td>
<hr />
<pre>
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.c14n;
 24 
 25 import java.io.ByteArrayInputStream;
 26 import java.io.InputStream;
 27 import java.io.OutputStream;
 28 import java.nio.charset.StandardCharsets;
 29 import java.util.Map;
 30 import java.util.Set;
 31 import java.util.concurrent.ConcurrentHashMap;
 32 


 33 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer11_OmitComments;
 34 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer11_WithComments;
 35 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315ExclOmitComments;
 36 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315ExclWithComments;
 37 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315OmitComments;
 38 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315WithComments;
 39 import com.sun.org.apache.xml.internal.security.c14n.implementations.CanonicalizerPhysical;
 40 import com.sun.org.apache.xml.internal.security.exceptions.AlgorithmAlreadyRegisteredException;
 41 import com.sun.org.apache.xml.internal.security.utils.JavaUtils;
 42 import com.sun.org.apache.xml.internal.security.utils.XMLUtils;
 43 import org.w3c.dom.Document;
 44 import org.w3c.dom.Node;
 45 import org.w3c.dom.NodeList;
 46 import org.xml.sax.InputSource;
 47 
 48 /**
 49  *
 50  */
 51 public class Canonicalizer {
 52 
</pre>
<hr />
<pre>
242 
243     /**
244      * This method tries to canonicalize the given bytes. It&#39;s possible to even
245      * canonicalize non-wellformed sequences if they are well-formed after being
246      * wrapped with a {@code &amp;gt;a&amp;lt;...&amp;gt;/a&amp;lt;}.
247      *
248      * @param inputBytes
249      * @return the result of the canonicalization.
250      * @throws CanonicalizationException
251      * @throws java.io.IOException
252      * @throws javax.xml.parsers.ParserConfigurationException
253      * @throws org.xml.sax.SAXException
254      */
255     public byte[] canonicalize(byte[] inputBytes)
256         throws javax.xml.parsers.ParserConfigurationException,
257         java.io.IOException, org.xml.sax.SAXException, CanonicalizationException {
258         Document document = null;
259         try (InputStream bais = new ByteArrayInputStream(inputBytes)) {
260             InputSource in = new InputSource(bais);
261 



262             /*







263              * Text from the spec:
264              *
265              * The input octet stream MUST contain a well-formed XML document,
266              * but the input need not be validated. However, the attribute
267              * value normalization and entity reference resolution MUST be
268              * performed in accordance with the behaviors of a validating
269              * XML processor. As well, nodes for default attributes (declared
270              * in the ATTLIST with an AttValue but not specified) are created
271              * in each element. Thus, the declarations in the document type
272              * declaration are used to help create the canonical form, even
273              * though the document type declaration is not retained in the
274              * canonical form.
275              */
<span class="line-modified">276             document = XMLUtils.read(in, secureValidation);</span>


277         }
278         return this.canonicalizeSubtree(document);
279     }
280 
281     /**
282      * Canonicalizes the subtree rooted by {@code node}.
283      *
284      * @param node The node to canonicalize
285      * @return the result of the c14n.
286      *
287      * @throws CanonicalizationException
288      */
289     public byte[] canonicalizeSubtree(Node node) throws CanonicalizationException {
290         canonicalizerSpi.secureValidation = secureValidation;
291         return canonicalizerSpi.engineCanonicalizeSubTree(node);
292     }
293 
294     /**
295      * Canonicalizes the subtree rooted by {@code node}.
296      *
</pre>
</td>
</tr>
</table>
<center><a href="../algorithms/implementations/SignatureECDSA.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="CanonicalizerSpi.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>