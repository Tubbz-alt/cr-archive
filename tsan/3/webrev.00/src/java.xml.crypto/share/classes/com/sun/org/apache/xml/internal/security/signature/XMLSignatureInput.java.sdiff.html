<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/signature/XMLSignatureInput.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="XMLSignature.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../transforms/implementations/TransformBase64Decode.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/signature/XMLSignatureInput.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.signature;
 24 
 25 import java.io.ByteArrayInputStream;
 26 import java.io.ByteArrayOutputStream;
 27 import java.io.IOException;
 28 import java.io.InputStream;
 29 import java.io.OutputStream;
 30 import java.nio.charset.StandardCharsets;
 31 import java.util.ArrayList;
 32 import java.util.LinkedHashSet;
 33 import java.util.List;
 34 import java.util.Set;
 35 
<span class="line-removed"> 36 import javax.xml.parsers.DocumentBuilder;</span>
 37 import javax.xml.parsers.ParserConfigurationException;
 38 
 39 import com.sun.org.apache.xml.internal.security.c14n.CanonicalizationException;
 40 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer11_OmitComments;
 41 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315OmitComments;
 42 import com.sun.org.apache.xml.internal.security.c14n.implementations.CanonicalizerBase;
 43 import com.sun.org.apache.xml.internal.security.exceptions.XMLSecurityRuntimeException;
 44 import com.sun.org.apache.xml.internal.security.utils.JavaUtils;
 45 import com.sun.org.apache.xml.internal.security.utils.XMLUtils;
 46 import org.w3c.dom.Document;
 47 import org.w3c.dom.Node;
 48 import org.xml.sax.SAXException;
 49 
 50 /**
 51  * Class XMLSignatureInput
 52  *
 53  * $todo$ check whether an XMLSignatureInput can be _both_, octet stream _and_ node set?
 54  */
 55 public class XMLSignatureInput {
 56     /*
</pre>
<hr />
<pre>
557         }
558         nodeFilters.add(filter);
559     }
560 
561     /**
562      * @return the node filters
563      */
564     public List&lt;NodeFilter&gt; getNodeFilters() {
565         return nodeFilters;
566     }
567 
568     /**
569      * @param b
570      */
571     public void setNodeSet(boolean b) {
572         isNodeSet = b;
573     }
574 
575     void convertToNodes() throws CanonicalizationException,
576         ParserConfigurationException, IOException, SAXException {
<span class="line-removed">577         DocumentBuilder db = XMLUtils.createDocumentBuilder(false, secureValidation);</span>
578         // select all nodes, also the comments.
579         try {
<span class="line-modified">580             db.setErrorHandler(new com.sun.org.apache.xml.internal.security.utils.IgnoreAllErrorHandler());</span>
<span class="line-removed">581 </span>
<span class="line-removed">582             Document doc = db.parse(this.getOctetStream());</span>
583             this.subNode = doc;
584         } catch (SAXException ex) {
585             byte[] result = null;
586             // if a not-wellformed nodeset exists, put a container around it...
587             try (ByteArrayOutputStream baos = new ByteArrayOutputStream()) {
588 
589                 baos.write(&quot;&lt;container&gt;&quot;.getBytes(StandardCharsets.UTF_8));
590                 baos.write(this.getBytes());
591                 baos.write(&quot;&lt;/container&gt;&quot;.getBytes(StandardCharsets.UTF_8));
592 
593                 result = baos.toByteArray();
594             }
595             try (InputStream is = new ByteArrayInputStream(result)) {
<span class="line-modified">596                 Document document = db.parse(is);</span>
597                 this.subNode = document.getDocumentElement().getFirstChild().getFirstChild();
598             }
599         } finally {
600             if (this.inputOctetStreamProxy != null) {
601                 this.inputOctetStreamProxy.close();
602             }
603             this.inputOctetStreamProxy = null;
604             this.bytes = null;
605         }
606     }
607 
608     public boolean isSecureValidation() {
609         return secureValidation;
610     }
611 
612     public void setSecureValidation(boolean secureValidation) {
613         this.secureValidation = secureValidation;
614     }
615 
616     public String getPreCalculatedDigest() {
</pre>
</td>
<td>
<hr />
<pre>
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.signature;
 24 
 25 import java.io.ByteArrayInputStream;
 26 import java.io.ByteArrayOutputStream;
 27 import java.io.IOException;
 28 import java.io.InputStream;
 29 import java.io.OutputStream;
 30 import java.nio.charset.StandardCharsets;
 31 import java.util.ArrayList;
 32 import java.util.LinkedHashSet;
 33 import java.util.List;
 34 import java.util.Set;
 35 

 36 import javax.xml.parsers.ParserConfigurationException;
 37 
 38 import com.sun.org.apache.xml.internal.security.c14n.CanonicalizationException;
 39 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer11_OmitComments;
 40 import com.sun.org.apache.xml.internal.security.c14n.implementations.Canonicalizer20010315OmitComments;
 41 import com.sun.org.apache.xml.internal.security.c14n.implementations.CanonicalizerBase;
 42 import com.sun.org.apache.xml.internal.security.exceptions.XMLSecurityRuntimeException;
 43 import com.sun.org.apache.xml.internal.security.utils.JavaUtils;
 44 import com.sun.org.apache.xml.internal.security.utils.XMLUtils;
 45 import org.w3c.dom.Document;
 46 import org.w3c.dom.Node;
 47 import org.xml.sax.SAXException;
 48 
 49 /**
 50  * Class XMLSignatureInput
 51  *
 52  * $todo$ check whether an XMLSignatureInput can be _both_, octet stream _and_ node set?
 53  */
 54 public class XMLSignatureInput {
 55     /*
</pre>
<hr />
<pre>
556         }
557         nodeFilters.add(filter);
558     }
559 
560     /**
561      * @return the node filters
562      */
563     public List&lt;NodeFilter&gt; getNodeFilters() {
564         return nodeFilters;
565     }
566 
567     /**
568      * @param b
569      */
570     public void setNodeSet(boolean b) {
571         isNodeSet = b;
572     }
573 
574     void convertToNodes() throws CanonicalizationException,
575         ParserConfigurationException, IOException, SAXException {

576         // select all nodes, also the comments.
577         try {
<span class="line-modified">578             Document doc = XMLUtils.read(this.getOctetStream(), secureValidation);</span>


579             this.subNode = doc;
580         } catch (SAXException ex) {
581             byte[] result = null;
582             // if a not-wellformed nodeset exists, put a container around it...
583             try (ByteArrayOutputStream baos = new ByteArrayOutputStream()) {
584 
585                 baos.write(&quot;&lt;container&gt;&quot;.getBytes(StandardCharsets.UTF_8));
586                 baos.write(this.getBytes());
587                 baos.write(&quot;&lt;/container&gt;&quot;.getBytes(StandardCharsets.UTF_8));
588 
589                 result = baos.toByteArray();
590             }
591             try (InputStream is = new ByteArrayInputStream(result)) {
<span class="line-modified">592                 Document document = XMLUtils.read(is, secureValidation);</span>
593                 this.subNode = document.getDocumentElement().getFirstChild().getFirstChild();
594             }
595         } finally {
596             if (this.inputOctetStreamProxy != null) {
597                 this.inputOctetStreamProxy.close();
598             }
599             this.inputOctetStreamProxy = null;
600             this.bytes = null;
601         }
602     }
603 
604     public boolean isSecureValidation() {
605         return secureValidation;
606     }
607 
608     public void setSecureValidation(boolean secureValidation) {
609         this.secureValidation = secureValidation;
610     }
611 
612     public String getPreCalculatedDigest() {
</pre>
</td>
</tr>
</table>
<center><a href="XMLSignature.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../transforms/implementations/TransformBase64Decode.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>