<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/signature/XMLSignature.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SignedInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="XMLSignatureInput.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/signature/XMLSignature.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.signature;
 24 
 25 import java.io.IOException;
 26 import java.io.OutputStream;
 27 import java.security.Key;
 28 import java.security.PublicKey;
 29 import java.security.cert.X509Certificate;
<span class="line-removed"> 30 import java.util.Base64;</span>
 31 
 32 import javax.crypto.SecretKey;
 33 
 34 import com.sun.org.apache.xml.internal.security.algorithms.SignatureAlgorithm;
 35 import com.sun.org.apache.xml.internal.security.c14n.CanonicalizationException;
 36 import com.sun.org.apache.xml.internal.security.c14n.Canonicalizer;
 37 import com.sun.org.apache.xml.internal.security.c14n.InvalidCanonicalizerException;
 38 import com.sun.org.apache.xml.internal.security.exceptions.XMLSecurityException;
 39 import com.sun.org.apache.xml.internal.security.keys.KeyInfo;
 40 import com.sun.org.apache.xml.internal.security.keys.content.X509Data;
 41 import com.sun.org.apache.xml.internal.security.transforms.Transforms;
 42 import com.sun.org.apache.xml.internal.security.utils.Constants;
 43 import com.sun.org.apache.xml.internal.security.utils.I18n;
 44 import com.sun.org.apache.xml.internal.security.utils.SignatureElementProxy;
 45 import com.sun.org.apache.xml.internal.security.utils.SignerOutputStream;
 46 import com.sun.org.apache.xml.internal.security.utils.UnsyncBufferedOutputStream;
 47 import com.sun.org.apache.xml.internal.security.utils.XMLUtils;
 48 import com.sun.org.apache.xml.internal.security.utils.resolver.ResourceResolver;
 49 import com.sun.org.apache.xml.internal.security.utils.resolver.ResourceResolverSpi;
 50 import org.w3c.dom.Attr;
</pre>
<hr />
<pre>
487         return getLocalAttribute(Constants._ATT_ID);
488     }
489 
490     /**
491      * Returns the completely parsed {@code SignedInfo} object.
492      *
493      * @return the completely parsed {@code SignedInfo} object.
494      */
495     public SignedInfo getSignedInfo() {
496         return this.signedInfo;
497     }
498 
499     /**
500      * Returns the octet value of the SignatureValue element.
501      * Throws an XMLSignatureException if it has no or wrong content.
502      *
503      * @return the value of the SignatureValue element.
504      * @throws XMLSignatureException If there is no content
505      */
506     public byte[] getSignatureValue() throws XMLSignatureException {
<span class="line-modified">507         String content = XMLUtils.getFullTextChildrenFromElement(signatureValueElement);</span>
<span class="line-modified">508         return Base64.getMimeDecoder().decode(content);</span>
509     }
510 
511     /**
512      * Base64 encodes and sets the bytes as the content of the SignatureValue
513      * Node.
514      *
515      * @param bytes bytes to be used by SignatureValue before Base64 encoding
516      */
517     private void setSignatureValueElement(byte[] bytes) {
518 
519         while (signatureValueElement.hasChildNodes()) {
520             signatureValueElement.removeChild(signatureValueElement.getFirstChild());
521         }
522 
<span class="line-modified">523         String base64codedValue = Base64.getMimeEncoder().encodeToString(bytes);</span>
524 
525         if (base64codedValue.length() &gt; 76 &amp;&amp; !XMLUtils.ignoreLineBreaks()) {
526             base64codedValue = &quot;\n&quot; + base64codedValue + &quot;\n&quot;;
527         }
528 
529         Text t = createText(base64codedValue);
530         signatureValueElement.appendChild(t);
531     }
532 
533     /**
534      * Returns the KeyInfo child. If we are in signing mode and the KeyInfo
535      * does not exist yet, it is created on demand and added to the Signature.
536      * &lt;br&gt;
537      * This allows to add arbitrary content to the KeyInfo during signing.
538      *
539      * @return the KeyInfo object
540      */
541     public KeyInfo getKeyInfo() {
542         // check to see if we are signing and if we have to create a keyinfo
543         if (this.state == MODE_SIGN &amp;&amp; this.keyInfo == null) {
</pre>
</td>
<td>
<hr />
<pre>
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.signature;
 24 
 25 import java.io.IOException;
 26 import java.io.OutputStream;
 27 import java.security.Key;
 28 import java.security.PublicKey;
 29 import java.security.cert.X509Certificate;

 30 
 31 import javax.crypto.SecretKey;
 32 
 33 import com.sun.org.apache.xml.internal.security.algorithms.SignatureAlgorithm;
 34 import com.sun.org.apache.xml.internal.security.c14n.CanonicalizationException;
 35 import com.sun.org.apache.xml.internal.security.c14n.Canonicalizer;
 36 import com.sun.org.apache.xml.internal.security.c14n.InvalidCanonicalizerException;
 37 import com.sun.org.apache.xml.internal.security.exceptions.XMLSecurityException;
 38 import com.sun.org.apache.xml.internal.security.keys.KeyInfo;
 39 import com.sun.org.apache.xml.internal.security.keys.content.X509Data;
 40 import com.sun.org.apache.xml.internal.security.transforms.Transforms;
 41 import com.sun.org.apache.xml.internal.security.utils.Constants;
 42 import com.sun.org.apache.xml.internal.security.utils.I18n;
 43 import com.sun.org.apache.xml.internal.security.utils.SignatureElementProxy;
 44 import com.sun.org.apache.xml.internal.security.utils.SignerOutputStream;
 45 import com.sun.org.apache.xml.internal.security.utils.UnsyncBufferedOutputStream;
 46 import com.sun.org.apache.xml.internal.security.utils.XMLUtils;
 47 import com.sun.org.apache.xml.internal.security.utils.resolver.ResourceResolver;
 48 import com.sun.org.apache.xml.internal.security.utils.resolver.ResourceResolverSpi;
 49 import org.w3c.dom.Attr;
</pre>
<hr />
<pre>
486         return getLocalAttribute(Constants._ATT_ID);
487     }
488 
489     /**
490      * Returns the completely parsed {@code SignedInfo} object.
491      *
492      * @return the completely parsed {@code SignedInfo} object.
493      */
494     public SignedInfo getSignedInfo() {
495         return this.signedInfo;
496     }
497 
498     /**
499      * Returns the octet value of the SignatureValue element.
500      * Throws an XMLSignatureException if it has no or wrong content.
501      *
502      * @return the value of the SignatureValue element.
503      * @throws XMLSignatureException If there is no content
504      */
505     public byte[] getSignatureValue() throws XMLSignatureException {
<span class="line-modified">506         String content = XMLUtils.getFullTextChildrenFromNode(signatureValueElement);</span>
<span class="line-modified">507         return XMLUtils.decode(content);</span>
508     }
509 
510     /**
511      * Base64 encodes and sets the bytes as the content of the SignatureValue
512      * Node.
513      *
514      * @param bytes bytes to be used by SignatureValue before Base64 encoding
515      */
516     private void setSignatureValueElement(byte[] bytes) {
517 
518         while (signatureValueElement.hasChildNodes()) {
519             signatureValueElement.removeChild(signatureValueElement.getFirstChild());
520         }
521 
<span class="line-modified">522         String base64codedValue = XMLUtils.encodeToString(bytes);</span>
523 
524         if (base64codedValue.length() &gt; 76 &amp;&amp; !XMLUtils.ignoreLineBreaks()) {
525             base64codedValue = &quot;\n&quot; + base64codedValue + &quot;\n&quot;;
526         }
527 
528         Text t = createText(base64codedValue);
529         signatureValueElement.appendChild(t);
530     }
531 
532     /**
533      * Returns the KeyInfo child. If we are in signing mode and the KeyInfo
534      * does not exist yet, it is created on demand and added to the Signature.
535      * &lt;br&gt;
536      * This allows to add arbitrary content to the KeyInfo during signing.
537      *
538      * @return the KeyInfo object
539      */
540     public KeyInfo getKeyInfo() {
541         // check to see if we are signing and if we have to create a keyinfo
542         if (this.state == MODE_SIGN &amp;&amp; this.keyInfo == null) {
</pre>
</td>
</tr>
</table>
<center><a href="SignedInfo.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="XMLSignatureInput.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>