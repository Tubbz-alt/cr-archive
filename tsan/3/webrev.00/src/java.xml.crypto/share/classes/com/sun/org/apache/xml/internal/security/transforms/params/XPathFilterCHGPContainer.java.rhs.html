<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/transforms/params/XPathFilterCHGPContainer.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * reserved comment block
  3  * DO NOT REMOVE OR ALTER!
  4  */
  5 /**
  6  * Licensed to the Apache Software Foundation (ASF) under one
  7  * or more contributor license agreements. See the NOTICE file
  8  * distributed with this work for additional information
  9  * regarding copyright ownership. The ASF licenses this file
 10  * to you under the Apache License, Version 2.0 (the
 11  * &quot;License&quot;); you may not use this file except in compliance
 12  * with the License. You may obtain a copy of the License at
 13  *
 14  * http://www.apache.org/licenses/LICENSE-2.0
 15  *
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.transforms.params;
 24 
 25 
 26 import com.sun.org.apache.xml.internal.security.exceptions.XMLSecurityException;
 27 import com.sun.org.apache.xml.internal.security.transforms.TransformParam;
 28 import com.sun.org.apache.xml.internal.security.utils.ElementProxy;
 29 import com.sun.org.apache.xml.internal.security.utils.XMLUtils;
 30 import org.w3c.dom.Document;
 31 import org.w3c.dom.Element;
 32 import org.w3c.dom.Node;
<a name="1" id="anc1"></a><span class="line-added"> 33 import org.w3c.dom.Text;</span>
 34 
 35 /**
 36  * Implements the parameters for a custom Transform which has a better performance
 37  * than the xfilter2.
 38  *
 39  */
 40 public class XPathFilterCHGPContainer extends ElementProxy implements TransformParam {
 41 
 42     public static final String TRANSFORM_XPATHFILTERCHGP =
 43         &quot;http://www.nue.et-inf.uni-siegen.de/~geuer-pollmann/#xpathFilter&quot;;
 44 
 45     /** Field _ATT_FILTER_VALUE_INTERSECT */
 46     private static final String _TAG_INCLUDE_BUT_SEARCH = &quot;IncludeButSearch&quot;;
 47 
 48     /** Field _ATT_FILTER_VALUE_SUBTRACT */
 49     private static final String _TAG_EXCLUDE_BUT_SEARCH = &quot;ExcludeButSearch&quot;;
 50 
 51     /** Field _ATT_FILTER_VALUE_UNION */
 52     private static final String _TAG_EXCLUDE = &quot;Exclude&quot;;
 53 
 54     /** Field _TAG_XPATHCHGP */
 55     public static final String _TAG_XPATHCHGP = &quot;XPathAlternative&quot;;
 56 
 57     /** Field _ATT_INCLUDESLASH */
 58     public static final String _ATT_INCLUDESLASH = &quot;IncludeSlashPolicy&quot;;
 59 
 60     /** Field IncludeSlash           */
 61     public static final boolean IncludeSlash = true;
 62 
 63     /** Field ExcludeSlash           */
 64     public static final boolean ExcludeSlash = false;
 65 
 66     /**
 67      * Constructor XPathFilterCHGPContainer
 68      *
 69      */
 70     private XPathFilterCHGPContainer() {
 71         // no instantiation
 72     }
 73 
 74     /**
 75      * Constructor XPathFilterCHGPContainer
 76      *
 77      * @param doc
 78      * @param includeSlashPolicy
 79      * @param includeButSearch
 80      * @param excludeButSearch
 81      * @param exclude
 82      */
 83     private XPathFilterCHGPContainer(
 84         Document doc, boolean includeSlashPolicy, String includeButSearch,
 85         String excludeButSearch, String exclude
 86     ) {
 87         super(doc);
 88 
 89         if (includeSlashPolicy) {
 90             setLocalAttribute(XPathFilterCHGPContainer._ATT_INCLUDESLASH, &quot;true&quot;);
 91         } else {
 92             setLocalAttribute(XPathFilterCHGPContainer._ATT_INCLUDESLASH, &quot;false&quot;);
 93         }
 94 
 95         if (includeButSearch != null &amp;&amp; includeButSearch.trim().length() &gt; 0) {
 96             Element includeButSearchElem =
 97                 ElementProxy.createElementForFamily(
 98                     doc, this.getBaseNamespace(), XPathFilterCHGPContainer._TAG_INCLUDE_BUT_SEARCH
 99                 );
100 
101             includeButSearchElem.appendChild(
102                 createText(indentXPathText(includeButSearch))
103             );
104             addReturnToSelf();
105             appendSelf(includeButSearchElem);
106         }
107 
108         if (excludeButSearch != null &amp;&amp; excludeButSearch.trim().length() &gt; 0) {
109             Element excludeButSearchElem =
110                 ElementProxy.createElementForFamily(
111                     doc, this.getBaseNamespace(), XPathFilterCHGPContainer._TAG_EXCLUDE_BUT_SEARCH
112                 );
113 
114             excludeButSearchElem.appendChild(
115                 createText(indentXPathText(excludeButSearch)));
116 
117             addReturnToSelf();
118             appendSelf(excludeButSearchElem);
119         }
120 
121         if (exclude != null &amp;&amp; exclude.trim().length() &gt; 0) {
122             Element excludeElem =
123                 ElementProxy.createElementForFamily(
124                    doc, this.getBaseNamespace(), XPathFilterCHGPContainer._TAG_EXCLUDE);
125 
126             excludeElem.appendChild(createText(indentXPathText(exclude)));
127             addReturnToSelf();
128             appendSelf(excludeElem);
129         }
130 
131         addReturnToSelf();
132     }
133 
134     /**
135      * Method indentXPathText
136      *
137      * @param xp
138      * @return the string with enters
139      */
140     static String indentXPathText(String xp) {
141         if (xp.length() &gt; 2 &amp;&amp; !Character.isWhitespace(xp.charAt(0))) {
142             return &quot;\n&quot; + xp + &quot;\n&quot;;
143         }
144         return xp;
145     }
146 
147     /**
148      * Constructor XPathFilterCHGPContainer
149      *
150      * @param element
151      * @param baseURI
152      * @throws XMLSecurityException
153      */
154     private XPathFilterCHGPContainer(Element element, String baseURI)
155         throws XMLSecurityException {
156         super(element, baseURI);
157     }
158 
159     /**
160      * Creates a new XPathFilterCHGPContainer; needed for generation.
161      *
162      * @param doc
163      * @param includeSlashPolicy
164      * @param includeButSearch
165      * @param excludeButSearch
166      * @param exclude
167      * @return the created object
168      */
169     public static XPathFilterCHGPContainer getInstance(
170         Document doc, boolean includeSlashPolicy, String includeButSearch,
171         String excludeButSearch, String exclude
172     ) {
173         return new XPathFilterCHGPContainer(
174             doc, includeSlashPolicy, includeButSearch, excludeButSearch, exclude);
175     }
176 
177     /**
178      * Creates a XPathFilterCHGPContainer from an existing Element; needed for verification.
179      *
180      * @param element
181      * @param baseURI
182      *
183      * @throws XMLSecurityException
184      * @return the created object.
185      */
186     public static XPathFilterCHGPContainer getInstance(
187         Element element, String baseURI
188     ) throws XMLSecurityException {
189         return new XPathFilterCHGPContainer(element, baseURI);
190     }
191 
192     /**
193      * Method getXStr
194      *
195      * @param type
196      * @return The Xstr
197      */
198     private String getXStr(String type) {
199         if (this.length(this.getBaseNamespace(), type) != 1) {
200             return &quot;&quot;;
201         }
202 
203         Element xElem =
204             XMLUtils.selectNode(
205                 getElement().getFirstChild(), this.getBaseNamespace(), type, 0
206             );
207 
<a name="2" id="anc2"></a><span class="line-modified">208         return XMLUtils.getFullTextChildrenFromNode(xElem);</span>
209     }
210 
211     /**
212      * Method getIncludeButSearch
213      *
214      * @return the string
215      */
216     public String getIncludeButSearch() {
217         return this.getXStr(XPathFilterCHGPContainer._TAG_INCLUDE_BUT_SEARCH);
218     }
219 
220     /**
221      * Method getExcludeButSearch
222      *
223      * @return the string
224      */
225     public String getExcludeButSearch() {
226         return this.getXStr(XPathFilterCHGPContainer._TAG_EXCLUDE_BUT_SEARCH);
227     }
228 
229     /**
230      * Method getExclude
231      *
232      * @return the string
233      */
234     public String getExclude() {
235         return this.getXStr(XPathFilterCHGPContainer._TAG_EXCLUDE);
236     }
237 
238     /**
239      * Method getIncludeSlashPolicy
240      *
241      * @return the string
242      */
243     public boolean getIncludeSlashPolicy() {
244         return getLocalAttribute(XPathFilterCHGPContainer._ATT_INCLUDESLASH).equals(&quot;true&quot;);
245     }
246 
247     /**
248      * Returns the first Text node which contains information from the XPath
249      * Filter String. We must use this stupid hook to enable the here() function
250      * to work.
251      *
252      * $todo$ I dunno whether this crashes: &lt;XPath&gt; he&lt;!-- comment --&gt;re()/ds:Signature[1]&lt;/XPath&gt;
253      * @param type
254      * @return the first Text node which contains information from the XPath 2 Filter String
255      */
256     private Node getHereContextNode(String type) {
257 
258         if (this.length(this.getBaseNamespace(), type) != 1) {
259             return null;
260         }
261 
<a name="3" id="anc3"></a><span class="line-modified">262         return selectNodeText(</span>
263             getFirstChild(), this.getBaseNamespace(), type, 0
264         );
265     }
266 
<a name="4" id="anc4"></a><span class="line-added">267     private static Text selectNodeText(Node sibling, String uri, String nodeName, int number) {</span>
<span class="line-added">268         Node n = XMLUtils.selectNode(sibling, uri, nodeName, number);</span>
<span class="line-added">269         if (n == null) {</span>
<span class="line-added">270             return null;</span>
<span class="line-added">271         }</span>
<span class="line-added">272         n = n.getFirstChild();</span>
<span class="line-added">273         while (n != null &amp;&amp; n.getNodeType() != Node.TEXT_NODE) {</span>
<span class="line-added">274             n = n.getNextSibling();</span>
<span class="line-added">275         }</span>
<span class="line-added">276         return (Text)n;</span>
<span class="line-added">277     }</span>
<span class="line-added">278 </span>
279     /**
280      * Method getHereContextNodeIncludeButSearch
281      *
282      * @return the string
283      */
284     public Node getHereContextNodeIncludeButSearch() {
285         return this.getHereContextNode(XPathFilterCHGPContainer._TAG_INCLUDE_BUT_SEARCH);
286     }
287 
288     /**
289      * Method getHereContextNodeExcludeButSearch
290      *
291      * @return the string
292      */
293     public Node getHereContextNodeExcludeButSearch() {
294         return this.getHereContextNode(XPathFilterCHGPContainer._TAG_EXCLUDE_BUT_SEARCH);
295     }
296 
297     /**
298      * Method getHereContextNodeExclude
299      *
300      * @return the string
301      */
302     public Node getHereContextNodeExclude() {
303         return this.getHereContextNode(XPathFilterCHGPContainer._TAG_EXCLUDE);
304     }
305 
306     /**
307      * Method getBaseLocalName
308      *
309      * {@inheritDoc}
310      */
311     public final String getBaseLocalName() {
312         return XPathFilterCHGPContainer._TAG_XPATHCHGP;
313     }
314 
315     /**
316      * Method getBaseNamespace
317      *
318      * {@inheritDoc}
319      */
320     public final String getBaseNamespace() {
321         return TRANSFORM_XPATHFILTERCHGP;
322     }
323 }
<a name="5" id="anc5"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="5" type="hidden" />
</body>
</html>