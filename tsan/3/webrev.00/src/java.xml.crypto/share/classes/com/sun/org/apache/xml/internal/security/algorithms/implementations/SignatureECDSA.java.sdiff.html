<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/algorithms/implementations/SignatureECDSA.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SignatureDSA.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../c14n/Canonicalizer.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.xml.crypto/share/classes/com/sun/org/apache/xml/internal/security/algorithms/implementations/SignatureECDSA.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.algorithms.implementations;
 24 
 25 import java.io.IOException;
 26 import java.security.InvalidAlgorithmParameterException;
 27 import java.security.InvalidKeyException;
 28 import java.security.Key;
 29 import java.security.NoSuchProviderException;
 30 import java.security.PrivateKey;
 31 import java.security.PublicKey;
 32 import java.security.SecureRandom;
 33 import java.security.Signature;
 34 import java.security.SignatureException;
 35 import java.security.spec.AlgorithmParameterSpec;
<span class="line-removed"> 36 import java.util.Base64;</span>
 37 
 38 import com.sun.org.apache.xml.internal.security.algorithms.JCEMapper;
 39 import com.sun.org.apache.xml.internal.security.algorithms.SignatureAlgorithmSpi;
 40 import com.sun.org.apache.xml.internal.security.signature.XMLSignature;
 41 import com.sun.org.apache.xml.internal.security.signature.XMLSignatureException;

 42 
 43 /**
 44  *
 45  */
 46 public abstract class SignatureECDSA extends SignatureAlgorithmSpi {
 47 
 48     private static final com.sun.org.slf4j.internal.Logger LOG =
 49         com.sun.org.slf4j.internal.LoggerFactory.getLogger(SignatureECDSA.class);
 50 
 51     /** {@inheritDoc} */
 52     public abstract String engineGetURI();
 53 
 54     /** Field algorithm */
 55     private Signature signatureAlgorithm;
 56 
 57     /**
 58      * Converts an ASN.1 ECDSA value to a XML Signature ECDSA Value.
 59      *
 60      * The JAVA JCE ECDSA Signature algorithm creates ASN.1 encoded (r, s) value
 61      * pairs; the XML Signature requires the core BigInteger values.
</pre>
<hr />
<pre>
115             throw new XMLSignatureException(&quot;algorithms.NoSuchAlgorithm&quot;, exArgs);
116         }
117     }
118 
119     /** {@inheritDoc} */
120     protected void engineSetParameter(AlgorithmParameterSpec params)
121         throws XMLSignatureException {
122         try {
123             this.signatureAlgorithm.setParameter(params);
124         } catch (InvalidAlgorithmParameterException ex) {
125             throw new XMLSignatureException(ex);
126         }
127     }
128 
129     /** {@inheritDoc} */
130     protected boolean engineVerify(byte[] signature) throws XMLSignatureException {
131         try {
132             byte[] jcebytes = SignatureECDSA.convertXMLDSIGtoASN1(signature);
133 
134             if (LOG.isDebugEnabled()) {
<span class="line-modified">135                 LOG.debug(&quot;Called ECDSA.verify() on &quot; + Base64.getMimeEncoder().encodeToString(signature));</span>
136             }
137 
138             return this.signatureAlgorithm.verify(jcebytes);
139         } catch (SignatureException ex) {
140             throw new XMLSignatureException(ex);
141         } catch (IOException ex) {
142             throw new XMLSignatureException(ex);
143         }
144     }
145 
146     /** {@inheritDoc} */
147     protected void engineInitVerify(Key publicKey) throws XMLSignatureException {
148 
149         if (!(publicKey instanceof PublicKey)) {
150             String supplied = null;
151             if (publicKey != null) {
152                 supplied = publicKey.getClass().getName();
153             }
154             String needed = PublicKey.class.getName();
155             Object exArgs[] = { supplied, needed };
</pre>
</td>
<td>
<hr />
<pre>
 16  * Unless required by applicable law or agreed to in writing,
 17  * software distributed under the License is distributed on an
 18  * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 19  * KIND, either express or implied. See the License for the
 20  * specific language governing permissions and limitations
 21  * under the License.
 22  */
 23 package com.sun.org.apache.xml.internal.security.algorithms.implementations;
 24 
 25 import java.io.IOException;
 26 import java.security.InvalidAlgorithmParameterException;
 27 import java.security.InvalidKeyException;
 28 import java.security.Key;
 29 import java.security.NoSuchProviderException;
 30 import java.security.PrivateKey;
 31 import java.security.PublicKey;
 32 import java.security.SecureRandom;
 33 import java.security.Signature;
 34 import java.security.SignatureException;
 35 import java.security.spec.AlgorithmParameterSpec;

 36 
 37 import com.sun.org.apache.xml.internal.security.algorithms.JCEMapper;
 38 import com.sun.org.apache.xml.internal.security.algorithms.SignatureAlgorithmSpi;
 39 import com.sun.org.apache.xml.internal.security.signature.XMLSignature;
 40 import com.sun.org.apache.xml.internal.security.signature.XMLSignatureException;
<span class="line-added"> 41 import com.sun.org.apache.xml.internal.security.utils.XMLUtils;</span>
 42 
 43 /**
 44  *
 45  */
 46 public abstract class SignatureECDSA extends SignatureAlgorithmSpi {
 47 
 48     private static final com.sun.org.slf4j.internal.Logger LOG =
 49         com.sun.org.slf4j.internal.LoggerFactory.getLogger(SignatureECDSA.class);
 50 
 51     /** {@inheritDoc} */
 52     public abstract String engineGetURI();
 53 
 54     /** Field algorithm */
 55     private Signature signatureAlgorithm;
 56 
 57     /**
 58      * Converts an ASN.1 ECDSA value to a XML Signature ECDSA Value.
 59      *
 60      * The JAVA JCE ECDSA Signature algorithm creates ASN.1 encoded (r, s) value
 61      * pairs; the XML Signature requires the core BigInteger values.
</pre>
<hr />
<pre>
115             throw new XMLSignatureException(&quot;algorithms.NoSuchAlgorithm&quot;, exArgs);
116         }
117     }
118 
119     /** {@inheritDoc} */
120     protected void engineSetParameter(AlgorithmParameterSpec params)
121         throws XMLSignatureException {
122         try {
123             this.signatureAlgorithm.setParameter(params);
124         } catch (InvalidAlgorithmParameterException ex) {
125             throw new XMLSignatureException(ex);
126         }
127     }
128 
129     /** {@inheritDoc} */
130     protected boolean engineVerify(byte[] signature) throws XMLSignatureException {
131         try {
132             byte[] jcebytes = SignatureECDSA.convertXMLDSIGtoASN1(signature);
133 
134             if (LOG.isDebugEnabled()) {
<span class="line-modified">135                 LOG.debug(&quot;Called ECDSA.verify() on &quot; + XMLUtils.encodeToString(signature));</span>
136             }
137 
138             return this.signatureAlgorithm.verify(jcebytes);
139         } catch (SignatureException ex) {
140             throw new XMLSignatureException(ex);
141         } catch (IOException ex) {
142             throw new XMLSignatureException(ex);
143         }
144     }
145 
146     /** {@inheritDoc} */
147     protected void engineInitVerify(Key publicKey) throws XMLSignatureException {
148 
149         if (!(publicKey instanceof PublicKey)) {
150             String supplied = null;
151             if (publicKey != null) {
152                 supplied = publicKey.getClass().getName();
153             }
154             String needed = PublicKey.class.getName();
155             Object exArgs[] = { supplied, needed };
</pre>
</td>
</tr>
</table>
<center><a href="SignatureDSA.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../c14n/Canonicalizer.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>