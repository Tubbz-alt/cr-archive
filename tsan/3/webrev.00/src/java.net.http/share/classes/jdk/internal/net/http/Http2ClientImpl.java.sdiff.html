<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.net.http/share/classes/jdk/internal/net/http/Http2ClientImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Http1Response.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HttpConnection.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.net.http/share/classes/jdk/internal/net/http/Http2ClientImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.internal.net.http;
 27 

 28 import java.io.IOException;
 29 import java.io.UncheckedIOException;
 30 import java.net.ConnectException;
 31 import java.net.InetSocketAddress;
 32 import java.net.URI;
 33 import java.util.Base64;
 34 import java.util.Collections;
 35 import java.util.HashSet;
 36 import java.util.Map;
 37 import java.util.Set;
 38 import java.util.concurrent.ConcurrentHashMap;
 39 import java.util.concurrent.CompletableFuture;
 40 import jdk.internal.net.http.common.Log;
 41 import jdk.internal.net.http.common.Logger;
 42 import jdk.internal.net.http.common.MinimalFuture;
 43 import jdk.internal.net.http.common.Utils;
 44 import jdk.internal.net.http.frame.SettingsFrame;
 45 import static jdk.internal.net.http.frame.SettingsFrame.INITIAL_WINDOW_SIZE;
 46 import static jdk.internal.net.http.frame.SettingsFrame.ENABLE_PUSH;
 47 import static jdk.internal.net.http.frame.SettingsFrame.HEADER_TABLE_SIZE;
</pre>
<hr />
<pre>
169             }
170             if (debug.on())
171                 debug.log(&quot;put in the connection pool: %s&quot;, c);
172             return true;
173         }
174     }
175 
176     void deleteConnection(Http2Connection c) {
177         if (debug.on())
178             debug.log(&quot;removing from the connection pool: %s&quot;, c);
179         synchronized (this) {
180             Http2Connection c1 = connections.get(c.key());
181             if (c1 != null &amp;&amp; c1.equals(c)) {
182                 connections.remove(c.key());
183                 if (debug.on())
184                     debug.log(&quot;removed from the connection pool: %s&quot;, c);
185             }
186         }
187     }
188 

189     void stop() {
190         if (debug.on()) debug.log(&quot;stopping&quot;);


191         connections.values().forEach(this::close);
192         connections.clear();
193     }
194 
195     private void close(Http2Connection h2c) {
196         try { h2c.close(); } catch (Throwable t) {}

197     }
198 
199     HttpClientImpl client() {
200         return client;
201     }
202 
203     /** Returns the client settings as a base64 (url) encoded string */
204     String getSettingsString() {
205         SettingsFrame sf = getClientSettings();
206         byte[] settings = sf.toByteArray(); // without the header
207         Base64.Encoder encoder = Base64.getUrlEncoder()
208                                        .withoutPadding();
209         return encoder.encodeToString(settings);
210     }
211 
212     private static final int K = 1024;
213 
214     private static int getParameter(String property, int min, int max, int defaultValue) {
215         int value =  Utils.getIntegerNetProperty(property, defaultValue);
216         // use default value if misconfigured
</pre>
</td>
<td>
<hr />
<pre>
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.internal.net.http;
 27 
<span class="line-added"> 28 import java.io.EOFException;</span>
 29 import java.io.IOException;
 30 import java.io.UncheckedIOException;
 31 import java.net.ConnectException;
 32 import java.net.InetSocketAddress;
 33 import java.net.URI;
 34 import java.util.Base64;
 35 import java.util.Collections;
 36 import java.util.HashSet;
 37 import java.util.Map;
 38 import java.util.Set;
 39 import java.util.concurrent.ConcurrentHashMap;
 40 import java.util.concurrent.CompletableFuture;
 41 import jdk.internal.net.http.common.Log;
 42 import jdk.internal.net.http.common.Logger;
 43 import jdk.internal.net.http.common.MinimalFuture;
 44 import jdk.internal.net.http.common.Utils;
 45 import jdk.internal.net.http.frame.SettingsFrame;
 46 import static jdk.internal.net.http.frame.SettingsFrame.INITIAL_WINDOW_SIZE;
 47 import static jdk.internal.net.http.frame.SettingsFrame.ENABLE_PUSH;
 48 import static jdk.internal.net.http.frame.SettingsFrame.HEADER_TABLE_SIZE;
</pre>
<hr />
<pre>
170             }
171             if (debug.on())
172                 debug.log(&quot;put in the connection pool: %s&quot;, c);
173             return true;
174         }
175     }
176 
177     void deleteConnection(Http2Connection c) {
178         if (debug.on())
179             debug.log(&quot;removing from the connection pool: %s&quot;, c);
180         synchronized (this) {
181             Http2Connection c1 = connections.get(c.key());
182             if (c1 != null &amp;&amp; c1.equals(c)) {
183                 connections.remove(c.key());
184                 if (debug.on())
185                     debug.log(&quot;removed from the connection pool: %s&quot;, c);
186             }
187         }
188     }
189 
<span class="line-added">190     private EOFException STOPPED;</span>
191     void stop() {
192         if (debug.on()) debug.log(&quot;stopping&quot;);
<span class="line-added">193         STOPPED = new EOFException(&quot;HTTP/2 client stopped&quot;);</span>
<span class="line-added">194         STOPPED.setStackTrace(new StackTraceElement[0]);</span>
195         connections.values().forEach(this::close);
196         connections.clear();
197     }
198 
199     private void close(Http2Connection h2c) {
200         try { h2c.close(); } catch (Throwable t) {}
<span class="line-added">201         try { h2c.shutdown(STOPPED); } catch (Throwable t) {}</span>
202     }
203 
204     HttpClientImpl client() {
205         return client;
206     }
207 
208     /** Returns the client settings as a base64 (url) encoded string */
209     String getSettingsString() {
210         SettingsFrame sf = getClientSettings();
211         byte[] settings = sf.toByteArray(); // without the header
212         Base64.Encoder encoder = Base64.getUrlEncoder()
213                                        .withoutPadding();
214         return encoder.encodeToString(settings);
215     }
216 
217     private static final int K = 1024;
218 
219     private static int getParameter(String property, int min, int max, int defaultValue) {
220         int value =  Utils.getIntegerNetProperty(property, defaultValue);
221         // use default value if misconfigured
</pre>
</td>
</tr>
</table>
<center><a href="Http1Response.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="HttpConnection.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>