<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.net.http/share/classes/jdk/internal/net/http/HttpResponseImpl.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HttpRequestImpl.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="LineSubscriberAdapter.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.net.http/share/classes/jdk/internal/net/http/HttpResponseImpl.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2015, 2019, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2015, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -129,10 +129,34 @@</span>
                      &quot;RawChannel is only supported for WebSocket creation&quot;);
          }
          return rawChannelProvider.rawChannel();
      }
  
<span class="udiff-line-added">+     /**</span>
<span class="udiff-line-added">+      * Closes the RawChannel that may have been used for WebSocket protocol.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @apiNote This method should be called to close the connection</span>
<span class="udiff-line-added">+      * if an exception occurs during the websocket handshake, in cases where</span>
<span class="udiff-line-added">+      * {@link #rawChannel() rawChannel().close()} would have been called.</span>
<span class="udiff-line-added">+      * An unsuccessful handshake may prevent the creation of the RawChannel:</span>
<span class="udiff-line-added">+      * if a RawChannel has already been created, this method wil close it.</span>
<span class="udiff-line-added">+      * Otherwise, it will close the connection.</span>
<span class="udiff-line-added">+      *</span>
<span class="udiff-line-added">+      * @throws UnsupportedOperationException if getting a RawChannel over</span>
<span class="udiff-line-added">+      *         this connection is not supported.</span>
<span class="udiff-line-added">+      * @throws IOException if an I/O exception occurs while closing</span>
<span class="udiff-line-added">+      *         the channel.</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     @Override</span>
<span class="udiff-line-added">+     public synchronized void closeRawChannel() throws IOException {</span>
<span class="udiff-line-added">+         if (rawChannelProvider == null) {</span>
<span class="udiff-line-added">+             throw new UnsupportedOperationException(</span>
<span class="udiff-line-added">+                     &quot;RawChannel is only supported for WebSocket creation&quot;);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         rawChannelProvider.closeRawChannel();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      @Override
      public String toString() {
          StringBuilder sb = new StringBuilder();
          String method = request().method();
          URI uri = request().uri();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -187,10 +211,17 @@</span>
                  rawchan = new RawChannelTube(connection, initial);
              }
              return rawchan;
          }
  
<span class="udiff-line-added">+         public synchronized void closeRawChannel() throws IOException {</span>
<span class="udiff-line-added">+             //  close the rawChannel, if created, or the</span>
<span class="udiff-line-added">+             // connection, if not.</span>
<span class="udiff-line-added">+             if (rawchan != null) rawchan.close();</span>
<span class="udiff-line-added">+             else connection.close();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
          private static HttpConnection connection(Response resp, Exchange&lt;?&gt; exch) {
              if (exch == null || exch.exchImpl == null) {
                  assert resp.statusCode == 407;
                  return null; // case of Proxy 407
              }
</pre>
<center><a href="HttpRequestImpl.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="LineSubscriberAdapter.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>