<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/java.net.http/share/classes/jdk/internal/net/http/common/Utils.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="SubscriberWrapper.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../websocket/OpeningHandshake.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/java.net.http/share/classes/jdk/internal/net/http/common/Utils.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -37,11 +37,10 @@</span>
  import java.io.ByteArrayOutputStream;
  import java.io.Closeable;
  import java.io.IOException;
  import java.io.PrintStream;
  import java.io.UncheckedIOException;
<span class="udiff-line-removed">- import java.io.UnsupportedEncodingException;</span>
  import java.lang.System.Logger.Level;
  import java.net.ConnectException;
  import java.net.InetSocketAddress;
  import java.net.URI;
  import java.net.URLPermission;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -72,10 +71,11 @@</span>
  import java.util.function.Supplier;
  import java.util.stream.Collectors;
  import java.util.stream.Stream;
  
  import static java.lang.String.format;
<span class="udiff-line-added">+ import static java.nio.charset.StandardCharsets.US_ASCII;</span>
  import static java.util.stream.Collectors.joining;
  import jdk.internal.net.http.HttpRequestImpl;
  
  /**
   * Miscellaneous utilities
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -176,11 +176,16 @@</span>
      public static final BiPredicate&lt;String, String&gt; CONTEXT_RESTRICTED(HttpClient client) {
          return (k, v) -&gt; client.authenticator() == null ||
                  ! (k.equalsIgnoreCase(&quot;Authorization&quot;)
                          &amp;&amp; k.equalsIgnoreCase(&quot;Proxy-Authorization&quot;));
      }
<span class="udiff-line-added">+     private static final BiPredicate&lt;String, String&gt; HOST_RESTRICTED = (k,v) -&gt; !&quot;host&quot;.equalsIgnoreCase(k);</span>
<span class="udiff-line-added">+     public static final BiPredicate&lt;String, String&gt; PROXY_TUNNEL_RESTRICTED(HttpClient client)  {</span>
<span class="udiff-line-added">+         return CONTEXT_RESTRICTED(client).and(HOST_RESTRICTED);</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-added">+     private static final Predicate&lt;String&gt; IS_HOST = &quot;host&quot;::equalsIgnoreCase;</span>
      private static final Predicate&lt;String&gt; IS_PROXY_HEADER = (k) -&gt;
              k != null &amp;&amp; k.length() &gt; 6 &amp;&amp; &quot;proxy-&quot;.equalsIgnoreCase(k.substring(0,6));
      private static final Predicate&lt;String&gt; NO_PROXY_HEADER =
              IS_PROXY_HEADER.negate();
      private static final Predicate&lt;String&gt; ALL_HEADERS = (s) -&gt; true;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -248,11 +253,12 @@</span>
          return true;
      }
  
      public static final BiPredicate&lt;String, String&gt; PROXY_TUNNEL_FILTER =
              (s,v) -&gt; isAllowedForProxy(s, v, PROXY_AUTH_TUNNEL_DISABLED_SCHEMES,
<span class="udiff-line-modified-removed">-                     IS_PROXY_HEADER);</span>
<span class="udiff-line-modified-added">+                     // Allows Proxy-* and Host headers when establishing the tunnel.</span>
<span class="udiff-line-added">+                     IS_PROXY_HEADER.or(IS_HOST));</span>
      public static final BiPredicate&lt;String, String&gt; PROXY_FILTER =
              (s,v) -&gt; isAllowedForProxy(s, v, PROXY_AUTH_DISABLED_SCHEMES,
                      ALL_HEADERS);
      public static final BiPredicate&lt;String, String&gt; NO_PROXY_HEADERS_FILTER =
              (n,v) -&gt; Utils.NO_PROXY_HEADER.test(n);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -530,19 +536,13 @@</span>
          buffer.position(mark);
      }
  
      public static String stackTrace(Throwable t) {
          ByteArrayOutputStream bos = new ByteArrayOutputStream();
<span class="udiff-line-modified-removed">-         String s = null;</span>
<span class="udiff-line-modified-removed">-         try {</span>
<span class="udiff-line-modified-removed">-             PrintStream p = new PrintStream(bos, true, &quot;US-ASCII&quot;);</span>
<span class="udiff-line-removed">-             t.printStackTrace(p);</span>
<span class="udiff-line-removed">-             s = bos.toString(&quot;US-ASCII&quot;);</span>
<span class="udiff-line-removed">-         } catch (UnsupportedEncodingException ex) {</span>
<span class="udiff-line-removed">-             throw new InternalError(ex); // Can&#39;t happen</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         return s;</span>
<span class="udiff-line-modified-added">+         PrintStream p = new PrintStream(bos, true, US_ASCII);</span>
<span class="udiff-line-modified-added">+         t.printStackTrace(p);</span>
<span class="udiff-line-modified-added">+         return bos.toString(US_ASCII);</span>
      }
  
      /**
       * Copies as much of src to dst as possible.
       * Return number of bytes copied
</pre>
<center><a href="SubscriberWrapper.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../websocket/OpeningHandshake.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>