<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old src/jdk.compiler/share/classes/com/sun/tools/javac/comp/CompileStates.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
 1 /*
 2  * Copyright (c) 2013, Oracle and/or its affiliates. All rights reserved.
 3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
 4  *
 5  * This code is free software; you can redistribute it and/or modify it
 6  * under the terms of the GNU General Public License version 2 only, as
 7  * published by the Free Software Foundation.  Oracle designates this
 8  * particular file as subject to the &quot;Classpath&quot; exception as provided
 9  * by Oracle in the LICENSE file that accompanied this code.
10  *
11  * This code is distributed in the hope that it will be useful, but WITHOUT
12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
14  * version 2 for more details (a copy is included in the LICENSE file that
15  * accompanied this code).
16  *
17  * You should have received a copy of the GNU General Public License version
18  * 2 along with this work; if not, write to the Free Software Foundation,
19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
20  *
21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
22  * or visit www.oracle.com if you need additional information or have any
23  * questions.
24  */
25 
26 package com.sun.tools.javac.comp;
27 
28 import java.util.HashMap;
29 
30 import com.sun.tools.javac.util.Context;
31 
32 /** Partial map to record which compiler phases have been executed
33  *  for each compilation unit. Used for ATTR and FLOW phases.
34  *
35  *  &lt;p&gt;&lt;b&gt;This is NOT part of any supported API.
36  *  If you write code that depends on this, you do so at your own risk.
37  *  This code and its internal interfaces are subject to change or
38  *  deletion without notice.&lt;/b&gt;
39  */
40 public class CompileStates extends HashMap&lt;Env&lt;AttrContext&gt;, CompileStates.CompileState&gt; {
41     /** The context key for the compile states. */
42     protected static final Context.Key&lt;CompileStates&gt; compileStatesKey = new Context.Key&lt;&gt;();
43 
44     /** Get the CompileStates instance for this context. */
45     public static CompileStates instance(Context context) {
46         CompileStates instance = context.get(compileStatesKey);
47         if (instance == null) {
48             instance = new CompileStates(context);
49         }
50         return instance;
51     }
52 
53     /** Ordered list of compiler phases for each compilation unit. */
54     public enum CompileState {
55         INIT(0),
56         PARSE(1),
57         ENTER(2),
58         PROCESS(3),
59         ATTR(4),
60         FLOW(5),
61         TRANSTYPES(6),
62         UNLAMBDA(7),
63         LOWER(8),
64         GENERATE(9);
65 
66         CompileState(int value) {
67             this.value = value;
68         }
69         public boolean isAfter(CompileState other) {
70             return value &gt; other.value;
71         }
72         public static CompileState max(CompileState a, CompileState b) {
73             return a.value &gt; b.value ? a : b;
74         }
75         private final int value;
76     }
77 
78     private static final long serialVersionUID = 1812267524140424433L;
79 
80     protected Context context;
81 
82     public CompileStates(Context context) {
83         this.context = context;
84         context.put(compileStatesKey, this);
85     }
86 
87     public boolean isDone(Env&lt;AttrContext&gt; env, CompileState cs) {
88         CompileState ecs = get(env);
89         return (ecs != null) &amp;&amp; !cs.isAfter(ecs);
90     }
91 }
    </pre>
  </body>
</html>