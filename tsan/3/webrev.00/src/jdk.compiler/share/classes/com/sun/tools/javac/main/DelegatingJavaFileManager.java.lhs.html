<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames src/jdk.compiler/share/classes/com/sun/tools/javac/main/DelegatingJavaFileManager.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package com.sun.tools.javac.main;
 27 
 28 import java.io.File;
 29 import java.io.IOException;
 30 import java.nio.file.Path;
 31 import java.util.Collection;
 32 import java.util.Iterator;
 33 import java.util.ServiceLoader;
 34 import java.util.Set;
 35 
 36 import javax.tools.FileObject;
 37 import javax.tools.JavaFileManager;
 38 import javax.tools.JavaFileManager.Location;
 39 import javax.tools.JavaFileObject;
 40 import javax.tools.JavaFileObject.Kind;
 41 import javax.tools.StandardJavaFileManager;
 42 
 43 import com.sun.tools.javac.util.Context;
 44 
 45 /**
 46  * A JavaFileManager that delegates to one of two delegate ClassLoaders.
 47  */
 48 public class DelegatingJavaFileManager implements JavaFileManager {
 49 
 50     public static void installReleaseFileManager(Context context,
 51                                                  JavaFileManager releaseFM,
 52                                                  JavaFileManager originalFM) {
 53         context.put(JavaFileManager.class, (JavaFileManager) null);
 54         JavaFileManager nue = originalFM instanceof StandardJavaFileManager
 55                 ? new DelegatingSJFM(releaseFM,
 56                                                         (StandardJavaFileManager) originalFM)
 57                 : new DelegatingJavaFileManager(releaseFM, originalFM);
 58         context.put(JavaFileManager.class, nue);
 59     }
 60 
 61     private final JavaFileManager releaseFM;
 62     private final JavaFileManager baseFM;
 63 
 64     private DelegatingJavaFileManager(JavaFileManager releaseFM, JavaFileManager baseFM) {
 65         this.releaseFM = releaseFM;
 66         this.baseFM = baseFM;
 67     }
 68 
 69     private JavaFileManager delegate(Location location) {
 70         if (releaseFM.hasLocation(location)) {
 71             return releaseFM;
 72         }
 73         return baseFM;
 74     }
 75 
 76     @Override
 77     public ClassLoader getClassLoader(Location location) {
 78         return delegate(location).getClassLoader(location);
 79     }
 80 
 81     @Override
 82     public Iterable&lt;JavaFileObject&gt; list(Location location, String packageName,
 83                                          Set&lt;Kind&gt; kinds, boolean recurse) throws IOException {
 84         return delegate(location).list(location, packageName, kinds, recurse);
 85     }
 86 
 87     @Override
 88     public String inferBinaryName(Location location, JavaFileObject file) {
 89         return delegate(location).inferBinaryName(location, file);
 90     }
 91 
 92     @Override
 93     public boolean isSameFile(FileObject a, FileObject b) {
 94         return baseFM.isSameFile(a, b);
 95     }
 96 
 97     @Override
 98     public boolean handleOption(String current, Iterator&lt;String&gt; remaining) {
 99         return baseFM.handleOption(current, remaining);
100     }
101 
102     @Override
103     public boolean hasLocation(Location location) {
104         return releaseFM.hasLocation(location) || baseFM.hasLocation(location);
105     }
106 
107     @Override
108     public JavaFileObject getJavaFileForInput(Location location, String className,
109                                               Kind kind) throws IOException {
110         return delegate(location).getJavaFileForInput(location, className, kind);
111     }
112 
113     @Override
114     public JavaFileObject getJavaFileForOutput(Location location, String className, Kind kind,
115                                                FileObject sibling) throws IOException {
116         return delegate(location).getJavaFileForOutput(location, className, kind, sibling);
117     }
118 
119     @Override
120     public FileObject getFileForInput(Location location, String packageName,
121                                       String relativeName) throws IOException {
122         return delegate(location).getFileForInput(location, packageName, relativeName);
123     }
124 
125     @Override
126     public FileObject getFileForOutput(Location location, String packageName, String relativeName,
127                                        FileObject sibling) throws IOException {
128         return delegate(location).getFileForOutput(location, packageName, relativeName, sibling);
129     }
130 
131     @Override
132     public void flush() throws IOException {
133         releaseFM.flush();
134         baseFM.flush();
135     }
136 
137     @Override
138     public void close() throws IOException {
139         releaseFM.close();
140         baseFM.close();
141     }
142 
143     @Override
144     public Location getLocationForModule(Location location,
145                                          String moduleName) throws IOException {
146         return delegate(location).getLocationForModule(location, moduleName);
147     }
148 
149     @Override
150     public Location getLocationForModule(Location location,
151                                          JavaFileObject fo) throws IOException {
152         return delegate(location).getLocationForModule(location, fo);
153     }
154 
155     @Override
156     public &lt;S&gt; ServiceLoader&lt;S&gt; getServiceLoader(Location location,
157                                                  Class&lt;S&gt; service) throws IOException {
158         return delegate(location).getServiceLoader(location, service);
159     }
160 
161     @Override
162     public String inferModuleName(Location location) throws IOException {
163         return delegate(location).inferModuleName(location);
164     }
165 
166     @Override
167     public Iterable&lt;Set&lt;Location&gt;&gt; listLocationsForModules(Location location) throws IOException {
168         return delegate(location).listLocationsForModules(location);
169     }
170 
171     @Override
172     public boolean contains(Location location, FileObject fo) throws IOException {
173         return delegate(location).contains(location, fo);
174     }
175 
176     @Override
177     public int isSupportedOption(String option) {
178         return baseFM.isSupportedOption(option);
179     }
180 
181     public JavaFileManager getBaseFileManager() {
182         return baseFM;
183     }
184 
185     private static final class DelegatingSJFM extends DelegatingJavaFileManager
186                                               implements StandardJavaFileManager {
187 
188         private final StandardJavaFileManager baseSJFM;
189 
190         private DelegatingSJFM(JavaFileManager releaseFM,
191                                                   StandardJavaFileManager baseSJFM) {
192             super(releaseFM, baseSJFM);
193             this.baseSJFM = baseSJFM;
194         }
195 
196         @Override
197         public boolean isSameFile(FileObject a, FileObject b) {
198             return baseSJFM.isSameFile(a, b);
199         }
200 
201         @Override
202         public Iterable&lt;? extends JavaFileObject&gt; getJavaFileObjectsFromFiles
203                                                   (Iterable&lt;? extends File&gt; files) {
204             return baseSJFM.getJavaFileObjectsFromFiles(files);
205         }
206 
<a name="1" id="anc1"></a>






207         @Override
208         public Iterable&lt;? extends JavaFileObject&gt; getJavaFileObjectsFromPaths
209                                                   (Iterable&lt;? extends Path&gt; paths) {
210             return baseSJFM.getJavaFileObjectsFromPaths(paths);
211         }
212 
213         @Override
214         public Iterable&lt;? extends JavaFileObject&gt; getJavaFileObjects(File... files) {
215             return baseSJFM.getJavaFileObjects(files);
216         }
217 
218         @Override
219         public Iterable&lt;? extends JavaFileObject&gt; getJavaFileObjects(Path... paths) {
220             return baseSJFM.getJavaFileObjects(paths);
221         }
222 
223         @Override
224         public Iterable&lt;? extends JavaFileObject&gt; getJavaFileObjectsFromStrings
225                                                   (Iterable&lt;String&gt; names) {
226             return baseSJFM.getJavaFileObjectsFromStrings(names);
227         }
228 
229         @Override
230         public Iterable&lt;? extends JavaFileObject&gt; getJavaFileObjects(String... names) {
231             return baseSJFM.getJavaFileObjects(names);
232         }
233 
234         @Override
235         public void setLocation(Location location,
236                                 Iterable&lt;? extends File&gt; files) throws IOException {
237             baseSJFM.setLocation(location, files);
238         }
239 
240         @Override
241         public void setLocationFromPaths(Location location,
242                                          Collection&lt;? extends Path&gt; paths) throws IOException {
243             baseSJFM.setLocationFromPaths(location, paths);
244         }
245 
246         @Override
247         public void setLocationForModule(Location location, String moduleName,
248                                          Collection&lt;? extends Path&gt; paths) throws IOException {
249             baseSJFM.setLocationForModule(location, moduleName, paths);
250         }
251 
252         @Override
253         public Iterable&lt;? extends File&gt; getLocation(Location location) {
254             return baseSJFM.getLocation(location);
255         }
256 
257         @Override
258         public Iterable&lt;? extends Path&gt; getLocationAsPaths(Location location) {
259             return baseSJFM.getLocationAsPaths(location);
260         }
261 
262         @Override
263         public Path asPath(FileObject file) {
264             return baseSJFM.asPath(file);
265         }
266 
267         @Override
268         public void setPathFactory(PathFactory f) {
269             baseSJFM.setPathFactory(f);
270         }
271 
272     }
273 }
<a name="2" id="anc2"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="2" type="hidden" />
</body>
</html>